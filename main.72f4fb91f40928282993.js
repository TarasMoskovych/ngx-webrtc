(self.webpackChunkngx_webrtc=self.webpackChunkngx_webrtc||[]).push([[179],{255:ba=>{function Ra(ic){return Promise.resolve().then(()=>{var x=new Error("Cannot find module '"+ic+"'");throw x.code="MODULE_NOT_FOUND",x})}Ra.keys=()=>[],Ra.resolve=Ra,Ra.id=255,ba.exports=Ra},85:function(ba,Ra,ic){var x=ic(52).default;ba.exports=function(){"use strict";let cr=!0,hs=!0;function ps(s,i,r){const a=s.match(i);return a&&a.length>=r&&parseInt(a[r],10)}function Ir(s,i,r){if(!s.RTCPeerConnection)return;const a=s.RTCPeerConnection.prototype,l=a.addEventListener;a.addEventListener=function(h,f){if(h!==i)return l.apply(this,arguments);const m=g=>{const E=r(g);E&&(f.handleEvent?f.handleEvent(E):f(E))};return this._eventMap=this._eventMap||{},this._eventMap[i]||(this._eventMap[i]=new Map),this._eventMap[i].set(f,m),l.apply(this,[h,m])};const d=a.removeEventListener;a.removeEventListener=function(h,f){if(h!==i||!this._eventMap||!this._eventMap[i])return d.apply(this,arguments);if(!this._eventMap[i].has(f))return d.apply(this,arguments);const m=this._eventMap[i].get(f);return this._eventMap[i].delete(f),0===this._eventMap[i].size&&delete this._eventMap[i],0===Object.keys(this._eventMap).length&&delete this._eventMap,d.apply(this,[h,m])},Object.defineProperty(a,"on"+i,{get(){return this["_on"+i]},set(h){this["_on"+i]&&(this.removeEventListener(i,this["_on"+i]),delete this["_on"+i]),h&&this.addEventListener(i,this["_on"+i]=h)},enumerable:!0,configurable:!0})}function rc(s){return"boolean"!=typeof s?new Error("Argument type: "+typeof s+". Please use a boolean."):(cr=s,s?"adapter.js logging disabled":"adapter.js logging enabled")}function Uu(s){return"boolean"!=typeof s?new Error("Argument type: "+typeof s+". Please use a boolean."):(hs=!s,"adapter.js deprecation warnings "+(s?"disabled":"enabled"))}function fs(){if("object"==typeof window){if(cr)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function en(s,i){hs&&console.warn(s+" is deprecated, please use "+i+" instead.")}function $y(s){return"[object Object]"===Object.prototype.toString.call(s)}function Kp(s){return $y(s)?Object.keys(s).reduce(function(i,r){const a=$y(s[r]),l=a?Kp(s[r]):s[r],d=a&&!Object.keys(l).length;return void 0===l||d?i:Object.assign(i,{[r]:l})},{}):s}function MR(s,i,r){i&&!r.has(i.id)&&(r.set(i.id,i),Object.keys(i).forEach(a=>{a.endsWith("Id")?MR(s,s.get(i[a]),r):a.endsWith("Ids")&&i[a].forEach(l=>{MR(s,s.get(l),r)})}))}function wn(s,i,r){const a=r?"outbound-rtp":"inbound-rtp",l=new Map;if(null===i)return l;const d=[];return s.forEach(h=>{"track"===h.type&&h.trackIdentifier===i.id&&d.push(h)}),d.forEach(h=>{s.forEach(f=>{f.type===a&&f.trackId===h.id&&MR(s,f,l)})}),l}const Jy=fs;function kR(s,i){const r=s&&s.navigator;if(!r.mediaDevices)return;const a=function(h){if("object"!=typeof h||h.mandatory||h.optional)return h;const f={};return Object.keys(h).forEach(m=>{if("require"===m||"advanced"===m||"mediaSource"===m)return;const g="object"==typeof h[m]?h[m]:{ideal:h[m]};void 0!==g.exact&&"number"==typeof g.exact&&(g.min=g.max=g.exact);const E=function(y,C){return y?y+C.charAt(0).toUpperCase()+C.slice(1):"deviceId"===C?"sourceId":C};if(void 0!==g.ideal){f.optional=f.optional||[];let y={};"number"==typeof g.ideal?(y[E("min",m)]=g.ideal,f.optional.push(y),y={},y[E("max",m)]=g.ideal,f.optional.push(y)):(y[E("",m)]=g.ideal,f.optional.push(y))}void 0!==g.exact&&"number"!=typeof g.exact?(f.mandatory=f.mandatory||{},f.mandatory[E("",m)]=g.exact):["min","max"].forEach(y=>{void 0!==g[y]&&(f.mandatory=f.mandatory||{},f.mandatory[E(y,m)]=g[y])})}),h.advanced&&(f.optional=(f.optional||[]).concat(h.advanced)),f},l=function(h,f){if(i.version>=61)return f(h);if((h=JSON.parse(JSON.stringify(h)))&&"object"==typeof h.audio){const m=function(g,E,y){E in g&&!(y in g)&&(g[y]=g[E],delete g[E])};m((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),m(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=a(h.audio)}if(h&&"object"==typeof h.video){let m=h.video.facingMode;m=m&&("object"==typeof m?m:{ideal:m});const g=i.version<66;if(m&&("user"===m.exact||"environment"===m.exact||"user"===m.ideal||"environment"===m.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||g)){let E;if(delete h.video.facingMode,"environment"===m.exact||"environment"===m.ideal?E=["back","rear"]:"user"!==m.exact&&"user"!==m.ideal||(E=["front"]),E)return r.mediaDevices.enumerateDevices().then(y=>{let C=(y=y.filter(b=>"videoinput"===b.kind)).find(b=>E.some(O=>b.label.toLowerCase().includes(O)));return!C&&y.length&&E.includes("back")&&(C=y[y.length-1]),C&&(h.video.deviceId=m.exact?{exact:C.deviceId}:{ideal:C.deviceId}),h.video=a(h.video),Jy("chrome: "+JSON.stringify(h)),f(h)})}h.video=a(h.video)}return Jy("chrome: "+JSON.stringify(h)),f(h)},d=function(h){return i.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=function(h,f,m){l(h,g=>{r.webkitGetUserMedia(g,f,E=>{m&&m(d(E))})})}.bind(r),r.mediaDevices.getUserMedia){const h=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(f){return l(f,m=>h(m).then(g=>{if(m.audio&&!g.getAudioTracks().length||m.video&&!g.getVideoTracks().length)throw g.getTracks().forEach(E=>{E.stop()}),new DOMException("","NotFoundError");return g},g=>Promise.reject(d(g))))}}}function LR(s){s.MediaStream=s.MediaStream||s.webkitMediaStream}function Vu(s){if("object"==typeof s&&s.RTCPeerConnection&&!("ontrack"in s.RTCPeerConnection.prototype)){Object.defineProperty(s.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const i=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",a=>{let l;l=s.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.track.id):{track:a.track};const d=new Event("track");d.track=a.track,d.receiver=l,d.transceiver={receiver:l},d.streams=[r.stream],this.dispatchEvent(d)}),r.stream.getTracks().forEach(a=>{let l;l=s.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.id):{track:a};const d=new Event("track");d.track=a,d.receiver=l,d.transceiver={receiver:l},d.streams=[r.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),i.apply(this,arguments)}}else Ir(s,"track",i=>(i.transceiver||Object.defineProperty(i,"transceiver",{value:{receiver:i.receiver}}),i))}function qp(s){if("object"==typeof s&&s.RTCPeerConnection&&!("getSenders"in s.RTCPeerConnection.prototype)&&"createDTMFSender"in s.RTCPeerConnection.prototype){const i=function(l,d){return{track:d,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===d.kind?l.createDTMFSender(d):null),this._dtmf},_pc:l}};if(!s.RTCPeerConnection.prototype.getSenders){s.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const l=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(h,f){let m=l.apply(this,arguments);return m||(m=i(this,h),this._senders.push(m)),m};const d=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);const f=this._senders.indexOf(h);-1!==f&&this._senders.splice(f,1)}}const r=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(l){this._senders=this._senders||[],r.apply(this,[l]),l.getTracks().forEach(d=>{this._senders.push(i(this,d))})};const a=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(l){this._senders=this._senders||[],a.apply(this,[l]),l.getTracks().forEach(d=>{const h=this._senders.find(f=>f.track===d);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if("object"==typeof s&&s.RTCPeerConnection&&"getSenders"in s.RTCPeerConnection.prototype&&"createDTMFSender"in s.RTCPeerConnection.prototype&&s.RTCRtpSender&&!("dtmf"in s.RTCRtpSender.prototype)){const i=s.RTCPeerConnection.prototype.getSenders;s.RTCPeerConnection.prototype.getSenders=function(){const r=i.apply(this,[]);return r.forEach(a=>a._pc=this),r},Object.defineProperty(s.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}}function ZP(s){if(!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[r,a,l]=arguments;if(arguments.length>0&&"function"==typeof r)return i.apply(this,arguments);if(0===i.length&&(0===arguments.length||"function"!=typeof r))return i.apply(this,[]);const d=function(f){const m={};return f.result().forEach(g=>{const E={id:g.id,timestamp:g.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[g.type]||g.type};g.names().forEach(y=>{E[y]=g.stat(y)}),m[E.id]=E}),m},h=function(f){return new Map(Object.keys(f).map(m=>[m,f[m]]))};return arguments.length>=2?i.apply(this,[function(m){a(h(d(m)))},r]):new Promise((f,m)=>{i.apply(this,[function(g){f(h(d(g)))},m])}).then(a,l)}}function Xy(s){if(!("object"==typeof s&&s.RTCPeerConnection&&s.RTCRtpSender&&s.RTCRtpReceiver))return;if(!("getStats"in s.RTCRtpSender.prototype)){const r=s.RTCPeerConnection.prototype.getSenders;r&&(s.RTCPeerConnection.prototype.getSenders=function(){const l=r.apply(this,[]);return l.forEach(d=>d._pc=this),l});const a=s.RTCPeerConnection.prototype.addTrack;a&&(s.RTCPeerConnection.prototype.addTrack=function(){const l=a.apply(this,arguments);return l._pc=this,l}),s.RTCRtpSender.prototype.getStats=function(){const l=this;return this._pc.getStats().then(d=>wn(d,l.track,!0))}}if(!("getStats"in s.RTCRtpReceiver.prototype)){const r=s.RTCPeerConnection.prototype.getReceivers;r&&(s.RTCPeerConnection.prototype.getReceivers=function(){const a=r.apply(this,[]);return a.forEach(l=>l._pc=this),a}),Ir(s,"track",a=>(a.receiver._pc=a.srcElement,a)),s.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(l=>wn(l,a.track,!1))}}if(!("getStats"in s.RTCRtpSender.prototype)||!("getStats"in s.RTCRtpReceiver.prototype))return;const i=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof s.MediaStreamTrack){const r=arguments[0];let a,l,d;return this.getSenders().forEach(h=>{h.track===r&&(a?d=!0:a=h)}),this.getReceivers().forEach(h=>(h.track===r&&(l?d=!0:l=h),h.track===r)),d||a&&l?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():l?l.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}function tn(s){s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};const i=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return i.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const f=i.apply(this,arguments);return this._shimmedLocalStreams[h.id]?-1===this._shimmedLocalStreams[h.id].indexOf(f)&&this._shimmedLocalStreams[h.id].push(f):this._shimmedLocalStreams[h.id]=[h,f],f};const r=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(m=>{if(this.getSenders().find(g=>g.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();r.apply(this,arguments);const f=this.getSenders().filter(m=>-1===h.indexOf(m));this._shimmedLocalStreams[d.id]=[d].concat(f)};const a=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],a.apply(this,arguments)};const l=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const f=this._shimmedLocalStreams[h].indexOf(d);-1!==f&&this._shimmedLocalStreams[h].splice(f,1),1===this._shimmedLocalStreams[h].length&&delete this._shimmedLocalStreams[h]}),l.apply(this,arguments)}}function Qy(s,i){if(!s.RTCPeerConnection)return;if(s.RTCPeerConnection.prototype.addTrack&&i.version>=65)return tn(s);const r=s.RTCPeerConnection.prototype.getLocalStreams;s.RTCPeerConnection.prototype.getLocalStreams=function(){const m=r.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(g=>this._reverseStreams[g.id])};const a=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(g=>{if(this.getSenders().find(E=>E.track===g))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const g=new s.MediaStream(m.getTracks());this._streams[m.id]=g,this._reverseStreams[g.id]=m,m=g}a.apply(this,[m])};const l=s.RTCPeerConnection.prototype.removeStream;function d(m,g){let E=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(y=>{const C=m._reverseStreams[y];E=E.replace(new RegExp(m._streams[C.id].id,"g"),C.id)}),new RTCSessionDescription({type:g.type,sdp:E})}s.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},s.RTCPeerConnection.prototype.addTrack=function(m,g){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const E=[].slice.call(arguments,1);if(1!==E.length||!E[0].getTracks().find(C=>C===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(C=>C.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const y=this._streams[g.id];if(y)y.addTrack(m),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const C=new s.MediaStream([m]);this._streams[g.id]=C,this._reverseStreams[C.id]=g,this.addStream(C)}return this.getSenders().find(C=>C.track===m)},["createOffer","createAnswer"].forEach(function(m){const g=s.RTCPeerConnection.prototype[m],E={[m](){const y=arguments;return arguments.length&&"function"==typeof arguments[0]?g.apply(this,[C=>{const b=d(this,C);y[0].apply(null,[b])},C=>{y[1]&&y[1].apply(null,C)},arguments[2]]):g.apply(this,arguments).then(C=>d(this,C))}};s.RTCPeerConnection.prototype[m]=E[m]});const h=s.RTCPeerConnection.prototype.setLocalDescription;s.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(m,g){let E=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(y=>{const C=m._reverseStreams[y],b=m._streams[C.id];E=E.replace(new RegExp(C.id,"g"),b.id)}),new RTCSessionDescription({type:g.type,sdp:E})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const f=Object.getOwnPropertyDescriptor(s.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(s.RTCPeerConnection.prototype,"localDescription",{get(){const m=f.get.apply(this);return""===m.type?m:d(this,m)}}),s.RTCPeerConnection.prototype.removeTrack=function(m){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(m._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let g;this._streams=this._streams||{},Object.keys(this._streams).forEach(E=>{this._streams[E].getTracks().find(y=>m.track===y)&&(g=this._streams[E])}),g&&(1===g.getTracks().length?this.removeStream(this._reverseStreams[g.id]):g.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function xR(s,i){!s.RTCPeerConnection&&s.webkitRTCPeerConnection&&(s.RTCPeerConnection=s.webkitRTCPeerConnection),s.RTCPeerConnection&&i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const a=s.RTCPeerConnection.prototype[r],l={[r](){return arguments[0]=new("addIceCandidate"===r?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};s.RTCPeerConnection.prototype[r]=l[r]})}function nl(s,i){Ir(s,"negotiationneeded",r=>{const a=r.target;if(!(i.version<72||a.getConfiguration&&"plan-b"===a.getConfiguration().sdpSemantics)||"stable"===a.signalingState)return r})}var Zy=Object.freeze({__proto__:null,fixNegotiationNeeded:nl,shimAddTrackRemoveTrack:Qy,shimAddTrackRemoveTrackWithNative:tn,shimGetDisplayMedia:function(s,i){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&("function"==typeof i?s.navigator.mediaDevices.getDisplayMedia=function(r){return i(r).then(a=>{const l=r.video&&r.video.width,d=r.video&&r.video.height;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:r.video&&r.video.frameRate||3}},l&&(r.video.mandatory.maxWidth=l),d&&(r.video.mandatory.maxHeight=d),s.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:qp,shimGetStats:ZP,shimGetUserMedia:kR,shimMediaStream:LR,shimOnTrack:Vu,shimPeerConnection:xR,shimSenderReceiverGetStats:Xy});function ev(s,i){const r=s&&s.navigator,a=s&&s.MediaStreamTrack;if(r.getUserMedia=function(l,d,h){en("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(l).then(d,h)},!(i.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const l=function(h,f,m){f in h&&!(m in h)&&(h[m]=h[f],delete h[f])},d=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(h){return"object"==typeof h&&"object"==typeof h.audio&&(h=JSON.parse(JSON.stringify(h)),l(h.audio,"autoGainControl","mozAutoGainControl"),l(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},a&&a.prototype.getSettings){const h=a.prototype.getSettings;a.prototype.getSettings=function(){const f=h.apply(this,arguments);return l(f,"mozAutoGainControl","autoGainControl"),l(f,"mozNoiseSuppression","noiseSuppression"),f}}if(a&&a.prototype.applyConstraints){const h=a.prototype.applyConstraints;a.prototype.applyConstraints=function(f){return"audio"===this.kind&&"object"==typeof f&&(f=JSON.parse(JSON.stringify(f)),l(f,"autoGainControl","mozAutoGainControl"),l(f,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[f])}}}}function xt(s){"object"==typeof s&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Rm(s,i){if("object"!=typeof s||!s.RTCPeerConnection&&!s.mozRTCPeerConnection)return;!s.RTCPeerConnection&&s.mozRTCPeerConnection&&(s.RTCPeerConnection=s.mozRTCPeerConnection),i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(l){const d=s.RTCPeerConnection.prototype[l],h={[l](){return arguments[0]=new("addIceCandidate"===l?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};s.RTCPeerConnection.prototype[l]=h[l]});const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[l,d,h]=arguments;return a.apply(this,[l||null]).then(f=>{if(i.version<53&&!d)try{f.forEach(m=>{m.type=r[m.type]||m.type})}catch(m){if("TypeError"!==m.name)throw m;f.forEach((g,E)=>{f.set(E,Object.assign({},g,{type:r[g.type]||g.type}))})}return f}).then(d,h)}}function ad(s){if("object"!=typeof s||!s.RTCPeerConnection||!s.RTCRtpSender||s.RTCRtpSender&&"getStats"in s.RTCRtpSender.prototype)return;const i=s.RTCPeerConnection.prototype.getSenders;i&&(s.RTCPeerConnection.prototype.getSenders=function(){const a=i.apply(this,[]);return a.forEach(l=>l._pc=this),a});const r=s.RTCPeerConnection.prototype.addTrack;r&&(s.RTCPeerConnection.prototype.addTrack=function(){const a=r.apply(this,arguments);return a._pc=this,a}),s.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Cn(s){if("object"!=typeof s||!s.RTCPeerConnection||!s.RTCRtpSender||s.RTCRtpSender&&"getStats"in s.RTCRtpReceiver.prototype)return;const i=s.RTCPeerConnection.prototype.getReceivers;i&&(s.RTCPeerConnection.prototype.getReceivers=function(){const r=i.apply(this,[]);return r.forEach(a=>a._pc=this),r}),Ir(s,"track",r=>(r.receiver._pc=r.srcElement,r)),s.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function FR(s){s.RTCPeerConnection&&!("removeStream"in s.RTCPeerConnection.prototype)&&(s.RTCPeerConnection.prototype.removeStream=function(i){en("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&i.getTracks().includes(r.track)&&this.removeTrack(r)})})}function UR(s){s.DataChannel&&!s.RTCDataChannel&&(s.RTCDataChannel=s.DataChannel)}function tv(s){if("object"!=typeof s||!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype.addTransceiver;i&&(s.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;void 0===r&&(r=[]),r=[...r];const a=r.length>0;a&&r.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const l=i.apply(this,arguments);if(a){const{sender:d}=l,h=d.getParameters();(!("encodings"in h)||1===h.encodings.length&&0===Object.keys(h.encodings[0]).length)&&(h.encodings=r,d.sendEncodings=r,this.setParametersPromises.push(d.setParameters(h).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return l})}function VR(s){if("object"!=typeof s||!s.RTCRtpSender)return;const i=s.RTCRtpSender.prototype.getParameters;i&&(s.RTCRtpSender.prototype.getParameters=function(){const r=i.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function BR(s){if("object"!=typeof s||!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}function zp(s){if("object"!=typeof s||!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype.createAnswer;s.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}var eM=Object.freeze({__proto__:null,shimAddTransceiver:tv,shimCreateAnswer:zp,shimCreateOffer:BR,shimGetDisplayMedia:function(s,i){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&(s.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,Promise.reject(a)}return!0===r.video?r.video={mediaSource:i}:r.video.mediaSource=i,s.navigator.mediaDevices.getUserMedia(r)})},shimGetParameters:VR,shimGetUserMedia:ev,shimOnTrack:xt,shimPeerConnection:Rm,shimRTCDataChannel:UR,shimReceiverGetStats:Cn,shimRemoveStream:FR,shimSenderGetStats:ad});function jR(s){if("object"==typeof s&&s.RTCPeerConnection){if("getLocalStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in s.RTCPeerConnection.prototype)){const i=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(a=>i.call(this,a,r)),r.getVideoTracks().forEach(a=>i.call(this,a,r))},s.RTCPeerConnection.prototype.addTrack=function(r,...a){return a&&a.forEach(l=>{this._localStreams?this._localStreams.includes(l)||this._localStreams.push(l):this._localStreams=[l]}),i.apply(this,arguments)}}"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(i){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(i);if(-1===r)return;this._localStreams.splice(r,1);const a=i.getTracks();this.getSenders().forEach(l=>{a.includes(l.track)&&this.removeTrack(l)})})}}function HR(s){if("object"==typeof s&&s.RTCPeerConnection&&("getRemoteStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in s.RTCPeerConnection.prototype))){Object.defineProperty(s.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(l=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(l))return;this._remoteStreams.push(l);const d=new Event("addstream");d.stream=l,this.dispatchEvent(d)})})}});const i=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(l=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(l)>=0)return;r._remoteStreams.push(l);const d=new Event("addstream");d.stream=l,r.dispatchEvent(d)})}),i.apply(r,arguments)}}}function nv(s){if("object"!=typeof s||!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype,r=i.createOffer,a=i.createAnswer,l=i.setLocalDescription,d=i.setRemoteDescription,h=i.addIceCandidate;i.createOffer=function(m,g){const y=r.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return g?(y.then(m,g),Promise.resolve()):y},i.createAnswer=function(m,g){const y=a.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return g?(y.then(m,g),Promise.resolve()):y};let f=function(m,g,E){const y=l.apply(this,[m]);return E?(y.then(g,E),Promise.resolve()):y};i.setLocalDescription=f,f=function(m,g,E){const y=d.apply(this,[m]);return E?(y.then(g,E),Promise.resolve()):y},i.setRemoteDescription=f,f=function(m,g,E){const y=h.apply(this,[m]);return E?(y.then(g,E),Promise.resolve()):y},i.addIceCandidate=f}function iv(s){const i=s&&s.navigator;if(i.mediaDevices&&i.mediaDevices.getUserMedia){const r=i.mediaDevices,a=r.getUserMedia.bind(r);i.mediaDevices.getUserMedia=l=>a(Im(l))}!i.getUserMedia&&i.mediaDevices&&i.mediaDevices.getUserMedia&&(i.getUserMedia=function(r,a,l){i.mediaDevices.getUserMedia(r).then(a,l)}.bind(i))}function Im(s){return s&&void 0!==s.video?Object.assign({},s,{video:Kp(s.video)}):s}function GR(s){if(!s.RTCPeerConnection)return;const i=s.RTCPeerConnection;s.RTCPeerConnection=function(r,a){if(r&&r.iceServers){const l=[];for(let d=0;d<r.iceServers.length;d++){let h=r.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(en("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,l.push(h)):l.push(r.iceServers[d])}r.iceServers=l}return new i(r,a)},s.RTCPeerConnection.prototype=i.prototype,"generateCertificate"in i&&Object.defineProperty(s.RTCPeerConnection,"generateCertificate",{get:()=>i.generateCertificate})}function WR(s){"object"==typeof s&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function wm(s){const i=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(r){if(r){void 0!==r.offerToReceiveAudio&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const a=this.getTransceivers().find(d=>"audio"===d.receiver.track.kind);!1===r.offerToReceiveAudio&&a?"sendrecv"===a.direction?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":"recvonly"===a.direction&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):!0!==r.offerToReceiveAudio||a||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==r.offerToReceiveVideo&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const l=this.getTransceivers().find(d=>"video"===d.receiver.track.kind);!1===r.offerToReceiveVideo&&l?"sendrecv"===l.direction?l.setDirection?l.setDirection("sendonly"):l.direction="sendonly":"recvonly"===l.direction&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive"):!0!==r.offerToReceiveVideo||l||this.addTransceiver("video",{direction:"recvonly"})}return i.apply(this,arguments)}}function KR(s){"object"!=typeof s||s.AudioContext||(s.AudioContext=s.webkitAudioContext)}var qR=Object.freeze({__proto__:null,shimAudioContext:KR,shimCallbacksAPI:nv,shimConstraints:Im,shimCreateOfferLegacy:wm,shimGetUserMedia:iv,shimLocalStreamsAPI:jR,shimRTCIceServerUrls:GR,shimRemoteStreamsAPI:HR,shimTrackEventTransceiver:WR}),Bu="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function wr(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var lr={exports:{}};!function(s){const i={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};i.localCName=i.generateIdentifier(),i.splitLines=function(r){return r.trim().split("\n").map(a=>a.trim())},i.splitSections=function(r){return r.split("\nm=").map((a,l)=>(l>0?"m="+a:a).trim()+"\r\n")},i.getDescription=function(r){const a=i.splitSections(r);return a&&a[0]},i.getMediaSections=function(r){const a=i.splitSections(r);return a.shift(),a},i.matchPrefix=function(r,a){return i.splitLines(r).filter(l=>0===l.indexOf(a))},i.parseCandidate=function(r){let a;a=0===r.indexOf("a=candidate:")?r.substring(12).split(" "):r.substring(10).split(" ");const l={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let d=8;d<a.length;d+=2)switch(a[d]){case"raddr":l.relatedAddress=a[d+1];break;case"rport":l.relatedPort=parseInt(a[d+1],10);break;case"tcptype":l.tcpType=a[d+1];break;case"ufrag":l.ufrag=a[d+1],l.usernameFragment=a[d+1];break;default:void 0===l[a[d]]&&(l[a[d]]=a[d+1])}return l},i.writeCandidate=function(r){const a=[];a.push(r.foundation);const l=r.component;a.push("rtp"===l?1:"rtcp"===l?2:l),a.push(r.protocol.toUpperCase()),a.push(r.priority),a.push(r.address||r.ip),a.push(r.port);const d=r.type;return a.push("typ"),a.push(d),"host"!==d&&r.relatedAddress&&r.relatedPort&&(a.push("raddr"),a.push(r.relatedAddress),a.push("rport"),a.push(r.relatedPort)),r.tcpType&&"tcp"===r.protocol.toLowerCase()&&(a.push("tcptype"),a.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(a.push("ufrag"),a.push(r.usernameFragment||r.ufrag)),"candidate:"+a.join(" ")},i.parseIceOptions=function(r){return r.substring(14).split(" ")},i.parseRtpMap=function(r){let a=r.substring(9).split(" ");const l={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),l.name=a[0],l.clockRate=parseInt(a[1],10),l.channels=3===a.length?parseInt(a[2],10):1,l.numChannels=l.channels,l},i.writeRtpMap=function(r){let a=r.payloadType;void 0!==r.preferredPayloadType&&(a=r.preferredPayloadType);const l=r.channels||r.numChannels||1;return"a=rtpmap:"+a+" "+r.name+"/"+r.clockRate+(1!==l?"/"+l:"")+"\r\n"},i.parseExtmap=function(r){const a=r.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},i.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&"sendrecv"!==r.direction?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+"\r\n"},i.parseFmtp=function(r){const a={};let l;const d=r.substring(r.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)l=d[h].trim().split("="),a[l[0].trim()]=l[1];return a},i.writeFmtp=function(r){let a="",l=r.payloadType;if(void 0!==r.preferredPayloadType&&(l=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){const d=[];Object.keys(r.parameters).forEach(h=>{d.push(void 0!==r.parameters[h]?h+"="+r.parameters[h]:h)}),a+="a=fmtp:"+l+" "+d.join(";")+"\r\n"}return a},i.parseRtcpFb=function(r){const a=r.substring(r.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},i.writeRtcpFb=function(r){let a="",l=r.payloadType;return void 0!==r.preferredPayloadType&&(l=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(d=>{a+="a=rtcp-fb:"+l+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+"\r\n"}),a},i.parseSsrcMedia=function(r){const a=r.indexOf(" "),l={ssrc:parseInt(r.substring(7,a),10)},d=r.indexOf(":",a);return d>-1?(l.attribute=r.substring(a+1,d),l.value=r.substring(d+1)):l.attribute=r.substring(a+1),l},i.parseSsrcGroup=function(r){const a=r.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(l=>parseInt(l,10))}},i.getMid=function(r){const a=i.matchPrefix(r,"a=mid:")[0];if(a)return a.substring(6)},i.parseFingerprint=function(r){const a=r.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},i.getDtlsParameters=function(r,a){return{role:"auto",fingerprints:i.matchPrefix(r+a,"a=fingerprint:").map(i.parseFingerprint)}},i.writeDtlsParameters=function(r,a){let l="a=setup:"+a+"\r\n";return r.fingerprints.forEach(d=>{l+="a=fingerprint:"+d.algorithm+" "+d.value+"\r\n"}),l},i.parseCryptoLine=function(r){const a=r.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},i.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+("object"==typeof r.keyParams?i.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+"\r\n"},i.parseCryptoKeyParams=function(r){if(0!==r.indexOf("inline:"))return null;const a=r.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},i.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},i.getCryptoParameters=function(r,a){return i.matchPrefix(r+a,"a=crypto:").map(i.parseCryptoLine)},i.getIceParameters=function(r,a){const l=i.matchPrefix(r+a,"a=ice-ufrag:")[0],d=i.matchPrefix(r+a,"a=ice-pwd:")[0];return l&&d?{usernameFragment:l.substring(12),password:d.substring(10)}:null},i.writeIceParameters=function(r){let a="a=ice-ufrag:"+r.usernameFragment+"\r\na=ice-pwd:"+r.password+"\r\n";return r.iceLite&&(a+="a=ice-lite\r\n"),a},i.parseRtpParameters=function(r){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},l=i.splitLines(r)[0].split(" ");a.profile=l[2];for(let h=3;h<l.length;h++){const f=l[h],m=i.matchPrefix(r,"a=rtpmap:"+f+" ")[0];if(m){const g=i.parseRtpMap(m),E=i.matchPrefix(r,"a=fmtp:"+f+" ");switch(g.parameters=E.length?i.parseFmtp(E[0]):{},g.rtcpFeedback=i.matchPrefix(r,"a=rtcp-fb:"+f+" ").map(i.parseRtcpFb),a.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(g.name.toUpperCase())}}}i.matchPrefix(r,"a=extmap:").forEach(h=>{a.headerExtensions.push(i.parseExtmap(h))});const d=i.matchPrefix(r,"a=rtcp-fb:* ").map(i.parseRtcpFb);return a.codecs.forEach(h=>{d.forEach(f=>{h.rtcpFeedback.find(m=>m.type===f.type&&m.parameter===f.parameter)||h.rtcpFeedback.push(f)})}),a},i.writeRtpDescription=function(r,a){let l="";l+="m="+r+" ",l+=a.codecs.length>0?"9":"0",l+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",l+=a.codecs.map(h=>void 0!==h.preferredPayloadType?h.preferredPayloadType:h.payloadType).join(" ")+"\r\n",l+="c=IN IP4 0.0.0.0\r\n",l+="a=rtcp:9 IN IP4 0.0.0.0\r\n",a.codecs.forEach(h=>{l+=i.writeRtpMap(h),l+=i.writeFmtp(h),l+=i.writeRtcpFb(h)});let d=0;return a.codecs.forEach(h=>{h.maxptime>d&&(d=h.maxptime)}),d>0&&(l+="a=maxptime:"+d+"\r\n"),a.headerExtensions&&a.headerExtensions.forEach(h=>{l+=i.writeExtmap(h)}),l},i.parseRtpEncodingParameters=function(r){const a=[],l=i.parseRtpParameters(r),d=-1!==l.fecMechanisms.indexOf("RED"),h=-1!==l.fecMechanisms.indexOf("ULPFEC"),f=i.matchPrefix(r,"a=ssrc:").map(C=>i.parseSsrcMedia(C)).filter(C=>"cname"===C.attribute),m=f.length>0&&f[0].ssrc;let g;const E=i.matchPrefix(r,"a=ssrc-group:FID").map(C=>C.substring(17).split(" ").map(b=>parseInt(b,10)));E.length>0&&E[0].length>1&&E[0][0]===m&&(g=E[0][1]),l.codecs.forEach(C=>{if("RTX"===C.name.toUpperCase()&&C.parameters.apt){let b={ssrc:m,codecPayloadType:parseInt(C.parameters.apt,10)};m&&g&&(b.rtx={ssrc:g}),a.push(b),d&&(b=JSON.parse(JSON.stringify(b)),b.fec={ssrc:m,mechanism:h?"red+ulpfec":"red"},a.push(b))}}),0===a.length&&m&&a.push({ssrc:m});let y=i.matchPrefix(r,"b=");return y.length&&(y=0===y[0].indexOf("b=TIAS:")?parseInt(y[0].substring(7),10):0===y[0].indexOf("b=AS:")?1e3*parseInt(y[0].substring(5),10)*.95-16e3:void 0,a.forEach(C=>{C.maxBitrate=y})),a},i.parseRtcpParameters=function(r){const a={},l=i.matchPrefix(r,"a=ssrc:").map(f=>i.parseSsrcMedia(f)).filter(f=>"cname"===f.attribute)[0];l&&(a.cname=l.value,a.ssrc=l.ssrc);const d=i.matchPrefix(r,"a=rtcp-rsize");a.reducedSize=d.length>0,a.compound=0===d.length;const h=i.matchPrefix(r,"a=rtcp-mux");return a.mux=h.length>0,a},i.writeRtcpParameters=function(r){let a="";return r.reducedSize&&(a+="a=rtcp-rsize\r\n"),r.mux&&(a+="a=rtcp-mux\r\n"),void 0!==r.ssrc&&r.cname&&(a+="a=ssrc:"+r.ssrc+" cname:"+r.cname+"\r\n"),a},i.parseMsid=function(r){let a;const l=i.matchPrefix(r,"a=msid:");if(1===l.length)return a=l[0].substring(7).split(" "),{stream:a[0],track:a[1]};const d=i.matchPrefix(r,"a=ssrc:").map(h=>i.parseSsrcMedia(h)).filter(h=>"msid"===h.attribute);return d.length>0?(a=d[0].value.split(" "),{stream:a[0],track:a[1]}):void 0},i.parseSctpDescription=function(r){const a=i.parseMLine(r),l=i.matchPrefix(r,"a=max-message-size:");let d;l.length>0&&(d=parseInt(l[0].substring(19),10)),isNaN(d)&&(d=65536);const h=i.matchPrefix(r,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:a.fmt,maxMessageSize:d};const f=i.matchPrefix(r,"a=sctpmap:");if(f.length>0){const m=f[0].substring(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:d}}},i.writeSctpDescription=function(r,a){let l=[];return l="DTLS/SCTP"!==r.protocol?["m="+r.kind+" 9 "+r.protocol+" "+a.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+a.port+"\r\n"]:["m="+r.kind+" 9 "+r.protocol+" "+a.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+a.port+" "+a.protocol+" 65535\r\n"],void 0!==a.maxMessageSize&&l.push("a=max-message-size:"+a.maxMessageSize+"\r\n"),l.join("")},i.generateSessionId=function(){return Math.random().toString().substr(2,22)},i.writeSessionBoilerplate=function(r,a,l){let d;const h=void 0!==a?a:2;return d=r||i.generateSessionId(),"v=0\r\no="+(l||"thisisadapterortc")+" "+d+" "+h+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},i.getDirection=function(r,a){const l=i.splitLines(r);for(let d=0;d<l.length;d++)switch(l[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return l[d].substring(2)}return a?i.getDirection(a):"sendrecv"},i.getKind=function(r){return i.splitLines(r)[0].split(" ")[0].substring(2)},i.isRejected=function(r){return"0"===r.split(" ",2)[1]},i.parseMLine=function(r){const a=i.splitLines(r)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},i.parseOLine=function(r){const a=i.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},i.isValidSDP=function(r){if("string"!=typeof r||0===r.length)return!1;const a=i.splitLines(r);for(let l=0;l<a.length;l++)if(a[l].length<2||"="!==a[l].charAt(1))return!1;return!0},s.exports=i}(lr);var ju=lr.exports,Yp=wr(ju),$p=function(s,i){return i.forEach(function(r){r&&"string"!=typeof r&&!Array.isArray(r)&&Object.keys(r).forEach(function(a){if("default"!==a&&!(a in s)){var l=Object.getOwnPropertyDescriptor(r,a);Object.defineProperty(s,a,l.get?l:{enumerable:!0,get:function(){return r[a]}})}})}),Object.freeze(s)}({__proto__:null,default:Yp},[ju]);function rv(s){if(!s.RTCIceCandidate||s.RTCIceCandidate&&"foundation"in s.RTCIceCandidate.prototype)return;const i=s.RTCIceCandidate;s.RTCIceCandidate=function(r){if("object"==typeof r&&r.candidate&&0===r.candidate.indexOf("a=")&&((r=JSON.parse(JSON.stringify(r))).candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){const a=new i(r),l=Yp.parseCandidate(r.candidate),d=Object.assign(a,l);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new i(r)},s.RTCIceCandidate.prototype=i.prototype,Ir(s,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new s.RTCIceCandidate(r.candidate),writable:"false"}),r))}function cd(s){!s.RTCIceCandidate||s.RTCIceCandidate&&"relayProtocol"in s.RTCIceCandidate.prototype||Ir(s,"icecandidate",i=>{if(i.candidate){const r=Yp.parseCandidate(i.candidate.candidate);"relay"===r.type&&(i.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return i})}function Gi(s,i){if(!s.RTCPeerConnection)return;"sctp"in s.RTCPeerConnection.prototype||Object.defineProperty(s.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const r=function(f){if(!f||!f.sdp)return!1;const m=Yp.splitSections(f.sdp);return m.shift(),m.some(g=>{const E=Yp.parseMLine(g);return E&&"application"===E.kind&&-1!==E.protocol.indexOf("SCTP")})},a=function(f){const m=f.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===m||m.length<2)return-1;const g=parseInt(m[1],10);return g!=g?-1:g},l=function(f){let m=65536;return"firefox"===i.browser&&(m=i.version<57?-1===f?16384:2147483637:i.version<60?57===i.version?65535:65536:2147483637),m},d=function(f,m){let g=65536;"firefox"===i.browser&&57===i.version&&(g=65535);const E=Yp.matchPrefix(f.sdp,"a=max-message-size:");return E.length>0?g=parseInt(E[0].substr(19),10):"firefox"===i.browser&&-1!==m&&(g=2147483637),g},h=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===i.browser&&i.version>=76){const{sdpSemantics:f}=this.getConfiguration();"plan-b"===f&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const f=a(arguments[0]),m=l(f),g=d(arguments[0],f);let E;E=0===m&&0===g?Number.POSITIVE_INFINITY:0===m||0===g?Math.max(m,g):Math.min(m,g);const y={};Object.defineProperty(y,"maxMessageSize",{get:()=>E}),this._sctp=y}return h.apply(this,arguments)}}function Am(s){if(!s.RTCPeerConnection||!("createDataChannel"in s.RTCPeerConnection.prototype))return;function i(a,l){const d=a.send;a.send=function(){const h=arguments[0];if("open"===a.readyState&&l.sctp&&(h.length||h.size||h.byteLength)>l.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+l.sctp.maxMessageSize+" bytes)");return d.apply(a,arguments)}}const r=s.RTCPeerConnection.prototype.createDataChannel;s.RTCPeerConnection.prototype.createDataChannel=function(){const a=r.apply(this,arguments);return i(a,this),a},Ir(s,"datachannel",a=>(i(a.channel,a.target),a))}function ov(s){if(!s.RTCPeerConnection||"connectionState"in s.RTCPeerConnection.prototype)return;const i=s.RTCPeerConnection.prototype;Object.defineProperty(i,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(i,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{const a=i[r];i[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=l=>{const d=l.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const h=new Event("connectionstatechange",l);d.dispatchEvent(h)}return l},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function zR(s,i){if(!s.RTCPeerConnection||"chrome"===i.browser&&i.version>=71||"safari"===i.browser&&i.version>=605)return;const r=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&-1!==a.sdp.indexOf("\na=extmap-allow-mixed")){const l=a.sdp.split("\n").filter(d=>"a=extmap-allow-mixed"!==d.trim()).join("\n");s.RTCSessionDescription&&a instanceof s.RTCSessionDescription?arguments[0]=new s.RTCSessionDescription({type:a.type,sdp:l}):a.sdp=l}return r.apply(this,arguments)}}function il(s,i){if(!s.RTCPeerConnection||!s.RTCPeerConnection.prototype)return;const r=s.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(s.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===i.browser&&i.version<78||"firefox"===i.browser&&i.version<68||"safari"===i.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Hu(s,i){if(!s.RTCPeerConnection||!s.RTCPeerConnection.prototype)return;const r=s.RTCPeerConnection.prototype.setLocalDescription;r&&0!==r.length&&(s.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if("object"!=typeof a||a.type&&a.sdp)return r.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||"offer"!==a.type&&"answer"!==a.type?r.apply(this,[a]):("offer"===a.type?this.createOffer:this.createAnswer).apply(this).then(l=>r.apply(this,[l]))})}var sv=Object.freeze({__proto__:null,removeExtmapAllowMixed:zR,shimAddIceCandidateNullOrEmpty:il,shimConnectionState:ov,shimMaxMessageSize:Gi,shimParameterlessSetLocalDescription:Hu,shimRTCIceCandidate:rv,shimRTCIceCandidateRelayProtocol:cd,shimSendThrowTypeError:Am});!function({window:s}={},i={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const r=fs,a=function(d){const h={browser:null,version:null};if(void 0===d||!d.navigator)return h.browser="Not a browser.",h;const{navigator:f}=d;if(f.mozGetUserMedia)h.browser="firefox",h.version=ps(f.userAgent,/Firefox\/(\d+)\./,1);else if(f.webkitGetUserMedia||!1===d.isSecureContext&&d.webkitRTCPeerConnection)h.browser="chrome",h.version=ps(f.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!f.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=ps(f.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return h}(s),l={browserDetails:a,commonShim:sv,extractVersion:ps,disableLog:rc,disableWarnings:Uu,sdp:$p};switch(a.browser){case"chrome":if(!Zy||!xR||!i.shimChrome)return r("Chrome shim is not included in this adapter release."),l;if(null===a.version)return r("Chrome shim can not determine version, not shimming."),l;r("adapter.js shimming chrome."),l.browserShim=Zy,il(s,a),Hu(s),kR(s,a),LR(s),xR(s,a),Vu(s),Qy(s,a),qp(s),ZP(s),Xy(s),nl(s,a),rv(s),cd(s),ov(s),Gi(s,a),Am(s),zR(s,a);break;case"firefox":if(!eM||!Rm||!i.shimFirefox)return r("Firefox shim is not included in this adapter release."),l;r("adapter.js shimming firefox."),l.browserShim=eM,il(s,a),Hu(s),ev(s,a),Rm(s,a),xt(s),FR(s),ad(s),Cn(s),UR(s),tv(s),VR(s),BR(s),zp(s),rv(s),ov(s),Gi(s,a),Am(s);break;case"safari":if(!qR||!i.shimSafari)return r("Safari shim is not included in this adapter release."),l;r("adapter.js shimming safari."),l.browserShim=qR,il(s,a),Hu(s),GR(s),wm(s),nv(s),jR(s),HR(s),WR(s),iv(s),KR(s),rv(s),cd(s),Gi(s,a),Am(s),zR(s,a);break;default:r("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var gi=function(s){try{return!!s()}catch(i){return!0}},Dm=!gi(function(){var s=function(){}.bind();return"function"!=typeof s||s.hasOwnProperty("prototype")}),YR=Dm,av=Function.prototype,cv=av.call,tM=YR&&av.bind.bind(cv,cv),Mi=YR?tM:function(s){return function(){return cv.apply(s,arguments)}},js=Mi({}.isPrototypeOf),Om=function(s){return s&&s.Math==Math&&s},dr=Om("object"==typeof globalThis&&globalThis)||Om("object"==typeof window&&window)||Om("object"==typeof self&&self)||Om("object"==typeof Bu&&Bu)||function(){return this}()||Bu||Function("return this")(),$R=Function.prototype,Sn=$R.apply,Nm=$R.call,Ft="object"==typeof Reflect&&Reflect.apply||(Dm?Nm.bind(Sn):function(){return Nm.apply(Sn,arguments)}),Pm=Mi,iM=Pm({}.toString),Ln=Pm("".slice),Ge=function(s){return Ln(iM(s),8,-1)},JR=Ge,IU=Mi,Ia=function(s){if("Function"===JR(s))return IU(s)},XR="object"==typeof document&&document.all,Gu={all:XR,IS_HTMLDDA:void 0===XR&&void 0!==XR},At=Gu.all,un=Gu.IS_HTMLDDA?function(s){return"function"==typeof s||s===At}:function(s){return"function"==typeof s},Jp={},oc=!gi(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),ld=Function.prototype.call,Vn=Dm?ld.bind(ld):function(){return ld.apply(ld,arguments)},QR={},ZR={}.propertyIsEnumerable,rM=Object.getOwnPropertyDescriptor,sc=rM&&!ZR.call({1:2},1);QR.f=sc?function(s){var i=rM(this,s);return!!i&&i.enumerable}:ZR;var dd,lv,Wu=function(s,i){return{enumerable:!(1&s),configurable:!(2&s),writable:!(4&s),value:i}},AU=gi,oM=Ge,e0=Object,sM=Mi("".split),t0=AU(function(){return!e0("z").propertyIsEnumerable(0)})?function(s){return"String"==oM(s)?sM(s,""):e0(s)}:e0,kr=function(s){return null==s},Yn=kr,DU=TypeError,Mm=function(s){if(Yn(s))throw DU("Can't call method on "+s);return s},OU=t0,Pe=Mm,Ku=function(s){return OU(Pe(s))},qt=un,ac=Gu.all,Po=Gu.IS_HTMLDDA?function(s){return"object"==typeof s?null!==s:qt(s)||s===ac}:function(s){return"object"==typeof s?null!==s:qt(s)},ud={},dv=ud,km=dr,Lm=un,xm=function(s){return Lm(s)?s:void 0},eo=function(s,i){return arguments.length<2?xm(dv[s])||xm(km[s]):dv[s]&&dv[s][i]||km[s]&&km[s][i]},hd="undefined"!=typeof navigator&&String(navigator.userAgent)||"",Xp=hd,n0=dr.process,cc=dr.Deno,uv=n0&&n0.versions||cc&&cc.version,aM=uv&&uv.v8;aM&&(lv=(dd=aM.split("."))[0]>0&&dd[0]<4?1:+(dd[0]+dd[1])),!lv&&Xp&&(!(dd=Xp.match(/Edge\/(\d+)/))||dd[1]>=74)&&(dd=Xp.match(/Chrome\/(\d+)/))&&(lv=+dd[1]);var mo=lv,Mo=mo,PU=dr.String,ui=!!Object.getOwnPropertySymbols&&!gi(function(){var s=Symbol();return!PU(s)||!(Object(s)instanceof Symbol)||!Symbol.sham&&Mo&&Mo<41}),r0=ui&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,cM=eo,lM=un,MU=js,Nn=Object,Fm=r0?function(s){return"symbol"==typeof s}:function(s){var i=cM("Symbol");return lM(i)&&MU(i.prototype,Nn(s))},kU=String,Hs=function(s){try{return kU(s)}catch(i){return"Object"}},Bn=un,Um=Hs,hv=TypeError,go=function(s){if(Bn(s))return s;throw hv(Um(s)+" is not a function")},o0=go,dM=kr,Gs=function(s,i){var r=s[i];return dM(r)?void 0:o0(r)},pd=Vn,pv=un,ki=Po,uM=TypeError,fv={exports:{}},_v=dr,s0=Object.defineProperty,a0="__core-js_shared__",Vm=dr[a0]||function(s,i){try{s0(_v,s,{value:i,configurable:!0,writable:!0})}catch(r){_v[s]=i}return i}(a0,{}),Ae=Vm;(fv.exports=function(s,i){return Ae[s]||(Ae[s]=void 0!==i?i:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Zi=fv.exports,Lr=Mm,rl=Object,ko=function(s){return rl(Lr(s))},_s=ko,hM=Mi({}.hasOwnProperty),$n=Object.hasOwn||function(s,i){return hM(_s(s),i)},Me=Mi,zt=0,Ei=Math.random(),Lo=Me(1..toString),lc=function(s){return"Symbol("+(void 0===s?"":s)+")_"+Lo(++zt+Ei,36)},ol=$n,Li=lc,Qp=ui,qu=r0,ht=dr.Symbol,zu=Zi("wks"),Yu=qu?ht.for||ht:ht&&ht.withoutSetter||Li,ri=function(s){return ol(zu,s)||(zu[s]=Qp&&ol(ht,s)?ht[s]:Yu("Symbol."+s)),zu[s]},$u=Vn,xr=Po,Ju=Fm,Xu=Gs,oi=TypeError,pM=ri("toPrimitive"),fM=function(s,i){if(!xr(s)||Ju(s))return s;var r,a=Xu(s,pM);if(a){if(void 0===i&&(i="default"),r=$u(a,s,i),!xr(r)||Ju(r))return r;throw oi("Can't convert object to primitive value")}return void 0===i&&(i="number"),function(s,i){var r,a;if("string"===i&&pv(r=s.toString)&&!ki(a=pd(r,s))||pv(r=s.valueOf)&&!ki(a=pd(r,s))||"string"!==i&&pv(r=s.toString)&&!ki(a=pd(r,s)))return a;throw uM("Can't convert object to primitive value")}(s,i)},Bm=Fm,Qu=function(s){var i=fM(s,"string");return Bm(i)?i:i+""},Zu=Po,eh=dr.document,fd=Zu(eh)&&Zu(eh.createElement),hr=function(s){return fd?eh.createElement(s):{}},_M=hr,Ks=!oc&&!gi(function(){return 7!=Object.defineProperty(_M("div"),"a",{get:function(){return 7}}).a}),mv=Vn,jm=QR,Hm=Wu,zs=Ku,mM=Qu,LU=$n,gM=Ks,c0=Object.getOwnPropertyDescriptor;Jp.f=oc?c0:function(s,i){if(s=zs(s),i=mM(i),gM)try{return c0(s,i)}catch(r){}if(LU(s,i))return Hm(!mv(jm.f,s,i),s[i])};var xU=gi,FU=un,UU=/#|\.prototype\./,Gm=function(s,i){var r=BU[VU(s)];return r==HU||r!=jU&&(FU(i)?xU(i):!!i)},VU=Gm.normalize=function(s){return String(s).replace(UU,".").toLowerCase()},BU=Gm.data={},jU=Gm.NATIVE="N",HU=Gm.POLYFILL="P",EM=Gm,GU=go,WU=Dm,KU=Ia(Ia.bind),Wm=function(s,i){return GU(s),void 0===i?s:WU?KU(s,i):function(){return s.apply(i,arguments)}},Ys={},gv=oc&&gi(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),Ev=Po,qU=String,zU=TypeError,wa=function(s){if(Ev(s))return s;throw zU(qU(s)+" is not an object")},l0=Ks,Zp=wa,d0=Qu,yM=TypeError,Km=Object.defineProperty,u0=Object.getOwnPropertyDescriptor,yv="enumerable",ef="configurable",vv="writable";Ys.f=oc?gv?function(s,i,r){if(Zp(s),i=d0(i),Zp(r),"function"==typeof s&&"prototype"===i&&"value"in r&&vv in r&&!r[vv]){var a=u0(s,i);a&&a[vv]&&(s[i]=r.value,r={configurable:ef in r?r[ef]:a[ef],enumerable:yv in r?r[yv]:a[yv],writable:!1})}return Km(s,i,r)}:Km:function(s,i,r){if(Zp(s),i=d0(i),Zp(r),l0)try{return Km(s,i,r)}catch(a){}if("get"in r||"set"in r)throw yM("Accessors not supported");return"value"in r&&(s[i]=r.value),s};var ms=Ys,h0=Wu,dc=oc?function(s,i,r){return ms.f(s,i,h0(1,r))}:function(s,i,r){return s[i]=r,s},th=dr,vM=Ft,Cv=Ia,YU=un,xi=Jp.f,$U=EM,md=ud,CM=Wm,hi=dc,p0=$n,JU=function(s){var i=function(r,a,l){if(this instanceof i){switch(arguments.length){case 0:return new s;case 1:return new s(r);case 2:return new s(r,a)}return new s(r,a,l)}return vM(s,this,arguments)};return i.prototype=s.prototype,i},Tn=function(s,i){var r,a,l,d,h,f,m,g,E,y=s.target,C=s.global,b=s.stat,O=s.proto,P=C?th:b?th[y]:(th[y]||{}).prototype,D=C?md:md[y]||hi(md,y,{})[y],L=D.prototype;for(d in i)a=!(r=$U(C?d:y+(b?".":"#")+d,s.forced))&&P&&p0(P,d),f=D[d],a&&(m=s.dontCallGetSet?(E=xi(P,d))&&E.value:P[d]),h=a&&m?m:i[d],a&&typeof f==typeof h||(g=s.bind&&a?CM(h,th):s.wrap&&a?JU(h):O&&YU(h)?Cv(h):h,(s.sham||h&&h.sham||f&&f.sham)&&hi(g,"sham",!0),hi(D,d,g),O&&(p0(md,l=y+"Prototype")||hi(md,l,{}),hi(md[l],d,h),s.real&&L&&(r||!L[d])&&hi(L,d,h)))},xo=Math.ceil,SM=Math.floor,Sv=Math.trunc||function(s){var i=+s;return(i>0?SM:xo)(i)},sl=function(s){var i=+s;return i!=i||0===i?0:Sv(i)},Fo=sl,f0=Math.max,Tv=Math.min,_0=function(s,i){var r=Fo(s);return r<0?f0(r+i,0):Tv(r,i)},al=sl,m0=Math.min,tt=function(s){return function(s){return s>0?m0(al(s),9007199254740991):0}(s.length)},XU=Ku,TM=_0,bM=tt,g0=function(s){return function(i,r,a){var l,d=XU(i),h=bM(d),f=TM(a,h);if(s&&r!=r){for(;h>f;)if((l=d[f++])!=l)return!0}else for(;h>f;f++)if((s||f in d)&&d[f]===r)return s||f||0;return!s&&-1}},Rv={includes:g0(!0),indexOf:g0(!1)},RM=Rv.includes;Tn({target:"Array",proto:!0,forced:gi(function(){return!Array(1).includes()})},{includes:function(s){return RM(this,s,arguments.length>1?arguments[1]:void 0)}});var IM=ud,Ee=function(s){return IM[s+"Prototype"]},hn=Ee("Array").includes,$s=Po,er=Ge,E0=ri("match"),Aa=TypeError,qm={};qm[ri("toStringTag")]="z";var nf="[object z]"===String(qm),QU=nf,wM=un,gd=Ge,zm=ri("toStringTag"),to=Object,Da="Arguments"==gd(function(){return arguments}()),cl=QU?gd:function(s){var i,r,a;return void 0===s?"Undefined":null===s?"Null":"string"==typeof(r=function(l,d){try{return l[d]}catch(h){}}(i=to(s),zm))?r:Da?gd(i):"Object"==(a=gd(i))&&wM(i.callee)?"Arguments":a},nh=cl,uc=String,hc=function(s){if("Symbol"===nh(s))throw TypeError("Cannot convert a Symbol value to a string");return uc(s)},y0=ri("match"),AM=Tn,DM=function(s){if(function(s){var i;return $s(s)&&(void 0!==(i=s[E0])?!!i:"RegExp"==er(s))}(s))throw Aa("The method doesn't accept regular expressions");return s},Iv=Mm,Ym=hc,wv=Mi("".indexOf);AM({target:"String",proto:!0,forced:!function(s){var i=/./;try{"/./"[s](i)}catch(r){try{return i[y0]=!1,"/./"[s](i)}catch(a){}}return!1}("includes")},{includes:function(s){return!!~wv(Ym(Iv(this)),Ym(DM(s)),arguments.length>1?arguments[1]:void 0)}});var OM=Ee("String").includes,Av=js,$m=hn,C0=OM,Jm=Array.prototype,Xm=String.prototype,we=wr(function(s){var i=s.includes;return s===Jm||Av(Jm,s)&&i===Jm.includes?$m:"string"==typeof s||s===Xm||Av(Xm,s)&&i===Xm.includes?C0:i}),rf={exports:{}},Fr=Ys.f;Tn({target:"Object",stat:!0,forced:Object.defineProperty!==Fr,sham:!oc},{defineProperty:Fr});var pc=ud.Object,Di=rf.exports=function(s,i,r){return pc.defineProperty(s,i,r)};pc.defineProperty.sham&&(Di.sham=!0);var Js=wr(rf.exports),MM=Ge,Xs=Array.isArray||function(s){return"Array"==MM(s)},kM=TypeError,LM=Qu,xM=Ys,Qm=Wu,of=function(s,i,r){var a=LM(i);a in s?xM.f(s,a,Qm(0,r)):s[a]=r},Zm=un,sf=Vm,S0=Mi(Function.toString);Zm(sf.inspectSource)||(sf.inspectSource=function(s){return S0(s)});var T0=sf.inspectSource,ll=Mi,af=gi,b0=un,FM=cl,cf=T0,eg=function(){},UM=[],R0=eo("Reflect","construct"),I0=/^\s*(?:class|function)\b/,ZU=ll(I0.exec),tg=!I0.exec(eg),ih=function(s){if(!b0(s))return!1;try{return R0(eg,UM,s),!0}catch(i){return!1}},ng=function(s){if(!b0(s))return!1;switch(FM(s)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return tg||!!ZU(I0,cf(s))}catch(i){return!0}};ng.sham=!0;var lf=!R0||af(function(){var s;return ih(ih.call)||!ih(Object)||!ih(function(){s=!0})||s})?ng:ih,Dv=Xs,w0=lf,rh=Po,VM=ri("species"),Ed=Array,df=function(s,i){return new(function(s){var i;return Dv(s)&&(w0(i=s.constructor)&&(i===Ed||Dv(i.prototype))||rh(i)&&null===(i=i[VM]))&&(i=void 0),void 0===i?Ed:i}(s))(0===i?0:i)},eV=gi,A0=mo,D0=ri("species"),BM=Tn,jM=gi,uf=Xs,Nv=Po,Pv=ko,ig=tt,hf=function(s){if(s>9007199254740991)throw kM("Maximum allowed index exceeded");return s},O0=of,N0=df,M0=mo,Mv=ri("isConcatSpreadable"),HM=M0>=51||!jM(function(){var s=[];return s[Mv]=!1,s.concat()[0]!==s}),GM=function(s){if(!Nv(s))return!1;var i=s[Mv];return void 0!==i?!!i:uf(s)};BM({target:"Array",proto:!0,arity:1,forced:!HM||!function(s){return A0>=51||!eV(function(){var i=[];return(i.constructor={})[D0]=function(){return{foo:1}},1!==i[s](Boolean).foo})}("concat")},{concat:function(s){var i,r,a,l,d,h=Pv(this),f=N0(h,0),m=0;for(i=-1,a=arguments.length;i<a;i++)if(GM(d=-1===i?h:arguments[i]))for(l=ig(d),hf(m+l),r=0;r<l;r++,m++)r in d&&O0(f,m,d[r]);else hf(m+1),O0(f,m++,d);return f.length=m,f}});var oh={},dl={},kv=$n,k0=Ku,L0=Rv.indexOf,sh=dl,pr=Mi([].push),rg=function(s,i){var r,a=k0(s),l=0,d=[];for(r in a)!kv(sh,r)&&kv(a,r)&&pr(d,r);for(;i.length>l;)kv(a,r=i[l++])&&(~L0(d,r)||pr(d,r));return d},fc=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ah=rg,ch=fc,yd=Object.keys||function(s){return ah(s,ch)},vd=Ys,tV=wa,nV=Ku,WM=yd;oh.f=oc&&!gv?Object.defineProperties:function(s,i){tV(s);for(var r,a=nV(i),l=WM(i),d=l.length,h=0;d>h;)vd.f(s,r=l[h++],a[r]);return s};var xv,x0=eo("document","documentElement"),je=lc,F0=Zi("keys"),ff=function(s){return F0[s]||(F0[s]=je(s))},iV=wa,rV=oh,KM=fc,oV=dl,sV=x0,aV=hr,U0="prototype",V0="script",qM=ff("IE_PROTO"),Cd=function(){},zM=function(s){return"<script>"+s+"</"+V0+">"},Ki=function(s){s.write(zM("")),s.close();var i=s.parentWindow.Object;return s=null,i},Sd=function(){try{xv=new ActiveXObject("htmlfile")}catch(l){}var s,i;Sd="undefined"!=typeof document?document.domain&&xv?Ki(xv):("javascript:",(i=aV("iframe")).style.display="none",sV.appendChild(i),i.src=String("javascript:"),(s=i.contentWindow.document).open(),s.write(zM("document.F=Object")),s.close(),s.F):Ki(xv);for(var a=KM.length;a--;)delete Sd[U0][KM[a]];return Sd()};oV[qM]=!0;var Td=Object.create||function(s,i){var r;return null!==s?(Cd[U0]=iV(s),r=new Cd,Cd[U0]=null,r[qM]=s):r=Sd(),void 0===i?r:rV.f(r,i)},Fv={},YM=rg,gs=fc.concat("length","prototype");Fv.f=Object.getOwnPropertyNames||function(s){return YM(s,gs)};var Qs={},_f=_0,bd=tt,ul=of,B0=Array,$M=Math.max,j0=function(s,i,r){for(var a=bd(s),l=_f(i,a),d=_f(void 0===r?a:r,a),h=B0($M(d-l,0)),f=0;l<d;l++,f++)ul(h,f,s[l]);return h.length=f,h},cV=Ge,lV=Ku,Uv=Fv.f,Uo=j0,og="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Qs.f=function(s){return og&&"Window"==cV(s)?function(i){try{return Uv(i)}catch(r){return Uo(og)}}(s):Uv(lV(s))};var _c={};_c.f=Object.getOwnPropertySymbols;var dV=dc,lh=function(s,i,r,a){return a&&a.enumerable?s[i]=r:dV(s,i,r),s},JM=Ys,H0=function(s,i,r){return JM.f(s,i,r)},dh={};dh.f=ri;var sg,mc,uh,mf=ud,uV=$n,gf=dh,Vv=Ys.f,Jn=function(s){var i=mf.Symbol||(mf.Symbol={});uV(i,s)||Vv(i,s,{value:gf.f(s)})},QM=Vn,ZM=eo,e1=ri,Bv=lh,t1=function(){var s=ZM("Symbol"),i=s&&s.prototype,r=i&&i.valueOf,a=e1("toPrimitive");i&&!i[a]&&Bv(i,a,function(l){return QM(r,this)},{arity:1})},jv=cl,hh=nf,n1=Ys.f,ie=dc,G0=$n,W0=nf?{}.toString:function(){return"[object "+jv(this)+"]"},hl=ri("toStringTag"),Oa=function(s,i,r,a){if(s){var l=r?s:s.prototype;G0(l,hl)||n1(l,hl,{configurable:!0,value:i}),a&&!hh&&ie(l,"toString",W0)}},Hv=dr.WeakMap,K0=un(Hv)&&/native code/.test(String(Hv)),ph=Po,Eo=dc,fh=$n,o1=ff,q0=dl,ag="Object already initialized",_h=dr.TypeError;if(K0||Vm.state){var Pa=Vm.state||(Vm.state=new(0,dr.WeakMap));Pa.get=Pa.get,Pa.has=Pa.has,Pa.set=Pa.set,sg=function(s,i){if(Pa.has(s))throw _h(ag);return i.facade=s,Pa.set(s,i),i},mc=function(s){return Pa.get(s)||{}},uh=function(s){return Pa.has(s)}}else{var mh=o1("state");q0[mh]=!0,sg=function(s,i){if(fh(s,mh))throw _h(ag);return i.facade=s,Eo(s,mh,i),i},mc=function(s){return fh(s,mh)?s[mh]:{}},uh=function(s){return fh(s,mh)}}var gc={set:sg,get:mc,has:uh,enforce:function(s){return uh(s)?mc(s):sg(s,{})},getterFor:function(s){return function(i){var r;if(!ph(i)||(r=mc(i)).type!==s)throw _h("Incompatible receiver, "+s+" required");return r}}},yf=Wm,s1=t0,hV=ko,Y0=tt,a1=df,c1=Mi([].push),pl=function(s){var i=1==s,r=2==s,a=3==s,l=4==s,d=6==s,h=7==s,f=5==s||d;return function(m,g,E,y){for(var C,b,O=hV(m),P=s1(O),D=yf(g,E),L=Y0(P),B=0,V=y||a1,J=i?V(m,L):r||h?V(m,0):void 0;L>B;B++)if((f||B in P)&&(b=D(C=P[B],B,O),s))if(i)J[B]=b;else if(b)switch(s){case 3:return!0;case 5:return C;case 6:return B;case 2:c1(J,C)}else switch(s){case 4:return!1;case 7:c1(J,C)}return d?-1:a||l?l:J}},l1={forEach:pl(0),map:pl(1),filter:pl(2),some:pl(3),every:pl(4),find:pl(5),findIndex:pl(6),filterReject:pl(7)},cg=Tn,Gv=dr,$0=Vn,Vo=Mi,gh=oc,Eh=ui,d1=gi,Ui=$n,no=js,vf=wa,Cf=Ku,lg=Qu,Ur=hc,Rd=Wu,Id=Td,J0=yd,u1=Fv,Wv=Qs,h1=_c,Kv=Jp,X0=Ys,Q0=oh,Z0=QR,eI=lh,qv=H0,Sf=Zi,tI=dl,zv=lc,Tf=ri,nI=dh,iI=Jn,Yv=t1,$v=Oa,Jv=gc,Xv=l1.forEach,tr=ff("hidden"),yh="Symbol",vh="prototype",p1=Jv.set,dg=Jv.getterFor(yh),Zs=Object[vh],wd=Gv.Symbol,ug=wd&&wd[vh],f1=Gv.TypeError,Qv=Gv.QObject,rI=Kv.f,fl=X0.f,hg=Wv.f,oI=Z0.f,pg=Vo([].push),Ec=Sf("symbols"),bf=Sf("op-symbols"),sI=Sf("wks"),fg=!Qv||!Qv[vh]||!Qv[vh].findChild,yc=gh&&d1(function(){return 7!=Id(fl({},"a",{get:function(){return fl(this,"a",{value:7}).a}})).a})?function(s,i,r){var a=rI(Zs,i);a&&delete Zs[i],fl(s,i,r),a&&s!==Zs&&fl(Zs,i,a)}:fl,_g=function(s,i){var r=Ec[s]=Id(ug);return p1(r,{type:yh,tag:s,description:i}),gh||(r.description=i),r},Rf=function(s,i,r){s===Zs&&Rf(bf,i,r),vf(s);var a=lg(i);return vf(r),Ui(Ec,a)?(r.enumerable?(Ui(s,tr)&&s[tr][a]&&(s[tr][a]=!1),r=Id(r,{enumerable:Rd(0,!1)})):(Ui(s,tr)||fl(s,tr,Rd(1,{})),s[tr][a]=!0),yc(s,a,r)):fl(s,a,r)},Zv=function(s,i){vf(s);var r=Cf(i),a=J0(r).concat(tC(r));return Xv(a,function(l){gh&&!$0(If,r,l)||Rf(s,l,r[l])}),s},If=function(s){var i=lg(s),r=$0(oI,this,i);return!(this===Zs&&Ui(Ec,i)&&!Ui(bf,i))&&(!(r||!Ui(this,i)||!Ui(Ec,i)||Ui(this,tr)&&this[tr][i])||r)},aI=function(s,i){var r=Cf(s),a=lg(i);if(r!==Zs||!Ui(Ec,a)||Ui(bf,a)){var l=rI(r,a);return!l||!Ui(Ec,a)||Ui(r,tr)&&r[tr][a]||(l.enumerable=!0),l}},eC=function(s){var i=hg(Cf(s)),r=[];return Xv(i,function(a){Ui(Ec,a)||Ui(tI,a)||pg(r,a)}),r},tC=function(s){var i=s===Zs,r=hg(i?bf:Cf(s)),a=[];return Xv(r,function(l){!Ui(Ec,l)||i&&!Ui(Zs,l)||pg(a,Ec[l])}),a};Eh||(wd=function(){if(no(ug,this))throw f1("Symbol is not a constructor");var s=arguments.length&&void 0!==arguments[0]?Ur(arguments[0]):void 0,i=zv(s),r=function(a){this===Zs&&$0(r,bf,a),Ui(this,tr)&&Ui(this[tr],i)&&(this[tr][i]=!1),yc(this,i,Rd(1,a))};return gh&&fg&&yc(Zs,i,{configurable:!0,set:r}),_g(i,s)},eI(ug=wd[vh],"toString",function(){return dg(this).tag}),eI(wd,"withoutSetter",function(s){return _g(zv(s),s)}),Z0.f=If,X0.f=Rf,Q0.f=Zv,Kv.f=aI,u1.f=Wv.f=eC,h1.f=tC,nI.f=function(s){return _g(Tf(s),s)},gh&&qv(ug,"description",{configurable:!0,get:function(){return dg(this).description}})),cg({global:!0,constructor:!0,wrap:!0,forced:!Eh,sham:!Eh},{Symbol:wd}),Xv(J0(sI),function(s){iI(s)}),cg({target:yh,stat:!0,forced:!Eh},{useSetter:function(){fg=!0},useSimple:function(){fg=!1}}),cg({target:"Object",stat:!0,forced:!Eh,sham:!gh},{create:function(s,i){return void 0===i?Id(s):Zv(Id(s),i)},defineProperty:Rf,defineProperties:Zv,getOwnPropertyDescriptor:aI}),cg({target:"Object",stat:!0,forced:!Eh},{getOwnPropertyNames:eC}),Yv(),$v(wd,yh),tI[tr]=!0;var nC=ui&&!!Symbol.for&&!!Symbol.keyFor,iC=Tn,cI=eo,mg=$n,gg=hc,rC=Zi,oC=nC,wf=rC("string-to-symbol-registry"),sC=rC("symbol-to-string-registry");iC({target:"Symbol",stat:!0,forced:!oC},{for:function(s){var i=gg(s);if(mg(wf,i))return wf[i];var r=cI("Symbol")(i);return wf[i]=r,sC[r]=i,r}});var Af=Tn,_1=$n,lI=Fm,m1=Hs,g1=nC,aC=Zi("symbol-to-string-registry");Af({target:"Symbol",stat:!0,forced:!g1},{keyFor:function(s){if(!lI(s))throw TypeError(m1(s)+" is not a symbol");if(_1(aC,s))return aC[s]}});var Eg=Mi([].slice),Df=Xs,cC=un,_l=Ge,E1=hc,dI=Mi([].push),pV=Tn,uI=eo,Of=Ft,lC=Vn,Ch=Mi,dC=gi,uC=un,ml=Fm,hI=Eg,y1=function(s){if(cC(s))return s;if(Df(s)){for(var i=s.length,r=[],a=0;a<i;a++){var l=s[a];"string"==typeof l?dI(r,l):"number"!=typeof l&&"Number"!=_l(l)&&"String"!=_l(l)||dI(r,E1(l))}var d=r.length,h=!0;return function(f,m){if(h)return h=!1,m;if(Df(this))return m;for(var g=0;g<d;g++)if(r[g]===f)return m}}},v1=ui,C1=String,gl=uI("JSON","stringify"),Vr=Ch(/./.exec),ea=Ch("".charAt),pI=Ch("".charCodeAt),S1=Ch("".replace),T1=Ch(1..toString),b1=/[\uD800-\uDFFF]/g,fI=/^[\uD800-\uDBFF]$/,_I=/^[\uDC00-\uDFFF]$/,hC=!v1||dC(function(){var s=uI("Symbol")();return"[null]"!=gl([s])||"{}"!=gl({a:s})||"{}"!=gl(Object(s))}),mI=dC(function(){return'"\\udf06\\ud834"'!==gl("\udf06\ud834")||'"\\udead"'!==gl("\udead")}),R1=function(s,i){var r=hI(arguments),a=y1(i);if(uC(a)||void 0!==s&&!ml(s))return r[1]=function(l,d){if(uC(a)&&(d=lC(a,this,C1(l),d)),!ml(d))return d},Of(gl,null,r)},I1=function(s,i,r){var a=ea(r,i-1),l=ea(r,i+1);return Vr(fI,s)&&!Vr(_I,l)||Vr(_I,s)&&!Vr(fI,a)?"\\u"+T1(pI(s,0),16):s};gl&&pV({target:"JSON",stat:!0,arity:3,forced:hC||mI},{stringify:function(s,i,r){var a=hI(arguments),l=Of(hC?R1:gl,null,a);return mI&&"string"==typeof l?S1(l,b1,I1):l}});var gI=_c,fV=ko;Tn({target:"Object",stat:!0,forced:!ui||gi(function(){gI.f(1)})},{getOwnPropertySymbols:function(s){var i=gI.f;return i?i(fV(s)):[]}}),Jn("asyncIterator"),Jn("hasInstance"),Jn("isConcatSpreadable"),Jn("iterator"),Jn("match"),Jn("matchAll"),Jn("replace"),Jn("search"),Jn("species"),Jn("split");var w1=t1;Jn("toPrimitive"),w1();var Nf=eo,EI=Oa;Jn("toStringTag"),EI(Nf("Symbol"),"Symbol"),Jn("unscopables"),Oa(dr.JSON,"JSON",!0);var Br,Sh,pC,yI=ud.Symbol,Ad={},vI=oc,A1=Function.prototype,fC=vI&&Object.getOwnPropertyDescriptor,Pf=$n(A1,"name"),yg={EXISTS:Pf,PROPER:Pf&&"something"===function(){}.name,CONFIGURABLE:Pf&&(!vI||vI&&fC(A1,"name").configurable)},mV=!gi(function(){function s(){}return s.prototype.constructor=null,Object.getPrototypeOf(new s)!==s.prototype}),gV=$n,CI=un,D1=ko,O1=mV,SI=ff("IE_PROTO"),_C=Object,TI=_C.prototype,Th=O1?_C.getPrototypeOf:function(s){var i=D1(s);if(gV(i,SI))return i[SI];var r=i.constructor;return CI(r)&&i instanceof r?r.prototype:i instanceof _C?TI:null},bI=gi,mC=un,N1=Po,Xn=Td,RI=Th,P1=lh,bh=ri("iterator"),gC=!1;[].keys&&("next"in(pC=[].keys())?(Sh=RI(RI(pC)))!==Object.prototype&&(Br=Sh):gC=!0);var M1=!N1(Br)||bI(function(){var s={};return Br[bh].call(s)!==s});mC((Br=M1?{}:Xn(Br))[bh])||P1(Br,bh,function(){return this});var II={IteratorPrototype:Br,BUGGY_SAFARI_ITERATORS:gC},k1=II.IteratorPrototype,L1=Td,x1=Wu,EV=Oa,yV=Ad,Mf=function(){return this},F1=Mi,wI=go,EC=un,AI=String,U1=TypeError,DI=wa,V1=Object.setPrototypeOf||("__proto__"in{}?function(){var s,i=!1,r={};try{(s=function(s,i,r){try{return F1(wI(Object.getOwnPropertyDescriptor(s,i)[r]))}catch(a){}}(Object.prototype,"__proto__","set"))(r,[]),i=r instanceof Array}catch(a){}return function(a,l){return DI(a),function(s){if("object"==typeof s||EC(s))return s;throw U1("Can't set "+AI(s)+" as a prototype")}(l),i?s(a,l):a.__proto__=l,a}}():void 0),B1=Tn,Dd=Vn,Es=Th,OI=Oa,NI=lh,PI=Ad,CV=yg.PROPER,kf=II.BUGGY_SAFARI_ITERATORS,yC=ri("iterator"),Cg="values",Od="entries",Ma=function(){return this},G1=function(s,i,r,a,l,d,h){!function(s,i,r,a){var l=i+" Iterator";s.prototype=L1(k1,{next:x1(+!a,r)}),EV(s,l,!1,!0),yV[l]=Mf}(r,i,a);var f,m,g,E=function(L){if(L===l&&P)return P;if(!kf&&L in b)return b[L];switch(L){case"keys":case Cg:case Od:return function(){return new r(this,L)}}return function(){return new r(this)}},y=i+" Iterator",C=!1,b=s.prototype,O=b[yC]||b["@@iterator"]||l&&b[l],P=!kf&&O||E(l),D="Array"==i&&b.entries||O;if(D&&(f=Es(D.call(new s)))!==Object.prototype&&f.next&&(OI(f,y,!0,!0),PI[y]=Ma),CV&&l==Cg&&O&&O.name!==Cg&&(C=!0,P=function(){return Dd(O,this)}),l)if(m={values:E(Cg),keys:d?P:E("keys"),entries:E(Od)},h)for(g in m)(kf||C||!(g in b))&&NI(b,g,m[g]);else B1({target:i,proto:!0,forced:kf||C},m);return h&&b[yC]!==P&&NI(b,yC,P,{name:l}),PI[i]=P,m},W1=function(s,i){return{value:s,done:i}},LI=Ku,K1=Ad,SV=G1,CC=W1,xI="Array Iterator",FI=gc.set,q1=gc.getterFor(xI);SV(Array,"Array",function(s,i){FI(this,{type:xI,target:LI(s),index:0,kind:i})},function(){var s=q1(this),i=s.target,r=s.kind,a=s.index++;return!i||a>=i.length?(s.target=void 0,CC(void 0,!0)):CC("keys"==r?a:"values"==r?i[a]:[a,i[a]],!1)},"values"),K1.Arguments=K1.Array;var ta=dr,Y1=cl,UI=dc,VI=Ad,BI=ri("toStringTag");for(var SC in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var jI=ta[SC],Sg=jI&&jI.prototype;Sg&&Y1(Sg)!==BI&&UI(Sg,BI,SC),VI[SC]=VI.Array}var $1=yI,X1=Ys.f,yt=ri("metadata"),Ke=Function.prototype;void 0===Ke[yt]&&X1(Ke,yt,{value:null}),Jn("dispose"),Jn("metadata");var HI=$1;Jn("asyncDispose");var Tg=Mi,Bo=eo("Symbol"),GI=Bo.keyFor,Q1=Tg(Bo.prototype.valueOf),bg=Bo.isRegisteredSymbol||function(s){try{return void 0!==GI(Q1(s))}catch(i){return!1}};Tn({target:"Symbol",stat:!0},{isRegisteredSymbol:bg});for(var vc=Zi,Rg=eo,WI=Mi,TC=Fm,TV=ri,Lf=Rg("Symbol"),Z1=Lf.isWellKnownSymbol,ka=Rg("Object","getOwnPropertyNames"),Ig=WI(Lf.prototype.valueOf),xf=vc("wks"),Ff=0,ek=ka(Lf),tk=ek.length;Ff<tk;Ff++)try{var bC=ek[Ff];TC(Lf[bC])&&TV(bC)}catch(s){}var nk=function(s){if(Z1&&Z1(s))return!0;try{for(var i=Ig(s),r=0,a=ka(xf),l=a.length;r<l;r++)if(xf[a[r]]==i)return!0}catch(d){}return!1};Tn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:nk}),Jn("matcher"),Jn("observable"),Tn({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:bg}),Tn({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:nk}),Jn("metadataKey"),Jn("patternMatch"),Jn("replaceAll");var Rh=wr(HI),KI=Mi,qI=sl,zI=hc,ik=Mm,RC=KI("".charAt),rk=KI("".charCodeAt),bV=KI("".slice),ok=function(s){return function(i,r){var a,l,d=zI(ik(i)),h=qI(r),f=d.length;return h<0||h>=f?s?"":void 0:(a=rk(d,h))<55296||a>56319||h+1===f||(l=rk(d,h+1))<56320||l>57343?s?RC(d,h):a:s?bV(d,h,h+2):l-56320+(a-55296<<10)+65536}},RV=(ok(!1),ok(!0)),IV=hc,wV=G1,ak=W1,ck="String Iterator",AV=gc.set,DV=gc.getterFor(ck);wV(String,"String",function(s){AV(this,{type:ck,string:IV(s),index:0})},function(){var s,i=DV(this),r=i.string,a=i.index;return a>=r.length?ak(void 0,!0):(s=RV(r,a),i.index+=s.length,ak(s,!1))});var Cc=wr(dh.f("iterator"));function Nd(s){return(Nd="function"==typeof Rh&&"symbol"==typeof Cc?function(i){return typeof i}:function(i){return i&&"function"==typeof Rh&&i.constructor===Rh&&i!==Rh.prototype?"symbol":typeof i})(s)}var lk=wr(dh.f("toPrimitive"));function T(s,i,r){return(i=function(s){var i=function(r,a){if("object"!==Nd(r)||null===r)return r;var l=r[lk];if(void 0!==l){var d=l.call(r,a);if("object"!==Nd(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}(s,"string");return"symbol"===Nd(i)?i:String(i)}(i))in s?Js(s,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[i]=r,s}var $I=Ee("Array").keys,IC=cl,dk=$n,El=js,JI=$I,wC=Array.prototype,OV={DOMTokenList:!0,NodeList:!0},jr=wr(function(s){var i=s.keys;return s===wC||El(wC,s)&&i===wC.keys||dk(OV,IC(s))?JI:i}),XI=Hs,QI=TypeError,ZI=j0,uk=Math.floor,Pd=function(s,i){var r=s.length,a=uk(r/2);return r<8?Ih(s,i):AC(s,Pd(ZI(s,0,a),i),Pd(ZI(s,a),i),i)},Ih=function(s,i){for(var r,a,l=s.length,d=1;d<l;){for(a=d,r=s[d];a&&i(s[a-1],r)>0;)s[a]=s[--a];a!==d++&&(s[a]=r)}return s},AC=function(s,i,r,a){for(var l=i.length,d=r.length,h=0,f=0;h<l||f<d;)s[h+f]=h<l&&f<d?a(i[h],r[f])<=0?i[h++]:r[f++]:h<l?i[h++]:r[f++];return s},wh=Pd,Uf=gi,Md=function(s,i){var r=[][s];return!!r&&Uf(function(){r.call(null,i||function(){return 1},1)})},ew=hd.match(/firefox\/(\d+)/i),tw=!!ew&&+ew[1],nw=/MSIE|Trident/.test(hd),wg=hd.match(/AppleWebKit\/(\d+)\./),iw=Tn,Vf=Mi,hk=go,rw=ko,pk=tt,ow=function(s,i){if(!delete s[i])throw QI("Cannot delete property "+XI(i)+" of "+XI(s))},OC=hc,NC=gi,sw=wh,fk=Md,aw=tw,jo=nw,cw=mo,lw=!!wg&&+wg[1],kd=[],_k=Vf(kd.sort),dw=Vf(kd.push),NV=NC(function(){kd.sort(void 0)}),mk=NC(function(){kd.sort(null)}),PC=fk("sort"),MC=!NC(function(){if(cw)return cw<70;if(!(aw&&aw>3)){if(jo)return!0;if(lw)return lw<603;var s,i,r,a,l="";for(s=65;s<76;s++){switch(i=String.fromCharCode(s),s){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(a=0;a<47;a++)kd.push({k:i+a,v:r})}for(kd.sort(function(d,h){return h.v-d.v}),a=0;a<kd.length;a++)i=kd[a].k.charAt(0),l.charAt(l.length-1)!==i&&(l+=i);return"DGBEFHACIJK"!==l}});iw({target:"Array",proto:!0,forced:NV||!mk||!PC||!MC},{sort:function(s){void 0!==s&&hk(s);var i=rw(this);if(MC)return void 0===s?_k(i):_k(i,s);var r,a,l=[],d=pk(i);for(a=0;a<d;a++)a in i&&dw(l,i[a]);for(sw(l,function(h){return function(f,m){return void 0===m?-1:void 0===f?1:void 0!==h?+h(f,m)||0:OC(f)>OC(m)?1:-1}}(s)),r=pk(l),a=0;a<r;)i[a]=l[a++];for(;a<d;)ow(i,a++);return i}});var gk=Ee("Array").sort,Ek=js,yk=gk,Ag=Array.prototype,Bf=wr(function(s){var i=s.sort;return s===Ag||Ek(Ag,s)&&i===Ag.sort?yk:i}),uw=eo,vk=Fv,Ck=_c,hw=wa,pw=Mi([].concat),Sk=uw("Reflect","ownKeys")||function(s){var i=vk.f(hw(s)),r=Ck.f;return r?pw(i,r(s)):i},na=$n,kC=Sk,Tk=Jp,bk=Ys,PV=Po,fw=dc,_w=Error,Rk=Mi("".replace),Ik=String(_w("zxcasd").stack),Dg=/\n\s*at [^:]*:[^\n]*/,wk=Dg.test(Ik),Ak=Wu,Og=!gi(function(){var s=Error("a");return!("stack"in s)||(Object.defineProperty(s,"stack",Ak(1,7)),7!==s.stack)}),LC=dc,xC=Og,Ng=Error.captureStackTrace,mw=Ad,Ok=ri("iterator"),Nk=Array.prototype,FC=cl,Pk=Gs,Mk=kr,gw=Ad,Ew=ri("iterator"),UC=function(s){if(!Mk(s))return Pk(s,Ew)||Pk(s,"@@iterator")||gw[FC(s)]},yw=Vn,vw=go,Sc=wa,Pg=Hs,kk=UC,Lk=TypeError,MV=Vn,yl=wa,Cw=Gs,jf=Wm,Hf=Vn,xk=wa,VC=Hs,Fk=tt,BC=js,jC=UC,Tw=function(s,i,r){var a,l;yl(s);try{if(!(a=Cw(s,"return"))){if("throw"===i)throw r;return r}a=MV(a,s)}catch(d){l=!0,a=d}if("throw"===i)throw r;if(l)throw a;return yl(a),r},Vk=TypeError,Gf=function(s,i){this.stopped=s,this.result=i},Ld=Gf.prototype,Ah=function(s,i,r){var a,l,d,h,f,m,g,y=!(!r||!r.AS_ENTRIES),C=!(!r||!r.IS_RECORD),b=!(!r||!r.IS_ITERATOR),O=!(!r||!r.INTERRUPTED),P=jf(i,r&&r.that),D=function(B){return a&&Tw(a,"normal",B),new Gf(!0,B)},L=function(B){return y?(xk(B),O?P(B[0],B[1],D):P(B[0],B[1])):O?P(B,D):P(B)};if(C)a=s.iterator;else if(b)a=s;else{if(!(l=jC(s)))throw Vk(VC(s)+" is not iterable");if(function(s){return void 0!==s&&(mw.Array===s||Nk[Ok]===s)}(l)){for(d=0,h=Fk(s);h>d;d++)if((f=L(s[d]))&&BC(Ld,f))return f;return new Gf(!1)}a=function(s,i){var r=arguments.length<2?kk(s):i;if(vw(r))return Sc(yw(r,s));throw Lk(Pg(s)+" is not iterable")}(s,l)}for(m=C?s.next:a.next;!(g=Hf(m,a)).done;){try{f=L(g.value)}catch(B){Tw(a,"throw",B)}if("object"==typeof f&&f&&BC(Ld,f))return f}return new Gf(!1)},Bk=hc,jk=Tn,Dh=js,Hk=Th,Mg=V1,bw=Td,Rw=dc,HC=Wu,Iw=function(s,i){PV(i)&&"cause"in i&&fw(s,"cause",i.cause)},An=function(s,i,r,a){xC&&(Ng?Ng(s,i):LC(s,"stack",function(s,i){if(wk&&"string"==typeof s&&!_w.prepareStackTrace)for(;i--;)s=Rk(s,Dg,"");return s}(r,a)))},GC=Ah,kV=function(s,i){return void 0===s?arguments.length<2?"":i:Bk(s)},Tc=ri("toStringTag"),Oh=Error,WC=[].push,Wf=function(s,i){var r,a=Dh(KC,this);Mg?r=Mg(Oh(),a?Hk(this):KC):(r=a?this:bw(KC),Rw(r,Tc,"Error")),void 0!==i&&Rw(r,"message",kV(i)),An(r,Wf,r.stack,1),arguments.length>2&&Iw(r,arguments[2]);var l=[];return GC(s,WC,{that:l}),Rw(r,"errors",l),r};Mg?Mg(Wf,Oh):function(s,i,r){for(var a=kC(i),l=bk.f,d=Tk.f,h=0;h<a.length;h++){var f=a[h];na(s,f)||r&&na(r,f)||l(s,f,d(i,f))}}(Wf,Oh,{name:!0});var KC=Wf.prototype=bw(Oh.prototype,{constructor:HC(1,Wf),message:HC(1,""),name:HC(1,"AggregateError")});jk({global:!0,constructor:!0,arity:2},{AggregateError:Wf});var Kf,xd,qC,kg,Nh="undefined"!=typeof process&&"process"==Ge(process),Wk=eo,Kk=H0,qf=oc,Lg=ri("species"),ww=js,Aw=TypeError,Dw=lf,Ow=Hs,qk=TypeError,Nw=wa,Yk=kr,Pw=ri("species"),$k=function(s,i){var r,a=Nw(s).constructor;return void 0===a||Yk(r=Nw(a)[Pw])?i:function(s){if(Dw(s))return s;throw qk(Ow(s)+" is not a constructor")}(r)},Mw=TypeError,kw=/(?:ipad|iphone|ipod).*applewebkit/i.test(hd),Ho=dr,LV=Ft,xV=Wm,xg=un,Jk=$n,zC=gi,YC=x0,FV=Eg,ys=hr,UV=function(s,i){if(s<i)throw Mw("Not enough arguments");return s},VV=kw,BV=Nh,Fg=Ho.setImmediate,Ug=Ho.clearImmediate,Lw=Ho.process,$C=Ho.Dispatch,jV=Ho.Function,JC=Ho.MessageChannel,Dt=Ho.String,XC=0,Fd={},xw="onreadystatechange";zC(function(){Kf=Ho.location});var QC=function(s){if(Jk(Fd,s)){var i=Fd[s];delete Fd[s],i()}},ZC=function(s){return function(){QC(s)}},Fw=function(s){QC(s.data)},Uw=function(s){Ho.postMessage(Dt(s),Kf.protocol+"//"+Kf.host)};Fg&&Ug||(Fg=function(s){UV(arguments.length,1);var i=xg(s)?s:jV(s),r=FV(arguments,1);return Fd[++XC]=function(){LV(i,void 0,r)},xd(XC),XC},Ug=function(s){delete Fd[s]},BV?xd=function(s){Lw.nextTick(ZC(s))}:$C&&$C.now?xd=function(s){$C.now(ZC(s))}:JC&&!VV?(kg=(qC=new JC).port2,qC.port1.onmessage=Fw,xd=xV(kg.postMessage,kg)):Ho.addEventListener&&xg(Ho.postMessage)&&!Ho.importScripts&&Kf&&"file:"!==Kf.protocol&&!zC(Uw)?(xd=Uw,Ho.addEventListener("message",Fw,!1)):xd=xw in ys("script")?function(s){YC.appendChild(ys("script"))[xw]=function(){YC.removeChild(this),QC(s)}}:function(s){setTimeout(ZC(s),0)});var Vw={set:Fg,clear:Ug},zf=function(){this.head=null,this.tail=null};zf.prototype={add:function(s){var i={item:s,next:null},r=this.tail;r?r.next=i:this.head=i,this.tail=i},get:function(){var s=this.head;if(s)return null===(this.head=s.next)&&(this.tail=null),s.item}};var ia,Vg,Go,Ud,Bw,jw=zf,eS=/ipad|iphone|ipod/i.test(hd)&&"undefined"!=typeof Pebble,La=/web0s(?!.*chrome)/i.test(hd),ra=dr,Ar=Wm,Ph=Vw.set,vs=jw,yi=kw,Mh=eS,kh=La,vl=Nh,Bd=ra.MutationObserver||ra.WebKitMutationObserver,jd=ra.document,Hd=ra.process,bc=ra.Promise,Gd=(0,Jp.f)(ra,"queueMicrotask"),Cl=Gd&&Gd.value;if(!Cl){var Yf=new vs,$f=function(){var s,i;for(vl&&(s=Hd.domain)&&s.exit();i=Yf.get();)try{i()}catch(r){throw Yf.head&&ia(),r}s&&s.enter()};yi||vl||kh||!Bd||!jd?!Mh&&bc&&bc.resolve?((Ud=bc.resolve(void 0)).constructor=bc,Bw=Ar(Ud.then,Ud),ia=function(){Bw($f)}):vl?ia=function(){Hd.nextTick($f)}:(Ph=Ar(Ph,ra),ia=function(){Ph($f)}):(Vg=!0,Go=jd.createTextNode(""),new Bd($f).observe(Go,{characterData:!0}),ia=function(){Go.data=Vg=!Vg}),Cl=function(s){Yf.head||ia(),Yf.add(s)}}var Hw=Cl,Wd=function(s){try{return{error:!1,value:s()}}catch(i){return{error:!0,value:i}}},Sl=dr.Promise,tS="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Gw=!tS&&!Nh&&"object"==typeof window&&"object"==typeof document,Ww=dr,Lh=Sl,Xk=un,Qn=EM,Qk=T0,Kw=Gw,Zk=tS,qw=mo,zw=Lh&&Lh.prototype,Yw=ri("species"),$w=!1,nS=Xk(Ww.PromiseRejectionEvent),Jf={CONSTRUCTOR:Qn("Promise",function(){var s=Qk(Lh),i=s!==String(Lh);if(!i&&66===qw||!zw.catch||!zw.finally)return!0;if(!qw||qw<51||!/native code/.test(s)){var r=new Lh(function(l){l(1)}),a=function(l){l(function(){},function(){})};if((r.constructor={})[Yw]=a,!($w=r.then(function(){})instanceof a))return!0}return!i&&(Kw||Zk)&&!nS}),REJECTION_EVENT:nS,SUBCLASSING:$w},Rc={},Jw=go,Xw=TypeError,HV=function(s){var i,r;this.promise=new s(function(a,l){if(void 0!==i||void 0!==r)throw Xw("Bad Promise constructor");i=a,r=l}),this.resolve=Jw(i),this.reject=Jw(r)};Rc.f=function(s){return new HV(s)};var Qw,tL,nL=Tn,iS=Nh,Tl=dr,Xf=Vn,rS=lh,oS=Oa,GV=go,Zw=un,WV=Po,eA=$k,oL=Vw.set,sS=Hw,sL=Wd,tA=jw,nA=gc,jg=Sl,iA=Rc,Zf="Promise",rA=Jf.CONSTRUCTOR,aL=Jf.REJECTION_EVENT,aS=nA.getterFor(Zf),cL=nA.set,Fh=jg,cS=jg&&jg.prototype,lS=Tl.TypeError,Hg=Tl.document,e_=Tl.process,oA=iA.f,dS=oA,dL=!!(Hg&&Hg.createEvent&&Tl.dispatchEvent),uL="unhandledrejection",Y=function(s){var i;return!(!WV(s)||!Zw(i=s.then))&&i},sA=function(s,i){var r,a,l,d=i.value,h=1==i.state,f=h?s.ok:s.fail,m=s.resolve,g=s.reject,E=s.domain;try{f?(h||(2===i.rejection&&_e(i),i.rejection=1),!0===f?r=d:(E&&E.enter(),r=f(d),E&&(E.exit(),l=!0)),r===s.promise?g(lS("Promise-chain cycle")):(a=Y(r))?Xf(a,r,m,g):m(r)):g(d)}catch(y){E&&!l&&E.exit(),g(y)}},Xe=function(s,i){s.notified||(s.notified=!0,sS(function(){for(var r,a=s.reactions;r=a.get();)sA(r,s);s.notified=!1,i&&!s.rejection&&hL(s)}))},Gg=function(s,i,r){var a,l;dL?((a=Hg.createEvent("Event")).promise=i,a.reason=r,a.initEvent(s,!1,!0),Tl.dispatchEvent(a)):a={promise:i,reason:r},!aL&&(l=Tl["on"+s])?l(a):s===uL&&function(s,i){try{1==arguments.length?console.error(s):console.error(s,i)}catch(r){}}("Unhandled promise rejection",r)},hL=function(s){Xf(oL,Tl,function(){var i,r=s.facade,a=s.value;if(fe(s)&&(i=sL(function(){iS?e_.emit("unhandledRejection",a,r):Gg(uL,r,a)}),s.rejection=iS||fe(s)?2:1,i.error))throw i.value})},fe=function(s){return 1!==s.rejection&&!s.parent},_e=function(s){Xf(oL,Tl,function(){var i=s.facade;iS?e_.emit("rejectionHandled",i):Gg("rejectionhandled",i,s.value)})},Ue=function(s,i,r){return function(a){s(i,a,r)}},t_=function(s,i,r){s.done||(s.done=!0,r&&(s=r),s.value=i,s.state=2,Xe(s,!0))},uS=function(s,i,r){if(!s.done){s.done=!0,r&&(s=r);try{if(s.facade===i)throw lS("Promise can't be resolved itself");var a=Y(i);a?sS(function(){var l={done:!1};try{Xf(a,i,Ue(uS,l,s),Ue(t_,l,s))}catch(d){t_(l,d,s)}}):(s.value=i,s.state=1,Xe(s,!1))}catch(l){t_({done:!1},l,s)}}};rA&&(cS=(Fh=function(s){(function(s,i){if(ww(i,s))return s;throw Aw("Incorrect invocation")})(this,cS),GV(s),Xf(Qw,this);var i=aS(this);try{s(Ue(uS,i),Ue(t_,i))}catch(r){t_(i,r)}}).prototype,(Qw=function(s){cL(this,{type:Zf,done:!1,notified:!1,parent:!1,reactions:new tA,rejection:!1,state:0,value:void 0})}).prototype=rS(cS,"then",function(s,i){var r=aS(this),a=oA(eA(this,Fh));return r.parent=!0,a.ok=!Zw(s)||s,a.fail=Zw(i)&&i,a.domain=iS?e_.domain:void 0,0==r.state?r.reactions.add(a):sS(function(){sA(a,r)}),a.promise}),tL=function(){var s=new Qw,i=aS(s);this.promise=s,this.resolve=Ue(uS,i),this.reject=Ue(t_,i)},iA.f=oA=function(s){return s===Fh||void 0===s?new tL(s):dS(s)}),nL({global:!0,constructor:!0,wrap:!0,forced:rA},{Promise:Fh}),oS(Fh,Zf,!1,!0),function(s){var i=Wk(s);qf&&i&&!i[Lg]&&Kk(i,Lg,{configurable:!0,get:function(){return this}})}(Zf);var Kd=ri("iterator"),qd=!1;try{var pL=0,bl={next:function(){return{done:!!pL++}},return:function(){qd=!0}};bl[Kd]=function(){return this},Array.from(bl,function(){throw 2})}catch(s){}var n_=Sl,zd=Jf.CONSTRUCTOR||!function(s,i){if(!i&&!qd)return!1;var r=!1;try{var a={};a[Kd]=function(){return{next:function(){return{done:r=!0}}}},s(a)}catch(l){}return r}(function(s){n_.all(s).then(void 0,function(){})}),dn=Vn,cA=go,fL=Rc,lA=Wd,dA=Ah;Tn({target:"Promise",stat:!0,forced:zd},{all:function(s){var i=this,r=fL.f(i),a=r.resolve,l=r.reject,d=lA(function(){var h=cA(i.resolve),f=[],m=0,g=1;dA(s,function(E){var y=m++,C=!1;g++,dn(h,i,E).then(function(b){C||(C=!0,f[y]=b,--g||a(f))},l)}),--g||a(f)});return d.error&&l(d.value),r.promise}}),Tn({target:"Promise",proto:!0,forced:Jf.CONSTRUCTOR,real:!0},{catch:function(s){return this.then(void 0,s)}});var _L=Vn,Rl=go,Hr=Rc,uA=Wd,pS=Ah;Tn({target:"Promise",stat:!0,forced:zd},{race:function(s){var i=this,r=Hr.f(i),a=r.reject,l=uA(function(){var d=Rl(i.resolve);pS(s,function(h){_L(d,i,h).then(r.resolve,a)})});return l.error&&a(l.value),r.promise}});var hA=Vn,pA=Rc;Tn({target:"Promise",stat:!0,forced:Jf.CONSTRUCTOR},{reject:function(s){var i=pA.f(this);return hA(i.reject,void 0,s),i.promise}});var fA=wa,_A=Po,mA=Rc,fS=function(s,i){if(fA(s),_A(i)&&i.constructor===s)return i;var r=mA.f(s);return(0,r.resolve)(i),r.promise},gA=Tn,EA=Sl,KV=Jf.CONSTRUCTOR,mL=fS,gL=eo("Promise"),yA=!KV;gA({target:"Promise",stat:!0,forced:!0},{resolve:function(s){return mL(yA&&this===gL?EA:this,s)}});var EL=Vn,nr=go,vA=Rc,yL=Wd,vL=Ah;Tn({target:"Promise",stat:!0,forced:zd},{allSettled:function(s){var i=this,r=vA.f(i),a=r.resolve,l=r.reject,d=yL(function(){var h=nr(i.resolve),f=[],m=0,g=1;vL(s,function(E){var y=m++,C=!1;g++,EL(h,i,E).then(function(b){C||(C=!0,f[y]={status:"fulfilled",value:b},--g||a(f))},function(b){C||(C=!0,f[y]={status:"rejected",reason:b},--g||a(f))})}),--g||a(f)});return d.error&&l(d.value),r.promise}});var CA=Vn,CL=go,SA=eo,TA=Rc,Uh=Wd,SL=Ah,bA="No one promise resolved";Tn({target:"Promise",stat:!0,forced:zd},{any:function(s){var i=this,r=SA("AggregateError"),a=TA.f(i),l=a.resolve,d=a.reject,h=Uh(function(){var f=CL(i.resolve),m=[],g=0,E=1,y=!1;SL(s,function(C){var b=g++,O=!1;E++,CA(f,i,C).then(function(P){O||y||(y=!0,l(P))},function(P){O||y||(O=!0,m[b]=P,--E||d(new r(m,bA)))})}),--E||d(new r(m,bA))});return h.error&&d(h.value),a.promise}});var qV=eo,Wg=un,Jt=$k,oa=fS,TL=Sl&&Sl.prototype;Tn({target:"Promise",proto:!0,real:!0,forced:!!Sl&&gi(function(){TL.finally.call({then:function(){}},function(){})})},{finally:function(s){var i=Jt(this,qV("Promise")),r=Wg(s);return this.then(r?function(a){return oa(i,s()).then(function(){return a})}:s,r?function(a){return oa(i,s()).then(function(){throw a})}:s)}});var wA=ud.Promise,q=wr(wA);const sa=()=>{};function io(){const s={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:sa};return s.promise=new q((i,r)=>{s.resolve=a=>{s.isFinished||(s.isResolved=!0,s.isFinished=!0,i(a),s.value=a)},s.reject=a=>{s.isFinished||(s.isRejected=!0,s.isFinished=!0,r(a))}}),s}const i_=new Map,r_=new Map,xa=new Map;var vi,St,s;(s=vi||(vi={})).WIN_10="Windows 10",s.WIN_81="Windows 8.1",s.WIN_8="Windows 8",s.WIN_7="Windows 7",s.WIN_VISTA="Windows Vista",s.WIN_SERVER_2003="Windows Server 2003",s.WIN_XP="Windows XP",s.WIN_2000="Windows 2000",s.ANDROID="Android",s.HARMONY_OS="HarmonyOS",s.OPEN_BSD="Open BSD",s.SUN_OS="Sun OS",s.LINUX="Linux",s.IOS="iOS",s.MAC_OS="Mac OS",s.QNX="QNX",s.UNIX="UNIX",s.BEOS="BeOS",s.OS_2="OS/2",s.SEARCH_BOT="Search Bot",function(s){s.CHROME="Chrome",s.SAFARI="Safari",s.EDGE="Edge",s.FIREFOX="Firefox",s.OPERA="OPR",s.QQ="QQBrowser",s.WECHAT="MicroMessenger"}(St||(St={}));var mS={exports:{}};!function(s,i){!function(r,a){var l="function",d="undefined",h="object",f="string",m="major",g="model",E="name",y="type",C="vendor",b="version",O="architecture",P="console",D="mobile",L="tablet",B="smarttv",V="wearable",J="embedded",ae="Amazon",z="Apple",Q="ASUS",X="BlackBerry",te="Browser",Ce="Chrome",Se="Firefox",He="Google",dt="Microsoft",It="Motorola",re="Opera",de="Samsung",xe="Sony",gt="Xiaomi",ue="Zebra",I="Facebook",U="Chromium OS",G="Mac OS",ce=function(Fn){for(var li={},an=0;an<Fn.length;an++)li[Fn[an].toUpperCase()]=Fn[an];return li},Ve=function(Fn,li){return typeof Fn===f&&-1!==sn(li).indexOf(sn(Fn))},sn=function(Fn){return Fn.toLowerCase()},Xi=function(Fn,li){if(typeof Fn===f)return Fn=Fn.replace(/^\s\s*/,""),typeof li===d?Fn:Fn.substring(0,350)},co=function(Fn,li){for(var an,wo,Qa,Un,Et,uo,Zl=0;Zl<li.length&&!Et;){var Za=li[Zl],eR=li[Zl+1];for(an=wo=0;an<Za.length&&!Et&&Za[an];)if(Et=Za[an++].exec(Fn))for(Qa=0;Qa<eR.length;Qa++)uo=Et[++wo],typeof(Un=eR[Qa])===h&&Un.length>0?2===Un.length?this[Un[0]]=typeof Un[1]==l?Un[1].call(this,uo):Un[1]:3===Un.length?this[Un[0]]=typeof Un[1]!==l||Un[1].exec&&Un[1].test?uo?uo.replace(Un[1],Un[2]):a:uo?Un[1].call(this,uo,Un[2]):a:4===Un.length&&(this[Un[0]]=uo?Un[3].call(this,uo.replace(Un[1],Un[2])):a):this[Un]=uo||a;Zl+=2}},Qr=function(Fn,li){for(var an in li)if(typeof li[an]===h&&li[an].length>0){for(var wo=0;wo<li[an].length;wo++)if(Ve(li[an][wo],Fn))return"?"===an?a:an}else if(Ve(li[an],Fn))return"?"===an?a:an;return Fn},Dy={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Oy={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[b,[E,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[b,[E,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[E,b],[/opios[\/ ]+([\w\.]+)/i],[b,[E,re+" Mini"]],[/\bopr\/([\w\.]+)/i],[b,[E,re]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[E,b],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[b,[E,"UC"+te]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[b,[E,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[b,[E,"WeChat"]],[/konqueror\/([\w\.]+)/i],[b,[E,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[b,[E,"IE"]],[/yabrowser\/([\w\.]+)/i],[b,[E,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[E,/(.+)/,"$1 Secure "+te],b],[/\bfocus\/([\w\.]+)/i],[b,[E,Se+" Focus"]],[/\bopt\/([\w\.]+)/i],[b,[E,re+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[b,[E,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[b,[E,"Dolphin"]],[/coast\/([\w\.]+)/i],[b,[E,re+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[b,[E,"MIUI "+te]],[/fxios\/([-\w\.]+)/i],[b,[E,Se]],[/\bqihu|(qi?ho?o?|360)browser/i],[[E,"360 "+te]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[E,/(.+)/,"$1 "+te],b],[/(comodo_dragon)\/([\w\.]+)/i],[[E,/_/g," "],b],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[E,b],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[E],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[E,I],b],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[E,b],[/\bgsa\/([\w\.]+) .*safari\//i],[b,[E,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[b,[E,Ce+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[E,Ce+" WebView"],b],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[b,[E,"Android "+te]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[E,b],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[b,[E,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[b,E],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[E,[b,Qr,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[E,b],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[E,"Netscape"],b],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[b,[E,Se+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[E,b],[/(cobalt)\/([\w\.]+)/i],[E,[b,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[O,"amd64"]],[/(ia32(?=;))/i],[[O,sn]],[/((?:i[346]|x)86)[;\)]/i],[[O,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[O,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[O,"armhf"]],[/windows (ce|mobile); ppc;/i],[[O,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[O,/ower/,"",sn]],[/(sun4\w)[;\)]/i],[[O,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[O,sn]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[g,[C,de],[y,L]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[g,[C,de],[y,D]],[/\((ip(?:hone|od)[\w ]*);/i],[g,[C,z],[y,D]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[g,[C,z],[y,L]],[/(macintosh);/i],[g,[C,z]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[g,[C,"Sharp"],[y,D]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[g,[C,"Huawei"],[y,L]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[g,[C,"Huawei"],[y,D]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[g,/_/g," "],[C,gt],[y,D]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[g,/_/g," "],[C,gt],[y,L]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[g,[C,"OPPO"],[y,D]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[g,[C,"Vivo"],[y,D]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[g,[C,"Realme"],[y,D]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[g,[C,It],[y,D]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[g,[C,It],[y,L]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[g,[C,"LG"],[y,L]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[g,[C,"LG"],[y,D]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[g,[C,"Lenovo"],[y,L]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[g,/_/g," "],[C,"Nokia"],[y,D]],[/(pixel c)\b/i],[g,[C,He],[y,L]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[g,[C,He],[y,D]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[g,[C,xe],[y,D]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[g,"Xperia Tablet"],[C,xe],[y,L]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[g,[C,"OnePlus"],[y,D]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[g,[C,ae],[y,L]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[g,/(.+)/g,"Fire Phone $1"],[C,ae],[y,D]],[/(playbook);[-\w\),; ]+(rim)/i],[g,C,[y,L]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[g,[C,X],[y,D]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[g,[C,Q],[y,L]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[g,[C,Q],[y,D]],[/(nexus 9)/i],[g,[C,"HTC"],[y,L]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[C,[g,/_/g," "],[y,D]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[g,[C,"Acer"],[y,L]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[g,[C,"Meizu"],[y,D]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[C,g,[y,D]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[C,g,[y,L]],[/(surface duo)/i],[g,[C,dt],[y,L]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[g,[C,"Fairphone"],[y,D]],[/(u304aa)/i],[g,[C,"AT&T"],[y,D]],[/\bsie-(\w*)/i],[g,[C,"Siemens"],[y,D]],[/\b(rct\w+) b/i],[g,[C,"RCA"],[y,L]],[/\b(venue[\d ]{2,7}) b/i],[g,[C,"Dell"],[y,L]],[/\b(q(?:mv|ta)\w+) b/i],[g,[C,"Verizon"],[y,L]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[g,[C,"Barnes & Noble"],[y,L]],[/\b(tm\d{3}\w+) b/i],[g,[C,"NuVision"],[y,L]],[/\b(k88) b/i],[g,[C,"ZTE"],[y,L]],[/\b(nx\d{3}j) b/i],[g,[C,"ZTE"],[y,D]],[/\b(gen\d{3}) b.+49h/i],[g,[C,"Swiss"],[y,D]],[/\b(zur\d{3}) b/i],[g,[C,"Swiss"],[y,L]],[/\b((zeki)?tb.*\b) b/i],[g,[C,"Zeki"],[y,L]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[C,"Dragon Touch"],g,[y,L]],[/\b(ns-?\w{0,9}) b/i],[g,[C,"Insignia"],[y,L]],[/\b((nxa|next)-?\w{0,9}) b/i],[g,[C,"NextBook"],[y,L]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[C,"Voice"],g,[y,D]],[/\b(lvtel\-)?(v1[12]) b/i],[[C,"LvTel"],g,[y,D]],[/\b(ph-1) /i],[g,[C,"Essential"],[y,D]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[g,[C,"Envizen"],[y,L]],[/\b(trio[-\w\. ]+) b/i],[g,[C,"MachSpeed"],[y,L]],[/\btu_(1491) b/i],[g,[C,"Rotor"],[y,L]],[/(shield[\w ]+) b/i],[g,[C,"Nvidia"],[y,L]],[/(sprint) (\w+)/i],[C,g,[y,D]],[/(kin\.[onetw]{3})/i],[[g,/\./g," "],[C,dt],[y,D]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[g,[C,ue],[y,L]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[g,[C,ue],[y,D]],[/smart-tv.+(samsung)/i],[C,[y,B]],[/hbbtv.+maple;(\d+)/i],[[g,/^/,"SmartTV"],[C,de],[y,B]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[C,"LG"],[y,B]],[/(apple) ?tv/i],[C,[g,z+" TV"],[y,B]],[/crkey/i],[[g,Ce+"cast"],[C,He],[y,B]],[/droid.+aft(\w)( bui|\))/i],[g,[C,ae],[y,B]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[g,[C,"Sharp"],[y,B]],[/(bravia[\w ]+)( bui|\))/i],[g,[C,xe],[y,B]],[/(mitv-\w{5}) bui/i],[g,[C,gt],[y,B]],[/Hbbtv.*(technisat) (.*);/i],[C,g,[y,B]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[C,Xi],[g,Xi],[y,B]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[y,B]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[C,g,[y,P]],[/droid.+; (shield) bui/i],[g,[C,"Nvidia"],[y,P]],[/(playstation [345portablevi]+)/i],[g,[C,xe],[y,P]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[g,[C,dt],[y,P]],[/((pebble))app/i],[C,g,[y,V]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[g,[C,z],[y,V]],[/droid.+; (glass) \d/i],[g,[C,He],[y,V]],[/droid.+; (wt63?0{2,3})\)/i],[g,[C,ue],[y,V]],[/(quest( 2| pro)?)/i],[g,[C,I],[y,V]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[C,[y,J]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[g,[y,D]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[g,[y,L]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[y,L]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[y,D]],[/(android[-\w\. ]{0,9});.+buil/i],[g,[C,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[b,[E,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[b,[E,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[E,b],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[b,E]],os:[[/microsoft (windows) (vista|xp)/i],[E,b],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[E,[b,Qr,Dy]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[E,"Windows"],[b,Qr,Dy]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[b,/_/g,"."],[E,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[E,G],[b,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[b,E],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[E,b],[/\(bb(10);/i],[b,[E,X]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[b,[E,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[b,[E,Se+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[b,[E,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[b,[E,"watchOS"]],[/crkey\/([\d\.]+)/i],[b,[E,Ce+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[E,U],b],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[E,b],[/(sunos) ?([\w\.\d]*)/i],[[E,"Solaris"],b],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[E,b]]},lo=function(Fn,li){if(typeof Fn===h&&(li=Fn,Fn=a),!(this instanceof lo))return new lo(Fn,li).getResult();var an=typeof r!==d&&r.navigator?r.navigator:a,wo=Fn||(an&&an.userAgent?an.userAgent:""),Qa=an&&an.userAgentData?an.userAgentData:a,Un=li?function(Et,uo){var Zl={};for(var Za in Et)Zl[Za]=uo[Za]&&uo[Za].length%2==0?uo[Za].concat(Et[Za]):Et[Za];return Zl}(Oy,li):Oy;return this.getBrowser=function(){var uo,Et={};return Et[E]=a,Et[b]=a,co.call(Et,wo,Un.browser),Et[m]=typeof(uo=Et[b])===f?uo.replace(/[^\d\.]/g,"").split(".")[0]:a,an&&an.brave&&typeof an.brave.isBrave==l&&(Et[E]="Brave"),Et},this.getCPU=function(){var Et={};return Et[O]=a,co.call(Et,wo,Un.cpu),Et},this.getDevice=function(){var Et={};return Et[C]=a,Et[g]=a,Et[y]=a,co.call(Et,wo,Un.device),!Et[y]&&Qa&&Qa.mobile&&(Et[y]=D),"Macintosh"==Et[g]&&an&&typeof an.standalone!==d&&an.maxTouchPoints&&an.maxTouchPoints>2&&(Et[g]="iPad",Et[y]=L),Et},this.getEngine=function(){var Et={};return Et[E]=a,Et[b]=a,co.call(Et,wo,Un.engine),Et},this.getOS=function(){var Et={};return Et[E]=a,Et[b]=a,co.call(Et,wo,Un.os),!Et[E]&&Qa&&"Unknown"!=Qa.platform&&(Et[E]=Qa.platform.replace(/chrome os/i,U).replace(/macos/i,G)),Et},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return wo},this.setUA=function(Et){return wo=typeof Et===f&&Et.length>350?Xi(Et,350):Et,this},this.setUA(wo),this};lo.VERSION="0.7.34",lo.BROWSER=ce([E,b,m]),lo.CPU=ce([O]),lo.DEVICE=ce([g,C,y,P,D,B,L,V,J]),lo.ENGINE=lo.OS=ce([E,b]),s.exports&&(i=s.exports=lo),i.UAParser=lo;var Xc=typeof r!==d&&(r.jQuery||r.Zepto);if(Xc&&!Xc.ua){var sm=new lo;Xc.ua=sm.getResult(),Xc.ua.get=function(){return sm.getUA()},Xc.ua.set=function(Fn){sm.setUA(Fn);var li=sm.getResult();for(var an in li)Xc.ua[an]=li[an]}}}("object"==typeof window?window:Bu)}(mS,mS.exports);const o_=new(wr(mS.exports));let Wo=o_.getResult(),gS=null;function pt(s){if(!gS){s&&o_.setUA(s),Wo=o_.getResult();const i=function(d){if("Blink"===d.engine.name&&"WeChat"!==d.browser.name)return St.CHROME;switch(d.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return St.CHROME;case"Safari":case"Mobile Safari":return St.SAFARI;case"Edge":return St.EDGE;case"Firefox":return St.FIREFOX;case"QQBrowser":return St.QQ;case"Opera":return St.OPERA;case"WeChat":return St.WECHAT;default:return d.browser.name||""}}(Wo),r=function(d){let h;return h="Blink"===d.engine.name?d.engine.version||"":d.browser.version||"",h.split(".")[0]}(Wo),a="Windows"===(d=Wo).os.name?d.os.version?d.os.name+" "+d.os.version:d.os.name:d.os.name||"",l=Wo.os.version;if(!(i&&r&&a&&l))return{name:i,version:r,os:a,osVersion:l};gS={name:i,version:r,os:a,osVersion:l}}var d;return gS}function Kg(){return pt().os}function ES(){const s=pt();return"".concat(s.os," ").concat(s.osVersion)}function s_(){const s=pt();return!!("WebKit"===Wo.engine.name&&s.os===vi.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&s.name!==St.SAFARI||Ci()&&s.name!==St.SAFARI)}function zg(){return pt().name===St.CHROME}function Yt(){return pt().name===St.SAFARI}function Pt(){return pt().name===St.FIREFOX}function Ci(){return pt().os===vi.IOS}function Yg(s){const i=pt();return!(i.name!==St.CHROME||!i.osVersion)&&Number(i.version)>=s}function yS(s){const i=pt();return!(i.name!==St.EDGE||!i.osVersion)&&Number(i.version)>=s}function vS(s){const i=pt();return!(i.name!==St.OPERA||!i.osVersion)&&Number(i.version)>=s}function CS(){const s=pt();return!(s.name!==St.CHROME||!s.osVersion)&&Number(s.version)<=90}function SS(){const s=pt();if(s.os!==vi.IOS||!s.osVersion)return!1;const i=s.osVersion.split(".");return Number(i[0])<14||14===Number(i[0])&&Number(i[1])<=6}function Yd(){const s=pt();if(s.os!==vi.IOS||!s.osVersion)return!1;const i=s.osVersion.split(".");return 15===Number(i[0])}function $g(){const s=pt();if(s.os!==vi.IOS||!s.osVersion)return!1;const i=s.osVersion.split(".");return 16===Number(i[0])}function TS(){const s=pt();if(s.os!==vi.IOS||!s.osVersion)return!1;const i=s.osVersion.split(".");return 15===Number(i[0])&&Number(i[1])>=1}function Fa(){return Yt()&&navigator.maxTouchPoints>0}function AA(){return pt().name===St.WECHAT}function DA(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function Il(){const s=pt();return s.name!==St.EDGE&&s.name!==St.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Jg(){return Kg()===vi.ANDROID}function a_(){const s=pt();return Jg()&&(s.name===St.CHROME||s.name===St.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}var k;!function(s){s.UNEXPECTED_ERROR="UNEXPECTED_ERROR",s.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",s.TIMEOUT="TIMEOUT",s.INVALID_PARAMS="INVALID_PARAMS",s.NOT_READABLE="NOT_READABLE",s.NOT_SUPPORTED="NOT_SUPPORTED",s.INVALID_OPERATION="INVALID_OPERATION",s.OPERATION_ABORTED="OPERATION_ABORTED",s.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",s.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",s.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",s.DATACHANNEL_FAILED="DATACHANNEL_FAILED",s.NETWORK_ERROR="NETWORK_ERROR",s.NETWORK_TIMEOUT="NETWORK_TIMEOUT",s.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",s.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",s.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",s.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",s.ELECTRON_IS_NULL="ELECTRON_IS_NULL",s.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",s.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",s.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",s.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",s.PERMISSION_DENIED="PERMISSION_DENIED",s.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",s.TRACK_IS_DISABLED="TRACK_IS_DISABLED",s.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",s.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",s.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",s.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",s.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",s.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",s.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",s.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",s.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",s.UID_CONFLICT="UID_CONFLICT",s.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",s.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",s.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",s.INVALID_TRACK="INVALID_TRACK",s.SENDER_NOT_FOUND="SENDER_NOT_FOUND",s.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",s.SET_ANSWER_FAILED="SET_ANSWER_FAILED",s.ICE_FAILED="ICE_FAILED",s.PC_CLOSED="PC_CLOSED",s.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",s.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",s.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",s.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",s.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",s.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",s.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",s.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",s.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",s.INVALID_REMOTE_USER="INVALID_REMOTE_USER",s.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",s.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",s.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",s.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",s.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",s.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",s.WS_ABORT="WS_ABORT",s.WS_DISCONNECT="WS_DISCONNECT",s.WS_ERR="WS_ERR",s.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",s.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",s.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",s.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",s.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",s.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",s.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",s.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",s.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",s.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",s.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",s.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",s.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",s.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",s.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",s.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",s.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",s.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",s.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",s.INVALID_PLUGIN="INVALID_PLUGIN",s.DISCONNECT_P2P="DISCONNECT_P2P",s.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",s.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",s.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",s.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",s.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",s.PROHIBITED_OPERATION="PROHIBITED_OPERATION",s.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED"}(k||(k={}));let ne=class extends Error{constructor(s){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(i),T(this,"code",void 0),T(this,"message",void 0),T(this,"data",void 0),T(this,"name","AgoraRTCException"),this.code=s,this.message="AgoraRTCError ".concat(this.code,": ").concat(i),this.data=r}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),"\n").concat(this.stack):"".concat(this.stack)}print(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",i=arguments.length>1?arguments[1]:void 0;return"error"===s&&(i||console).error(this.toString()),"warning"===s&&(i||console).warn(this.toString()),this}throw(s){throw this.print("error",s),this}};function $d(s,i){if("boolean"!=typeof s)throw new ne(k.INVALID_PARAMS,"Invalid ".concat(i,": The value is of the boolean type."))}function pi(s,i,r){if(!we(r).call(r,s))throw new ne(k.INVALID_PARAMS,"".concat(i," can only be set as ").concat(JSON.stringify(r)))}function Ut(s,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(s<r||s>a||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&("number"!=typeof(l=s)||l%1!=0))throw new ne(k.INVALID_PARAMS,"invalid ".concat(i,": the value range is [").concat(r,", ").concat(a,"]. integer only"));var l}function bS(s,i){if("number"!=typeof s){if(!(s.min||s.max||s.ideal||s.exact))throw new ne(k.INVALID_PARAMS,"".concat(i," is not a valid ConstrainLong"));void 0!==s.min&&Ut(s.min,"".concat(i,".min"),0,1/0),void 0!==s.max&&Ut(s.max,"".concat(i,".max"),1,1/0),void 0!==s.exact&&Ut(s.exact,"".concat(i,".exact"),1,1/0),void 0!==s.ideal&&Ut(s.ideal,"".concat(i,".ideal"),1,1/0)}else Ut(s,i,1,1/0)}function Vi(s,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==s)throw new ne(k.INVALID_PARAMS,"".concat(i||"param"," cannot be empty"));if(!OA(s,r,a,l))throw new ne(k.INVALID_PARAMS,"Invalid ".concat(i||"string param",": Length of the string: [").concat(r,",").concat(a,"].").concat(l?" ASCII characters only.":""))}function Ic(s,i){if(!Array.isArray(s))throw new ne(k.INVALID_PARAMS,"".concat(i," should be an array"))}function En(s){return null==s}function OA(s){return"string"==typeof s&&s.length<=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:255)&&s.length>=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)&&(!(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])||function(l){if("string"!=typeof l)return!1;for(let d=0;d<l.length;d+=1){const h=l.charCodeAt(d);if(h<0||h>255)return!1}return!0}(s))}function NA(s,i,r){if("getBigUint64"in DataView.prototype)return s.getBigUint64(i,r);const a=s.getUint32(i,r),l=s.getUint32(i+4,r),d=Number(!!r),h=Number(!r);return BigInt(a*h+l*d)<<BigInt(32)|BigInt(a*d+l*h)}function PA(s,i,r,a){if("setBigUint64"in DataView.prototype)return s.setBigUint64(i,r,a);const l=Number(r>>BigInt(32)),d=Number(r&BigInt(4294967295));a?(s.setUint32(i+4,l,a),s.setUint32(i,d,a)):(s.setUint32(i,l,a),s.setUint32(i+4,d,a))}var Jd,c_;(function(s){s.COVERED="COVERED",s.POSITION="POSITION",s.SIZE="SIZE",s.STYLE="STYLE"})(Jd||(Jd={})),function(s){s.UNMOUNTED="UNMOUNTED",s.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(c_||(c_={}));const RS=new class{constructor(){T(this,"_clientSize",null),T(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),T(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),T(this,"getStyle",s=>window.getComputedStyle(s,null)),T(this,"checkCssVisibleProperty",s=>{var i;let r=!0;const a=this.getStyle(s),{display:l,visibility:d,opacity:h,filter:f}=a;return("none"===l||we(i=["hidden","collapse"]).call(i,d)||Number(h)<.1)&&(r=!1),!!r&&(f&&f.split(" ").filter(m=>{var g;const E=m.split("(")[0];return we(g=["brightness","blur","opacity"]).call(g,E)}).map(m=>{const[g,E]=m.split(/\(|\)/);return[g,Number(E.match(/^[0-9\.]+/))]}).forEach(m=>{const[g,E]=m;switch(g){case"brightness":(E<.1||E>3)&&(r=!1);break;case"blur":E>3&&(r=!1);break;case"opacity":E<.1&&(r=!1)}}),r)}),T(this,"checkPropertyUpToAllParentNodes",(s,i)=>{let r=!0,a=!0;let d=s;for(;d&&a;)i(d)||(r=!1,a=!1),d=d.parentElement,d||(a=!1);return r}),T(this,"checkActualCssVisibleIncludeInherit",s=>this.checkPropertyUpToAllParentNodes(s,this.checkCssVisibleProperty)),T(this,"getSizeAboutClient",s=>{const{width:i,height:r,left:a,right:l,top:d,bottom:h}=s.getBoundingClientRect(),f=this.getClientWidth(),m=this.getClientHeight();return{width:i,height:r,left:a,right:l,top:d,bottom:h,clientWidth:f,clientHeight:m,clientMin:Math.min(f,m)}}),T(this,"checkActualSize",()=>{const{width:s,height:i,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(s,i,r)}),T(this,"elementFromPoint",(s,i)=>document.elementFromPoint?document.elementFromPoint(s,i):null),T(this,"checkCoverForAPoint",(s,i,r)=>{const a=this.elementFromPoint(s,i);return null!==a&&a!==r}),T(this,"getPointPositionList",()=>{const{width:s,height:i,left:r,top:a}=this._clientSize,l=s/6,d=i/6,h=[],f=10**6;for(let m=0;m<5;m++)for(let g=0;g<5;g++)h.push({x:(r*f+(0===m?.1:4===m?(l*m*f-1e5)/f:l*m)*f)/f,y:(a*f+(0===g?.1:4===g?(d*g*f-1e5)/f:d*g)*f)/f});return[...h]}),T(this,"checkElementCover",s=>this.getPointPositionList().map(i=>this.checkCoverForAPoint(i.x,i.y,s)).filter(i=>!!i).length>6),T(this,"checkSizeIsVisible",(s,i,r)=>(s>50||r/s<=10)&&(i>50||r/i<=10)),T(this,"checkSizeOfPartInClient",()=>{const{left:s,right:i,top:r,bottom:a,clientHeight:l,clientWidth:d,clientMin:h}=this._clientSize;let f,m,g,E;if(s<0)f=0;else{if(!(s<d))return!1;f=s}if(i<0)return!1;if(m=i<d?i:d,r<0)g=0;else{if(!(r<l))return!1;g=r}return!(a<0)&&(E=a<l?a:l,this.checkSizeIsVisible(m-f,E-g,h))}),T(this,"returnHiddenResult",s=>(this._clientSize=null,{visible:!1,reason:s})),T(this,"checkOneElementVisible",s=>{if(s instanceof HTMLElement){if(this.checkElementIsMountedOnDom(s)){if(this.checkActualCssVisibleIncludeInherit(s)){if(this._clientSize=this.getSizeAboutClient(s),this.checkElementCover(s))return this.returnHiddenResult(Jd.COVERED);{const i=this.checkActualSize(),r=this.checkSizeOfPartInClient();return i&&!r?this.returnHiddenResult(Jd.POSITION):i?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Jd.SIZE)}}return this.returnHiddenResult(Jd.STYLE)}return this.returnHiddenResult(c_.UNMOUNTED)}return this.returnHiddenResult(c_.INVALID_HTML_ELEMENT)}),T(this,"checkElementIsMountedOnDom",s=>this.checkPropertyUpToAllParentNodes(s,i=>"HTML"!==i.nodeName.toUpperCase()?null!==i.parentElement:!!document.documentElement))}};function Xg(s){return(new TextEncoder).encode(s)}const IS=function(s,i){const r=new Uint8Array(s.byteLength+i.byteLength);return r.set(new Uint8Array(s),0),r.set(new Uint8Array(i),s.byteLength),r},MA=function(){var s=x(function*(i){const r=function(h){const f=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),m=new Uint8Array(new ArrayBuffer(f.length));for(let g=0;g<f.length;g+=1)m[g]=f.charCodeAt(g);return m}(),a=yield window.crypto.subtle.importKey("spki",r,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),l=Xg(i),d=yield window.crypto.subtle.encrypt({name:"RSA-OAEP"},a,l);return function(h){let f="";for(let m=0;m<h.length;m+=1)f+=String.fromCharCode(h[m]);return window.btoa(f)}(new Uint8Array(d))});return function(r){return s.apply(this,arguments)}}(),kA=function(){var s=x(function*(i){return function(r,a){let l="";return new Uint8Array(r).forEach(d=>{l+=d.toString(16).padStart(2,"0")}),l}(yield crypto.subtle.digest("SHA-256",Xg(i)))});return function(r){return s.apply(this,arguments)}}();class nn{constructor(){T(this,"_events",{}),T(this,"addListener",this.on)}getListeners(i){return this._events[i]?this._events[i].map(r=>r.listener):[]}on(i,r){this._events[i]||(this._events[i]=[]);const a=this._events[i];-1===this._indexOfListener(a,r)&&a.push({listener:r,once:!1})}once(i,r){this._events[i]||(this._events[i]=[]);const a=this._events[i];-1===this._indexOfListener(a,r)&&a.push({listener:r,once:!0})}off(i,r){if(!this._events[i])return;const a=this._events[i],l=this._indexOfListener(a,r);-1!==l&&a.splice(l,1),0===this._events[i].length&&delete this._events[i]}removeAllListeners(i){i?delete this._events[i]:this._events={}}emit(i){this._events[i]||(this._events[i]=[]);const r=this._events[i].map(h=>h);for(var a=arguments.length,l=new Array(a>1?a-1:0),d=1;d<a;d++)l[d-1]=arguments[d];for(let h=0;h<r.length;h+=1){const f=r[h];f.once&&this.off(i,f.listener),f.listener.apply(this,l||[])}}safeEmit(i){for(var r=arguments.length,a=new Array(r>1?r-1:0),l=1;l<r;l++)a[l-1]=arguments[l];[...this._events[i]||[]].forEach(d=>{d.once&&this.off(i,d.listener);try{d.listener.apply(this,a)}catch(h){console.error("safeEmit event:".concat(i," error ").concat(null==h?void 0:h.toString()))}})}_indexOfListener(i,r){let a=i.length;for(;a--;)if(i[a].listener===r)return a;return-1}}let Vh=null;function Xd(){if(Vh)return Vh;if(window.electron)return Vh=window.electron;if(!window.require)return null;try{return Vh=window.require("electron"),Vh}catch(s){return null}}var jn,Kt,wS,$e,We,Si,yn,wl;function AS(s){return Ut(s.timeout,"config.timeout",0,1e5),Ut(s.timeoutFactor,"config.timeoutFactor",0,100,!1),Ut(s.maxRetryCount,"config.maxRetryConfig",0,1/0),Ut(s.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function Qd(s){if(!Array.isArray(s)||s.length<1)return!1;try{s.forEach(i=>{if(!i.urls)throw Error()})}catch(i){return!1}return!0}function RL(s){return Vi(s.turnServerURL,"turnServerURL"),Vi(s.username,"username"),Vi(s.password,"password"),s.udpport&&Ut(s.udpport,"udpport",1,99999,!0),s.forceturn&&$d(s.forceturn,"forceturn"),s.security&&$d(s.security,"security"),s.tcpport&&Ut(s.tcpport,"tcpport",1,99999,!0),!0}function ke(s){return void 0!==s.level&&pi(s.level,"level",[1,2,3]),void 0!==s.delay&&Ut(s.delay,"delay",0,3e3,!0),!0}function vn(s,i){for(var r=arguments.length,a=new Array(r>2?r-2:0),l=2;l<r;l++)a[l-2]=arguments[l];return 0===s.getListeners(i).length?q.reject(new ne(k.UNEXPECTED_ERROR,"can not emit promise")):new q((d,h)=>{s.emit(i,...a,d,h)})}function Ht(s,i){if(0===s.getListeners(i).length)return q.resolve();for(var r=arguments.length,a=new Array(r>2?r-2:0),l=2;l<r;l++)a[l-2]=arguments[l];return vn(s,i,...a)}function ro(s,i){if(0===s.getListeners(i).length)return null;for(var r=arguments.length,a=new Array(r>2?r-2:0),l=2;l<r;l++)a[l-2]=arguments[l];return Cs(s,i,...a)}function Cs(s,i){let r=null,a=null;for(var l=arguments.length,d=new Array(l>2?l-2:0),h=2;h<l;h++)d[h-2]=arguments[h];if(s.emit(i,...d,f=>{r=f},f=>{a=f}),null!==a)throw a;if(null===r)throw new ne(k.UNEXPECTED_ERROR,"handler is not sync");return r}(function(s){s.CREATE_CLIENT="createClient",s.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",s.SET_AREA="setArea",s.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",s.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",s.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",s.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",s.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",s.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",s.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",s.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",s.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",s.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",s.START_PROXY_SERVER="Client.startProxyServer",s.STOP_PROXY_SERVER="Client.stopProxyServer",s.SET_PROXY_SERVER="Client.setProxyServer",s.SET_TURN_SERVER="Client.setTurnServer",s.SET_CLIENT_ROLE="Client.setClientRole",s.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",s.ENABLE_DUAL_STREAM="Client.enableDualStream",s.DISABLE_DUAL_STREAM="Client.disableDualStream",s.JOIN="Client.join",s.LEAVE="Client.leave",s.PUBLISH="Client.publish",s.UNPUBLISH="Client.unpublish",s.SUBSCRIBE="Client.subscribe",s.MASS_SUBSCRIBE="Client.massSubscribe",s.MASS_UNSUBSCRIBE="Client.massUnsubscribe",s.UNSUBSCRIBE="Client.unsubscribe",s.RENEW_TOKEN="Client.renewToken",s.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",s.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",s.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",s.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",s.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",s.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",s.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",s.DATACHANNEL_FAILBACK="Client._datachannelFailback",s.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",s.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",s.START_LIVE_STREAMING="Client.startLiveStreaming",s.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",s.STOP_LIVE_STREAMING="Client.stopLiveStreaming",s.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",s.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",s.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",s.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",s.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",s.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",s.SET_CONFIG_DISTRIBUTE="_configDistribute",s.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",s.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",s.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",s.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",s.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",s.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",s.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",s.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",s.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",s.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",s.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",s.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",s.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",s.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",s.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",s.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",s.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",s.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",s.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",s.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",s.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",s.STREAM_TYPE_CHANGE="streamTypeChange",s.CONNECTION_STATE_CHANGE="connectionStateChange",s.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",s.IMAGE_MODERATION_UPLOAD="imageModerationUpload"})(jn||(jn={})),function(s){s.TRACER="tracer"}(Kt||(Kt={})),function(s){s[s.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",s[s.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",s[s.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(wS||(wS={})),function(s){s.LEAVE="LEAVE",s.NETWORK_ERROR="NETWORK_ERROR",s.SERVER_ERROR="SERVER_ERROR",s.UID_BANNED="UID_BANNED",s.IP_BANNED="IP_BANNED",s.CHANNEL_BANNED="CHANNEL_BANNED",s.FALLBACK="FALLBACK",s.LICENSE_MISSING="LICENSE_MISSING",s.LICENSE_EXPIRED="LICENSE_EXPIRED",s.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",s.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",s.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",s.LICENSE_ILLEGAL="LICENSE_ILLEGAL",s.TOKEN_EXPIRE="TOKEN_EXPIRE"}($e||($e={})),function(s){s.CONNECTION_STATE_CHANGE="connection-state-change",s.MEDIA_RECONNECT_START="media-reconnect-start",s.MEDIA_RECONNECT_END="media-reconnect-end",s.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",s.USER_JOINED="user-joined",s.USER_LEAVED="user-left",s.USER_PUBLISHED="user-published",s.USER_UNPUBLISHED="user-unpublished",s.USER_INFO_UPDATED="user-info-updated",s.CLIENT_BANNED="client-banned",s.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",s.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",s.VOLUME_INDICATOR="volume-indicator",s.CRYPT_ERROR="crypt-error",s.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",s.NETWORK_QUALITY="network-quality",s.STREAM_TYPE_CHANGED="stream-type-changed",s.STREAM_FALLBACK="stream-fallback",s.RECEIVE_METADATA="receive-metadata",s.STREAM_MESSAGE="stream-message",s.LIVE_STREAMING_ERROR="live-streaming-error",s.LIVE_STREAMING_WARNING="live-streaming-warning",s.INJECT_STREAM_STATUS="stream-inject-status",s.EXCEPTION="exception",s.ERROR="error",s.P2P_LOST="p2p_lost",s.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",s.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",s.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",s.PUBLISHED_USER_LIST="published-user-list",s.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",s.CONTENT_INSPECT_ERROR="content-inspect-error",s.CONTENT_INSPECT_RESULT="content-inspect-result",s.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}(We||(We={})),function(s){s.NETWORK_ERROR="NETWORK_ERROR",s.SERVER_ERROR="SERVER_ERROR",s.MULTI_IP="MULTI_IP",s.TIMEOUT="TIMEOUT",s.OFFLINE="OFFLINE",s.LEAVE="LEAVE",s.P2P_FAILED="P2P_FAILED",s.FALLBACK="FALLBACK"}(Si||(Si={})),function(s){s.ONLINE="ONLINE",s.OFFLINE="OFFLINE"}(yn||(yn={})),function(s){s.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",s.ONLINE="ONLINE",s.OFFLINE="OFFLINE"}(wl||(wl={}));const Hn=new class extends nn{set networkState(s){this.emit(wl.NETWORK_STATE_CHANGE,s,this._networkState),s===yn.ONLINE?this.emit(wl.ONLINE):s===yn.OFFLINE&&(this.onlineWaiter=new q(i=>{this.once(wl.ONLINE,()=>{this.onlineWaiter=void 0,i(yn.ONLINE)})}),this.emit(wl.OFFLINE)),this._networkState=s}get networkState(){return this._networkState}get isOnline(){return this._networkState===yn.ONLINE}constructor(){super(),T(this,"_moduleName","network-indicator"),T(this,"_networkState",yn.ONLINE),T(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=yn.ONLINE}),window.addEventListener("offline",()=>{this.networkState=yn.OFFLINE})}};function l_(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Ua(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?l_(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):l_(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function Ti(s,i){const r=s.indexOf(i);-1!==r&&s.splice(r,1)}function d_(s){const i=[];return s.forEach(r=>{-1===i.indexOf(r)&&i.push(r)}),i}function Ko(s){void 0!==q?q.resolve().then(s):setTimeout(s,0)}function Pn(s){return JSON.parse(JSON.stringify(s))}function Zd(s){try{return Pn(s)}catch(i){return s}}const DS={};function Bh(s,i){DS[i]||(DS[i]=!0,s())}function u_(s){const i=window.atob(s),r=new Uint8Array(new ArrayBuffer(i.length));for(let a=0;a<i.length;a+=1)r[a]=i.charCodeAt(a);return r}function h_(s){let i="";for(let r=0;r<s.length;r+=1)i+=String.fromCharCode(s[r]);return window.btoa(i)}function Va(s){return window.TextEncoder?(new TextEncoder).encode(s).length:s.length}function LA(s){let i=0;return/DingTalk/i.test(navigator.userAgent)&&s.realFormData&&(s=s.realFormData),s.forEach(r=>{i+="string"==typeof r?Va(r):r.size}),i+138}function IL(s){const i=new ne(k.TIMEOUT,"timeout");return new q((r,a)=>{window.setTimeout(()=>a(i),s)})}function si(s){return new q(i=>{window.setTimeout(i,s)})}function Vt(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,i=arguments.length>1?arguments[1]:void 0;const r=Math.random().toString(16).substr(2,s).toLowerCase();return r.length===s?"".concat(i).concat(r):"".concat(i).concat(r)+Vt(s-r.length,"")}function OS(){return Vt(32,"").toUpperCase()}const Qg=()=>{},p_=new class{constructor(){T(this,"fnMap",new Map)}throttleByKey(s,i,r,a){for(var l=arguments.length,d=new Array(l>4?l-4:0),h=4;h<l;h++)d[h-4]=arguments[h];if(this.fnMap.has(i)){const f=this.fnMap.get(i);if(f.threshold!==r){f.fn(...f.args),clearTimeout(f.timer);const m=window.setTimeout(()=>{const g=this.fnMap.get(i);g&&g.fn(...g.args),this.fnMap.delete(i)},r);this.fnMap.set(i,{fn:s,threshold:r,timer:m,args:d,skipFn:a})}else f.skipFn&&f.skipFn(...f.args),this.fnMap.set(i,Ua(Ua({},f),{},{fn:s,args:d,skipFn:a}))}else{const f=window.setTimeout(()=>{const m=this.fnMap.get(i);m&&m.fn(...m.args),this.fnMap.delete(i)},r);this.fnMap.set(i,{fn:s,threshold:r,timer:f,args:d,skipFn:a})}}},NS=p_.throttleByKey.bind(p_);function PS(s){return"object"==typeof s&&null!==s&&!(s instanceof RegExp)}function Zg(s,i){if(!PS(s)||!PS(i)||Array.isArray(s)&&!Array.isArray(i)||!Array.isArray(s)&&Array.isArray(i))return i;if(Array.isArray(i)&&Array.isArray(s)){const r=[...s];for(let a=0;a<i.length;a++)r[a]=Zg(s[a],i[a]);return r}{const r=Ua({},s);for(const a in i)Object.prototype.hasOwnProperty.call(i,a)&&(r[a]=Object.prototype.hasOwnProperty.call(s,a)?Zg(s[a],i[a]):i[a]);return r}}let wL=1,Al=console;class Gn{static setLogger(i){Al=i}constructor(i){T(this,"lockingPromise",q.resolve()),T(this,"locks",0),T(this,"name",""),T(this,"lockId",void 0),this.lockId=wL++,i&&(this.name=i),Al.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(i){let r;this.locks+=1,Al.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat("string"==typeof i?i:""));const a=new q(d=>{r=()=>{this.locks-=1,Al.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat("string"==typeof i?i:"")),d()}}),l=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>a),l}}function jh(s,i){return function(r,a,l){const d=l.value;if("function"!=typeof d)throw new Error("Cannot use mutex on object property.");return l.value=x(function*(){const h=this[i];if(!h)throw new Error("mutex property key ".concat(i," doesn't exist on ").concat(s));const f=yield h.lock("From ".concat(s,".").concat(a));try{for(var m=arguments.length,g=new Array(m),E=0;E<m;E++)g[E]=arguments[E];return yield d.apply(this,g)}finally{f()}}),l}}const Wn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function eE(s,i){const r=Math.floor(i.timeout*Math.pow(i.timeoutFactor,s));return Math.min(i.maxRetryTimeout,r)}function Ss(s,i,r,a){const l=Object.assign({},Wn,a);let d=l.timeout;const h=function(){var g=x(function*(){var E;yield(E=d,new q(y=>{window.setTimeout(y,E)})),d*=l.timeoutFactor,d=Math.min(l.maxRetryTimeout,d)});return function(){return g.apply(this,arguments)}}();let f=!1;const m=new q(function(){var g=x(function*(E,y){i=i||(()=>!1),r=r||(()=>!0);for(let C=0;C<l.maxRetryCount;C+=1){if(f)return y(new ne(k.OPERATION_ABORTED));try{const b=yield s();if(!i(b,C)||C+1===l.maxRetryCount)return E(b);yield h()}catch(b){if(!r(b,C)||C+1===l.maxRetryCount)return y(b);yield h()}}});return function(E,y){return g.apply(this,arguments)}}());return m.cancel=()=>f=!0,m}var xA=go,FA=ko,AL=t0,UA=tt,DL=TypeError,VA=function(s){return function(i,r,a,l){xA(r);var d=FA(i),h=AL(d),f=UA(d),m=s?f-1:0,g=s?-1:1;if(a<2)for(;;){if(m in h){l=h[m],m+=g;break}if(m+=g,s?m<0:f<=m)throw DL("Reduce of empty array with no initial value")}for(;s?m>=0:f>m;m+=g)m in h&&(l=r(l,h[m],m,d));return l}},zV=[VA(!1),VA(!0)][0];Tn({target:"Array",proto:!0,forced:!Nh&&mo>79&&mo<83||!Md("reduce")},{reduce:function(s){var i=arguments.length;return zV(this,s,i,i>1?arguments[1]:void 0)}});var YV=Ee("Array").reduce,$V=js,JV=YV,tE=Array.prototype,Ba=wr(function(s){var i=s.reduce;return s===tE||$V(tE,s)&&i===tE.reduce?JV:i});let MS=class{constructor(s){T(this,"input",[]),T(this,"size",void 0),this.size=s}add(s){this.input.push(s),this.input.length>this.size&&this.input.splice(0,1)}mean(){var s;return 0===this.input.length?0:Ba(s=this.input).call(s,(i,r)=>i+r)/this.input.length}};var kS,nE={exports:{}},Hh=function(s,i){return function(){for(var r=new Array(arguments.length),a=0;a<r.length;a++)r[a]=arguments[a];return s.apply(i,r)}},OL=Hh,LS=Object.prototype.toString,xS=(kS=Object.create(null),function(s){var i=LS.call(s);return kS[i]||(kS[i]=i.slice(8,-1).toLowerCase())});function eu(s){return s=s.toLowerCase(),function(i){return xS(i)===s}}function FS(s){return Array.isArray(s)}function f_(s){return void 0===s}var BA=eu("ArrayBuffer");function jA(s){return null!==s&&"object"==typeof s}function wc(s){if("object"!==xS(s))return!1;var i=Object.getPrototypeOf(s);return null===i||i===Object.prototype}var NL=eu("Date"),HA=eu("File"),PL=eu("Blob"),GA=eu("FileList");function US(s){return"[object Function]"===LS.call(s)}var WA=eu("URLSearchParams");function VS(s,i){if(null!=s)if("object"!=typeof s&&(s=[s]),FS(s))for(var r=0,a=s.length;r<a;r++)i.call(null,s[r],r,s);else for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&i.call(null,s[l],l,s)}var __,ML=(__="undefined"!=typeof Uint8Array&&Object.getPrototypeOf(Uint8Array),function(s){return __&&s instanceof __}),fr={isArray:FS,isArrayBuffer:BA,isBuffer:function(s){return null!==s&&!f_(s)&&null!==s.constructor&&!f_(s.constructor)&&"function"==typeof s.constructor.isBuffer&&s.constructor.isBuffer(s)},isFormData:function(s){var i="[object FormData]";return s&&("function"==typeof FormData&&s instanceof FormData||LS.call(s)===i||US(s.toString)&&s.toString()===i)},isArrayBufferView:function(s){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(s):s&&s.buffer&&BA(s.buffer)},isString:function(s){return"string"==typeof s},isNumber:function(s){return"number"==typeof s},isObject:jA,isPlainObject:wc,isUndefined:f_,isDate:NL,isFile:HA,isBlob:PL,isFunction:US,isStream:function(s){return jA(s)&&US(s.pipe)},isURLSearchParams:WA,isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:VS,merge:function s(){var i={};function r(d,h){i[h]=wc(i[h])&&wc(d)?s(i[h],d):wc(d)?s({},d):FS(d)?d.slice():d}for(var a=0,l=arguments.length;a<l;a++)VS(arguments[a],r);return i},extend:function(s,i,r){return VS(i,function(a,l){s[l]=r&&"function"==typeof a?OL(a,r):a}),s},trim:function(s){return s.trim?s.trim():s.replace(/^\s+|\s+$/g,"")},stripBOM:function(s){return 65279===s.charCodeAt(0)&&(s=s.slice(1)),s},inherits:function(s,i,r,a){s.prototype=Object.create(i.prototype,a),s.prototype.constructor=s,r&&Object.assign(s.prototype,r)},toFlatObject:function(s,i,r){var a,l,d,h={};i=i||{};do{for(l=(a=Object.getOwnPropertyNames(s)).length;l-- >0;)h[d=a[l]]||(i[d]=s[d],h[d]=!0);s=Object.getPrototypeOf(s)}while(s&&(!r||r(s,i))&&s!==Object.prototype);return i},kindOf:xS,kindOfTest:eu,endsWith:function(s,i,r){s=String(s),(void 0===r||r>s.length)&&(r=s.length);var a=s.indexOf(i,r-=i.length);return-1!==a&&a===r},toArray:function(s){if(!s)return null;var i=s.length;if(f_(i))return null;for(var r=new Array(i);i-- >0;)r[i]=s[i];return r},isTypedArray:ML,isFileList:GA},tu=fr;function KA(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var qA=function(s,i,r){if(!i)return s;var a;if(r)a=r(i);else if(tu.isURLSearchParams(i))a=i.toString();else{var l=[];tu.forEach(i,function(h,f){null!=h&&(tu.isArray(h)?f+="[]":h=[h],tu.forEach(h,function(m){tu.isDate(m)?m=m.toISOString():tu.isObject(m)&&(m=JSON.stringify(m)),l.push(KA(f)+"="+KA(m))}))}),a=l.join("&")}if(a){var d=s.indexOf("#");-1!==d&&(s=s.slice(0,d)),s+=(-1===s.indexOf("?")?"?":"&")+a}return s},kL=fr;function Gh(){this.handlers=[]}Gh.prototype.use=function(s,i,r){return this.handlers.push({fulfilled:s,rejected:i,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},Gh.prototype.eject=function(s){this.handlers[s]&&(this.handlers[s]=null)},Gh.prototype.forEach=function(s){kL.forEach(this.handlers,function(i){null!==i&&s(i)})};var zA,BS,LL=Gh,xL=fr;function Wh(){if(BS)return zA;BS=1;var s=fr;function i(l,d,h,f,m){Error.call(this),this.message=l,this.name="AxiosError",d&&(this.code=d),h&&(this.config=h),f&&(this.request=f),m&&(this.response=m)}s.inherits(i,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var r=i.prototype,a={};return["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(l){a[l]={value:l}}),Object.defineProperties(i,a),Object.defineProperty(r,"isAxiosError",{value:!0}),i.from=function(l,d,h,f,m,g){var E=Object.create(r);return s.toFlatObject(l,E,function(y){return y!==Error.prototype}),i.call(E,l.message,d,h,f,m),E.name=l.name,g&&Object.assign(E,g),E},zA=i}var jS,YA,$A,JA,HS,GS,WS={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};function XA(){if(YA)return jS;YA=1;var s=fr;return jS=function(i,r){r=r||new FormData;var a=[];function l(d){return null===d?"":s.isDate(d)?d.toISOString():s.isArrayBuffer(d)||s.isTypedArray(d)?"function"==typeof Blob?new Blob([d]):Buffer.from(d):d}return function d(h,f){if(s.isPlainObject(h)||s.isArray(h)){if(-1!==a.indexOf(h))throw Error("Circular reference detected in "+f);a.push(h),s.forEach(h,function(m,g){if(!s.isUndefined(m)){var E,y=f?f+"."+g:g;if(m&&!f&&"object"==typeof m)if(s.endsWith(g,"{}"))m=JSON.stringify(m);else if(s.endsWith(g,"[]")&&(E=s.toArray(m)))return void E.forEach(function(C){!s.isUndefined(C)&&r.append(y,l(C))});d(m,y)}}),a.pop()}else r.append(f,l(h))}(i),r}}var KS,ZA,eD,iE,rE,qS,oE,tD,zS,sE,nD,Gt,YS=function(s,i){return s&&!function(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}(i)?function(s,i){return i?s.replace(/\/+$/,"")+"/"+i.replace(/^\/+/,""):s}(s,i):i};function aE(){if(qS)return rE;qS=1;var s=Wh();function i(r){s.call(this,null==r?"canceled":r,s.ERR_CANCELED),this.name="CanceledError"}return fr.inherits(i,s,{__CANCEL__:!0}),rE=i}var qi=fr,m_=function(s,i){xL.forEach(s,function(r,a){a!==i&&a.toUpperCase()===i.toUpperCase()&&(s[i]=r,delete s[a])})},oD=Wh(),Kh=WS,VL=XA(),ZV={"Content-Type":"application/x-www-form-urlencoded"};function sD(s,i){!qi.isUndefined(s)&&qi.isUndefined(s["Content-Type"])&&(s["Content-Type"]=i)}var Ot,g_={transitional:Kh,adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(Ot=function(){if(sE)return zS;sE=1;var s=fr,i=function(){if(JA)return $A;JA=1;var s=Wh();return $A=function(i,r,a){var l=a.config.validateStatus;a.status&&l&&!l(a.status)?r(new s("Request failed with status code "+a.status,[s.ERR_BAD_REQUEST,s.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a)):i(a)}}(),r=function(){if(GS)return HS;GS=1;var s=fr;return HS=s.isStandardBrowserEnv()?{write:function(i,r,a,l,d,h){var f=[];f.push(i+"="+encodeURIComponent(r)),s.isNumber(a)&&f.push("expires="+new Date(a).toGMTString()),s.isString(l)&&f.push("path="+l),s.isString(d)&&f.push("domain="+d),!0===h&&f.push("secure"),document.cookie=f.join("; ")},read:function(i){var r=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove:function(i){this.write(i,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}}(),a=qA,l=YS,d=function(){if(ZA)return KS;ZA=1;var s=fr,i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return KS=function(r){var a,l,d,h={};return r&&s.forEach(r.split("\n"),function(f){if(d=f.indexOf(":"),a=s.trim(f.substr(0,d)).toLowerCase(),l=s.trim(f.substr(d+1)),a){if(h[a]&&i.indexOf(a)>=0)return;h[a]="set-cookie"===a?(h[a]?h[a]:[]).concat([l]):h[a]?h[a]+", "+l:l}}),h}}(),h=function(){if(iE)return eD;iE=1;var s=fr;return eD=s.isStandardBrowserEnv()?function(){var i,r=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement("a");function l(d){var h=d;return r&&(a.setAttribute("href",h),h=a.href),a.setAttribute("href",h),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,""):"",host:a.host,search:a.search?a.search.replace(/^\?/,""):"",hash:a.hash?a.hash.replace(/^#/,""):"",hostname:a.hostname,port:a.port,pathname:"/"===a.pathname.charAt(0)?a.pathname:"/"+a.pathname}}return i=l(window.location.href),function(d){var h=s.isString(d)?l(d):d;return h.protocol===i.protocol&&h.host===i.host}}():function(){return!0}}(),f=WS,m=Wh(),g=aE(),E=(tD||(tD=1,oE=function(s){var i=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return i&&i[1]||""}),oE);return zS=function(y){return new Promise(function(C,b){var O,P=y.data,D=y.headers,L=y.responseType;function B(){y.cancelToken&&y.cancelToken.unsubscribe(O),y.signal&&y.signal.removeEventListener("abort",O)}s.isFormData(P)&&s.isStandardBrowserEnv()&&delete D["Content-Type"];var V=new XMLHttpRequest;if(y.auth){var J=y.auth.username||"",ae=y.auth.password?unescape(encodeURIComponent(y.auth.password)):"";D.Authorization="Basic "+btoa(J+":"+ae)}var z=l(y.baseURL,y.url);function Q(){if(V){var Ce="getAllResponseHeaders"in V?d(V.getAllResponseHeaders()):null;i(function(He){C(He),B()},function(He){b(He),B()},{data:L&&"text"!==L&&"json"!==L?V.response:V.responseText,status:V.status,statusText:V.statusText,headers:Ce,config:y,request:V}),V=null}}if(V.open(y.method.toUpperCase(),a(z,y.params,y.paramsSerializer),!0),V.timeout=y.timeout,"onloadend"in V?V.onloadend=Q:V.onreadystatechange=function(){V&&4===V.readyState&&(0!==V.status||V.responseURL&&0===V.responseURL.indexOf("file:"))&&setTimeout(Q)},V.onabort=function(){V&&(b(new m("Request aborted",m.ECONNABORTED,y,V)),V=null)},V.onerror=function(){b(new m("Network Error",m.ERR_NETWORK,y,V,V)),V=null},V.ontimeout=function(){var Ce=y.timeout?"timeout of "+y.timeout+"ms exceeded":"timeout exceeded";y.timeoutErrorMessage&&(Ce=y.timeoutErrorMessage),b(new m(Ce,(y.transitional||f).clarifyTimeoutError?m.ETIMEDOUT:m.ECONNABORTED,y,V)),V=null},s.isStandardBrowserEnv()){var X=(y.withCredentials||h(z))&&y.xsrfCookieName?r.read(y.xsrfCookieName):void 0;X&&(D[y.xsrfHeaderName]=X)}"setRequestHeader"in V&&s.forEach(D,function(Ce,Se){void 0===P&&"content-type"===Se.toLowerCase()?delete D[Se]:V.setRequestHeader(Se,Ce)}),s.isUndefined(y.withCredentials)||(V.withCredentials=!!y.withCredentials),L&&"json"!==L&&(V.responseType=y.responseType),"function"==typeof y.onDownloadProgress&&V.addEventListener("progress",y.onDownloadProgress),"function"==typeof y.onUploadProgress&&V.upload&&V.upload.addEventListener("progress",y.onUploadProgress),(y.cancelToken||y.signal)&&(O=function(Ce){V&&(b(!Ce||Ce&&Ce.type?new g:Ce),V.abort(),V=null)},y.cancelToken&&y.cancelToken.subscribe(O),y.signal&&(y.signal.aborted?O():y.signal.addEventListener("abort",O))),P||(P=null);var te=E(z);te&&-1===["http","https","file"].indexOf(te)?b(new m("Unsupported protocol "+te+":",m.ERR_BAD_REQUEST,y)):V.send(P)})}}()),Ot),transformRequest:[function(s,i){if(m_(i,"Accept"),m_(i,"Content-Type"),qi.isFormData(s)||qi.isArrayBuffer(s)||qi.isBuffer(s)||qi.isStream(s)||qi.isFile(s)||qi.isBlob(s))return s;if(qi.isArrayBufferView(s))return s.buffer;if(qi.isURLSearchParams(s))return sD(i,"application/x-www-form-urlencoded;charset=utf-8"),s.toString();var r,a=qi.isObject(s),l=i&&i["Content-Type"];if((r=qi.isFileList(s))||a&&"multipart/form-data"===l){var d=this.env&&this.env.FormData;return VL(r?{"files[]":s}:s,d&&new d)}return a||"application/json"===l?(sD(i,"application/json"),function(h,f,m){if(qi.isString(h))try{return(0,JSON.parse)(h),qi.trim(h)}catch(g){if("SyntaxError"!==g.name)throw g}return(0,JSON.stringify)(h)}(s)):s}],transformResponse:[function(s){var i=this.transitional||g_.transitional,l=!(i&&i.silentJSONParsing)&&"json"===this.responseType;if(l||i&&i.forcedJSONParsing&&qi.isString(s)&&s.length)try{return JSON.parse(s)}catch(d){if(l)throw"SyntaxError"===d.name?oD.from(d,oD.ERR_BAD_RESPONSE,this,null,this.response):d}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Gt?nD:(Gt=1,nD=null)},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};qi.forEach(["delete","get","head"],function(s){g_.headers[s]={}}),qi.forEach(["post","put","patch"],function(s){g_.headers[s]=qi.merge(ZV)});var BL,Dl,Ts=g_,jL=fr,e3=Ts;function aD(){return Dl?BL:(Dl=1,BL=function(s){return!(!s||!s.__CANCEL__)})}var cD=fr,$S=function(s,i,r){var a=this||e3;return jL.forEach(r,function(l){s=l.call(a,s,i)}),s},JS=aD(),Ol=Ts,lD=aE();function cE(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new lD}var dD,HL,qo=fr,uD=function(s,i){i=i||{};var r={};function a(g,E){return qo.isPlainObject(g)&&qo.isPlainObject(E)?qo.merge(g,E):qo.isPlainObject(E)?qo.merge({},E):qo.isArray(E)?E.slice():E}function l(g){return qo.isUndefined(i[g])?qo.isUndefined(s[g])?void 0:a(void 0,s[g]):a(s[g],i[g])}function d(g){if(!qo.isUndefined(i[g]))return a(void 0,i[g])}function h(g){return qo.isUndefined(i[g])?qo.isUndefined(s[g])?void 0:a(void 0,s[g]):a(void 0,i[g])}function f(g){return g in i?a(s[g],i[g]):g in s?a(void 0,s[g]):void 0}var m={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:f};return qo.forEach(Object.keys(s).concat(Object.keys(i)),function(g){var E=m[g]||l,y=E(g);qo.isUndefined(y)&&E!==f||(r[g]=y)}),r};function hD(){return HL?dD:(HL=1,dD={version:"0.27.2"})}var pD=hD().version,Ac=Wh(),lE={};["object","boolean","number","function","string","symbol"].forEach(function(s,i){lE[s]=function(r){return typeof r===s||"a"+(i<1?"n ":" ")+s}});var fD={};lE.transitional=function(s,i,r){function a(l,d){return"[Axios v"+pD+"] Transitional option '"+l+"'"+d+(r?". "+r:"")}return function(l,d,h){if(!1===s)throw new Ac(a(d," has been removed"+(i?" in "+i:"")),Ac.ERR_DEPRECATED);return i&&!fD[d]&&(fD[d]=!0,console.warn(a(d," has been deprecated since v"+i+" and will be removed in the near future"))),!s||s(l,d,h)}};var _D,XS,nu,mD,QS,iu,qh=fr,GL=qA,gD=LL,WL=function(s){return cE(s),s.headers=s.headers||{},s.data=$S.call(s,s.data,s.headers,s.transformRequest),s.headers=cD.merge(s.headers.common||{},s.headers[s.method]||{},s.headers),cD.forEach(["delete","get","head","post","put","patch","common"],function(i){delete s.headers[i]}),(s.adapter||Ol.adapter)(s).then(function(i){return cE(s),i.data=$S.call(s,i.data,i.headers,s.transformResponse),i},function(i){return JS(i)||(cE(s),i&&i.response&&(i.response.data=$S.call(s,i.response.data,i.response.headers,s.transformResponse))),Promise.reject(i)})},uE=uD,zo=YS,ED={assertOptions:function(s,i,r){if("object"!=typeof s)throw new Ac("options must be an object",Ac.ERR_BAD_OPTION_VALUE);for(var a=Object.keys(s),l=a.length;l-- >0;){var d=a[l],h=i[d];if(h){var f=s[d],m=void 0===f||h(f,d,s);if(!0!==m)throw new Ac("option "+d+" must be "+m,Ac.ERR_BAD_OPTION_VALUE)}else if(!0!==r)throw new Ac("Unknown option "+d,Ac.ERR_BAD_OPTION)}},validators:lE},zh=ED.validators;function Yh(s){this.defaults=s,this.interceptors={request:new gD,response:new gD}}Yh.prototype.request=function(s,i){"string"==typeof s?(i=i||{}).url=s:i=s||{},i.method=(i=uE(this.defaults,i)).method?i.method.toLowerCase():this.defaults.method?this.defaults.method.toLowerCase():"get";var r=i.transitional;void 0!==r&&ED.assertOptions(r,{silentJSONParsing:zh.transitional(zh.boolean),forcedJSONParsing:zh.transitional(zh.boolean),clarifyTimeoutError:zh.transitional(zh.boolean)},!1);var a=[],l=!0;this.interceptors.request.forEach(function(y){"function"==typeof y.runWhen&&!1===y.runWhen(i)||(l=l&&y.synchronous,a.unshift(y.fulfilled,y.rejected))});var d,h=[];if(this.interceptors.response.forEach(function(y){h.push(y.fulfilled,y.rejected)}),!l){var f=[WL,void 0];for(Array.prototype.unshift.apply(f,a),f=f.concat(h),d=Promise.resolve(i);f.length;)d=d.then(f.shift(),f.shift());return d}for(var m=i;a.length;){var g=a.shift(),E=a.shift();try{m=g(m)}catch(y){E(y);break}}try{d=WL(m)}catch(y){return Promise.reject(y)}for(;h.length;)d=d.then(h.shift(),h.shift());return d},Yh.prototype.getUri=function(s){s=uE(this.defaults,s);var i=zo(s.baseURL,s.url);return GL(i,s.params,s.paramsSerializer)},qh.forEach(["delete","get","head","options"],function(s){Yh.prototype[s]=function(i,r){return this.request(uE(r||{},{method:s,url:i,data:(r||{}).data}))}}),qh.forEach(["post","put","patch"],function(s){function i(r){return function(a,l,d){return this.request(uE(d||{},{method:s,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:l}))}}Yh.prototype[s]=i(),Yh.prototype[s+"Form"]=i(!0)});var yD=fr,KL=Hh,hE=Yh,qL=uD,Yo=function s(i){var r=new hE(i),a=KL(hE.prototype.request,r);return yD.extend(a,hE.prototype,r),yD.extend(a,r),a.create=function(l){return s(qL(i,l))},a}(Ts);Yo.Axios=hE,Yo.CanceledError=aE(),Yo.CancelToken=function(){if(XS)return _D;XS=1;var s=aE();function i(r){if("function"!=typeof r)throw new TypeError("executor must be a function.");var a;this.promise=new Promise(function(d){a=d});var l=this;this.promise.then(function(d){if(l._listeners){var h,f=l._listeners.length;for(h=0;h<f;h++)l._listeners[h](d);l._listeners=null}}),this.promise.then=function(d){var h,f=new Promise(function(m){l.subscribe(m),h=m}).then(d);return f.cancel=function(){l.unsubscribe(h)},f},r(function(d){l.reason||(l.reason=new s(d),a(l.reason))})}return i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.prototype.subscribe=function(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]},i.prototype.unsubscribe=function(r){if(this._listeners){var a=this._listeners.indexOf(r);-1!==a&&this._listeners.splice(a,1)}},i.source=function(){var r;return{token:new i(function(a){r=a}),cancel:r}},_D=i}(),Yo.isCancel=aD(),Yo.VERSION=hD().version,Yo.toFormData=XA(),Yo.AxiosError=Wh(),Yo.Cancel=Yo.CanceledError,Yo.all=function(s){return Promise.all(s)},Yo.spread=mD?nu:(mD=1,nu=function(s){return function(i){return s.apply(null,i)}}),Yo.isAxiosError=function(){if(iu)return QS;iu=1;var s=fr;return QS=function(i){return s.isObject(i)&&!0===i.isAxiosError}}(),nE.exports=Yo,nE.exports.default=Yo;var Gr=wr(nE.exports);function $o(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function vD(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?$o(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):$o(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}let pE,fE=0,$h=0;function bs(s,i,r,a){return new q((l,d)=>{i.responseType=i.responseType||"json",i.data&&!r?(i.data=JSON.stringify(i.data),fE+=Va(i.data)):r&&(i.data.size?fE+=i.data.size:i.data instanceof FormData?fE+=LA(i.data):fE+=Va(JSON.stringify(i.data))),i.headers=i.headers||{},i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json",i.method="POST",i.url=s,Gr.request(i).then(h=>{"string"==typeof h.data?$h+=Va(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?$h+=h.data.byteLength:$h+=Va(JSON.stringify(h.data)),a&&l({data:h.data,headers:h.headers}),l(h.data)}).catch(h=>{Gr.isCancel(h)?d(new ne(k.OPERATION_ABORTED,"cancel token canceled")):d("ECONNABORTED"===h.code?new ne(k.NETWORK_TIMEOUT,h.message):h.response?new ne(k.NETWORK_RESPONSE_ERROR,h.response.status):new ne(k.NETWORK_ERROR,h.message))})})}function CD(s,i){return ZS.apply(this,arguments)}function ZS(){return ZS=x(function*(s,i){const r=new Blob([i.data],{type:"buffer"});return yield bs(s,vD(vD({},i),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}),ZS.apply(this,arguments)}const SD=()=>void 0!==window.isSecureContext;function _r(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function be(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?_r(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):_r(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}var Qe;!function(s){s.SET_SESSION_ID="SET_SESSION_ID",s.SET_P2P_ID="SET_P2P_id",s.SET_DC_ID="SET_DC_id",s.SET_UID="SET_UID",s.SET_PUB_ID="SET_PUB_ID",s.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",s.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",s.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",s.AVOID_JOIN_START="AVOID_JOIN_START",s.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",s.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",s.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",s.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",s.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",s.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",s.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",s.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",s.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",s.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",s.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",s.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",s.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",s.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",s.RESET_KEY_METRICS="RESET_KEY_METRICS",s.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",s.SET_USE_P2P="SET_USE_P2P"}(Qe||(Qe={}));class TD{constructor(i,r,a,l){T(this,"state",void 0),this.state={codec:i,audioCodec:r,mode:a,clientId:l,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1}}dispatch(i){this.state=function(r,a){switch(a.type){case Qe.SET_SESSION_ID:return be(be({},r),{},{sessionId:a.sessionId});case Qe.SET_P2P_ID:return be(be({},r),{},{p2pId:a.p2pId});case Qe.SET_UID:return be(be({},r),{},{uid:a.uid});case Qe.SET_PUB_ID:return be(be({},r),{},{pubId:a.pubId});case Qe.KEY_METRIC_CLIENT_CREATED:return be(be({},r),{},{keyMetrics:be(be({},r.keyMetrics),{},{clientCreated:a.metric})});case Qe.KEY_METRIC_JOIN_START:return be(be({},r),{},{keyMetrics:be(be({},r.keyMetrics),{},{joinStart:a.metric})});case Qe.AVOID_JOIN_START:return be(be({},r),{},{avoidJoinStart:a.avoidJoinStart});case Qe.KEY_METRIC_JOIN_END:return be(be({},r),{},{keyMetrics:be(be({},r.keyMetrics),{},{joinEnd:a.metric})});case Qe.KEY_METRIC_REQUEST_AP_START:return be(be({},r),{},{keyMetrics:be(be({},r.keyMetrics),{},{requestAPStart:a.metric})});case Qe.KEY_METRIC_REQUEST_AP_END:return be(be({},r),{},{keyMetrics:be(be({},r.keyMetrics),{},{requestAPEnd:a.metric})});case Qe.KEY_METRIC_JOIN_GATEWAY_START:return be(be({},r),{},{keyMetrics:be(be({},r.keyMetrics),{},{joinGatewayStart:a.metric})});case Qe.KEY_METRIC_JOIN_GATEWAY_END:return be(be({},r),{},{keyMetrics:be(be({},r.keyMetrics),{},{joinGatewayEnd:a.metric})});case Qe.KEY_METRIC_PEER_CONNECTION_START:return be(be({},r),{},{keyMetrics:be(be({},r.keyMetrics),{},{peerConnectionStart:a.metric})});case Qe.KEY_METRIC_PEER_CONNECTION_END:return be(be({},r),{},{keyMetrics:be(be({},r.keyMetrics),{},{peerConnectionEnd:a.metric})});case Qe.KEY_METRIC_DESCRIPTION_START:return be(be({},r),{},{keyMetrics:be(be({},r.keyMetrics),{},{descriptionStart:a.metric})});case Qe.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return be(be({},r),{},{keyMetrics:be(be({},r.keyMetrics),{},{signalChannelOpen:a.metric})});case Qe.KEY_METRIC_ICE_CONNECTION_END:return be(be({},r),{},{keyMetrics:be(be({},r.keyMetrics),{},{iceConnectionEnd:a.metric})});case Qe.KEY_METRIC_PUBLISH:{const l=r.keyMetrics.publish,d=l.findIndex(h=>h.trackId===a.metric.trackId);return-1!==d?(l[d]=be(be({},l[d]),a.metric),be(be({},r),{},{keyMetrics:be(be({},r.keyMetrics),{},{publish:[...l]})})):be(be({},r),{},{keyMetrics:be(be({},r.keyMetrics),{},{publish:[...r.keyMetrics.publish,a.metric]})})}case Qe.KEY_METRIC_SUBSCRIBE:{const l=r.keyMetrics.subscribe,d=l.findIndex(h=>h.userId===a.metric.userId&&h.type===a.metric.type);return-1!==d?(l[d]=be(be({},l[d]),a.metric),be(be({},r),{},{keyMetrics:be(be({},r.keyMetrics),{},{subscribe:[...l]})})):be(be({},r),{},{keyMetrics:be(be({},r.keyMetrics),{},{subscribe:[...r.keyMetrics.subscribe,a.metric]})})}case Qe.SET_CLOUD_PROXY_SERVER_MODE:return r.cloudProxyServerMode=a.mode,r;case Qe.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof a.index?r.joinChannelServiceRecords=[...r.joinChannelServiceRecords,a.record]:(r.joinChannelServiceRecords[a.index]=be(be({},r.joinChannelServiceRecords[a.index]),a.record),r.joinChannelServiceRecords=[...r.joinChannelServiceRecords]),r;case Qe.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return r.joinChannelServiceRecords=[],r;case Qe.RESET_KEY_METRICS:return r.keyMetrics={publish:[],subscribe:[]},r;case Qe.SET_USE_DATACHANNEL:return be(be({},r),{},{useDataChannel:a.val});case Qe.SET_USE_P2P:return be(be({},r),{},{useP2P:a.val});default:return r}}(this.state,i)}set sessionId(i){this.dispatch({type:Qe.SET_SESSION_ID,sessionId:i})}get sessionId(){return this.state.sessionId}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(i){this.dispatch({type:Qe.SET_P2P_ID,p2pId:i})}get p2pId(){return this.state.p2pId}set dcId(i){this.dispatch({type:Qe.SET_DC_ID,dcId:i})}get dcId(){return this.state.dcId}set uid(i){this.dispatch({type:Qe.SET_UID,uid:i})}get uid(){return this.state.uid}set pubId(i){this.dispatch({type:Qe.SET_PUB_ID,pubId:i})}get pubId(){return this.state.pubId}set cloudProxyServerMode(i){this.dispatch({type:Qe.SET_CLOUD_PROXY_SERVER_MODE,mode:i})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(i){this.dispatch({type:Qe.SET_USE_DATACHANNEL,val:i})}get useDataChannel(){return this.state.useDataChannel}set useP2P(i){this.dispatch({type:Qe.SET_USE_P2P,val:i})}get useP2P(){return this.state.useP2P}clientCreated(){this.dispatch({type:Qe.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Qe.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Qe.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Qe.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Qe.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Qe.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Qe.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Qe.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Qe.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Qe.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Qe.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Qe.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(i,r,a,l){this.dispatch({type:Qe.KEY_METRIC_PUBLISH,metric:be(be({trackId:i,type:r},a&&{publishStart:a}),l&&{publishEnd:l})})}subscribe(i,r,a,l,d,h,f){this.dispatch({type:Qe.KEY_METRIC_SUBSCRIBE,metric:be(be(be(be(be({userId:i,type:r},a&&{subscribeStart:a}),l&&{subscribeEnd:l}),d&&{firstFrame:d}),h&&{streamAdded:h}),f&&{firstDecoded:f})})}massSubscribe(i,r,a,l){i.forEach(d=>{this.dispatch({type:Qe.KEY_METRIC_SUBSCRIBE,metric:be(be(be({userId:d.userId,type:d.type},r&&{subscribeStart:r}),a&&{subscribeEnd:a}),l&&{firstFrame:l})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(i,r){"gateway"===i.service&&Array.isArray(i.urls)&&(i.urls=i.urls.map(a=>a.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return"number"!=typeof r?(this.dispatch({type:Qe.RECORD_JOIN_CHANNEL_SERVICE,record:be(be({},i),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(r<0||r>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Qe.RECORD_JOIN_CHANNEL_SERVICE,record:i,index:r}),r)}catch(a){return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Qe.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Qe.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch(i){return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(i){this.dispatch({type:Qe.AVOID_JOIN_START,avoidJoinStart:i})}}const yo=function(s){if(s.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return s;const i=s.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(i&&i[1]&&i[2]){const l=i[2];return"".concat(i[1],".").concat(l)}const r=s.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(r&&r[1]&&r[2]){const l=r[2];return"".concat(r[1],".").concat(100*(Number(l)+1))}return"4.0.0.999"}("4.19.1"),E_=function(){try{return!0===JSON.parse("true")}catch(s){return!0}}(),_E="v4.19.1-0-g605286cc(10/11/2023, 2:37:03 PM)",ir={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,RTM2_FLAG:void 0,AP_RTM:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,USE_XR:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:1e4,P2P:!1,SHOW_P2P_LOG:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0}};function Bt(s,i,r){var a,l;we(a=Object.keys(ir)).call(a,s)&&(!r&&we(l=Object.keys(Dc)).call(l,s)||(ir[s]=i))}function H(s){return ir[s]}const Dc={},mE=new class extends nn{reportLogUploadError(s){this.emit("REPORT_LOG_UPLOAD",s)}};class bD{constructor(i){T(this,"logger",void 0),T(this,"prefixLists",[]),this.logger=i}debug(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];this.logger.debug(...this.prefixLists,...r)}info(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];this.logger.info(...this.prefixLists,...r)}warning(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];this.logger.warning(...this.prefixLists,...r)}error(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];this.logger.error(...this.prefixLists,...r)}prefix(i){return this.prefixLists.push(i),this}popPrefix(){return this.prefixLists.pop(),this}}function Jh(){const s=new Date;return s.toTimeString().split(" ")[0]+":"+s.getMilliseconds()}function y_(){const s=new Date,i=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return i?(null==i?void 0:i[0])+":"+s.getUTCMilliseconds():s.toTimeString().split(" ")[0]+":"+s.getMilliseconds()}const Rs={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Nl=Date.now(),pn=s=>{for(const i in Rs)if(Object.prototype.hasOwnProperty.call(Rs,i)&&Rs[i]===s)return i;return"DEFAULT"},R=new class{constructor(){T(this,"proxyServerURL",void 0),T(this,"logLevel",Rs.DEBUG),T(this,"uploadState","collecting"),T(this,"uploadLogWaitingList",[]),T(this,"uploadLogUploadingList",[]),T(this,"uploadErrorCount",0),T(this,"currentLogID",0),T(this,"url",void 0),T(this,"extLog",(s,i)=>{this.appendLogToWaitingList(s,...i)})}debug(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];const a=[Rs.DEBUG].concat(i);this.log.apply(this,a)}info(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];const a=[Rs.INFO].concat(i);this.log.apply(this,a)}warning(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];const a=[Rs.WARNING].concat(i);this.log.apply(this,a)}warn(){this.warning(...arguments)}error(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];const a=[Rs.ERROR].concat(i);this.log.apply(this,a)}upload(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];const a=[Rs.DEBUG].concat(i);this.uploadLog.apply(this,a)}setLogLevel(s){s=Math.min(Math.max(0,s),4),this.logLevel=s}enableLogUpload(){Bt("UPLOAD_LOG",!0)}disableLogUpload(){Bt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(s){this.proxyServerURL=s}prefix(s){return new bD(this).prefix(s)}log(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];if(Date.now()-Nl<100)return void setTimeout(()=>{this.log(...i)},Date.now()-Nl);const a=Math.max(0,Math.min(4,i[0]));if(i[0]=Jh()+" Agora-SDK [".concat(pn(a),"]:"),this.appendLogToWaitingList(a,...i),a<this.logLevel)return;const l=Jh()+" %cAgora-SDK [".concat(pn(a),"]:");let d=[];if(!H("USE_NEW_LOG"))switch(a){case Rs.DEBUG:d=[l,"color: #64B5F6;"].concat(i.slice(1)),console.log.apply(console,d);break;case Rs.INFO:d=[l,"color: #1E88E5; font-weight: bold;"].concat(i.slice(1)),console.log.apply(console,d);break;case Rs.WARNING:d=[l,"color: #FB8C00; font-weight: bold;"].concat(i.slice(1)),console.warn.apply(console,d);break;case Rs.ERROR:d=[l,"color: #B00020; font-weight: bold;"].concat(i.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];if(Date.now()-Nl<100)return void setTimeout(()=>{this.uploadLog(...i)},Date.now()-Nl);const a=Math.max(0,Math.min(4,i[0]));i[0]=Jh()+" Agora-SDK [".concat(pn(a),"]:"),this.appendLogToWaitingList(a,...i)}appendLogToWaitingList(s){if(!H("UPLOAD_LOG"))return;for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];Array.isArray(r[0])?r[0][0]=y_()+" Agora-SDK [".concat(pn(s),"]:"):r[0]=y_()+" Agora-SDK [".concat(pn(s),"]:");let l="";r.forEach(d=>{"object"==typeof d&&(d=JSON.stringify(d)),l+="".concat(d," ")}),this.uploadLogWaitingList.push({payload_str:l,log_level:s,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}uploadLogs(){var s=this;return x(function*(){const i=s.uploadLogUploadingList,r={sdk_version:yo,process_id:H("PROCESS_ID"),payload:JSON.stringify(i)};return Ss(x(function*(){const a=yield Gr.post(s.url||(s.proxyServerURL?"https://".concat(s.proxyServerURL,"/ls/?h=").concat(H("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(H("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if("OK"!==a.data){const l=new Error("unexpected upload log response");throw l.response=a,l}}),()=>(s.uploadLogUploadingList=[],!1),a=>(mE.reportLogUploadError(a.response?{status:a.response.status,data:a.response.data,headers:a.response.headers,message:a.message}:a.request?{status:a.request.status,message:a.message}:{status:-1,message:a.message}),!0),{timeout:H("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:H("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})})()}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,H("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),H("UPLOAD_LOG_INTERVAL"))}).catch(s=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),H("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),H("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var ru,Xh;function n3(s){return Vi(s.reportId,"params.reportId",0,100,!1),Vi(s.category,"params.category",0,100,!1),Vi(s.event,"params.event",0,100,!1),Vi(s.label,"params.label",0,100,!1),Ut(s.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(function(s){s.FREE="free",s.UPLOADING="uploading"})(ru||(ru={})),function(s){s[s.MISC=0]="MISC",s[s.INTERNAL_EVENT=1]="INTERNAL_EVENT",s[s.PUBLIC_EVENT=2]="PUBLIC_EVENT",s[s.WEB_EVENT=3]="WEB_EVENT",s[s.INTERNAL_API=4]="INTERNAL_API",s[s.WEB_API=5]="WEB_API",s[s.PUBLIC_API=6]="PUBLIC_API"}(Xh||(Xh={}));const Tt={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var rn,Xt,Pl,zL;function eT(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function qe(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?eT(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):eT(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}(function(s){s.PUBLISH="publish",s.SUBSCRIBE="subscribe",s.WS_COMPRESSOR_INIT="ws_compressor_init",s.SESSION_INIT="session_init",s.JOIN_CHOOSE_SERVER="join_choose_server",s.REQ_USER_ACCOUNT="req_user_account",s.JOIN_GATEWAY="join_gateway",s.REJOIN_GATEWAY="rejoin_gateway",s.STREAM_SWITCH="stream_switch",s.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",s.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",s.FIRST_VIDEO_RECEIVED="first_video_received",s.FIRST_AUDIO_RECEIVED="first_audio_received",s.FIRST_VIDEO_DECODE="first_video_decode",s.FIRST_AUDIO_DECODE="first_audio_decode",s.ON_ADD_AUDIO_STREAM="on_add_audio_stream",s.ON_ADD_VIDEO_STREAM="on_add_video_stream",s.ON_UPDATE_STREAM="on_update_stream",s.ON_REMOVE_STREAM="on_remove_stream",s.USER_ANALYTICS="req_user_analytics",s.PC_STATS="pc_stats"})(rn||(rn={})),function(s){s.SESSION="io.agora.pb.Wrtc.Session",s.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",s.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",s.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",s.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",s.PUBLISH="io.agora.pb.Wrtc.Publish",s.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",s.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",s.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",s.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",s.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",s.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",s.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",s.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",s.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",s.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",s.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",s.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",s.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",s.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",s.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",s.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",s.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",s.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",s.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",s.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",s.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",s.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",s.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",s.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",s.PC_STATS="io.agora.pb.Wrtc.PCStats"}(Xt||(Xt={})),function(s){s[s.WORKER_EVENT=156]="WORKER_EVENT",s[s.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(Pl||(Pl={})),function(s){s[s.SESSION=26]="SESSION",s[s.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",s[s.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",s[s.JOIN_GATEWAY=28]="JOIN_GATEWAY",s[s.PUBLISH=30]="PUBLISH",s[s.SUBSCRIBE=29]="SUBSCRIBE",s[s.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",s[s.STREAM_SWITCH=32]="STREAM_SWITCH",s[s.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",s[s.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",s[s.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",s[s.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",s[s.API_INVOKE=41]="API_INVOKE",s[s.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",s[s.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",s[s.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",s[s.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",s[s.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",s[s.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",s[s.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",s[s.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",s[s.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",s[s.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",s[s.WORKER_EVENT=156]="WORKER_EVENT",s[s.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",s[s.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",s[s.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",s[s.USER_ANALYTICS=1e4]="USER_ANALYTICS",s[s.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(zL||(zL={}));class gE{constructor(){var i=this;T(this,"baseInfoMap",new Map),T(this,"proxyServer",void 0),T(this,"eventUploadTimer",void 0),T(this,"setSessionIdTimer",void 0),T(this,"url",void 0),T(this,"backupUrl",void 0),T(this,"_appId",void 0),T(this,"keyEventUploadPendingItems",[]),T(this,"normalEventUploadPendingItems",[]),T(this,"apiInvokeUploadPendingItems",[]),T(this,"apiInvokeCount",0),T(this,"ltsList",[]),T(this,"lastSendNormalEventTime",Date.now()),T(this,"customReportCounterTimer",void 0),T(this,"customReportCount",0),T(this,"extApiInvoke",function(){var r=x(function*(a){for(const l of a){const d=qe(qe({},l),{},{sid:null,invokeId:++i.apiInvokeCount,tag:Kt.TRACER});i.sendApiInvoke(d)}});return function(a){return r.apply(this,arguments)}}()),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),H("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),H("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(i){return this.baseInfoMap.get(i)}adjustSessionStartTime(i){if(!this.baseInfoMap.has(i)&&!this.baseInfoMap.get(i))return void R.error("adjust session ".concat(i," start time, sid is not exist or info is undefined"));const r=this.baseInfoMap.get(i),a=Date.now(),l=r.startTime;r.startTime=a,R.debug("rewrite session ".concat(i," startTime: ").concat(a," , ").concat(a-l,"ms")),this.baseInfoMap.set(i,r)}setAppId(i){this._appId=i}reportApiInvoke(i,r,a){r.timeout=r.timeout||6e4,r.reportResult=void 0===r.reportResult||r.reportResult;const l=Date.now();this.apiInvokeCount+=1;const d=this.apiInvokeCount,h=()=>({tag:r.tag,invokeId:d,sid:i,name:r.name,apiInvokeTime:l,options:r.options,states:r.states||null}),f=!!H("SHOW_REPORT_INVOKER_LOG");f&&R.info("".concat(r.name," start"),r.options);let m=!1;si(r.timeout).then(()=>{m||(this.sendApiInvoke(qe(qe({},h()),{},{error:k.API_INVOKE_TIMEOUT,success:!1})),R.debug("".concat(r.name," timeout")))});const g=new ne(k.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:E=>{const y=()=>{if(m)throw g;return m=!0,this.sendApiInvoke(qe(qe({},h()),{},{success:!0},r.reportResult&&{result:E})),f&&R.info("".concat(r.name," onSuccess")),E};return a?NS(y,r.name+"Success",a,()=>m=!0):y()},onError:E=>{const y=()=>{if(m)throw E;m=!0,this.sendApiInvoke(qe(qe({},h()),{},{success:!1,error:E})),f&&R.info("".concat(r.name," onFailure"),E.toString())};return a?NS(y,r.name+"Error",a,()=>m=!0):y()}}}sessionInit(i,r){if(this.baseInfoMap.has(i))return;const a=Date.now(),l=this.createBaseInfo(i,a);l.cname=r.cname;const d=Object.assign({},{willUploadConsoleLog:H("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:E_?"global":"oversea",areas:H("AREAS")&&H("AREAS").join(",")},r.extend),h=Date.now(),f=qe(qe({},l),{},{eventType:rn.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,build:_E,lts:h,elapse:h-a,extend:JSON.stringify(d),mode:r.mode,process:H("PROCESS_ID"),appType:H("APP_TYPE"),success:!0,version:yo});this.send({type:Xt.SESSION,data:f},!0)}joinChooseServer(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now(),h=qe(qe({},l),{},{eventType:rn.JOIN_CHOOSE_SERVER,lts:d,eventElapse:d-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:d-a.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3});this.send({type:Xt.JOIN_CHOOSE_SERVER,data:h},!0)}reqUserAccount(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now(),h=qe(qe({},l),{},{eventType:rn.REQ_USER_ACCOUNT,lts:d,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:d-a.startTime,eventElapse:d-r.lts,extend:JSON.stringify(r.extend)});this.send({type:Xt.REQ_USER_ACCOUNT,data:h},!0)}joinGateway(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info;r.vid&&(l.vid=r.vid),l.uid=r.uid,l.cid=r.cid;const d=Date.now(),{firstSuccess:h,avoidJoinStartTime:f,isProxy:m,addr:g}=r,E=d-(h&&f?f:a.startTime),y=qe(qe({},l),{},{eventType:rn.JOIN_GATEWAY,lts:d,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,elapse:E,eventElapse:d-r.lts,firstSuccess:h,signalChannel:r.signalChannel}),C=y.success?1:0;if(r.succ&&(a.lastJoinSuccessTime=d),h)this.send({type:Xt.JOIN_GATEWAY,data:y},!0);else{let b;if(g)if(m){const P=g.match(/h=(\d{1,3}-){3}\d{1,3}/g),D=g.match(/p=[0-9]{1,6}/g);b={isSuccess:C,gatewayIp:P&&P.length?P[0].split("=")[1].replace(/-/g,"."):"",port:D&&D.length?D[0].split("=")[1]:"",isProxy:m?1:0}}else{const P=g.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),D=g.match(/(:|p=)[0-9]{1,6}/g);b={isSuccess:C,gatewayIp:P&&P.length?P[0].split("//")[1].replace(/-/g,"."):"",port:D&&D.length?D[0].split(/:|p=/g)[1]:"",isProxy:m?1:0}}else b={isSuccess:C,gatewayIp:"",port:"",isProxy:m?1:0};delete y.success,delete y.eventType,delete y.firstSuccess,y.vid=Number(y.vid);const O=Object.assign({},y,b,{eventType:rn.REJOIN_GATEWAY});this.send({type:Xt.RE_JOIN_GATEWAY,data:O},!0)}}joinChannelTimeout(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=Date.now(),d=qe(qe({},a.info),{},{lts:l,timeout:r,elapse:l-a.startTime});this.send({type:Xt.JOIN_CHANNEL_TIMEOUT,data:d},!0)}publish(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now(),h=qe(qe({},l),{},{eventType:rn.PUBLISH,lts:d,eventElapse:r.eventElapse,elapse:d-a.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:Xt.PUBLISH,data:h},!0)}subscribe(i,r,a){const l=this.baseInfoMap.get(i);if(!l)return;const d=l.info,h=Date.now(),f=qe(qe({},d),{},{eventType:rn.SUBSCRIBE,lts:h,eventElapse:r.eventElapse,elapse:h-l.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid},a&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof r.peerid?f.peerSuid=r.peerid:f.peer=r.peerid,this.send({type:Xt.SUBSCRIBE,data:f},!0)}wsCompressorInit(i){var r;const a=[...jr(r=this.baseInfoMap).call(r)],d=this.baseInfoMap.get(a.length?a[0]:"UnableToGetSid");if(!d)return;const h=d.info,f=Date.now(),m=qe(qe({},h),{},{eventType:rn.WS_COMPRESSOR_INIT,lts:f,eventElapse:i.eventElapse,elapse:f-d.startTime,status:i.status?1:2});this.send({type:Xt.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(i,r,a,l){const d=this.baseInfoMap.get(i);if(!d)return;const h=d.info,f=Date.now(),m=qe(qe(qe({},h),l),{},{elapse:f-d.startTime,eventType:r,lts:f,firstDecodeFrame:Math.max(f-d.startTime,0),apEnd:Math.max(l.apEnd-d.startTime,0),apStart:Math.max(l.apStart-d.startTime,0),joinGwEnd:Math.max(l.joinGwEnd-d.startTime,0),joinGwStart:Math.max(l.joinGwStart-d.startTime,0),pcEnd:Math.max(l.pcEnd-d.startTime,0),pcStart:Math.max(l.pcStart-d.startTime,0),subscriberEnd:Math.max(l.subscriberEnd-d.startTime,0),subscriberStart:Math.max(l.subscriberStart-d.startTime,0),videoAddNotify:Math.max(l.videoAddNotify-d.startTime,0)});this.send({type:a,data:m},!0)}firstRemoteFrame(i,r,a,l){const d=this.baseInfoMap.get(i);if(!d)return;const h=d.info,f=Date.now(),m=qe(qe(qe({},h),l),{},{elapse:f-d.startTime,eventType:r,lts:f});this.send({type:a,data:m},!0)}pcStats(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now(),h=qe(qe(qe({},l),r),{},{vid:void 0===l.vid?0:Number(l.vid),elapse:d-a.startTime,eventType:rn.PC_STATS,lts:d});this.send({type:Xt.PC_STATS,data:h},!0)}onGatewayStream(i,r,a,l){const d=this.baseInfoMap.get(i);if(!d)return;const h=d.info,f=Date.now(),m=qe(qe(qe({},h),l),{},{eventType:r,lts:f});this.send({type:a,data:m},!0)}streamSwitch(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now(),h=qe(qe({},l),{},{eventType:rn.STREAM_SWITCH,lts:d,isDual:r.isdual,elapse:d-a.startTime,success:r.succ});this.send({type:Xt.STREAM_SWITCH,data:h},!0)}requestProxyAppCenter(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now(),h=qe(qe({},l),{},{eventType:rn.REQUEST_PROXY_APPCENTER,lts:d,eventElapse:d-r.lts,elapse:d-a.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Xt.REQUEST_PROXY_APPCENTER,data:h},!0)}requestProxyWorkerManager(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now(),h=qe(qe({},l),{},{eventType:rn.REQUEST_PROXY_WORKER_MANAGER,lts:d,eventElapse:d-r.lts,elapse:d-a.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Xt.REQUEST_PROXY_WORKER_MANAGER,data:h},!0)}setProxyServer(i){this.proxyServer=i,R.debug(i?"reportProxyServerurl: ".concat(i):"disable reportProxyServerurl: ".concat(i))}peerPublishStatus(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now(),h=qe(qe({},l),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:d,elapse:d-a.startTime,joinChannelSuccessElapse:d-(a.lastJoinSuccessTime||d),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:Xt.PEER_PUBLISH_STATUS,data:h},!0)}workerEvent(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now();(function(f,m,g){const E=f[m];if(!E||"string"!=typeof E)return[f];f[m]="";const y=Va(JSON.stringify(f));let C=0;const b=[];let O=0;for(let P=0;P<E.length;P++)O+=E.charCodeAt(P)<=127?1:3,O<=1300-y||(b[b.length]=Ua(Ua({},f),{},{[m]:E.substring(C,P)}),C=P,O=E.charCodeAt(P)<=127?1:3);return C!==E.length-1&&(b[b.length]=Ua(Ua({},f),{},{[m]:E.substring(C)})),b})(qe(qe(qe({},l),r),{},{elapse:d-a.startTime,lts:d,productType:"WebRTC"}),"payload").forEach(f=>this.send({type:Xt.WORKER_EVENT,data:f},!0))}apworkerEvent(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now(),h=qe(qe(qe({},l),r),{},{elapse:d-a.startTime,lts:d});this.send({type:Xt.AP_WORKER_EVENT,data:h},!0)}joinWebProxyAP(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now(),h=qe(qe(qe({},l),r),{},{elapse:d-a.startTime,lts:d,extend:r.extend||void 0});this.send({type:Xt.JOIN_WEB_PROXY_AP,data:h},!0)}WebSocketQuit(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now(),h=qe(qe(qe({},l),r),{},{elapse:d-a.startTime,lts:d});this.send({type:Xt.WEBSOCKET_QUIT,data:h},!0)}sendCustomReportMessage(i,r){var a=this;return x(function*(){if(a.customReportCount+=r.length,a.customReportCount>H("CUSTOM_REPORT_LIMIT"))throw new ne(k.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);a.customReportCounterTimer||(a.customReportCounterTimer=window.setInterval(()=>{a.customReportCount=0},5e3));const l=Date.now(),d=r.map(h=>({type:Xt.USER_ANALYTICS,data:qe(qe({sid:i},h),{},{lts:l})}));try{H("NEW_REPORT_SERVER")?yield a.postDataToStatsCollector2(d):yield a.postDataToStatsCollector(d)}catch(h){throw R.error("send custom report message failed",h.toString()),new ne(k.CUSTOM_REPORT_SEND_FAILED,h.message)}})()}sendApiInvoke(i){const r=H("NOT_REPORT_EVENT");if(i.tag&&we(r)&&we(r).call(r,i.tag))return!1;if(null===i.sid)return this.apiInvokeUploadPendingItems.push(i),!1;const a=this.baseInfoMap.get(i.sid);if(!a)return this.apiInvokeUploadPendingItems.push(i),!1;const{cname:l,uid:d,cid:h}=a.info;let f;if(i.lts=i.lts||Date.now(),i.error)if(i.error instanceof ne){const{code:g,message:E}=i.error;f=g||E||i.error.toString()}else f=i.error.toString();const m={invokeId:i.invokeId,sid:i.sid,cname:l,cid:h,uid:d,lts:i.lts,success:i.success,elapse:i.lts-a.startTime,execElapse:i.lts-i.apiInvokeTime,apiName:i.name,options:i.options?JSON.stringify(i.options):void 0,execStates:i.states?JSON.stringify(i.states):void 0,execResult:i.result?JSON.stringify(i.result):void 0,errorCode:i.error?f:void 0,errorMsg:i.error?JSON.stringify(i.error):void 0};return this.send({type:Xt.API_INVOKE,data:m},!1),!0}appendSessionId(){gE.__CLIENT_LIST__.forEach(i=>{if(i._sessionId){const r=this.apiInvokeUploadPendingItems.length;for(let a=0;a<r;a++){const l=this.apiInvokeUploadPendingItems.shift();l&&(l.sid=i._sessionId,this.sendApiInvoke(Object.assign({},l)))}}})}send(i,r){if(r)return this.keyEventUploadPendingItems.push(i),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(i),this.normalEventUploadPendingItems.length>H("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(i,r){const a=[],l=[];for(;i.length;){const h=i.shift();a.length<20?a.push(h):l.push(h)}i.push(...l);for(const h of[...a]){var d;-1!==this.ltsList.indexOf(h.data.lts)?(h.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(h.data.lts)):(this.ltsList.push(h.data.lts),Bf(d=this.ltsList).call(d,(f,m)=>f-m))}return r||(this.lastSendNormalEventTime=Date.now()),H("ENABLE_EVENT_REPORT")&&a.length&&(H("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(a):this.postDataToStatsCollector(a)).catch((h=>f=>{H("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(h):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(h),this.normalEventUploadPendingItems.length>H("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-H("NORMAL_EVENT_QUEUE_CAPACITY")),R.warning("report: drop normal events"))))})(a)),i}postDataToStatsCollector2(i){var r=this;return x(function*(){Hn.networkState===yn.OFFLINE&&(yield q.race([Hn.onlineWaiter,si(2*Wn.maxRetryTimeout)]));const a=h=>{let f=new Uint8Array;return h.forEach(m=>{const g=Xg(JSON.stringify(m.data)),E=new ArrayBuffer(5),y=(b=>{let O=0;return Object.entries(Xt).forEach(P=>{let[D,L]=P;L===b.type&&(O=EventNameToID[D])}),O})(m),C=new DataView(E);C.setUint16(0,g.byteLength,!0),C.setUint8(2,255&y),C.setUint8(3,y>>>8&255),C.setUint8(4,y>>>16&255),f=IS(f,new Uint8Array(E)),f=IS(f,g)}),f},l="event";let d=r.proxyServer?"https://".concat(r.proxyServer,"/rs/?h=").concat(H("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(l):"https://".concat(H("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(l);for(let h=0;h<2;h+=1){1===h&&(d=r.proxyServer?"https://".concat(r.proxyServer,"/rs/?h=").concat(H("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(l):"https://".concat(H("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(l));try{yield bs(d,{timeout:1e4,data:a(i),headers:qe(qe({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},r._appId&&{appid:r._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(f){if(1===h)throw f;continue}return}})()}postDataToStatsCollector(i){var r=arguments,a=this;return x(function*(){let l=r.length>1&&void 0!==r[1]&&r[1];const d={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:i.map(m=>JSON.stringify(m)),vid:(m=>{const g=m&&m.data.sid&&a.baseInfoMap.get(m.data.sid);return g&&g.info.vid&&+g.info.vid||0})(i[0])};Hn.networkState===yn.OFFLINE&&(yield q.race([Hn.onlineWaiter,si(2*Wn.maxRetryTimeout)]));const h=l?"/events/proto-raws":"/events/messages";let f=a.url||(a.proxyServer?"https://".concat(a.proxyServer,"/rs/?h=").concat(H("EVENT_REPORT_DOMAIN"),"&p=").concat(H("STATS_COLLECTOR_PORT"),"&d=").concat(h):"https://".concat(H("EVENT_REPORT_DOMAIN"),":").concat(H("STATS_COLLECTOR_PORT")).concat(h));for(let m=0;m<2;m+=1){1===m&&(f=a.backupUrl||(a.proxyServer?"https://".concat(a.proxyServer,"/rs/?h=").concat(H("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(H("STATS_COLLECTOR_PORT"),"&d=").concat(h):"https://".concat(H("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(H("STATS_COLLECTOR_PORT")).concat(h)));try{l?yield CD(f,{timeout:1e4,data:d}):yield bs(f,{timeout:1e4,data:d})}catch(g){if(1===m)throw g;continue}return}})()}createBaseInfo(i,r){const a=Object.assign({},Tt);return a.sid=i,this.baseInfoMap.set(i,{info:a,startTime:r}),a}reportResourceTiming(i,r){const a=performance.getEntriesByName(i),l=a[a.length-1];l&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:l,tag:Kt.TRACER}).onSuccess()}}function Oe(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(i,r,a){const l=a.value;if("function"==typeof l){const d=s.className||i.__className__||("AgoraRTCClient"===i.constructor.name?"Client":i.constructor.name);a.value=function(){for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];let g=f;if(s.argsMap)try{g=s.argsMap(this,...f)}catch(y){R.warning(y),g=[]}try{JSON.stringify(g)}catch(y){R.warning("arguments for method ".concat(d,".").concat(String(r)," not serializable for apiInvoke.")),g=[]}const E=(s.report||Te).reportApiInvoke(this._sessionId||null,{name:"".concat(d,".").concat(String(r)),options:g,tag:Kt.TRACER,reportResult:s.reportResult},s.throttleTime);try{const y=l.apply(this,f);return y instanceof q?y.then(C=>(E.onSuccess(s.reportResult&&C),C)).catch(C=>{throw E.onError(C),C}):(E.onSuccess(s.reportResult&&y),y)}catch(y){throw E.onError(y),y}}}return a}}T(gE,"__CLIENT_LIST__",[]);const Te=new gE;mE.on("REPORT_LOG_UPLOAD",s=>{s.networkState=Hn.networkState,Te.reportApiInvoke(null,{name:"logUploadError",options:s,tag:Kt.TRACER})});const Is=["CHINA","GLOBAL"],on=function(){const s="us".concat("erna","me"),i="pa".concat("sswo","rd"),r=["t","s","t"];r.splice(1,0,"e");const a=r.join(""),l=[];for(let f=0;f<6;f++)l.push("1");const d=l.join(""),h={};return h[s]=a,h[i]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=on,E_||(ir.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],ir.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],ir.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],ir.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ir.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],ir.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],ir.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",ir.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",ir.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",ir.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",ir.AREAS=["NORTH_AMERICA","OVERSEA"]);const ws=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Oc=[];function ou(s,i){return!!i&&Oc.some(r=>r.uid===s&&r.channelName===i)}gE.__CLIENT_LIST__=Oc;var EE,mr,ca,Nc,vo,ai,Ie,ze,he,ve,gr,Fe,su,Qh,Ne,Zn,Pc,RD=Ee("Array").values,yE=cl,YL=$n,tT=js,nT=RD,ID=Array.prototype,i3={DOMTokenList:!0,NodeList:!0},Ze=wr(function(s){var i=s.values;return s===ID||tT(ID,s)&&i===ID.values||YL(i3,yE(s))?nT:i});function oe(s,i,r,a){var l,d=arguments.length,h=d<3?i:null===a?a=Object.getOwnPropertyDescriptor(i,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect.decorate(s,i,r,a);else for(var f=s.length-1;f>=0;f--)(l=s[f])&&(h=(d<3?l(h):d>3?l(i,r,h):l(i,r))||h);return d>3&&h&&Object.defineProperty(i,r,h),h}function N(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)}(function(s){s.L1T1="L1T1",s.L1T2="L1T2",s.L1T3="L1T3",s.L2T1_KEY="L2T1_KEY",s.L2T2_KEY="L2T2_KEY",s.L2T3_KEY="L2T3_KEY",s.L3T1_KEY="L3T1_KEY",s.L3T2_KEY="L3T2_KEY",s.L3T3_KEY="L3T3_KEY"})(EE||(EE={})),function(s){s.CERTIFICATE="certificate",s.CODEC="codec",s.CANDIDATE_PAIR="candidate-pair",s.LOCAL_CANDIDATE="local-candidate",s.REMOTE_CANDIDATE="remote-candidate",s.INBOUND="inbound-rtp",s.TRACK="track",s.OUTBOUND="outbound-rtp",s.PC="peer-connection",s.REMOTE_INBOUND="remote-inbound-rtp",s.REMOTE_OUTBOUND="remote-outbound-rtp",s.TRANSPORT="transport",s.CSRC="csrc",s.DATA_CHANNEL="data-channel",s.STREAM="stream",s.SENDER="sender",s.RECEIVER="receiver"}(mr||(mr={})),function(s){s[s.ACCESS_POINT=101]="ACCESS_POINT",s[s.UNILBS=201]="UNILBS",s[s.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(ca||(ca={})),function(s){s[s.IIIEGAL_APPID=1]="IIIEGAL_APPID",s[s.IIIEGAL_UID=2]="IIIEGAL_UID",s[s.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(Nc||(Nc={})),function(s){s[s.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",s[s.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",s[s.INTERNAL_ERROR=8]="INTERNAL_ERROR",s[s.NO_AUTHORIZED=9]="NO_AUTHORIZED",s[s.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",s[s.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",s[s.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",s[s.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",s[s.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",s[s.USER_OVERLOAD=16]="USER_OVERLOAD",s[s.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",s[s.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(vo||(vo={})),function(s){s[s.NO_FLAG_SET=100]="NO_FLAG_SET",s[s.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",s[s.INVALID_FALG_SET=102]="INVALID_FALG_SET",s[s.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",s[s.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",s[s.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",s[s.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",s[s.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",s[s.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",s[s.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",s[s.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",s[s.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",s[s.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",s[s.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",s[s.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",s[s.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",s[s.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",s[s.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",s[s.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(ai||(ai={})),function(s){s[s.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",s[s.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",s[s.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",s[s.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",s[s.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",s[s.K_TICKET_INVALID=7]="K_TICKET_INVALID",s[s.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",s[s.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",s[s.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",s[s.K_UID_BANNED=14]="K_UID_BANNED",s[s.K_IP_BANNED=15]="K_IP_BANNED",s[s.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",s[s.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",s[s.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",s[s.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",s[s.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",s[s.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",s[s.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",s[s.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",s[s.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",s[s.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",s[s.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",s[s.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",s[s.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",s[s.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",s[s.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",s[s.ERR_INVALID_UID=117]="ERR_INVALID_UID",s[s.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",s[s.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",s[s.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",s[s.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",s[s.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",s[s.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",s[s.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",s[s.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",s[s.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",s[s.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",s[s.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",s[s.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",s[s.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",s[s.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",s[s.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",s[s.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",s[s.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",s[s.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",s[s.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",s[s.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",s[s.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",s[s.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",s[s.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",s[s.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",s[s.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",s[s.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",s[s.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",s[s.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",s[s.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",s[s.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",s[s.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",s[s.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",s[s.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",s[s.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",s[s.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",s[s.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",s[s.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(Ie||(Ie={})),function(s){s.CONNECTING="connecting",s.CONNECTED="connected",s.RECONNECTING="reconnecting",s.CLOSED="closed"}(ze||(ze={})),function(s){s.WS_CONNECTED="ws_connected",s.WS_RECONNECTING="ws_reconnecting",s.WS_CLOSED="ws_closed",s.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",s.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",s.ON_BINARY_DATA="on_binary_data",s.REQUEST_RECOVER="request_recover",s.REQUEST_JOIN_INFO="request_join_info",s.REQUEST_REJOIN_INFO="req_rejoin_info",s.IS_P2P_DISCONNECTED="is_p2p_dis",s.DISCONNECT_P2P="dis_p2p",s.ABORT_P2P_EXECUTION="abort_p2p_execution",s.NEED_RENEW_SESSION="need-sid",s.REPORT_JOIN_GATEWAY="report_join_gateway",s.REQUEST_TIMEOUT="request_timeout",s.REQUEST_SUCCESS="request_success",s.JOIN_RESPONSE="join_response",s.DATACHANNEL_PRECONNECT="datachannel_preconnect",s.DATACHANNEL_CONNECTING="datachannel_connecting",s.DATACHANNEL_FAILBACK="datachannel_failback",s.P2P_START="p2p_start",s.P2P_CONNECTION="p2p_connection",s.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",s.P2P_SUBSCRIBE="p2p_subscribe",s.P2P_UNSUBSCRIBE="p2p_unsubscribe",s.P2P_EXCHANGE_SDP="p2p_exchange_sdp",s.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",s.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream"}(he||(he={})),function(s){s.PING="ping",s.PING_BACK="ping_back",s.JOIN="join_v3",s.REJOIN="rejoin_v3",s.LEAVE="leave",s.SET_CLIENT_ROLE="set_client_role",s.PUBLISH="publish",s.PUBLISH_DATASTREAM="publish_datastream",s.UNPUBLISH="unpublish",s.UNPUBLISH_DATASTREAM="unpublish_datastream",s.SUBSCRIBE="subscribe",s.SUBSCRIBE_DATASTREAM="subscribe_datastream",s.SUBSCRIBE_STREAMS="subscribe_streams",s.UNSUBSCRIBE="unsubscribe",s.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",s.UNSUBSCRIBE_STREAMS="unsubscribe_streams",s.SUBSCRIBE_CHANGE="subscribe_change",s.TRAFFIC_STATS="traffic_stats",s.RENEW_TOKEN="renew_token",s.SWITCH_VIDEO_STREAM="switch_video_stream",s.DEFAULT_VIDEO_STREAM="default_video_stream",s.SET_FALLBACK_OPTION="set_fallback_option",s.GATEWAY_INFO="gateway_info",s.CONTROL="control",s.SEND_METADATA="send_metadata",s.DATA_STREAM="data_stream",s.PICK_SVC_LAYER="pick_svc_layer",s.RESTART_ICE="restart_ice",s.CONNECT_PC="connect_pc",s.SET_VIDEO_PROFILE="set_video_profile",s.SET_PARAMETER="set_parameter",s.SET_RTM2_FLAG="set_rtm2_flag"}(ve||(ve={})),function(s){s.PUBLISH_STATS="publish_stats",s.PUBLISH_RELATED_STATS="publish_related_stats",s.SUBSCRIBE_STATS="subscribe_stats",s.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",s.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",s.DENOISER_STATS="denoiser_stats",s.TRANSPORT_STATS="transport_stats",s.EXTENSION_USAGE_STATS="extension_usage_stats"}(gr||(gr={})),function(s){s.ON_USER_ONLINE="on_user_online",s.ON_USER_OFFLINE="on_user_offline",s.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",s.ON_PUBLISH_STREAM="on_publish_stream",s.ON_UPLINK_STATS="on_uplink_stats",s.ON_P2P_LOST="on_p2p_lost",s.ON_REMOVE_STREAM="on_remove_stream",s.ON_ADD_AUDIO_STREAM="on_add_audio_stream",s.ON_ADD_VIDEO_STREAM="on_add_video_stream",s.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",s.ON_USER_BANNED="on_user_banned",s.ON_USER_LICENSE_BANNED="on_user_license_banned",s.ON_NOTIFICATION="on_notification",s.ON_CRYPT_ERROR="on_crypt_error",s.MUTE_AUDIO="mute_audio",s.MUTE_VIDEO="mute_video",s.UNMUTE_AUDIO="unmute_audio",s.UNMUTE_VIDEO="unmute_video",s.ON_P2P_OK="on_p2p_ok",s.RECEIVE_METADATA="receive_metadata",s.ON_DATA_STREAM="on_data_stream",s.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",s.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",s.ENABLE_LOCAL_VIDEO="enable_local_video",s.DISABLE_LOCAL_VIDEO="disable_local_video",s.ENABLE_LOCAL_AUDIO="enable_local_audio",s.DISABLE_LOCAL_AUDIO="disable_local_audio",s.ON_PUBLISHED_USER_LIST="on_published_user_list"}(Fe||(Fe={})),function(s){s.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",s.NEED_ANSWER="NEED_ANSWER",s.NEED_RENEGOTIATE="NEED_RENEGOTIATE",s.P2P_LOST="P2P_LOST",s.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",s.NEED_UNPUB="NEED_UNPUB",s.NEED_UNSUB="NEED_UNSUB",s.NEED_UPLOAD="NEED_UPLOAD",s.NEED_CONTROL="NEED_CONTROL",s.START_RECONNECT="START_RECONNECT",s.END_RECONNECT="END_RECONNECT",s.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(su||(su={})),function(s){s.SEND_ONLY="SEND_ONLY",s.RECEIVE_ONLY="RECEIVE_ONLY"}(Qh||(Qh={})),function(s){s.CONNECTED="websocket:connected",s.RECONNECTING="websocket:reconnecting",s.WILL_RECONNECT="websocket:will_reconnect",s.CLOSED="websocket:closed",s.FAILED="websocket:failed",s.ON_MESSAGE="websocket:on_message",s.REQUEST_NEW_URLS="websocket:request_new_urls",s.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",s.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"}(Ne||(Ne={}));class K extends ne{constructor(i){super(i,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),T(this,"name","AgoraRTCException")}print(){return super.print(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",R)}throw(){super.throw(R)}}function iT(s){if("string"!=typeof s||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(s))throw R.error("Invalid Channel Name ".concat(s)),new K(k.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function rT(s){if(!("number"==typeof(i=s)&&Math.floor(i)===i&&0<=i&&i<=4294967295||OA(s,1,255)))throw new K(k.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var i;"string"==typeof s&&R.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}(function(s){s.TRANSCODE="mix_streaming",s.RAW="raw_streaming",s.INJECT="inject_streaming"})(Zn||(Zn={})),function(s){s[s.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",s[s.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",s[s.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",s[s.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",s[s.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",s[s.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",s[s.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",s[s.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",s[s.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",s[s.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",s[s.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(Pc||(Pc={}));const r3={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},wD={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function oT(s,i){Vi(s.url,"".concat(i,".url"),1,1e3,!1),En(s.x)||Ut(s.x,"".concat(i,".x"),0,1e4),En(s.y)||Ut(s.y,"".concat(i,".y"),0,1e4),En(s.width)||Ut(s.width,"".concat(i,".width"),0,1e4),En(s.height)||Ut(s.height,"".concat(i,".height"),0,1e4),En(s.zOrder)||Ut(s.zOrder,"".concat(i,".zOrder"),0,255),En(s.alpha)||Ut(s.alpha,"".concat(i,".alpha"),0,1,!1)}const Wr={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},$L={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var As,Ml,xn,AD,zi,la,Er,kl,bt,Rn,au,Kn,Zh,at;function JL(s){if(!s.channelName)throw new K(k.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof s.uid)throw new K(k.INVALID_PARAMS,"invalid uid in info, uid must be a number");return s.token&&Vi(s.token,"info.token",1,2047),rT(s.uid),iT(s.channelName),!0}(function(s){s.WARNING="@live_uap-warning",s.ERROR="@line_uap-error",s.PUBLISH_STREAM_STATUS="@live_uap-publish-status",s.INJECT_STREAM_STATUS="@live_uap-inject-status",s.WORKER_STATUS="@live_uap-worker-status",s.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(As||(As={})),function(s){s.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(Ml||(Ml={})),function(s){s[s.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",s[s.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",s[s.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",s[s.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",s[s.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",s[s.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",s[s.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",s[s.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",s[s.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",s[s.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",s[s.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",s[s.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",s[s.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",s[s.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",s[s.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",s[s.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",s[s.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",s[s.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",s[s.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",s[s.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",s[s.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(xn||(xn={})),function(s){s.CONNECT_FAILED="connect failed",s.CONNECT_TIMEOUT="connect timeout",s.WS_DISCONNECTED="websocket disconnected",s.REQUEST_TIMEOUT="request timeout",s.REQUEST_FAILED="request failed",s.WAIT_STATUS_TIMEOUT="wait status timeout",s.WAIT_STATUS_ERROR="wait status error",s.BAD_STATE="bad state",s.WS_ABORT="ws abort",s.AP_REQUEST_TIMEOUT="AP request timeout",s.AP_JSON_PARSE_ERROR="AP json parse error",s.AP_REQUEST_ERROR="AP request error",s.AP_REQUEST_ABORT="AP request abort"}(AD||(AD={})),function(s){s[s.SetSdkProfile=0]="SetSdkProfile",s[s.SetSourceChannel=1]="SetSourceChannel",s[s.SetSourceUserId=2]="SetSourceUserId",s[s.SetDestChannel=3]="SetDestChannel",s[s.StartPacketTransfer=4]="StartPacketTransfer",s[s.StopPacketTransfer=5]="StopPacketTransfer",s[s.UpdateDestChannel=6]="UpdateDestChannel",s[s.Reconnect=7]="Reconnect",s[s.SetVideoProfile=8]="SetVideoProfile"}(zi||(zi={})),function(s){s.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",s.NETWORK_CONNECTED="NETWORK_CONNECTED",s.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",s.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",s.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",s.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",s.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",s.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",s.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",s.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(la||(la={})),function(s){s.RELAY_STATE_IDLE="RELAY_STATE_IDLE",s.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",s.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",s.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(Er||(Er={})),function(s){s.RELAY_OK="RELAY_OK",s.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",s.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",s.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(kl||(kl={})),function(s){s.High="high",s.Low="low",s.Audio="audio",s.Screen="screen",s.ScreenLow="screen_low"}(bt||(bt={})),function(s){s.DISCONNECT="disconnect",s.CONNECTION_STATE_CHANGE="connection-state-change",s.NETWORK_QUALITY="network-quality",s.STREAM_TYPE_CHANGE="stream-type-change",s.IS_P2P_DISCONNECTED="is-p2p-dis",s.DISCONNECT_P2P="dis-p2p",s.REQUEST_NEW_GATEWAY_LIST="req-gate-url",s.NEED_RENEW_SESSION="need-sid",s.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",s.JOIN_RESPONSE="join-response",s.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",s.RESET_CONNECTION_EVENTS="reset-connection-events",s.DATACHANNEL_PRECONNECT="datachannel_preconnect",s.DATACHANNEL_FAILBACK="datachannel_failback",s.RESET_SIGNAL="reset-signal"}(Rn||(Rn={})),function(s){s.P2P_DISCONNECTED="P2P_DISCONNECTED",s.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",s.TIMEOUT="TIMEOUT",s.UNKNOWN_REASON="UNKNOWN_REASON"}(au||(au={})),function(s){s[s.Nothing=0]="Nothing",s[s.Audio=1]="Audio",s[s.LwoVideo=2]="LwoVideo",s[s.Video=4]="Video",s[s.Data=8]="Data",s[s.DataStream0=256]="DataStream0",s[s.DataStream1=512]="DataStream1",s[s.DataStream2=1024]="DataStream2",s[s.DataStream3=2048]="DataStream3",s[s.DataStream4=4096]="DataStream4",s[s.DataStream5=8192]="DataStream5",s[s.DataStream6=16384]="DataStream6",s[s.DataStream7=32768]="DataStream7"}(Kn||(Kn={})),function(s){s[s.websocket=0]="websocket",s[s.datachannel=1]="datachannel"}(Zh||(Zh={})),function(s){s.CHINA="CHINA",s.ASIA="ASIA",s.NORTH_AMERICA="NORTH_AMERICA",s.EUROPE="EUROPE",s.JAPAN="JAPAN",s.INDIA="INDIA",s.KOREA="KOREA",s.HKMC="HKMC",s.US="US",s.OCEANIA="OCEANIA",s.SOUTH_AMERICA="SOUTH_AMERICA",s.AFRICA="AFRICA",s.OVERSEA="OVERSEA",s.GLOBAL="GLOBAL",s.EXTENSIONS="EXTENSIONS"}(at||(at={}));const DD=[at.AFRICA,at.ASIA,at.CHINA,at.EUROPE,at.GLOBAL,at.INDIA,at.JAPAN,at.NORTH_AMERICA,at.OCEANIA,at.OVERSEA,at.SOUTH_AMERICA];var Oi;!function(s){s.CHINA="CN",s.ASIA="AS",s.NORTH_AMERICA="NA",s.EUROPE="EU",s.JAPAN="JP",s.INDIA="IN",s.KOREA="KR",s.HKMC="HK",s.US="US",s.OCEANIA="OC",s.SOUTH_AMERICA="SA",s.AFRICA="AF",s.OVERSEA="OVERSEA",s.GLOBAL="GLOBAL",s.EXTENSIONS="GLOBAL"}(Oi||(Oi={}));const vE={CHINA:{},ASIA:{CODE:Oi.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Oi.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Oi.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Oi.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","\tuap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Oi.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Oi.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Oi.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Oi.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Oi.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Oi.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Oi.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Oi.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Oi.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};var v_,OD,ye,fi,da,se,rt,Re,XL,oo,Co,ci,ja,Mn,ua,sT,so,Jo,cu,$t,Mc,CE;E_&&(vE.CHINA={CODE:Oi.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(s){s.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(v_||(v_={}));class ND extends nn{constructor(i,r){super(),T(this,"onICEConnectionStateChange",void 0),T(this,"onConnectionStateChange",void 0),T(this,"onDTLSTransportStateChange",void 0),T(this,"onDTLSTransportError",void 0),T(this,"onICETransportStateChange",void 0),T(this,"onFirstAudioReceived",void 0),T(this,"onFirstVideoReceived",void 0),T(this,"onFirstAudioDecoded",void 0),T(this,"onFirstVideoDecoded",void 0),T(this,"onFirstVideoDecodedTimeout",void 0),T(this,"onSelectedLocalCandidateChanged",void 0),T(this,"onSelectedRemoteCandidateChanged",void 0)}}class SE extends ND{constructor(i,r){super(i,r)}}(function(s){s.SEND="sendonly",s.RECV="recvonly",s.SENDRECV="sendrecv",s.INACTIVE="inactive"})(OD||(OD={})),function(s){s.VIDEO="video",s.AUDIO="audio"}(ye||(ye={})),function(s){s[s.UDP=0]="UDP",s[s.TCP=1]="TCP",s[s.RELAY=2]="RELAY"}(fi||(fi={})),function(s){s[s.FIRST_CONNECTION=0]="FIRST_CONNECTION",s[s.TCP_RESTART=1]="TCP_RESTART",s[s.RELAY_RESTART=2]="RELAY_RESTART",s[s.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",s[s.OLD_RESTART=11]="OLD_RESTART",s[s.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(da||(da={})),function(s){s.LocalVideoTrack="videoTrack",s.LocalAudioTrack="audioTrack",s.LocalVideoLowTrack="videoLowTrack"}(se||(se={})),function(s){s.New="new",s.Connected="connected",s.Reconnecting="reconnecting",s.Disconnected="disconnected"}(rt||(rt={})),function(s){s.StateChange="stateChange",s.IceConnectionStateChange="iceConnectionStateChange",s.RequestMuteLocal="requestMuteLocal",s.RequestUnmuteLocal="requestUnmuteLocal",s.RequestRePublish="requestRePublish",s.RequestRePublishDataChannel="requestRePublishDataChannel",s.RequestReSubscribe="requestReSubscribe",s.RequestUploadStats="requestUploadStats",s.MediaReconnectStart="MediaReconnectStart",s.MediaReconnectEnd="MediaReconnectEnd",s.NeedSignalRTT="NeedSignalRTT",s.RequestRestartICE="RequestRestartIce",s.PeerConnectionStateChange="PeerConnectionStateChange",s.RequestReconnect="RequestReconnect",s.RequestReconnectPC="RequestReconnectPC",s.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",s.P2PLost="P2PLost",s.UpdateVideoEncoder="UpdateVideoEncoder",s.ConnectionTypeChange="ConnectionTypeChange",s.RequestLowStreamParameter="RequestLowStreamParameter",s.QueryClientConnectionState="QueryClientConnectionState",s.LocalCandidate="LocalCandidate",s.RequestP2PMuteLocal="requestP2PMuteLocal",s.RequestP2PPublish="RequestP2PPublish",s.RequestP2PUnPublish="RequestP2PUnPublish",s.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",s.RequestP2PMuteRemote="RequestP2PMuteRemote",s.RequestP2PRestartICE="RequestP2PRestartICE"}(Re||(Re={})),function(s){s.MUTE_LOCAL_VIDEO="mute_local_video",s.MUTE_LOCAL_AUDIO="mute_local_audio",s.UNMUTE_LOCAL_VIDEO="unmute_local_video",s.UNMUTE_LOCAL_AUDIO="unmute_local_audio",s.MUTE_REMOTE_VIDEO="mute_remote_video",s.MUTE_REMOTE_AUDIO="mute_remote_audio",s.UNMUTE_REMOTE_VIDEO="unmute_remote_video",s.UNMUTE_REMOTE_AUDIO="unmute_remote_audio"}(XL||(XL={})),function(s){s.CONNECTING="CONNECTING",s.RECONNECTING="RECONNECTING",s.CONNECTED="CONNECTED",s.CLOSED="CLOSED"}(oo||(oo={})),function(s){s[s.CONNECT_AP=0]="CONNECT_AP",s[s.AP_CONNECTED=1]="AP_CONNECTED",s[s.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",s[s.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",s[s.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",s[s.CONNECT_WORKER=5]="CONNECT_WORKER",s[s.WORKER_CONNECTED=6]="WORKER_CONNECTED",s[s.CLOSED=7]="CLOSED"}(Co||(Co={})),function(s){s.CONNECTION_STATE_CHANGE="connection-state-change",s.STATE_CHANGE="state-change",s.INSPECT_RESULT="inspect-result",s.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",s.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(ci||(ci={})),function(s){s.NETWORK_ERROR="NETWORK_ERROR",s.SERVER_ERROR="SERVER_ERROR",s.MULTI_IP="MULTI_IP",s.TIMEOUT="TIMEOUT",s.OFFLINE="OFFLINE",s.LEAVE="LEAVE",s.P2P_FAILED="P2P_FAILED",s.FALLBACK="FALLBACK"}(ja||(ja={})),function(s){s.CONNECTED="transmitter:connected",s.RECONNECTING="transmitter:reconnecting",s.WILL_RECONNECT="transmitter:will_reconnect",s.CLOSED="transmitter:closed",s.FAILED="transmitter:failed",s.ON_MESSAGE="transmitter:on_message",s.REQUEST_NEW_URLS="transmitter:request_new_urls",s.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",s.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",s.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",s.FAILBACK="transmitter:failback"}(Mn||(Mn={})),function(s){s.CAMERA_CHANGED="camera-changed",s.MICROPHONE_CHANGED="microphone-changed",s.PLAYBACK_DEVICE_CHANGED="playback-device-changed",s.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",s.AUTOPLAY_FAILED="autoplay-failed",s.SECURITY_POLICY_VIOLATION="security-policy-violation"}(ua||(ua={})),function(s){s[s.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",s[s.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",s[s.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",s[s.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",s[s.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",s[s.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",s[s.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",s[s.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",s[s.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",s[s.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",s[s.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",s[s.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",s[s.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",s[s.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",s[s.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",s[s.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",s[s.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",s[s.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",s[s.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",s[s.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(sT||(sT={})),function(s){s.CONNECTING="CONNECTING",s.RECONNECTING="RECONNECTING",s.CONNECTED="CONNECTED",s.CLOSED="CLOSED"}(so||(so={})),function(s){s.CONNECTION_STATE_CHANGE="connection-state-change",s.STATE_CHANGE="state-change",s.INSPECT_RESULT="inspect-result",s.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",s.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(Jo||(Jo={})),function(s){s[s.CONNECT_AP=0]="CONNECT_AP",s[s.AP_CONNECTED=1]="AP_CONNECTED",s[s.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",s[s.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",s[s.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",s[s.CONNECT_WORKER=5]="CONNECT_WORKER",s[s.WORKER_CONNECTED=6]="WORKER_CONNECTED",s[s.CLOSED=7]="CLOSED"}(cu||(cu={})),function(s){s.CALL="call",s.CANDIDATE="candidate",s.PUBLISH="publish",s.UNPUBLISH="unpublish",s.SUBSCRIBE="subscribe",s.UNSUBSCRIBE="unsubscribe",s.CONTROL="control",s.RESTART_ICE="restart_ice",s.ACK="ack",s.JOIN="join",s.EXCHANGE_SDP="exchange_sdp",s.DO_SUBSCRIBE="do_subscribe",s.DO_UNSUBSCRIBE="do_unsubscribe"}($t||($t={})),function(s){s.MUTE_LOCAL_AUDIO="mute_local_audio",s.MUTE_LOCAL_VIDEO="mute_local_video",s.UNMUTE_LOCAL_AUDIO="unmute_local_audio",s.UNMUTE_LOCAL_VIDEO="unmute_local_video"}(Mc||(Mc={})),function(s){s[s.SUCCESS=1]="SUCCESS",s[s.FAILED=0]="FAILED"}(CE||(CE={}));const QL={[ca.ACCESS_POINT]:{[ai.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[ai.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[ai.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[ai.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[ai.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[ai.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[ai.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[ai.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[ai.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[ai.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[ai.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[ai.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[ai.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[ai.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[ai.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[ai.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[ai.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[ai.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[ca.UNILBS]:{[vo.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[vo.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[vo.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[vo.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[vo.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[vo.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[vo.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[vo.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[vo.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[vo.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[vo.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[vo.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[ca.STRING_UID_ALLOCATOR]:{[Nc.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Nc.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Nc.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function TE(s){const i=QL[Math.floor(s/1e4)];if(!i)return{desc:"unkonw error",retry:!1};const r=i[s%1e4];if(!r){if(Math.floor(s/1e4)===ca.ACCESS_POINT){const a=s%1e4;if("1"===a.toString()[0])return{desc:s.toString(),retry:!1};if("2"===a.toString()[0])return{desc:s.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return r}const ZL={[Ie.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ie.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ie.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ie.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ie.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ie.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ie.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ie.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ie.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ie.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ie.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ie.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ie.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ie.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ie.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ie.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ie.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ie.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ie.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ie.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ie.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ie.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ie.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ie.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ie.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ie.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ie.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ie.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ie.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ie.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ie.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ie.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ie.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ie.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ie.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ie.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ie.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ie.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ie.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ie.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ie.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ie.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ie.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ie.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ie.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ie.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ie.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ie.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ie.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ie.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ie.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ie.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ie.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ie.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ie.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ie.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ie.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ie.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ie.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ie.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ie.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ie.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ie.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function lu(s){return ZL[s]||{desc:"UNKNOW_ERROR_".concat(s),action:"failed"}}function aT(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function C_(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?aT(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):aT(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function PD(s){return s.every(i=>i.readyState===WebSocket.CLOSED||i.readyState===WebSocket.CLOSING)}function du(s,i){if("string"==typeof s)return s;const{proxy:r,host:a,port:l}=s;if(i){const d=H("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===d?"wss://".concat(a,"/ws/?p=").concat(Number(l)+150):"wss://".concat(a,":").concat(d,"/ws/?p=").concat(Number(l)+150)}return r?"wss://".concat(r,"/ws/?h=").concat(a,"&p=").concat(l):"wss://".concat(a,":").concat(l)}const Kr=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,MD=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,ha=/wss:\/\/(.+):([0-9]+)\/?/,cT=/wss:\/\/(.[^\/]+)\/?/;let ex=0;class kD{constructor(i,r){T(this,"id",0),T(this,"store",void 0),T(this,"recordIndex",void 0),T(this,"websockets",[]),T(this,"try443PortDuration",2e3),T(this,"forceCloseWSDuration",5e3),T(this,"try443PortTimeout",null),T(this,"forceCloseTimeout",null),T(this,"isTry443PortFailed",!1),T(this,"isNormalPortFailed",!1),T(this,"useDoubleDomain",!1),T(this,"useProxy",!1),T(this,"startTime",Date.now()),this.id=++ex,this.try443PortDuration=H("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=i||5e3,this.store=r}closeAllWebsockets(){this.websockets.forEach(i=>{i.onopen=null,i.onclose=null,i.onmessage=null,i.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var i;const r=Date.now()-this.startTime;for(var a=arguments.length,l=new Array(a),d=0;d<a;d++)l[d]=arguments[d];R.debug("[choose-best-ws ".concat(null===(i=this.store)||void 0===i?void 0:i.clientId," ").concat(this.id,"] ").concat(r,"ms:"),...l)}createWebSocket(i,r,a){this.logger("createWebSocket:",i,{isTry443Port:r,hasTimeoutDetection:a});const l=H("GATEWAY_DOMAINS"),d=Date.now(),h=[],f=l.find(E=>{var y;return we(y=i.host).call(y,E)});f||(this.useDoubleDomain=!1);const m=[];if(this.useDoubleDomain)l.forEach(E=>{m.push(du(C_(C_({},i),{},{host:i.host.replace(f,E)}),r))});else{const E=C_({},i);if(r&&f){const y=l.find(C=>C!==f);y&&(E.host=E.host.replace(f,y))}m.push(du(E,r))}try{m.forEach(E=>{const y=new WebSocket(E);y.binaryType="arraybuffer",h.push(y),this.logger("ws is connecting:",y.url)})}catch(E){if(this.logger("ws create failed"),h.forEach(y=>y.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(i,r,a);if(!r&&443!==Number(i.port))return this.createWebSocket(i,!0,a);throw new K(k.WS_ERR,"init websocket failed! Error: ".concat(E.toString()))}const g=io();return this.store&&this.store.recordJoinChannelService({urls:h.map(E=>E.url),service:"gateway"},this.recordIndex),h.forEach(E=>{E.onopen=()=>{this.logger("onopen: ws ".concat(E.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach(y=>{y!==E&&(y.onopen=null,y.onclose=null,y.onmessage=null,y.close(),this.logger("close backup websocket: ".concat(y.url)))}),this.websockets.length=0,g.resolve(E)},E.onclose=y=>{this.logger("onclose: ws ".concat(E.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(E.readyState)),r?this.isTry443PortFailed=PD(h):this.isNormalPortFailed=PD(h),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(r&&this.isTry443PortFailed||!r&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(y.reason)),g.reject({code:y.code,reason:au.A_ROUND_WS_FAILED}))},E.onmessage=y=>this.logger("".concat(E.url," onmessage: ").concat(y.data))}),this.websockets.push(...h),a||(()=>{const E=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",g.isResolved),this.websockets.forEach(y=>y.readyState!==WebSocket.OPEN&&y.close())};if(r||this.useProxy)return this.logger("add 5s timeout at ".concat(r?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(E,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",g.isResolved),g.isResolved)return E();pt().os===vi.MAC_OS&&Pt()&&E(),this.createWebSocket(i,!0,!0).then(y=>g.resolve(y)).catch(y=>{this.isNormalPortFailed&&g.reject(y),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(E,this.forceCloseWSDuration)},this.try443PortDuration)})(),g.promise}chooseBestWebsocket(i,r,a,l){return this.useDoubleDomain=!!r,"string"==typeof i&&(i=function(d){let h,f,m;return[,h,f,m]=d.match(Kr)||[],h||([,f,m]=d.match(MD)||[]),f&&m||([,f,m]=d.match(ha)||[]),f&&m||([,f]=d.match(cT)||[]),f||R.warning("un-destructible url: ",d),{proxy:h,host:f,port:m||"443"}}(i)),this.recordIndex=l,this.useProxy=!!i.proxy,a&&this.useProxy&&(R.warn("cannot use 443 only when use proxy"),a=!1),this.createWebSocket(i,!!a,!1).finally(()=>this.clearTimeout())}}function lT(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}class dT extends nn{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(i){var r;we(r=["tryNext","recover"]).call(r,i)&&this.resetReconnectCount(i),this._reconnectMode=i}get state(){return this._state}set state(i){i!==this._state&&(this._state=i,"reconnecting"===this._state?this.emit(Ne.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(Ne.CONNECTED):"closed"===this._state?this.emit(Ne.CLOSED):"failed"===this._state&&this.emit(Ne.FAILED))}resetReconnectCount(i){R.debug("websocket reset reconnect count, reason: "+i),this.reconnectCount=0}constructor(i,r){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),T(this,"connectionID",0),T(this,"currentURLIndex",0),T(this,"urls",[]),T(this,"_reconnectMode","tryNext"),T(this,"reconnectReason",void 0),T(this,"_initMutex",new Gn("websocket")),T(this,"name",void 0),T(this,"_state","closed"),T(this,"reconnectInterrupter",void 0),T(this,"websocket",void 0),T(this,"retryConfig",void 0),T(this,"reconnectCount",0),T(this,"forceCloseTimeout",5e3),T(this,"onlineReconnectListener",void 0),T(this,"useCompress",void 0),T(this,"tryDoubleDomain",!1),T(this,"use443PortOnly",!1),T(this,"wsInflateLength",0),T(this,"wsDeflateLength",0),T(this,"closeEstablishingWs",()=>{}),T(this,"store",void 0),T(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=i,this.retryConfig=function(y){for(var C=1;C<arguments.length;C++){var b=null!=arguments[C]?arguments[C]:{};C%2?lT(Object(b),!0).forEach(function(O){T(y,O,b[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(b)):lT(Object(b)).forEach(function(O){Object.defineProperty(y,O,Object.getOwnPropertyDescriptor(b,O))})}return y}({},r),this.useCompress=a,this.tryDoubleDomain=l,this.use443PortOnly=d;const{timeout:f,timeoutFactor:m}=r,g=Math.max(300,Math.floor(3*f/5)),E=Math.max(1.2,Math.floor(8*m)/10);yn.ONLINE&&(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=E),Hn.on(wl.NETWORK_STATE_CHANGE,(y,C)=>{y!==C&&(this.resetReconnectCount("network state change: ".concat(C," -> ").concat(y)),y===yn.ONLINE?(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=E):(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=m))})}getConnection(){return this.websocket||void 0}init(i){var r=arguments,a=this;return x(function*(){let l=r.length>1&&void 0!==r[1]?r[1]:5e3;const d=yield a._initMutex.lock();a.forceCloseTimeout=l,a.urls=i,a.state="connecting";try{const h=io();a.createWebSocketConnection(a.urls[a.currentURLIndex]).then(h.resolve).catch(h.reject),a.once(Ne.CLOSED,()=>{h.reject(new ne(k.WS_DISCONNECT))}),a.once(Ne.CONNECTED,h.resolve),yield h.promise}catch(h){}finally{d()}})()}close(i,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const a=this.websocket;r?setTimeout(()=>a.close(),500):a.close(),this.websocket=void 0}this.state=i?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(i,r){if(!this.websocket)return void R.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==i&&(this.reconnectMode=i),R.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(r)]},this.joinGatewayRecordIndex);const a=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),a&&a.bind(this.websocket)({code:9999,reason:r})}sendMessage(i){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new ne(k.WS_ABORT,"websocket is not ready");try{r||(i=JSON.stringify(i)),this.websocket.send(i)}catch(a){throw new ne(k.WS_ERR,"send websocket message error"+a.toString())}}setWsInflateData(i){this.wsDeflateLength=this.wsDeflateLength+i.originLength,this.wsInflateLength=this.wsInflateLength+i.compressedLength}getWsInflateData(){const i=this.wsInflateLength,r=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:i,wsDeflateLength:r}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}createWebSocketConnection(i){var r=this;return x(function*(){var a;const l=io();r.connectionID+=1,r.joinGatewayRecordIndex=void 0;const d=y=>{var C;null===(C=r.store)||void 0===C||C.signalChannelOpen(),R.debug("[".concat(r.name,"] websocket opened:"),y),r.reconnectMode="retry",r.state="connected",r.resetReconnectCount("opened"),l.resolve()},h=function(){var y=x(function*(C){var b;if(R.debug("[".concat(r.name,"] websocket close ").concat(null===(b=r.websocket)||void 0===b?void 0:b.url,", code: ").concat(C.code,", reason: ").concat(C.reason,", current mode: ").concat(r.reconnectMode)),r.reconnectCount>=r.retryConfig.maxRetryCount)l.reject(new ne(k.WS_DISCONNECT,"websocket close: ".concat(C.code))),r.close();else{"connected"===r.state&&(r.reconnectReason=C.reason,r.state="reconnecting");const O=ro(r,Ne.WILL_RECONNECT,r.reconnectMode,C.reason)||r.reconnectMode,P=yield r.reconnectWithAction(O);if("closed"===r.state)return void R.debug("[".concat(r.connectionID,"] ws is closed, no need to reconnect"));if(!P)return l.reject(new ne(k.WS_DISCONNECT,"websocket reconnect failed: ".concat(C.code))),r.close(!0);l.resolve()}});return function(b){return y.apply(this,arguments)}}(),f=y=>{r.emit(Ne.ON_MESSAGE,y)},m=y=>{R.warn("[".concat(r.connectionID,"] ws open error ").concat(y))};r.websocket&&(r.websocket.onclose=null,r.websocket.close()),H("GATEWAY_WSS_ADDRESS")&&r.name.startsWith("gateway")&&(i=H("GATEWAY_WSS_ADDRESS")),R.debug("[".concat(r.name,"] start connect, url:"),i);const g=null===(a=r.store)||void 0===a?void 0:a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var E;const y=yield r.chooseBestWebsocketConnection(i);r.websocket=y,d&&d(r.websocket.url),r.websocket.onclose=h,r.websocket.onmessage=f,r.websocket.onerror=m,null===(E=r.store)||void 0===E||E.recordJoinChannelService({endTs:Date.now(),status:"success"},g),r.joinGatewayRecordIndex=g}catch(y){const C="closed"===r.state,b=y instanceof ne,O=b&&y.code===k.WS_ABORT,P=b&&y.code===k.WS_ERR,D=b?y.message:y&&(y.reason||y.toString());R.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(D)),r.store&&r.store.recordJoinChannelService({endTs:Date.now(),status:O?"aborted":"error",errors:[y]},g),C||P?(l.reject(C?new ne(k.WS_DISCONNECT,"websocket is closed: ".concat(D)):new ne(k.WS_ERR,"init websocket failed: ".concat(D))),P&&R.error("[".concat(r.name,"] init websocket failed: ").concat(D))):h&&h(y)}return l.promise})()}reconnectWithAction(i){var r=arguments,a=this;return x(function*(){let l=!(r.length>1&&void 0!==r[1])||r[1];if(a.reconnectCount>=a.retryConfig.maxRetryCount||0===a.urls.length||"closed"===a.state)return!1;R.warning("[choose-best-ws] action: =>",i),a.onlineReconnectListener||Hn.isOnline||!Hn.onlineWaiter||(a.onlineReconnectListener=Hn.onlineWaiter.then(()=>{a.onlineReconnectListener=void 0}));let d=!0;if(a.reconnectInterrupter=()=>d=!1,l){const m=eE(a.reconnectCount,a.retryConfig);R.debug("[".concat(a.name,"] wait ").concat(m,"ms to reconnect websocket, mode: ").concat(i)),yield q.race([si(m),a.onlineReconnectListener||new q(()=>{})])}if("closed"===a._state||!d)return!1;a.reconnectCount+=1;const h=function(){var m=x(function*(g,E){a.emit(Ne.RECONNECT_CREATE_CONNECTION,E),yield a.createWebSocketConnection(g)});return function(E,y){return m.apply(this,arguments)}}();try{if("retry"===i)a.emit(Ne.RECONNECT_WAITTING_FINISH,i),yield h(a.urls[a.currentURLIndex],i);else if("tryNext"===i){if(a.currentURLIndex+=1,a.currentURLIndex>=a.urls.length)return a.reconnectWithAction("recover",!1);R.debug("[".concat(a.name,"] websocket url length: ").concat(a.urls.length," current index: ").concat(a.currentURLIndex)),a.emit(Ne.RECONNECT_WAITTING_FINISH,i),yield h(a.urls[a.currentURLIndex],i)}else"recover"===i&&(R.debug("[".concat(a.name,"] request new urls")),a.resetReconnectCount("recover mode"),a.emit(Ne.RECONNECT_WAITTING_FINISH,i),a.urls=yield vn(a,Ne.REQUEST_NEW_URLS),a.currentURLIndex=0,yield h(a.urls[a.currentURLIndex],i))}catch(m){var f;R.error("[".concat(a.name,"] reconnect failed ").concat(m&&m.toString()));const g=null==m||null===(f=m.data)||void 0===f?void 0:f.desc;return Array.isArray(g)&&we(g).call(g,"dynamic key expired")?(a.emit(Ne.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):a.reconnectWithAction(i,l)}return!0})()}}class S_ extends dT{constructor(i,r){super(i,r,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(i,r){var a=this;return x(function*(){const l=io(),d=new kD(a.forceCloseTimeout,a.store);a.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),d.closeAllWebsockets(),l.reject(new ne(k.WS_ABORT,"choose best websocket aborted"))};const h=H("GATEWAY_DOMAINS");return R.debug("[choose-best-ws] currentDomain: ",i,", domains: ",h,"total: ".concat(a.urls.length),"current: ".concat(a.currentURLIndex+1)),d.chooseBestWebsocket(i,a.tryDoubleDomain,a.use443PortOnly,r).then(l.resolve).catch(l.reject),l.promise.finally(()=>{a.closeEstablishingWs=void 0})})()}}class T_ extends dT{constructor(i,r){super(i,r,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(i,r){var a=this;return x(function*(){return new q((l,d)=>{let h=!1;const f=[];a.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),f.forEach(P=>{P.onclose=null,P.onopen=null,P.onmessage=null,P.close()}),d(new ne(k.WS_ABORT,"choose best websocket aborted"))};const m=H("GATEWAY_DOMAINS");let g;const E=i.indexOf("?h="),y=m.find(P=>-1!==E?we(i).call(i,P,E):we(i).call(i,P));R.debug("[choose-best-ws] currentDomain: ",y,", domains: ",m);let C=!a.tryDoubleDomain||!y;if(!C&&y){var b;const P=Date.now();try{m.forEach(D=>{const L=-1===E?i.replace(y,D):i.substr(0,E)+i.substr(E).replace(y,D),B=new WebSocket(L);B.binaryType="arraybuffer",f.push(B),R.debug("[choose-best-ws] ws is connecting:",B.url)})}catch(D){for(R.debug("[choose-best-ws] ws create failed, fallback to single url"),f.forEach(L=>L.close());f.length;)f.pop();C=!0}null===(b=a.store)||void 0===b||b.recordJoinChannelService({urls:f.map(D=>D.url),service:"gateway"},r),f.forEach(D=>{D.onopen=()=>{if(h)return;const L=Date.now()-P;R.debug("[choose-best-ws] ws open cost ".concat(L,"ms")),f.filter(B=>B!==D).forEach(B=>{R.debug("[choose-best-ws]close backup websocket: ".concat(B.url)),B.close()}),h=!0,l(D)},D.onclose=L=>{g=L,!h&&(f.find(B=>!(B.readyState===WebSocket.CLOSED||B.readyState===WebSocket.CLOSING))||(R.debug("[choose-best-ws] all websocket is closed"),h=!0,d(g)))},D.onmessage=L=>{R.debug("[choose-best-ws]".concat(D.url," onmessage: ").concat(L.data))}}),si(a.forceCloseTimeout).then(()=>{f.forEach(D=>{D.readyState!==WebSocket.OPEN&&D.close()})})}if(C){var O;let P;R.debug("[choose-best-ws] use single url: ",i),null===(O=a.store)||void 0===O||O.recordJoinChannelService({urls:[i],service:"gateway"},r);try{P=new WebSocket(i),f.push(P),P.binaryType="arraybuffer"}catch(D){const L=new ne(k.WS_ERR,"init websocket failed! Error: ".concat(D.toString()));return R.error("[".concat(a.name,"]").concat(L)),void d(L)}P.onopen=()=>{l(P)},P.onclose=D=>{d(D)},P.onmessage=D=>{R.debug("[choose-best-ws]".concat(P.url," onmessage: ").concat(D.data))},si(a.forceCloseTimeout).then(()=>{P&&P.readyState!==WebSocket.OPEN&&P.close()})}}).then(l=>(a.closeEstablishingWs=void 0,l)).catch(l=>{throw a.closeEstablishingWs=void 0,l})})()}}class LD extends nn{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===ze.CONNECTED?this.emit(he.WS_CONNECTED):i===ze.RECONNECTING?this.emit(he.WS_RECONNECTING,this._websocketReconnectReason):i===ze.CLOSED&&this.emit(he.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(i,r){super(),T(this,"_disconnectedReason",void 0),T(this,"_websocketReconnectReason",void 0),T(this,"_connectionState",ze.CLOSED),T(this,"reconnectToken",void 0),T(this,"websocket",void 0),T(this,"openConnectionTime",void 0),T(this,"clientId",void 0),T(this,"lastMsgTime",Date.now()),T(this,"uploadCache",[]),T(this,"uploadCacheInterval",void 0),T(this,"rttRolling",new MS(5)),T(this,"pingpongTimer",void 0),T(this,"wsInflateDataTimer",void 0),T(this,"pingpongTimeoutCount",0),T(this,"joinResponse",void 0),T(this,"multiIpOption",void 0),T(this,"initError",void 0),T(this,"spec",void 0),T(this,"store",void 0),T(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(he.ON_BINARY_DATA,a.data);const l=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(l,"_id")){const d="res-@".concat(l._id);this.emit(d,l._result,l._message)}else if(Object.prototype.hasOwnProperty.call(l,"_type")){if(this.emit(l._type,l._message),l._type===Fe.ON_NOTIFICATION&&this.handleNotification(l._message),l._type===Fe.ON_USER_BANNED)switch(l._message.error_code){case 14:this.close($e.UID_BANNED);break;case 15:this.close($e.IP_BANNED);break;case 16:this.close($e.CHANNEL_BANNED)}if(l._type===Fe.ON_USER_LICENSE_BANNED)switch(l._message.error_code){case Ie.ERR_LICENSE_MISSING:this.close($e.LICENSE_MISSING);break;case Ie.ERR_LICENSE_EXPIRED:this.close($e.LICENSE_EXPIRED);break;case Ie.ERR_LICENSE_MINUTES_EXCEEDED:this.close($e.LICENSE_MINUTES_EXCEEDED);break;case Ie.ERR_LICENSE_PERIOD_INVALID:this.close($e.LICENSE_PERIOD_INVALID);break;case Ie.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close($e.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ie.ERR_LICENSE_ILLEGAL:this.close($e.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=i.clientId,this.spec=i,this.store=r,this.websocket=new S_("gateway-".concat(this.clientId),this.spec.retryConfig,!0,H("JOIN_GATEWAY_USE_DUAL_DOMAIN"),H("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===ze.CONNECTED&&this.reconnect("retry",Si.OFFLINE)})}request(i,r,a,l){var d=this;return x(function*(){const h=Vt(6,""),f={_id:h,_type:i,_message:r},m=d.websocket.connectionID,g=()=>new q((P,D)=>{if(d.connectionState===ze.CONNECTED)return P();const L=()=>{d.off(he.WS_CLOSED,B),P()},B=()=>{d.off(he.WS_CONNECTED,L),D(new K(k.WS_ABORT))};d.once(he.WS_CONNECTED,L),d.once(he.WS_CLOSED,B),i!==ve.PUBLISH&&i!==ve.SUBSCRIBE&&i!==ve.UNSUBSCRIBE&&i!==ve.UNPUBLISH&&i!==ve.CONTROL&&i!==ve.RESTART_ICE||d.once(he.DISCONNECT_P2P,()=>{D(new K(k.DISCONNECT_P2P))}),i!==ve.PUBLISH&&i!==ve.RESTART_ICE||d.once(he.ABORT_P2P_EXECUTION,()=>{D(new K(k.DISCONNECT_P2P))})});if(d.connectionState!==ze.CONNECTING&&d.connectionState!==ze.RECONNECTING||i===ve.JOIN||i===ve.REJOIN||(yield g()),d.websocket.sendMessage(f,!0),l)return;const E=new q((P,D)=>{let L=!1;const B=(J,ae)=>{L=!0,P({isSuccess:"success"===J,message:ae||{}}),d.off(he.WS_CLOSED,V),d.off(he.WS_RECONNECTING,V),d.emit(he.REQUEST_SUCCESS,i,r)};d.once("res-@".concat(h),B);const V=()=>{D(new K(k.WS_ABORT,"type: ".concat(i))),d.off(he.WS_CLOSED,V),d.off(he.WS_RECONNECTING,V),d.off("res-@".concat(h),B)};d.once(he.WS_CLOSED,V),d.once(he.WS_RECONNECTING,V),si(H("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||L||(R.warning("[".concat(d.clientId,"] ws request timeout, type: ").concat(i)),d.emit(he.REQUEST_TIMEOUT,i,r))})});let y=null;try{y=yield E}catch(P){if(d.connectionState===ze.CLOSED||i===ve.LEAVE)throw new K(k.WS_ABORT);return!d.spec.forceWaitGatewayResponse||a?P.throw():i===ve.JOIN||i===ve.REJOIN?null:(yield g(),yield d.request(i,r))}if(y.isSuccess)return y.message;const C=Number(y.message.error_code||y.message.code),b=lu(C),O=new K(k.UNEXPECTED_RESPONSE,"".concat(b.desc,": ").concat(y.message.error_str),{code:C,data:y.message});return"success"===b.action?y.message:(R.warning("[".concat(d.clientId,"] [").concat(d.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(C,", message: ").concat(b.desc,", action: ").concat(b.action)),C===Ie.ERR_TOO_MANY_BROADCASTERS?((i===ve.JOIN||i===ve.REJOIN)&&(d.initError=O,d.close()),O.throw()):"failed"===b.action?O.throw():"quit"===b.action?(d.initError=O,d.close(),O.throw()):(C===Ie.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=y.message.option,R.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",Si.MULTI_IP)):d.reconnect(b.action,Si.SERVER_ERROR),i===ve.JOIN||i===ve.REJOIN?null:yield d.request(i,r)))})()}waitMessage(i,r){return new q(a=>{const l=d=>{(!r||r(d))&&(this.off(i,l),a(d))};this.on(i,l)})}upload(i,r){const a={_type:i,_message:r};try{this.websocket.sendMessage(a)}catch(l){const d=H("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==ze.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},H("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,r){this.websocket.sendMessage({_type:i,_message:r})}init(i,r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new q((a,l)=>{this.once(he.WS_CONNECTED,()=>a(this.joinResponse)),this.once(he.WS_CLOSED,()=>l(this.initError||new K(k.WS_ABORT))),this.connectionState=ze.CONNECTING,this.websocket.init(i).catch(l),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=i||$e.LEAVE,this.connectionState=ze.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),i===$e.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new S_("gateway-".concat(this.clientId),this.spec.retryConfig,!0,H("JOIN_GATEWAY_USE_DUAL_DOMAIN"),H("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}join(){var i=this;return x(function*(){if(!i.joinResponse){i.emit(he.ABORT_P2P_EXECUTION);const r=yield vn(i,he.REQUEST_JOIN_INFO),a=yield i.request(ve.JOIN,r);if(!a)return i.emit(he.REPORT_JOIN_GATEWAY,au.TIMEOUT,i.url||""),!1;i.joinResponse=a,i.emit(he.JOIN_RESPONSE,i.joinResponse),i.reconnectToken=i.joinResponse.rejoin_token}return i.connectionState=ze.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),!0})()}rejoin(){var i=this;return x(function*(){if(!i.reconnectToken)throw new K(k.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=Cs(i,he.REQUEST_REJOIN_INFO);r.token=i.reconnectToken;const a=yield i.request(ve.REJOIN,r);return!!a&&(i.connectionState=ze.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),a.peers&&a.peers.forEach(l=>{i.emit(Fe.ON_USER_ONLINE,{uid:l.uid}),l.audio&&i.emit(Fe.ON_ADD_AUDIO_STREAM,{uid:l.uid,uint_id:l.uint_id,audio:!0,ssrcId:l.audio_ssrc}),l.video&&i.emit(Fe.ON_ADD_VIDEO_STREAM,{uid:l.uid,uint_id:l.uint_id,video:!0,ssrcId:l.video_ssrc}),i.emit(l.audio_mute?Fe.MUTE_AUDIO:Fe.UNMUTE_AUDIO,{uid:l.uid}),i.emit(l.video_mute?Fe.MUTE_VIDEO:Fe.UNMUTE_VIDEO,{uid:l.uid}),i.emit(l.audio_enable_local?Fe.ENABLE_LOCAL_AUDIO:Fe.DISABLE_LOCAL_AUDIO,{uid:l.uid}),i.emit(l.video_enable_local?Fe.ENABLE_LOCAL_VIDEO:Fe.DISABLE_LOCAL_VIDEO,{uid:l.uid}),l.audio||l.video||i.emit(Fe.ON_REMOVE_STREAM,{uid:l.uid,uint_id:l.uint_id})}),!0)})()}reconnect(i,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,r)}handleNotification(i){R.debug("[".concat(this.clientId,"] receive notification: "),i);const r=lu(i.code);if("success"!==r.action){if("failed"!==r.action)return"quit"===r.action?("ERR_REPEAT_JOIN_CHANNEL"===r.desc&&this.close($e.UID_BANNED),void this.close()):void this.reconnect(r.action,Si.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=H("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=i&&(R.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>H("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Si.TIMEOUT):this.request(ve.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-r;this.rttRolling.add(a),H("REPORT_STATS")&&this.send(ve.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWsInflateData(){const{wsInflateLength:i,wsDeflateLength:r}=this.websocket.getWsInflateData();0!==i&&0!==r&&this.upload(gr.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:i})}handleWebsocketEvents(){this.websocket.on(Ne.RECONNECT_WAITTING_FINISH,i=>{this.emit(he.WS_RECONNECT_WAITTING_FINISH,i)}),this.websocket.on(Ne.RECONNECT_CREATE_CONNECTION,i=>{this.emit(he.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(Ne.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ne.CLOSED,()=>{this.connectionState=ze.CLOSED}),this.websocket.on(Ne.FAILED,()=>{this._disconnectedReason=$e.NETWORK_ERROR,this.connectionState=ze.CLOSED}),this.websocket.on(Ne.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState=this.connectionState===ze.CONNECTED?ze.RECONNECTING:ze.CONNECTING}),this.websocket.on(Ne.WILL_RECONNECT,(i,r,a)=>{const l=Cs(this,he.IS_P2P_DISCONNECTED),d=l||"retry"!==i;l&&"retry"===i&&(R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),i="tryNext",r=au.P2P_DISCONNECTED),d&&(R.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(i)),this.emit(he.REPORT_JOIN_GATEWAY,r||au.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(he.NEED_RENEW_SESSION),this.emit(he.DISCONNECT_P2P)),a(i)}),this.websocket.on(Ne.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(i=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(i)),this.reconnect("tryNext",Si.SERVER_ERROR)}):this.join().catch(i=>{if(this.emit(he.REPORT_JOIN_GATEWAY,i.message||i.code||au.UNKNOWN_REASON,this.url||""),i instanceof K&&i.code===k.UNEXPECTED_RESPONSE&&i.data.code===Ie.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Si.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Si.SERVER_ERROR):(this.initError=i,this.close())})}),this.websocket.on(Ne.REQUEST_NEW_URLS,(i,r)=>{vn(this,he.REQUEST_RECOVER,this.multiIpOption).then(i).catch(r)}),this.websocket.on(Ne.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Fe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var uT="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",tx=Mm,o3=hc,hT=uT,xD=Mi("".replace),ep=RegExp("^["+hT+"]+"),s3=RegExp("(^|[^"+hT+"])["+hT+"]+$"),bE=function(s){return function(i){var r=o3(tx(i));return 1&s&&(r=xD(r,ep,"")),2&s&&(r=xD(r,s3,"$1")),r}},nx={start:bE(1),end:bE(2),trim:bE(3)},a3=yg.PROPER,FD=gi,UD=uT,pT=nx.trim;Tn({target:"String",proto:!0,forced:function(s){return FD(function(){return!!UD[s]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[s]()||a3&&UD[s].name!==s})}("trim")},{trim:function(){return pT(this)}});var bi,_i,ix=Ee("String").trim,rx=js,VD=ix,fT=String.prototype,_T=wr(function(s){var i=s.trim;return"string"==typeof s||s===fT||rx(fT,s)&&i===fT.trim?VD:i});function tp(s,i,r){return{sampleRate:s,stereo:i,bitrate:r}}function ct(s,i,r,a,l){return{width:s,height:i,frameRate:r,bitrateMin:a,bitrateMax:l}}function Ds(s,i,r,a,l){return{width:{max:s},height:{max:i},frameRate:r,bitrateMin:a,bitrateMax:l}}function uu(s,i){return{numSpatialLayers:s,numTemporalLayers:i}}(function(s){s[s.CHOOSE_SERVER=11]="CHOOSE_SERVER",s[s.CLOUD_PROXY=18]="CLOUD_PROXY",s[s.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",s[s.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"})(bi||(bi={})),function(s){s.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",s.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",s.IOS_INTERRUPTION_START="ios-interruption-start",s.IOS_INTERRUPTION_END="ios-interruption-end",s.STATE_CHANGE="state-change"}(_i||(_i={}));const BD={"90p":ct(160,90),"90p_1":ct(160,90),"120p":ct(160,120,15,30,65),"120p_1":ct(160,120,15,30,65),"120p_3":ct(120,120,15,30,50),"120p_4":ct(212,120),"180p":ct(320,180,15,30,140),"180p_1":ct(320,180,15,30,140),"180p_3":ct(180,180,15,30,100),"180p_4":ct(240,180,15,30,120),"240p":ct(320,240,15,40,200),"240p_1":ct(320,240,15,40,200),"240p_3":ct(240,240,15,40,140),"240p_4":ct(424,240,15,40,220),"360p":ct(640,360,15,80,400),"360p_1":ct(640,360,15,80,400),"360p_3":ct(360,360,15,80,260),"360p_4":ct(640,360,30,80,600),"360p_6":ct(360,360,30,80,400),"360p_7":ct(480,360,15,80,320),"360p_8":ct(480,360,30,80,490),"360p_9":ct(640,360,15,80,800),"360p_10":ct(640,360,24,80,800),"360p_11":ct(640,360,24,80,1e3),"480p":ct(640,480,15,100,500),"480p_1":ct(640,480,15,100,500),"480p_2":ct(640,480,30,100,1e3),"480p_3":ct(480,480,15,100,400),"480p_4":ct(640,480,30,100,750),"480p_6":ct(480,480,30,100,600),"480p_8":ct(848,480,15,100,610),"480p_9":ct(848,480,30,100,930),"480p_10":ct(640,480,10,100,400),"720p":ct(1280,720,15,120,1130),"720p_1":ct(1280,720,15,120,1130),"720p_2":ct(1280,720,30,120,2e3),"720p_3":ct(1280,720,30,120,1710),"720p_5":ct(960,720,15,120,910),"720p_6":ct(960,720,30,120,1380),"1080p":ct(1920,1080,15,120,2080),"1080p_1":ct(1920,1080,15,120,2080),"1080p_2":ct(1920,1080,30,120,3e3),"1080p_3":ct(1920,1080,30,120,3150),"1080p_5":ct(1920,1080,60,120,4780),"1440p":ct(2560,1440,30,120,4850),"1440p_1":ct(2560,1440,30,120,4850),"1440p_2":ct(2560,1440,60,120,7350),"4k":ct(3840,2160,30,120,8910),"4k_1":ct(3840,2160,30,120,8910),"4k_3":ct(3840,2160,60,120,13500)},jD={"480p":Ds(640,480,5),"480p_1":Ds(640,480,5),"480p_2":Ds(640,480,30),"480p_3":Ds(640,480,15),"720p":Ds(1280,720,5),"720p_1":Ds(1280,720,5),"720p_2":Ds(1280,720,30),"720p_3":Ds(1280,720,15),"1080p":Ds(1920,1080,5),"1080p_1":Ds(1920,1080,5),"1080p_2":Ds(1920,1080,30),"1080p_3":Ds(1920,1080,15)},HD={"1SL1TL":uu(1,1),"3SL3TL":uu(3,3),"2SL3TL":uu(2,3)};function Ha(s){return s||(s="480p_1"),"string"==typeof s?Object.assign({},BD[s]):s}function RE(s){return"string"==typeof s?Object.assign({},jD[s]):s}function Ll(s){return"string"==typeof s?Object.assign({},HD[s]):s}const ox={speech_low_quality:tp(16e3,!1),speech_standard:tp(32e3,!1,18),music_standard:tp(48e3,!1),standard_stereo:tp(48e3,!0,56),high_quality:tp(48e3,!1,128),high_quality_stereo:tp(48e3,!0,192)};function xl(s){return"string"==typeof s?Object.assign({},ox[s]):s}const np=[];function GD(s){return pi(s,"mediaSource",["screen","window","application"]),!0}var me,Qt,Os,Fl,mT,Ul,ft,hu,rr,IE;(function(s){s.NEED_RENEGOTIATE="@need_renegotiate",s.NEED_REPLACE_TRACK="@need_replace_track",s.NEED_CLOSE="@need_close",s.NEED_ENABLE_TRACK="@need_enable_track",s.NEED_DISABLE_TRACK="@need_disable_track",s.NEED_SESSION_ID="@need_sid",s.SET_OPTIMIZATION_MODE="@set_optimization_mode",s.GET_STATS="@get_stats",s.GET_LOW_VIDEO_TRACK="@get_low_video_track",s.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",s.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",s.NEED_MUTE_TRACK="@need_mute_track",s.NEED_UNMUTE_TRACK="@need_unmute_track"})(me||(me={})),function(s){s.SCREEN_TRACK="screen_track",s.CUSTOM_TRACK="custome_track",s.LOW_STREAM="low_stream"}(Qt||(Qt={})),function(s){s[s.HIGH_STREAM=0]="HIGH_STREAM",s[s.LOW_STREAM=1]="LOW_STREAM"}(Os||(Os={})),function(s){s[s.HIGH_STREAM=0]="HIGH_STREAM",s[s.LOW_STREAM=1]="LOW_STREAM"}(Fl||(Fl={})),function(s){s[s.DISABLE=0]="DISABLE",s[s.LOW_STREAM=1]="LOW_STREAM",s[s.AUDIO_ONLY=2]="AUDIO_ONLY"}(mT||(mT={})),function(s){s.TRANSCEIVER_UPDATED="transceiver-updated"}(Ul||(Ul={})),function(s){s.SOURCE_STATE_CHANGE="source-state-change",s.TRACK_ENDED="track-ended",s.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",s.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",s.CLOSED="closed"}(ft||(ft={})),function(s){s.FIRST_FRAME_DECODED="first-frame-decoded",s.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(hu||(hu={})),function(s){s.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",s.RECEIVE_TRACK_BUFFER="receive_track_buffer",s.ON_AUDIO_BUFFER="on_audio_buffer",s.UPDATE_SOURCE="update_source"}(rr||(rr={})),function(s){s.UPDATE_TRACK_SOURCE="update-track-source"}(IE||(IE={}));const gT={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},WD={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},wE={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},ET={uplinkNetworkQuality:0,downlinkNetworkQuality:0},yT={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var Fi,yr,pu,kc,Yi;(function(s){s.ON_TRACK="on_track",s.ON_NODE="on_node"})(Fi||(Fi={})),function(s){s.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",s.REQUEST_CONSTRAINTS="request_constraints"}(yr||(yr={})),function(s){s.IDLE="IDLE",s.INITING="INITING",s.INITEND="INITEND"}(pu||(pu={})),function(s){s.STATE_CHANGE="state_change",s.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",s.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",s.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(kc||(kc={})),function(s){s.NONE="none",s.INIT="init",s.CANPLAY="canplay",s.PLAYING="playing",s.PAUSED="paused",s.SUSPEND="suspend",s.STALLED="stalled",s.WAITING="waiting",s.ERROR="error",s.DESTROYED="destroyed",s.ABORT="abort",s.ENDED="ended",s.EMPTIED="emptied",s.LOADEDDATA="loadeddata"}(Yi||(Yi={}));const vT={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};var fu;!function(s){s.OPEN="open",s.MESSAGE="message",s.CLOSE="close",s.CLOSING="closing",s.ERROR="error"}(fu||(fu={}));class AE extends nn{constructor(i,r){super(),T(this,"_ID",void 0),T(this,"_rtpTransceiver",void 0),T(this,"_lowRtpTransceiver",void 0),T(this,"_hints",[]),T(this,"_isClosed",!1),T(this,"_originMediaStreamTrack",void 0),T(this,"_mediaStreamTrack",void 0),T(this,"_external",{}),this._ID=r||Vt(8,"track-"),this._originMediaStreamTrack=i,this._mediaStreamTrack=i,we(np).call(np,this)||np.push(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(i){if(!i){Te.reportApiInvoke(null,{name:jn.GET_MEDIA_STREAM_TRACK,options:[],tag:Kt.TRACER}).onSuccess(this._mediaStreamTrack&&"string"==typeof this._mediaStreamTrack.label?this._mediaStreamTrack.label:"")}return this._mediaStreamTrack}getRTCRtpTransceiver(i){return i===Os.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(i){const r=np.indexOf(i);-1!==r&&np.splice(r,1)}(this),this.emit(ft.CLOSED)}_updateRtpTransceiver(i,r){if(r===Os.LOW_STREAM){if(this._lowRtpTransceiver===i)return;this._lowRtpTransceiver=i}else{if(this._rtpTransceiver===i)return;this._rtpTransceiver=i}this.emit(Ul.TRANSCEIVER_UPDATED,i,r)}}class jt extends AE{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(i){this._processorContext=i}constructor(i,r){super(i,r),T(this,"_enabled",!0),T(this,"_muted",!1),T(this,"_isExternalTrack",!1),T(this,"_isClosed",!1),T(this,"_enabledMutex",void 0),T(this,"processor",void 0),T(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Gn("".concat(this.getTrackId())),i.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var i,r;return null!==(i=null===(r=this._originMediaStreamTrack)||void 0===r?void 0:r.label)&&void 0!==i?i:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,R.debug("[".concat(this.getTrackId(),"] close")),this.emit(me.NEED_CLOSE),super.close())}_updateOriginMediaStreamTrack(i,r){var a=arguments,l=this;return x(function*(){l._isExternalTrack=a.length>2&&void 0!==a[2]&&a[2],i!==l._originMediaStreamTrack&&(l._originMediaStreamTrack&&(l._originMediaStreamTrack.removeEventListener("ended",l._handleTrackEnded),r&&l._originMediaStreamTrack.stop()),i.addEventListener("ended",l._handleTrackEnded),l._originMediaStreamTrack=i,l._muted&&(l._originMediaStreamTrack.enabled=!1),l._mediaStreamTrack=l._originMediaStreamTrack,l._updatePlayerSource(),yield Ht(l,me.NEED_REPLACE_TRACK,l),l.processor&&l.processor.updateInput({track:l._originMediaStreamTrack,context:l.processorContext}))})()}_getDefaultPlayerConfig(){return{}}onTrackEnded(){R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ft.TRACK_ENDED)}stateCheck(i,r){if(R.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(i,": ").concat(r,"]")),$d(r,i),this._enabled&&this._muted&&"enabled"===i&&!1===r)throw new ne(k.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",R);if(!this._enabled&&!this._muted&&"muted"===i&&!0===r)throw new ne(k.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",R)}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function pa(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}const Xo=window.AudioContext||window.webkitAudioContext;let fn=null;const Mt=new class extends nn{constructor(){var s;super(...arguments),s=this,T(this,"prevState",void 0),T(this,"curState",void 0),T(this,"currentTime",void 0),T(this,"currentTimeStuckAt",void 0),T(this,"interruptDetectorTrack",void 0),T(this,"onLocalAudioTrackMute",()=>{R.info("ios15-interruption-start"),this.emit(_i.IOS_15_16_INTERRUPTION_START)}),T(this,"onLocalAudioTrackUnmute",x(function*(){R.info("ios15-interruption-end"),"running"!==s.curState||s.duringInterruption?R.info("ios15-interruption-end-canceled"):(fn&&(yield fn.suspend()),s.emit(_i.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(s){R.debug("webaudio bindInterruptDetectorTrack ".concat(s.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=s,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(s){R.debug("webaudio unbindInterruptDetectorTrack ".concat(s.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===s&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function _u(){if(!fn){if(function(){if(!Xo)return void R.error("your browser is not support web audio");R.info("create audio context");const s=function(i){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?pa(Object(a),!0).forEach(function(l){T(i,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):pa(Object(a)).forEach(function(l){Object.defineProperty(i,l,Object.getOwnPropertyDescriptor(a,l))})}return i}({},H("WEBAUDIO_INIT_OPTIONS"));var i;R.debug("audio context init option:",JSON.stringify(s)),fn=new Xo(s),Mt.curState=fn.state,fn.onstatechange=()=>{Mt.prevState=Mt.curState,Mt.curState=fn?fn.state:void 0;const{prevState:i,curState:r}=Mt,a="running"===r,l="interrupted"===r,d="running"===i,h="suspended"===i,f="interrupted"===i,m=pt().osVersion;(Ci()||Fa())&&d&&l&&(R.info("ios".concat(m,"-interruption-start")),Mt.emit(_i.IOS_INTERRUPTION_START)),(Ci()||Fa())&&(h||f)&&a&&(R.info("ios".concat(m,"-interruption-end")),Mt.emit(_i.IOS_INTERRUPTION_END)),i!==r&&(R.debug("AudioContext State Change","".concat(i,"=>").concat(r)),Mt.emit(_i.STATE_CHANGE))},setInterval(()=>{var i;const r=null===(i=fn)||void 0===i?void 0:i.currentTime;Mt.currentTime!==r?(Mt.currentTimeStuckAt&&(R.debug("AudioContext current time resume at ".concat(r)),Mt.currentTimeStuckAt=void 0),Mt.currentTime=r):(r!==Mt.currentTimeStuckAt&&(Te.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:r},tag:Kt.TRACER}).onSuccess(),R.warning("AudioContext current time stuck at ".concat(r))),Mt.currentTimeStuckAt=r)},5e3),(i=x(function*(r){const a=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let l,d=!1,h=!1,f=!1;function m(L){"running"===r.state?g(!1):Ci()||Fa()?"suspended"===r.state&&(g(!0),L&&r.resume().then(y,y)):"closed"!==r.state&&(g(!0),L&&r.resume().then(y,y))}function g(L){if(d!==L){d=L;for(let B=0,V=a;B<V.length;B+=1){const J=V[B];L?window.addEventListener(J,C,{capture:!0,passive:!0}):window.removeEventListener(J,C,{capture:!0,passive:!0})}}}function y(){m(!1)}function C(){m(!0)}function b(L){if(!f)if(l.paused)if(L){let B;O(!1),f=!0;try{B=l.play(),B?B.then(P,P):(l.addEventListener("playing",P),l.addEventListener("abort",P),l.addEventListener("error",P))}catch(V){P()}}else O(!0);else O(!1)}function O(L){if(h!==L){h=L;for(let B=0,V=a;B<V.length;B++){const J=V[B];L?window.addEventListener(J,D,{capture:!0,passive:!0}):window.removeEventListener(J,D,{capture:!0,passive:!0})}}}function P(){l.removeEventListener("playing",P),l.removeEventListener("abort",P),l.removeEventListener("error",P),f=!1,b(!1)}function D(){b(!0)}if(Ci()){const L=r.createMediaStreamDestination(),B=document.createElement("div");B.innerHTML="<audio x-webkit-airplay='deny'></audio>",l=B.children.item(0),l.controls=!1,l.disableRemotePlayback=!0,l.preload="auto",l.srcObject=L.stream,b(!0)}Mt.on(_i.STATE_CHANGE,function(){m(!0)}),m(!1)}),function(r){return i.apply(this,arguments)})(fn)}(),!fn)throw new ne(k.NOT_SUPPORTED,"can not create audio context");return fn}return fn}function qD(){return!!fn}function Vl(s){if(function(){if(null!==DE)return DE;const a=_u(),l=a.createBufferSource(),d=a.createGain(),h=a.createGain();l.connect(d),l.connect(h),l.disconnect(d);let f=!1;try{l.disconnect(d)}catch(m){f=!0}return l.disconnect(),DE=f,f}())return;const i=s.connect,r=s.disconnect;s.connect=(a,l,d)=>{var h;return s._inputNodes||(s._inputNodes=[]),we(h=s._inputNodes).call(h,a)||(a instanceof AudioNode?(s._inputNodes.push(a),i.call(s,a,l,d)):i.call(s,a,l)),s},s.disconnect=(a,l,d)=>{r.call(s),a?Ti(s._inputNodes,a):s._inputNodes=[];for(const h of s._inputNodes)i.call(s,h)}}let DE=null;function zD(s,i){let r=!1;const a=1/i;if(H("DISABLE_WEBAUDIO")){const l=window.setInterval(()=>{r?window.clearInterval(l):s(performance.now()/1e3)},1e3*a)}else{const l=_u();let d=l.createGain();d.gain.value=0,d.connect(l.destination);const h=()=>{if(r)return void(d=null);const f=l.createOscillator();f.onended=h,f.connect(d),f.start(0),f.stop(l.currentTime+a),s(l.currentTime)};h()}return()=>{r=!0}}const _n={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1};function Rt(){return _n}class YD{constructor(){T(this,"context",void 0),T(this,"analyserNode",void 0),T(this,"sourceNode",void 0),this.context=_u(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(i){if(i!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch(r){}this.sourceNode=i,null==i||i.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Ci()||Fa()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode))return 0;const i=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(i);else{const a=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(a);for(let l=0;l<i.length;++l)i[l]=a[l]/128-1}const r=Ba(i).call(i,(a,l)=>a+l*l,0)/i.length;return Math.max(10*Math.log10(r)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var i,r;null===(i=this.sourceNode)||void 0===i||i.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(r=this.sourceNode)||void 0===r||r.connect(this.analyserNode)}catch(a){R.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class $D extends nn{get processSourceNode(){return this.sourceNode}set processedNode(i){var r;if(!this.isDestroyed&&this._processedNode!==i){try{var a;null===(a=this.sourceNode)||void 0===a||a.disconnect(this.outputNode)}catch(l){}null===(r=this._processedNode)||void 0===r||r.disconnect(),this._processedNode=i,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),T(this,"outputNode",void 0),T(this,"outputTrack",void 0),T(this,"isPlayed",!1),T(this,"context",void 0),T(this,"audioBufferNode",void 0),T(this,"destNode",void 0),T(this,"audioOutputLevel",0),T(this,"volumeLevelAnalyser",void 0),T(this,"_processedNode",void 0),T(this,"playNode",void 0),T(this,"isDestroyed",!1),T(this,"onNoAudioInput",void 0),T(this,"isNoAudioInput",!1),T(this,"_noAudioInputCount",0),this.context=_u(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Vl(this.outputNode),this.volumeLevelAnalyser=new YD}startGetAudioBuffer(i){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(i),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=r=>{this.emit(rr.ON_AUDIO_BUFFER,function(a){for(let l=0;l<a.outputBuffer.numberOfChannels;l+=1){const d=a.outputBuffer.getChannelData(l);for(let h=0;h<d.length;h+=1)d[h]=0}return a.inputBuffer}(r))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Rt().webAudioMediaStreamDest)throw new ne(k.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(i){"running"!==this.context.state&&Ko(()=>{Mt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=i||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(i){}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}checkHasAudioInput(){var i=arguments,r=this;return x(function*(){let a=i.length>0&&void 0!==i[0]?i[0]:0;if(a>5)return r.isNoAudioInput=!0,r.onNoAudioInput&&r.onNoAudioInput(),!1;Ci()||Fa()?"suspended"===r.context.state&&r.context.resume():"running"!==r.context.state&&r.context.resume();const l=r.volumeLevelAnalyser.getAnalyserNode();let d;l.getFloatTimeDomainData?(d=new Float32Array(l.fftSize),l.getFloatTimeDomainData(d)):(d=new Uint8Array(l.fftSize),l.getByteTimeDomainData(d));let h=!1;for(let f=0;f<d.length;f++)0!==d[f]&&(h=!0);return h?(r.isNoAudioInput=!1,!0):(yield si(200),(yield r.checkHasAudioInput(a?a+1:1))&&h)})()}getAudioVolume(){return this.outputNode.gain.value}setVolume(i){this.outputNode.gain.setValueAtTime(i,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var i,r;null===(i=this.processedNode)||void 0===i||i.disconnect(),null===(r=this.sourceNode)||void 0===r||r.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var i;this.processedNode?null===(i=this.processedNode)||void 0===i||i.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class JD extends $D{get isFreeze(){return!1}constructor(i,r,a){var l,d;if(super(),l=this,T(this,"sourceNode",void 0),T(this,"track",void 0),T(this,"clonedTrack",void 0),T(this,"audioElement",void 0),T(this,"isCurrentTrackCloned",!1),T(this,"isRemoteTrack",!1),T(this,"originVolumeLevelAnalyser",void 0),T(this,"rebuildWebAudio",x(function*(){if(R.debug("ready to rebuild web audio, state:",l.context.state),l.isNoAudioInput&&(yield l.checkHasAudioInput()),!l.isNoAudioInput||l.isDestroyed)return document.body.removeEventListener("click",l.rebuildWebAudio,!0),void R.debug("rebuild web audio success, current volume status",l.getAccurateVolumeLevel());l.context.resume().then(()=>R.info("resume success")),R.debug("rebuild web audio because of ios 12 bugs"),l.disconnect();const m=l.track;l.track=l.track.clone(),l.isCurrentTrackCloned?m.stop():l.isCurrentTrackCloned=!0;const g=new MediaStream([l.track]);l.sourceNode=l.context.createMediaStreamSource(g),Vl(l.sourceNode),l.volumeLevelAnalyser.rebuildAnalyser();const E=l.outputNode.gain.value;l.outputNode=l.context.createGain(),l.outputNode.gain.setValueAtTime(E,l.context.currentTime),Vl(l.outputNode),l.emit(rr.UPDATE_SOURCE),l.connect(),l.audioElement.srcObject=g,l.isPlayed&&l.play(l.playNode),l.checkHasAudioInput()})),"audio"!==i.kind)throw new ne(k.UNEXPECTED_ERROR);this.track=i;const h=new MediaStream([this.track]);if(this.isRemoteTrack=!!r,this.sourceNode=this.context.createMediaStreamSource(h),Vl(this.sourceNode),a){const m=a.clone();m.enabled=!0,this.clonedTrack=m,R.debug("create an unmuted track ".concat(m.id," from the original track ").concat(a.id," to get the volume"));const g=this.context.createMediaStreamSource(new MediaStream([m]));Vl(g),this.originVolumeLevelAnalyser=new YD,this.originVolumeLevelAnalyser.updateSource(g)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=h;const f=pt();r&&f.os===vi.IOS&&Number(null===(d=f.osVersion)||void 0===d?void 0:d.split(".")[0])<15&&(Mt.on(_i.STATE_CHANGE,()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(i){this.sourceNode.disconnect(),this.track=i,this.isCurrentTrackCloned=!1;const r=new MediaStream([i]);this.sourceNode=this.context.createMediaStreamSource(r),Vl(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(rr.UPDATE_SOURCE),this.audioElement.srcObject=r}destroy(){var i;this.audioElement.srcObject=null,this.audioElement.remove(),Mt.off("state-change",this.rebuildWebAudio),null===(i=this.originVolumeLevelAnalyser)||void 0===i||i.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(i){return this.context.createMediaStreamSource(new MediaStream([i]))}updateOriginTrack(i){const r=i.clone();r.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=r),R.debug("create an unmuted track ".concat(r.id," from the original track ").concat(i.id," to get the volume"));const a=this.context.createMediaStreamSource(new MediaStream([r]));Vl(a),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(a)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}function ip(s,i,r){return CT.apply(this,arguments)}function CT(){return CT=x(function*(s,i,r){const a=(d,h)=>d?"number"!=typeof d?d.max||d.exact||d.ideal||d.min||h:d:h,l={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxHeight:a(i.height,1080),maxWidth:a(i.width,1920)}}};return i.frameRate&&"number"!=typeof i.frameRate?(l.video.mandatory.maxFrameRate=i.frameRate.max,l.video.mandatory.minFrameRate=i.frameRate.min):"number"==typeof i.frameRate&&(l.video.mandatory.maxFrameRate=i.frameRate),yield navigator.mediaDevices.getUserMedia(l)}),CT.apply(this,arguments)}function ST(s,i){return TT.apply(this,arguments)}function TT(){return TT=x(function*(s,i){const r=yield bT(s.mediaSource),{sourceId:a,audio:l}=yield function(d){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new q((f,m)=>{const g=document.createElement("div");g.innerText="share screen",g.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const E=document.createElement("div");E.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const y=document.createElement("div");y.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",y.setAttribute("style","height: 12%;");const C=document.createElement("div");C.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const b=document.createElement("div");b.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const O=document.createElement("button");O.innerHTML="cancel",O.setAttribute("style","width: 85px;"),O.onclick=()=>{document.body.removeChild(L);const B=new Error("NotAllowedError");B.name="NotAllowedError",m(B)};let P=h;const D=document.createElement("div");if(h){const B=document.createElement("input");B.setAttribute("type","checkbox");const V=document.createElement("span");B.setAttribute("style","margin-right: 6px;"),V.innerText="Share audio",B.checked=P,B.onchange=()=>{P=B.checked},D.appendChild(B),D.appendChild(V)}b.appendChild(D),b.appendChild(O),E.appendChild(y),E.appendChild(C),E.appendChild(b);const L=document.createElement("div");L.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),L.appendChild(g),L.appendChild(E),document.body.appendChild(L),d.map(B=>{if(B.id){const V=document.createElement("div");V.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let J=B.thumbnail;try{const{width:ae}=J.getSize();ae>1920&&(J=J.resize({width:1920}))}catch(ae){throw ae&&ae.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),ae}V.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+J.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+B.name.replace(/[\u00A0-\u9999<>\&]/g,function(ae){return"&#"+ae.charCodeAt(0)+";"})+"</span>",V.onclick=()=>{document.body.removeChild(L),f({sourceId:B.id,audio:P})},C.appendChild(V)}})})}(r,i);return yield ip(a,s,l)}),TT.apply(this,arguments)}function bT(s){return RT.apply(this,arguments)}function RT(){return RT=x(function*(s){let i=["window","screen"];"application"!==s&&"window"!==s||(i=["window"]),"screen"===s&&(i=["screen"]);const r=Xd();if(!r)throw console.error("failed to fetch electron, please mount it to window"),new ne(k.ELECTRON_IS_NULL);let a=null;try{var l;a=(null===(l=r.desktopCapturer)||void 0===l?void 0:l.getSources({types:i}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:i})}catch(d){a=null}a&&a.then||(a=new q((d,h)=>{r.desktopCapturer.getSources({types:i},(f,m)=>{f?h(f):d(m)})}));try{return yield a}catch(d){throw new ne(k.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}),RT.apply(this,arguments)}function XD(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}const b_=new Gn("safari");let IT=!1,wT=!1;function Dr(s,i){return R_.apply(this,arguments)}function R_(){return R_=x(function*(s,i){let r=0,a=null;for(;r<2;)try{a=yield c3(s,i,r>0);break}catch(l){if(l instanceof ne)throw R.error("[".concat(i,"] ").concat(l.toString())),l;const d=NE(l.name||l.code||l,l.message);if(d.code===k.MEDIA_OPTION_INVALID){R.debug("[".concat(i,"] detect media option invalid, retry")),r+=1,yield si(500);continue}throw R.error("[".concat(i,"] ").concat(d.toString())),d}if(!a)throw new ne(k.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return a}),R_.apply(this,arguments)}function c3(s,i,r){return OE.apply(this,arguments)}function OE(){return OE=x(function*(s,i,r){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new ne(k.NOT_SUPPORTED,"can not find getUserMedia");r&&(s.video&&(delete s.video.width,delete s.video.height),s.screen&&(delete s.screen.width,delete s.screen.height));const a=Rt(),l=new MediaStream;if(s.audioSource&&l.addTrack(s.audioSource),s.videoSource&&l.addTrack(s.videoSource),!s.audio&&!s.video&&!s.screen)return R.debug("Using Video Source/ Audio Source"),l;if(s.screen)if(Xd())mu(l,s.screen.sourceId?yield ip(s.screen.sourceId,s.screen,s.screenAudio):yield ST(s.screen,s.screenAudio));else if(zg()&&s.screen.extensionId&&s.screen.mandatory){if(!a.getStreamFromExtension)throw new ne(k.NOT_SUPPORTED,"This browser does not support screen sharing");R.debug("[".concat(i,'] Screen access on chrome stable, looking for extension"'));const C=yield(h=s.screen.extensionId,f=i,new q((b,O)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},P=>{if(!P||!P.streamId)return R.error("[".concat(f,"] No response from Chrome Plugin. Plugin not installed properly"),P),void O(new ne(k.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));b(P.streamId)})}catch(P){R.error("[".concat(f,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),P.toString()),O(new ne(k.CHROME_PLUGIN_NOT_INSTALL))}}));s.screen.mandatory.chromeMediaSourceId=C,mu(l,yield navigator.mediaDevices.getUserMedia({video:{mandatory:s.screen.mandatory}}))}else if(a.getDisplayMedia){var d;s.screen.mediaSource&&GD(s.screen.mediaSource);const C={width:s.screen.width,height:s.screen.height,frameRate:s.screen.frameRate,displaySurface:null!==(d=s.screen.displaySurface)&&void 0!==d?d:"screen"===s.screen.mediaSource?"monitor":s.screen.mediaSource},{selfBrowserSurface:b,surfaceSwitching:O,systemAudio:P}=s.screen,D={selfBrowserSurface:b,surfaceSwitching:O,systemAudio:P};!b&&delete D.selfBrowserSurface,!O&&delete D.surfaceSwitching,!P&&delete D.systemAudio,R.debug("[".concat(i,"] getDisplayMedia:"),JSON.stringify({video:C,audio:!!s.screenAudio,controls:D}));const L=yield navigator.mediaDevices.getDisplayMedia(function(B){for(var V=1;V<arguments.length;V++){var J=null!=arguments[V]?arguments[V]:{};V%2?XD(Object(J),!0).forEach(function(ae){T(B,ae,J[ae])}):Object.getOwnPropertyDescriptors?Object.defineProperties(B,Object.getOwnPropertyDescriptors(J)):XD(Object(J)).forEach(function(ae){Object.defineProperty(B,ae,Object.getOwnPropertyDescriptor(J,ae))})}return B}({video:C,audio:!!s.screenAudio},D));mu(l,L)}else{if(!Pt())throw R.error("[".concat(i,"] This browser does not support screenSharing")),new ne(k.NOT_SUPPORTED,"This browser does not support screen sharing");{s.screen.mediaSource&&GD(s.screen.mediaSource);const C={video:{mediaSource:s.screen.mediaSource,width:s.screen.width,height:s.screen.height,frameRate:s.screen.frameRate}};R.debug("[".concat(i,"] getUserMedia: ").concat(JSON.stringify(C))),mu(l,yield navigator.mediaDevices.getUserMedia(C))}}var h,f;if(!s.video&&!s.audio)return l;let m={video:s.video,audio:s.audio},g=H("MEDIA_DEVICE_CONSTRAINTS");if(g)try{"string"==typeof g&&(g=JSON.parse(g)),m=Zg(m,g)}catch(C){}R.debug("[".concat(i,"] GetUserMedia"),JSON.stringify(m)),pt();let E,y=null;(Yt()||Ci()||s_())&&(y=yield b_.lock());try{E=yield navigator.mediaDevices.getUserMedia(m)}catch(C){throw y&&y(),C}return m.audio&&(IT=!0),m.video&&(wT=!0),mu(l,E),y&&y(),l}),OE.apply(this,arguments)}function NE(s,i){switch(s){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new ne(k.MEDIA_OPTION_INVALID,"".concat(s,": ").concat(i));case"NotFoundError":case"DevicesNotFoundError":return new ne(k.DEVICE_NOT_FOUND,"".concat(s,": ").concat(i));case"NotSupportedError":return new ne(k.NOT_SUPPORTED,"".concat(s,": ").concat(i));case"NotReadableError":return new ne(k.NOT_READABLE,"".concat(s,": ").concat(i));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new ne(k.PERMISSION_DENIED,"".concat(s,": ").concat(i));case"ConstraintNotSatisfiedError":return new ne(k.CONSTRAINT_NOT_SATISFIED,"".concat(s,": ").concat(i));default:return R.error("getUserMedia unexpected error",s),new ne(k.UNEXPECTED_ERROR,"".concat(s,": ").concat(i))}}function mu(s,i){const r=s.getVideoTracks()[0],a=s.getAudioTracks()[0],l=i.getVideoTracks()[0],d=i.getAudioTracks()[0];d&&(a&&s.removeTrack(a),s.addTrack(d)),l&&(r&&s.removeTrack(r),s.addTrack(l))}const Or=new class extends nn{get state(){return this._state}set state(s){s!==this._state&&(this.emit(kc.STATE_CHANGE,s),this._state=s)}constructor(){super(),T(this,"_state",pu.IDLE),T(this,"isAccessMicrophonePermission",!1),T(this,"isAccessCameraPermission",!1),T(this,"lastAccessMicrophonePermission",!1),T(this,"lastAccessCameraPermission",!1),T(this,"checkdeviceMatched",!1),T(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(H("ENUMERATE_DEVICES_INTERVAL")||(Jg()||Kg()===vi.HARMONY_OS)&&Il())&&this.updateDevicesInfo()},H("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(s=>R.error(s.toString()))}enumerateDevices(s,i){var r=arguments,a=this;return x(function*(){let l=r.length>2&&void 0!==r[2]&&r[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new ne(k.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const d=yield navigator.mediaDevices.enumerateDevices(),h=a.checkMediaDeviceInfoIsOk(d);let f=!a.isAccessMicrophonePermission&&s,m=!a.isAccessCameraPermission&&i;h.audio&&(f=!1),h.video&&(m=!1);let g=null,E=null,y=null;if(!l&&(f||m)){if(b_.isLocked&&(R.debug("[device manager] wait GUM lock"),(yield b_.lock())(),R.debug("[device manager] GUM unlock")),IT&&(f=!1,a.isAccessMicrophonePermission=!0),wT&&(m=!1,a.isAccessCameraPermission=!0),R.debug("[device manager] check media device permissions",s,i,f,m),f&&m){try{y=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(C){const b=NE(C.name||C.code||C,C.message);if(b.code===k.PERMISSION_DENIED)throw b;R.warning("getUserMedia failed in getDevices",b)}a.isAccessCameraPermission=!0,a.isAccessMicrophonePermission=!0}else if(f){try{g=yield navigator.mediaDevices.getUserMedia({audio:s})}catch(C){const b=NE(C.name||C.code||C,C.message);if(b.code===k.PERMISSION_DENIED)throw b;R.warning("getUserMedia failed in getDevices",b)}a.isAccessMicrophonePermission=!0}else if(m){try{E=yield navigator.mediaDevices.getUserMedia({video:i})}catch(C){const b=NE(C.name||C.code||C,C.message);if(b.code===k.PERMISSION_DENIED)throw b;R.warning("getUserMedia failed in getDevices",b)}a.isAccessCameraPermission=!0}R.debug("[device manager] mic permission",s,"cam permission",i)}try{const C=yield navigator.mediaDevices.enumerateDevices();return g&&g.getTracks().forEach(b=>b.stop()),E&&E.getTracks().forEach(b=>b.stop()),y&&y.getTracks().forEach(b=>b.stop()),g=null,E=null,y=null,C}catch(C){return g&&g.getTracks().forEach(b=>b.stop()),E&&E.getTracks().forEach(b=>b.stop()),y&&y.getTracks().forEach(b=>b.stop()),g=null,E=null,y=null,new ne(k.ENUMERATE_DEVICES_FAILED,C.toString()).throw()}})()}getRecordingDevices(){var s=arguments,i=this;return x(function*(){let r=s.length>0&&void 0!==s[0]&&s[0];return(yield i.enumerateDevices(!0,!1,r)).filter(a=>"audioinput"===a.kind)})()}getCamerasDevices(){var s=arguments,i=this;return x(function*(){let r=s.length>0&&void 0!==s[0]&&s[0];return(yield i.enumerateDevices(!1,!0,r)).filter(a=>"videoinput"===a.kind)})()}getSpeakers(){var s=arguments,i=this;return x(function*(){let r=s.length>0&&void 0!==s[0]&&s[0];return(yield i.enumerateDevices(!0,!1,r)).filter(a=>"audiooutput"===a.kind)})()}searchDeviceIdByName(s){let i=null;return this.deviceInfoMap.forEach(r=>{r.device.label===s&&(i=r.device.deviceId)}),i}getDeviceById(s){var i=this;return x(function*(){const r=(yield i.enumerateDevices(!0,!0,!0)).find(a=>a.deviceId===s);if(!r)throw new ne(k.DEVICE_NOT_FOUND,"deviceId: ".concat(s));return r})()}init(){var s=this;return x(function*(){s.state=pu.INITING;try{yield s.updateDevicesInfo(),s.state=pu.INITEND}catch(i){throw R.warning("Device Detection functionality cannot start properly.",i.toString()),s.state=pu.IDLE,!("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)&&new ne(k.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),i}})()}updateDevicesInfo(){var s=this;return x(function*(){const i=yield s.enumerateDevices(!0,!0,!0),r=Date.now(),a=[];if(i[0]&&i[0].label&&!1===s.checkdeviceMatched){s.checkdeviceMatched=!0;const d=i.find(f=>"audioinput"===f.kind&&"default"===f.deviceId),h=i.find(f=>"audiooutput"===f.kind&&"default"===f.deviceId);d&&h?h.groupId===d.groupId?R.debug("[device-check] default input ".concat(d.label," and output ").concat(h.label," is the same group")):R.warning("[device-check] default input ".concat(d.label," and output ").concat(h.label," is not the same group")):R.debug("[device-check] default input or output not found")}const l=s.checkMediaDeviceInfoIsOk(i);if(i.forEach(d=>{if(!d.deviceId)return;const h=s.deviceInfoMap.get("".concat(d.kind,"_").concat(d.deviceId));if("ACTIVE"!==(h?h.state:"INACTIVE")){const f={initAt:r,updateAt:r,device:d,state:"ACTIVE"};s.deviceInfoMap.set("".concat(d.kind,"_").concat(d.deviceId),f),a.push(f)}h&&(h.updateAt=r)}),s.deviceInfoMap.forEach((d,h)=>{"ACTIVE"===d.state&&d.updateAt!==r&&(d.state="INACTIVE",a.push(d))}),s.state!==pu.INITEND)return l.audio&&(s.lastAccessMicrophonePermission=!0,s.isAccessMicrophonePermission=!0),void(l.video&&(s.lastAccessCameraPermission=!0,s.isAccessCameraPermission=!0));a.forEach(d=>{switch(d.device.kind){case"audioinput":s.lastAccessMicrophonePermission&&s.isAccessMicrophonePermission&&s.emit(kc.RECORDING_DEVICE_CHANGED,d);break;case"videoinput":s.lastAccessCameraPermission&&s.isAccessCameraPermission&&s.emit(kc.CAMERA_DEVICE_CHANGED,d);break;case"audiooutput":s.lastAccessMicrophonePermission&&s.isAccessMicrophonePermission&&s.emit(kc.PLAYOUT_DEVICE_CHANGED,d)}}),l.audio&&(s.lastAccessMicrophonePermission=!0,s.isAccessMicrophonePermission=!0),l.video&&(s.lastAccessCameraPermission=!0,s.isAccessCameraPermission=!0)})()}checkMediaDeviceInfoIsOk(s){const i=s.filter(l=>"audioinput"===l.kind),r=s.filter(l=>"videoinput"===l.kind),a={audio:!1,video:!1};for(const l of i)if(l.label&&l.deviceId){a.audio=!0;break}for(const l of r)if(l.label&&l.deviceId){a.video=!0;break}return a}};let PE=!1;const So=new class extends nn{constructor(){super(...arguments),T(this,"onAutoplayFailed",void 0),T(this,"onAudioAutoplayFailed",void 0)}};function ME(){if(pt(),!PE){const s=i=>{i.preventDefault(),PE=!1,a_()?document.body.removeEventListener("click",s,!0):(document.body.removeEventListener("touchstart",s,!0),document.body.removeEventListener("mousedown",s,!0))};PE=!0,a_()?document.body.addEventListener("click",s,!0):(document.body.addEventListener("touchstart",s,!0),document.body.addEventListener("mousedown",s,!0)),R.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),So.onAutoplayFailed?So.onAutoplayFailed():R.warning(So.onAudioAutoplayFailed?"AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .":"We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),So.emit("autoplay-failed")}}function kE(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function QD(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?kE(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):kE(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function ZD(s,i,r,a){if(!s)return;const l=Te.getBaseInfoBySessionId(s);if(!l)return;const d=l.info,h=Date.now(),f=QD(QD({},d),{},{vid:void 0===d.vid?0:Number(d.vid),lts:h,elapse:h-l.startTime,cbRegistered:So.onAutoplayFailed||So.onAudioAutoplayFailed?1:-1,errorMsg:r,mediaType:i,trackId:a,extend:void 0});Te.send({type:Xt.AUTOPLAY_FAILED,data:f},!0)}const eO=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],qr=new class{constructor(){T(this,"onAutoplayFailed",void 0),T(this,"elementMap",new Map),T(this,"elementStateMap",new Map),T(this,"elementsNeedToResume",[]),T(this,"sinkIdMap",new Map),T(this,"autoResumeAfterInterruption",()=>{Array.from(this.elementMap.entries()).forEach(s=>{let[i,r]=s;const a=this.elementStateMap.get(i),l=r.srcObject.getAudioTracks()[0];Yd()?l&&"live"===l.readyState&&"running"===Mt.curState&&(R.debug("auto resume after interruption for iOS 15"),r.pause(),r.play()):a&&"paused"===a&&l&&"live"===l.readyState&&"running"===Mt.curState&&(R.debug("auto resume after interruption for iOS"),r.play())})}),T(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(s=>{let[i,r]=s;const a=r.srcObject.getAudioTracks()[0];a&&"live"===a.readyState&&(R.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r.pause(),r.play())})}),this.autoResumeAudioElement(),Mt.on(_i.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Mt.on(_i.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Mt.on(_i.STATE_CHANGE,()=>{Ci()&&"suspended"===Mt.prevState&&"running"===Mt.curState&&this.autoResumeAfterInterruption()})}setSinkID(s,i){var r=this;return x(function*(){const a=r.elementMap.get(s);if(r.sinkIdMap.set(s,i),a)try{yield a.setSinkId(i)}catch(l){throw new ne(k.PERMISSION_DENIED,"can not set sink id: "+l.toString())}})()}play(s,i,r,a){if(this.elementMap.has(i))return;const l=document.createElement("audio");l.autoplay=!0,l.srcObject=new MediaStream([s]),this.bindAudioElementEvents(i,l),this.elementMap.set(i,l),this.elementStateMap.set(i,Yi.INIT),this.setVolume(i,r);const d=this.sinkIdMap.get(i);if(d)try{l.setSinkId(d).catch(f=>{R.warning("[".concat(i,"] set sink id failed"),f.toString())})}catch(f){R.warning("[".concat(i,"] set sink id failed"),f.toString())}const h=l.play();h&&h.then&&h.catch(f=>{a&&ZD(a,"audio",f.message,i),R.warning("audio element play warning",f.toString()),this.elementMap.has(i)&&"NotAllowedError"===f.name&&(R.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(l),Ko(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),ME()}))})}updateTrack(s,i){const r=this.elementMap.get(s);r&&(r.srcObject=new MediaStream([i]))}isPlaying(s){return this.elementMap.has(s)&&"playing"===this.elementStateMap.get(s)}setVolume(s,i){const r=this.elementMap.get(s);r&&(i=Math.max(0,Math.min(100,i)),r.volume=i/100)}stop(s){const i=this.elementMap.get(s);if(this.sinkIdMap.delete(s),!i)return;const r=this.elementsNeedToResume.indexOf(i);this.elementsNeedToResume.splice(r,1),i.srcObject=null,i.remove(),this.elementMap.delete(s),this.elementStateMap.delete(s)}bindAudioElementEvents(s,i){eO.forEach(r=>{i.addEventListener(r,a=>{const l=this.elementStateMap.get(s),d="pause"===a.type?"paused":a.type;if(R.debug("[".concat(s,"] audio-element-status change ").concat(l," => ").concat(d)),"error"===a.type){const h=null==i?void 0:i.error;h&&R.error("[".concat(s,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(s,d)})})}getPlayerState(s){return this.elementStateMap.get(s)||"uninit"}autoResumeAudioElement(){const s=()=>{this.elementsNeedToResume.forEach(i=>{i.play().then(r=>{R.debug("Auto resume audio element success")}).catch(r=>{R.warning("Auto resume audio element failed!",r)})}),this.elementsNeedToResume=[]};new q(i=>{document.body?i():window.addEventListener("load",()=>i())}).then(()=>{a_()?document.body.addEventListener("click",s,!0):(document.body.addEventListener("touchstart",s,!0),document.body.addEventListener("mousedown",s,!0))})}};function Dn(){return function(s,i,r){const a=r.value;return"function"==typeof a&&(r.value=function(){this._isClosed&&new ne(k.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",R);for(var l=arguments.length,d=new Array(l),h=0;h<l;h++)d[h]=arguments[h];const f=a.apply(this,d);return f instanceof q?new q((m,g)=>{f.then(m).catch(g)}):f}),r}}function tO(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function I_(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?tO(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):tO(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class AT extends nn{constructor(i){super(),T(this,"name","VideoProcessorDestination"),T(this,"ID","0"),T(this,"_source",void 0),T(this,"videoContext",void 0),T(this,"inputTrack",void 0),this.videoContext=i}get kind(){return"video"}get enabled(){return!0}pipe(){throw new ne(k.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new ne(k.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(i){if(i.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");i.track&&i.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=i.track,this.emit(Fi.ON_TRACK,i.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Fi.ON_TRACK,void 0)}}class nO extends nn{set chained(i){this._chained=i}get chained(){return this._chained}constructor(i,r){super(),T(this,"constraintsMap",new Map),T(this,"statsRegistry",[]),T(this,"usageRegistry",[]),T(this,"trackId",void 0),T(this,"direction",void 0),T(this,"_chained",!1),this.trackId=i,this.direction=r}getConstraints(){var i=this;return x(function*(){return yield vn(i,yr.REQUEST_CONSTRAINTS)})()}requestApplyConstraints(i,r){var a=this;return x(function*(){var l;return R.info("processor ".concat(r.name," requestApplyConstraints for ").concat(a.trackId)),i&&a.constraintsMap.set(r,i),Ht(a,yr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ze(l=a.constraintsMap).call(l)))})()}requestRevertConstraints(i){var r=this;return x(function*(){var a;if(r.constraintsMap.has(i))return R.info("processor ".concat(i.name," requestRevertConstraints for ").concat(r.trackId)),r.constraintsMap.delete(i),Ht(r,yr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ze(a=r.constraintsMap).call(a)))})()}registerStats(i,r,a){this.statsRegistry.find(l=>l.processorID===i.ID&&l.processorName===i.name&&l.type===r)||this.statsRegistry.push({processorName:i.name,processorID:i.ID,type:r,cb:a})}unregisterStats(i,r){const a=this.statsRegistry.findIndex(l=>l.processorID===i.ID&&l.processorName===i.name&&l.type===r);-1!==a&&this.statsRegistry.splice(a,1)}gatherStats(){const i=[];for(const{processorID:r,processorName:a,type:l,cb:d}of this.statsRegistry)try{const h=d();i.push({processorID:r,processorName:a,type:l,stats:h})}catch(h){R.error(new ne(k.UNEXPECTED_ERROR,h.message))}return i}registerUsage(i,r){this.usageRegistry.find(a=>a.processorID===i.ID&&a.processorName===i.name)||this.usageRegistry.push({processorID:i.ID,processorName:i.name,cb:r})}unregisterUsage(i){const r=this.usageRegistry.findIndex(a=>a.processorID===i.ID&&a.processorName===i.name);-1!==r&&this.usageRegistry.splice(r,1)}gatherUsage(){var i=this;return x(function*(){const r=[];if(!i.chained)return[];for(const{cb:a}of i.usageRegistry)try{let l=a();l instanceof q&&(l=yield l),r.push(I_(I_({},l),{},{direction:i.direction}))}catch(l){R.error("gather extension usage error",l)}return r})()}getDirection(){return this.direction}}class LE extends nn{constructor(i){super(),T(this,"name","AudioProcessorDestination"),T(this,"ID","0"),T(this,"inputTrack",void 0),T(this,"inputNode",void 0),T(this,"audioProcessorContext",void 0),T(this,"_source",void 0),this.audioProcessorContext=i}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new ne(k.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new ne(k.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Fi.ON_TRACK,void 0),this.emit(Fi.ON_NODE,void 0)}updateInput(i){if(i.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");i.track&&this.inputTrack!==i.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=i.track,this.emit(Fi.ON_TRACK,this.inputTrack)),i.node&&this.inputNode!==i.node&&(this.audioProcessorContext.chained=!0,this.inputNode=i.node,this.emit(Fi.ON_NODE,this.inputNode))}}class w_ extends nn{set chained(i){this._chained=i}get chained(){return this._chained}constructor(i,r,a){super(),T(this,"constraintsMap",new Map),T(this,"statsRegistry",[]),T(this,"audioContext",void 0),T(this,"trackId",void 0),T(this,"direction",void 0),T(this,"usageRegistry",[]),T(this,"_chained",!1),this.audioContext=i,this.trackId=r,this.direction=a}getConstraints(){var i=this;return x(function*(){return vn(i,yr.REQUEST_CONSTRAINTS)})()}getAudioContext(){return this.audioContext}requestApplyConstraints(i,r){var a=this;return x(function*(){var l;return R.info("processor ".concat(r.name," requestApplyConstraints for ").concat(a.trackId)),i&&a.constraintsMap.set(r,i),Ht(a,yr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ze(l=a.constraintsMap).call(l)))})()}requestRevertConstraints(i){var r=this;return x(function*(){var a;if(r.constraintsMap.has(i))return r.constraintsMap.delete(i),Ht(r,yr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ze(a=r.constraintsMap).call(a)))})()}registerStats(i,r,a){this.statsRegistry.find(l=>l.processorID===i.ID&&l.processorName===i.name&&l.type===r)||this.statsRegistry.push({processorName:i.name,processorID:i.ID,type:r,cb:a})}unregisterStats(i,r){const a=this.statsRegistry.findIndex(l=>l.processorID===i.ID&&l.processorName===i.name&&l.type===r);-1!==a&&this.statsRegistry.splice(a,1)}gatherStats(){const i=[];for(const{processorID:r,processorName:a,type:l,cb:d}of this.statsRegistry)try{const h=d();i.push({processorID:r,processorName:a,type:l,stats:h})}catch(h){R.error(new ne(k.UNEXPECTED_ERROR,h.message))}return i}registerUsage(i,r){this.usageRegistry.find(a=>a.processorID===i.ID&&a.processorName===i.name)||this.usageRegistry.push({processorID:i.ID,processorName:i.name,cb:r})}unregisterUsage(i){const r=this.usageRegistry.findIndex(a=>a.processorID===i.ID&&a.processorName===i.name);-1!==r&&this.usageRegistry.splice(r,1)}gatherUsage(){var i=this;return x(function*(){const r=[];if(!i.chained)return[];for(const{cb:a}of i.usageRegistry)try{let l=a();l instanceof q&&(l=yield l),r.push(I_(I_({},l),{},{direction:i.direction}))}catch(l){R.error("gather extension usage error",l)}return r})()}getDirection(){return this.direction}}class DT extends nn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),T(this,"context",void 0),T(this,"processSourceNode",void 0),T(this,"outputTrack",void 0),T(this,"processedNode",void 0),T(this,"clonedTrack",void 0),T(this,"outputNode",void 0),this.outputNode=new iO}setVolume(){}createOutputTrack(){throw new ne(k.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class iO{disconnect(){}connect(){}}let gu=null;class rO{constructor(){T(this,"state","open"),T(this,"trigger",void 0),T(this,"tasks",[]),R.debug("[macro-task-queue] is created."),this.trigger=window.setTimeout(()=>{this.state="closed",R.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map(i=>i.key),"]")),this.trigger=void 0,this.tasks.forEach(i=>{let{func:r}=i;return r()}),this.tasks.length=0,R.debug("[macro-task-queue] is closed.")})}enqueue(i,r){"closed"!==this.state&&(this.tasks.push({key:i,func:r}),R.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof i?i:"")))}runTask(i){if("closed"===this.state)return;const r=this.tasks.findIndex(a=>a.key===i);if(-1!==r){const a=this.tasks.splice(r,1);R.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof i?i:"")),a[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,R.debug("[macro-task-queue] is closed."))}}function xE(s){return function(i,r,a){var l;const d=null!==(l=a.value)&&void 0!==l?l:a.get,h=function(){gu&&"open"===gu.state&&gu.runTask(s);for(var f=arguments.length,m=new Array(f),g=0;g<f;g++)m[g]=arguments[g];return null==d?void 0:d.apply(this,...m)};return a.value?a.value=h:a.get=h,a}}function oO(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function OT(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?oO(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):oO(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class vt extends jt{get _source(){return this._trackSource}set _source(i){this._trackSource=i}get processorContext(){return this._processorContext}set processorContext(i){this._processorContext=i}get processorDestination(){return this._processorDestination}set processorDestination(i){this._processorDestination=i}get isPlaying(){return this._useAudioElement?qr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(i,r,a,l,d){super(i,a),T(this,"trackMediaType","audio"),T(this,"_encoderConfig",void 0),T(this,"_trackSource",void 0),T(this,"_enabled",!0),T(this,"_volume",100),T(this,"_useAudioElement",!1),T(this,"_bypassWebAudio",!1),T(this,"processor",void 0),T(this,"_processorContext",void 0),T(this,"_processorDestination",void 0),T(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!l;const h=()=>{this.processorContext=new w_(this._source.context,this.getTrackId(),"local"),this.processorDestination=new LE(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(rr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})},f=d&&Yt()&&!qD();H("DISABLE_WEBAUDIO")?(this._source=new DT,this._useAudioElement=!0,this._bypassWebAudio=!0):f?this._source=new DT:(this._source=new JD(i,!1,this._getOriginVolumeLevel?i:void 0),H("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),h(),!H("DISABLE_WEBAUDIO")&&f&&(gu||(gu=new rO),gu).enqueue("INIT_WEBAUDIO",()=>{this._source=new JD(i,!1,this._getOriginVolumeLevel?i:void 0),H("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),h(),this.emit(IE.UPDATE_TRACK_SOURCE)})}setVolume(i){Ut(i,"volume",0,1e3),this._volume=i,this._source.setVolume(i/100),this._useAudioElement&&qr.setVolume(this.getTrackId(),i);try{if(this._bypassWebAudio)return void R.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,Ht(this,me.NEED_REPLACE_TRACK,this).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(a=>{R.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),a)}))}catch(r){}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}setPlaybackDevice(i){var r=this;return x(function*(){if(!r._useAudioElement)throw new ne(k.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield qr.setSinkID(r.getTrackId(),i)})()}setEnabled(i,r,a){var l=this;return x(function*(){return l._setEnabled(i,r,a)})()}_setEnabled(i,r,a){var l=this;return x(function*(){if(!a){if(i===l._enabled)return;l.stateCheck("enabled",i)}if(R.info("[".concat(l.getTrackId(),"] start setEnabled"),i),i){l._originMediaStreamTrack.enabled=!0;try{a||(l._enabled=!0),yield Ht(l,me.NEED_ENABLE_TRACK,l),R.info("[".concat(l.getTrackId(),"] setEnabled to ").concat(i," success"))}catch(d){throw a||(l._enabled=!1),R.error("[".concat(l.getTrackId(),"] setEnabled to true error"),d.toString()),d}}else{l._originMediaStreamTrack.enabled=!1,a||(l._enabled=!1);try{yield Ht(l,me.NEED_DISABLE_TRACK,l)}catch(d){throw a||(l._enabled=!0),R.error("[".concat(l.getTrackId(),"] setEnabled to false error"),d.toString()),d}}})()}setMuted(i){var r=this;return x(function*(){i!==r._muted&&(r.stateCheck("muted",i),r._muted=i,r._originMediaStreamTrack.enabled=!i,R.debug("[".concat(r.getTrackId(),"] start set muted: ").concat(i)),i?yield Ht(r,me.NEED_MUTE_TRACK,r):yield Ht(r,me.NEED_UNMUTE_TRACK,r))})()}getStats(){return Bh(()=>{R.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),ro(this,me.GET_STATS)||OT({},gT)}setAudioFrameCallback(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!i)return this._source.removeAllListeners(rr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(rr.ON_AUDIO_BUFFER),this._source.on(rr.ON_AUDIO_BUFFER,a=>i(a))}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] start audio playback in element")),qr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?qr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),i&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&qr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}_updateOriginMediaStreamTrack(i,r){var a=this;return x(function*(){a._originMediaStreamTrack!==i&&(a._originMediaStreamTrack&&(a._originMediaStreamTrack.removeEventListener("ended",a._handleTrackEnded),r&&a._originMediaStreamTrack.stop()),i.addEventListener("ended",a._handleTrackEnded),a._originMediaStreamTrack=i,a._muted&&(a._originMediaStreamTrack.enabled=!1),a.processor&&a.processor.updateInput({track:i,context:a.processorContext}),a._mediaStreamTrack!==a._source.outputTrack?(a._mediaStreamTrack=a._originMediaStreamTrack,a._updatePlayerSource(),yield Ht(a,me.NEED_REPLACE_TRACK,a)):a._source.updateTrack(a._originMediaStreamTrack),a._getOriginVolumeLevel&&a._source.updateOriginTrack(i))})()}renewMediaStreamTrack(i){return q.resolve(void 0)}pipe(i){if(this._bypassWebAudio)throw new ne(k.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===i)return i;if(i._source)throw new ne(k.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),i}unpipe(){var i;if(!this.processor)return;const r=this.processor;null===(i=this._source.processSourceNode)||void 0===i||i.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){var i=this;this.processorDestination.on(Fi.ON_TRACK,function(){var r=x(function*(a){a?a!==i._mediaStreamTrack&&(i._mediaStreamTrack=a,i._updatePlayerSource(!1),i._source.processedNode=i._source.createMediaStreamSourceNode(a),yield Ht(i,me.NEED_REPLACE_TRACK,i)):i._mediaStreamTrack!==i._originMediaStreamTrack&&(i._mediaStreamTrack=i._originMediaStreamTrack,i._updatePlayerSource(),yield Ht(i,me.NEED_REPLACE_TRACK,i))});return function(a){return r.apply(this,arguments)}}()),this.processorDestination.on(Fi.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Fi.ON_TRACK),this.processorDestination.removeAllListeners(Fi.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(yr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(yr.REQUEST_CONSTRAINTS)}}oe([xE("INIT_WEBAUDIO"),N("design:type",Object),N("design:paramtypes",[Object])],vt.prototype,"_source",null),oe([xE("INIT_WEBAUDIO"),N("design:type",w_),N("design:paramtypes",[w_])],vt.prototype,"processorContext",null),oe([xE("INIT_WEBAUDIO"),N("design:type",LE),N("design:paramtypes",[LE])],vt.prototype,"processorDestination",null),oe([Oe({argsMap:(s,i)=>[s.getTrackId(),i],throttleTime:300}),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],vt.prototype,"setVolume",null),oe([Oe({argsMap:(s,i)=>[s.getTrackId(),i]}),Dn(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],vt.prototype,"setPlaybackDevice",null),oe([jh("LocalAudioTrack","_enabledMutex"),Oe({argsMap:(s,i)=>[s.getTrackId(),i]}),Dn(),N("design:type",Function),N("design:paramtypes",[Boolean,Object,Boolean]),N("design:returntype",q)],vt.prototype,"setEnabled",null),oe([jh("LocalAudioTrack","_enabledMutex"),Oe({argsMap:(s,i)=>[s.getTrackId(),i]}),Dn(),N("design:type",Function),N("design:paramtypes",[Boolean]),N("design:returntype",q)],vt.prototype,"setMuted",null),oe([Dn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",Object)],vt.prototype,"getStats",null),oe([Dn(),N("design:type",Function),N("design:paramtypes",[Object,Number]),N("design:returntype",void 0)],vt.prototype,"setAudioFrameCallback",null),oe([Oe({argsMap:s=>[s.getTrackId()]}),Dn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],vt.prototype,"play",null),oe([Oe({argsMap:s=>[s.getTrackId()]}),Dn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],vt.prototype,"stop",null),oe([Oe({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],vt.prototype,"close",null),oe([Oe({argsMap:(s,i)=>[s.getTrackId(),i.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],vt.prototype,"pipe",null),oe([Oe({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],vt.prototype,"unpipe",null);class Lc extends vt{get __className__(){return"MicrophoneAudioTrack"}constructor(i,r,a,l){super(i,r.encoderConfig?xl(r.encoderConfig):{},l,H("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),T(this,"_config",void 0),T(this,"_deviceName","default"),T(this,"_constraints",void 0),T(this,"_originalConstraints",void 0),T(this,"_enabled",!0),this._config=r,this._constraints=a,this._originalConstraints=a,this._deviceName=i.label,"boolean"==typeof r.bypassWebAudio&&(this._bypassWebAudio=r.bypassWebAudio),(Yd()||$g())&&Mt.bindInterruptDetectorTrack(this),this.on(IE.UPDATE_TRACK_SOURCE,()=>{this.bindProcessorContextEvents()}),qD()&&this.bindProcessorContextEvents()}setDevice(i){var r=this;return x(function*(){if(R.info("[".concat(r.getTrackId(),"] start set device to ").concat(i)),r._enabled)try{const a=yield Or.getDeviceById(i),l={};l.audio=OT({},r._constraints),l.audio.deviceId={exact:i},r._originMediaStreamTrack.stop();let d=null;try{d=yield Dr(l,r.getTrackId())}catch(h){throw R.error("[".concat(r.getTrackId(),"] setDevice failed"),h.toString()),d=yield Dr({audio:r._constraints},r.getTrackId()),yield r._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),h}yield r._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),r._deviceName=a.label,r._config.microphoneId=i,r._constraints.deviceId={exact:i}}catch(a){throw R.error("[".concat(r.getTrackId(),"] setDevice error"),a.toString()),a}else try{const a=yield Or.getDeviceById(i);r._deviceName=a.label,r._config.microphoneId=i,r._constraints.deviceId={exact:i}}catch(a){throw R.error("[".concat(r.getTrackId(),"] setDevice error"),a.toString()),a}R.info("[".concat(r.getTrackId(),"] set device to ").concat(i," success"))})()}setEnabled(i,r,a){var l=()=>super._setEnabled,d=this;return x(function*(){if(r)return R.debug("[".concat(d.getTrackId(),"] setEnabled false (do not close microphone)")),yield l().call(d,i);if(!a){if(i===d._enabled)return;d.stateCheck("enabled",i)}if(R.info("[".concat(d.getTrackId(),"] start setEnabled"),i),!i){var h;d._originMediaStreamTrack.onended=null,d._originMediaStreamTrack.stop(),null===(h=d._source.clonedTrack)||void 0===h||h.stop(),a||(d._enabled=!1);try{yield Ht(d,me.NEED_DISABLE_TRACK,d)}catch(g){throw R.error("[".concat(d.getTrackId(),"] setEnabled false failed"),g.toString()),g}return}const f=OT({},d._constraints),m=Or.searchDeviceIdByName(d._deviceName);m&&!f.deviceId&&(f.deviceId=m);try{a||(d._enabled=!0);const g=yield Dr({audio:d._constraints},d.getTrackId());yield d._updateOriginMediaStreamTrack(g.getAudioTracks()[0],!1),yield Ht(d,me.NEED_ENABLE_TRACK,d)}catch(g){throw a||(d._enabled=!1),R.error("[".concat(d.getTrackId(),"] setEnabled true failed"),g.toString()),g}R.info("[".concat(d.getTrackId(),"] setEnabled success"))})()}close(){super.close(),(Yd()||$g())&&Mt.unbindInterruptDetectorTrack(this)}onTrackEnded(){var i=this;if((Ci()||Fa())&&this._enabled&&!this._isClosed&&Mt.duringInterruption){const r=function(){var a=x(function*(){Mt.off(_i.IOS_INTERRUPTION_END,r),i._enabled&&!i._isClosed&&(R.debug("[".concat(i.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),yield i.setEnabled(!1),yield i.setEnabled(!0))});return function(){return a.apply(this,arguments)}}();Mt.on(_i.IOS_INTERRUPTION_END,r)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ft.TRACK_ENDED)}renewMediaStreamTrack(i){var r=this;return x(function*(){const a=i||r._constraints,l=Or.searchDeviceIdByName(r._deviceName);if(l&&!a.deviceId&&(a.deviceId=l),r._constraints=a,r._enabled){r._originMediaStreamTrack.stop();const d=yield Dr({audio:r._constraints},r.getTrackId());yield r._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!0)}})()}bindProcessorContextEvents(){var i=this;this.processorContext.on(yr.REQUEST_UPDATE_CONSTRAINTS,function(){var r=x(function*(a,l,d){try{const h=Object.assign({},i._originalConstraints,...a);yield i.renewMediaStreamTrack(h),l()}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this.processorContext.on(yr.REQUEST_CONSTRAINTS,function(){var r=x(function*(a){a(i._originMediaStreamTrack.getSettings())});return function(a){return r.apply(this,arguments)}}())}}oe([Oe({argsMap:(s,i)=>[s.getTrackId(),i]}),Dn(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Lc.prototype,"setDevice",null),oe([jh("MicrophoneAudioTrack","_enabledMutex"),Oe({argsMap:(s,i,r)=>[s.getTrackId(),i,r]}),Dn(),N("design:type",Function),N("design:paramtypes",[Boolean,Boolean,Boolean]),N("design:returntype",q)],Lc.prototype,"setEnabled",null),oe([Oe({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Lc.prototype,"close",null);class Eu extends vt{get __className__(){return"BufferSourceAudioTrack"}constructor(i,r,a,l){super(r.createOutputTrack(),a,l),T(this,"source",void 0),T(this,"_bufferSource",void 0),this.source=i,this._bufferSource=r,this._bufferSource.on(rr.AUDIO_SOURCE_STATE_CHANGE,d=>{this.safeEmit(ft.SOURCE_STATE_CHANGE,d)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(d){}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(i){i&&this._bufferSource.updateOptions(i),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(i){this._bufferSource.seekAudioBuffer(i)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(i){Ut(i,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(i)}}oe([Oe({argsMap:(s,i)=>[s.getTrackId(),i,s.duration]}),Dn(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],Eu.prototype,"startProcessAudioBuffer",null),oe([Oe({argsMap:s=>[s.getTrackId()]}),Dn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Eu.prototype,"pauseProcessAudioBuffer",null),oe([Oe({argsMap:s=>[s.getTrackId()]}),Dn(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],Eu.prototype,"seekAudioBuffer",null),oe([Oe({argsMap:s=>[s.getTrackId()]}),Dn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Eu.prototype,"resumeProcessAudioBuffer",null),oe([Oe({argsMap:s=>[s.getTrackId()]}),Dn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Eu.prototype,"stopProcessAudioBuffer",null),oe([Oe({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Eu.prototype,"close",null),oe([Oe({argsMap:s=>[s.getTrackId()]}),Dn(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],Eu.prototype,"setAudioBufferPlaybackSpeed",null);class ei extends vt{get __className__(){return"MixingAudioTrack"}get isActive(){for(const i of this.trackList)if(i._enabled&&!i._isClosed&&!i.muted)return!0;return!1}constructor(){const i=_u().createMediaStreamDestination();super(i.stream.getAudioTracks()[0],void 0,Vt(8,"track-mix-")),T(this,"trackList",void 0),T(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(r){}this.destNode=i,this.trackList=[]}hasAudioTrack(i){return-1!==this.trackList.indexOf(i)}addAudioTrack(i){-1===this.trackList.indexOf(i)?(R.debug("add ".concat(i.getTrackId()," to mixing track")),i._source.outputNode.connect(this.destNode),this.trackList.push(i),this.updateEncoderConfig()):R.debug("track ".concat(i.getTrackId()," is already added"))}removeAudioTrack(i){if(-1!==this.trackList.indexOf(i)){R.debug("remove ".concat(i.getTrackId()," from mixing track"));try{i._source.outputNode.disconnect(this.destNode)}catch(r){}Ti(this.trackList,i),this.updateEncoderConfig()}}updateEncoderConfig(){const i={};this.trackList.forEach(r=>{r._encoderConfig&&((r._encoderConfig.bitrate||0)>(i.bitrate||0)&&(i.bitrate=r._encoderConfig.bitrate),(r._encoderConfig.sampleRate||0)>(i.sampleRate||0)&&(i.sampleRate=r._encoderConfig.sampleRate),(r._encoderConfig.sampleSize||0)>(i.sampleSize||0)&&(i.sampleSize=r._encoderConfig.sampleSize),r._encoderConfig.stereo&&(i.stereo=!0))}),this._encoderConfig=i}_updateRtpTransceiver(i){this._rtpTransceiver!==i&&(this._rtpTransceiver=i,this.trackList.forEach(r=>{r instanceof ei?r.emit(Ul.TRANSCEIVER_UPDATED,i):r._updateRtpTransceiver(i)}))}}function NT(s){const i={};s.facingMode&&(i.facingMode=s.facingMode),s.cameraId&&(i.deviceId={exact:s.cameraId});const r=Ha(s.encoderConfig);return null!=r.width&&(i.width=r.width),null!=r.height&&(i.height=r.height),!DA()&&r.frameRate&&(i.frameRate=r.frameRate),pt().name===St.EDGE&&"object"==typeof i.frameRate&&(i.frameRate.max=60),Pt()&&(i.frameRate={ideal:30,max:30}),i}function sx(s){const i={};if(DA()||(void 0!==s.AGC&&(i.autoGainControl=s.AGC),void 0!==s.AEC&&(i.echoCancellation=s.AEC),void 0!==s.ANS&&(i.noiseSuppression=s.ANS,zg()&&s.ANS&&(i.googHighpassFilter=s.ANS))),s.encoderConfig){const r=xl(s.encoderConfig);i.channelCount=r.stereo?2:1,i.sampleRate=r.sampleRate,i.sampleSize=r.sampleSize}return s.microphoneId&&(i.deviceId={exact:s.microphoneId}),Jg()&&(i.sampleRate=void 0),i}class l3 extends $D{set currentState(i){i!==this._currentState&&(this._currentState=i,this.safeEmit(rr.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),T(this,"audioBuffer",void 0),T(this,"sourceNode",void 0),T(this,"startPlayTime",0),T(this,"startPlayOffset",0),T(this,"pausePlayTime",0),T(this,"options",void 0),T(this,"currentLoopCount",0),T(this,"currentPlaybackSpeed",100),T(this,"_currentState","stopped"),this.audioBuffer=i,this.options=r,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:(this.playbackSpeed/100*(this.context.currentTime-this.startPlayTime)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(i){"stopped"===this.currentState?(this.options=i,this.startPlayOffset=this.options.startPlayTime||0):R.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(i){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=i,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=i))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch(i){}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(i){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=i/100),this.currentPlaybackSpeed=i}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const i=this.context.createBufferSource();return i.buffer=this.audioBuffer,i.loop=!!this.options.loop,i.connect(this.outputNode),i.playbackRate.value=this.currentPlaybackSpeed/100,i}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const ax=new Map;function sO(){return sO=x(function*(s,i){let r=null;if("string"==typeof s){const l=ax.get(s);if(l)return R.debug("use cached audio resource: ",s),l;try{r=(yield Ss(()=>Gr.get(s,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(d){throw new ne(k.FETCH_AUDIO_FILE_FAILED,d.toString())}}else r=yield new q((d,h)=>{const f=new FileReader;f.onload=m=>{m.target?d(m.target.result):h(new ne(k.READ_LOCAL_AUDIO_FILE_ERROR))},f.onerror=()=>{h(new ne(k.READ_LOCAL_AUDIO_FILE_ERROR))},f.readAsArrayBuffer(s)});const a=yield function(l){const d=_u();return new q((h,f)=>{d.decodeAudioData(l,m=>{h(m)},m=>{f(new ne(k.DECODE_AUDIO_FILE_FAILED,m.toString()))})})}(r);return"string"==typeof s&&i&&ax.set(s,a),a}),sO.apply(this,arguments)}const aO=s=>{const i=document.createElement("canvas");return i.width=2,i.height=2,new q((r,a)=>{i.toBlob(function(){var l=x(function*(d){if(i.remove(),d){const h=yield cx(d);r({buffer:h,width:i.width,height:i.height})}else a(new ne(k.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(d){return l.apply(this,arguments)}}(),s,1)})},cx=function(){var s=x(function*(i){const r=yield i.arrayBuffer();return new Uint8Array(r)});return function(r){return s.apply(this,arguments)}}(),Bl=new class extends nn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),T(this,"_lastHiddenTime",0),T(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),R.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};function lx(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function dx(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?lx(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):lx(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class cO{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(i){i!==this._videoElementStatus&&(R.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(i)),this._videoElementStatus=i)}constructor(i){T(this,"trackId",void 0),T(this,"config",void 0),T(this,"onFirstVideoFrameDecoded",void 0),T(this,"freezeTimeCounterList",[]),T(this,"renderFreezeAccTime",0),T(this,"isKeepLastFrame",!1),T(this,"timeUpdatedCount",0),T(this,"freezeTime",0),T(this,"playbackTime",0),T(this,"lastTimeUpdatedTime",0),T(this,"autoplayFailed",!1),T(this,"videoTrack",void 0),T(this,"videoElement",void 0),T(this,"cacheVideoElement",void 0),T(this,"videoElementCheckInterval",void 0),T(this,"_videoElementStatus",Yi.NONE),T(this,"isGettingVideoDimensions",!1),T(this,"startGetVideoDimensions",()=>{const r=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return R.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(r,500)};!this.isGettingVideoDimensions&&r()}),T(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===Mt.curState&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(ES())),TS()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),T(this,"handleVideoEvents",r=>{switch(r.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Yi.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch(a){}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Yi.CANPLAY;break;case"stalled":this.videoElementStatus=Yi.STALLED;break;case"suspend":this.videoElementStatus=Yi.SUSPEND;break;case"pause":this.videoElementStatus=Yi.PAUSED,Ci()||Fa()||Yt()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Yi.WAITING;break;case"abort":this.videoElementStatus=Yi.ABORT;break;case"ended":this.videoElementStatus=Yi.ENDED;break;case"emptied":this.videoElementStatus=Yi.EMPTIED;break;case"error":{this.videoElementStatus=Yi.ERROR;const a=this.videoElement.error;a&&R.error("[".concat(this.trackId,"] media error, code: ").concat(a.code,", message: ").concat(a.message));break}case"timeupdate":{const a=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=a);const l=a-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=a,Bl.lastVisibleTime<Bl.lastHiddenTime||d<Bl.lastHiddenTime||d<Bl.lastVisibleTime)return;for(l>H("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=l),this.playbackTime+=l;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),T(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(ES())),TS()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=i.trackId,this.config=i,this.videoElement=i.element instanceof HTMLVideoElement?i.element:document.createElement("video"),Mt.on(_i.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Mt.on(_i.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var i;return null!==(i=this.videoElement.parentElement)&&void 0!==i?i:void 0}updateConfig(i){this.config=i,this.trackId=i.trackId,i.element!==this.videoElement&&(this.destroy(),this.videoElement=i.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(i){this.videoTrack!==i&&(this.videoTrack=i,this.initVideoElement())}play(i){const r=this.videoElement.play();r&&r.catch&&r.catch(l=>{i&&ZD(i,"video",l.message,this.trackId),"NotAllowedError"===l.name?(R.warning("detected video element autoplay failed",l),this.autoplayFailed=!0,this.handleAutoPlayFailed()):R.warning("[".concat(this.trackId,"] play warning: "),l)});const a=pt();if(("Safari"===a.name&&15===Number(a.version)||Yd())&&r&&r.then){const l=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};r.then(l).catch(l)}}getCurrentFrame(){const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const r=i.getContext("2d");if(!r)return R.error("create canvas context failed!"),new ImageData(2,2);r.drawImage(this.videoElement,0,0,i.width,i.height);const a=r.getImageData(0,0,i.width,i.height);return i.remove(),a}getCurrentFrameToUint8Array(i){var r=arguments,a=this;return x(function*(){let l=r.length>1&&void 0!==r[1]?r[1]:1;const d=document.createElement("canvas");d.width=a.videoElement.videoWidth,d.height=a.videoElement.videoHeight;const h=d.getContext("2d");return h?(h.drawImage(a.videoElement,0,0,d.width,d.height),new q((f,m)=>{d.toBlob(function(){var g=x(function*(E){if(d.remove(),E){const y=yield cx(E);f({buffer:y,width:d.width,height:d.height})}else m(new ne(k.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(E){return g.apply(this,arguments)}}(),i,l<0?.1:l>1?1:l)})):yield aO(i)})()}destroy(){Mt.off(_i.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Mt.off(_i.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=Yi.INIT,!this.videoElementCheckInterval&&(ux.forEach(d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{var d;(d=this.videoElement)!==document.body&&document.body.contains(d)||(this.videoElementStatus=Yi.DESTROYED)},1e3),H("ENABLE_VIDEO_FRAME_CALLBACK"))){var i,r;let d;const h=(f,m)=>{if(this.videoElementStatus===Yi.PLAYING){if(d){const y=m.presentationTime-d.presentationTime;y>H("VIDEO_FREEZE_DURATION")&&Bl.lastVisibleTime>=Bl.lastHiddenTime&&d.timestamp>Bl.lastVisibleTime&&d.timestamp>Bl.lastHiddenTime&&(this.renderFreezeAccTime+=y)}d=dx(dx({},m),{},{timestamp:f})}var g,E;H("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(g=(E=this.videoElement).requestVideoFrameCallback)||void 0===g||g.call(E,h))};null===(i=(r=this.videoElement).requestVideoFrameCallback)||void 0===i||i.call(r,h)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Jg()&&(this.videoElement.poster="noposter");const a=pt();"Safari"===a.name&&15===Number(a.version)||Yd()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.videoElement.style.objectFit=this.config.fit?this.config.fit:"cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Pt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Pt()&&this.videoElement.load());const l=this.videoElement.play();void 0!==l&&l.catch(d=>{R.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())})}resetVideoElement(){ux.forEach(i=>{this.videoElement&&this.videoElement.removeEventListener(i,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Yi.NONE}handleAutoPlayFailed(){const i=r=>{r.preventDefault(),this.videoElement.play().then(()=>{R.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(a=>{R.error(a)}),this.autoplayFailed=!1,a_()?document.body.removeEventListener("click",i,!0):(document.body.removeEventListener("touchstart",i,!0),document.body.removeEventListener("mousedown",i,!0))};a_()?document.body.addEventListener("click",i,!0):(document.body.addEventListener("touchstart",i,!0),document.body.addEventListener("mousedown",i,!0)),ME()}}const ux=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class hx extends cO{constructor(i){super(i),T(this,"container",void 0),T(this,"slot",void 0),this.slot=i.element,this.updateConfig(i)}updateConfig(i){this.config=i,this.trackId=i.trackId;const r=i.element;r!==this.slot&&(this.destroy(),this.slot=r),this.createElements()}updateVideoTrack(i){this.videoTrack!==i&&(this.videoTrack=i,this.createElements())}play(i){var r;null!==(r=this.container)&&void 0!==r&&r.contains(this.videoElement)&&super.play(i)}getCurrentFrame(){var i;return null!==(i=this.container)&&void 0!==i&&i.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}getCurrentFrameToUint8Array(i){var r=arguments,a=()=>super.getCurrentFrameToUint8Array,l=this;return x(function*(){var d;let h=r.length>1&&void 0!==r[1]?r[1]:1;return null!==(d=l.container)&&void 0!==d&&d.contains(l.videoElement)?yield a().call(l,i,h):yield aO(i)})()}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch(i){}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",H("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var i;!this.container||null!==(i=this.container)&&void 0!==i&&i.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var i;if(null!==(i=this.container)&&void 0!==i&&i.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch(r){}this.videoElement=document.createElement("video")}}resetVideoElement(){var i;null!==(i=this.container)&&void 0!==i&&i.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function px(s){return new q((i,r)=>{let a=!1;const l=document.createElement("video");l.setAttribute("autoplay",""),l.setAttribute("muted",""),l.muted=!0,l.autoplay=!0,l.setAttribute("playsinline",""),l.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(l);const d=Ci()?"canplay":"playing";l.addEventListener(d,()=>{const h=l.videoWidth,f=l.videoHeight;!h&&Pt()||(a=!0,l.srcObject=null,l.remove(),i([h,f]))}),l.srcObject=new MediaStream([s]),l.play().catch(Qg),setTimeout(()=>{a||(l.srcObject=null,l.remove(),i([l.videoWidth,l.videoHeight]))},4e3)})}const fx=function(){var s=x(function*(i,r,a){const l=function(f){const m=[];for(let g=0;g<f.length;g+=2)m.push(parseInt(f.slice(g,g+2),16));return Uint8Array.from(m)}(function(f){const m="0123456789abcdef";function g(Ce){let Se,He="";for(Se=0;Se<=3;Se++)He+=m.charAt(Ce>>8*Se+4&15)+m.charAt(Ce>>8*Se&15);return He}function E(Ce,Se){const He=(65535&Ce)+(65535&Se);return(Ce>>16)+(Se>>16)+(He>>16)<<16|65535&He}function y(Ce,Se,He,ut,mt,dt){return E((It=E(E(Se,Ce),E(ut,dt)))<<(re=mt)|It>>>32-re,He);var It,re}function C(Ce,Se,He,ut,mt,dt,It){return y(Se&He|~Se&ut,Ce,Se,mt,dt,It)}function b(Ce,Se,He,ut,mt,dt,It){return y(Se&ut|He&~ut,Ce,Se,mt,dt,It)}function O(Ce,Se,He,ut,mt,dt,It){return y(Se^He^ut,Ce,Se,mt,dt,It)}function P(Ce,Se,He,ut,mt,dt,It){return y(He^(Se|~ut),Ce,Se,mt,dt,It)}const D=function(Ce){let Se;const He=1+(Ce.length+8>>6),ut=new Array(16*He);for(Se=0;Se<16*He;Se++)ut[Se]=0;for(Se=0;Se<Ce.length;Se++)ut[Se>>2]|=Ce.charCodeAt(Se)<<Se%4*8;return ut[Se>>2]|=128<<Se%4*8,ut[16*He-2]=8*Ce.length,ut}(f);let L,B,V,J,ae,z=1732584193,Q=-271733879,X=-1732584194,te=271733878;for(L=0;L<D.length;L+=16)B=z,V=Q,J=X,ae=te,z=C(z,Q,X,te,D[L+0],7,-680876936),te=C(te,z,Q,X,D[L+1],12,-389564586),X=C(X,te,z,Q,D[L+2],17,606105819),Q=C(Q,X,te,z,D[L+3],22,-1044525330),z=C(z,Q,X,te,D[L+4],7,-176418897),te=C(te,z,Q,X,D[L+5],12,1200080426),X=C(X,te,z,Q,D[L+6],17,-1473231341),Q=C(Q,X,te,z,D[L+7],22,-45705983),z=C(z,Q,X,te,D[L+8],7,1770035416),te=C(te,z,Q,X,D[L+9],12,-1958414417),X=C(X,te,z,Q,D[L+10],17,-42063),Q=C(Q,X,te,z,D[L+11],22,-1990404162),z=C(z,Q,X,te,D[L+12],7,1804603682),te=C(te,z,Q,X,D[L+13],12,-40341101),X=C(X,te,z,Q,D[L+14],17,-1502002290),Q=C(Q,X,te,z,D[L+15],22,1236535329),z=b(z,Q,X,te,D[L+1],5,-165796510),te=b(te,z,Q,X,D[L+6],9,-1069501632),X=b(X,te,z,Q,D[L+11],14,643717713),Q=b(Q,X,te,z,D[L+0],20,-373897302),z=b(z,Q,X,te,D[L+5],5,-701558691),te=b(te,z,Q,X,D[L+10],9,38016083),X=b(X,te,z,Q,D[L+15],14,-660478335),Q=b(Q,X,te,z,D[L+4],20,-405537848),z=b(z,Q,X,te,D[L+9],5,568446438),te=b(te,z,Q,X,D[L+14],9,-1019803690),X=b(X,te,z,Q,D[L+3],14,-187363961),Q=b(Q,X,te,z,D[L+8],20,1163531501),z=b(z,Q,X,te,D[L+13],5,-1444681467),te=b(te,z,Q,X,D[L+2],9,-51403784),X=b(X,te,z,Q,D[L+7],14,1735328473),Q=b(Q,X,te,z,D[L+12],20,-1926607734),z=O(z,Q,X,te,D[L+5],4,-378558),te=O(te,z,Q,X,D[L+8],11,-2022574463),X=O(X,te,z,Q,D[L+11],16,1839030562),Q=O(Q,X,te,z,D[L+14],23,-35309556),z=O(z,Q,X,te,D[L+1],4,-1530992060),te=O(te,z,Q,X,D[L+4],11,1272893353),X=O(X,te,z,Q,D[L+7],16,-155497632),Q=O(Q,X,te,z,D[L+10],23,-1094730640),z=O(z,Q,X,te,D[L+13],4,681279174),te=O(te,z,Q,X,D[L+0],11,-358537222),X=O(X,te,z,Q,D[L+3],16,-722521979),Q=O(Q,X,te,z,D[L+6],23,76029189),z=O(z,Q,X,te,D[L+9],4,-640364487),te=O(te,z,Q,X,D[L+12],11,-421815835),X=O(X,te,z,Q,D[L+15],16,530742520),Q=O(Q,X,te,z,D[L+2],23,-995338651),z=P(z,Q,X,te,D[L+0],6,-198630844),te=P(te,z,Q,X,D[L+7],10,1126891415),X=P(X,te,z,Q,D[L+14],15,-1416354905),Q=P(Q,X,te,z,D[L+5],21,-57434055),z=P(z,Q,X,te,D[L+12],6,1700485571),te=P(te,z,Q,X,D[L+3],10,-1894986606),X=P(X,te,z,Q,D[L+10],15,-1051523),Q=P(Q,X,te,z,D[L+1],21,-2054922799),z=P(z,Q,X,te,D[L+8],6,1873313359),te=P(te,z,Q,X,D[L+15],10,-30611744),X=P(X,te,z,Q,D[L+6],15,-1560198380),Q=P(Q,X,te,z,D[L+13],21,1309151649),z=P(z,Q,X,te,D[L+4],6,-145523070),te=P(te,z,Q,X,D[L+11],10,-1120210379),X=P(X,te,z,Q,D[L+2],15,718787259),Q=P(Q,X,te,z,D[L+9],21,-343485551),z=E(z,B),Q=E(Q,V),X=E(X,J),te=E(te,ae);return g(z)+g(Q)+g(X)+g(te)}(""+r+a)).slice(0,16),d=l.slice(0,12),h=yield window.crypto.subtle.importKey("raw",l,"AES-GCM",!0,["encrypt"]);return new Uint8Array(yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:d},h,i))});return function(r,a,l){return s.apply(this,arguments)}}(),lO=function(){var s=x(function*(i,r,a){return yield fx(i.buffer,r,a)});return function(r,a,l){return s.apply(this,arguments)}}();function dO(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Qo(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?dO(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):dO(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class Ye extends jt{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Yi.PLAYING)}get processorContext(){return this._processorContext}set processorContext(i){this._processorContext=i}get __className__(){return"LocalVideoTrack"}constructor(i,r,a,l,d,h){if(super(i,d),T(this,"trackMediaType","video"),T(this,"_player",void 0),T(this,"_videoVisibleTimer",null),T(this,"_previousVideoVisibleStatus",void 0),T(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),T(this,"_encoderConfig",void 0),T(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),T(this,"_optimizationMode",void 0),T(this,"_videoHeight",void 0),T(this,"_videoWidth",void 0),T(this,"_forceBitrateLimit",void 0),T(this,"_enabled",!0),T(this,"processorDestination",void 0),T(this,"_processorContext",void 0),Yt()){const{width:f,height:m}=i.getSettings();this._videoWidth=f,this._videoHeight=m}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=r,this._scalabilityMode=a,this._optimizationMode=l,this._hints=h||[],-1===this._hints.indexOf(Qt.SCREEN_TRACK))this.updateBitrateFromProfile();else if(function(f,m,g){const E=pt();return!(E.name!==f||!E.osVersion)&&115===Number(E.version)}(St.CHROME)&&-1!==Kg().indexOf("Windows")){const f=function(m,g){if("VideoFrame"in window&&"TransformStream"in window&&Rt().supportWebRTCInsertableStream){const E=new MediaStreamTrackProcessor(m),y=new MediaStreamTrackGenerator({kind:"video"});let C,b,O=Date.now();const P=()=>{D&&(clearInterval(D),D=void 0),C&&(C.close(),C=void 0),m.stop(),b=void 0,y.removeEventListener("ended",P)};let D=window.setInterval(()=>{if(b&&C&&Date.now()-O>1e3)try{"live"===y.readyState?b.enqueue(C.clone()):P()}catch(B){P()}},1e3);const L=new TransformStream({transform:(B,V)=>{"live"===y.readyState?(b=V,O=Date.now(),void 0===C?(C=B,V.enqueue(B.clone())):(V.enqueue(C),C=B)):B.close()}});return y.addEventListener("ended",P),E.readable.pipeThrough(L).pipeTo(y.writable),y}}(i);f&&(R.info("local screen video track begin to inject frame"),this._mediaStreamTrack=f)}r&&-1!==this._hints.indexOf(Qt.CUSTOM_TRACK)&&this.setEncoderConfiguration(r),this.processorContext=new nO(this.getTrackId(),"local"),this.processorDestination=new AT(this.processorContext),this.bindProcessorDestinationEvents()}play(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof i){const l=document.getElementById(i);l?i=l:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(i,'" element, use document.body')),i=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const a=Qo(Qo(Qo({},this._getDefaultPlayerConfig()),r),{},{trackId:this.getTrackId(),element:i});this._player?this._player.updateConfig(a):(this._player=i instanceof HTMLVideoElement?new cO(a):new hx(a),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const l=this.getVideoElementVisibleStatus();this.safeEmit(ft.VIDEO_ELEMENT_VISIBLE_STATUS,l)}catch(l){}},H("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}setEnabled(i,r){var a=this;return x(function*(){if(!r){if(i===a._enabled)return;a.stateCheck("enabled",i)}if(R.info("[".concat(a.getTrackId(),"] start setEnabled"),i),!i){a._originMediaStreamTrack.enabled=!1;try{yield Ht(a,me.NEED_DISABLE_TRACK,a)}catch(l){throw R.error("[".concat(a.getTrackId(),"] setEnabled to false error"),l.toString()),l}return r||(a._enabled=!1),void R.info("[".concat(a.getTrackId(),"] setEnabled to false success"))}a._originMediaStreamTrack.enabled=!0;try{yield Ht(a,me.NEED_ENABLE_TRACK,a)}catch(l){throw R.error("[".concat(a.getTrackId(),"] setEnabled to true error"),l.toString()),l}R.info("[".concat(a.getTrackId(),"] setEnabled to true success")),r||(a._enabled=!0)})()}setMuted(i){var r=this;return x(function*(){i!==r._muted&&(r.stateCheck("muted",i),r._muted=i,r._originMediaStreamTrack.enabled=!i,R.debug("[".concat(r.getTrackId(),"] start set muted: ").concat(i)),i?yield Ht(r,me.NEED_MUTE_TRACK,r):yield Ht(r,me.NEED_UNMUTE_TRACK,r))})()}setEncoderConfiguration(i,r){var a=this;return x(function*(){if(!a._enabled)throw new ne(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(i=Ha(i),a._forceBitrateLimit&&(i.bitrateMax=a._forceBitrateLimit.max_bitrate?a._forceBitrateLimit.max_bitrate:i.bitrateMax,i.bitrateMin=a._forceBitrateLimit.min_bitrate?a._forceBitrateLimit.min_bitrate:i.bitrateMin),i.width||i.height||i.frameRate){const l=NT({encoderConfig:i});(Yt()||Ci()||Fa())&&(l.deviceId=void 0),R.debug("[".concat(a.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(i),JSON.stringify(l));try{yield a._originMediaStreamTrack.applyConstraints(l),a.updateMediaStreamTrackResolution()}catch(d){const h=new ne(k.UNEXPECTED_ERROR,d.toString());throw R.error("[".concat(a.getTrackId(),"] applyConstraints error"),h.toString()),h}}a._encoderConfig=i,-1===a._hints.indexOf(Qt.SCREEN_TRACK)&&a.updateBitrateFromProfile();try{yield Ht(a,me.NEED_UPDATE_VIDEO_ENCODER,a)}catch(l){return l.throw(R)}})()}getStats(){return Bh(()=>{R.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),ro(this,me.GET_STATS)||Qo({},WD)}setBeautyEffect(i){return x(function*(){R.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")})()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}getCurrentFrameImage(i){var r=arguments,a=this;return x(function*(){return a._player?a._player.getCurrentFrameToUint8Array(i,r.length>1&&void 0!==r[1]?r[1]:1):yield aO(i)})()}setBitrateLimit(i){var r=this;return x(function*(){if(R.debug("[".concat(r.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(i))),i){r._forceBitrateLimit=i,r._encoderConfig&&(r._encoderConfig.bitrateMax=r._encoderConfig.bitrateMax&&r._encoderConfig.bitrateMax<i.max_bitrate?r._encoderConfig.bitrateMax:i.max_bitrate,r._encoderConfig.bitrateMin=i.min_bitrate);try{yield Ht(r,me.NEED_UPDATE_VIDEO_ENCODER,r)}catch(a){return a.throw(R)}}})()}setOptimizationMode(i){var r=this;return x(function*(){if("motion"!==i&&"detail"!==i&&"balanced"!==i)return void R.error(k.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const a=r._optimizationMode;try{r._optimizationMode=i,yield Ht(r,me.SET_OPTIMIZATION_MODE,r)}catch(l){throw r._optimizationMode=a,R.error("[".concat(r.getTrackId(),"] set optimization mode failed"),l.toString()),l}R.info("[".concat(r.getTrackId(),"] set optimization mode success (").concat(i,")"))})()}setScalabiltyMode(i){if(1===i.numSpatialLayers&&1!==i.numTemporalLayers)return R.error(k.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=i,R.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(i,")"))}updateMediaStreamTrackResolution(){px(this._originMediaStreamTrack).then(i=>{let[r,a]=i;this._videoHeight=a,this._videoWidth=r}).catch(Qg)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:i,height:r,frameRate:a}=this.getMediaStreamTrackSettings();if(!i||!r||!a)return;const[l,d]=function(h,f,m,g){let E;const y=200*Math.pow(m/15,.6)*Math.pow(h*f/640/360,.75),C=y;if("STANDARD_BITRATE"===g)E=4*y;else{if("COMPATIABLE_BITRATE"!==g)return;E=2*y}return[Math.floor(E),Math.floor(C)]}(i,r,a,H("BITRATE_ADAPTER_TYPE"))||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=d,this._encoderConfig.bitrateMax=l,R.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(i,", h: ").concat(r,", fps: ").concat(a,"] => [brMax: ").concat(l,", brMin: ").concat(d,"]")))}getVideoElementVisibleStatus(){try{var i,r;const a=null==this||null===(i=this._player)||void 0===i?void 0:i.getContainerElement(),l={track:this,element:null==this||null===(r=this._player)||void 0===r?void 0:r.getVideoElement(),slot:null==a?void 0:a.parentElement},{element:d,slot:h}=l;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const f=RS.checkOneElementVisible(d),m=Object.assign({},f);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;Te.reportApiInvoke(null,{tag:Kt.TRACER,name:jn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(m.visible?"Video is visible":"Invisible because of ".concat(m.reason))}return m}return}catch(a){throw new ne(k.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}renewMediaStreamTrack(i){return x(function*(){})()}pipe(i){if(this.processor===i)return i;if(i._source)throw new ne(k.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),i}unpipe(){if(!this.processor)return;const i=this.processor;this.processor._source=void 0,this.processor=void 0,i.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(i){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this._encoderConfig;i&&(a=Qo(Qo({},a),Ha(i))),a=Zd(a);const l=Vt(8,"track-video-cloned-"),d=new Ye(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,a,Zd(this._scalabilityMode),this._optimizationMode,l,Zd(this._hints));return i&&a&&d.setEncoderConfiguration(a),R.debug("clone video track from ".concat(this.getTrackId()," to ").concat(l,", clone ").concat(r)),d}replaceTrack(i,r){var a=this;return x(function*(){if(!(i instanceof MediaStreamTrack))throw new ne(k.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==i.kind)throw new ne(k.INVALID_PARAMS,"track should be a video MediaStreamTrack");yield a._updateOriginMediaStreamTrack(i,r,!0),a.updateMediaStreamTrackResolution()})()}bindProcessorDestinationEvents(){var i=this;this.processorDestination.on(Fi.ON_TRACK,function(){var r=x(function*(a){a?a!==i._mediaStreamTrack&&(i._mediaStreamTrack=a,i._updatePlayerSource(),yield Ht(i,me.NEED_REPLACE_TRACK,i)):i._mediaStreamTrack!==i._originMediaStreamTrack&&(i._mediaStreamTrack=i._originMediaStreamTrack,i._updatePlayerSource(),yield Ht(i,me.NEED_REPLACE_TRACK,i))});return function(a){return r.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Fi.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(yr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(yr.REQUEST_CONSTRAINTS)}}oe([Oe({argsMap:(s,i,r)=>[s.getTrackId(),"string"==typeof i?i:i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),Dn(),N("design:type",Function),N("design:paramtypes",[Object,Object]),N("design:returntype",void 0)],Ye.prototype,"play",null),oe([Oe({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Ye.prototype,"stop",null),oe([jh("LocalVideoTrack","_enabledMutex"),Oe({argsMap:(s,i)=>[s.getTrackId(),i]}),Dn(),N("design:type",Function),N("design:paramtypes",[Boolean,Boolean]),N("design:returntype",q)],Ye.prototype,"setEnabled",null),oe([jh("LocalVideoTrack","_enabledMutex"),Oe({argsMap:(s,i)=>[s.getTrackId(),i]}),Dn(),N("design:type",Function),N("design:paramtypes",[Boolean]),N("design:returntype",q)],Ye.prototype,"setMuted",null),oe([Oe({argsMap:(s,i)=>[s.getTrackId(),i]}),Dn(),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",q)],Ye.prototype,"setEncoderConfiguration",null),oe([Dn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",Object)],Ye.prototype,"getStats",null),oe([Oe({argsMap:(s,i,r)=>[s.getTrackId(),i,r]}),Dn(),N("design:type",Function),N("design:paramtypes",[Boolean,Object]),N("design:returntype",q)],Ye.prototype,"setBeautyEffect",null),oe([Dn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",ImageData)],Ye.prototype,"getCurrentFrameData",null),oe([Dn(),N("design:type",Function),N("design:paramtypes",[String,Number]),N("design:returntype",q)],Ye.prototype,"getCurrentFrameImage",null),oe([Dn(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",q)],Ye.prototype,"setBitrateLimit",null),oe([Dn(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Ye.prototype,"setOptimizationMode",null),oe([Dn(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],Ye.prototype,"setScalabiltyMode",null),oe([Dn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Ye.prototype,"updateMediaStreamTrackResolution",null),oe([Oe({argsMap:(s,i)=>[s.getTrackId(),i.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],Ye.prototype,"pipe",null),oe([Oe({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Ye.prototype,"unpipe",null),oe([Oe({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Ye.prototype,"close",null),oe([Oe({argsMap:(s,i,r)=>[s.getTrackId(),i.label,r]}),N("design:type",Function),N("design:paramtypes",[MediaStreamTrack,Boolean]),N("design:returntype",q)],Ye.prototype,"replaceTrack",null);class yu extends Ye{get __className__(){return"CameraVideoTrack"}constructor(i,r,a,l,d,h){var f;super(i,Ha(r.encoderConfig),l,d,h),f=this,T(this,"_config",void 0),T(this,"_originalConstraints",void 0),T(this,"_constraints",void 0),T(this,"_enabled",!0),T(this,"_deviceName","default"),T(this,"tryResumeVideoForIOS15_16WeChat",x(function*(){(Yd()||$g())&&!function(){const m=pt();if(m.os!==vi.IOS||!m.osVersion)return!1;const g=m.osVersion.split(".");return 15===Number(g[0])&&Number(g[1])>=2}()&&AA()&&f._enabled&&!f._isClosed&&(R.debug("[".concat(f.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),yield f.renewMediaStreamTrack())})),this._config=r,this._originalConstraints=a,this._constraints=a,this._deviceName=i.label,this._encoderConfig=Ha(this._config.encoderConfig),Mt.on(_i.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Mt.on(_i.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}setDevice(i){var r=this;return x(function*(){return"string"==typeof i?r._setDeviceById(i):i.deviceId?r._setDeviceById(i.deviceId):i.facingMode?r._setDeviceByFacingModel(i.facingMode):void 0})()}_setDeviceById(i){var r=this;return x(function*(){if(R.info("[".concat(r.getTrackId(),"] set device to ").concat(i)),r._enabled)try{const a=yield Or.getDeviceById(i),l={};l.video=Qo({},r._constraints),l.video.deviceId={exact:i},l.video.facingMode=void 0,r._originMediaStreamTrack.stop();let d=null;try{d=yield Dr(l,r.getTrackId())}catch(h){throw R.error("[".concat(r.getTrackId(),"] setDevice failed"),h.toString()),d=yield Dr({video:r._constraints},r.getTrackId()),yield r._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),h}yield r._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),r.updateMediaStreamTrackResolution(),r._deviceName=a.label,r._config.cameraId=i,r._constraints.deviceId={exact:i}}catch(a){throw R.error("[".concat(r.getTrackId(),"] setDevice error"),a.toString()),a}else try{const a=yield Or.getDeviceById(i);r._deviceName=a.label,r._config.cameraId=i,r._constraints.deviceId={exact:i}}catch(a){throw R.error("[".concat(r.getTrackId(),"] setDevice error"),a.toString()),a}R.info("[".concat(r.getTrackId(),"] setDevice success"))})()}_setDeviceByFacingModel(i){var r=this;return x(function*(){R.info("[".concat(r.getTrackId(),"] set facingMode ").concat(i));const a={video:Qo(Qo({},r._constraints),{},{deviceId:void 0,facingMode:{exact:i}})};if(r._enabled){r._originMediaStreamTrack.stop();let l=null;try{l=yield Dr(a,r.getTrackId())}catch(d){throw R.error("[".concat(r.getTrackId(),"] setDeviceByFacingModel failed"),d.toString()),l=yield Dr({video:r._constraints},r.getTrackId()),yield r._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1),d}yield r._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1),r.updateMediaStreamTrackResolution()}r._deviceName="",r._config.facingMode=i,r._config.cameraId=void 0,r._constraints=Qo({},a.video),R.info("[".concat(r.getTrackId(),"] setDeviceByFacingModel success"))})()}setEnabled(i,r){var a=this;return x(function*(){if(!r){if(i===a._enabled)return;a.stateCheck("enabled",i)}if(R.info("[".concat(a.getTrackId(),"] start setEnabled"),i),i){try{if(a.isExternalTrack)a._originMediaStreamTrack.enabled=!0;else{const l=yield Dr({video:a._constraints},a.getTrackId());yield a._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1)}yield Ht(a,me.NEED_ENABLE_TRACK,a)}catch(l){throw R.error("[".concat(a.getTrackId(),"] setEnabled true error"),l.toString()),l}a.updateMediaStreamTrackResolution(),R.info("[".concat(a.getTrackId(),"] setEnabled to true success")),r||(a._enabled=!0)}else{a.isExternalTrack?a._originMediaStreamTrack.enabled=!1:(a._originMediaStreamTrack.onended=null,a._originMediaStreamTrack.stop()),r||(a._enabled=!1);try{yield Ht(a,me.NEED_DISABLE_TRACK,a)}catch(l){throw R.error("[".concat(a.getTrackId(),"] setEnabled to false error"),l.toString()),l}R.info("[".concat(a.getTrackId(),"] setEnabled to false success"))}})()}setEncoderConfiguration(i,r){var a=this;return x(function*(){if(!a._enabled)throw new ne(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");i=Ha(i),a._forceBitrateLimit&&(i.bitrateMax=a._forceBitrateLimit.max_bitrate?a._forceBitrateLimit.max_bitrate:i.bitrateMax,i.bitrateMin=a._forceBitrateLimit.min_bitrate?a._forceBitrateLimit.min_bitrate:i.bitrateMin);const l=Pn(a._config);l.encoderConfig=i;const d=NT(l);(Yt()||Ci()||Fa())&&(d.deviceId=void 0),R.debug("[".concat(a.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(i),JSON.stringify(d));try{yield a._originMediaStreamTrack.applyConstraints(d),a.updateMediaStreamTrackResolution()}catch(h){const f=new ne(k.UNEXPECTED_ERROR,h.toString());throw R.error("[".concat(a.getTrackId(),"] applyConstraints error"),f.toString()),f}a._config=l,a._constraints=d,a._originalConstraints=d,a._encoderConfig=i,-1===a._hints.indexOf(Qt.SCREEN_TRACK)&&a.updateBitrateFromProfile();try{yield Ht(a,me.NEED_UPDATE_VIDEO_ENCODER,a)}catch(h){return h.throw(R)}})()}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){var i=this;if((Ci()||Fa())&&this._enabled&&!this._isClosed&&Mt.duringInterruption){const r=function(){var a=x(function*(){Mt.off(_i.IOS_INTERRUPTION_END,r),i._enabled&&!i._isClosed&&(R.debug("[".concat(i.getTrackId(),"] try capture camera media device for interrupted iOS device.")),yield i.setEnabled(!1),yield i.setEnabled(!0))});return function(){return a.apply(this,arguments)}}();Mt.on(_i.IOS_INTERRUPTION_END,r)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ft.TRACK_ENDED)}renewMediaStreamTrack(i){var r=this;return x(function*(){const a=i||r._constraints,l=Or.searchDeviceIdByName(r._deviceName);if(l&&!a.deviceId&&(a.deviceId={exact:l}),r._enabled){const d=yield Dr({video:a},r.getTrackId());r._constraints=a,yield r._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!0),r.updateMediaStreamTrackResolution()}})()}close(){super.close(),Mt.off(_i.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Mt.off(_i.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(i){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this._encoderConfig;i&&(a=Qo(Qo({},a),Ha(i))),a=Zd(a);const l=Vt(8,"track-cam-cloned-"),d=new yu(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,Zd(Qo(Qo({},this._config),{},{encoderConfig:a})),Zd(this._constraints),Zd(this._scalabilityMode),this._optimizationMode,l);return i&&a&&d.setEncoderConfiguration(a),R.debug("clone track from ".concat(this.getTrackId()," to ").concat(l,", clone ").concat(r)),d}bindProcessorContextEvents(){var i=this;this.processorContext.on(yr.REQUEST_UPDATE_CONSTRAINTS,function(){var r=x(function*(a,l,d){try{const h=Object.assign({},i._originalConstraints,...a);yield i.renewMediaStreamTrack(h),l()}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this.processorContext.on(yr.REQUEST_CONSTRAINTS,function(){var r=x(function*(a){a(i._originMediaStreamTrack.getSettings())});return function(a){return r.apply(this,arguments)}}())}}function uO(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function FE(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?uO(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):uO(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function PT(s,i,r,a){r.optimizationMode&&(a&&a.width&&a.height?(r.encoderConfig=FE(FE({},a),{},{bitrateMin:a.bitrateMin,bitrateMax:a.bitrateMax}),"motion"!==r.optimizationMode&&"detail"!==r.optimizationMode||(i.contentHint=r.optimizationMode,i.contentHint===r.optimizationMode?R.debug("[".concat(s,"] set content hint to"),r.optimizationMode):R.debug("[".concat(s,"] set content hint failed")))):R.warning("[".concat(s,"] can not apply optimization mode bitrate config, no encoderConfig")))}function _x(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function MT(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?_x(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):_x(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}oe([Oe({argsMap:(s,i)=>[s.getTrackId(),i]}),Dn(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",q)],yu.prototype,"setDevice",null),oe([jh("CameraVideoTrack","_enabledMutex"),Oe({argsMap:(s,i)=>[s.getTrackId(),i]}),Dn(),N("design:type",Function),N("design:paramtypes",[Boolean,Boolean]),N("design:returntype",q)],yu.prototype,"setEnabled",null),oe([Oe({argsMap:(s,i)=>[s.getTrackId(),i]}),Dn(),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",q)],yu.prototype,"setEncoderConfiguration",null),oe([Oe({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],yu.prototype,"close",null);class mx extends AE{getUserId(){return this._userId}constructor(i,r,a,l){super(i,"track-".concat(i.kind,"-").concat(r,"-").concat(l.clientId,"_").concat(Vt(5,""))),T(this,"_userId",void 0),T(this,"_uintId",void 0),T(this,"_isDestroyed",!1),T(this,"store",void 0),T(this,"processor",void 0),this._userId=r,this._uintId=a,this.store=l}_updateOriginMediaStreamTrack(i){this._originMediaStreamTrack=i,this._mediaStreamTrack=i,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,R.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}class xc extends mx{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Yi.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(i,r,a,l){super(i,r,a,l),T(this,"_videoVisibleTimer",null),T(this,"_previousVideoVisibleStatus",void 0),T(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),T(this,"trackMediaType","video"),T(this,"_videoWidth",void 0),T(this,"_videoHeight",void 0),T(this,"_player",void 0),T(this,"processorDestination",void 0),T(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new nO(this.getTrackId(),"remote"),this.processorDestination=new AT(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Bh(()=>{R.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),ro(this,me.GET_STATS)||MT({},yT)}play(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof i){const l=document.getElementById(i);l?i=l:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(i,'" element, use document.body')),i=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const a=MT(MT({fit:"cover"},r),{},{trackId:this.getTrackId(),element:i});this._player?this._player.updateConfig(a):(this._player=i instanceof HTMLVideoElement?new cO(a):new hx(a),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(hu.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const l=this.getVideoElementVisibleStatus();this.safeEmit(hu.VIDEO_ELEMENT_VISIBLE_STATUS,l)}catch(l){}},H("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){px(this._originMediaStreamTrack).then(i=>{let[r,a]=i;this._videoHeight=a,this._videoWidth=r}).catch(Qg)}_updatePlayerSource(){R.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var i,r;const a=null==this||null===(i=this._player)||void 0===i?void 0:i.getContainerElement(),l={track:this,element:null==this||null===(r=this._player)||void 0===r?void 0:r.getVideoElement(),slot:null==a?void 0:a.parentElement},{element:d,slot:h}=l;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const f=RS.checkOneElementVisible(d),m=Object.assign({},f);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;Te.reportApiInvoke(null,{tag:Kt.TRACER,name:jn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(m.visible?"Video is visible":"Invisible because of ".concat(m.reason))}return m}return}catch(a){throw new ne(k.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}pipe(i){if(this.processor===i)return i;if(i._source)throw new ne(k.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),i}unpipe(){if(!this.processor)return;const i=this.processor;this.processor._source=void 0,this.processor=void 0,i.reset()}bindProcessorDestinationEvents(){var i=this;this.processorDestination.on(Fi.ON_TRACK,function(){var r=x(function*(a){a?a!==i._mediaStreamTrack&&(i._mediaStreamTrack=a,i._updatePlayerSource()):i._mediaStreamTrack!==i._originMediaStreamTrack&&(i._mediaStreamTrack=i._originMediaStreamTrack,i._updatePlayerSource())});return function(a){return r.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Fi.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}oe([Oe({argsMap:(s,i,r)=>[s.getTrackId(),"string"==typeof i?i:i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),N("design:type",Function),N("design:paramtypes",[Object,Object]),N("design:returntype",void 0)],xc.prototype,"play",null),oe([Oe({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],xc.prototype,"stop",null),oe([Oe({argsMap:(s,i)=>[s.getTrackId(),i.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],xc.prototype,"pipe",null),oe([Oe({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],xc.prototype,"unpipe",null);class Ns extends mx{get isPlaying(){return this._useAudioElement?qr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(i,r,a,l){super(i,r,a,l),T(this,"trackMediaType","audio"),T(this,"_source",void 0),T(this,"_useAudioElement",!0),T(this,"_volume",100),T(this,"processorContext",void 0),T(this,"processorDestination",void 0),T(this,"_played",!1),T(this,"_bypassWebAudio",!1),H("DISABLE_WEBAUDIO")?(this._source=new DT,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new JD(i,!0),H("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(rr.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(hu.FIRST_FRAME_DECODED)}),this.processorContext=new w_(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new LE(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(rr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!i)return this._source.removeAllListeners(rr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(rr.ON_AUDIO_BUFFER),this._source.on(rr.ON_AUDIO_BUFFER,a=>i(a))}setVolume(i){this._volume=i,this._useAudioElement?qr.setVolume(this.getTrackId(),i):this._source.setVolume(i/100)}setPlaybackDevice(i){var r=this;return x(function*(){if(!r._useAudioElement)throw new ne(k.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield qr.setSinkID(r.getTrackId(),i)})()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Bh(()=>{R.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),ro(this,me.GET_STATS)||MT({},wE)}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] use audio element to play")),qr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?qr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),i&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&qr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(i){if(this._bypassWebAudio)throw new ne(k.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===i)return i;if(i._source)throw new ne(k.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),i}unpipe(){var i;if(this._bypassWebAudio)throw new ne(k.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;null===(i=this._source.processSourceNode)||void 0===i||i.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){var i=this;this.processorDestination.on(Fi.ON_TRACK,function(){var r=x(function*(a){a?a!==i._mediaStreamTrack&&(i._mediaStreamTrack=a,i._updatePlayerSource(!1),i._source.processedNode=i._source.createMediaStreamSourceNode(a)):i._mediaStreamTrack!==i._originMediaStreamTrack&&(i._mediaStreamTrack=i._originMediaStreamTrack,i._updatePlayerSource())});return function(a){return r.apply(this,arguments)}}()),this.processorDestination.on(Fi.ON_NODE,r=>{this._source.processedNode=r;const a=!r;this._useAudioElement!==a&&(this._played?(this.stop(),this._useAudioElement=a,this.play()):this._useAudioElement=a)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Fi.ON_TRACK),this.processorDestination.removeAllListeners(Fi.ON_NODE)}}function A_(s){let i=s.length;for(;--i>=0;)s[i]=0}oe([Oe({argsMap:(s,i)=>[s.getTrackId(),i],throttleTime:300}),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],Ns.prototype,"setVolume",null),oe([Oe({argsMap:(s,i)=>[s.getTrackId(),i]}),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Ns.prototype,"setPlaybackDevice",null),oe([Oe({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Ns.prototype,"play",null),oe([Oe({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Ns.prototype,"stop",null),oe([Oe({argsMap:(s,i)=>[s.getTrackId(),i.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],Ns.prototype,"pipe",null),oe([Oe({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Ns.prototype,"unpipe",null);const LT=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),UE=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),xT=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),FT=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Zo=new Array(576);A_(Zo);const op=new Array(60);A_(op);const VE=new Array(512);A_(VE);const jl=new Array(256);A_(jl);const fa=new Array(29);A_(fa);const D_=new Array(30);function hO(s,i,r,a,l){this.static_tree=s,this.extra_bits=i,this.extra_base=r,this.elems=a,this.max_length=l,this.has_stree=s&&s.length}let gx,Ex,pO;function fO(s,i){this.dyn_tree=s,this.max_code=0,this.stat_desc=i}A_(D_);const O_=s=>s<256?VE[s]:VE[256+(s>>>7)],N_=(s,i)=>{s.pending_buf[s.pending++]=255&i,s.pending_buf[s.pending++]=i>>>8&255},es=(s,i,r)=>{s.bi_valid>16-r?(s.bi_buf|=i<<s.bi_valid&65535,N_(s,s.bi_buf),s.bi_buf=i>>16-s.bi_valid,s.bi_valid+=r-16):(s.bi_buf|=i<<s.bi_valid&65535,s.bi_valid+=r)},Uc=(s,i,r)=>{es(s,r[2*i],r[2*i+1])},BE=(s,i)=>{let r=0;do{r|=1&s,s>>>=1,r<<=1}while(--i>0);return r>>>1},_O=(s,i,r)=>{const a=new Array(16);let l,d,h=0;for(l=1;l<=15;l++)h=h+r[l-1]<<1,a[l]=h;for(d=0;d<=i;d++){let f=s[2*d+1];0!==f&&(s[2*d]=BE(a[f]++,f))}},yx=s=>{let i;for(i=0;i<286;i++)s.dyn_ltree[2*i]=0;for(i=0;i<30;i++)s.dyn_dtree[2*i]=0;for(i=0;i<19;i++)s.bl_tree[2*i]=0;s.dyn_ltree[512]=1,s.opt_len=s.static_len=0,s.sym_next=s.matches=0},vx=s=>{s.bi_valid>8?N_(s,s.bi_buf):s.bi_valid>0&&(s.pending_buf[s.pending++]=s.bi_buf),s.bi_buf=0,s.bi_valid=0},mO=(s,i,r,a)=>{const l=2*i,d=2*r;return s[l]<s[d]||s[l]===s[d]&&a[i]<=a[r]},gO=(s,i,r)=>{const a=s.heap[r];let l=r<<1;for(;l<=s.heap_len&&(l<s.heap_len&&mO(i,s.heap[l+1],s.heap[l],s.depth)&&l++,!mO(i,a,s.heap[l],s.depth));)s.heap[r]=s.heap[l],r=l,l<<=1;s.heap[r]=a},UT=(s,i,r)=>{let a,l,d,h,f=0;if(0!==s.sym_next)do{a=255&s.pending_buf[s.sym_buf+f++],a+=(255&s.pending_buf[s.sym_buf+f++])<<8,l=s.pending_buf[s.sym_buf+f++],0===a?Uc(s,l,i):(d=jl[l],Uc(s,d+256+1,i),h=LT[d],0!==h&&(l-=fa[d],es(s,l,h)),a--,d=O_(a),Uc(s,d,r),h=UE[d],0!==h&&(a-=D_[d],es(s,a,h)))}while(f<s.sym_next);Uc(s,256,i)},VT=(s,i)=>{const r=i.dyn_tree,a=i.stat_desc.static_tree,l=i.stat_desc.has_stree,d=i.stat_desc.elems;let h,f,m,g=-1;for(s.heap_len=0,s.heap_max=573,h=0;h<d;h++)0!==r[2*h]?(s.heap[++s.heap_len]=g=h,s.depth[h]=0):r[2*h+1]=0;for(;s.heap_len<2;)m=s.heap[++s.heap_len]=g<2?++g:0,r[2*m]=1,s.depth[m]=0,s.opt_len--,l&&(s.static_len-=a[2*m+1]);for(i.max_code=g,h=s.heap_len>>1;h>=1;h--)gO(s,r,h);m=d;do{h=s.heap[1],s.heap[1]=s.heap[s.heap_len--],gO(s,r,1),f=s.heap[1],s.heap[--s.heap_max]=h,s.heap[--s.heap_max]=f,r[2*m]=r[2*h]+r[2*f],s.depth[m]=(s.depth[h]>=s.depth[f]?s.depth[h]:s.depth[f])+1,r[2*h+1]=r[2*f+1]=m,s.heap[1]=m++,gO(s,r,1)}while(s.heap_len>=2);s.heap[--s.heap_max]=s.heap[1],((E,y)=>{const C=y.dyn_tree,b=y.max_code,O=y.stat_desc.static_tree,P=y.stat_desc.has_stree,D=y.stat_desc.extra_bits,L=y.stat_desc.extra_base,B=y.stat_desc.max_length;let V,J,ae,z,Q,X,te=0;for(z=0;z<=15;z++)E.bl_count[z]=0;for(C[2*E.heap[E.heap_max]+1]=0,V=E.heap_max+1;V<573;V++)J=E.heap[V],z=C[2*C[2*J+1]+1]+1,z>B&&(z=B,te++),C[2*J+1]=z,J>b||(E.bl_count[z]++,Q=0,J>=L&&(Q=D[J-L]),X=C[2*J],E.opt_len+=X*(z+Q),P&&(E.static_len+=X*(O[2*J+1]+Q)));if(0!==te){do{for(z=B-1;0===E.bl_count[z];)z--;E.bl_count[z]--,E.bl_count[z+1]+=2,E.bl_count[B]--,te-=2}while(te>0);for(z=B;0!==z;z--)for(J=E.bl_count[z];0!==J;)ae=E.heap[--V],ae>b||(C[2*ae+1]!==z&&(E.opt_len+=(z-C[2*ae+1])*C[2*ae],C[2*ae+1]=z),J--)}})(s,i),_O(r,g,s.bl_count)},Cx=(s,i,r)=>{let a,l,d=-1,h=i[1],f=0,m=7,g=4;for(0===h&&(m=138,g=3),i[2*(r+1)+1]=65535,a=0;a<=r;a++)l=h,h=i[2*(a+1)+1],++f<m&&l===h||(f<g?s.bl_tree[2*l]+=f:0!==l?(l!==d&&s.bl_tree[2*l]++,s.bl_tree[32]++):f<=10?s.bl_tree[34]++:s.bl_tree[36]++,f=0,d=l,0===h?(m=138,g=3):l===h?(m=6,g=3):(m=7,g=4))},Sx=(s,i,r)=>{let a,l,d=-1,h=i[1],f=0,m=7,g=4;for(0===h&&(m=138,g=3),a=0;a<=r;a++)if(l=h,h=i[2*(a+1)+1],!(++f<m&&l===h)){if(f<g)do{Uc(s,l,s.bl_tree)}while(0!=--f);else 0!==l?(l!==d&&(Uc(s,l,s.bl_tree),f--),Uc(s,16,s.bl_tree),es(s,f-3,2)):f<=10?(Uc(s,17,s.bl_tree),es(s,f-3,3)):(Uc(s,18,s.bl_tree),es(s,f-11,7));f=0,d=l,0===h?(m=138,g=3):l===h?(m=6,g=3):(m=7,g=4)}};let EO=!1;const Hl=(s,i,r,a)=>{es(s,0+(a?1:0),3),vx(s),N_(s,r),N_(s,~r),r&&s.pending_buf.set(s.window.subarray(i,i+r),s.pending),s.pending+=r};var BT={_tr_init:s=>{EO||((()=>{let i,r,a,l,d;const h=new Array(16);for(a=0,l=0;l<28;l++)for(fa[l]=a,i=0;i<1<<LT[l];i++)jl[a++]=l;for(jl[a-1]=l,d=0,l=0;l<16;l++)for(D_[l]=d,i=0;i<1<<UE[l];i++)VE[d++]=l;for(d>>=7;l<30;l++)for(D_[l]=d<<7,i=0;i<1<<UE[l]-7;i++)VE[256+d++]=l;for(r=0;r<=15;r++)h[r]=0;for(i=0;i<=143;)Zo[2*i+1]=8,i++,h[8]++;for(;i<=255;)Zo[2*i+1]=9,i++,h[9]++;for(;i<=279;)Zo[2*i+1]=7,i++,h[7]++;for(;i<=287;)Zo[2*i+1]=8,i++,h[8]++;for(_O(Zo,287,h),i=0;i<30;i++)op[2*i+1]=5,op[2*i]=BE(i,5);gx=new hO(Zo,LT,257,286,15),Ex=new hO(op,UE,0,30,15),pO=new hO(new Array(0),xT,0,19,7)})(),EO=!0),s.l_desc=new fO(s.dyn_ltree,gx),s.d_desc=new fO(s.dyn_dtree,Ex),s.bl_desc=new fO(s.bl_tree,pO),s.bi_buf=0,s.bi_valid=0,yx(s)},_tr_stored_block:Hl,_tr_flush_block:(s,i,r,a)=>{let l,d,h=0;s.level>0?(2===s.strm.data_type&&(s.strm.data_type=(f=>{let m,g=4093624447;for(m=0;m<=31;m++,g>>>=1)if(1&g&&0!==f.dyn_ltree[2*m])return 0;if(0!==f.dyn_ltree[18]||0!==f.dyn_ltree[20]||0!==f.dyn_ltree[26])return 1;for(m=32;m<256;m++)if(0!==f.dyn_ltree[2*m])return 1;return 0})(s)),VT(s,s.l_desc),VT(s,s.d_desc),h=(f=>{let m;for(Cx(f,f.dyn_ltree,f.l_desc.max_code),Cx(f,f.dyn_dtree,f.d_desc.max_code),VT(f,f.bl_desc),m=18;m>=3&&0===f.bl_tree[2*FT[m]+1];m--);return f.opt_len+=3*(m+1)+5+5+4,m})(s),l=s.opt_len+3+7>>>3,d=s.static_len+3+7>>>3,d<=l&&(l=d)):l=d=r+5,r+4<=l&&-1!==i?Hl(s,i,r,a):4===s.strategy||d===l?(es(s,2+(a?1:0),3),UT(s,Zo,op)):(es(s,4+(a?1:0),3),((f,m,g,E)=>{let y;for(es(f,m-257,5),es(f,g-1,5),es(f,E-4,4),y=0;y<E;y++)es(f,f.bl_tree[2*FT[y]+1],3);Sx(f,f.dyn_ltree,m-1),Sx(f,f.dyn_dtree,g-1)})(s,s.l_desc.max_code+1,s.d_desc.max_code+1,h+1),UT(s,s.dyn_ltree,s.dyn_dtree)),yx(s),a&&vx(s)},_tr_tally:(s,i,r)=>(s.pending_buf[s.sym_buf+s.sym_next++]=i,s.pending_buf[s.sym_buf+s.sym_next++]=i>>8,s.pending_buf[s.sym_buf+s.sym_next++]=r,0===i?s.dyn_ltree[2*r]++:(s.matches++,i--,s.dyn_ltree[2*(jl[r]+256+1)]++,s.dyn_dtree[2*O_(i)]++),s.sym_next===s.sym_end),_tr_align:s=>{var i;es(s,2,3),Uc(s,256,Zo),16===(i=s).bi_valid?(N_(i,i.bi_buf),i.bi_buf=0,i.bi_valid=0):i.bi_valid>=8&&(i.pending_buf[i.pending++]=255&i.bi_buf,i.bi_buf>>=8,i.bi_valid-=8)}},P_=(s,i,r,a)=>{let l=65535&s|0,d=s>>>16&65535|0,h=0;for(;0!==r;){h=r>2e3?2e3:r,r-=h;do{l=l+i[a++]|0,d=d+l|0}while(--h);l%=65521,d%=65521}return l|d<<16|0};const nt=new Uint32Array((()=>{let s,i=[];for(var r=0;r<256;r++){s=r;for(var a=0;a<8;a++)s=1&s?3988292384^s>>>1:s>>>1;i[r]=s}return i})());var vr=(s,i,r,a)=>{const l=nt,d=a+r;s^=-1;for(let h=a;h<d;h++)s=s>>>8^l[255&(s^i[h])];return-1^s},Vc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},sp={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Ix,_tr_stored_block:M_,_tr_flush_block:yO,_tr_tally:Bc,_tr_align:wx}=BT,{Z_NO_FLUSH:Wa,Z_PARTIAL_FLUSH:vO,Z_FULL_FLUSH:Ax,Z_FINISH:Ps,Z_BLOCK:jE,Z_OK:Cr,Z_STREAM_END:jT,Z_STREAM_ERROR:Ms,Z_DATA_ERROR:Dx,Z_BUF_ERROR:ts,Z_DEFAULT_COMPRESSION:Ox,Z_FILTERED:u3,Z_HUFFMAN_ONLY:HE,Z_RLE:h3,Z_FIXED:Nx,Z_DEFAULT_STRATEGY:Px,Z_UNKNOWN:Mx,Z_DEFLATED:HT}=sp,jc=262,Su=(s,i)=>(s.msg=Vc[i],i),KT=s=>2*s-(s>4?9:0),zr=s=>{let i=s.length;for(;--i>=0;)s[i]=0},qT=s=>{let i,r,a,l=s.w_size;i=s.hash_size,a=i;do{r=s.head[--a],s.head[a]=r>=l?r-l:0}while(--i);i=l,a=i;do{r=s.prev[--a],s.prev[a]=r>=l?r-l:0}while(--i)};let Hc=(s,i,r)=>(i<<s.hash_shift^r)&s.hash_mask;const ns=s=>{const i=s.state;let r=i.pending;r>s.avail_out&&(r=s.avail_out),0!==r&&(s.output.set(i.pending_buf.subarray(i.pending_out,i.pending_out+r),s.next_out),s.next_out+=r,i.pending_out+=r,s.total_out+=r,s.avail_out-=r,i.pending-=r,0===i.pending&&(i.pending_out=0))},Yr=(s,i)=>{yO(s,s.block_start>=0?s.block_start:-1,s.strstart-s.block_start,i),s.block_start=s.strstart,ns(s.strm)},kn=(s,i)=>{s.pending_buf[s.pending++]=i},GE=(s,i)=>{s.pending_buf[s.pending++]=i>>>8&255,s.pending_buf[s.pending++]=255&i},TO=(s,i,r,a)=>{let l=s.avail_in;return l>a&&(l=a),0===l?0:(s.avail_in-=l,i.set(s.input.subarray(s.next_in,s.next_in+l),r),1===s.state.wrap?s.adler=P_(s.adler,i,l,r):2===s.state.wrap&&(s.adler=vr(s.adler,i,l,r)),s.next_in+=l,s.total_in+=l,l)},zT=(s,i)=>{let r,a,l=s.max_chain_length,d=s.strstart,h=s.prev_length,f=s.nice_match;const m=s.strstart>s.w_size-jc?s.strstart-(s.w_size-jc):0,g=s.window,E=s.w_mask,y=s.prev,C=s.strstart+258;let b=g[d+h-1],O=g[d+h];s.prev_length>=s.good_match&&(l>>=2),f>s.lookahead&&(f=s.lookahead);do{if(r=i,g[r+h]===O&&g[r+h-1]===b&&g[r]===g[d]&&g[++r]===g[d+1]){d+=2,r++;do{}while(g[++d]===g[++r]&&g[++d]===g[++r]&&g[++d]===g[++r]&&g[++d]===g[++r]&&g[++d]===g[++r]&&g[++d]===g[++r]&&g[++d]===g[++r]&&g[++d]===g[++r]&&d<C);if(a=258-(C-d),d=C-258,a>h){if(s.match_start=i,h=a,a>=f)break;b=g[d+h-1],O=g[d+h]}}}while((i=y[i&E])>m&&0!=--l);return h<=s.lookahead?h:s.lookahead},Tu=s=>{const i=s.w_size;let r,a,l;do{if(a=s.window_size-s.lookahead-s.strstart,s.strstart>=i+(i-jc)&&(s.window.set(s.window.subarray(i,i+i-a),0),s.match_start-=i,s.strstart-=i,s.block_start-=i,s.insert>s.strstart&&(s.insert=s.strstart),qT(s),a+=i),0===s.strm.avail_in)break;if(r=TO(s.strm,s.window,s.strstart+s.lookahead,a),s.lookahead+=r,s.lookahead+s.insert>=3)for(l=s.strstart-s.insert,s.ins_h=s.window[l],s.ins_h=Hc(s,s.ins_h,s.window[l+1]);s.insert&&(s.ins_h=Hc(s,s.ins_h,s.window[l+3-1]),s.prev[l&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=l,l++,s.insert--,!(s.lookahead+s.insert<3)););}while(s.lookahead<jc&&0!==s.strm.avail_in)},bO=(s,i)=>{let r,a,l,d=s.pending_buf_size-5>s.w_size?s.w_size:s.pending_buf_size-5,h=0,f=s.strm.avail_in;do{if(r=65535,l=s.bi_valid+42>>3,s.strm.avail_out<l||(l=s.strm.avail_out-l,a=s.strstart-s.block_start,r>a+s.strm.avail_in&&(r=a+s.strm.avail_in),r>l&&(r=l),r<d&&(0===r&&i!==Ps||i===Wa||r!==a+s.strm.avail_in)))break;h=i===Ps&&r===a+s.strm.avail_in?1:0,M_(s,0,0,h),s.pending_buf[s.pending-4]=r,s.pending_buf[s.pending-3]=r>>8,s.pending_buf[s.pending-2]=~r,s.pending_buf[s.pending-1]=~r>>8,ns(s.strm),a&&(a>r&&(a=r),s.strm.output.set(s.window.subarray(s.block_start,s.block_start+a),s.strm.next_out),s.strm.next_out+=a,s.strm.avail_out-=a,s.strm.total_out+=a,s.block_start+=a,r-=a),r&&(TO(s.strm,s.strm.output,s.strm.next_out,r),s.strm.next_out+=r,s.strm.avail_out-=r,s.strm.total_out+=r)}while(0===h);return f-=s.strm.avail_in,f&&(f>=s.w_size?(s.matches=2,s.window.set(s.strm.input.subarray(s.strm.next_in-s.w_size,s.strm.next_in),0),s.strstart=s.w_size,s.insert=s.strstart):(s.window_size-s.strstart<=f&&(s.strstart-=s.w_size,s.window.set(s.window.subarray(s.w_size,s.w_size+s.strstart),0),s.matches<2&&s.matches++,s.insert>s.strstart&&(s.insert=s.strstart)),s.window.set(s.strm.input.subarray(s.strm.next_in-f,s.strm.next_in),s.strstart),s.strstart+=f,s.insert+=f>s.w_size-s.insert?s.w_size-s.insert:f),s.block_start=s.strstart),s.high_water<s.strstart&&(s.high_water=s.strstart),h?4:i!==Wa&&i!==Ps&&0===s.strm.avail_in&&s.strstart===s.block_start?2:(l=s.window_size-s.strstart,s.strm.avail_in>l&&s.block_start>=s.w_size&&(s.block_start-=s.w_size,s.strstart-=s.w_size,s.window.set(s.window.subarray(s.w_size,s.w_size+s.strstart),0),s.matches<2&&s.matches++,l+=s.w_size,s.insert>s.strstart&&(s.insert=s.strstart)),l>s.strm.avail_in&&(l=s.strm.avail_in),l&&(TO(s.strm,s.window,s.strstart,l),s.strstart+=l,s.insert+=l>s.w_size-s.insert?s.w_size-s.insert:l),s.high_water<s.strstart&&(s.high_water=s.strstart),l=s.bi_valid+42>>3,l=s.pending_buf_size-l>65535?65535:s.pending_buf_size-l,d=l>s.w_size?s.w_size:l,a=s.strstart-s.block_start,(a>=d||(a||i===Ps)&&i!==Wa&&0===s.strm.avail_in&&a<=l)&&(r=a>l?l:a,h=i===Ps&&0===s.strm.avail_in&&r===a?1:0,M_(s,s.block_start,r,h),s.block_start+=r,ns(s.strm)),h?3:1)},YT=(s,i)=>{let r,a;for(;;){if(s.lookahead<jc){if(Tu(s),s.lookahead<jc&&i===Wa)return 1;if(0===s.lookahead)break}if(r=0,s.lookahead>=3&&(s.ins_h=Hc(s,s.ins_h,s.window[s.strstart+3-1]),r=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),0!==r&&s.strstart-r<=s.w_size-jc&&(s.match_length=zT(s,r)),s.match_length>=3)if(a=Bc(s,s.strstart-s.match_start,s.match_length-3),s.lookahead-=s.match_length,s.match_length<=s.max_lazy_match&&s.lookahead>=3){s.match_length--;do{s.strstart++,s.ins_h=Hc(s,s.ins_h,s.window[s.strstart+3-1]),r=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart}while(0!=--s.match_length);s.strstart++}else s.strstart+=s.match_length,s.match_length=0,s.ins_h=s.window[s.strstart],s.ins_h=Hc(s,s.ins_h,s.window[s.strstart+1]);else a=Bc(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++;if(a&&(Yr(s,!1),0===s.strm.avail_out))return 1}return s.insert=s.strstart<2?s.strstart:2,i===Ps?(Yr(s,!0),0===s.strm.avail_out?3:4):s.sym_next&&(Yr(s,!1),0===s.strm.avail_out)?1:2},ap=(s,i)=>{let r,a,l;for(;;){if(s.lookahead<jc){if(Tu(s),s.lookahead<jc&&i===Wa)return 1;if(0===s.lookahead)break}if(r=0,s.lookahead>=3&&(s.ins_h=Hc(s,s.ins_h,s.window[s.strstart+3-1]),r=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),s.prev_length=s.match_length,s.prev_match=s.match_start,s.match_length=2,0!==r&&s.prev_length<s.max_lazy_match&&s.strstart-r<=s.w_size-jc&&(s.match_length=zT(s,r),s.match_length<=5&&(s.strategy===u3||3===s.match_length&&s.strstart-s.match_start>4096)&&(s.match_length=2)),s.prev_length>=3&&s.match_length<=s.prev_length){l=s.strstart+s.lookahead-3,a=Bc(s,s.strstart-1-s.prev_match,s.prev_length-3),s.lookahead-=s.prev_length-1,s.prev_length-=2;do{++s.strstart<=l&&(s.ins_h=Hc(s,s.ins_h,s.window[s.strstart+3-1]),r=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart)}while(0!=--s.prev_length);if(s.match_available=0,s.match_length=2,s.strstart++,a&&(Yr(s,!1),0===s.strm.avail_out))return 1}else if(s.match_available){if(a=Bc(s,0,s.window[s.strstart-1]),a&&Yr(s,!1),s.strstart++,s.lookahead--,0===s.strm.avail_out)return 1}else s.match_available=1,s.strstart++,s.lookahead--}return s.match_available&&(a=Bc(s,0,s.window[s.strstart-1]),s.match_available=0),s.insert=s.strstart<2?s.strstart:2,i===Ps?(Yr(s,!0),0===s.strm.avail_out?3:4):s.sym_next&&(Yr(s,!1),0===s.strm.avail_out)?1:2};function Ka(s,i,r,a,l){this.good_length=s,this.max_lazy=i,this.nice_length=r,this.max_chain=a,this.func=l}const cp=[new Ka(0,0,0,0,bO),new Ka(4,4,8,4,YT),new Ka(4,5,16,8,YT),new Ka(4,6,32,32,YT),new Ka(4,4,16,16,ap),new Ka(8,16,32,32,ap),new Ka(8,16,128,128,ap),new Ka(8,32,128,256,ap),new Ka(32,128,258,1024,ap),new Ka(32,258,258,4096,ap)];function p3(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=HT,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),zr(this.dyn_ltree),zr(this.dyn_dtree),zr(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),zr(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),zr(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const WE=s=>{if(!s)return 1;const i=s.state;return!i||i.strm!==s||42!==i.status&&57!==i.status&&69!==i.status&&73!==i.status&&91!==i.status&&103!==i.status&&113!==i.status&&666!==i.status?1:0},RO=s=>{if(WE(s))return Su(s,Ms);s.total_in=s.total_out=0,s.data_type=Mx;const i=s.state;return i.pending=0,i.pending_out=0,i.wrap<0&&(i.wrap=-i.wrap),i.status=2===i.wrap?57:i.wrap?42:113,s.adler=2===i.wrap?0:1,i.last_flush=-2,Ix(i),Cr},KE=s=>{const i=RO(s);var r;return i===Cr&&((r=s.state).window_size=2*r.w_size,zr(r.head),r.max_lazy_match=cp[r.level].max_lazy,r.good_match=cp[r.level].good_length,r.nice_match=cp[r.level].nice_length,r.max_chain_length=cp[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0),i},or=(s,i,r,a,l,d)=>{if(!s)return Ms;let h=1;if(i===Ox&&(i=6),a<0?(h=0,a=-a):a>15&&(h=2,a-=16),l<1||l>9||r!==HT||a<8||a>15||i<0||i>9||d<0||d>Nx||8===a&&1!==h)return Su(s,Ms);8===a&&(a=9);const f=new p3;return s.state=f,f.strm=s,f.status=42,f.wrap=h,f.gzhead=null,f.w_bits=a,f.w_size=1<<f.w_bits,f.w_mask=f.w_size-1,f.hash_bits=l+7,f.hash_size=1<<f.hash_bits,f.hash_mask=f.hash_size-1,f.hash_shift=~~((f.hash_bits+3-1)/3),f.window=new Uint8Array(2*f.w_size),f.head=new Uint16Array(f.hash_size),f.prev=new Uint16Array(f.w_size),f.lit_bufsize=1<<l+6,f.pending_buf_size=4*f.lit_bufsize,f.pending_buf=new Uint8Array(f.pending_buf_size),f.sym_buf=f.lit_bufsize,f.sym_end=3*(f.lit_bufsize-1),f.level=i,f.strategy=d,f.method=r,KE(s)};var lp_deflateInit2=or,lp_deflateSetHeader=(s,i)=>WE(s)||2!==s.state.wrap?Ms:(s.state.gzhead=i,Cr),lp_deflate=(s,i)=>{if(WE(s)||i>jE||i<0)return s?Su(s,Ms):Ms;const r=s.state;if(!s.output||0!==s.avail_in&&!s.input||666===r.status&&i!==Ps)return Su(s,0===s.avail_out?ts:Ms);const a=r.last_flush;if(r.last_flush=i,0!==r.pending){if(ns(s),0===s.avail_out)return r.last_flush=-1,Cr}else if(0===s.avail_in&&KT(i)<=KT(a)&&i!==Ps)return Su(s,ts);if(666===r.status&&0!==s.avail_in)return Su(s,ts);if(42===r.status&&0===r.wrap&&(r.status=113),42===r.status){let l=HT+(r.w_bits-8<<4)<<8,d=-1;if(d=r.strategy>=HE||r.level<2?0:r.level<6?1:6===r.level?2:3,l|=d<<6,0!==r.strstart&&(l|=32),l+=31-l%31,GE(r,l),0!==r.strstart&&(GE(r,s.adler>>>16),GE(r,65535&s.adler)),s.adler=1,r.status=113,ns(s),0!==r.pending)return r.last_flush=-1,Cr}if(57===r.status)if(s.adler=0,kn(r,31),kn(r,139),kn(r,8),r.gzhead)kn(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),kn(r,255&r.gzhead.time),kn(r,r.gzhead.time>>8&255),kn(r,r.gzhead.time>>16&255),kn(r,r.gzhead.time>>24&255),kn(r,9===r.level?2:r.strategy>=HE||r.level<2?4:0),kn(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(kn(r,255&r.gzhead.extra.length),kn(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(s.adler=vr(s.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(kn(r,0),kn(r,0),kn(r,0),kn(r,0),kn(r,0),kn(r,9===r.level?2:r.strategy>=HE||r.level<2?4:0),kn(r,3),r.status=113,ns(s),0!==r.pending)return r.last_flush=-1,Cr;if(69===r.status){if(r.gzhead.extra){let l=r.pending,d=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+d>r.pending_buf_size;){let f=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+f),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>l&&(s.adler=vr(s.adler,r.pending_buf,r.pending-l,l)),r.gzindex+=f,ns(s),0!==r.pending)return r.last_flush=-1,Cr;l=0,d-=f}let h=new Uint8Array(r.gzhead.extra);r.pending_buf.set(h.subarray(r.gzindex,r.gzindex+d),r.pending),r.pending+=d,r.gzhead.hcrc&&r.pending>l&&(s.adler=vr(s.adler,r.pending_buf,r.pending-l,l)),r.gzindex=0}r.status=73}if(73===r.status){if(r.gzhead.name){let l,d=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>d&&(s.adler=vr(s.adler,r.pending_buf,r.pending-d,d)),ns(s),0!==r.pending)return r.last_flush=-1,Cr;d=0}l=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,kn(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>d&&(s.adler=vr(s.adler,r.pending_buf,r.pending-d,d)),r.gzindex=0}r.status=91}if(91===r.status){if(r.gzhead.comment){let l,d=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>d&&(s.adler=vr(s.adler,r.pending_buf,r.pending-d,d)),ns(s),0!==r.pending)return r.last_flush=-1,Cr;d=0}l=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,kn(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>d&&(s.adler=vr(s.adler,r.pending_buf,r.pending-d,d))}r.status=103}if(103===r.status){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(ns(s),0!==r.pending))return r.last_flush=-1,Cr;kn(r,255&s.adler),kn(r,s.adler>>8&255),s.adler=0}if(r.status=113,ns(s),0!==r.pending)return r.last_flush=-1,Cr}if(0!==s.avail_in||0!==r.lookahead||i!==Wa&&666!==r.status){let l=0===r.level?bO(r,i):r.strategy===HE?((d,h)=>{let f;for(;;){if(0===d.lookahead&&(Tu(d),0===d.lookahead)){if(h===Wa)return 1;break}if(d.match_length=0,f=Bc(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,f&&(Yr(d,!1),0===d.strm.avail_out))return 1}return d.insert=0,h===Ps?(Yr(d,!0),0===d.strm.avail_out?3:4):d.sym_next&&(Yr(d,!1),0===d.strm.avail_out)?1:2})(r,i):r.strategy===h3?((d,h)=>{let f,m,g,E;const y=d.window;for(;;){if(d.lookahead<=258){if(Tu(d),d.lookahead<=258&&h===Wa)return 1;if(0===d.lookahead)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(g=d.strstart-1,m=y[g],m===y[++g]&&m===y[++g]&&m===y[++g])){E=d.strstart+258;do{}while(m===y[++g]&&m===y[++g]&&m===y[++g]&&m===y[++g]&&m===y[++g]&&m===y[++g]&&m===y[++g]&&m===y[++g]&&g<E);d.match_length=258-(E-g),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(f=Bc(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(f=Bc(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),f&&(Yr(d,!1),0===d.strm.avail_out))return 1}return d.insert=0,h===Ps?(Yr(d,!0),0===d.strm.avail_out?3:4):d.sym_next&&(Yr(d,!1),0===d.strm.avail_out)?1:2})(r,i):cp[r.level].func(r,i);if(3!==l&&4!==l||(r.status=666),1===l||3===l)return 0===s.avail_out&&(r.last_flush=-1),Cr;if(2===l&&(i===vO?wx(r):i!==jE&&(M_(r,0,0,!1),i===Ax&&(zr(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),ns(s),0===s.avail_out))return r.last_flush=-1,Cr}return i!==Ps?Cr:r.wrap<=0?jT:(2===r.wrap?(kn(r,255&s.adler),kn(r,s.adler>>8&255),kn(r,s.adler>>16&255),kn(r,s.adler>>24&255),kn(r,255&s.total_in),kn(r,s.total_in>>8&255),kn(r,s.total_in>>16&255),kn(r,s.total_in>>24&255)):(GE(r,s.adler>>>16),GE(r,65535&s.adler)),ns(s),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?Cr:jT)},lp_deflateEnd=s=>{if(WE(s))return Ms;const i=s.state.status;return s.state=null,113===i?Su(s,Dx):Cr},lp_deflateSetDictionary=(s,i)=>{let r=i.length;if(WE(s))return Ms;const a=s.state,l=a.wrap;if(2===l||1===l&&42!==a.status||a.lookahead)return Ms;if(1===l&&(s.adler=P_(s.adler,i,r,0)),a.wrap=0,r>=a.w_size){0===l&&(zr(a.head),a.strstart=0,a.block_start=0,a.insert=0);let m=new Uint8Array(a.w_size);m.set(i.subarray(r-a.w_size,r),0),i=m,r=a.w_size}const d=s.avail_in,h=s.next_in,f=s.input;for(s.avail_in=r,s.next_in=0,s.input=i,Tu(a);a.lookahead>=3;){let m=a.strstart,g=a.lookahead-2;do{a.ins_h=Hc(a,a.ins_h,a.window[m+3-1]),a.prev[m&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=m,m++}while(--g);a.strstart=m,a.lookahead=2,Tu(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,s.next_in=h,s.input=f,s.avail_in=d,a.wrap=l,Cr};const Lx=(s,i)=>Object.prototype.hasOwnProperty.call(s,i);var bu_assign=function(s){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const r=i.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const a in r)Lx(r,a)&&(s[a]=r[a])}}return s},bu_flattenChunks=s=>{let i=0;for(let a=0,l=s.length;a<l;a++)i+=s[a].length;const r=new Uint8Array(i);for(let a=0,l=0,d=s.length;a<d;a++){let h=s[a];r.set(h,l),l+=h.length}return r};let wO=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(s){wO=!1}const L_=new Uint8Array(256);for(let s=0;s<256;s++)L_[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;L_[254]=L_[254]=1;var dp_string2buf=s=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(s);let i,r,a,l,d,h=s.length,f=0;for(l=0;l<h;l++)r=s.charCodeAt(l),55296==(64512&r)&&l+1<h&&(a=s.charCodeAt(l+1),56320==(64512&a)&&(r=65536+(r-55296<<10)+(a-56320),l++)),f+=r<128?1:r<2048?2:r<65536?3:4;for(i=new Uint8Array(f),d=0,l=0;d<f;l++)r=s.charCodeAt(l),55296==(64512&r)&&l+1<h&&(a=s.charCodeAt(l+1),56320==(64512&a)&&(r=65536+(r-55296<<10)+(a-56320),l++)),r<128?i[d++]=r:r<2048?(i[d++]=192|r>>>6,i[d++]=128|63&r):r<65536?(i[d++]=224|r>>>12,i[d++]=128|r>>>6&63,i[d++]=128|63&r):(i[d++]=240|r>>>18,i[d++]=128|r>>>12&63,i[d++]=128|r>>>6&63,i[d++]=128|63&r);return i},dp_buf2string=(s,i)=>{const r=i||s.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(s.subarray(0,i));let a,l;const d=new Array(2*r);for(l=0,a=0;a<r;){let h=s[a++];if(h<128){d[l++]=h;continue}let f=L_[h];if(f>4)d[l++]=65533,a+=f-1;else{for(h&=2===f?31:3===f?15:7;f>1&&a<r;)h=h<<6|63&s[a++],f--;f>1?d[l++]=65533:h<65536?d[l++]=h:(h-=65536,d[l++]=55296|h>>10&1023,d[l++]=56320|1023&h)}}return((h,f)=>{if(f<65534&&h.subarray&&wO)return String.fromCharCode.apply(null,h.length===f?h:h.subarray(0,f));let m="";for(let g=0;g<f;g++)m+=String.fromCharCode(h[g]);return m})(d,l)},dp_utf8border=(s,i)=>{(i=i||s.length)>s.length&&(i=s.length);let r=i-1;for(;r>=0&&128==(192&s[r]);)r--;return r<0||0===r?i:r+L_[s[r]]>i?r:i},Wl=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const $T=Object.prototype.toString,{Z_NO_FLUSH:JT,Z_SYNC_FLUSH:XT,Z_FULL_FLUSH:xx,Z_FINISH:qE,Z_OK:zE,Z_STREAM_END:QT,Z_DEFAULT_COMPRESSION:AO,Z_DEFAULT_STRATEGY:Sr,Z_DEFLATED:_3}=sp;function x_(s){this.options=bu_assign({level:AO,method:_3,chunkSize:16384,windowBits:15,memLevel:8,strategy:Sr},s||{});let i=this.options;i.raw&&i.windowBits>0?i.windowBits=-i.windowBits:i.gzip&&i.windowBits>0&&i.windowBits<16&&(i.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Wl,this.strm.avail_out=0;let r=lp_deflateInit2(this.strm,i.level,i.method,i.windowBits,i.memLevel,i.strategy);if(r!==zE)throw new Error(Vc[r]);if(i.header&&lp_deflateSetHeader(this.strm,i.header),i.dictionary){let a;if(a="string"==typeof i.dictionary?dp_string2buf(i.dictionary):"[object ArrayBuffer]"===$T.call(i.dictionary)?new Uint8Array(i.dictionary):i.dictionary,r=lp_deflateSetDictionary(this.strm,a),r!==zE)throw new Error(Vc[r]);this._dict_set=!0}}function ZT(s,i){const r=new x_(i);if(r.push(s,!0),r.err)throw r.msg||Vc[r.err];return r.result}x_.prototype.push=function(s,i){const r=this.strm,a=this.options.chunkSize;let l,d;if(this.ended)return!1;for(d=i===~~i?i:!0===i?qE:JT,r.input="string"==typeof s?dp_string2buf(s):"[object ArrayBuffer]"===$T.call(s)?new Uint8Array(s):s,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(a),r.next_out=0,r.avail_out=a),(d===XT||d===xx)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(l=lp_deflate(r,d),l===QT)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),l=lp_deflateEnd(this.strm),this.onEnd(l),this.ended=!0,l===zE;if(0!==r.avail_out){if(d>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},x_.prototype.onData=function(s){this.chunks.push(s)},x_.prototype.onEnd=function(s){s===zE&&(this.result=bu_flattenChunks(this.chunks)),this.chunks=[],this.err=s,this.msg=this.strm.msg};var m3={Deflate:x_,deflate:ZT,deflateRaw:function(s,i){return(i=i||{}).raw=!0,ZT(s,i)},gzip:function(s,i){return(i=i||{}).gzip=!0,ZT(s,i)},constants:sp};const Ru=16209;var Fx=function(s,i){let r,a,l,d,h,f,m,g,E,y,C,b,O,P,D,L,B,V,J,ae,z,Q,X,te;const Ce=s.state;r=s.next_in,X=s.input,a=r+(s.avail_in-5),l=s.next_out,te=s.output,d=l-(i-s.avail_out),h=l+(s.avail_out-257),f=Ce.dmax,m=Ce.wsize,g=Ce.whave,E=Ce.wnext,y=Ce.window,C=Ce.hold,b=Ce.bits,O=Ce.lencode,P=Ce.distcode,D=(1<<Ce.lenbits)-1,L=(1<<Ce.distbits)-1;e:do{b<15&&(C+=X[r++]<<b,b+=8,C+=X[r++]<<b,b+=8),B=O[C&D];t:for(;;){if(V=B>>>24,C>>>=V,b-=V,V=B>>>16&255,0===V)te[l++]=65535&B;else{if(!(16&V)){if(0==(64&V)){B=O[(65535&B)+(C&(1<<V)-1)];continue t}if(32&V){Ce.mode=16191;break e}s.msg="invalid literal/length code",Ce.mode=Ru;break e}J=65535&B,V&=15,V&&(b<V&&(C+=X[r++]<<b,b+=8),J+=C&(1<<V)-1,C>>>=V,b-=V),b<15&&(C+=X[r++]<<b,b+=8,C+=X[r++]<<b,b+=8),B=P[C&L];n:for(;;){if(V=B>>>24,C>>>=V,b-=V,V=B>>>16&255,!(16&V)){if(0==(64&V)){B=P[(65535&B)+(C&(1<<V)-1)];continue n}s.msg="invalid distance code",Ce.mode=Ru;break e}if(ae=65535&B,V&=15,b<V&&(C+=X[r++]<<b,b+=8,b<V&&(C+=X[r++]<<b,b+=8)),ae+=C&(1<<V)-1,ae>f){s.msg="invalid distance too far back",Ce.mode=Ru;break e}if(C>>>=V,b-=V,V=l-d,ae>V){if(V=ae-V,V>g&&Ce.sane){s.msg="invalid distance too far back",Ce.mode=Ru;break e}if(z=0,Q=y,0===E){if(z+=m-V,V<J){J-=V;do{te[l++]=y[z++]}while(--V);z=l-ae,Q=te}}else if(E<V){if(z+=m+E-V,V-=E,V<J){J-=V;do{te[l++]=y[z++]}while(--V);if(z=0,E<J){V=E,J-=V;do{te[l++]=y[z++]}while(--V);z=l-ae,Q=te}}}else if(z+=E-V,V<J){J-=V;do{te[l++]=y[z++]}while(--V);z=l-ae,Q=te}for(;J>2;)te[l++]=Q[z++],te[l++]=Q[z++],te[l++]=Q[z++],J-=3;J&&(te[l++]=Q[z++],J>1&&(te[l++]=Q[z++]))}else{z=l-ae;do{te[l++]=te[z++],te[l++]=te[z++],te[l++]=te[z++],J-=3}while(J>2);J&&(te[l++]=te[z++],J>1&&(te[l++]=te[z++]))}break}}break}}while(r<a&&l<h);J=b>>3,r-=J,b-=J<<3,C&=(1<<b)-1,s.next_in=r,s.next_out=l,s.avail_in=r<a?a-r+5:5-(r-a),s.avail_out=l<h?h-l+257:257-(l-h),Ce.hold=C,Ce.bits=b};const g3=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),E3=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Ux=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Vx=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var F_=(s,i,r,a,l,d,h,f)=>{const m=f.bits;let g,E,y,C,b,O,P=0,D=0,L=0,B=0,V=0,J=0,ae=0,z=0,Q=0,X=0,te=null;const Ce=new Uint16Array(16),Se=new Uint16Array(16);let He,ut,mt,dt=null;for(P=0;P<=15;P++)Ce[P]=0;for(D=0;D<a;D++)Ce[i[r+D]]++;for(V=m,B=15;B>=1&&0===Ce[B];B--);if(V>B&&(V=B),0===B)return l[d++]=20971520,l[d++]=20971520,f.bits=1,0;for(L=1;L<B&&0===Ce[L];L++);for(V<L&&(V=L),z=1,P=1;P<=15;P++)if(z<<=1,z-=Ce[P],z<0)return-1;if(z>0&&(0===s||1!==B))return-1;for(Se[1]=0,P=1;P<15;P++)Se[P+1]=Se[P]+Ce[P];for(D=0;D<a;D++)0!==i[r+D]&&(h[Se[i[r+D]]++]=D);if(0===s?(te=dt=h,O=20):1===s?(te=g3,dt=E3,O=257):(te=Ux,dt=Vx,O=0),X=0,D=0,P=L,b=d,J=V,ae=0,y=-1,Q=1<<V,C=Q-1,1===s&&Q>852||2===s&&Q>592)return 1;for(;;){He=P-ae,h[D]+1<O?(ut=0,mt=h[D]):h[D]>=O?(ut=dt[h[D]-O],mt=te[h[D]-O]):(ut=96,mt=0),g=1<<P-ae,E=1<<J,L=E;do{E-=g,l[b+(X>>ae)+E]=He<<24|ut<<16|mt|0}while(0!==E);for(g=1<<P-1;X&g;)g>>=1;if(0!==g?(X&=g-1,X+=g):X=0,D++,0==--Ce[P]){if(P===B)break;P=i[r+h[D]]}if(P>V&&(X&C)!==y){for(0===ae&&(ae=V),b+=L,J=P-ae,z=1<<J;J+ae<B&&(z-=Ce[J+ae],!(z<=0));)J++,z<<=1;if(Q+=1<<J,1===s&&Q>852||2===s&&Q>592)return 1;y=X&C,l[y]=V<<24|J<<16|b-d|0}}return 0!==X&&(l[b+X]=P-ae<<24|64<<16|0),f.bits=V,0};const{Z_FINISH:DO,Z_BLOCK:Bx,Z_TREES:tb,Z_OK:Iu,Z_STREAM_END:jx,Z_NEED_DICT:Hx,Z_STREAM_ERROR:_a,Z_DATA_ERROR:Gx,Z_MEM_ERROR:OO,Z_BUF_ERROR:Wx,Z_DEFLATED:NO}=sp,YE=16180,$E=16190,sr=16191,JE=16199,XE=16200,Ri=16209,MO=s=>(s>>>24&255)+(s>>>8&65280)+((65280&s)<<8)+((255&s)<<24);function Kx(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const ma=s=>{if(!s)return 1;const i=s.state;return!i||i.strm!==s||i.mode<YE||i.mode>16211?1:0},rb=s=>{if(ma(s))return _a;const i=s.state;return s.total_in=s.total_out=i.total=0,s.msg="",i.wrap&&(s.adler=1&i.wrap),i.mode=YE,i.last=0,i.havedict=0,i.flags=-1,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Int32Array(852),i.distcode=i.distdyn=new Int32Array(592),i.sane=1,i.back=-1,Iu},qx=s=>{if(ma(s))return _a;const i=s.state;return i.wsize=0,i.whave=0,i.wnext=0,rb(s)},kO=(s,i)=>{let r;if(ma(s))return _a;const a=s.state;return i<0?(r=0,i=-i):(r=5+(i>>4),i<48&&(i&=15)),i&&(i<8||i>15)?_a:(null!==a.window&&a.wbits!==i&&(a.window=null),a.wrap=r,a.wbits=i,qx(s))},zx=(s,i)=>{if(!s)return _a;const r=new Kx;s.state=r,r.strm=s,r.window=null,r.mode=YE;const a=kO(s,i);return a!==Iu&&(s.state=null),a};let LO,xO,QE=!0;const Yx=s=>{if(QE){LO=new Int32Array(512),xO=new Int32Array(32);let i=0;for(;i<144;)s.lens[i++]=8;for(;i<256;)s.lens[i++]=9;for(;i<280;)s.lens[i++]=7;for(;i<288;)s.lens[i++]=8;for(F_(1,s.lens,0,288,LO,0,s.work,{bits:9}),i=0;i<32;)s.lens[i++]=5;F_(2,s.lens,0,32,xO,0,s.work,{bits:5}),QE=!1}s.lencode=LO,s.lenbits=9,s.distcode=xO,s.distbits=5},FO=(s,i,r,a)=>{let l;const d=s.state;return null===d.window&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),a>=d.wsize?(d.window.set(i.subarray(r-d.wsize,r),0),d.wnext=0,d.whave=d.wsize):(l=d.wsize-d.wnext,l>a&&(l=a),d.window.set(i.subarray(r-a,r-a+l),d.wnext),(a-=l)?(d.window.set(i.subarray(r-a,r),0),d.wnext=a,d.whave=d.wsize):(d.wnext+=l,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=l))),0};var Kl_inflateReset=qx,Kl_inflateInit2=zx,Kl_inflate=(s,i)=>{let r,a,l,d,h,f,m,g,E,y,C,b,O,P,D,L,B,V,J,ae,z,Q,X=0;const te=new Uint8Array(4);let Ce,Se;const He=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ma(s)||!s.output||!s.input&&0!==s.avail_in)return _a;r=s.state,r.mode===sr&&(r.mode=16192),h=s.next_out,l=s.output,m=s.avail_out,d=s.next_in,a=s.input,f=s.avail_in,g=r.hold,E=r.bits,y=f,C=m,Q=Iu;e:for(;;)switch(r.mode){case YE:if(0===r.wrap){r.mode=16192;break}for(;E<16;){if(0===f)break e;f--,g+=a[d++]<<E,E+=8}if(2&r.wrap&&35615===g){0===r.wbits&&(r.wbits=15),r.check=0,te[0]=255&g,te[1]=g>>>8&255,r.check=vr(r.check,te,2,0),g=0,E=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&g)<<8)+(g>>8))%31){s.msg="incorrect header check",r.mode=Ri;break}if((15&g)!==NO){s.msg="unknown compression method",r.mode=Ri;break}if(g>>>=4,E-=4,z=8+(15&g),0===r.wbits&&(r.wbits=z),z>15||z>r.wbits){s.msg="invalid window size",r.mode=Ri;break}r.dmax=1<<r.wbits,r.flags=0,s.adler=r.check=1,r.mode=512&g?16189:sr,g=0,E=0;break;case 16181:for(;E<16;){if(0===f)break e;f--,g+=a[d++]<<E,E+=8}if(r.flags=g,(255&r.flags)!==NO){s.msg="unknown compression method",r.mode=Ri;break}if(57344&r.flags){s.msg="unknown header flags set",r.mode=Ri;break}r.head&&(r.head.text=g>>8&1),512&r.flags&&4&r.wrap&&(te[0]=255&g,te[1]=g>>>8&255,r.check=vr(r.check,te,2,0)),g=0,E=0,r.mode=16182;case 16182:for(;E<32;){if(0===f)break e;f--,g+=a[d++]<<E,E+=8}r.head&&(r.head.time=g),512&r.flags&&4&r.wrap&&(te[0]=255&g,te[1]=g>>>8&255,te[2]=g>>>16&255,te[3]=g>>>24&255,r.check=vr(r.check,te,4,0)),g=0,E=0,r.mode=16183;case 16183:for(;E<16;){if(0===f)break e;f--,g+=a[d++]<<E,E+=8}r.head&&(r.head.xflags=255&g,r.head.os=g>>8),512&r.flags&&4&r.wrap&&(te[0]=255&g,te[1]=g>>>8&255,r.check=vr(r.check,te,2,0)),g=0,E=0,r.mode=16184;case 16184:if(1024&r.flags){for(;E<16;){if(0===f)break e;f--,g+=a[d++]<<E,E+=8}r.length=g,r.head&&(r.head.extra_len=g),512&r.flags&&4&r.wrap&&(te[0]=255&g,te[1]=g>>>8&255,r.check=vr(r.check,te,2,0)),g=0,E=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&r.flags&&(b=r.length,b>f&&(b=f),b&&(r.head&&(z=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(a.subarray(d,d+b),z)),512&r.flags&&4&r.wrap&&(r.check=vr(r.check,a,b,d)),f-=b,d+=b,r.length-=b),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&r.flags){if(0===f)break e;b=0;do{z=a[d+b++],r.head&&z&&r.length<65536&&(r.head.name+=String.fromCharCode(z))}while(z&&b<f);if(512&r.flags&&4&r.wrap&&(r.check=vr(r.check,a,b,d)),f-=b,d+=b,z)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&r.flags){if(0===f)break e;b=0;do{z=a[d+b++],r.head&&z&&r.length<65536&&(r.head.comment+=String.fromCharCode(z))}while(z&&b<f);if(512&r.flags&&4&r.wrap&&(r.check=vr(r.check,a,b,d)),f-=b,d+=b,z)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&r.flags){for(;E<16;){if(0===f)break e;f--,g+=a[d++]<<E,E+=8}if(4&r.wrap&&g!==(65535&r.check)){s.msg="header crc mismatch",r.mode=Ri;break}g=0,E=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),s.adler=r.check=0,r.mode=sr;break;case 16189:for(;E<32;){if(0===f)break e;f--,g+=a[d++]<<E,E+=8}s.adler=r.check=MO(g),g=0,E=0,r.mode=$E;case $E:if(0===r.havedict)return s.next_out=h,s.avail_out=m,s.next_in=d,s.avail_in=f,r.hold=g,r.bits=E,Hx;s.adler=r.check=1,r.mode=sr;case sr:if(i===Bx||i===tb)break e;case 16192:if(r.last){g>>>=7&E,E-=7&E,r.mode=16206;break}for(;E<3;){if(0===f)break e;f--,g+=a[d++]<<E,E+=8}switch(r.last=1&g,g>>>=1,E-=1,3&g){case 0:r.mode=16193;break;case 1:if(Yx(r),r.mode=JE,i===tb){g>>>=2,E-=2;break e}break;case 2:r.mode=16196;break;case 3:s.msg="invalid block type",r.mode=Ri}g>>>=2,E-=2;break;case 16193:for(g>>>=7&E,E-=7&E;E<32;){if(0===f)break e;f--,g+=a[d++]<<E,E+=8}if((65535&g)!=(g>>>16^65535)){s.msg="invalid stored block lengths",r.mode=Ri;break}if(r.length=65535&g,g=0,E=0,r.mode=16194,i===tb)break e;case 16194:r.mode=16195;case 16195:if(b=r.length,b){if(b>f&&(b=f),b>m&&(b=m),0===b)break e;l.set(a.subarray(d,d+b),h),f-=b,d+=b,m-=b,h+=b,r.length-=b;break}r.mode=sr;break;case 16196:for(;E<14;){if(0===f)break e;f--,g+=a[d++]<<E,E+=8}if(r.nlen=257+(31&g),g>>>=5,E-=5,r.ndist=1+(31&g),g>>>=5,E-=5,r.ncode=4+(15&g),g>>>=4,E-=4,r.nlen>286||r.ndist>30){s.msg="too many length or distance symbols",r.mode=Ri;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;E<3;){if(0===f)break e;f--,g+=a[d++]<<E,E+=8}r.lens[He[r.have++]]=7&g,g>>>=3,E-=3}for(;r.have<19;)r.lens[He[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,Ce={bits:r.lenbits},Q=F_(0,r.lens,0,19,r.lencode,0,r.work,Ce),r.lenbits=Ce.bits,Q){s.msg="invalid code lengths set",r.mode=Ri;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;X=r.lencode[g&(1<<r.lenbits)-1],D=X>>>24,L=X>>>16&255,B=65535&X,!(D<=E);){if(0===f)break e;f--,g+=a[d++]<<E,E+=8}if(B<16)g>>>=D,E-=D,r.lens[r.have++]=B;else{if(16===B){for(Se=D+2;E<Se;){if(0===f)break e;f--,g+=a[d++]<<E,E+=8}if(g>>>=D,E-=D,0===r.have){s.msg="invalid bit length repeat",r.mode=Ri;break}z=r.lens[r.have-1],b=3+(3&g),g>>>=2,E-=2}else if(17===B){for(Se=D+3;E<Se;){if(0===f)break e;f--,g+=a[d++]<<E,E+=8}g>>>=D,E-=D,z=0,b=3+(7&g),g>>>=3,E-=3}else{for(Se=D+7;E<Se;){if(0===f)break e;f--,g+=a[d++]<<E,E+=8}g>>>=D,E-=D,z=0,b=11+(127&g),g>>>=7,E-=7}if(r.have+b>r.nlen+r.ndist){s.msg="invalid bit length repeat",r.mode=Ri;break}for(;b--;)r.lens[r.have++]=z}}if(r.mode===Ri)break;if(0===r.lens[256]){s.msg="invalid code -- missing end-of-block",r.mode=Ri;break}if(r.lenbits=9,Ce={bits:r.lenbits},Q=F_(1,r.lens,0,r.nlen,r.lencode,0,r.work,Ce),r.lenbits=Ce.bits,Q){s.msg="invalid literal/lengths set",r.mode=Ri;break}if(r.distbits=6,r.distcode=r.distdyn,Ce={bits:r.distbits},Q=F_(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,Ce),r.distbits=Ce.bits,Q){s.msg="invalid distances set",r.mode=Ri;break}if(r.mode=JE,i===tb)break e;case JE:r.mode=XE;case XE:if(f>=6&&m>=258){s.next_out=h,s.avail_out=m,s.next_in=d,s.avail_in=f,r.hold=g,r.bits=E,Fx(s,C),h=s.next_out,l=s.output,m=s.avail_out,d=s.next_in,a=s.input,f=s.avail_in,g=r.hold,E=r.bits,r.mode===sr&&(r.back=-1);break}for(r.back=0;X=r.lencode[g&(1<<r.lenbits)-1],D=X>>>24,L=X>>>16&255,B=65535&X,!(D<=E);){if(0===f)break e;f--,g+=a[d++]<<E,E+=8}if(L&&0==(240&L)){for(V=D,J=L,ae=B;X=r.lencode[ae+((g&(1<<V+J)-1)>>V)],D=X>>>24,L=X>>>16&255,B=65535&X,!(V+D<=E);){if(0===f)break e;f--,g+=a[d++]<<E,E+=8}g>>>=V,E-=V,r.back+=V}if(g>>>=D,E-=D,r.back+=D,r.length=B,0===L){r.mode=16205;break}if(32&L){r.back=-1,r.mode=sr;break}if(64&L){s.msg="invalid literal/length code",r.mode=Ri;break}r.extra=15&L,r.mode=16201;case 16201:if(r.extra){for(Se=r.extra;E<Se;){if(0===f)break e;f--,g+=a[d++]<<E,E+=8}r.length+=g&(1<<r.extra)-1,g>>>=r.extra,E-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;X=r.distcode[g&(1<<r.distbits)-1],D=X>>>24,L=X>>>16&255,B=65535&X,!(D<=E);){if(0===f)break e;f--,g+=a[d++]<<E,E+=8}if(0==(240&L)){for(V=D,J=L,ae=B;X=r.distcode[ae+((g&(1<<V+J)-1)>>V)],D=X>>>24,L=X>>>16&255,B=65535&X,!(V+D<=E);){if(0===f)break e;f--,g+=a[d++]<<E,E+=8}g>>>=V,E-=V,r.back+=V}if(g>>>=D,E-=D,r.back+=D,64&L){s.msg="invalid distance code",r.mode=Ri;break}r.offset=B,r.extra=15&L,r.mode=16203;case 16203:if(r.extra){for(Se=r.extra;E<Se;){if(0===f)break e;f--,g+=a[d++]<<E,E+=8}r.offset+=g&(1<<r.extra)-1,g>>>=r.extra,E-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){s.msg="invalid distance too far back",r.mode=Ri;break}r.mode=16204;case 16204:if(0===m)break e;if(b=C-m,r.offset>b){if(b=r.offset-b,b>r.whave&&r.sane){s.msg="invalid distance too far back",r.mode=Ri;break}b>r.wnext?(b-=r.wnext,O=r.wsize-b):O=r.wnext-b,b>r.length&&(b=r.length),P=r.window}else P=l,O=h-r.offset,b=r.length;b>m&&(b=m),m-=b,r.length-=b;do{l[h++]=P[O++]}while(--b);0===r.length&&(r.mode=XE);break;case 16205:if(0===m)break e;l[h++]=r.length,m--,r.mode=XE;break;case 16206:if(r.wrap){for(;E<32;){if(0===f)break e;f--,g|=a[d++]<<E,E+=8}if(C-=m,s.total_out+=C,r.total+=C,4&r.wrap&&C&&(s.adler=r.check=r.flags?vr(r.check,l,C,h-C):P_(r.check,l,C,h-C)),C=m,4&r.wrap&&(r.flags?g:MO(g))!==r.check){s.msg="incorrect data check",r.mode=Ri;break}g=0,E=0}r.mode=16207;case 16207:if(r.wrap&&r.flags){for(;E<32;){if(0===f)break e;f--,g+=a[d++]<<E,E+=8}if(4&r.wrap&&g!==(4294967295&r.total)){s.msg="incorrect length check",r.mode=Ri;break}g=0,E=0}r.mode=16208;case 16208:Q=jx;break e;case Ri:Q=Gx;break e;case 16210:return OO;default:return _a}return s.next_out=h,s.avail_out=m,s.next_in=d,s.avail_in=f,r.hold=g,r.bits=E,(r.wsize||C!==s.avail_out&&r.mode<Ri&&(r.mode<16206||i!==DO))&&FO(s,s.output,s.next_out,C-s.avail_out),y-=s.avail_in,C-=s.avail_out,s.total_in+=y,s.total_out+=C,r.total+=C,4&r.wrap&&C&&(s.adler=r.check=r.flags?vr(r.check,l,C,s.next_out-C):P_(r.check,l,C,s.next_out-C)),s.data_type=r.bits+(r.last?64:0)+(r.mode===sr?128:0)+(r.mode===JE||16194===r.mode?256:0),(0===y&&0===C||i===DO)&&Q===Iu&&(Q=Wx),Q},Kl_inflateEnd=s=>{if(ma(s))return _a;let i=s.state;return i.window&&(i.window=null),s.state=null,Iu},Kl_inflateGetHeader=(s,i)=>{if(ma(s))return _a;const r=s.state;return 0==(2&r.wrap)?_a:(r.head=i,i.done=!1,Iu)},Kl_inflateSetDictionary=(s,i)=>{const r=i.length;let a,l,d;return ma(s)?_a:(a=s.state,0!==a.wrap&&a.mode!==$E?_a:a.mode===$E&&(l=1,l=P_(l,i,r,0),l!==a.check)?Gx:(d=FO(s,i,r,r),d?(a.mode=16210,OO):(a.havedict=1,Iu)))},Jx=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const UO=Object.prototype.toString,{Z_NO_FLUSH:Xx,Z_FINISH:ga,Z_OK:ZE,Z_STREAM_END:ey,Z_NEED_DICT:ob,Z_STREAM_ERROR:VO,Z_DATA_ERROR:sb,Z_MEM_ERROR:BO}=sp;function wu(s){this.options=bu_assign({chunkSize:65536,windowBits:15,to:""},s||{});const i=this.options;i.raw&&i.windowBits>=0&&i.windowBits<16&&(i.windowBits=-i.windowBits,0===i.windowBits&&(i.windowBits=-15)),!(i.windowBits>=0&&i.windowBits<16)||s&&s.windowBits||(i.windowBits+=32),i.windowBits>15&&i.windowBits<48&&0==(15&i.windowBits)&&(i.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Wl,this.strm.avail_out=0;let r=Kl_inflateInit2(this.strm,i.windowBits);if(r!==ZE)throw new Error(Vc[r]);if(this.header=new Jx,Kl_inflateGetHeader(this.strm,this.header),i.dictionary&&("string"==typeof i.dictionary?i.dictionary=dp_string2buf(i.dictionary):"[object ArrayBuffer]"===UO.call(i.dictionary)&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw&&(r=Kl_inflateSetDictionary(this.strm,i.dictionary),r!==ZE)))throw new Error(Vc[r])}function U_(s,i){const r=new wu(i);if(r.push(s),r.err)throw r.msg||Vc[r.err];return r.result}wu.prototype.push=function(s,i){const r=this.strm,a=this.options.chunkSize,l=this.options.dictionary;let d,h,f;if(this.ended)return!1;for(h=i===~~i?i:!0===i?ga:Xx,r.input="[object ArrayBuffer]"===UO.call(s)?new Uint8Array(s):s,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(a),r.next_out=0,r.avail_out=a),d=Kl_inflate(r,h),d===ob&&l&&(d=Kl_inflateSetDictionary(r,l),d===ZE?d=Kl_inflate(r,h):d===sb&&(d=ob));r.avail_in>0&&d===ey&&r.state.wrap>0&&0!==s[r.next_in];)Kl_inflateReset(r),d=Kl_inflate(r,h);switch(d){case VO:case sb:case ob:case BO:return this.onEnd(d),this.ended=!0,!1}if(f=r.avail_out,r.next_out&&(0===r.avail_out||d===ey))if("string"===this.options.to){let m=dp_utf8border(r.output,r.next_out),g=r.next_out-m,E=dp_buf2string(r.output,m);r.next_out=g,r.avail_out=a-g,g&&r.output.set(r.output.subarray(m,m+g),0),this.onData(E)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(d!==ZE||0!==f){if(d===ey)return d=Kl_inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},wu.prototype.onData=function(s){this.chunks.push(s)},wu.prototype.onEnd=function(s){s===ZE&&(this.result="string"===this.options.to?this.chunks.join(""):bu_flattenChunks(this.chunks)),this.chunks=[],this.err=s,this.msg=this.strm.msg};var ab={Inflate:wu,inflate:U_,inflateRaw:function(s,i){return(i=i||{}).raw=!0,U_(s,i)},ungzip:U_,constants:sp};const{deflate:ty}=m3,{inflate:e2}=ab;var lb,n2=ty,db=e2;!function(s){s[s.ONE_BYTE=0]="ONE_BYTE",s[s.TWO_BYTE=1]="TWO_BYTE"}(lb||(lb={}));class r2{constructor(){T(this,"_sequence",0),T(this,"_startTime",Date.now()),T(this,"isUseOneByte",!0)}get startTime(){const i=Date.now()-this._startTime;return i<Math.pow(2,16)?i:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(i){const r={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:i};if(i.byteLength>128){const f=new Uint8Array(4);f.set([1,0,0,0]);const g={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[{id:0,length:4,data:f.buffer}]};r.commonPacketHeader.extension=1,r.extension=g,r.payload=this.compress(i),r.commonPacketHeader.length=8+(r.extension.length+2)+r.payload.byteLength}else r.commonPacketHeader.length=8+r.payload.byteLength;const a=new ArrayBuffer(r.commonPacketHeader.length),l=new Uint8Array(a),d=new DataView(a);let h=0;if(d.setUint16(h,r.commonPacketHeader.extension<<15|r.commonPacketHeader.reserved<<14|r.commonPacketHeader.length,!0),h+=2,d.setUint32(h,r.commonPacketHeader.sequence,!0),h+=4,d.setUint16(h,r.commonStreamHeader,!0),h+=2,r.extension){const f=this.serializeExtension(r.extension);l.set(new Uint8Array(f),h),h+=f.byteLength}if(l.set(new Uint8Array(r.payload),h),h+=r.payload.byteLength,h!==r.commonPacketHeader.length)throw Error("serialize error!");return a}deserialize(i){if(i.byteLength<4)return new ArrayBuffer(0);const r=new DataView(i);let a=0;const l=r.getUint16(a,!0);a+=2;const d=(32768&l)>>15;let h,f;if(r.getUint16(a+2,!0),r.getUint16(a,!0),a+=4,r.getUint16(a,!0),a+=2,d){f=this.deserializeExtension(i.slice(a)),a+=2+f.length,h=i.slice(a);let m=!1;if(f.datas.length>0){const g=f.datas.find(E=>0===E.id);g&&(m=1==(1&new DataView(g.data).getUint32(0,!0)))}h=m?this.decompress(h):h}else h=i.slice(8);return h}serializeExtension(i){const{profile:r,length:a,datas:l}=i,d=new ArrayBuffer(a+2),h=new Uint8Array(d),f=new DataView(d);let m=0;if(f.setUint8(m++,r),f.setUint8(m++,a),l.forEach(g=>{r?(f.setUint8(m++,g.id),f.setUint8(m++,g.length),h.set(new Uint8Array(g.data),m),m+=g.data.byteLength):(f.setUint8(m++,g.id|g.length<<4),h.set(new Uint8Array(g.data),m),m+=g.data.byteLength)}),m!==a+2)throw Error("serialize extension error, is ".concat(m,"!==").concat(a+2));return d}deserializeExtension(i){const r=new DataView(i);let a=0;const l=r.getUint8(a);a++;const d=r.getUint8(a);a++;const h=l===lb.TWO_BYTE,f=[],m=new DataView(i,2);let g=0;for(;g<d;){let E=0,y=0,C=new ArrayBuffer(0);h?(E=m.getUint8(g),g++,y=m.getUint8(g),g++):(E=15&m.getUint8(g),y=m.getUint8(g)>>4,g++),y>0&&(C=m.buffer.slice(g+2,g+2+y),g+=C.byteLength),f.push({id:E,length:y,data:C})}if(g!==d)throw Error("parse error");return{profile:l,length:d,datas:f}}decompress(i){return db(new Uint8Array(i))}compress(i){return n2(new Uint8Array(i))}}class $r extends nn{constructor(i,r){super(),T(this,"_version",1),T(this,"_type",3),T(this,"_config",void 0),T(this,"_originDataChannel",void 0),T(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),T(this,"_dataStreamPacketHandler",void 0),T(this,"_datachannelEventMap",new Map),this._config=i,r&&(this._originDataChannel=r,this._bandDataChannelEvents(r)),this._initPacketHeader(),this._dataStreamPacketHandler=new r2}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return H("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var i,r;return null!==(i=null===(r=this._originDataChannel)||void 0===r?void 0:r.readyState)&&void 0!==i?i:"connecting"}get _originDataChannelId(){var i,r;return null!==(i=null===(r=this._originDataChannel)||void 0===r?void 0:r.id)&&void 0!==i?i:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}_waitTillOpen(){var i=this;return x(function*(){return new q((r,a)=>{if(i._originDataChannel){"open"===i._originDataChannel.readyState&&r();const l=setTimeout(()=>{var d;a(new ne(k.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(d=i._originDataChannel)||void 0===d?void 0:d.id)))},1e4);i._originDataChannel.onopen=()=>{clearTimeout(l),i._originDataChannel&&i._bandDataChannelEvents(i._originDataChannel),r()},i._originDataChannel.onerror=()=>{throw clearTimeout(l),new ne(k.DATACHANNEL_CONNECTION_TIMEOUT)}}else a(new ne(k.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})})()}_updateOriginDataChannel(i){this._originDataChannel=i,this._bandDataChannelEvents(i)}_initPacketHeader(){const i=new DataView(this._dataStreamPacketHeader);i.setUint16(0,this._version),i.setUint8(2,this._type),i.setUint8(3,this._config.id)}_bandDataChannelEvents(i){this._unbindDataChannelEvents(i),[fu.OPEN,fu.CLOSE,fu.ERROR].forEach(r=>{const a=()=>{this.emit(r)};this._datachannelEventMap.set(r,a),i.addEventListener(r,a)})}_unbindDataChannelEvents(i){Array.from(this._datachannelEventMap.entries()).forEach(r=>{let[a,l]=r;i.removeEventListener(a,l)}),this._datachannelEventMap.clear()}}class V_ extends $r{constructor(i){super(i),T(this,"_messageListener",void 0),this._messageListener=r=>{if(r.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const a=r.data.slice(0,this._dataStreamPacketHeader.byteLength);if(new DataView(a).getUint8(3)!==this.id)return;let l=r.data.slice(this._dataStreamPacketHeader.byteLength);l=this._dataStreamPacketHandler.deserialize(l),this.emit(fu.MESSAGE,l)}}_updateOriginDataChannel(i){super._updateOriginDataChannel(i),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class B_ extends $r{send(i){if(this._originDataChannel){let r=i;r=this._dataStreamPacketHandler.serialize(i);const a=new Uint8Array(this._dataStreamPacketHeader.byteLength+r.byteLength);a.set(new Uint8Array(this._dataStreamPacketHeader),0),a.set(new Uint8Array(r),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(a.buffer)}}}class jO extends nn{constructor(){super(...arguments),T(this,"resultStorage",new Map)}setLocalAudioStats(i,r,a){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",i,this.checkAudioInputLevel(a,r)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",i,this.checkSendAudioBitrate(a,r))}setLocalVideoStats(i,r,a){this.record("SEND_VIDEO_BITRATE_TOO_LOW",i,this.checkSendVideoBitrate(a,r)),this.record("FRAMERATE_INPUT_TOO_LOW",i,this.checkFramerateInput(a,r)),this.record("FRAMERATE_SENT_TOO_LOW",i,this.checkFramerateSent(a))}setRemoteAudioStats(i,r){const a=i.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",a,this.checkAudioOutputLevel(r))}setRemoteVideoStats(i,r){const a=i.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",a,this.checkVideoDecode(r))}record(i,r,a){if(H("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(i)||this.resultStorage.set(i,{result:[],isPrevNormal:!0});const l=this.resultStorage.get(i);if(l&&(l.result.push(a),l.result.length>=5)){var d;const h=we(d=l.result).call(d,!0);l.isPrevNormal&&!h&&this.emit("exception",j_[i],i,r),!l.isPrevNormal&&h&&this.emit("exception",j_[i]+2e3,i+"_RECOVER",r),l.isPrevNormal=h,l.result=[]}}checkAudioOutputLevel(i){return!(i.receiveBitrate>0&&0===i.receiveLevel)}checkAudioInputLevel(i,r){return r instanceof ei&&!r.isActive||!!r.muted||0!==i.sendVolumeLevel}checkFramerateInput(i,r){let a=null;r._encoderConfig&&r._encoderConfig.frameRate&&(a=To(r._encoderConfig.frameRate));const l=i.captureFrameRate;return!a||!l||!(a>10&&l<5||a<10&&a>=5&&l<=1)}checkFramerateSent(i){return!(i.captureFrameRate&&i.sendFrameRate&&i.captureFrameRate>5&&i.sendFrameRate<=1)}checkSendVideoBitrate(i,r){return!!r.muted||0!==i.sendBitrate}checkSendAudioBitrate(i,r){return r instanceof ei&&!r.isActive||!!r.muted||0!==i.sendBitrate}checkVideoDecode(i){return 0===i.receiveBitrate||0!==i.decodeFrameRate}}const j_={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Ni=new class{markSubscribeStart(s,i){performance.mark("agora-web-sdk/".concat(s,"/subscribe-").concat(i))}markPublishStart(s,i){performance.mark("agora-web-sdk/".concat(s,"/publish-").concat(i))}measureFromSubscribeStart(s,i){const r=performance.getEntriesByName("agora-web-sdk/".concat(s,"/subscribe-").concat(i));if(r.length>0){const a=r[r.length-1];return Math.round(performance.now()-a.startTime)}return 0}measureFromPublishStart(s,i){const r=performance.getEntriesByName("agora-web-sdk/".concat(s,"/publish-").concat(i));if(r.length>0){const a=r[r.length-1];return Math.round(performance.now()-a.startTime)}return 0}};function ub(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function qa(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?ub(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):ub(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class up{constructor(i){T(this,"store",void 0),T(this,"onStatsException",void 0),T(this,"onUploadPublishDuration",void 0),T(this,"onStatsChanged",void 0),T(this,"localStats",new Map),T(this,"remoteStats",new Map),T(this,"updateStatsInterval",void 0),T(this,"trafficStats",void 0),T(this,"trafficStatsPeerList",[]),T(this,"uplinkStats",void 0),T(this,"exceptionMonitor",void 0),T(this,"p2pChannel",void 0),T(this,"scalabilityMode",EE.L1T1),T(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=i,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new jO,this.exceptionMonitor.on("exception",(r,a,l)=>{this.onStatsException&&this.onStatsException(r,a,l)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(se.LocalAudioTrack)||qa({},gT)}getLocalVideoTrackStats(){return this.localStats.get(se.LocalVideoTrack)||qa({},WD)}getRemoteAudioTrackStats(i){const r=(d,h)=>{if(!this.trafficStats)return h;const f=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return f&&(h.publishDuration=f.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},a={};if(i){var l;const d=null===(l=this.remoteStats.get(i))||void 0===l?void 0:l.audioStats;d&&(a[i]=r(i,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{audioStats:f}]=d;f&&(a[h]=r(h,f))});return a}getRemoteNetworkQualityStats(i){const r={};if(i){var a;const l=null===(a=this.remoteStats.get(i))||void 0===a?void 0:a.networkStats;l&&(r[i]=l)}else Array.from(this.remoteStats.entries()).forEach(l=>{let[d,{networkStats:h}]=l;h&&(r[d]=h)});return r}getRemoteVideoTrackStats(i){const r=(d,h)=>{if(!this.trafficStats)return h;const f=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return f&&(h.publishDuration=f.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},a={};if(i){var l;const d=null===(l=this.remoteStats.get(i))||void 0===l?void 0:l.videoStats;d&&(a[i]=r(i,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{videoStats:f}]=d;f&&(a[h]=r(h,f))});return a}getRTCStats(){let i=0,r=0,a=0,l=0;const d=this.localStats.get(se.LocalAudioTrack);d&&(i+=d.sendBytes,r+=d.sendBitrate);const h=this.localStats.get(se.LocalVideoTrack);h&&(i+=h.sendBytes,r+=h.sendBitrate);const f=this.localStats.get(se.LocalVideoLowTrack);f&&(i+=f.sendBytes,r+=f.sendBitrate),this.remoteStats.forEach(g=>{let{audioStats:E,videoStats:y}=g;E&&(a+=E.receiveBytes,l+=E.receiveBitrate),y&&(a+=y.receiveBytes,l+=y.receiveBitrate)});let m=1;return this.trafficStats&&(m+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:m,SendBitrate:r,SendBytes:i,RecvBytes:a,RecvBitrate:l,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(i){this.localStats.set(i,void 0)}removeLocalStats(i){i?this.localStats.delete(i):this.localStats.clear()}addRemoteStats(i){this.remoteStats.set(i,{})}removeRemoteStats(i){i?this.remoteStats.delete(i):this.remoteStats.clear()}addP2PChannel(i){this.p2pChannel=i}updateTrafficStats(i){i.peer_delay=i.peer_delay.filter(r=>void 0!==r.B_ppad||void 0!==r.B_ppvd),i.peer_delay.filter(r=>-1===this.trafficStatsPeerList.indexOf(r.peer_uid)).forEach(r=>{var a;const l=null===(a=this.p2pChannel)||void 0===a?void 0:a.getRemoteMedia(r.peer_uid),d=null!=l&&l.videoSSRC?Ni.measureFromSubscribeStart(this.store.clientId,l.videoSSRC):0,h=null!=l&&l.audioSSRC?Ni.measureFromSubscribeStart(this.store.clientId,l.audioSSRC):0;void 0!==r.B_ppad&&void 0!==r.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(r.peer_uid,r.B_ppad,r.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(r.peer_uid))}),this.trafficStats=i}updateUplinkStats(i){this.uplinkStats&&this.uplinkStats.B_fir!==i.B_fir&&R.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(i.B_fir)),this.uplinkStats=i}static isRemoteVideoFreeze(i,r,a){return!!i&&(!!a&&r.framesDecodeFreezeTime>a.framesDecodeFreezeTime||!(!a||r.framesDecodeCount>a.framesDecodeCount))}static isRemoteAudioFreeze(i){return!!i&&i._isFreeze()}isLocalVideoFreeze(i){return!(!i.inputFrame||!i.sentFrame)&&i.inputFrame.frameRate>5&&i.sentFrame.frameRate<3}updateLocalStats(i){Array.from(this.localStats.entries()).forEach(r=>{let[a,l]=r;switch(a){case se.LocalVideoTrack:case se.LocalVideoLowTrack:{const h=l,f=qa({},WD),m=i.getStats(),g=i.getLocalMedia(a);if(m){const E=m.videoSend.find(y=>y.ssrc===(null==g?void 0:g.ssrcs[0].ssrcId));if(E){const y=i.getLocalVideoSize(),C=i.getEncoderConfig(se.LocalVideoTrack);"H264"!==E.codec&&"H265"!==E.codec&&"VP8"!==E.codec&&"VP9"!==E.codec&&"AV1X"!==E.codec&&"AV1"!==E.codec||(f.codecType=E.codec),f.sendBytes=E.bytes,f.sendBitrate=h?8*Math.max(0,f.sendBytes-h.sendBytes):0,E.inputFrame?(f.captureFrameRate=E.inputFrame.frameRate,f.captureResolutionHeight=E.inputFrame.height,f.captureResolutionWidth=E.inputFrame.width):y&&(f.captureResolutionWidth=y.width,f.captureResolutionHeight=y.height),E.sentFrame?(f.sendFrameRate=E.sentFrame.frameRate,f.sendResolutionHeight=E.sentFrame.height,f.sendResolutionWidth=E.sentFrame.width):y&&(f.sendResolutionWidth=y.width,f.sendResolutionHeight=y.height),E.avgEncodeMs&&(f.encodeDelay=E.avgEncodeMs),C&&C.bitrateMax&&(f.targetSendBitrate=1e3*C.bitrateMax),f.sendPackets=E.packets,f.sendPacketsLost=E.packetsLost,f.sendJitterMs=E.jitterMs,f.sendRttMs=E.rttMs,f.totalDuration=h?h.totalDuration+1:1,f.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(E)&&(f.totalFreezeTime+=1),E.scalabilityMode&&this.scalabilityMode!==E.scalabilityMode&&(R.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(E.scalabilityMode)),this.scalabilityMode=E.scalabilityMode)}this.trafficStats&&(f.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var d;this.localStats.set(a,f),((null==h?void 0:h.sendResolutionWidth)!==f.sendResolutionWidth||(null==h?void 0:h.sendResolutionHeight)!==f.sendResolutionHeight)&&(null===(d=this.onStatsChanged)||void 0===d||d.call(this,"resolution",{width:f.sendResolutionWidth,height:f.sendResolutionHeight})),f&&g&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,g.track,f);break}case se.LocalAudioTrack:{const h=l,f=qa({},gT),m=i.getStats(),g=i.getLocalMedia(a);if(m){const E=m.audioSend.find(y=>y.ssrc===(null==g?void 0:g.ssrcs[0].ssrcId));if(E){if("opus"!==E.codec&&"aac"!==E.codec&&"PCMU"!==E.codec&&"PCMA"!==E.codec&&"G722"!==E.codec||(f.codecType=E.codec),E.inputLevel)f.sendVolumeLevel=Math.round(32767*E.inputLevel);else{const y=i.getLocalAudioVolume();y&&(f.sendVolumeLevel=Math.round(32767*y))}f.sendBytes=E.bytes,f.sendPackets=E.packets,f.sendPacketsLost=E.packetsLost,f.sendJitterMs=E.jitterMs,f.sendRttMs=E.rttMs,f.sendBitrate=h?8*Math.max(0,f.sendBytes-h.sendBytes):0}}this.trafficStats&&(f.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(se.LocalAudioTrack,f),f&&g&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,g.track,f);break}}})}updateRemoteStats(i){Array.from(this.remoteStats.entries()).forEach(r=>{let[a,{videoStats:l,audioStats:d,videoPcStats:h}]=r;const f=d,m=l,g=h,E=qa({},wE),y=qa({},yT),C=qa({},ET),{audioTrack:b,videoTrack:O,audioSSRC:P,videoSSRC:D}=i.getRemoteMedia(a),L=i.getStats(),B=null==L?void 0:L.audioRecv.find(ae=>ae.ssrc===P),V=null==L?void 0:L.videoRecv.find(ae=>ae.ssrc===D),J=this.trafficStats&&this.trafficStats.peer_delay.find(ae=>ae.peer_uid===a);if(B&&("opus"!==B.codec&&"aac"!==B.codec&&"PCMU"!==B.codec&&"PCMA"!==B.codec&&"G722"!==B.codec||(E.codecType=B.codec),B.outputLevel?E.receiveLevel=Math.round(32767*B.outputLevel):b&&(E.receiveLevel=Math.round(32767*b.getVolumeLevel())),E.receiveBytes=B.bytes,E.receivePackets=B.packets,E.receivePacketsLost=B.packetsLost,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost),E.receiveBitrate=f?8*Math.max(0,E.receiveBytes-f.receiveBytes):0,E.totalDuration=f?f.totalDuration+1:1,E.totalFreezeTime=f?f.totalFreezeTime:0,E.freezeRate=E.totalFreezeTime/E.totalDuration,E.receiveDelay=B.jitterBufferMs,E.totalDuration>10&&up.isRemoteAudioFreeze(b)&&(E.totalFreezeTime+=1)),V){"H264"!==V.codec&&"H265"!==V.codec&&"VP8"!==V.codec&&"VP9"!==V.codec&&"AV1X"!==V.codec&&"AV1"!==V.codec||(y.codecType=V.codec),y.receiveBytes=V.bytes,y.receiveBitrate=m?8*Math.max(0,y.receiveBytes-m.receiveBytes):0,y.decodeFrameRate=V.decodeFrameRate<0?0:V.decodeFrameRate,y.renderFrameRate=V.decodeFrameRate<0?0:V.decodeFrameRate,V.outputFrame&&(y.renderFrameRate=V.outputFrame.frameRate),V.receivedFrame?(y.receiveFrameRate=V.receivedFrame.frameRate,y.receiveResolutionHeight=V.receivedFrame.height,y.receiveResolutionWidth=V.receivedFrame.width):O&&(y.receiveResolutionHeight=O._videoHeight||0,y.receiveResolutionWidth=O._videoWidth||0),void 0!==V.framesRateFirefox&&(y.receiveFrameRate=Math.round(V.framesRateFirefox)),y.receivePackets=V.packets,y.receivePacketsLost=V.packetsLost,y.packetLossRate=y.receivePacketsLost/(y.receivePackets+y.receivePacketsLost),y.totalDuration=m?m.totalDuration+1:1,y.totalFreezeTime=m?m.totalFreezeTime:0,y.receiveDelay=V.jitterBufferMs||0;const ae=!!D&&i.getRemoteVideoIsReady(D);O&&ae&&up.isRemoteVideoFreeze(O,V,g)&&(y.totalFreezeTime+=1),y.freezeRate=y.totalFreezeTime/y.totalDuration}J&&(E.end2EndDelay=J.B_ad,y.end2EndDelay=J.B_vd,E.transportDelay=J.B_ed,y.transportDelay=J.B_ed,E.currentPacketLossRate=J.B_ealr4/100,y.currentPacketLossRate=J.B_evlr4/100,C.uplinkNetworkQuality=J.B_punq?J.B_punq:0,C.downlinkNetworkQuality=J.B_pdnq?J.B_pdnq:0),this.remoteStats.set(a,{audioStats:E,videoStats:y,videoPcStats:V,networkStats:C}),b&&this.exceptionMonitor.setRemoteAudioStats(b,E),O&&this.exceptionMonitor.setRemoteVideoStats(O,y)})}}function HO(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function ny(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?HO(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):HO(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function H_(s){return s.match(/^[\.\:\d]+$/)?"".concat(s.replace(/[^\d]/g,"-"),".").concat(H("TURN_DOMAIN")):(R.info("Cannot recognized as IP address ".concat(s,". Used As Host instead")),s)}function hb(s,i){var r,a;const l=H("GATEWAY_DOMAINS");let d=l[1]&&-1!==i.indexOf(l[1])?1:0;s.addresses=s.addresses||[];const h=s.addresses.map(m=>m.domain_prefix?{address:"".concat(m.domain_prefix,".").concat(l[d++%l.length],":").concat(m.port)}:m.ip.match(/^[\.\:\d]+$/)?{ip:m.ip,port:m.port,address:"".concat(m.ip.replace(/[^\d]/g,"-"),".").concat(l[d++%l.length],":").concat(m.port)}:(R.info("Cannot recognized as IP address ".concat(m.ip,". Used As Host instead")),{ip:m.ip,port:m.port,address:"".concat(m.ip,":").concat(m.port)}));if(null!==(r=s.detail)&&void 0!==r&&r[18]&&"string"==typeof(null===(a=s.detail)||void 0===a?void 0:a[18])){const m=s.detail[18],g=null==m?void 0:m.split(";");for(let E=0;E<g.length;E++){var f;const y=_T(f=g[E]).call(f);h[E]&&y&&(h[E].ip6=y)}}return{gatewayAddrs:h,uid:s.uid,cid:s.cid,cert:s.cert,vid:s.detail&&s.detail[8],uni_lbs_ip:s.detail&&s.detail[1],res:s,csIp:s.detail&&s.detail[502]}}function To(s){return"number"==typeof s?s:s.exact||s.ideal||s.max||s.min||0}function iy(s){const i=s._encoderConfig;if(!i)return{};const r={resolution:i.width&&i.height?"".concat(To(i.width),"x").concat(To(i.height)):void 0,maxVideoBW:i.bitrateMax,minVideoBW:i.bitrateMin};return"number"==typeof i.frameRate?(r.maxFrameRate=i.frameRate,r.minFrameRate=i.frameRate):i.frameRate&&(r.maxFrameRate=i.frameRate.max||i.frameRate.ideal||i.frameRate.exact||i.frameRate.min,r.minFrameRate=i.frameRate.min||i.frameRate.ideal||i.frameRate.exact||i.frameRate.max),r}function GO(s){const i={connectionType:0,googRtt:s.rtt};switch(s.selectedCandidatePair.localCandidate.candidateType){case"relay":{const r=s.selectedCandidatePair.localCandidate.relayProtocol;"udp"===r&&(i.connectionType=1),"tcp"===r&&(i.connectionType=3),"tls"===r&&(i.connectionType=4);break}case"srflx":i.connectionType=2}return i}function Gc(s){return s>=0&&s<.17?1:s>=.17&&s<.36?2:s>=.36&&s<.59?3:s>=.59&&s<=1?4:s>1?5:0}function Au(s,i){let r,a,l;switch(i){case bi.CHOOSE_SERVER:a=4096,l="choose server";break;case bi.CLOUD_PROXY:a=1048576,l="proxy";break;case bi.CLOUD_PROXY_5:a=4194304,l="proxy5";break;case bi.CLOUD_PROXY_FALLBACK:a=4194310,l="proxy fallback";break;default:throw new K(k.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:s.detail&&s.detail[502],retry:!1})}if(s.response_body.forEach(d=>{d.buffer&&d.buffer.flag===a&&(r={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map(h=>ny(ny({},h),{},{ticket:d.buffer.cert})),server_ts:s.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:ny(ny({},d.buffer.detail),s.detail),flag:d.buffer.flag,opid:s.opid,cert:d.buffer.cert})}),!r)throw new K(k.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(l," from multi unilbs response"),{csIp:s.detail&&s.detail[502]});return r}function pb(s,i){return fb.apply(this,arguments)}function fb(){return fb=x(function*(s,i){return yield q.all(s.addresses.map(function(){var r=x(function*(a){return{address:H_(a.ip),tcpport:a.port,udpport:a.port,username:i&&H("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?i.toString():on.username,password:i&&H("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?yield kA(i.toString()):on.password}});return function(a){return r.apply(this,arguments)}}()))}),fb.apply(this,arguments)}function _b(s,i){const r=i._videoHeight||i.getMediaStreamTrack(!0).getSettings().height;return r?Math.max(r/To(s.height),1):(R.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function ql(s){let{candidateType:i,relayProtocol:r,type:a,address:l,port:d,protocol:h}=s;return"local-candidate"===a?{candidateType:i,relayProtocol:r,protocol:h}:{candidateType:i,relayProtocol:r,address:l,port:d,protocol:h}}function ry(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}class o2 extends nn{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(i){var r;we(r=["tryNext","recover"]).call(r,i)&&this.resetReconnectCount(i),this._reconnectMode=i}get state(){return this._state}set state(i){i!==this._state&&(this._state=i,"reconnecting"===this._state?this.emit(Mn.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(Mn.CONNECTED):"closed"===this._state?this.emit(Mn.CLOSED):"failed"===this._state&&this.emit(Mn.FAILED))}constructor(i,r,a,l){super(),T(this,"connectionID",0),T(this,"currentURLIndex",0),T(this,"reconnectReason",void 0),T(this,"_reconnectMode","tryNext"),T(this,"_name",void 0),T(this,"_state","closed"),T(this,"_retryConfig",void 0),T(this,"_reconnectCount",0),T(this,"_forceCloseTimeout",5e3),T(this,"_onlineReconnectListener",void 0),T(this,"_closeEstablishingTransmitter",()=>{}),T(this,"_store",void 0),T(this,"_joinChannelServiceRecordIndex",void 0),T(this,"_useCompress",void 0),T(this,"_inflateLength",0),T(this,"_deflateLength",0),this._store=l,this._name=i,this._retryConfig=function(d){for(var h=1;h<arguments.length;h++){var f=null!=arguments[h]?arguments[h]:{};h%2?ry(Object(f),!0).forEach(function(m){T(d,m,f[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(f)):ry(Object(f)).forEach(function(m){Object.defineProperty(d,m,Object.getOwnPropertyDescriptor(f,m))})}return d}({},r),this._useCompress=a}resetReconnectCount(i){R.debug("".concat(this._name," reset reconnect count, reason: ").concat(i)),this._reconnectCount=0}close(i,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const a=this._transmitter;r?setTimeout(()=>a.close(),500):a.close(),this._transmitter=void 0}this.state=i?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(i,r){if(!this._transmitter)return void R.warning("[".concat(this._name,"] can not reconnect, no websocket"));var a;void 0!==i&&(this.reconnectMode=i),R.debug("[".concat(this._name,"] reconnect is triggered initiative")),"number"==typeof this._joinChannelServiceRecordIndex&&(null===(a=this._store)||void 0===a||a.recordJoinChannelService({status:"error",errors:[new Error(r)]},this._joinChannelServiceRecordIndex));const l=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),l&&l.bind(this._transmitter)({code:9999,reason:r})}getInflateData(){const i=this._inflateLength,r=this._deflateLength;return this.clearInflateData(),{inflateLength:i,deflateLength:r}}setInflateData(i){this._deflateLength=this._deflateLength+i.originLength,this._inflateLength=this._inflateLength+i.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}var bo;!function(s){s[s.Default=0]="Default",s[s.Ack=1]="Ack"}(bo||(bo={}));class WO{constructor(i,r,a){T(this,"version",1),T(this,"initialRTO",void 0),T(this,"maxBatchAckCount",void 0),T(this,"maxRTO",void 0),T(this,"initialRTT",void 0),T(this,"ID",void 0),T(this,"rtt",void 0),T(this,"packetNumber",1),T(this,"rtoRatioMap",new Map),T(this,"timeoutMap",new Map),T(this,"unorderedPacketQueue",[]),T(this,"batchAckPacketQueue",[]),T(this,"lastOrderedPacketNumber",0),T(this,"batchAckTimer",void 0),T(this,"sendImpl",void 0),T(this,"receiveImpl",void 0),this.sendImpl=i,this.receiveImpl=r,this.ID=Vt(7,"transmitter-"),this.initialRTO=void 0!==(null==a?void 0:a.initialRTO)?a.initialRTO:H("TRANSMITTER_INITIAL_RTO"),this.initialRTT=void 0!==(null==a?void 0:a.initialRTT)?a.initialRTT:H("TRANSMITTER_INITIAL_RTT"),this.rtt=void 0!==(null==a?void 0:a.initialRTT)?a.initialRTT:H("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=void 0!==(null==a?void 0:a.maxBatchAckCount)?a.maxBatchAckCount:H("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=void 0!==(null==a?void 0:a.maxRTO)?a.maxRTO:H("TRANSMITTER_MAX_RTO")}packetize(i,r){return{type:bo.Default,version:this.version,packetNumber:r,payload:i}}serialize(i){switch(i.type){case bo.Default:{let r;r="string"==typeof i.payload?(new TextEncoder).encode(i.payload):i.payload;const a=new ArrayBuffer(r.length+15),l=new DataView(a);return l.setUint16(0,i.version),l.setUint8(2,i.type),l.setUint32(3,i.packetNumber),PA(l,7,BigInt(i.sendTs)),new Uint8Array(l.buffer).set(r,15),a}case bo.Ack:{const r=new ArrayBuffer(16),a=new DataView(r);return a.setUint16(0,i.version),a.setUint8(2,i.type),a.setUint32(3,i.maxAckPacketNumber),a.setUint8(7,i.shift),PA(a,8,BigInt(i.ackSendTs)),r}}}deserialize(i){const r=new DataView(i),a=r.getUint16(0),l=r.getUint8(2);switch(l){case bo.Default:{const d=r.getUint32(3),h=NA(r,7),f=i.slice(15),m=(new TextDecoder).decode(f);return{version:a,type:l,packetNumber:d,sendTs:Number(h),payload:m}}case bo.Ack:{const d=r.getUint32(3),h=r.getUint8(7),f=NA(r,8);return{version:a,type:l,maxAckPacketNumber:d,shift:h,ackSendTs:Number(f)}}default:throw R.error("[".concat(this.ID,"] Unrecognized packet type ").concat(l)),new Error("Unrecognized packet type ".concat(l))}}sendMessage(i){const r=this.packetize(i,this.packetNumber);this.packetNumber=4294967295===this.packetNumber?1:this.packetNumber+1;const a=this.calculateRTO(r),l=window.setTimeout(()=>{this.resendMessage(r)},a);this.timeoutMap.set(r.packetNumber,l),this.sendPacket(r)}onData(i){const r=this.deserialize(i);r.type===bo.Default?this.ack(r):r.type===bo.Ack&&(this.updateRTT(r,Math.round(performance.now())),this.clearRTO(r))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(i=>{let[r,a]=i;window.clearTimeout(a)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,void 0!==this.batchAckTimer&&window.clearTimeout(this.batchAckTimer)}resendMessage(i){const r=this.calculateRTO(i),a=window.setTimeout(()=>{this.resendMessage(i)},r);this.timeoutMap.set(i.packetNumber,a),this.sendPacket(i)}calculateRTO(i){const r=this.rtoRatioMap.get(i.packetNumber);if(void 0===r)return this.rtoRatioMap.set(i.packetNumber,1),this.initialRTO;{const a=9*this.rtt/8*r;return this.rtoRatioMap.set(i.packetNumber,r+1),a>this.maxRTO?this.maxRTO:a}}updateRTT(i,r){this.rtt=this.rtt*(7/8)+(r-i.ackSendTs-this.rtt)/8}ack(i){if(i.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(i):(this.batchAckPacketQueue.push(i),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(i.payload);;){const r=this.unorderedPacketQueue[0];if(!r){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(r.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else i.packetNumber<=this.lastOrderedPacketNumber?this.sendPacket({ackSendTs:i.sendTs,maxAckPacketNumber:i.packetNumber,shift:0,type:bo.Ack,version:this.version}):i.packetNumber>this.lastOrderedPacketNumber&&(this.unorderedPacketQueue[i.packetNumber-this.lastOrderedPacketNumber-2]=i,this.sendPacket({ackSendTs:i.sendTs,maxAckPacketNumber:i.packetNumber,shift:0,type:bo.Ack,version:this.version}))}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0,this.sendPacket({ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:bo.Ack,version:this.version}),this.batchAckPacketQueue=[]}sendPacket(i){i.type===bo.Default&&(i.sendTs=Math.round(performance.now()));const r=this.serialize(i);this.sendImpl(r)}clearRTO(i){for(let r=i.maxAckPacketNumber-i.shift;r<=i.maxAckPacketNumber;r++){const a=this.timeoutMap.get(r);void 0!==a&&window.clearTimeout(a),this.timeoutMap.delete(r),this.rtoRatioMap.delete(r)}}}class KO extends o2{constructor(i,r){super(i,r,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3?arguments[3]:void 0),T(this,"_initMutex",void 0),T(this,"_reconnectInterrupter",void 0),T(this,"_url",void 0),T(this,"_transmitter",void 0),T(this,"_addresses",void 0),T(this,"_reliableTransmission",void 0),this._initMutex=new Gn("datachannel");const{timeout:a,timeoutFactor:l}=r,d=Math.max(300,Math.floor(3*a/5)),h=Math.max(1.2,Math.floor(8*l)/10);yn.ONLINE&&(this._retryConfig.timeout=d,this._retryConfig.timeoutFactor=h),Hn.on(wl.NETWORK_STATE_CHANGE,(f,m)=>{f!==m&&(this.resetReconnectCount("network state change: ".concat(m," -> ").concat(f)),f===yn.ONLINE?(this._retryConfig.timeout=d,this._retryConfig.timeoutFactor=h):(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=l))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}init(i){var r=arguments,a=this;return x(function*(){a._forceCloseTimeout=r.length>1&&void 0!==r[1]?r[1]:5e3;return a._initMutex.lock().then(h=>new q((f,m)=>{((h,f)=>{a._addresses=i,a.currentURLIndex=a._addresses.findIndex(g=>g.fingerprint||H("FINGERPRINT"));const m=a._addresses[a.currentURLIndex];a.state="connecting",a.createTransmitterConnection(m).then(h).catch(f),a.once(Mn.CLOSED,()=>f(new K(k.WS_DISCONNECT))),a.once(Mn.CONNECTED,()=>h())})(f,m)}).then(()=>{h()}).catch(()=>{h()}))})()}sendMessage(i){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new K(k.WS_ABORT,"datachannel is not ready");try{r||(i=JSON.stringify(i)),this._reliableTransmission.sendMessage(i)}catch(a){throw new K(k.WS_ERR,"send datachannel signal message error"+a.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(i){const r=JSON.stringify(i);return{compressed:r,compressedLength:r.length,origin:i}}sendMessageWithUint8Array(i){return{compressed:i,compressedLength:i.byteLength,origin:i}}createTransmitterConnection(i){var r=this;return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(i.ip,":").concat(i.port),new q((a,l)=>{var d;const h=()=>{R.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),a()},f=function(){var y=x(function*(C){var b;if(null===(b=r._closeEstablishingTransmitter)||void 0===b||b.call(r),R.debug("[".concat(r._name,"] datachannel close ").concat(r._url,", code: ").concat(C.code,", reason: ").concat(C.reason,", current mode: ").concat(r.reconnectMode)),r._reconnectCount<r._retryConfig.maxRetryCount){"connected"===r.state&&(r.reconnectReason=C.reason,r.state="reconnecting");const O=ro(r,Mn.WILL_RECONNECT,r.reconnectMode)||r.reconnectMode,P=yield r.reconnectWithAction(O);if("closed"===r.state)return void R.debug("[".concat(r.connectionID,"] dc is closed, no need to reconnect"));if(!P)return l(new K(k.WS_DISCONNECT,"datachannel reconnect failed: ".concat(C.code))),void r.close(!0);a()}else l(new K(k.WS_DISCONNECT,"datachannel close: ".concat(C.code))),r.close()});return function(b){return y.apply(this,arguments)}}(),m=y=>{var C;null===(C=this._reliableTransmission)||void 0===C||C.onData(y.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),R.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(i)));const g=null===(d=this._store)||void 0===d?void 0:d.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),E=Date.now();vn(this,Mn.TO_CONNECT_DATACHANNEL,i).then(y=>{var C,b;if(!y)throw new Error("transmissonInfo not exist yet");const{transmitter:O,close:P}=y;this._transmitter=O,null===(C=this._store)||void 0===C||C.signalChannelOpen();const D=Date.now()-E;R.debug("[choose dc] dc open cost ".concat(D,"ms")),this._reliableTransmission=new WO(L=>{var B;this._transmitter&&"open"===this._transmitter.readyState&&(null===(B=this._transmitter)||void 0===B||B.send(L))},L=>{"string"==typeof L&&this.emit(Mn.ON_MESSAGE,L)}),this._closeEstablishingTransmitter=()=>{var L;null===(L=this._reliableTransmission)||void 0===L||L.close(),this._reliableTransmission=void 0,P()},h&&h(),O.onclose=f,O.onmessage=m,null===(b=this._store)||void 0===b||b.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this._joinChannelServiceRecordIndex=g}).catch(y=>{var C;if(null===(C=this._store)||void 0===C||C.recordJoinChannelService({endTs:Date.now(),status:y instanceof K&&y.code===k.WS_ABORT?"aborted":"error",errors:[y]},g),"closed"!==this.state){if(y instanceof K&&y.code===k.WS_ERR){const b=new K(k.WS_ERR,"init datachannel failed! Error: ".concat(y.toString()));return R.error("[".concat(this._name,"]").concat(b)),void l(b)}f&&f(y)}else l(new K(k.WS_DISCONNECT,"datachannel is closed: ".concat(y.toString())))})})}reconnectWithAction(i){var r=arguments,a=this;return x(function*(){let l=!(r.length>1&&void 0!==r[1])||r[1];if(a._reconnectCount>=a._retryConfig.maxRetryCount||!a._addresses||"closed"===a.state)return!1;a._onlineReconnectListener||Hn.networkState!==yn.OFFLINE||(a._onlineReconnectListener=Hn.onlineWaiter&&Hn.onlineWaiter.then(()=>{a._onlineReconnectListener=void 0}));let d=!0;if(a._reconnectInterrupter=()=>{d=!1},l){const g=eE(a._reconnectCount,a._retryConfig);R.debug("[".concat(a._name,"] wait ").concat(g,"ms to reconnect datachannel, mode: ").concat(i)),yield q.race([si(g),a._onlineReconnectListener||new q(()=>{})])}if("closed"===a.state||!d)return!1;a._reconnectCount+=1;const h=function(){var g=x(function*(E,y){a.emit(Mn.RECONNECT_CREATE_CONNECTION,y),yield a.createTransmitterConnection(E)});return function(y,C){return g.apply(this,arguments)}}();try{if("retry"===i){const g=a._addresses[a.currentURLIndex];a.emit(Mn.RECONNECT_WAITTING_FINISH,i),yield h(g,i)}else if("tryNext"===i){a.currentURLIndex+=1;for(let E=a.currentURLIndex;E<a._addresses.length;E++){if(a._addresses[E].fingerprint||H("FINGERPRINT")){a.currentURLIndex=E;break}a.currentURLIndex+=1}if(a.currentURLIndex>=a._addresses.length)return R.debug("[".concat(a._name,"] the available addresses are exhausted, change to recover")),yield a.reconnectWithAction("recover",!1);R.debug("[".concat(a._name,"] datachannel url length: ").concat(a._addresses.length," current index: ").concat(a.currentURLIndex));const g=a._addresses[a.currentURLIndex];a.emit(Mn.RECONNECT_WAITTING_FINISH,i),yield h(g,i)}else"recover"===i&&(R.debug("[".concat(a._name,"] start to failback to websocket")),a.resetReconnectCount("recover mode"),a.emit(Mn.RECONNECT_WAITTING_FINISH,i),a.emit(Mn.FAILBACK));return!0}catch(g){var f,m;return R.error("[".concat(a._name,"] reconnect failed"),g.toString()),null!=g&&null!==(f=g.data)&&void 0!==f&&f.desc&&Array.isArray(g.data.desc)&&g.data.desc.length&&we(m=g.data.desc).call(m,"dynamic key expired")?(a.emit(Mn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):yield a.reconnectWithAction(i,l)}})()}}class Wc extends nn{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===ze.CONNECTED?this.emit(he.WS_CONNECTED):i===ze.RECONNECTING?this.emit(he.WS_RECONNECTING,this._websocketReconnectReason):i===ze.CLOSED&&this.emit(he.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(i,r){super(),T(this,"_disconnectedReason",void 0),T(this,"_websocketReconnectReason",void 0),T(this,"_connectionState",ze.CLOSED),T(this,"reconnectToken",void 0),T(this,"websocket",void 0),T(this,"openConnectionTime",void 0),T(this,"clientId",void 0),T(this,"lastMsgTime",Date.now()),T(this,"uploadCache",[]),T(this,"uploadCacheInterval",void 0),T(this,"rttRolling",new MS(5)),T(this,"pingpongTimer",void 0),T(this,"inflateDataTimer",void 0),T(this,"pingpongTimeoutCount",0),T(this,"joinResponse",void 0),T(this,"multiIpOption",void 0),T(this,"initError",void 0),T(this,"spec",void 0),T(this,"store",void 0),T(this,"onWebsocketMessage",a=>{if(a instanceof ArrayBuffer)return void this.emit(he.ON_BINARY_DATA,a);const l=JSON.parse(a);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(l,"_id")){const d="res-@".concat(l._id);this.emit(d,l._result,l._message)}else if(Object.prototype.hasOwnProperty.call(l,"_type")&&(this.emit(l._type,l._message),l._type===Fe.ON_NOTIFICATION&&this.handleNotification(l._message),l._type===Fe.ON_USER_BANNED))switch(l._message.error_code){case 14:this.close($e.UID_BANNED);break;case 15:this.close($e.IP_BANNED);break;case 16:this.close($e.CHANNEL_BANNED)}}),this.clientId=i.clientId,this.spec=i,this.store=r,this.websocket=new KO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===ze.CONNECTED&&this.reconnect("retry",ja.OFFLINE)})}request(i,r,a,l){var d=this;return x(function*(){const h=Vt(6,""),f={_id:h,_type:i,_message:r},m=d.websocket.connectionID,g=()=>new q((P,D)=>{if(d.connectionState===ze.CONNECTED)return P();const L=()=>{d.off(he.WS_CLOSED,B),P()},B=()=>{d.off(he.WS_CONNECTED,L),D(new K(k.WS_ABORT))};d.once(he.WS_CONNECTED,L),d.once(he.WS_CLOSED,B),i!==ve.PUBLISH&&i!==ve.SUBSCRIBE&&i!==ve.UNSUBSCRIBE&&i!==ve.UNPUBLISH&&i!==ve.CONTROL&&i!==ve.RESTART_ICE||d.once(he.DISCONNECT_P2P,()=>{D(new K(k.DISCONNECT_P2P))}),i!==ve.PUBLISH&&i!==ve.RESTART_ICE||d.once(he.ABORT_P2P_EXECUTION,()=>{D(new K(k.DISCONNECT_P2P))})});if(d.connectionState!==ze.CONNECTING&&d.connectionState!==ze.RECONNECTING||i===ve.JOIN||i===ve.REJOIN||(yield g()),i===ve.LEAVE&&(d.websocket.unbindDcCloseEventListener(),l=!0),d.websocket.sendMessage(f,!0,!1),l)return;const E=new q((P,D)=>{let L=!1;const B=(J,ae)=>{L=!0,P({isSuccess:"success"===J,message:ae||{}}),d.off(he.WS_CLOSED,V),d.off(he.WS_RECONNECTING,V),d.emit(he.REQUEST_SUCCESS,i,r)};d.once("res-@".concat(h),B);const V=()=>{D(new K(k.WS_ABORT,"type: ".concat(i))),d.off(he.WS_CLOSED,V),d.off(he.WS_RECONNECTING,V),d.off("res-@".concat(h),B)};d.once(he.WS_CLOSED,V),d.once(he.WS_RECONNECTING,V),si(H("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||L||(R.warning("dc request timeout, type: ".concat(i)),d.emit(he.REQUEST_TIMEOUT,i,r))})});let y=null;try{y=yield E}catch(P){if(d.connectionState===ze.CLOSED||i===ve.LEAVE)throw new K(k.WS_ABORT);return!d.spec.forceWaitGatewayResponse||a?P.throw():i===ve.JOIN||i===ve.REJOIN?null:(yield g(),yield d.request(i,r))}if(y.isSuccess)return y.message;const C=Number(y.message.error_code||y.message.code),b=lu(C),O=new K(k.UNEXPECTED_RESPONSE,"".concat(b.desc,": ").concat(y.message.error_str),{code:C,data:y.message});return"success"===b.action?y.message:(R.warning("[".concat(d.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(C,", message: ").concat(b.desc,", action: ").concat(b.action)),C===Ie.ERR_TOO_MANY_BROADCASTERS?((i===ve.JOIN||i===ve.REJOIN)&&(d.initError=O,d.close()),O.throw()):"failed"===b.action?O.throw():"quit"===b.action?(d.initError=O,d.close(),O.throw()):(C===Ie.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=y.message.option,R.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",ja.MULTI_IP)):d.reconnect(b.action,ja.SERVER_ERROR),i===ve.JOIN||i===ve.REJOIN?null:yield d.request(i,r)))})()}waitMessage(i,r){return new q(a=>{const l=d=>{(!r||r(d))&&(this.off(i,l),a(d))};this.on(i,l)})}upload(i,r){const a={_type:i,_message:r};try{this.websocket.sendMessage(a)}catch(l){const d=H("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==ze.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},H("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,r){this.websocket.sendMessage({_type:i,_message:r})}init(i,r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new q((a,l)=>{this.once(he.WS_CONNECTED,()=>a(this.joinResponse)),this.once(he.WS_CLOSED,()=>l(this.initError||new K(k.WS_ABORT))),this.connectionState=ze.CONNECTING,this.websocket.init(i).catch(l),this.websocket.once(Mn.FAILBACK,()=>{void 0===this.openConnectionTime&&l(new K(k.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{r&&void 0===this.openConnectionTime&&(R.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),l(new K(k.INIT_DATACHANNEL_TIMEOUT)))},H("DC_JOIN_WITH_FAILBACK"))})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=i||$e.LEAVE,this.connectionState=ze.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),i===$e.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new KO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}join(){var i=this;return x(function*(){if(!i.joinResponse){i.emit(he.ABORT_P2P_EXECUTION);const r=yield vn(i,he.DATACHANNEL_CONNECTING),a=yield i.request(ve.JOIN,r);if(!a)return i.emit(he.REPORT_JOIN_GATEWAY,k.TIMEOUT,i.url||""),!1;i.joinResponse=a,i.emit(he.JOIN_RESPONSE,i.joinResponse),i.reconnectToken=i.joinResponse.rejoin_token}return i.connectionState=ze.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),!0})()}rejoin(){var i=this;return x(function*(){if(!i.reconnectToken)throw new K(k.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=Cs(i,he.REQUEST_REJOIN_INFO);r.token=i.reconnectToken;const a=yield i.request(ve.REJOIN,r);return!!a&&(i.connectionState=ze.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),a.peers&&a.peers.forEach(l=>{i.emit(Fe.ON_USER_ONLINE,{uid:l.uid}),l.audio&&i.emit(Fe.ON_ADD_AUDIO_STREAM,{uid:l.uid,uint_id:l.uint_id,audio:!0,ssrcId:l.audio_ssrc}),l.video&&i.emit(Fe.ON_ADD_VIDEO_STREAM,{uid:l.uid,uint_id:l.uint_id,video:!0,ssrcId:l.video_ssrc}),i.emit(l.audio_mute?Fe.MUTE_AUDIO:Fe.UNMUTE_AUDIO,{uid:l.uid}),i.emit(l.video_mute?Fe.MUTE_VIDEO:Fe.UNMUTE_VIDEO,{uid:l.uid}),i.emit(l.audio_enable_local?Fe.ENABLE_LOCAL_AUDIO:Fe.DISABLE_LOCAL_AUDIO,{uid:l.uid}),i.emit(l.video_enable_local?Fe.ENABLE_LOCAL_VIDEO:Fe.DISABLE_LOCAL_VIDEO,{uid:l.uid}),l.audio||l.video||i.emit(Fe.ON_REMOVE_STREAM,{uid:l.uid,uint_id:l.uint_id})}),!0)})()}reconnect(i,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,r)}handleNotification(i){R.debug("[".concat(this.clientId,"] receive notification: "),i);const r=lu(i.code);if("success"!==r.action){if("failed"!==r.action)return"quit"===r.action?("ERR_REPEAT_JOIN_CHANNEL"===r.desc&&this.close($e.UID_BANNED),void this.close()):void this.reconnect(r.action,ja.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=H("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=i&&(R.warning("PINGPONG Timeout. Last Socket Message: ".concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>H("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ja.TIMEOUT):this.request(ve.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-r;this.rttRolling.add(a),H("REPORT_STATS")&&this.send(ve.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleInflateData(){const{inflateLength:i,deflateLength:r}=this.websocket.getInflateData();0!==i&&0!==r&&this.upload(gr.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:i})}handleWebsocketEvents(){var i=this;this.websocket.on(Mn.RECONNECT_WAITTING_FINISH,r=>{this.emit(he.WS_RECONNECT_WAITTING_FINISH,r)}),this.websocket.on(Mn.RECONNECT_CREATE_CONNECTION,r=>{this.emit(he.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Mn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Mn.CLOSED,()=>{this.connectionState=ze.CLOSED}),this.websocket.on(Mn.FAILED,()=>{this._disconnectedReason=$e.NETWORK_ERROR,this.connectionState=ze.CLOSED}),this.websocket.on(Mn.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState=this.connectionState===ze.CONNECTED?ze.RECONNECTING:ze.CONNECTING}),this.websocket.on(Mn.WILL_RECONNECT,(r,a)=>{if(Cs(this,he.IS_P2P_DISCONNECTED)&&"retry"===r)return R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(he.NEED_RENEW_SESSION),this.emit(he.DISCONNECT_P2P),a("tryNext");"retry"!==r&&(R.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0,this.emit(he.NEED_RENEW_SESSION),this.emit(he.DISCONNECT_P2P)),a(r)}),this.websocket.on(Mn.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",ja.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(he.REPORT_JOIN_GATEWAY,r.message||r.code,this.url||""),r instanceof K&&r.code===k.UNEXPECTED_RESPONSE&&r.data.code===Ie.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ja.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ja.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(Mn.REQUEST_NEW_URLS,(r,a)=>{vn(this,he.REQUEST_RECOVER,this.multiIpOption).then(r).catch(a)}),this.websocket.on(Mn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Fe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(Mn.TO_CONNECT_DATACHANNEL,function(){var r=x(function*(a,l,d){return vn(i,he.DATACHANNEL_PRECONNECT,a).then(l).catch(d)});return function(a,l,d){return r.apply(this,arguments)}}()),this.websocket.on(Mn.FAILBACK,()=>{void 0!==this.openConnectionTime&&this.emit(he.DATACHANNEL_FAILBACK)})}}class oy extends nn{constructor(i){super(),T(this,"_signal",void 0),T(this,"_sequence",0),T(this,"_userMap",new Map),T(this,"_encoder",new TextEncoder),this._signal=i}send(i,r,a,l,d){var h=this;return x(function*(){var f,m,g;"string"!=typeof r&&(r=JSON.stringify(r)),l=null!==(f=l)&&void 0!==f?f:Vt(6,""),d=null!==(m=d)&&void 0!==m?m:h._sequence++;const E={_id:l,_type:i,_seq:null!==(g=d)&&void 0!==g?g:h._sequence++,_message:r};if(H("SHOW_P2P_LOG")&&R.debug("send message",E),h.sendStreamMessage(JSON.stringify(E)),a)return;const y=new q((b,O)=>{const P=window.setTimeout(()=>{h.off("res-@".concat(l),D),R.warning("[external-signal] request timeout, type: ".concat(i)),O(new ne(0===h._userMap.size?k.INVALID_REMOTE_USER:k.TIMEOUT))},H("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),D=(L,B)=>{P&&window.clearTimeout(P),"success"===L?b({isSuccess:!0,message:B}):O(new ne(k.UNEXPECTED_ERROR,B))};h.once("res-@".concat(l),D)});let C;try{C=yield y}catch(b){if(b.code===k.TIMEOUT)return yield h.send(i,r,!1,l,d);throw b}return C.isSuccess?C.message:void 0})()}sendStreamMessage(i){this._splitMessage(i).forEach(r=>{this._signal.request(ve.DATA_STREAM,{payload:h_(this._encoder.encode(r))})})}onMessage(i){const{_uid:r}=i;let a;const l=this._userMap.get(r);if(l?a=l.splitMessageMap:(a=new Map,this._userMap.set(r,{isStart:!1,splitMessageMap:a,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map})),"id"in i&&"total"in i){var d;const{id:h,total:f}=i,m=null!==(d=a.get(h))&&void 0!==d?d:[];if(m.push(i),a.has(h)||a.set(h,m),m.length!==f)return;{const g=Bf(m).call(m,(E,y)=>E.index-y.index).map(E=>E.payload).join("");a.delete(h),(i=JSON.parse(g))._uid=r}}this.handleReceivedMessage(i)}setStart(i){this._userMap.has(i)?this._userMap.get(i).isStart=!0:this._userMap.set(i,{isStart:!0,splitMessageMap:new Map,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map}),this.handleReceivedMessage()}setEnd(i){return this._userMap.delete(i),0===this._userMap.size}ack(i,r,a){this.send($t.ACK,JSON.stringify({success:!a,message:r}),!0,i)}handleReceivedMessage(i){const r=()=>{this._userMap.forEach(g=>{const{receivedMessagesMap:E,nextExpectedSequenceNumber:y}=g;for(;E.has(y);){const C=E.get(y);E.delete(y),this.receiveMessage(C),g.nextExpectedSequenceNumber++}})};if(!i)return void r();const{_uid:a,_seq:l}=i,d=this._userMap.get(a),{receivedMessagesMap:h,isStart:f,nextExpectedSequenceNumber:m}=d;l<m?R.debug("[external-signal] receive old message, seq: ".concat(l)):(h.set(l,i),f&&l===m&&(this.receiveMessage(i),h.delete(m),d.nextExpectedSequenceNumber++,r()))}receiveMessage(i){const{_id:r,_type:a,_message:l,_uid:d}=i;if(H("SHOW_P2P_LOG")&&R.debug("\u6536\u5230\u6d88\u606f",i),r)switch(i._type){case $t.PUBLISH:const h=JSON.parse(l);this._signal.emit(a,h,d),this.ack(i._id);break;case $t.CONTROL:case $t.UNPUBLISH:case $t.DO_SUBSCRIBE:case $t.DO_UNSUBSCRIBE:{const f=JSON.parse(l);f.uid=d,vn(this._signal,a,f).then(m=>{this.ack(i._id,m)}).catch(m=>{this.ack(i._id,void 0,!0)});break}case $t.ACK:{const{success:f,message:m}=JSON.parse(l);this.emit("res-@".concat(r),f?"success":"failed",m);break}case $t.CALL:vn(this,a,l).then(f=>{this.ack(r,f)});break;case $t.RESTART_ICE:case $t.EXCHANGE_SDP:case $t.SUBSCRIBE:case $t.UNSUBSCRIBE:vn(this._signal,a,l).then(f=>{this.ack(r,f)}).catch(f=>{this.ack(i._id,void 0,!0)});break;case $t.CANDIDATE:this._signal.emit(a,l),this.ack(r);break;case $t.JOIN:this.emit(a,JSON.parse(l));break;default:this.emit(a,l),this.ack(r)}}_splitMessage(i){if(i.length<oy.MAX_MESSAGE_SIZE)return[i];const r=[],a=Vt(6,"");let l=0;const d=Math.ceil(i.length/800);for(;i.length>0;){l++;const h=i.slice(0,800);r.push({id:a,index:l,total:d,payload:h}),i=i.slice(800)}return r.map(h=>JSON.stringify(h))}clear(){this._sequence=0,this._userMap.clear()}}T(oy,"MAX_MESSAGE_SIZE",1024);class za extends nn{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===ze.CONNECTED?this.emit(he.WS_CONNECTED):i===ze.RECONNECTING?this.emit(he.WS_RECONNECTING,this._websocketReconnectReason):i===ze.CLOSED&&this.emit(he.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(i,r){super(),T(this,"_disconnectedReason",void 0),T(this,"_websocketReconnectReason",void 0),T(this,"_connectionState",ze.CLOSED),T(this,"reconnectToken",void 0),T(this,"_userInRoom",!1),T(this,"_userOnlineTime",void 0),T(this,"websocket",void 0),T(this,"openConnectionTime",void 0),T(this,"clientId",void 0),T(this,"lastMsgTime",Date.now()),T(this,"uploadCache",[]),T(this,"uploadCacheInterval",void 0),T(this,"rttRolling",new MS(5)),T(this,"pingpongTimer",void 0),T(this,"wsInflateDataTimer",void 0),T(this,"pingpongTimeoutCount",0),T(this,"joinResponse",void 0),T(this,"multiIpOption",void 0),T(this,"initError",void 0),T(this,"spec",void 0),T(this,"store",void 0),T(this,"_external_signal",void 0),T(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(he.ON_BINARY_DATA,a.data);const l=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(l,"_id")){const d="res-@".concat(l._id);this.emit(d,l._result,l._message)}else if(Object.prototype.hasOwnProperty.call(l,"_type")){switch(l._type){case Fe.ON_DATA_STREAM:return void this.handleDataStream(l._message);case Fe.MUTE_AUDIO:case Fe.MUTE_VIDEO:case Fe.ON_P2P_LOST:return;case Fe.ON_USER_ONLINE:this.emit(l._type,l._message);const{uid:d}=l._message;return this._external_signal.setStart(d),void this._external_signal.send($t.JOIN,{onlineTime:this._userOnlineTime},!0)}if(this.emit(l._type,l._message),l._type===Fe.ON_NOTIFICATION&&this.handleNotification(l._message),l._type===Fe.ON_USER_BANNED)switch(l._message.error_code){case 14:this.close($e.UID_BANNED);break;case 15:this.close($e.IP_BANNED);break;case 16:this.close($e.CHANNEL_BANNED)}if(l._type===Fe.ON_USER_LICENSE_BANNED)switch(l._message.error_code){case Ie.ERR_LICENSE_MISSING:this.close($e.LICENSE_MISSING);break;case Ie.ERR_LICENSE_EXPIRED:this.close($e.LICENSE_EXPIRED);break;case Ie.ERR_LICENSE_MINUTES_EXCEEDED:this.close($e.LICENSE_MINUTES_EXCEEDED);break;case Ie.ERR_LICENSE_PERIOD_INVALID:this.close($e.LICENSE_PERIOD_INVALID);break;case Ie.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close($e.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ie.ERR_LICENSE_ILLEGAL:this.close($e.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=i.clientId,this.spec=i,this.store=r,this.websocket=new S_("gateway-".concat(this.clientId),this.spec.retryConfig,!0,H("JOIN_GATEWAY_USE_DUAL_DOMAIN"),H("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===ze.CONNECTED&&this.reconnect("retry",Si.OFFLINE)}),this._external_signal=new oy(this),this._handleSignalP2PEvents()}request(i,r,a,l){var d=this;return x(function*(){const h=Vt(6,""),f={_id:h,_type:i,_message:r},m=d.websocket.connectionID,g=()=>new q((P,D)=>{if(d.connectionState===ze.CONNECTED)return P();const L=()=>{d.off(he.WS_CLOSED,B),P()},B=()=>{d.off(he.WS_CONNECTED,L),D(new ne(k.WS_ABORT))};d.once(he.WS_CONNECTED,L),d.once(he.WS_CLOSED,B),i!==ve.PUBLISH&&i!==ve.SUBSCRIBE&&i!==ve.UNSUBSCRIBE&&i!==ve.UNPUBLISH&&i!==ve.CONTROL&&i!==ve.RESTART_ICE||d.once(he.DISCONNECT_P2P,()=>{D(new ne(k.DISCONNECT_P2P))}),i!==ve.PUBLISH&&i!==ve.RESTART_ICE||d.once(he.ABORT_P2P_EXECUTION,()=>{D(new ne(k.DISCONNECT_P2P))})});if(d.connectionState!==ze.CONNECTING&&d.connectionState!==ze.RECONNECTING||i===ve.JOIN||i===ve.REJOIN||(yield g()),d.websocket.sendMessage(f,!0),l)return;const E=new q((P,D)=>{let L=!1;const B=(J,ae)=>{L=!0,P({isSuccess:"success"===J,message:ae||{}}),d.off(he.WS_CLOSED,V),d.off(he.WS_RECONNECTING,V),d.emit(he.REQUEST_SUCCESS,i,r)};d.once("res-@".concat(h),B);const V=()=>{D(new ne(k.WS_ABORT,"type: ".concat(i))),d.off(he.WS_CLOSED,V),d.off(he.WS_RECONNECTING,V),d.off("res-@".concat(h),B)};d.once(he.WS_CLOSED,V),d.once(he.WS_RECONNECTING,V),si(H("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||L||(R.warning("[".concat(d.clientId,"] ws request timeout, type: ").concat(i)),d.emit(he.REQUEST_TIMEOUT,i,r))})});let y=null;try{y=yield E}catch(P){if(d.connectionState===ze.CLOSED||i===ve.LEAVE)throw new ne(k.WS_ABORT);return!d.spec.forceWaitGatewayResponse||a?P.throw():i===ve.JOIN||i===ve.REJOIN?null:(yield g(),yield d.request(i,r))}if(y.isSuccess)return y.message;const C=Number(y.message.error_code||y.message.code),b=lu(C),O=new ne(k.UNEXPECTED_RESPONSE,"".concat(b.desc,": ").concat(y.message.error_str),{code:C,data:y.message});return"success"===b.action?y.message:(R.warning("[".concat(d.clientId,"] [").concat(d.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(C,", message: ").concat(b.desc,", action: ").concat(b.action)),C===Ie.ERR_TOO_MANY_BROADCASTERS?((i===ve.JOIN||i===ve.REJOIN)&&(d.initError=O,d.close()),O.throw()):"failed"===b.action?O.throw():"quit"===b.action?(d.initError=O,d.close(),O.throw()):(C===Ie.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=y.message.option,R.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",Si.MULTI_IP)):d.reconnect(b.action,Si.SERVER_ERROR),i===ve.JOIN||i===ve.REJOIN?null:yield d.request(i,r)))})()}waitMessage(i,r){return new q(a=>{const l=d=>{(!r||r(d))&&(this.off(i,l),a(d))};this.on(i,l)})}upload(i,r){const a={_type:i,_message:r};try{this.websocket.sendMessage(a)}catch(l){const d=H("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==ze.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},H("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,r){this.websocket.sendMessage({_type:i,_message:r})}sendExtensionMessage(i,r,a){var l=this;return x(function*(){return yield l.waitTillUserOnline(),yield l._external_signal.send(i,r,a)})()}init(i,r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new q((a,l)=>{this.once(he.WS_CONNECTED,()=>a(this.joinResponse)),this.once(he.WS_CLOSED,()=>l(this.initError||new ne(k.WS_ABORT))),this.connectionState=ze.CONNECTING,this.websocket.init(i).catch(l),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=i||$e.LEAVE,this.connectionState=ze.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),i===$e.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new S_("gateway-".concat(this.clientId),this.spec.retryConfig,!0,H("JOIN_GATEWAY_USE_DUAL_DOMAIN"),H("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}join(){var i=this;return x(function*(){if(!i.joinResponse){i.emit(he.ABORT_P2P_EXECUTION);const r=yield vn(i,he.REQUEST_JOIN_INFO),a=yield i.request(ve.JOIN,r);if(!a)return i.emit(he.REPORT_JOIN_GATEWAY,k.TIMEOUT,i.url||""),!1;i.joinResponse=a,i.emit(he.JOIN_RESPONSE,i.joinResponse),i.reconnectToken=i.joinResponse.rejoin_token}return i.connectionState=ze.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),i._userOnlineTime=(new Date).getTime(),i._external_signal.clear(),!0})()}rejoin(){var i=this;return x(function*(){if(!i.reconnectToken)throw new ne(k.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=Cs(i,he.REQUEST_REJOIN_INFO);return r.token=i.reconnectToken,!!(yield i.request(ve.REJOIN,r))&&(i.connectionState=ze.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),!0)})()}reconnect(i,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,r)}handleDataStream(i){try{var r;const a=u_(i.payload),l=(new TextDecoder).decode(a),d=JSON.parse(l);"total"in d&&"id"in d||we(r=Object.values($t)).call(r,d._type)?(i.seq&&delete i.seq,d._uid=i.uid,this._external_signal.onMessage(d)):this.emit(Fe.ON_DATA_STREAM,i)}catch(a){}}handleNotification(i){R.debug("[".concat(this.clientId,"] receive notification: "),i);const r=lu(i.code);if("success"!==r.action){if("failed"!==r.action)return"quit"===r.action?("ERR_REPEAT_JOIN_CHANNEL"===r.desc&&this.close($e.UID_BANNED),void this.close()):void this.reconnect(r.action,Si.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=H("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=i&&(R.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>H("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Si.TIMEOUT):this.request(ve.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-r;this.rttRolling.add(a),H("REPORT_STATS")&&this.send(ve.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWsInflateData(){const{wsInflateLength:i,wsDeflateLength:r}=this.websocket.getWsInflateData();0!==i&&0!==r&&this.upload(gr.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:i})}handleWebsocketEvents(){this.websocket.on(Ne.RECONNECT_WAITTING_FINISH,i=>{this.emit(he.WS_RECONNECT_WAITTING_FINISH,i)}),this.websocket.on(Ne.RECONNECT_CREATE_CONNECTION,i=>{this.emit(he.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(Ne.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ne.CLOSED,()=>{this.connectionState=ze.CLOSED}),this.websocket.on(Ne.FAILED,()=>{this._disconnectedReason=$e.NETWORK_ERROR,this.connectionState=ze.CLOSED}),this.websocket.on(Ne.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState=this.connectionState===ze.CONNECTED?ze.RECONNECTING:ze.CONNECTING}),this.websocket.on(Ne.WILL_RECONNECT,(i,r,a)=>{if(Cs(this,he.IS_P2P_DISCONNECTED)&&"retry"===i)return R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(he.NEED_RENEW_SESSION),this.emit(he.DISCONNECT_P2P),a("tryNext");"retry"!==i&&(R.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(i)),this.reconnectToken=void 0,this.emit(he.NEED_RENEW_SESSION),this.emit(he.DISCONNECT_P2P)),a(i)}),this.websocket.on(Ne.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(i=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(i)),this.reconnect("tryNext",Si.SERVER_ERROR)}):this.join().catch(i=>{if(this.emit(he.REPORT_JOIN_GATEWAY,i.message||i.code,this.url||""),i instanceof ne&&i.code===k.UNEXPECTED_RESPONSE&&i.data.code===Ie.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Si.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Si.SERVER_ERROR):(this.initError=i,this.close())})}),this.websocket.on(Ne.REQUEST_NEW_URLS,(i,r)=>{vn(this,he.REQUEST_RECOVER,this.multiIpOption).then(i).catch(r)}),this.websocket.on(Ne.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Fe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}_handleSignalP2PEvents(){var i=this;this._external_signal.on($t.JOIN,function(){var r=x(function*(a){if(i._userOnlineTime&&i._userOnlineTime<a.onlineTime){const l=yield vn(i,he.P2P_START,void 0),d=yield i._external_signal.send($t.CALL,l);i.emit(he.P2P_CONNECTION,d,!0)}i._userInRoom=!0,i.emit("user-online")});return function(a){return r.apply(this,arguments)}}()),this.on(Fe.ON_USER_OFFLINE,function(){var r=x(function*(a){i._external_signal.clear(),i._userInRoom=!1});return function(a){return r.apply(this,arguments)}}()),this._external_signal.on($t.CALL,function(){var r=x(function*(a,l,d){i._userInRoom=!0,i.emit("user-online");try{l(yield vn(i,he.P2P_START,a))}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}())}waitTillUserOnline(){var i=this;return x(function*(){return new q(r=>{if(i._userInRoom)r();else{const a=()=>{i.off("user-online",a),r()};i.on("user-online",a)}})})()}}function hp(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Nr(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?hp(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):hp(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}const pp=new Map;class fp extends nn{get state(){return this._state}set state(i){if(i===this._state)return;const r=this._state;this._state=i,"DISCONNECTED"===i&&this._disconnectedReason?this.emit(Rn.CONNECTION_STATE_CHANGE,i,r,this._disconnectedReason):this.emit(Rn.CONNECTION_STATE_CHANGE,i,r)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(i){R.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(i)),this._joinGatewayStartTime=i}constructor(i,r){super(),T(this,"store",void 0),T(this,"joinInfo",void 0),T(this,"key",void 0),T(this,"ntpOffset",0),T(this,"signal",void 0),T(this,"role",void 0),T(this,"inChannelInfo",{joinAt:null,duration:0}),T(this,"spec",void 0),T(this,"_state","DISCONNECTED"),T(this,"_statsCollector",void 0),T(this,"_disconnectedReason",void 0),T(this,"isSignalRecover",!1),T(this,"hasChangeBGPAddress",!1),T(this,"trafficStatsInterval",void 0),T(this,"networkQualityInterval",void 0),T(this,"_joinGatewayStartTime",0),T(this,"_signalTimeout",!1),T(this,"_clientRoleOptions",void 0),T(this,"_isProactiveJoin",!1),this.store=i,this.spec=r,this.signal=this.store.useP2P?new za(Nr(Nr({},r),{},{retryConfig:r.websocketRetryConfig}),i):this.store.useDataChannel?new Wc(Nr(Nr({},r),{},{retryConfig:r.websocketRetryConfig}),i):new LD(Nr(Nr({},r),{},{retryConfig:r.websocketRetryConfig}),i),this._statsCollector=r.statsCollector,this.role=r.role||"audience",this._clientRoleOptions=r.clientRoleOptions,this.handleSignalEvents()}join(i,r,a){var l=this;return x(function*(){if(l.signal instanceof Wc){let g=!1;"disabled"!==i.cloudProxyServer?(R.debug("[".concat(l.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(i.cloudProxyServer,")")),g=!0):"".concat(i.apResponse.cid,"_").concat(i.apResponse.cert).length>255||"".concat(i.apResponse.cid,"_").concat(i.apResponse.cert).length<22?(R.debug("[".concat(l.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),g=!0):i.apResponse.addresses.some(E=>E.fingerprint)||H("FINGERPRINT")||(R.debug("[".concat(l.store.clientId,"] Dc is not supported, because fingerprint does not exist")),g=!0),g&&l.resetSignal()}l.store.joinGatewayStart(),"disabled"!==i.cloudProxyServer&&(l.hasChangeBGPAddress=!0);const d=Date.now();let h=pp.get(i.cname);if(h||(h=new Map,pp.set(i.cname,h)),l._isProactiveJoin=!0,h.has(i.uid)){const g=new K(k.UID_CONFLICT);throw Te.joinGateway(i.sid,{lts:d,succ:!1,ec:g.message,addr:null,uid:i.uid,cid:i.cid,firstSuccess:l._isProactiveJoin,avoidJoinStartTime:l.store.avoidJoinStart,isProxy:!!i.proxyServer,signalChannel:l.signal instanceof Wc?"1":"0"}),l._isProactiveJoin=!1,g}h.set(i.uid,!0),l.joinInfo=i,l.key=r;let f=0;l.joinGatewayStartTime=d;const m=i.proxyServer;try{let g;if(R.debug("[".concat(l.store.clientId,"] use ").concat(l.signal instanceof Wc?"datachannel":"websocket"," join uid ").concat(f)),l.signal instanceof Wc)g=yield l.signal.init(i.apResponse.addresses,a);else{const E=i.gatewayAddrs.map(y=>{let{address:C}=y;const[b,O]=C.split(":"),P={host:b,port:O};return i.proxyServer&&(P.proxy=i.proxyServer),P});g=yield l.signal.init(E,a)}f=g.uid,R.debug("[".concat(l.store.clientId,"] ").concat(l.signal instanceof Wc?"datachannel":"websocket"," join uid ").concat(f," cost ").concat(Date.now()-l.joinGatewayStartTime))}catch(g){throw g&&g.code===k.INIT_WEBSOCKET_TIMEOUT?(R.warning("[".concat(l.store.clientId,"] User join failed"),g.toString()),g):g&&g.code===k.INIT_DATACHANNEL_TIMEOUT?(R.warning("[".concat(l.store.clientId,"] User join datachannel failed"),g.toString()),l.resetSignal(),g):(R.error("[".concat(l.store.clientId,"] User join failed"),g.toString()),Te.joinGateway(i.sid,{lts:d,succ:!1,ec:g.message,addr:l.signal.url,uid:i.uid,cid:i.cid,firstSuccess:l._isProactiveJoin,avoidJoinStartTime:l.store.avoidJoinStart,isProxy:!!m,signalChannel:l.signal instanceof Wc?"1":"0"}),l._isProactiveJoin=!1,h.delete(i.uid),l.signal.close(),g)}return l.state="CONNECTED",l.inChannelInfo.joinAt=Date.now(),R.debug("[".concat(l.store.clientId,"] Connected to gateway server")),l.trafficStatsInterval=window.setInterval(()=>{l.updateTrafficStats().catch(g=>{R.warning("[".concat(l.store.clientId,"] get traffic stats error"),g.toString())})},3e3),l.networkQualityInterval=window.setInterval(()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?l.emit(Rn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):l.emit(Rn.NETWORK_QUALITY,l._signalTimeout?{downlinkNetworkQuality:5,uplinkNetworkQuality:5}:"CONNECTED"===l.state&&l._statsCollector.trafficStats?{uplinkNetworkQuality:Gc(l._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:Gc(l._statsCollector.trafficStats.B_dnq)}:{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),l.store.joinGatewayEnd(),f})()}leave(){var i=arguments,r=this;return x(function*(){let a=i.length>0&&void 0!==i[0]&&i[0],l=i.length>1?i[1]:void 0;if("DISCONNECTED"!==r.state){l!==$e.FALLBACK&&(r.state="DISCONNECTING");try{a||r.signal.connectionState!==ze.CONNECTED||(yield(d=r.signal.request(ve.LEAVE,void 0,!0),3e3,q.race([d,IL(3e3)])))}catch(d){R.warning("[".concat(r.store.clientId,"] leave request failed, ignore"),d)}r.signal.close(l),l!==$e.FALLBACK&&(r.state="DISCONNECTED"),r.reset()}var d})()}publish(i,r,a){var l=this;return x(function*(){if("CONNECTED"!==l.state&&"RECONNECTING"!==l.state)throw new K(k.INVALID_OPERATION,"can not publish when connection state is ".concat(l.state));const d={state:"offer",p2p_id:l.store.p2pId,ortc:r,mode:l.spec.mode,extend:H("PUB_EXTEND"),twcc:!!H("PUBLISH_TWCC"),rtx:!!H("USE_PUB_RTX")};try{return(yield l.signal.request(ve.PUBLISH,d,!0))._message}catch(h){if(a&&h.data&&h.data.code===Ie.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(l.store.clientId,"] receive publish error code, retry"),h.toString()),yield l.tryUnpubBeforeRepub(i,r),l.publish(i,r,!1);throw h}})()}publishDataChannel(i,r,a){var l=this;return x(function*(){var d;if("CONNECTED"!==l.state&&"RECONNECTING"!==l.state)throw new K(k.INVALID_OPERATION,"can not publish when connection state is ".concat(l.state));const h={stream_id:r.streamId,ordered:r.ordered?1:0,max_retrans_times:null!==(d=r.maxRetransmits)&&void 0!==d?d:10,channel_id:r.channelId,metadata:r.metadata};try{yield l.signal.request(ve.PUBLISH_DATASTREAM,h,!0)}catch(f){if(a&&f.data&&f.data.code===Ie.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(l.store.clientId,"] receive publish datachannels error code, retry"),f.toString()),yield l.tryUnpubDataChannelBeforeRepub(i,r),l.publishDataChannel(i,r,!1);throw f}})()}unpublish(i,r){var a=this;return x(function*(){try{if("CONNECTED"!==a.state&&"RECONNECTING"!==a.state)throw new K(k.INVALID_OPERATION,"can not publish when connection state is ".concat(a.state));yield a.signal.request(ve.UNPUBLISH,{stream_id:r,ortc:i},!0)}catch(l){R.warning("[".concat(a.store.clientId,"] unpublish warning: "),l)}})()}unpublishDataChannel(i){var r=this;return x(function*(){try{if("CONNECTED"!==r.state&&"RECONNECTING"!==r.state)throw new K(k.INVALID_OPERATION,"can not publish when connection state is ".concat(r.state));yield q.all(i.map(a=>r.signal.request(ve.UNPUBLISH_DATASTREAM,{channel_id:a},!0)))}catch(a){R.warning("unpublish datachannels warning: ",a)}})()}subscribe(i,r,a){var l=this;return x(function*(){if("CONNECTED"!==l.state&&"RECONNECTING"!==l.state)throw new K(k.INVALID_OPERATION,"can not subscribe when connection state is ".concat(l.state));const d={stream_id:i,stream_type:r.stream_type,mode:l.spec.mode,codec:l.spec.codec,p2p_id:l.store.p2pId,twcc:!!H("SUBSCRIBE_TWCC"),rtx:!!H("USE_SUB_RTX"),extend:H("SUB_EXTEND"),ssrcId:r.ssrcId,svc:Array.isArray(H("SVC"))&&0!==H("SVC").length?H("SVC"):void 0};try{return(yield l.signal.request(ve.SUBSCRIBE,d,!0))._message}catch(h){if(a&&h.data&&h.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(l.store.clientId,"] receiver subscribe error code, retry"),h.toString()),yield l.tryUnsubBeforeResub(i,r),yield l.subscribe(i,r,!1);throw h}})()}subscribeDataChannel(i,r,a){var l=this;return x(function*(){if("CONNECTED"!==l.state&&"RECONNECTING"!==l.state)throw new K(k.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(l.state));const d={uid:i,stream_id:r.id,channel_id:r.datachannelId};try{return void(yield l.signal.request(ve.SUBSCRIBE_DATASTREAM,d,!0))}catch(h){if(a&&h.data&&h.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(l.store.clientId,"] receiver subscribe datachannel error code, retry"),h.toString()),yield l.tryUnsubDataChannelBeforeResub(i,r),yield l.subscribeDataChannel(i,r,!1);throw h}})()}subscribeAll(i,r){var a=this;return x(function*(){if("CONNECTED"!==a.state&&"RECONNECTING"!==a.state)throw new K(k.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(a.state));const l={p2p_id:a.store.p2pId,users:i,dtx:!1,rtx:!!H("USE_SUB_RTX")};try{return yield a.signal.request(ve.SUBSCRIBE_STREAMS,l,!0)}catch(d){if(r&&d.data&&d.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(a.store.clientId,"] receiver massSubscribe error code, retry"),d.toString()),yield a.tryMassUnsubBeforeResub(i),yield a.subscribeAll(i,!1);throw d}})()}setVideoProfile(i){var r=this;return x(function*(){const a=function(l){if(!(l.bitrateMax&&l.bitrateMin&&l.frameRate&&l.height&&l.width))return;let d=l.frameRate,h=l.width,f=l.height,m=!0;return"number"!=typeof d&&(d=d.exact||d.ideal||d.max||d.min||0,d||(m=!1)),"number"!=typeof h&&(h=h.exact||h.ideal||h.max||h.min||0,h||(m=!1)),"number"!=typeof f&&(f=f.exact||f.ideal||f.max||f.min||0,d||(m=!1)),m?{stream_type:0,width:h,height:f,fps:d,start_bps:1e3*l.bitrateMax,min_bps:1e3*l.bitrateMin,target_bps:1e3*l.bitrateMax}:void 0}(i);if(a)return r.signal.request(ve.SET_VIDEO_PROFILE,a);R.debug("[".concat(r.store.clientId,"] encoder config is not complete, do not report to gateway"))})()}unsubscribe(i,r){var a=this;return x(function*(){try{yield a.signal.request(ve.UNSUBSCRIBE,{p2p_id:a.store.p2pId,ortc:i,stream_id:r},!0)}catch(l){R.warning("[".concat(a.store.clientId,"] unsubscribe warning: "),l)}})()}unsubscribeDataChannel(i,r){var a=this;return x(function*(){try{if("CONNECTED"!==a.state&&"RECONNECTING"!==a.state)throw new K(k.INVALID_OPERATION,"can not publish when connection state is ".concat(a.state));yield q.all(i.map(l=>a.signal.request(ve.UNSUBSCRIBE_DATASTREAM,{stream_id:l,uid:r},!0)))}catch(l){R.warning("unsubscribeDataChannel warning: ",l)}})()}massUnsubscribe(i){var r=this;return x(function*(){try{yield r.signal.request(ve.UNSUBSCRIBE_STREAMS,i,!0)}catch(a){R.warning("[".concat(r.store.clientId,"] massUnsubscribeAll warning: "),a)}})()}reconnectPC(i){var r=this;return x(function*(){const{iceParameters:a,dtlsParameters:l,rtpCapabilities:d}=i;return{gatewayEstablishParams:yield r.signal.request(ve.CONNECT_PC,{p2p_id:r.store.p2pId,stream_id:r.store.uid,ortc:{iceParameters:a,dtlsParameters:l,rtpCapabilities:d}},!0),gatewayAddress:r.getCurrentGatewayAddress()}})()}getGatewayInfo(){return this.signal.request(ve.GATEWAY_INFO)}renewToken(i){var r=this;return x(function*(){yield r.signal.request(ve.RENEW_TOKEN,i),r.key=i.token})()}setClientRole(i,r){var a=this;return x(function*(){if(r&&(a._clientRoleOptions=Object.assign({},r)),"CONNECTED"!==a.state)return void(a.role=i);let l,d=0;"audience"===i?a._clientRoleOptions&&a._clientRoleOptions.delay?(l=a._clientRoleOptions.delay,d=1):d=a._clientRoleOptions&&a._clientRoleOptions.level?a._clientRoleOptions.level:2:d=0,yield a.signal.request(ve.SET_CLIENT_ROLE,{role:i,level:d,delay:l,client_ts:Date.now()}),a.role=i})()}setRemoteVideoStreamType(i,r){var a=this;return x(function*(){yield a.signal.request(ve.SWITCH_VIDEO_STREAM,{stream_id:i,stream_type:r})})()}setDefaultRemoteVideoStreamType(i){var r=this;return x(function*(){yield r.signal.request(ve.DEFAULT_VIDEO_STREAM,{stream_type:i})})()}setStreamFallbackOption(i,r){var a=this;return x(function*(){yield a.signal.request(ve.SET_FALLBACK_OPTION,{stream_id:i,fallback_type:r})})()}pickSVCLayer(i,r){var a=this;return x(function*(){yield a.signal.request(ve.PICK_SVC_LAYER,{stream_id:i,spatial_layer:r.spatialLayer,temporal_layer:r.temporalLayer})})()}setRTM2Flag(i){var r=this;return x(function*(){yield r.signal.request(ve.SET_RTM2_FLAG,{rtm2_flag:i})})()}sendExtensionMessage(i,r,a){var l=this;return x(function*(){if(l.signal instanceof za)return l.signal.sendExtensionMessage(i,r,a)})()}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Nr({},this.inChannelInfo)}getGatewayVersion(){var i=this;return x(function*(){return(yield i.signal.request(ve.GATEWAY_INFO)).version})()}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const i=pp.get(this.joinInfo.cname);i&&i.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const i=function(r){let a;return a=r.startsWith("dc")?r.match(/(dc\:\/\/)?([^:]+):(\d+)/):r.match(/(wss\:\/\/)?([^:]+):(\d+)/),a?{username:on.username,password:on.password,turnServerURL:a[2],tcpport:parseInt(a[3])+30,udpport:parseInt(a[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],i&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(Nr(Nr({},on),{},{turnServerURL:i.turnServerURL,tcpport:i.tcpport,udpport:i.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}updateTrafficStats(){var i=this;return x(function*(){if("CONNECTED"!==i.state)return;const r=yield i.signal.request(ve.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),null!=r.ntp_offset&&(i.ntpOffset=r.ntp_offset),r.peer_delay.forEach(a=>{const l=i._statsCollector.trafficStats&&i._statsCollector.trafficStats.peer_delay.find(d=>d.peer_uid===a.peer_uid);l&&l.B_st!==a.B_st&&Ko(()=>{i.emit(Rn.STREAM_TYPE_CHANGE,a.peer_uid,a.B_st)})}),i._statsCollector.updateTrafficStats(r)})()}getJoinMessage(i){if(!this.joinInfo||!this.key)throw new K(k.UNEXPECTED_ERROR,"can not generate join message, no join info");const r=Object.assign({},this.joinInfo.apResponse);let a=H("REPORT_APP_SCENARIO");if("string"!=typeof a)try{a=JSON.stringify(a)}catch(d){a=void 0}a&&a.length>128&&(a=void 0);const l=Nr({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:yo,browser:navigator.userAgent,process_id:H("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:r,extend:H("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:a,attributes:{userAttributes:{enablePublishedUserList:H("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:H("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:"number"==typeof H("SUBSCRIBE_AUDIO_FILTER_TOPN")?H("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:"boolean"==typeof H("ENABLE_PUBLISH_AUDIO_FILTER")?H("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:"boolean"==typeof H("ENABLE_USER_LICENSE_CHECK")?H("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:!0===H("USE_PUB_RTX")||!0===H("USE_SUB_RTX")||void 0,disableFEC:H("DISABLE_FEC"),enableNTPReport:!!H("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!H("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:"boolean"==typeof H("ENABLE_DATASTREAM_2")?H("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:"number"==typeof H("RTM2_FLAG")?H("RTM2_FLAG"):void 0,enableUserAutoRebalanceCheck:!!H("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:"boolean"==typeof H("USE_XR")?H("USE_XR"):void 0}},join_ts:this.joinGatewayStartTime},i);return this.joinInfo.stringUid&&(l.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(l.aes_mode=this.joinInfo.aesmode,H("ENCRYPT_AES")?(l.aes_secret=this.joinInfo.aespassword,l.aes_encrypt=!0):l.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(l.aes_salt=this.joinInfo.aessalt)),r.addresses[this.signal.websocket.currentURLIndex]&&(l.ap_response.ticket=r.addresses[this.signal.websocket.currentURLIndex].ticket,delete r.addresses),void 0!==this.joinInfo.defaultVideoStream&&(l.default_video_stream=this.joinInfo.defaultVideoStream),l}getRejoinMessage(){if(!this.joinInfo)throw new K(k.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){var i=this;this.signal.on(he.WS_RECONNECT_WAITTING_FINISH,r=>{var a;we(a=["tryNext","recover"]).call(a,r)&&this.joinInfo&&Te.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(he.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(he.WS_RECONNECTING,r=>{this.joinInfo&&Te.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||Si.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Te.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(he.WS_CLOSED,r=>{let a;switch(r){case $e.LEAVE:a=Si.LEAVE;break;case $e.UID_BANNED:case $e.IP_BANNED:case $e.CHANNEL_BANNED:case $e.SERVER_ERROR:a=Si.SERVER_ERROR;break;case $e.FALLBACK:a=Si.FALLBACK;break;case $e.LICENSE_MISSING:case $e.LICENSE_EXPIRED:case $e.LICENSE_MINUTES_EXCEEDED:case $e.LICENSE_PERIOD_INVALID:case $e.LICENSE_MULTIPLE_SDK_SERVICE:case $e.LICENSE_ILLEGAL:case $e.TOKEN_EXPIRE:a=r;break;default:a=Si.NETWORK_ERROR}R.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(a||"undefined -> "+Si.NETWORK_ERROR)),this.joinInfo&&Te.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===$e.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:a}),this._disconnectedReason=r,r!==$e.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(he.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&("audience"===this.role&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(R.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),Te.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof Wc?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion)){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void R.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));Bt("EVENT_REPORT_DOMAIN",r[1]),Bt("EVENT_REPORT_BACKUP_DOMAIN",r[1]),Bt("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}),this.signal.on(Fe.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(he.REQUEST_RECOVER,(r,a,l)=>{if(!this.joinInfo)return l(new K(k.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,vn(this,Rn.REQUEST_NEW_GATEWAY_LIST).then(a).catch(l)}),this.signal.on(he.REQUEST_JOIN_INFO,function(){var r=x(function*(a){var l;if(i.updateTurnConfigFromSignal(),i.store.useP2P)return void a(i.getJoinMessage({ortc:{}}));const{iceParameters:d,dtlsParameters:h,rtpCapabilities:f}=yield vn(i,Rn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:null===(l=i.joinInfo)||void 0===l?void 0:l.turnServer});a(i.getJoinMessage({ortc:{iceParameters:d,dtlsParameters:h,rtpCapabilities:f,version:"2"}}))});return function(a){return r.apply(this,arguments)}}()),this.signal.on(he.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(he.REPORT_JOIN_GATEWAY,(r,a)=>{this.joinInfo&&(Te.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,addr:a,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof Wc?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(he.IS_P2P_DISCONNECTED,r=>{r(Cs(this,Rn.IS_P2P_DISCONNECTED))}),this.signal.on(he.DISCONNECT_P2P,()=>{this.emit(Rn.DISCONNECT_P2P)}),this.signal.on(he.NEED_RENEW_SESSION,()=>{this.emit(Rn.NEED_RENEW_SESSION)}),this.signal.on(he.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(he.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(he.JOIN_RESPONSE,r=>{const a=this.getCurrentGatewayAddress();this.emit(Rn.JOIN_RESPONSE,r,a)}),this.signal.on(he.DATACHANNEL_PRECONNECT,function(){var r=x(function*(a,l,d){i.updateTurnConfigFromSignal();const h=i.getCurrentGatewayAddress();return vn(i,Rn.DATACHANNEL_PRECONNECT,a,h).then(l).catch(d)});return function(a,l,d){return r.apply(this,arguments)}}()),this.signal.on(he.DATACHANNEL_CONNECTING,function(){var r=x(function*(a){const{iceParameters:l,dtlsParameters:d,rtpCapabilities:h}=yield vn(i,Rn.REQUEST_DC_CONNECTION_PARAMS);a(i.getJoinMessage({ortc:{iceParameters:l,dtlsParameters:d,rtpCapabilities:h,version:"2"}}))});return function(a){return r.apply(this,arguments)}}()),this.signal.on(he.DATACHANNEL_FAILBACK,()=>{R.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(Rn.DATACHANNEL_FAILBACK)})}tryUnsubBeforeResub(i,r){var a=this;return x(function*(){try{yield a.signal.request(ve.UNSUBSCRIBE,{p2p_id:a.store.p2pId,stream_id:i,ortc:[r]},!0)}catch(l){throw R.warning("[".concat(a.store.clientId,"] tryUnsubBeforeResub warning"),l),l}})()}tryUnsubDataChannelBeforeResub(i,r){var a=this;return x(function*(){try{yield a.signal.request(ve.UNSUBSCRIBE,{stream_id:r.id},!0)}catch(l){throw R.warning("unsubscribe datachannel warning",l),l}})()}tryUnpubBeforeRepub(i,r){var a=this;return x(function*(){try{yield a.signal.request(ve.UNPUBLISH,{stream_id:i,ortc:r},!0)}catch(l){throw R.warning("[".concat(a.store.clientId,"] tryUnpubBeforeRepub warning: "),l),l}})()}tryUnpubDataChannelBeforeRepub(i,r){var a=this;return x(function*(){try{yield a.signal.request(ve.UNPUBLISH_DATASTREAM,{channnel_id:r.channelId},!0)}catch(l){throw R.warning("unpublish datastream warning: ",l),l}})()}tryMassUnsubBeforeResub(i){var r=this;return x(function*(){const a={users:i.map(l=>({stream_id:l.stream_id,stream_type:l.stream_type}))};try{yield r.signal.request(ve.UNSUBSCRIBE_STREAMS,a,!0)}catch(l){throw R.warning("[".concat(r.store.clientId,"] tryMassUnsubBeforeResub warning"),l),l}})()}muteLocal(i,r){var a=this;return x(function*(){const l={action:i.find(d=>d.stream_type===bt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:a.store.p2pId,ortc:i,stream_id:r};try{yield a.signal.request(ve.CONTROL,l,!0,!0)}catch(d){throw R.warning("[".concat(a.store.clientId,"] gateway muteLocal warning: "),d),d}})()}unmuteLocal(i,r){var a=this;return x(function*(){const l={action:i.find(d=>d.stream_type===bt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:a.store.p2pId,ortc:i,stream_id:r};try{yield a.signal.request(ve.CONTROL,l,!0,!0)}catch(d){throw R.warning("[".concat(a.store.clientId,"] gateway unmuteLocal warning: "),d),d}})()}muteRemote(i,r){var a=this;return x(function*(){const l={action:i===ye.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:a.store.p2pId,stream_id:r};try{yield a.signal.request(ve.CONTROL,l,!0,!0)}catch(d){throw R.warning("[".concat(a.store.clientId,"] gateway muteRemote warning: "),d),d}})()}unmuteRemote(i,r){var a=this;return x(function*(){const l={action:i===ye.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:a.store.p2pId,stream_id:r};try{yield a.signal.request(ve.CONTROL,l,!0,!0)}catch(d){throw R.warning("[".concat(a.store.clientId,"] gateway unmuteRemote warning: "),d),d}})()}uploadStats(i,r){this.signal.upload(i,r)}getSignalRTT(){return this.signal.rtt}restartICE(i){var r=this;return x(function*(){const a={p2p_id:r.store.p2pId,stream_id:r.store.uid,ortc:i};try{return yield r.signal.request(ve.RESTART_ICE,a,!0)}catch(l){throw R.warning("[".concat(r.store.clientId,"] P2PChannel.restartICE warning: "),l),l}})()}reconnect(){"CONNECTED"===this.state&&this.signal.reconnect(void 0,Si.P2P_FAILED)}getCurrentGatewayAddress(){var i;if(!H("GATEWAY_WSS_ADDRESS"))return null!==(i=this.joinInfo)&&void 0!==i&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}setPublishAudioFilterEnabled(i){var r=this;return x(function*(){yield r.signal.request(ve.SET_PARAMETER,{enablePublishAudioFilter:i})})()}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close($e.FALLBACK)),this.store.useDataChannel=!1,this.signal=new LD(Nr(Nr({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(Rn.RESET_SIGNAL,Zh.websocket)}}let sy=0,mb=0;function Kc(s,i,r,a){return new q((l,d)=>{i.timeout=i.timeout||H("HTTP_CONNECT_TIMEOUT"),i.responseType=i.responseType||"json",i.data&&!r?(i.data=JSON.stringify(i.data),sy+=Va(i.data)):r&&(i.data.size?sy+=i.data.size:i.data instanceof FormData?sy+=LA(i.data):sy+=Va(JSON.stringify(i.data))),i.headers=i.headers||{},i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json",i.method="POST",i.url=s,Gr.request(i).then(h=>{"string"==typeof h.data?mb+=Va(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?mb+=h.data.byteLength:mb+=Va(JSON.stringify(h.data)),a&&l({data:h.data,headers:h.headers}),l(h.data)}).catch(h=>{Gr.isCancel(h)?d(new K(k.OPERATION_ABORTED,"cancel token canceled")):d("ECONNABORTED"===h.code?new K(k.NETWORK_TIMEOUT,h.message):h.response?new K(k.NETWORK_RESPONSE_ERROR,h.response.status):new K(k.NETWORK_ERROR,h.message))})})}!function(){var s;function i(re){var de=0;return function(){return de<re.length?{done:!1,value:re[de++]}:{done:!0}}}var a,r="function"==typeof Object.defineProperties?Object.defineProperty:function(re,de,ge){return re==Array.prototype||re==Object.prototype||(re[de]=ge.value),re},l=function(re){re=["object"==typeof globalThis&&globalThis,re,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Bu&&Bu];for(var de=0;de<re.length;++de){var ge=re[de];if(ge&&ge.Math==Math)return ge}throw Error("Cannot find global object")}(this);function d(re,de){if(de)e:{var ge=l;re=re.split(".");for(var xe=0;xe<re.length-1;xe++){var gt=re[xe];if(!(gt in ge))break e;ge=ge[gt]}(de=de(xe=ge[re=re[re.length-1]]))!=xe&&null!=de&&r(ge,re,{configurable:!0,writable:!0,value:de})}}function h(re){return(re={next:re})[Symbol.iterator]=function(){return this},re}function f(re){var de="undefined"!=typeof Symbol&&Symbol.iterator&&re[Symbol.iterator];return de?de.call(re):{next:i(re)}}if(d("Symbol",function(re){function de(gt,ue){this.A=gt,r(this,"description",{configurable:!0,writable:!0,value:ue})}if(re)return re;de.prototype.toString=function(){return this.A};var ge="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",xe=0;return function gt(ue){if(this instanceof gt)throw new TypeError("Symbol is not a constructor");return new de(ge+(ue||"")+"_"+xe++,ue)}}),d("Symbol.iterator",function(re){if(re)return re;re=Symbol("Symbol.iterator");for(var de="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),ge=0;ge<de.length;ge++){var xe=l[de[ge]];"function"==typeof xe&&"function"!=typeof xe.prototype[re]&&r(xe.prototype,re,{configurable:!0,writable:!0,value:function(){return h(i(this))}})}return re}),"function"==typeof Object.setPrototypeOf)a=Object.setPrototypeOf;else{var m;e:{var g={};try{g.__proto__={a:!0},m=g.a;break e}catch(re){}m=!1}a=m?function(re,de){if(re.__proto__=de,re.__proto__!==de)throw new TypeError(re+" is not extensible");return re}:null}var E=a;function y(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function C(re){if(re.m)throw new TypeError("Generator is already running");re.m=!0}function b(re,de){return re.h=3,{value:de}}function O(re){this.g=new y,this.G=re}function P(re,de,ge,xe){try{var gt=de.call(re.g.j,ge);if(!(gt instanceof Object))throw new TypeError("Iterator result "+gt+" is not an object");if(!gt.done)return re.g.m=!1,gt;var ue=gt.value}catch(I){return re.g.j=null,re.g.s(I),D(re)}return re.g.j=null,xe.call(re.g,ue),D(re)}function D(re){for(;re.g.h;)try{var de=re.G(re.g);if(de)return re.g.m=!1,{value:de.value,done:!1}}catch(ge){re.g.v=void 0,re.g.s(ge)}if(re.g.m=!1,re.g.l){if(de=re.g.l,re.g.l=null,de.F)throw de.D;return{value:de.return,done:!0}}return{value:void 0,done:!0}}function L(re){this.next=function(de){return re.o(de)},this.throw=function(de){return re.s(de)},this.return=function(de){return function(ge,xe){C(ge.g);var gt=ge.g.j;return gt?P(ge,"return"in gt?gt.return:function(ue){return{value:ue,done:!0}},xe,ge.g.return):(ge.g.return(xe),D(ge))}(re,de)},this[Symbol.iterator]=function(){return this}}function B(re,de){return de=new L(new O(de)),E&&re.prototype&&E(de,re.prototype),de}if(y.prototype.o=function(re){this.v=re},y.prototype.s=function(re){this.l={D:re,F:!0},this.h=this.C||this.u},y.prototype.return=function(re){this.l={return:re},this.h=this.u},O.prototype.o=function(re){return C(this.g),this.g.j?P(this,this.g.j.next,re,this.g.o):(this.g.o(re),D(this))},O.prototype.s=function(re){return C(this.g),this.g.j?P(this,this.g.j.throw,re,this.g.o):(this.g.s(re),D(this))},d("Array.prototype.entries",function(re){return re||function(){return function(de,ge){de instanceof String&&(de+="");var xe=0,gt=!1,ue={next:function(){if(!gt&&xe<de.length){var I=xe++;return{value:ge(I,de[I]),done:!1}}return gt=!0,{done:!0,value:void 0}}};return ue[Symbol.iterator]=function(){return ue},ue}(this,function(de,ge){return[de,ge]})}}),"undefined"!=typeof Blob&&("undefined"==typeof FormData||!FormData.prototype.keys)){var V=function(re,de){for(var ge=0;ge<re.length;ge++)de(re[ge])},J=function(re){return re.replace(/\r?\n|\r/g,"\r\n")},ae=function(re,de,ge){return de instanceof Blob?(ge=void 0!==ge?String(ge+""):"string"==typeof de.name?de.name:"blob",de.name===ge&&"[object Blob]"!==Object.prototype.toString.call(de)||(de=new File([de],ge)),[String(re),de]):[String(re),String(de)]},z=function(re,de){if(re.length<de)throw new TypeError(de+" argument required, but only "+re.length+" present.")},Q="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,X=Q.FormData,te=Q.XMLHttpRequest&&Q.XMLHttpRequest.prototype.send,Ce=Q.Request&&Q.fetch,Se=Q.navigator&&Q.navigator.sendBeacon,He=Q.Element&&Q.Element.prototype,ut=Q.Symbol&&Symbol.toStringTag;ut&&(Blob.prototype[ut]||(Blob.prototype[ut]="Blob"),"File"in Q&&!File.prototype[ut]&&(File.prototype[ut]="File"));try{new File([],"")}catch(re){Q.File=function(de,ge,xe){return de=new Blob(de,xe||{}),Object.defineProperties(de,{name:{value:ge},lastModified:{value:+(xe&&void 0!==xe.lastModified?new Date(xe.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),ut&&Object.defineProperty(de,ut,{value:"File"}),de}}var mt=function(re){return re.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},dt=function(re){this.i=[];var de=this;re&&V(re.elements,function(ge){if(ge.name&&!ge.disabled&&"submit"!==ge.type&&"button"!==ge.type&&!ge.matches("form fieldset[disabled] *"))if("file"===ge.type){var xe=ge.files&&ge.files.length?ge.files:[new File([],"",{type:"application/octet-stream"})];V(xe,function(gt){de.append(ge.name,gt)})}else"select-multiple"===ge.type||"select-one"===ge.type?V(ge.options,function(gt){!gt.disabled&&gt.selected&&de.append(ge.name,gt.value)}):"checkbox"===ge.type||"radio"===ge.type?ge.checked&&de.append(ge.name,ge.value):(xe="textarea"===ge.type?J(ge.value):ge.value,de.append(ge.name,xe))})};if((s=dt.prototype).append=function(re,de,ge){z(arguments,2),this.i.push(ae(re,de,ge))},s.delete=function(re){z(arguments,1);var de=[];re=String(re),V(this.i,function(ge){ge[0]!==re&&de.push(ge)}),this.i=de},s.entries=function re(){var de,ge=this;return B(re,function(xe){if(1==xe.h&&(de=0),3!=xe.h)return de<ge.i.length?xe=b(xe,ge.i[de]):(xe.h=0,xe=void 0),xe;de++,xe.h=2})},s.forEach=function(re,de){z(arguments,1);for(var ge=f(this),xe=ge.next();!xe.done;xe=ge.next()){var gt=f(xe.value);xe=gt.next().value,gt=gt.next().value,re.call(de,gt,xe,this)}},s.get=function(re){z(arguments,1);var de=this.i;re=String(re);for(var ge=0;ge<de.length;ge++)if(de[ge][0]===re)return de[ge][1];return null},s.getAll=function(re){z(arguments,1);var de=[];return re=String(re),V(this.i,function(ge){ge[0]===re&&de.push(ge[1])}),de},s.has=function(re){z(arguments,1),re=String(re);for(var de=0;de<this.i.length;de++)if(this.i[de][0]===re)return!0;return!1},s.keys=function re(){var de,ge,ue=this;return B(re,function(I){if(1==I.h&&(de=f(ue),ge=de.next()),3!=I.h)return ge.done?void(I.h=0):b(I,f(ge.value).next().value);ge=de.next(),I.h=2})},s.set=function(re,de,ge){z(arguments,2),re=String(re);var xe=[],gt=ae(re,de,ge),ue=!0;V(this.i,function(I){I[0]===re?ue&&(ue=!xe.push(gt)):xe.push(I)}),ue&&xe.push(gt),this.i=xe},s.values=function re(){var de,ge,gt,ue=this;return B(re,function(I){if(1==I.h&&(de=f(ue),ge=de.next()),3!=I.h)return ge.done?void(I.h=0):((gt=f(ge.value)).next(),b(I,gt.next().value));ge=de.next(),I.h=2})},dt.prototype._asNative=function(){for(var re=new X,de=f(this),ge=de.next();!ge.done;ge=de.next()){var xe=f(ge.value);ge=xe.next().value,xe=xe.next().value,re.append(ge,xe)}return re},dt.prototype._blob=function(){var re="----formdata-polyfill-"+Math.random(),de=[],ge="--"+re+'\r\nContent-Disposition: form-data; name="';return this.forEach(function(xe,gt){return"string"==typeof xe?de.push(ge+mt(J(gt))+'"\r\n\r\n'+J(xe)+"\r\n"):de.push(ge+mt(J(gt))+'"; filename="'+mt(xe.name)+'"\r\nContent-Type: '+(xe.type||"application/octet-stream")+"\r\n\r\n",xe,"\r\n")}),de.push("--"+re+"--"),new Blob(de,{type:"multipart/form-data; boundary="+re})},dt.prototype[Symbol.iterator]=function(){return this.entries()},dt.prototype.toString=function(){return"[object FormData]"},He&&!He.matches&&(He.matches=He.matchesSelector||He.mozMatchesSelector||He.msMatchesSelector||He.oMatchesSelector||He.webkitMatchesSelector||function(re){for(var de=(re=(this.document||this.ownerDocument).querySelectorAll(re)).length;0<=--de&&re.item(de)!==this;);return-1<de}),ut&&(dt.prototype[ut]="FormData"),te){var It=Q.XMLHttpRequest.prototype.setRequestHeader;Q.XMLHttpRequest.prototype.setRequestHeader=function(re,de){It.call(this,re,de),"content-type"===re.toLowerCase()&&(this.B=!0)},Q.XMLHttpRequest.prototype.send=function(re){re instanceof dt?(re=re._blob(),this.B||this.setRequestHeader("Content-Type",re.type),te.call(this,re)):te.call(this,re)}}Ce&&(Q.fetch=function(re,de){return de&&de.body&&de.body instanceof dt&&(de.body=de.body._blob()),Ce.call(this,re,de)}),Se&&(Q.navigator.sendBeacon=function(re,de){return de instanceof dt&&(de=de._asNative()),Se.call(this,re,de)}),Q.FormData=dt}}();const G_=()=>{const s=H("AREAS");return 0===s.length&&s.push(at.GLOBAL),Ba(s).call(s,(i,r,a)=>{const l=gb(r);return l?0===a?l:"".concat(i,",").concat(l):i},"")},gb=s=>s===at.OVERSEA?"".concat(Oi.ASIA,",").concat(Oi.EUROPE,",").concat(Oi.AFRICA,",").concat(Oi.NORTH_AMERICA,",").concat(Oi.SOUTH_AMERICA,",").concat(Oi.OCEANIA):Oi[s],qO=s=>{const i={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return s.map(r=>{const a=vE[r],l=Object.keys(a);l&&l.map(d=>{"CODE"!==d&&(i[d]=i[d].concat(a[d]))})}),i},W_={GLOBAL:{ASIA:[at.CHINA,at.JAPAN,at.INDIA,at.KOREA,at.HKMC],EUROPE:[],NORTH_AMERICA:[at.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},_p=Object.keys(W_[at.GLOBAL]),Eb=[at.CHINA,at.NORTH_AMERICA,at.EUROPE,at.ASIA,at.JAPAN,at.INDIA,at.OCEANIA,at.SOUTH_AMERICA,at.AFRICA,at.KOREA,at.HKMC,at.US],s2=function(s,i){let r=[];if(we(s).call(s,at.GLOBAL)){const d=[at.GLOBAL,at.OVERSEA],h=Object.keys(vE);if(i===at.GLOBAL)throw new K(k.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(i===at.CHINA)r=[at.OVERSEA];else if(l=i,we(_p).call(_p,l)){const f=W_[at.GLOBAL][i]||[],m=[...d,i,...f];r=h.filter(g=>!we(m).call(m,g))}else if(function(f){let m=!1;return _p.forEach(g=>{var E;we(E=W_[at.GLOBAL][g]).call(E,f)&&(m=!0)}),m}(i)){const f=function(g){let E;return _p.forEach(y=>{var C;we(C=W_[at.GLOBAL][y]).call(C,g)&&(E=y)}),E}(i),m=[...d,f,i];r=h.filter(g=>!we(m).call(m,g))}else r=s;r=function(f){const m=[];return Eb.forEach(g=>{we(f).call(f,g)&&m.push(g)}),m.concat(f.filter(g=>!we(Eb).call(Eb,g)))}(r)}else r=s;var l;return r};function yb(s){var i,r;if(!s&&we(i=H("AREAS")).call(i,at.EXTENSIONS))return R.debug("update area from ap : reset"),void qc(Is,!0);if(!we(r=H("AREAS")).call(r,at.GLOBAL)||!s)return;let a=vE.EXTENSIONS;a&&(a={CODE:gb(at.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(s,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(s,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(s,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(s,".agora.io"),"cds-ap-web-2-".concat(s,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(s,".agora.io"),"sua-ap-web-2-".concat(s,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(s,".agora.io"),"uap-ap-web-2-".concat(s,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(s,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(s,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(s,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(s,".agora.io")]},R.debug("update area from ap success: ".concat(s,",config is "),a),Bt("AREAS",[at.EXTENSIONS],!0),Object.keys(a).map(l=>{Bt(l,"LOG_UPLOAD_SERVER"===l||"EVENT_REPORT_DOMAIN"===l||"EVENT_REPORT_BACKUP_DOMAIN"===l||"PROXY_SERVER_TYPE3"===l?a[l][0]:a[l])}))}function qc(s){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=Te.reportApiInvoke(null,{name:jn.SET_AREA,options:s,tag:Kt.TRACER});try{let a=[];if("string"==typeof s&&(a=[s]),Array.isArray(s)&&(s.forEach(d=>{if(!we(DD).call(DD,d))throw new K(k.INVALID_PARAMS,"invalid area code")}),a=s),"[object Object]"===Object.prototype.toString.call(s)){const{areaCode:d,excludedArea:h}=s;if(!d)throw new K(k.INVALID_PARAMS,"area code is needed");let f=d;"string"==typeof d&&(f=[d]),a=h?s2(f,h):f}if(!i){if(Dc.AREAS){const d=new K(k.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r.onError(d),void R.warning("setArea is prohibited because of config-distribute")}if(we(a).call(a,at.GLOBAL)&&H("AREAS")===at.EXTENSIONS){const d=new K(k.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r.onError(d),void R.warning("setArea is prohibited because of ap extensions")}}Bt("AREAS",a,i);const l=qO(a);Object.keys(l).map(d=>{Bt(d,"LOG_UPLOAD_SERVER"===d||"EVENT_REPORT_DOMAIN"===d||"EVENT_REPORT_BACKUP_DOMAIN"===d||"PROXY_SERVER_TYPE3"===d?l[d][0]:l[d])}),R.debug("set area success:",a.join(","))}catch(a){throw r.onError(a),a}r.onSuccess()}function ay(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function vb(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?ay(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):ay(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}let Cb=1;function C3(s,i,r,a,l){Cb+=1;const d={sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(Date.now()/1e3),seq:Cb,requestId:Cb,version:yo,cname:r.cname},h={service_name:i,json_body:JSON.stringify(d)};let f,m,g=s[0];return Ss(x(function*(){f=Date.now();const E=yield Kc(g,{data:h,cancelToken:a,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(m=Date.now()-f,0!==E.code){const b=new K(k.UNEXPECTED_RESPONSE,"live streaming ap error, code"+E.code,{retry:!0,responseTime:m});throw R.error(b.toString()),b}const y=JSON.parse(E.json_body);if(200!==y.code){const b=new K(k.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(y.code,", reason: ").concat(y.reason),{code:y.code,responseTime:m});throw R.error(b.toString()),b}if(!y.servers||0===y.servers.length){const b=new K(k.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:y.code,responseTime:m});throw R.error(b.toString()),b}const C=(O=i,{addressList:(b=y).servers.map(P=>"wss://".concat(P.address.replace(/\./g,"-"),".").concat(H("WORKER_DOMAIN"),":").concat(P.wss,"?serviceName=").concat(encodeURIComponent(O))),workerToken:b.workerToken,vid:b.vid});var b,O;return H("LIVE_STREAMING_ADDRESS")&&(C.addressList=H("LIVE_STREAMING_ADDRESS")instanceof Array?H("LIVE_STREAMING_ADDRESS"):[H("LIVE_STREAMING_ADDRESS")]),vb(vb({},C),{},{responseTime:m})}),(E,y)=>(Te.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:i,responseDetail:JSON.stringify(E.addressList),firstSuccess:0===y,responseTime:m,serverIp:s[y%s.length]}),!1),(E,y)=>(Te.apworkerEvent(r.sid,{success:!1,sc:E.data&&E.data.code||200,serviceName:i,responseTime:m,serverIp:s[y%s.length]}),!!(E.code!==k.OPERATION_ABORTED&&E.code!==k.UNEXPECTED_RESPONSE||E.data&&E.data.retry)&&(g=s[(y+1)%s.length],!0)),l)}let zO=1;function a2(s,i,r,a){let{url:l,areaCode:d}=s;const h=Date.now();let f;const[m,g]=l2(i,d,[bi.CHOOSE_SERVER]);let E=Hn.networkState;return Ss(x(function*(){E&&Hn.networkState===yn.OFFLINE&&Hn.onlineWaiter&&(yield q.race([Hn.onlineWaiter,si(a&&a.maxRetryTimeout||Wn.maxRetryTimeout)])),E=Hn.networkState;const{data:y,headers:C}=yield Kc(l,{data:m,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);f="1"===C.http3?1:-1,Te.reportResourceTiming(l,i.sid),YO(y,l,i,h,[bi.CHOOSE_SERVER],f);const b=Au(y,bi.CHOOSE_SERVER);return $O(b),hb(b,l)}),y=>(y&&Te.joinChooseServer(i.sid,{lts:h,succ:!0,csAddr:l,opid:g,serverList:y.gatewayAddrs.map(C=>C.address),ec:null,cid:y.cid.toString(),uid:y.uid.toString(),csIp:y.csIp,unilbsServerIds:[bi.CHOOSE_SERVER].toString(),isHttp3:f}),!1),y=>y.code!==k.OPERATION_ABORTED&&(y.code===k.CAN_NOT_GET_GATEWAY_SERVER?y.data.retry:(Te.joinChooseServer(i.sid,{lts:h,succ:!1,csAddr:l,serverList:null,opid:g,ec:y.code,csIp:y.data&&y.data.csIp,unilbsServerIds:[bi.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:E}),isHttp3:f}),R.warning("[".concat(i.clientId,"] Choose server network error, retry"),y),!0)),a)}function c2(s,i,r,a){let l,{url:d,areaCode:h,serviceIds:f}=s;const m=Date.now(),[g,E]=l2(i,h,f);let y;return Ss(x(function*(){y&&Hn.networkState===yn.OFFLINE&&Hn.onlineWaiter&&(yield q.race([Hn.onlineWaiter,si(a&&a.maxRetryTimeout||Wn.maxRetryTimeout)])),y=Hn.networkState;const{data:C,headers:b}=yield Kc(d,{data:g,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l="1"===b.http3?1:-1,Te.reportResourceTiming(d,i.sid),YO(C,d,i,m,f,l);const O=Au(C,bi.CHOOSE_SERVER),P=Au(C,"proxy5"===i.cloudProxyServer?bi.CLOUD_PROXY_5:"proxy3"===i.cloudProxyServer||"proxy4"===i.cloudProxyServer?bi.CLOUD_PROXY:bi.CLOUD_PROXY_FALLBACK);return $O(O),{gatewayInfo:hb(O,d),proxyInfo:P,url:d}}),C=>(C.gatewayInfo&&Te.joinChooseServer(i.sid,{lts:m,succ:!0,csAddr:d,serverList:C.gatewayInfo.gatewayAddrs.map(b=>b.address),ec:null,opid:E,cid:C.gatewayInfo.cid.toString(),uid:C.gatewayInfo.uid.toString(),csIp:C.gatewayInfo.csIp,unilbsServerIds:f.toString(),isHttp3:l}),C.proxyInfo&&Te.joinWebProxyAP(i.sid,{lts:m,sucess:1,apServerAddr:d,turnServerAddrList:C.proxyInfo.addresses.map(b=>b.ip).join(","),errorCode:null,eventType:i.cloudProxyServer,unilbsServerIds:f.toString()}),!1),C=>C.code!==k.OPERATION_ABORTED&&(C.code===k.CAN_NOT_GET_GATEWAY_SERVER?C.data.retry:(Te.joinWebProxyAP(i.sid,{lts:m,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:C.code,eventType:i.cloudProxyServer,unilbsServerIds:f.toString(),extend:JSON.stringify({networkState:y})}),R.warning("[".concat(i.clientId,"] multi unilbs network error, retry"),C),!0)),a)}const YO=(s,i,r,a,l,d)=>{const h=[],f=m=>{4096===m.flag?Te.joinChooseServer(r.sid,{lts:a,succ:!1,csAddr:i,opid:s.opid,serverList:null,ec:m.error.message,csIp:m.error.data&&m.error.data.csIp,unilbsServerIds:l.toString(),isHttp3:d}):1048576!==m.flag&&4194304!==m.flag&&4194310!==m.flag||Te.joinWebProxyAP(r.sid,{lts:a,sucess:0,apServerAddr:i,turnServerAddrList:null,errorCode:m.error.code,eventType:r.cloudProxyServer,unilbsServerIds:l.toString()})};if(s.response_body.forEach(m=>{const g=m.buffer.code;if(23===m.uri&&0===g&&!m.buffer.edges_services)if(4194310===m.buffer.flag)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),m.buffer.edges_services=[];else{const E={error:new K(k.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:s.detail[502]}),flag:m.buffer.flag};h.push(E),f(E)}if(0!==g){const E=TE(g),y={error:new K(k.CAN_NOT_GET_GATEWAY_SERVER,E.desc,{desc:E.desc,retry:E.retry,csIp:s.detail[502]}),flag:m.buffer.flag};4194310===m.buffer.flag?R.warning(y.error.toString()):h.push(y),f(y)}}),h.length)throw R.warning("[".concat(r.clientId,"] multi unilbs ").concat(i," failed, ").concat(h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message,", retry: ").concat(m.error.data.retry)).join(" | "))),new K(k.CAN_NOT_GET_GATEWAY_SERVER,h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message)).join(" | "),{retry:!!h.find(m=>m.error.data.retry),csIp:s.detail[502],desc:[...new Set(h.map(m=>{var g;return null==m||null===(g=m.error)||void 0===g||null===(g=g.data)||void 0===g?void 0:g.desc}).filter(m=>!!m))]})},$O=s=>{var i,r,a,l;if(s.addresses&&0===s.addresses.length&&0===s.code)throw new K(k.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:s.detail&&s.detail[502]});if(H("AP_AREA")&&(null!==(a=s.detail)&&void 0!==a&&a[23]&&"string"==typeof(null===(l=s.detail)||void 0===l?void 0:l[23])?yb(s.detail[23].toLowerCase()):yb()),null!==(i=s.detail)&&void 0!==i&&i[19]&&"string"==typeof(null===(r=s.detail)||void 0===r?void 0:r[19])){const h=s.detail[19],f=null==h?void 0:h.split(";");for(let m=0;m<f.length;m++){var d;const g=_T(d=f[m]).call(d);s.addresses[m]&&f&&(s.addresses[m].fingerprint=g)}}if(H("GATEWAY_ADDRESS")&&H("GATEWAY_ADDRESS").length>0){R.debug("assign gateway address to",H("GATEWAY_ADDRESS"));const h=H("GATEWAY_ADDRESS").map(f=>{var m,g;const E=null!==(m=null===(g=s.addresses.find(y=>y.ip===f.ip&&y.port===f.port))||void 0===g?void 0:g.fingerprint)&&void 0!==m?m:"";return{ip:f.ip,port:f.port,ticket:s.addresses[0]&&s.addresses[0].ticket,fingerprint:E}});s.addresses=h}},S3=(s,i)=>{if(s.response_body&&s.response_body.length){const r=s.response_body[0];if(0!==r.buffer.code){const a=TE(r.buffer.code);throw new K(k.UPDATE_TICKET_FAILED,"[".concat(r.buffer.code,"]: ").concat(a.desc),{retry:a.retry})}return r.buffer.ticket}throw R.debug("update ticket request received ap response without response body:",i),new K(k.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},l2=(s,i,r)=>{const a=Math.floor(Math.random()*10**12),l={appid:s.appId,client_ts:Date.now(),opid:a,sid:s.sid,request_bodies:[{uri:22,buffer:{cname:s.cname,detail:vb({6:s.stringUid,11:i,12:H("USE_NEW_TOKEN")?"1":void 0,22:i},H("AP_RTM")?{26:"RTM2"}:{}),key:s.token,service_ids:r,uid:s.uid||0}}]};l.request_bodies.forEach(h=>{s.multiIP&&s.multiIP.gateway_ip&&(h.buffer.detail[5]=JSON.stringify({vocs_ip:[s.multiIP.uni_lbs_ip],vos_ip:[s.multiIP.gateway_ip]}))});const d=new FormData;return d.append("request",JSON.stringify(l)),[d,a]},T3=(s,i)=>{const r=Math.floor(Math.random()*10**12),a={appid:s.appId,client_ts:Date.now(),opid:r,sid:s.sid,request_bodies:[{uri:28,buffer:{cname:s.cname,detail:{1:"",6:s.stringUid,12:"1"},token:s.token,service_ids:i,uid:s.uid||0,edges_services:s.apResponse.addresses.map(d=>({ip:d.ip,port:d.port}))}}]},l=new FormData;return l.append("request",JSON.stringify(a)),[l,r]};let K_=0;function mp(s){return q.all(s.map(i=>i.then(r=>{throw r},r=>r))).then(i=>{throw i},i=>i)}const cy=function(){var s=x(function*(i){let{fragementLength:r,referenceList:a,asyncMapHandler:l,allFailedhandler:d,promisesCollector:h}=i,f=0;const m=r;let g,E=0;const y=function(){var C=x(function*(){const b=(()=>{const O=f*m;return a.slice(O,O+m).map(l)})();h&&h.push(...b);try{g=yield mp(b)}catch(O){if(E+=m,f++,!(E>=a.length))return void(yield y());d(O)}b.forEach(O=>O.cancel())});return function(){return C.apply(this,arguments)}}();return yield y(),g});return function(r){return s.apply(this,arguments)}}();function JO(s,i,r,a){return XO.apply(this,arguments)}function XO(){return XO=x(function*(s,i,r,a){return{gatewayInfo:yield(d=x(function*(h,f,m,g){let E=null;const y=[],C=function(){var O=x(function*(){const P=H("WEBCS_DOMAIN").slice(0,H("AJAX_REQUEST_CONCURRENT")).map(B=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(B+"/api/v2/transpond/webrtc?v=2"):"https://".concat(B,"/api/v2/transpond/webrtc?v=2"),areaCode:G_()})),D=g.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(B=>B.url)}),L=yield cy({fragementLength:H("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:B=>(R.debug("[".concat(h.clientId,"] Connect to choose_server:"),B.url),a2(B,h,f,m)),allFailedhandler:B=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},D),B[0]},promisesCollector:y});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},D),L});return function(){return O.apply(this,arguments)}}(),b=function(){var O=x(function*(){if(yield si(1e3),null!==E)return E;const P=H("WEBCS_DOMAIN_BACKUP_LIST").map(B=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(B+"/api/v2/transpond/webrtc?v=2"):"https://".concat(B,"/api/v2/transpond/webrtc?v=2"),areaCode:G_()})),D=g.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(B=>B.url)}),L=yield cy({fragementLength:H("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:B=>(R.debug("[".concat(h.clientId,"] Connect to backup choose_server:"),B.url),a2(B,h,f,m)),allFailedhandler:B=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},D),B[0]},promisesCollector:y});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},D),L});return function(){return O.apply(this,arguments)}}();try{return E=yield mp([C(),b()]),y.length&&y.forEach(O=>O.cancel&&"function"==typeof O.cancel&&O.cancel()),E}catch(O){throw O[0]}}),function(h,f,m,g){return d.apply(this,arguments)})(s,i,r,a)};var d}),XO.apply(this,arguments)}function d2(s,i,r,a,l){return gp.apply(this,arguments)}function gp(){return gp=x(function*(s,i,r,a,l){const d=s.cloudProxyServer;if("disabled"===d){if(!a)return;if(s.useLocalAccessPoint)return yield JO(s,i,r,l);if(H("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:g,proxyInfo:E}=yield Je(s,i,r,l);return s.turnServer&&"auto"!==s.turnServer.mode||(s.turnServer={mode:"manual",servers:E.map(y=>({turnServerURL:y.address,tcpport:y.tcpport||on.tcpport,udpport:y.udpport||on.udpport,username:y.username||on.username,password:y.password||on.password,forceturn:!1,security:!0}))}),{gatewayInfo:g}}return yield JO(s,i,r,l)}const{proxyInfo:h,gatewayInfo:f}=yield Je(s,i,r,l),m={gatewayInfo:f};return s.turnServer={mode:"manual",servers:h.map(g=>({turnServerURL:g.address,tcpport:"proxy3"===d?void 0:g.tcpport?g.tcpport:on.tcpport,udpport:"proxy4"===d?void 0:g.udpport?g.udpport:on.udpport,username:g.username||on.username,password:g.password||on.password,forceturn:"proxy4"!==d,security:"proxy5"===d}))},R.debug("[".concat(s.clientId,"] set proxy server: ").concat(s.proxyServer,", mode: ").concat(d)),m}),gp.apply(this,arguments)}function Ea(s,i,r,a,l){return QO.apply(this,arguments)}function QO(){return QO=x(function*(s,i,r,a,l){let h=[];h=H("ACCOUNT_REGISTER").slice(0,H("AJAX_REQUEST_CONCURRENT")).map(i.proxyServer?m=>"https://".concat(i.proxyServer,"/ap/?url=").concat(m+"/api/v1"):m=>"https://".concat(m,"/api/v1"));const f=null==l?void 0:l.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const m=yield(g=x(function*(E,y,C,b,O){const P=Date.now(),D={sid:C.sid,opid:10,appid:C.appId,string_uid:y};let L=E[0];const B=yield Ss(()=>Kc(L+"".concat(-1===L.indexOf("?")?"?":"&","action=stringuid"),{data:D,cancelToken:b,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(V,J)=>{if(0===V.code){if(V.uid<=0||V.uid>=Math.pow(2,32))throw R.error("Invalid Uint Uid ".concat(y," => ").concat(V.uid),V),Te.reqUserAccount(D.sid,{lts:P,success:!1,serverAddr:L,stringUid:D.string_uid,uid:V.uid,errorCode:k.INVALID_UINT_UID_FROM_STRING_UID,extend:D}),new K(k.INVALID_UINT_UID_FROM_STRING_UID);return Te.reqUserAccount(D.sid,{lts:P,success:!0,serverAddr:L,stringUid:D.string_uid,uid:V.uid,errorCode:null,extend:D}),!1}const ae=TE(V.code);return ae.retry&&(L=E[(J+1)%E.length]),Te.reqUserAccount(D.sid,{lts:P,success:!1,serverAddr:L,stringUid:D.string_uid,uid:V.uid,errorCode:ae.desc,extend:D}),ae.retry},(V,J)=>V.code!==k.OPERATION_ABORTED&&(Te.reqUserAccount(D.sid,{lts:P,success:!1,serverAddr:L,stringUid:D.string_uid,uid:null,errorCode:V.code,extend:D}),L=E[(J+1)%E.length],!0),O);if(0!==B.code){const V=TE(B.code);throw new K(k.UNEXPECTED_RESPONSE,V.desc)}return B}),function(E,y,C,b,O){return g.apply(this,arguments)})(h,s,i,r,a);return null==l||l.recordJoinChannelService({status:"success",endTs:Date.now()},f),m.uid}catch(m){throw null==l||l.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[m]},f),m}var g}),QO.apply(this,arguments)}function Sb(){return Sb=x(function*(s,i,r){const a=H("CDS_AP").slice(0,H("AJAX_REQUEST_CONCURRENT")).map(f=>s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(f+"/api/v1"):"https://".concat(f,"/api/v1?action=config")).map(f=>function(m,g,E,y){const C=pt(),b={flag:64,cipher_method:0,features:{device:C.name,system:C.os,system_general:navigator.userAgent,vendor:g.appId,version:yo,cname:g.cname,sid:g.sid,session_id:g.sid,detail:"",proxyServer:g.proxyServer}};return Ss(()=>Kc(m,{data:b,timeout:1e3,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,O=>O.code!==k.OPERATION_ABORTED,y)}(f,s,i,r));let l=null,d=null,h={};try{l=yield mp(a)}catch(f){if(f.code===k.OPERATION_ABORTED)throw f;d=f}if(a.forEach(f=>f.cancel()),Te.reportApiInvoke(s.sid,{name:jn.REQUEST_CONFIG_DISTRIBUTE,options:{error:d,res:l}}).onSuccess(),l&&l.test_tags)try{h=function(f){if(!f.test_tags)return{};const m=f.test_tags,g=Object.keys(m),E={};return g.forEach(y=>{var C;const b=_T(C=y.slice(4)).call(C),O=JSON.parse(m[y])[1];E[b]=O}),E}(l)}catch(f){}return h}),Sb.apply(this,arguments)}function Je(s,i,r,a){return zc.apply(this,arguments)}function zc(){return zc=x(function*(s,i,r,a){const l=H("PROXY_SERVER_TYPE3"),d=(b,O,P)=>{let D=P||l;return Array.isArray(D)&&(D=O%2==0?l[1]:l[0]),"https://".concat(D,"/ap/?url=").concat(b)};let h=null;const f=[],m=function(){var b=x(function*(){const O=H("WEBCS_DOMAIN").slice(0,H("AJAX_REQUEST_CONCURRENT")).map((L,B)=>{let V;return V="disabled"===s.cloudProxyServer&&s.proxyServer?d("".concat(L,"/api/v2/transpond/webrtc?v=2"),B,s.proxyServer):"disabled"===s.cloudProxyServer||"fallback"===s.cloudProxyServer?"https://".concat(L,"/api/v2/transpond/webrtc?v=2"):d("".concat(L,"/api/v2/transpond/webrtc?v=2"),B),{url:V,areaCode:G_(),serviceIds:[bi.CHOOSE_SERVER,"proxy5"===s.cloudProxyServer?bi.CLOUD_PROXY_5:"proxy3"===s.cloudProxyServer||"proxy4"===s.cloudProxyServer?bi.CLOUD_PROXY:bi.CLOUD_PROXY_FALLBACK]}}),P=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(L=>L.url)}),D=yield cy({fragementLength:H("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:L=>(R.debug("[".concat(s.clientId,"] Connect to choose_server:"),L.url),c2(L,s,i,r)),allFailedhandler:L=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:L},P),L[0]},promisesCollector:f});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},P),D});return function(){return b.apply(this,arguments)}}(),g=function(){var b=x(function*(){if(yield si(1e3),null!==h)return h;const O=H("WEBCS_DOMAIN_BACKUP_LIST").map((L,B)=>{let V;return V="disabled"===s.cloudProxyServer&&s.proxyServer?d("".concat(L,"/api/v2/transpond/webrtc?v=2"),B,s.proxyServer):"disabled"===s.cloudProxyServer||"fallback"===s.cloudProxyServer?"https://".concat(L,"/api/v2/transpond/webrtc?v=2"):d("".concat(L,"/api/v2/transpond/webrtc?v=2"),B),{url:V,areaCode:G_(),serviceIds:[bi.CHOOSE_SERVER,"proxy5"===s.cloudProxyServer?bi.CLOUD_PROXY_5:"proxy3"===s.cloudProxyServer||"proxy4"===s.cloudProxyServer?bi.CLOUD_PROXY:bi.CLOUD_PROXY_FALLBACK]}}),P=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(L=>L.url)}),D=yield cy({fragementLength:H("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:L=>(R.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),L.url),c2(L,s,i,r)),allFailedhandler:L=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:L},P),L[0]},promisesCollector:f});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},P),D});return function(){return b.apply(this,arguments)}}();let E,y,C;try{({gatewayInfo:E,proxyInfo:y,url:C}=yield mp([m(),g()]))}catch(b){throw b[0]}if(f.length&&f.forEach(b=>b.cancel&&"function"==typeof b.cancel&&b.cancel()),!E||!y)throw new K(k.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(s.apUrl=C,"disabled"!==s.cloudProxyServer&&Array.isArray(l)&&C){const b=/^https?:\/\/(.+?)(\/.*)?$/.exec(C)[1];we(l).call(l,b)&&(s.proxyServer=b,R.setProxyServer(b),Te.setProxyServer(b))}return h={gatewayInfo:E,proxyInfo:yield pb(y,E.uid)},h}),zc.apply(this,arguments)}function ZO(s,i,r,a){return Tb.apply(this,arguments)}function Tb(){return Tb=x(function*(s,i,r,a){const l=H("UAP_AP").slice(0,H("AJAX_REQUEST_CONCURRENT")).map(d=>i.proxyServer?"https://".concat(i.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap"));return yield C3(l,s,i,r,a)}),Tb.apply(this,arguments)}function ly(){return ly=x(function*(s,i,r){const a=H("UAP_AP").slice(0,H("AJAX_REQUEST_CONCURRENT")).map(l=>s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(l+"/api/v1?action=uap"):"https://".concat(l,"/api/v1?action=uap")).map(l=>function(d,h,f,m){const g={command:"convergeAllocateEdge",sid:h.sid,appId:h.appId,token:h.token,ts:Date.now(),version:yo,cname:h.cname,uid:h.uid.toString(),requestId:zO,seq:zO};zO+=1;const E={service_name:"tele_channel",json_body:JSON.stringify(g)};return Ss(x(function*(){const y=yield Kc(d,{data:E,cancelToken:f,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==y.code){const b=new K(k.UNEXPECTED_RESPONSE,"cross channel ap error, code"+y.code,{retry:!0});throw R.error(b.toString()),b}const C=JSON.parse(y.json_body);if(200!==C.code){const b=new K(k.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(C.code,", reason: ").concat(C.reason));throw R.error(b.toString()),b}if(!C.servers||0===C.servers.length){const b=new K(k.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw R.error(b.toString()),b}return{vid:C.vid,workerToken:C.workerToken,addressList:(H("CHANNEL_MEDIA_RELAY_SERVERS")||C.servers).map(b=>"wss://".concat(b.address.replace(/\./g,"-"),".").concat(H("WORKER_DOMAIN"),":").concat(b.wss))}}),void 0,y=>!!(y.code!==k.OPERATION_ABORTED&&y.code!==k.UNEXPECTED_RESPONSE||y.data&&y.data.retry),m)}(l,s,i,r));try{const l=yield mp(a);return a.forEach(d=>d.cancel()),l}catch(l){throw l[0]}}),ly.apply(this,arguments)}function q_(){return q_=x(function*(s,i,r){let a=null;const l=[],d=function(){var h=x(function*(f){const m=H(f?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(g=>s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(g+"/api/v2/transpond/webrtc?v=2"):"https://".concat(g,"/api/v2/transpond/webrtc?v=2"));return f&&(yield si(1e3),null!==a)?a:yield cy({fragementLength:H("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:g=>(R.debug("[".concat(s.clientId,"] update ticket, Connect to ").concat(f?"backup":""," choose_server:"),g),function(E,y,C,b){const[O]=T3(y,[bi.CHOOSE_SERVER]);let P=Hn.networkState;return Ss(x(function*(){P&&Hn.networkState===yn.OFFLINE&&Hn.onlineWaiter&&(yield q.race([Hn.onlineWaiter,si(b&&b.maxRetryTimeout||Wn.maxRetryTimeout)])),P=Hn.networkState;const D=yield Kc(E,{data:O,cancelToken:C,headers:{"Content-Type":"multipart/form-data;"}},!0);return S3(D,E)}),()=>!1,D=>D.code!==k.OPERATION_ABORTED&&(D.code===k.UPDATE_TICKET_FAILED?D.data.retry:(R.warning("[".concat(y.clientId,"] update ticket network error, retry"),D),!0)),b)}(g,s,i,r)),allFailedhandler:g=>{throw g[0]},promisesCollector:l})});return function(m){return h.apply(this,arguments)}}();try{return a=yield mp([d(!1),d(!0)]),l.length&&l.forEach(h=>h.cancel&&"function"==typeof h.cancel&&h.cancel()),a}catch(h){throw h[0]}}),q_.apply(this,arguments)}function bb(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Ya(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?bb(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):bb(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class Ep extends nn{constructor(){super(),T(this,"configs",void 0),T(this,"joinInfo",void 0),T(this,"cancelToken",void 0),T(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),T(this,"interval",void 0),T(this,"mutex",new Gn("config-distribute")),T(this,"mutableParamsRead",!1)}startGetConfigDistribute(i,r){this.joinInfo=i,this.cancelToken=r,this.interval&&this.stopGetConfigDistribute(),H("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},H("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}awaitConfigDistributeComplete(){var i=this;return x(function*(){!i.mutex.isLocked||(yield i.mutex.lock())()})()}updateConfigDistribute(){var i=this;return x(function*(){if(i.mutableParamsRead||(i.mutableParamsRead=!0,Te.reportApiInvoke(null,{options:void 0,name:jn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Kt.TRACER}).onSuccess(JSON.stringify(Dc))),!i.joinInfo||!i.cancelToken||!i.retryConfig)return void R.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const a=yield i.mutex.lock();try{r=yield function(s,i,r){return Sb.apply(this,arguments)}(i.joinInfo,i.cancelToken,i.retryConfig),R.debug("[config-distribute] get config distribute",JSON.stringify(r)),r.limit_bitrate&&i.handleBitrateLimit(r.limit_bitrate),i.cacheGlobalParameterConfig(r),i.configs=r}catch(l){const d=new K(k.NETWORK_RESPONSE_ERROR,l);R.warning("[config-distribute] ".concat(d.toString()))}finally{a()}})()}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(i){var r;(r=i)&&r.uplink&&r.id&&void 0!==r.uplink.max_bitrate&&void 0!==r.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==i.id&&this.emit(v_.UPDATE_BITRATE_LIMIT,i):this.emit(v_.UPDATE_BITRATE_LIMIT,i))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&Ya({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(i){var r;const a=Bf(r=Object.keys(i).filter(d=>/^webrtc_ng_global_parameter/.test(d))).call(r);for(let d=0;d<a.length;d++)for(let h=a.length-1;h>d;h--){const f=a[h];if("number"==typeof i[f].__priority){const m=i[f].__priority,g=a[h-1];if("number"==typeof i[g].__priority){if(!(m>i[g].__priority))continue;{const E=f;a[h]=a[h-1],a[h-1]=E}}else{const E=f;a[h]=a[h-1],a[h-1]=E}}}const l={};a.forEach(d=>{const h=i[d],f=h.__expires;Object.keys(h).forEach(m=>{"__priority"===m||"__expires"===m||Object.prototype.hasOwnProperty.call(l,m)||(l[m]=Ya({value:h[m]},f&&{expires:f}))})});try{!function(f){try{const m=Date.now();Object.keys(f).forEach(g=>{switch(g){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":if(Object.prototype.hasOwnProperty.call(ir,g)){const{value:E,expires:y}=f[g];if(y&&y<=m)return;Dc[g]=E,ir[g]=E,R.debug("Update global parameters from config distribute",g,E)}}})}catch(m){R.error("Error update config immediately: ".concat(f),m.message)}}(l);const d=JSON.stringify(l),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),R.debug("Caching global parameters ".concat(d))}catch(d){R.error("Error caching global parameters:",d.message)}}}function tN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Du(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?tN(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):tN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class nN extends nn{constructor(i,r,a,l){super(),T(this,"spec",void 0),T(this,"token",void 0),T(this,"websocket",void 0),T(this,"pingpongTimer",void 0),T(this,"reconnectMode","retry"),T(this,"serviceMode",void 0),T(this,"reqId",0),T(this,"commandReqId",0),T(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),T(this,"handleWebSocketMessage",d=>{if(!d.data)return;const h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):this.serviceMode===Zn.INJECT?this.emit(As.INJECT_STREAM_STATUS,h):(Te.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===Zn.TRANSCODE?1:2}),this.emit(As.PUBLISH_STREAM_STATUS,h))}),this.spec=r,this.token=i,this.serviceMode=l,this.websocket=new T_("live-streaming",a),this.websocket.on(Ne.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Ne.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Ne.REQUEST_NEW_URLS,(d,h)=>{vn(this,As.REQUEST_NEW_ADDRESS).then(d).catch(h)}),this.websocket.on(Ne.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(i){return this.websocket.init(i)}request(i,r,a,l){var d=this;return x(function*(){d.reqId+=1,"request"===i&&(d.commandReqId+=1);const h=d.commandReqId,f=d.reqId;if(!f||!d.websocket)throw new K(k.UNEXPECTED_ERROR);const m=Du({command:i,sdkVersion:"4.19.1"===yo?"0.0.1":yo,seq:f,requestId:f,allocate:a,cname:d.spec.cname,appId:d.spec.appId,sid:d.spec.sid,uid:d.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},r);if("closed"===d.websocket.state)throw new K(k.WS_DISCONNECT);const g=()=>new q((b,O)=>{d.websocket.once(Ne.CLOSED,()=>O(new K(k.WS_ABORT))),d.websocket.once(Ne.CONNECTED,b)});"connected"!==d.websocket.state&&(yield g()),m.clientRequest&&(m.clientRequest.workerToken=d.token);const E=new q((b,O)=>{const P=()=>{O(new K(k.WS_ABORT))};d.websocket.once(Ne.RECONNECTING,P),d.websocket.once(Ne.CLOSED,P),d.once("@".concat(f,"-").concat(d.spec.sid),D=>{b(D)})});l&&Te.workerEvent(d.spec.sid,Du(Du({},l),{},{requestId:h,actionType:"request",payload:JSON.stringify(r.clientRequest),serverCode:0,code:0}));const y=Date.now();d.websocket.sendMessage(m);let C=null;try{C=yield E}catch(b){if("closed"===d.websocket.state)throw b;return yield g(),yield d.request(i,r,a)}return l&&Te.workerEvent(d.spec.sid,Du(Du({},l),{},{requestId:h,actionType:"response",payload:JSON.stringify(C.serverResponse),serverCode:C.code,success:200===C.code,responseTime:Date.now()-y})),200!==C.code&&d.handleResponseError(C),C})()}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const i="4.19.1"===yo?"0.0.1":yo;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:i,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(i){switch(i.code){case xn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void R.warning("live stream response already exists stream");case xn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case xn.LIVE_STREAM_RESPONSE_BAD_STREAM:case xn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new K(k.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:i.code}).throw();case xn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===i.serverResponse.command||"UninjectStream"===i.serverResponse.command)return;throw new K(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case xn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new K(k.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:i.code}).throw();case xn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const r=new K(k.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(As.WARNING,r,i.serverResponse.url)}case xn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const r=new K(k.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(As.WARNING,r,i.serverResponse.url)}case xn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new K(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case xn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new K(k.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:i.code}).throw();case xn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const r=new K(k.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(As.WARNING,r,i.serverResponse.url)}case xn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new K(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:i.code}).throw();case xn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new K(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case xn.LIVE_STREAM_RESPONSE_WORKER_LOST:case xn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===i.serverResponse.command||"UninjectStream"===i.serverResponse.command)return;throw new K(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case xn.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===i.serverResponse.command||"UninjectStream"===i.serverResponse.command)return;if("UpdateTranscoding"===i.serverResponse.command||"ControlStream"===i.serverResponse.command)return new K(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:i.code}).throw();throw new K(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case xn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case xn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case xn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case xn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new K(k.LIVE_STREAMING_CDN_ERROR,"",{code:i.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(Qg)},6e3)}}function iN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Bi(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?iN(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):iN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class p2 extends nn{constructor(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Wn,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Wn;super(),T(this,"onLiveStreamWarning",void 0),T(this,"onLiveStreamError",void 0),T(this,"onInjectStatusChange",void 0),T(this,"spec",void 0),T(this,"retryTimeout",1e4),T(this,"connection",void 0),T(this,"httpRetryConfig",void 0),T(this,"wsRetryConfig",void 0),T(this,"streamingTasks",new Map),T(this,"isStartingStreamingTask",!1),T(this,"taskMutex",new Gn("live-streaming")),T(this,"cancelToken",Gr.CancelToken.source()),T(this,"transcodingConfig",void 0),T(this,"injectConfig",Bi({},$L)),T(this,"injectLoopTimes",0),T(this,"uapResponse",void 0),T(this,"lastTaskId",1),T(this,"statusError",new Map),this.spec=i,this.httpRetryConfig=a,this.wsRetryConfig=r}setTranscodingConfig(i){var r=this;return x(function*(){const a=Bi(Bi({},Wr),i);var f;66!==a.videoCodecProfile&&77!==a.videoCodecProfile&&100!==a.videoCodecProfile&&(R.debug("[".concat(r.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(a.videoCodecProfile," -> 100")),a.videoCodecProfile=100),a.transcodingUsers||(a.transcodingUsers=a.userConfigs),a.transcodingUsers&&(a.transcodingUsers=a.transcodingUsers.map(f=>Bi(Bi(Bi({},r3),f),{},{zOrder:f.zOrder?f.zOrder+1:1}))),En((f=a).width)||Ut(f.width,"config.width",0,1e4),En(f.height)||Ut(f.height,"config.height",0,1e4),En(f.videoBitrate)||Ut(f.videoBitrate,"config.videoBitrate",1,1e6),En(f.videoFrameRate)||Ut(f.videoFrameRate,"config.videoFrameRate"),En(f.lowLatency)||$d(f.lowLatency,"config.lowLatency"),En(f.audioSampleRate)||pi(f.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),En(f.audioBitrate)||Ut(f.audioBitrate,"config.audioBitrate",1,128),En(f.audioChannels)||pi(f.audioChannels,"config.audioChannels",[1,2,3,4,5]),En(f.videoGop)||Ut(f.videoGop,"config.videoGop"),En(f.videoCodecProfile)||pi(f.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),En(f.userCount)||Ut(f.userCount,"config.userCount",0,17),En(f.backgroundColor)||Ut(f.backgroundColor,"config.backgroundColor",0,16777215),En(f.userConfigExtraInfo)||Vi(f.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),f.transcodingUsers&&!En(f.transcodingUsers)&&(Ic(f.transcodingUsers,"config.transcodingUsers"),f.transcodingUsers.forEach((m,g)=>{rT(m.uid),En(m.x)||Ut(m.x,"transcodingUser[".concat(g,"].x"),0,1e4),En(m.y)||Ut(m.y,"transcodingUser[".concat(g,"].y"),0,1e4),En(m.width)||Ut(m.width,"transcodingUser[".concat(g,"].width"),0,1e4),En(m.height)||Ut(m.height,"transcodingUser[".concat(g,"].height"),0,1e4),En(m.zOrder)||Ut(m.zOrder-1,"transcodingUser[".concat(g,"].zOrder"),0,100),En(m.alpha)||Ut(m.alpha,"transcodingUser[".concat(g,"].alpha"),0,1,!1)})),En(f.watermark)||oT(f.watermark,"watermark"),En(f.backgroundImage)||oT(f.backgroundImage,"backgroundImage"),f.images&&!En(f.images)&&(Ic(f.images,"config.images"),f.images.forEach((m,g)=>{oT(m,"images[".concat(g,"]"))}));const l=[];a.images&&l.push(...a.images.map(f=>Bi(Bi(Bi({},wD),f),{},{zOrder:255}))),a.backgroundImage&&(l.push(Bi(Bi(Bi({},wD),a.backgroundImage),{},{zOrder:0})),delete a.backgroundImage),a.watermark&&(l.push(Bi(Bi(Bi({},wD),a.watermark),{},{zOrder:255})),delete a.watermark),a.images=l,a.transcodingUsers&&(a.userConfigs=a.transcodingUsers.map(f=>Bi({},f)),a.userCount=a.transcodingUsers.length,delete a.transcodingUsers);const d=(a.userConfigs||[]).map(f=>"number"==typeof f.uid?q.resolve(f.uid):Ea(f.uid,r.spec,r.cancelToken.token,r.httpRetryConfig));if((yield q.all(d)).forEach((f,m)=>{a.userConfigs&&a.userConfigs[m]&&(a.userConfigs[m].uid=f)}),r.transcodingConfig=a,r.connection)try{var h;const f=yield r.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:r.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Ze(h=r.streamingTasks).call(h)).map(m=>m.taskId).join("#")});R.debug("[".concat(r.spec.clientId,"] update live transcoding config success, code: ").concat(f.code,", config:"),JSON.stringify(r.transcodingConfig))}catch(f){if(!f.data||!f.data.retry)throw f;f.data.changeAddress&&r.connection.tryNextAddress(),r.streamingTasks.forEach(m=>{R.warning("[".concat(r.spec.clientId,"] live streaming receive error"),f.toString(),"try to republish",m.url),r.startLiveStreamingTask(m.url,m.mode,f).then(()=>{R.debug("[".concat(r.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(g=>{R.error("[".concat(r.spec.clientId,"] live streaming republish failed"),m.url,g.toString()),r.onLiveStreamError&&r.onLiveStreamError(m.url,g)})})}})()}setInjectStreamConfig(i,r){this.injectConfig=Object.assign({},this.injectConfig,i),this.injectLoopTimes=r}startLiveStreamingTask(i,r,a){var l=this;return x(function*(){var d;if(Array.from(Ze(d=l.streamingTasks).call(d)).find(g=>g.mode===Zn.INJECT)&&r===Zn.INJECT)return new K(k.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!l.transcodingConfig&&r===Zn.TRANSCODE)throw new K(k.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let h={command:"PublishStream",ts:Date.now(),url:i,uid:l.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};R.debug("[".concat(l.spec.clientId,"] start live streaming ").concat(i,", mode: ").concat(r));const f=yield l.taskMutex.lock();if(!l.connection&&a)return void f();if(l.streamingTasks.get(i)&&!a)return f(),new K(k.LIVE_STREAMING_TASK_CONFLICT).throw();try{l.connection||(l.connection=yield l.connect(r))}catch(g){throw f(),g}switch(r){case Zn.TRANSCODE:h.transcodingConfig=Bi({},l.transcodingConfig);break;case Zn.RAW:break;case Zn.INJECT:h={cname:l.spec.cname,command:"InjectStream",sid:l.spec.sid,transcodingConfig:l.injectConfig,ts:Date.now(),url:i,loopTimes:l.injectLoopTimes}}l.uapResponse&&l.uapResponse.vid&&(h.vid=l.uapResponse.vid),l.isStartingStreamingTask=!0;const m=l.lastTaskId++;try{const g=new q((y,C)=>{si(l.retryTimeout).then(()=>{if(a)return C(a);const b=l.statusError.get(i);return b?(l.statusError.delete(i),C(b)):void 0})}),E=yield q.race([l.connection.request("request",{clientRequest:h},!0,{url:i,command:"PublishStream",workerType:r===Zn.TRANSCODE?1:2,requestByUser:!a,tid:m.toString()}),g]);l.isStartingStreamingTask=!1,R.debug("[".concat(l.spec.clientId,"] live streaming started, code: ").concat(E.code)),l.streamingTasks.set(i,{clientRequest:h,mode:r,url:i,taskId:m}),f()}catch(g){if(f(),l.isStartingStreamingTask=!1,!g.data||!g.data.retry||a)throw g;return g.data.changeAddress?(l.connection.tryNextAddress(),yield l.startLiveStreamingTask(i,r,g)):yield l.startLiveStreamingTask(i,r,g)}})()}stopLiveStreamingTask(i){return new q((r,a)=>{const l=this.streamingTasks.get(i);if(!l||!this.connection)return new K(k.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=l.mode;l.abortTask=()=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(i),r()},this.connection.request("request",{clientRequest:{command:d===Zn.INJECT?"UninjectStream":"UnpublishStream",url:l.url}},!1,{url:i,command:"UnPublishStream",workerType:d===Zn.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(i),0===this.streamingTasks.size&&d!==Zn.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),r(),d===Zn.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(Pc.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,i)}).catch(a)})}controlInjectStream(i,r,a,l){var d=this;return x(function*(){const h=d.streamingTasks.get(i);if(!h||!d.connection||h.mode!==Zn.INJECT)throw new K(k.INVALID_OPERATION,"can not find inject stream task to control");return(yield d.connection.request("request",{clientRequest:{command:"ControlStream",url:i,control:r,audioVolume:a,position:l}})).serverResponse})()}resetAllTask(){var i;const r=Array.from(Ze(i=this.streamingTasks).call(i));this.terminate();for(const a of r)this.startLiveStreamingTask(a.url,a.mode).catch(l=>{this.onLiveStreamError&&this.onLiveStreamError(a.url,l)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Gr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}connect(i){var r=this;return x(function*(){if(r.connection)throw new K(k.UNEXPECTED_ERROR,"live streaming connection has already connected");const a=yield vn(r,Ml.REQUEST_WORKER_MANAGER_LIST,i);return r.uapResponse=a,r.connection=new nN(a.workerToken,r.spec,r.wsRetryConfig,i),r.connection.on(As.WARNING,(l,d)=>r.onLiveStreamWarning&&r.onLiveStreamWarning(d,l)),r.connection.on(As.PUBLISH_STREAM_STATUS,l=>r.handlePublishStreamServer(l)),r.connection.on(As.INJECT_STREAM_STATUS,l=>r.handleInjectStreamServerStatus(l)),r.connection.on(As.REQUEST_NEW_ADDRESS,(l,d)=>{if(!r.connection)return d(new K(k.UNEXPECTED_ERROR,"can not get new live streaming address list"));vn(r,Ml.REQUEST_WORKER_MANAGER_LIST,i).then(h=>{r.uapResponse=h,l(h.addressList)}).catch(d)}),yield r.connection.init(a.addressList),r.connection})()}handlePublishStreamServer(i){const r=i.serverStatus&&i.serverStatus.url||"empty_url",a=this.streamingTasks.get(r),l=i.reason;switch(i.code){case xn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case xn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case xn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case xn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new K(k.LIVE_STREAMING_CDN_ERROR,"",{code:i.code});if(a)return R.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(r,h);if(!this.isStartingStreamingTask)return;this.statusError.set(r,h)}case xn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new K(k.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,l);return this.onLiveStreamWarning&&this.onLiveStreamWarning(r,h)}case xn.LIVE_STREAM_RESPONSE_WORKER_LOST:case xn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Ze(d=this.streamingTasks).call(d));for(const f of h)f.abortTask?f.abortTask():(R.warning("[".concat(this.spec.clientId,"] publish stream status code"),i.code,"try to republish",f.url),this.startLiveStreamingTask(f.url,f.mode,new K(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:i.code})).then(()=>{R.debug("[".concat(this.spec.clientId,"] republish live stream success"),f.url)}).catch(m=>{R.error(m.toString()),this.onLiveStreamError&&this.onLiveStreamError(f.url,m)}));return}}}handleInjectStreamServerStatus(i){const r=Number(i.uid),a=i.serverStatus&&i.serverStatus.url;switch(i.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(Pc.INJECT_STREAM_STATUS_START_SUCCESS,r,a));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(Pc.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,r,a),void this.streamingTasks.delete(a);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(Pc.INJECT_STREAM_STATUS_START_UNAUTHORIZED,r,a),void this.streamingTasks.delete(a);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(Pc.INJECT_STREAM_STATUS_BROKEN,r,a),void this.streamingTasks.delete(a);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(Pc.INJECT_STREAM_STATUS_START_TIMEOUT,r,a),void this.streamingTasks.delete(a);default:return void R.debug("inject stream server status",i)}}hasUrl(i){return this.streamingTasks.has(i)}}class dy{constructor(){T(this,"destChannelMediaInfos",new Map),T(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(i){JL(i),this.srcChannelMediaInfo=i}addDestChannelInfo(i){JL(i),this.destChannelMediaInfos.set(i.channelName,i)}removeDestChannelInfo(i){iT(i),this.destChannelMediaInfos.delete(i)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function Rb(s){if(!(s instanceof dy))return new K(k.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const i=s.getSrcChannelMediaInfo(),r=s.getDestChannelMediaInfo();return i?0===r.size?new K(k.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new K(k.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class rN extends nn{constructor(i,r,a){super(),T(this,"ws",void 0),T(this,"requestId",1),T(this,"heartBeatTimer",void 0),T(this,"joinInfo",void 0),T(this,"clientId",void 0),T(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),T(this,"onClose",l=>{this.emit("close"),this.dispose()}),T(this,"onMessage",l=>{const d=JSON.parse(l.data);if(!d||"serverResponse"!==d.command||!d.requestId)return d&&"serverStatus"===d.command&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)}),this.joinInfo=i,this.clientId=r,this.ws=new T_("cross-channel-".concat(this.clientId),a),this.ws.on(Ne.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Ne.CONNECTED,this.onOpen),this.ws.on(Ne.ON_MESSAGE,this.onMessage),this.ws.on(Ne.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(i){const r=this.requestId++;return i.requestId=r,i.seq=r,this.ws.sendMessage(i),r}waitStatus(i){return new q((r,a)=>{const l=window.setTimeout(()=>{a(new K(k.TIMEOUT,"wait status timeout, status: ".concat(i)))},5e3);this.once(i,d=>{window.clearTimeout(l),d.state&&0!==d.state?a(new K(k.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(i))):r(void 0)}),this.once("dispose",()=>{window.clearTimeout(l),a(new K(k.WS_ABORT))})})}request(i){var r=this;return x(function*(){if("closed"===r.ws.state)throw new K(k.WS_DISCONNECT);"connected"!==r.ws.state&&(yield new q((f,m)=>{r.ws.once(Ne.CLOSED,()=>m(new K(k.WS_ABORT))),r.ws.once(Ne.CONNECTED,f)}));const l=r.sendMessage(i),d=new q((f,m)=>{const g=()=>{m(new K(k.WS_ABORT))};r.ws.once(Ne.RECONNECTING,g),r.ws.once(Ne.CLOSED,g),r.once("req_".concat(l),f),si(3e3).then(()=>{r.removeAllListeners("req_".concat(l)),r.ws.off(Ne.RECONNECTING,g),r.ws.off(Ne.CLOSED,g),m(new K(k.TIMEOUT,"cross channel ws request timeout"))})}),h=yield d;if(!h||200!==h.code)throw new K(k.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(h)));return h})()}connect(i){var r=this;return x(function*(){r.ws.removeAllListeners(Ne.REQUEST_NEW_URLS),r.ws.on(Ne.REQUEST_NEW_URLS,a=>{a(i)}),yield r.ws.init(i)})()}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(i){const r=this.requestId++;return i.requestId=r,this.ws.sendMessage(i),r}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Ro extends nn{set state(i){i!==this._state&&(i!==Er.RELAY_STATE_FAILURE&&(this.errorCode=kl.RELAY_OK),this.emit("state",i,this.errorCode),this._state=i)}get state(){return this._state}constructor(i,r,a,l,d){var h;super(),h=this,T(this,"joinInfo",void 0),T(this,"sid",void 0),T(this,"clientId",void 0),T(this,"cancelToken",Gr.CancelToken.source()),T(this,"workerToken",void 0),T(this,"requestId",0),T(this,"signal",void 0),T(this,"prevChannelMediaConfig",void 0),T(this,"httpRetryConfig",void 0),T(this,"_resolution",void 0),T(this,"_state",Er.RELAY_STATE_IDLE),T(this,"errorCode",kl.RELAY_OK),T(this,"onStatus",f=>{R.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(f))),f&&f.command&&("onAudioPacketReceived"===f.command&&this.emit("event",la.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===f.command&&this.emit("event",la.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===f.command&&(this.errorCode=kl.SRC_TOKEN_EXPIRED,this.state=Er.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===f.command&&(this.errorCode=kl.DEST_TOKEN_EXPIRED,this.state=Er.RELAY_STATE_FAILURE))}),T(this,"onReconnect",x(function*(){R.debug("[".concat(h.clientId,"] ChannelMediaSocket disconnect, reconnecting")),h.emit("event",la.NETWORK_DISCONNECTED),h.state=Er.RELAY_STATE_IDLE,h.prevChannelMediaConfig&&h.sendStartRelayMessage(h.prevChannelMediaConfig).catch(f=>{h.state!==Er.RELAY_STATE_IDLE&&(R.error("auto restart channel media relay failed",f.toString()),h.errorCode=kl.SERVER_CONNECTION_LOST,h.state=Er.RELAY_STATE_FAILURE)})})),this.joinInfo=i,this.clientId=r,this.sid=OS(),this.signal=new rN(this.joinInfo,this.clientId,a),this.httpRetryConfig=l,this._resolution=d}startChannelMediaRelay(i){var r=this;return x(function*(){if(r.state!==Er.RELAY_STATE_IDLE)throw new K(k.INVALID_OPERATION);r.state=Er.RELAY_STATE_CONNECTING,yield r.connect(),R.debug("[".concat(r.clientId,"] startChannelMediaRelay: connect success"));try{yield r.sendStartRelayMessage(i)}catch(a){throw a.data&&a.data.serverResponse&&"SetSourceChannel"===a.data.serverResponse.command?new K(k.CROSS_CHANNEL_FAILED_JOIN_SRC):a.data&&a.data.serverResponse&&"SetDestChannelStatus"===a.serverResponse.command?new K(k.CROSS_CHANNEL_FAILED_JOIN_DEST):a.data&&a.data.serverResponse&&"StartPacketTransfer"===a.serverResponse.command?new K(k.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):a}r.prevChannelMediaConfig=i})()}updateChannelMediaRelay(i){var r=this;return x(function*(){if(r.state!==Er.RELAY_STATE_RUNNING)throw new K(k.INVALID_OPERATION);yield r.sendUpdateMessage(i),r.prevChannelMediaConfig=i})()}setVideoProfile(i){var r=this;return x(function*(){if(r._resolution=i,r.state!==Er.RELAY_STATE_RUNNING)throw new K(k.INVALID_OPERATION);const a=r.genMessage(zi.SetVideoProfile);yield r.signal.request(a),R.debug("[".concat(r.clientId,"] startChannelMediaRelay: setVideoProfile success"))})()}stopChannelMediaRelay(){var i=this;return x(function*(){yield i.sendStopRelayMessage(),R.debug("[".concat(i.clientId,"] stopChannelMediaRelay: send stop message success")),i.state=Er.RELAY_STATE_IDLE,i.dispose()})()}dispose(){R.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Gr.CancelToken.source(),this.state=Er.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}connect(){var i=this;return x(function*(){const r=yield function(s,i,r){return ly.apply(this,arguments)}(i.joinInfo,i.cancelToken.token,i.httpRetryConfig);i.workerToken=r.workerToken,yield i.signal.connect(r.addressList),i.emit("event",la.NETWORK_CONNECTED),i.signal.on("status",i.onStatus),i.signal.on("reconnecting",i.onReconnect)})()}sendStartRelayMessage(i){var r=this;return x(function*(){const a=r.genMessage(zi.StopPacketTransfer);yield r.signal.request(a),yield r.signal.waitStatus("Normal Quit"),R.debug("[".concat(r.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const l=r.genMessage(zi.SetSdkProfile,i);yield r.signal.request(l),R.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const d=r.genMessage(zi.SetSourceChannel,i);yield r.signal.request(d),yield r.signal.waitStatus("SetSourceChannelStatus"),r.emit("event",la.PACKET_JOINED_SRC_CHANNEL),R.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const h=r.genMessage(zi.SetSourceUserId,i);yield r.signal.request(h),R.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const f=r.genMessage(zi.SetDestChannel,i);yield r.signal.request(f),yield r.signal.waitStatus("SetDestChannelStatus"),r.emit("event",la.PACKET_JOINED_DEST_CHANNEL),R.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=r.genMessage(zi.StartPacketTransfer,i);yield r.signal.request(m),r.emit("event",la.PACKET_SENT_TO_DEST_CHANNEL),r.state=Er.RELAY_STATE_RUNNING,R.debug("[".concat(r.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),r.setVideoProfile(r._resolution)})()}sendUpdateMessage(i){var r=this;return x(function*(){const a=r.genMessage(zi.UpdateDestChannel,i);yield r.signal.request(a),r.emit("event",la.PACKET_UPDATE_DEST_CHANNEL),R.debug("[".concat(r.clientId,"] sendUpdateMessage: UpdateDestChannel success"))})()}sendStopRelayMessage(){var i=this;return x(function*(){const r=i.genMessage(zi.StopPacketTransfer);yield i.signal.request(r),R.debug("[".concat(i.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))})()}genMessage(i,r){const a=[],l=[],d=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:yo,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.19.1"===h.sdkVersion&&(h.sdkVersion="0.0.1");let f=null,m=null;switch(i){case zi.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case zi.SetSourceChannel:if(m=r&&r.getSrcChannelMediaInfo(),!m)throw new K(k.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:m.channelName,token:m.token||this.joinInfo.appId},h;case zi.SetSourceUserId:if(m=r&&r.getSrcChannelMediaInfo(),!m)throw new K(k.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:m.uid+""},h;case zi.SetDestChannel:if(f=r&&r.getDestChannelMediaInfo(),!f)throw new K(k.UNEXPECTED_ERROR,"can not find dest config");return f.forEach(g=>{a.push(g.channelName),l.push(g.uid+""),d.push(g.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:a,uid:l,token:d},h;case zi.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case zi.Reconnect:return h.clientRequest={command:"Reconnect"},h;case zi.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case zi.UpdateDestChannel:if(f=r&&r.getDestChannelMediaInfo(),!f)throw new K(k.UNEXPECTED_ERROR,"can not find dest config");return f.forEach(g=>{a.push(g.channelName),l.push(g.uid+""),d.push(g.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:a,uid:l,token:d},h;case zi.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}class Wt{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(i,r){T(this,"uid",void 0),T(this,"_uintid",void 0),T(this,"_trust_in_room_",!0),T(this,"_trust_audio_enabled_state_",!0),T(this,"_trust_video_enabled_state_",!0),T(this,"_trust_audio_mute_state_",!0),T(this,"_trust_video_mute_state_",!0),T(this,"_audio_muted_",!1),T(this,"_video_muted_",!1),T(this,"_audio_enabled_",!0),T(this,"_video_enabled_",!0),T(this,"_audio_added_",!1),T(this,"_video_added_",!1),T(this,"_trust_video_stream_added_state_",!0),T(this,"_trust_audio_stream_added_state_",!0),T(this,"_audioTrack",void 0),T(this,"_videoTrack",void 0),T(this,"_dataChannels",[]),T(this,"_audioSSRC",void 0),T(this,"_videoSSRC",void 0),T(this,"_audioOrtc",void 0),T(this,"_videoOrtc",void 0),T(this,"_cname",void 0),T(this,"_rtxSsrcId",void 0),this.uid=i,this._uintid=r}}var ji=wA,Zt=Rc;Tn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var s=Zt.f(this);return{promise:s.promise,resolve:s.resolve,reject:s.reject}}});var Pi=Rc,ot=Wd;Tn({target:"Promise",stat:!0,forced:!0},{try:function(s){var i=Pi.f(this),r=ot(s);return(r.error?i.reject:i.resolve)(r.value),i.promise}});var oN=wr(ji),sN=dh.f("asyncIterator"),f2=wr(sN);function Ib(s,i){this.v=s,this.k=i}function z_(s){var i,r;function a(d,h){try{var f=s[d](h),m=f.value,g=m instanceof Ib;oN.resolve(g?m.v:m).then(function(E){if(g){var y="return"===d?"return":"next";if(!m.k||E.done)return a(y,E);E=s[y](E).value}l(f.done?"return":"normal",E)},function(E){a("throw",E)})}catch(E){l("throw",E)}}function l(d,h){switch(d){case"return":i.resolve({value:h,done:!0});break;case"throw":i.reject(h);break;default:i.resolve({value:h,done:!1})}(i=i.next)?a(i.key,i.arg):r=null}this._invoke=function(d,h){return new oN(function(f,m){var g={key:d,arg:h,resolve:f,reject:m,next:null};r?r=r.next=g:(i=r=g,a(d,h))})},"function"!=typeof s.return&&(this.return=void 0)}function is(s){return function(){return new z_(s.apply(this,arguments))}}function _t(s){return new Ib(s,0)}function wb(s){var i={},r=!1;function a(l,d){return r=!0,{done:!1,value:new Ib(d=new oN(function(h){h(s[l](d))}),1)}}return i[void 0!==Rh&&Cc||"@@iterator"]=function(){return this},i.next=function(l){return r?(r=!1,l):a("next",l)},"function"==typeof s.throw&&(i.throw=function(l){if(r)throw r=!1,l;return a("throw",l)}),"function"==typeof s.return&&(i.return=function(l){return r?(r=!1,l):a("return",l)}),i}z_.prototype["function"==typeof Rh&&f2||"@@asyncIterator"]=function(){return this},z_.prototype.next=function(s){return this._invoke("next",s)},z_.prototype.throw=function(s){return this._invoke("throw",s)},z_.prototype.return=function(s){return this._invoke("return",s)};var Y_=wr(sN),$_={exports:{}};!function(s,i){s.exports=(()=>{var r={8:(d,h,f)=>{f.r(h),f.d(h,{Parser:()=>Se,Printer:()=>It,parse:()=>xe,print:()=>gt});const m="\n",g="".concat("\r").concat(m),E=" ";let y;function C(ue){return ue>="0"&&ue<="9"}function b(ue){return ue>="!"&&ue<="~"}function O(ue){return b(ue)||ue>="\x80"&&ue<="\xff"}function P(ue){return"!"===ue||ue>="#"&&ue<="'"||ue>="*"&&ue<="+"||ue>="-"&&ue<="."||ue>="0"&&ue<="9"||ue>="A"&&ue<="Z"||ue>="^"&&ue<="~"}function D(ue){return ue>="1"&&ue<="9"}function L(ue){return ue>="A"&&ue<="Z"||ue>="a"&&ue<="z"}function B(ue){return"d"===ue||"h"===ue||"m"===ue||"s"===ue}function V(ue){return ue>"\x01"&&ue<"\t"||ue>"\v"&&ue<"\f"||ue>"\x0e"&&ue<"\xff"}function J(ue){return L(ue)||C(ue)||"+"===ue||"/"===ue}function ae(ue){return C(ue)||L(ue)||"+"===ue||"/"===ue||"-"===ue||"_"===ue}function z(ue){return L(ue)||C(ue)||"+"===ue||"/"===ue}function Q(ue,I){var U=Object.keys(ue);if(Object.getOwnPropertySymbols){var G=Object.getOwnPropertySymbols(ue);I&&(G=G.filter(function(ce){return Object.getOwnPropertyDescriptor(ue,ce).enumerable})),U.push.apply(U,G)}return U}function X(ue){for(var I=1;I<arguments.length;I++){var U=null!=arguments[I]?arguments[I]:{};I%2?Q(Object(U),!0).forEach(function(G){te(ue,G,U[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ue,Object.getOwnPropertyDescriptors(U)):Q(Object(U)).forEach(function(G){Object.defineProperty(ue,G,Object.getOwnPropertyDescriptor(U,G))})}return ue}function te(ue,I,U){return I in ue?Object.defineProperty(ue,I,{value:U,enumerable:!0,configurable:!0,writable:!0}):ue[I]=U,ue}var ue;(ue=y||(y={})).VERSION="v",ue.ORIGIN="o",ue.SESSION_NAME="s",ue.INFORMATION="i",ue.URI="u",ue.EMAIL="e",ue.PHONE="p",ue.CONNECTION="c",ue.BANDWIDTH="b",ue.TIME="t",ue.REPEAT="r",ue.ZONE_ADJUSTMENTS="z",ue.KEY="k",ue.ATTRIBUTE="a",ue.MEDIA="m";class Ce{consumeText(I,U){let G=U;for(;G<I.length;){const ce=I[G];if("\0"===ce||"\r"===ce||ce===m)break;G+=1}if(G-U==0)throw new Error("Invalid text, at ".concat(I));return G}consumeUnicastAddress(I,U,G){return this.consumeTill(I,U,E)}consumeOneOrMore(I,U,G){let ce=U;for(;G(I[ce]);)ce++;if(ce-U==0)throw new Error("Invalid rule at ".concat(U,"."));return ce}consumeSpace(I,U){if(I[U]===E)return U+1;throw new Error("Invalid space at ".concat(U,"."))}consumeIP4Address(I,U){let G=U;for(let ce=0;ce<4;ce++)if(G=this.consumeDecimalUChar(I,G),3!==ce){if("."!==I[G])throw new Error("Invalid IP4 address.");G++}return G}consumeDecimalUChar(I,U){let G=U;for(let Ve=0;Ve<3&&C(I[G]);Ve++,G++);if(G-U==0)throw new Error("Invalid decimal uchar.");const ce=parseInt(I.slice(U,G));if(ce>=0&&ce<=255)return G;throw new Error("Invalid decimal uchar")}consumeIP6Address(I,U){let G=this.consumeHexpart(I,U);return":"===I[G]&&(G+=1,G=this.consumeIP4Address(I,G)),G}consumeHexpart(I,U){let G=U;if(":"===I[G]&&":"===I[G+1]){G+=2;try{G=this.consumeHexseq(I,G)}catch(ce){}return G}if(G=this.consumeHexseq(I,G),":"===I[G]&&":"===I[G+1]){G+=2;try{G=this.consumeHexseq(I,G)}catch(ce){}return G}return G}consumeHexseq(I,U){let G=U;for(;G=this.consumeHex4(I,G),":"===I[G]&&":"!==I[G+1];)G+=1;return G}consumeHex4(I,U){let G=0;for(;G<4;G++)if(!((ce=I[U+G])>="0"&&ce<="9"||ce>="a"&&ce<="f"||ce>="A"&&ce<="F")){if(0===G)throw new Error("Invalid hex 4");break}var ce;return U+G}consumeFQDN(I,U){let G=U;for(;C(I[G])||L(I[G])||"-"===I[G]||"."===I[G];)G+=1;if(G-U<4)throw new Error("Invalid FQDN");return G}consumeExtnAddr(I,U){return this.consumeOneOrMore(I,U,O)}consumeMulticastAddress(I,U,G){switch(G){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(I,U);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(I,U);default:try{return this.consumeFQDN(I,U)}catch(ce){return this.consumeExtnAddr(I,U)}}}consumeIP6MulticastAddress(I,U){const G=this.consumeHexpart(I,U);return"/"===I[G]?this.consumeInteger(I,G+1):G}consumeIP4MulticastAddress(I,U){let G=U+3;const ce=I.slice(U,G),Ve=parseInt(ce);if(Ve<224||Ve>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let sn=0;sn<3;sn++){if("."!==I[G])throw new Error("Invalid IP4 multicast address.");G+=1,G=this.consumeDecimalUChar(I,G)}return"/"===I[G]&&(G+=1),G=this.consumeTTL(I,G),"/"===I[G]&&(G=this.consumeInteger(I,G)),G}consumeInteger(I,U){if(!D(I[U]))throw new Error("Invalid integer.");for(U+=1;C(I[U]);)U+=1;return U}consumeTTL(I,U){if("0"===I[U])return U+1;if(!D(I[U]))throw new Error("Invalid TTL.");U+=1;for(let G=0;G<2&&C(I[U]);G++)U+=1;return U}consumeToken(I,U){return this.consumeOneOrMore(I,U,P)}consumeTime(I,U){let G=U;if("0"===I[G])return G+1;for(D(I[G])&&(G+=1);C(I[G]);)G++;if(G-U<10)throw new Error("Invalid time");return G}consumeAddress(I,U){return this.consumeTill(I,U,E)}consumeTypedTime(I,U){let G=U;return G=this.consumeOneOrMore(I,G,C),B(I[G])?G+1:G}consumeRepeatInterval(I,U){if(!D(I[U]))throw new Error("Invalid repeat interval");for(U+=1;C(I[U]);)U+=1;return B(I[U])&&(U+=1),U}consumePort(I,U){return this.consumeOneOrMore(I,U,C)}consume(I,U,G){for(let ce=0;ce<G.length;ce++){if(U+ce>=I.length)throw new Error("consume exceeding value length");if(I[U+ce]!==G[ce])throw new Error("consume ".concat(G," failed at ").concat(ce))}return U+G.length}consumeTill(I,U,G){let ce=U;for(;ce<I.length&&("string"!=typeof G||I[ce]!==G)&&("function"!=typeof G||!G(I[ce]));)ce++;return ce}}class Se extends Ce{constructor(){super(),te(this,"records",[]),te(this,"currentLine",0)}parse(I){const U=this.probeEOL(I);this.records=I.split(U).filter(li=>!!li.trim()).map(this.parseLine),this.currentLine=0;const G=this.parseVersion(),ce=this.parseOrigin(),Ve=this.parseSessionName(),sn=this.parseInformation(),Xi=this.parseUri(),co=this.parseEmail(),Qr=this.parsePhone(),Dy=this.parseConnection(),Oy=this.parseBandWidth(),lo=this.parseTimeFields(),Xc=this.parseKey(),sm=this.parseSessionAttribute(),Fn=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:G,origin:ce,sessionName:Ve,information:sn,uri:Xi,emails:co,phones:Qr,connection:Dy,bandwidths:Oy,timeFields:lo,key:Xc,attributes:sm,mediaDescriptions:Fn}}getCurrentRecord(){const I=this.records[this.currentLine];if(!I)throw new Error("Record doesn't exit.");return I}probeEOL(I){for(let U=0;U<I.length;U++)if(I[U]===m)return"\r"===I[U-1]?g:m;throw new Error("Invalid newline character.")}parseLine(I,U){if(I.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const G=I[0];if("="!==I[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:G,value:I.slice(2),line:U,cur:0}}parseSessionAttribute(){const I=new ut;for(;this.currentLine<this.records.length;){const U=this.getCurrentRecord();if(U.type!==y.ATTRIBUTE)break;const G={attField:this.extractOneOrMore(U,ce=>P(ce)&&":"!==ce),_cur:0};":"===U.value[U.cur]&&(U.cur+=1,G.attValue=this.extractOneOrMore(U,V)),I.parse(G),this.currentLine++}return I.digest()}parseMediaAttributes(I){const U=new mt(I);for(;this.currentLine<this.records.length;){const G=this.getCurrentRecord();if(G.type!==y.ATTRIBUTE)break;const ce={attField:this.extractOneOrMore(G,Ve=>P(Ve)&&":"!==Ve),_cur:0};":"===G.value[G.cur]&&(G.cur+=1,ce.attValue=this.extractOneOrMore(G,V)),U.parse(ce),this.currentLine++}return U.digest()}parseKey(){const I=this.getCurrentRecord();if(I.type===y.KEY){if("prompt"===I.value||"clear:"===I.value||"base64:"===I.value||"uri:"===I.value)return I.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const I=this.getCurrentRecord();if(I.type===y.ZONE_ADJUSTMENTS){const U=[];for(;;)try{const G=this.extract(I,this.consumeTime);this.consumeSpaceForRecord(I);let ce=!1;"-"===I.value[I.cur]&&(ce=!0,I.cur+=1);const Ve=this.extract(I,this.consumeTypedTime);U.push({time:G,typedTime:Ve,back:ce})}catch(G){break}if(0===U.length)throw new Error("Invalid zone adjustments");return this.currentLine++,U}return[]}parseRepeat(){const I=[];for(;;){const U=this.getCurrentRecord();if(U.type!==y.REPEAT)break;{const G=this.extract(U,this.consumeRepeatInterval),ce=this.parseTypedTime(U);I.push({repeatInterval:G,typedTimes:ce}),this.currentLine++}}return I}parseTypedTime(I){const U=[];for(;;)try{this.consumeSpaceForRecord(I),U.push(this.extract(I,this.consumeTypedTime))}catch(G){break}if(0===U.length)throw new Error("Invalid typed time.");return U}parseTime(){const I=this.getCurrentRecord(),U=this.extract(I,this.consumeTime);this.consumeSpaceForRecord(I);const G=this.extract(I,this.consumeTime);return this.currentLine++,{startTime:U,stopTime:G}}parseBandWidth(){const I=[];for(;this.currentLine<this.records.length;){const U=this.getCurrentRecord();if(U.type!==y.BANDWIDTH)break;{const G=this.extractOneOrMore(U,P);if(":"!==U.value[U.cur])throw new Error("Invalid bandwidth field.");U.cur++;const ce=this.extractOneOrMore(U,C);I.push({bwtype:G,bandwidth:ce}),this.currentLine++}}return I}parseVersion(){const I=this.getCurrentRecord();if(I.type!==y.VERSION)throw new Error("first sdp record must be version");const U=I.value.slice(0,this.consumeOneOrMore(I.value,0,C));if(U.length!==I.value.length)throw new Error('invalid proto version, "v='.concat(I.value,'"'));return this.currentLine++,U}parseOrigin(){const I=this.getCurrentRecord();if(I.type!==y.ORIGIN)throw new Error("second line of sdp must be origin");const U=this.extractOneOrMore(I,O);this.consumeSpaceForRecord(I);const G=this.extractOneOrMore(I,C);this.consumeSpaceForRecord(I);const ce=this.extractOneOrMore(I,C);this.consumeSpaceForRecord(I);const Ve=this.extractOneOrMore(I,P);this.consumeSpaceForRecord(I);const sn=this.extractOneOrMore(I,P);this.consumeSpaceForRecord(I);const Xi=this.extract(I,this.consumeUnicastAddress);return this.currentLine++,{username:U,sessId:G,sessVersion:ce,nettype:Ve,addrtype:sn,unicastAddress:Xi}}parseSessionName(){const I=this.getCurrentRecord();if(I.type===y.SESSION_NAME){const U=this.extract(I,this.consumeText);return this.currentLine++,U}}parseInformation(){const I=this.getCurrentRecord();if(I.type!==y.INFORMATION)return;const U=this.extract(I,this.consumeText);return this.currentLine++,U}parseUri(){const I=this.getCurrentRecord();if(I.type===y.URI)return this.currentLine++,I.value}parseEmail(){const I=[];for(;;){const U=this.getCurrentRecord();if(U.type!==y.EMAIL)break;I.push(U.value),this.currentLine++}return I}parsePhone(){const I=[];for(;;){const U=this.getCurrentRecord();if(U.type!==y.PHONE)break;I.push(U.value),this.currentLine++}return I}parseConnection(){const I=this.getCurrentRecord();if(I.type===y.CONNECTION){const U=this.extractOneOrMore(I,P);this.consumeSpaceForRecord(I);const G=this.extractOneOrMore(I,P);this.consumeSpaceForRecord(I);const ce=this.extract(I,this.consumeAddress);return this.currentLine++,{nettype:U,addrtype:G,address:ce}}}parseMedia(){const I=this.getCurrentRecord(),U=this.extract(I,this.consumeToken);this.consumeSpaceForRecord(I);let G=this.extract(I,this.consumePort);"/"===I.value[I.cur]&&(I.cur+=1,G+=this.extract(I,this.consumeInteger)),this.consumeSpaceForRecord(I);const ce=[];for(ce.push(this.extract(I,this.consumeToken));"/"===I.value[I.cur];)I.cur+=1,ce.push(this.extract(I,this.consumeToken));if(0===ce.length)throw new Error("Invalid proto");const Ve=this.parseFmt(I);return this.currentLine++,{mediaType:U,port:G,protos:ce,fmts:Ve}}parseTimeFields(){const I=[];for(;this.getCurrentRecord().type===y.TIME;){const U=this.parseTime(),G=this.parseRepeat(),ce=this.parseZone();I.push({time:U,repeats:G,zones:ce})}return I}parseMediaDescription(){const I=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.MEDIA;){const U=this.parseMedia(),G=this.parseInformation(),ce=this.parseConnections(),Ve=this.parseBandWidth(),sn=this.parseKey(),Xi=this.parseMediaAttributes(U);I.push({media:U,information:G,connections:ce,bandwidths:Ve,key:sn,attributes:Xi})}return I}parseConnections(){const I=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.CONNECTION;)I.push(this.parseConnection());return I}parseFmt(I){const U=[];for(;;)try{this.consumeSpaceForRecord(I),U.push(this.extract(I,this.consumeToken))}catch(G){break}if(0===U.length)throw new Error("Invalid fmts");return U}extract(I,U,...G){const ce=U.call(this,I.value,I.cur,...G),Ve=I.value.slice(I.cur,ce);return I.cur=ce,Ve}extractOneOrMore(I,U){const G=this.consumeOneOrMore(I.value,I.cur,U),ce=I.value.slice(I.cur,G);return I.cur=G,ce}consumeSpaceForRecord(I){if(I.value[I.cur]!==E)throw new Error("Invalid space at ".concat(I.cur,"."));I.cur+=1}}class He extends Ce{constructor(...I){super(...I),te(this,"attributes",void 0),te(this,"digested",!1)}extractOneOrMore(I,U,G){const ce=this.consumeOneOrMore(I.attValue,I._cur,U),Ve=I.attValue.slice(I._cur,ce),[sn,Xi]=G||[];if("number"==typeof sn&&Ve.length<sn)throw new Error("error in length, should be more or equal than ".concat(sn," characters."));if("number"==typeof Xi&&Ve.length>Xi)throw new Error("error in length, should be less or equal than ".concat(Xi," characters."));return I._cur=ce,Ve}consumeAttributeSpace(I){if(I.attValue[I._cur]!==E)throw new Error("Invalid space at ".concat(I._cur,"."));I._cur+=1}extract(I,U,...G){if(!I.attValue)throw new Error("Nothing to extract from attValue.");const ce=U.call(this,I.attValue,I._cur,...G),Ve=I.attValue.slice(I._cur,ce);return I._cur=ce,Ve}atEnd(I){if(!I.attValue)throw new Error;return I._cur>=I.attValue.length}peekChar(I){if(!I.attValue)throw new Error;return I.attValue[I._cur]}peek(I,U){if(!I.attValue)throw new Error;for(let G=0;G<U.length;G++)if(U[G]!==I.attValue[I._cur+G])return!1;return!0}parseIceUfrag(I){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(I,J,[4,256])}parseIcePwd(I){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(I,J,[22,256])}parseIceOptions(I){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const U=[];for(;!this.atEnd(I);){U.push(this.extractOneOrMore(I,J));try{this.consumeAttributeSpace(I)}catch(G){if(this.atEnd(I))break;throw G}}this.attributes.iceOptions=U}parseFingerprint(I){const U=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);const G=this.extract(I,this.consumeTill);this.attributes.fingerprints.push({hashFunction:U,fingerprint:G})}parseExtmap(I){const U=this.extractOneOrMore(I,C);let G;"/"===this.peekChar(I)&&(this.extract(I,this.consume,"/"),G=this.extract(I,this.consumeToken)),this.consumeAttributeSpace(I);const ce=this.extract(I,this.consumeTill,E),Ve=X(X({entry:parseInt(U,10)},G&&{direction:G}),{},{extensionName:ce});this.peekChar(I)===E&&(this.consumeAttributeSpace(I),Ve.extensionAttributes=this.extract(I,this.consumeTill)),this.attributes.extmaps.push(Ve)}parseSetup(I){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const U=this.extract(I,this.consumeTill);if("active"!==U&&"passive"!==U&&"actpass"!==U&&"holdconn"!==U)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=U}}class ut extends He{constructor(...I){super(...I),te(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(I){if(this.digested)throw new Error("already digested");try{switch(I.attField){case"group":this.parseGroup(I);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(I);break;case"ice-pwd":this.parseIcePwd(I);break;case"ice-options":this.parseIceOptions(I);break;case"fingerprint":this.parseFingerprint(I);break;case"setup":this.parseSetup(I);break;case"tls-id":this.parseTlsId(I);break;case"identity":this.parseIdentity(I);break;case"extmap":this.parseExtmap(I);break;case"msid-semantic":this.parseMsidSemantic(I);break;default:I.ignored=!0,this.attributes.unrecognized.push(I)}}catch(U){throw console.error("parsing session attribute ".concat(I.attField,' error, "a=').concat(I.attField,":").concat(I.attValue,'"')),U}if(!I.ignored&&I.attValue&&!this.atEnd(I))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(I){const U=this.extract(I,this.consumeToken),G=[];for(;!this.atEnd(I)&&this.peekChar(I)===E;)this.consumeAttributeSpace(I),G.push(this.extract(I,this.consumeToken));this.attributes.groups.push({semantic:U,identificationTag:G})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(I){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(I,ae)}parseIdentity(I){const U=this.extractOneOrMore(I,z),G=[];for(;!this.atEnd(I)&&this.peekChar(I)===E;){this.consumeAttributeSpace(I);const ce=this.extract(I,this.consumeToken);this.extract(I,this.consume,"=");const Ve=this.extractOneOrMore(I,sn=>sn!==E&&V(sn));G.push({name:ce,value:Ve})}this.attributes.identities.push({assertionValue:U,extensions:G})}parseMsidSemantic(I){this.peekChar(I)===E&&this.consumeAttributeSpace(I);const U={semantic:this.extract(I,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(I)}catch(G){break}if("*"===this.peekChar(I)){this.extract(I,this.consume,"*"),U.applyForAll=!0;break}{const G=this.extract(I,this.consumeTill,E);U.identifierList.push(G)}}this.attributes.msidSemantic=U}}class mt extends He{constructor(I){super(),te(this,"attributes",void 0),-1!==I.protos.indexOf("RTP")||I.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(I){if(this.digested)throw new Error("already digested");try{switch(I.attField){case"extmap":this.parseExtmap(I);break;case"setup":this.parseSetup(I);break;case"ice-ufrag":this.parseIceUfrag(I);break;case"ice-pwd":this.parseIcePwd(I);break;case"ice-options":this.parseIceOptions(I);break;case"candidate":this.parseCandidate(I);break;case"remote-candidate":this.parseRemoteCandidate(I);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(I);break;case"rtpmap":this.parseRtpmap(I);break;case"ptime":this.parsePtime(I);break;case"maxptime":this.parseMaxPtime(I);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(I);break;case"ssrc":this.parseSSRC(I);break;case"fmtp":this.parseFmtp(I);break;case"rtcp-fb":this.parseRtcpFb(I);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(I);break;case"mid":this.parseMid(I);break;case"msid":this.parseMsid(I);break;case"imageattr":this.parseImageAttr(I);break;case"rid":this.parseRid(I);break;case"simulcast":this.parseSimulcast(I);break;case"sctp-port":this.parseSctpPort(I);break;case"max-message-size":this.parseMaxMessageSize(I);break;case"ssrc-group":this.parseSSRCGroup(I);break;default:I.ignored=!0,this.attributes.unrecognized.push(I)}}catch(U){throw console.error("parsing media attribute ".concat(I.attField,' error, "a=').concat(I.attField,":").concat(I.attValue,'"')),U}if(!I.ignored&&I.attValue&&!this.atEnd(I))throw new Error("attribute parsing error")}parseCandidate(I){const U=this.extractOneOrMore(I,J,[1,32]);this.consumeAttributeSpace(I);const G=this.extractOneOrMore(I,C,[1,5]);this.consumeAttributeSpace(I);const ce=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);const Ve=this.extractOneOrMore(I,C,[1,10]);this.consumeAttributeSpace(I);const sn=this.extract(I,this.consumeAddress);this.consumeAttributeSpace(I);const Xi=this.extract(I,this.consumePort);this.consumeAttributeSpace(I),this.extract(I,this.consume,"typ"),this.consumeAttributeSpace(I);const co={foundation:U,componentId:G,transport:ce,priority:Ve,connectionAddress:sn,port:Xi,type:this.extract(I,this.consumeToken),extension:{}};for(this.peek(I," raddr")&&(this.extract(I,this.consume," raddr"),this.consumeAttributeSpace(I),co.relAddr=this.extract(I,this.consumeAddress)),this.peek(I," rport")&&(this.extract(I,this.consume," rport"),this.consumeAttributeSpace(I),co.relPort=this.extract(I,this.consumePort));this.peekChar(I)===E;){this.consumeAttributeSpace(I);const Qr=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I),co.extension[Qr]=this.extractOneOrMore(I,b)}this.attributes.candidates.push(co)}parseRemoteCandidate(I){const U=[];for(;;){const G=this.extractOneOrMore(I,C,[1,5]);this.consumeAttributeSpace(I);const ce=this.extract(I,this.consumeAddress);this.consumeAttributeSpace(I);const Ve=this.extract(I,this.consumePort);U.push({componentId:G,connectionAddress:ce,port:Ve});try{this.consumeAttributeSpace(I)}catch(sn){break}}this.attributes.remoteCandidatesList.push(U)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(I){const U=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);const G=this.extract(I,this.consumeTill,"/");this.extract(I,this.consume,"/");const ce={encodingName:G,clockRate:this.extractOneOrMore(I,C)};this.atEnd(I)||"/"!==this.peekChar(I)||(this.extract(I,this.consume,"/"),ce.encodingParameters=parseInt(this.extract(I,this.consumeTill),10));const Ve=this.attributes.payloads.find(sn=>sn.payloadType===parseInt(U,10));Ve?Ve.rtpMap=ce:this.attributes.payloads.push({payloadType:parseInt(U,10),rtpMap:ce,rtcpFeedbacks:[]})}parsePtime(I){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(I,this.consumeTill)}parseMaxPtime(I){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(I,this.consumeTill)}parseDirection(I){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=I.attField}parseSSRC(I){const U=this.extractOneOrMore(I,C);this.consumeAttributeSpace(I);const G=this.extract(I,this.consumeTill,":");let ce;":"===this.peekChar(I)&&(this.extract(I,this.consume,":"),ce=this.extract(I,this.consumeTill));const Ve=this.attributes.ssrcs.find(sn=>sn.ssrcId===parseInt(U,10));Ve?Ve.attributes[G]=ce:this.attributes.ssrcs.push({ssrcId:parseInt(U,10),attributes:{[G]:ce}})}parseFmtp(I){const U=this.extract(I,this.consumeTill,E);this.consumeAttributeSpace(I);const G=this.extract(I,this.consumeTill),ce={};G.split(";").forEach(sn=>{let[Xi,co]=sn.split("=");Xi=Xi.trim();const Qr="string"==typeof co?co.trim():null;"string"==typeof Xi&&Xi.length>0&&(ce[Xi]=Qr)});const Ve=this.attributes.payloads.find(sn=>sn.payloadType===parseInt(U,10));Ve?Ve.fmtp={parameters:ce}:this.attributes.payloads.push({payloadType:parseInt(U,10),rtcpFeedbacks:[],fmtp:{parameters:ce}})}parseFmtParameters(I){const U={},G=this.extract(I,this.consumeTill,"=");I._cur++;const ce=this.extract(I,this.consumeTill,";");for(U[G]=ce;";"===I.attValue[I._cur];){const Ve=this.extract(I,this.consumeTill,"=");I._cur++;const sn=this.extract(I,this.consumeTill,";");U[Ve]=sn}return U}parseRtcpFb(I){let U="";U="*"===this.peekChar(I)?this.extract(I,this.consume,"*"):this.extract(I,this.consumeTill,E),this.consumeAttributeSpace(I);const G=this.extract(I,this.consumeTill,E);let ce;if("trr-int"===G)ce={type:G,interval:this.extract(I,this.consumeTill)};else{const Ve={type:G};this.peekChar(I)===E&&(this.consumeAttributeSpace(I),Ve.parameter=this.extract(I,this.consumeToken),this.peekChar(I)===E&&(Ve.additional=this.extract(I,this.consumeTill))),ce=Ve}if("*"===U)this.attributes.rtcpFeedbackWildcards.push(ce);else{const Ve=this.attributes.payloads.find(sn=>sn.payloadType===parseInt(U,10));Ve?Ve.rtcpFeedbacks.push(ce):this.attributes.payloads.push({payloadType:parseInt(U,10),rtcpFeedbacks:[ce]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(I){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const U={port:this.extract(I,this.consumePort)};this.peekChar(I)===E&&(this.consumeAttributeSpace(I),U.netType=this.extractOneOrMore(I,P),this.consumeAttributeSpace(I),U.addressType=this.extractOneOrMore(I,P),this.consumeAttributeSpace(I),U.address=this.extract(I,this.consumeAddress)),this.attributes.rtcp=U}parseMsid(I){const U={id:this.extractOneOrMore(I,P,[1,64])};this.peekChar(I)===E&&(this.consumeAttributeSpace(I),U.appdata=this.extractOneOrMore(I,P,[1,64])),this.attributes.msids.push(U)}parseImageAttr(I){this.attributes.imageattr.push(I.attValue)}parseRid(I){const U=this.extractOneOrMore(I,ce=>L(ce)||C(ce)||"_"===ce||"-"===ce);this.consumeAttributeSpace(I);const G={id:U,direction:this.extract(I,this.consumeToken),params:[]};if(this.peekChar(I)===E){if(this.consumeAttributeSpace(I),this.peek(I,"pt=")){this.extract(I,this.consume,"pt=");const ce=[];for(;;){const Ve=this.extract(I,this.consumeToken);ce.push(Ve);try{this.extract(I,this.consume,",")}catch(sn){break}}G.payloads=ce,this.peekChar(I)===E&&this.extract(I,this.consume,E)}for(;;){const ce=this.extract(I,this.consumeToken);switch(ce){case"depend":{const Ve={type:ce,rids:this.extract(I,this.consume,"=").split(",")};G.params.push(Ve);break}default:{const Ve={type:ce};"="===this.peekChar(I)&&(this.extract(I,this.consume,"="),Ve.val=this.extract(I,this.consumeTill,";")),G.params.push(Ve)}}try{this.extract(I,this.consume,";")}catch(Ve){break}}}this.attributes.rids.push(G)}parseSimulcast(I){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=I.attValue,this.extract(I,this.consumeTill)}parseSctpPort(I){this.attributes.sctpPort=this.extractOneOrMore(I,C,[1,5])}parseMaxMessageSize(I){this.attributes.maxMessageSize=this.extractOneOrMore(I,C,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(I){this.attributes.mid=this.extract(I,this.consumeToken)}parseSSRCGroup(I){const U=this.extract(I,this.consumeToken),G=[];for(;;)try{this.consumeAttributeSpace(I);const ce=this.extract(I,this.consumeInteger);G.push(parseInt(ce,10))}catch(ce){break}this.attributes.ssrcGroups.push({semantic:U,ssrcIds:G})}}function dt(ue,I,U){return I in ue?Object.defineProperty(ue,I,{value:U,enumerable:!0,configurable:!0,writable:!0}):ue[I]=U,ue}class It{constructor(){dt(this,"eol",g)}print(I,U){let G="";return U&&(this.eol=U),G+=this.printVersion(I.version),G+=this.printOrigin(I.origin),G+=this.printSessionName(I.sessionName),G+=this.printInformation(I.information),G+=this.printUri(I.uri),G+=this.printEmail(I.emails),G+=this.printPhone(I.phones),G+=this.printConnection(I.connection),G+=this.printBandwidth(I.bandwidths),G+=this.printTimeFields(I.timeFields),G+=this.printKey(I.key),G+=this.printSessionAttributes(I.attributes),G+=this.printMediaDescription(I.mediaDescriptions),G}printVersion(I){return"v=".concat(I).concat(this.eol)}printOrigin(I){return"o=".concat(I.username," ").concat(I.sessId," ").concat(I.sessVersion," ").concat(I.nettype," ").concat(I.addrtype," ").concat(I.unicastAddress).concat(this.eol)}printSessionName(I){return I?"s=".concat(I).concat(this.eol):""}printInformation(I){return I?"i=".concat(I).concat(this.eol):""}printUri(I){return I?"u=".concat(I).concat(this.eol):""}printEmail(I){let U="";for(const G of I)U+="e=".concat(G).concat(this.eol);return U}printPhone(I){let U="";for(const G of I)U+="e=".concat(G).concat(this.eol);return U}printConnection(I){return I?"c=".concat(I.nettype," ").concat(I.addrtype," ").concat(I.address).concat(this.eol):""}printBandwidth(I){let U="";for(const G of I)U+="b=".concat(G.bwtype,":").concat(G.bandwidth).concat(this.eol);return U}printTimeFields(I){let U="";for(const G of I){U+="t=".concat(G.time.startTime," ").concat(G.time.startTime).concat(this.eol);for(const ce of G.repeats)U+="r=".concat(ce.repeatInterval," ").concat(ce.typedTimes.join(" ")).concat(this.eol);G.zoneAdjustments&&(U+="z=",U+="z=".concat(G.zoneAdjustments.map(ce=>"".concat(ce.time," ").concat(ce.back?"-":""," ").concat(ce.typedTime)).join(" ")).concat(this.eol),U+=this.eol)}return U}printKey(I){return I?"k=".concat(I).concat(this.eol):""}printAttributes(I){let U="";for(const G of I)U+="a=".concat(G.attField).concat(G.attValue?":".concat(G.attValue):"").concat(this.eol);return U}printMediaDescription(I){let U="";for(const G of I)U+=this.printMedia(G.media),U+=this.printInformation(G.information),U+=this.printConnections(G.connections),U+=this.printBandwidth(G.bandwidths),U+=this.printKey(G.key),U+=this.printMediaAttributes(G);return U}printConnections(I){let U="";for(const G of I)U+=this.printConnection(G);return U}printMedia(I){return"m=".concat(I.mediaType," ").concat(I.port," ").concat(I.protos.join("/")," ").concat(I.fmts.join(" ")).concat(this.eol)}printSessionAttributes(I){return new de(this.eol).print(I)}printMediaAttributes(I){return new ge(this.eol).print(I)}}class re{constructor(I){dt(this,"eol",void 0),this.eol=I}printIceUfrag(I){return void 0===I?"":"a=ice-ufrag:".concat(I).concat(this.eol)}printIcePwd(I){return void 0===I?"":"a=ice-pwd:".concat(I).concat(this.eol)}printIceOptions(I){return void 0===I?"":"a=ice-options:".concat(I.join(E)).concat(this.eol)}printFingerprints(I){return I.length>0?I.map(U=>"a=fingerprint:".concat(U.hashFunction).concat(E).concat(U.fingerprint)).join(this.eol)+this.eol:""}printExtmap(I){return I.map(U=>"a=extmap:".concat(U.entry).concat(U.direction?"/".concat(U.direction):"").concat(E).concat(U.extensionName).concat(U.extensionAttributes?"".concat(E).concat(U.extensionAttributes):"").concat(this.eol)).join("")}printSetup(I){return void 0===I?"":"a=setup:".concat(I).concat(this.eol)}printUnrecognized(I){return I.map(U=>"a=".concat(U.attField).concat(U.attValue?":".concat(U.attValue):"").concat(this.eol)).join("")}}class de extends re{print(I){let U="";return U+=this.printGroups(I.groups),U+=this.printMsidSemantic(I.msidSemantic),U+=this.printIceLite(I.iceLite),U+=this.printIceUfrag(I.iceUfrag),U+=this.printIcePwd(I.icePwd),U+=this.printIceOptions(I.iceOptions),U+=this.printFingerprints(I.fingerprints),U+=this.printSetup(I.setup),U+=this.printTlsId(I.tlsId),U+=this.printIdentity(I.identities),U+=this.printExtmap(I.extmaps),U+=this.printUnrecognized(I.unrecognized),U}printGroups(I){let U="";return I.length>0&&(U+=I.map(G=>"a=group:".concat(G.semantic).concat(G.identificationTag.map(ce=>"".concat(E).concat(ce)).join("")).concat(this.eol)).join("")),U}printIceLite(I){return void 0===I?"":"a=ice-lite"+this.eol}printTlsId(I){return I?"a=tls-id:".concat(I).concat(this.eol):""}printIdentity(I){return 0===I.length?"":I.map(U=>"a=identity:".concat(U.assertionValue).concat(U.extensions.map(G=>"".concat(E).concat(G.name).concat(G.value?"=".concat(G.value):"")))).join(this.eol)+this.eol}printMsidSemantic(I){if(!I)return"";let U="a=msid-semantic:".concat(I.semantic);return I.applyForAll?U+="".concat(E,"*"):I.identifierList.length>0&&(U+=I.identifierList.map(G=>"".concat(E).concat(G))),U+this.eol}}class ge extends re{print(I){const U=I.attributes;let G="";return G+=this.printRTCP(U.rtcp),G+=this.printIceUfrag(U.iceUfrag),G+=this.printIcePwd(U.icePwd),G+=this.printIceOptions(U.iceOptions),G+=this.printCandidates(U.candidates),G+=this.printRemoteCandidatesList(U.remoteCandidatesList),G+=this.printEndOfCandidates(U.endOfCandidates),G+=this.printFingerprints(U.fingerprints),G+=this.printSetup(U.setup),G+=this.printMid(U.mid),G+=this.printExtmap(U.extmaps),G+=this.printRTPRelated(U),G+=this.printPtime(U.ptime),G+=this.printMaxPtime(U.maxPtime),G+=this.printDirection(U.direction),G+=this.printSSRCGroups(U.ssrcGroups),G+=this.printSSRC(U.ssrcs),G+=this.printRTCPMux(U.rtcpMux),G+=this.printRTCPMuxOnly(U.rtcpMuxOnly),G+=this.printRTCPRsize(U.rtcpRsize),G+=this.printMSId(U.msids),G+=this.printImageattr(U.imageattr),G+=this.printRid(U.rids),G+=this.printSimulcast(U.simulcast),G+=this.printSCTPPort(U.sctpPort),G+=this.printMaxMessageSize(U.maxMessageSize),G+=this.printUnrecognized(U.unrecognized),G}printCandidates(I){return I.map(U=>"a=candidate:".concat(U.foundation).concat(E).concat(U.componentId).concat(E).concat(U.transport).concat(E).concat(U.priority).concat(E).concat(U.connectionAddress).concat(E).concat(U.port).concat(E,"typ").concat(E).concat(U.type).concat(U.relAddr?"".concat(E,"raddr").concat(E).concat(U.relAddr):"").concat(U.relPort?"".concat(E,"rport").concat(E).concat(U.relPort):"").concat(Object.keys(U.extension).map(G=>"".concat(E).concat(G).concat(E).concat(U.extension[G])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(I){return I.map(U=>"a=remote-candidates:".concat(U.join(E)).concat(this.eol)).join("")}printEndOfCandidates(I){return void 0===I?"":"a=end-of-candidates"+this.eol}printRTPRelated(I){if(!I.payloads)return"";const U=I.payloads;let G="";G+=I.rtcpFeedbackWildcards.map(ce=>this.printRTCPFeedback("*",ce)).join("");for(const ce of U)G+=this.printRtpMap(ce.payloadType,ce.rtpMap),G+=this.printFmtp(ce.payloadType,ce.fmtp),G+=ce.rtcpFeedbacks.map(Ve=>this.printRTCPFeedback(ce.payloadType,Ve)).join("");return G}printFmtp(I,U){if(!U)return"";const G=Object.keys(U.parameters);return 1===G.length&&null===U.parameters[G[0]]?"a=fmtp:".concat(I).concat(E).concat(G[0]).concat(this.eol):"a=fmtp:".concat(I).concat(E).concat(Object.keys(U.parameters).map(ce=>"".concat(ce,"=").concat(U.parameters[ce])).join(";")).concat(this.eol)}printRtpMap(I,U){return U?"a=rtpmap:".concat(I).concat(E).concat(U.encodingName,"/").concat(U.clockRate).concat(U.encodingParameters?"/".concat(U.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(I,U){let G="a=rtcp-fb:".concat(I).concat(E),ce=U;return"trr-int"===ce.type?G+="ttr-int".concat(E).concat(ce.interval):(G+="".concat(ce.type),ce.parameter&&(G+="".concat(E).concat(ce.parameter),ce.additional&&(G+="".concat(E).concat(ce.additional)))),G+this.eol}printPtime(I){return void 0===I?"":"a=ptime:".concat(I).concat(this.eol)}printMaxPtime(I){return void 0===I?"":"a=maxptime:".concat(I).concat(this.eol)}printDirection(I){return void 0===I?"":"a=".concat(I).concat(this.eol)}printSSRC(I){return I.map(U=>Object.keys(U.attributes).map(G=>"a=ssrc:".concat(U.ssrcId.toString(10)).concat(E).concat(G).concat(U.attributes[G]?":".concat(U.attributes[G]):"").concat(this.eol)).join("")).join("")}printRTCPMux(I){return void 0===I?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(I){return void 0===I?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(I){return void 0===I?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(I){if(void 0===I)return"";let U="a=rtcp:".concat(I.port);return I.netType&&(U+="".concat(E).concat(I.netType)),I.addressType&&(U+="".concat(E).concat(I.addressType)),I.address&&(U+="".concat(E).concat(I.address)),U+this.eol}printMSId(I){return I.map(U=>"a=msid:".concat(U.id).concat(U.appdata?"".concat(E).concat(U.appdata):"").concat(this.eol)).join("")}printImageattr(I){return I.map(U=>"a=imageattr:".concat(U).concat(this.eol)).join("")}printRid(I){return I.map(U=>{let G="a=rid:".concat(U.id).concat(E).concat(U.direction);return U.payloads&&(G+="".concat(E,"pt=").concat(U.payloads.join(","))),U.params.length>0&&(G+="".concat(E).concat(U.params.map(ce=>"depend"===ce.type?"depend=".concat(ce.rids.join(",")):"".concat(ce.type,"=").concat(ce.val)).join(";"))),G+this.eol}).join("")}printSimulcast(I){return void 0===I?"":"a=simulcast:".concat(I).concat(this.eol)}printSCTPPort(I){return void 0===I?"":"a=sctp-port:".concat(I).concat(this.eol)}printMaxMessageSize(I){return void 0===I?"":"a=max-message-size:".concat(I).concat(this.eol)}printMid(I){return void 0===I?"":"a=mid:".concat(I).concat(this.eol)}printSSRCGroups(I){return I.map(U=>"a=ssrc-group:".concat(U.semantic).concat(U.ssrcIds.map(G=>"".concat(E).concat(G.toString(10))).join("")).concat(this.eol)).join("")}}function xe(ue){return(new Se).parse(ue)}function gt(ue,I){return(new It).print(ue,I)}}},a={};function l(d){if(a[d])return a[d].exports;var h=a[d]={exports:{}};return r[d](h,h.exports,l),h.exports}return l.d=(d,h)=>{for(var f in h)l.o(h,f)&&!l.o(d,f)&&Object.defineProperty(d,f,{enumerable:!0,get:h[f]})},l.o=(d,h)=>Object.prototype.hasOwnProperty.call(d,h),l.r=d=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})},l(8)})()}($_);var mn=$_.exports;function rs(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function uy(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?rs(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):rs(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function aN(s){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;const{filterRTX:l,filterVideoFec:d,filterAudioFec:h,filterAudioCodec:f,filterVideoCodec:m}=i,{useXR:g}=r;let E=[],y=[],C=[],b=[],O=!1,P=!1;if(mn.parse(s).mediaDescriptions.forEach(D=>{a&&a!==D.attributes.direction||("video"!==D.media.mediaType||O||(y=D.attributes.payloads,b=D.attributes.extmaps,O=!0),"audio"!==D.media.mediaType||P||(E=D.attributes.payloads,C=D.attributes.extmaps,P=!0))}),!b||0===y.length)throw new Error("Cannot get video capabilities from SDP.");if(!C||0===E.length)throw new Error("Cannot get audio capabilities from SDP.");return y.forEach(D=>{var L;null!==(L=D.rtpMap)&&void 0!==L&&L.clockRate&&(D.rtpMap.clockRate=parseInt(D.rtpMap.clockRate)),g&&D.rtcpFeedbacks.push({type:"rrtr"})}),E.forEach(D=>{var L;null!==(L=D.rtpMap)&&void 0!==L&&L.clockRate&&(D.rtpMap.clockRate=parseInt(D.rtpMap.clockRate)),g&&D.rtcpFeedbacks.push({type:"rrtr"})}),l&&(E=E.filter(D=>{var L;return"rtx"!==(null===(L=D.rtpMap)||void 0===L?void 0:L.encodingName.toLowerCase())}),y=y.filter(D=>{var L;return"rtx"!==(null===(L=D.rtpMap)||void 0===L?void 0:L.encodingName.toLowerCase())})),d&&(y=y.filter(D=>{var L;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(L=D.rtpMap)||void 0===L?void 0:L.encodingName)||"")})),h&&(E=E.filter(D=>{var L;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(L=D.rtpMap)||void 0===L?void 0:L.encodingName)||"")})),f&&(null==f?void 0:f.length)>0&&(E=E.filter(D=>{var L;return we(f).call(f,(null===(L=D.rtpMap)||void 0===L?void 0:L.encodingName.toLowerCase())||"")})),m&&(null==m?void 0:m.length)>0&&(y=y.filter(D=>{var L;return we(m).call(m,(null===(L=D.rtpMap)||void 0===L?void 0:L.encodingName.toLowerCase())||"")})),{audioCodecs:E,videoCodecs:y,audioExtensions:C,videoExtensions:b}}function yp(s){const i=mn.parse(s);let r,a;for(const l of i.mediaDescriptions){if(!r){const d=l.attributes.iceUfrag,h=l.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");r={iceUfrag:d,icePwd:h}}if(!a){const d=l.attributes.fingerprints;d.length>0&&(a={fingerprints:d})}}if(!a&&i.attributes.fingerprints.length>0&&(a={fingerprints:i.attributes.fingerprints}),!a||!r)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:r,dtlsParameters:a}}function _2(s,i){const r=[],a=s.attributes.ssrcGroups.filter(h=>"FID"===h.semantic),l=s.attributes.ssrcGroups.find(h=>"SIM"===h.semantic),d=s.attributes.ssrcs;if(l)l.ssrcIds.forEach(h=>{var f;const m=null===(f=a.find(g=>g.ssrcIds[0]===h))||void 0===f?void 0:f.ssrcIds[1];r.push({ssrcId:h,rtx:i?m:void 0})});else if(a.length>0){const f=a[0].ssrcIds[1];r.push({ssrcId:a[0].ssrcIds[0],rtx:i?f:void 0})}else{if(0===d.length)throw new Error("No ssrcs found on local media description.");r.push({ssrcId:d[0].ssrcId})}return r}function cN(s,i){const{cname:r}=s;let a;i&&i.ip&&"number"==typeof i.port?(a=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:i.ip,port:i.port.toString(),type:"host",extension:{}}],R.debug("Using remote candidate from AP ".concat(i.ip,":").concat(i.port)),i.ip6&&(a.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:i.ip6,port:i.port.toString(),type:"host",extension:{}}),R.debug("Using IPV6 remote candidate from AP ".concat(i.ip6,":").concat(i.port)))):a=s.iceParameters.candidates.map(f=>({foundation:f.foundation,componentId:"1",transport:f.protocol,priority:f.priority.toString(),connectionAddress:f.ip,port:f.port.toString(),type:f.type,extension:{}}));const l={fingerprints:s.dtlsParameters.fingerprints.map(f=>({hashFunction:f.algorithm,fingerprint:f.fingerprint}))},d={iceUfrag:s.iceParameters.iceUfrag,icePwd:s.iceParameters.icePwd};let h;switch(s.dtlsParameters.role){case"server":h="passive";break;case"client":h="active";break;case"auto":h="actpass"}return{dtlsParameters:l,iceParameters:d,candidates:a,rtpCapabilities:Nb(s.rtpCapabilities),setup:h,cname:r}}function os(s,i,r){const a=[],l=[];return s.forEach(d=>{let{ssrcId:h,rtx:f}=d;const m=Vt(8,"track-"),g={ssrcId:h,attributes:uy({label:m,mslabel:r=r||Vt(10,""),msid:"".concat(r," ").concat(m)},i&&{cname:i})};if(a.push(g),void 0!==f){const E={ssrcId:f,attributes:uy({label:m,mslabel:r,msid:"".concat(r," ").concat(m)},i&&{cname:i})};a.push(E),l.push({semantic:"FID",ssrcIds:[h,f]})}}),s.length>1&&l.push({semantic:"SIM",ssrcIds:s.map(d=>{let{ssrcId:h}=d;return h})}),{ssrcs:a,ssrcGroups:l}}function zl(s,i){i instanceof vt&&s.attributes.payloads.forEach(r=>{var a;const l=null===(a=r.rtpMap)||void 0===a?void 0:a.encodingName.toLowerCase();if(!l||-1===["opus","pcmu","pcma","g722"].indexOf(l))return;r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.minptime="10",r.fmtp.parameters.useinbandfec="1";const d=i._encoderConfig;d&&"pcmu"!==l&&"pcma"!==l&&"g722"!==l&&(d.bitrate&&!Pt()&&(r.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(r.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),r.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"))})}function Ab(s){const i=s.attributes.unrecognized.findIndex(r=>"x-google-flag"===r.attField&&"conference"===r.attValue);-1!==i&&s.attributes.unrecognized.splice(i,1)}function Db(s,i){var r;if(!(i instanceof Ye&&i._encoderConfig&&-1===i._hints.indexOf(Qt.SCREEN_TRACK)))return;const a=i._encoderConfig;Rt().supportMinBitrate&&a.bitrateMin&&s.attributes.payloads.forEach(l=>{var d,h;we(d=["h264","h265","vp8","vp9","av1"]).call(d,(null===(h=l.rtpMap)||void 0===h?void 0:h.encodingName.toLowerCase())||"")&&(l.fmtp||(l.fmtp={parameters:{}}),l.fmtp.parameters["x-google-min-bitrate"]="".concat(a.bitrateMin))}),Rt().supportMinBitrate&&!we(r=i._hints).call(r,Qt.LOW_STREAM)&&a.bitrateMax&&s.attributes.payloads.forEach(l=>{var d,h;we(d=["h264","h265","vp8","vp9","av1"]).call(d,(null===(h=l.rtpMap)||void 0===h?void 0:h.encodingName.toLowerCase())||"")&&(l.fmtp||(l.fmtp={parameters:{}}),l.fmtp.parameters["x-google-start-bitrate"]="".concat(H("X_GOOGLE_START_BITRATE")||Math.floor(a.bitrateMax)))})}function m2(s){if("video"!==s.media.mediaType)return;const i=pt();if(i.name!==St.SAFARI&&i.os!==vi.IOS)return;const r=s.attributes.extmaps.findIndex(a=>/video-orientation/g.test(a.extensionName));-1!==r&&s.attributes.extmaps.splice(r,1)}function ao(s,i,r){if(!i)return;let a,l;if("video"===s.media.mediaType?(a=r.videoExtensions,l=r.videoCodecs):(a=r.audioExtensions,l=r.audioCodecs),!0===i.twcc){const d=a.find(h=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===h.extensionName);d&&(s.attributes.extmaps.find(f=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===f.extensionName)||s.attributes.extmaps.push({entry:d.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),(f=l,m=s.attributes.payloads,m.filter(g=>!!f.find(E=>E.payloadType===g.payloadType&&!!E.rtcpFeedbacks.find(y=>"transport-cc"===y.type)))).forEach(f=>{f.rtcpFeedbacks.find(m=>"transport-cc"===m.type)||f.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(!1===i.twcc){const d=s.attributes.extmaps.findIndex(h=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===h.extensionName);-1!==d&&s.attributes.extmaps.splice(d,1),s.attributes.payloads.forEach(h=>{const f=h.rtcpFeedbacks.findIndex(m=>"transport-cc"===m.type);-1!==f&&h.rtcpFeedbacks.splice(f,1)})}var f,m;if(!0===i.remb){const d=a.find(h=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===h.extensionName);d&&(s.attributes.extmaps.find(f=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===f.extensionName)||s.attributes.extmaps.push({entry:d.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(f,m){return m.filter(g=>!!f.find(E=>E.payloadType===g.payloadType&&!!E.rtcpFeedbacks.find(y=>"goog-remb"===y.type)))}(l,s.attributes.payloads).forEach(f=>{f.rtcpFeedbacks.find(m=>"goog-remb"===m.type)||f.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(!1===i.remb){const d=s.attributes.extmaps.findIndex(h=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===h.extensionName);-1!==d&&s.attributes.extmaps.splice(d,1),s.attributes.payloads.forEach(h=>{const f=h.rtcpFeedbacks.findIndex(m=>"goog-remb"===m.type);-1!==f&&h.rtcpFeedbacks.splice(f,1)})}}function J_(s,i,r){if(Pt()||"video"!==s.media.mediaType||!(i instanceof Ye)||"vp9"!==r&&"vp8"!==r||"vp8"===r&&!H("SIMULCAST")||void 0===i._scalabilityMode||i._scalabilityMode.numSpatialLayers<=1)return;const a="vp8"===r?2:i._scalabilityMode.numSpatialLayers,l=s.attributes.ssrcs[0],d=s.attributes.ssrcGroups.find(f=>"FID"===f.semantic&&f.ssrcIds[0]===l.ssrcId),h={semantic:"SIM",ssrcIds:[l.ssrcId]};for(let f=1;f<a;f++)s.attributes.ssrcs.push({ssrcId:l.ssrcId+f,attributes:Pn(l.attributes)}),h.ssrcIds.push(l.ssrcId+f),d&&(s.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+f,attributes:Pn(l.attributes)}),s.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[l.ssrcId+f,d.ssrcIds[1]+f]}));s.attributes.ssrcGroups.unshift(h)}function lN(){return Ob.apply(this,arguments)}function Ob(){return Ob=x(function*(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{filterRTX:r,filterVideoFec:a,filterAudioFec:l,filterAudioCodec:d,filterVideoCodec:h}=s,{useXR:f}=i,m=new RTCPeerConnection;m.addTransceiver("video",{direction:"sendonly"}),m.addTransceiver("audio",{direction:"sendonly"}),m.addTransceiver("video",{direction:"recvonly"}),m.addTransceiver("audio",{direction:"recvonly"});const g=(yield m.createOffer()).sdp,E=aN(g,{filterRTX:r,filterVideoFec:a,filterAudioFec:l,filterAudioCodec:d,filterVideoCodec:h},{useXR:f},"sendonly"),y=aN(g,{filterRTX:r,filterVideoFec:a,filterAudioFec:l,filterAudioCodec:d,filterVideoCodec:h},{useXR:f},"recvonly"),C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(hy(E,y,"videoExtensions",C,b,O),hy(E,y,"videoCodecs",C,b,O),hy(E,y,"audioExtensions",C,b,O),hy(E,y,"audioCodecs",C,b,O),H("RAISE_H264_BASELINE_PRIORITY")){const P=O.videoCodecs.findIndex(D=>{var L,B;return"h264"===(null===(L=D.rtpMap)||void 0===L?void 0:L.encodingName.toLocaleLowerCase())&&"42001f"===(null===(B=D.fmtp)||void 0===B?void 0:B.parameters["profile-level-id"])});if(-1!==P){const D=O.videoCodecs.findIndex(L=>{var B;return"h264"===(null===(B=L.rtpMap)||void 0===B?void 0:B.encodingName.toLocaleLowerCase())});if(D<P){R.debug("raising H264 baseline profile priority");const L=O.videoCodecs[P];O.videoCodecs.splice(P,1),O.videoCodecs.splice(D,0,L)}-1!==D&&(b.videoCodecs=b.videoCodecs.filter(L=>{var B,V;return!("h264"===(null===(B=L.rtpMap)||void 0===B?void 0:B.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(V=L.fmtp)||void 0===V?void 0:V.parameters["profile-level-id"]))})),-1!==D&&H("FILTER_SEND_H264_BASELINE")&&(C.videoCodecs=C.videoCodecs.filter(L=>{var B,V;return!("h264"===(null===(B=L.rtpMap)||void 0===B?void 0:B.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(V=L.fmtp)||void 0===V?void 0:V.parameters["profile-level-id"]))}))}}try{m.close()}catch(P){}return{send:C,recv:b,sendrecv:O}}),Ob.apply(this,arguments)}function hy(s,i,r,a,l,d){if("videoExtensions"===r||"audioExtensions"===r){const h=[];return s[r].forEach(f=>{i[r].some((m,g)=>{if(f.entry===m.entry&&f.extensionName===m.extensionName)return h.push(g),!0})?d[r].push(f):a[r].push(f)}),void i[r].forEach((f,m)=>{-1===h.indexOf(m)&&l[r].push(f)})}if("videoCodecs"===r||"audioCodecs"===r){const h=[];return s[r].forEach(f=>{i[r].some((m,g)=>{if(f.payloadType===m.payloadType&&JSON.stringify(f)===JSON.stringify(m))return h.push(g),!0})?d[r].push(f):a[r].push(f)}),void i[r].forEach((f,m)=>{-1===h.indexOf(m)&&l[r].push(f)})}}function Nb(s){const{send:i,recv:r,sendrecv:a}=s;if(!a){if(!i||!r)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:i,recv:r}}let l,d;return i?(l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},l.audioCodecs=[...i.audioCodecs,...a.audioCodecs],l.videoCodecs=[...i.videoCodecs,...a.videoCodecs],l.audioExtensions=[...i.audioExtensions,...a.audioExtensions],l.videoExtensions=[...i.videoExtensions,...a.videoExtensions]):l=a,r?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...r.audioCodecs,...a.audioCodecs],d.videoCodecs=[...r.videoCodecs,...a.videoCodecs],d.audioExtensions=[...r.audioExtensions,...a.audioExtensions],d.videoExtensions=[...r.videoExtensions,...a.videoExtensions]):d=a,{send:l,recv:d}}function ks(s){"audio"===s.media.mediaType&&s.attributes.payloads.filter(i=>{var r;return"opus"===(null===(r=i.rtpMap)||void 0===r?void 0:r.encodingName.toLowerCase())}).forEach(i=>{i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"})}function py(s){s.mediaDescriptions.forEach(i=>{"video"!==i.media.mediaType&&"audio"!==i.media.mediaType||i.attributes.payloads.forEach(r=>{-1===r.rtcpFeedbacks.findIndex(a=>"rrtr"===a.type)&&r.rtcpFeedbacks.push({type:"rrtr"})})})}function $i(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function lt(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?$i(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):$i(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function it(s){if(Array.isArray(s))return s.map(r=>r);if(!dN(s))return s;const i={};for(const r in s){const a=s[r];i[r]=dN(a)||Array.isArray(a)?it(a):a}return i}function dN(s){return!("object"!=typeof s||Array.isArray(s)||!s)}class vp{constructor(i){T(this,"input",[]),T(this,"size",void 0),this.size=i}add(i){this.input.push(i),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const Tr={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Yl={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Tr,remoteCandidate:Tr}},Ls={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},uN={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},Hi={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},hN={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function ti(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function pN(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?ti(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):ti(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class Cp{constructor(i,r){var a=this;T(this,"onFirstVideoReceived",void 0),T(this,"onFirstVideoDecoded",void 0),T(this,"onFirstAudioReceived",void 0),T(this,"onFirstVideoDecodedTimeout",void 0),T(this,"onFirstAudioDecoded",void 0),T(this,"onSelectedLocalCandidateChanged",void 0),T(this,"onSelectedRemoteCandidateChanged",void 0),T(this,"videoIsReady",!1),T(this,"videoIsReady2",{}),T(this,"pc",void 0),T(this,"options",void 0),T(this,"intervalTimer",void 0),T(this,"stats",it(Yl)),T(this,"isFirstVideoReceived",{}),T(this,"isFirstVideoDecoded",{}),T(this,"isFirstAudioReceived",{}),T(this,"isFirstAudioDecoded",{}),T(this,"isFirstVideoDecodedTimeout",{}),T(this,"lossRateWindowStats",[]),this.pc=i,this.options=r,this.intervalTimer=window.setInterval(x(function*(){a.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new q(i=>{i({local:pN({},Tr),remote:pN({},Tr)})})}setVideoIsReady(i){this.videoIsReady=i}setVideoIsReady2(i,r){this.videoIsReady2[i]=r}getVideoIsReady(i){return this.videoIsReady2[i]||!1}setIsFirstAudioDecoded(i){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(i){this.lossRateWindowStats.push(i),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,a=["videoSend","audioSend","videoRecv","audioRecv"];let l=0,d=0,h=0,f=0;for(const m of a)i[m].forEach((g,E)=>{if(!this.lossRateWindowStats[r-1][m][E]||!this.lossRateWindowStats[0][m][E])return;const y=this.lossRateWindowStats[r-1][m][E].packets-this.lossRateWindowStats[0][m][E].packets,C=this.lossRateWindowStats[r-1][m][E].packetsLost-this.lossRateWindowStats[0][m][E].packetsLost;"videoSend"===m||"audioSend"===m?(l+=y,h+=C):(d+=y,f+=C),g.packetLostRate=Number.isNaN(y)||Number.isNaN(y)||y<=0||C<=0?0:C/(y+C)});i.sendPacketLossRate=l<=0||h<=0?0:h/(l+h),i.recvPacketLossRate=d<=0||f<=0?0:f/(d+f)}}function fN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function fy(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?fN(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):fN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class g2 extends Cp{constructor(){super(...arguments),T(this,"_stats",Yl),T(this,"lastDecodeVideoReceiverStats",new Map)}updateStats(){var i=this;return x(function*(){const r=yield i._getStats(),a=i.statsResponsesToObjects(r);i._stats=it(Yl);const l=a.filter(h=>"ssrc"===h.type);i.processSSRCStats(l);const d=a.find(h=>"VideoBwe"===h.type);d&&i.processBandwidthStats(d),i._stats.timestamp=Date.now(),i.calcLossRate(i._stats),i.stats=i._stats})()}processBandwidthStats(i){this._stats.bitrate={actualEncoded:Number(i.googActualEncBitrate),targetEncoded:Number(i.googTargetEncBitrate),retransmit:Number(i.googRetransmitBitrate),transmit:Number(i.googTransmitBitrate)},this._stats.sendBandwidth=Number(i.googAvailableSendBandwidth)}processSSRCStats(i){i.forEach(r=>{var a;const l=we(a=r.id).call(a,"send");switch("".concat(r.mediaType,"_").concat(l?"send":"recv")){case"video_send":{const d=it(uN);d.codec=r.googCodecName,d.adaptionChangeReason="none",r.googCpuLimitedResolution&&(d.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(d.adaptionChangeReason="bandwidth"),d.avgEncodeMs=Number(r.googAvgEncodeMs),d.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},d.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},d.firsCount=Number(r.googFirReceived),d.nacksCount=Number(r.googNacksReceived),d.plisCount=Number(r.googPlisReceived),d.frameCount=Number(r.framesEncoded),d.bytes=Number(r.bytesSent),d.packets=Number(r.packetsSent),d.packetsLost=Number(r.packetsLost),d.ssrc=Number(r.ssrc),d.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(d),this._stats.rtt=d.rttMs;break}case"video_recv":{const d=it(Ls),h=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(d.codec=r.googCodecName,d.targetDelayMs=Number(r.googTargetDelayMs),d.renderDelayMs=Number(r.googRenderDelayMs),d.currentDelayMs=Number(r.googCurrentDelayMs),d.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),d.decodeMs=Number(r.googDecodeMs),d.maxDecodeMs=Number(r.googMaxDecodeMs),d.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},d.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},d.decodeFrameRate=Number(r.googFrameRateDecoded),d.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},d.jitterBufferMs=Number(r.googJitterBufferMs),d.firsCount=Number(r.googFirsSent),d.nacksCount=Number(r.googNacksSent),d.plisCount=Number(r.googPlisSent),d.framesDecodeCount=Number(r.framesDecoded),d.bytes=Number(r.bytesReceived),d.packets=Number(r.packetsReceived),d.packetsLost=Number(r.packetsLost),d.ssrc=Number(r.ssrc),d.packets>0&&!this.isFirstVideoReceived[d.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(d.ssrc),this.isFirstVideoReceived[d.ssrc]=!0),d.framesDecodeCount>0&&!this.isFirstVideoDecoded[d.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(d.ssrc,d.decodedFrame.width,d.decodedFrame.height),this.isFirstVideoDecoded[d.ssrc]=!0),h){const f=h.stats,m=Date.now()-h.lts;d.framesDecodeFreezeTime=f.framesDecodeFreezeTime,d.framesDecodeInterval=f.framesDecodeInterval,d.framesDecodeCount>f.framesDecodeCount&&this.isFirstVideoDecoded[d.ssrc]?(h.lts=Date.now(),d.framesDecodeInterval=m,d.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?d.framesDecodeFreezeTime+=d.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):d.framesDecodeCount<h.stats.framesDecodeCount&&(d.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(d.ssrc,{stats:fy({},d),lts:Date.now()}),this._stats.videoRecv.push(d);break}case"audio_recv":{const d=it(hN);d.codec=r.googCodecName,d.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,d.decodingCNG=Number(r.googDecodingCNG),d.decodingCTN=Number(r.googDecodingCTN),d.decodingCTSG=Number(r.googDecodingCTSG),d.decodingNormal=Number(r.googDecodingNormal),d.decodingPLC=Number(r.googDecodingPLC),d.decodingPLCCNG=Number(r.googDecodingPLCCNG),d.expandRate=Number(r.googExpandRate),d.accelerateRate=Number(r.googAccelerateRate),d.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),d.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),d.speechExpandRate=Number(r.googSpeechExpandRate),d.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),d.jitterBufferMs=Number(r.googJitterBufferMs),d.jitterMs=Number(r.googJitterReceived),d.bytes=Number(r.bytesReceived),d.packets=Number(r.packetsReceived),d.packetsLost=Number(r.packetsLost),d.ssrc=Number(r.ssrc),d.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),d.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),d.receivedFrames>0&&!this.isFirstAudioReceived[d.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(d.ssrc),this.isFirstAudioReceived[d.ssrc]=!0),d.decodingNormal>0&&!this.isFirstAudioDecoded[d.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(d.ssrc),this.isFirstAudioDecoded[d.ssrc]=!0),this._stats.audioRecv.push(d);break}case"audio_send":{const d=it(Hi);d.codec=r.googCodecName,d.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,d.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),d.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),d.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),d.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),d.bytes=Number(r.bytesSent),d.packets=Number(r.packetsSent),d.packetsLost=Number(r.packetsLost),d.ssrc=Number(r.ssrc),d.rttMs=Number(r.googRtt||0),this._stats.rtt=d.rttMs,this._stats.audioSend.push(d);break}}})}_getStats(){return new q((i,r)=>{this.pc.getStats(i,r)})}statsResponsesToObjects(i){const r=[];return i.result().forEach(a=>{const l={id:a.id,timestamp:a.timestamp.valueOf().toString(),type:a.type};a.names().forEach(d=>{l[d]=a.stat(d)}),r.push(l)}),r}}function Pb(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Yc(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?Pb(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Pb(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class X_ extends Cp{constructor(){super(...arguments),T(this,"_stats",Yl),T(this,"report",void 0),T(this,"lastDecodeVideoReceiverStats",new Map),T(this,"lastVideoFramesRecv",new Map),T(this,"lastVideoFramesSent",new Map),T(this,"lastVideoFramesDecode",new Map),T(this,"lastVideoJBDelay",new Map),T(this,"lastAudioJBDelay",new Map),T(this,"mediaBytesSent",new Map),T(this,"mediaBytesRetransmit",new Map),T(this,"mediaBytesTargetEncode",new Map),T(this,"lastEncoderMs",new Map)}updateStats(){var i=this;return x(function*(){i.report=yield i.pc.getStats(),i._stats=it(Yl),i.report.forEach(r=>{switch(r.type){case mr.OUTBOUND:case mr.INBOUND:{const a=r.mediaType||r.kind,l=!a&&"frameWidth"in r,d=!a&&!("frameWidth"in r);r.type===mr.OUTBOUND?"audio"===a||d?i.processAudioOutboundStats(r):("video"===a||l)&&i.processVideoOutboundStats(r):r.type===mr.INBOUND&&("audio"===a||d?i.processAudioInboundStats(r):("video"===a||l)&&i.processVideoInboundStats(r));break}case mr.TRANSPORT:{const a=i.report.get(r.selectedCandidatePairId);a&&i.processCandidatePairStats(a);break}case mr.CANDIDATE_PAIR:r.selected&&i.processCandidatePairStats(r)}}),i.updateSendBitrate(),i._stats.timestamp=Date.now(),i.calcLossRate(i._stats),i.stats=i._stats})()}getSelectedCandidatePair(){var i=this;return x(function*(){const r=yield i.pc.getStats(),a={local:Yc({},Tr),remote:Yc({},Tr)};return r.forEach(l=>{let d;if(l.type===mr.TRANSPORT&&(d=r.get(l.selectedCandidatePairId)),l.type===mr.CANDIDATE_PAIR&&l.selected&&(d=l),d){const h=(f,m)=>{f.type=m.type,f.id=m.id,m.address&&(f.address=m.address),m.candidateType&&(f.candidateType=m.candidateType),m.port&&(f.port=m.port),m.priority&&(f.priority=m.priority),m.protocol&&(f.protocol=m.protocol),m.relayProtocol&&(f.relayProtocol=m.relayProtocol)};if(d.localCandidateId){const f=r.get(d.localCandidateId);f&&h(a.local,f)}if(d.remoteCandidateId){const f=r.get(d.remoteCandidateId);f&&h(a.remote,f)}}}),a})()}processCandidatePairStats(i){if(this._stats.sendBandwidth=i.availableOutgoingBitrate||0,i.currentRoundTripTime&&(this._stats.rtt=1e3*i.currentRoundTripTime),this._stats.videoSend.forEach(r=>{i.currentRoundTripTime&&(r.rttMs=1e3*i.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{i.currentRoundTripTime&&(r.rttMs=1e3*i.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=i.id,i.localCandidateId){const r=this.report.get(i.localCandidateId);r&&this.processCandidateStats(r)}if(i.remoteCandidateId){const r=this.report.get(i.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(i){let r;i.type===mr.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),i.type===mr.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=i.type,r.id=i.id,i.address&&(r.address=i.address),i.candidateType&&(r.candidateType=i.candidateType),i.port&&(r.port=i.port),i.priority&&(r.priority=i.priority),i.protocol&&(r.protocol=i.protocol),i.relayProtocol&&(r.relayProtocol=i.relayProtocol),i.type===mr.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Yc({},r),Yc({},this.stats.selectedCandidatePair.localCandidate)),i.type===mr.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Yc({},r),Yc({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(i){let r=this._stats.audioRecv.find(a=>a.ssrc===i.ssrc);r||(r=it(hN),this._stats.audioRecv.push(r)),r.ssrc=i.ssrc,r.packets=i.packetsReceived,r.packetsLost=i.packetsLost,r.bytes=i.bytesReceived,r.jitterMs=1e3*i.jitter,this.processAudioTrackReceiverStats(i,i.trackId,r),i.codecId&&(r.codec=this.getCodecFromCodecStats(i.codecId)),r.receivedFrames||(r.receivedFrames=i.packetsReceived),r.droppedFrames||(r.droppedFrames=i.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),"number"==typeof i.concealedSamples&&(r.concealedSamples=i.concealedSamples)}processVideoInboundStats(i){let r=this._stats.videoRecv.find(h=>h.ssrc===i.ssrc);r||(r=it(Ls),this._stats.videoRecv.push(r)),r.ssrc=i.ssrc,r.packets=i.packetsReceived,r.packetsLost=i.packetsLost,r.bytes=i.bytesReceived,r.firsCount=i.firCount,r.nacksCount=i.nackCount,r.plisCount=i.pliCount,r.framesDecodeCount=i.framesDecoded,r.totalInterFrameDelay=i.totalInterFrameDelay,r.totalSquaredInterFrameDelay=i.totalSquaredInterFrameDelay;const a=this.lastDecodeVideoReceiverStats.get(r.ssrc),l=this.lastVideoFramesDecode.get(r.ssrc),d=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,f=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,f),this.isFirstVideoDecoded[r.ssrc]=!0}if(a){const h=a.stats,f=d-a.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&f>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(a.lts=Date.now(),r.framesDecodeInterval=f,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(i.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(i.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),i.framesDecoded&&i.qpSum&&(r.qpSumPerFrame=a.stats.framesDecodeCount>i.framesDecoded?i.qpSum/i.framesDecoded:(i.qpSum-a.qpSum)/(i.framesDecoded-a.stats.framesDecodeCount))}l&&d-l.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-l.count)/((d-l.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:r.decodeFrameRate})):l?r.decodeFrameRate=l.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:0}),i.totalDecodeTime&&(r.decodeMs=1e3*i.totalDecodeTime),this.processVideoTrackReceiverStats(i,i.trackId,r),i.codecId&&(r.codec=this.getCodecFromCodecStats(i.codecId)),i.framerateMean&&(r.framesRateFirefox=i.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:Yc({},r),lts:a?a.lts:Date.now(),qpSum:i.qpSum})}processVideoOutboundStats(i){let r=this._stats.videoSend.find(l=>l.ssrc===i.ssrc);r||(r=it(uN),this._stats.videoSend.push(r));const a=this.mediaBytesSent.get(i.ssrc);if(a)a.add(i.bytesSent);else{const l=new vp(10);l.add(i.bytesSent),this.mediaBytesSent.set(i.ssrc,l)}if(void 0!==i.retransmittedBytesSent){const l=this.mediaBytesRetransmit.get(i.ssrc);if(l)l.add(i.retransmittedBytesSent);else{const d=new vp(10);d.add(i.retransmittedBytesSent),this.mediaBytesRetransmit.set(i.ssrc,d)}}if(i.totalEncodedBytesTarget){const l=this.mediaBytesTargetEncode.get(i.ssrc);if(l)l.add(i.totalEncodedBytesTarget);else{const d=new vp(10);d.add(i.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(i.ssrc,d)}}if(r.ssrc=i.ssrc,r.bytes=i.bytesSent,r.packets=i.packetsSent,r.firsCount=i.firCount,r.nacksCount=i.nackCount,r.plisCount=i.pliCount,r.frameCount=i.framesEncoded,r.adaptionChangeReason=i.qualityLimitationReason,r.scalabilityMode=i.scalabilityMode,i.totalEncodeTime&&i.framesEncoded){const l=this.lastEncoderMs.get(i.ssrc);r.avgEncodeMs=!l||l.lastFrameCount>i.framesEncoded?1e3*i.totalEncodeTime/i.framesEncoded:1e3*(i.totalEncodeTime-l.lastEncoderTime)/(i.framesEncoded-l.lastFrameCount)}if(i.framesEncoded&&i.qpSum){const l=this.lastEncoderMs.get(i.ssrc);r.qpSumPerFrame=!l||l.lastFrameCount>i.framesEncoded?i.qpSum/i.framesEncoded:(i.qpSum-l.lastQpSum)/(i.framesEncoded-l.lastFrameCount)}if(this.lastEncoderMs.set(i.ssrc,{lastFrameCount:i.framesEncoded,lastEncoderTime:i.totalEncodeTime,lastQpSum:i.qpSum,lts:Date.now()}),i.codecId&&(r.codec=this.getCodecFromCodecStats(i.codecId)),i.mediaSourceId&&this.processVideoMediaSource(i.mediaSourceId,r),this.processVideoTrackSenderStats(i,i.trackId,r),i.remoteId)this.processRemoteInboundStats(i.remoteId,r);else{const l=this.findRemoteStatsId(i.ssrc,mr.REMOTE_INBOUND);l&&this.processRemoteInboundStats(l,r)}}processAudioOutboundStats(i){let r=this._stats.audioSend.find(a=>a.ssrc===i.ssrc);if(r||(r=it(Hi),this._stats.audioSend.push(r)),r.ssrc=i.ssrc,r.packets=i.packetsSent,r.bytes=i.bytesSent,i.mediaSourceId&&this.processAudioMediaSource(i.mediaSourceId,r),i.codecId&&(r.codec=this.getCodecFromCodecStats(i.codecId)),this.processAudioTrackSenderStats(i,i.trackId,r),i.remoteId)this.processRemoteInboundStats(i.remoteId,r);else{const a=this.findRemoteStatsId(i.ssrc,mr.REMOTE_INBOUND);a&&this.processRemoteInboundStats(a,r)}}findRemoteStatsId(i,r){var a;const l=Array.from(Ze(a=this.report).call(a)).find(d=>d.type===r&&d.ssrc===i);return l?l.id:null}processVideoMediaSource(i,r){const a=this.report.get(i);a&&a.width&&a.height&&a.framesPerSecond&&(r.inputFrame={width:a.width,height:a.height,frameRate:a.framesPerSecond})}processAudioMediaSource(i,r){const a=this.report.get(i);a&&(r.inputLevel=a.audioLevel)}processVideoTrackSenderStats(i,r,a){var l,d,h,f;const m=r?this.report.get(r):void 0,g=null!==(l=null==m?void 0:m.framesSent)&&void 0!==l?l:i.framesSent;if("number"!=typeof g)return;let E=null!==(d=null==m?void 0:m.frameWidth)&&void 0!==d?d:i.frameWidth,y=null!==(h=null==m?void 0:m.frameHeight)&&void 0!==h?h:i.frameHeight,C=null!==(f=null==m?void 0:m.framesPerSecond)&&void 0!==f?f:i.framesPerSecond;if("number"==typeof E&&"number"==typeof y||(E=0,y=0),null==C){const b=Date.now(),O=this.lastVideoFramesSent.get(a.ssrc);O&&b-O.lts>=800?(C=Math.round((g-O.count)/((b-O.lts)/1e3)),this.lastVideoFramesSent.set(a.ssrc,{count:g,lts:b,rate:C})):O?C=O.rate:this.lastVideoFramesSent.set(a.ssrc,{count:g,lts:b,rate:0})}a.sentFrame={width:E,height:y,frameRate:Math.max(0,C)}}processVideoTrackReceiverStats(i,r,a){var l,d,h,f,m;const g=r?this.report.get(r):void 0,E=null!==(l=null==g?void 0:g.framesReceived)&&void 0!==l?l:i.framesReceived,y=null!==(d=null==g?void 0:g.frameWidth)&&void 0!==d?d:i.frameWidth,C=null!==(h=null==g?void 0:g.frameHeight)&&void 0!==h?h:i.frameHeight,b=null!==(f=null==g?void 0:g.jitterBufferDelay)&&void 0!==f?f:i.jitterBufferDelay,O=null!==(m=null==g?void 0:g.jitterBufferEmittedCount)&&void 0!==m?m:i.jitterBufferEmittedCount;if("number"==typeof E){const P=this.lastVideoFramesRecv.get(a.ssrc),D=Date.now();a.framesReceivedCount=E;let L=0;P&&D-P.lts>=800?(L=Math.round((E-P.count)/((D-P.lts)/1e3)),this.lastVideoFramesRecv.set(a.ssrc,{count:E,lts:D,rate:L})):P?L=P.rate:this.lastVideoFramesRecv.set(a.ssrc,{count:E,lts:D,rate:0}),a.receivedFrame={width:y||0,height:C||0,frameRate:L||0},a.decodedFrame={width:y||0,height:C||0,frameRate:a.decodeFrameRate||0},a.outputFrame={width:y||0,height:C||0,frameRate:a.decodeFrameRate||0}}if(b&&O){const P=this.lastVideoJBDelay.get(a.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let D=P.jitterBufferMs;const L=O-P.jitterBufferEmittedCount;L>0&&(D=1e3*(b-P.jitterBufferDelay)/L),a.jitterBufferMs=D,a.currentDelayMs=Math.round(D),this.lastVideoJBDelay.set(a.ssrc,{jitterBufferDelay:b,jitterBufferEmittedCount:O,jitterBufferMs:a.currentDelayMs})}}processAudioTrackSenderStats(i,r,a){var l,d,h,f;const m=r?this.report.get(r):void 0,g=null!==(l=null!==(d=null==m?void 0:m.echoReturnLoss)&&void 0!==d?d:i.echoReturnLoss)&&void 0!==l?l:0,E=null!==(h=null!==(f=null==m?void 0:m.echoReturnLossEnhancement)&&void 0!==f?f:i.echoReturnLossEnhancement)&&void 0!==h?h:0;a.aecReturnLoss=g,a.aecReturnLossEnhancement=E}processAudioTrackReceiverStats(i,r,a){var l,d,h,f,m,g,E;const y=r?this.report.get(r):void 0,C=null!==(l=null==y?void 0:y.removedSamplesForAcceleration)&&void 0!==l?l:i.removedSamplesForAcceleration,b=null!==(d=null==y?void 0:y.totalSamplesReceived)&&void 0!==d?d:i.totalSamplesReceived,O=null!==(h=null==y?void 0:y.jitterBufferDelay)&&void 0!==h?h:i.jitterBufferDelay,P=null!==(f=null==y?void 0:y.jitterBufferEmittedCount)&&void 0!==f?f:i.jitterBufferEmittedCount,D=null!==(m=null==y?void 0:y.audioLevel)&&void 0!==m?m:null==i?void 0:i.audioLevel,L=null!==(g=null==y?void 0:y.totalSamplesDuration)&&void 0!==g?g:null==i?void 0:i.totalSamplesDuration,B=null!==(E=null==y?void 0:y.concealedSamples)&&void 0!==E?E:i.concealedSamples;if(C&&b&&(a.accelerateRate=C/b),O&&P){const J=this.lastAudioJBDelay.get(a.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let ae=J.jitterBufferMs;const z=P-J.jitterBufferEmittedCount;z>0&&(ae=1e3*(O-J.jitterBufferDelay)/z),a.jitterBufferMs=Math.round(ae),this.lastAudioJBDelay.set(a.ssrc,{jitterBufferDelay:O,jitterBufferEmittedCount:P,jitterBufferMs:a.jitterBufferMs})}a.outputLevel=D;let V=1920;L&&b&&(V=b/L/50,a.receivedFrames=Math.round(b/V)),B&&(a.droppedFrames=Math.round(B/V))}processRemoteInboundStats(i,r){const a=this.report.get(i);a&&(r.packetsLost=a.packetsLost,a.roundTripTime&&(r.rttMs=1e3*a.roundTripTime),a.jitter&&(r.jitterMs=1e3*a.jitter),a.timestamp&&(r.timestamp=a.timestamp))}getCodecFromCodecStats(i){const r=this.report.get(i);if(!r)return"";const a=r.mimeType.match(/\/(.*)$/);return a&&a[1]?a[1]:""}updateSendBitrate(){let i=0,r=null,a=null;this.mediaBytesSent.forEach(d=>{i+=d.diffMean()}),this.mediaBytesRetransmit.forEach(d=>{r=null===r?d.diffMean():r+d.diffMean()}),this.mediaBytesTargetEncode.forEach(d=>{a=null===a?d.diffMean():a+d.diffMean()}),this._stats.bitrate={actualEncoded:8*(null!==r?i-r:i)/(this.options.updateInterval/1e3),transmit:8*i/(this.options.updateInterval/1e3)},null!==r&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),null!==a&&(this._stats.bitrate.targetEncoded=8*a/(this.options.updateInterval/1e3))}}class Mb extends Cp{updateStats(){return q.resolve()}}function _y(s){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const d=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return d?d<76?new g2(s,{updateInterval:i,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:l}):new X_(s,{updateInterval:i,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:l}):(h=s,window.RTCStatsReport&&h.getStats()instanceof q?new X_(s,{updateInterval:i,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:l}):new Mb(s,{updateInterval:i,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:l}));var h}function kb(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function _N(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?kb(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):kb(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class Ii extends SE{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(i,r){super(i,r),T(this,"store",void 0),T(this,"peerConnection",void 0),T(this,"remoteSDP",void 0),T(this,"initialOffer",void 0),T(this,"statsFilter",void 0),T(this,"useRTX",!1),T(this,"localCapabilities",void 0),T(this,"localCandidateCount",0),T(this,"allCandidatesReceived",!1),T(this,"establishPromise",void 0),T(this,"mutex",new Gn("P2PConnection-mutex")),this.store=r,this.peerConnection=new RTCPeerConnection(Ii.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.statsFilter=_y(this.peerConnection,H("STATS_UPDATE_INTERVAL"),void 0,Pt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(){var i=this;return x(function*(){try{const r=yield i.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=yp(r.sdp),l=aN(r.sdp,{filterRTX:!i.useRTX,filterVideoFec:H("FILTER_VIDEO_FEC"),filterAudioFec:H("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return i.localCapabilities=l,i.initialOffer=r,_N(_N({},a),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:l},offerSDP:r.sdp})}catch(r){throw new ne(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}})()}connect(i,r,a,l,d,h){var f=this;return x(function*(){try{if(!f.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");f.remoteSDP=new class{constructor(g){T(this,"sessionDesc",void 0),T(this,"localCapabilities",void 0),T(this,"rtpCapabilities",void 0),T(this,"candidates",void 0),T(this,"iceParameters",void 0),T(this,"dtlsParameters",void 0),T(this,"setup",void 0),T(this,"currentMidIndex",void 0),T(this,"cname",void 0),g=Pn(g);const{remoteIceParameters:E,remoteDtlsParameters:y,candidates:C,remoteRTPCapabilities:b,remoteSetup:O,localCapabilities:P,cname:L}=g,B=mn.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=b,this.candidates=C,this.iceParameters=E,this.dtlsParameters=y,this.setup=O,this.localCapabilities=P,this.cname=L;for(let V=0;V<B.mediaDescriptions.length;V++){const J=B.mediaDescriptions[V];J.attributes.iceUfrag=E.iceUfrag,J.attributes.icePwd=E.icePwd,J.attributes.fingerprints=y.fingerprints,J.attributes.candidates=C,J.attributes.setup=O,"video"===J.media.mediaType&&(J.media.fmts=b.videoCodecs.map(ae=>ae.payloadType.toString(10)),J.attributes.payloads=b.videoCodecs,J.attributes.extmaps=b.videoExtensions),"audio"===J.media.mediaType&&(J.media.fmts=b.audioCodecs.map(ae=>ae.payloadType.toString(10)),J.attributes.payloads=b.audioCodecs,J.attributes.extmaps=b.audioExtensions),B.mediaDescriptions[V]=this.mungMediaDesc(J)}this.sessionDesc=B,this.currentMidIndex=B.mediaDescriptions.length-1}toString(){return mn.print(this.sessionDesc)}send(g,E,y){const{ssrcs:C,ssrcGroups:b}=os(E,this.cname),O=this.sessionDesc.mediaDescriptions.find(L=>g===ye.VIDEO?"video"===L.media.mediaType:"audio"===L.media.mediaType),P=C[0].attributes.label,D=C[0].attributes.mslabel;return O.attributes.ssrcs=O.attributes.ssrcs.concat(C),O.attributes.ssrcGroups=O.attributes.ssrcGroups.concat(b),{id:P,mslabel:D}}batchSend(g){return g.map(E=>{let{kind:y,ssrcMsg:C}=E;return this.send(y,C,void 0)})}stopSending(g){this.sessionDesc.mediaDescriptions.forEach(E=>{const y=[],C=[],b=[];E.attributes.ssrcs.forEach(O=>{we(g).call(g,O.attributes.label||"")?b.push(O):y.push(O)}),E.attributes.ssrcGroups.forEach(O=>{var P;we(P=b.map(D=>D.ssrcId)).call(P,O.ssrcIds[0])||C.push(O)}),E.attributes.ssrcs=y,E.attributes.ssrcGroups=C})}mute(g){const E=this.sessionDesc.mediaDescriptions.find(y=>y.attributes.mid===g);if(!E)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.mute."));E.attributes.direction="inactive"}unmute(g){const E=this.sessionDesc.mediaDescriptions.find(y=>y.attributes.mid===g);if(!E)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.unmute."));E.attributes.direction="sendonly"}receive(g,E,y){g.forEach((C,b)=>{const O=C._mediaStreamTrack,P=this.sessionDesc.mediaDescriptions.findIndex(L=>L.attributes.mid===O.kind),D=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[P],C);this.sessionDesc.mediaDescriptions[P]=D})}stopReceiving(g){}updateCandidates(g){g===fi.TCP?this.candidates.forEach(E=>{-1===this.candidates.findIndex(y=>"tcp"===y.transport&&y.connectionAddress===E.connectionAddress&&y.port===E.port)&&this.candidates.push(lt(lt({},E),{},{foundation:"tcpcandidate",priority:Number(E.priority)-1+"",transport:"tcp",port:Number(E.port)+90+""}))}):this.candidates=this.candidates.filter(E=>"tcp"!==E.transport);for(const E of this.sessionDesc.mediaDescriptions)E.attributes.candidates=this.candidates}restartICE(g){g=Pn(g),this.iceParameters=g,this.sessionDesc.mediaDescriptions.forEach(E=>{E.attributes.iceUfrag=g.iceUfrag,E.attributes.icePwd=g.icePwd})}predictReceivingMids(g){const E=[];for(let y=0;y<g;y++)E.push((this.currentMidIndex+y+1).toString(10));return E}mungRecvMediaDsec(g,E){const y=Pn(g);return zl(y,E),Db(y,E),y}updateRecvMedia(g,E){const y=this.sessionDesc.mediaDescriptions.findIndex(C=>C.attributes.mid===g);if(-1!==y){const C=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[y],E);this.sessionDesc.mediaDescriptions[y]=C}}bumpMid(g){this.currentMidIndex+=g}updateTrackLabel(g,E,y){const C=this.sessionDesc.mediaDescriptions.find(O=>g===ye.VIDEO?"video"===O.attributes.mid:"audio"===O.attributes.mid);if(C){const O=C.attributes.ssrcs.find(P=>P.attributes.label===E);var b;O&&(O.attributes.label=y,null===(b=O.attributes.msid)||void 0===b||b.replace(E,y))}}mungMediaDesc(g){const E=Pn(g);return Ab(E),function(y){const C=y.attributes.extmaps.find(b=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===b.extensionName);C&&y.attributes.extmaps.splice(y.attributes.extmaps.indexOf(C),1),y.attributes.payloads.forEach(b=>{const O=b.rtcpFeedbacks.findIndex(P=>"transport-cc"===P.type);-1!==O&&b.rtcpFeedbacks.splice(O,1)})}(E),E}getSSRC(g){for(const E of this.sessionDesc.mediaDescriptions)for(const y of E.attributes.ssrcs)if(y.attributes.label===g)return[y]}}({remoteIceParameters:i,remoteDtlsParameters:r,candidates:a,remoteRTPCapabilities:l.send,remoteSetup:d,localCapabilities:f.localCapabilities,sdkCodec:f.store.codec,cname:h});const m=f.remoteSDP.toString();yield f.peerConnection.setLocalDescription(f.initialOffer),yield f.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(m){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(m.toString()))}})()}send(i,r){var a=this;return is(function*(){const l=yield _t(a.mutex.lock());try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=i.map(C=>a.peerConnection.addTrack(C._mediaStreamTrack)),h=yield _t(a.peerConnection.createOffer()),f=mn.parse(h.sdp),m=i.map(C=>{const b=C._mediaStreamTrack,O=f.mediaDescriptions.find(P=>P.attributes.mid===b.kind);if(!O)throw new Error("Cannot extract ssrc from mediaDescription.");return function(P,D,L){const B=P.attributes.ssrcs.filter(J=>J.attributes.label===D),V=P.attributes.ssrcGroups;if(0===B.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(V&&B.length>1){const J=V.find(ae=>-1!==ae.ssrcIds.indexOf(B[0].ssrcId));return J?[{ssrcId:J.ssrcIds[0],rtx:L?J.ssrcIds[1]:void 0}]:[{ssrcId:B[0].ssrcId}]}return[{ssrcId:B[0].ssrcId}]}(O,b.id,a.useRTX)});let g;try{g=yield m}catch(C){throw d.forEach(b=>{Yt()&&b.replaceTrack(null),a.peerConnection.removeTrack(b)}),C}const E=a.mungSendOfferSDP(h.sdp,i);a.remoteSDP.receive(i,r,g);const y=a.remoteSDP.toString();return yield _t(a.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield _t(a.applySendEncodings(d,i)),yield _t(a.peerConnection.setRemoteDescription({type:"answer",sdp:y})),i.map((C,b)=>({localSSRC:m[b],id:C._mediaStreamTrack.id}))}catch(d){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{l()}})()}stopSending(i){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const a=r.peerConnection.getSenders().filter(h=>{var f;return-1!==i.indexOf((null===(f=h.track)||void 0===f?void 0:f.id)||"")});if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");a.map(h=>{Yt()&&h.replaceTrack(null),r.peerConnection.removeTrack(h)});const l=yield r.peerConnection.createOffer();yield r.peerConnection.setLocalDescription(l),r.remoteSDP.stopReceiving(i);const d=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(a.toString()))}})()}receive(i,r,a,l){var d=this;return x(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{id:h,mslabel:f}=d.remoteSDP.send(i,r,l),m=new q((y,C)=>{const b=setTimeout(()=>{C(new Error("Cannot receive track, id: ".concat(h)))},1e4),O=P=>{const D=pt();if(("Safari"===D.name&&11===Number(D.version)||Ci())&&P.track.id!==h&&P.streams[0].id===f){var L;const B=P.streams[0].getTracks()[0];return null===(L=d.remoteSDP)||void 0===L||L.updateTrackLabel(i,h,P.track.id),d.peerConnection.removeEventListener("track",O),clearTimeout(b),void y(B)}if(P.track.id===h)return d.peerConnection.removeEventListener("track",O),clearTimeout(b),void y(P.track)};d.peerConnection.addEventListener("track",O)}),g=d.remoteSDP.toString();yield d.peerConnection.setRemoteDescription({type:"offer",sdp:g});const E=yield d.peerConnection.createAnswer();return yield d.peerConnection.setLocalDescription(E),{track:yield m,id:h}}catch(h){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}stopReceiving(i){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.remoteSDP.stopSending(i);const a=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const l=yield r.peerConnection.createAnswer();yield r.peerConnection.setLocalDescription(l)}catch(a){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}})()}muteRemote(i){return x(function*(){})()}unmuteRemote(i){return x(function*(){})()}muteLocal(i){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const a=r.peerConnection.getSenders().filter(l=>{var d;return-1!==i.indexOf((null===(d=l.track)||void 0===d?void 0:d.id)||"")});if(a.length!==i.length)throw new Error("sender' length doesn't match mids' length.");a.map(l=>{if(Yt()&&l.track)l.track.enabled=!1;else{const d=l.getParameters();d.encodings.forEach(h=>h.active=!1),l.setParameters(d)}})}catch(a){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(a.toString()))}})()}unmuteLocal(i){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const a=r.peerConnection.getSenders().filter(h=>{var f;return-1!==i.indexOf((null===(f=h.track)||void 0===f?void 0:f.id)||"")});if(a.length!==i.length)throw new Error("Senders' length doesn't match mids' length.");a.map(function(){var h=x(function*(f){if(Yt()&&f.track)f.track.enabled=!0;else{const m=f.getParameters();m.encodings.forEach(g=>g.active=!0),yield f.setParameters(m)}});return function(f){return h.apply(this,arguments)}}());const l=yield r.peerConnection.createOffer();yield r.peerConnection.setLocalDescription(l);const d=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(a.toString()))}})()}restartICE(i){var r=this;return is(function*(){const a=yield _t(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Rt().supportPCSetConfiguration){const m=r.peerConnection.getConfiguration(),g=i===fi.RELAY?"relay":"all";m.iceTransportPolicy!==g&&(R.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(m.iceTransportPolicy,"] to [").concat(g,"]")),m.iceTransportPolicy=g,r.peerConnection.setConfiguration(m))}else if(i===fi.RELAY)return;i!==fi.RELAY&&r.remoteSDP.updateCandidates(i);const l=yield _t(r.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=yp(l.sdp),{remoteIceParameters:h}=yield d.iceParameters;r.remoteSDP.restartICE(h);const f=r.remoteSDP.toString();yield _t(r.peerConnection.setLocalDescription(l)),yield _t(r.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(l){R.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),l)}finally{a()}})()}close(){var i;this.peerConnection.close(),null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}updateEncoderConfig(i,r){var a=this;return x(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const l=yield a.peerConnection.createOffer(),d=a.mungSendOfferSDP(l.sdp,[r]);a.remoteSDP.updateRecvMedia(r._mediaStreamTrack.kind,r);const h=a.remoteSDP.toString();yield a.peerConnection.setLocalDescription({type:"offer",sdp:d}),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(l){throw new ne(k.EXCHANGE_SDP_FAILED,l.toString())}})()}updateSendParameters(i,r){var a=this;return x(function*(){const l=a.peerConnection.getSenders().filter(d=>{var h;return(null===(h=d.track)||void 0===h?void 0:h.id)===i});1===l.length&&(yield a.applySendEncodings(l,[r]))})()}setStatsRemoteVideoIsReady(i,r){this.statsFilter.setVideoIsReady2(i,r)}replaceTrack(i,r){var a=this;return x(function*(){const l=a.peerConnection.getSenders().find(d=>{var h;return(null===(h=d.track)||void 0===h?void 0:h.id)===r});l&&(yield l.replaceTrack(i._mediaStreamTrack))})()}createDataChannels(i,r){throw new ne(k.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(i){throw new ne(k.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;null===(i=this.onICEConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},H("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const r={iceServers:[],sdpSemantics:"plan-b"};return i.iceServers?r.iceServers=i.iceServers:i.turnServer&&"off"!==i.turnServer.mode&&(Qd(i.turnServer.servers)?r.iceServers=i.turnServer.servers:(r.iceServers&&r.iceServers.push(...Ii.turnServerConfigToIceServers(i.turnServer.servers)),H("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&i.turnServer.serversFromGateway&&r.iceServers.push(...Ii.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(i){const r=[];return i.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}updateRtpSenderEncodings(i,r){var a=this;return x(function*(){var l;if(r||(r=a.peerConnection.getSenders().find(E=>{var y;return(null===(y=E.track)||void 0===y?void 0:y.id)===i._mediaStreamTrack.id})),!r)return R.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(!Rt().supportSetRtpSenderParameters)return R.warn("Browser not support set rtp-sender parameters");const d={},h={};if(i instanceof Ye)switch(i._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(H("DSCP_TYPE")&&Il()){var f;const E=H("DSCP_TYPE");we(f=["very-low","low","medium","high"]).call(f,E)&&(h.networkPriority=E)}const m=r.getParameters(),g=null===(l=m.encodings)||void 0===l?void 0:l[0];g&&Object.assign(g,h),Object.assign(m,d),R.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),yield r.setParameters(m)})()}applySendEncodings(i,r){var a=this;return x(function*(){try{if(!Rt().supportSetRtpSenderParameters||i.length!==r.length)return;for(let l=0;l<i.length;l++){const d=i[l],h=r[l];d&&h&&(yield a.updateRtpSenderEncodings(h,d))}}catch(l){R.debug("[".concat(a.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(i,r){const a=mn.parse(i);return r.forEach((l,d)=>{const h=l._mediaStreamTrack,f=a.mediaDescriptions.find(m=>m.attributes.mid===h.kind);f&&zl(f,l)}),mn.print(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,r,a)=>{var l;null===(l=this.onFirstVideoDecoded)||void 0===l||l.call(this,i,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,i,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}batchReceive(i){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const a=r.remoteSDP.batchSend(i).map((h,f)=>{let{id:m,mslabel:g}=h;const{kind:E}=i[f];return new q((y,C)=>{const b=setTimeout(()=>{C(new Error("Cannot receive track, id: ".concat(m)))},1e4),O=P=>{const D=pt();if("Safari"===D.name&&11===Number(D.version)&&P.track.id!==m&&P.streams[0].id===g){var L;const B=P.streams[0].getTracks()[0];return null===(L=r.remoteSDP)||void 0===L||L.updateTrackLabel(E,m,P.track.id),r.peerConnection.removeEventListener("track",O),clearTimeout(b),void y({track:B,id:m})}if(P.track.id===m)return r.peerConnection.removeEventListener("track",O),clearTimeout(b),void y({track:P.track,id:m})};r.peerConnection.addEventListener("track",O)})}),l=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"offer",sdp:l});const d=yield r.peerConnection.createAnswer();return yield r.peerConnection.setLocalDescription(d),yield q.all(a)}catch(a){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}})()}getRemoteSSRC(i){var r=this;return x(function*(){if(!r.remoteSDP)return;const a=r.remoteSDP.getSSRC(i);return null==a?void 0:a[0].ssrcId})()}setConfiguration(i){if(Rt().supportPCSetConfiguration){const r=Ii.resolvePCConfiguration(i);this.peerConnection.setConfiguration(r)}}}function ss(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=x(function*(){const l=this.mutex,d=yield l.lock("Locking from P2PConnection.".concat(i));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return yield a.apply(this,f)}finally{d()}}),r}function mN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function $c(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?mN(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):mN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}oe([ss,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",q)],Ii.prototype,"connect",null),oe([ss,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],Ii.prototype,"stopSending",null),oe([ss,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",q)],Ii.prototype,"receive",null),oe([ss,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],Ii.prototype,"stopReceiving",null),oe([ss,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Ii.prototype,"muteRemote",null),oe([ss,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Ii.prototype,"unmuteRemote",null),oe([ss,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],Ii.prototype,"muteLocal",null),oe([ss,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],Ii.prototype,"unmuteLocal",null),oe([ss,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Ii.prototype,"close",null),oe([ss,N("design:type",Function),N("design:paramtypes",[String,jt]),N("design:returntype",q)],Ii.prototype,"updateEncoderConfig",null),oe([ss,N("design:type",Function),N("design:paramtypes",[String,jt]),N("design:returntype",q)],Ii.prototype,"updateSendParameters",null),oe([ss,N("design:type",Function),N("design:paramtypes",[jt,String]),N("design:returntype",q)],Ii.prototype,"replaceTrack",null),oe([ss,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Ii.prototype,"getRemoteSSRC",null);function Z_(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function $a(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?Z_(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Z_(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}let wi=class PR extends SE{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var i,r;return null!==(i=null===(r=this.peerConnection.getReceivers()[0])||void 0===r||null===(r=r.transport)||void 0===r?void 0:r.state)&&void 0!==i?i:null}constructor(i,r){super(i,r),T(this,"store",void 0),T(this,"peerConnection",void 0),T(this,"remoteSDP",void 0),T(this,"initialOffer",void 0),T(this,"transportEventReceiver",void 0),T(this,"statsFilter",void 0),T(this,"useXR",H("USE_XR")),T(this,"localCapabilities",void 0),T(this,"localCandidateCount",0),T(this,"allCandidatesReceived",!1),T(this,"dataStreamChannelMap",new Map),T(this,"establishPromise",void 0),T(this,"mutex",new Gn("P2PConnection-mutex")),this.store=r,this.peerConnection=new RTCPeerConnection(PR.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.statsFilter=_y(this.peerConnection,H("STATS_UPDATE_INTERVAL"),void 0,Pt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(){var i=this;return x(function*(){try{i.peerConnection.addTransceiver("video",{direction:"recvonly"}),i.peerConnection.addTransceiver("audio",{direction:"recvonly"});const r=yield i.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=yp(r.sdp),l=yield lN({filterRTX:!H("USE_PUB_RTX")&&!H("USE_SUB_RTX"),filterVideoFec:H("FILTER_VIDEO_FEC"),filterAudioFec:H("FILTER_AUDIO_FEC")},{useXR:i.useXR});return i.localCapabilities=Nb(l),i.initialOffer=r,$a($a({},a),{},{rtpCapabilities:l,offerSDP:r.sdp})}catch(r){throw new ne(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}})()}connect(i,r,a,l,d,h){var f=this;return x(function*(){try{if(!f.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");f.remoteSDP=new class{get localCapabilities(){return Pn(this._localCapabilities)}get rtpCapabilities(){return Pn(this._rtpCapabilities)}get candidates(){return Pn(this._candidates)}get iceParameters(){return Pn(this._iceParameters)}get dtlsParameters(){return Pn(this._dtlsParameters)}constructor(O){T(this,"sessionDesc",void 0),T(this,"_localCapabilities",void 0),T(this,"_rtpCapabilities",void 0),T(this,"_candidates",void 0),T(this,"_iceParameters",void 0),T(this,"_dtlsParameters",void 0),T(this,"setup",void 0),T(this,"currentMidIndex",void 0),T(this,"cname",void 0),T(this,"firefoxSsrcMidMap",new Map),O=Pn(O);const{remoteIceParameters:P,remoteDtlsParameters:D,candidates:L,remoteRTPCapabilities:B,remoteSetup:V,localCapabilities:J,cname:ae}=O,z=mn.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n");this._rtpCapabilities=B,this._candidates=L,this._iceParameters=P,this._dtlsParameters=D,this._localCapabilities=J,this.setup=V,this.cname=ae;const Q=this.rtpCapabilities.send;for(const X of z.mediaDescriptions){if(X.attributes.iceUfrag=P.iceUfrag,X.attributes.icePwd=P.icePwd,X.attributes.fingerprints=D.fingerprints,X.attributes.candidates=L,X.attributes.setup=V,"video"===X.media.mediaType&&(X.media.fmts=Q.videoCodecs.map(te=>te.payloadType.toString(10)),X.attributes.payloads=Q.videoCodecs,X.attributes.extmaps=Q.videoExtensions,H("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:te,ssrcGroups:Ce}=os([{ssrcId:4e4,rtx:H("USE_SUB_RTX")?40001:void 0}],this.cname);X.attributes.ssrcs=te,X.attributes.ssrcGroups=Ce}if("audio"===X.media.mediaType&&(X.media.fmts=Q.audioCodecs.map(te=>te.payloadType.toString(10)),X.attributes.payloads=Q.audioCodecs,X.attributes.extmaps=Q.audioExtensions,ks(X),H("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:te,ssrcGroups:Ce}=os([{ssrcId:2e4}],this.cname);X.attributes.ssrcs=te,X.attributes.ssrcGroups=Ce}}this.sessionDesc=z,this.currentMidIndex=z.mediaDescriptions.length-1}preloadRemoteMedia(){const O=H("PRELOAD_MEDIA_COUNT"),P=this.candidates,D=this.dtlsParameters,L=this.iceParameters,B=this.rtpCapabilities.send;for(let V=1;V<O;V++){const J=2*V+2e4,ae=2*V+4e4,{ssrcs:z,ssrcGroups:Q}=os([{ssrcId:J}],this.cname),{ssrcs:X,ssrcGroups:te}=os([{ssrcId:ae,rtx:H("USE_SUB_RTX")?ae+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:B.videoCodecs.map(Ce=>Ce.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:L.iceUfrag,icePwd:L.icePwd,unrecognized:[],candidates:P,extmaps:B.videoExtensions,fingerprints:D.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:X,ssrcGroups:te,rtcpFeedbackWildcards:[],payloads:B.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*V)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:B.audioCodecs.map(Ce=>Ce.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:L.iceUfrag,icePwd:L.icePwd,unrecognized:[],candidates:P,extmaps:B.audioExtensions,fingerprints:D.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:z,ssrcGroups:Q,rtcpFeedbackWildcards:[],payloads:B.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*V+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return mn.print(this.sessionDesc)}send(O,P,D,L){const{ssrcs:B,ssrcGroups:V}=os(P,this.cname,H("SYNC_GROUP")?D:void 0),J=this.findPreloadMediaDesc(B);if(J){if(Pt()&&this.firefoxSsrcMidMap.set(B[0].ssrcId,J.attributes.mid),L&&(L.twcc||L.remb)){const ae=this.sessionDesc.mediaDescriptions.indexOf(J);return this.sessionDesc.mediaDescriptions[ae]=this.mungSendMediaDesc(J,L),{mid:J.attributes.mid,needExchangeSDP:!0}}return{mid:J.attributes.mid,needExchangeSDP:!1}}{const ae=this.findAvailableMediaIndex(O,B);let z;return-1===ae||1===ae&&(Yt()||CS())||0===ae&&H("USE_SUB_RTX")||SS()?(z=this.createOrRecycleSendMedia(O,B,V,"sendonly",L),this.updateBundleMids()):(z=Pn(this.sessionDesc.mediaDescriptions[ae]),z.attributes.direction="sendonly",z.attributes.ssrcs=B,z.attributes.ssrcGroups=V,this.sessionDesc.mediaDescriptions[ae]=this.mungSendMediaDesc(z,L)),Pt()&&this.firefoxSsrcMidMap.set(B[0].ssrcId,z.attributes.mid),{mid:z.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:O,needExchangeSDP:P}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:O.attributes.mid,needExchangeSDP:P}}batchSend(O){const P=O.map(B=>{let{kind:V,ssrcMsg:J,mslabel:ae}=B;return this.send(V,J,ae)}),D=[];let L=!1;return P.forEach(B=>{let{mid:V,needExchangeSDP:J}=B;J&&(L=!0),D.push(V)}),{mids:D,needExchangeSDP:L}}stopSending(O){const P=this.sessionDesc.mediaDescriptions.filter(D=>D.attributes.mid&&-1!==O.indexOf(D.attributes.mid));if(P.length!==O.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");P.forEach(D=>{"0"===D.attributes.mid||Pt()||SS()?D.attributes.ssrcs=[]:(D.attributes.ssrcs=[],D.attributes.direction="inactive",D.media.port="0")}),this.updateBundleMids()}mute(O){const P=this.sessionDesc.mediaDescriptions.find(D=>D.attributes.mid===O);if(!P)throw new Error("mediaDescription not found with ".concat(O," in remote SDP when calling RemoteSDP.mute."));P.attributes.direction="inactive"}unmute(O){const P=this.sessionDesc.mediaDescriptions.find(D=>D.attributes.mid===O);if(!P)throw new Error("mediaDescription not found with ".concat(O," in remote SDP when calling RemoteSDP.unmute."));P.attributes.direction="sendonly"}muteRemote(O){const P=this.sessionDesc.mediaDescriptions.filter(D=>we(O).call(O,D.attributes.mid||""));if(P.length!==O.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");P.forEach(D=>{D.attributes.direction="inactive"})}unmuteRemote(O){const P=this.sessionDesc.mediaDescriptions.filter(D=>we(O).call(O,D.attributes.mid||""));if(P.length!==O.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");P.forEach(D=>{D.attributes.direction="recvonly"})}receive(O,P,D,L){O.forEach((B,V)=>{this.createOrRecycleRecvMedia(B,[],"recvonly",P,D,L[V])}),this.updateBundleMids()}stopReceiving(O){const P=this.sessionDesc.mediaDescriptions.filter(D=>-1!==O.indexOf(D.attributes.mid));if(P.length!==O.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");P.forEach(D=>{D.media.port="0",D.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(O){const P=this._candidates.filter(D=>"udp"===D.transport);if(O===fi.TCP){if(0===P.length)return;if(H("TCP_CANDIDATE_ONLY")){const D=this._candidates.filter(L=>"tcp"===L.transport);P.forEach(L=>{-1===D.findIndex(B=>B.connectionAddress===L.connectionAddress)&&D.push($c($c({},L),{},{foundation:"tcpcandidate",priority:Number(L.priority)-1+"",transport:"tcp",port:Number(L.port)+90+""}))}),this._candidates=D}else{const D=[];P.forEach(L=>{D.push($c($c({},L),{},{foundation:"tcpcandidate",priority:Number(L.priority)-1+"",transport:"tcp",port:Number(L.port)+90+""}))}),this._candidates=[...P,...D]}}else if(O===fi.RELAY){if(0!==P.length)return;{const D=this._candidates.filter(L=>"tcp"===L.transport);D.forEach(L=>{P.push($c($c({},L),{},{foundation:"udpcandidate",priority:Number(L.priority)+1+"",transport:"udp",port:Number(L.port)-90+""}))}),this._candidates=[...P,...D]}}else 0===P.length?(this._candidates.filter(D=>"tcp"===D.transport).forEach(D=>{P.push($c($c({},D),{},{foundation:"udpcandidate",priority:Number(D.priority)+1+"",transport:"udp",port:Number(D.port)-90+""}))}),this._candidates=P):this._candidates=this._candidates.filter(D=>"tcp"!==D.transport);for(const D of this.sessionDesc.mediaDescriptions)D.attributes.candidates=this.candidates}restartICE(O){O=Pn(O),this._iceParameters=O,this.sessionDesc.mediaDescriptions.forEach(P=>{P.attributes.iceUfrag=O.iceUfrag,P.attributes.icePwd=O.icePwd})}predictReceivingMids(O){const P=[];for(let D=0;D<O;D++)P.push((this.currentMidIndex+D+1).toString(10));return P}findAvailableMediaIndex(O,P){return this.sessionDesc.mediaDescriptions.findIndex(D=>{const L=D.media.mediaType===O&&"0"!==D.media.port&&("sendonly"===D.attributes.direction||"sendrecv"===D.attributes.direction)&&0===D.attributes.ssrcs.length;if(Pt()){if(L){const B=this.firefoxSsrcMidMap.get(P[0].ssrcId);return!(B||"0"!==D.attributes.mid&&"1"!==D.attributes.mid)||!(!B||B!==D.attributes.mid)}return!1}return L})}createOrRecycleDataChannel(){for(const D of this.sessionDesc.mediaDescriptions)if("application"===D.media.mediaType)return{mediaDesc:D,needExchangeSDP:!1};this.currentMidIndex+=1;const O="".concat(this.currentMidIndex),P={media:{mediaType:"application",port:"9",protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(O),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(P),{mediaDesc:P,needExchangeSDP:!0}}createOrRecycleRecvMedia(O,P,D,L,B,V){const J=O._mediaStreamTrack.kind,ae=this.rtpCapabilities.recv,z=this.localCapabilities.send;let Q=[];if(J===ye.VIDEO){var X,te;if(H("H264_PROFILE_LEVEL_ID")&&"h264"===L&&(Q=ae.videoCodecs.filter(mt=>{var dt,It,re;return we(dt=(null===(It=mt.rtpMap)||void 0===It?void 0:It.encodingName.toLowerCase())||"").call(dt,L)&&(null==mt||null===(re=mt.fmtp)||void 0===re?void 0:re.parameters["profile-level-id"])===H("H264_PROFILE_LEVEL_ID")})),!Q||0===(null===(X=Q)||void 0===X?void 0:X.length)){const mt=z.videoCodecs.filter(dt=>{var It,re;return we(It=(null===(re=dt.rtpMap)||void 0===re?void 0:re.encodingName.toLowerCase())||"").call(It,L)});0!==mt.length&&(Q=ae.videoCodecs.filter(dt=>mt.some(It=>It.payloadType===dt.payloadType)))}if(H("USE_PUB_RTX")){const mt=Q.map(It=>It.payloadType.toString()),dt=ae.videoCodecs.filter(It=>{var re,de;return"rtx"===(null===(re=It.rtpMap)||void 0===re?void 0:re.encodingName)&&we(mt).call(mt,(null===(de=It.fmtp)||void 0===de?void 0:de.parameters.apt)||"")});Q=[...Q,...dt]}0===Q.length&&(R.warning("codec ".concat(L," not included in rtpCapabilities, fallback to default payloads: ").concat(null===(te=ae.videoCodecs[0].rtpMap)||void 0===te?void 0:te.encodingName)),Q=ae.videoCodecs)}else Q=ae.audioCodecs.filter(mt=>{var dt,It;return we(dt=(null===(It=mt.rtpMap)||void 0===It?void 0:It.encodingName.toLowerCase())||"").call(dt,B)}),0===Q.length&&(R.warning("codec ".concat(B," not included in rtpCapabilities, fallback to opus")),Q=ae.audioCodecs.filter(mt=>{var dt,It;return we(dt=(null===(It=mt.rtpMap)||void 0===It?void 0:It.encodingName.toLowerCase())||"").call(dt,"opus")}));const Ce=J===ye.VIDEO?ae.videoExtensions:ae.audioExtensions;this.currentMidIndex+=1;const Se="".concat(this.currentMidIndex);let He={media:{mediaType:J,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:Q.map(mt=>mt.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Ce,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:P,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:Q,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:D,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Se)}};He=this.mungRecvMediaDsec(He,O,V);const ut=this.findFirstClosedMedia(J);if(ut){const mt=this.sessionDesc.mediaDescriptions.indexOf(ut);this.sessionDesc.mediaDescriptions[mt]=He}else this.sessionDesc.mediaDescriptions.push(He);return He}createOrRecycleSendMedia(O,P,D,L,B){const V=this.rtpCapabilities.send,J=O===ye.VIDEO?V.videoCodecs:V.audioCodecs,ae=O===ye.VIDEO?V.videoExtensions:V.audioExtensions;this.currentMidIndex+=1;const z="".concat(this.currentMidIndex);let Q={media:{mediaType:O,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:J.map(te=>te.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:ae,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:P,ssrcGroups:D,rtcpFeedbackWildcards:[],payloads:J,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:L,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(z)}};Q=this.mungSendMediaDesc(Q,B);const X=this.findFirstClosedMedia(O);if(X){const te=this.sessionDesc.mediaDescriptions.indexOf(X);this.sessionDesc.mediaDescriptions[te]=Q}else this.sessionDesc.mediaDescriptions.push(Q);return Q}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(O=>"0"!==O.media.port).map(O=>O.attributes.mid)}mungRecvMediaDsec(O,P,D){const L=Pn(O);return Ab(L),zl(L,P),Db(L,P),m2(L),ao(L,D,this.localCapabilities.send),L}mungSendMediaDesc(O,P){const D=Pn(O);return ao(D,P,this.localCapabilities.recv),ks(D),D}updateRecvMedia(O,P){const D=this.sessionDesc.mediaDescriptions.findIndex(L=>L.attributes.mid===O);if(-1!==D){const L=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[D],P);this.sessionDesc.mediaDescriptions[D]=L}}bumpMid(O){this.currentMidIndex+=O}findFirstClosedMedia(O){return this.sessionDesc.mediaDescriptions.find(P=>Pt()?"0"===P.media.port&&P.media.mediaType===O:"0"===P.media.port)}findPreloadMediaDesc(O){return this.sessionDesc.mediaDescriptions.find(P=>{var D;return(null===(D=P.attributes)||void 0===D||null===(D=D.ssrcs[0])||void 0===D?void 0:D.ssrcId)===O[0].ssrcId})}getSSRC(O){var P;return null===(P=this.sessionDesc.mediaDescriptions.find(D=>D.attributes.mid===O))||void 0===P?void 0:P.attributes.ssrcs}}({remoteIceParameters:i,remoteDtlsParameters:r,candidates:a,remoteRTPCapabilities:l,remoteSetup:d,localCapabilities:f.localCapabilities,cname:h});const m=f.remoteSDP.toString(),g=mn.parse(f.initialOffer.sdp),E=g.mediaDescriptions.find(O=>"audio"===O.media.mediaType);E&&ks(E),f.useXR&&py(g);const y=mn.print(g),C=f.logSDPExchange(y||"","offer","local","connect");f.store.descriptionStart(),yield f.peerConnection.setLocalDescription({type:"offer",sdp:y}),null==C||C(m),yield f.peerConnection.setRemoteDescription({type:"answer",sdp:m});const b=f.peerConnection.getTransceivers()[0];if(null!=b&&b.receiver&&f.tryBindTransportEvents(b.receiver),H("PRELOAD_MEDIA_COUNT")>0){f.remoteSDP.preloadRemoteMedia();const O=f.remoteSDP.toString();yield f.peerConnection.setRemoteDescription({type:"offer",sdp:O});const P=yield f.peerConnection.createAnswer();yield f.peerConnection.setLocalDescription(P)}}catch(m){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(m.toString()))}})()}send(i,r,a){var l=this;return is(function*(){const d=yield _t(l.mutex.lock("From P2PConnection.send"));try{if(!l.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[];i.forEach(P=>{const D=l.peerConnection.addTransceiver(P._mediaStreamTrack,{direction:"sendonly"});h.push(D),P._updateRtpTransceiver(D)}),Pt()&&!0===H("SIMULCAST")&&(yield _t(l.applySimulcastForFirefox(h,i)));const f=yield _t(l.peerConnection.createOffer()),m=l.remoteSDP.predictReceivingMids(i.length),g=l.mungSendOfferSDP(f.sdp,i,m),E=mn.parse(g),y=m.map(P=>{const D=E.mediaDescriptions.find(L=>L.attributes.mid===P);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return _2(D,H("USE_PUB_RTX"))});let C;try{C=yield y}catch(P){C=[],l.remoteSDP.receive(i,r,a,C);const D=l.remoteSDP.toString();throw yield _t(l.peerConnection.setLocalDescription({type:"offer",sdp:g})),yield _t(l.peerConnection.setRemoteDescription({type:"answer",sdp:D})),yield _t(l.stopSending(m,!0)),P}l.remoteSDP.receive(i,r,a,C);const b=l.remoteSDP.toString(),O=l.logSDPExchange(g,"offer","local","send");return yield _t(l.peerConnection.setLocalDescription({type:"offer",sdp:g})),yield _t(l.applySimulcastEncodings(h,i)),yield _t(l.applySendEncodings(h,i)),null==O||O(b),yield _t(l.peerConnection.setRemoteDescription({type:"answer",sdp:b})),h.map((P,D)=>({localSSRC:y[D],id:m[D],transceiver:P}))}catch(h){throw h instanceof ne?h:new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}createDataChannels(i,r){var a=this;return x(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let l=a.dataStreamChannelMap.get(i);l&&"open"===l.readyState?R.debug("[P2PConnection] Channels are already available and can be reused directly."):(l=a.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:H("DATASTREAM_MAX_RETRANSMITS")}),l.binaryType="arraybuffer",a.dataStreamChannelMap.set(i,l)),r.forEach(h=>{h._updateOriginDataChannel(l)});const{needExchangeSDP:d}=a.remoteSDP.sendDataChannel();if(d){const h=a.remoteSDP.toString();yield a.peerConnection.setRemoteDescription({type:"offer",sdp:h});const f=yield a.peerConnection.createAnswer();yield a.peerConnection.setLocalDescription(f),R.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else R.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(l){throw l instanceof ne?l:new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(l.toString()))}})()}stopDataChannels(i){var r=this;return x(function*(){try{const a=r.dataStreamChannelMap.get(i);return null==a||a.close(),void r.dataStreamChannelMap.delete(i)}catch(a){throw a instanceof ne?a:new ne(k.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(a.toString()))}})()}stopSending(i,r){var a=this;return x(function*(){const l=r?void 0:yield a.mutex.lock("From P2PConnection.stopSending");try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const d=a.peerConnection.getTransceivers().filter(g=>-1!==i.indexOf(g.mid));if(d.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");d.map(g=>{var E;g.direction="inactive",null===(E=g.stop)||void 0===E||E.call(g)});const h=yield a.peerConnection.createOffer(),f=a.logSDPExchange(h.sdp||"","offer","local","stopSending");yield a.peerConnection.setLocalDescription(h),a.remoteSDP.stopReceiving(i);const m=a.remoteSDP.toString();null==f||f(m),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(d){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(d.toString()))}finally{l&&l()}})()}receive(i,r,a,l){var d=this;return x(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{mid:h,needExchangeSDP:f}=d.remoteSDP.send(i,r,a,l);if(f){const g=d.remoteSDP.toString(),E=d.logSDPExchange(g,"offer","remote","receive");yield d.peerConnection.setRemoteDescription({type:"offer",sdp:g});const y=yield d.peerConnection.createAnswer(),C=d.mungReceiveAnswerSDP(y.sdp,h,i);null==E||E(C||""),yield d.peerConnection.setLocalDescription({type:"answer",sdp:C}),R.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(i," by exchanging SDP."))}else R.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(i," no need to exchange SDP."));const m=d.peerConnection.getTransceivers().find(g=>g.mid===h);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:h,transceiver:m}}catch(h){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}batchReceive(i){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:a,needExchangeSDP:l}=r.remoteSDP.batchSend(i);if(l){const d=r.remoteSDP.toString(),h=r.logSDPExchange(d,"offer","remote","receive");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:d});const f=yield r.peerConnection.createAnswer();null==h||h(f.sdp||""),yield r.peerConnection.setLocalDescription(f),R.debug("[".concat(r.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else R.debug("[".concat(r.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return a.map(d=>{const h=r.peerConnection.getTransceivers().find(f=>f.mid===d);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:d,transceiver:h}})}catch(a){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}})()}stopReceiving(i){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.remoteSDP.stopSending(i);const a=r.remoteSDP.toString(),l=r.logSDPExchange(a,"offer","remote","stopReceiving");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield r.peerConnection.createAnswer();null==l||l(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(a){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}})()}muteRemote(i){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(i," before remote SDP created."));r.remoteSDP.mute(i);const a=r.remoteSDP.toString(),l=r.logSDPExchange(a,"offer","remote","muteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield r.peerConnection.createAnswer();null==l||l(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(a){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(a.toString()))}})()}unmuteRemote(i){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(i," before remote SDP created."));r.remoteSDP.unmute(i);const a=r.remoteSDP.toString(),l=r.logSDPExchange(a,"offer","remote","unmuteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield r.peerConnection.createAnswer();null==l||l(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(a){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(a.toString()))}})()}muteLocal(i){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(f=>f.mid&&-1!==i.indexOf(f.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(f=>{f.direction="inactive"});const l=yield r.peerConnection.createOffer(),d=r.logSDPExchange(l.sdp||"","offer","local","muteLocal");yield r.peerConnection.setLocalDescription(l),r.remoteSDP.muteRemote(i);const h=r.remoteSDP.toString();null==d||d(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(a.toString()))}})()}unmuteLocal(i){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(f=>f.mid&&-1!==i.indexOf(f.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(function(){var f=x(function*(m,g){m.direction="sendonly"});return function(m,g){return f.apply(this,arguments)}}());const l=yield r.peerConnection.createOffer(),d=r.logSDPExchange(l.sdp||"","offer","local","unmuteLocal");yield r.peerConnection.setLocalDescription(l),r.remoteSDP.unmuteRemote(i);const h=r.remoteSDP.toString();null==d||d(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(a.toString()))}})()}restartICE(i){var r=this;return is(function*(){const a=yield _t(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Rt().supportPCSetConfiguration){const g=r.peerConnection.getConfiguration(),E=i===fi.RELAY?"relay":"all";g.iceTransportPolicy!==E&&(R.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(g.iceTransportPolicy,"] to [").concat(E,"]")),g.iceTransportPolicy=E,r.peerConnection.setConfiguration(g))}else if(i===fi.RELAY)return;r.remoteSDP.updateCandidates(i);const l=yield _t(r.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=yp(l.sdp),{remoteIceParameters:h}=yield d.iceParameters;r.remoteSDP.restartICE(h);const f=r.remoteSDP.toString(),m=r.logSDPExchange(l.sdp||"","offer","local","restartICE");r.store.descriptionStart(),yield _t(r.peerConnection.setLocalDescription(l)),null==m||m(f),yield _t(r.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(l){R.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),l)}finally{a()}})()}close(){var i;this.peerConnection.close(),null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}updateEncoderConfig(i,r){var a=this;return x(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const l=yield a.peerConnection.createOffer(),d=a.mungSendOfferSDP(l.sdp,[r],[i]);a.remoteSDP.updateRecvMedia(i,r);const h=a.remoteSDP.toString(),f=a.logSDPExchange(d,"offer","local","updateEncoderConfig");yield a.peerConnection.setLocalDescription({type:"offer",sdp:d}),null==f||f(h),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(l){throw new ne(k.EXCHANGE_SDP_FAILED,l.toString())}})()}updateSendParameters(i,r){var a=this;return x(function*(){const l=a.peerConnection.getTransceivers().filter(d=>d.mid===i);1===l.length&&(a.isVP8Simulcast(r)?Pt()||(yield a.applySimulcastEncodings(l,[r])):yield a.applySendEncodings(l,[r]))})()}setStatsRemoteVideoIsReady(i,r){this.statsFilter.setVideoIsReady2(i,r)}replaceTrack(i,r){var a=this;return x(function*(){const l=a.peerConnection.getTransceivers().find(d=>d.mid===r);l&&(yield l.sender.replaceTrack(i._mediaStreamTrack))})()}getSelectedCandidatePair(){var i=this;return x(function*(){const r=i.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const a=r[0].transport.iceTransport,{local:l,remote:d}=a.getSelectedCandidatePair();return{local:$a($a({},Tr),{},{candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port}),remote:$a($a({},Tr),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})}}return i.statsFilter.getSelectedCandidatePair()})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;null===(i=this.onICEConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},H("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const r={iceServers:[]};return i.iceServers?r.iceServers=i.iceServers:i.turnServer&&"off"!==i.turnServer.mode&&(Qd(i.turnServer.servers)?r.iceServers=i.turnServer.servers:(r.iceServers&&r.iceServers.push(...PR.turnServerConfigToIceServers(i.turnServer.servers)),H("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&i.turnServer.serversFromGateway&&r.iceServers.push(...PR.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),H("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),H("ENABLE_ENCODED_TRANSFORM")&&Rt().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(i){const r=[];return i.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(H_(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!H("FORCE_TURN_TCP")&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}tryBindTransportEvents(i){const r=i.transport;if(r){this.transportEventReceiver=i,r.onstatechange=()=>{var l;null!=r&&r.state&&(null===(l=this.onDTLSTransportStateChange)||void 0===l||l.call(this,r.state))},r.onerror=l=>{var d;null===(d=this.onDTLSTransportError)||void 0===d||d.call(this,"error"in l?l.error:l)};const a=r.iceTransport;a&&(a.onstatechange=()=>{const l=null==r?void 0:r.iceTransport.state;var d;l&&(null===(d=this.onICETransportStateChange)||void 0===d||d.call(this,l))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){const{local:l,remote:d}=a.getSelectedCandidatePair();R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:l.type,protocol:l.protocol}),", remote ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(i,r){var a=this;return x(function*(){var l;if(r||(r=a.peerConnection.getSenders().find(y=>y.track===i._mediaStreamTrack)),!r)return R.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(a.isVP8Simulcast(i))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Rt().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(i._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(i._encoderConfig){var f;const{bitrateMax:y,frameRate:C,scaleResolutionDownBy:b}=i._encoderConfig;y&&(h.maxBitrate=1e3*y),we(f=i._hints).call(f,Qt.LOW_STREAM)&&(C&&(h.maxFramerate=To(C)),b&&b>=1&&(h.scaleResolutionDownBy=b))}if(H("DSCP_TYPE")&&Il()){var m;const y=H("DSCP_TYPE");we(m=["very-low","low","medium","high"]).call(m,y)&&(h.networkPriority=y)}const g=r.getParameters(),E=null===(l=g.encodings)||void 0===l?void 0:l[0];Pt()&&!E&&(d.encodings=[h]),E&&Object.assign(E,h),Object.assign(g,d),R.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),yield r.setParameters(g)})()}applySendEncodings(i,r){var a=this;return x(function*(){try{if(!Rt().supportSetRtpSenderParameters||i.length!==r.length)return;for(let l=0;l<i.length;l++){const d=i[l],h=r[l];h instanceof Ye&&!a.isVP8Simulcast(h)&&(yield a.updateRtpSenderEncodings(h,d.sender))}}catch(l){R.debug("[".concat(a.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(i,r,a){const l=mn.parse(i);return r.forEach((d,h)=>{const f=a[h],m=l.mediaDescriptions.find(g=>g.attributes.mid===f);m&&(zl(m,d),J_(m,d,this.store.codec))}),mn.print(l)}mungReceiveAnswerSDP(i,r,a){const l=mn.parse(i),d=l.mediaDescriptions.find(h=>h.attributes.mid===r);return d&&(a===ye.AUDIO&&"audio"===d.media.mediaType&&ks(d),this.useXR&&py(l)),mn.print(l)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,r,a)=>{var l;null===(l=this.onFirstVideoDecoded)||void 0===l||l.call(this,i,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var r;null===(r=this.onFirstVideoDecodedTimeout)||void 0===r||r.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(i,r){var a=this;return x(function*(){if(i.length===r.length)for(let g=0;g<i.length;g++){var l,d,h,f,m;const E=i[g],y=r[g];if(y instanceof Ye&&!we(l=y._hints).call(l,Qt.LOW_STREAM)&&null!==(d=y._encoderConfig)&&void 0!==d&&d.bitrateMax&&(null===(h=y._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(f=y._scalabilityMode)&&void 0!==f&&f.numSpatialLayers&&(null===(m=y._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===a.store.codec){const C={},b={high:1e3*(y._encoderConfig.bitrateMax-50),medium:5e4};C.encodings=[{rid:"m",active:!0,maxBitrate:b.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:b.high}];const O=E.sender.getParameters();yield E.sender.setParameters(Object.assign(O,C))}}})()}applySimulcastEncodings(i,r){var a=this;return x(function*(){if(!Pt()&&i.length===r.length)for(let l=0;l<i.length;l++){const d=r[l];if(d instanceof Ye&&a.isVP8Simulcast(d)){const h=i[l],f={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=h.sender.getParameters();yield h.sender.setParameters(Object.assign(g,f))}}})()}isVP8Simulcast(i){var r,a,l,d,h;return!!(i instanceof Ye&&H("SIMULCAST")&&"vp8"===this.store.codec&&!we(r=i._hints).call(r,Qt.LOW_STREAM)&&null!==(a=i._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(l=i._encoderConfig)||void 0===l?void 0:l.bitrateMax)>200&&null!==(d=i._scalabilityMode)&&void 0!==d&&d.numSpatialLayers&&(null===(h=i._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(i,r,a,l){if(H("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(r," SDP during P2PConnection.").concat(l,"\n"),i),"offer"===r?d=>{this.logSDPExchange(d,"answer","local"===a?"remote":"local",l)}:void 0}getRemoteSSRC(i){var r=this;return x(function*(){if(!r.remoteSDP)return;const a=r.remoteSDP.getSSRC(i);return null==a?void 0:a[0].ssrcId})()}setConfiguration(i){if(Rt().supportPCSetConfiguration){const r=PR.resolvePCConfiguration(i);this.peerConnection.setConfiguration(r)}}};function Io(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=x(function*(){const l=this.mutex,d=yield l.lock("From P2PConnection.".concat(i));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return yield a.apply(this,f)}finally{d()}}),r}function em(s,i){let r=document.createElement("video"),a=document.createElement("canvas");r.setAttribute("style","display:none"),a.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),a.width=To(i.width),a.height=To(i.height);const l=To(i.framerate||15);document.body.append(r),document.body.append(a);let d=s._mediaStreamTrack;r.srcObject=new MediaStream([d]),r.play();const h=a.getContext("2d");if(!h)throw new K(k.UNEXPECTED_ERROR,"can not get canvas context");const f=Rt(),m=a.captureStream(f.supportRequestFrame?0:l).getVideoTracks()[0];m.canvas||(m.canvas=a),a.startCapture=()=>{if(!r)return a.stopCapture&&a.stopCapture();if(r.paused&&r.play(),r.videoHeight>2&&r.videoWidth>2){const C=a.width*(r.videoHeight/r.videoWidth);Math.abs(C-a.height)>=2&&(R.debug("adjust low stream resolution","".concat(a.width,"x").concat(a.height," -> ").concat(a.width,"x").concat(C)),a.height=C)}h.drawImage(r,0,0,a.width,a.height),m.requestFrame&&m.requestFrame(),d!==s._mediaStreamTrack&&(d=s._mediaStreamTrack,r.srcObject=new MediaStream([d]))},a.stopCapture=zD(()=>a.startCapture&&a.startCapture(),l);const g=m.stop;return m.stop=()=>{g.call(m),r&&(r.remove(),r.srcObject=null,r=null),a&&(a.width=0,a.remove(),a.stopCapture&&a.stopCapture(),a.startCapture=void 0,a.stopCapture=void 0,a=null),R.debug("clean low stream renderer")},m}function xb(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function gN(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?xb(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):xb(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}oe([Io,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",q)],wi.prototype,"connect",null),oe([Io,N("design:type",Function),N("design:paramtypes",[Object,Array]),N("design:returntype",q)],wi.prototype,"createDataChannels",null),oe([Io,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",q)],wi.prototype,"receive",null),oe([Io,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],wi.prototype,"batchReceive",null),oe([Io,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],wi.prototype,"stopReceiving",null),oe([Io,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],wi.prototype,"muteRemote",null),oe([Io,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],wi.prototype,"unmuteRemote",null),oe([Io,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],wi.prototype,"muteLocal",null),oe([Io,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],wi.prototype,"unmuteLocal",null),oe([Io,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],wi.prototype,"close",null),oe([Io,N("design:type",Function),N("design:paramtypes",[String,jt]),N("design:returntype",q)],wi.prototype,"updateEncoderConfig",null),oe([Io,N("design:type",Function),N("design:paramtypes",[String,jt]),N("design:returntype",q)],wi.prototype,"updateSendParameters",null),oe([Io,N("design:type",Function),N("design:paramtypes",[jt,String]),N("design:returntype",q)],wi.prototype,"replaceTrack",null),oe([Io,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],wi.prototype,"getRemoteSSRC",null);const my="v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0\na=msid-semantic: WMS\na=ice-lite\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 127.0.0.1\na=mid:0\n";class Vb{get localCapabilities(){return Pn(this._localCapabilities)}get rtpCapabilities(){return Pn(this._rtpCapabilities)}get candidates(){return Pn(this._candidates)}get iceParameters(){return Pn(this._iceParameters)}get dtlsParameters(){return Pn(this._dtlsParameters)}constructor(i){T(this,"sessionDesc",void 0),T(this,"_localCapabilities",void 0),T(this,"_rtpCapabilities",void 0),T(this,"_candidates",void 0),T(this,"_iceParameters",void 0),T(this,"_dtlsParameters",void 0),T(this,"setup",void 0),T(this,"currentMidIndex",void 0),T(this,"cname",void 0),T(this,"firefoxSsrcMidMap",new Map),i=Pn(i);const{remoteIceParameters:r,remoteDtlsParameters:a,candidates:l,remoteRTPCapabilities:d,remoteSetup:h,localCapabilities:f,cname:m}=i,g=mn.parse(my);this._rtpCapabilities=d,this._candidates=l,this._iceParameters=r,this._dtlsParameters=a,this._localCapabilities=f,this.setup=h,this.cname=m;const E=this.rtpCapabilities.send;for(const y of g.mediaDescriptions){if(y.attributes.iceUfrag=r.iceUfrag,y.attributes.icePwd=r.icePwd,y.attributes.fingerprints=a.fingerprints,y.attributes.candidates=l,y.attributes.setup=h,"application"===y.media.mediaType&&(y.attributes.sctpPort="5000"),"video"===y.media.mediaType&&(y.media.fmts=E.videoCodecs.map(C=>C.payloadType.toString(10)),y.attributes.payloads=E.videoCodecs,y.attributes.extmaps=E.videoExtensions,H("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:C,ssrcGroups:b}=os([{ssrcId:4e4,rtx:H("USE_SUB_RTX")?40001:void 0}],this.cname);y.attributes.ssrcs=C,y.attributes.ssrcGroups=b}if("audio"===y.media.mediaType&&(y.media.fmts=E.audioCodecs.map(C=>C.payloadType.toString(10)),y.attributes.payloads=E.audioCodecs,y.attributes.extmaps=E.audioExtensions,ks(y),H("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:C,ssrcGroups:b}=os([{ssrcId:2e4}],this.cname);y.attributes.ssrcs=C,y.attributes.ssrcGroups=b}}this.sessionDesc=g,this.currentMidIndex=g.mediaDescriptions.length-1}updateRemoteRTPCapabilities(i){const r=mn.parse(my);this._rtpCapabilities=i;const a=this.rtpCapabilities.send;for(const l of r.mediaDescriptions){if(l.attributes.iceUfrag=this._iceParameters.iceUfrag,l.attributes.icePwd=this._iceParameters.icePwd,l.attributes.fingerprints=this._dtlsParameters.fingerprints,l.attributes.candidates=this._candidates,l.attributes.setup=this.setup,"application"===l.media.mediaType&&(l.attributes.sctpPort="5000"),"video"===l.media.mediaType&&(l.media.fmts=a.videoCodecs.map(d=>d.payloadType.toString(10)),l.attributes.payloads=a.videoCodecs,l.attributes.extmaps=a.videoExtensions,H("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:d,ssrcGroups:h}=os([{ssrcId:4e4,rtx:H("USE_SUB_RTX")?40001:void 0}],this.cname);l.attributes.ssrcs=d,l.attributes.ssrcGroups=h}if("audio"===l.media.mediaType&&(l.media.fmts=a.audioCodecs.map(d=>d.payloadType.toString(10)),l.attributes.payloads=a.audioCodecs,l.attributes.extmaps=a.audioExtensions,H("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:d,ssrcGroups:h}=os([{ssrcId:2e4}],this.cname);l.attributes.ssrcs=d,l.attributes.ssrcGroups=h}}this.sessionDesc=r,this.currentMidIndex=r.mediaDescriptions.length-1}preloadRemoteMedia(i){const r=this.candidates,a=this.dtlsParameters,l=this.iceParameters,d=this.rtpCapabilities.send;for(let h=1;h<i;h++){const f=2*h+2e4,m=2*h+4e4,{ssrcs:g,ssrcGroups:E}=os([{ssrcId:f}],this.cname),{ssrcs:y,ssrcGroups:C}=os([{ssrcId:m,rtx:H("USE_SUB_RTX")?m+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.videoCodecs.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:l.iceUfrag,icePwd:l.icePwd,unrecognized:[],candidates:r,extmaps:d.videoExtensions,fingerprints:a.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:y,ssrcGroups:C,rtcpFeedbackWildcards:[],payloads:d.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.audioCodecs.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:l.iceUfrag,icePwd:l.icePwd,unrecognized:[],candidates:r,extmaps:d.audioExtensions,fingerprints:a.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:g,ssrcGroups:E,rtcpFeedbackWildcards:[],payloads:d.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return mn.print(this.sessionDesc)}send(i,r,a,l){const{ssrcs:d,ssrcGroups:h}=os(r,this.cname,H("SYNC_GROUP")?a:void 0),f=this.findPreloadMediaDesc(d);if(f){if(Pt()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,f.attributes.mid),l&&(l.twcc||l.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(f);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(f,l),{mid:f.attributes.mid,needExchangeSDP:!0}}return{mid:f.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(i,d);let g;return-1===m||Yt()||Ci()||CS()||0===m&&H("USE_SUB_RTX")?(g=this.createOrRecycleSendMedia(i,d,h,"sendonly",l),this.updateBundleMids()):(g=Pn(this.sessionDesc.mediaDescriptions[m]),g.attributes.direction="sendonly",g.attributes.ssrcs=d,g.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(g,l)),Pt()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,g.attributes.mid),{mid:g.attributes.mid,needExchangeSDP:!0}}}batchSend(i){const r=i.map(d=>{let{kind:h,ssrcMsg:f,mslabel:m}=d;return this.send(h,f,m)}),a=[];let l=!1;return r.forEach(d=>{let{mid:h,needExchangeSDP:f}=d;f&&(l=!0),a.push(h)}),{mids:a,needExchangeSDP:l}}stopSending(i){const r=this.sessionDesc.mediaDescriptions.filter(a=>a.attributes.mid&&-1!==i.indexOf(a.attributes.mid));if(r.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(a=>{"0"===a.attributes.mid||Pt()||Yt()||Ci()?a.attributes.ssrcs=[]:(a.attributes.ssrcs=[],a.attributes.direction="inactive",a.media.port="0")}),this.updateBundleMids()}mute(i){const r=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===i);if(!r)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(i){const r=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===i);if(!r)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}muteRemote(i){const r=this.sessionDesc.mediaDescriptions.filter(a=>we(i).call(i,a.attributes.mid||""));if(r.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(a=>{a.attributes.direction="inactive"})}unmuteRemote(i){const r=this.sessionDesc.mediaDescriptions.filter(a=>we(i).call(i,a.attributes.mid||""));if(r.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(a=>{a.attributes.direction="recvonly"})}receive(i,r,a,l){i.forEach((d,h)=>{this.createOrRecycleRecvMedia(d,[],"recvonly",r,a,l[h])}),this.updateBundleMids()}stopReceiving(i){const r=this.sessionDesc.mediaDescriptions.filter(a=>-1!==i.indexOf(a.attributes.mid));if(r.length!==i.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(a=>{a.media.port="0",a.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(i){i===fi.TCP?this._candidates.forEach(r=>{-1===this._candidates.findIndex(a=>"tcp"===a.transport&&a.connectionAddress===r.connectionAddress&&a.port===r.port)&&this._candidates.push(gN(gN({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}):this._candidates=this._candidates.filter(r=>"tcp"!==r.transport);for(const r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}restartICE(i){i=Pn(i),this._iceParameters=i,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=i.iceUfrag,r.attributes.icePwd=i.icePwd})}predictReceivingMids(i){const r=[];for(let a=0;a<i;a++)r.push((this.currentMidIndex+a+1).toString(10));return r}findAvailableMediaIndex(i,r){return this.sessionDesc.mediaDescriptions.findIndex(a=>{const l=a.media.mediaType===i&&"0"!==a.media.port&&("sendonly"===a.attributes.direction||"sendrecv"===a.attributes.direction)&&0===a.attributes.ssrcs.length;if(Pt()){if(l){const d=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(d||"0"!==a.attributes.mid&&"1"!==a.attributes.mid)||!(!d||d!==a.attributes.mid)}return!1}return l})}createOrRecycleRecvMedia(i,r,a,l,d,h){const f=i._mediaStreamTrack.kind,m=this.rtpCapabilities.recv,g=this.localCapabilities.send;let E=[];if(f===ye.VIDEO){var y,C;if(H("H264_PROFILE_LEVEL_ID")&&"h264"===l&&(E=m.videoCodecs.filter(L=>{var B,V,J;return we(B=(null===(V=L.rtpMap)||void 0===V?void 0:V.encodingName.toLowerCase())||"").call(B,l)&&(null==L||null===(J=L.fmtp)||void 0===J?void 0:J.parameters["profile-level-id"])===H("H264_PROFILE_LEVEL_ID")})),!E||0===(null===(y=E)||void 0===y?void 0:y.length)){const L=g.videoCodecs.filter(B=>{var V,J;return we(V=(null===(J=B.rtpMap)||void 0===J?void 0:J.encodingName.toLowerCase())||"").call(V,l)});0!==L.length&&(E=m.videoCodecs.filter(B=>L.some(V=>V.payloadType===B.payloadType)))}if(H("USE_PUB_RTX")){const L=E.map(V=>V.payloadType.toString()),B=m.videoCodecs.filter(V=>{var J,ae;return"rtx"===(null===(J=V.rtpMap)||void 0===J?void 0:J.encodingName)&&we(L).call(L,(null===(ae=V.fmtp)||void 0===ae?void 0:ae.parameters.apt)||"")});E=[...E,...B]}0===E.length&&(R.warning("codec ".concat(l," not included in rtpCapabilities, fallback to default payloads: ").concat(null===(C=m.videoCodecs[0].rtpMap)||void 0===C?void 0:C.encodingName)),E=m.videoCodecs)}else E=m.audioCodecs.filter(L=>{var B,V;return we(B=(null===(V=L.rtpMap)||void 0===V?void 0:V.encodingName.toLowerCase())||"").call(B,d)}),0===E.length&&(R.warning("codec ".concat(d," not included in rtpCapabilities, fallback to opus")),E=m.audioCodecs.filter(L=>{var B,V;return we(B=(null===(V=L.rtpMap)||void 0===V?void 0:V.encodingName.toLowerCase())||"").call(B,"opus")}));const b=f===ye.VIDEO?m.videoExtensions:m.audioExtensions;this.currentMidIndex+=1;const O="".concat(this.currentMidIndex);let P={media:{mediaType:f,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:E.map(L=>L.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:b,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:E,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(O)}};P=this.mungRecvMediaDsec(P,i,h);const D=this.findFirstClosedMedia(f);if(D){const L=this.sessionDesc.mediaDescriptions.indexOf(D);this.sessionDesc.mediaDescriptions[L]=P}else this.sessionDesc.mediaDescriptions.push(P);return P}createOrRecycleSendMedia(i,r,a,l,d){const h=this.rtpCapabilities.send,f=i===ye.VIDEO?h.videoCodecs:h.audioCodecs,m=i===ye.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const g="".concat(this.currentMidIndex);let E={media:{mediaType:i,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(C=>C.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:a,rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:l,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};E=this.mungSendMediaDesc(E,d);const y=this.findFirstClosedMedia(i);if(y){const C=this.sessionDesc.mediaDescriptions.indexOf(y);this.sessionDesc.mediaDescriptions[C]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(i=>"0"!==i.media.port).map(i=>i.attributes.mid)}mungRecvMediaDsec(i,r,a){const l=Pn(i);return Ab(l),zl(l,r),Db(l,r),m2(l),ao(l,a,this.localCapabilities.send),l}mungSendMediaDesc(i,r){const a=Pn(i);return ao(a,r,this.localCapabilities.recv),ks(a),a}updateRecvMedia(i,r){const a=this.sessionDesc.mediaDescriptions.findIndex(l=>l.attributes.mid===i);if(-1!==a){const l=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],r);this.sessionDesc.mediaDescriptions[a]=l}}bumpMid(i){this.currentMidIndex+=i}findFirstClosedMedia(i){return this.sessionDesc.mediaDescriptions.find(r=>Pt()?"0"===r.media.port&&r.media.mediaType===i:"0"===r.media.port)}findPreloadMediaDesc(i){return this.sessionDesc.mediaDescriptions.find(r=>{var a;return(null===(a=r.attributes)||void 0===a||null===(a=a.ssrcs[0])||void 0===a?void 0:a.ssrcId)===i[0].ssrcId})}getSSRC(i){var r;return null===(r=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===i))||void 0===r?void 0:r.attributes.ssrcs}}function EN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Ey(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?EN(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):EN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class Ji extends SE{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(i,r,a){super(i,r),T(this,"store",void 0),T(this,"peerConnection",void 0),T(this,"remoteSDP",void 0),T(this,"initialOffer",void 0),T(this,"transportEventReceiver",void 0),T(this,"statsFilter",void 0),T(this,"useXR",H("USE_XR")),T(this,"localCapabilities",void 0),T(this,"localCandidateCount",0),T(this,"allCandidatesReceived",!1),T(this,"dataStreamChannelMap",new Map),T(this,"establishPromise",void 0),T(this,"mutex",new Gn("NVExtentionsConnection-mutex")),T(this,"rtcMedia",void 0),this.store=r,this.peerConnection=a,this.statsFilter=_y(this.peerConnection,H("STATS_UPDATE_INTERVAL"),void 0,Pt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(i){var r=this;return x(function*(){try{const a=yield r.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const l=yp(a.sdp),d=yield lN({filterRTX:!H("USE_PUB_RTX")&&!H("USE_SUB_RTX"),filterVideoFec:H("FILTER_VIDEO_FEC"),filterAudioFec:H("FILTER_AUDIO_FEC")},{useXR:r.useXR});return r.localCapabilities=d,r.initialOffer=a,Ey(Ey({},l),{},{rtpCapabilities:d,offerSDP:a.sdp})}catch(a){throw new K(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}})()}connect(i,r,a,l,d,h){var f=this;return x(function*(){try{if(!f.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");f.remoteSDP=new Vb({remoteIceParameters:i,remoteDtlsParameters:r,candidates:a,remoteRTPCapabilities:l,remoteSetup:d,localCapabilities:Nb(f.localCapabilities),cname:h});const m=f.remoteSDP.toString(),g=mn.parse(f.initialOffer.sdp),E=g.mediaDescriptions.find(b=>"audio"===b.media.mediaType);E&&ks(E),f.useXR&&py(g);const y=mn.print(g),C=f.logSDPExchange(y||"","offer","local","connect");yield f.peerConnection.setLocalDescription({type:"offer",sdp:y}),null==C||C(m),yield f.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(m){throw new K(k.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(m.toString()))}})()}updateRemoteConnect(i){var r=this;return x(function*(){var a,l,d;null===(a=r.remoteSDP)||void 0===a||a.updateRemoteRTPCapabilities(i),null===(l=r.remoteSDP)||void 0===l||l.preloadRemoteMedia(2);const h=null===(d=r.remoteSDP)||void 0===d?void 0:d.toString();yield r.peerConnection.setRemoteDescription({type:"offer",sdp:h});const f=yield r.peerConnection.createAnswer();yield r.peerConnection.setLocalDescription(f),R.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")})()}send(i,r,a){var l=this;return is(function*(){const d=yield _t(l.mutex.lock("From NVExtentionsConnection.send"));try{if(!l.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const h=[];i.forEach(P=>{const D=l.peerConnection.addTransceiver(P._mediaStreamTrack,{direction:"sendonly"});h.push(D)}),Pt()&&!0===H("SIMULCAST")&&(yield _t(l.applySimulcastForFirefox(h,i)));const f=yield _t(l.peerConnection.createOffer()),m=l.remoteSDP.predictReceivingMids(i.length),g=l.mungSendOfferSDP(f.sdp,i,m),E=mn.parse(g),y=m.map(P=>{const D=E.mediaDescriptions.find(L=>L.attributes.mid===P);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return _2(D,H("USE_PUB_RTX"))});let C;try{C=yield y}catch(P){C=[],l.remoteSDP.receive(i,r,a,C);const D=l.remoteSDP.toString();throw yield _t(l.peerConnection.setLocalDescription({type:"offer",sdp:g})),yield _t(l.peerConnection.setRemoteDescription({type:"answer",sdp:D})),yield _t(l.stopSending(m,!0)),P}l.remoteSDP.receive(i,r,a,C);const b=l.remoteSDP.toString(),O=l.logSDPExchange(g,"offer","local","send");return yield _t(l.peerConnection.setLocalDescription({type:"offer",sdp:g})),yield _t(l.applySimulcastEncodings(h,i)),yield _t(l.applySendEncodings(h,i)),null==O||O(b),yield _t(l.peerConnection.setRemoteDescription({type:"answer",sdp:b})),h.map((P,D)=>({localSSRC:y[D],id:m[D],transceiver:P}))}catch(h){throw h instanceof K?h:new K(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(h.toString()))}finally{d()}})()}stopSending(i,r){var a=this;return x(function*(){const l=r?void 0:yield a.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!a.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const d=a.peerConnection.getTransceivers().filter(g=>-1!==i.indexOf(g.mid));if(d.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");d.map(g=>{var E;g.direction="inactive",null===(E=g.stop)||void 0===E||E.call(g)});const h=yield a.peerConnection.createOffer(),f=a.logSDPExchange(h.sdp||"","offer","local","stopSending");yield a.peerConnection.setLocalDescription(h),a.remoteSDP.stopReceiving(i);const m=a.remoteSDP.toString();null==f||f(m),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(d){throw new K(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(d.toString()))}finally{l&&l()}})()}createDataChannels(i,r){var a=this;return x(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let l=a.dataStreamChannelMap.get(i);return l&&"open"===l.readyState?R.debug("[P2PConnection] Channels are already available and can be reused directly."):(l=a.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:H("DATASTREAM_MAX_RETRANSMITS")}),l.binaryType="arraybuffer",a.dataStreamChannelMap.set(i,l)),void r.forEach(d=>{d._updateOriginDataChannel(l)})}catch(l){throw l instanceof K?l:new K(k.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(l.toString()))}})()}stopDataChannels(i){var r=this;return x(function*(){try{const a=r.dataStreamChannelMap.get(i);return null==a||a.close(),void r.dataStreamChannelMap.delete(i)}catch(a){throw a instanceof K?a:new K(k.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(a.toString()))}})()}receive(i,r,a,l){var d=this;return x(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(i," before remoteSDP created."));const{mid:h,needExchangeSDP:f}=d.remoteSDP.send(i,r,a,l);if(f){const g=d.remoteSDP.toString(),E=d.logSDPExchange(g,"offer","remote","receive");yield d.peerConnection.setRemoteDescription({type:"offer",sdp:g});const y=yield d.peerConnection.createAnswer(),C=d.mungReceiveAnswerSDP(y.sdp,h,i);null==E||E(C||""),yield d.peerConnection.setLocalDescription({type:"answer",sdp:C}),R.debug("[NVExtentionsConnection] receive ".concat(i," by exchanging SDP."))}else R.debug("[NVExtentionsConnection] receive ".concat(i," no need to exchange SDP."));const m=d.peerConnection.getTransceivers().find(g=>g.mid===h);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:h}}catch(h){throw new K(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(h.toString()))}})()}batchReceive(i){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:a,needExchangeSDP:l}=r.remoteSDP.batchSend(i);if(l){const d=r.remoteSDP.toString(),h=r.logSDPExchange(d,"offer","remote","receive");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:d});const f=yield r.peerConnection.createAnswer();null==h||h(f.sdp||""),yield r.peerConnection.setLocalDescription(f),R.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else R.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return a.map(d=>{const h=r.peerConnection.getTransceivers().find(f=>f.mid===d);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:d}})}catch(a){throw new K(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(a.toString()))}})()}stopReceiving(i){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");r.remoteSDP.stopSending(i);const a=r.remoteSDP.toString(),l=r.logSDPExchange(a,"offer","remote","stopReceiving");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield r.peerConnection.createAnswer();null==l||l(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(a){throw new K(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(a.toString()))}})()}muteRemote(i){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(i," before remote SDP created."));r.remoteSDP.mute(i);const a=r.remoteSDP.toString(),l=r.logSDPExchange(a,"offer","remote","muteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield r.peerConnection.createAnswer();null==l||l(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(a){throw new K(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(a.toString()))}})()}unmuteRemote(i){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(i," before remote SDP created."));r.remoteSDP.unmute(i);const a=r.remoteSDP.toString(),l=r.logSDPExchange(a,"offer","remote","unmuteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield r.peerConnection.createAnswer();null==l||l(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(a){throw new K(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(a.toString()))}})()}muteLocal(i){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(f=>f.mid&&-1!==i.indexOf(f.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(f=>{f.direction="inactive"});const l=yield r.peerConnection.createOffer(),d=r.logSDPExchange(l.sdp||"","offer","local","muteLocal");yield r.peerConnection.setLocalDescription(l),r.remoteSDP.muteRemote(i);const h=r.remoteSDP.toString();null==d||d(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new K(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(a.toString()))}})()}unmuteLocal(i){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(f=>f.mid&&-1!==i.indexOf(f.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(function(){var f=x(function*(m,g){m.direction="sendonly"});return function(m,g){return f.apply(this,arguments)}}());const l=yield r.peerConnection.createOffer(),d=r.logSDPExchange(l.sdp||"","offer","local","unmuteLocal");yield r.peerConnection.setLocalDescription(l),r.remoteSDP.unmuteRemote(i);const h=r.remoteSDP.toString();null==d||d(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new K(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(a.toString()))}})()}restartICE(i){var r=this;return is(function*(){const a=yield _t(r.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Rt().supportPCSetConfiguration){const g=r.peerConnection.getConfiguration(),E=i===fi.RELAY?"relay":"all";g.iceTransportPolicy!==E&&(R.debug("restartICE change iceTransportPolicy from [".concat(g.iceTransportPolicy,"] to [").concat(E,"]")),g.iceTransportPolicy=E,r.peerConnection.setConfiguration(g))}else if(i===fi.RELAY)return;i!==fi.RELAY&&r.remoteSDP.updateCandidates(i);const l=yield _t(r.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=yp(l.sdp),{remoteIceParameters:h}=yield d.iceParameters;r.remoteSDP.restartICE(h);const f=r.remoteSDP.toString(),m=r.logSDPExchange(l.sdp||"","offer","local","restartICE");yield _t(r.peerConnection.setLocalDescription(l)),null==m||m(f),yield _t(r.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(l){R.warning("restart ICE failed, abort operation",l)}finally{a()}})()}close(){var i;null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}updateEncoderConfig(i,r){var a=this;return x(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const l=yield a.peerConnection.createOffer(),d=a.mungSendOfferSDP(l.sdp,[r],[i]);a.remoteSDP.updateRecvMedia(i,r);const h=a.remoteSDP.toString(),f=a.logSDPExchange(d,"offer","local","updateEncoderConfig");yield a.peerConnection.setLocalDescription({type:"offer",sdp:d}),null==f||f(h),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(l){throw new K(k.EXCHANGE_SDP_FAILED,l.toString())}})()}updateSendParameters(i,r){var a=this;return x(function*(){const l=a.peerConnection.getTransceivers().filter(d=>d.mid===i);1===l.length&&(a.isVP8Simulcast(r)?Pt()||(yield a.applySimulcastEncodings(l,[r])):yield a.applySendEncodings(l,[r]))})()}setStatsRemoteVideoIsReady(i,r){this.statsFilter.setVideoIsReady2(i,r)}replaceTrack(i,r){var a=this;return x(function*(){const l=a.peerConnection.getTransceivers().find(d=>d.mid===r);l&&(yield l.sender.replaceTrack(i._mediaStreamTrack))})()}getP2PConnectionParams(){var i;if(null===(i=this.peerConnection.currentLocalDescription)||void 0===i||!i.sdp||!this.localCapabilities)throw new Error;return Ey(Ey({},yp(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;null===(i=this.onICEConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},H("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const r={iceServers:[]};return i.iceServers?r.iceServers=i.iceServers:i.turnServer&&"off"!==i.turnServer.mode&&(Qd(i.turnServer.servers)?r.iceServers=i.turnServer.servers:(r.iceServers&&r.iceServers.push(...Ji.turnServerConfigToIceServers(i.turnServer.servers)),H("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&i.turnServer.serversFromGateway&&r.iceServers.push(...Ji.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),H("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(i){const r=[];return i.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(H_(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!H("FORCE_TURN_TCP")&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}applySendEncodings(i,r){var a=this;return x(function*(){try{if(!Rt().supportSetRtpSenderParameters||i.length!==r.length)return;for(let C=0;C<i.length;C++){const b=i[C],O=r[C];if(O&&O instanceof Ye){var l,d,h;if(a.isVP8Simulcast(O))continue;const P={},D={};switch(O._optimizationMode){case"motion":P.degradationPreference="maintain-framerate";break;case"detail":P.degradationPreference="maintain-resolution";break;default:P.degradationPreference="balanced"}var f,m,g,E;if(null!==(l=O._encoderConfig)&&void 0!==l&&l.bitrateMax&&(D.maxBitrate=1e3*(null===(f=O._encoderConfig)||void 0===f?void 0:f.bitrateMax)),we(d=O._hints).call(d,Qt.LOW_STREAM)&&(null!==(m=O._encoderConfig)&&void 0!==m&&m.frameRate&&(D.maxFramerate=To(O._encoderConfig.frameRate)),null!==(g=O._encoderConfig)&&void 0!==g&&g.scaleResolutionDownBy&&(null===(E=O._encoderConfig)||void 0===E?void 0:E.scaleResolutionDownBy)>1&&(D.scaleResolutionDownBy=O._encoderConfig.scaleResolutionDownBy)),H("DSCP_TYPE")&&Il()){var y;const V=H("DSCP_TYPE");we(y=["very-low","low","medium","high"]).call(y,V)&&(D.networkPriority=V)}const L=b.sender.getParameters(),B=null===(h=L.encodings)||void 0===h?void 0:h[0];Pt()&&!B&&(P.encodings=[D]),B&&Object.assign(B,D),Object.assign(L,P),yield b.sender.setParameters(L)}}}catch(C){R.debug("Apply RTPSendEncodings failed.")}})()}mungSendOfferSDP(i,r,a){const l=mn.parse(i);return r.forEach((d,h)=>{const f=a[h],m=l.mediaDescriptions.find(g=>g.attributes.mid===f);m&&(zl(m,d),J_(m,d,this.store.codec))}),mn.print(l)}mungReceiveAnswerSDP(i,r,a){const l=mn.parse(i),d=l.mediaDescriptions.find(h=>h.attributes.mid===r);return d&&a===ye.AUDIO&&"audio"===d.media.mediaType&&ks(d),this.useXR&&py(l),mn.print(l)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,r,a)=>{var l;null===(l=this.onFirstVideoDecoded)||void 0===l||l.call(this,i,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var r;null===(r=this.onFirstVideoDecodedTimeout)||void 0===r||r.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(i,r){var a=this;return x(function*(){if(i.length===r.length)for(let g=0;g<i.length;g++){var l,d,h,f,m;const E=i[g],y=r[g];if(y instanceof Ye&&!we(l=y._hints).call(l,Qt.LOW_STREAM)&&null!==(d=y._encoderConfig)&&void 0!==d&&d.bitrateMax&&(null===(h=y._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(f=y._scalabilityMode)&&void 0!==f&&f.numSpatialLayers&&(null===(m=y._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===a.store.codec){const C={},b={high:1e3*(y._encoderConfig.bitrateMax-50),medium:5e4};C.encodings=[{rid:"m",active:!0,maxBitrate:b.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:b.high}];const O=E.sender.getParameters();yield E.sender.setParameters(Object.assign(O,C))}}})()}applySimulcastEncodings(i,r){var a=this;return x(function*(){if(!Pt()&&i.length===r.length)for(let l=0;l<i.length;l++){const d=r[l];if(d instanceof Ye&&a.isVP8Simulcast(d)){const h=i[l],f={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=h.sender.getParameters();yield h.sender.setParameters(Object.assign(g,f))}}})()}isVP8Simulcast(i){var r,a,l,d,h;return!!(i instanceof Ye&&H("SIMULCAST")&&"vp8"===this.store.codec&&!we(r=i._hints).call(r,Qt.LOW_STREAM)&&null!==(a=i._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(l=i._encoderConfig)||void 0===l?void 0:l.bitrateMax)>200&&null!==(d=i._scalabilityMode)&&void 0!==d&&d.numSpatialLayers&&(null===(h=i._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(i,r,a,l){if(H("SDP_LOGGING"))return R.upload("exchanging ".concat(a," ").concat(r," SDP during NVExtentionsConnection.").concat(l,"\n"),i),"offer"===r?d=>{this.logSDPExchange(d,"answer","local"===a?"remote":"local",l)}:void 0}getRemoteSSRC(i){var r=this;return x(function*(){if(!r.remoteSDP)return;const a=r.remoteSDP.getSSRC(i);return null==a?void 0:a[0].ssrcId})()}setConfiguration(i){if(Rt().supportPCSetConfiguration){const r=Ji.resolvePCConfiguration(i);this.peerConnection.setConfiguration(r)}}}function Pr(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=x(function*(){const l=this.mutex,d=yield l.lock("From NVExtentionsConnection.".concat(i));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return yield a.apply(this,f)}finally{d()}}),r}function tm(s){var i,r,a,l=2;for("undefined"!=typeof Symbol&&(r=Y_,a=Symbol.iterator);l--;){if(r&&null!=(i=s[r]))return i.call(s);if(a&&null!=(i=s[a]))return new nm(i.call(s));r="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function nm(s){function i(r){if(Object(r)!==r)return q.reject(new TypeError(r+" is not an object."));var a=r.done;return q.resolve(r.value).then(function(l){return{value:l,done:a}})}return(nm=function(r){this.s=r,this.n=r.next}).prototype={s:null,n:null,next:function(){return i(this.n.apply(this.s,arguments))},return:function(r){var a=this.s.return;return void 0===a?q.resolve({value:r,done:!0}):i(a.apply(this.s,arguments))},throw:function(r){var a=this.s.return;return void 0===a?q.reject(r):i(a.apply(this.s,arguments))}},new nm(s)}oe([Pr,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",q)],Ji.prototype,"connect",null),oe([Pr,N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",q)],Ji.prototype,"updateRemoteConnect",null),oe([Pr,N("design:type",Function),N("design:paramtypes",[Object,Array]),N("design:returntype",q)],Ji.prototype,"createDataChannels",null),oe([Pr,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",q)],Ji.prototype,"receive",null),oe([Pr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],Ji.prototype,"batchReceive",null),oe([Pr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],Ji.prototype,"stopReceiving",null),oe([Pr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Ji.prototype,"muteRemote",null),oe([Pr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Ji.prototype,"unmuteRemote",null),oe([Pr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],Ji.prototype,"muteLocal",null),oe([Pr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],Ji.prototype,"unmuteLocal",null),oe([Pr,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Ji.prototype,"close",null),oe([Pr,N("design:type",Function),N("design:paramtypes",[String,jt]),N("design:returntype",q)],Ji.prototype,"updateEncoderConfig",null),oe([Pr,N("design:type",Function),N("design:paramtypes",[String,jt]),N("design:returntype",q)],Ji.prototype,"updateSendParameters",null),oe([Pr,N("design:type",Function),N("design:paramtypes",[jt,String]),N("design:returntype",q)],Ji.prototype,"replaceTrack",null),oe([Pr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Ji.prototype,"getRemoteSSRC",null);class mi extends SE{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(i,r){super(i,r),T(this,"store",void 0),T(this,"peerConnection",void 0),T(this,"cname",void 0),T(this,"mutex",new Gn("DataChannelConnection-mutex")),T(this,"dataChannel",void 0),T(this,"_p2pConnection",void 0),T(this,"establishPromise",void 0),T(this,"_nvMedia",void 0),this.store=r,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(mi.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new Ji(i,r,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}establish(){var i=this;return x(function*(){var r;const a=null===(r=i._nvMedia)||void 0===r?void 0:r.getLocalRtpCapabilities();return yield i._p2pConnection.establish(a)})()}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}connect(i,r,a,l,d,h){var f=this;return x(function*(){return f.cname=h,yield f._p2pConnection.connect(i,r,a,l,d,h),yield new q((m,g)=>{const E=setTimeout(()=>{f.closeSignal(),g(new K(k.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(a))))},2e3);f.dataChannel.onopen=()=>{if("open"===f.dataChannel.readyState)return clearTimeout(E),void m()},f.dataChannel.onerror=y=>{f.closeSignal(),g(y)}}),{transmitter:f.dataChannel,close:f.closeSignal.bind(f)}})()}send(i,r,a){var l=this;return is(function*(){const d=yield _t(l.mutex.lock("From DataChannelConnection.send"));try{return yield*wb(tm(l._p2pConnection.send(i,r,a)))}finally{d()}})()}stopSending(i,r){var a=this;return x(function*(){return a._p2pConnection.stopSending(i,r)})()}createDataChannels(i,r){var a=this;return x(function*(){return a._p2pConnection.createDataChannels(i,r)})()}stopDataChannels(i){var r=this;return x(function*(){return r._p2pConnection.stopDataChannels(i)})()}receive(i,r,a,l){var d=this;return x(function*(){return d._nvMedia?(R.debug("[DataChannelConnection] receive ".concat(i," by DataChannel.")),yield d._nvMedia.reveiveByRTCMedia(i,r,d.cname)):(R.debug("[DataChannelConnection] receive ".concat(i," by WebRTC.")),yield d._p2pConnection.receive(i,r,a,l))})()}batchReceive(i){var r=this;return x(function*(){return[...yield r._p2pConnection.batchReceive(i)]})()}stopReceiving(i){var r=this;return x(function*(){return yield r._p2pConnection.stopReceiving(i)})()}muteRemote(i){var r=this;return x(function*(){return yield r._p2pConnection.muteRemote(i)})()}unmuteRemote(i){var r=this;return x(function*(){return yield r._p2pConnection.unmuteRemote(i)})()}muteLocal(i){var r=this;return x(function*(){return yield r._p2pConnection.muteLocal(i)})()}unmuteLocal(i){var r=this;return x(function*(){return yield r._p2pConnection.unmuteLocal(i)})()}restartICE(i){var r=this;return is(function*(){return yield*wb(tm(r._p2pConnection.restartICE(i)))})()}close(){var i;null===(i=this._nvMedia)||void 0===i||i.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(i){return this._p2pConnection.getRemoteVideoIsReady(i)}updateRemoteConnect(i){var r;null===(r=this._nvMedia)||void 0===r||r.setRemoteRtpCapabilities(i),this._p2pConnection.updateRemoteConnect(i)}updateEncoderConfig(i,r){var a=this;return x(function*(){return yield a._p2pConnection.updateEncoderConfig(i,r)})()}updateSendParameters(i,r){var a=this;return x(function*(){return yield a._p2pConnection.updateSendParameters(i,r)})()}setStatsRemoteVideoIsReady(i,r){this._p2pConnection.setStatsRemoteVideoIsReady(i,r)}replaceTrack(i,r){var a=this;return x(function*(){return yield a._p2pConnection.replaceTrack(i,r)})()}getRemoteSSRC(i){var r=this;return x(function*(){return r._p2pConnection.getRemoteSSRC(i)})()}logSDPExchange(i,r,a,l){if(H("SDP_LOGGING"))return R.upload("exchanging ".concat(a," ").concat(r," SDP during DataChannelConnection.").concat(l,"\n"),i),"offer"===r?d=>{this.logSDPExchange(d,"answer","local"===a?"remote":"local",l)}:void 0}static resolvePCConfiguration(i){const r={iceServers:[]};return i.iceServers?r.iceServers=i.iceServers:i.turnServer&&"off"!==i.turnServer.mode&&(Qd(i.turnServer.servers)?r.iceServers=i.turnServer.servers:(r.iceServers&&r.iceServers.push(...mi.turnServerConfigToIceServers(i.turnServer.servers)),H("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&i.turnServer.serversFromGateway&&r.iceServers.push(...mi.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),H("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(i){const r=[];return i.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(H_(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!H("FORCE_TURN_TCP")&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=i=>{var r;return null===(r=this.onICEConnectionStateChange)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onConnectionStateChange=i=>{var r;return null===(r=this.onConnectionStateChange)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onDTLSTransportStateChange=i=>{var r;return null===(r=this.onDTLSTransportStateChange)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onDTLSTransportError=i=>{var r;return null===(r=this.onDTLSTransportError)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onICETransportStateChange=i=>{var r;return null===(r=this.onICETransportStateChange)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onFirstAudioReceived=i=>{var r;return null===(r=this.onFirstAudioReceived)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onFirstVideoReceived=i=>{var r;return null===(r=this.onFirstVideoReceived)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onFirstAudioDecoded=i=>{var r;return null===(r=this.onFirstAudioDecoded)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onFirstVideoDecoded=(i,r,a)=>{var l;return null===(l=this.onFirstVideoDecoded)||void 0===l?void 0:l.call(this,i,r,a)},this._p2pConnection.onFirstVideoDecodedTimeout=i=>{var r;return null===(r=this.onFirstVideoDecodedTimeout)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onSelectedLocalCandidateChanged=(i,r)=>{var a;return null===(a=this.onSelectedLocalCandidateChanged)||void 0===a?void 0:a.call(this,i,r)},this._p2pConnection.onSelectedRemoteCandidateChanged=(i,r)=>{var a;return null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a?void 0:a.call(this,i,r)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(i){i.onConnectionStateChange=void 0,i.onICEConnectionStateChange=void 0,i.onICETransportStateChange=void 0,i.onDTLSTransportStateChange=void 0,i.onDTLSTransportError=void 0,i.onFirstAudioDecoded=void 0,i.onFirstAudioReceived=void 0,i.onFirstVideoDecoded=void 0,i.onFirstVideoReceived=void 0,i.onSelectedLocalCandidateChanged=void 0,i.onSelectedRemoteCandidateChanged=void 0,i.onFirstVideoDecodedTimeout=void 0}setConfiguration(i){this._p2pConnection.setConfiguration(i)}}function xs(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=x(function*(){const l=this.mutex,d=yield l.lock("From DataChannelConnection.".concat(i));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return yield a.apply(this,f)}finally{d()}}),r}function yN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function yy(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?yN(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):yN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}oe([xs,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",q)],mi.prototype,"connect",null),oe([xs,N("design:type",Function),N("design:paramtypes",[Object,Array]),N("design:returntype",q)],mi.prototype,"createDataChannels",null),oe([xs,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",q)],mi.prototype,"receive",null),oe([xs,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],mi.prototype,"stopReceiving",null),oe([xs,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],mi.prototype,"muteRemote",null),oe([xs,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],mi.prototype,"unmuteRemote",null),oe([xs,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],mi.prototype,"muteLocal",null),oe([xs,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],mi.prototype,"unmuteLocal",null),oe([xs,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],mi.prototype,"close",null),oe([xs,N("design:type",Function),N("design:paramtypes",[String,jt]),N("design:returntype",q)],mi.prototype,"updateEncoderConfig",null),oe([xs,N("design:type",Function),N("design:paramtypes",[String,jt]),N("design:returntype",q)],mi.prototype,"updateSendParameters",null),oe([xs,N("design:type",Function),N("design:paramtypes",[jt,String]),N("design:returntype",q)],mi.prototype,"replaceTrack",null),oe([xs,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],mi.prototype,"getRemoteSSRC",null);class vN extends nn{constructor(){super(),T(this,"uplinkStatsUploadInterval",void 0),T(this,"uplinkRelatedStatsUploadInterval",void 0),T(this,"uplinkDenoiserStatsUploadInterval",void 0),T(this,"transportStatsUploadInterval",void 0),T(this,"uplinkExtensionStatsUploadInterval",void 0),T(this,"downlinkExtensionStatsUploadInterval",void 0),T(this,"extensionUsageStatsUploadInterval",void 0),T(this,"downlinkStatsUploadInterval",void 0),T(this,"downlinkRelatedStatsUploadInterval",void 0),T(this,"lastStats",void 0),T(this,"uploadUnplinkStarted",!1),T(this,"uploadDownlinkStarted",!1),T(this,"uploadTransportStarted",!1),T(this,"uploadExtensionUsageStarted",!1),T(this,"requestStats",void 0),T(this,"requestTransportStats",void 0),T(this,"requestLocalMedia",void 0),T(this,"requestRemoteMedia",void 0),T(this,"requestAllTracks",void 0),T(this,"requestVideoIsReady",void 0),T(this,"requestUpload",void 0)}startUploadTransportStats(i){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval(()=>{var r;const a=null===(r=this.requestStats)||void 0===r?void 0:r.call(this);if(a){const d=GO(a);if(i){var l;const h=null===(l=this.requestStats)||void 0===l?void 0:l.call(this,!0);if(h){const f=GO(h);d.connectionType+=f.connectionType<<3}d.connectionType+=110}else d.connectionType+=100;Ko(()=>{var h;null===(h=this.requestUpload)||void 0===h||h.call(this,gr.TRANSPORT_STATS,d)})}},1e3))}startUploadExtensionUsageStats(){var i=this;if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const r=new Map;this.extensionUsageStatsUploadInterval=window.setInterval(x(function*(){var a,l,d;const h=Date.now(),f={connectionInterval:H("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:h};let m=[];const g=(null===(a=i.requestAllTracks)||void 0===a?void 0:a.call(i))||[];for(const b of g)!b.muted&&b.enabled&&(m=m.concat(yield b.getProcessorUsage()));const E=(null===(l=i.requestRemoteMedia)||void 0===l?void 0:l.call(i))||[];for(const[b,O]of E)O.has(ye.VIDEO)&&b.videoTrack&&(m=m.concat(yield b.videoTrack.getProcessorUsage())),O.has(ye.AUDIO)&&b.audioTrack&&(m=m.concat(yield b.audioTrack.getProcessorUsage()));if(0===m.length)return;f.details=function(b,O){const P={};for(const{id:V,value:J,level:ae,direction:z}of b){var D;const Q=null!==(D=O.get(V))&&void 0!==D?D:0,X=2===J?Q+H("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:Q;var L,B;O.set(V,X),P[V]?(2===J&&(P[V].value=J),ae>P[V].level&&(P[V].level=ae),"remote"===z&&(P[V].remoteUidCount+=1),P[V].totalTs=null!==(L=O.get(V))&&void 0!==L?L:0):P[V]={value:J,level:ae,remoteUidCount:"local"===z?0:1,totalTs:null!==(B=O.get(V))&&void 0!==B?B:0}}return Object.keys(P).map(V=>{const{level:J,value:ae,totalTs:z}=P[V];return{id:V,level:J,value:ae,totalTs:z}})}(m,r);const y=Date.now();null===(d=i.requestUpload)||void 0===d||d.call(i,gr.EXTENSION_USAGE_STATS,{usageStats:f,sendTs:y>h?y:h+1})}),H("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval(()=>{var i;const r=null===(i=this.requestStats)||void 0===i?void 0:i.call(this);r&&(this.uploadUplinkStats(r),this.lastStats=r)},3e3),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval(()=>{var i;const r=null===(i=this.requestStats)||void 0===i?void 0:i.call(this);r&&this.uploadRelatedUplinkStats(r,this.lastStats),this.lastStats=r},1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval(()=>{var i;const r=null===(i=this.requestAllTracks)||void 0===i?void 0:i.call(this);r&&this.uploadDenoiserStats(r)},2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval(()=>{var i;const r=null===(i=this.requestAllTracks)||void 0===i?void 0:i.call(this);r&&this.uploadExtensionStats(r)},2e3))}uploadUplinkStats(i){var r;((null===(r=this.requestLocalMedia)||void 0===r?void 0:r.call(this))||[]).forEach(a=>{let[l,{track:d,ssrcs:h}]=a;switch(l){case se.LocalVideoLowTrack:case se.LocalVideoTrack:{const f=function(E,y,C){var b;const O=y.videoSend.find(D=>D.ssrc===E);if(!O)return null;const P={id:Vt(10,""),timestamp:new Date(y.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:O.ssrc.toString()};switch(P.A_vstd=C._originMediaStreamTrack&&!C._originMediaStreamTrack.enabled||C._mediaStreamTrack&&!C._mediaStreamTrack.enabled?"1":"0",O.sentFrame&&(P.A_fhs=O.sentFrame.height.toString(),P.A_frs=O.sentFrame.frameRate.toString(),P.A_fws=O.sentFrame.width.toString()),O.adaptionChangeReason){case"none":P.A_ac="0";break;case"cpu":P.A_ac="1";break;case"bandwidth":P.A_ac="2";break;case"other":P.A_ac="3"}return P.A_lvps=vT[C._player?C._player.videoElementStatus:"uninit"].toString(),P.A_nr=null===(b=O.nacksCount)||void 0===b?void 0:b.toString(),O.avgEncodeMs&&(P.A_aem=O.avgEncodeMs.toFixed(0).toString()),H("P2P")&&(O.bytes&&(P.bytesSent=O.bytes.toString()),"number"==typeof O.packetsLost&&(P.packetsLost=O.packetsLost.toString()),O.packets&&(P.packetsSent=O.packets.toString())),P}(h[0].ssrcId,i,d),m=l===se.LocalVideoTrack?function(E,y,C){var b,O,P,D,L,B,V,J;const ae=y.videoSend.find(Ce=>Ce.ssrc===E);if(!ae)return null;const z={id:Vt(10,""),timestamp:new Date(y.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:ae.ssrc.toString()},Q=null!==(b=null!==(O=null===(P=ae.inputFrame)||void 0===P?void 0:P.height)&&void 0!==O?O:null==C?void 0:C._videoHeight)&&void 0!==b?b:0,X=null!==(D=null!==(L=null===(B=ae.inputFrame)||void 0===B?void 0:B.width)&&void 0!==L?L:null==C?void 0:C._videoWidth)&&void 0!==D?D:0,te=null!==(V=null===(J=ae.inputFrame)||void 0===J?void 0:J.frameRate)&&void 0!==V?V:0;return Q&&(z.A_fhi=Q+""),X&&(z.A_fwi=X+""),te&&(z.A_fri=te+""),z}(h[0].ssrcId,i,d):null;f&&Ko(()=>{var E;return null===(E=this.requestUpload)||void 0===E?void 0:E.call(this,gr.PUBLISH_STATS,{stream_type:l===se.LocalVideoLowTrack?"low":"high",stats:yy(yy({},f),m)})});const g=function(E){const y={id:"bweforvideo",timestamp:new Date(E.timestamp).toISOString(),type:"VideoBwe"};return E.bitrate.retransmit&&(y.A_rb=E.bitrate.retransmit.toString()),E.bitrate.targetEncoded&&(y.A_teb=E.bitrate.targetEncoded.toString()),y.A_aeb=E.bitrate.actualEncoded.toString(),y.A_tb=E.bitrate.transmit.toString(),void 0!==E.sendBandwidth&&(y.A_asb=E.sendBandwidth.toString()),y}(i);g&&setTimeout(()=>{var E;return null===(E=this.requestUpload)||void 0===E?void 0:E.call(this,gr.PUBLISH_STATS,{stream_type:l===se.LocalVideoLowTrack?"low":"high",stats:g})},1e3);break}case se.LocalAudioTrack:{const f=function(m,g,E){const y=g.audioSend.find(b=>b.ssrc===m);if(!y)return null;const C={id:Vt(10,""),timestamp:new Date(g.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:y.ssrc.toString()};return C.A_astd=E._originMediaStreamTrack&&!E._originMediaStreamTrack.enabled||E._mediaStreamTrack&&!E._mediaStreamTrack.enabled?"1":"0",C.A_ail=y.inputLevel?Math.round(100*y.inputLevel).toString():Math.round(100*E._source.getAccurateVolumeLevel()).toString(),C.A_apil=Math.round(100*E._source.getAccurateVolumeLevel()).toString(),y.aecReturnLoss&&(C.A_ecrl=Math.round(y.aecReturnLoss).toString()),y.aecReturnLossEnhancement&&(C.A_ecrle=Math.round(y.aecReturnLossEnhancement).toString()),H("P2P")&&(y.bytes&&(C.bytesSent=y.bytes.toString()),"number"==typeof y.packetsLost&&(C.packetsLost=y.packetsLost.toString()),y.packets&&(C.packetsSent=y.packets.toString())),C}(h[0].ssrcId,i,d);f&&Ko(()=>{var m;return null===(m=this.requestUpload)||void 0===m?void 0:m.call(this,gr.PUBLISH_STATS,{stream_type:"high",stats:f})});break}}})}uploadRelatedUplinkStats(i,r){var a;((null===(a=this.requestLocalMedia)||void 0===a?void 0:a.call(this))||[]).filter(l=>{let[d]=l;return d===se.LocalVideoLowTrack||d===se.LocalVideoTrack}).forEach(l=>{let[d,{ssrcs:h}]=l;const f=function(m,g){const E=g.videoSend.find(y=>y.ssrc===m);return E?{mediaType:"video",isVideoMute:!1,frameRateInput:E.inputFrame&&E.inputFrame.frameRate.toString(),frameRateSent:E.sentFrame&&E.sentFrame.frameRate.toString(),googRtt:E.rttMs.toString(),qpSumPerFrame:Math.floor(E.qpSumPerFrame).toString()}:null}(h[0].ssrcId,i);f&&Ko(()=>{var m;null===(m=this.requestUpload)||void 0===m||m.call(this,gr.PUBLISH_RELATED_STATS,{stream_type:d===se.LocalVideoLowTrack?"low":"high",stats:f})})})}uploadDenoiserStats(i){for(let d=0;d<i.length;d++){const h=i[d];if(h instanceof Lc){var r,a,l;const f=null===(r=(a=h._external).getDenoiserStats)||void 0===r?void 0:r.call(a);return void(f&&(null===(l=this.requestUpload)||void 0===l||l.call(this,gr.DENOISER_STATS,f)))}}}uploadExtensionStats(i){for(let r=0;r<i.length;r++)i[r].getProcessorStats().forEach(a=>{var l;null===(l=this.requestUpload)||void 0===l||l.call(this,a.type,a.stats)})}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let i;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let r=!1;this.downlinkStatsUploadInterval=window.setInterval(()=>{var a;const l=null===(a=this.requestStats)||void 0===a?void 0:a.call(this,!0);l&&(this.uploadDownlinkStats(l,r,i),i=l),r=!r},3e3),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval(()=>{var a;const l=null===(a=this.requestStats)||void 0===a?void 0:a.call(this,!0);l&&(this.uploadRelatedDownlinkStats(l,this.lastStats),this.lastStats=l)},1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval(()=>{var a;const l=null===(a=this.requestRemoteMedia)||void 0===a?void 0:a.call(this);l&&this.uploadDownlinkExtensionStats(l)},2e3)}uploadDownlinkStats(i,r,a){var l;((null===(l=this.requestRemoteMedia)||void 0===l?void 0:l.call(this))||[]).forEach(d=>{let[h,f]=d;if(f.has(ye.VIDEO)&&h.videoTrack){const m=h.videoTrack?function(g,E,y,C,b){const O=E.videoRecv.find(B=>B.ssrc===g);if(!O)return null;const P={id:Vt(10,""),timestamp:new Date(E.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:O.ssrc.toString()};var D,L;if(P.bytesReceived=O.bytes.toString(),P.packetsLost=O.packetsLost.toString(),P.packetsReceived=O.packets.toString(),O.framesRateFirefox&&(P.A_frr=O.framesRateFirefox.toString()),O.receivedFrame?(P.A_frr=O.receivedFrame.frameRate.toString(),P.A_fhr=O.receivedFrame.height.toString(),P.A_fwr=O.receivedFrame.width.toString()):(P.A_fhr=null===(D=C._videoHeight)||void 0===D?void 0:D.toString(),P.A_fwr=null===(L=C._videoWidth)||void 0===L?void 0:L.toString()),P.A_frd=O.decodeFrameRate.toString(),O.outputFrame&&(P.A_fro=O.outputFrame.frameRate.toString()),void 0!==O.jitterBufferMs&&(P.A_jbm=Math.floor(O.jitterBufferMs).toString()),void 0!==O.currentDelayMs&&(P.A_cdm=Math.floor(O.currentDelayMs).toString()),P.A_fs=O.firsCount.toString(),P.A_ns=O.nacksCount.toString(),P.A_ps=O.plisCount.toString(),C&&(P.A_vrtd=C._originMediaStreamTrack.enabled&&C._mediaStreamTrack.enabled?"0":"1"),C._player&&C._player.freezeTimeCounterList.length>0&&(P.A_vrft=Math.round(C._player.freezeTimeCounterList.splice(0,1)[0]).toString()),b&&C._player&&"visible"===Bl.visibility){const B=Math.min(6e3,C._player.renderFreezeAccTime);P.A_vrrft=Math.round(B).toString(),C._player.renderFreezeAccTime=Math.max(0,C._player.renderFreezeAccTime-B)}if(P.A_rvps=vT[C._player?C._player.videoElementStatus:"uninit"].toString(),y){const B=y.videoRecv.find(V=>V.ssrc===g);if(B&&void 0!==O.totalInterFrameDelay&&void 0!==O.totalSquaredInterFrameDelay&&void 0!==B.totalInterFrameDelay&&void 0!==B.totalSquaredInterFrameDelay){const V=O.totalInterFrameDelay-B.totalInterFrameDelay,ae=O.framesDecodeCount-B.framesDecodeCount,z=V/ae*1e3,Q=Math.round(1e3*Math.sqrt((O.totalSquaredInterFrameDelay-B.totalSquaredInterFrameDelay-Math.pow(V,2)/ae)/ae));!isNaN(Q)&&z+Q>Math.max(3*z,z+150)&&(P.A_ifdsd=Q.toString())}}return P}(h._videoSSRC,i,a,h.videoTrack,r):void 0;m&&Ko(()=>{var g;return null===(g=this.requestUpload)||void 0===g?void 0:g.call(this,gr.SUBSCRIBE_STATS,{stream_id:h.uid,stats:m})})}if(f.has(ye.AUDIO)&&h.audioTrack){const m=h.audioTrack?function(g,E,y,C){const b=E.audioRecv.find(P=>P.ssrc===g);if(!b)return null;const O={id:Vt(10,""),timestamp:new Date(E.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:b.ssrc.toString()};if(O.bytesReceived=b.bytes.toString(),O.packetsLost=b.packetsLost.toString(),O.packetsReceived=b.packets.toString(),O.A_aol=b.outputLevel?Math.round(100*b.outputLevel).toString():Math.round(100*C._source.getAccurateVolumeLevel()).toString(),O.A_apol=Math.round(100*C._source.getAccurateVolumeLevel()).toString(),C&&(O.A_artd=C._originMediaStreamTrack.enabled&&C._mediaStreamTrack.enabled?"0":"1"),O.A_jr=b.jitterMs.toString(),O.A_jbm=Math.floor(b.jitterBufferMs).toString(),O.A_cdm=Math.floor(b.jitterBufferMs).toString(),O.A_raps=vT[qr.getPlayerState(C.getTrackId())].toString(),y){const P=y.audioRecv.find(D=>D.ssrc===g);if(P){const D=b.concealedSamples-P.concealedSamples;D>0&&(O.A_cs=Math.round(D).toString())}}return O}(h._audioSSRC,i,a,h.audioTrack):void 0;m&&Ko(()=>{var g;return null===(g=this.requestUpload)||void 0===g?void 0:g.call(this,gr.SUBSCRIBE_STATS,{stream_id:h.uid,stats:m})})}})}uploadRelatedDownlinkStats(i,r){var a;((null===(a=this.requestRemoteMedia)||void 0===a?void 0:a.call(this))||[]).forEach(l=>{let[d,h]=l;if(h.has(ye.VIDEO)&&d.videoTrack){var f;const m=!0===(d._videoSSRC&&(null===(f=this.requestVideoIsReady)||void 0===f?void 0:f.call(this,d._videoSSRC))||!1),g=function(E,y,C,b,O,P){const D=C.videoRecv.find(J=>J.ssrc===E),L=O?O.videoRecv.find(J=>J.ssrc===E):void 0;if(!D)return null;const B=up.isRemoteVideoFreeze(P,D,L)&&y,V={mediaType:"video",isVideoMute:!1,peerId:b,frameRateReceived:D.receivedFrame&&D.receivedFrame.frameRate.toString(),frameRateDecoded:D.decodedFrame&&D.decodedFrame.frameRate.toString(),isFreeze:B,bytesReceived:D.bytes.toString(),packetsReceived:D.packets.toString(),packetsLost:D.packetsLost.toString(),qpSumPerFrame:Math.floor(D.qpSumPerFrame).toString()};return D.framesRateFirefox&&(V.frameRateDecoded=D.framesRateFirefox.toString(),V.frameRateReceived=D.framesRateFirefox.toString()),V}(d._videoSSRC,m,i,d.uid,r,d.videoTrack);g&&Ko(()=>{var E;null===(E=this.requestUpload)||void 0===E||E.call(this,gr.SUBSCRIBE_RELATED_STATS,{stream_id:d.uid,stats:g})})}if(h.has(ye.AUDIO)&&d.audioTrack){const m=function(g,E,y,C){const b=E.audioRecv.find(P=>P.ssrc===g);if(!b)return null;const O=up.isRemoteAudioFreeze(C);return{mediaType:"audio",isAudioMute:!1,peerId:y,googJitterReceived:b.jitterMs.toString(),isFreeze:O,bytesReceived:b.bytes.toString(),packetsReceived:b.packets.toString(),packetsLost:b.packetsLost.toString(),frameReceived:b.receivedFrames.toString(),frameDropped:b.droppedFrames.toString()}}(d._audioSSRC,i,d.uid,d.audioTrack);m&&Ko(()=>{var g;null===(g=this.requestUpload)||void 0===g||g.call(this,gr.SUBSCRIBE_RELATED_STATS,{stream_id:d.uid,stats:m})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(i){i.forEach(r=>{let[a,l]=r;l.has(ye.VIDEO)&&a.videoTrack&&a.videoTrack.getProcessorStats().forEach(d=>{var h;null===(h=this.requestUpload)||void 0===h||h.call(this,d.type,d.stats)}),l.has(ye.AUDIO)&&a.audioTrack&&a.audioTrack.getProcessorStats().forEach(d=>{var h;null===(h=this.requestUpload)||void 0===h||h.call(this,d.type,d.stats)})})}}function CN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Jc(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?CN(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):CN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function Bb(s){var i,r,a,l=2;for("undefined"!=typeof Symbol&&(r=Y_,a=Symbol.iterator);l--;){if(r&&null!=(i=s[r]))return i.call(s);if(a&&null!=(i=s[a]))return new vy(i.call(s));r="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function vy(s){function i(r){if(Object(r)!==r)return q.reject(new TypeError(r+" is not an object."));var a=r.done;return q.resolve(r.value).then(function(l){return{value:l,done:a}})}return(vy=function(r){this.s=r,this.n=r.next}).prototype={s:null,n:null,next:function(){return i(this.n.apply(this.s,arguments))},return:function(r){var a=this.s.return;return void 0===a?q.resolve({value:r,done:!0}):i(a.apply(this.s,arguments))},throw:function(r){var a=this.s.return;return void 0===a?q.reject(r):i(a.apply(this.s,arguments))}},new vy(s)}class qn extends nn{get state(){return this._state}set state(i){const r=this._state;this._state=i,this.emit(Re.StateChange,r,this._state)}constructor(i,r){var a;super(),a=this,T(this,"store",void 0),T(this,"statsUploader",void 0),T(this,"connection",void 0),T(this,"localTrackMap",new Map),T(this,"remoteUserMap",new Map),T(this,"localDataChannels",[]),T(this,"remoteDataChannelMap",new Map),T(this,"pendingLocalTracks",[]),T(this,"pendingRemoteTracks",[]),T(this,"pendingLocalDataChannels",[]),T(this,"pendingRemoteDataChannels",[]),T(this,"statsCollector",void 0),T(this,"isPlanB",!1),T(this,"shouldForwardP2PCreation",void 0),T(this,"iceFailedCount",0),T(this,"dtlsFailedCount",0),T(this,"mutex",new Gn("P2PChannel-mutex")),T(this,"_state",rt.Disconnected),T(this,"_pcStatsUploadType",H("NEW_ICE_RESTART")?da.FIRST_CONNECTION:da.OLD_FIRST_CONNECTION),T(this,"_isInRestartIce",!1),T(this,"_isStartRestartIce",!1),T(this,"_restartStates",["disconnected","failed"]),T(this,"_restartTimer",void 0),T(this,"_isFirstConnected",!0),T(this,"handleMuteLocalTrack",function(){var l=x(function*(d,h,f){const m=yield a.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!a.connection||a.state!==rt.Connected)return void f(new ne(k.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const g=a.filterTobeMutedTracks(d);if(0===g.length)return void h();const E=g.find(C=>"videoLowTrack"===C[0]);E&&E[1].track._originMediaStreamTrack.stop(),yield a.connection.muteLocal(g.map(C=>{let[,{id:b}]=C;return b}));const y=a.createMuteMessage(g);yield Ht(a,Re.RequestMuteLocal,y),h()}catch(g){f(g)}finally{m()}});return function(d,h,f){return l.apply(this,arguments)}}()),T(this,"handleUnmuteLocalTrack",function(){var l=x(function*(d,h,f){const m=yield a.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!a.connection||a.state!==rt.Connected)return void f(new ne(k.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const g=a.filterTobeUnmutedTracks(d);if(0===g.length)return void h();const E=g.find(C=>"videoLowTrack"===C[0]);if(E){const C=E[1];if(C.track._originMediaStreamTrack.stop(),!H("DISABLE_DUAL_STREAM_USE_ENCODING")&&Rt().supportDualStreamEncoding){const b=d._mediaStreamTrack.clone();C.track._mediaStreamTrack=b,C.track._originMediaStreamTrack=b}else{const b=em(d,Cs(a,Re.RequestLowStreamParameter));C.track._mediaStreamTrack=b,C.track._originMediaStreamTrack=b}yield new q((b,O)=>{a.handleReplaceTrack(C.track,b,O,!0)})}yield a.connection.unmuteLocal(g.map(C=>{let[,{id:b}]=C;return b}));const y=a.createUnmuteMessage(g);yield Ht(a,Re.RequestUnmuteLocal,y),h()}catch(g){f(g)}finally{m()}});return function(d,h,f){return l.apply(this,arguments)}}()),T(this,"handleUpdateVideoEncoder",function(){var l=x(function*(d,h,f){const m=yield a.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const g=a.localTrackMap.get(se.LocalVideoTrack);if(!a.connection||!g||g.track!==d||a.state!==rt.Connected)return void h();const{id:E,track:y}=g;yield a.connection.updateSendParameters(E,y),yield a.connection.updateEncoderConfig(E,y),a.emit(Re.UpdateVideoEncoder,y),h()}catch(g){f(g)}finally{m()}});return function(d,h,f){return l.apply(this,arguments)}}()),T(this,"handleSetOptimizationMode",function(){var l=x(function*(d,h,f){const m=yield a.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const g=a.localTrackMap.get(se.LocalVideoTrack);if(!a.connection||!g||g.track!==d||a.state!==rt.Connected)return;const{id:E,track:y}=g;yield a.connection.updateSendParameters(E,y),h()}catch(g){f(g)}finally{m()}});return function(d,h,f){return l.apply(this,arguments)}}()),T(this,"handleReplaceTrack",function(){var l=x(function*(d,h,f,m){let g;R.debug("[".concat(a.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(d.getTrackId(),"]")),"boolean"==typeof m&&m||(g=yield a.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var E;const C=Array.from(a.localTrackMap.entries()).find(b=>{let[,{track:O}]=b;return d===O});if(!a.connection||!C||a.state!==rt.Connected)return void h();if(yield null===(E=a.connection)||void 0===E?void 0:E.replaceTrack(d,C[1].id),a.isPlanB){const b=C[1];b.id=d._mediaStreamTrack.id,a.localTrackMap.set(C[0],b)}if(C[0]===se.LocalVideoTrack&&!H("DISABLE_DUAL_STREAM_USE_ENCODING")&&Rt().supportDualStreamEncoding){const b=a.localTrackMap.get(se.LocalVideoLowTrack);if(b){const O=d._mediaStreamTrack.clone();b.track._originMediaStreamTrack.stop(),b.track._mediaStreamTrack=O,b.track._originMediaStreamTrack=O,yield new q((P,D)=>{a.handleReplaceTrack(b.track,P,D,!0)})}}h()}catch(C){f(C)}finally{var y;null===(y=g)||void 0===y||y()}});return function(d,h,f,m){return l.apply(this,arguments)}}()),T(this,"handleGetLocalVideoStats",l=>{l(this.statsCollector.getLocalVideoTrackStats())}),T(this,"handleGetLocalAudioStats",l=>{l(this.statsCollector.getLocalAudioTrackStats())}),T(this,"handleGetRemoteVideoStats",l=>this.statsCollector.getRemoteVideoTrackStats(l.uid)[l.uid]),T(this,"handleGetRemoteAudioStats",l=>this.statsCollector.getRemoteAudioTrackStats(l.uid)[l.uid]),this.store=i,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new vN,this.bindStatsUploaderEvents(),this.isPlanB=!Rt().supportUnifiedPlan||H("CHROME_FORCE_PLAN_B")&&Il(),this.shouldForwardP2PCreation=H("FORWARD_P2P_CREATION")&&Rt().supportPCSetConfiguration&&function(){const l=Kg();return l===vi.ANDROID||l===vi.IOS||l===vi.HARMONY_OS}(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new mi({},this.store):this.isPlanB?new Ii({},this.store):new wi({},this.store),this.bindConnectionEvents(this.connection))}startP2PConnection(i,r){var a=this;return x(function*(){var l;a.state=rt.New;const d=a.shouldForwardP2PCreation&&"closed"===(null===(l=a.connection)||void 0===l?void 0:l.peerConnectionState);if(a.shouldForwardP2PCreation&&!d||(d&&a.connection&&(R.warning("[".concat(a.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),a.connection.close(),a.unbindConnectionEvents(a.connection)),a.connection=a.store.useDataChannel?new mi(i,a.store):a.isPlanB?new Ii(i,a.store):new wi(i,a.store),a.bindConnectionEvents(a.connection)),!a.connection)throw new ne(k.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return a._pcStatsUploadType=H("NEW_ICE_RESTART")?da.FIRST_CONNECTION:da.OLD_FIRST_CONNECTION,a._isFirstConnected=!0,a._isInRestartIce=!1,a._isStartRestartIce=!1,a.connection.setConfiguration(i),a.connection.establishPromise})()}connect(i,r,a,l,d,h){var f=this;return x(function*(){if(!f.connection)throw new ne(k.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");f.connection instanceof mi?f.connection.updateRemoteConnect(l):(f.store.peerConnectionStart(),yield f.connection.connect(i,r,a,l,d,h),f.statsUploader.startUploadTransportStats(),f.statsUploader.startUploadExtensionUsageStats(),f.state=rt.Connected)})()}preConnect(i,r,a,l,d,h){var f=this;return x(function*(){if(!f.connection)throw new ne(k.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");f.store.peerConnectionStart();const m=yield f.connection.connect(i,r,a,l,d,h);return f.statsUploader.startUploadTransportStats(),f.statsUploader.startUploadExtensionUsageStats(),f.state=rt.Connected,m})()}getEstablishParams(){if(this.connection instanceof mi)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}publishDataChannel(i){var r=this;return x(function*(){if(!r.connection){if(r.state===rt.Disconnected)throw new ne(k.UNEXPECTED_ERROR,"PeerConnection already disconnected.");const l=i.filter(d=>-1!==r.pendingLocalDataChannels.findIndex(h=>h.id===d.id));return void(r.pendingLocalDataChannels=r.pendingLocalDataChannels.concat(l))}const a=r.filterTobePublishedDataChannels(i);0!==a.length&&(a.forEach(l=>{const d=Date.now();r.store.publish(l.id.toString(),"datachannel",d)}),yield r.connection.createDataChannels(r.store.uid,a),a.forEach(l=>{r.localDataChannels.push(l);const d=Date.now();r.store.publish(l.id+"","datachannel",void 0,d)}))})()}publish(i,r,a){var l=this;return is(function*(){const d=yield _t(l.mutex.lock("From P2PChannel.publish"));try{if(!l.connection||l.state!==rt.Connected){if(l.state===rt.Disconnected)throw new ne(k.UNEXPECTED_ERROR,"PeerConnection already disconnected.");l.throwIfTrackTypeNotMatch(i);const f=i.filter(m=>-1===l.pendingLocalTracks.indexOf(m));return void(l.pendingLocalTracks=l.pendingLocalTracks.concat(f))}l.store.pubId=l.store.pubId+1,Ni.markPublishStart(l.store.clientId,l.store.pubId);const h=l.filterTobePublishedTracks(i,r,a);if(0===h.length)return void(yield _t(l.tryToUnmuteAudio(i)));yield*wb(Bb(l.doPublish(l.connection,h)))}finally{d()}})()}doPublish(i,r){var a=this;return is(function*(){r.forEach(E=>{let{track:y,type:C}=E;const b=Date.now();a.store.publish(y.getTrackId(),C===se.LocalAudioTrack?"audio":"video",b)}),a.bindLocalTrackEvents(r);const l=yield _t(i.send(r.map(E=>{let{track:y}=E;return y}),a.store.codec,a.store.audioCodec)),d=(yield _t(l.next())).value,h=a.createGatewayPublishMessage(r,d);let f;try{f=yield h}catch(E){throw l.throw(E),(null==E?void 0:E.code)===k.WS_ABORT&&r.forEach(y=>{let{track:C}=y;-1===a.pendingLocalTracks.indexOf(C)&&a.pendingLocalTracks.push(C)}),a.unbindLocalTrackEvents(r),E}const m=a.mapPubResToRemoteConfig(h,f),g=(yield _t(l.next(m))).value;r.forEach(E=>{let{type:y}=E;a.statsCollector.addLocalStats(y)}),a.assignLocalTracks(r,g),a.statsUploader.startUploadUplinkStats(),r.forEach(E=>{let{track:y,type:C}=E;const b=Date.now();a.store.publish(y.getTrackId(),C===se.LocalAudioTrack?"audio":"video",void 0,b)})})()}updateVideoStreamParameter(i,r){var a=this;return x(function*(){const l=a.localTrackMap.get(r);if(!l)return;if(!(l.track instanceof Ye))return R.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(a.connection instanceof wi||a.connection instanceof Ii))return R.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:d}=l,h=function(f,m){const g={};return f.height&&f.width&&(g.scaleResolutionDownBy=_b(f,m)),g.maxFramerate=f.framerate?To(f.framerate):void 0,g.maxBitrate=f.bitrate?1e3*f.bitrate:void 0,g}(i,d);if(d._encoderConfig||(d._encoderConfig={}),r!==se.LocalVideoLowTrack||!H("DISABLE_DUAL_STREAM_USE_ENCODING")&&Rt().supportDualStreamEncoding)null!=h.scaleResolutionDownBy&&(d._encoderConfig.scaleResolutionDownBy=h.scaleResolutionDownBy);else{const f=d._originMediaStreamTrack;if(!f.canvas)return R.warn("[".concat(d.getTrackId(),"] no canvas on track"));!function(m,g){const E=m.canvas;g.width&&(E.width=To(g.width)),g.height&&(E.height=To(g.height)),g.framerate&&(E.stopCapture&&E.stopCapture(),E.stopCapture=zD(()=>{!E.startCapture&&E.stopCapture&&E.stopCapture(),E.startCapture&&E.startCapture()},To(g.framerate)))}(f,i)}null!=h.maxBitrate&&(d._encoderConfig.bitrateMax=h.maxBitrate/1e3),null!=h.maxFramerate&&(d._encoderConfig.frameRate&&"object"==typeof d._encoderConfig.frameRate?d._encoderConfig.frameRate.max=h.maxFramerate:d._encoderConfig.frameRate={max:h.maxFramerate}),R.debug("[".concat(d.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(d._encoderConfig))),yield a.connection.updateRtpSenderEncodings(d)})()}publishLowStream(i){var r=this;return is(function*(){if(!r.connection||r.state!==rt.Connected)return;const a=yield _t(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const d=r.localTrackMap.get(se.LocalVideoTrack);if(!d)throw new ne(k.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(se.LocalVideoLowTrack))throw new ne(k.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const h=[{track:r.getLowVideoTrack(d.track,i),type:se.LocalVideoLowTrack}];if(yield*wb(Bb(r.doPublish(r.connection,h))),d.track.muted||!d.track.enabled){var l;const f=null===(l=r.localTrackMap.get(se.LocalVideoLowTrack))||void 0===l?void 0:l.id;void 0!==f&&(yield _t(r.connection.muteLocal([f])))}}finally{a()}})()}republish(){var i=this;return x(function*(){i.pendingLocalTracks.length>0&&(R.debug("[".concat(i.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield vn(i,Re.RequestRePublish,i.pendingLocalTracks),i.emit(Re.MediaReconnectEnd,i.store.uid),i.pendingLocalTracks=[]),i.pendingLocalDataChannels.length>0&&(R.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),yield vn(i,Re.RequestRePublishDataChannel,i.pendingLocalDataChannels),i.pendingLocalDataChannels=[])})()}reSubscribe(i){var r=this;return x(function*(){for(let a=r.pendingRemoteTracks.length-1;a>=0;a--){const{user:l,kind:d}=r.pendingRemoteTracks[a];(d!==ye.AUDIO||l._audio_added_&&l._audioSSRC)&&(d!==ye.VIDEO||l._video_added_&&l._videoSSRC)||r.pendingRemoteTracks.splice(a,1)}if(i)yield vn(r,Re.RequestReSubscribe,r.pendingRemoteTracks);else for(const{user:a,kind:l}of r.pendingRemoteTracks)yield r.subscribe(a,l,l===ye.VIDEO?a._videoSSRC:a._audioSSRC);r.pendingRemoteTracks.forEach(a=>{let{user:l}=a;r.emit(Re.MediaReconnectEnd,l.uid)}),r.pendingRemoteTracks=[]})()}unpublish(i){var r=this;return x(function*(){if(!r.connection||r.state!==rt.Connected)return void i.forEach(d=>{const h=r.pendingLocalTracks.indexOf(d);-1!==h&&r.pendingLocalTracks.splice(h,1)});const a=r.filterTobeUnpublishedTracks(i);if(0===a.length)return;const l=a.find(d=>"videoLowTrack"===d[0]);return l&&l[1].track.close(),r.doUnpublish(r.connection,a)})()}unpublishDataChannel(i){var r=this;return x(function*(){if(!r.connection||r.state!==rt.Connected)return void i.forEach(l=>{const d=r.pendingLocalDataChannels.indexOf(l);-1!==d&&r.pendingLocalDataChannels.splice(d,1)});const a=r.filterTobeUnpublishedDataChannels(i);return 0!==a.length?(a.forEach(l=>{const d=r.localDataChannels.indexOf(l);-1!==d&&r.localDataChannels.splice(d,1)}),0===r.localDataChannels.length&&(yield r.connection.stopDataChannels(r.store.uid)),a.map(l=>l.id)):void 0})()}unpublishLowStream(){var i=this;return x(function*(){if(!i.connection||i.state!==rt.Connected)return;const r=i.localTrackMap.get(se.LocalVideoLowTrack);return r?(r.track.close(),i.doUnpublish(i.connection,[[se.LocalVideoLowTrack,r]])):void 0})()}doUnpublish(i,r){var a=this;return x(function*(){const l=a.createGatewayUnpublishMessage(r);return yield i.stopSending(r.map(d=>{let[,{id:h}]=d;return h})),a.withdrawLocalTracks(r),a.unbindLocalTrackEvents(r.map(d=>{let[h,{track:f}]=d;return{type:h,track:f}})),r.forEach(d=>{let[h]=d;a.statsCollector.removeLocalStats(h)}),0===a.localTrackMap.size&&a.statsUploader.stopUploadUplinkStats(),l})()}subscribeDataChannel(i,r){var a=this;return x(function*(){if(!a.connection||a.state!==rt.Connected)throw new ne(k.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const l=r.filter(d=>{var h;return!(null!==(h=a.remoteDataChannelMap.get(i))&&void 0!==h&&h.get(d.id))});if(0!==l.length)return yield a.connection.createDataChannels(i.uid,l),l.forEach(d=>{var h;a.remoteDataChannelMap.has(i)?null===(h=a.remoteDataChannelMap.get(i))||void 0===h||h.set(d.id,d):a.remoteDataChannelMap.set(i,new Map([[d.id,d]]));const f=a.pendingRemoteDataChannels.findIndex(m=>{let{user:g,id:E}=m;return g.uid===i.uid&&E===d.id});-1!==f&&a.pendingRemoteDataChannels.splice(f,1)}),l.map(d=>d.id)})()}subscribe(i,r,a,l,d){var h=this;return x(function*(){var f;if(!h.connection||h.state!==rt.Connected)throw new ne(k.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(f=h.remoteUserMap.get(i))&&void 0!==f&&f.has(r))return;let m,g,E;if(d){const b=d.find(P=>{let{stream_type:D}=P;return D===r});if(!b)throw new ne(k.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(i.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const O=yield h.connection.receive(r,b.ssrcs,String(i._uintid),b.attributes);h.connection instanceof wi&&(E=O.transceiver),m=O.track,g=O.id}else{const b=yield h.connection.receive(r,[{ssrcId:a,rtx:l}],String(i._uintid),void 0);h.connection instanceof wi&&(E=b.transceiver),m=b.track,g=b.id}r===ye.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(m):(i._audioTrack=new Ns(m,i.uid,i._uintid,h.store),R.info("[".concat(h.store.clientId,"] [").concat(h.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),E&&i._audioTrack._updateRtpTransceiver(E),h.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(m):(i._videoTrack=new xc(m,i.uid,i._uintid,h.store),R.info("[".concat(h.store.clientId,"] [").concat(h.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),E&&i._videoTrack._updateRtpTransceiver(E),h.bindRemoteTrackEvents(i,i._videoTrack));const y=h.remoteUserMap.get(i);y?y.set(r,g):h.remoteUserMap.set(i,new Map([[r,g]])),h.statsCollector.addRemoteStats(i.uid),h.statsUploader.startUploadDownlinkStats();const C=h.pendingRemoteTracks.findIndex(b=>{let{user:O,kind:P}=b;return O.uid===i.uid&&r===P});-1!==C&&(h.pendingRemoteTracks.splice(C,1),h.emit(Re.MediaReconnectEnd,i.uid))})()}massSubscribe(i){var r=this;return x(function*(){return r.massSubscribeNoLock(i)})()}massSubscribeNoLock(i){var r=this;return x(function*(){if(!r.connection||r.state!==rt.Connected)throw new ne(k.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");i=i.filter(l=>{var d;let{user:h,mediaType:f}=l;return!(null!==(d=r.remoteUserMap.get(h))&&void 0!==d&&d.has(f))});const a=yield r.connection.batchReceive(i.map(l=>{let{user:d,mediaType:h,ssrcId:f,rtxSsrcId:m}=l;return{kind:h,ssrcMsg:[{ssrcId:f,rtx:m}],mslabel:String(d._uintid)}}));i.forEach((l,d)=>{let{user:h,mediaType:f}=l;const{track:m,id:g,transceiver:E}=a[d];f===ye.AUDIO?(h._audioTrack?h._audioTrack._updateOriginMediaStreamTrack(m):(h._audioTrack=new Ns(m,h.uid,h._uintid,r.store),R.info("[".concat(r.store.clientId,"] [").concat(r.store.p2pId,"] create remote audio track: ").concat(h._audioTrack.getTrackId()))),E&&h._audioTrack._updateRtpTransceiver(E),r.bindRemoteTrackEvents(h,h._audioTrack)):(h._videoTrack?h._videoTrack._updateOriginMediaStreamTrack(m):(h._videoTrack=new xc(m,h.uid,h._uintid,r.store),R.info("[".concat(r.store.clientId,"] [").concat(r.store.p2pId,"] create remote video track: ").concat(h._videoTrack.getTrackId()))),E&&h._videoTrack._updateRtpTransceiver(E),r.bindRemoteTrackEvents(h,h._videoTrack));const y=r.remoteUserMap.get(h);y?y.set(f,g):r.remoteUserMap.set(h,new Map([[f,g]])),r.statsCollector.addRemoteStats(h.uid),r.statsUploader.startUploadDownlinkStats();const C=r.pendingRemoteTracks.findIndex(b=>{let{user:O,kind:P}=b;return O.uid===h.uid&&f===P});-1!==C&&(r.pendingRemoteTracks.splice(C,1),r.emit(Re.MediaReconnectEnd,h.uid))})})()}unsubscribe(i,r,a){var l=this;return x(function*(){const d=l.pendingRemoteTracks.filter(m=>{let{user:g,kind:E}=m;return void 0!==r?g.uid===i.uid&&r===E:g.uid===i.uid});if(d.forEach(m=>{const g=l.pendingRemoteTracks.indexOf(m);l.pendingRemoteTracks.splice(g,1)}),l.connection&&l.state===rt.Connected||a||d.forEach(m=>{let{kind:g}=m;var E;if(g===ye.AUDIO)null===(E=i._audioTrack)||void 0===E||E._destroy(),i._audioTrack=void 0;else if(g===ye.VIDEO){var y;null===(y=i._videoTrack)||void 0===y||y._destroy(),i._videoTrack=void 0}}),!l.connection||l.state!==rt.Connected)return;const h=l.filterTobeUnSubscribedTracks(i,r);if(0===h.length)return;yield l.connection.stopReceiving(h.map(m=>{let[,{id:g}]=m;return g}));const f=l.createUnsubscribeMessage(h);return l.withdrawRemoteTracks(h),0===l.remoteUserMap.size&&l.statsUploader.stopUploadDownlinkStats(),h.forEach(m=>{let[g,{kind:E}]=m;var y,C;if(E===ye.VIDEO&&g._videoSSRC&&(null===(y=l.connection)||void 0===y||y.setStatsRemoteVideoIsReady(g._videoSSRC,!1)),E===ye.VIDEO)l.unbindRemoteTrackEvents(g._videoTrack),a||(null===(C=g._videoTrack)||void 0===C||C._destroy(),g._videoTrack=void 0);else if(E===ye.AUDIO){var b;l.unbindRemoteTrackEvents(g._audioTrack),!a&&(null===(b=g._audioTrack)||void 0===b||b._destroy(),g._audioTrack=void 0)}}),f})()}unsubscribeDataChannel(i,r){var a=this;return x(function*(){if(r.forEach(h=>{const f=a.pendingRemoteDataChannels.findIndex(m=>m.id===h.id);-1!==f&&a.pendingRemoteDataChannels.splice(f,1)}),!a.connection)return;const l=a.filterTobeUnSubscribedDataChannels(i,r);if(0===l.length)return;r.forEach(h=>{h._close()});const d=a.remoteDataChannelMap.get(i);return l.forEach(h=>{d&&d.delete(h.id)}),d&&0===d.size&&(a.remoteDataChannelMap.delete(i),yield a.connection.stopDataChannels(i.uid)),l.map(h=>h.id)})()}massUnsubscribe(i){var r=this;return x(function*(){return r.massUnsubscribeNoLock(i)})()}massUnsubscribeNoLock(i){var r=this;return x(function*(){let a=[];for(const{user:h,mediaType:f}of i){const m=r.pendingRemoteTracks.filter(g=>{let{user:E,kind:y}=g;return void 0!==f?E.uid===h.uid&&f===y:E.uid===h.uid});m.forEach(g=>{const E=r.pendingRemoteTracks.indexOf(g);r.pendingRemoteTracks.splice(E,1)}),a=a.concat(m)}if(!r.connection||r.state!==rt.Connected)return void a.forEach(h=>{let{user:f,kind:m}=h;var g;if(m===ye.AUDIO)null===(g=f._audioTrack)||void 0===g||g._destroy(),f._audioTrack=void 0;else if(m===ye.VIDEO){var E;null===(E=f._videoTrack)||void 0===E||E._destroy(),f._videoTrack=void 0}});const l=Ba(i).call(i,(h,f)=>{let{user:m,mediaType:g}=f;const E=r.filterTobeUnSubscribedTracks(m,g);return h.concat(E)},[]);if(0===l.length)return;yield r.connection.stopReceiving(l.map(h=>{let[,{id:f}]=h;return f}));const d=r.createUnsubscribeAllMessage(l);return r.withdrawRemoteTracks(l),0===r.remoteUserMap.size&&r.statsUploader.stopUploadDownlinkStats(),l.forEach(h=>{let[f,{kind:m}]=h;var g,E;if(m===ye.VIDEO&&f._videoSSRC&&(null===(g=r.connection)||void 0===g||g.setStatsRemoteVideoIsReady(f._videoSSRC,!1)),m===ye.VIDEO)r.unbindRemoteTrackEvents(f._videoTrack),null===(E=f._videoTrack)||void 0===E||E._destroy(),f._videoTrack=void 0;else if(m===ye.AUDIO){var y;r.unbindRemoteTrackEvents(f._audioTrack),null===(y=f._audioTrack)||void 0===y||y._destroy(),f._audioTrack=void 0}}),d})()}muteRemote(i,r){var a=this;return x(function*(){if(!a.connection)return;const l=a.remoteUserMap.get(i);if(!l)return void R.warning("[".concat(a.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(i.uid,"."));if(!l.get(r))return void R.warning("[".concat(a.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(i.uid," media type ").concat(r,"."));const d=r===ye.VIDEO?i._videoSSRC:i._audioSSRC;void 0!==d&&a.connection.setStatsRemoteVideoIsReady(d,!1)})()}unmuteRemote(i,r){var a=this;return x(function*(){return a.unmuteRemoteNoLock(i,r)})()}unmuteRemoteNoLock(i,r){var a=this;return x(function*(){if(!a.connection)return;const l=a.remoteUserMap.get(i);l?l.get(r)||R.warning("[".concat(a.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(i.uid," media type ").concat(r,".")):R.warning("[".concat(a.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(i.uid,"."))})()}getAllTracks(i){const r=this.localTrackMap.get(se.LocalAudioTrack);if((null==r?void 0:r.track)instanceof ei){const a=r.track;return Array.from(this.localTrackMap.entries()).filter(l=>{let[d]=l;return d!==se.LocalAudioTrack}).filter(l=>{let[d]=l;return!(i&&d===se.LocalVideoLowTrack)}).map(l=>{let[,{track:d}]=l;return d}).concat(a.trackList)}return Array.from(this.localTrackMap.entries()).filter(a=>{let[l]=a;return!(i&&l===se.LocalVideoLowTrack)}).map(a=>{let[,{track:l}]=a;return l})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(i,r,a,l,d){if(i){const f=this.localTrackMap.get(se.LocalAudioTrack),m=this.localTrackMap.get(l?se.LocalVideoLowTrack:se.LocalVideoTrack);Te.publish(this.store.sessionId,{eventElapse:Ni.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:i,ec:r,audioName:null==f?void 0:f.track.getTrackLabel(),videoName:null==m?void 0:m.track.getTrackLabel(),screenshare:-1!==(null==m?void 0:m.track._hints.indexOf(Qt.SCREEN_TRACK)),audio:!!f,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}else{var h;a||(a=[]);const f=a.find(g=>g instanceof vt),m=l?null===(h=this.localTrackMap.get(se.LocalVideoTrack))||void 0===h?void 0:h.track:a.find(g=>g instanceof Ye);Te.publish(this.store.sessionId,{eventElapse:Ni.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:i,ec:r,audioName:null==f?void 0:f.getTrackLabel(),videoName:null==m?void 0:m.getTrackLabel(),screenshare:-1!==(null==m?void 0:m._hints.indexOf(Qt.SCREEN_TRACK)),audio:!!f,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}}reportSubscribeEvent(i,r,a,l){const d=l===ye.VIDEO?a._videoSSRC:a._audioSSRC;d&&Te.subscribe(this.store.sessionId,{succ:i,ec:r,video:l===ye.VIDEO,audio:l===ye.AUDIO,peerid:a.uid,subscribeRequestid:l===ye.VIDEO?a._videoSSRC:a._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ni.measureFromSubscribeStart(this.store.clientId,d)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Gn("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new mi({},this.store):this.isPlanB?new Ii({},this.store):new wi({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const i=this.localTrackMap.get(se.LocalAudioTrack);if((null==i?void 0:i.track)instanceof ei){if(i.track.trackList.length>0){const r=i.track;i.track.trackList.forEach(a=>{r.removeAudioTrack(a)})}i.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=rt.Disconnected}getStats(){var i;return null===(i=this.connection)||void 0===i?void 0:i.getStats()}getRemoteVideoIsReady(i){var r;return(null===(r=this.connection)||void 0===r?void 0:r.getRemoteVideoIsReady(i))||!1}getLocalAudioVolume(){const i=this.localTrackMap.get(se.LocalAudioTrack);if(i)return i.track.getVolumeLevel()}getLocalVideoSize(){const i=this.localTrackMap.get(se.LocalVideoTrack);if(i)return{width:i.track._videoWidth||0,height:i.track._videoHeight||0}}getEncoderConfig(i){const r=this.localTrackMap.get(i);return r&&r.track instanceof Ye||r&&r.track instanceof vt?r.track._encoderConfig:void 0}getLocalMedia(i){return this.localTrackMap.get(i)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(i,r){if(!i)return this.remoteUserMap.size>0;const a=this.remoteUserMap.get(i);return!!a&&(!r||a.has(r))}hasRemoteMediaWithLock(i,r){var a=this;return x(function*(){if(!i)return a.remoteUserMap.size>0;const l=a.remoteUserMap.get(i);return!!l&&(!r||l.has(r))})()}getRemoteMedia(i){var r;const a=Array.from(jr(r=this.remoteUserMap).call(r)).find(l=>l.uid===i);return a?{audioTrack:a.audioTrack,audioSSRC:a._audioSSRC,videoTrack:a.videoTrack,videoSSRC:a._videoSSRC}:{}}getAudioLevels(){let i=Array.from(this.remoteUserMap.entries()).map(a=>{let[l]=a;return{uid:l.uid,level:l.audioTrack?100*l.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(se.LocalAudioTrack);return r&&i.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),i=Bf(i).call(i,(a,l)=>a.level-l.level),i}disconnectForReconnect(){var i=this;return x(function*(){i.connection&&(R.debug("[".concat(i.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),i.state=rt.Reconnecting,H("KEEP_LAST_FRAME")&&0!==i.remoteUserMap.size&&Array.from(i.remoteUserMap.entries()).forEach(r=>{let[a]=r;var l;a._videoTrack&&a._videoTrack._player&&(null===(l=a._videoTrack._player.getVideoElement())||void 0===l||l.pause(),a._videoTrack._player.isKeepLastFrame=!0,a._videoTrack._originMediaStreamTrack.stop())}),i.connection.close(),i.unbindConnectionEvents(i.connection),i.connection=void 0,i.shouldForwardP2PCreation&&(i.connection=i.store.useDataChannel?new mi({},i.store):i.isPlanB?new Ii({},i.store):new wi({},i.store),i.bindConnectionEvents(i.connection)),0!==i.localTrackMap.size&&(Array.from(i.localTrackMap.entries()).forEach(r=>{var a;let[l,{track:d}]=r;switch(l){case se.LocalVideoTrack:we(a=d._hints).call(a,Qt.LOW_STREAM)?d.close():i.pendingLocalTracks.push(d);break;case se.LocalAudioTrack:d instanceof ei?i.pendingLocalTracks=i.pendingLocalTracks.concat(d.trackList):i.pendingLocalTracks.push(d)}}),i.emit(Re.MediaReconnectStart,i.store.uid)),i.unbindLocalTrackEvents(),i.localTrackMap.clear(),0!==i.remoteUserMap.size&&Array.from(i.remoteUserMap.entries()).forEach(r=>{let[a,l]=r;Array.from(jr(l).call(l)).forEach(d=>{i.setPendingRemoteMedia(a,d)}),i.emit(Re.MediaReconnectStart,a.uid)}),i.unbindAllRemoteTrackEvents(),i.remoteUserMap.clear(),0!==i.localDataChannels.length&&(i.localDataChannels.forEach(r=>{i.pendingLocalDataChannels.push(r)}),i.localDataChannels.length=0),0!==i.remoteDataChannelMap.size&&(Array.from(i.remoteDataChannelMap.entries()).forEach(r=>{let[a,l]=r;Array.from(jr(l).call(l)).forEach(d=>{i.setPendingRemoteDataChannel(a,d)})}),i.remoteDataChannelMap.clear()),i.statsUploader.stopUploadUplinkStats(),i.statsUploader.stopUploadDownlinkStats(),i.statsUploader.stopUploadTransportStats(),R.debug("[".concat(i.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))})()}hasPendingRemoteDataChannel(i,r){for(const a of this.pendingRemoteDataChannels){const{user:l,id:d}=a;if((i instanceof Wt?i.uid:i)===l.uid&&d===r)return!0}return!1}setPendingRemoteDataChannel(i,r){this.hasPendingRemoteDataChannel(i,r)||this.pendingRemoteDataChannels.push({user:i,id:r})}hasPendingRemoteMedia(i,r){for(const a of this.pendingRemoteTracks){const{user:l,kind:d}=a;if((i instanceof Wt?i.uid:i)===l.uid&&r===d)return!0}return!1}setPendingRemoteMedia(i,r){this.hasPendingRemoteMedia(i,r)||this.pendingRemoteTracks.push({user:i,kind:r})}restartICE(i){var r=this;return is(function*(){if(!r.connection||r.state!==rt.Connected||r.connection instanceof mi)return;const a=yield _t(r.mutex.lock("From P2PChannel.restartICE"));let l;try{l=yield _t(r.connection.restartICE(i));const h=yield _t(l.next());if(h.done)return;const f=h.value,m=yield f;switch(r.reportPCDisconnectedOrFailed(i),i){case fi.TCP:r._pcStatsUploadType=da.TCP_RESTART;break;case fi.RELAY:r._pcStatsUploadType=da.RELAY_RESTART;break;default:r._pcStatsUploadType=da.OLD_RESTART}r._isInRestartIce=!0,l.next(m)}catch(h){var d;null===(d=l)||void 0===d||d.throw(h)}finally{a()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const i=this.connection.getStats(),r=this.localTrackMap.get(se.LocalVideoTrack),a=this.localTrackMap.get(se.LocalAudioTrack),l=i.videoSend.find(O=>O.ssrc===(null==r?void 0:r.ssrcs[0].ssrcId)),d=i.audioSend.find(O=>O.ssrc===(null==a?void 0:a.ssrcs[0].ssrcId));if(!l||!d)return 1;const h=ro(this,Re.NeedSignalRTT),f=l?l.rttMs:void 0,m=d?d.rttMs:void 0,g=f&&m?(f+m)/2:f||m,y=100*i.sendPacketLossRate*.7/50+.3*((g&&h?(g+h)/2:g||h)||0)/1500,C=y<.17?1:y<.36?2:y<.59?3:y<.1?4:5,b=null==r?void 0:r.track;if(b&&b._encoderConfig&&-1===b._hints.indexOf(Qt.SCREEN_TRACK)){const O=b._encoderConfig.bitrateMax,P=i.bitrate.actualEncoded;if(O&&P){const D=(1e3*O-P)/(1e3*O);return ws[D<.15?0:D<.3?1:D<.45?2:D<.6?3:4][C]}}return C}getDownlinkNetworkQuality(){if(!this.connection)return 0;const i=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(a=>{let[l]=a;const d=l._audioSSRC,h=l._videoSSRC,f=i.audioRecv.find(P=>P.ssrc===d),m=i.videoRecv.find(P=>P.ssrc===h);if(!f&&!m)return void(r+=1);const g=ro(this,Re.NeedSignalRTT),E=i.rtt,y=(E&&g?(E+g)/2:E||g)||0,C=f?f.jitterMs:void 0,b=i.recvPacketLossRate;let O=.7*b*100/50+.3*y/1500;C&&(O=.6*b*100/50+.2*y/1500+.2*C/400),r+=O<.1?1:O<.17?2:O<.36?3:O<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}muteLocalTrack(i){var r=this;return x(function*(){return new q((a,l)=>{r.handleMuteLocalTrack(i,a,l)})})()}filterTobePublishedTracks(i,r,a){const l=[],d=Rt(),h=this.getAllTracks();i=d_(i=i.filter(g=>-1===h.indexOf(g)));let f=!1,m=!1;for(const g of i){if(g instanceof Ye&&(this.localTrackMap.has(se.LocalVideoTrack)||f?new ne(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(l.push({track:g,type:se.LocalVideoTrack}),f=!0),r)){const E=this.getLowVideoTrack(g,a);l.push({track:E,type:se.LocalVideoLowTrack})}if(g instanceof vt){const E=this.localTrackMap.get(se.LocalAudioTrack);if(E){if(!(E.track instanceof ei))throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0)}else if(m){const y=l.find(C=>{let{type:b}=C;return b===se.LocalAudioTrack});if(!(y.track instanceof ei))throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");y.track.addAudioTrack(g)}else{if(!d.webAudioMediaStreamDest||g instanceof ei||g._bypassWebAudio)l.push({track:g,type:se.LocalAudioTrack});else{const y=new ei;y.addAudioTrack(g),l.push({track:y,type:se.LocalAudioTrack})}m=!0}}}return l}filterTobeUnpublishedTracks(i){const r=[],a=this.getAllTracks();i=d_(i=i.filter(l=>-1!==a.indexOf(l)));for(const l of i){if(l instanceof vt){const d=this.localTrackMap.get(se.LocalAudioTrack);if(!d)continue;d.track instanceof ei?(d.track.removeAudioTrack(l),this.unbindLocalAudioTrackEvents(l),0===d.track.trackList.length&&(r.push([se.LocalAudioTrack,d]),d.track.close())):r.push([se.LocalAudioTrack,d])}if(l instanceof Ye){const d=this.localTrackMap.get(se.LocalVideoTrack);if(!d)continue;r.push([se.LocalVideoTrack,d]);const h=this.localTrackMap.get(se.LocalVideoLowTrack);h&&r.push([se.LocalVideoLowTrack,h])}}return r}filterTobePublishedDataChannels(i){return(i=d_(i)).filter(r=>-1===this.localDataChannels.findIndex(a=>a.id===r.id))}filterTobeUnpublishedDataChannels(i){return(i=(i=d_(i)).filter(r=>-1!==this.localDataChannels.indexOf(r))).filter(r=>r._originDataChannel)}bindLocalTrackEvents(i){i.forEach(r=>{let{track:a,type:l}=r;switch(l){case se.LocalVideoTrack:a.addListener(me.GET_STATS,this.handleGetLocalVideoStats),a.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.addListener(me.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),a.addListener(me.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),a.addListener(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),a.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case se.LocalAudioTrack:this.bindLocalAudioTrackEvents(a)}})}bindLocalAudioTrackEvents(i,r){i instanceof ei?i.trackList.forEach(a=>{a.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.addListener(me.GET_STATS,this.handleGetLocalAudioStats),a.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(i.addListener(me.GET_STATS,this.handleGetLocalAudioStats),i.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||i.addListener(me.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(i){i||(i=Array.from(this.localTrackMap.entries()).map(r=>{let[a,{track:l}]=r;return{track:l,type:a}})),i.forEach(r=>{let{track:a,type:l}=r;switch(l){case se.LocalVideoTrack:a.off(me.GET_STATS,this.handleGetLocalVideoStats),a.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.off(me.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),a.off(me.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),a.off(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),a.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case se.LocalAudioTrack:this.unbindLocalAudioTrackEvents(a)}})}unbindLocalAudioTrackEvents(i){i instanceof ei?i.trackList.forEach(r=>{r.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(me.GET_STATS,this.handleGetLocalAudioStats),r.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(i.off(me.GET_STATS,this.handleGetLocalAudioStats),i.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(i,r){r instanceof xc&&r.addListener(me.GET_STATS,a=>{a(this.handleGetRemoteVideoStats(i))}),r instanceof Ns&&r.addListener(me.GET_STATS,a=>{a(this.handleGetRemoteAudioStats(i))})}unbindRemoteTrackEvents(i){i&&i.removeAllListeners(me.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(i=>{let[r,a]=i;a.has(ye.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),a.has(ye.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(i,r){return i.map((a,l)=>{var d;let h,f,{track:m,type:g}=a;switch(g){case se.LocalAudioTrack:h=bt.Audio,f={dtx:m instanceof Lc&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case se.LocalVideoTrack:h=we(d=m._hints).call(d,Qt.SCREEN_TRACK)?bt.Screen:bt.High,f=Jc(Jc({},iy(m)),{},{codec:this.store.codec});break;case se.LocalVideoLowTrack:h=bt.Low,f=Jc(Jc({},iy(m)),{},{codec:this.store.codec})}return{stream_type:h,attributes:f,ssrcs:r[l]}})}createGatewayUnpublishMessage(i){return i.map(r=>{var a;let l,[d,{track:h,ssrcs:f,id:m}]=r;switch(d){case se.LocalVideoTrack:l=we(a=h._hints).call(a,Qt.SCREEN_TRACK)?bt.Screen:bt.High;break;case se.LocalAudioTrack:l=bt.Audio;break;case se.LocalVideoLowTrack:l=bt.Low}return{stream_type:l,ssrcs:f,mid:m}})}assignLocalTracks(i,r){i.forEach((a,l)=>{let{track:d,type:h}=a;this.localTrackMap.set(h,{track:d,id:r[l].id,ssrcs:r[l].localSSRC})})}withdrawLocalTracks(i){i.forEach(r=>{let[a]=r;this.localTrackMap.delete(a)})}bindConnectionEvents(i){var r=this;i.onConnectionStateChange=function(){var a=x(function*(l){if(R.info("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(l,")")),r.emit(Re.PeerConnectionStateChange,l),"connected"!==l||r.store.keyMetrics.peerConnectionEnd||r.store.peerConnectionEnd(),"connected"===l&&(r._restartTimer&&(clearTimeout(r._restartTimer),r._restartTimer=void 0),(r._isFirstConnected||r._isInRestartIce)&&r.reportPCStats(Date.now(),!0,r._pcStatsUploadType),r._isInRestartIce=!1,r._isFirstConnected=!1,r._isStartRestartIce=!1),H("NEW_ICE_RESTART")){var d;if(we(d=r._restartStates).call(d,l)){if(r._isStartRestartIce)return;r._isStartRestartIce=!0;const h=g=>{("disconnected"===i.iceConnectionState||"checking"===i.iceConnectionState||"failed"===i.iceConnectionState)&&(R.debug("[".concat(r.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(g)),"CONNECTED"===ro(r,Re.QueryClientConnectionState)&&r.emit(Re.RequestRestartICE,g))},f=()=>{"disconnected"!==i.iceConnectionState&&"checking"!==i.iceConnectionState&&"failed"!==i.iceConnectionState||(r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),R.debug("[".concat(r.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>r.emit(Re.P2PLost),0),r.iceFailedCount+=1,r.requestReconnect())},m=H("ICE_RESTART_INTERVAL");return void(r._restartTimer=window.setTimeout(()=>{if(H("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Rt().supportPCSetConfiguration)h(fi.RELAY),r._restartTimer=window.setTimeout(f,m);else if(Pt())h(fi.UDP),r._restartTimer=window.setTimeout(f,4e3);else{if(h(fi.TCP),Rt().supportPCSetConfiguration)return void(r._restartTimer=window.setTimeout(()=>{h(fi.RELAY),r._restartTimer=window.setTimeout(f,m)},m));r._restartTimer=window.setTimeout(f,m)}},800))}}else{if("disconnected"===l&&"disconnected"===i.iceConnectionState)return setTimeout(()=>{"disconnected"===i.iceConnectionState&&H("ICE_RESTART")&&"CONNECTED"===ro(r,Re.QueryClientConnectionState)&&r.emit(Re.RequestRestartICE)},800),void setTimeout(()=>{"disconnected"===i.peerConnectionState&&(R.debug("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),r._isInRestartIce=!1,setTimeout(()=>r.emit(Re.P2PLost),0),r.iceFailedCount+=1,r.requestReconnect())},4e3);"failed"===l&&(R.debug("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection state failed, force reconnect")),r.reportPCDisconnectedOrFailed(),setTimeout(()=>r.emit(Re.P2PLost),0),r.iceFailedCount+=1,yield r.requestReconnect())}});return function(l){return a.apply(this,arguments)}}(),i.onICEConnectionStateChange=a=>{"connected"!==a||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(a,")")),Te.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:a,tag:Kt.TRACER}).onSuccess(),this.emit(Re.IceConnectionStateChange,a)},i.onICETransportStateChange=a=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(a,")"))},i.onDTLSTransportStateChange=a=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(a,")"))},i.onDTLSTransportError=a=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(a,")"))},i.onFirstAudioDecoded=a=>{var l;const d=Array.from(jr(l=this.remoteUserMap).call(l)).find(f=>f._audioSSRC===a);var h;d&&(this.store.subscribe(d.uid,"audio",void 0,void 0,void 0,Date.now()),null===(h=d.audioTrack)||void 0===h||h.emit(hu.FIRST_FRAME_DECODED),Te.firstRemoteFrame(this.store.sessionId,rn.FIRST_AUDIO_DECODE,Xt.FIRST_AUDIO_DECODE,{peer:d._uintid,subscribeElapse:Ni.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId}))},i.onFirstAudioReceived=a=>{var l;const d=Array.from(jr(l=this.remoteUserMap).call(l)).find(h=>h._audioSSRC===a);d&&Te.firstRemoteFrame(this.store.sessionId,rn.FIRST_AUDIO_RECEIVED,Xt.FIRST_AUDIO_RECEIVED,{peer:d._uintid,subscribeElapse:Ni.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId})},i.onFirstVideoDecoded=(a,l,d)=>{this.reportVideoFirstFrameDecoded(a,l,d)},i.onFirstVideoReceived=a=>{var l;const d=Array.from(jr(l=this.remoteUserMap).call(l)).find(h=>h._videoSSRC===a);d&&Te.firstRemoteFrame(this.store.sessionId,rn.FIRST_VIDEO_RECEIVED,Xt.FIRST_VIDEO_RECEIVED,{peer:d._uintid,subscribeElapse:Ni.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId})},i.onSelectedLocalCandidateChanged=(a,l)=>{const d="relay"===a.candidateType;"unknown"!==l.candidateType&&d===("relay"===l.candidateType)||this.emit(Re.ConnectionTypeChange,d),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ql(l))," -> ").concat(JSON.stringify(ql(a)),")"))},i.onSelectedRemoteCandidateChanged=(a,l)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ql(l))," -> ").concat(JSON.stringify(ql(a)),")"))},i.onFirstVideoDecodedTimeout=a=>{this.reportVideoFirstFrameDecoded(a,void 0,void 0,!0)}}unbindConnectionEvents(i){i.onConnectionStateChange=void 0,i.onICEConnectionStateChange=void 0,i.onICETransportStateChange=void 0,i.onDTLSTransportStateChange=void 0,i.onDTLSTransportError=void 0,i.onFirstAudioDecoded=void 0,i.onFirstAudioReceived=void 0,i.onFirstVideoDecoded=void 0,i.onFirstVideoReceived=void 0,i.onSelectedLocalCandidateChanged=void 0,i.onSelectedRemoteCandidateChanged=void 0,i.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(i){const r=[];if(-1===this.getAllTracks().indexOf(i))return r;const a=this.localTrackMap.get(se.LocalAudioTrack);if(i instanceof vt&&(null==a?void 0:a.track)instanceof ei)return a.track.isActive||r.push([se.LocalAudioTrack,a]),r;const l=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return i===h});if(l&&(r.push(l),l[0]===se.LocalVideoTrack)){const d=this.localTrackMap.get(se.LocalVideoLowTrack);d&&r.push([se.LocalVideoLowTrack,d])}return r}filterTobeUnmutedTracks(i){const r=[],a=this.localTrackMap.get(se.LocalAudioTrack);if(i instanceof vt&&(null==a?void 0:a.track)instanceof ei)return a.track.isActive&&r.push([se.LocalAudioTrack,a]),r;const l=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return i===h});if(l)if(l[0]===se.LocalVideoTrack){r.push(l);const d=this.localTrackMap.get(se.LocalVideoLowTrack);d&&r.push([se.LocalVideoLowTrack,d])}else r.push(l);return r}createMuteMessage(i){return i.map(r=>{var a;let l,[d,{track:h,ssrcs:f,id:m}]=r;switch(d){case se.LocalAudioTrack:l=bt.Audio;break;case se.LocalVideoTrack:l=we(a=h._hints).call(a,Qt.SCREEN_TRACK)?bt.Screen:bt.High;break;case se.LocalVideoLowTrack:l=bt.Low}return{stream_type:l,ssrcs:f,mid:m}})}createUnmuteMessage(i){return i.map(r=>{var a;let l,[d,{track:h,ssrcs:f,id:m}]=r;switch(d){case se.LocalAudioTrack:l=bt.Audio;break;case se.LocalVideoTrack:l=we(a=h._hints).call(a,Qt.SCREEN_TRACK)?bt.Screen:bt.High;break;case se.LocalVideoLowTrack:l=bt.Low}return{stream_type:l,ssrcs:f,mid:m}})}filterTobeUnSubscribedTracks(i,r){const a=[],l=this.remoteUserMap.get(i);if(!l)return a;if(r){const d=l.get(r);if(!d)return a;a.push([i,{kind:r,id:d}])}else Array.from(l.entries()).forEach(d=>{let[h,f]=d;a.push([i,{kind:h,id:f}])});return a}filterTobeUnSubscribedDataChannels(i,r){const a=[];return r.forEach(l=>{var d;null!==(d=this.remoteDataChannelMap.get(i))&&void 0!==d&&d.has(l.id)&&a.push(l)}),a}createUnsubscribeMessage(i){const r=[];return i.forEach(a=>{let[l,{kind:d}]=a;switch(d){case ye.VIDEO:return void(l._videoSSRC&&r.push({stream_type:ye.VIDEO,ssrcId:l._videoSSRC}));case ye.AUDIO:return void(l._audioSSRC&&r.push({stream_type:ye.AUDIO,ssrcId:l._audioSSRC}))}}),r}createUnsubscribeAllMessage(i){const r=new Map;return i.forEach(a=>{let[l,{kind:d}]=a;if(r.has(l)){let h=r.get(l);h|=d===ye.VIDEO?Kn.Video:Kn.Audio,r.set(l,h)}else r.set(l,d===ye.VIDEO?Kn.Video:Kn.Audio)}),{users:Array.from(r.entries()).map(a=>{let[l,d]=a;return{stream_id:l.uid,stream_type:d}})}}withdrawRemoteTracks(i){i.forEach(r=>{let[a,{kind:l}]=r;const d=this.remoteUserMap.get(a);d&&(d.delete(l),0===Array.from(d.entries()).length&&this.remoteUserMap.delete(a))})}updateBitrateLimit(i){var r=this;return x(function*(){const a=r.localTrackMap.get(se.LocalVideoTrack),l=r.localTrackMap.get(se.LocalVideoLowTrack);a&&(yield a.track.setBitrateLimit(i.uplink)),l&&i.low_stream_uplink&&(yield l.track.setBitrateLimit({max_bitrate:i.low_stream_uplink.bitrate,min_bitrate:i.low_stream_uplink.bitrate||0}))})()}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(i,r){return i.map((a,l)=>{var d;let{stream_type:h}=a;return null===(d=r.find(f=>{let{stream_type:m}=f;return h===m}))||void 0===d?void 0:d.attributes})}tryToUnmuteAudio(i){var r=this;return x(function*(){for(let l=0;l<i.length;l++)if(i[l]instanceof vt){var a;const d=r.filterTobeUnmutedTracks(i[l]);if(0===d.length)continue;yield null===(a=r.connection)||void 0===a?void 0:a.unmuteLocal(d.map(f=>{let[,{id:m}]=f;return m}));const h=r.createUnmuteMessage(d);return void(yield Ht(r,Re.RequestUnmuteLocal,h))}})()}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=i=>{var r;return!(null===(r=this.connection)||void 0===r||!r.getRemoteVideoIsReady(i))},this.statsUploader.requestUpload=(i,r)=>this.emit(Re.RequestUploadStats,i,r),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){var i=this;return x(function*(){i.dtlsFailedCount+=1,yield si(eE(i.dtlsFailedCount,Wn)),i.emit(Re.RequestReconnect)})()}reconnectP2P(){var i=this;return x(function*(){const r=Array.from(i.localTrackMap.entries()),a=i.createGatewayUnpublishMessage(r);Array.from(i.remoteUserMap.entries()),a.length>0&&(yield vn(i,Re.RequestUnpublishForReconnectPC,a)),i.disconnectForReconnect(),i.emit(Re.RequestReconnectPC)})()}canPublishLowStream(){return this.localTrackMap.has(se.LocalVideoTrack)||this.pendingLocalTracks.some(i=>i instanceof Ye)}throwIfTrackTypeNotMatch(i){if(i.filter(r=>r instanceof Ye).length>1)throw new ne(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(i.filter(r=>r instanceof vt).length>1&&(i.some(r=>r instanceof vt&&r._bypassWebAudio)||!Rt().webAudioMediaStreamDest))throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of i){if(r instanceof Ye&&this.pendingLocalTracks.some(a=>a instanceof Ye))throw new ne(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof vt&&this.pendingLocalTracks.some(a=>a instanceof vt)&&(!Rt().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(a=>a instanceof vt&&a._bypassWebAudio)))throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(i,r){const a=!H("DISABLE_DUAL_STREAM_USE_ENCODING")&&Rt().supportDualStreamEncoding,l=Jc(Jc({},{width:160,height:120,framerate:15,bitrate:50}),r);let d;d=a?i._mediaStreamTrack.clone():em(i,l);const h=Vt(8,"track-low-"),f=new Ye(d,Jc(Jc({},a&&{scaleResolutionDownBy:_b(l,i)}),{},{frameRate:l.framerate,bitrateMax:l.bitrate,bitrateMin:l.bitrate}),void 0,void 0,h);return f.on(Ul.TRANSCEIVER_UPDATED,m=>{i._updateRtpTransceiver(m,Os.LOW_STREAM)}),f._hints.push(Qt.LOW_STREAM),i.addListener(me.NEED_CLOSE,()=>{f.close()}),f}globalLock(){var i=this;return x(function*(){return i.mutex.lock("From P2PChannel.globalLock")})()}reportPCStats(i,r,a){var l=arguments,d=this;return x(function*(){let h=l.length>3&&void 0!==l[3]?l[3]:null;if(d.connection&&d.connection instanceof wi){var f,m,g,E;const y=d.store.keyMetrics.descriptionStart||0,{iceConnectionState:C,dtlsTransportState:b,peerConnectionState:O}=d.connection,{local:P,remote:D}=yield d.connection.getSelectedCandidatePair();Te.pcStats(d.store.sessionId,{startTime:y,eventElapse:i-y||0,iceconnectionsate:C,dtlsstate:b,connectionstate:O,intSucc:r?1:2,error:h,selectedLocalCandidateProtocol:null!==(f=null==P?void 0:P.protocol)&&void 0!==f?f:"",selectedLocalCandidateType:null!==(m=P.candidateType)&&void 0!==m?m:"",selectedLocalCandidateAddress:"".concat(P.address,":").concat(P.port),selectedRemoteCandidateProtocol:null!==(g=D.protocol)&&void 0!==g?g:"",selectedRemoteCandidateType:null!==(E=D.candidateType)&&void 0!==E?E:"",selectedRemoteCandidateAddress:"".concat(D.address,":").concat(D.port),restartCnt:a})}})()}reportVideoFirstFrameDecoded(i,r,a,l){var d;const h=Array.from(jr(d=this.remoteUserMap).call(d)).find(f=>f._videoSSRC===i);if(h){l||this.store.subscribe(h.uid,"video",void 0,void 0,void 0,void 0,Date.now());const f=this.store.keyMetrics,m=f.subscribe.find(g=>g.userId===h.uid&&"video"===g.type);Te.firstRemoteVideoDecode(this.store.sessionId,rn.FIRST_VIDEO_DECODE,Xt.FIRST_VIDEO_DECODE,{peer:h._uintid,videowidth:r,videoheight:a,subscribeElapse:Ni.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId,apEnd:f.requestAPEnd||0,apStart:f.requestAPStart||0,joinGwEnd:f.joinGatewayEnd||0,joinGwStart:f.joinGatewayStart||0,pcEnd:f.peerConnectionEnd||0,pcStart:f.peerConnectionStart||0,subscriberEnd:(null==m?void 0:m.subscribeEnd)||0,subscriberStart:(null==m?void 0:m.subscribeStart)||0,videoAddNotify:(null==m?void 0:m.streamAdded)||0,state:l?1:0})}}remoteMediaSsrcChanged(i,r,a){var l=this;return x(function*(){if(!l.connection)return!1;const d=l.remoteUserMap.get(i);if(!d)return!1;const h=d.get(r);if(!h)return!1;const f=yield l.connection.getRemoteSSRC(h);return void 0!==f&&f!==a})()}resetConnection(i){R.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(i)),this.state===rt.Connected?(R.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=i===Zh.datachannel?new mi({},this.store):this.isPlanB?new Ii({},this.store):new wi({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(i=>{let[r,{track:a}]=i;r===se.LocalVideoLowTrack?a._updateRtpTransceiver(void 0,Os.LOW_STREAM):a._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(i){this.connection&&this.connection instanceof wi&&("disconnected"!==this.connection.iceConnectionState&&"checking"!==this.connection.iceConnectionState&&"failed"!==this.connection.iceConnectionState||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this.reportPCStats(Date.now(),!1,this._pcStatsUploadType===da.TCP_RESTART&&i===fi.RELAY?this._pcStatsUploadType:da.DISCONNECTED_OR_FAILED)))}}function ar(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=x(function*(){const l=this.mutex,d=yield l.lock("From P2PChannel.".concat(i));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return yield a.apply(this,f)}finally{d()}}),r}function Cy(s){let i={};e:for(;!RN(s);){let r=Xa(s);switch(r>>>3){case 0:break e;case 1:i.requestId=IN(s,Xa(s));break;case 2:i.requestType=Xa(s)>>>0;break;case 3:i.scorePorn=Wb(s);break;case 4:i.scoreSexy=Wb(s);break;case 5:i.scoreNeutral=Wb(s);break;case 6:i.requestScene=Xa(s)>>>0;break;case 7:i.scene=Xa(s)>>>0;break;default:y2(s,7&r)}}return i}function TN(s,i){let r=s.service;void 0!==r&&(Nt(i,8),Nt(i,r));let a=s.vendor;void 0!==a&&(Nt(i,16),Nt(i,a));let l=s.token;void 0!==l&&(Nt(i,26),Ja(i,l));let d=s.callbackUrl;void 0!==d&&(Nt(i,34),Ja(i,d))}function E2(s){let i=Xa(s),r=s.limit;return s.limit=s.offset+i,r}function y2(s,i){switch(i){case 0:for(;128&wN(s););break;case 2:Gb(s,Xa(s));break;case 5:Gb(s,4);break;case 1:Gb(s,8);break;default:throw new Error("Unimplemented type: "+i)}}oe([ar,N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",q)],qn.prototype,"startP2PConnection",null),oe([ar,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",q)],qn.prototype,"connect",null),oe([ar,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",q)],qn.prototype,"preConnect",null),oe([ar,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],qn.prototype,"publishDataChannel",null),oe([ar,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],qn.prototype,"unpublish",null),oe([ar,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],qn.prototype,"unpublishDataChannel",null),oe([ar,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",q)],qn.prototype,"unpublishLowStream",null),oe([ar,N("design:type",Function),N("design:paramtypes",[Wt,Array]),N("design:returntype",q)],qn.prototype,"subscribeDataChannel",null),oe([ar,N("design:type",Function),N("design:paramtypes",[Wt,String,Number,Number,Array]),N("design:returntype",q)],qn.prototype,"subscribe",null),oe([ar,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],qn.prototype,"massSubscribe",null),oe([ar,N("design:type",Function),N("design:paramtypes",[Wt,String,Boolean]),N("design:returntype",q)],qn.prototype,"unsubscribe",null),oe([ar,N("design:type",Function),N("design:paramtypes",[Wt,Array]),N("design:returntype",q)],qn.prototype,"unsubscribeDataChannel",null),oe([ar,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],qn.prototype,"massUnsubscribe",null),oe([ar,N("design:type",Function),N("design:paramtypes",[Wt,String]),N("design:returntype",q)],qn.prototype,"muteRemote",null),oe([ar,N("design:type",Function),N("design:paramtypes",[Wt,String]),N("design:returntype",q)],qn.prototype,"unmuteRemote",null),oe([ar,N("design:type",Function),N("design:paramtypes",[Wt,String]),N("design:returntype",q)],qn.prototype,"hasRemoteMediaWithLock",null),oe([ar,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",q)],qn.prototype,"disconnectForReconnect",null),oe([ar,N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",q)],qn.prototype,"updateBitrateLimit",null),oe([ar,N("design:type",Function),N("design:paramtypes",[Wt,String,Number]),N("design:returntype",q)],qn.prototype,"remoteMediaSsrcChanged",null);let bN=new Float32Array(1);new Uint8Array(bN.buffer);let Hb=new Float64Array(1),Jr=new Uint8Array(Hb.buffer);function Sp(s){return{low:s|=0,high:s>>31,unsigned:s>=0}}let v2=[];function Fs(){const s=v2.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}function C2(s){v2.push(s)}function Gb(s,i){if(s.offset+i>s.limit)throw new Error("Skip past limit");s.offset+=i}function RN(s){return s.offset>=s.limit}function Tp(s,i){let r=s.bytes,a=s.offset,l=s.limit,d=a+i;if(d>r.length){let h=new Uint8Array(2*d);h.set(r),s.bytes=h}return s.offset=d,d>l&&(s.limit=d),a}function bp(s,i){let r=s.offset;if(r+i>s.limit)throw new Error("Read past limit");return s.offset+=i,r}function IN(s,i){let r=bp(s,i),a=String.fromCharCode,l=s.bytes,d="\ufffd",h="";for(let f=0;f<i;f++){let m,g,E,y,C=l[f+r];0==(128&C)?h+=a(C):192==(224&C)?f+1>=i?h+=d:(m=l[f+r+1],128!=(192&m)?h+=d:(y=(31&C)<<6|63&m,y<128?h+=d:(h+=a(y),f++))):224==(240&C)?f+2>=i?h+=d:(m=l[f+r+1],g=l[f+r+2],32896!=(49344&(m|g<<8))?h+=d:(y=(15&C)<<12|(63&m)<<6|63&g,y<2048||y>=55296&&y<=57343?h+=d:(h+=a(y),f+=2))):240==(248&C)?f+3>=i?h+=d:(m=l[f+r+1],g=l[f+r+2],E=l[f+r+3],8421504!=(12632256&(m|g<<8|E<<16))?h+=d:(y=(7&C)<<18|(63&m)<<12|(63&g)<<6|63&E,y<65536||y>1114111?h+=d:(y-=65536,h+=a(55296+(y>>10),56320+(1023&y)),f+=3))):h+=d}return h}function Ja(s,i){let r=i.length,a=0;for(let h=0;h<r;h++){let f=i.charCodeAt(h);f>=55296&&f<=56319&&h+1<r&&(f=(f<<10)+i.charCodeAt(++h)-56613888),a+=f<128?1:f<2048?2:f<65536?3:4}Nt(s,a);let l=Tp(s,a),d=s.bytes;for(let h=0;h<r;h++){let f=i.charCodeAt(h);f>=55296&&f<=56319&&h+1<r&&(f=(f<<10)+i.charCodeAt(++h)-56613888),f<128?d[l++]=f:(f<2048?d[l++]=f>>6&31|192:(f<65536?d[l++]=f>>12&15|224:(d[l++]=f>>18&7|240,d[l++]=f>>12&63|128),d[l++]=f>>6&63|128),d[l++]=63&f|128)}}function S2(s,i){let r=Tp(s,i.limit),a=s.bytes,l=i.bytes;for(let d=0,h=i.limit;d<h;d++)a[d+r]=l[d]}function wN(s){return s.bytes[bp(s,1)]}function AN(s,i){let r=Tp(s,1);s.bytes[r]=i}function Wb(s){let i=bp(s,8),r=s.bytes;return Jr[0]=r[i++],Jr[1]=r[i++],Jr[2]=r[i++],Jr[3]=r[i++],Jr[4]=r[i++],Jr[5]=r[i++],Jr[6]=r[i++],Jr[7]=r[i++],Hb[0]}function Kb(s,i){let r=Tp(s,8),a=s.bytes;Hb[0]=i,a[r++]=Jr[0],a[r++]=Jr[1],a[r++]=Jr[2],a[r++]=Jr[3],a[r++]=Jr[4],a[r++]=Jr[5],a[r++]=Jr[6],a[r++]=Jr[7]}function Xa(s){let i,r=0,a=0;do{i=wN(s),r<32&&(a|=(127&i)<<r),r+=7}while(128&i);return a}function Nt(s,i){for(i>>>=0;i>=128;)AN(s,127&i|128),i>>>=7;AN(s,i)}function $l(s,i){let r=i.low>>>0,a=(i.low>>>28|i.high<<4)>>>0,l=i.high>>>24,d=0===l?0===a?r<16384?r<128?1:2:r<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:l<128?9:10,h=Tp(s,d),f=s.bytes;switch(d){case 10:f[h+9]=l>>>7&1;case 9:f[h+8]=9!==d?128|l:127&l;case 8:f[h+7]=8!==d?a>>>21|128:a>>>21&127;case 7:f[h+6]=7!==d?a>>>14|128:a>>>14&127;case 6:f[h+5]=6!==d?a>>>7|128:a>>>7&127;case 5:f[h+4]=5!==d?128|a:127&a;case 4:f[h+3]=4!==d?r>>>21|128:r>>>21&127;case 3:f[h+2]=3!==d?r>>>14|128:r>>>14&127;case 2:f[h+1]=2!==d?r>>>7|128:r>>>7&127;case 1:f[h]=1!==d?128|r:127&r}}function DN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}const ON=new Map([["moderation",1],["supervise",2]]);class Sy extends nn{get connectionState(){return this._connectionState}set connectionState(i){if(this._connectionState===i)return;const r=this._connectionState;this._connectionState=i,this.emit(ci.CONNECTION_STATE_CHANGE,r,i)}get inspectType(){return this._inspectType}set inspectType(i){var r;this._inspectMode=Ba(r=i.map(a=>ON.get(a)||0)).call(r,(a,l)=>a+l),this._inspectType=i}get quality(){return this._quality}set quality(i){this._quality=i>1?1:i<.1?.1:i,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(i){super(),T(this,"name","AgoraRTCVideoContentInspect"),T(this,"_connectionState",oo.CONNECTING),T(this,"_innerConnectionState",void 0),T(this,"sequence",0),T(this,"inspectStartTime",void 0),T(this,"workerManagerConnection",void 0),T(this,"workerConnection",void 0),T(this,"workerMessageLengthLimit",void 0),T(this,"inspectIntervalMinimum",void 0),T(this,"qualityRatio",void 0),T(this,"_connectInfo",void 0),T(this,"_cancelTokenSource",Gr.CancelToken.source()),T(this,"_retryConfig",void 0),T(this,"wmSequence",0),T(this,"inspectInterval",void 0),T(this,"inspectTimer",null),T(this,"ossFilePrefix",void 0),T(this,"extraInfo",void 0),T(this,"_inspectType",void 0),T(this,"_inspectMode",void 0),T(this,"_quality",1),T(this,"qualityTimer",null),T(this,"_inspectId",void 0),T(this,"_needWorkUrlOnly",!1),T(this,"inspectImage",()=>{if(this.connectionState!==oo.CONNECTED)throw new K(k.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===oo.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Vt(5,"inspect-"),this.workerMessageLengthLimit=H("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=H("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=H("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=i.interval,this.ossFilePrefix=i.ossFilePrefix,this.extraInfo=i.extraInfo,this.inspectType=i.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new T_("worker-manager-"+this._inspectId,Wn),this.on(ci.STATE_CHANGE,(r,a)=>{this._innerConnectionState=r,R.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Co[r]," ").concat(a||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new T_("worker-"+this._inspectId,Wn),this.handleWorkerEvents()}init(i,r){var a=this;return x(function*(){a.emit(ci.STATE_CHANGE,Co.CONNECT_AP),a._connectInfo=i;const l=a._cancelTokenSource.token;return a._retryConfig=r,new q((d,h)=>{a.on(ci.CONNECTION_STATE_CHANGE,(f,m)=>{m===oo.CONNECTED&&d()}),a.requestAP(i,l,r).then(f=>{a.connectWorkerManager(f)}).catch(f=>{h(f)})})})()}requestAP(i,r,a){var l=this;return x(function*(){const d=H("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),h=yield function(m,g,E,y){let{appId:C,areaCode:b,cname:O,sid:P,token:D,uid:L}=g;K_++;const B="image_moderation_api",V={service_name:B,json_body:JSON.stringify({appId:C,areaCode:b,cname:O,command:"allocateEdge",requestId:K_,seq:K_,sid:P,token:D,ts:Date.now(),uid:L+""})};let J,ae,z=m[0];return Ss(x(function*(){J=Date.now();const Q=yield Kc(z,{data:V,cancelToken:E,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ae=Date.now()-J,0!==Q.code){const Se=new K(k.UNEXPECTED_RESPONSE,"image inspect ap error, code"+Q.code,{retry:!0,responseTime:ae});throw R.error(Se.toString()),Se}const X=JSON.parse(Q.json_body);if(200!==X.code){const Se=new K(k.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(X.code,", reason: ").concat(X.reason),{code:X.code,responseTime:ae});throw R.error(Se.toString()),Se}if(!X.servers||!Array.isArray(X.servers)||0===X.servers.length){const Se=new K(k.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:X.code,responseTime:ae});throw R.error(Se.toString()),Se}const te=H("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Ce=H("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:X.servers.map(Se=>{let{address:He,wss:ut}=Se;if(He&&ut)return"wss://".concat(He.replace(/\./g,"-"),".").concat(te,":").concat(Ce||ut)}).filter(Se=>!!Se),workerToken:X.workerToken,vid:X.vid,responseTime:ae}}),(Q,X)=>(Te.apworkerEvent(P,{success:!0,sc:200,serviceName:B,responseDetail:JSON.stringify(Q.addressList),firstSuccess:0===X,responseTime:ae,serverIp:m[X%m.length]}),!1),(Q,X)=>(Te.apworkerEvent(P,{success:!1,sc:Q.data&&Q.data.code||200,serviceName:B,responseTime:ae,serverIp:m[X%m.length]}),!!(Q.code!==k.OPERATION_ABORTED&&Q.code!==k.UNEXPECTED_RESPONSE||Q.data&&Q.data.retry)&&(z=m[(X+1)%m.length],!0)),y)}(d,i,r,a);l.emit(ci.STATE_CHANGE,Co.AP_CONNECTED);const{addressList:f}=h;return l.wmSequence++,f})()}connectWorkerManager(i){var r=arguments,a=this;return x(function*(){a._needWorkUrlOnly=r.length>1&&void 0!==r[1]&&r[1],a.emit(ci.STATE_CHANGE,Co.CONNECT_WORKER_MANAGER),yield a.workerManagerConnection.init(i,1e4)})()}connectWorker(i){var r=this;return x(function*(){yield r.workerConnection.init([i])})()}handleWorkerManagerEvents(){var i=this;this.workerManagerConnection.on(Ne.CONNECTED,x(function*(){i.emit(ci.STATE_CHANGE,Co.WORKER_MANAGER_CONNECTED,i.workerManagerConnection.url),i.workerManagerConnection.sendMessage({appId:i._connectInfo.appId,cname:i._connectInfo.cname,uid:i._connectInfo.uid+"",sdkVersion:"4.19.1",sid:i._connectInfo.sid,seq:i.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(Ne.CLOSED,()=>{this._innerConnectionState<Co.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Ne.FAILED,()=>{this._innerConnectionState<Co.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Ne.RECONNECTING,()=>{this._innerConnectionState<Co.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Ne.ON_MESSAGE,function(){var r=x(function*(a){i.emit(ci.STATE_CHANGE,Co.GET_WORKER_MANAGER_RESPONSE);const l=i.workerManagerConnection.url;i.workerManagerConnection.close();const d=JSON.parse(a.data);if(200!==d.code)throw R.error("[".concat(i._inspectId,"] Unexpected code ").concat(d.code," from worker manager")),new K(k.UNEXPECTED_RESPONSE,"response code of worker is unexpected",d);if(!(d.serverResponse&&d.serverResponse.portWss&&l))throw R.error("[".concat(i._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(d))),new K(k.UNEXPECTED_RESPONSE,"response content of worker is unexpected",d);{const h=H("VIDEO_INSPECT_WORKER_PORT")||d.serverResponse.portWss,f=l.replace(/:\d+\/?$/,":".concat(h));i.emit(ci.STATE_CHANGE,Co.CONNECT_WORKER,f),i._needWorkUrlOnly?i.emit(ci.REQUEST_NEW_WORKER_URL,f):yield i.connectWorker(f)}});return function(a){return r.apply(this,arguments)}}()),this.workerManagerConnection.on(Ne.WILL_RECONNECT,(r,a,l)=>{l(r)}),this.workerManagerConnection.on(Ne.REQUEST_NEW_URLS,(r,a)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(a)})}handleWorkerEvents(){var i=this;this.workerConnection.on(Ne.CONNECTED,x(function*(){i.emit(ci.STATE_CHANGE,Co.WORKER_CONNECTED,i.workerConnection.url),i.connectionState=oo.CONNECTED})),this.workerConnection.on(Ne.ON_MESSAGE,function(){var r=x(function*(a){if(a.data instanceof ArrayBuffer){const d=function(s){return function(r){let a={};e:for(;!RN(r);){let l=Xa(r);switch(l>>>3){case 0:break e;case 1:a.code=Xa(r);break;case 2:a.msg=IN(r,Xa(r));break;case 3:{let d=E2(r);a.data=Cy(r),r.limit=d;break}default:y2(r,7&l)}}return a}({bytes:i=s,offset:0,limit:i.length});var i}(new Uint8Array(a.data));if(H("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&R.debug("[".concat(i._inspectId,"] Response message for worker of inspect content "),JSON.stringify(d)),200===d.code){if(Array.isArray(i.inspectType)&&1===i.inspectType.length&&"supervise"===i.inspectType[0])return void i.emit(ci.INSPECT_RESULT,void 0,void 0);if(d.data&&d.data.scorePorn&&d.data.scoreSexy&&d.data.scoreNeutral){var l;const h={porn:d.data.scorePorn,sexy:d.data.scoreSexy,neutral:d.data.scoreNeutral},f=Ba(l=Object.keys(h)).call(l,(g,E)=>h[g]>h[E]?g:E,"porn"),m=Object.keys(h).find(g=>g===f);i.emit(ci.INSPECT_RESULT,m)}else i.emit(ci.INSPECT_RESULT,void 0,new K(k.UNEXPECTED_RESPONSE,d.code+"","There is an unexpected data on message"))}else i.emit(ci.INSPECT_RESULT,void 0,new K(k.UNEXPECTED_RESPONSE,d.code+"",d.msg))}else R.error("[".concat(i._inspectId,"] Unexpected message type from worker")),i.emit(ci.INSPECT_RESULT,void 0,new K(k.UNEXPECTED_RESPONSE,"invalid worker message type"))});return function(a){return r.apply(this,arguments)}}()),this.workerConnection.on(Ne.CLOSED,()=>{this.connectionState=oo.CLOSED}),this.workerConnection.on(Ne.FAILED,()=>{this.connectionState=oo.CLOSED}),this.workerConnection.on(Ne.RECONNECTING,()=>{this.connectionState=this.connectionState===oo.CONNECTED?oo.RECONNECTING:oo.CONNECTING}),this.workerConnection.on(Ne.WILL_RECONNECT,(r,a,l)=>{"recover"===r&&l(r),l("tryNext")}),this.workerConnection.on(Ne.REQUEST_NEW_URLS,(r,a)=>{this.workerManagerConnection.close(),this.once(ci.REQUEST_NEW_WORKER_URL,l=>{r([l])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(l=>{this.connectWorkerManager(l,!0)}).catch(l=>{a(l)})})}static intToLong(i){return{low:i|=0,high:i>>31,unsigned:i>=0}}requestToInspectImage(){var i=this;return x(function*(){i.sequence++;const r=ro(i,ci.CLIENT_LOCAL_VIDEO_TRACK),a={appId:i._connectInfo.appId,cname:i._connectInfo.cname,cid:i._connectInfo.cid,sid:i._connectInfo.sid,uid:i._connectInfo.uid,vid:i._connectInfo.vid};if(r){if(!r.isPlaying)return void i.emit(ci.INSPECT_RESULT,void 0,new K(k.INVALID_OPERATION,"Only the track being played can be inspected"));const l=yield i.generateRequestData(r,a);i.workerConnection.sendMessage(l,!0,!0)}else i.emit(ci.INSPECT_RESULT,void 0,new K(k.INVALID_OPERATION,"Only the track being published can be inspected"))})()}generateRequestData(i,r){var a=this;return x(function*(){let{appId:l,cname:d,cid:h,vid:f,sid:m,uid:g}=r;const E=Date.now(),y=yield i.getCurrentFrameImage("image/jpeg",a.quality),C=yield lO(y,l,d),b=a.sequence+"-"+h+"-"+g+"-"+E+"-"+Vt(12,""),O={appId:l,cid:h,cname:d,deviceId:"",elapse:Sy.intToLong(Number(E-a.inspectStartTime)),fileSize:C.byteLength,jpgEncryption:2,height:y.height,width:y.width,jpg:C,networkType:6,osType:7,requestId:b,sdkVersion:"4.19.1",sequence:a.sequence,sid:m,timestamp:Sy.intToLong(E),uid:g,vid:f,service:a._inspectMode,callbackData:a.extraInfo,ossFilePrefix:a.ossFilePrefix};void 0===a.extraInfo&&delete O.callbackData,void 0===a.ossFilePrefix&&delete O.ossFilePrefix;const P=function(s){let i=Fs();return function(r,a){let l=r.appId;void 0!==l&&(Nt(a,10),Ja(a,l));let d=r.cid;void 0!==d&&(Nt(a,16),Nt(a,d));let h=r.cname;void 0!==h&&(Nt(a,26),Ja(a,h));let f=r.deviceId;void 0!==f&&(Nt(a,34),Ja(a,f));let m=r.elapse;void 0!==m&&(Nt(a,40),$l(a,m));let g=r.fileSize;void 0!==g&&(Nt(a,48),$l(a,Sp(g)));let E=r.height;void 0!==E&&(Nt(a,56),$l(a,Sp(E)));let y=r.jpg;void 0!==y&&(Nt(a,66),Nt(a,y.length),function(It,re){let de=Tp(It,re.length);It.bytes.set(re,de)}(a,y));let C=r.networkType;void 0!==C&&(Nt(a,72),$l(a,Sp(C)));let b=r.osType;void 0!==b&&(Nt(a,80),$l(a,Sp(b)));let O=r.requestId;void 0!==O&&(Nt(a,90),Ja(a,O));let P=r.sdkVersion;void 0!==P&&(Nt(a,98),Ja(a,P));let D=r.sequence;void 0!==D&&(Nt(a,104),$l(a,Sp(D)));let L=r.sid;void 0!==L&&(Nt(a,114),Ja(a,L));let B=r.timestamp;void 0!==B&&(Nt(a,120),$l(a,B));let V=r.uid;void 0!==V&&(Nt(a,128),Nt(a,V));let J=r.vid;void 0!==J&&(Nt(a,136),Nt(a,J));let ae=r.width;void 0!==ae&&(Nt(a,144),$l(a,Sp(ae)));let z=r.service;void 0!==z&&(Nt(a,152),Nt(a,z));let Q=r.callbackData;void 0!==Q&&(Nt(a,162),Ja(a,Q));let X=r.jpgEncryption;void 0!==X&&(Nt(a,168),Nt(a,X));let te=r.requestType;void 0!==te&&(Nt(a,176),Nt(a,te));let Ce=r.scorePorn;void 0!==Ce&&(Nt(a,185),Kb(a,Ce));let Se=r.scoreSexy;void 0!==Se&&(Nt(a,193),Kb(a,Se));let He=r.scoreNeutral;void 0!==He&&(Nt(a,201),Kb(a,He));let ut=r.scene;void 0!==ut&&(Nt(a,208),Nt(a,ut));let mt=r.ossFilePrefix;void 0!==mt&&(Nt(a,218),Ja(a,mt));let dt=r.serviceVendor;if(void 0!==dt)for(let It of dt){Nt(a,226);let re=Fs();TN(It,re),Nt(a,re.limit),S2(a,re),C2(re)}}(s,i),function(r){let a=r.bytes,l=r.limit;return a.length===l?a:a.subarray(0,l)}(i)}(O);if(P.byteLength<a.workerMessageLengthLimit){if(H("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const D=function(L){for(var B=1;B<arguments.length;B++){var V=null!=arguments[B]?arguments[B]:{};B%2?DN(Object(V),!0).forEach(function(J){T(L,J,V[J])}):Object.getOwnPropertyDescriptors?Object.defineProperties(L,Object.getOwnPropertyDescriptors(V)):DN(Object(V)).forEach(function(J){Object.defineProperty(L,J,Object.getOwnPropertyDescriptor(V,J))})}return L}({},O);delete D.jpg,R.debug("[".concat(a._inspectId,"] Request message for worker of inspect content "),JSON.stringify(D))}return P}return a.quality=a.quality*a.qualityRatio,yield a.generateRequestData(i,{appId:l,cname:d,cid:h,vid:f,sid:m,uid:g})})()}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Gr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=oo.CLOSED,this.emit(ci.STATE_CHANGE,Co.CLOSED)}}function qb(s,i){switch(i){case 0:for(;128&ya(s););break;case 2:NN(s,Ty(s));break;case 5:NN(s,4);break;case 1:NN(s,8);break;default:throw new Error("Unimplemented type: "+i)}}function Jl(s){return{low:s|=0,high:s>>31,unsigned:s>=0}}let R2=[];function NN(s,i){if(s.offset+i>s.limit)throw new Error("Skip past limit");s.offset+=i}function im(s){return s.offset>=s.limit}function rm(s,i){let r=s.bytes,a=s.offset,l=s.limit,d=a+i;if(d>r.length){let h=new Uint8Array(2*d);h.set(r),s.bytes=h}return s.offset=d,d>l&&(s.limit=d),a}function PN(s,i){let r=s.offset;if(r+i>s.limit)throw new Error("Read past limit");return s.offset+=i,r}function MN(s,i){let r=rm(s,i.length);s.bytes.set(i,r)}function kN(s,i){let r=PN(s,i),a=String.fromCharCode,l=s.bytes,d="\ufffd",h="";for(let f=0;f<i;f++){let m,g,E,y,C=l[f+r];0==(128&C)?h+=a(C):192==(224&C)?f+1>=i?h+=d:(m=l[f+r+1],128!=(192&m)?h+=d:(y=(31&C)<<6|63&m,y<128?h+=d:(h+=a(y),f++))):224==(240&C)?f+2>=i?h+=d:(m=l[f+r+1],g=l[f+r+2],32896!=(49344&(m|g<<8))?h+=d:(y=(15&C)<<12|(63&m)<<6|63&g,y<2048||y>=55296&&y<=57343?h+=d:(h+=a(y),f+=2))):240==(248&C)?f+3>=i?h+=d:(m=l[f+r+1],g=l[f+r+2],E=l[f+r+3],8421504!=(12632256&(m|g<<8|E<<16))?h+=d:(y=(7&C)<<18|(63&m)<<12|(63&g)<<6|63&E,y<65536||y>1114111?h+=d:(y-=65536,h+=a(55296+(y>>10),56320+(1023&y)),f+=3))):h+=d}return h}function Ou(s,i){let r=i.length,a=0;for(let h=0;h<r;h++){let f=i.charCodeAt(h);f>=55296&&f<=56319&&h+1<r&&(f=(f<<10)+i.charCodeAt(++h)-56613888),a+=f<128?1:f<2048?2:f<65536?3:4}ni(s,a);let l=rm(s,a),d=s.bytes;for(let h=0;h<r;h++){let f=i.charCodeAt(h);f>=55296&&f<=56319&&h+1<r&&(f=(f<<10)+i.charCodeAt(++h)-56613888),f<128?d[l++]=f:(f<2048?d[l++]=f>>6&31|192:(f<65536?d[l++]=f>>12&15|224:(d[l++]=f>>18&7|240,d[l++]=f>>12&63|128),d[l++]=f>>6&63|128),d[l++]=63&f|128)}}function ya(s){return s.bytes[PN(s,1)]}function I2(s,i){let r=rm(s,1);s.bytes[r]=i}function Ty(s){let i,r=0,a=0;do{i=ya(s),r<32&&(a|=(127&i)<<r),r+=7}while(128&i);return a}function ni(s,i){for(i>>>=0;i>=128;)I2(s,127&i|128),i>>>=7;I2(s,i)}function LN(s,i){let r,a=0,l=0,d=0;return r=ya(s),a=127&r,128&r&&(r=ya(s),a|=(127&r)<<7,128&r&&(r=ya(s),a|=(127&r)<<14,128&r&&(r=ya(s),a|=(127&r)<<21,128&r&&(r=ya(s),l=127&r,128&r&&(r=ya(s),l|=(127&r)<<7,128&r&&(r=ya(s),l|=(127&r)<<14,128&r&&(r=ya(s),l|=(127&r)<<21,128&r&&(r=ya(s),d=127&r,128&r&&(r=ya(s),d|=(127&r)<<7))))))))),{low:a|l<<28,high:l>>>4|d<<24,unsigned:i}}function Xl(s,i){let r=i.low>>>0,a=(i.low>>>28|i.high<<4)>>>0,l=i.high>>>24,d=0===l?0===a?r<16384?r<128?1:2:r<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:l<128?9:10,h=rm(s,d),f=s.bytes;switch(d){case 10:f[h+9]=l>>>7&1;case 9:f[h+8]=9!==d?128|l:127&l;case 8:f[h+7]=8!==d?a>>>21|128:a>>>21&127;case 7:f[h+6]=7!==d?a>>>14|128:a>>>14&127;case 6:f[h+5]=6!==d?a>>>7|128:a>>>7&127;case 5:f[h+4]=5!==d?128|a:127&a;case 4:f[h+3]=4!==d?r>>>21|128:r>>>21&127;case 3:f[h+2]=3!==d?r>>>14|128:r>>>14&127;case 2:f[h+1]=2!==d?r>>>7|128:r>>>7&127;case 1:f[h]=1!==d?128|r:127&r}}const zb={},xN={},Yb=4294967296,FN=Yb*Yb,UN=FN/2,om=$b(0,!0),Rp=$b(0),w2=Ip(0,-2147483648,!1),by=Ip(-1,2147483647,!1),A2=Ip(-1,-1,!0);function $b(s,i){let r,a,l;return i?(l=0<=(s>>>=0)&&s<256)&&(a=xN[s],a)?a:(r=Ip(s,0,!0),l&&(xN[s]=r),r):(l=-128<=(s|=0)&&s<128)&&(a=zb[s],a)?a:(r=Ip(s,s<0?-1:0,!1),l&&(zb[s]=r),r)}function Ip(s,i,r){return{low:0|s,high:0|i,unsigned:!!r}}function D2(s,i){if(isNaN(s))return i?om:Rp;if(i){if(s<0)return om;if(s>=FN)return A2}else{if(s<=-UN)return w2;if(s+1>=UN)return by}return s<0?i?om:Rp:Ip(s%Yb|0,s/Yb|0,i)}function Ry(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}class Jb extends nn{get connectionState(){return this._connectionState}set connectionState(i){if(this._connectionState===i)return;const r=this._connectionState;this._connectionState=i,this.emit(Jo.CONNECTION_STATE_CHANGE,i,r)}get quality(){return this._quality}set quality(i){this._quality=i>1?1:i<.1?.1:i,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(i){var r;super(),T(this,"name","AgoraRTCImageModeration"),T(this,"_connectionState",so.CONNECTING),T(this,"_sequence",0),T(this,"_moderationStartTime",void 0),T(this,"_workerConnection",void 0),T(this,"_workerMessageLengthLimit",void 0),T(this,"_qualityRatio",void 0),T(this,"_connectInfo",void 0),T(this,"_cancelTokenSource",Gr.CancelToken.source()),T(this,"_retryConfig",void 0),T(this,"_moderationInterval",void 0),T(this,"_moderationTimer",null),T(this,"_moderationMode",1),T(this,"_quality",1),T(this,"_qualityTimer",null),T(this,"_ticket",void 0),T(this,"_moderationIntervalMinimum",void 0),T(this,"_uploadFailedNum",0),T(this,"_uploadNum",0),T(this,"_uploadTimer",null),T(this,"_moderationId",void 0),T(this,"inspectImage",()=>{if(this.connectionState!==so.CONNECTED)throw new K(k.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===so.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Vt(5,"image-moderation-"),this._workerMessageLengthLimit=H("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=H("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(r=i.interval)&&void 0!==r?r:1e3,this._qualityRatio=H("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new T_("worker-"+this._moderationId,Wn),this.on(Jo.STATE_CHANGE,(a,l)=>{R.debug("[".concat(this._moderationId,"] Moderation operation :").concat(cu[a]," ").concat(l||""))}),this.handleWorkerEvents()}init(i,r){var a=this;return x(function*(){a.emit(Jo.STATE_CHANGE,cu.CONNECT_AP),a._connectInfo=i;const l=a._cancelTokenSource.token;return a._retryConfig=r,new q((d,h)=>{a.on(Jo.CONNECTION_STATE_CHANGE,(f,m)=>{f===so.CONNECTED&&d()}),a.requestAP(i,l,r).then(f=>{a.connectWorker(f)}).catch(f=>{h(f)})})})()}updateConfig(i){var r;this._moderationInterval=null!==(r=i.interval)&&void 0!==r?r:1e3,R.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(i))),this.connectionState===so.CONNECTED&&this.inspectImage()}requestAP(i,r,a){var l=this;return x(function*(){const d=H("WEBCS_DOMAIN").map(g=>"https://".concat(g,"/api/v1")),h=yield function(g,E,y,C){let{appId:b,areaCode:O,cname:P,sid:D,token:L,uid:B}=E;K_++;const V="moderation_plugin",J={service_name:V,json_body:JSON.stringify({appId:b,areaCode:O,cname:P,command:"allocateEdge",requestId:K_,seq:K_,sid:D,appToken:L,ts:Date.now(),uid:B+""})};let ae,z,Q=g[0];return Ss(x(function*(){ae=Date.now();const X=yield Kc(Q,{data:J,cancelToken:y,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(z=Date.now()-ae,0!==X.code){const Se=new K(k.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+X.code,{retry:!0,responseTime:z});throw R.error(Se.toString()),Se}const te=JSON.parse(X.json_body);if(200!==te.code){const Se=new K(k.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(te.code,", reason: ").concat(te.reason),{code:te.code,responseTime:z});throw R.error(Se.toString()),Se}if(!te.servers||!Array.isArray(te.servers)||0===te.servers.length){const Se=new K(k.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:te.code,responseTime:z});throw R.error(Se.toString()),Se}if(!te.servers.some(Se=>!!Se.wss)){const Se=new K(k.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:te.code,responseTime:z});throw R.error(Se.toString()),Se}const Ce=H("IMAGE_MODERATION_WORKER_HOST");return{addressList:te.servers.map(Se=>{let{address:He,wss:ut}=Se;if(He&&ut)return"wss://".concat(He.replace(/\./g,"-"),".").concat(Ce,":").concat(ut,"/moderation")}).filter(Se=>!!Se),workerToken:te.workerToken,vid:te.vid,ticket:te.appTicket,responseTime:z}}),(X,te)=>(Te.apworkerEvent(D,{success:!0,sc:200,serviceName:V,responseDetail:JSON.stringify(X.addressList),firstSuccess:0===te,responseTime:z,serverIp:g[te%g.length]}),!1),(X,te)=>(Te.apworkerEvent(D,{success:!1,sc:X.data&&X.data.code||200,serviceName:V,responseTime:z,serverIp:g[te%g.length]}),!!(X.code!==k.OPERATION_ABORTED&&X.code!==k.UNEXPECTED_RESPONSE||X.data&&X.data.retry)&&(Q=g[(te+1)%g.length],!0)),C)}(d,i,r,a);l.emit(Jo.STATE_CHANGE,cu.AP_CONNECTED);const{addressList:f,ticket:m}=h;return l._ticket=m,f})()}connectWorker(i){var r=this;return x(function*(){r.emit(Jo.STATE_CHANGE,cu.CONNECT_WORKER),yield r._workerConnection.init(i,1e4)})()}handleWorkerEvents(){var i=this;this._workerConnection.on(Ne.CONNECTED,x(function*(){i.emit(Jo.STATE_CHANGE,cu.WORKER_CONNECTED,i._workerConnection.url),i.connectionState=so.CONNECTED})),this._workerConnection.on(Ne.CLOSED,()=>{this.connectionState=so.CLOSED}),this._workerConnection.on(Ne.FAILED,()=>{this.connectionState=so.CLOSED}),this._workerConnection.on(Ne.RECONNECTING,()=>{this.connectionState=this.connectionState===so.CONNECTED?so.RECONNECTING:so.CONNECTING}),this._workerConnection.on(Ne.ON_MESSAGE,function(){var r=x(function*(a){if(a.data instanceof ArrayBuffer){const l=function(s){return function(r){let a={};e:for(;!im(r);){let l=Ty(r);switch(l>>>3){case 0:break e;case 1:a.code=Ty(r);break;case 2:a.msg=kN(r,Ty(r));break;case 3:a.requestId=kN(r,Ty(r));break;case 4:a.timestamp=LN(r,!1);break;default:qb(r,7&l)}}return a}({bytes:i=s,offset:0,limit:i.length});var i}(new Uint8Array(a.data));H("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("[".concat(i._moderationId,"] Response message for worker of image moderation "),JSON.stringify(l)),i._uploadNum++,void 0===l.code||0===l.code||(i._uploadFailedNum++,R.error("[".concat(i._moderationId,"] Error response from worke, code is ").concat(l.code,", msg is ").concat(l.msg)),i._uploadTimer||(i._uploadTimer=window.setTimeout(()=>{Te.reportApiInvoke(i._connectInfo.sid||null,{name:jn.IMAGE_MODERATION_UPLOAD,options:[i._uploadFailedNum,i._uploadNum,l.code],tag:Kt.TRACER}).onError(new K(k.IMAGE_MODERATION_UPLOAD_FAILED,l.msg)),i._uploadTimer=null},H("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else R.error("[".concat(i._moderationId,"] Unexpected message type from worker"))});return function(a){return r.apply(this,arguments)}}()),this._workerConnection.on(Ne.WILL_RECONNECT,(r,a,l)=>{"recover"===r&&l(r),l("tryNext")}),this._workerConnection.on(Ne.REQUEST_NEW_URLS,(r,a)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(a)})}static intToLong(i){return{low:i|=0,high:i>>31,unsigned:i>=0}}requestToInspectImage(){var i=this;return x(function*(){const r=ro(i,Jo.CLIENT_LOCAL_VIDEO_TRACK),a={appId:i._connectInfo.appId,cname:i._connectInfo.cname,cid:i._connectInfo.cid,sid:i._connectInfo.sid,uid:i._connectInfo.uid,vid:i._connectInfo.vid};if(r){if(!r.isPlaying)return void(H("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being played can be inspected"));i._sequence++;const l=yield i.generateRequestData(r,a);i._workerConnection.sendMessage(l,!0,!0)}else H("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being published can be inspected")})()}generateRequestData(i,r){var a=this;return x(function*(){let{appId:l,cname:d,cid:h,vid:f,sid:m,uid:g}=r;const E=Date.now(),y=yield i.getCurrentFrameImage("image/jpeg",a.quality),C=yield lO(y,l,d),b=a._sequence+"-"+h+"-"+g+"-"+E+"-"+Vt(12,""),O={appId:l,cid:h,cname:d,deviceId:"",elapse:Jb.intToLong(Number(E-a._moderationStartTime)),fileSize:y.buffer.byteLength,height:y.height,width:y.width,jpg:C,networkType:6,osType:7,requestId:b,sdkVersion:"4.19.1",sequence:a._sequence,sid:m,timestamp:D2(E),uid:g,vid:f,service:a._moderationMode,ticket:a._ticket},P=function(s){let i=function(){const r=R2.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(r,a){let l=r.appId;void 0!==l&&(ni(a,10),Ou(a,l));let d=r.cid;void 0!==d&&(ni(a,16),ni(a,d));let h=r.cname;void 0!==h&&(ni(a,26),Ou(a,h));let f=r.deviceId;void 0!==f&&(ni(a,34),Ou(a,f));let m=r.elapse;void 0!==m&&(ni(a,40),Xl(a,m));let g=r.fileSize;void 0!==g&&(ni(a,48),Xl(a,Jl(g)));let E=r.height;void 0!==E&&(ni(a,56),Xl(a,Jl(E)));let y=r.jpg;void 0!==y&&(ni(a,66),ni(a,y.length),MN(a,y));let C=r.networkType;void 0!==C&&(ni(a,72),Xl(a,Jl(C)));let b=r.osType;void 0!==b&&(ni(a,80),Xl(a,Jl(b)));let O=r.requestId;void 0!==O&&(ni(a,90),Ou(a,O));let P=r.sdkVersion;void 0!==P&&(ni(a,98),Ou(a,P));let D=r.sequence;void 0!==D&&(ni(a,104),Xl(a,Jl(D)));let L=r.sid;void 0!==L&&(ni(a,114),Ou(a,L));let B=r.timestamp;void 0!==B&&(ni(a,120),Xl(a,B));let V=r.uid;void 0!==V&&(ni(a,128),ni(a,V));let J=r.vid;void 0!==J&&(ni(a,136),ni(a,J));let ae=r.width;void 0!==ae&&(ni(a,144),Xl(a,Jl(ae)));let z=r.service;void 0!==z&&(ni(a,152),ni(a,z));let Q=r.callbackData;void 0!==Q&&(ni(a,162),ni(a,Q.length),MN(a,Q));let X=r.ticket;void 0!==X&&(ni(a,170),Ou(a,X))}(s,i),function(r){let a=r.bytes,l=r.limit;return a.length===l?a:a.subarray(0,l)}(i)}(O);if(P.byteLength<a._workerMessageLengthLimit){if(H("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const D=function(L){for(var B=1;B<arguments.length;B++){var V=null!=arguments[B]?arguments[B]:{};B%2?Ry(Object(V),!0).forEach(function(J){T(L,J,V[J])}):Object.getOwnPropertyDescriptors?Object.defineProperties(L,Object.getOwnPropertyDescriptors(V)):Ry(Object(V)).forEach(function(J){Object.defineProperty(L,J,Object.getOwnPropertyDescriptor(V,J))})}return L}({},O);delete D.jpg,R.debug("[".concat(a._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(D))}return P}return a.quality=a.quality*a._qualityRatio,yield a.generateRequestData(i,{appId:l,cname:d,cid:h,vid:f,sid:m,uid:g})})()}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Gr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=so.CLOSED,this.emit(Jo.STATE_CHANGE,cu.CLOSED)}}function VN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Iy(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?VN(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):VN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class Mr extends ND{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var i,r;return null!==(i=null===(r=this.peerConnection.getReceivers()[0])||void 0===r||null===(r=r.transport)||void 0===r?void 0:r.state)&&void 0!==i?i:null}constructor(i,r,a){super(i,r),T(this,"direction",void 0),T(this,"store",void 0),T(this,"peerConnection",void 0),T(this,"transportEventReceiver",void 0),T(this,"statsFilter",void 0),T(this,"localCandidateCount",0),T(this,"allCandidatesReceived",!1),T(this,"mutex",new Gn("P2PConnection-mutex")),T(this,"dataChannel",void 0),T(this,"onLocalCandidate",void 0),this.store=r,this.peerConnection=new RTCPeerConnection(Mr.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.direction=null!=a?a:Qh.SEND_ONLY,this.dataChannel=this.peerConnection.createDataChannel("agora-p2p-signal",{ordered:!0}),this.statsFilter=_y(this.peerConnection,H("STATS_UPDATE_INTERVAL"),void 0,Pt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}establish(i){var r=this;return x(function*(){try{if(i){yield r.peerConnection.setRemoteDescription({type:"offer",sdp:i});const a=yield r.peerConnection.createAnswer();if(yield r.peerConnection.setLocalDescription(a),!a.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");return a.sdp}{const a=yield r.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");return yield r.peerConnection.setLocalDescription(a),a.sdp}}catch(a){throw new ne(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}})()}connect(i){var r=this;return x(function*(){try{yield r.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(a){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(a.toString()))}})()}addRemoteCandidate(i){var r=this;return x(function*(){try{yield r.peerConnection.addIceCandidate(i)}catch(a){throw new ne(k.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(a.toString()))}})()}send(i){var r=this;return x(function*(){try{const a=[];i.forEach(h=>{const f=r.peerConnection.addTransceiver(h._mediaStreamTrack,{direction:"sendonly"});a.push(f)}),Pt()&&!0===H("SIMULCAST")&&(yield r.applySimulcastForFirefox(a,i)),yield r.applySimulcastEncodings(a,i),yield r.applySendEncodings(a,i);const l=yield r.peerConnection.createOffer();if(yield r.peerConnection.setLocalDescription(l),!l.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");const d=a.map(h=>{const f=r.getLocalSSRC(h.mid,l.sdp);if(!f)throw new Error("Cannot get ssrc when trying to send PeerConnection.");return{mid:h.mid,localSSRC:[{ssrcId:f}]}});return{sdp:l.sdp,trackMessage:d}}catch(a){throw a instanceof ne?a:new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}})()}stopSending(i,r){var a=this;return x(function*(){const l=r?void 0:yield a.mutex.lock("From P2PConnection.stopSending");try{const d=a.peerConnection.getTransceivers().filter(f=>-1!==i.indexOf(f.mid));if(d.length!==i.length)throw new Error("Transceivers' length (".concat(d.length,") doesn't match mids' length (").concat(i.length,") when trying to call P2PConnection.stopSending."));d.map(f=>{var m;f.direction="inactive",null===(m=f.stop)||void 0===m||m.call(f),a.peerConnection.removeTrack(f.sender)});const h=yield a.peerConnection.createOffer();if(yield a.peerConnection.setLocalDescription(h),!h.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");return h.sdp}catch(d){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(d.toString()))}finally{l&&l()}})()}receive(i,r,a){var l=this;return x(function*(){try{yield l.peerConnection.setRemoteDescription({type:"offer",sdp:r});const d=yield l.peerConnection.createAnswer();if(!d.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");yield l.peerConnection.setLocalDescription(d),R.debug("[".concat(l.store.clientId,"] [P2PConnection] receive ").concat(i," by exchanging SDP."));const h=l.getRemoteMid(a,r);if(void 0===h)throw new Error("Cannot get transceiver mid when trying to receive track.");const f=l.peerConnection.getTransceivers().find(m=>m.mid===h);if(!f||null===f.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:f.receiver.track,mid:f.mid,sdp:d.sdp}}catch(d){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}})()}setDescription(i,r){var a=this;return x(function*(){try{if("remote"===i){yield a.peerConnection.setRemoteDescription({type:"offer",sdp:r});const l=yield a.peerConnection.createAnswer();if(!l.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return yield a.peerConnection.setLocalDescription(l),R.debug("[".concat(a.store.clientId,"] [P2PConnection] exchanging SDP, type is ").concat(i)),l.sdp}yield a.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(l){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.setDescription failed; ".concat(l.toString()))}})()}stopReceiving(i,r){var a=this;return x(function*(){try{const l=a.peerConnection.getTransceivers().filter(h=>-1!==i.indexOf(h.mid));if(l.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");l.map(h=>{var f;h.direction="inactive",null===(f=h.stop)||void 0===f||f.call(h)}),yield a.peerConnection.setRemoteDescription({type:"offer",sdp:r});const d=yield a.peerConnection.createAnswer();if(yield a.peerConnection.setLocalDescription(d),!d.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return d.sdp}catch(l){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(l.toString()))}})()}restartICE(){var i=this;return x(function*(){try{const r=yield i.peerConnection.createOffer({iceRestart:!0});if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");return i.store.descriptionStart(),yield i.peerConnection.setLocalDescription(r),r.sdp}catch(r){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}})()}close(){var i;this.peerConnection.close(),null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}updateEncoderConfig(i,r){return x(function*(){})()}updateSendParameters(i,r){var a=this;return x(function*(){const l=a.peerConnection.getTransceivers().filter(d=>d.mid===i);1===l.length&&(a.isVP8Simulcast(r)?Pt()||(yield a.applySimulcastEncodings(l,[r])):yield a.applySendEncodings(l,[r]))})()}setStatsRemoteVideoIsReady(i,r){this.statsFilter.setVideoIsReady2(i,r)}replaceTrack(i,r){var a=this;return x(function*(){const l=a.peerConnection.getTransceivers().find(d=>d.mid===r);l&&(yield l.sender.replaceTrack(i._mediaStreamTrack))})()}getSelectedCandidatePair(){var i=this;return x(function*(){const r=i.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const a=r[0].transport.iceTransport,{local:l,remote:d}=a.getSelectedCandidatePair();return{local:Iy(Iy({},Tr),{},{candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port}),remote:Iy(Iy({},Tr),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})}}return i.statsFilter.getSelectedCandidatePair()})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;null===(i=this.onICEConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{var r;i.candidate&&(null===(r=this.onLocalCandidate)||void 0===r||r.call(this,i.candidate)),i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},H("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const r={iceServers:[]};return i.iceServers?r.iceServers=i.iceServers:i.turnServer&&"off"!==i.turnServer.mode&&(Qd(i.turnServer.servers)?r.iceServers=i.turnServer.servers:(r.iceServers&&r.iceServers.push(...Mr.turnServerConfigToIceServers(i.turnServer.servers)),H("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&i.turnServer.serversFromGateway&&r.iceServers.push(...Mr.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),H("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),H("ENABLE_ENCODED_TRANSFORM")&&Rt().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(i){const r=[];return i.forEach(a=>{a.tcpport&&(r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(H_(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}),r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=udp")}),r.push({username:a.username,credential:a.password,credentialType:"password",urls:"stun:".concat(a.turnServerURL,":").concat(a.tcpport)}))}),r}tryBindTransportEvents(i){const r=i.transport;if(r){this.transportEventReceiver=i,r.onstatechange=()=>{var l;null!=r&&r.state&&(null===(l=this.onDTLSTransportStateChange)||void 0===l||l.call(this,r.state))},r.onerror=l=>{var d;null===(d=this.onDTLSTransportError)||void 0===d||d.call(this,"error"in l?l.error:l)};const a=r.iceTransport;a&&(a.onstatechange=()=>{const l=null==r?void 0:r.iceTransport.state;var d;l&&(null===(d=this.onICETransportStateChange)||void 0===d||d.call(this,l))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){const{local:l,remote:d}=a.getSelectedCandidatePair();R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:l.type,protocol:l.protocol}),", remote ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(i,r){var a=this;return x(function*(){var l;if(r||(r=a.peerConnection.getSenders().find(y=>y.track===i._mediaStreamTrack)),!r)return R.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(a.isVP8Simulcast(i))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Rt().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(i._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(i._encoderConfig){var f;const{bitrateMax:y,frameRate:C,scaleResolutionDownBy:b}=i._encoderConfig;y&&(h.maxBitrate=1e3*y),we(f=i._hints).call(f,Qt.LOW_STREAM)&&(C&&(h.maxFramerate=To(C)),b&&b>=1&&(h.scaleResolutionDownBy=b))}if(H("DSCP_TYPE")&&Il()){var m;const y=H("DSCP_TYPE");we(m=["very-low","low","medium","high"]).call(m,y)&&(h.networkPriority=y)}const g=r.getParameters(),E=null===(l=g.encodings)||void 0===l?void 0:l[0];Pt()&&!E&&(d.encodings=[h]),E&&Object.assign(E,h),Object.assign(g,d),R.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),yield r.setParameters(g)})()}applySendEncodings(i,r){var a=this;return x(function*(){try{if(!Rt().supportSetRtpSenderParameters||i.length!==r.length)return;for(let l=0;l<i.length;l++){const d=i[l],h=r[l];h instanceof Ye&&!a.isVP8Simulcast(h)&&(yield a.updateRtpSenderEncodings(h,d.sender))}}catch(l){R.debug("[".concat(a.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(i,r,a){const l=mn.parse(i);return r.forEach((d,h)=>{const f=a[h],m=l.mediaDescriptions.find(g=>g.attributes.mid===f);m&&(zl(m,d),J_(m,d,this.store.codec))}),mn.print(l)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,r,a)=>{var l;null===(l=this.onFirstVideoDecoded)||void 0===l||l.call(this,i,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var r;null===(r=this.onFirstVideoDecodedTimeout)||void 0===r||r.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(i,r){var a=this;return x(function*(){if(i.length===r.length)for(let g=0;g<i.length;g++){var l,d,h,f,m;const E=i[g],y=r[g];if(y instanceof Ye&&!we(l=y._hints).call(l,Qt.LOW_STREAM)&&null!==(d=y._encoderConfig)&&void 0!==d&&d.bitrateMax&&(null===(h=y._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(f=y._scalabilityMode)&&void 0!==f&&f.numSpatialLayers&&(null===(m=y._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===a.store.codec){const C={},b={high:1e3*(y._encoderConfig.bitrateMax-50),medium:5e4};C.encodings=[{rid:"m",active:!0,maxBitrate:b.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:b.high}];const O=E.sender.getParameters();yield E.sender.setParameters(Object.assign(O,C))}}})()}applySimulcastEncodings(i,r){var a=this;return x(function*(){if(!Pt()&&i.length===r.length)for(let l=0;l<i.length;l++){const d=r[l];if(d instanceof Ye&&a.isVP8Simulcast(d)){const h=i[l],f={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=h.sender.getParameters();yield h.sender.setParameters(Object.assign(g,f))}}})()}isVP8Simulcast(i){var r,a,l,d,h;return!!(i instanceof Ye&&H("SIMULCAST")&&"vp8"===this.store.codec&&!we(r=i._hints).call(r,Qt.LOW_STREAM)&&null!==(a=i._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(l=i._encoderConfig)||void 0===l?void 0:l.bitrateMax)>200&&null!==(d=i._scalabilityMode)&&void 0!==d&&d.numSpatialLayers&&(null===(h=i._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(i,r,a,l){if(H("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(r," SDP during P2PConnection.").concat(l,"\n"),i),"offer"===r?d=>{this.logSDPExchange(d,"answer","local"===a?"remote":"local",l)}:void 0}getLocalSSRC(i,r){var a,l;if(r=null!==(a=r)&&void 0!==a?a:null===(l=this.currentLocalDescription)||void 0===l?void 0:l.sdp){var d;const h=null===(d=mn.parse(r).mediaDescriptions.find(f=>f.attributes.mid===i))||void 0===d?void 0:d.attributes.ssrcs;return null==h?void 0:h[0].ssrcId}}getRemoteMid(i,r){var a,l,d;if(r=null!==(a=r)&&void 0!==a?a:null===(l=this.currentRemoteDescription)||void 0===l?void 0:l.sdp)return null===(d=mn.parse(r).mediaDescriptions.find(h=>h.attributes.ssrcs.some(f=>f.ssrcId===i)))||void 0===d?void 0:d.attributes.mid}getRemoteSSRC(i,r){var a=this;return x(function*(){var l,d;if(r=null!==(l=r)&&void 0!==l?l:null===(d=a.currentRemoteDescription)||void 0===d?void 0:d.sdp){var h;const f=null===(h=mn.parse(r).mediaDescriptions.find(m=>m.attributes.mid===i))||void 0===h?void 0:h.attributes.ssrcs;return null==f?void 0:f[0].ssrcId}})()}}function va(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=x(function*(){const l=this.mutex,d=yield l.lock("From P2PConnection.".concat(i));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return yield a.apply(this,f)}finally{d()}}),r}var Xr;function O2(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Ql(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?O2(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):O2(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}oe([va,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Mr.prototype,"establish",null),oe([va,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Mr.prototype,"connect",null),oe([va,N("design:type",Function),N("design:paramtypes",[RTCIceCandidate]),N("design:returntype",q)],Mr.prototype,"addRemoteCandidate",null),oe([va,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],Mr.prototype,"send",null),oe([va,N("design:type",Function),N("design:paramtypes",[String,String,Number]),N("design:returntype",q)],Mr.prototype,"receive",null),oe([va,N("design:type",Function),N("design:paramtypes",[String,String]),N("design:returntype",q)],Mr.prototype,"setDescription",null),oe([va,N("design:type",Function),N("design:paramtypes",[Array,String]),N("design:returntype",q)],Mr.prototype,"stopReceiving",null),oe([va,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",q)],Mr.prototype,"restartICE",null),oe([va,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Mr.prototype,"close",null),oe([va,N("design:type",Function),N("design:paramtypes",[String,jt]),N("design:returntype",q)],Mr.prototype,"updateEncoderConfig",null),oe([va,N("design:type",Function),N("design:paramtypes",[String,jt]),N("design:returntype",q)],Mr.prototype,"updateSendParameters",null),oe([va,N("design:type",Function),N("design:paramtypes",[jt,String]),N("design:returntype",q)],Mr.prototype,"replaceTrack",null),function(s){s.SEND_ONLY="SEND_ONLY",s.RECEIVE_ONLY="RECEIVE_ONLY"}(Xr||(Xr={}));class In extends nn{get state(){return this._state}set state(i){const r=this._state;this._state=i,this.emit(Re.StateChange,r,this._state)}constructor(i,r){var a;super(),a=this,T(this,"store",void 0),T(this,"statsUploader",void 0),T(this,"sendConnection",void 0),T(this,"recvConnection",void 0),T(this,"localTrackMap",new Map),T(this,"remoteUserMap",new Map),T(this,"localDataChannels",[]),T(this,"pendingLocalTracks",[]),T(this,"pendingRemoteTracks",[]),T(this,"statsCollector",void 0),T(this,"dtlsFailedCount",0),T(this,"sendMutex",new Gn("P2PChannel2-send-mutex")),T(this,"recvMutex",new Gn("P2PChannel2-recv-mutex")),T(this,"_state",rt.Disconnected),T(this,"_restartStates",["disconnected","failed"]),T(this,"_restartTimer",void 0),T(this,"handleMuteLocalTrack",function(){var l=x(function*(d,h,f){const m=yield a.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!a.sendConnection||a.state!==rt.Connected)return void f(new ne(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const y=a.filterTobeMutedTracks(d);if(0===y.length)return void h();const C=y.find(V=>"videoLowTrack"===V[0]);C&&C[1].track._originMediaStreamTrack.stop();let b=!1;var g,E;b="video"===d.trackMediaType?!(null===(g=a.localTrackMap.get(se.LocalAudioTrack))||void 0===g||!g.track._muted):void 0===(null===(E=a.localTrackMap.get(se.LocalVideoTrack))||void 0===E?void 0:E.id);const O=y.filter(V=>{let[J,ae]=V;return(J!==se.LocalAudioTrack||b)&&void 0!==ae.id}).map(V=>{let[,J]=V;return J});let P;O.length>0&&(P=yield a.sendConnection.stopSending(O.map(V=>V.id)),O.forEach(V=>{V.id=void 0,V.ssrcs=void 0}));const D=a.createMuteMessage(y),L="video"===d.trackMediaType?Mc.MUTE_LOCAL_VIDEO:Mc.MUTE_LOCAL_AUDIO,B=yield vn(a,Re.RequestP2PMuteLocal,{action:L,sdp:P,message:D,isMuteAll:b});B&&(yield a.sendConnection.setDescription("local",B)),(P||"audio"===d.trackMediaType)&&(yield Ht(a,Re.RequestMuteLocal,D)),h()}catch(y){f(y)}finally{m()}});return function(d,h,f){return l.apply(this,arguments)}}()),T(this,"handleUnmuteLocalTrack",function(){var l=x(function*(d,h,f){const m=yield a.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!a.sendConnection||a.state!==rt.Connected)return void f(new ne(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const g=a.filterTobeUnmutedTracks(d);if(0===g.length)return void h();const E=a.createUnmuteMessage(g),y="video"===d.trackMediaType?Mc.UNMUTE_LOCAL_VIDEO:Mc.UNMUTE_LOCAL_AUDIO;yield Ht(a,Re.RequestP2PMuteLocal,{action:y,message:E}),h()}catch(g){f(g)}finally{m()}});return function(d,h,f){return l.apply(this,arguments)}}()),T(this,"handleUpdateVideoEncoder",function(){var l=x(function*(d,h,f){const m=yield a.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const g=a.localTrackMap.get(se.LocalVideoTrack);if(!a.sendConnection||!g||g.track!==d||a.state!==rt.Connected)return void h();const{id:E,track:y}=g;E&&(yield a.sendConnection.updateSendParameters(E,y),yield a.sendConnection.updateEncoderConfig(E,y),a.emit(Re.UpdateVideoEncoder,y)),h()}catch(g){f(g)}finally{m()}});return function(d,h,f){return l.apply(this,arguments)}}()),T(this,"handleSetOptimizationMode",function(){var l=x(function*(d,h,f){const m=yield a.sendMutex.lock("Locking from P2PChannel2.handleSetOptimizationMode");try{const g=a.localTrackMap.get(se.LocalVideoTrack);if(!a.sendConnection||!g||g.track!==d||a.state!==rt.Connected)return;const{id:E,track:y}=g;E&&(yield a.sendConnection.updateSendParameters(E,y)),h()}catch(g){f(g)}finally{m()}});return function(d,h,f){return l.apply(this,arguments)}}()),T(this,"handleReplaceTrack",function(){var l=x(function*(d,h,f,m){let g;R.debug("[".concat(a.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(d.getTrackId(),"]")),"boolean"==typeof m&&m||(g=yield a.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var E;const C=Array.from(a.localTrackMap.entries()).find(b=>{let[,{track:O}]=b;return d===O});if(!a.sendConnection||!C||void 0===C[1].id||a.state!==rt.Connected)return void h();if(yield null===(E=a.sendConnection)||void 0===E?void 0:E.replaceTrack(d,C[1].id),C[0]===se.LocalVideoTrack&&Rt().supportDualStreamEncoding){const b=a.localTrackMap.get(se.LocalVideoLowTrack);if(b){const O=d._mediaStreamTrack.clone();b.track._originMediaStreamTrack.stop(),b.track._mediaStreamTrack=O,b.track._originMediaStreamTrack=O,yield new q((P,D)=>{a.handleReplaceTrack(b.track,P,D,!0)})}}h()}catch(C){f(C)}finally{var y;null===(y=g)||void 0===y||y()}});return function(d,h,f,m){return l.apply(this,arguments)}}()),T(this,"handleGetLocalVideoStats",l=>{l(this.statsCollector.getLocalVideoTrackStats())}),T(this,"handleGetLocalAudioStats",l=>{l(this.statsCollector.getLocalAudioTrackStats())}),T(this,"handleGetRemoteVideoStats",l=>this.statsCollector.getRemoteVideoTrackStats(l.uid)[l.uid]),T(this,"handleGetRemoteAudioStats",l=>this.statsCollector.getRemoteAudioTrackStats(l.uid)[l.uid]),this.store=i,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new vN,this.bindStatsUploaderEvents()}startP2PConnection(i,r){return x(function*(){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")})()}connect(i,r,a,l,d,h){return x(function*(){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support connect.")})()}startP2P(i,r){var a=this;return x(function*(){if(a.state=rt.New,a.sendConnection&&(R.warning("[".concat(a.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),a.sendConnection.close(),a.unbindConnectionEvents(a.sendConnection)),a.recvConnection&&(R.warning("[".concat(a.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),a.recvConnection.close(),a.unbindConnectionEvents(a.recvConnection)),a.sendConnection=new Mr(i,a.store),a.bindConnectionEvents(a.sendConnection),a.recvConnection=new Mr(i,a.store,Qh.RECEIVE_ONLY),a.bindConnectionEvents(a.recvConnection),r){a.store.peerConnectionStart(),yield a.recvConnection.establish(r);const l=yield a.sendConnection.establish(r);return a.statsUploader.startUploadTransportStats(!0),a.statsUploader.startUploadExtensionUsageStats(),a.state=rt.Connected,l}return yield a.recvConnection.establish(r),a.sendConnection.establish(r)})()}p2pConnect(i){var r=this;return x(function*(){if(!r.sendConnection||!r.recvConnection)throw new ne(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.startP2PConnection .");r.store.peerConnectionStart(),yield r.recvConnection.connect(i),yield r.sendConnection.connect(i),r.statsUploader.startUploadTransportStats(),r.statsUploader.startUploadExtensionUsageStats(),r.state=rt.Connected})()}addRemoteCandidate(i){var r=this;return x(function*(){if(!r.sendConnection||!r.recvConnection)throw new ne(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");yield r.recvConnection.addRemoteCandidate(i),yield r.sendConnection.addRemoteCandidate(i)})()}publish(i,r,a){var l=this;return x(function*(){if(!l.sendConnection||l.state!==rt.Connected){l.throwIfTrackTypeNotMatch(i);const f=i.filter(m=>-1===l.pendingLocalTracks.indexOf(m));return void(l.pendingLocalTracks=l.pendingLocalTracks.concat(f))}l.store.pubId=l.store.pubId+1,Ni.markPublishStart(l.store.clientId,l.store.pubId);const d=l.filterTobePublishedTracks(i,r,a);if(0===d.length)return void(yield l.tryToUnmuteAudio(i));d.forEach(f=>{let{track:m,type:g}=f;const E=Date.now();l.store.publish(m.getTrackId(),g===se.LocalAudioTrack?"audio":"video",E)}),l.bindLocalTrackEvents(d);const h=l.createGatewayPublishMessage(d);return l.assignLocalTracks(d),d.forEach(f=>{let{track:m,type:g}=f;const E=Date.now();l.store.publish(m.getTrackId(),g===se.LocalAudioTrack?"audio":"video",void 0,E)}),h})()}dopublish(i){var r=this;return x(function*(){if(!r.sendConnection||r.state!==rt.Connected)return;const a=r.localTrackMap.get(i);if(a){const{sdp:l,trackMessage:d}=yield r.sendConnection.send([a.track]),{mid:h,localSSRC:f}=d[0];a.id=h,a.ssrcs=f,r.statsCollector.addLocalStats(i),r.statsUploader.startUploadUplinkStats();const m=yield vn(r,Re.RequestP2PPublish,{kind:i===se.LocalAudioTrack?ye.AUDIO:ye.VIDEO,sdp:l,ssrcId:f[0].ssrcId});yield r.sendConnection.setDescription("local",m);const g=r.createUnmuteMessage([[i,a]]);yield Ht(r,Re.RequestUnmuteLocal,g)}})()}setDescription(i,r){var a=this;return x(function*(){let l,d;"local"===i?(l=yield a.sendMutex.lock("From P2PChannel.restartICE"),d=a.sendConnection):(l=yield a.recvMutex.lock("From P2PChannel.restartICE"),d=a.recvConnection);try{return d&&a.state===rt.Connected?yield d.setDescription(i,r):void 0}finally{l()}})()}publishLowStream(i){return is(function*(){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}republish(){var i=this;return x(function*(){i.pendingLocalTracks.length>0&&(R.debug("[".concat(i.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield vn(i,Re.RequestRePublish,i.pendingLocalTracks),i.emit(Re.MediaReconnectEnd,i.store.uid),i.pendingLocalTracks=[])})()}unpublish(i){var r=this;return x(function*(){if(!r.sendConnection||r.state!==rt.Connected)return void(0===i.length?r.pendingLocalTracks.length=0:r.pendingLocalTracks=r.pendingLocalTracks.filter(g=>!we(i).call(i,g)));const a=r.filterTobeUnpublishedTracks(i);if(0===a.length)return;r.unbindLocalTrackEvents(a.map(g=>{let[E,{track:y}]=g;return{type:E,track:y}}));const l=a.filter(g=>{let[,{id:E}]=g;return void 0!==E});if(!r.sendConnection||r.state!==rt.Connected)return void i.forEach(g=>{const E=r.pendingLocalTracks.indexOf(g);-1!==E&&r.pendingLocalTracks.splice(E,1)});const d=a.find(g=>"videoLowTrack"===g[0]);let h;d&&d[1].track.close();const f=r.createGatewayUnpublishMessage(a);l.length>0&&(h=yield r.sendConnection.stopSending(l.map(g=>{let[,{id:E}]=g;return E}))),r.withdrawLocalTracks(a),r.unbindLocalTrackEvents(a.map(g=>{let[E,{track:y}]=g;return{type:E,track:y}})),a.forEach(g=>{let[E]=g;r.statsCollector.removeLocalStats(E)}),0===r.localTrackMap.size&&r.statsUploader.stopUploadUplinkStats();const m=r.createMuteMessage(a);return yield q.all(m.map(function(){var g=x(function*(E){yield Ht(r,Re.RequestMuteLocal,[E])});return function(E){return g.apply(this,arguments)}}())),{sdp:h,unpubMsg:f}})()}unpublishLowStream(){return x(function*(){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")})()}doUnpublish(i){var r=this;return x(function*(){if(!r.sendConnection||r.state!==rt.Connected)return;const a=[];if(i!==ye.AUDIO){const l=r.localTrackMap.get(se.LocalVideoTrack);void 0!==(null==l?void 0:l.id)&&a.push([se.LocalVideoTrack,l]);const d=r.localTrackMap.get(se.LocalVideoLowTrack);void 0!==(null==d?void 0:d.id)&&a.push([se.LocalVideoLowTrack,d]),r.statsCollector.removeLocalStats(se.LocalVideoTrack),r.statsCollector.removeLocalStats(se.LocalVideoLowTrack)}if(i!==ye.VIDEO){const l=r.localTrackMap.get(se.LocalAudioTrack);void 0!==(null==l?void 0:l.id)&&a.push([se.LocalAudioTrack,l]),r.statsCollector.removeLocalStats(se.LocalAudioTrack)}if(a.length>0){const l=yield r.sendConnection.stopSending(a.map(f=>{let[,m]=f;return m.id}));a.forEach(f=>{let[,m]=f;m.id=void 0,m.ssrcs=void 0});const d=yield vn(r,Re.RequestP2PUnPublish,{sdp:l,kind:i});yield r.sendConnection.setDescription("local",d);const h=r.createMuteMessage(a);yield q.all(h.map(function(){var f=x(function*(m){yield Ht(r,Re.RequestMuteLocal,[m])});return function(m){return f.apply(this,arguments)}}()))}})()}subscribe(i,r,a,l){var d=this;return x(function*(){var h;if(!d.recvConnection||d.state!==rt.Connected)throw new ne(k.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(h=d.remoteUserMap.get(i))&&void 0!==h&&h.has(r))return;const{track:f,mid:m,sdp:g}=yield d.recvConnection.receive(r,a,l);r===ye.AUDIO?(i._audioSSRC=l,i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(f):(i._audioTrack=new Ns(f,i.uid,i._uintid,d.store),R.info("[".concat(d.store.clientId,"] [").concat(d.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),d.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoSSRC=l,i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(f):(i._videoTrack=new xc(f,i.uid,i._uintid,d.store),R.info("[".concat(d.store.clientId,"] [").concat(d.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),d.bindRemoteTrackEvents(i,i._videoTrack));const E=d.remoteUserMap.get(i);E?E.set(r,m):d.remoteUserMap.set(i,new Map([[r,m]])),d.statsCollector.addRemoteStats(i.uid),d.statsUploader.startUploadDownlinkStats(),yield Ht(d,Re.RequestP2PUnmuteRemote,r);const y=d.pendingRemoteTracks.findIndex(C=>{let{user:b,kind:O}=C;return b.uid===i.uid&&r===O});return-1!==y&&(d.pendingRemoteTracks.splice(y,1),d.emit(Re.MediaReconnectEnd,i.uid)),g})()}unsubscribe(i,r,a,l){var d=this;return x(function*(){const h=d.pendingRemoteTracks.filter(g=>{let{user:E,kind:y}=g;return void 0!==a?E.uid===i.uid&&a===y:E.uid===i.uid});if(h.forEach(g=>{const E=d.pendingRemoteTracks.indexOf(g);d.pendingRemoteTracks.splice(E,1)}),d.recvConnection&&d.state===rt.Connected||l||h.forEach(g=>{let{kind:E}=g;var y;if(E===ye.AUDIO)null===(y=i._audioTrack)||void 0===y||y._destroy(),i._audioTrack=void 0;else if(E===ye.VIDEO){var C;null===(C=i._videoTrack)||void 0===C||C._destroy(),i._videoTrack=void 0}}),!d.recvConnection||d.state!==rt.Connected)return;const f=d.filterTobeUnSubscribedTracks(i,a);if(0===f.length)return void(a!==ye.VIDEO&&Ht(d,Re.RequestP2PMuteRemote,ye.AUDIO));const m=yield d.recvConnection.stopReceiving(f.map(g=>{let[,{id:E}]=g;return E}),r);return d.withdrawRemoteTracks(f),0===d.remoteUserMap.size&&d.statsUploader.stopUploadDownlinkStats(),f.forEach(g=>{let[E,{kind:y}]=g;var C,b;if(y===ye.VIDEO&&E._videoSSRC&&(null===(C=d.recvConnection)||void 0===C||C.setStatsRemoteVideoIsReady(E._videoSSRC,!1)),y===ye.VIDEO)d.unbindRemoteTrackEvents(E._videoTrack),l||(null===(b=E._videoTrack)||void 0===b||b._destroy(),E._videoTrack=void 0);else if(y===ye.AUDIO){var O;d.unbindRemoteTrackEvents(E._audioTrack),!l&&(null===(O=E._audioTrack)||void 0===O||O._destroy(),E._audioTrack=void 0)}}),f.filter(g=>{let[,{kind:E}]=g;return E!==ye.AUDIO}).forEach(g=>{let[,{kind:E}]=g;Ht(d,Re.RequestP2PMuteRemote,E)}),a!==ye.VIDEO&&Ht(d,Re.RequestP2PMuteRemote,ye.AUDIO),m})()}getAllDataChannels(){return this.localDataChannels}massSubscribe(i){return x(function*(){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")})()}massSubscribeNoLock(i){return x(function*(){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")})()}massUnsubscribe(i){return x(function*(){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")})()}massUnsubscribeNoLock(i){return x(function*(){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")})()}muteRemote(i,r){var a=this;return x(function*(){if(!a.recvConnection)return;const l=a.remoteUserMap.get(i);if(!l)return void R.warning("[".concat(a.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(i.uid,"."));if(!l.get(r))return void R.warning("[".concat(a.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(i.uid," media type ").concat(r,"."));const d=r===ye.VIDEO?i._videoSSRC:i._audioSSRC;void 0!==d&&a.recvConnection.setStatsRemoteVideoIsReady(d,!1)})()}unmuteRemote(i,r){var a=this;return x(function*(){return a.unmuteRemoteNoLock(i,r)})()}unmuteRemoteNoLock(i,r){var a=this;return x(function*(){if(!a.recvConnection)return;const l=a.remoteUserMap.get(i);l?l.get(r)||R.warning("[".concat(a.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(i.uid," media type ").concat(r,".")):R.warning("[".concat(a.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(i.uid,"."))})()}getAllTracks(i){const r=this.localTrackMap.get(se.LocalAudioTrack);if((null==r?void 0:r.track)instanceof ei){const a=r.track;return Array.from(this.localTrackMap.entries()).filter(l=>{let[d]=l;return d!==se.LocalAudioTrack}).filter(l=>{let[d]=l;return!(i&&d===se.LocalVideoLowTrack)}).map(l=>{let[,{track:d}]=l;return d}).concat(a.trackList)}return Array.from(this.localTrackMap.entries()).filter(a=>{let[l]=a;return!(i&&l===se.LocalVideoLowTrack)}).map(a=>{let[,{track:l}]=a;return l})}reportPublishEvent(i,r,a,l,d){if(i){const f=this.localTrackMap.get(se.LocalAudioTrack),m=this.localTrackMap.get(l?se.LocalVideoLowTrack:se.LocalVideoTrack);Te.publish(this.store.sessionId,{eventElapse:Ni.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:i,ec:r,audioName:null==f?void 0:f.track.getTrackLabel(),videoName:null==m?void 0:m.track.getTrackLabel(),screenshare:-1!==(null==m?void 0:m.track._hints.indexOf(Qt.SCREEN_TRACK)),audio:!!f,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}else{var h;a||(a=[]);const f=a.find(g=>g instanceof vt),m=l?null===(h=this.localTrackMap.get(se.LocalVideoTrack))||void 0===h?void 0:h.track:a.find(g=>g instanceof Ye);Te.publish(this.store.sessionId,{eventElapse:Ni.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:i,ec:r,audioName:null==f?void 0:f.getTrackLabel(),videoName:null==m?void 0:m.getTrackLabel(),screenshare:-1!==(null==m?void 0:m._hints.indexOf(Qt.SCREEN_TRACK)),audio:!!f,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}}reportSubscribeEvent(i,r,a,l){const d=l===ye.VIDEO?a._videoSSRC:a._audioSSRC;d&&Te.subscribe(this.store.sessionId,{succ:i,ec:r,video:l===ye.VIDEO,audio:l===ye.AUDIO,peerid:a.uid,subscribeRequestid:l===ye.VIDEO?a._videoSSRC:a._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ni.measureFromSubscribeStart(this.store.clientId,d)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Gn("P2PChannel2-send-mutex"),this.sendMutex=new Gn("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const i=this.localTrackMap.get(se.LocalAudioTrack);if((null==i?void 0:i.track)instanceof ei){if(i.track.trackList.length>0){const r=i.track;i.track.trackList.forEach(a=>{r.removeAudioTrack(a)})}i.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=rt.Disconnected}getStats(i){var r,a;return i?null===(a=this.recvConnection)||void 0===a?void 0:a.getStats():null===(r=this.sendConnection)||void 0===r?void 0:r.getStats()}getRemoteVideoIsReady(i){var r;return(null===(r=this.recvConnection)||void 0===r?void 0:r.getRemoteVideoIsReady(i))||!1}getLocalAudioVolume(){const i=this.localTrackMap.get(se.LocalAudioTrack);if(i)return i.track.getVolumeLevel()}getLocalVideoSize(){const i=this.localTrackMap.get(se.LocalVideoTrack);if(i)return{width:i.track._videoWidth||0,height:i.track._videoHeight||0}}getEncoderConfig(i){const r=this.localTrackMap.get(i);return r&&r.track instanceof Ye||r&&r.track instanceof vt?r.track._encoderConfig:void 0}getLocalMedia(i){return this.localTrackMap.get(i)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(i,r){if(!i)return this.remoteUserMap.size>0;const a=this.remoteUserMap.get(i);return!!a&&(!r||a.has(r))}hasRemoteMediaWithLock(i,r){var a=this;return x(function*(){if(!i)return a.remoteUserMap.size>0;const l=a.remoteUserMap.get(i);return!!l&&(!r||l.has(r))})()}getRemoteMedia(i){var r;const a=Array.from(jr(r=this.remoteUserMap).call(r)).find(l=>l.uid===i);return a?{audioTrack:a.audioTrack,audioSSRC:a._audioSSRC,videoTrack:a.videoTrack,videoSSRC:a._videoSSRC}:{}}getAudioLevels(){let i=Array.from(this.remoteUserMap.entries()).map(a=>{let[l]=a;return{uid:l.uid,level:l.audioTrack?100*l.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(se.LocalAudioTrack);return r&&i.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),i=Bf(i).call(i,(a,l)=>a.level-l.level),i}disconnectForReconnect(){var i=this;return x(function*(){i.sendConnection&&i.recvConnection&&(R.debug("[".concat(i.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),i.state=rt.Reconnecting,H("KEEP_LAST_FRAME")&&0!==i.remoteUserMap.size&&Array.from(i.remoteUserMap.entries()).forEach(r=>{let[a]=r;var l;a._videoTrack&&a._videoTrack._player&&(null===(l=a._videoTrack._player.getVideoElement())||void 0===l||l.pause(),a._videoTrack._player.isKeepLastFrame=!0,a._videoTrack._originMediaStreamTrack.stop())}),i.sendConnection.close(),i.unbindConnectionEvents(i.sendConnection),i.sendConnection=void 0,i.recvConnection.close(),i.unbindConnectionEvents(i.recvConnection),i.recvConnection=void 0,0!==i.localTrackMap.size&&(Array.from(i.localTrackMap.entries()).forEach(r=>{var a;let[l,{track:d}]=r;switch(l){case se.LocalVideoTrack:we(a=d._hints).call(a,Qt.LOW_STREAM)?d.close():i.pendingLocalTracks.push(d);break;case se.LocalAudioTrack:d instanceof ei?i.pendingLocalTracks=i.pendingLocalTracks.concat(d.trackList):i.pendingLocalTracks.push(d)}}),i.emit(Re.MediaReconnectStart,i.store.uid)),i.unbindLocalTrackEvents(),i.localTrackMap.clear(),0!==i.remoteUserMap.size&&Array.from(i.remoteUserMap.entries()).forEach(r=>{let[a,l]=r;Array.from(jr(l).call(l)).forEach(d=>{i.setPendingRemoteMedia(a,d)}),i.emit(Re.MediaReconnectStart,a.uid)}),i.unbindAllRemoteTrackEvents(),i.remoteUserMap.clear(),i.statsUploader.stopUploadUplinkStats(),i.statsUploader.stopUploadDownlinkStats(),i.statsUploader.stopUploadTransportStats(),R.debug("[".concat(i.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))})()}hasPendingRemoteMedia(i,r){for(const a of this.pendingRemoteTracks){const{user:l,kind:d}=a;if((i instanceof Wt?i.uid:i)===l.uid&&r===d)return!0}return!1}setPendingRemoteMedia(i,r){this.hasPendingRemoteMedia(i,r)||this.pendingRemoteTracks.push({user:i,kind:r})}restartICE(i){var r=this;return x(function*(){let a;a=i.direction===Qh.SEND_ONLY?yield r.sendMutex.lock("From P2PChannel.restartICE"):yield r.recvMutex.lock("From P2PChannel.restartICE");try{const l=yield i.restartICE(),d=yield vn(r,Re.RequestP2PRestartICE,l);i.setDescription("local",d)}finally{a()}})()}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const i=this.sendConnection.getStats(),r=this.localTrackMap.get(se.LocalVideoTrack),a=this.localTrackMap.get(se.LocalAudioTrack),l=i.videoSend.find(O=>{var P;return O.ssrc===(null==r||null===(P=r.ssrcs)||void 0===P?void 0:P[0].ssrcId)}),d=i.audioSend.find(O=>{var P;return O.ssrc===(null==a||null===(P=a.ssrcs)||void 0===P?void 0:P[0].ssrcId)});if(!l||!d)return 1;const h=ro(this,Re.NeedSignalRTT),f=l?l.rttMs:void 0,m=d?d.rttMs:void 0,g=f&&m?(f+m)/2:f||m,y=100*i.sendPacketLossRate*.7/50+.3*((g&&h?(g+h)/2:g||h)||0)/1500,C=y<.17?1:y<.36?2:y<.59?3:y<.1?4:5,b=null==r?void 0:r.track;if(b&&b._encoderConfig&&-1===b._hints.indexOf(Qt.SCREEN_TRACK)){const O=b._encoderConfig.bitrateMax,P=i.bitrate.actualEncoded;if(O&&P){const D=(1e3*O-P)/(1e3*O);return ws[D<.15?0:D<.3?1:D<.45?2:D<.6?3:4][C]}}return C}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const i=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(a=>{let[l]=a;const d=l._audioSSRC,h=l._videoSSRC,f=i.audioRecv.find(P=>P.ssrc===d),m=i.videoRecv.find(P=>P.ssrc===h);if(!f&&!m)return void(r+=1);const g=ro(this,Re.NeedSignalRTT),E=i.rtt,y=(E&&g?(E+g)/2:E||g)||0,C=f?f.jitterMs:void 0,b=i.recvPacketLossRate;let O=.7*b*100/50+.3*y/1500;C&&(O=.6*b*100/50+.2*y/1500+.2*C/400),r+=O<.1?1:O<.17?2:O<.36?3:O<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}muteLocalTrack(i){var r=this;return x(function*(){return new q((a,l)=>{r.handleMuteLocalTrack(i,a,l)})})()}filterTobePublishedTracks(i,r,a){const l=[],d=Rt(),h=this.getAllTracks();i=d_(i=i.filter(g=>-1===h.indexOf(g)));let f=!1,m=!1;for(const g of i){if(g instanceof Ye&&(this.localTrackMap.has(se.LocalVideoTrack)||f?new ne(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(l.push({track:g,type:se.LocalVideoTrack}),f=!0),r)){const E=this.getLowVideoTrack(g,a);l.push({track:E,type:se.LocalVideoLowTrack})}if(g instanceof vt){const E=this.localTrackMap.get(se.LocalAudioTrack);if(E){if(!(E.track instanceof ei))throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0)}else if(m){const y=l.find(C=>{let{type:b}=C;return b===se.LocalAudioTrack});if(!(y.track instanceof ei))throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");y.track.addAudioTrack(g)}else{if(!d.webAudioMediaStreamDest||g instanceof ei||g._bypassWebAudio)l.push({track:g,type:se.LocalAudioTrack});else{const y=new ei;y.addAudioTrack(g),l.push({track:y,type:se.LocalAudioTrack})}m=!0}}}return l}filterTobeUnpublishedTracks(i){const r=[],a=this.getAllTracks();i=d_(i=i.filter(l=>-1!==a.indexOf(l)));for(const l of i){if(l instanceof vt){const d=this.localTrackMap.get(se.LocalAudioTrack);if(!d)continue;d.track instanceof ei?(d.track.removeAudioTrack(l),this.unbindLocalAudioTrackEvents(l),0===d.track.trackList.length&&(r.push([se.LocalAudioTrack,d]),d.track.close())):r.push([se.LocalAudioTrack,d])}if(l instanceof Ye){const d=this.localTrackMap.get(se.LocalVideoTrack);if(!d)continue;r.push([se.LocalVideoTrack,d]);const h=this.localTrackMap.get(se.LocalVideoLowTrack);h&&r.push([se.LocalVideoLowTrack,h])}}return r}bindLocalTrackEvents(i){i.forEach(r=>{let{track:a,type:l}=r;switch(l){case se.LocalVideoTrack:a.addListener(me.GET_STATS,this.handleGetLocalVideoStats),a.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.addListener(me.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),a.addListener(me.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),a.addListener(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),a.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case se.LocalAudioTrack:this.bindLocalAudioTrackEvents(a)}})}bindLocalAudioTrackEvents(i,r){i instanceof ei?i.trackList.forEach(a=>{a.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.addListener(me.GET_STATS,this.handleGetLocalAudioStats),a.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(i.addListener(me.GET_STATS,this.handleGetLocalAudioStats),i.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||i.addListener(me.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(i){i||(i=Array.from(this.localTrackMap.entries()).map(r=>{let[a,{track:l}]=r;return{track:l,type:a}})),i.forEach(r=>{let{track:a,type:l}=r;switch(l){case se.LocalVideoTrack:a.off(me.GET_STATS,this.handleGetLocalVideoStats),a.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.off(me.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),a.off(me.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),a.off(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),a.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case se.LocalAudioTrack:this.unbindLocalAudioTrackEvents(a)}})}unbindLocalAudioTrackEvents(i){i instanceof ei?i.trackList.forEach(r=>{r.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(me.GET_STATS,this.handleGetLocalAudioStats),r.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(i.off(me.GET_STATS,this.handleGetLocalAudioStats),i.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(i,r){r instanceof xc&&r.addListener(me.GET_STATS,a=>{a(this.handleGetRemoteVideoStats(i))}),r instanceof Ns&&r.addListener(me.GET_STATS,a=>{a(this.handleGetRemoteAudioStats(i))})}unbindRemoteTrackEvents(i){i&&i.removeAllListeners(me.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(i=>{let[r,a]=i;a.has(ye.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),a.has(ye.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(i){return i.map(r=>{var a;let l,d,{track:h,type:f}=r;switch(f){case se.LocalAudioTrack:l=bt.Audio,d={dtx:h instanceof Lc&&h._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case se.LocalVideoTrack:l=we(a=h._hints).call(a,Qt.SCREEN_TRACK)?bt.Screen:bt.High,d=Ql(Ql({},iy(h)),{},{codec:this.store.codec});break;case se.LocalVideoLowTrack:l=bt.Low,d=Ql(Ql({},iy(h)),{},{codec:this.store.codec})}return{kind:f===se.LocalAudioTrack?ye.AUDIO:ye.VIDEO,stream_type:l,attributes:d,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(i){return i.map(r=>{var a;let l,[d,{track:h,ssrcs:f,id:m}]=r;switch(d){case se.LocalVideoTrack:l=we(a=h._hints).call(a,Qt.SCREEN_TRACK)?bt.Screen:bt.High;break;case se.LocalAudioTrack:l=bt.Audio;break;case se.LocalVideoLowTrack:l=bt.Low}return{stream_type:l,ssrcs:f,mid:m}})}assignLocalTracks(i){i.forEach(r=>{let{track:a,type:l}=r;this.localTrackMap.set(l,{track:a})})}withdrawLocalTracks(i){i.forEach(r=>{let[a]=r;this.localTrackMap.delete(a)})}bindConnectionEvents(i){var r=this;i.onConnectionStateChange=function(){var a=x(function*(l){var d;if(R.info("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(l,")")),r.emit(Re.PeerConnectionStateChange,l),"connected"!==l||r.store.keyMetrics.peerConnectionEnd||r.store.peerConnectionEnd(),we(d=r._restartStates).call(d,l)||i.direction===Qh.SEND_ONLY){if(r._restartTimer)return;const h=()=>{("disconnected"===i.iceConnectionState||"checking"===i.iceConnectionState||"failed"===i.iceConnectionState)&&(R.debug("[".concat(r.store.clientId,"] [P2PChannel] start use restartICE")),"CONNECTED"===ro(r,Re.QueryClientConnectionState)&&r.restartICE(i))};r._restartTimer=window.setTimeout(()=>{h(),r._restartTimer=void 0},800)}});return function(l){return a.apply(this,arguments)}}(),i.onICEConnectionStateChange=a=>{"connected"!==a||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(a,")")),Te.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:a,tag:Kt.TRACER}).onSuccess(),this.emit(Re.IceConnectionStateChange,a)},i.onICETransportStateChange=a=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(a,")"))},i.onDTLSTransportStateChange=a=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(a,")"))},i.onDTLSTransportError=a=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(a,")"))},i.onFirstAudioDecoded=a=>{var l;const d=Array.from(jr(l=this.remoteUserMap).call(l)).find(f=>f._audioSSRC===a);var h;d&&(this.store.subscribe(d.uid,"audio",void 0,void 0,void 0,Date.now()),null===(h=d.audioTrack)||void 0===h||h.emit(hu.FIRST_FRAME_DECODED),Te.firstRemoteFrame(this.store.sessionId,rn.FIRST_AUDIO_DECODE,Xt.FIRST_AUDIO_DECODE,{peer:d._uintid,subscribeElapse:Ni.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId}))},i.onFirstAudioReceived=a=>{var l;const d=Array.from(jr(l=this.remoteUserMap).call(l)).find(h=>h._audioSSRC===a);d&&Te.firstRemoteFrame(this.store.sessionId,rn.FIRST_AUDIO_RECEIVED,Xt.FIRST_AUDIO_RECEIVED,{peer:d._uintid,subscribeElapse:Ni.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId})},i.onFirstVideoDecoded=(a,l,d)=>{this.reportVideoFirstFrameDecoded(a,l,d)},i.onFirstVideoReceived=a=>{var l;const d=Array.from(jr(l=this.remoteUserMap).call(l)).find(h=>h._videoSSRC===a);d&&Te.firstRemoteFrame(this.store.sessionId,rn.FIRST_VIDEO_RECEIVED,Xt.FIRST_VIDEO_RECEIVED,{peer:d._uintid,subscribeElapse:Ni.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId})},i.onSelectedLocalCandidateChanged=(a,l)=>{const d="relay"===a.candidateType;"unknown"!==l.candidateType&&d===("relay"===l.candidateType)||this.emit(Re.ConnectionTypeChange,d),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ql(l))," -> ").concat(JSON.stringify(ql(a)),")"))},i.onSelectedRemoteCandidateChanged=(a,l)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ql(l))," -> ").concat(JSON.stringify(ql(a)),")"))},i.onFirstVideoDecodedTimeout=a=>{this.reportVideoFirstFrameDecoded(a,void 0,void 0,!0)},i.onLocalCandidate=a=>{this.emit(Re.LocalCandidate,a)}}unbindConnectionEvents(i){i.onConnectionStateChange=void 0,i.onICEConnectionStateChange=void 0,i.onICETransportStateChange=void 0,i.onDTLSTransportStateChange=void 0,i.onDTLSTransportError=void 0,i.onFirstAudioDecoded=void 0,i.onFirstAudioReceived=void 0,i.onFirstVideoDecoded=void 0,i.onFirstVideoReceived=void 0,i.onSelectedLocalCandidateChanged=void 0,i.onSelectedRemoteCandidateChanged=void 0,i.onFirstVideoDecodedTimeout=void 0,i.onLocalCandidate=void 0}filterTobeMutedTracks(i){const r=[];if(-1===this.getAllTracks().indexOf(i))return r;const a=this.localTrackMap.get(se.LocalAudioTrack);if(i instanceof vt&&(null==a?void 0:a.track)instanceof ei)return a.track.isActive||r.push([se.LocalAudioTrack,a]),r;const l=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return i===h});if(l&&(r.push(l),l[0]===se.LocalVideoTrack)){const d=this.localTrackMap.get(se.LocalVideoLowTrack);d&&r.push([se.LocalVideoLowTrack,d])}return r}filterTobeUnmutedTracks(i){const r=[],a=this.localTrackMap.get(se.LocalAudioTrack);if(i instanceof vt&&(null==a?void 0:a.track)instanceof ei)return a.track.isActive&&r.push([se.LocalAudioTrack,a]),r;const l=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return i===h});if(l)if(l[0]===se.LocalVideoTrack){r.push(l);const d=this.localTrackMap.get(se.LocalVideoLowTrack);d&&r.push([se.LocalVideoLowTrack,d])}else r.push(l);return r}createMuteMessage(i){return i.map(r=>{var a;let l,[d,{track:h,ssrcs:f,id:m}]=r;switch(d){case se.LocalAudioTrack:l=bt.Audio;break;case se.LocalVideoTrack:l=we(a=h._hints).call(a,Qt.SCREEN_TRACK)?bt.Screen:bt.High;break;case se.LocalVideoLowTrack:l=bt.Low}return{stream_type:l,ssrcs:f,mid:m}})}createUnmuteMessage(i){return i.map(r=>{var a;let l,[d,{track:h,ssrcs:f,id:m}]=r;switch(d){case se.LocalAudioTrack:l=bt.Audio;break;case se.LocalVideoTrack:l=we(a=h._hints).call(a,Qt.SCREEN_TRACK)?bt.Screen:bt.High;break;case se.LocalVideoLowTrack:l=bt.Low}return{stream_type:l,ssrcs:f,mid:m}})}filterTobeUnSubscribedTracks(i,r){const a=[],l=this.remoteUserMap.get(i);if(!l)return a;if(r){const d=l.get(r);if(!d)return a;a.push([i,{kind:r,id:d}])}else Array.from(l.entries()).forEach(d=>{let[h,f]=d;a.push([i,{kind:h,id:f}])});return a}createUnsubscribeMessage(i){const r=[];return i.forEach(a=>{let[l,{kind:d}]=a;switch(d){case ye.VIDEO:return void(l._videoSSRC&&r.push({stream_type:ye.VIDEO,ssrcId:l._videoSSRC}));case ye.AUDIO:return void(l._audioSSRC&&r.push({stream_type:ye.AUDIO,ssrcId:l._audioSSRC}))}}),r}withdrawRemoteTracks(i){i.forEach(r=>{let[a,{kind:l}]=r;const d=this.remoteUserMap.get(a);d&&(d.delete(l),0===Array.from(d.entries()).length&&this.remoteUserMap.delete(a))})}updateBitrateLimit(i){var r=this;return x(function*(){const a=r.localTrackMap.get(se.LocalVideoTrack),l=r.localTrackMap.get(se.LocalVideoLowTrack);a&&(yield a.track.setBitrateLimit(i.uplink)),l&&i.low_stream_uplink&&(yield l.track.setBitrateLimit({max_bitrate:i.low_stream_uplink.bitrate,min_bitrate:i.low_stream_uplink.bitrate||0}))})()}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const r=this.recvConnection.peerConnectionState;return"connected"!==this.sendConnection.peerConnectionState&&"connected"!==r}return!0}tryToUnmuteAudio(i){var r=this;return x(function*(){for(let a=0;a<i.length;a++)if(i[a]instanceof vt){const l=r.filterTobeUnmutedTracks(i[a]);if(0===l.length)continue;const d=r.createUnmuteMessage(l);return void(yield Ht(r,Re.RequestUnmuteLocal,d))}})()}bindStatsUploaderEvents(){this.statsUploader.requestStats=i=>this.getStats(i),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(i=>{let[,{ssrcs:r}]=i;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=i=>{var r;return!(null===(r=this.recvConnection)||void 0===r||!r.getRemoteVideoIsReady(i))},this.statsUploader.requestUpload=(i,r)=>this.emit(Re.RequestUploadStats,i,r),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){var i=this;return x(function*(){i.dtlsFailedCount+=1,yield si(eE(i.dtlsFailedCount,Wn)),i.emit(Re.RequestReconnect)})()}reconnectP2P(){return x(function*(){})()}canPublishLowStream(){return this.localTrackMap.has(se.LocalVideoTrack)||this.pendingLocalTracks.some(i=>i instanceof Ye)}throwIfTrackTypeNotMatch(i){if(i.filter(r=>r instanceof Ye).length>1)throw new ne(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(i.filter(r=>r instanceof vt).length>1&&(i.some(r=>r instanceof vt&&r._bypassWebAudio)||!Rt().webAudioMediaStreamDest))throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of i){if(r instanceof Ye&&this.pendingLocalTracks.some(a=>a instanceof Ye))throw new ne(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof vt&&this.pendingLocalTracks.some(a=>a instanceof vt)&&(!Rt().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(a=>a instanceof vt&&a._bypassWebAudio)))throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(i,r){const a=!H("DISABLE_DUAL_STREAM_USE_ENCODING")&&Rt().supportDualStreamEncoding,l=Ql(Ql({},{width:160,height:120,framerate:15,bitrate:50}),r);let d;d=a?i._mediaStreamTrack.clone():em(i,l);const h=Vt(8,"track-low-"),f=new Ye(d,Ql(Ql({},a&&{scaleResolutionDownBy:_b(l,i)}),{},{frameRate:l.framerate,bitrateMax:l.bitrate,bitrateMin:l.bitrate}),void 0,void 0,h);return f.on(Ul.TRANSCEIVER_UPDATED,m=>{i._updateRtpTransceiver(m,Os.LOW_STREAM)}),f._hints.push(Qt.LOW_STREAM),i.addListener(me.NEED_CLOSE,()=>{f.close()}),f}globalLock(){var i=this;return x(function*(){return i.recvMutex.lock("From P2PChannel2.globalLock")})()}reportVideoFirstFrameDecoded(i,r,a,l){var d;const h=Array.from(jr(d=this.remoteUserMap).call(d)).find(f=>f._videoSSRC===i);if(h){l||this.store.subscribe(h.uid,"video",void 0,void 0,void 0,void 0,Date.now());const f=this.store.keyMetrics,m=f.subscribe.find(g=>g.userId===h.uid&&"video"===g.type);Te.firstRemoteVideoDecode(this.store.sessionId,rn.FIRST_VIDEO_DECODE,Xt.FIRST_VIDEO_DECODE,{peer:h._uintid,videowidth:r,videoheight:a,subscribeElapse:Ni.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId,apEnd:f.requestAPEnd||0,apStart:f.requestAPStart||0,joinGwEnd:f.joinGatewayEnd||0,joinGwStart:f.joinGatewayStart||0,pcEnd:f.peerConnectionEnd||0,pcStart:f.peerConnectionStart||0,subscriberEnd:(null==m?void 0:m.subscribeEnd)||0,subscriberStart:(null==m?void 0:m.subscribeStart)||0,videoAddNotify:(null==m?void 0:m.streamAdded)||0,state:l?1:0})}}remoteMediaSsrcChanged(i,r,a){var l=this;return x(function*(){if(!l.recvConnection)return!1;const d=l.remoteUserMap.get(i);if(!d)return!1;const h=d.get(r);if(!h)return!1;const f=yield l.recvConnection.getRemoteSSRC(h);return void 0!==f&&f!==a})()}resetConnection(i){R.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(i)),this.state===rt.Connected?(R.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}publishDataChannel(i){return x(function*(){throw new ne(k.NOT_SUPPORTED)})()}unpublishDataChannel(i){return x(function*(){throw new ne(k.NOT_SUPPORTED)})()}subscribeDataChannel(i,r){return x(function*(){throw new ne(k.NOT_SUPPORTED)})()}unsubscribeDataChannel(i,r){return x(function*(){throw new ne(k.NOT_SUPPORTED)})()}hasPendingRemoteDataChannel(i,r){throw new ne(k.NOT_SUPPORTED)}setPendingRemoteDataChannel(i,r){throw new ne(k.NOT_SUPPORTED)}preConnect(i,r,a,l,d,h){return x(function*(){throw new ne(k.NOT_SUPPORTED)})()}getEstablishParams(){throw new ne(k.NOT_SUPPORTED)}reSubscribe(i){return x(function*(){throw new ne(k.NOT_SUPPORTED)})()}updateVideoStreamParameter(i,r){return x(function*(){throw new ne(k.NOT_SUPPORTED)})()}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(i=>{let[r,{track:a}]=i;r===se.LocalVideoLowTrack?a._updateRtpTransceiver(void 0,Os.LOW_STREAM):a._updateRtpTransceiver(void 0)})}}function as(s){return function(i,r,a){const l=i[r];if("function"!=typeof l)throw new Error("Cannot use mutex on object property.");return a.value=x(function*(){for(var d=arguments.length,h=new Array(d),f=0;f<d;f++)h[f]=arguments[f];switch(s){case Xr.SEND_ONLY:{const m=yield this.sendMutex.lock("From P2PChannel2.".concat(r));try{return yield l.apply(this,h)}finally{m()}}case Xr.RECEIVE_ONLY:{const m=yield this.recvMutex.lock("From P2PChannel2.".concat(r));try{return yield l.apply(this,h)}finally{m()}}default:{const m=yield this.sendMutex.lock("From P2PChannel2.".concat(r)),g=yield this.recvMutex.lock("From P2PChannel2.".concat(r));try{return yield l.apply(this,h)}finally{m(),g()}}}}),a}}function Xb(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function BN(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?Xb(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Xb(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}oe([as(),N("design:type",Function),N("design:paramtypes",[Object,String]),N("design:returntype",q)],In.prototype,"startP2P",null),oe([as(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],In.prototype,"p2pConnect",null),oe([as(Xr.SEND_ONLY),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],In.prototype,"dopublish",null),oe([as(Xr.SEND_ONLY),N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],In.prototype,"unpublish",null),oe([as(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",q)],In.prototype,"unpublishLowStream",null),oe([as(Xr.SEND_ONLY),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],In.prototype,"doUnpublish",null),oe([as(Xr.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Wt,String,String,Number]),N("design:returntype",q)],In.prototype,"subscribe",null),oe([as(Xr.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Wt,String,String,Boolean]),N("design:returntype",q)],In.prototype,"unsubscribe",null),oe([as(Xr.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Wt,String]),N("design:returntype",q)],In.prototype,"muteRemote",null),oe([as(Xr.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Wt,String]),N("design:returntype",q)],In.prototype,"unmuteRemote",null),oe([as(Xr.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Wt,String]),N("design:returntype",q)],In.prototype,"hasRemoteMediaWithLock",null),oe([as(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",q)],In.prototype,"disconnectForReconnect",null),oe([as(Xr.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Wt,String,Number]),N("design:returntype",q)],In.prototype,"remoteMediaSsrcChanged",null);const N2=Date.now(),jN=new Map,wy=new Map;function wp(s){return Ap.apply(this,arguments)}function Ap(){return Ap=x(function*(s){const i=jN.get(s),r=Array.isArray(i)&&i[i.length-1],a=wy.get(s);if(!r)return void(a.isSyncing=!1);const l={uid:r.uid,payload:u_(r.payload)};0===a.firstRecvTs&&(a.firstRecvTs=r.recvTs,a.firstSendTs=r.sendTs);const d=r.sendTs-a.firstSendTs,h=d-(Date.now()-a.firstRecvTs);h>0&&(a.firstRecvTs=Date.now()-d);let f=r.mediaDelay+h;f<=0?(i.pop(),Ay(r.context,l),f=0):f=Math.min(f,20),setTimeout(()=>i.length&&wp(s),f)}),Ap.apply(this,arguments)}function Ay(s,i){s.safeEmit(We.STREAM_MESSAGE,i.uid,i.payload),s.onStreamMessage&&s.onStreamMessage(i)}function Dp(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Op(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?Dp(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Dp(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}Gn.setLogger(R);class kt extends nn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var i;return(null===(i=this._config)||void 0===i?void 0:i.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(i){var r;let a;if(super(),r=this,T(this,"store",void 0),T(this,"_uid",void 0),T(this,"_channelName",void 0),T(this,"_uintUid",void 0),T(this,"_users",[]),T(this,"_config",void 0),T(this,"_clientId",void 0),T(this,"_appId",void 0),T(this,"_sessionId",null),T(this,"_key",void 0),T(this,"_joinInfo",void 0),T(this,"_gateway",void 0),T(this,"_statsCollector",void 0),T(this,"_configDistribute",void 0),T(this,"_leaveMutex",new Gn("client-leave")),T(this,"_publishMutex",new Gn("client-publish")),T(this,"_renewTokenMutex",new Gn("client-renewtoken")),T(this,"_subscribeMutex",new Gn("client-subscribe")),T(this,"_encryptionMode","none"),T(this,"_encryptionSecret",null),T(this,"_encryptionSalt",null),T(this,"_proxyServer",void 0),T(this,"_turnServer",{servers:[],mode:"auto"}),T(this,"_cloudProxyServerMode","disabled"),T(this,"_isDualStreamEnabled",!1),T(this,"_defaultStreamFallbackType",void 0),T(this,"_lowStreamParameter",void 0),T(this,"_streamFallbackTypeCacheMap",new Map),T(this,"_remoteStreamTypeCacheMap",new Map),T(this,"_axiosCancelSource",Gr.CancelToken.source()),T(this,"_audioVolumeIndicationInterval",void 0),T(this,"_networkQualityInterval",void 0),T(this,"_userOfflineTimeout",void 0),T(this,"_streamRemovedTimeout",void 0),T(this,"_injectStreamingClient",void 0),T(this,"_liveTranscodeStreamingClient",void 0),T(this,"_liveRawStreamingClient",void 0),T(this,"_channelMediaRelayClient",void 0),T(this,"_networkQualitySensitivity","normal"),T(this,"_p2pChannel",void 0),T(this,"_useLocalAccessPoint",!1),T(this,"_setLocalAPVersion",void 0),T(this,"_joinAndNotLeaveYet",!1),T(this,"_numberOfJoinCount",0),T(this,"_remoteDefaultVideoStreamType",void 0),T(this,"_inspect",void 0),T(this,"_moderation",void 0),T(this,"_license",void 0),T(this,"_pendingPublishedUsers",[]),T(this,"ntpAlignErrorCount",0),T(this,"remoteInboundOffset",0),T(this,"_handleLocalTrackEnable",(l,d,h)=>{this.publish(l,!1).then(d).catch(h)}),T(this,"_handleLocalTrackDisable",(l,d,h)=>{this.unpublish(l).then(d).catch(h)}),T(this,"_handleUserOnline",l=>{if(H("BLOCK_LOCAL_CLIENT")&&ou(l.uid,this.channelName))return void R.debug("[".concat(l.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof l.uid&&R.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const d=this._users.find(h=>h.uid===l.uid);if(d)d._trust_in_room_=!0;else{const h=new Wt(l.uid,l.uint_id||l.uid);this._users.push(h),R.debug("[".concat(this._clientId,"] user online"),l.uid),this.safeEmit(We.USER_JOINED,h)}}),T(this,"_handleUserOffline",l=>{if(H("BLOCK_LOCAL_CLIENT")&&ou(l.uid,this.channelName))return;const d=this._users.find(h=>h.uid===l.uid);d&&(this._handleRemoveStream(l),this._handleRemoveDataChannels(l),Ti(this._users,d),this._remoteStreamTypeCacheMap.delete(d.uid),this._streamFallbackTypeCacheMap.delete(d.uid),R.debug("[".concat(this._clientId,"] user offline"),l.uid,"reason:",l.reason),this.safeEmit(We.USER_LEAVED,d,l.reason))}),T(this,"_handleAddAudioOrVideoStream",(l,d,h,f,m,g,E)=>{if(H("BLOCK_LOCAL_CLIENT")&&ou(d,this.channelName))return;const y=this._users.find(b=>b.uid===d);if(!y)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(l)),this.store.subscribe(y.uid,l,void 0,void 0,void 0,Date.now());const C="audio"===l?y.hasAudio:y.hasVideo;y._uintid||(y._uintid=m||d),"audio"===l?y._trust_audio_stream_added_state_=!0:y._trust_video_stream_added_state_=!0,"audio"===l?(y._audio_added_=!0,void 0!==h&&(y._audioSSRC=h),void 0!==f&&(y._cname=f),g&&(y._audioOrtc=g)):(y._video_added_=!0,void 0!==h&&(y._videoSSRC=h),void 0!==f&&(y._cname=f),void 0!==E&&(y._rtxSsrcId=E),g&&(y._videoOrtc=g)),("audio"===l?y.hasAudio:y.hasVideo)&&!C&&(R.info("[".concat(this._clientId,"] remote user ").concat(y.uid," published ").concat(l)),this.safeEmit(We.USER_PUBLISHED,y,l)),"video"===l?Te.onGatewayStream(this._sessionId,rn.ON_ADD_VIDEO_STREAM,Xt.ON_ADD_VIDEO_STREAM,{peer:m||d,ssrc:y._videoSSRC}):Te.onGatewayStream(this._sessionId,rn.ON_ADD_AUDIO_STREAM,Xt.ON_ADD_AUDIO_STREAM,{peer:m||d,ssrc:y._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(y,l,h).then(b=>{if(b&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(l," for user ").concat(y.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof qn))return this._p2pChannel.unsubscribe(y,l,!0).then(()=>this._subscribe(y,l,!0).catch(O=>{R.error("[".concat(this._clientId,"] resubscribe error"),O.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(y,l)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(l," for user ").concat(y.uid," after reconnect.")),this._subscribe(y,l,!0).catch(b=>{R.error("[".concat(this._clientId,"] resubscribe error"),b.toString())}))}),T(this,"_handleRemoveStream",(l,d,h)=>{if(H("BLOCK_LOCAL_CLIENT")&&ou(l.uid,this.channelName))return;const f=this._users.find(g=>g.uid===l.uid);if(!f)return void R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));R.debug("[".concat(this._clientId,"] stream removed with uid ").concat(l.uid));let m=()=>{};if(f.hasAudio&&f.hasVideo?m=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(f.uid," unpublished audio track")),this.safeEmit(We.USER_UNPUBLISHED,f,"audio"),R.info("[".concat(this._clientId,"] remote user ").concat(f.uid," unpublished video track")),this.safeEmit(We.USER_UNPUBLISHED,f,"video")}:f.hasVideo?m=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(f.uid," unpublished video track")),this.safeEmit(We.USER_UNPUBLISHED,f,"video")}:f.hasAudio&&(m=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(f.uid," unpublished audio track")),this.safeEmit(We.USER_UNPUBLISHED,f,"audio")}),f._trust_audio_stream_added_state_=!0,f._trust_video_stream_added_state_=!0,f._audio_added_=!1,f._video_added_=!1,this._p2pChannel instanceof qn)this._p2pChannel.unsubscribe(f).then(g=>{if(g)return this._gateway.unsubscribe(g,f.uid)});else if(d&&h)if(l.sdp){const{sdp:g}=l;this._p2pChannel.unsubscribe(f,g).then(E=>{E&&d(E)}).catch(h)}else d&&d();f._audioSSRC=void 0,f._videoSSRC=void 0,f._audioOrtc=void 0,f._videoOrtc=void 0,f._rtxSsrcId=void 0,Te.onGatewayStream(this._sessionId,rn.ON_REMOVE_STREAM,Xt.ON_REMOVE_STREAM,{peer:l.uint_id||l.uid}),m()}),T(this,"_handleSetStreamLocalEnable",(l,d,h)=>{if(H("BLOCK_LOCAL_CLIENT")&&ou(d,this.channelName))return;const f=this._users.find(E=>E.uid===d);if(!f)return void R.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));R.debug("[".concat(this._clientId,"] local ").concat(l," ").concat(h?"enabled":"disabled"," with uid ").concat(d));const m="audio"===l?f.hasAudio:f.hasVideo;if("audio"===l){f._trust_audio_enabled_state_=!0;const E=f._audio_enabled_;if(f._audio_enabled_=h,f._audio_enabled_===E)return;{const y=f._audio_enabled_?"enable-local-audio":"disable-local-audio";R.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(d,", msg: ").concat(y)),this.safeEmit(We.USER_INFO_UPDATED,d,y)}}else{f._trust_video_enabled_state_=!0;const E=f._video_enabled_;if(f._video_enabled_=h,f._video_enabled_===E)return;{const y=f._video_enabled_?"enable-local-video":"disable-local-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(y)),this.safeEmit(We.USER_INFO_UPDATED,d,y)}}const g="audio"===l?f.hasAudio:f.hasVideo;return m!==g?!m&&g?(R.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(l)),void this.safeEmit(We.USER_PUBLISHED,f,l)):("video"===l&&f._videoTrack&&f._videoTrack._destroy(),this._p2pChannel.muteRemote(f,l),R.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(l)),void this.safeEmit(We.USER_UNPUBLISHED,f,l)):void 0}),T(this,"_handleMuteStream",(l,d,h,f,m,g)=>{if(H("BLOCK_LOCAL_CLIENT")&&ou(l,this.channelName))return;R.debug("[".concat(this._clientId,"] receive mute message"),l,d,h);const E=this._users.find(b=>b.uid===l);if(!E)return void R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(l));const y="audio"===d?E.hasAudio:E.hasVideo;if("audio"===d){E._trust_audio_mute_state_=!0;const b=E._audio_muted_;if(E._audio_muted_=h,E._audio_muted_===b)return;{const O=E._audio_muted_?"mute-audio":"unmute-audio";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(O)),this.safeEmit(We.USER_INFO_UPDATED,l,O)}}else{E._trust_video_mute_state_=!0;const b=E._video_muted_;if(E._video_muted_=h,E._video_muted_===b)return;{const O=E._video_muted_?"mute-video":"unmute-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(O)),this.safeEmit(We.USER_INFO_UPDATED,l,O)}}const C="audio"===d?E.hasAudio:E.hasVideo;if(y!==C){if(!y&&C)return this.store.useP2P||("audio"===d?E._audioSSRC:E._videoSSRC)?(R.info("[".concat(this._clientId,"] remote user ").concat(l," published ").concat(d)),void this.safeEmit(We.USER_PUBLISHED,E,d)):void R.warning("[".concat(this._clientId,"] remote user ").concat(l," receive ").concat(d," unmute message  before add stream message, ").concat(d," SSRC doesn't exist yet."));"video"===d&&E._videoTrack&&E._videoTrack._destroy(),m&&g&&this._p2pChannel instanceof In&&(f?this._p2pChannel.unsubscribe(E,f,d).then(b=>{m(b)}).catch(g):m()),this._p2pChannel.muteRemote(E,d),R.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished ").concat(d)),this.safeEmit(We.USER_UNPUBLISHED,E,d)}}),T(this,"_handleP2PLost",function(){var l=x(function*(d){R.debug("[".concat(r._clientId,"] receive p2p lost"),d),parseInt(d.p2pid,10)===r.store.p2pId?yield r._p2pChannel.requestReconnect():R.warning("[".concat(r._clientId,"] P2PLost stream not found"),d)});return function(d){return l.apply(this,arguments)}}()),T(this,"_handleTokenWillExpire",()=>{R.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(We.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),T(this,"_handleBeforeUnload",l=>{"beforeunload"===l.type&&void 0!==l.returnValue&&""!==l.returnValue||(this.leave(),R.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),T(this,"_handleUpdateNetworkQuality",()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(We.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const l={downlinkNetworkQuality:0,uplinkNetworkQuality:0};l.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),l.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(We.NETWORK_QUALITY,l)}),T(this,"_handleP2PAddAudioOrVideoStream",(l,d)=>{const h=this._users.find(m=>m.uid===d);if(!h)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(l)),this.store.subscribe(h.uid,l,void 0,void 0,void 0,Date.now());const f="audio"===l?h.hasAudio:h.hasVideo;"audio"===l?h._trust_audio_stream_added_state_=!0:h._trust_video_stream_added_state_=!0,"audio"===l?h._audio_added_=!0:h._video_added_=!0,("audio"===l?h.hasAudio:h.hasVideo)&&!f&&(R.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published ").concat(l)),this.safeEmit(We.USER_PUBLISHED,h,l)),this._p2pChannel.hasPendingRemoteMedia(h,l)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(l," for user ").concat(h.uid," after reconnect.")),this._subscribe(h,l,!0).catch(m=>{R.error("[".concat(this._clientId,"] resubscribe error"),m.toString())}))}),this._config=i,this._clientId=Vt(5,"client-"),this.store=new TD(i.codec,i.audioCodec,i.mode,this._clientId),this.store.clientCreated(),i.proxyServer&&this.setProxyServer(i.proxyServer,!0),i.turnServer&&this.setTurnServer(i.turnServer,!0),R.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(yo," build: ").concat(_E,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),i.clientRoleOptions)try{ke(i.clientRoleOptions),a=Object.assign({},i.clientRoleOptions)}catch(l){R.warning("[".concat(this._clientId,"] ").concat(l.toString()))}this._statsCollector=new up(this.store),this._statsCollector.onStatsException=(l,d,h)=>{R.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(l,", msg: ").concat(d,", uid: ").concat(h)),this.safeEmit(We.EXCEPTION,{code:l,msg:d,uid:h})},this._statsCollector.onUploadPublishDuration=(l,d,h,f)=>{const m=this._users.find(g=>g.uid===l);m&&Te.peerPublishStatus(this._sessionId,{subscribeElapse:f,audioPublishDuration:d,videoPublishDuration:h,peer:m._uintid})},this.store.useDataChannel=Rt().supportDataChannel&&H("SIGNAL_CHANNEL"),this.store.useP2P=H("P2P"),this._gateway=new fp(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:i.websocketRetryConfig||Wn,httpRetryConfig:i.httpRetryConfig||Wn,forceWaitGatewayResponse:void 0===i.forceWaitGatewayResponse||i.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:i.role,clientRoleOptions:a}),this._configDistribute=new Ep,this.store.useP2P?(this._p2pChannel=new In(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new qn(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}joinMeta(i,r,a,l,d){var h=arguments,f=this;return x(function*(){let m=!(h.length>5&&void 0!==h[5])||h[5],g=h.length>6&&void 0!==h[6]&&h[6];Bt("JOIN_GATEWAY_USE_443PORT_ONLY",m),Bt("JOIN_GATEWAY_USE_DUAL_DOMAIN",g);const E=f._gateway.signal.websocket;return E instanceof S_&&(E.use443PortOnly=m,E.tryDoubleDomain=g),(y=x(function*(C,b,O){i_.get(C)||i_.set(C,[]),r_.get(C)||r_.set(C,b),xa.get(C)||xa.set(C,0);const P=i_.get(C),D=r_.get(C);if(!P||!D)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(xa.get(C)===D){const ae=io();P.push(ae),yield ae.promise}xa.set(C,xa.get(C)+1);for(var L=arguments.length,B=new Array(L>3?L-3:0),V=3;V<L;V++)B[V-3]=arguments[V];const J=yield O(...B);return xa.set(C,xa.get(C)-1),xa.get(C)===D-1&&P.length>0&&(P[0].resolve(),P.shift()),0===xa.get(C)&&(i_.set(C,[]),r_.set(C,0),xa.set(C,0)),J}),function(C,b,O){return y.apply(this,arguments)})("client.join",H("JOIN_MAX_CONCURRENCY"),f.join.bind(f),i,r,a,l,d);var y})()}join(i,r,a,l,d){var h=this;return x(function*(){const f=++h._numberOfJoinCount;h.store.joinStart(),l&&(h.store.uid=l);const m="HTTPS"===(pE||pE||(pE=(window.location.protocol.split(":")[0]||"").toUpperCase(),pE)),g=SD()?window.isSecureContext:"Browser Not Support";(SD()||m)&&window.isSecureContext||R.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");const E=OS();"DISCONNECTED"===h.connectionState&&(h.store.avoidJoinStart=Math.round(Date.now()),R.debug("[".concat(h._clientId,"] set avoidJoinStart to ").concat(h.store.avoidJoinStart)));const y=Te.reportApiInvoke(E,{name:jn.JOIN,options:[i,r,a,l],states:{isHttps:m,isSecureContext:g},tag:Kt.TRACER});Te.setAppId(i);try{if(!a&&null!==a)throw new K(k.INVALID_PARAMS,"Invalid token: ".concat(a,". If you don not use token, set it to null"));a&&Vi(a,"token",1,2047),Vi(i,"appid",1,2047),iT(r),l&&rT(l),d&&Vi(d,"optionalInfo",1,2047)}catch(D){throw y.onError(D),D}if(R.info("[".concat(h._clientId,"] start join channel ").concat(r,", join number: ").concat(f)),h._leaveMutex.isLocked&&(R.debug("[".concat(h._clientId,"] join: waiting leave operation")),(yield h._leaveMutex.lock())(),R.debug("[".concat(h._clientId,"] join: continue"))),h._joinAndNotLeaveYet=!0,"DISCONNECTED"!==h.connectionState){const D=new K(k.INVALID_OPERATION,"[".concat(h._clientId,"] Client already in connecting/connected state"));throw y.onError(D),D}h._sessionId||(h._sessionId=E,h.store.sessionId=h._sessionId),h._gateway.state="CONNECTING";const C=Op({clientId:h._clientId,appId:i,sid:h._sessionId,cname:r,uid:"string"!=typeof l?l:null,turnServer:h._turnServer,proxyServer:h._proxyServer,token:a||i,cloudProxyServer:h._cloudProxyServerMode,optionalInfo:d,license:h._license,useLocalAccessPoint:h._useLocalAccessPoint},void 0!==h._remoteDefaultVideoStreamType&&{defaultVideoStream:h._remoteDefaultVideoStreamType});if(h._useLocalAccessPoint&&(C.setLocalAPVersion=h._setLocalAPVersion),"string"==typeof l&&(C.stringUid=l,h._uintUid?(C.uid=h._uintUid,h._uintUid=void 0):C.uid=0),"none"!==h._encryptionMode&&h._encryptionSecret){if(C.aesmode=h._encryptionMode,C.aespassword=yield MA(h._encryptionSecret),!h._joinAndNotLeaveYet)throw new K(k.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));h._encryptionSalt&&(C.aessalt=h._encryptionSalt)}h._startSession(h._sessionId,{channel:r,appId:i});const b=h._sessionId;setTimeout(()=>{"CONNECTING"===h.connectionState&&b===h._sessionId&&Te.joinChannelTimeout(h._sessionId,5)},5e3);try{var O;let D;const L=C.cloudProxyServer;if(we(O=["proxy3","proxy4","proxy5"]).call(O,L)){const ae=H("PROXY_SERVER_TYPE3");C.proxyServer=Array.isArray(ae)?ae[0]:ae}if(Te.setProxyServer(C.proxyServer),R.setProxyServer(C.proxyServer),h.store.requestAPStart(),C.stringUid&&!C.uid){const ae=yield Ea(C.stringUid,C,h._axiosCancelSource.token,h._config.httpRetryConfig||Wn,h.store);R.debug("[".concat(h._clientId,"] getUserAccount Success ").concat(C.stringUid," => ").concat(ae)),C.uid=ae,D=yield d2(C,h._axiosCancelSource.token,h._config.httpRetryConfig||Wn,!0,h.store)}else D=yield d2(C,h._axiosCancelSource.token,h._config.httpRetryConfig||Wn,!0,h.store);if(!h._joinAndNotLeaveYet)throw new K(k.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));h.store.requestAPEnd(),setTimeout(()=>{h._configDistribute.startGetConfigDistribute(C,h._axiosCancelSource.token),h._configDistribute.on(v_.UPDATE_BITRATE_LIMIT,ae=>{h._p2pChannel.updateBitrateLimit(ae)})},0),h._key=a||i;const B=D.gatewayInfo;h._joinInfo=Op(Op({},C),{},{cid:B.cid,uid:C.uid?C.uid:B.uid,vid:B.vid,apResponse:B.res,uni_lbs_ip:B.uni_lbs_ip,gatewayAddrs:B.gatewayAddrs});const V=yield h._joinGateway();if(!h._joinAndNotLeaveYet)throw new K(k.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));y.onSuccess(V),h._appId=i,h._channelName=C.cname,h._uid=V,h.store.uid=V,setTimeout(()=>{h._networkQualityInterval&&window.clearInterval(h._networkQualityInterval),h._networkQualityInterval=window.setInterval(h._handleUpdateNetworkQuality,2e3),window.addEventListener(Yt()?"beforeunload":"pagehide",h._handleBeforeUnload)},0);const J=C.stringUid?"string uid: ".concat(C.stringUid,",uid: ").concat(C.uid):"uid: ".concat(h._uid);return R.info("[".concat(h._clientId,"] Joining channel success: channel: ").concat(r,",").concat(J)),setTimeout(()=>{R.startUpload()},5e3),h.store.joinEnd(),P=h,we(Oc).call(Oc,P)||Oc.push(P),V}catch(D){const L=Array.isArray(D)?D[0]:D;throw L&&L.code===k.OPERATION_ABORTED?R.warning("[".concat(h._clientId,"] join number: ").concat(f,", Joining channel failed, rollback"),L):R.error("[".concat(h._clientId,"] join number: ").concat(f,", Joining channel failed, rollback"),L),L.code!==k.OPERATION_ABORTED&&h._numberOfJoinCount===f&&(h._gateway.state="DISCONNECTED",h._reset()),y.onError(L),L}var P})()}_joinGateway(){if(!this._joinInfo||!this._key)throw new K(k.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!H("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(i=>i).catch(i=>{if(i.code===k.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,$e.FALLBACK),i;if(i.code===k.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,$e.FALLBACK),i;throw i}).then(i=>{if(i instanceof K){if(i.code===k.INIT_WEBSOCKET_TIMEOUT){if(R.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new K(k.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const r=H("PROXY_SERVER_TYPE3");if(Array.isArray(r))if(this._joinInfo.apUrl){const l=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),d=l.slice(l.length-2).join(".");r.forEach(h=>{this._joinInfo&&we(h).call(h,d)&&(this._joinInfo.proxyServer=h)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=r[0])}else this._joinInfo.proxyServer=r[0];else this._joinInfo.proxyServer=r;const a=H("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return a&&a[1]&&"443"!==a[1]&&R.setProxyServer(this._joinInfo.proxyServer),"443"!==H("STATS_COLLECTOR_PORT").toString()&&Te.setProxyServer(this._joinInfo.proxyServer),Te.reportApiInvoke(this._sessionId,{name:jn.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:Kt.TRACER}).onSuccess(),this.safeEmit(We.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),H("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(l=>{"forceturn"in l&&(l.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(R.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new K(k.INVALID_OPERATION);return Te.reportApiInvoke(this._sessionId,{name:jn.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:Kt.TRACER}).onSuccess(),this._joinGateway()}return i}).then(i=>i)}leave(){var i=this;return x(function*(){R.info("[".concat(i._clientId,"] Leaving channel")),window.removeEventListener(Yt()?"beforeunload":"pagehide",i._handleBeforeUnload),i._reset(),function(a){const l=Oc.indexOf(a);-1!==l&&Oc.splice(l,1)}(i);const r=yield i._leaveMutex.lock();if("DISCONNECTED"===i.connectionState)return R.info("[".concat(i._clientId,"] Leaving channel repeated, success")),void r();yield i._gateway.leave("CONNECTED"!==i.connectionState),R.info("[".concat(i._clientId,"] Leaving channel success")),i._joinAndNotLeaveYet=!1,i.store.resetJoinChannelServiceRecords(),r()})()}publish(i){var r=arguments,a=this;return x(function*(){let l=!(r.length>1&&void 0!==r[1])||r[1];if(!Array.isArray(i)){if(!(i instanceof jt))return a._publishDataChannel(i);i=[i]}if(0===i.length)throw new K(k.INVALID_PARAMS,"param list is empty");const d=i;if("audience"===a._gateway.role)throw new K(k.INVALID_OPERATION,"audience can not publish stream");for(const f of d){if(!(f instanceof jt))throw new K(k.INVALID_PARAMS,"parameter is not local track");if(!f._enabled&&l)throw new K(k.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(f.getTrackId()))}R.info("[".concat(a._clientId,"] Publishing tracks, id ").concat(d.map(f=>"".concat(f.getTrackId()," "))));const h=yield a._publishMutex.lock();yield a._configDistribute.awaitConfigDistributeComplete(),l&&d.forEach(f=>{const m=a._configDistribute.getBitrateLimit();f instanceof Ye&&m&&f.setBitrateLimit(m.uplink)});try{yield a._publishHighStream(d),R.info("[".concat(a._clientId,"] Publish success, id ").concat(d.map(f=>"".concat(f.getTrackId()," "))))}catch(f){throw R.error("[".concat(a._clientId,"] publish error"),f.toString()),f}finally{h()}})()}_publishDataChannel(i){var r=this;return x(function*(){Ut(i.id,"id",0,65535,!0),$d(i.ordered,"ordered"),Vi(i.metadata,"metadata",0,512),R.info("[".concat(r._clientId,"] Publishing datachannels, id ").concat(i.id));const a=yield r._publishMutex.lock();try{if(-1!==r._p2pChannel.getAllDataChannels().findIndex(d=>d.id===i.id))throw new K(k.INVALID_PARAMS,"Invalid id: ".concat(i.id,". If you want to republish the datachannel, unpublish first"));if(!r._joinInfo||void 0===r._uid)throw new K(k.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new K(k.INVALID_OPERATION,"can not publish datachannel in ".concat(r.connectionState," state"));if("auto"===r._turnServer.mode&&H("FORCE_TURN")&&!H("TURN_ENABLE_TCP")&&!H("TURN_ENABLE_UDP"))throw new K(k.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const l=new B_(i);yield r._p2pChannel.publishDataChannel([l]);try{const d={streamId:i.id,ordered:i.ordered,maxRetransmits:H("DATASTREAM_MAX_RETRANSMITS"),metadata:i.metadata,channelId:l._originDataChannelId};yield r._gateway.publishDataChannel(r._uid,d,!0)}catch(d){if(d.code!==k.DISCONNECT_P2P)throw d}return yield l._waitTillOpen(),R.info("[".concat(r._clientId,"] Publish dataChannels success, id ").concat(l.id)),l}catch(l){throw R.error("[".concat(r._clientId,"] publish datachannels error"),l.toString()),l}finally{a()}})()}unpublish(i){var r=this;return x(function*(){if(!r._joinInfo||void 0===r._uid)throw new K(k.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let a=[];if(i)if(Array.isArray(i))a=i;else{if(!(i instanceof jt))return r._unpublishDataChannel([i]);a=[i]}else r.store.useP2P||(yield r._unpublishDataChannel()),a=r._p2pChannel.getAllTracks(!0);R.info("[".concat(r._clientId,"] Unpublish tracks, tracks ").concat(a.map(d=>"".concat(d.getTrackId()," "))," "));const l=yield r._publishMutex.lock();try{if(r._p2pChannel instanceof In){const d=yield r._p2pChannel.unpublish(a);if(d){const h=yield r._gateway.sendExtensionMessage($t.UNPUBLISH,d);h&&(yield r._p2pChannel.setDescription("local",h))}}else{const d=yield r._p2pChannel.unpublish(a);d&&(yield r._gateway.unpublish(d,r._uid)),R.info("[".concat(r._clientId,"] Unpublish success,tracks ").concat(a.map(h=>"".concat(h.getTrackId()))))}}catch(d){throw R.error("[".concat(r._clientId,"] unpublish error"),d.toString()),d}finally{l&&l()}})()}_unpublishDataChannel(i){var r=this;return x(function*(){void 0!==i&&0!==i.length||(i=r._p2pChannel.getAllDataChannels()),R.info("[".concat(r._clientId,"] Unpublish datachannels, datachannels ").concat(i.map(l=>"".concat(l.id," "))," "));const a=yield r._publishMutex.lock();try{const l=yield r._p2pChannel.unpublishDataChannel(i);l&&(yield r._gateway.unpublishDataChannel(l)),R.info("[".concat(r._clientId,"] Unpublish dataChannel success,dataChannel ").concat(i.map(d=>"".concat(d.id))))}catch(l){throw R.error("[".concat(r._clientId,"] unpublish dataChannel error"),l.toString()),l}finally{a&&a()}})()}subscribe(i,r,a){var l=this;return x(function*(){return"datachannel"===r?l._subscribeDataChannel(i,a):l._subscribe(i,r)})()}_subscribeDataChannel(i,r){var a=this;return x(function*(){var l;if(Ut(r,"channelId",0,65535,!0),!a._joinInfo)throw new K(k.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==a.connectionState&&"RECONNECTING"!==a.connectionState)throw new K(k.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(a.connectionState," state"));if(!a._users.find(m=>m===i))throw R.error("[".concat(a._clientId,"] can not subscribe ").concat(i.uid,", this user is not in the channel")),new K(k.INVALID_REMOTE_USER,"user is not in the channel");if(!i.hasAudio&&!i.hasVideo&&0===i._dataChannels.length)throw R.error("[".concat(a._clientId,"] can not subscribe ").concat(i.uid,", user is not published")),new K(k.INVALID_REMOTE_USER,"user is not published");const d=null===(l=i._dataChannels)||void 0===l?void 0:l.find(m=>m.id===r);if(!d)throw R.error("[".concat(a._clientId,"] can not subscribe ").concat(i.uid," with mediaType datachannel, remote datachannel is not published")),new K(k.REMOTE_USER_IS_NOT_PUBLISHED);const h=yield a._subscribeMutex.lock();R.info("[".concat(a._clientId,"] subscribe user ").concat(i.uid,", mediaType: datachannel"));try{const m=yield a._p2pChannel.subscribeDataChannel(i,[d]);if(m&&we(m).call(m,d.id))try{var f;if(!d._originDataChannelId)throw R.error("[".concat(a._clientId,"] can not subscribe ").concat(i.uid," with mediaType datachannel, cannot get RTCDatachannel")),new K(k.REMOTE_USER_IS_NOT_PUBLISHED);const g={id:d.id,datachannelId:d._originDataChannelId,ordered:d.ordered,maxRetransmits:d.maxRetransmits,metadata:null!==(f=d.metadata)&&void 0!==f?f:""};yield a._gateway.subscribeDataChannel(i.uid,g,!0)}catch(g){if((null==g?void 0:g.code)!==k.WS_ABORT)throw yield a._p2pChannel.unsubscribeDataChannel(i,[d]),g;yield a._p2pChannel.unsubscribeDataChannel(i,[d]),a._p2pChannel.setPendingRemoteDataChannel(i,d.id)}return yield d._waitTillOpen(),R.info("[".concat(a._clientId,"] subscribe success user ").concat(i.uid,", mediaType: datachannel")),d}finally{h()}})()}_p2pSubscribe(i,r,a){var l=this;return x(function*(){if(pi(r,"mediaType",["audio","video"]),!l._joinInfo)throw new K(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==l.connectionState&&"RECONNECTING"!==l.connectionState)throw new K(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(l.connectionState," state"));if(!l._users.find(f=>f===i)){const f=new K(k.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(l._clientId,"] can not subscribe ").concat(i.uid,", this user is not in the channel")),f}if(!i.hasAudio&&!i.hasVideo){const f=new K(k.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(l._clientId,"] can not subscribe ").concat(i.uid,", user is not published")),f}if(!a&&("audio"===r&&!i.hasAudio||"video"===r&&!i.hasVideo)){const f=new K(k.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(l._clientId,"] can not subscribe ").concat(i.uid," with mediaType ").concat(r,", remote track is not published")),f}const d=yield l._subscribeMutex.lock();R.info("[".concat(l._clientId,"] subscribe user ").concat(i.uid,", mediaType: ").concat(r));const h="audio"===r?se.LocalAudioTrack:l._joinInfo.defaultVideoStream===Fl.LOW_STREAM?se.LocalVideoLowTrack:se.LocalVideoTrack;try{(yield l._p2pChannel.hasRemoteMediaWithLock(i,r))?yield l._p2pChannel.unmuteRemote(i,r):(l.store.subscribe(i.uid,r,Date.now()),l._p2pChannel instanceof In&&(yield l._gateway.sendExtensionMessage($t.SUBSCRIBE,{trackType:h}))),R.info("[".concat(l._clientId,"] subscribe success user ").concat(i.uid,", mediaType: ").concat(r)),l._defaultStreamFallbackType&&l.setStreamFallbackOption(i.uid,l._defaultStreamFallbackType).catch(m=>{R.warning("[".concat(l._clientId,"] auto set fallback failed"),m)});const f="audio"===r?i._audioTrack:i._videoTrack;if(!f)throw new K(k.UNEXPECTED_ERROR,"can not find remote track in user object");return f}catch(f){throw R.error("[".concat(l._clientId,"] subscribe user ").concat(i.uid," error"),f),f}finally{d()}})()}_subscribe(i,r,a){var l=this;return x(function*(){if(l._p2pChannel instanceof In)return l._p2pSubscribe(i,r);if(pi(r,"mediaType",["audio","video"]),!l._joinInfo)throw new K(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==l.connectionState&&"RECONNECTING"!==l.connectionState)throw new K(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(l.connectionState," state"));if(!l._users.find(E=>E===i)){const E=new K(k.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(l._clientId,"] can not subscribe ").concat(i.uid,", this user is not in the channel")),E}if(!i.hasAudio&&!i.hasVideo){const E=new K(k.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(l._clientId,"] can not subscribe ").concat(i.uid,", user is not published")),E}if(!(a||("audio"!==r||i.hasAudio&&void 0!==i._audioSSRC)&&("video"!==r||i.hasVideo&&void 0!==i._videoSSRC))){const E=new K(k.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(l._clientId,"] can not subscribe ").concat(i.uid," with mediaType ").concat(r,", remote track is not published")),E}let d="audio"===r?i._audioSSRC:i._videoSSRC,h="audio"===r?i._audioOrtc:i._videoOrtc,f="video"===r?i._rtxSsrcId:void 0,m={stream_type:"audio"===r?ye.AUDIO:ye.VIDEO,ssrcId:d};const g=yield l._subscribeMutex.lock();R.info("[".concat(l._clientId,"] subscribe user ").concat(i.uid,", mediaType: ").concat(r));try{if(yield l._p2pChannel.hasRemoteMediaWithLock(i,r))yield l._p2pChannel.unmuteRemote(i,r);else try{const y="audio"===r?i._audioSSRC:i._videoSSRC;void 0!==y&&y!==d&&(d=y,h="audio"===r?i._audioOrtc:i._videoOrtc,f="video"===r?i._rtxSsrcId:void 0,m={stream_type:"audio"===r?ye.AUDIO:ye.VIDEO,ssrcId:d}),Ni.markSubscribeStart(l.store.clientId,d),l.store.subscribe(i.uid,r,Date.now()),yield l._p2pChannel.subscribe(i,r,d,f,h);try{yield l._gateway.subscribe(i.uid,m,!0)}catch(C){if((null==C?void 0:C.code)!==k.WS_ABORT)throw yield l._p2pChannel.unsubscribe(i,r),C;yield l._p2pChannel.unsubscribe(i,r,!0),l._p2pChannel.setPendingRemoteMedia(i,r)}l.store.subscribe(i.uid,r,void 0,Date.now()),l._p2pChannel.reportSubscribeEvent(!0,null,i,r)}catch(y){throw l._p2pChannel.reportSubscribeEvent(!1,null==y?void 0:y.code,i,r),y}R.info("[".concat(l._clientId,"] subscribe success user ").concat(i.uid,", mediaType: ").concat(r)),l._defaultStreamFallbackType&&l.setStreamFallbackOption(i.uid,l._defaultStreamFallbackType).catch(y=>{R.warning("[".concat(l._clientId,"] auto set fallback failed"),y)});const E="audio"===r?i._audioTrack:i._videoTrack;if(!E)throw new K(k.UNEXPECTED_ERROR,"can not find remote track in user object");return E}catch(E){throw R.error("[".concat(l._clientId,"] subscribe user ").concat(i.uid," error"),E),E}finally{g()}})()}massSubscribe(i){var r=this;return x(function*(){if(Ic(i,"subscribeList"),!r._joinInfo)throw new K(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new K(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(r.connectionState," state"));const a=Date.now(),l=new Map,d=yield r._subscribeMutex.lock();R.info("[".concat(r._clientId,"]start massSubscribe user ").concat(i.map(g=>{let{user:E,mediaType:y}=g;return"user: ".concat(null==E?void 0:E.uid,", mediaType: ").concat(y)}).join("; ")));const h=(i=[...i]).map(g=>{let{user:E,mediaType:y}=g;return{user:E,mediaType:y}}),f=yield r._p2pChannel.globalLock();try{var m;for(let E=i.length-1;E>=0;E--){const y=i[E],{user:C,mediaType:b}=y;if(pi(b,"mediaType",["audio","video"]),!C){const D=new K(k.INVALID_PARAMS,"user property does not exist in subscribeList item");throw R.error("[".concat(r._clientId,"] user property does not exist in subscribeList item")),D}if(!r._users.find(D=>D===C)){const D=new K(k.INVALID_REMOTE_USER,"user is not in the channel");R.error("[".concat(r._clientId,"] can not massSubscribe ").concat(C.uid,", this user is not in the channel")),h[E].error=D,i.splice(E,1);continue}if("audio"===b&&(!C.hasAudio||void 0===C._audioSSRC)||"video"===b&&(!C.hasVideo||void 0===C._videoSSRC)){const D=new K(k.REMOTE_USER_IS_NOT_PUBLISHED);R.error("[".concat(r._clientId,"] can not subscribe ").concat(C.uid," with mediaType ").concat(b,", remote user is not published")),h[E].error=D,i.splice(E,1);continue}const O=Kn.Video|Kn.LwoVideo,P=l.get(C);if(P){if("video"===b?P&O:P&Kn.Audio){i.splice(E,1),R.warning("[".concat(r._clientId,"] repeat massSubscribe user:").concat(C.uid,", mediaType:").concat(b," twice"));continue}l.set(C,P|("video"===b?O:Kn.Audio))}else l.set(C,"video"===b?O:Kn.Audio)}for(let E=i.length-1;E>=0;E--){const y=i[E],{user:C,mediaType:b}=y,O=Kn.Video|Kn.LwoVideo;if(r._p2pChannel.hasRemoteMedia(C,b)){yield r._p2pChannel.unmuteRemoteNoLock(C,b);const P=l.get(C);l.set(C,"video"===b?P^O:P^Kn.Audio),i.splice(E,1)}}r.store.massSubscribe(i.map(E=>({userId:E.user.uid,type:E.mediaType})),a);const g=Ba(m=Array.from(l.entries())).call(m,(E,y)=>{let[C,b]=y;if(0===b)return E;const O={stream_id:C.uid,stream_type:b};return b&Kn.Audio&&(O.audio_ssrc=C._audioSSRC),b&Kn.Video&&(O.video_ssrc=C._videoSSRC),E.push(O),E},[]);try{i.length>0&&(yield r._p2pChannel.massSubscribeNoLock(i.map(y=>{let{user:C,mediaType:b}=y;return{user:C,mediaType:b,ssrcId:b===ye.VIDEO?C._videoSSRC:C._audioSSRC,rtxSsrcId:b===ye.VIDEO?C._rtxSsrcId:void 0}})));const E=new Map;if(g.length>0){const y=yield r._gateway.subscribeAll(g,!0);((null==y?void 0:y.users)||[]).forEach(C=>{let{stream_id:b,video_error_code:O,audio_error_code:P,error_code:D}=C;(O||P||D)&&E.set(b,{video_error_code:O,audio_error_code:P,error_code:D})})}if(Array.from(E.entries()).length>0){const y=Array.from(E.entries()).map(C=>{let b,[O,P]=C;return P.error_code||P.video_error_code&&P.audio_error_code?b=void 0:P.video_error_code?b=ye.VIDEO:P.audio_error_code&&(b=ye.AUDIO),{user:r.remoteUsers.find(D=>D.uid===O),mediaType:b}});yield r._p2pChannel.massUnsubscribeNoLock(y)}for(const y of h){const C=E.get(y.user.uid);if(C){const b=C.error_code||"audio"===y.mediaType&&C.audio_error_code||"video"===y.mediaType&&C.video_error_code;if(b){const O=lu(b);R.error("user:".concat(y.user.uid," mediaType:").concat(y.mediaType," has massSubscribe error ").concat(O.desc)),y.error=new K(k.SUBSCRIBE_FAILED,"code ".concat(b,": ").concat(O.desc))}}y.error||(y.track="video"===y.mediaType?y.user.videoTrack:y.user.audioTrack)}return r.store.massSubscribe(h.filter(y=>!y.error).map(y=>({userId:y.user.uid,type:y.mediaType})),void 0,Date.now()),h.forEach(y=>{var C;Te.subscribe(r.store.sessionId,{succ:!!y.error,ec:(null===(C=y.error)||void 0===C?void 0:C.code)||null,video:y.mediaType===ye.VIDEO,audio:y.mediaType===ye.AUDIO,peerid:y.user.uid,subscribeRequestid:y.mediaType===ye.VIDEO?y.user._videoSSRC:y.user._audioSSRC,p2pid:r.store.p2pId,eventElapse:Math.floor(performance.now()-a)},!0)}),R.info("[".concat(r._clientId,"] massSubscribe success ").concat(i.map(y=>{let{user:C,mediaType:b}=y;return"user: ".concat(null==C?void 0:C.uid,", mediaType: ").concat(b)}).join("; "))),h}catch(E){throw yield r._p2pChannel.massUnsubscribeNoLock(i),E}}finally{f(),d()}})()}unsubscribe(i,r,a){var l=this;return x(function*(){if(r||l.store.useP2P){if("datachannel"===r)return l._unsubscribeDataChannel(i,a)}else yield l._unsubscribeDataChannel(i,a);if(r&&pi(r,"mediaType",["audio","video"]),!l._joinInfo)throw new K(k.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!l._users.find(h=>h===i)){const h=new K(k.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(l._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),h}R.info("[".concat(l._clientId,"] unsubscribe uid: ").concat(i.uid,", mediaType: ").concat(r));const d=yield l._subscribeMutex.lock();try{if(l._p2pChannel instanceof In)yield l._gateway.sendExtensionMessage($t.UNSUBSCRIBE,{mediaType:r});else{const h=yield l._p2pChannel.unsubscribe(i,r);h&&(yield l._gateway.unsubscribe(h,i.uid)),R.info("[".concat(l._clientId,"] unsubscribe success uid: ").concat(i.uid,", mediaType: ").concat(r))}}catch(h){if(h.code===k.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(l._clientId,"] unsubscribe user ").concat(i.uid," error"),h.toString()),h}finally{d()}})()}_unsubscribeDataChannel(i,r){var a=this;return x(function*(){if(r&&Ut(r,"id",0,65535,!0),!a._joinInfo)throw new K(k.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!a._users.find(d=>d===i)){const d=new K(k.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(a._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),d}let l;if("number"==typeof r){const d=i._dataChannels.find(h=>h.id===r);d&&(l=[d])}else l=i._dataChannels;if(void 0===l){const d=new K(k.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(a._clientId,"] can not unsubscribe ").concat(i.uid," with channelId ").concat(r,", remote datachannel is not published")),d}R.info("[".concat(a._clientId,"] unsubscribe uid: ").concat(i.uid,", mediaType: datachannel, ids: ").concat(l.map(d=>d.id)));try{const d=yield a._p2pChannel.unsubscribeDataChannel(i,l);d&&(yield a._gateway.unsubscribeDataChannel(d,i.uid)),R.info("[".concat(a._clientId,"] unsubscribe datachannel success uid: ").concat(i.uid,", mediaType: datachannel, ids: ").concat(d))}catch(d){if(d.code===k.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(a._clientId,"] unsubscribe user ").concat(i.uid," error"),d.toString()),d}})()}massUnsubscribe(i){var r=this;return x(function*(){if(Ic(i,"unsubscribeList"),!r._joinInfo)throw new K(k.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");R.info("[".concat(r._clientId,"] start massUnsubscribe ").concat(i.map(l=>{let{user:d,mediaType:h}=l;return"user: ".concat(null==d?void 0:d.uid,", mediaType: ").concat(h,";")}).join())),i=[...i];const a=new Map;for(let l=i.length-1;l>=0;l--){const{user:d,mediaType:h}=i[l];if(!d){const m=new K(k.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw R.error("[".concat(r._clientId,"] user property does not exist in unsubscribeList item")),m}if(pi(h,"mediaType",["video","audio",void 0]),!r._users.find(m=>m===d)){R.warning("[".concat(r._clientId,"] can not unsubscribe ").concat(d.uid,", user is not in the channel")),i.splice(l,1);continue}const f=Kn.Video|Kn.LwoVideo;if(a.has(d)){const m=a.get(d);let g;switch(h){case"video":g=m&f;break;case"audio":g=m&Kn.Audio;break;default:g=m&(Kn.Audio|f)}if(g){R.warning("[".concat(r._clientId,"] repeat massUnsubscribe user:").concat(d.uid,",mediaType:").concat(h," twice.")),i.splice(l,1);continue}h?"audio"===h?a.set(d,m|Kn.Audio):"video"===h&&a.set(d,m|f):a.set(d,m|Kn.Audio|f)}else h?"audio"===h?a.set(d,Kn.Audio):"video"===h&&a.set(d,f):a.set(d,Kn.Audio|f)}try{const l=yield r._p2pChannel.massUnsubscribe(i);l&&(yield r._gateway.massUnsubscribe(l)),R.info("[".concat(r._clientId,"] massUnsubscribe success ").concat(i.map(d=>{let{user:h,mediaType:f}=d;return"user: ".concat(null==h?void 0:h.uid,", mediaType: ").concat(f,";")}).join()))}catch(l){if(l.code===k.DISCONNECT_P2P)return void R.warning("[".concat(r._clientId,"] disconnecting p2p, abort unsubscribe request."));throw R.error("[".concat(r._clientId,"] massUnsubscribe error"),l.toString()),l}})()}setLowStreamParameter(i){var r=this;return x(function*(){(function(l){if(!l)throw new ne(k.INVALID_PARAMS);En(l.width)||bS(l.width,"streamParameter.width"),En(l.height)||bS(l.height,"streamParameter.height"),En(l.framerate)||bS(l.framerate,"streamParameter.framerate"),En(l.bitrate)||Ut(l.bitrate,"streamParameter.bitrate")})(i),(!i.width&&i.height||i.width&&!i.height)&&R.warning("[".concat(r._clientId,"] The width and height parameters take effect only when both are set")),R.info("[".concat(r._clientId,"] set low stream parameter to"),JSON.stringify(i));const a=r._configDistribute.getLowStreamConfigDistribute();if(a&&a.bitrate&&i.bitrate&&a.bitrate<i.bitrate&&(i.bitrate=a.bitrate),r._lowStreamParameter=i,r._isDualStreamEnabled)return r._p2pChannel.updateVideoStreamParameter(i,se.LocalVideoLowTrack)})()}enableDualStream(){var i=this;return x(function*(){if(!Rt().supportDualStream)throw Te.streamSwitch(i._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new K(k.NOT_SUPPORTED,"Your browser is not support dual stream");if(i._isDualStreamEnabled)throw new K(k.INVALID_OPERATION,"Dual stream is already enabled");if(i._p2pChannel.canPublishLowStream())try{yield i._publishLowStream()}catch(r){throw Te.streamSwitch(i._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),r}i._isDualStreamEnabled=!0,Te.streamSwitch(i._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),R.info("[".concat(i._clientId,"] enable dual stream"))})()}disableDualStream(){var i=this;return x(function*(){if(i._isDualStreamEnabled){if(!i._joinInfo)throw new K(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(i._p2pChannel.getLocalMedia(se.LocalVideoLowTrack))try{const r=yield i._p2pChannel.unpublishLowStream();r&&(yield i._gateway.unpublish(r,i._joinInfo.stringUid||i._joinInfo.uid))}catch(r){throw Te.streamSwitch(i._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),r}i._isDualStreamEnabled=!1,Te.streamSwitch(i._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),R.info("[".concat(i._clientId,"] disable dual stream"))}})()}setClientRole(i,r){var a=this;return x(function*(){if(pi(i,"role",["audience","host"]),r&&ke(r),"rtc"===a.mode)throw R.warning("[".concat(a._clientId,"]rtc mode can not use setClientRole")),new K(k.INVALID_OPERATION,"rtc mode can not use setClientRole");if(r&&r.level&&"host"===i)throw new K(k.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===i&&a._p2pChannel.hasLocalMedia())throw new K(k.INVALID_OPERATION,"can not set client role to audience when publishing stream");yield a._gateway.setClientRole(i,r),a._config.role=i,R.info("[".concat(a._clientId,"] set client role to ").concat(i,", level: ").concat(r&&r.level))})()}getRemoteInboundOffset(){var i;const r=null===(i=this._p2pChannel.getStats())||void 0===i?void 0:i.audioSend[0];if(!r||!r.timestamp)return 0;const a=r.timestamp-Date.now();return Math.abs(a)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?a:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(i,r){if(Vi(i,"proxyServer"),!r){if("DISCONNECTED"!==this.connectionState)throw new K(k.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new K(k.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=i,Te.setProxyServer(this._proxyServer),R.setProxyServer(this._proxyServer),R.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(i,r){if(Array.isArray(i)||(i=[i]),!r){if("DISCONNECTED"!==this.connectionState)throw new K(k.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new K(k.INVALID_OPERATION,"You have already set the proxy")}if(Qd(i))return this._turnServer={servers:i,mode:"original-manual"},void R.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(i.map(a=>a.urls).join(","),"."));i.forEach(a=>RL(a)),this._turnServer={servers:i,mode:"manual"},R.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(i){if("DISCONNECTED"!==this.connectionState)throw new K(k.INVALID_OPERATION,"you should set license before join channel");if(Vi(i,"license",32,32),!/^[A-Za-z\d]+$/.test(i))throw new K(k.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=i,R.info("[".concat(this._clientId,"] set license success"),i)}startProxyServer(i){if("DISCONNECTED"!==this.connectionState)throw new K(k.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new K(k.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let a;switch(void 0===i&&(i=3),i){case 1:case 2:throw new K(k.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:a="proxy3";break;case 4:a="proxy4";break;case 5:a="proxy5";break;default:throw new K(k.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=a,this.store.cloudProxyServerMode=a,R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new K(k.INVALID_OPERATION,"Stop proxy server after leave channel");Te.setProxyServer(),R.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(i){if(!i.accessPoints)throw new K(k.INVALID_PARAMS,"accessPoints is required.");Ic(i.accessPoints.serverList,"accessPoints.serverList"),Vi(i.accessPoints.domain,"accessPoints.domain");const r=(b,O)=>{Ut(b,O,0,65535,!0)};let a=443;if(i.accessPoints.port&&(r(i.accessPoints.port,"accessPoints.port"),a=i.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new K(k.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");H("CLOSE_AFB_FOR_LOCAL_AP")&&(Bt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Bt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const l=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,d=i.accessPoints.domain,h=i.accessPoints.serverList.map(b=>l.test(b)?"".concat(b.replace(/\./g,"-"),".").concat(d):b),f=h.map(b=>"".concat(b,":").concat(a));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Bt("WEBCS_DOMAIN",f),Bt("WEBCS_DOMAIN_BACKUP_LIST",f),Bt("GATEWAY_DOMAINS",[d]),i.report&&i.report.hostname&&Array.isArray(i.report.hostname)&&i.report.hostname.length?(Ic(i.report.hostname,"report.hostname"),Bt("EVENT_REPORT_DOMAIN",i.report.hostname[0]),Bt("EVENT_REPORT_BACKUP_DOMAIN",i.report.hostname[1]||i.report.hostname[0])):(Bt("EVENT_REPORT_DOMAIN",h[0]),Bt("EVENT_REPORT_BACKUP_DOMAIN",h[1]||h[0]));let m=6443;i.report&&i.report.port&&(r(i.report.port,"report.port"),m=i.report.port),Bt("STATS_COLLECTOR_PORT",m),Bt("ENABLE_EVENT_REPORT",!!i.report);let g="";i.log&&i.log.hostname&&Array.isArray(i.log.hostname)&&i.log.hostname.length?(Ic(i.log.hostname,"log.hostname"),g=i.log.hostname[0]):g=h[0];let E=6444;i.log&&i.log.port&&(r(i.log.port,"log.port"),E=i.log.port),Bt("LOG_UPLOAD_SERVER","".concat(g,":").concat(E));let y=[];i.cds&&i.cds.hostname&&Array.isArray(i.cds.hostname)&&i.cds.hostname.length?(Ic(i.cds.hostname,"cds.hostname"),y=i.cds.hostname):y=h;let C=443;i.cds&&i.cds.port&&(r(i.cds.port,"cds.port"),C=i.cds.port),Bt("CDS_AP",y.map(b=>"".concat(b,":").concat(C))),Bt("ENABLE_CONFIG_DISTRIBUTE",!!i.cds),R.info("set local access point v2 success")}setLocalAccessPoints(i,r){if(Ic(i,"serverList"),Vi(r,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new K(k.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const a=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;i=i.map(l=>a.test(l)?"".concat(l.replace(/\./g,"-"),".").concat(r):l),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Bt("WEBCS_DOMAIN",i),Bt("WEBCS_DOMAIN_BACKUP_LIST",i),Bt("GATEWAY_DOMAINS",[r]),Bt("EVENT_REPORT_DOMAIN",i[0]),Bt("EVENT_REPORT_BACKUP_DOMAIN",i[1]||i[0]),Bt("LOG_UPLOAD_SERVER","".concat(i[0],":6444")),R.info("[".concat(this._clientId,"] set local access point success"))}setRemoteDefaultVideoStreamType(i){var r=this;return x(function*(){if(pi(i,"streamType",[0,1]),r._remoteDefaultVideoStreamType=i,r._joinInfo)try{yield r._gateway.setDefaultRemoteVideoStreamType(i),r._joinInfo.defaultVideoStream=r._remoteDefaultVideoStreamType}catch(a){throw R.error("[".concat(r._clientId,"] set default remote video stream type error"),a.toString()),a}else R.debug("[".concat(r._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(i))})()}setRemoteVideoStreamType(i,r){var a=this;return x(function*(){pi(r,"streamType",[0,1]);try{yield a._gateway.setRemoteVideoStreamType(i,r),setTimeout(()=>{const l=a._users.find(d=>d.uid===i);l&&l.videoTrack&&l.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(l){throw R.error("[".concat(a._clientId,"] set remote video stream type error"),l.toString()),l}R.info("[".concat(a._clientId,"] set remote ").concat(i," video stream type to ").concat(r)),a._remoteStreamTypeCacheMap.set(i,r)})()}setStreamFallbackOption(i,r){var a=this;return x(function*(){pi(r,"fallbackType",[0,1,2]);try{yield a._gateway.setStreamFallbackOption(i,r)}catch(l){throw R.error("[".concat(a._clientId,"] set stream fallback option"),l.toString()),l}R.info("[".concat(a._clientId,"] set remote ").concat(i," stream fallback type to ").concat(r)),a._streamFallbackTypeCacheMap.set(i,r)})()}setEncryptionConfig(i,r,a){pi(i,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"]),Vi(r,"secret");const l=["aes-128-gcm2","aes-256-gcm2"];if(we(l).call(l,i)){if(!a||!(a instanceof Uint8Array&&32===a.length))throw new K(k.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(a)throw new K(k.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(r)||R.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=i,this._encryptionSecret=r,a&&(this._encryptionSalt=h_(a))}renewToken(i){var r=this;return x(function*(){if(Vi(i,"token",1,2047),!r._key||!r._joinInfo)throw new K(k.INVALID_OPERATION,"renewToken should not be called before user join");const a=r._key;r._key=i,r._joinInfo&&(r._joinInfo.token=i);const l=yield r._renewTokenMutex.lock();try{if(H("USE_NEW_TOKEN")){R.debug("[".concat(r._clientId,"] start renew token with ticket from unilbs"));const d=yield function(s,i,r){return q_.apply(this,arguments)}(r._joinInfo,r._axiosCancelSource.token,r._config.httpRetryConfig||Wn);R.debug("[".concat(r._clientId,"] get ticket from unilbs success")),yield r._gateway.renewToken({token:i,ticket:d})}else R.debug("[".concat(r._clientId,"] start renew token without ticket")),yield r._gateway.renewToken({token:i});R.debug("[".concat(r._clientId,"] renewToken success"))}catch(d){throw r._key=a,r._joinInfo.token=a,R.error("[".concat(r._clientId,"] renewToken failed"),d.toString()),d}finally{l()}})()}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?R.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const i=this._p2pChannel.getAudioLevels();this.safeEmit(We.VOLUME_INDICATOR,i)},H("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const i=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return i.Duration=Math.round(r.duration/1e3),i}startLiveStreaming(i,r){var a=this;return x(function*(){if(!r){if("h264"!==a.codec)throw new K(k.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!a._p2pChannel.hasLocalMedia())throw new K(k.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(a._liveRawStreamingClient&&a._liveRawStreamingClient.hasUrl(i)||a._liveTranscodeStreamingClient&&a._liveTranscodeStreamingClient.hasUrl(i))throw new K(k.LIVE_STREAMING_TASK_CONFLICT);const l=r?Zn.TRANSCODE:Zn.RAW;return a._createLiveStreamingClient(l).startLiveStreamingTask(i,l)})()}setLiveTranscoding(i){return this._createLiveStreamingClient(Zn.TRANSCODE).setTranscodingConfig(i)}stopLiveStreaming(i){var r=this;return x(function*(){const a=[r._liveRawStreamingClient,r._liveTranscodeStreamingClient].filter(l=>l&&l.hasUrl(i));if(!a.length)throw new K(k.INVALID_PARAMS,"can not find live streaming url to stop");yield q.all(a.map(l=>l&&l.stopLiveStreamingTask(i)))})()}addInjectStreamUrl(i,r){var a=this;return x(function*(){if(!a._joinInfo)throw new K(k.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const l=a._createLiveStreamingClient(Zn.INJECT);l.setInjectStreamConfig(r,0),yield l.startLiveStreamingTask(i,Zn.INJECT)})()}removeInjectStreamUrl(){var i=this;return x(function*(){var r;const a=i._createLiveStreamingClient(Zn.INJECT),l=Array.from(Ze(r=a.streamingTasks).call(r)).find(d=>d.mode===Zn.INJECT);if(!i._joinInfo||!l)throw new K(k.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");yield a.stopLiveStreamingTask(l.url)})()}startChannelMediaRelay(i){var r=this;return x(function*(){Rb(i),yield r._createChannelMediaRelayClient().startChannelMediaRelay(i)})()}updateChannelMediaRelay(i){var r=this;return x(function*(){Rb(i),yield r._createChannelMediaRelayClient().updateChannelMediaRelay(i)})()}stopChannelMediaRelay(){var i=this;return x(function*(){yield i._createChannelMediaRelayClient().stopChannelMediaRelay(),i._statsCollector.onStatsChanged&&(i._statsCollector.onStatsChanged=void 0)})()}sendStreamMessage(i){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new K(k.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof i||i instanceof Uint8Array)&&(i={payload:i}),"string"==typeof i.payload){const a=new TextEncoder;i.payload=a.encode(i.payload)}if(new Blob([i.payload]).size>1024)throw new K(k.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(ve.DATA_STREAM,{payload:h_(i.payload),syncWithAudio:i.syncWithAudio,sendTs:Date.now()-N2},!r)}sendMetadata(i){if(!this._joinInfo)throw new K(k.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([i]).size>1024)throw new K(k.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ve.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:h_(i)})}sendCustomReportMessage(i){var r=this;return x(function*(){if(Array.isArray(i)||(i=[i]),i.forEach(n3),!r._joinInfo)throw new K(k.INVALID_OPERATION,"can not send custom report, not joined");yield Te.sendCustomReportMessage(r._joinInfo.sid,i)})()}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}pickSVCLayer(i,r){var a=this;return x(function*(){pi(r.spatialLayer,"spatialLayer",[0,1,2,3]),pi(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{yield a._gateway.pickSVCLayer(i,r)}catch(l){throw R.error("[".concat(a._clientId,"] pick SVC layer failed"),l.toString()),l}})()}setRTM2Flag(i){if(pi(i,"flag",[0,1]),!this._joinInfo)throw new K(k.INVALID_OPERATION,"Can't setRtm2Flag, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new K(k.INVALID_OPERATION,"Can't setRtm2Flag in ".concat(this.connectionState," state"));return this._gateway.setRTM2Flag(i)}_reset(){if(R.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Gr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._pendingPublishedUsers=[],this._users.forEach(i=>{i._audioTrack&&i._audioTrack._destroy(),i._videoTrack&&i._videoTrack._destroy(),i._dataChannels&&(i._dataChannels.forEach(r=>r._close()),i._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Gn("client-publish"),this._subscribeMutex=new Gn("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch(i){}if(this._moderation)try{this.setImageModeration(!1)}catch(i){}}_startSession(i,r){const a=i||OS();R.debug(i?"[".concat(this._clientId,"] new Session ").concat(a):"[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(a)),this._sessionId=a,this.store.sessionId=a,r?Te.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:r.channel,appid:r.appId,mode:this.mode}):this._joinInfo?Te.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this.mode}):this._gateway.joinInfo&&Te.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this.mode}),this._joinInfo&&(this._joinInfo.sid=a),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=a)}_publishHighStream(i){var r=this;return x(function*(){if(!r._joinInfo||void 0===r._uid)throw new K(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new K(k.INVALID_OPERATION,"can not publish stream in ".concat(r.connectionState," state"));if("auto"===r._turnServer.mode&&H("FORCE_TURN")&&!H("TURN_ENABLE_TCP")&&!H("TURN_ENABLE_UDP"))throw new K(k.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");R.debug("[".concat(r._clientId,"] publish high stream"));try{if(r._p2pChannel instanceof In){const l=yield r._p2pChannel.publish(i,r._isDualStreamEnabled,r._lowStreamParameter);if(l)try{yield r._gateway.sendExtensionMessage($t.PUBLISH,l)}catch(d){throw r._p2pChannel.unpublish(i),d}}else{const l=yield r._p2pChannel.publish(i,r._isDualStreamEnabled,r._lowStreamParameter),d=(yield l.next()).value;if(d){var a;let h;try{h=yield r._gateway.publish(r._uid,d,!0)}catch(f){if(f.code!==k.DISCONNECT_P2P)throw l.throw(f),f}yield l.next((null===(a=h)||void 0===a?void 0:a.ortc)||[])}r._p2pChannel.reportPublishEvent(!0,null);for(const h of i)h instanceof Ye&&h._encoderConfig&&r._gateway.setVideoProfile(h._encoderConfig),!h.muted&&h.enabled||(yield r._p2pChannel.muteLocalTrack(h))}}catch(l){if(r._p2pChannel.reportPublishEvent(!1,null==l?void 0:l.code,i),(null==l?void 0:l.code)===k.WS_ABORT)return;throw l}})()}_publishLowStream(){var i=this;return x(function*(){if(!i._joinInfo||void 0===i._uid)throw new K(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==i.connectionState&&"RECONNECTING"!==i.connectionState)throw new K(k.INVALID_OPERATION,"can not publish stream in ".concat(i.connectionState," state"));R.debug("[".concat(i._clientId,"] publish low stream"));const r=i._configDistribute.getLowStreamConfigDistribute();r&&r.bitrate&&(i._lowStreamParameter||(i._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),i._lowStreamParameter&&i._lowStreamParameter.bitrate&&r.bitrate<i._lowStreamParameter.bitrate&&(i._lowStreamParameter.bitrate=r.bitrate));try{const l=yield i._p2pChannel.publishLowStream(i._lowStreamParameter),d=(yield l.next()).value;if(d){var a;let h;try{h=yield i._gateway.publish(i._uid,d,!0)}catch(f){if(f.code!==k.DISCONNECT_P2P)throw l.throw(f),f}l.next((null===(a=h)||void 0===a?void 0:a.ortc)||[]),i._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(l){if(i._p2pChannel.reportPublishEvent(!1,null==l?void 0:l.code,void 0,!0),(null==l?void 0:l.code)===k.WS_ABORT)return;throw l}})()}_createLiveStreamingClient(i){if(!this._joinInfo||!this._appId)return new K(k.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const r=()=>new p2(this._joinInfo,this._config.websocketRetryConfig||Wn,this._config.httpRetryConfig||Wn),a=l=>{l.onLiveStreamError=(d,h)=>{Te.reportApiInvoke(this._sessionId,{name:jn.ON_LIVE_STREAM_ERROR,options:[d,h],tag:Kt.TRACER}).onSuccess(),this.safeEmit(We.LIVE_STREAMING_ERROR,d,h)},l.onLiveStreamWarning=(d,h)=>{Te.reportApiInvoke(this._sessionId,{name:jn.ON_LIVE_STREAM_WARNING,options:[d,h],tag:Kt.TRACER}).onSuccess(),this.safeEmit(We.LIVE_STREAMING_WARNING,d,h)},l.on(Ml.REQUEST_WORKER_MANAGER_LIST,(d,h,f)=>{if(!this._joinInfo)return f(new K(k.INVALID_OPERATION,"can not find join info to get worker manager"));ZO(d,this._joinInfo,this._axiosCancelSource.token,Wn).then(h).catch(f)})};switch(i){case Zn.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=r(),a(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Zn.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=r(),a(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Zn.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=r(),this._injectStreamingClient.on(Ml.REQUEST_WORKER_MANAGER_LIST,(l,d,h)=>{if(!this._joinInfo)return h(new K(k.INVALID_OPERATION,"can not find join info to get worker manager"));ZO(l,this._joinInfo,this._axiosCancelSource.token,Wn).then(d).catch(h)}),this._injectStreamingClient.onInjectStatusChange=(l,d,h)=>{this.safeEmit(We.INJECT_STREAM_STATUS,l,d,h)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new K(k.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:i,sendResolutionHeight:r}=this.getLocalVideoStats();this._channelMediaRelayClient=new Ro(this._joinInfo,this._clientId,this._config.websocketRetryConfig||Wn,this._config.httpRetryConfig||Wn,{width:i,height:r}),this._channelMediaRelayClient.on("state",l=>{l===Er.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(We.CHANNEL_MEDIA_RELAY_STATE,l)}),this._channelMediaRelayClient.on("event",l=>{this.safeEmit(We.CHANNEL_MEDIA_RELAY_EVENT,l)}),this._statsCollector.onStatsChanged=(l,d)=>{var h;"resolution"===l&&(null===(h=this._channelMediaRelayClient)||void 0===h||h.setVideoProfile(d))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(i,r){const{added:a,deleted:l}=i,d=[];Array.isArray(a)&&a.length>0&&a.forEach(h=>{const{uid:f,stream_id:m,ordered:g,max_retrans_times:E,metadata:y}=h,C=this._users.find(b=>b._uintid===f);if(C){if(R.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(f)),we(d).call(d,C)||d.push(C),C._uintid||(C._uintid=f),-1===C._dataChannels.findIndex(b=>b.id===h.stream_id)){const b={id:m,ordered:!!g,maxRetransmits:E,metadata:y},O=new V_(b);C._dataChannels.push(O),R.info("[".concat(this._clientId,"] remote user ").concat(C.uid," published datachannel")),r||this.safeEmit(We.USER_PUBLISHED,C,"datachannel",b)}this._p2pChannel.hasPendingRemoteDataChannel(C,h.stream_id)&&(R.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(C.uid," after reconnect.")),this._subscribeDataChannel(C,h.stream_id).catch(b=>{R.error("[".concat(this._clientId,"] resubscribe datachannel error"),b.toString())}))}else R.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))}),r&&(this.safeEmit(We.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(l)&&l.length>0&&l.forEach(h=>{const{uid:f}=h,g=this._users.find(y=>y._uintid===f);if(!g)return void R.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const E=g._dataChannels.find(y=>y.id===h.stream_id);E&&(R.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(f)),this._p2pChannel.unsubscribeDataChannel(g,[E]).then(y=>{if(y)return g._dataChannels=g._dataChannels.filter(C=>C!==E),this._gateway.unsubscribeDataChannel(y,g.uid)}),R.info("[".concat(this._clientId,"] remote user ").concat(f," unpublished datachannel ,id:").concat(E.id)),this.safeEmit(We.USER_UNPUBLISHED,g,"datachannel",E._config))})}_handleRemoveDataChannels(i){const r=this._users.find(a=>a.uid===i.uid);if(r){if(void 0!==r._dataChannels&&r._dataChannels.length>0){R.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(i.uid));const a=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(l=>{this.safeEmit(We.USER_UNPUBLISHED,r,"datachannel",l._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(l=>{if(l)return this._gateway.unsubscribeDataChannel(l,r.uid)}),a()}}else R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){var i=this;this._gateway.on(Rn.DISCONNECT_P2P,x(function*(){yield i._p2pChannel.disconnectForReconnect()})),this._gateway.on(Rn.CONNECTION_STATE_CHANGE,(r,a,l)=>{var d;if(l===$e.FALLBACK)return;const h=()=>{this.safeEmit(We.CONNECTION_STATE_CHANGE,r,a,l)};if(Te.reportApiInvoke(this._sessionId||(null===(d=this._gateway.joinInfo)||void 0===d?void 0:d.sid)||null,{name:jn.CONNECTION_STATE_CHANGE,options:[r,a,l],tag:Kt.TRACER}).onSuccess(JSON.stringify({cur:r,prev:a,reason:l})),R.info("[".concat(this._clientId,"] connection state change: ").concat(a," -> ").concat(r)),"DISCONNECTED"===r)return this._reset(),void h();if("RECONNECTING"===r)this._users.forEach(m=>{m._trust_in_room_=!1,m._trust_audio_enabled_state_=!1,m._trust_video_enabled_state_=!1,m._trust_audio_mute_state_=!1,m._trust_video_mute_state_=!1,m._trust_audio_stream_added_state_=!1,m._trust_video_stream_added_state_=!1,m._audioSSRC=void 0,m._videoSSRC=void 0,m._videoOrtc=void 0,m._audioOrtc=void 0,m._cname=void 0,m._rtxSsrcId=void 0}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===r){var f;this._streamFallbackTypeCacheMap.forEach((m,g)=>{this._gateway.setStreamFallbackOption(g,m).catch(E=>{R.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),E)})}),this._remoteStreamTypeCacheMap.forEach((m,g)=>{this._gateway.setRemoteVideoStreamType(g,m).catch(E=>{R.warning("[".concat(this._clientId,"] auto set remote stream type failed"),E)})}),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(f=this._joinInfo)||void 0===f?void 0:f.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{R.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(m=>{R.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(m))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter(m=>!m._trust_in_room_).forEach(m=>{R.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(m.uid)),this._handleUserOffline({uid:m.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach(m=>{m._trust_audio_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(m.uid)),this._handleMuteStream(m.uid,ye.AUDIO,!1)),m._trust_video_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(m.uid)),this._handleMuteStream(m.uid,ye.VIDEO,!1)),m._trust_audio_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(m.uid)),this._handleSetStreamLocalEnable("audio",m.uid,!0)),m._trust_video_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(m.uid)),this._handleSetStreamLocalEnable("video",m.uid,!0)),m._trust_video_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(m.uid)),this._handleResetAddStream(m,"video")),m._trust_audio_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(m.uid)),this._handleResetAddStream(m,"audio")),m._video_added_||m._audio_added_||(R.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(m.uid)),this._handleRemoveStream({uid:m.uid,uint_id:m._uintid}))}))},1e3))}h()}),this._gateway.on(Rn.REQUEST_NEW_GATEWAY_LIST,(r,a)=>{if(!this._joinInfo)return a(new K(k.UNEXPECTED_ERROR,"can not recover, no join info"));JO(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Wn,this.store).then(l=>{this._joinInfo&&(this._joinInfo.apResponse=l.gatewayInfo.res,this._joinInfo.gatewayAddrs=l.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=l.gatewayInfo.uni_lbs_ip);const d=[];l.gatewayInfo.gatewayAddrs.forEach(h=>{let{address:f}=h;const[m,g]=f.split(":");d.push(this._joinInfo&&this._joinInfo.proxyServer?{proxy:this._joinInfo.proxyServer,host:m,port:g}:{host:m,port:g})}),r(d)}).catch(a)}),this._gateway.on(Rn.NETWORK_QUALITY,r=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(We.NETWORK_QUALITY,r)}),this._gateway.on(Rn.STREAM_TYPE_CHANGE,(r,a)=>{this.safeEmit(We.STREAM_TYPE_CHANGED,r,a),Te.reportApiInvoke(this._sessionId,{name:jn.STREAM_TYPE_CHANGE,options:[r,a],tag:Kt.TRACER}).onSuccess(JSON.stringify({uid:r,streamType:a}))}),this._gateway.on(Rn.IS_P2P_DISCONNECTED,r=>{this._p2pChannel.isP2PDisconnected()?r(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?r(!1):r(!0)}),this._gateway.on(Rn.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(Rn.REQUEST_P2P_CONNECTION_PARAMS,function(){var r=x(function*(a,l,d){try{l(yield i._p2pChannel.startP2PConnection(a))}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.on(Rn.JOIN_RESPONSE,(r,a)=>{if(this.store.useP2P)return;const{dtlsParameters:l,iceParameters:d,candidates:h,rtpCapabilities:f,setup:m,cname:g}=cN(r.ortc,a);this._p2pChannel.connect(d,l,h,f,m,g)}),this._gateway.on(Rn.REQUEST_DC_CONNECTION_PARAMS,r=>{r(this._p2pChannel.getEstablishParams())}),this._gateway.on(Rn.RESET_SIGNAL,r=>{this._p2pChannel.resetConnection(r),this._handleGatewaySignalEvents()}),this._gateway.on(Rn.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(Rn.DATACHANNEL_PRECONNECT,function(){var r=x(function*(a,l,d,h){var f,m,g,E,y,C;yield i._p2pChannel.startP2PConnection({turnServer:null===(f=i._joinInfo)||void 0===f?void 0:f.turnServer},!0);const b=function(O,P){let D;return P&&P.ip&&"number"==typeof P.port?(D=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:P.ip,port:P.port.toString(),type:"host",extension:{}}],R.debug("Using remote candidate from AP ".concat(P.ip,":").concat(P.port)),P.ip6&&(D.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:P.ip6,port:P.port.toString(),type:"host",extension:{}}),R.debug("Using IPV6 remote candidate from AP ".concat(P.ip6,":").concat(P.port)))):D=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:O.ip,port:O.port.toString(),type:"host",extension:{}}],D}(a,l);return i._p2pChannel.preConnect({iceUfrag:"".concat(null===(m=i._joinInfo)||void 0===m?void 0:m.apResponse.cid,"_").concat(null===(g=i._joinInfo)||void 0===g?void 0:g.apResponse.cert),icePwd:"".concat(null===(E=i._joinInfo)||void 0===E?void 0:E.apResponse.cid,"_").concat(null===(y=i._joinInfo)||void 0===y?void 0:y.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(C=H("FINGERPRINT"))&&void 0!==C?C:a.fingerprint}]},b,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(d).catch(h)});return function(a,l,d,h){return r.apply(this,arguments)}}())}_handleGatewaySignalEvents(){var i=this;this._gateway.signal.on(Fe.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Fe.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Fe.ON_ADD_AUDIO_STREAM,r=>this._handleAddAudioOrVideoStream("audio",r.uid,r.ssrcId,r.cname,r.uint_id,r.ortc)),this._gateway.signal.on(Fe.ON_ADD_VIDEO_STREAM,r=>this._handleAddAudioOrVideoStream("video",r.uid,r.ssrcId,r.cname,r.uint_id,r.ortc,r.rtxSsrcId)),this._gateway.signal.on(Fe.ON_REMOTE_DATASTREAM_UPDATE,r=>{this._handleUpdateDataChannel(r)}),this._gateway.signal.on(Fe.ON_REMOTE_FULL_DATASTREAM_INFO,r=>{this._handleUpdateDataChannel({added:r.datastreams,deleted:[]},!0)}),this._gateway.signal.on(Fe.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Fe.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Fe.MUTE_AUDIO,r=>this._handleMuteStream(r.uid,ye.AUDIO,!0)),this._gateway.signal.on(Fe.UNMUTE_AUDIO,r=>this._handleMuteStream(r.uid,ye.AUDIO,!1)),this._gateway.signal.on(Fe.MUTE_VIDEO,r=>this._handleMuteStream(r.uid,ye.VIDEO,!0)),this._gateway.signal.on(Fe.UNMUTE_VIDEO,r=>this._handleMuteStream(r.uid,ye.VIDEO,!1)),this._gateway.signal.on(Fe.RECEIVE_METADATA,r=>{const a=u_(r.metadata);this.safeEmit(We.RECEIVE_METADATA,r.uid,a)}),this._gateway.signal.on(Fe.ON_DATA_STREAM,function(){var r=x(function*(a){if(!a)return;let l=0;if(a.ordered||a.syncWithAudio){const d=i._p2pChannel.getStats(),h=i.remoteUsers.find(m=>m.uid===a.uid),f=null==d?void 0:d.audioRecv.find(m=>m.ssrc===(null==h?void 0:h._audioSSRC));l=null==f?void 0:f.jitterBufferMs}null==l&&(l=0),function(s){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(!s.syncWithAudio)return Ay(r,{uid:s.uid,payload:u_(s.payload)});const a="".concat(r.id,"-").concat(s.uid),l=jN.get(a)||[],d=l.findIndex(g=>s.sendTs>=g.sendTs),h=BN(BN({},s),{},{context:r,mediaDelay:i,recvTs:Date.now()});-1===d?l.push(h):l.splice(d,0,h),jN.set(a,l);let f=!1;var m;wy.has(a)?f=!(null===(m=wy.get(a))||void 0===m||!m.isSyncing):wy.set(a,{isSyncing:f,firstRecvTs:0,firstSendTs:0}),f||wp(a)}(a,l,{id:i._clientId,onStreamMessage:"function"==typeof i.onStreamMessage?i.onStreamMessage.bind(i):void 0,safeEmit:i.safeEmit.bind(i)})});return function(a){return r.apply(this,arguments)}}()),this._gateway.signal.on(Fe.ON_CRYPT_ERROR,()=>{Bh(()=>{R.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(We.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Fe.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Fe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{R.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,$e.TOKEN_EXPIRE),this.safeEmit(We.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Fe.ON_STREAM_FALLBACK_UPDATE,r=>{R.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(r.stream_id,", attr: ").concat(r.stream_type)),this.safeEmit(We.STREAM_FALLBACK,r.stream_id,1===r.stream_type?"fallback":"recover")}),this._gateway.signal.on(Fe.ON_PUBLISH_STREAM,r=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:r.proxy})),R.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(r))))}),this._gateway.signal.on(Fe.ENABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!0)}),this._gateway.signal.on(Fe.DISABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!1)}),this._gateway.signal.on(he.REQUEST_TIMEOUT,(r,a)=>{if(this._joinInfo)switch(r){case ve.PUBLISH:{if(!a)return;const h=a.ortc;if(h){var l,d;const f=h.some(E=>{let{stream_type:y}=E;return y===bt.Audio}),m=h.some(E=>{let{stream_type:y}=E;return y!==bt.Audio}),g=h.some(E=>{let{stream_type:y}=E;return y===bt.Screen||y===bt.ScreenLow});"offer"===a.state&&Te.publish(this._joinInfo.sid,{eventElapse:Ni.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:k.TIMEOUT,audio:f,video:m,p2pid:a.p2p_id,publishRequestid:this.store.pubId,screenshare:g,audioName:f?null===(l=h.find(E=>{let{stream_type:y}=E;return y===bt.Audio}))||void 0===l||null===(l=l.ssrcs[0])||void 0===l?void 0:l.ssrcId.toString():void 0,videoName:m?null===(d=h.find(E=>{let{stream_type:y}=E;return y!==bt.Audio}))||void 0===d||null===(d=d.ssrcs[0])||void 0===d?void 0:d.ssrcId.toString():void 0})}break}case ve.SUBSCRIBE:a&&Te.subscribe(this._joinInfo.sid,{succ:!1,ec:k.TIMEOUT,audio:a.stream_type===ye.AUDIO,video:a.stream_type===ye.VIDEO,peerid:a.stream_id,subscribeRequestid:a.ssrcId,p2pid:this.store.p2pId,eventElapse:Ni.measureFromSubscribeStart(this.store.clientId,a.ssrcId)})}}),this._gateway.signal.on(Fe.ON_P2P_OK,r=>{}),this._gateway.signal.on(Fe.ON_PUBLISHED_USER_LIST,r=>{if(null==r||!r.users)return;H("BLOCK_LOCAL_CLIENT")&&(r.users=r.users.filter(d=>!ou(d.string_id||d.stream_id,this.channelName)));const a=[],l=[];for(const d of r.users){let h=this._users.find(C=>C._uintid===d.stream_id);h?h._trust_in_room_=!0:(h=new Wt(d.string_id||d.stream_id,d.stream_id),this._users.push(h),0===this.getListeners(We.PUBLISHED_USER_LIST).length&&(R.debug("[".concat(this._clientId,"] user online"),d.stream_id),this.safeEmit(We.USER_JOINED,h)));const f=Kn.Audio&d.stream_type,m=(Kn.Video|Kn.LwoVideo)&d.stream_type,g=0!=(65280&d.stream_type),E=f&&h.hasAudio,y=m&&h.hasVideo;m&&(h._trust_video_stream_added_state_=!0,h._video_added_=!0,h._videoSSRC=d.video_ssrc,h._rtxSsrcId=d.video_rtx),f&&(h._trust_audio_stream_added_state_=!0,h._audio_added_=!0,h._audioSSRC=d.audio_ssrc),f&&!E&&0===this.getListeners(We.PUBLISHED_USER_LIST).length&&(R.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published audio")),this.safeEmit(We.USER_PUBLISHED,h,"audio")),m&&!y&&0===this.getListeners(We.PUBLISHED_USER_LIST).length&&(R.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published video")),this.safeEmit(We.USER_PUBLISHED,h,"video")),(f&&!E||m&&!y||g)&&a.push(h),m&&this._p2pChannel.hasPendingRemoteMedia(h,"video")&&l.push({user:h,mediaType:"video"}),f&&this._p2pChannel.hasPendingRemoteMedia(h,"audio")&&l.push({user:h,mediaType:"audio"})}l.length>0&&(R.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(l.map(d=>"user: ".concat(d.user.uid,", mediaType: ").concat(d.mediaType)).join("; ")," ")),this.massSubscribe(l).catch(d=>{R.error("[".concat(this._clientId,"] mass resubscribe error"),d.toString())})),this.getListeners(We.PUBLISHED_USER_LIST).length>0?H("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=a:(R.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(a.map(d=>d.uid).join(", "))),this.safeEmit(We.PUBLISHED_USER_LIST,a)):R.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(a.map(d=>d.uid).join(", ")))})}_handleP2PEvents(){var i=this;this._gateway.signal.on(Fe.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on($t.PUBLISH,function(){var r=x(function*(a,l){a.forEach(d=>d.kind===ye.VIDEO?(i._handleP2PAddAudioOrVideoStream("video",l),i._handleMuteStream(l,ye.VIDEO,!!d.isMuted)):(i._handleP2PAddAudioOrVideoStream("audio",l),i._handleMuteStream(l,ye.AUDIO,!!d.isMuted)))});return function(a,l){return r.apply(this,arguments)}}()),this._gateway.signal.on(he.P2P_START,function(){var r=x(function*(a,l){var d;i._p2pChannel instanceof In&&l(yield i._p2pChannel.startP2P({turnServer:null===(d=i._joinInfo)||void 0===d?void 0:d.turnServer},a))});return function(a,l){return r.apply(this,arguments)}}()),this._gateway.signal.on(he.P2P_CONNECTION,function(){var r=x(function*(a){i._p2pChannel instanceof In&&(yield i._p2pChannel.p2pConnect(a))});return function(a){return r.apply(this,arguments)}}()),this._gateway.signal.on(he.P2P_REMOTE_CANDIDATE_UPDATE,r=>{this._p2pChannel instanceof In&&this._p2pChannel.addRemoteCandidate(JSON.parse(r))}),this._gateway.signal.on($t.SUBSCRIBE,function(){var r=x(function*(a,l,d){if(i._p2pChannel instanceof In){const{trackType:h}=JSON.parse(a);try{yield i._p2pChannel.dopublish(h),l()}catch(f){d(f)}}});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.signal.on($t.UNSUBSCRIBE,function(){var r=x(function*(a,l,d){if(i._p2pChannel instanceof In){const{mediaType:h}=JSON.parse(a);try{yield i._p2pChannel.doUnpublish(h),l()}catch(f){d(f)}}});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.signal.on($t.EXCHANGE_SDP,function(){var r=x(function*(a,l,d){if(i._p2pChannel instanceof In){const{type:h,sdp:f}=JSON.parse(a);try{l(yield i._p2pChannel.setDescription(h,f))}catch(m){d(m)}}});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.signal.on($t.UNPUBLISH,function(){var r=x(function*(a,l,d){if(i._p2pChannel instanceof In){const{unpubMsg:h,uid:f}=a;if(1===h.length){const m=h[0].stream_type===bt.Audio?ye.AUDIO:ye.VIDEO;i._handleMuteStream(f,m,!0);const{sdp:g}=a;if(i._p2pChannel instanceof In&&g){const E=i._users.find(y=>y.uid===f);if(!E)return R.warning("[".concat(i._clientId,"] can not find remote user, ignore mute event, uid: ").concat(f)),void l();i._p2pChannel.unsubscribe(E,g,m).then(y=>{y&&l(y)}).catch(d)}else l()}else i._handleRemoveStream(a,l,d)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.signal.on($t.CONTROL,function(){var r=x(function*(a,l,d){const{action:h,sdp:f,isMuteAll:m,uid:g}=a;switch(h){case Mc.MUTE_LOCAL_VIDEO:i._handleMuteStream(g,ye.VIDEO,!0,f,l,d);break;case Mc.MUTE_LOCAL_AUDIO:l(),i._handleMuteStream(g,ye.AUDIO,!0);break;case Mc.UNMUTE_LOCAL_VIDEO:l(),i._handleP2PAddAudioOrVideoStream("video",g),i._handleMuteStream(g,ye.VIDEO,!1);break;case Mc.UNMUTE_LOCAL_AUDIO:l(),i._handleP2PAddAudioOrVideoStream("audio",g),i._handleMuteStream(g,ye.AUDIO,!1)}m&&i._handleRemoveStream(a,l,d)});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.signal.on($t.DO_SUBSCRIBE,function(){var r=x(function*(a,l,d){if(i._p2pChannel instanceof In){const{kind:h,sdp:f,ssrcId:m,uid:g}=a,E=i._users.find(y=>y.uid===g);if(!E)return R.error("[".concat(i._clientId,"] can not find target user!(on_add_stream)")),void l();try{l(yield i._p2pChannel.subscribe(E,h,f,m))}catch(y){d(y)}}});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.signal.on($t.DO_UNSUBSCRIBE,function(){var r=x(function*(a,l,d){if(i._p2pChannel instanceof In){const{uid:h,kind:f,sdp:m}=a,g=i._users.find(E=>E.uid===h);if(!g)return R.error("[".concat(i._clientId,"] can not find target user!(on_add_stream)")),void l();try{l(yield i._p2pChannel.unsubscribe(g,m,f))}catch(E){d(E)}}});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.signal.on($t.RESTART_ICE,function(){var r=x(function*(a,l,d){if(i._p2pChannel instanceof In)try{l(yield i._p2pChannel.setDescription("remote",a))}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(Re.RequestP2PRestartICE,function(){var r=x(function*(a,l,d){try{l(yield i._gateway.sendExtensionMessage($t.RESTART_ICE,a))}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(Re.LocalCandidate,r=>{this._gateway.sendExtensionMessage($t.CANDIDATE,JSON.stringify(r))}),this._p2pChannel.on(Re.RequestP2PMuteLocal,function(){var r=x(function*(a,l,d){try{l(yield i._gateway.sendExtensionMessage($t.CONTROL,a))}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(Re.RequestP2PPublish,function(){var r=x(function*(a,l,d){try{l(yield i._gateway.sendExtensionMessage($t.DO_SUBSCRIBE,a))}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(Re.RequestP2PUnPublish,function(){var r=x(function*(a,l,d){try{l(yield i._gateway.sendExtensionMessage($t.DO_UNSUBSCRIBE,a))}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(Re.RequestP2PUnmuteRemote,function(){var r=x(function*(a,l,d){if(i._joinInfo)try{yield i._gateway.unmuteRemote(a,i._joinInfo.stringUid||i._joinInfo.uid),l()}catch(h){h.code===k.DISCONNECT_P2P?l():d(h)}else l()});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(Re.RequestP2PMuteRemote,function(){var r=x(function*(a,l,d){if(i._joinInfo)try{yield i._gateway.muteRemote(a,i._joinInfo.stringUid||i._joinInfo.uid),l()}catch(h){h.code===k.DISCONNECT_P2P?l():d(h)}else l()});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(Re.StateChange,(r,a)=>{a===rt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){var i=this;this._p2pChannel.on(Re.RequestMuteLocal,function(){var r=x(function*(a,l,d){if(i._joinInfo)try{yield i._gateway.muteLocal(a,i._joinInfo.stringUid||i._joinInfo.uid),l()}catch(h){h.code===k.DISCONNECT_P2P?l():d(h)}else l()});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(Re.RequestUnmuteLocal,function(){var r=x(function*(a,l,d){if(i._joinInfo)try{yield i._gateway.unmuteLocal(a,i._joinInfo.stringUid||i._joinInfo.uid),l()}catch(h){h.code===k.DISCONNECT_P2P?l():d(h)}else l()});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(Re.RequestRePublish,(r,a,l)=>{this.publish(r,!1).then(a).catch(l)}),this._p2pChannel.on(Re.RequestRePublishDataChannel,(r,a,l)=>{q.all(r.map(function(){var d=x(function*(h){yield i._p2pChannel.publishDataChannel([h]);const f={streamId:h.id,ordered:h.ordered,maxRetransmits:h.maxRetransmits,metadata:h.metadata,channelId:h._originDataChannelId};try{yield i._gateway.publishDataChannel(i._uid,f,!0)}catch(m){if(m.code!==k.DISCONNECT_P2P)throw m}});return function(h){return d.apply(this,arguments)}}())).then(a).catch(l)}),this._p2pChannel.on(Re.RequestReSubscribe,function(){var r=x(function*(a,l,d){try{for(const{user:h,kind:f}of a)f===ye.VIDEO?yield i.subscribe(h,"video"):yield i.subscribe(h,"audio");l()}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(Re.RequestUploadStats,(r,a)=>{this._gateway.uploadStats(r,a)}),this._p2pChannel.on(Re.MediaReconnectStart,r=>{this.safeEmit(We.MEDIA_RECONNECT_START,r)}),this._p2pChannel.on(Re.MediaReconnectEnd,r=>{this.safeEmit(We.MEDIA_RECONNECT_END,r)}),this._p2pChannel.on(Re.NeedSignalRTT,r=>{r(this._gateway.getSignalRTT())}),this._p2pChannel.on(Re.RequestRestartICE,function(){var r=x(function*(a){if(i._p2pChannel instanceof In)return;const l=yield i._p2pChannel.restartICE(a),d=yield l.next();if(d.done)return;const h=d.value;let f;try{f=yield i._gateway.restartICE({iceParameters:h})}catch(g){return void l.throw(g)}const{iceParameters:m}=function(g){const E=g.iceParameters;return{iceParameters:{iceUfrag:E.iceUfrag,icePwd:E.icePwd}}}(f);yield l.next({remoteIceParameters:m})});return function(a){return r.apply(this,arguments)}}()),this._p2pChannel.on(Re.RequestReconnect,x(function*(){i._gateway.reconnect()})),this._p2pChannel.on(Re.RequestReconnectPC,x(function*(){var r;const{iceParameters:a,dtlsParameters:l,rtpCapabilities:d}=yield i._p2pChannel.startP2PConnection({turnServer:null===(r=i._joinInfo)||void 0===r?void 0:r.turnServer}),{gatewayEstablishParams:h,gatewayAddress:f}=yield i._gateway.reconnectPC({iceParameters:a,dtlsParameters:l,rtpCapabilities:d}),{dtlsParameters:m,iceParameters:g,candidates:E,rtpCapabilities:y,setup:C,cname:b}=cN(h,f);yield i._p2pChannel.connect(g,m,E,y,C,b),yield i._p2pChannel.republish(),yield i._p2pChannel.reSubscribe()})),this._p2pChannel.on(Re.RequestUnpublishForReconnectPC,function(){var r=x(function*(a,l,d){i._joinInfo&&void 0!==i._uid?(yield i._gateway.unpublish(a,i._uid),l()):d()});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(Re.P2PLost,()=>{this.safeEmit(We.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Re.UpdateVideoEncoder,r=>{r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig)}),this._p2pChannel.on(Re.ConnectionTypeChange,r=>{this.safeEmit(We.IS_USING_CLOUD_PROXY,r)}),this._p2pChannel.on(Re.RequestLowStreamParameter,r=>{r(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Re.QueryClientConnectionState,r=>{r(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}enableContentInspect(i){var r=this;return x(function*(){if("CONNECTED"!==r.connectionState||!r._joinInfo)throw new K(k.INVALID_OPERATION,"[".concat(r._clientId,"] Client did not join channel"));if(r._inspect)throw new K(k.INVALID_OPERATION,"[".concat(r._clientId,"] Inspect content service already in connecting/connected state"));if(!i)throw new K(k.INVALID_PARAMS,"[".concat(r._clientId,"] inspectConfig is necessary"));if(!i.inspectType||!Array.isArray(i.inspectType))throw new K(k.INVALID_PARAMS,"[".concat(r._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const a=[...new Set(i.inspectType)];a.forEach(l=>{var d;if(!we(d=["supervise","moderation"]).call(d,l))throw new K(k.INVALID_PARAMS,"[".concat(r._clientId,"] ").concat(l," is not a valid inspect type."))}),i.inspectType=a}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new K(k.INVALID_PARAMS,"[".concat(r._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const a=new Sy(i);r._inspect=a,r.handleVideoInspectEvents(r._inspect),yield a.init({appId:r._joinInfo.appId,areaCode:"",cname:r._joinInfo.cname,sid:r._joinInfo.sid,token:r._joinInfo.token,uid:r._joinInfo.uid,cid:r._joinInfo.cid,vid:r._joinInfo.vid?Number(r._joinInfo.vid):0},Wn)}catch(a){throw Array.isArray(a)?a[0]:a}})()}disableContentInspect(){var i=this;return x(function*(){if(!i._inspect)throw new K(k.INVALID_OPERATION,"[".concat(i._clientId,"] inspectVideoContent not started"));try{i._inspect.close(),i._inspect=void 0}catch(r){throw Array.isArray(r)?r[0]:r}})()}setImageModeration(i,r){var a=this;return x(function*(){if($d(i,"enabled"),i){if(!r)throw new K(k.INVALID_PARAMS,"[".concat(a._clientId,"] config is necessary"));if(Ut(r.interval,"interval",1e3,1/0),"CONNECTED"!==a.connectionState||!a._joinInfo)throw new K(k.INVALID_OPERATION,"[".concat(a._clientId,'] can not enable image moderation, not joined"'));try{if(a._moderation)return void a._moderation.updateConfig(r);const l=new Jb(r);a._moderation=l,a.handleImageModerationEvents(a._moderation),yield l.init({appId:a._joinInfo.appId,areaCode:"",cname:a._joinInfo.cname,sid:a._joinInfo.sid,token:a._joinInfo.token,uid:a._joinInfo.uid,cid:a._joinInfo.cid,vid:a._joinInfo.vid?Number(a._joinInfo.vid):0},Wn)}catch(l){throw Array.isArray(l)?l[0]:l}}else{if(!a._moderation)throw new K(k.INVALID_OPERATION,"[".concat(a._clientId,"] image moderation not started"));try{a._moderation.close(),a._moderation.removeAllListeners(),a._moderation=void 0}catch(l){throw Array.isArray(l)?l[0]:l}}})()}handleImageModerationEvents(i){i.on(Jo.CONNECTION_STATE_CHANGE,(r,a)=>{if(this.safeEmit(We.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,a),r===so.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new K(k.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");i.inspectImage()}}),i.on(Jo.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(a=>"video"===a.trackMediaType)[0])})}handleVideoInspectEvents(i){i.on(ci.CONNECTION_STATE_CHANGE,(r,a)=>{if(this.safeEmit(We.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,a),a===oo.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit(We.CONTENT_INSPECT_ERROR,new K(k.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));i.inspectImage()}}),i.on(ci.INSPECT_RESULT,(r,a)=>{var l;if((null==a?void 0:a.code)===k.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return R.debug("Stop inspect content because that has left channel"),null==this||null===(l=this._inspect)||void 0===l||l.close(),void(this._inspect=void 0);this.safeEmit(We.CONTENT_INSPECT_RESULT,r,a)}),i.on(ci.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(a=>"video"===a.trackMediaType)[0])})}getJoinChannelServiceRecords(){return R.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}setPublishAudioFilterEnabled(i){var r=this;return x(function*(){$d(i,"enabled"),Bt("ENABLE_PUBLISH_AUDIO_FILTER",i),r._joinInfo&&(yield r._gateway.setPublishAudioFilterEnabled(i))})()}_handleResetAddStream(i,r){switch(r){case"audio":i._audio_added_=!1,i._trust_audio_stream_added_state_=!0;break;case"video":i._video_added_=!1,i._trust_video_stream_added_state_=!0}}}oe([Oe(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",q)],kt.prototype,"leave",null),oe([Oe({argsMap:(s,i)=>{if(!Array.isArray(i)){if(!(i instanceof jt))return[i];i=[i]}return i.map(r=>r?Object(r).toString():"null")}}),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",q)],kt.prototype,"publish",null),oe([Oe({argsMap:(s,i)=>(i||(i=[]),i instanceof B_?[i.getChannelId()]:(Array.isArray(i)||(i=[i]),i.map(r=>r.getTrackId())))}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",q)],kt.prototype,"unpublish",null),oe([Oe({argsMap:(s,i,r,a)=>[i.uid,r,a]}),N("design:type",Function),N("design:paramtypes",[Wt,String,Number]),N("design:returntype",q)],kt.prototype,"subscribe",null),oe([Oe({argsMap:(s,i)=>i.map(r=>{let{user:a,mediaType:l}=r;return[null==a?void 0:a.uid,l]})}),N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],kt.prototype,"massSubscribe",null),oe([Oe({argsMap:(s,i,r,a)=>[i.uid,r,a]}),N("design:type",Function),N("design:paramtypes",[Wt,String,Number]),N("design:returntype",q)],kt.prototype,"unsubscribe",null),oe([Oe({argsMap:(s,i)=>i.map(r=>{let{user:a,mediaType:l}=r;return{uid:null==a?void 0:a.uid,mediaType:l}})}),N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],kt.prototype,"massUnsubscribe",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",q)],kt.prototype,"setLowStreamParameter",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",q)],kt.prototype,"enableDualStream",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",q)],kt.prototype,"disableDualStream",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[String,Object]),N("design:returntype",q)],kt.prototype,"setClientRole",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[String,Boolean]),N("design:returntype",void 0)],kt.prototype,"setProxyServer",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",void 0)],kt.prototype,"setTurnServer",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",void 0)],kt.prototype,"setLicense",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],kt.prototype,"startProxyServer",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],kt.prototype,"stopProxyServer",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],kt.prototype,"setLocalAccessPointsV2",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[Array,String]),N("design:returntype",void 0)],kt.prototype,"setLocalAccessPoints",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",q)],kt.prototype,"setRemoteDefaultVideoStreamType",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[Object,Number]),N("design:returntype",q)],kt.prototype,"setRemoteVideoStreamType",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[Object,Number]),N("design:returntype",q)],kt.prototype,"setStreamFallbackOption",null),oe([Oe({argsMap:(s,i)=>[i]}),N("design:type",Function),N("design:paramtypes",[String,String,Uint8Array]),N("design:returntype",void 0)],kt.prototype,"setEncryptionConfig",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],kt.prototype,"renewToken",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],kt.prototype,"enableAudioVolumeIndicator",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[String,Boolean]),N("design:returntype",q)],kt.prototype,"startLiveStreaming",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",q)],kt.prototype,"setLiveTranscoding",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],kt.prototype,"stopLiveStreaming",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[String,Object]),N("design:returntype",q)],kt.prototype,"addInjectStreamUrl",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",q)],kt.prototype,"removeInjectStreamUrl",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[dy]),N("design:returntype",q)],kt.prototype,"startChannelMediaRelay",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[dy]),N("design:returntype",q)],kt.prototype,"updateChannelMediaRelay",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",q)],kt.prototype,"stopChannelMediaRelay",null),oe([Oe({argsMap:(s,i)=>(Array.isArray(i)||(i=[i]),[JSON.stringify(i)])}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",q)],kt.prototype,"sendCustomReportMessage",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[Object,Object]),N("design:returntype",q)],kt.prototype,"pickSVCLayer",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",q)],kt.prototype,"setRTM2Flag",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",q)],kt.prototype,"enableContentInspect",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",q)],kt.prototype,"disableContentInspect",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[Boolean,Object]),N("design:returntype",q)],kt.prototype,"setImageModeration",null),oe([Oe({reportResult:!0}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",Array)],kt.prototype,"getJoinChannelServiceRecords",null),oe([Oe(),N("design:type",Function),N("design:paramtypes",[Boolean]),N("design:returntype",q)],kt.prototype,"setPublishAudioFilterEnabled",null);const Qb=pt().name;class Np{constructor(i,r){T(this,"id",0),T(this,"element",void 0),T(this,"peerPair",void 0),T(this,"context",void 0),T(this,"audioPlayerElement",void 0),T(this,"audioTrack",void 0),Np.count+=1,this.id=Np.count,this.element=i,this.context=r}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=i=>{const r=document.createElement("audio");r.srcObject=new MediaStream([i.track]),r.play(),this.audioPlayerElement=r}}switchSdp(){var i=this;return x(function*(){if(!i.peerPair)return;const r=function(){var l=x(function*(d,h){const f="offer"===h?yield d.createOffer():yield d.createAnswer();return yield d.setLocalDescription(f),"complete"===d.iceGatheringState?d.localDescription:new q(m=>{d.onicegatheringstatechange=()=>{"complete"===d.iceGatheringState&&m(d.localDescription)}})});return function(h,f){return l.apply(this,arguments)}}(),a=function(){var l=x(function*(d,h){return yield d.setRemoteDescription(h)});return function(h,f){return l.apply(this,arguments)}}();try{const l=yield r(i.peerPair[0],"offer");yield a(i.peerPair[1],l);const d=yield r(i.peerPair[1],"answer");yield a(i.peerPair[0],d)}catch(l){throw new K(k.LOCAL_AEC_ERROR,l.toString()).print()}})()}getTracksFromMediaElement(i){var r=this;return x(function*(){if(r.audioTrack)return r.audioTrack;let a;try{i instanceof HTMLVideoElement&&(i.captureStream?i.captureStream():i.mozCaptureStream()),a=r.context.createMediaStreamDestination(),r.context.createMediaElementSource(i).connect(a)}catch(d){throw new K(k.LOCAL_AEC_ERROR,d.toString()).print()}if(!a)throw new K(k.LOCAL_AEC_ERROR,"no dest node when local aec").print();const l=a.stream.getAudioTracks()[0];return r.audioTrack=l,l})()}getElement(){return this.element}startEchoCancellation(){var i=this;return x(function*(){i.context.resume(),i.peerPair&&i.close(),i.initPeers();const r=i.element,a=yield i.getTracksFromMediaElement(r);i.peerPair&&i.peerPair[0].addTrack(a),yield i.switchSdp()})()}close(){R.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(i=>{i.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}T(Np,"count",0);const GN=window.AudioContext||window.webkitAudioContext;class WN{constructor(){T(this,"units",[]),T(this,"context",void 0)}processExternalMediaAEC(i){if(!this._doesEnvironmentNeedAEC())return R.debug("the system does not need to process local aec"),-1;this.context||(this.context=new GN);let r=this.units.find(a=>a&&a.getElement()===i);return r||(r=new Np(i,this.context),this.units.push(r)),r.startEchoCancellation(),R.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return pt().name!==St.SAFARI}}oe([Oe({report:Te}),N("design:type",Function),N("design:paramtypes",[HTMLAudioElement]),N("design:returntype",Number)],WN.prototype,"processExternalMediaAEC",null);const M2=new WN;function KN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function qN(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?KN(Object(r),!0).forEach(function(a){T(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):KN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}const Pp=window||document;function Zb(s){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Pp)return;const r=Ai._cspEventHandlerPointer;if(r&&i)return void console.error(r,i);const a=l=>{if(!(l&&l.blockedURI&&(Ai.onSecurityPolicyViolation||Ai.getListeners(ua.SECURITY_POLICY_VIOLATION).length>0)))return;const d=l.blockedURI;H("CSP_DETECTED_HOSTNAME_LIST").some(h=>we(d).call(d,h))&&(Ai.onSecurityPolicyViolation&&"function"==typeof Ai.onSecurityPolicyViolation&&Ai.onSecurityPolicyViolation(l),Ai.getListeners(ua.SECURITY_POLICY_VIOLATION).length>0&&Ai.safeEmit(ua.SECURITY_POLICY_VIOLATION,l))};r&&Pp.removeEventListener("securitypolicyviolation",r),(i||s&&"function"==typeof s||Ai.getListeners(ua.SECURITY_POLICY_VIOLATION).length>0)&&Pp.addEventListener("securitypolicyviolation",a),Ai._cspEventHandlerPointer=a}Bt("PROCESS_ID","process-".concat(Vt(8,""),"-").concat(Vt(4,""),"-").concat(Vt(4,""),"-").concat(Vt(4,""),"-").concat(Vt(12,""))),function(){const s=pt();_n.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),_n.getStreamFromExtension=s.name===St.CHROME&&Number(s.version)>34,_n.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const i=new RTCPeerConnection;let r=!1;try{i.addTransceiver("audio"),r=!0}catch(a){}return i.close(),r}(),_n.supportMinBitrate=s.name===St.CHROME||s.name===St.EDGE,_n.supportSetRtpSenderParameters=function(){const i=pt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Il()||!(!Yt()&&!s_())||i.name===St.FIREFOX&&Number(i.version)>=64)}(),s.name===St.SAFARI&&(_n.supportDualStream=Number(s.version)>=14),_n.webAudioMediaStreamDest=function(){const i=pt();return!(i.name===St.SAFARI&&Number(i.version)<12)}(),_n.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,_n.supportWebGL="undefined"!=typeof WebGLRenderingContext,_n.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Il()||(_n.webAudioWithAEC=!0),_n.supportShareAudio=function(){const i=pt();return(i.os===vi.WIN_10||i.os===vi.WIN_81||i.os===vi.WIN_7||i.os===vi.LINUX||i.os===vi.MAC_OS)&&i.name===St.CHROME&&Number(i.version)>=74}(),_n.supportDataChannel=!!(Yg(76)||function(i){const r=pt();return!(r.name!==St.FIREFOX||!r.osVersion)&&Number(r.version)>=68}()||function(i){const r=pt();return!(r.name!==St.SAFARI||!r.osVersion)&&Number(r.version)>=14}()),_n.supportPCSetConfiguration=function(){const i=window.RTCPeerConnection;return!Pt()&&!!i&&i.prototype.setConfiguration instanceof Function}(),_n.supportWebRTCEncodedTransform=function(){const i=pt();return"Chrome"===i.name&&Number(i.version)>=86}(),_n.supportWebRTCInsertableStream=function(){const i=pt();return(i.name===St.CHROME||i.name===St.EDGE)&&Number(i.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Ko(()=>{_n.supportDualStreamEncoding=function(){const i=pt();return!!H("DISABLE_WEBAUDIO")||"Safari"===i.name&&Number(i.version)>=14||!!("Chrome"===i.name&&/Windows/i.test(i.os||"")&&Number(i.version)>=100&&H("CHROME_DUAL_STREAM_USE_ENCODING"))}(),R.info("browser compatibility",JSON.stringify(_n),JSON.stringify(s))})}(),function(){let s;try{s=window.localStorage.getItem("websdk_ng_global_parameter")}catch(i){return void R.error("Error loading sdk config",i.message)}if(s)try{const i=JSON.parse(window.atob(s)),r=Date.now();R.debug("Loading global parameters from cache",i),Object.keys(i).forEach(a=>{if(Object.prototype.hasOwnProperty.call(ir,a)){const{value:l,expires:d}=i[a];if(d&&d<=r)return;Dc[a]=l,ir[a]=l}})}catch(i){R.error("Error loading mutableParamsCache: ".concat(s),i.message)}}(),Array.isArray(Dc.AREAS)&&Dc.AREAS.length>0&&qc(Dc.AREAS,!0);const Ai=function(s){const i=new nn,r=s,a={getListeners:i.getListeners.bind(i),on:(l,d)=>(l===ua.SECURITY_POLICY_VIOLATION&&Zb(d,!0),i.on.bind(i)(l,d)),addListener:i.addListener.bind(i),once:i.once.bind(i),off:i.off.bind(i),removeAllListeners:i.removeAllListeners.bind(i),emit:i.emit.bind(i),safeEmit:i.safeEmit.bind(i)};return qN(qN({},r),a)}({__TRACK_LIST__:np,VERSION:yo,BUILD:_E,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:(s,i,r)=>{R.debug("setParameter key:".concat(s,", value:").concat(JSON.stringify(i))),Bt(s,i,r)},getParameter:H,getSupportedCodec:function(){var s=x(function*(){let i={audio:[],video:[]};try{let r=new RTCPeerConnection;r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});const a=(yield r.createOffer()).sdp;if(!a)return i;r.close(),r=null,i=function(l){const d={video:[],audio:[]};return l.match(/ VP8/i)&&d.video.push("VP8"),l.match(/ VP9/i)&&d.video.push("VP9"),l.match(/ AV1/i)&&d.video.push("AV1"),l.match(/ H264/i)&&d.video.push("H264"),l.match(/ H265/i)&&d.video.push("H265"),l.match(/ opus/i)&&d.audio.push("OPUS"),l.match(/ PCMU/i)&&d.audio.push("PCMU"),l.match(/ PCMA/i)&&d.audio.push("PCMA"),l.match(/ G722/i)&&d.audio.push("G722"),d}(a)}catch(r){throw new K(k.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return i});return function(){return s.apply(this,arguments)}}(),checkSystemRequirements:function(){const s=Te.reportApiInvoke(null,{name:jn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Kt.TRACER});let i=!1;try{const d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,f=window.WebSocket;i=!!(d&&h&&f)}catch(d){return R.error("check system requirement failed: ",d),!1}let r=!1;const a=pt();a.name===St.CHROME&&Number(a.version)>=58&&(!("WebKit"===Wo.engine.name)||function(){const s=pt();if(s_()){if(s.os===vi.MAC_OS)return!0;if(s.os===vi.IOS){const i=Wo.os.version&&Wo.os.version.split(".");if(i&&14===Number(i[0])&&i[1]&&Number(i[1])>=3||i&&Number(i[0])>14)return!0}}return!1}())&&(r=!0),a.name===St.FIREFOX&&Number(a.version)>=56&&(r=!0),a.name===St.OPERA&&Number(a.version)>=45&&(r=!0),a.name===St.SAFARI&&Number(a.version)>=11&&(r=!0),(AA()||pt().name===St.QQ)&&(r=!0),R.debug("checkSystemRequirements, api:",i,"browser",r);const l=i&&r;return s.onSuccess(l),l},getDevices:function(s){return Or.enumerateDevices(!0,!0,s)},getMicrophones:function(s){return Or.getRecordingDevices(s)},getCameras:function(s){return Or.getCamerasDevices(s)},getElectronScreenSources:bT,getPlaybackDevices:function(s){return Or.getSpeakers(s)},createClient:function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const i=Te.reportApiInvoke(null,{name:jn.CREATE_CLIENT,options:[s],tag:Kt.TRACER});try{pi((r=s).codec,"config.codec",["vp8","vp9","av1","h264","h265"]),pi(r.mode,"config.mode",["rtc","live"]),void 0!==r.audioCodec&&pi(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==r.proxyServer&&Vi(r.proxyServer,"config.proxyServer",1,1e4),void 0!==r.turnServer&&RL(r.turnServer),void 0!==r.httpRetryConfig&&AS(r.httpRetryConfig),void 0!==r.websocketRetryConfig&&AS(r.websocketRetryConfig)}catch(r){throw i.onError(r),r}var r;return void 0===s.audioCodec&&(s.audioCodec="opus"),i.onSuccess(),new kt(Op(Op({forceWaitGatewayResponse:!0},s),{},{role:"rtc"===s.mode?"host":s.role||"audience"}))},createCameraVideoTrack:function(){var s=x(function*(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=Te.reportApiInvoke(null,{tag:Kt.TRACER,name:jn.CREATE_CAM_VIDEO_TRACK,options:[FE({},i)]}),a=NT(i),l=Vt(8,"track-cam-");let d=null;R.info("start create camera video track with config",JSON.stringify(i),"trackId",l);try{d=(yield Dr({video:a},l)).getVideoTracks()[0]||null}catch(f){throw r.onError(f),f}if(!d){const f=new ne(k.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(f),f.throw(R)}i.optimizationMode&&PT(l,d,i,Ha(i.encoderConfig));const h=new yu(d,i,a,i.scalabiltyMode?Ll(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,l);return r.onSuccess(h.getTrackId()),R.info("create camera video success, trackId:",l),h});return function(){return s.apply(this,arguments)}}(),createCustomVideoTrack:function(s){const i=Te.reportApiInvoke(null,{tag:Kt.TRACER,name:jn.CREATE_CUSTOM_VIDEO_TRACK,options:[s]}),r=new Ye(s.mediaStreamTrack,{width:s.width,height:s.height,frameRate:s.frameRate,bitrateMax:s.bitrateMax,bitrateMin:s.bitrateMin},s.scalabiltyMode?Ll(s.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},s.optimizationMode,Vt(8,"track-cus-"),[Qt.CUSTOM_TRACK]);return i.onSuccess(r.getTrackId()),R.info("create custom video track success with config",s,"trackId",r.getTrackId()),r},createScreenVideoTrack:function(){var s=x(function*(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const a=Te.reportApiInvoke(null,{tag:Kt.TRACER,name:jn.CREATE_SCREEN_VIDEO_TRACK,options:[FE({},i),r]});i.encoderConfig?"string"==typeof i.encoderConfig||i.encoderConfig.width&&i.encoderConfig.height||(i.encoderConfig.width={max:1920},i.encoderConfig.height={max:1080}):i.encoderConfig="1080p_2";const l=function(y){const C={};y.screenSourceType&&(C.mediaSource=y.screenSourceType),y.extensionId&&zg()&&(C.extensionId=y.extensionId);const{displaySurface:b,selfBrowserSurface:O,surfaceSwitching:P,systemAudio:D}=y;(Yg(107)||yS(107)||vS(93))&&(b&&(pi(b,"displaySurface",["browser","window","monitor"]),C.displaySurface=b),O?(pi(O,"selfBrowserSurface",["exclude","include"]),C.selfBrowserSurface=O):C.selfBrowserSurface="include",P&&(pi(P,"surfaceSwitching",["exclude","include"]),C.surfaceSwitching=P)),(Yg(105)||yS(105)||vS(91))&&D&&(pi(D,"systemAudio",["exclude","include"]),C.systemAudio=D),y.electronScreenSourceId&&(C.sourceId=y.electronScreenSourceId);const L=y.encoderConfig?RE(y.encoderConfig):null;return C.mandatory={chromeMediaSource:"desktop",maxWidth:L?L.width:void 0,maxHeight:L?L.height:void 0},L&&(L.frameRate&&("number"==typeof L.frameRate?(C.mandatory.maxFrameRate=L.frameRate,C.mandatory.minFrameRate=L.frameRate):(C.mandatory.maxFrameRate=L.frameRate.max||L.frameRate.ideal||L.frameRate.exact||void 0,C.mandatory.minFrameRate=L.frameRate.min||L.frameRate.ideal||L.frameRate.exact||void 0),C.frameRate=L.frameRate),L.width&&(C.width=L.width),L.height&&(C.height=L.height)),C}(i),d=Vt(8,"track-scr-v-");let h=null,f=null;const m=Rt();if(!m.supportShareAudio&&"enable"===r){const y=new ne(k.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return a.onError(y),y.throw(R)}R.info("start create screen video track with config",i,"withAudio",r,"trackId",d);try{const y=yield Dr({screen:l,screenAudio:"auto"===r?m.supportShareAudio:"enable"===r},d);h=y.getVideoTracks()[0]||null,f=y.getAudioTracks()[0]||null}catch(y){throw a.onError(y),y}if(!h){const y=new ne(k.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(y),y.throw(R)}if(!f&&"enable"===r){h&&h.stop();const y=new ne(k.SHARE_AUDIO_NOT_ALLOWED);return a.onError(y),y.throw(R)}i.optimizationMode||(i.optimizationMode="detail"),i.optimizationMode&&(PT(d,h,i,i.encoderConfig&&RE(i.encoderConfig)||void 0),i.encoderConfig&&"string"!=typeof i.encoderConfig&&(i.encoderConfig.bitrateMin=i.encoderConfig.bitrateMax));const g=new Ye(h,i.encoderConfig?RE(i.encoderConfig):{},i.scalabiltyMode?Ll(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,d,[Qt.SCREEN_TRACK]);if(!f)return a.onSuccess(g.getTrackId()),R.info("create screen video track success","video:",g.getTrackId()),g;const E=new vt(f,void 0,Vt(8,"track-scr-a-"),!1,!0);return a.onSuccess([g.getTrackId(),E.getTrackId()]),R.info("create screen video track success","video:",g.getTrackId(),"audio:",E.getTrackId()),[g,E]});return function(){return s.apply(this,arguments)}}(),createMicrophoneAndCameraTracks:function(){var s=x(function*(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=Te.reportApiInvoke(null,{tag:Kt.TRACER,name:jn.CREATE_MIC_AND_CAM_TRACKS,options:[i,r]}),l=NT(r),d=sx(i),h=Vt(8,"track-mic-"),f=Vt(8,"track-cam-");let m=null,g=null;R.info("start create camera video track(".concat(f,") and microphone audio track(").concat(h,") with config, audio: ").concat(JSON.stringify(i),", video: ").concat(JSON.stringify(r)));try{const C=yield Dr({audio:d,video:l},"".concat(h,"-").concat(f));m=C.getAudioTracks()[0],g=C.getVideoTracks()[0]}catch(C){throw a.onError(C),C}if(!m||!g){const C=new ne(k.UNEXPECTED_ERROR,"can not find tracks in media stream");return a.onError(C),C.throw(R)}r.optimizationMode&&PT(f,g,r,Ha(r.encoderConfig));const E=new Lc(m,i,d,h),y=new yu(g,r,l,r.scalabiltyMode?Ll(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,f);return a.onSuccess([E.getTrackId(),y.getTrackId()]),R.info("create camera video track(".concat(f,") and microphone audio track(").concat(h,") success")),[E,y]});return function(){return s.apply(this,arguments)}}(),createMicrophoneAudioTrack:function(){var s=x(function*(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=Te.reportApiInvoke(null,{tag:Kt.TRACER,name:jn.CREATE_MIC_AUDIO_TRACK,options:[i]}),a=sx(i),l=Vt(8,"track-mic-");let d=null;R.info("start create microphone audio track with config",JSON.stringify(i),"trackId",l);try{d=(yield Dr({audio:a},l)).getAudioTracks()[0]||null}catch(f){throw r.onError(f),f}if(!d){const f=new ne(k.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(f),f.throw(R)}const h=new Lc(d,i,a,l);return r.onSuccess(h.getTrackId()),R.info("create microphone audio track success, trackId:",l),h});return function(){return s.apply(this,arguments)}}(),createCustomAudioTrack:function(s){const i=Te.reportApiInvoke(null,{tag:Kt.TRACER,name:jn.CREATE_CUSTOM_AUDIO_TRACK,options:[s]}),r=new vt(s.mediaStreamTrack,s.encoderConfig?xl(s.encoderConfig):{},Vt(8,"track-cus-"),!1,!0);return R.info("create custom audio track success with config",s,"trackId",r.getTrackId()),i.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:function(){var s=x(function*(i){var r;const{cacheOnlineFile:a,encoderConfig:l}=i;let{source:d}=i;const h={source:d instanceof AudioBuffer?"AudioBuffer":d instanceof File?null!==(r=File.name)&&void 0!==r?r:"File":d,cacheOnlineFile:a,encoderConfig:l},f=Te.reportApiInvoke(null,{tag:Kt.TRACER,name:jn.CREATE_BUFFER_AUDIO_TRACK,options:[h]});if(H("DISABLE_WEBAUDIO"))throw new ne(k.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const m=Vt(8,"track-buf-");R.info("start create buffer source audio track with config",JSON.stringify(h),"trackId",m);const g=d;if(!(d instanceof AudioBuffer))try{d=yield function(s,i){return sO.apply(this,arguments)}(d,a)}catch(C){return f.onError(C),C.throw(R)}const E=new l3(d),y=new Eu(g,E,l?xl(l):{},m);return R.info("create buffer source audio track success, trackId:",m),f.onSuccess(y.getTrackId()),y});return function(r){return s.apply(this,arguments)}}(),setAppType:function(s){if(R.debug("setAppType: ".concat(s)),!(Number.isInteger(s)&&s>=0))throw R.debug("Invalid appType"),new K(k.INVALID_PARAMS,"invalid app type",s);Bt("APP_TYPE",Math.floor(s))},setLogLevel:function(s){R.setLogLevel(s)},enableLogUpload:function(){H("USE_NEW_LOG")?Bt("UPLOAD_LOG",!0):R.enableLogUpload()},disableLogUpload:function(){H("USE_NEW_LOG")?Bt("UPLOAD_LOG",!1):R.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new dy},checkAudioTrackIsActive:function(){var s=x(function*(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const a=Te.reportApiInvoke(null,{tag:Kt.TRACER,name:jn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(i instanceof vt||i instanceof Ns)){const g=new K(k.INVALID_TRACK,"the parameter is not a audio track");return a.onError(g),g.throw()}r&&r<1e3&&(r=1e3);const l=i instanceof vt?i.getTrackLabel():"remote_track",d=i.getVolumeLevel();let h=d,f=d;const m=Date.now();return new q(g=>{const E=setInterval(()=>{const y=i.getVolumeLevel();h=y>h?y:h,f=y<f?y:f;const C=h-f>1e-4,b=Date.now()-m;if(C||b>r){clearInterval(E);const O=C,P={duration:b,deviceLabel:l,maxVolumeLevel:h,result:O};R.info("[track-".concat(i.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(P))),a.onSuccess(P),g(O)}},200)})});return function(r){return s.apply(this,arguments)}}(),checkVideoTrackIsActive:function(){var s=x(function*(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const a=Te.reportApiInvoke(null,{tag:Kt.TRACER,name:jn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(i instanceof Ye||i instanceof xc)){const C=new K(k.INVALID_TRACK,"the parameter is not a video track");return a.onError(C),C.throw()}r&&r<1e3&&(r=1e3);const l=i instanceof Ye?i.getTrackLabel():"remote_track",d=i.getMediaStreamTrack(!0),h=document.createElement("video");h.style.width="1px",h.style.height="1px",h.setAttribute("muted",""),h.muted=!0,h.setAttribute("playsinline",""),h.controls=!1,(Yt()||s_())&&(h.style.opacity="0.01",h.style.position="fixed",h.style.left="0",h.style.top="0",document.body.appendChild(h)),h.srcObject=new MediaStream([d]),h.play();const f=document.createElement("canvas");f.width=160,f.height=120;let m=0,g=0;try{const C=Date.now();m=yield function(b,O,P,D){let L,B=0,V=null;return new q((J,ae)=>{setTimeout(()=>{L&&(L(),J(B))},O),L=zD(()=>{!function(){B>4&&L&&(L(),J(B));const Q=P.getContext("2d");if(!Q){const Ce=new K(k.UNEXPECTED_ERROR,"can not get canvas 2d context.");return R.error(Ce.toString()),void ae(Ce)}Q.drawImage(b,0,0,160,120);const X=Q.getImageData(0,0,P.width,P.height),te=Math.floor(X.data.length/3);if(V){for(let Ce=0;Ce<te;Ce+=3)if(X.data[Ce]!==V[Ce])return B+=1,void(V=X.data);V=X.data}else V=X.data}()},30)})}(h,r,f),g=Date.now()-C}catch(C){throw a.onError(C),C}Qb===St.SAFARI&&(h.pause(),h.remove()),h.srcObject=null;const E=m>4,y={duration:g,changedPicNum:m,deviceLabel:l,result:E};return R.info("[track-".concat(i.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(y))),a.onSuccess(y),E});return function(r){return s.apply(this,arguments)}}(),setArea:qc,audioElementPlayCenter:qr,processExternalMediaAEC:function(s){M2.processExternalMediaAEC(s)},registerExtensions:function(s){s.forEach(i=>{const r=i;r.__registered__=!0,r.logger.hookLog=R.extLog,r.reporter.hookApiInvoke=Te.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach(a=>{r.parameters[a]=H(a)})})},ChannelMediaRelayError:kl,ChannelMediaRelayEvent:la,ChannelMediaRelayState:Er,RemoteStreamFallbackType:mT,RemoteStreamType:Fl,ConnectionDisconnectedReason:$e,AudienceLatencyLevelType:wS,AREAS:at});return Object.defineProperties(Ai,{onAudioAutoplayFailed:{get:()=>So.onAudioAutoplayFailed,set:s=>{So.onAudioAutoplayFailed=s}},onAutoplayFailed:{get:()=>So.onAutoplayFailed,set:s=>{So.onAutoplayFailed=s}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Ai._onSecurityPolicyViolation,set(s){Ai._onSecurityPolicyViolation=s,Zb(s)}},__CLIENT_LIST__:{get:()=>H("SHOW_GLOBAL_CLIENT_LIST")?Oc:[]}}),Or.on(kc.CAMERA_DEVICE_CHANGED,s=>{R.info("camera device changed",JSON.stringify(s)),Ai.onCameraChanged&&Ai.onCameraChanged(s),Ai.safeEmit(ua.CAMERA_CHANGED,s)}),Or.on(kc.RECORDING_DEVICE_CHANGED,s=>{R.info("microphone device changed",JSON.stringify(s)),Ai.onMicrophoneChanged&&Ai.onMicrophoneChanged(s),Ai.safeEmit(ua.MICROPHONE_CHANGED,s)}),Or.on(kc.PLAYOUT_DEVICE_CHANGED,s=>{R.debug("playout device changed",JSON.stringify(s)),Ai.onPlaybackDeviceChanged&&Ai.onPlaybackDeviceChanged(s),Ai.safeEmit(ua.PLAYBACK_DEVICE_CHANGED,s)}),qr.onAutoplayFailed=()=>{R.info("detect audio element autoplay failed"),So.onAudioAutoplayFailed&&So.onAudioAutoplayFailed()},Mt.on("autoplay-failed",()=>{R.info("detect webaudio autoplay failed"),So.onAudioAutoplayFailed&&So.onAudioAutoplayFailed(),Ai.safeEmit(ua.AUTOPLAY_FAILED)}),Hn.on(wl.NETWORK_STATE_CHANGE,(s,i)=>{R.info("[network-indicator] network state changed, ".concat(i," => ").concat(s))}),window&&(window.__ARTC__=Ai),Ai}()},357:(ba,Ra,ic)=>{"use strict";function x(n){return"function"==typeof n}let tl=!1;const cr={Promise:void 0,set useDeprecatedSynchronousErrorHandling(n){if(n){const e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else tl&&console.log("RxJS: Back to a better error behavior. Thank you. <3");tl=n},get useDeprecatedSynchronousErrorHandling(){return tl}};function hs(n){setTimeout(()=>{throw n},0)}const ps={closed:!0,next(n){},error(n){if(cr.useDeprecatedSynchronousErrorHandling)throw n;hs(n)},complete(){}},Ir=Array.isArray||(n=>n&&"number"==typeof n.length);function rc(n){return null!==n&&"object"==typeof n}const fs=(()=>{function n(e){return Error.call(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((t,o)=>`${o+1}) ${t.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e,this}return n.prototype=Object.create(Error.prototype),n})();class en{constructor(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}unsubscribe(){let e;if(this.closed)return;let{_parentOrParents:t,_ctorUnsubscribe:o,_unsubscribe:c,_subscriptions:u}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,t instanceof en)t.remove(this);else if(null!==t)for(let p=0;p<t.length;++p)t[p].remove(this);if(x(c)){o&&(this._unsubscribe=void 0);try{c.call(this)}catch(p){e=p instanceof fs?$y(p.errors):[p]}}if(Ir(u)){let p=-1,_=u.length;for(;++p<_;){const v=u[p];if(rc(v))try{v.unsubscribe()}catch(S){e=e||[],S instanceof fs?e=e.concat($y(S.errors)):e.push(S)}}}if(e)throw new fs(e)}add(e){let t=e;if(!e)return en.EMPTY;switch(typeof e){case"function":t=new en(e);case"object":if(t===this||t.closed||"function"!=typeof t.unsubscribe)return t;if(this.closed)return t.unsubscribe(),t;if(!(t instanceof en)){const u=t;t=new en,t._subscriptions=[u]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}let{_parentOrParents:o}=t;if(null===o)t._parentOrParents=this;else if(o instanceof en){if(o===this)return t;t._parentOrParents=[o,this]}else{if(-1!==o.indexOf(this))return t;o.push(this)}const c=this._subscriptions;return null===c?this._subscriptions=[t]:c.push(t),t}remove(e){const t=this._subscriptions;if(t){const o=t.indexOf(e);-1!==o&&t.splice(o,1)}}}var n;function $y(n){return n.reduce((e,t)=>e.concat(t instanceof fs?t.errors:t),[])}en.EMPTY=((n=new en).closed=!0,n);const Kp="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();class wn extends en{constructor(e,t,o){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=ps;break;case 1:if(!e){this.destination=ps;break}if("object"==typeof e){e instanceof wn?(this.syncErrorThrowable=e.syncErrorThrowable,this.destination=e,e.add(this)):(this.syncErrorThrowable=!0,this.destination=new Jy(this,e));break}default:this.syncErrorThrowable=!0,this.destination=new Jy(this,e,t,o)}}[Kp](){return this}static create(e,t,o){const c=new wn(e,t,o);return c.syncErrorThrowable=!1,c}next(e){this.isStopped||this._next(e)}error(e){this.isStopped||(this.isStopped=!0,this._error(e))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(e){this.destination.next(e)}_error(e){this.destination.error(e),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:e}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this}}class Jy extends wn{constructor(e,t,o,c){super(),this._parentSubscriber=e;let u,p=this;x(t)?u=t:t&&(u=t.next,o=t.error,c=t.complete,t!==ps&&(p=Object.create(t),x(p.unsubscribe)&&this.add(p.unsubscribe.bind(p)),p.unsubscribe=this.unsubscribe.bind(this))),this._context=p,this._next=u,this._error=o,this._complete=c}next(e){if(!this.isStopped&&this._next){const{_parentSubscriber:t}=this;cr.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}error(e){if(!this.isStopped){const{_parentSubscriber:t}=this,{useDeprecatedSynchronousErrorHandling:o}=cr;if(this._error)o&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)o?(t.syncErrorValue=e,t.syncErrorThrown=!0):hs(e),this.unsubscribe();else{if(this.unsubscribe(),o)throw e;hs(e)}}}complete(){if(!this.isStopped){const{_parentSubscriber:e}=this;if(this._complete){const t=()=>this._complete.call(this._context);cr.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,t),this.unsubscribe()):(this.__tryOrUnsub(t),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(e,t){try{e.call(this._context,t)}catch(o){if(this.unsubscribe(),cr.useDeprecatedSynchronousErrorHandling)throw o;hs(o)}}__tryOrSetError(e,t,o){if(!cr.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,o)}catch(c){return cr.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=c,e.syncErrorThrown=!0,!0):(hs(c),!0)}return!1}_unsubscribe(){const{_parentSubscriber:e}=this;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}const Vu="function"==typeof Symbol&&Symbol.observable||"@@observable";function qp(n){return n}let tn=(()=>{class n{constructor(t){this._isScalar=!1,t&&(this._subscribe=t)}lift(t){const o=new n;return o.source=this,o.operator=t,o}subscribe(t,o,c){const{operator:u}=this,p=function(n,e,t){if(n){if(n instanceof wn)return n;if(n[Kp])return n[Kp]()}return n||e||t?new wn(n,e,t):new wn(ps)}(t,o,c);if(p.add(u?u.call(p,this.source):this.source||cr.useDeprecatedSynchronousErrorHandling&&!p.syncErrorThrowable?this._subscribe(p):this._trySubscribe(p)),cr.useDeprecatedSynchronousErrorHandling&&p.syncErrorThrowable&&(p.syncErrorThrowable=!1,p.syncErrorThrown))throw p.syncErrorValue;return p}_trySubscribe(t){try{return this._subscribe(t)}catch(o){cr.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=o),function(n){for(;n;){const{closed:e,destination:t,isStopped:o}=n;if(e||o)return!1;n=t&&t instanceof wn?t:null}return!0}(t)?t.error(o):console.warn(o)}}forEach(t,o){return new(o=Qy(o))((c,u)=>{let p;p=this.subscribe(_=>{try{t(_)}catch(v){u(v),p&&p.unsubscribe()}},u,c)})}_subscribe(t){const{source:o}=this;return o&&o.subscribe(t)}[Vu](){return this}pipe(...t){return 0===t.length?this:function(n){return 0===n.length?qp:1===n.length?n[0]:function(t){return n.reduce((o,c)=>c(o),t)}}(t)(this)}toPromise(t){return new(t=Qy(t))((o,c)=>{let u;this.subscribe(p=>u=p,p=>c(p),()=>o(u))})}}return n.create=e=>new n(e),n})();function Qy(n){if(n||(n=cr.Promise||Promise),!n)throw new Error("no Promise impl found");return n}const nl=(()=>{function n(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return n.prototype=Object.create(Error.prototype),n})();class Zy extends en{constructor(e,t){super(),this.subject=e,this.subscriber=t,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const e=this.subject,t=e.observers;if(this.subject=null,!t||0===t.length||e.isStopped||e.closed)return;const o=t.indexOf(this.subscriber);-1!==o&&t.splice(o,1)}}class ev extends wn{constructor(e){super(e),this.destination=e}}let xt=(()=>{class n extends tn{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[Kp](){return new ev(this)}lift(t){const o=new Rm(this,this);return o.operator=t,o}next(t){if(this.closed)throw new nl;if(!this.isStopped){const{observers:o}=this,c=o.length,u=o.slice();for(let p=0;p<c;p++)u[p].next(t)}}error(t){if(this.closed)throw new nl;this.hasError=!0,this.thrownError=t,this.isStopped=!0;const{observers:o}=this,c=o.length,u=o.slice();for(let p=0;p<c;p++)u[p].error(t);this.observers.length=0}complete(){if(this.closed)throw new nl;this.isStopped=!0;const{observers:t}=this,o=t.length,c=t.slice();for(let u=0;u<o;u++)c[u].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(t){if(this.closed)throw new nl;return super._trySubscribe(t)}_subscribe(t){if(this.closed)throw new nl;return this.hasError?(t.error(this.thrownError),en.EMPTY):this.isStopped?(t.complete(),en.EMPTY):(this.observers.push(t),new Zy(this,t))}asObservable(){const t=new tn;return t.source=this,t}}return n.create=(e,t)=>new Rm(e,t),n})();class Rm extends xt{constructor(e,t){super(),this.destination=e,this.source=t}next(e){const{destination:t}=this;t&&t.next&&t.next(e)}error(e){const{destination:t}=this;t&&t.error&&this.destination.error(e)}complete(){const{destination:e}=this;e&&e.complete&&this.destination.complete()}_subscribe(e){const{source:t}=this;return t?this.source.subscribe(e):en.EMPTY}}function ad(n){return n&&"function"==typeof n.schedule}function Cn(n,e){return function(o){if("function"!=typeof n)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return o.lift(new FR(n,e))}}class FR{constructor(e,t){this.project=e,this.thisArg=t}call(e,t){return t.subscribe(new UR(e,this.project,this.thisArg))}}class UR extends wn{constructor(e,t,o){super(e),this.project=t,this.count=0,this.thisArg=o||this}_next(e){let t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(o){return void this.destination.error(o)}this.destination.next(t)}}const tv=n=>e=>{for(let t=0,o=n.length;t<o&&!e.closed;t++)e.next(n[t]);e.complete()},zp="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",nv=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function iv(n){return!!n&&"function"!=typeof n.subscribe&&"function"==typeof n.then}const Im=n=>{if(n&&"function"==typeof n[Vu])return(n=>e=>{const t=n[Vu]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)})(n);if(nv(n))return tv(n);if(iv(n))return(n=>e=>(n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,hs),e))(n);if(n&&"function"==typeof n[zp])return(n=>e=>{const t=n[zp]();for(;;){let o;try{o=t.next()}catch(c){return e.error(c),e}if(o.done){e.complete();break}if(e.next(o.value),e.closed)break}return"function"==typeof t.return&&e.add(()=>{t.return&&t.return()}),e})(n);{const t=`You provided ${rc(n)?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(t)}};function wm(n,e){return new tn(t=>{const o=new en;let c=0;return o.add(e.schedule(function(){c!==n.length?(t.next(n[c++]),t.closed||o.add(this.schedule())):t.complete()})),o})}function lr(n,e){return e?function(n,e){if(null!=n){if(function(n){return n&&"function"==typeof n[Vu]}(n))return function(n,e){return new tn(t=>{const o=new en;return o.add(e.schedule(()=>{const c=n[Vu]();o.add(c.subscribe({next(u){o.add(e.schedule(()=>t.next(u)))},error(u){o.add(e.schedule(()=>t.error(u)))},complete(){o.add(e.schedule(()=>t.complete()))}}))})),o})}(n,e);if(iv(n))return function(n,e){return new tn(t=>{const o=new en;return o.add(e.schedule(()=>n.then(c=>{o.add(e.schedule(()=>{t.next(c),o.add(e.schedule(()=>t.complete()))}))},c=>{o.add(e.schedule(()=>t.error(c)))}))),o})}(n,e);if(nv(n))return wm(n,e);if(function(n){return n&&"function"==typeof n[zp]}(n)||"string"==typeof n)return function(n,e){if(!n)throw new Error("Iterable cannot be null");return new tn(t=>{const o=new en;let c;return o.add(()=>{c&&"function"==typeof c.return&&c.return()}),o.add(e.schedule(()=>{c=n[zp](),o.add(e.schedule(function(){if(t.closed)return;let u,p;try{const _=c.next();u=_.value,p=_.done}catch(_){return void t.error(_)}p?t.complete():(t.next(u),this.schedule())}))})),o})}(n,e)}throw new TypeError((null!==n&&typeof n||n)+" is not observable")}(n,e):n instanceof tn?n:new tn(Im(n))}class ju extends wn{constructor(e){super(),this.parent=e}_next(e){this.parent.notifyNext(e)}_error(e){this.parent.notifyError(e),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class $p extends wn{notifyNext(e){this.destination.next(e)}notifyError(e){this.destination.error(e)}notifyComplete(){this.destination.complete()}}function cd(n,e){if(e.closed)return;if(n instanceof tn)return n.subscribe(e);let t;try{t=Im(n)(e)}catch(o){e.error(o)}return t}function Gi(n,e,t=Number.POSITIVE_INFINITY){return"function"==typeof e?o=>o.pipe(Gi((c,u)=>lr(n(c,u)).pipe(Cn((p,_)=>e(c,p,u,_))),t)):("number"==typeof e&&(t=e),o=>o.lift(new Am(n,t)))}class Am{constructor(e,t=Number.POSITIVE_INFINITY){this.project=e,this.concurrent=t}call(e,t){return t.subscribe(new ov(e,this.project,this.concurrent))}}class ov extends $p{constructor(e,t,o=Number.POSITIVE_INFINITY){super(e),this.project=t,this.concurrent=o,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}_tryNext(e){let t;const o=this.index++;try{t=this.project(e,o)}catch(c){return void this.destination.error(c)}this.active++,this._innerSub(t)}_innerSub(e){const t=new ju(this),o=this.destination;o.add(t);const c=cd(e,t);c!==t&&o.add(c)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(e){this.destination.next(e)}notifyComplete(){const e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function il(n=Number.POSITIVE_INFINITY){return Gi(qp,n)}function Hu(n,e){return e?wm(n,e):new tn(tv(n))}function sv(...n){let e=Number.POSITIVE_INFINITY,t=null,o=n[n.length-1];return ad(o)?(t=n.pop(),n.length>1&&"number"==typeof n[n.length-1]&&(e=n.pop())):"number"==typeof o&&(e=n.pop()),null===t&&1===n.length&&n[0]instanceof tn?n[0]:il(e)(Hu(n,t))}function gi(){return function(e){return e.lift(new Dm(e))}}class Dm{constructor(e){this.connectable=e}call(e,t){const{connectable:o}=this;o._refCount++;const c=new YR(e,o),u=t.subscribe(c);return c.closed||(c.connection=o.connect()),u}}class YR extends wn{constructor(e,t){super(e),this.connectable=t}_unsubscribe(){const{connectable:e}=this;if(!e)return void(this.connection=null);this.connectable=null;const t=e._refCount;if(t<=0)return void(this.connection=null);if(e._refCount=t-1,t>1)return void(this.connection=null);const{connection:o}=this,c=e._connection;this.connection=null,c&&(!o||c===o)&&c.unsubscribe()}}class av extends tn{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._refCount=0,this._isComplete=!1}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let e=this._connection;return e||(this._isComplete=!1,e=this._connection=new en,e.add(this.source.subscribe(new tM(this.getSubject(),this))),e.closed&&(this._connection=null,e=en.EMPTY)),e}refCount(){return gi()(this)}}const cv=(()=>{const n=av.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:n._subscribe},_isComplete:{value:n._isComplete,writable:!0},getSubject:{value:n.getSubject},connect:{value:n.connect},refCount:{value:n.refCount}}})();class tM extends ev{constructor(e,t){super(e),this.connectable=t}_error(e){this._unsubscribe(),super._error(e)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const e=this.connectable;if(e){this.connectable=null;const t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}}}function nM(){return new xt}function Sn(n){for(let e in n)if(n[e]===Sn)return e;throw Error("Could not find renamed property on target object.")}function Nm(n,e){for(const t in e)e.hasOwnProperty(t)&&!n.hasOwnProperty(t)&&(n[t]=e[t])}function Ft(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(Ft).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const e=n.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function Pm(n,e){return null==n||""===n?null===e?"":e:null==e||""===e?n:n+" "+e}const iM=Sn({__forward_ref__:Sn});function Ln(n){return n.__forward_ref__=Ln,n.toString=function(){return Ft(this())},n}function Ge(n){return JR(n)?n():n}function JR(n){return"function"==typeof n&&n.hasOwnProperty(iM)&&n.__forward_ref__===Ln}class Ia extends Error{constructor(e,t){super(function(n,e){return`${n?`NG0${n}: `:""}${e}`}(e,t)),this.code=e}}function At(n){return"string"==typeof n?n:null==n?"":String(n)}function un(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():At(n)}function ld(n,e){const t=e?` in ${e}`:"";throw new Ia("201",`No provider for ${un(n)} found${t}`)}function kr(n,e){null==n&&function(n,e,t,o){throw new Error(`ASSERTION ERROR: ${n}`+(null==o?"":` [Expected=> ${t} ${o} ${e} <=Actual]`))}(e,n,null,"!=")}function Pe(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function qt(n){return{providers:n.providers||[],imports:n.imports||[]}}function ac(n){return Po(n,Lm)||Po(n,eo)}function Po(n,e){return n.hasOwnProperty(e)?n[e]:null}function km(n){return n&&(n.hasOwnProperty(xm)||n.hasOwnProperty(hd))?n[xm]:null}const Lm=Sn({\u0275prov:Sn}),xm=Sn({\u0275inj:Sn}),eo=Sn({ngInjectableDef:Sn}),hd=Sn({ngInjectorDef:Sn});var et=(()=>((et=et||{})[et.Default=0]="Default",et[et.Host=1]="Host",et[et.Self=2]="Self",et[et.SkipSelf=4]="SkipSelf",et[et.Optional=8]="Optional",et))();let Xp;function cc(n){const e=Xp;return Xp=n,e}function uv(n,e,t){const o=ac(n);return o&&"root"==o.providedIn?void 0===o.value?o.value=o.factory():o.value:t&et.Optional?null:void 0!==e?e:void ld(Ft(n),"Injector")}function mo(n){return{toString:n}.toString()}var Mo=(()=>((Mo=Mo||{})[Mo.OnPush=0]="OnPush",Mo[Mo.Default=1]="Default",Mo))(),ui=(()=>((ui=ui||{})[ui.Emulated=0]="Emulated",ui[ui.None=2]="None",ui[ui.ShadowDom=3]="ShadowDom",ui))();const r0="undefined"!=typeof globalThis&&globalThis,cM="undefined"!=typeof window&&window,lM="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Nn=r0||"undefined"!=typeof global&&global||cM||lM,Hs={},Bn=[],Um=Sn({\u0275cmp:Sn}),hv=Sn({\u0275dir:Sn}),go=Sn({\u0275pipe:Sn}),o0=Sn({\u0275mod:Sn}),dM=Sn({\u0275loc:Sn}),Gs=Sn({\u0275fac:Sn}),pd=Sn({__NG_ELEMENT_ID__:Sn});let pv=0;function ki(n){return mo(()=>{const t={},o={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===Mo.OnPush,directiveDefs:null,pipeDefs:null,selectors:n.selectors||Bn,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||ui.Emulated,id:"c",styles:n.styles||Bn,_:null,setInput:null,schemas:n.schemas||null,tView:null},c=n.directives,u=n.features,p=n.pipes;return o.id+=pv++,o.inputs=Vm(n.inputs,t),o.outputs=Vm(n.outputs),u&&u.forEach(_=>_(o)),o.directiveDefs=c?()=>("function"==typeof c?c():c).map(fv):null,o.pipeDefs=p?()=>("function"==typeof p?p():p).map(_v):null,o})}function fv(n){return Lr(n)||function(n){return n[hv]||null}(n)}function _v(n){return function(n){return n[go]||null}(n)}const s0={};function ln(n){return mo(()=>{const e={type:n.type,bootstrap:n.bootstrap||Bn,declarations:n.declarations||Bn,imports:n.imports||Bn,exports:n.exports||Bn,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null};return null!=n.id&&(s0[n.id]=n.type),e})}function Vm(n,e){if(null==n)return Hs;const t={};for(const o in n)if(n.hasOwnProperty(o)){let c=n[o],u=c;Array.isArray(c)&&(u=c[1],c=c[0]),t[c]=o,e&&(e[c]=u)}return t}const Ae=ki;function Zi(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,onDestroy:n.type.prototype.ngOnDestroy||null}}function Lr(n){return n[Um]||null}function _s(n,e){const t=n[o0]||null;if(!t&&!0===e)throw new Error(`Type ${Ft(n)} does not have '\u0275mod' property.`);return t}function Ks(n){return Array.isArray(n)&&"object"==typeof n[1]}function qs(n){return Array.isArray(n)&&!0===n[1]}function mv(n){return 0!=(8&n.flags)}function jm(n){return 2==(2&n.flags)}function Hm(n){return 1==(1&n.flags)}function zs(n){return null!==n.template}function mM(n){return 0!=(512&n[2])}function _d(n,e){return n.hasOwnProperty(Gs)?n[Gs]:null}class l0{constructor(e,t,o){this.previousValue=e,this.currentValue=t,this.firstChange=o}isFirstChange(){return this.firstChange}}function Wi(){return Zp}function Zp(n){return n.type.prototype.ngOnChanges&&(n.setInput=yM),d0}function d0(){const n=u0(this),e=null==n?void 0:n.current;if(e){const t=n.previous;if(t===Hs)n.previous=e;else for(let o in e)t[o]=e[o];n.current=null,this.ngOnChanges(e)}}function yM(n,e,t,o){const c=u0(n)||function(n,e){return n[Km]=e}(n,{previous:Hs,current:null}),u=c.current||(c.current={}),p=c.previous,_=this.declaredInputs[t],v=p[_];u[_]=new l0(v&&v.currentValue,e,p===Hs),n[o]=e}Wi.ngInherit=!0;const Km="__ngSimpleChanges__";function u0(n){return n[Km]||null}const h0="http://www.w3.org/2000/svg";let th;function xi(n){return!!n.listen}const md={createRenderer:(n,e)=>void 0!==th?th:"undefined"!=typeof document?document:void 0};function hi(n){for(;Array.isArray(n);)n=n[0];return n}function Tn(n,e){return hi(e[n])}function xo(n,e){return hi(e[n.index])}function Sv(n,e){return n.data[e]}function sl(n,e){return n[e]}function Fo(n,e){const t=e[n];return Ks(t)?t:t[0]}function f0(n){return 4==(4&n[2])}function Tv(n){return 128==(128&n[2])}function al(n,e){return null==e?null:n[e]}function m0(n){n[18]=0}function bv(n,e){n[5]+=e;let t=n,o=n[3];for(;null!==o&&(1===e&&1===t[5]||-1===e&&0===t[5]);)o[5]+=e,t=o,o=o[3]}const tt={lFrame:Jm(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Rv(){return tt.bindingsEnabled}function Ee(){return tt.lFrame.lView}function hn(){return tt.lFrame.tView}function $s(n){return tt.lFrame.contextLView=n,n[8]}function er(){let n=E0();for(;null!==n&&64===n.type;)n=n.parent;return n}function E0(){return tt.lFrame.currentTNode}function Aa(n,e){const t=tt.lFrame;t.currentTNode=n,t.isParent=e}function qm(){return tt.lFrame.isParent}function nf(){tt.lFrame.isParent=!1}function gd(){return tt.isInCheckNoChangesMode}function zm(n){tt.isInCheckNoChangesMode=n}function to(){const n=tt.lFrame;let e=n.bindingRootIndex;return-1===e&&(e=n.bindingRootIndex=n.tView.bindingStartIndex),e}function nh(){return tt.lFrame.bindingIndex++}function AM(n,e){const t=tt.lFrame;t.bindingIndex=t.bindingRootIndex=n,Iv(e)}function Iv(n){tt.lFrame.currentDirectiveIndex=n}function v0(){return tt.lFrame.currentQueryIndex}function wv(n){tt.lFrame.currentQueryIndex=n}function OM(n){const e=n[1];return 2===e.type?e.declTNode:1===e.type?n[6]:null}function Av(n,e,t){if(t&et.SkipSelf){let c=e,u=n;for(;!(c=c.parent,null!==c||t&et.Host||(c=OM(u),null===c||(u=u[15],10&c.type))););if(null===c)return!1;e=c,n=u}const o=tt.lFrame=C0();return o.currentTNode=e,o.lView=n,!0}function $m(n){const e=C0(),t=n[1];tt.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function C0(){const n=tt.lFrame,e=null===n?null:n.child;return null===e?Jm(n):e}function Jm(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function Xm(){const n=tt.lFrame;return tt.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const we=Xm;function rf(){const n=Xm();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function Fr(){return tt.lFrame.selectedIndex}function pc(n){tt.lFrame.selectedIndex=n}function Di(){const n=tt.lFrame;return Sv(n.tView,n.selectedIndex)}function Js(){tt.lFrame.currentNamespace=h0}function Xs(){tt.lFrame.currentNamespace=null}function Qm(n,e){for(let t=e.directiveStart,o=e.directiveEnd;t<o;t++){const u=n.data[t].type.prototype,{ngAfterContentInit:p,ngAfterContentChecked:_,ngAfterViewInit:v,ngAfterViewChecked:S,ngOnDestroy:w}=u;p&&(n.contentHooks||(n.contentHooks=[])).push(-t,p),_&&((n.contentHooks||(n.contentHooks=[])).push(t,_),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(t,_)),v&&(n.viewHooks||(n.viewHooks=[])).push(-t,v),S&&((n.viewHooks||(n.viewHooks=[])).push(t,S),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(t,S)),null!=w&&(n.destroyHooks||(n.destroyHooks=[])).push(t,w)}}function of(n,e,t){S0(n,e,3,t)}function Zm(n,e,t,o){(3&n[2])===t&&S0(n,e,t,o)}function sf(n,e){let t=n[2];(3&t)===e&&(t&=2047,t+=1,n[2]=t)}function S0(n,e,t,o){const u=null!=o?o:-1,p=e.length-1;let _=0;for(let v=void 0!==o?65535&n[18]:0;v<p;v++)if("number"==typeof e[v+1]){if(_=e[v],null!=o&&_>=o)break}else e[v]<0&&(n[18]+=65536),(_<u||-1==u)&&(T0(n,t,e,v),n[18]=(4294901760&n[18])+v+2),v++}function T0(n,e,t,o){const c=t[o]<0,u=t[o+1],_=n[c?-t[o]:t[o]];if(c){if(n[2]>>11<n[18]>>16&&(3&n[2])===e){n[2]+=2048;try{u.call(_)}finally{}}}else try{u.call(_)}finally{}}class af{constructor(e,t,o){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=o}}function tg(n,e,t){const o=xi(n);let c=0;for(;c<t.length;){const u=t[c];if("number"==typeof u){if(0!==u)break;c++;const p=t[c++],_=t[c++],v=t[c++];o?n.setAttribute(e,_,v,p):e.setAttributeNS(p,_,v)}else{const p=u,_=t[++c];ng(p)?o&&n.setProperty(e,p,_):o?n.setAttribute(e,p,_):e.setAttribute(p,_),c++}}return c}function ih(n){return 3===n||4===n||6===n}function ng(n){return 64===n.charCodeAt(0)}function lf(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let o=0;o<e.length;o++){const c=e[o];"number"==typeof c?t=c:0===t||Dv(n,t,c,null,-1===t||2===t?e[++o]:null)}}return n}function Dv(n,e,t,o,c){let u=0,p=n.length;if(-1===e)p=-1;else for(;u<n.length;){const _=n[u++];if("number"==typeof _){if(_===e){p=-1;break}if(_>e){p=u-1;break}}}for(;u<n.length;){const _=n[u];if("number"==typeof _)break;if(_===t){if(null===o)return void(null!==c&&(n[u+1]=c));if(o===n[u+1])return void(n[u+2]=c)}u++,null!==o&&u++,null!==c&&u++}-1!==p&&(n.splice(p,0,e),u=p+1),n.splice(u++,0,t),null!==o&&n.splice(u++,0,o),null!==c&&n.splice(u++,0,c)}function w0(n){return-1!==n}function rh(n){return 32767&n}function Ed(n,e){let t=function(n){return n>>16}(n),o=e;for(;t>0;)o=o[15],t--;return o}let Ov=!0;function df(n){const e=Ov;return Ov=n,e}let BM=0;function uf(n,e){const t=Pv(n,e);if(-1!==t)return t;const o=e[1];o.firstCreatePass&&(n.injectorIndex=e.length,Nv(o.data,n),Nv(e,null),Nv(o.blueprint,null));const c=ig(n,e),u=n.injectorIndex;if(w0(c)){const p=rh(c),_=Ed(c,e),v=_[1].data;for(let S=0;S<8;S++)e[u+S]=_[p+S]|v[p+S]}return e[u+8]=c,u}function Nv(n,e){n.push(0,0,0,0,0,0,0,0,e)}function Pv(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function ig(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,o=null,c=e;for(;null!==c;){const u=c[1],p=u.type;if(o=2===p?u.declTNode:1===p?c[6]:null,null===o)return-1;if(t++,c=c[15],-1!==o.injectorIndex)return o.injectorIndex|t<<16}return-1}function hf(n,e,t){!function(n,e,t){let o;"string"==typeof t?o=t.charCodeAt(0)||0:t.hasOwnProperty(pd)&&(o=t[pd]),null==o&&(o=t[pd]=BM++);const c=255&o;e.data[n+(c>>5)]|=1<<c}(n,e,t)}function N0(n,e,t){if(t&et.Optional)return n;ld(e,"NodeInjector")}function P0(n,e,t,o){if(t&et.Optional&&void 0===o&&(o=null),0==(t&(et.Self|et.Host))){const c=n[9],u=cc(void 0);try{return c?c.get(e,o,t&et.Optional):uv(e,o,t&et.Optional)}finally{cc(u)}}return N0(o,e,t)}function M0(n,e,t,o=et.Default,c){if(null!==n){const u=function(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(pd)?n[pd]:void 0;return"number"==typeof e?e>=0?255&e:HM:e}(t);if("function"==typeof u){if(!Av(e,n,o))return o&et.Host?N0(c,t,o):P0(e,t,o,c);try{const p=u(o);if(null!=p||o&et.Optional)return p;ld(t)}finally{we()}}else if("number"==typeof u){let p=null,_=Pv(n,e),v=-1,S=o&et.Host?e[16][6]:null;for((-1===_||o&et.SkipSelf)&&(v=-1===_?ig(n,e):e[_+8],-1!==v&&L0(o,!1)?(p=e[1],_=rh(v),e=Ed(v,e)):_=-1);-1!==_;){const w=e[1];if(k0(u,_,w.data)){const M=GM(_,e,t,p,o,S);if(M!==Mv)return M}v=e[_+8],-1!==v&&L0(o,e[1].data[_+8]===S)&&k0(u,_,e)?(p=w,_=rh(v),e=Ed(v,e)):_=-1}}}return P0(e,t,o,c)}const Mv={};function HM(){return new sh(er(),Ee())}function GM(n,e,t,o,c,u){const p=e[1],_=p.data[n+8],w=oh(_,p,t,null==o?jm(_)&&Ov:o!=p&&0!=(3&_.type),c&et.Host&&u===_);return null!==w?dl(e,p,w,_):Mv}function oh(n,e,t,o,c){const u=n.providerIndexes,p=e.data,_=1048575&u,v=n.directiveStart,w=u>>20,F=c?_+w:n.directiveEnd;for(let j=o?_:_+w;j<F;j++){const W=p[j];if(j<v&&t===W||j>=v&&W.type===t)return j}if(c){const j=p[v];if(j&&zs(j)&&j.type===t)return v}return null}function dl(n,e,t,o){let c=n[t];const u=e.data;if(function(n){return n instanceof af}(c)){const p=c;p.resolving&&function(n,e){throw new Ia("200",`Circular dependency in DI detected for ${n}`)}(un(u[t]));const _=df(p.canSeeViewProviders);p.resolving=!0;const v=p.injectImpl?cc(p.injectImpl):null;Av(n,o,et.Default);try{c=n[t]=p.factory(void 0,u,n,o),e.firstCreatePass&&t>=o.directiveStart&&function(n,e,t){const{ngOnChanges:o,ngOnInit:c,ngDoCheck:u}=e.type.prototype;if(o){const p=Zp(e);(t.preOrderHooks||(t.preOrderHooks=[])).push(n,p),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,p)}c&&(t.preOrderHooks||(t.preOrderHooks=[])).push(0-n,c),u&&((t.preOrderHooks||(t.preOrderHooks=[])).push(n,u),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,u))}(t,u[t],e)}finally{null!==v&&cc(v),df(_),p.resolving=!1,we()}}return c}function k0(n,e,t){return!!(t[e+(n>>5)]&1<<n)}function L0(n,e){return!(n&et.Self||n&et.Host&&e)}class sh{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,o){return M0(this._tNode,this._lView,e,o,t)}}function pr(n){return mo(()=>{const e=n.prototype.constructor,t=e[Gs]||rg(e),o=Object.prototype;let c=Object.getPrototypeOf(n.prototype).constructor;for(;c&&c!==o;){const u=c[Gs]||rg(c);if(u&&u!==t)return u;c=Object.getPrototypeOf(c)}return u=>new u})}function rg(n){return JR(n)?()=>{const e=rg(Ge(n));return e&&e()}:_d(n)}function fc(n){return function(n,e){if("class"===e)return n.classes;if("style"===e)return n.styles;const t=n.attrs;if(t){const o=t.length;let c=0;for(;c<o;){const u=t[c];if(ih(u))break;if(0===u)c+=2;else if("number"==typeof u)for(c++;c<o&&"string"==typeof t[c];)c++;else{if(u===e)return t[c+1];c+=2}}}return null}(er(),n)}const ch="__parameters__";function vd(n,e,t){return mo(()=>{const o=function(n){return function(...t){if(n){const o=n(...t);for(const c in o)this[c]=o[c]}}}(e);function c(...u){if(this instanceof c)return o.apply(this,u),this;const p=new c(...u);return _.annotation=p,_;function _(v,S,w){const M=v.hasOwnProperty(ch)?v[ch]:Object.defineProperty(v,ch,{value:[]})[ch];for(;M.length<=w;)M.push(null);return(M[w]=M[w]||[]).push(p),v}}return t&&(c.prototype=Object.create(t.prototype)),c.prototype.ngMetadataName=n,c.annotationCls=c,c})}class je{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Pe({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}toString(){return`InjectionToken ${this._desc}`}}const F0=new je("AnalyzeForEntryComponents"),Sd=Function;function gs(n,e){void 0===e&&(e=n);for(let t=0;t<n.length;t++){let o=n[t];Array.isArray(o)?(e===n&&(e=n.slice(0,t)),gs(o,e)):e!==n&&e.push(o)}return e}function Qs(n,e){n.forEach(t=>Array.isArray(t)?Qs(t,e):e(t))}function _f(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function bd(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function ul(n,e){const t=[];for(let o=0;o<n;o++)t.push(e);return t}function Uo(n,e,t){let o=_c(n,e);return o>=0?n[1|o]=t:(o=~o,function(n,e,t,o){let c=n.length;if(c==e)n.push(t,o);else if(1===c)n.push(o,n[0]),n[0]=t;else{for(c--,n.push(n[c-1],n[c]);c>e;)n[c]=n[c-2],c--;n[e]=t,n[e+1]=o}}(n,o,e,t)),o}function og(n,e){const t=_c(n,e);if(t>=0)return n[1|t]}function _c(n,e){return function(n,e,t){let o=0,c=n.length>>t;for(;c!==o;){const u=o+(c-o>>1),p=n[u<<t];if(e===p)return u<<t;p>e?c=u:o=u+1}return~(c<<t)}(n,e,1)}const gf={},Vv="__NG_DI_FLAG__",Jn="ngTempTokenPath",ZM=/\n/gm,Bv="__source",jv=Sn({provide:String,useValue:Sn});let Ef;function hh(n){const e=Ef;return Ef=n,e}function n1(n,e=et.Default){if(void 0===Ef)throw new Error("inject() must be called from an injection context");return null===Ef?uv(n,void 0,e):Ef.get(n,e&et.Optional?null:void 0,e)}function ie(n,e=et.Default){return(Xp||n1)(Ge(n),e)}const W0=ie;function hl(n){const e=[];for(let t=0;t<n.length;t++){const o=Ge(n[t]);if(Array.isArray(o)){if(0===o.length)throw new Error("Arguments array must have arguments.");let c,u=et.Default;for(let p=0;p<o.length;p++){const _=o[p],v=i1(_);"number"==typeof v?-1===v?c=_.token:u|=v:c=_}e.push(ie(c,u))}else e.push(ie(o))}return e}function Oa(n,e){return n[Vv]=e,n.prototype[Vv]=e,n}function i1(n){return n[Vv]}function Hv(n,e,t,o){const c=n[Jn];throw e[Bv]&&c.unshift(e[Bv]),n.message=function(n,e,t,o=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.substr(2):n;let c=Ft(e);if(Array.isArray(e))c=e.map(Ft).join(" -> ");else if("object"==typeof e){let u=[];for(let p in e)if(e.hasOwnProperty(p)){let _=e[p];u.push(p+":"+("string"==typeof _?JSON.stringify(_):Ft(_)))}c=`{${u.join(", ")}}`}return`${t}${o?"("+o+")":""}[${c}]: ${n.replace(ZM,"\n  ")}`}("\n"+n.message,c,t,o),n.ngTokenPath=c,n[Jn]=null,n}const ph=Oa(vd("Inject",n=>({token:n})),-1),Eo=Oa(vd("Optional"),8),Na=Oa(vd("SkipSelf"),4);var Vo=(()=>((Vo=Vo||{})[Vo.Important=1]="Important",Vo[Vo.DashCase=2]="DashCase",Vo))();const lg="__ngContext__";function Ur(n,e){n[lg]=e}function Id(n){const e=function(n){return n[lg]||null}(n);return e?Array.isArray(e)?e:e.lView:null}function Sf(n,e){return undefined(n,e)}function Tf(n){const e=n[3];return qs(e)?e[3]:e}function Yv(n){return Jv(n[13])}function $v(n){return Jv(n[4])}function Jv(n){for(;null!==n&&!qs(n);)n=n[4];return n}function tr(n,e,t,o,c){if(null!=o){let u,p=!1;qs(o)?u=o:Ks(o)&&(p=!0,o=o[0]);const _=hi(o);0===n&&null!==t?null==c?_g(e,t,_):yc(e,t,_,c||null,!0):1===n&&null!==t?yc(e,t,_,c||null,!0):2===n?function(n,e,t){const o=If(n,e);o&&function(n,e,t,o){xi(n)?n.removeChild(e,t,o):e.removeChild(t)}(n,o,e,t)}(e,_,p):3===n&&e.destroyNode(_),null!=u&&function(n,e,t,o,c){const u=t[7];u!==hi(t)&&tr(e,n,o,u,c);for(let _=10;_<t.length;_++){const v=t[_];Af(v[1],v,n,e,o,u)}}(e,n,u,t,c)}}function dg(n,e,t){return xi(n)?n.createElement(e,t):null===t?n.createElement(e):n.createElementNS(t,e)}function fl(n,e){const t=n[9],o=t.indexOf(e),c=e[3];1024&e[2]&&(e[2]&=-1025,bv(c,-1)),t.splice(o,1)}function hg(n,e){if(n.length<=10)return;const t=10+e,o=n[t];if(o){const c=o[17];null!==c&&c!==n&&fl(c,o),e>0&&(n[t-1][4]=o[4]);const u=bd(n,10+e);!function(n,e){Af(n,e,e[11],2,null,null),e[0]=null,e[6]=null}(o[1],o);const p=u[19];null!==p&&p.detachView(u[1]),o[3]=null,o[4]=null,o[2]&=-129}return o}function oI(n,e){if(!(256&e[2])){const t=e[11];xi(t)&&t.destroyNode&&Af(n,e,t,3,null,null),function(n){let e=n[13];if(!e)return pg(n[1],n);for(;e;){let t=null;if(Ks(e))t=e[13];else{const o=e[10];o&&(t=o)}if(!t){for(;e&&!e[4]&&e!==n;)Ks(e)&&pg(e[1],e),e=e[3];null===e&&(e=n),Ks(e)&&pg(e[1],e),t=e&&e[4]}e=t}}(e)}}function pg(n,e){if(!(256&e[2])){e[2]&=-129,e[2]|=256,function(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let o=0;o<t.length;o+=2){const c=e[t[o]];if(!(c instanceof af)){const u=t[o+1];if(Array.isArray(u))for(let p=0;p<u.length;p+=2){const _=c[u[p]],v=u[p+1];try{v.call(_)}finally{}}else try{u.call(c)}finally{}}}}(n,e),function(n,e){const t=n.cleanup,o=e[7];let c=-1;if(null!==t)for(let u=0;u<t.length-1;u+=2)if("string"==typeof t[u]){const p=t[u+1],_="function"==typeof p?p(e):hi(e[p]),v=o[c=t[u+2]],S=t[u+3];"boolean"==typeof S?_.removeEventListener(t[u],v,S):S>=0?o[c=S]():o[c=-S].unsubscribe(),u+=2}else{const p=o[c=t[u+1]];t[u].call(p)}if(null!==o){for(let u=c+1;u<o.length;u++)o[u]();e[7]=null}}(n,e),1===e[1].type&&xi(e[11])&&e[11].destroy();const t=e[17];if(null!==t&&qs(e[3])){t!==e[3]&&fl(t,e);const o=e[19];null!==o&&o.detachView(n)}}}function sI(n,e,t){return function(n,e,t){let o=e;for(;null!==o&&40&o.type;)o=(e=o).parent;if(null===o)return t[0];if(2&o.flags){const c=n.data[o.directiveStart].encapsulation;if(c===ui.None||c===ui.Emulated)return null}return xo(o,t)}(n,e.parent,t)}function yc(n,e,t,o,c){xi(n)?n.insertBefore(e,t,o,c):e.insertBefore(t,o,c)}function _g(n,e,t){xi(n)?n.appendChild(e,t):e.appendChild(t)}function Rf(n,e,t,o,c){null!==o?yc(n,e,t,o,c):_g(n,e,t)}function If(n,e){return xi(n)?n.parentNode(e):e.parentNode}function eC(n,e,t){return nC(n,e,t)}let nC=function(n,e,t){return 40&n.type?xo(n,t):null};function mg(n,e,t,o){const c=sI(n,o,e),u=e[11],_=eC(o.parent||e[6],o,e);if(null!=c)if(Array.isArray(t))for(let v=0;v<t.length;v++)Rf(u,c,t[v],_,!1);else Rf(u,c,t,_,!1)}function gg(n,e){if(null!==e){const t=e.type;if(3&t)return xo(e,n);if(4&t)return oC(-1,n[e.index]);if(8&t){const o=e.child;if(null!==o)return gg(n,o);{const c=n[e.index];return qs(c)?oC(-1,c):hi(c)}}if(32&t)return Sf(e,n)()||hi(n[e.index]);{const o=rC(n,e);return null!==o?Array.isArray(o)?o[0]:gg(Tf(n[16]),o):gg(n,e.next)}}return null}function rC(n,e){return null!==e?n[16][6].projection[e.projection]:null}function oC(n,e){const t=10+n+1;if(t<e.length){const o=e[t],c=o[1].firstChild;if(null!==c)return gg(o,c)}return e[7]}function sC(n,e,t,o,c,u,p){for(;null!=t;){const _=o[t.index],v=t.type;if(p&&0===e&&(_&&Ur(hi(_),o),t.flags|=4),64!=(64&t.flags))if(8&v)sC(n,e,t.child,o,c,u,!1),tr(e,n,c,_,u);else if(32&v){const S=Sf(t,o);let w;for(;w=S();)tr(e,n,c,w,u);tr(e,n,c,_,u)}else 16&v?lI(n,e,o,t,c,u):tr(e,n,c,_,u);t=p?t.projectionNext:t.next}}function Af(n,e,t,o,c,u){sC(t,o,n.firstChild,e,c,u,!1)}function lI(n,e,t,o,c,u){const p=t[16],v=p[6].projection[o.projection];if(Array.isArray(v))for(let S=0;S<v.length;S++)tr(e,n,c,v[S],u);else sC(n,e,v,p[3],c,u,!0)}function aC(n,e,t){xi(n)?n.setAttribute(e,"style",t):e.style.cssText=t}function Eg(n,e,t){xi(n)?""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t):e.className=t}class ml{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function Vr(n){return n instanceof ml?n.changingThisBreaksApplicationSecurity:n}function ea(n,e){const t=function(n){return n instanceof ml&&n.getTypeName()||null}(n);if(null!=t&&t!==e){if("ResourceURL"===t&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${t} (see https://g.co/ng/security#xss)`)}return t===e}const gI=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,w1=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;var Xn=(()=>((Xn=Xn||{})[Xn.NONE=0]="NONE",Xn[Xn.HTML=1]="HTML",Xn[Xn.STYLE=2]="STYLE",Xn[Xn.SCRIPT=3]="SCRIPT",Xn[Xn.URL=4]="URL",Xn[Xn.RESOURCE_URL=5]="RESOURCE_URL",Xn))();function bh(n){const e=function(){const n=Ee();return n&&n[12]}();return e?e.sanitize(Xn.URL,n)||"":ea(n,"URL")?Vr(n):function(n){return(n=String(n)).match(gI)||n.match(w1)?n:"unsafe:"+n}(At(n))}function vg(n){return n.ngOriginalError}function B1(n,...e){n.error(...e)}class Dd{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e),o=this._findContext(e),c=function(n){return n&&n.ngErrorLogger||B1}(e);c(this._console,"ERROR",e),t&&c(this._console,"ORIGINAL ERROR",t),o&&c(this._console,"ERROR CONTEXT",o)}_findContext(e){return e?function(n){return n.ngDebugContext}(e)||this._findContext(vg(e)):null}_findOriginalError(e){let t=e&&vg(e);for(;t&&vg(t);)t=vg(t);return t||null}}const kf=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Nn))();function Ma(n){return n instanceof Function?n():n}function vC(n,e,t){let o=n.length;for(;;){const c=n.indexOf(e,t);if(-1===c)return c;if(0===c||n.charCodeAt(c-1)<=32){const u=e.length;if(c+u===o||n.charCodeAt(c+u)<=32)return c}t=c+1}}const CC="ng-template";function xI(n,e,t){let o=0;for(;o<n.length;){let c=n[o++];if(t&&"class"===c){if(c=n[o],-1!==vC(c.toLowerCase(),e,0))return!0}else if(1===c){for(;o<n.length&&"string"==typeof(c=n[o++]);)if(c.toLowerCase()===e)return!0;return!1}}return!1}function FI(n){return 4===n.type&&n.value!==CC}function q1(n,e,t){return e===(4!==n.type||t?n.value:CC)}function z1(n,e,t){let o=4;const c=n.attrs||[],u=function(n){for(let e=0;e<n.length;e++)if(ih(n[e]))return e;return n.length}(c);let p=!1;for(let _=0;_<e.length;_++){const v=e[_];if("number"!=typeof v){if(!p)if(4&o){if(o=2|1&o,""!==v&&!q1(n,v,t)||""===v&&1===e.length){if(ta(o))return!1;p=!0}}else{const S=8&o?v:e[++_];if(8&o&&null!==n.attrs){if(!xI(n.attrs,S,t)){if(ta(o))return!1;p=!0}continue}const M=Y1(8&o?"class":v,c,FI(n),t);if(-1===M){if(ta(o))return!1;p=!0;continue}if(""!==S){let F;F=M>u?"":c[M+1].toLowerCase();const j=8&o?F:null;if(j&&-1!==vC(j,S,0)||2&o&&S!==F){if(ta(o))return!1;p=!0}}}}else{if(!p&&!ta(o)&&!ta(v))return!1;if(p&&ta(v))continue;p=!1,o=v|1&o}}return ta(o)||p}function ta(n){return 0==(1&n)}function Y1(n,e,t,o){if(null===e)return-1;let c=0;if(o||!t){let u=!1;for(;c<e.length;){const p=e[c];if(p===n)return c;if(3===p||6===p)u=!0;else{if(1===p||2===p){let _=e[++c];for(;"string"==typeof _;)_=e[++c];continue}if(4===p)break;if(0===p){c+=4;continue}}c+=u?1:2}return-1}return function(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const o=n[t];if("number"==typeof o)return-1;if(o===e)return t;t++}return-1}(e,n)}function UI(n,e,t=!1){for(let o=0;o<e.length;o++)if(z1(n,e[o],t))return!0;return!1}function jI(n,e){e:for(let t=0;t<e.length;t++){const o=e[t];if(n.length===o.length){for(let c=0;c<n.length;c++)if(n[c]!==o[c])continue e;return!0}}return!1}function Sg(n,e){return n?":not("+e.trim()+")":e}function $1(n){let e=n[0],t=1,o=2,c="",u=!1;for(;t<n.length;){let p=n[t];if("string"==typeof p)if(2&o){const _=n[++t];c+="["+p+(_.length>0?'="'+_+'"':"")+"]"}else 8&o?c+="."+p:4&o&&(c+=" "+p);else""!==c&&!ta(p)&&(e+=Sg(u,c),c=""),o=p,u=u||!ta(o);t++}return""!==c&&(e+=Sg(u,c)),e}const yt={};function Ke(n){HI(hn(),Ee(),Fr()+n,gd())}function HI(n,e,t,o){if(!o)if(3==(3&e[2])){const u=n.preOrderCheckHooks;null!==u&&of(e,u,t)}else{const u=n.preOrderHooks;null!==u&&Zm(e,u,0,t)}pc(t)}function Tg(n,e){return n<<17|e<<2}function Bo(n){return n>>17&32767}function bg(n){return 2|n}function vc(n){return(131068&n)>>2}function Rg(n,e){return-131069&n|e<<2}function TC(n){return 1|n}function QI(n,e){const t=n.contentQueries;if(null!==t)for(let o=0;o<t.length;o+=2){const c=t[o],u=t[o+1];if(-1!==u){const p=n.data[u];wv(c),p.contentQueries(2,e[u],u)}}}function Pd(n,e,t,o,c,u,p,_,v,S){const w=e.blueprint.slice();return w[0]=c,w[2]=140|o,m0(w),w[3]=w[15]=n,w[8]=t,w[10]=p||n&&n[10],w[11]=_||n&&n[11],w[12]=v||n&&n[12]||null,w[9]=S||n&&n[9]||null,w[6]=u,w[16]=2==e.type?n[16]:w,w}function Ih(n,e,t,o,c){let u=n.data[e];if(null===u)u=function(n,e,t,o,c){const u=E0(),p=qm(),v=n.data[e]=function(n,e,t,o,c,u){return{type:t,index:o,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:c,attrs:u,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,p?u:u&&u.parent,t,e,o,c);return null===n.firstChild&&(n.firstChild=v),null!==u&&(p?null==u.child&&null!==v.parent&&(u.child=v):null===u.next&&(u.next=v)),v}(n,e,t,o,c),tt.lFrame.inI18n&&(u.flags|=64);else if(64&u.type){u.type=t,u.value=o,u.attrs=c;const p=function(){const n=tt.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();u.injectorIndex=null===p?-1:p.injectorIndex}return Aa(u,!0),u}function wh(n,e,t,o){if(0===t)return-1;const c=e.length;for(let u=0;u<t;u++)e.push(o),n.blueprint.push(o),n.data.push(null);return c}function Uf(n,e,t){$m(e);try{const o=n.viewQuery;null!==o&&FC(1,o,t);const c=n.template;null!==c&&tw(n,e,c,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&QI(n,e),n.staticViewQueries&&FC(2,n.viewQuery,t);const u=n.components;null!==u&&function(n,e){for(let t=0;t<e.length;t++)wk(n,e[t])}(e,u)}catch(o){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),o}finally{e[2]&=-5,rf()}}function Md(n,e,t,o){const c=e[2];if(256==(256&c))return;$m(e);const u=gd();try{m0(e),function(n){tt.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&tw(n,e,t,2,o);const p=3==(3&c);if(!u)if(p){const S=n.preOrderCheckHooks;null!==S&&of(e,S,null)}else{const S=n.preOrderHooks;null!==S&&Zm(e,S,0,null),sf(e,0)}if(function(n){for(let e=Yv(n);null!==e;e=$v(e)){if(!e[2])continue;const t=e[9];for(let o=0;o<t.length;o++){const c=t[o],u=c[3];0==(1024&c[2])&&bv(u,1),c[2]|=1024}}}(e),function(n){for(let e=Yv(n);null!==e;e=$v(e))for(let t=10;t<e.length;t++){const o=e[t],c=o[1];Tv(o)&&Md(c,o,c.template,o[8])}}(e),null!==n.contentQueries&&QI(n,e),!u)if(p){const S=n.contentCheckHooks;null!==S&&of(e,S)}else{const S=n.contentHooks;null!==S&&Zm(e,S,1),sf(e,1)}!function(n,e){const t=n.hostBindingOpCodes;if(null!==t)try{for(let o=0;o<t.length;o++){const c=t[o];if(c<0)pc(~c);else{const u=c,p=t[++o],_=t[++o];AM(p,u),_(2,e[u])}}}finally{pc(-1)}}(n,e);const _=n.components;null!==_&&function(n,e){for(let t=0;t<e.length;t++)Ik(n,e[t])}(e,_);const v=n.viewQuery;if(null!==v&&FC(2,v,o),!u)if(p){const S=n.viewCheckHooks;null!==S&&of(e,S)}else{const S=n.viewHooks;null!==S&&Zm(e,S,2),sf(e,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),u||(e[2]&=-73),1024&e[2]&&(e[2]&=-1025,bv(e[3],-1))}finally{rf()}}function ew(n,e,t,o){const c=e[10],u=!gd(),p=f0(e);try{u&&!p&&c.begin&&c.begin(),p&&Uf(n,e,o),Md(n,e,t,o)}finally{u&&!p&&c.end&&c.end()}}function tw(n,e,t,o,c){const u=Fr(),p=2&o;try{pc(-1),p&&e.length>20&&HI(n,e,20,gd()),t(o,c)}finally{pc(u)}}function nw(n,e,t){if(mv(e)){const c=e.directiveEnd;for(let u=e.directiveStart;u<c;u++){const p=n.data[u];p.contentQueries&&p.contentQueries(1,t[u],u)}}}function wg(n,e,t){!Rv()||(function(n,e,t,o){const c=t.directiveStart,u=t.directiveEnd;n.firstCreatePass||uf(t,e),Ur(o,e);const p=t.initialInputs;for(let _=c;_<u;_++){const v=n.data[_],S=zs(v);S&&Sk(e,t,v);const w=dl(e,n,_,t);Ur(w,e),null!==p&&Tk(0,_-c,w,v,0,p),S&&(Fo(t.index,e)[8]=w)}}(n,e,t,xo(t,e)),128==(128&t.flags)&&function(n,e,t){const o=t.directiveStart,c=t.directiveEnd,p=t.index,_=tt.lFrame.currentDirectiveIndex;try{pc(p);for(let v=o;v<c;v++){const S=n.data[v],w=e[v];Iv(v),(null!==S.hostBindings||0!==S.hostVars||null!==S.hostAttrs)&&Ag(S,w)}}finally{pc(-1),Iv(_)}}(n,e,t))}function DC(n,e,t=xo){const o=e.localNames;if(null!==o){let c=e.index+1;for(let u=0;u<o.length;u+=2){const p=o[u+1],_=-1===p?t(e,n):n[p];n[c++]=_}}}function iw(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=Vf(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):e}function Vf(n,e,t,o,c,u,p,_,v,S){const w=20+o,M=w+c,F=function(n,e){const t=[];for(let o=0;o<e;o++)t.push(o<n?null:yt);return t}(w,M),j="function"==typeof S?S():S;return F[1]={type:n,blueprint:F,template:t,queries:null,viewQuery:_,declTNode:e,data:F.slice().fill(null,w),bindingStartIndex:w,expandoStartIndex:M,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof u?u():u,pipeRegistry:"function"==typeof p?p():p,firstChild:null,schemas:v,consts:j,incompleteFirstPass:!1}}function OC(n,e,t,o){const c=gw(e);null===t?c.push(o):(c.push(t),n.firstCreatePass&&Ew(n).push(o,c.length-1))}function sw(n,e,t){for(let o in n)if(n.hasOwnProperty(o)){const c=n[o];(t=null===t?{}:t).hasOwnProperty(o)?t[o].push(e,c):t[o]=[e,c]}return t}function jo(n,e,t,o,c,u,p,_){const v=xo(e,t);let w,S=e.inputs;!_&&null!=S&&(w=S[o])?(vw(n,t,w,o,c),jm(e)&&function(n,e){const t=Fo(e,n);16&t[2]||(t[2]|=64)}(t,e.index)):3&e.type&&(o=function(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(o),c=null!=p?p(c,e.value||"",o):c,xi(u)?u.setProperty(v,o,c):ng(o)||(v.setProperty?v.setProperty(o,c):v[o]=c))}function PC(n,e,t,o){let c=!1;if(Rv()){const u=function(n,e,t){const o=n.directiveRegistry;let c=null;if(o)for(let u=0;u<o.length;u++){const p=o[u];UI(t,p.selectors,!1)&&(c||(c=[]),hf(uf(t,e),n,p.type),zs(p)?(uw(n,t),c.unshift(p)):c.push(p))}return c}(n,e,t),p=null===o?null:{"":-1};if(null!==u){c=!0,hw(t,n.data.length,u.length);for(let w=0;w<u.length;w++){const M=u[w];M.providersResolver&&M.providersResolver(M)}let _=!1,v=!1,S=wh(n,e,u.length,null);for(let w=0;w<u.length;w++){const M=u[w];t.mergedAttrs=lf(t.mergedAttrs,M.hostAttrs),pw(n,t,e,S,M),Ck(S,M,p),null!==M.contentQueries&&(t.flags|=8),(null!==M.hostBindings||null!==M.hostAttrs||0!==M.hostVars)&&(t.flags|=128);const F=M.type.prototype;!_&&(F.ngOnChanges||F.ngOnInit||F.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(t.index),_=!0),!v&&(F.ngOnChanges||F.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t.index),v=!0),S++}!function(n,e){const o=e.directiveEnd,c=n.data,u=e.attrs,p=[];let _=null,v=null;for(let S=e.directiveStart;S<o;S++){const w=c[S],M=w.inputs,F=null===u||FI(e)?null:bk(M,u);p.push(F),_=sw(M,S,_),v=sw(w.outputs,S,v)}null!==_&&(_.hasOwnProperty("class")&&(e.flags|=16),_.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=p,e.inputs=_,e.outputs=v}(n,t)}p&&function(n,e,t){if(e){const o=n.localNames=[];for(let c=0;c<e.length;c+=2){const u=t[e[c+1]];if(null==u)throw new Ia("301",`Export of name '${e[c+1]}' not found!`);o.push(e[c],u)}}}(t,o,p)}return t.mergedAttrs=lf(t.mergedAttrs,t.attrs),c}function MC(n,e,t,o,c,u){const p=u.hostBindings;if(p){let _=n.hostBindingOpCodes;null===_&&(_=n.hostBindingOpCodes=[]);const v=~e.index;(function(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(_)!=v&&_.push(v),_.push(o,c,p)}}function Ag(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function uw(n,e){e.flags|=2,(n.components||(n.components=[])).push(e.index)}function Ck(n,e,t){if(t){if(e.exportAs)for(let o=0;o<e.exportAs.length;o++)t[e.exportAs[o]]=n;zs(e)&&(t[""]=n)}}function hw(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}function pw(n,e,t,o,c){n.data[o]=c;const u=c.factory||(c.factory=_d(c.type)),p=new af(u,zs(c),null);n.blueprint[o]=p,t[o]=p,MC(n,e,0,o,wh(n,t,c.hostVars,yt),c)}function Sk(n,e,t){const o=xo(e,n),c=iw(t),u=n[10],p=Og(n,Pd(n,c,null,t.onPush?64:16,o,e,u,u.createRenderer(o,t),null,null));n[e.index]=p}function na(n,e,t,o,c,u){const p=xo(n,e);!function(n,e,t,o,c,u,p){if(null==u)xi(n)?n.removeAttribute(e,c,t):e.removeAttribute(c);else{const _=null==p?At(u):p(u,o||"",c);xi(n)?n.setAttribute(e,c,_,t):t?e.setAttributeNS(t,c,_):e.setAttribute(c,_)}}(e[11],p,u,n.value,t,o,c)}function Tk(n,e,t,o,c,u){const p=u[e];if(null!==p){const _=o.setInput;for(let v=0;v<p.length;){const S=p[v++],w=p[v++],M=p[v++];null!==_?o.setInput(t,M,S,w):t[w]=M}}}function bk(n,e){let t=null,o=0;for(;o<e.length;){const c=e[o];if(0!==c)if(5!==c){if("number"==typeof c)break;n.hasOwnProperty(c)&&(null===t&&(t=[]),t.push(c,n[c],e[o+1])),o+=2}else o+=2;else o+=4}return t}function fw(n,e,t,o){return new Array(n,!0,!1,e,null,0,o,t,null,null)}function Ik(n,e){const t=Fo(e,n);if(Tv(t)){const o=t[1];80&t[2]?Md(o,t,o.template,t[8]):t[5]>0&&Dg(t)}}function Dg(n){for(let o=Yv(n);null!==o;o=$v(o))for(let c=10;c<o.length;c++){const u=o[c];if(1024&u[2]){const p=u[1];Md(p,u,p.template,u[8])}else u[5]>0&&Dg(u)}const t=n[1].components;if(null!==t)for(let o=0;o<t.length;o++){const c=Fo(t[o],n);Tv(c)&&c[5]>0&&Dg(c)}}function wk(n,e){const t=Fo(e,n),o=t[1];(function(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])})(o,t),Uf(o,t,t[8])}function Og(n,e){return n[13]?n[14][4]=e:n[13]=e,n[14]=e,e}function LC(n){for(;n;){n[2]|=64;const e=Tf(n);if(mM(n)&&!e)return n;n=e}return null}function Ng(n,e,t){const o=e[10];o.begin&&o.begin();try{Md(n,e,n.template,t)}catch(c){throw yw(e,c),c}finally{o.end&&o.end()}}function mw(n){!function(n){for(let e=0;e<n.components.length;e++){const t=n.components[e],o=Id(t),c=o[1];ew(c,o,c.template,t)}}(n[8])}function FC(n,e,t){wv(0),e(n,t)}const Mk=(()=>Promise.resolve(null))();function gw(n){return n[7]||(n[7]=[])}function Ew(n){return n.cleanup||(n.cleanup=[])}function yw(n,e){const t=n[9],o=t?t.get(Dd,null):null;o&&o.handleError(e)}function vw(n,e,t,o,c){for(let u=0;u<t.length;){const p=t[u++],_=t[u++],v=e[p],S=n.data[p];null!==S.setInput?S.setInput(v,c,o,_):v[_]=c}}function Sc(n,e,t){const o=Tn(e,n);!function(n,e,t){xi(n)?n.setValue(e,t):e.textContent=t}(n[11],o,t)}function Pg(n,e,t){let o=t?n.styles:null,c=t?n.classes:null,u=0;if(null!==e)for(let p=0;p<e.length;p++){const _=e[p];"number"==typeof _?u=_:1==u?c=Pm(c,_):2==u&&(o=Pm(o,_+": "+e[++p]+";"))}t?n.styles=o:n.stylesWithoutHost=o,t?n.classes=c:n.classesWithoutHost=c}const yl=new je("INJECTOR",-1);class Cw{get(e,t=gf){if(t===gf){const o=new Error(`NullInjectorError: No provider for ${Ft(e)}!`);throw o.name="NullInjectorError",o}return t}}const jf=new je("Set Injector scope."),Hf={},xk={};let VC;function Sw(){return void 0===VC&&(VC=new Cw),VC}function BC(n,e=null,t=null,o){return new Uk(n,t,e||Sw(),o)}class Uk{constructor(e,t,o,c=null){this.parent=o,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const u=[];t&&Qs(t,_=>this.processProvider(_,e,t)),Qs([e],_=>this.processInjectorType(_,[],u)),this.records.set(yl,Ld(void 0,this));const p=this.records.get(jf);this.scope=null!=p?p.value:null,this.source=c||("object"==typeof e?null:Ft(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,t=gf,o=et.Default){this.assertNotDestroyed();const c=hh(this),u=cc(void 0);try{if(!(o&et.SkipSelf)){let _=this.records.get(e);if(void 0===_){const v=function(n){return"function"==typeof n||"object"==typeof n&&n instanceof je}(e)&&ac(e);_=v&&this.injectableDefInScope(v)?Ld(jC(e),Hf):null,this.records.set(e,_)}if(null!=_)return this.hydrate(e,_)}return(o&et.Self?Sw():this.parent).get(e,t=o&et.Optional&&t===gf?null:t)}catch(p){if("NullInjectorError"===p.name){if((p[Jn]=p[Jn]||[]).unshift(Ft(e)),c)throw p;return Hv(p,e,"R3InjectorError",this.source)}throw p}finally{cc(u),hh(c)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((o,c)=>e.push(Ft(c))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(e,t,o){if(!(e=Ge(e)))return!1;let c=km(e);const u=null==c&&e.ngModule||void 0,p=void 0===u?e:u,_=-1!==o.indexOf(p);if(void 0!==u&&(c=km(u)),null==c)return!1;if(null!=c.imports&&!_){let w;o.push(p);try{Qs(c.imports,M=>{this.processInjectorType(M,t,o)&&(void 0===w&&(w=[]),w.push(M))})}finally{}if(void 0!==w)for(let M=0;M<w.length;M++){const{ngModule:F,providers:j}=w[M];Qs(j,W=>this.processProvider(W,F,j||Bn))}}this.injectorDefTypes.add(p);const v=_d(p)||(()=>new p);this.records.set(p,Ld(v,Hf));const S=c.providers;if(null!=S&&!_){const w=e;Qs(S,M=>this.processProvider(M,w,S))}return void 0!==u&&void 0!==e.providers}processProvider(e,t,o){let c=Dh(e=Ge(e))?e:Ge(e&&e.provide);const u=function(n,e,t){return Ah(n)?Ld(void 0,n.useValue):Ld(Gf(n),Hf)}(e);if(Dh(e)||!0!==e.multi)this.records.get(c);else{let p=this.records.get(c);p||(p=Ld(void 0,Hf,!0),p.factory=()=>hl(p.multi),this.records.set(c,p)),c=e,p.multi.push(e)}this.records.set(c,u)}hydrate(e,t){return t.value===Hf&&(t.value=xk,t.value=t.factory()),"object"==typeof t.value&&t.value&&function(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this.onDestroy.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=Ge(e.providedIn);return"string"==typeof t?"any"===t||t===this.scope:this.injectorDefTypes.has(t)}}function jC(n){const e=ac(n),t=null!==e?e.factory:_d(n);if(null!==t)return t;if(n instanceof je)throw new Error(`Token ${Ft(n)} is missing a \u0275prov definition.`);if(n instanceof Function)return function(n){const e=n.length;if(e>0){const o=ul(e,"?");throw new Error(`Can't resolve all parameters for ${Ft(n)}: (${o.join(", ")}).`)}const t=function(n){const e=n&&(n[Lm]||n[eo]);if(e){const t=function(n){if(n.hasOwnProperty("name"))return n.name;const e=(""+n).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${t}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${t}" class.`),e}return null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new Error("unreachable")}function Gf(n,e,t){let o;if(Dh(n)){const c=Ge(n);return _d(c)||jC(c)}if(Ah(n))o=()=>Ge(n.useValue);else if(function(n){return!(!n||!n.useFactory)}(n))o=()=>n.useFactory(...hl(n.deps||[]));else if(function(n){return!(!n||!n.useExisting)}(n))o=()=>ie(Ge(n.useExisting));else{const c=Ge(n&&(n.useClass||n.provide));if(!function(n){return!!n.deps}(n))return _d(c)||jC(c);o=()=>new c(...hl(n.deps))}return o}function Ld(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function Ah(n){return null!==n&&"object"==typeof n&&jv in n}function Dh(n){return"function"==typeof n}const Iw=function(n,e,t){return function(n,e=null,t=null,o){const c=BC(n,e,t,o);return c._resolveInjectorDefTypes(),c}({name:t},e,n,t)};let An=(()=>{class n{static create(t,o){return Array.isArray(t)?Iw(t,o,""):Iw(t.providers,t.parent,t.name||"")}}return n.THROW_IF_NOT_FOUND=gf,n.NULL=new Cw,n.\u0275prov=Pe({token:n,providedIn:"any",factory:()=>ie(yl)}),n.__NG_ELEMENT_ID__=-1,n})();function $C(n,e){Qm(Id(n)[1],er())}function Dt(n){let e=function(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),t=!0;const o=[n];for(;e;){let c;if(zs(n))c=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new Error("Directives cannot inherit Components");c=e.\u0275dir}if(c){if(t){o.push(c);const p=n;p.inputs=Fd(n.inputs),p.declaredInputs=Fd(n.declaredInputs),p.outputs=Fd(n.outputs);const _=c.hostBindings;_&&ZC(n,_);const v=c.viewQuery,S=c.contentQueries;if(v&&xw(n,v),S&&QC(n,S),Nm(n.inputs,c.inputs),Nm(n.declaredInputs,c.declaredInputs),Nm(n.outputs,c.outputs),zs(c)&&c.data.animation){const w=n.data;w.animation=(w.animation||[]).concat(c.data.animation)}}const u=c.features;if(u)for(let p=0;p<u.length;p++){const _=u[p];_&&_.ngInherit&&_(n),_===Dt&&(t=!1)}}e=Object.getPrototypeOf(e)}!function(n){let e=0,t=null;for(let o=n.length-1;o>=0;o--){const c=n[o];c.hostVars=e+=c.hostVars,c.hostAttrs=lf(c.hostAttrs,t=lf(t,c.hostAttrs))}}(o)}function Fd(n){return n===Hs?{}:n===Bn?[]:n}function xw(n,e){const t=n.viewQuery;n.viewQuery=t?(o,c)=>{e(o,c),t(o,c)}:e}function QC(n,e){const t=n.contentQueries;n.contentQueries=t?(o,c,u)=>{e(o,c,u),t(o,c,u)}:e}function ZC(n,e){const t=n.hostBindings;n.hostBindings=t?(o,c)=>{e(o,c),t(o,c)}:e}let zf=null;function ia(){if(!zf){const n=Nn.Symbol;if(n&&n.iterator)zf=n.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const o=e[t];"entries"!==o&&"size"!==o&&Map.prototype[o]===Map.prototype.entries&&(zf=o)}}}return zf}class Go{constructor(e){this.wrapped=e}static wrap(e){return new Go(e)}static unwrap(e){return Go.isWrapped(e)?e.wrapped:e}static isWrapped(e){return e instanceof Go}}function Ud(n){return!!eS(n)&&(Array.isArray(n)||!(n instanceof Map)&&ia()in n)}function eS(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function La(n,e,t){return n[e]=t}function Ar(n,e,t){return!Object.is(n[e],t)&&(n[e]=t,!0)}function Vd(n,e,t,o){const c=Ar(n,e,t);return Ar(n,e+1,o)||c}function yi(n,e,t,o){const c=Ee();return Ar(c,nh(),e)&&(hn(),na(Di(),c,n,e,t,o)),yi}function Qn(n,e,t,o,c,u,p,_){const v=Ee(),S=hn(),w=n+20,M=S.firstCreatePass?function(n,e,t,o,c,u,p,_,v){const S=e.consts,w=Ih(e,n,4,p||null,al(S,_));PC(e,t,w,al(S,v)),Qm(e,w);const M=w.tViews=Vf(2,w,o,c,u,e.directiveRegistry,e.pipeRegistry,null,e.schemas,S);return null!==e.queries&&(e.queries.template(e,w),M.queries=e.queries.embeddedTView(w)),w}(w,S,v,e,t,o,c,u,p):S.data[w];Aa(M,!1);const F=v[11].createComment("");mg(S,v,F,M),Ur(F,v),Og(v,v[w]=fw(F,v,F,M)),Hm(M)&&wg(S,v,M),null!=p&&DC(v,M,_)}function Bg(n){return sl(tt.lFrame.contextLView,20+n)}function Y(n,e=et.Default){const t=Ee();return null===t?ie(n,e):M0(er(),t,Ge(n),e)}function Xe(n,e,t){const o=Ee();return Ar(o,nh(),e)&&jo(hn(),Di(),o,n,e,o[11],t,!1),Xe}function Gg(n,e,t,o,c){const p=c?"class":"style";vw(n,t,e.inputs[p],p,o)}function fe(n,e,t,o){const c=Ee(),u=hn(),p=20+n,_=c[11],v=c[p]=dg(_,e,tt.lFrame.currentNamespace),S=u.firstCreatePass?function(n,e,t,o,c,u,p){const _=e.consts,S=Ih(e,n,2,c,al(_,u));return PC(e,t,S,al(_,p)),null!==S.attrs&&Pg(S,S.attrs,!1),null!==S.mergedAttrs&&Pg(S,S.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,S),S}(p,u,c,0,e,t,o):u.data[p];Aa(S,!0);const w=S.mergedAttrs;null!==w&&tg(_,v,w);const M=S.classes;null!==M&&Eg(_,v,M);const F=S.styles;null!==F&&aC(_,v,F),64!=(64&S.flags)&&mg(u,c,v,S),0===tt.lFrame.elementDepthCount&&Ur(v,c),tt.lFrame.elementDepthCount++,Hm(S)&&(wg(u,c,S),nw(u,S,c)),null!==o&&DC(c,S)}function _e(){let n=er();qm()?nf():(n=n.parent,Aa(n,!1));const e=n;tt.lFrame.elementDepthCount--;const t=hn();t.firstCreatePass&&(Qm(t,n),mv(n)&&t.queries.elementEnd(n)),null!=e.classesWithoutHost&&function(n){return 0!=(16&n.flags)}(e)&&Gg(t,e,Ee(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function(n){return 0!=(32&n.flags)}(e)&&Gg(t,e,Ee(),e.stylesWithoutHost,!1)}function Ue(n,e,t,o){fe(n,e,t,o),_e()}function Kd(n,e,t){const o=Ee(),c=hn(),u=n+20,p=c.firstCreatePass?function(n,e,t,o,c){const u=e.consts,p=al(u,o),_=Ih(e,n,8,"ng-container",p);return null!==p&&Pg(_,p,!0),PC(e,t,_,al(u,c)),null!==e.queries&&e.queries.elementStart(e,_),_}(u,c,o,e,t):c.data[u];Aa(p,!0);const _=o[u]=o[11].createComment("");mg(c,o,_,p),Ur(_,o),Hm(p)&&(wg(c,o,p),nw(c,p,o)),null!=t&&DC(o,p)}function qd(){let n=er();const e=hn();qm()?nf():(n=n.parent,Aa(n,!1)),e.firstCreatePass&&(Qm(e,n),mv(n)&&e.queries.elementEnd(n))}function bl(){return Ee()}function n_(n){return!!n&&"function"==typeof n.then}function aA(n){return!!n&&"function"==typeof n.subscribe}const zd=aA;function dn(n,e,t,o){const c=Ee(),u=hn(),p=er();return function(n,e,t,o,c,u,p,_){const v=Hm(o),w=n.firstCreatePass&&Ew(n),M=e[8],F=gw(e);let j=!0;if(3&o.type||_){const $=xo(o,e),pe=_?_($):$,le=F.length,De=_?Le=>_(hi(Le[o.index])):o.index;if(xi(t)){let Le=null;if(!_&&v&&(Le=function(n,e,t,o){const c=n.cleanup;if(null!=c)for(let u=0;u<c.length-1;u+=2){const p=c[u];if(p===t&&c[u+1]===o){const _=e[7],v=c[u+2];return _.length>v?_[v]:null}"string"==typeof p&&(u+=2)}return null}(n,e,c,o.index)),null!==Le)(Le.__ngLastListenerFn__||Le).__ngNextListenerFn__=u,Le.__ngLastListenerFn__=u,j=!1;else{u=hS(o,e,M,u,!1);const wt=t.listen(pe,c,u);F.push(u,wt),w&&w.push(c,De,le,le+1)}}else u=hS(o,e,M,u,!0),pe.addEventListener(c,u,p),F.push(u),w&&w.push(c,De,le,p)}else u=hS(o,e,M,u,!1);const W=o.outputs;let ee;if(j&&null!==W&&(ee=W[c])){const $=ee.length;if($)for(let pe=0;pe<$;pe+=2){const zn=e[ee[pe]][ee[pe+1]].subscribe(u),di=F.length;F.push(u,zn),w&&w.push(c,o.index,di,-(di+1))}}}(u,c,c[11],p,n,e,!!t,o),dn}function dA(n,e,t,o){try{return!1!==t(o)}catch(c){return yw(n,c),!1}}function hS(n,e,t,o,c){return function u(p){if(p===Function)return o;const _=2&n.flags?Fo(n.index,e):e;0==(32&e[2])&&LC(_);let v=dA(e,0,o,p),S=u.__ngNextListenerFn__;for(;S;)v=dA(e,0,S,p)&&v,S=S.__ngNextListenerFn__;return c&&!1===v&&(p.preventDefault(),p.returnValue=!1),v}}function bn(n=1){return function(n){return(tt.lFrame.contextLView=function(n,e){for(;n>0;)e=e[15],n--;return e}(n,tt.lFrame.contextLView))[8]}(n)}function _L(n,e){let t=null;const o=function(n){const e=n.attrs;if(null!=e){const t=e.indexOf(5);if(0==(1&t))return e[t+1]}return null}(n);for(let c=0;c<e.length;c++){const u=e[c];if("*"!==u){if(null===o?UI(n,u,!0):jI(o,u))return c}else t=c}return t}function Rl(n){const e=Ee()[16][6];if(!e.projection){const o=e.projection=ul(n?n.length:1,null),c=o.slice();let u=e.child;for(;null!==u;){const p=n?_L(u,n):0;null!==p&&(c[p]?c[p].projectionNext=u:o[p]=u,c[p]=u),u=u.next}}}function Hr(n,e=0,t){const o=Ee(),c=hn(),u=Ih(c,20+n,16,null,t||null);null===u.projection&&(u.projection=e),nf(),64!=(64&u.flags)&&function(n,e,t){lI(e[11],0,e,t,sI(n,t,e),eC(t.parent||e[6],t,e))}(c,o,u)}function yA(n,e,t,o,c){const u=n[t+1],p=null===e;let _=o?Bo(u):vc(u),v=!1;for(;0!==_&&(!1===v||p);){const w=n[_+1];EL(n[_],e)&&(v=!0,n[_+1]=o?TC(w):bg(w)),_=o?Bo(w):vc(w)}v&&(n[t+1]=o?bg(u):TC(u))}function EL(n,e){return null===n||null==e||(Array.isArray(n)?n[1]:n)===e||!(!Array.isArray(n)||"string"!=typeof e)&&_c(n,e)>=0}function Wg(n,e,t){return sa(n,e,t,!1),Wg}function Jt(n,e){return sa(n,e,null,!0),Jt}function sa(n,e,t,o){const c=Ee(),u=hn(),p=function(n){const e=tt.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}(2);u.firstUpdatePass&&function(n,e,t,o){const c=n.data;if(null===c[t+1]){const u=c[Fr()],p=function(n,e){return e>=n.expandoStartIndex}(n,t);(function(n,e){return 0!=(n.flags&(e?16:32))})(u,o)&&null===e&&!p&&(e=!1),e=function(n,e,t,o){const c=function(n){const e=tt.lFrame.currentDirectiveIndex;return-1===e?null:n[e]}(n);let u=o?e.residualClasses:e.residualStyles;if(null===c)0===(o?e.classBindings:e.styleBindings)&&(t=Wo(t=o_(null,n,e,t,o),e.attrs,o),u=null);else{const p=e.directiveStylingLast;if(-1===p||n[p]!==c)if(t=o_(c,n,e,t,o),null===u){let v=function(n,e,t){const o=t?e.classBindings:e.styleBindings;if(0!==vc(o))return n[Bo(o)]}(n,e,o);void 0!==v&&Array.isArray(v)&&(v=o_(null,n,e,v[1],o),v=Wo(v,e.attrs,o),function(n,e,t,o){n[Bo(t?e.classBindings:e.styleBindings)]=o}(n,e,o,v))}else u=function(n,e,t){let o;const c=e.directiveEnd;for(let u=1+e.directiveStylingLast;u<c;u++)o=Wo(o,n[u].hostAttrs,t);return Wo(o,e.attrs,t)}(n,e,o)}return void 0!==u&&(o?e.residualClasses=u:e.residualStyles=u),t}(c,u,e,o),function(n,e,t,o,c,u){let p=u?e.classBindings:e.styleBindings,_=Bo(p),v=vc(p);n[o]=t;let w,S=!1;if(Array.isArray(t)){const M=t;w=M[1],(null===w||_c(M,w)>0)&&(S=!0)}else w=t;if(c)if(0!==v){const F=Bo(n[_+1]);n[o+1]=Tg(F,_),0!==F&&(n[F+1]=Rg(n[F+1],o)),n[_+1]=function(n,e){return 131071&n|e<<17}(n[_+1],o)}else n[o+1]=Tg(_,0),0!==_&&(n[_+1]=Rg(n[_+1],o)),_=o;else n[o+1]=Tg(v,0),0===_?_=o:n[v+1]=Rg(n[v+1],o),v=o;S&&(n[o+1]=bg(n[o+1])),yA(n,w,o,!0),yA(n,w,o,!1),function(n,e,t,o,c){const u=c?n.residualClasses:n.residualStyles;null!=u&&"string"==typeof e&&_c(u,e)>=0&&(t[o+1]=TC(t[o+1]))}(e,w,n,o,u),p=Tg(_,v),u?e.classBindings=p:e.styleBindings=p}(c,u,e,t,p,o)}}(u,n,p,o),e!==yt&&Ar(c,p,e)&&function(n,e,t,o,c,u,p,_){if(!(3&e.type))return;const v=n.data,S=v[_+1];qg(function(n){return 1==(1&n)}(S)?s_(v,e,t,c,vc(S),p):void 0)||(qg(u)||function(n){return 2==(2&n)}(S)&&(u=s_(v,null,t,c,_,p)),function(n,e,t,o,c){const u=xi(n);if(e)c?u?n.addClass(t,o):t.classList.add(o):u?n.removeClass(t,o):t.classList.remove(o);else{let p=-1===o.indexOf("-")?void 0:Vo.DashCase;if(null==c)u?n.removeStyle(t,o,p):t.style.removeProperty(o);else{const _="string"==typeof c&&c.endsWith("!important");_&&(c=c.slice(0,-10),p|=Vo.Important),u?n.setStyle(t,o,c,p):t.style.setProperty(o,c,_?"important":"")}}}(o,p,Tn(Fr(),t),c,u))}(u,u.data[Fr()],c,c[11],n,c[p+1]=function(n,e){return null==n||("string"==typeof e?n+=e:"object"==typeof n&&(n=Ft(Vr(n)))),n}(e,t),o,p)}function o_(n,e,t,o,c){let u=null;const p=t.directiveEnd;let _=t.directiveStylingLast;for(-1===_?_=t.directiveStart:_++;_<p&&(u=e[_],o=Wo(o,u.hostAttrs,c),u!==n);)_++;return null!==n&&(t.directiveStylingLast=_),o}function Wo(n,e,t){const o=t?1:2;let c=-1;if(null!==e)for(let u=0;u<e.length;u++){const p=e[u];"number"==typeof p?c=p:c===o&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),Uo(n,p,!!t||e[++u]))}return void 0===n?null:n}function s_(n,e,t,o,c,u){const p=null===e;let _;for(;c>0;){const v=n[c],S=Array.isArray(v),w=S?v[1]:v,M=null===w;let F=t[c+1];F===yt&&(F=M?Bn:void 0);let j=M?og(F,o):w===o?F:void 0;if(S&&!qg(j)&&(j=og(v,o)),qg(j)&&(_=j,p))return _;const W=n[c+1];c=p?Bo(W):vc(W)}if(null!==e){let v=u?e.residualClasses:e.residualStyles;null!=v&&(_=og(v,o))}return _}function qg(n){return void 0!==n}function Yt(n,e=""){const t=Ee(),o=hn(),c=n+20,u=o.firstCreatePass?Ih(o,c,1,e,null):o.data[c],p=t[c]=function(n,e){return xi(n)?n.createText(e):n.createTextNode(e)}(t[11],e);mg(o,t,p,u),Aa(u,!1)}function Pt(n){return Ci("",n,""),Pt}function Ci(n,e,t){const o=Ee(),c=function(n,e,t,o){return Ar(n,nh(),t)?e+At(t)+o:yt}(o,n,e,t);return c!==yt&&Sc(o,Fr(),c),Ci}function Xd(n,e,t){const o=Ee();return Ar(o,nh(),e)&&jo(hn(),Di(),o,n,e,o[11],t,!0),Xd}const Kt=void 0;var $e=["en",[["a","p"],["AM","PM"],Kt],[["AM","PM"],Kt,Kt],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Kt,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Kt,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Kt,"{1} 'at' {0}",Kt],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(n){const e=Math.floor(Math.abs(n)),t=n.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===t?1:5}];let We={};function Qd(n){return n in We||(We[n]=Nn.ng&&Nn.ng.common&&Nn.ng.common.locales&&Nn.ng.common.locales[n]),We[n]}var ke=(()=>((ke=ke||{})[ke.LocaleId=0]="LocaleId",ke[ke.DayPeriodsFormat=1]="DayPeriodsFormat",ke[ke.DayPeriodsStandalone=2]="DayPeriodsStandalone",ke[ke.DaysFormat=3]="DaysFormat",ke[ke.DaysStandalone=4]="DaysStandalone",ke[ke.MonthsFormat=5]="MonthsFormat",ke[ke.MonthsStandalone=6]="MonthsStandalone",ke[ke.Eras=7]="Eras",ke[ke.FirstDayOfWeek=8]="FirstDayOfWeek",ke[ke.WeekendRange=9]="WeekendRange",ke[ke.DateFormat=10]="DateFormat",ke[ke.TimeFormat=11]="TimeFormat",ke[ke.DateTimeFormat=12]="DateTimeFormat",ke[ke.NumberSymbols=13]="NumberSymbols",ke[ke.NumberFormats=14]="NumberFormats",ke[ke.CurrencyCode=15]="CurrencyCode",ke[ke.CurrencySymbol=16]="CurrencySymbol",ke[ke.CurrencyName=17]="CurrencyName",ke[ke.Currencies=18]="Currencies",ke[ke.Directionality=19]="Directionality",ke[ke.PluralCase=20]="PluralCase",ke[ke.ExtraData=21]="ExtraData",ke))();const Cs="en-US";let Ko=Cs;function Pn(n){kr(n,"Expected localeId to be defined"),"string"==typeof n&&(Ko=n.toLowerCase().replace(/_/g,"-"))}function iE(n,e,t,o,c){if(n=Ge(n),Array.isArray(n))for(let u=0;u<n.length;u++)iE(n[u],e,t,o,c);else{const u=hn(),p=Ee();let _=Dh(n)?n:Ge(n.provide),v=Gf(n);const S=er(),w=1048575&S.providerIndexes,M=S.directiveStart,F=S.providerIndexes>>20;if(Dh(n)||!n.multi){const j=new af(v,c,Y),W=oE(_,e,c?w:w+F,M);-1===W?(hf(uf(S,p),u,_),rE(u,n,e.length),e.push(_),S.directiveStart++,S.directiveEnd++,c&&(S.providerIndexes+=1048576),t.push(j),p.push(j)):(t[W]=j,p[W]=j)}else{const j=oE(_,e,w+F,M),W=oE(_,e,w,w+F),ee=j>=0&&t[j],$=W>=0&&t[W];if(c&&!$||!c&&!ee){hf(uf(S,p),u,_);const pe=function(n,e,t,o,c){const u=new af(n,t,Y);return u.multi=[],u.index=e,u.componentProviders=0,qS(u,c,o&&!t),u}(c?zS:tD,t.length,c,o,v);!c&&$&&(t[W].providerFactory=pe),rE(u,n,e.length,0),e.push(_),S.directiveStart++,S.directiveEnd++,c&&(S.providerIndexes+=1048576),t.push(pe),p.push(pe)}else rE(u,n,j>-1?j:W,qS(t[c?W:j],v,!c&&o));!c&&o&&$&&t[W].componentProviders++}}}function rE(n,e,t,o){const c=Dh(e);if(c||function(n){return!!n.useClass}(e)){const p=(e.useClass||e).prototype.ngOnDestroy;if(p){const _=n.destroyHooks||(n.destroyHooks=[]);if(!c&&e.multi){const v=_.indexOf(t);-1===v?_.push(t,[o,p]):_[v+1].push(o,p)}else _.push(t,p)}}}function qS(n,e,t){return t&&n.componentProviders++,n.multi.push(e)-1}function oE(n,e,t,o){for(let c=t;c<o;c++)if(e[c]===n)return c;return-1}function tD(n,e,t,o){return sE(this.multi,[])}function zS(n,e,t,o){const c=this.multi;let u;if(this.providerFactory){const p=this.providerFactory.componentProviders,_=dl(t,t[1],this.providerFactory.index,o);u=_.slice(0,p),sE(c,u);for(let v=p;v<_.length;v++)u.push(_[v])}else u=[],sE(c,u);return u}function sE(n,e){for(let t=0;t<n.length;t++)e.push((0,n[t])());return e}function Gt(n,e=[]){return t=>{t.providersResolver=(o,c)=>function(n,e,t){const o=hn();if(o.firstCreatePass){const c=zs(n);iE(t,o.data,o.blueprint,c,!0),iE(e,o.data,o.blueprint,c,!1)}}(o,c?c(n):n,e)}}class iD{}const rD="ngComponent";class aE{resolveComponentFactory(e){throw function(n){const e=Error(`No component factory found for ${Ft(n)}. Did you add it to @NgModule.entryComponents?`);return e[rD]=n,e}(e)}}let aa=(()=>{class n{}return n.NULL=new aE,n})();function m_(...n){}function Kh(n,e){return new Ot(xo(n,e))}const sD=function(){return Kh(er(),Ee())};let Ot=(()=>{class n{constructor(t){this.nativeElement=t}}return n.__NG_ELEMENT_ID__=sD,n})();function g_(n){return n instanceof Ot?n.nativeElement:n}class Dl{}let Ts=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>aD(),n})();const aD=function(){const n=Ee(),t=Fo(er().index,n);return function(n){return n[11]}(Ks(t)?t:n)};let JS=(()=>{class n{}return n.\u0275prov=Pe({token:n,providedIn:"root",factory:()=>null}),n})();class Ol{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const lD=new Ol("12.2.17");class cE{constructor(){}supports(e){return Ud(e)}create(e){return new qo(e)}}const dD=(n,e)=>e;class qo{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||dD}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,o=this._removalsHead,c=0,u=null;for(;t||o;){const p=!o||t&&t.currentIndex<Ac(o,c,u)?t:o,_=Ac(p,c,u),v=p.currentIndex;if(p===o)c--,o=o._nextRemoved;else if(t=t._next,null==p.previousIndex)c++;else{u||(u=[]);const S=_-c,w=v-c;if(S!=w){for(let F=0;F<S;F++){const j=F<u.length?u[F]:u[F]=0,W=j+F;w<=W&&W<S&&(u[F]=j+1)}u[p.previousIndex]=w-S}}_!==v&&e(p,_,v)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!Ud(e))throw new Error(`Error trying to diff '${Ft(e)}'. Only arrays and iterables are allowed`);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let c,u,p,t=this._itHead,o=!1;if(Array.isArray(e)){this.length=e.length;for(let _=0;_<this.length;_++)u=e[_],p=this._trackByFn(_,u),null!==t&&Object.is(t.trackById,p)?(o&&(t=this._verifyReinsertion(t,u,p,_)),Object.is(t.item,u)||this._addIdentityChange(t,u)):(t=this._mismatch(t,u,p,_),o=!0),t=t._next}else c=0,function(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{const t=n[ia()]();let o;for(;!(o=t.next()).done;)e(o.value)}}(e,_=>{p=this._trackByFn(c,_),null!==t&&Object.is(t.trackById,p)?(o&&(t=this._verifyReinsertion(t,_,p,c)),Object.is(t.item,_)||this._addIdentityChange(t,_)):(t=this._mismatch(t,_,p,c),o=!0),t=t._next,c++}),this.length=c;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,o,c){let u;return null===e?u=this._itTail:(u=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(o,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,u,c)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(o,c))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,u,c)):e=this._addAfter(new uD(t,o),u,c),e}_verifyReinsertion(e,t,o,c){let u=null===this._unlinkedRecords?null:this._unlinkedRecords.get(o,null);return null!==u?e=this._reinsertAfter(u,e._prev,c):e.currentIndex!=c&&(e.currentIndex=c,this._addToMoves(e,c)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,o){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const c=e._prevRemoved,u=e._nextRemoved;return null===c?this._removalsHead=u:c._nextRemoved=u,null===u?this._removalsTail=c:u._prevRemoved=c,this._insertAfter(e,t,o),this._addToMoves(e,o),e}_moveAfter(e,t,o){return this._unlink(e),this._insertAfter(e,t,o),this._addToMoves(e,o),e}_addAfter(e,t,o){return this._insertAfter(e,t,o),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,o){const c=null===t?this._itHead:t._next;return e._next=c,e._prev=t,null===c?this._itTail=e:c._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new pD),this._linkedRecords.put(e),e.currentIndex=o,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,o=e._next;return null===t?this._itHead=o:t._next=o,null===o?this._itTail=t:o._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new pD),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class uD{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class hD{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let o;for(o=this._head;null!==o;o=o._nextDup)if((null===t||t<=o.currentIndex)&&Object.is(o.trackById,e))return o;return null}remove(e){const t=e._prevDup,o=e._nextDup;return null===t?this._head=o:t._nextDup=o,null===o?this._tail=t:o._prevDup=t,null===this._head}}class pD{constructor(){this.map=new Map}put(e){const t=e.trackById;let o=this.map.get(t);o||(o=new hD,this.map.set(t,o)),o.add(e)}get(e,t){const c=this.map.get(e);return c?c.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Ac(n,e,t){const o=n.previousIndex;if(null===o)return o;let c=0;return t&&o<t.length&&(c=t[o]),o+e+c}class lE{constructor(){}supports(e){return e instanceof Map||eS(e)}create(){return new fD}}class fD{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||eS(e)))throw new Error(`Error trying to diff '${Ft(e)}'. Only maps and objects are allowed`)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(o,c)=>{if(t&&t.key===c)this._maybeAddToChanges(t,o),this._appendAfter=t,t=t._next;else{const u=this._getOrCreateRecordForKey(c,o);t=this._insertBeforeOrAppend(t,u)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let o=t;null!==o;o=o._nextRemoved)o===this._mapHead&&(this._mapHead=null),this._records.delete(o.key),o._nextRemoved=o._next,o.previousValue=o.currentValue,o.currentValue=null,o._prev=null,o._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const o=e._prev;return t._next=e,t._prev=o,e._prev=t,o&&(o._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const c=this._records.get(e);this._maybeAddToChanges(c,t);const u=c._prev,p=c._next;return u&&(u._next=p),p&&(p._prev=u),c._next=null,c._prev=null,c}const o=new _D(e);return this._records.set(e,o),o.currentValue=t,this._addToAdditions(o),o}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(o=>t(e[o],o))}}class _D{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function XS(){return new nu([new cE])}let nu=(()=>{class n{constructor(t){this.factories=t}static create(t,o){if(null!=o){const c=o.factories.slice();t=t.concat(c)}return new n(t)}static extend(t){return{provide:n,useFactory:o=>n.create(t,o||XS()),deps:[[n,new Na,new Eo]]}}find(t){const o=this.factories.find(c=>c.supports(t));if(null!=o)return o;throw new Error(`Cannot find a differ supporting object '${t}' of type '${function(n){return n.name||typeof n}(t)}'`)}}return n.\u0275prov=Pe({token:n,providedIn:"root",factory:XS}),n})();function QS(){return new iu([new lE])}let iu=(()=>{class n{constructor(t){this.factories=t}static create(t,o){if(o){const c=o.factories.slice();t=t.concat(c)}return new n(t)}static extend(t){return{provide:n,useFactory:o=>n.create(t,o||QS()),deps:[[n,new Na,new Eo]]}}find(t){const o=this.factories.find(c=>c.supports(t));if(o)return o;throw new Error(`Cannot find a differ supporting object '${t}'`)}}return n.\u0275prov=Pe({token:n,providedIn:"root",factory:QS}),n})();function dE(n,e,t,o,c=!1){for(;null!==t;){const u=e[t.index];if(null!==u&&o.push(hi(u)),qs(u))for(let _=10;_<u.length;_++){const v=u[_],S=v[1].firstChild;null!==S&&dE(v[1],v,S,o)}const p=t.type;if(8&p)dE(n,e,t.child,o);else if(32&p){const _=Sf(t,e);let v;for(;v=_();)o.push(v)}else if(16&p){const _=rC(e,t);if(Array.isArray(_))o.push(..._);else{const v=Tf(e[16]);dE(v[1],v,_,o,!0)}}t=c?t.projectionNext:t.next}return o}class qh{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return dE(t,e,t.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(qs(e)){const t=e[8],o=t?t.indexOf(this):-1;o>-1&&(hg(e,o),bd(t,o))}this._attachedToViewContainer=!1}oI(this._lView[1],this._lView)}onDestroy(e){OC(this._lView[1],this._lView,null,e)}markForCheck(){LC(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){Ng(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(n,e,t){zm(!0);try{Ng(n,e,t)}finally{zm(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function(n,e){Af(n,e,e[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}}class GL extends qh{constructor(e){super(e),this._view=e}detectChanges(){mw(this._view)}checkNoChanges(){!function(n){zm(!0);try{mw(n)}finally{zm(!1)}}(this._view)}get context(){return null}}const uE=function(n){return function(n,e,t){if(jm(n)&&!t){const o=Fo(n.index,e);return new qh(o,o)}return 47&n.type?new qh(e[16],e):null}(er(),Ee(),16==(16&n))};let zo=(()=>{class n{}return n.__NG_ELEMENT_ID__=uE,n})();const Yh=[new lE],KL=new nu([new cE]),hE=new iu(Yh),Gr=function(){return $h(er(),Ee())};let $o=(()=>{class n{}return n.__NG_ELEMENT_ID__=Gr,n})();const vD=$o,pE=class extends vD{constructor(e,t,o){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=o}createEmbeddedView(e){const t=this._declarationTContainer.tViews,o=Pd(this._declarationLView,t,e,16,null,t.declTNode,null,null,null,null);o[17]=this._declarationLView[this._declarationTContainer.index];const u=this._declarationLView[19];return null!==u&&(o[19]=u.createEmbeddedView(t)),Uf(t,o,e),new qh(o)}};function $h(n,e){return 4&n.type?new pE(e,n,Kh(n,e)):null}class bs{}class CD{}const SD=function(){return _E(er(),Ee())};let _r=(()=>{class n{}return n.__NG_ELEMENT_ID__=SD,n})();const Qe=_r,TD=class extends Qe{constructor(e,t,o){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=o}get element(){return Kh(this._hostTNode,this._hostLView)}get injector(){return new sh(this._hostTNode,this._hostLView)}get parentInjector(){const e=ig(this._hostTNode,this._hostLView);if(w0(e)){const t=Ed(e,this._hostLView),o=rh(e);return new sh(t[1].data[o+8],t)}return new sh(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=yo(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,o){const c=e.createEmbeddedView(t||{});return this.insert(c,o),c}createComponent(e,t,o,c,u){const p=o||this.parentInjector;if(!u&&null==e.ngModule&&p){const v=p.get(bs,null);v&&(u=v)}const _=e.create(p,c,void 0,u);return this.insert(_.hostView,t),_}insert(e,t){const o=e._lView,c=o[1];if(function(n){return qs(n[3])}(o)){const w=this.indexOf(e);if(-1!==w)this.detach(w);else{const M=o[3],F=new TD(M,M[6],M[3]);F.detach(F.indexOf(e))}}const u=this._adjustIndex(t),p=this._lContainer;!function(n,e,t,o){const c=10+o,u=t.length;o>0&&(t[c-1][4]=e),o<u-10?(e[4]=t[c],_f(t,10+o,e)):(t.push(e),e[4]=null),e[3]=t;const p=e[17];null!==p&&t!==p&&function(n,e){const t=n[9];e[16]!==e[3][3][16]&&(n[2]=!0),null===t?n[9]=[e]:t.push(e)}(p,e);const _=e[19];null!==_&&_.insertView(n),e[2]|=128}(c,o,p,u);const _=oC(u,p),v=o[11],S=If(v,p[7]);return null!==S&&function(n,e,t,o,c,u){o[0]=c,o[6]=e,Af(n,o,t,1,c,u)}(c,p[6],v,o,S,_),e.attachToViewContainerRef(),_f(E_(p),u,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=yo(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),o=hg(this._lContainer,t);o&&(bd(E_(this._lContainer),t),oI(o[1],o))}detach(e){const t=this._adjustIndex(e,-1),o=hg(this._lContainer,t);return o&&null!=bd(E_(this._lContainer),t)?new qh(o):null}_adjustIndex(e,t=0){return null==e?this.length+t:e}};function yo(n){return n[8]}function E_(n){return n[8]||(n[8]=[])}function _E(n,e){let t;const o=e[n.index];if(qs(o))t=o;else{let c;if(8&n.type)c=hi(o);else{const u=e[11];c=u.createComment("");const p=xo(n,e);yc(u,If(u,p),c,function(n,e){return xi(n)?n.nextSibling(e):e.nextSibling}(u,p),!1)}e[n.index]=t=fw(o,e,c,n),Og(e,t)}return new TD(t,n,e)}const du={};class lT extends aa{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=Lr(e);return new uT(t,this.ngModule)}}function dT(n){const e=[];for(let t in n)n.hasOwnProperty(t)&&e.push({propName:n[t],templateName:t});return e}const T_=new je("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>kf});class uT extends iD{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function(n){return n.map($1).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return dT(this.componentDef.inputs)}get outputs(){return dT(this.componentDef.outputs)}create(e,t,o,c){const u=(c=c||this.ngModule)?function(n,e){return{get:(t,o,c)=>{const u=n.get(t,du,c);return u!==du||o===du?u:e.get(t,o,c)}}}(e,c.injector):e,p=u.get(Dl,md),_=u.get(JS,null),v=p.createRenderer(null,this.componentDef),S=this.componentDef.selectors[0][0]||"div",w=o?function(n,e,t){if(xi(n))return n.selectRootElement(e,t===ui.ShadowDom);let o="string"==typeof e?n.querySelector(e):e;return o.textContent="",o}(v,o,this.componentDef.encapsulation):dg(p.createRenderer(null,this.componentDef),S,function(n){const e=n.toLowerCase();return"svg"===e?h0:"math"===e?"http://www.w3.org/1998/MathML/":null}(S)),M=this.componentDef.onPush?576:528,F=function(n,e){return{components:[],scheduler:n||kf,clean:Mk,playerHandler:e||null,flags:0}}(),j=Vf(0,null,null,1,0,null,null,null,null,null),W=Pd(null,j,F,M,null,null,p,v,_,u);let ee,$;$m(W);try{const pe=function(n,e,t,o,c,u){const p=t[1];t[20]=n;const v=Ih(p,20,2,"#host",null),S=v.mergedAttrs=e.hostAttrs;null!==S&&(Pg(v,S,!0),null!==n&&(tg(c,n,S),null!==v.classes&&Eg(c,n,v.classes),null!==v.styles&&aC(c,n,v.styles)));const w=o.createRenderer(n,e),M=Pd(t,iw(e),null,e.onPush?64:16,t[20],v,o,w,u||null,null);return p.firstCreatePass&&(hf(uf(v,t),p,e.type),uw(p,v),hw(v,t.length,1)),Og(t,M),t[20]=M}(w,this.componentDef,W,p,v);if(w)if(o)tg(v,w,["ng-version",lD.full]);else{const{attrs:le,classes:De}=function(n){const e=[],t=[];let o=1,c=2;for(;o<n.length;){let u=n[o];if("string"==typeof u)2===c?""!==u&&e.push(u,n[++o]):8===c&&t.push(u);else{if(!ta(c))break;c=u}o++}return{attrs:e,classes:t}}(this.componentDef.selectors[0]);le&&tg(v,w,le),De&&De.length>0&&Eg(v,w,De.join(" "))}if($=Sv(j,20),void 0!==t){const le=$.projection=[];for(let De=0;De<this.ngContentSelectors.length;De++){const Le=t[De];le.push(null!=Le?Array.from(Le):null)}}ee=function(n,e,t,o,c){const u=t[1],p=function(n,e,t){const o=er();n.firstCreatePass&&(t.providersResolver&&t.providersResolver(t),pw(n,o,e,wh(n,e,1,null),t));const c=dl(e,n,o.directiveStart,o);Ur(c,e);const u=xo(o,e);return u&&Ur(u,e),c}(u,t,e);if(o.components.push(p),n[8]=p,c&&c.forEach(v=>v(p,e)),e.contentQueries){const v=er();e.contentQueries(1,p,v.directiveStart)}const _=er();return!u.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(pc(_.index),MC(t[1],_,0,_.directiveStart,_.directiveEnd,e),Ag(e,p)),p}(pe,this.componentDef,W,F,[$C]),Uf(j,W,null)}finally{rf()}return new hT(this.componentType,ee,Kh($,W),W,$)}}class hT extends class{}{constructor(e,t,o,c,u){super(),this.location=o,this._rootLView=c,this._tNode=u,this.instance=t,this.hostView=this.changeDetectorRef=new GL(c),this.componentType=e}get injector(){return new sh(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}const ep=new Map;class UD extends bs{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new lT(this);const o=_s(e),c=function(n){return n[dM]||null}(e);c&&Pn(c),this._bootstrapComponents=Ma(o.bootstrap),this._r3Injector=BC(e,t,[{provide:bs,useValue:this},{provide:aa,useValue:this.componentFactoryResolver}],Ft(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,t=An.THROW_IF_NOT_FOUND,o=et.Default){return e===An||e===bs||e===yl?this:this._r3Injector.get(e,t,o)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class pT extends CD{constructor(e){super(),this.moduleType=e,null!==_s(e)&&function(n){const e=new Set;!function t(o){const c=_s(o,!0),u=c.id;null!==u&&(function(n,e,t){if(e&&e!==t)throw new Error(`Duplicate module registered for ${n} - ${Ft(e)} vs ${Ft(e.name)}`)}(u,ep.get(u),o),ep.set(u,o));const p=Ma(c.imports);for(const _ of p)e.has(_)||(e.add(_),t(_))}(n)}(e)}create(e){return new UD(this.moduleType,e)}}function VD(n,e,t,o,c,u,p){return function(n,e,t,o,c,u,p,_,v){const S=e+t;return function(n,e,t,o,c,u){const p=Vd(n,e,t,o);return Vd(n,e+2,c,u)||p}(n,S,c,u,p,_)?La(n,S+4,v?o.call(v,c,u,p,_):o(c,u,p,_)):uu(n,S+4)}(Ee(),to(),n,e,t,o,c,u,p)}function uu(n,e){const t=n[e];return t===yt?void 0:t}function BD(n,e,t,o,c,u){const p=e+t;return Ar(n,p,c)?La(n,p+1,u?o.call(u,c):o(c)):uu(n,p+1)}function Ll(n,e){const t=hn();let o;const c=n+20;t.firstCreatePass?(o=function(n,e){if(e)for(let t=e.length-1;t>=0;t--){const o=e[t];if(n===o.name)return o}throw new Ia("302",`The pipe '${n}' could not be found!`)}(e,t.pipeRegistry),t.data[c]=o,o.onDestroy&&(t.destroyHooks||(t.destroyHooks=[])).push(c,o.onDestroy)):o=t.data[c];const u=o.factory||(o.factory=_d(o.type)),p=cc(Y);try{const _=df(!1),v=u();return df(_),function(n,e,t,o){t>=n.data.length&&(n.data[t]=null,n.blueprint[t]=null),e[t]=o}(t,Ee(),c,v),v}finally{cc(p)}}function xl(n,e,t){const o=n+20,c=Ee(),u=sl(c,o);return function(n,e){Go.isWrapped(e)&&(e=Go.unwrap(e),n[tt.lFrame.bindingIndex]=yt);return e}(c,function(n,e){return n[1].data[e].pure}(c,o)?BD(c,to(),e,u.transform,t,u):u.transform(t))}function Ul(n){return e=>{setTimeout(n,void 0,e)}}const ft=class extends xt{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,o){var c,u,p;let _=e,v=t||(()=>null),S=o;if(e&&"object"==typeof e){const M=e;_=null===(c=M.next)||void 0===c?void 0:c.bind(M),v=null===(u=M.error)||void 0===u?void 0:u.bind(M),S=null===(p=M.complete)||void 0===p?void 0:p.bind(M)}this.__isAsync&&(v=Ul(v),_&&(_=Ul(_)),S&&(S=Ul(S)));const w=super.subscribe({next:_,error:v,complete:S});return e instanceof en&&e.add(w),w}};function hu(){return this._results[ia()]()}class rr{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=ia(),o=rr.prototype;o[t]||(o[t]=hu)}get changes(){return this._changes||(this._changes=new ft)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const o=this;o.dirty=!1;const c=gs(e);(this._changesDetected=!function(n,e,t){if(n.length!==e.length)return!1;for(let o=0;o<n.length;o++){let c=n[o],u=e[o];if(t&&(c=t(c),u=t(u)),u!==c)return!1}return!0}(o._results,c,t))&&(o._results=c,o.length=c.length,o.last=c[this.length-1],o.first=c[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;class wE{constructor(e){this.queryList=e,this.matches=null}clone(){return new wE(this.queryList)}setDirty(){this.queryList.setDirty()}}class ET{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const o=null!==e.contentQueries?e.contentQueries[0]:t.length,c=[];for(let u=0;u<o;u++){const p=t.getByIndex(u);c.push(this.queries[p.indexInDeclarationView].clone())}return new ET(c)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==Vl(e,t).matches&&this.queries[t].setDirty()}}class yT{constructor(e,t,o=null){this.predicate=e,this.flags=t,this.read=o}}class Fi{constructor(e=[]){this.queries=e}elementStart(e,t){for(let o=0;o<this.queries.length;o++)this.queries[o].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let o=0;o<this.length;o++){const c=null!==t?t.length:0,u=this.getByIndex(o).embeddedTView(e,c);u&&(u.indexInDeclarationView=o,null!==t?t.push(u):t=[u])}return null!==t?new Fi(t):null}template(e,t){for(let o=0;o<this.queries.length;o++)this.queries[o].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class yr{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new yr(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let o=e.parent;for(;null!==o&&8&o.type&&o.index!==t;)o=o.parent;return t===(null!==o?o.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const o=this.metadata.predicate;if(Array.isArray(o))for(let c=0;c<o.length;c++){const u=o[c];this.matchTNodeWithReadOption(e,t,pu(t,u)),this.matchTNodeWithReadOption(e,t,oh(t,e,u,!1,!1))}else o===$o?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,oh(t,e,o,!1,!1))}matchTNodeWithReadOption(e,t,o){if(null!==o){const c=this.metadata.read;if(null!==c)if(c===Ot||c===_r||c===$o&&4&t.type)this.addMatch(t.index,-2);else{const u=oh(t,e,c,!1,!1);null!==u&&this.addMatch(t.index,u)}else this.addMatch(t.index,o)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function pu(n,e){const t=n.localNames;if(null!==t)for(let o=0;o<t.length;o+=2)if(t[o]===e)return t[o+1];return null}function Yi(n,e,t,o){return-1===t?function(n,e){return 11&n.type?Kh(n,e):4&n.type?$h(n,e):null}(e,n):-2===t?function(n,e,t){return t===Ot?Kh(e,n):t===$o?$h(e,n):t===_r?_E(e,n):void 0}(n,e,o):dl(n,n[1],t,e)}function fu(n,e,t,o){const c=e[19].queries[o];if(null===c.matches){const u=n.data,p=t.matches,_=[];for(let v=0;v<p.length;v+=2){const S=p[v];_.push(S<0?null:Yi(e,u[S],p[v+1],t.metadata.read))}c.matches=_}return c.matches}function AE(n,e,t,o){const c=n.queries.getByIndex(t),u=c.matches;if(null!==u){const p=fu(n,e,c,t);for(let _=0;_<u.length;_+=2){const v=u[_];if(v>0)o.push(p[_/2]);else{const S=u[_+1],w=e[-v];for(let M=10;M<w.length;M++){const F=w[M];F[17]===F[3]&&AE(F[1],F,S,o)}if(null!==w[9]){const M=w[9];for(let F=0;F<M.length;F++){const j=M[F];AE(j[1],j,S,o)}}}}}return o}function jt(n){const e=Ee(),t=hn(),o=v0();wv(o+1);const c=Vl(t,o);if(n.dirty&&f0(e)===(2==(2&c.metadata.flags))){if(null===c.matches)n.reset([]);else{const u=c.crossesNgTemplate?AE(t,e,o,[]):fu(t,e,c,o);n.reset(u,g_),n.notifyOnChanges()}return!0}return!1}function pa(n,e,t){const o=hn();o.firstCreatePass&&(_u(o,new yT(n,e,t),-1),2==(2&e)&&(o.staticViewQueries=!0)),KD(o,Ee(),e)}function Xo(n,e,t,o){const c=hn();if(c.firstCreatePass){const u=er();_u(c,new yT(e,t,o),u.index),function(n,e){const t=n.contentQueries||(n.contentQueries=[]);e!==(t.length?t[t.length-1]:-1)&&t.push(n.queries.length-1,e)}(c,n),2==(2&t)&&(c.staticContentQueries=!0)}KD(c,Ee(),t)}function fn(){return function(n,e){return n[19].queries[e].queryList}(Ee(),v0())}function KD(n,e,t){const o=new rr(4==(4&t));OC(n,e,o,o.destroy),null===e[19]&&(e[19]=new ET),e[19].queries.push(new wE(o))}function _u(n,e,t){null===n.queries&&(n.queries=new Fi),n.queries.track(new yr(e,t))}function Vl(n,e){return n.queries.getByIndex(e)}function DE(n,e){return $h(n,e)}const rp=new je("Application Initializer");let Ga=(()=>{class n{constructor(t){this.appInits=t,this.resolve=m_,this.reject=m_,this.initialized=!1,this.done=!1,this.donePromise=new Promise((o,c)=>{this.resolve=o,this.reject=c})}runInitializers(){if(this.initialized)return;const t=[],o=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let c=0;c<this.appInits.length;c++){const u=this.appInits[c]();if(n_(u))t.push(u);else if(zd(u)){const p=new Promise((_,v)=>{u.subscribe({complete:_,error:v})});t.push(p)}}Promise.all(t).then(()=>{o()}).catch(c=>{this.reject(c)}),0===t.length&&o(),this.initialized=!0}}return n.\u0275fac=function(t){return new(t||n)(ie(rp,8))},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})();const Fc=new je("AppId"),UE={provide:Fc,useFactory:function(){return`${xT()}${xT()}${xT()}`},deps:[]};function xT(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const FT=new je("Platform Initializer"),Zo=new je("Platform ID"),op=new je("appBootstrapListener");let jl=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})();const fa=new je("LocaleId"),D_=new je("DefaultCurrencyCode");class N_{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}const BE=function(n){return new pT(n)},_O=BE,mO=function(n){return Promise.resolve(BE(n))},UT=function(n){const e=BE(n),o=Ma(_s(n).declarations).reduce((c,u)=>{const p=Lr(u);return p&&c.push(new uT(p)),c},[]);return new N_(e,o)},VT=UT,EO=function(n){return Promise.resolve(UT(n))};let Hl=(()=>{class n{constructor(){this.compileModuleSync=_O,this.compileModuleAsync=mO,this.compileModuleAndAllComponentsSync=VT,this.compileModuleAndAllComponentsAsync=EO}clearCache(){}clearCacheFor(t){}getModuleId(t){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})();const Rx=(()=>Promise.resolve(0))();function BT(n){"undefined"==typeof Zone?Rx.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class nt{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:o=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new ft(!1),this.onMicrotaskEmpty=new ft(!1),this.onStable=new ft(!1),this.onError=new ft(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const c=this;c._nesting=0,c._outer=c._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(c._inner=c._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(c._inner=c._inner.fork(Zone.longStackTraceZoneSpec)),c.shouldCoalesceEventChangeDetection=!o&&t,c.shouldCoalesceRunChangeDetection=o,c.lastRequestAnimationFrameId=-1,c.nativeRequestAnimationFrame=function(){let n=Nn.requestAnimationFrame,e=Nn.cancelAnimationFrame;if("undefined"!=typeof Zone&&n&&e){const t=n[Zone.__symbol__("OriginalDelegate")];t&&(n=t);const o=e[Zone.__symbol__("OriginalDelegate")];o&&(e=o)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function(n){const e=()=>{!function(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(Nn,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,M_(n),n.isCheckStableRunning=!0,Vc(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),M_(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,o,c,u,p,_)=>{try{return yO(n),t.invokeTask(c,u,p,_)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===u.type||n.shouldCoalesceRunChangeDetection)&&e(),Bc(n)}},onInvoke:(t,o,c,u,p,_,v)=>{try{return yO(n),t.invoke(c,u,p,_,v)}finally{n.shouldCoalesceRunChangeDetection&&e(),Bc(n)}},onHasTask:(t,o,c,u)=>{t.hasTask(c,u),o===c&&("microTask"==u.change?(n._hasPendingMicrotasks=u.microTask,M_(n),Vc(n)):"macroTask"==u.change&&(n.hasPendingMacrotasks=u.macroTask))},onHandleError:(t,o,c,u)=>(t.handleError(c,u),n.runOutsideAngular(()=>n.onError.emit(u)),!1)})}(c)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!nt.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(nt.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,t,o){return this._inner.run(e,t,o)}runTask(e,t,o,c){const u=this._inner,p=u.scheduleEventTask("NgZoneEvent: "+c,e,vr,m_,m_);try{return u.runTask(p,t,o)}finally{u.cancelTask(p)}}runGuarded(e,t,o){return this._inner.runGuarded(e,t,o)}runOutsideAngular(e){return this._outer.run(e)}}const vr={};function Vc(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function M_(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function yO(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function Bc(n){n._nesting--,Vc(n)}class wx{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new ft,this.onMicrotaskEmpty=new ft,this.onStable=new ft,this.onError=new ft}run(e,t,o){return e.apply(t,o)}runGuarded(e,t,o){return e.apply(t,o)}runOutsideAngular(e){return e()}runTask(e,t,o,c){return e.apply(t,o)}}let Wa=(()=>{class n{constructor(t){this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{nt.assertNotInAngularZone(),BT(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())BT(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(o=>!o.updateCb||!o.updateCb(t)||(clearTimeout(o.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,o,c){let u=-1;o&&o>0&&(u=setTimeout(()=>{this._callbacks=this._callbacks.filter(p=>p.timeoutId!==u),t(this._didWork,this.getPendingTasks())},o)),this._callbacks.push({doneCb:t,timeoutId:u,updateCb:c})}whenStable(t,o,c){if(c&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,o,c),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(t,o,c){return[]}}return n.\u0275fac=function(t){return new(t||n)(ie(nt))},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})(),vO=(()=>{class n{constructor(){this._applications=new Map,jE.addToWindow(this)}registerApplication(t,o){this._applications.set(t,o)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,o=!0){return jE.findTestabilityInTree(this,t,o)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})();class Ax{addToWindow(e){}findTestabilityInTree(e,t,o){return null}}let jE=new Ax,Cr=!0,jT=!1;function Ms(){return jT=!0,Cr}let ts;const CO=new je("AllowMultipleToken");class WT{constructor(e,t){this.name=e,this.token=t}}function SO(n,e,t=[]){const o=`Platform: ${e}`,c=new je(o);return(u=[])=>{let p=Cu();if(!p||p.injector.get(CO,!1))if(n)n(t.concat(u).concat({provide:c,useValue:!0}));else{const _=t.concat(u).concat({provide:c,useValue:!0},{provide:jf,useValue:"platform"});!function(n){if(ts&&!ts.destroyed&&!ts.injector.get(CO,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");ts=n.get(Gl);const e=n.get(FT,null);e&&e.forEach(t=>t())}(An.create({providers:_,name:o}))}return function(n){const e=Cu();if(!e)throw new Error("No platform exists!");if(!e.injector.get(n,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return e}(c)}}function Cu(){return ts&&!ts.destroyed?ts:null}let Gl=(()=>{class n{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,o){const _=function(n,e){let t;return t="noop"===n?new wx:("zone.js"===n?void 0:n)||new nt({enableLongStackTrace:Ms(),shouldCoalesceEventChangeDetection:!!(null==e?void 0:e.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==e?void 0:e.ngZoneRunCoalescing)}),t}(o?o.ngZone:void 0,{ngZoneEventCoalescing:o&&o.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:o&&o.ngZoneRunCoalescing||!1}),v=[{provide:nt,useValue:_}];return _.run(()=>{const S=An.create({providers:v,parent:this.injector,name:t.moduleType.name}),w=t.create(S),M=w.injector.get(Dd,null);if(!M)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return _.runOutsideAngular(()=>{const F=_.onError.subscribe({next:j=>{M.handleError(j)}});w.onDestroy(()=>{qT(this._modules,w),F.unsubscribe()})}),function(n,e,t){try{const o=t();return n_(o)?o.catch(c=>{throw e.runOutsideAngular(()=>n.handleError(c)),c}):o}catch(o){throw e.runOutsideAngular(()=>n.handleError(o)),o}}(M,_,()=>{const F=w.injector.get(Ga);return F.runInitializers(),F.donePromise.then(()=>(Pn(w.injector.get(fa,Cs)||Cs),this._moduleDoBootstrap(w),w))})})}bootstrapModule(t,o=[]){const c=KT({},o);return function(n,e,t){const o=new pT(t);return Promise.resolve(o)}(0,0,t).then(u=>this.bootstrapModuleFactory(u,c))}_moduleDoBootstrap(t){const o=t.injector.get(zr);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(c=>o.bootstrap(c));else{if(!t.instance.ngDoBootstrap)throw new Error(`The module ${Ft(t.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);t.instance.ngDoBootstrap(o)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(t=>t.destroy()),this._destroyListeners.forEach(t=>t()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(t){return new(t||n)(ie(An))},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})();function KT(n,e){return Array.isArray(e)?e.reduce(KT,n):Object.assign(Object.assign({},n),e)}let zr=(()=>{class n{constructor(t,o,c,u,p){this._zone=t,this._injector=o,this._exceptionHandler=c,this._componentFactoryResolver=u,this._initStatus=p,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const _=new tn(S=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{S.next(this._stable),S.complete()})}),v=new tn(S=>{let w;this._zone.runOutsideAngular(()=>{w=this._zone.onStable.subscribe(()=>{nt.assertNotInAngularZone(),BT(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,S.next(!0))})})});const M=this._zone.onUnstable.subscribe(()=>{nt.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{S.next(!1)}))});return()=>{w.unsubscribe(),M.unsubscribe()}});this.isStable=sv(_,v.pipe(n=>gi()(function(n,e){return function(o){let c;c="function"==typeof n?n:function(){return n};const u=Object.create(o,cv);return u.source=o,u.subjectFactory=c,u}}(nM)(n))))}bootstrap(t,o){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let c;c=t instanceof iD?t:this._componentFactoryResolver.resolveComponentFactory(t),this.componentTypes.push(c.componentType);const u=function(n){return n.isBoundToModule}(c)?void 0:this._injector.get(bs),_=c.create(An.NULL,[],o||c.selector,u),v=_.location.nativeElement,S=_.injector.get(Wa,null),w=S&&_.injector.get(vO);return S&&w&&w.registerApplication(v,S),_.onDestroy(()=>{this.detachView(_.hostView),qT(this.components,_),w&&w.unregisterApplication(v)}),this._loadComponent(_),_}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){const o=t;this._views.push(o),o.attachToAppRef(this)}detachView(t){const o=t;qT(this._views,o),o.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(op,[]).concat(this._bootstrapListeners).forEach(c=>c(t))}ngOnDestroy(){this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return n.\u0275fac=function(t){return new(t||n)(ie(nt),ie(An),ie(Dd),ie(aa),ie(Ga))},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})();function qT(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}class Yr{}class YT{}const ap={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};let Ka=(()=>{class n{constructor(t,o){this._compiler=t,this._config=o||ap}load(t){return this.loadAndCompile(t)}loadAndCompile(t){let[o,c]=t.split("#");return void 0===c&&(c="default"),ic(255)(o).then(u=>u[c]).then(u=>cp(u,o,c)).then(u=>this._compiler.compileModuleAsync(u))}loadFactory(t){let[o,c]=t.split("#"),u="NgFactory";return void 0===c&&(c="default",u=""),ic(255)(this._config.factoryPathPrefix+o+this._config.factoryPathSuffix).then(p=>p[c+u]).then(p=>cp(p,o,c))}}return n.\u0275fac=function(t){return new(t||n)(ie(Hl),ie(YT,8))},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})();function cp(n,e,t){if(!n)throw new Error(`Cannot find '${t}' in '${e}'`);return n}const Ux=SO(null,"core",[{provide:Zo,useValue:"unknown"},{provide:Gl,deps:[An]},{provide:vO,deps:[]},{provide:jl,deps:[]}]),Iu=[{provide:zr,useClass:zr,deps:[nt,An,Dd,aa,Ga]},{provide:T_,deps:[nt],useFactory:function(n){let e=[];return n.onStable.subscribe(()=>{for(;e.length;)e.pop()()}),function(t){e.push(t)}}},{provide:Ga,useClass:Ga,deps:[[new Eo,rp]]},{provide:Hl,useClass:Hl,deps:[]},UE,{provide:nu,useFactory:function(){return KL},deps:[]},{provide:iu,useFactory:function(){return hE},deps:[]},{provide:fa,useFactory:function(n){return Pn(n=n||"undefined"!=typeof $localize&&$localize.locale||Cs),n},deps:[[new ph(fa),new Eo,new Na]]},{provide:D_,useValue:"USD"}];let Hx=(()=>{class n{constructor(t){}}return n.\u0275fac=function(t){return new(t||n)(ie(zr))},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({providers:Iu}),n})(),gp=null;function Ea(){return gp}const Je=new je("DocumentToken");let zc=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Pe({factory:ZO,token:n,providedIn:"platform"}),n})();function ZO(){return ie(eN)}const Tb=new je("Location Initialized");let eN=(()=>{class n extends zc{constructor(t){super(),this._doc=t,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Ea().getBaseHref(this._doc)}onPopState(t){const o=Ea().getGlobalEventTarget(this._doc,"window");return o.addEventListener("popstate",t,!1),()=>o.removeEventListener("popstate",t)}onHashChange(t){const o=Ea().getGlobalEventTarget(this._doc,"window");return o.addEventListener("hashchange",t,!1),()=>o.removeEventListener("hashchange",t)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(t){this.location.pathname=t}pushState(t,o,c){ly()?this._history.pushState(t,o,c):this.location.hash=c}replaceState(t,o,c){ly()?this._history.replaceState(t,o,c):this.location.hash=c}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}}return n.\u0275fac=function(t){return new(t||n)(ie(Je))},n.\u0275prov=Pe({factory:h2,token:n,providedIn:"platform"}),n})();function ly(){return!!window.history.pushState}function h2(){return new eN(ie(Je))}function q_(n,e){if(0==n.length)return e;if(0==e.length)return n;let t=0;return n.endsWith("/")&&t++,e.startsWith("/")&&t++,2==t?n+e.substring(1):1==t?n+e:n+"/"+e}function bb(n){const e=n.match(/#|\?|$/),t=e&&e.index||n.length;return n.slice(0,t-("/"===n[t-1]?1:0))+n.slice(t)}function Ya(n){return n&&"?"!==n[0]?"?"+n:n}let Ep=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Pe({factory:tN,token:n,providedIn:"root"}),n})();function tN(n){const e=ie(Je).location;return new nN(ie(zc),e&&e.origin||"")}const Du=new je("appBaseHref");let nN=(()=>{class n extends Ep{constructor(t,o){if(super(),this._platformLocation=t,this._removeListenerFns=[],null==o&&(o=this._platformLocation.getBaseHrefFromDOM()),null==o)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=o}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return q_(this._baseHref,t)}path(t=!1){const o=this._platformLocation.pathname+Ya(this._platformLocation.search),c=this._platformLocation.hash;return c&&t?`${o}${c}`:o}pushState(t,o,c,u){const p=this.prepareExternalUrl(c+Ya(u));this._platformLocation.pushState(t,o,p)}replaceState(t,o,c,u){const p=this.prepareExternalUrl(c+Ya(u));this._platformLocation.replaceState(t,o,p)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(t=0){var o,c;null===(c=(o=this._platformLocation).historyGo)||void 0===c||c.call(o,t)}}return n.\u0275fac=function(t){return new(t||n)(ie(zc),ie(Du,8))},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})(),iN=(()=>{class n extends Ep{constructor(t,o){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=o&&(this._baseHref=o)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let o=this._platformLocation.hash;return null==o&&(o="#"),o.length>0?o.substring(1):o}prepareExternalUrl(t){const o=q_(this._baseHref,t);return o.length>0?"#"+o:o}pushState(t,o,c,u){let p=this.prepareExternalUrl(c+Ya(u));0==p.length&&(p=this._platformLocation.pathname),this._platformLocation.pushState(t,o,p)}replaceState(t,o,c,u){let p=this.prepareExternalUrl(c+Ya(u));0==p.length&&(p=this._platformLocation.pathname),this._platformLocation.replaceState(t,o,p)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(t=0){var o,c;null===(c=(o=this._platformLocation).historyGo)||void 0===c||c.call(o,t)}}return n.\u0275fac=function(t){return new(t||n)(ie(zc),ie(Du,8))},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})(),Bi=(()=>{class n{constructor(t,o){this._subject=new ft,this._urlChangeListeners=[],this._platformStrategy=t;const c=this._platformStrategy.getBaseHref();this._platformLocation=o,this._baseHref=bb(Rb(c)),this._platformStrategy.onPopState(u=>{this._subject.emit({url:this.path(!0),pop:!0,state:u.state,type:u.type})})}path(t=!1){return this.normalize(this._platformStrategy.path(t))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(t,o=""){return this.path()==this.normalize(t+Ya(o))}normalize(t){return n.stripTrailingSlash(function(n,e){return n&&e.startsWith(n)?e.substring(n.length):e}(this._baseHref,Rb(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._platformStrategy.prepareExternalUrl(t)}go(t,o="",c=null){this._platformStrategy.pushState(c,"",t,o),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Ya(o)),c)}replaceState(t,o="",c=null){this._platformStrategy.replaceState(c,"",t,o),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Ya(o)),c)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(t=0){var o,c;null===(c=(o=this._platformStrategy).historyGo)||void 0===c||c.call(o,t)}onUrlChange(t){this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(o=>{this._notifyUrlChangeListeners(o.url,o.state)}))}_notifyUrlChangeListeners(t="",o){this._urlChangeListeners.forEach(c=>c(t,o))}subscribe(t,o,c){return this._subject.subscribe({next:t,error:o,complete:c})}}return n.\u0275fac=function(t){return new(t||n)(ie(Ep),ie(zc))},n.normalizeQueryParams=Ya,n.joinWithSlash=q_,n.stripTrailingSlash=bb,n.\u0275prov=Pe({factory:p2,token:n,providedIn:"root"}),n})();function p2(){return new Bi(ie(Ep),ie(zc))}function Rb(n){return n.replace(/\/index.html$/,"")}var Wt=(()=>((Wt=Wt||{})[Wt.Zero=0]="Zero",Wt[Wt.One=1]="One",Wt[Wt.Two=2]="Two",Wt[Wt.Few=3]="Few",Wt[Wt.Many=4]="Many",Wt[Wt.Other=5]="Other",Wt))();const os=function(n){return function(n){const e=function(n){return n.toLowerCase().replace(/_/g,"-")}(n);let t=Qd(e);if(t)return t;const o=e.split("-")[0];if(t=Qd(o),t)return t;if("en"===o)return $e;throw new Error(`Missing locale data for the locale "${n}".`)}(n)[ke.PluralCase]};class tm{}let mi=(()=>{class n extends tm{constructor(t){super(),this.locale=t}getPluralCategory(t,o){switch(os(o||this.locale)(t)){case Wt.Zero:return"zero";case Wt.One:return"one";case Wt.Two:return"two";case Wt.Few:return"few";case Wt.Many:return"many";default:return"other"}}}return n.\u0275fac=function(t){return new(t||n)(ie(fa))},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})(),yy=(()=>{class n{constructor(t,o,c,u){this._iterableDiffers=t,this._keyValueDiffers=o,this._ngEl=c,this._renderer=u,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(t){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof t?t.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(t){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof t?t.split(/\s+/):t,this._rawClass&&(Ud(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const t=this._iterableDiffer.diff(this._rawClass);t&&this._applyIterableChanges(t)}else if(this._keyValueDiffer){const t=this._keyValueDiffer.diff(this._rawClass);t&&this._applyKeyValueChanges(t)}}_applyKeyValueChanges(t){t.forEachAddedItem(o=>this._toggleClass(o.key,o.currentValue)),t.forEachChangedItem(o=>this._toggleClass(o.key,o.currentValue)),t.forEachRemovedItem(o=>{o.previousValue&&this._toggleClass(o.key,!1)})}_applyIterableChanges(t){t.forEachAddedItem(o=>{if("string"!=typeof o.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${Ft(o.item)}`);this._toggleClass(o.item,!0)}),t.forEachRemovedItem(o=>this._toggleClass(o.item,!1))}_applyClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(o=>this._toggleClass(o,!0)):Object.keys(t).forEach(o=>this._toggleClass(o,!!t[o])))}_removeClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(o=>this._toggleClass(o,!1)):Object.keys(t).forEach(o=>this._toggleClass(o,!1)))}_toggleClass(t,o){(t=t.trim())&&t.split(/\s+/g).forEach(c=>{o?this._renderer.addClass(this._ngEl.nativeElement,c):this._renderer.removeClass(this._ngEl.nativeElement,c)})}}return n.\u0275fac=function(t){return new(t||n)(Y(nu),Y(iu),Y(Ot),Y(Ts))},n.\u0275dir=Ae({type:n,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),n})();class CN{constructor(e,t,o,c){this.$implicit=e,this.ngForOf=t,this.index=o,this.count=c}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Jc=(()=>{class n{constructor(t,o,c){this._viewContainer=t,this._template=o,this._differs=c,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;if(!this._differ&&t)try{this._differ=this._differs.find(t).create(this.ngForTrackBy)}catch(o){throw new Error(`Cannot find a differ supporting object '${t}' of type '${function(n){return n.name||typeof n}(t)}'. NgFor only supports binding to Iterables such as Arrays.`)}}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const o=[];t.forEachOperation((c,u,p)=>{if(null==c.previousIndex){const _=this._viewContainer.createEmbeddedView(this._template,new CN(null,this._ngForOf,-1,-1),null===p?void 0:p),v=new Bb(c,_);o.push(v)}else if(null==p)this._viewContainer.remove(null===u?void 0:u);else if(null!==u){const _=this._viewContainer.get(u);this._viewContainer.move(_,p);const v=new Bb(c,_);o.push(v)}});for(let c=0;c<o.length;c++)this._perViewChange(o[c].view,o[c].record);for(let c=0,u=this._viewContainer.length;c<u;c++){const p=this._viewContainer.get(c);p.context.index=c,p.context.count=u,p.context.ngForOf=this._ngForOf}t.forEachIdentityChange(c=>{this._viewContainer.get(c.currentIndex).context.$implicit=c.item})}_perViewChange(t,o){t.context.$implicit=o.item}static ngTemplateContextGuard(t,o){return!0}}return n.\u0275fac=function(t){return new(t||n)(Y(_r),Y($o),Y(nu))},n.\u0275dir=Ae({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),n})();class Bb{constructor(e,t){this.record=e,this.view=t}}let qn=(()=>{class n{constructor(t,o){this._viewContainer=t,this._context=new ar,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=o}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){SN("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){SN("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,o){return!0}}return n.\u0275fac=function(t){return new(t||n)(Y(_r),Y($o))},n.\u0275dir=Ae({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),n})();class ar{constructor(){this.$implicit=null,this.ngIf=null}}function SN(n,e){if(e&&!e.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${Ft(e)}'.`)}class jb{constructor(e,t){this._viewContainerRef=e,this._templateRef=t,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(e){e&&!this._created?this.create():!e&&this._created&&this.destroy()}}let Cy=(()=>{class n{constructor(){this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(t){this._ngSwitch=t,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(t){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(t)}_matchCase(t){const o=t==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||o,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),o}_updateDefaultCases(t){if(this._defaultViews&&t!==this._defaultUsed){this._defaultUsed=t;for(let o=0;o<this._defaultViews.length;o++)this._defaultViews[o].enforceState(t)}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=Ae({type:n,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"}}),n})(),TN=(()=>{class n{constructor(t,o,c){this.ngSwitch=c,c._addCase(),this._view=new jb(t,o)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return n.\u0275fac=function(t){return new(t||n)(Y(_r),Y($o),Y(Cy,9))},n.\u0275dir=Ae({type:n,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"}}),n})();class C2{createSubscription(e,t){return e.subscribe({next:t,error:o=>{throw o}})}dispose(e){e.unsubscribe()}onDestroy(e){e.unsubscribe()}}class Gb{createSubscription(e,t){return e.then(t,o=>{throw o})}dispose(e){}onDestroy(e){}}const RN=new Gb,Tp=new C2;let bp=(()=>{class n{constructor(t){this._ref=t,this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null}ngOnDestroy(){this._subscription&&this._dispose()}transform(t){return this._obj?t!==this._obj?(this._dispose(),this.transform(t)):this._latestValue:(t&&this._subscribe(t),this._latestValue)}_subscribe(t){this._obj=t,this._strategy=this._selectStrategy(t),this._subscription=this._strategy.createSubscription(t,o=>this._updateLatestValue(t,o))}_selectStrategy(t){if(n_(t))return RN;if(aA(t))return Tp;throw function(n,e){return Error(`InvalidPipeArgument: '${e}' for pipe '${Ft(n)}'`)}(n,t)}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(t,o){t===this._obj&&(this._latestValue=o,this._ref.markForCheck())}}return n.\u0275fac=function(t){return new(t||n)(Y(zo,16))},n.\u0275pipe=Zi({name:"async",type:n,pure:!1}),n})(),im=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({providers:[{provide:tm,useClass:mi}]}),n})();const rm="browser";let LN=(()=>{class n{}return n.\u0275prov=Pe({token:n,providedIn:"root",factory:()=>new Xl(ie(Je),window)}),n})();class Xl{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function(n,e){const t=n.getElementById(e)||n.getElementsByName(e)[0];if(t)return t;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const o=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let c=o.currentNode;for(;c;){const u=c.shadowRoot;if(u){const p=u.getElementById(e)||u.querySelector(`[name="${e}"]`);if(p)return p}c=o.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),this.attemptFocus(t))}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),o=t.left+this.window.pageXOffset,c=t.top+this.window.pageYOffset,u=this.offset();this.window.scrollTo(o-u[0],c-u[1])}attemptFocus(e){return e.focus(),this.document.activeElement===e}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=zb(this.window.history)||zb(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch(e){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(e){return!1}}}function zb(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class om extends class extends class{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function(n){gp||(gp=n)}(new om)}onAndCancel(e,t,o){return e.addEventListener(t,o,!1),()=>{e.removeEventListener(t,o,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=(Rp=Rp||document.querySelector("base"),Rp?Rp.getAttribute("href"):null);return null==t?null:function(n){by=by||document.createElement("a"),by.setAttribute("href",n);const e=by.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){Rp=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return function(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const o=t.indexOf("="),[c,u]=-1==o?[t,""]:[t.slice(0,o),t.slice(o+1)];if(c.trim()===e)return decodeURIComponent(u)}return null}(document.cookie,e)}}let by,Rp=null;const $b=new je("TRANSITION_ID"),D2=[{provide:rp,useFactory:function(n,e,t){return()=>{t.get(Ga).donePromise.then(()=>{const o=Ea(),c=e.querySelectorAll(`style[ng-transition="${n}"]`);for(let u=0;u<c.length;u++)o.remove(c[u])})}},deps:[$b,Je,An],multi:!0}];class Ry{static init(){!function(n){jE=n}(new Ry)}addToWindow(e){Nn.getAngularTestability=(o,c=!0)=>{const u=e.findTestabilityInTree(o,c);if(null==u)throw new Error("Could not find testability for element.");return u},Nn.getAllAngularTestabilities=()=>e.getAllTestabilities(),Nn.getAllAngularRootElements=()=>e.getAllRootElements(),Nn.frameworkStabilizers||(Nn.frameworkStabilizers=[]),Nn.frameworkStabilizers.push(o=>{const c=Nn.getAllAngularTestabilities();let u=c.length,p=!1;const _=function(v){p=p||v,u--,0==u&&o(p)};c.forEach(function(v){v.whenStable(_)})})}findTestabilityInTree(e,t,o){if(null==t)return null;const c=e.getTestability(t);return null!=c?c:o?Ea().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null}}let Jb=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})();const wp=new je("EventManagerPlugins");let Ap=(()=>{class n{constructor(t,o){this._zone=o,this._eventNameToPlugin=new Map,t.forEach(c=>c.manager=this),this._plugins=t.slice().reverse()}addEventListener(t,o,c){return this._findPluginFor(o).addEventListener(t,o,c)}addGlobalEventListener(t,o,c){return this._findPluginFor(o).addGlobalEventListener(t,o,c)}getZone(){return this._zone}_findPluginFor(t){const o=this._eventNameToPlugin.get(t);if(o)return o;const c=this._plugins;for(let u=0;u<c.length;u++){const p=c[u];if(p.supports(t))return this._eventNameToPlugin.set(t,p),p}throw new Error(`No event manager plugin found for event ${t}`)}}return n.\u0275fac=function(t){return new(t||n)(ie(wp),ie(nt))},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})();class Ay{constructor(e){this._doc=e}addGlobalEventListener(e,t,o){const c=Ea().getGlobalEventTarget(this._doc,e);if(!c)throw new Error(`Unsupported event target ${c} for event ${t}`);return this.addEventListener(c,t,o)}}let HN=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(t){const o=new Set;t.forEach(c=>{this._stylesSet.has(c)||(this._stylesSet.add(c),o.add(c))}),this.onStylesAdded(o)}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})(),Dp=(()=>{class n extends HN{constructor(t){super(),this._doc=t,this._hostNodes=new Map,this._hostNodes.set(t.head,[])}_addStylesToHost(t,o,c){t.forEach(u=>{const p=this._doc.createElement("style");p.textContent=u,c.push(o.appendChild(p))})}addHost(t){const o=[];this._addStylesToHost(this._stylesSet,t,o),this._hostNodes.set(t,o)}removeHost(t){const o=this._hostNodes.get(t);o&&o.forEach(Op),this._hostNodes.delete(t)}onStylesAdded(t){this._hostNodes.forEach((o,c)=>{this._addStylesToHost(t,c,o)})}ngOnDestroy(){this._hostNodes.forEach(t=>t.forEach(Op))}}return n.\u0275fac=function(t){return new(t||n)(ie(Je))},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})();function Op(n){Ea().remove(n)}const kt={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Qb=/%COMP%/g;function Pp(n,e,t){for(let o=0;o<e.length;o++){let c=e[o];Array.isArray(c)?Pp(n,c,t):(c=c.replace(Qb,n),t.push(c))}return t}function Zb(n){return e=>{if("__ngUnwrap__"===e)return n;!1===n(e)&&(e.preventDefault(),e.returnValue=!1)}}let s=(()=>{class n{constructor(t,o,c){this.eventManager=t,this.sharedStylesHost=o,this.appId=c,this.rendererByCompId=new Map,this.defaultRenderer=new i(t)}createRenderer(t,o){if(!t||!o)return this.defaultRenderer;switch(o.encapsulation){case ui.Emulated:{let c=this.rendererByCompId.get(o.id);return c||(c=new d(this.eventManager,this.sharedStylesHost,o,this.appId),this.rendererByCompId.set(o.id,c)),c.applyToHost(t),c}case 1:case ui.ShadowDom:return new h(this.eventManager,this.sharedStylesHost,t,o);default:if(!this.rendererByCompId.has(o.id)){const c=Pp(o.id,o.styles,[]);this.sharedStylesHost.addStyles(c),this.rendererByCompId.set(o.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(t){return new(t||n)(ie(Ap),ie(Dp),ie(Fc))},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})();class i{constructor(e){this.eventManager=e,this.data=Object.create(null)}destroy(){}createElement(e,t){return t?document.createElementNS(kt[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){e.appendChild(t)}insertBefore(e,t,o){e&&e.insertBefore(t,o)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let o="string"==typeof e?document.querySelector(e):e;if(!o)throw new Error(`The selector "${e}" did not match any elements`);return t||(o.textContent=""),o}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,o,c){if(c){t=c+":"+t;const u=kt[c];u?e.setAttributeNS(u,t,o):e.setAttribute(t,o)}else e.setAttribute(t,o)}removeAttribute(e,t,o){if(o){const c=kt[o];c?e.removeAttributeNS(c,t):e.removeAttribute(`${o}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,o,c){c&(Vo.DashCase|Vo.Important)?e.style.setProperty(t,o,c&Vo.Important?"important":""):e.style[t]=o}removeStyle(e,t,o){o&Vo.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,o){e[t]=o}setValue(e,t){e.nodeValue=t}listen(e,t,o){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,Zb(o)):this.eventManager.addEventListener(e,t,Zb(o))}}class d extends i{constructor(e,t,o,c){super(e),this.component=o;const u=Pp(c+"-"+o.id,o.styles,[]);t.addStyles(u),this.contentAttr=function(n){return"_ngcontent-%COMP%".replace(Qb,n)}(c+"-"+o.id),this.hostAttr=function(n){return"_nghost-%COMP%".replace(Qb,n)}(c+"-"+o.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const o=super.createElement(e,t);return super.setAttribute(o,this.contentAttr,""),o}}class h extends i{constructor(e,t,o,c){super(e),this.sharedStylesHost=t,this.hostEl=o,this.shadowRoot=o.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const u=Pp(c.id,c.styles,[]);for(let p=0;p<u.length;p++){const _=document.createElement("style");_.textContent=u[p],this.shadowRoot.appendChild(_)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,o){return super.insertBefore(this.nodeOrShadowRoot(e),t,o)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let f=(()=>{class n extends Ay{constructor(t){super(t)}supports(t){return!0}addEventListener(t,o,c){return t.addEventListener(o,c,!1),()=>this.removeEventListener(t,o,c)}removeEventListener(t,o,c){return t.removeEventListener(o,c)}}return n.\u0275fac=function(t){return new(t||n)(ie(Je))},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})();const L=["alt","control","meta","shift"],V={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},J={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},te={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let Ce=(()=>{class n extends Ay{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,o,c){const u=n.parseEventName(o),p=n.eventCallback(u.fullKey,c,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Ea().onAndCancel(t,u.domEventName,p))}static parseEventName(t){const o=t.toLowerCase().split("."),c=o.shift();if(0===o.length||"keydown"!==c&&"keyup"!==c)return null;const u=n._normalizeKey(o.pop());let p="";if(L.forEach(v=>{const S=o.indexOf(v);S>-1&&(o.splice(S,1),p+=v+".")}),p+=u,0!=o.length||0===u.length)return null;const _={};return _.domEventName=c,_.fullKey=p,_}static getEventFullKey(t){let o="",c=function(n){let e=n.key;if(null==e){if(e=n.keyIdentifier,null==e)return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===n.location&&J.hasOwnProperty(e)&&(e=J[e]))}return V[e]||e}(t);return c=c.toLowerCase()," "===c?c="space":"."===c&&(c="dot"),L.forEach(u=>{u!=c&&te[u](t)&&(o+=u+".")}),o+=c,o}static eventCallback(t,o,c){return u=>{n.getEventFullKey(u)===t&&c.runGuarded(()=>o(u))}}static _normalizeKey(t){return"esc"===t?"escape":t}}return n.\u0275fac=function(t){return new(t||n)(ie(Je))},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})();const ge=[{provide:Zo,useValue:rm},{provide:FT,useValue:function(){om.makeCurrent(),Ry.init()},multi:!0},{provide:Je,useFactory:function(){return function(n){th=n}(document),document},deps:[]}],I=SO(Ux,"browser",ge),U=[[],{provide:jf,useValue:"root"},{provide:Dd,useFactory:function(){return new Dd},deps:[]},{provide:wp,useClass:f,multi:!0,deps:[Je,nt,Zo]},{provide:wp,useClass:Ce,multi:!0,deps:[Je]},[],{provide:s,useClass:s,deps:[Ap,Dp,Fc]},{provide:Dl,useExisting:s},{provide:HN,useExisting:Dp},{provide:Dp,useClass:Dp,deps:[Je]},{provide:Wa,useClass:Wa,deps:[nt]},{provide:Ap,useClass:Ap,deps:[wp,nt]},{provide:class{},useClass:Jb,deps:[]},[]];let G=(()=>{class n{constructor(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:n,providers:[{provide:Fc,useValue:t.appId},{provide:$b,useExisting:Fc},D2]}}}return n.\u0275fac=function(t){return new(t||n)(ie(n,12))},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({providers:U,imports:[im,Hx]}),n})();"undefined"!=typeof window&&window;class eR{}const Nu="*";function k2(n,e){return{type:7,name:n,definitions:e,options:{}}}function tR(n,e=null){return{type:4,styles:e,timings:n}}function b3(n,e=null){return{type:2,steps:n,options:e}}function Us(n){return{type:6,styles:n,offset:null}}function L2(n,e,t){return{type:0,name:n,styles:e,options:t}}function y6(n){return{type:5,steps:n}}function nR(n,e,t=null){return{type:1,expr:n,animation:e,options:t}}function R3(n){Promise.resolve(null).then(n)}class Ny{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){R3(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(o=>o()),t.length=0}}class I3{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,o=0,c=0;const u=this.players.length;0==u?R3(()=>this._onFinish()):this.players.forEach(p=>{p.onDone(()=>{++t==u&&this._onFinish()}),p.onDestroy(()=>{++o==u&&this._onDestroy()}),p.onStart(()=>{++c==u&&this._onStart()})}),this.totalTime=this.players.reduce((p,_)=>Math.max(p,_.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){const t=e*this.totalTime;this.players.forEach(o=>{const c=o.totalTime?Math.min(1,t/o.totalTime):1;o.setPosition(c)})}getPosition(){const e=this.players.reduce((t,o)=>null===t||o.totalTime>t.totalTime?o:t,null);return null!=e?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(o=>o()),t.length=0}}function w3(){return"undefined"!=typeof window&&void 0!==window.document}function F2(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function Mp(n){switch(n.length){case 0:return new Ny;case 1:return n[0];default:return new I3(n)}}function A3(n,e,t,o,c={},u={}){const p=[],_=[];let v=-1,S=null;if(o.forEach(w=>{const M=w.offset,F=M==v,j=F&&S||{};Object.keys(w).forEach(W=>{let ee=W,$=w[W];if("offset"!==W)switch(ee=e.normalizePropertyName(ee,p),$){case"!":$=c[W];break;case Nu:$=u[W];break;default:$=e.normalizeStyleValue(W,ee,$,p)}j[ee]=$}),F||_.push(j),S=j,v=M}),p.length){const w="\n - ";throw new Error(`Unable to animate due to the following errors:${w}${p.join(w)}`)}return _}function U2(n,e,t,o){switch(e){case"start":n.onStart(()=>o(t&&V2(t,"start",n)));break;case"done":n.onDone(()=>o(t&&V2(t,"done",n)));break;case"destroy":n.onDestroy(()=>o(t&&V2(t,"destroy",n)))}}function V2(n,e,t){const o=t.totalTime,u=B2(n.element,n.triggerName,n.fromState,n.toState,e||n.phaseName,null==o?n.totalTime:o,!!t.disabled),p=n._data;return null!=p&&(u._data=p),u}function B2(n,e,t,o,c="",u=0,p){return{element:n,triggerName:e,fromState:t,toState:o,phaseName:c,totalTime:u,disabled:!!p}}function Ca(n,e,t){let o;return n instanceof Map?(o=n.get(e),o||n.set(e,o=t)):(o=n[e],o||(o=n[e]=t)),o}function D3(n){const e=n.indexOf(":");return[n.substring(1,e),n.substr(e+1)]}let j2=(n,e)=>!1,H2=(n,e)=>!1,O3=(n,e,t)=>[];const N3=F2();(N3||"undefined"!=typeof Element)&&(j2=w3()?(n,e)=>{for(;e&&e!==document.documentElement;){if(e===n)return!0;e=e.parentNode||e.host}return!1}:(n,e)=>n.contains(e),H2=(()=>{if(N3||Element.prototype.matches)return(n,e)=>n.matches(e);{const n=Element.prototype,e=n.matchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector||n.webkitMatchesSelector;return e?(t,o)=>e.apply(t,[o]):H2}})(),O3=(n,e,t)=>{let o=[];if(t){const c=n.querySelectorAll(e);for(let u=0;u<c.length;u++)o.push(c[u])}else{const c=n.querySelector(e);c&&o.push(c)}return o});let am=null,P3=!1;function G2(n){am||(am=("undefined"!=typeof document?document.body:null)||{},P3=!!am.style&&"WebkitAppearance"in am.style);let e=!0;return am.style&&!function(n){return"ebkit"==n.substring(1,6)}(n)&&(e=n in am.style,!e&&P3&&(e="Webkit"+n.charAt(0).toUpperCase()+n.substr(1)in am.style)),e}const W2=H2,K2=j2,q2=O3;function M3(n){const e={};return Object.keys(n).forEach(t=>{const o=t.replace(/([a-z])([A-Z])/g,"$1-$2");e[o]=n[t]}),e}let k3=(()=>{class n{validateStyleProperty(t){return G2(t)}matchesElement(t,o){return W2(t,o)}containsElement(t,o){return K2(t,o)}query(t,o,c){return q2(t,o,c)}computeStyle(t,o,c){return c||""}animate(t,o,c,u,p,_=[],v){return new Ny(c,u)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})(),z2=(()=>{class n{}return n.NOOP=new k3,n})();const Y2="ng-enter",zN="ng-leave",YN="ng-trigger",$N=".ng-trigger",x3="ng-animating",$2=".ng-animating";function cm(n){if("number"==typeof n)return n;const e=n.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:J2(parseFloat(e[1]),e[2])}function J2(n,e){return"s"===e?1e3*n:n}function JN(n,e,t){return n.hasOwnProperty("duration")?n:function(n,e,t){let c,u=0,p="";if("string"==typeof n){const _=n.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===_)return e.push(`The provided timing value "${n}" is invalid.`),{duration:0,delay:0,easing:""};c=J2(parseFloat(_[1]),_[2]);const v=_[3];null!=v&&(u=J2(parseFloat(v),_[4]));const S=_[5];S&&(p=S)}else c=n;if(!t){let _=!1,v=e.length;c<0&&(e.push("Duration values below 0 are not allowed for this animation step."),_=!0),u<0&&(e.push("Delay values below 0 are not allowed for this animation step."),_=!0),_&&e.splice(v,0,`The provided timing value "${n}" is invalid.`)}return{duration:c,delay:u,easing:p}}(n,e,t)}function Py(n,e={}){return Object.keys(n).forEach(t=>{e[t]=n[t]}),e}function kp(n,e,t={}){if(e)for(let o in n)t[o]=n[o];else Py(n,t);return t}function U3(n,e,t){return t?e+":"+t+";":""}function V3(n){let e="";for(let t=0;t<n.style.length;t++){const o=n.style.item(t);e+=U3(0,o,n.style.getPropertyValue(o))}for(const t in n.style)n.style.hasOwnProperty(t)&&!t.startsWith("_")&&(e+=U3(0,w6(t),n.style[t]));n.setAttribute("style",e)}function ed(n,e,t){n.style&&(Object.keys(e).forEach(o=>{const c=Q2(o);t&&!t.hasOwnProperty(o)&&(t[o]=n.style[c]),n.style[c]=e[o]}),F2()&&V3(n))}function lm(n,e){n.style&&(Object.keys(e).forEach(t=>{const o=Q2(t);n.style[o]=""}),F2()&&V3(n))}function iR(n){return Array.isArray(n)?1==n.length?n[0]:b3(n):n}const X2=new RegExp("{{\\s*(.+?)\\s*}}","g");function B3(n){let e=[];if("string"==typeof n){let t;for(;t=X2.exec(n);)e.push(t[1]);X2.lastIndex=0}return e}function XN(n,e,t){const o=n.toString(),c=o.replace(X2,(u,p)=>{let _=e[p];return e.hasOwnProperty(p)||(t.push(`Please provide a value for the animation param ${p}`),_=""),_.toString()});return c==o?n:c}function QN(n){const e=[];let t=n.next();for(;!t.done;)e.push(t.value),t=n.next();return e}const I6=/-+([a-z0-9])/g;function Q2(n){return n.replace(I6,(...e)=>e[1].toUpperCase())}function w6(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function j3(n,e){return 0===n||0===e}function H3(n,e,t){const o=Object.keys(t);if(o.length&&e.length){let u=e[0],p=[];if(o.forEach(_=>{u.hasOwnProperty(_)||p.push(_),u[_]=t[_]}),p.length)for(var c=1;c<e.length;c++){let _=e[c];p.forEach(function(v){_[v]=Z2(n,v)})}}return e}function Sa(n,e,t){switch(e.type){case 7:return n.visitTrigger(e,t);case 0:return n.visitState(e,t);case 1:return n.visitTransition(e,t);case 2:return n.visitSequence(e,t);case 3:return n.visitGroup(e,t);case 4:return n.visitAnimate(e,t);case 5:return n.visitKeyframes(e,t);case 6:return n.visitStyle(e,t);case 8:return n.visitReference(e,t);case 9:return n.visitAnimateChild(e,t);case 10:return n.visitAnimateRef(e,t);case 11:return n.visitQuery(e,t);case 12:return n.visitStagger(e,t);default:throw new Error(`Unable to resolve animation metadata node #${e.type}`)}}function Z2(n,e){return window.getComputedStyle(n)[e]}function A6(n,e){const t=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(o=>function(n,e,t){if(":"==n[0]){const v=function(n,e){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,o)=>parseFloat(o)>parseFloat(t);case":decrement":return(t,o)=>parseFloat(o)<parseFloat(t);default:return e.push(`The transition alias value "${n}" is not supported`),"* => *"}}(n,t);if("function"==typeof v)return void e.push(v);n=v}const o=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==o||o.length<4)return t.push(`The provided transition expression "${n}" is not supported`),e;const c=o[1],u=o[2],p=o[3];e.push(G3(c,p));"<"==u[0]&&!("*"==c&&"*"==p)&&e.push(G3(p,c))}(o,t,e)):t.push(n),t}const eP=new Set(["true","1"]),tP=new Set(["false","0"]);function G3(n,e){const t=eP.has(n)||tP.has(n),o=eP.has(e)||tP.has(e);return(c,u)=>{let p="*"==n||n==c,_="*"==e||e==u;return!p&&t&&"boolean"==typeof c&&(p=c?eP.has(n):tP.has(n)),!_&&o&&"boolean"==typeof u&&(_=u?eP.has(e):tP.has(e)),p&&_}}const N6=new RegExp("s*:selfs*,?","g");function eF(n,e,t){return new P6(n).build(e,t)}class P6{constructor(e){this._driver=e}build(e,t){const o=new L6(t);return this._resetContextStyleTimingState(o),Sa(this,iR(e),o)}_resetContextStyleTimingState(e){e.currentQuerySelector="",e.collectedStyles={},e.collectedStyles[""]={},e.currentTime=0}visitTrigger(e,t){let o=t.queryCount=0,c=t.depCount=0;const u=[],p=[];return"@"==e.name.charAt(0)&&t.errors.push("animation triggers cannot be prefixed with an `@` sign (e.g. trigger('@foo', [...]))"),e.definitions.forEach(_=>{if(this._resetContextStyleTimingState(t),0==_.type){const v=_,S=v.name;S.toString().split(/\s*,\s*/).forEach(w=>{v.name=w,u.push(this.visitState(v,t))}),v.name=S}else if(1==_.type){const v=this.visitTransition(_,t);o+=v.queryCount,c+=v.depCount,p.push(v)}else t.errors.push("only state() and transition() definitions can sit inside of a trigger()")}),{type:7,name:e.name,states:u,transitions:p,queryCount:o,depCount:c,options:null}}visitState(e,t){const o=this.visitStyle(e.styles,t),c=e.options&&e.options.params||null;if(o.containsDynamicStyles){const u=new Set,p=c||{};if(o.styles.forEach(_=>{if(nP(_)){const v=_;Object.keys(v).forEach(S=>{B3(v[S]).forEach(w=>{p.hasOwnProperty(w)||u.add(w)})})}}),u.size){const _=QN(u.values());t.errors.push(`state("${e.name}", ...) must define default values for all the following style substitutions: ${_.join(", ")}`)}}return{type:0,name:e.name,style:o,options:c?{params:c}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;const o=Sa(this,iR(e.animation),t);return{type:1,matchers:A6(e.expr,t.errors),animation:o,queryCount:t.queryCount,depCount:t.depCount,options:dm(e.options)}}visitSequence(e,t){return{type:2,steps:e.steps.map(o=>Sa(this,o,t)),options:dm(e.options)}}visitGroup(e,t){const o=t.currentTime;let c=0;const u=e.steps.map(p=>{t.currentTime=o;const _=Sa(this,p,t);return c=Math.max(c,t.currentTime),_});return t.currentTime=c,{type:3,steps:u,options:dm(e.options)}}visitAnimate(e,t){const o=function(n,e){let t=null;if(n.hasOwnProperty("duration"))t=n;else if("number"==typeof n)return tF(JN(n,e).duration,0,"");const o=n;if(o.split(/\s+/).some(u=>"{"==u.charAt(0)&&"{"==u.charAt(1))){const u=tF(0,0,"");return u.dynamic=!0,u.strValue=o,u}return t=t||JN(o,e),tF(t.duration,t.delay,t.easing)}(e.timings,t.errors);t.currentAnimateTimings=o;let c,u=e.styles?e.styles:Us({});if(5==u.type)c=this.visitKeyframes(u,t);else{let p=e.styles,_=!1;if(!p){_=!0;const S={};o.easing&&(S.easing=o.easing),p=Us(S)}t.currentTime+=o.duration+o.delay;const v=this.visitStyle(p,t);v.isEmptyStep=_,c=v}return t.currentAnimateTimings=null,{type:4,timings:o,style:c,options:null}}visitStyle(e,t){const o=this._makeStyleAst(e,t);return this._validateStyleAst(o,t),o}_makeStyleAst(e,t){const o=[];Array.isArray(e.styles)?e.styles.forEach(p=>{"string"==typeof p?p==Nu?o.push(p):t.errors.push(`The provided style string value ${p} is not allowed.`):o.push(p)}):o.push(e.styles);let c=!1,u=null;return o.forEach(p=>{if(nP(p)){const _=p,v=_.easing;if(v&&(u=v,delete _.easing),!c)for(let S in _)if(_[S].toString().indexOf("{{")>=0){c=!0;break}}}),{type:6,styles:o,easing:u,offset:e.offset,containsDynamicStyles:c,options:null}}_validateStyleAst(e,t){const o=t.currentAnimateTimings;let c=t.currentTime,u=t.currentTime;o&&u>0&&(u-=o.duration+o.delay),e.styles.forEach(p=>{"string"!=typeof p&&Object.keys(p).forEach(_=>{if(!this._driver.validateStyleProperty(_))return void t.errors.push(`The provided animation property "${_}" is not a supported CSS property for animations`);const v=t.collectedStyles[t.currentQuerySelector],S=v[_];let w=!0;S&&(u!=c&&u>=S.startTime&&c<=S.endTime&&(t.errors.push(`The CSS property "${_}" that exists between the times of "${S.startTime}ms" and "${S.endTime}ms" is also being animated in a parallel animation between the times of "${u}ms" and "${c}ms"`),w=!1),u=S.startTime),w&&(v[_]={startTime:u,endTime:c}),t.options&&function(n,e,t){const o=e.params||{},c=B3(n);c.length&&c.forEach(u=>{o.hasOwnProperty(u)||t.push(`Unable to resolve the local animation param ${u} in the given list of values`)})}(p[_],t.options,t.errors)})})}visitKeyframes(e,t){const o={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push("keyframes() must be placed inside of a call to animate()"),o;let u=0;const p=[];let _=!1,v=!1,S=0;const w=e.steps.map(pe=>{const le=this._makeStyleAst(pe,t);let De=null!=le.offset?le.offset:function(n){if("string"==typeof n)return null;let e=null;if(Array.isArray(n))n.forEach(t=>{if(nP(t)&&t.hasOwnProperty("offset")){const o=t;e=parseFloat(o.offset),delete o.offset}});else if(nP(n)&&n.hasOwnProperty("offset")){const t=n;e=parseFloat(t.offset),delete t.offset}return e}(le.styles),Le=0;return null!=De&&(u++,Le=le.offset=De),v=v||Le<0||Le>1,_=_||Le<S,S=Le,p.push(Le),le});v&&t.errors.push("Please ensure that all keyframe offsets are between 0 and 1"),_&&t.errors.push("Please ensure that all keyframe offsets are in order");const M=e.steps.length;let F=0;u>0&&u<M?t.errors.push("Not all style() steps within the declared keyframes() contain offsets"):0==u&&(F=1/(M-1));const j=M-1,W=t.currentTime,ee=t.currentAnimateTimings,$=ee.duration;return w.forEach((pe,le)=>{const De=F>0?le==j?1:F*le:p[le],Le=De*$;t.currentTime=W+ee.delay+Le,ee.duration=Le,this._validateStyleAst(pe,t),pe.offset=De,o.styles.push(pe)}),o}visitReference(e,t){return{type:8,animation:Sa(this,iR(e.animation),t),options:dm(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:9,options:dm(e.options)}}visitAnimateRef(e,t){return{type:10,animation:this.visitReference(e.animation,t),options:dm(e.options)}}visitQuery(e,t){const o=t.currentQuerySelector,c=e.options||{};t.queryCount++,t.currentQuery=e;const[u,p]=function(n){const e=!!n.split(/\s*,\s*/).find(t=>":self"==t);return e&&(n=n.replace(N6,"")),n=n.replace(/@\*/g,$N).replace(/@\w+/g,t=>$N+"-"+t.substr(1)).replace(/:animating/g,$2),[n,e]}(e.selector);t.currentQuerySelector=o.length?o+" "+u:u,Ca(t.collectedStyles,t.currentQuerySelector,{});const _=Sa(this,iR(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=o,{type:11,selector:u,limit:c.limit||0,optional:!!c.optional,includeSelf:p,animation:_,originalSelector:e.selector,options:dm(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push("stagger() can only be used inside of query()");const o="full"===e.timings?{duration:0,delay:0,easing:"full"}:JN(e.timings,t.errors,!0);return{type:12,animation:Sa(this,iR(e.animation),t),timings:o,options:null}}}class L6{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles={},this.options=null}}function nP(n){return!Array.isArray(n)&&"object"==typeof n}function dm(n){return n?(n=Py(n)).params&&(n.params=function(n){return n?Py(n):null}(n.params)):n={},n}function tF(n,e,t){return{duration:n,delay:e,easing:t}}function nF(n,e,t,o,c,u,p=null,_=!1){return{type:1,element:n,keyframes:e,preStyleProps:t,postStyleProps:o,duration:c,delay:u,totalTime:c+u,easing:p,subTimeline:_}}class iP{constructor(){this._map=new Map}consume(e){let t=this._map.get(e);return t?this._map.delete(e):t=[],t}append(e,t){let o=this._map.get(e);o||this._map.set(e,o=[]),o.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}}const B6=new RegExp(":enter","g"),H6=new RegExp(":leave","g");function iF(n,e,t,o,c,u={},p={},_,v,S=[]){return(new G6).buildKeyframes(n,e,t,o,c,u,p,_,v,S)}class G6{buildKeyframes(e,t,o,c,u,p,_,v,S,w=[]){S=S||new iP;const M=new rF(e,t,S,c,u,w,[]);M.options=v,M.currentTimeline.setStyles([p],null,M.errors,v),Sa(this,o,M);const F=M.timelines.filter(j=>j.containsAnimation());if(F.length&&Object.keys(_).length){const j=F[F.length-1];j.allowOnlyTimelineStyles()||j.setStyles([_],null,M.errors,v)}return F.length?F.map(j=>j.buildKeyframes()):[nF(t,[],[],[],0,0,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){const o=t.subInstructions.consume(t.element);if(o){const c=t.createSubContext(e.options),u=t.currentTimeline.currentTime,p=this._visitSubInstructions(o,c,c.options);u!=p&&t.transformIntoNewTimeline(p)}t.previousNode=e}visitAnimateRef(e,t){const o=t.createSubContext(e.options);o.transformIntoNewTimeline(),this.visitReference(e.animation,o),t.transformIntoNewTimeline(o.currentTimeline.currentTime),t.previousNode=e}_visitSubInstructions(e,t,o){let u=t.currentTimeline.currentTime;const p=null!=o.duration?cm(o.duration):null,_=null!=o.delay?cm(o.delay):null;return 0!==p&&e.forEach(v=>{const S=t.appendInstructionToTimeline(v,p,_);u=Math.max(u,S.duration+S.delay)}),u}visitReference(e,t){t.updateOptions(e.options,!0),Sa(this,e.animation,t),t.previousNode=e}visitSequence(e,t){const o=t.subContextCount;let c=t;const u=e.options;if(u&&(u.params||u.delay)&&(c=t.createSubContext(u),c.transformIntoNewTimeline(),null!=u.delay)){6==c.previousNode.type&&(c.currentTimeline.snapshotCurrentStyles(),c.previousNode=rP);const p=cm(u.delay);c.delayNextStep(p)}e.steps.length&&(e.steps.forEach(p=>Sa(this,p,c)),c.currentTimeline.applyStylesToKeyframe(),c.subContextCount>o&&c.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){const o=[];let c=t.currentTimeline.currentTime;const u=e.options&&e.options.delay?cm(e.options.delay):0;e.steps.forEach(p=>{const _=t.createSubContext(e.options);u&&_.delayNextStep(u),Sa(this,p,_),c=Math.max(c,_.currentTimeline.currentTime),o.push(_.currentTimeline)}),o.forEach(p=>t.currentTimeline.mergeTimelineCollectedStyles(p)),t.transformIntoNewTimeline(c),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){const o=e.strValue;return JN(t.params?XN(o,t.params,t.errors):o,t.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){const o=t.currentAnimateTimings=this._visitTiming(e.timings,t),c=t.currentTimeline;o.delay&&(t.incrementTime(o.delay),c.snapshotCurrentStyles());const u=e.style;5==u.type?this.visitKeyframes(u,t):(t.incrementTime(o.duration),this.visitStyle(u,t),c.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){const o=t.currentTimeline,c=t.currentAnimateTimings;!c&&o.getCurrentStyleProperties().length&&o.forwardFrame();const u=c&&c.easing||e.easing;e.isEmptyStep?o.applyEmptyStep(u):o.setStyles(e.styles,u,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){const o=t.currentAnimateTimings,c=t.currentTimeline.duration,u=o.duration,_=t.createSubContext().currentTimeline;_.easing=o.easing,e.styles.forEach(v=>{_.forwardTime((v.offset||0)*u),_.setStyles(v.styles,v.easing,t.errors,t.options),_.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(_),t.transformIntoNewTimeline(c+u),t.previousNode=e}visitQuery(e,t){const o=t.currentTimeline.currentTime,c=e.options||{},u=c.delay?cm(c.delay):0;u&&(6===t.previousNode.type||0==o&&t.currentTimeline.getCurrentStyleProperties().length)&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=rP);let p=o;const _=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!c.optional,t.errors);t.currentQueryTotal=_.length;let v=null;_.forEach((S,w)=>{t.currentQueryIndex=w;const M=t.createSubContext(e.options,S);u&&M.delayNextStep(u),S===t.element&&(v=M.currentTimeline),Sa(this,e.animation,M),M.currentTimeline.applyStylesToKeyframe(),p=Math.max(p,M.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(p),v&&(t.currentTimeline.mergeTimelineCollectedStyles(v),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){const o=t.parentContext,c=t.currentTimeline,u=e.timings,p=Math.abs(u.duration),_=p*(t.currentQueryTotal-1);let v=p*t.currentQueryIndex;switch(u.duration<0?"reverse":u.easing){case"reverse":v=_-v;break;case"full":v=o.currentStaggerTime}const w=t.currentTimeline;v&&w.delayNextStep(v);const M=w.currentTime;Sa(this,e.animation,t),t.previousNode=e,o.currentStaggerTime=c.currentTime-M+(c.startTime-o.currentTimeline.startTime)}}const rP={};class rF{constructor(e,t,o,c,u,p,_,v){this._driver=e,this.element=t,this.subInstructions=o,this._enterClassName=c,this._leaveClassName=u,this.errors=p,this.timelines=_,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=rP,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=v||new oP(this._driver,t,0),_.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;const o=e;let c=this.options;null!=o.duration&&(c.duration=cm(o.duration)),null!=o.delay&&(c.delay=cm(o.delay));const u=o.params;if(u){let p=c.params;p||(p=this.options.params={}),Object.keys(u).forEach(_=>{(!t||!p.hasOwnProperty(_))&&(p[_]=XN(u[_],p,this.errors))})}}_copyOptions(){const e={};if(this.options){const t=this.options.params;if(t){const o=e.params={};Object.keys(t).forEach(c=>{o[c]=t[c]})}}return e}createSubContext(e=null,t,o){const c=t||this.element,u=new rF(this._driver,c,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(c,o||0));return u.previousNode=this.previousNode,u.currentAnimateTimings=this.currentAnimateTimings,u.options=this._copyOptions(),u.updateOptions(e),u.currentQueryIndex=this.currentQueryIndex,u.currentQueryTotal=this.currentQueryTotal,u.parentContext=this,this.subContextCount++,u}transformIntoNewTimeline(e){return this.previousNode=rP,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,o){const c={duration:null!=t?t:e.duration,delay:this.currentTimeline.currentTime+(null!=o?o:0)+e.delay,easing:""},u=new W6(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,c,e.stretchStartingKeyframe);return this.timelines.push(u),c}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,o,c,u,p){let _=[];if(c&&_.push(this.element),e.length>0){e=(e=e.replace(B6,"."+this._enterClassName)).replace(H6,"."+this._leaveClassName);let S=this._driver.query(this.element,e,1!=o);0!==o&&(S=o<0?S.slice(S.length+o,S.length):S.slice(0,o)),_.push(...S)}return!u&&0==_.length&&p.push(`\`query("${t}")\` returned zero elements. (Use \`query("${t}", { optional: true })\` if you wish to allow this.)`),_}}class oP{constructor(e,t,o,c){this._driver=e,this.element=t,this.startTime=o,this._elementTimelineStylesLookup=c,this.duration=0,this._previousKeyframe={},this._currentKeyframe={},this._keyframes=new Map,this._styleSummary={},this._pendingStyles={},this._backFill={},this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._localTimelineStyles=Object.create(this._backFill,{}),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.getCurrentStyleProperties().length>0;default:return!0}}getCurrentStyleProperties(){return Object.keys(this._currentKeyframe)}get currentTime(){return this.startTime+this.duration}delayNextStep(e){const t=1==this._keyframes.size&&Object.keys(this._pendingStyles).length;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new oP(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=Object.create(this._backFill,{}),this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles[e]=t,this._globalTimelineStyles[e]=t,this._styleSummary[e]={time:this.currentTime,value:t}}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&(this._previousKeyframe.easing=e),Object.keys(this._globalTimelineStyles).forEach(t=>{this._backFill[t]=this._globalTimelineStyles[t]||Nu,this._currentKeyframe[t]=Nu}),this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,o,c){t&&(this._previousKeyframe.easing=t);const u=c&&c.params||{},p=function(n,e){const t={};let o;return n.forEach(c=>{"*"===c?(o=o||Object.keys(e),o.forEach(u=>{t[u]=Nu})):kp(c,!1,t)}),t}(e,this._globalTimelineStyles);Object.keys(p).forEach(_=>{const v=XN(p[_],u,o);this._pendingStyles[_]=v,this._localTimelineStyles.hasOwnProperty(_)||(this._backFill[_]=this._globalTimelineStyles.hasOwnProperty(_)?this._globalTimelineStyles[_]:Nu),this._updateStyle(_,v)})}applyStylesToKeyframe(){const e=this._pendingStyles,t=Object.keys(e);0!=t.length&&(this._pendingStyles={},t.forEach(o=>{this._currentKeyframe[o]=e[o]}),Object.keys(this._localTimelineStyles).forEach(o=>{this._currentKeyframe.hasOwnProperty(o)||(this._currentKeyframe[o]=this._localTimelineStyles[o])}))}snapshotCurrentStyles(){Object.keys(this._localTimelineStyles).forEach(e=>{const t=this._localTimelineStyles[e];this._pendingStyles[e]=t,this._updateStyle(e,t)})}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){Object.keys(e._styleSummary).forEach(t=>{const o=this._styleSummary[t],c=e._styleSummary[t];(!o||c.time>o.time)&&this._updateStyle(t,c.value)})}buildKeyframes(){this.applyStylesToKeyframe();const e=new Set,t=new Set,o=1===this._keyframes.size&&0===this.duration;let c=[];this._keyframes.forEach((_,v)=>{const S=kp(_,!0);Object.keys(S).forEach(w=>{const M=S[w];"!"==M?e.add(w):M==Nu&&t.add(w)}),o||(S.offset=v/this.duration),c.push(S)});const u=e.size?QN(e.values()):[],p=t.size?QN(t.values()):[];if(o){const _=c[0],v=Py(_);_.offset=0,v.offset=1,c=[_,v]}return nF(this.element,c,u,p,this.duration,this.startTime,this.easing,!1)}}class W6 extends oP{constructor(e,t,o,c,u,p,_=!1){super(e,t,p.delay),this.keyframes=o,this.preStyleProps=c,this.postStyleProps=u,this._stretchStartingKeyframe=_,this.timings={duration:p.duration,delay:p.delay,easing:p.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:o,easing:c}=this.timings;if(this._stretchStartingKeyframe&&t){const u=[],p=o+t,_=t/p,v=kp(e[0],!1);v.offset=0,u.push(v);const S=kp(e[0],!1);S.offset=q3(_),u.push(S);const w=e.length-1;for(let M=1;M<=w;M++){let F=kp(e[M],!1);F.offset=q3((t+F.offset*o)/p),u.push(F)}o=p,t=0,c="",e=u}return nF(this.element,e,this.preStyleProps,this.postStyleProps,o,t,c,!0)}}function q3(n,e=3){const t=Math.pow(10,e-1);return Math.round(n*t)/t}class oF{}class q6 extends oF{normalizePropertyName(e,t){return Q2(e)}normalizeStyleValue(e,t,o,c){let u="";const p=o.toString().trim();if(z6[t]&&0!==o&&"0"!==o)if("number"==typeof o)u="px";else{const _=o.match(/^[+-]?[\d\.]+([a-z]*)$/);_&&0==_[1].length&&c.push(`Please provide a CSS unit value for ${e}:${o}`)}return p+u}}const z6=(()=>function(n){const e={};return n.forEach(t=>e[t]=!0),e}("width,height,minWidth,minHeight,maxWidth,maxHeight,left,top,bottom,right,fontSize,outlineWidth,outlineOffset,paddingTop,paddingLeft,paddingBottom,paddingRight,marginTop,marginLeft,marginBottom,marginRight,borderRadius,borderWidth,borderTopWidth,borderLeftWidth,borderRightWidth,borderBottomWidth,textIndent,perspective".split(",")))();function z3(n,e,t,o,c,u,p,_,v,S,w,M,F){return{type:0,element:n,triggerName:e,isRemovalTransition:c,fromState:t,fromStyles:u,toState:o,toStyles:p,timelines:_,queriedElements:v,preStyleProps:S,postStyleProps:w,totalTime:M,errors:F}}const sF={};class Y3{constructor(e,t,o){this._triggerName=e,this.ast=t,this._stateStyles=o}match(e,t,o,c){return function(n,e,t,o,c){return n.some(u=>u(e,t,o,c))}(this.ast.matchers,e,t,o,c)}buildStyles(e,t,o){const c=this._stateStyles["*"],u=this._stateStyles[e],p=c?c.buildStyles(t,o):{};return u?u.buildStyles(t,o):p}build(e,t,o,c,u,p,_,v,S,w){const M=[],F=this.ast.options&&this.ast.options.params||sF,W=this.buildStyles(o,_&&_.params||sF,M),ee=v&&v.params||sF,$=this.buildStyles(c,ee,M),pe=new Set,le=new Map,De=new Map,Le="void"===c,wt={params:Object.assign(Object.assign({},F),ee)},zn=w?[]:iF(e,t,this.ast.animation,u,p,W,$,wt,S,M);let di=0;if(zn.forEach(Oo=>{di=Math.max(Oo.duration+Oo.delay,di)}),M.length)return z3(t,this._triggerName,o,c,Le,W,$,[],[],le,De,di,M);zn.forEach(Oo=>{const No=Oo.element,xu=Ca(le,No,{});Oo.preStyleProps.forEach(el=>xu[el]=!0);const Fu=Ca(De,No,{});Oo.postStyleProps.forEach(el=>Fu[el]=!0),No!==t&&pe.add(No)});const us=QN(pe.values());return z3(t,this._triggerName,o,c,Le,W,$,zn,us,le,De,di)}}class J6{constructor(e,t,o){this.styles=e,this.defaultParams=t,this.normalizer=o}buildStyles(e,t){const o={},c=Py(this.defaultParams);return Object.keys(e).forEach(u=>{const p=e[u];null!=p&&(c[u]=p)}),this.styles.styles.forEach(u=>{if("string"!=typeof u){const p=u;Object.keys(p).forEach(_=>{let v=p[_];v.length>1&&(v=XN(v,c,t));const S=this.normalizer.normalizePropertyName(_,t);v=this.normalizer.normalizeStyleValue(_,S,v,t),o[S]=v})}}),o}}class Q6{constructor(e,t,o){this.name=e,this.ast=t,this._normalizer=o,this.transitionFactories=[],this.states={},t.states.forEach(c=>{this.states[c.name]=new J6(c.style,c.options&&c.options.params||{},o)}),$3(this.states,"true","1"),$3(this.states,"false","0"),t.transitions.forEach(c=>{this.transitionFactories.push(new Y3(e,c,this.states))}),this.fallbackTransition=function(n,e,t){return new Y3(n,{type:1,animation:{type:2,steps:[],options:null},matchers:[(p,_)=>!0],options:null,queryCount:0,depCount:0},e)}(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,o,c){return this.transitionFactories.find(p=>p.match(e,t,o,c))||null}matchStyles(e,t,o){return this.fallbackTransition.buildStyles(e,t,o)}}function $3(n,e,t){n.hasOwnProperty(e)?n.hasOwnProperty(t)||(n[t]=n[e]):n.hasOwnProperty(t)&&(n[e]=n[t])}const e8=new iP;class t8{constructor(e,t,o){this.bodyNode=e,this._driver=t,this._normalizer=o,this._animations={},this._playersById={},this.players=[]}register(e,t){const o=[],c=eF(this._driver,t,o);if(o.length)throw new Error(`Unable to build the animation due to the following errors: ${o.join("\n")}`);this._animations[e]=c}_buildPlayer(e,t,o){const c=e.element,u=A3(0,this._normalizer,0,e.keyframes,t,o);return this._driver.animate(c,u,e.duration,e.delay,e.easing,[],!0)}create(e,t,o={}){const c=[],u=this._animations[e];let p;const _=new Map;if(u?(p=iF(this._driver,t,u,Y2,zN,{},{},o,e8,c),p.forEach(w=>{const M=Ca(_,w.element,{});w.postStyleProps.forEach(F=>M[F]=null)})):(c.push("The requested animation doesn't exist or has already been destroyed"),p=[]),c.length)throw new Error(`Unable to create the animation due to the following errors: ${c.join("\n")}`);_.forEach((w,M)=>{Object.keys(w).forEach(F=>{w[F]=this._driver.computeStyle(M,F,Nu)})});const S=Mp(p.map(w=>{const M=_.get(w.element);return this._buildPlayer(w,{},M)}));return this._playersById[e]=S,S.onDestroy(()=>this.destroy(e)),this.players.push(S),S}destroy(e){const t=this._getPlayer(e);t.destroy(),delete this._playersById[e];const o=this.players.indexOf(t);o>=0&&this.players.splice(o,1)}_getPlayer(e){const t=this._playersById[e];if(!t)throw new Error(`Unable to find the timeline player referenced by ${e}`);return t}listen(e,t,o,c){const u=B2(t,"","","");return U2(this._getPlayer(e),o,u,c),()=>{}}command(e,t,o,c){if("register"==o)return void this.register(e,c[0]);if("create"==o)return void this.create(e,t,c[0]||{});const u=this._getPlayer(e);switch(o){case"play":u.play();break;case"pause":u.pause();break;case"reset":u.reset();break;case"restart":u.restart();break;case"finish":u.finish();break;case"init":u.init();break;case"setPosition":u.setPosition(parseFloat(c[0]));break;case"destroy":this.destroy(e)}}}const J3="ng-animate-queued",X3="ng-animate-disabled",Q3=".ng-animate-disabled",o8=[],Z3={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},s8={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},ec="__ng_removed";class aF{constructor(e,t=""){this.namespaceId=t;const o=e&&e.hasOwnProperty("value");if(this.value=function(n){return null!=n?n:null}(o?e.value:e),o){const u=Py(e);delete u.value,this.options=u}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(e){const t=e.params;if(t){const o=this.options.params;Object.keys(t).forEach(c=>{null==o[c]&&(o[c]=t[c])})}}}const rR="void",cF=new aF(rR);class a8{constructor(e,t,o){this.id=e,this.hostElement=t,this._engine=o,this.players=[],this._triggers={},this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,tc(t,this._hostClassName)}listen(e,t,o,c){if(!this._triggers.hasOwnProperty(t))throw new Error(`Unable to listen on the animation trigger event "${o}" because the animation trigger "${t}" doesn't exist!`);if(null==o||0==o.length)throw new Error(`Unable to listen on the animation trigger "${t}" because the provided event is undefined!`);if(!function(n){return"start"==n||"done"==n}(o))throw new Error(`The provided animation trigger event "${o}" for the animation trigger "${t}" is not supported!`);const u=Ca(this._elementListeners,e,[]),p={name:t,phase:o,callback:c};u.push(p);const _=Ca(this._engine.statesByElement,e,{});return _.hasOwnProperty(t)||(tc(e,YN),tc(e,YN+"-"+t),_[t]=cF),()=>{this._engine.afterFlush(()=>{const v=u.indexOf(p);v>=0&&u.splice(v,1),this._triggers[t]||delete _[t]})}}register(e,t){return!this._triggers[e]&&(this._triggers[e]=t,!0)}_getTrigger(e){const t=this._triggers[e];if(!t)throw new Error(`The provided animation trigger "${e}" has not been registered!`);return t}trigger(e,t,o,c=!0){const u=this._getTrigger(t),p=new lF(this.id,t,e);let _=this._engine.statesByElement.get(e);_||(tc(e,YN),tc(e,YN+"-"+t),this._engine.statesByElement.set(e,_={}));let v=_[t];const S=new aF(o,this.id);if(!(o&&o.hasOwnProperty("value"))&&v&&S.absorbOptions(v.options),_[t]=S,v||(v=cF),S.value!==rR&&v.value===S.value){if(!function(n,e){const t=Object.keys(n),o=Object.keys(e);if(t.length!=o.length)return!1;for(let c=0;c<t.length;c++){const u=t[c];if(!e.hasOwnProperty(u)||n[u]!==e[u])return!1}return!0}(v.params,S.params)){const ee=[],$=u.matchStyles(v.value,v.params,ee),pe=u.matchStyles(S.value,S.params,ee);ee.length?this._engine.reportError(ee):this._engine.afterFlush(()=>{lm(e,$),ed(e,pe)})}return}const F=Ca(this._engine.playersByElement,e,[]);F.forEach(ee=>{ee.namespaceId==this.id&&ee.triggerName==t&&ee.queued&&ee.destroy()});let j=u.matchTransition(v.value,S.value,e,S.params),W=!1;if(!j){if(!c)return;j=u.fallbackTransition,W=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:j,fromState:v,toState:S,player:p,isFallbackTransition:W}),W||(tc(e,J3),p.onStart(()=>{My(e,J3)})),p.onDone(()=>{let ee=this.players.indexOf(p);ee>=0&&this.players.splice(ee,1);const $=this._engine.playersByElement.get(e);if($){let pe=$.indexOf(p);pe>=0&&$.splice(pe,1)}}),this.players.push(p),F.push(p),p}deregister(e){delete this._triggers[e],this._engine.statesByElement.forEach((t,o)=>{delete t[e]}),this._elementListeners.forEach((t,o)=>{this._elementListeners.set(o,t.filter(c=>c.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);const t=this._engine.playersByElement.get(e);t&&(t.forEach(o=>o.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){const o=this._engine.driver.query(e,$N,!0);o.forEach(c=>{if(c[ec])return;const u=this._engine.fetchNamespacesByElement(c);u.size?u.forEach(p=>p.triggerLeaveAnimation(c,t,!1,!0)):this.clearElementCache(c)}),this._engine.afterFlushAnimationsDone(()=>o.forEach(c=>this.clearElementCache(c)))}triggerLeaveAnimation(e,t,o,c){const u=this._engine.statesByElement.get(e);if(u){const p=[];if(Object.keys(u).forEach(_=>{if(this._triggers[_]){const v=this.trigger(e,_,rR,c);v&&p.push(v)}}),p.length)return this._engine.markElementAsRemoved(this.id,e,!0,t),o&&Mp(p).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){const t=this._elementListeners.get(e),o=this._engine.statesByElement.get(e);if(t&&o){const c=new Set;t.forEach(u=>{const p=u.name;if(c.has(p))return;c.add(p);const v=this._triggers[p].fallbackTransition,S=o[p]||cF,w=new aF(rR),M=new lF(this.id,p,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:p,transition:v,fromState:S,toState:w,player:M,isFallbackTransition:!0})})}}removeNode(e,t){const o=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let c=!1;if(o.totalAnimations){const u=o.players.length?o.playersByQueriedElement.get(e):[];if(u&&u.length)c=!0;else{let p=e;for(;p=p.parentNode;)if(o.statesByElement.get(p)){c=!0;break}}}if(this.prepareLeaveAnimationListeners(e),c)o.markElementAsRemoved(this.id,e,!1,t);else{const u=e[ec];(!u||u===Z3)&&(o.afterFlush(()=>this.clearElementCache(e)),o.destroyInnerAnimations(e),o._onRemovalComplete(e,t))}}insertNode(e,t){tc(e,this._hostClassName)}drainQueuedTransitions(e){const t=[];return this._queue.forEach(o=>{const c=o.player;if(c.destroyed)return;const u=o.element,p=this._elementListeners.get(u);p&&p.forEach(_=>{if(_.name==o.triggerName){const v=B2(u,o.triggerName,o.fromState.value,o.toState.value);v._data=e,U2(o.player,_.phase,v,_.callback)}}),c.markedForDestroy?this._engine.afterFlush(()=>{c.destroy()}):t.push(o)}),this._queue=[],t.sort((o,c)=>{const u=o.transition.ast.depCount,p=c.transition.ast.depCount;return 0==u||0==p?u-p:this._engine.driver.containsElement(o.element,c.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}elementContainsData(e){let t=!1;return this._elementListeners.has(e)&&(t=!0),t=!!this._queue.find(o=>o.element===e)||t,t}}class c8{constructor(e,t,o){this.bodyNode=e,this.driver=t,this._normalizer=o,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(c,u)=>{}}_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}get queuedPlayers(){const e=[];return this._namespaceList.forEach(t=>{t.players.forEach(o=>{o.queued&&e.push(o)})}),e}createNamespace(e,t){const o=new a8(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(o,t):(this.newHostElements.set(t,o),this.collectEnterElement(t)),this._namespaceLookup[e]=o}_balanceNamespaceList(e,t){const o=this._namespaceList.length-1;if(o>=0){let c=!1;for(let u=o;u>=0;u--)if(this.driver.containsElement(this._namespaceList[u].hostElement,t)){this._namespaceList.splice(u+1,0,e),c=!0;break}c||this._namespaceList.splice(0,0,e)}else this._namespaceList.push(e);return this.namespacesByHostElement.set(t,e),e}register(e,t){let o=this._namespaceLookup[e];return o||(o=this.createNamespace(e,t)),o}registerTrigger(e,t,o){let c=this._namespaceLookup[e];c&&c.register(t,o)&&this.totalAnimations++}destroy(e,t){if(!e)return;const o=this._fetchNamespace(e);this.afterFlush(()=>{this.namespacesByHostElement.delete(o.hostElement),delete this._namespaceLookup[e];const c=this._namespaceList.indexOf(o);c>=0&&this._namespaceList.splice(c,1)}),this.afterFlushAnimationsDone(()=>o.destroy(t))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){const t=new Set,o=this.statesByElement.get(e);if(o){const c=Object.keys(o);for(let u=0;u<c.length;u++){const p=o[c[u]].namespaceId;if(p){const _=this._fetchNamespace(p);_&&t.add(_)}}}return t}trigger(e,t,o,c){if(sP(t)){const u=this._fetchNamespace(e);if(u)return u.trigger(t,o,c),!0}return!1}insertNode(e,t,o,c){if(!sP(t))return;const u=t[ec];if(u&&u.setForRemoval){u.setForRemoval=!1,u.setForMove=!0;const p=this.collectedLeaveElements.indexOf(t);p>=0&&this.collectedLeaveElements.splice(p,1)}if(e){const p=this._fetchNamespace(e);p&&p.insertNode(t,o)}c&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),tc(e,X3)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),My(e,X3))}removeNode(e,t,o,c){if(sP(t)){const u=e?this._fetchNamespace(e):null;if(u?u.removeNode(t,c):this.markElementAsRemoved(e,t,!1,c),o){const p=this.namespacesByHostElement.get(t);p&&p.id!==e&&p.removeNode(t,c)}}else this._onRemovalComplete(t,c)}markElementAsRemoved(e,t,o,c){this.collectedLeaveElements.push(t),t[ec]={namespaceId:e,setForRemoval:c,hasAnimation:o,removedBeforeQueried:!1}}listen(e,t,o,c,u){return sP(t)?this._fetchNamespace(e).listen(t,o,c,u):()=>{}}_buildInstruction(e,t,o,c,u){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,o,c,e.fromState.options,e.toState.options,t,u)}destroyInnerAnimations(e){let t=this.driver.query(e,$N,!0);t.forEach(o=>this.destroyActiveAnimationsForElement(o)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(e,$2,!0),t.forEach(o=>this.finishActiveQueriedAnimationOnElement(o)))}destroyActiveAnimationsForElement(e){const t=this.playersByElement.get(e);t&&t.forEach(o=>{o.queued?o.markedForDestroy=!0:o.destroy()})}finishActiveQueriedAnimationOnElement(e){const t=this.playersByQueriedElement.get(e);t&&t.forEach(o=>o.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return Mp(this.players).onDone(()=>e());e()})}processLeaveNode(e){const t=e[ec];if(t&&t.setForRemoval){if(e[ec]=Z3,t.namespaceId){this.destroyInnerAnimations(e);const o=this._fetchNamespace(t.namespaceId);o&&o.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}this.driver.matchesElement(e,Q3)&&this.markElementAsDisabled(e,!1),this.driver.query(e,Q3,!0).forEach(o=>{this.markElementAsDisabled(o,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((o,c)=>this._balanceNamespaceList(o,c)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let o=0;o<this.collectedEnterElements.length;o++)tc(this.collectedEnterElements[o],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const o=[];try{t=this._flushAnimations(o,e)}finally{for(let c=0;c<o.length;c++)o[c]()}}else for(let o=0;o<this.collectedLeaveElements.length;o++)this.processLeaveNode(this.collectedLeaveElements[o]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(o=>o()),this._flushFns=[],this._whenQuietFns.length){const o=this._whenQuietFns;this._whenQuietFns=[],t.length?Mp(t).onDone(()=>{o.forEach(c=>c())}):o.forEach(c=>c())}}reportError(e){throw new Error(`Unable to process animations due to the following failed trigger transitions\n ${e.join("\n")}`)}_flushAnimations(e,t){const o=new iP,c=[],u=new Map,p=[],_=new Map,v=new Map,S=new Map,w=new Set;this.disabledNodes.forEach(Be=>{w.add(Be);const st=this.driver.query(Be,".ng-animate-queued",!0);for(let Lt=0;Lt<st.length;Lt++)w.add(st[Lt])});const M=this.bodyNode,F=Array.from(this.statesByElement.keys()),j=nB(F,this.collectedEnterElements),W=new Map;let ee=0;j.forEach((Be,st)=>{const Lt=Y2+ee++;W.set(st,Lt),Be.forEach(On=>tc(On,Lt))});const $=[],pe=new Set,le=new Set;for(let Be=0;Be<this.collectedLeaveElements.length;Be++){const st=this.collectedLeaveElements[Be],Lt=st[ec];Lt&&Lt.setForRemoval&&($.push(st),pe.add(st),Lt.hasAnimation?this.driver.query(st,".ng-star-inserted",!0).forEach(On=>pe.add(On)):le.add(st))}const De=new Map,Le=nB(F,Array.from(pe));Le.forEach((Be,st)=>{const Lt=zN+ee++;De.set(st,Lt),Be.forEach(On=>tc(On,Lt))}),e.push(()=>{j.forEach((Be,st)=>{const Lt=W.get(st);Be.forEach(On=>My(On,Lt))}),Le.forEach((Be,st)=>{const Lt=De.get(st);Be.forEach(On=>My(On,Lt))}),$.forEach(Be=>{this.processLeaveNode(Be)})});const wt=[],zn=[];for(let Be=this._namespaceList.length-1;Be>=0;Be--)this._namespaceList[Be].drainQueuedTransitions(t).forEach(Lt=>{const On=Lt.player,Zr=Lt.element;if(wt.push(On),this.collectedEnterElements.length){const sd=Zr[ec];if(sd&&sd.setForMove)return void On.destroy()}const od=!M||!this.driver.containsElement(M,Zr),Ta=De.get(Zr),Wp=W.get(Zr),Qi=this._buildInstruction(Lt,o,Wp,Ta,od);if(Qi.errors&&Qi.errors.length)zn.push(Qi);else{if(od)return On.onStart(()=>lm(Zr,Qi.fromStyles)),On.onDestroy(()=>ed(Zr,Qi.toStyles)),void c.push(On);if(Lt.isFallbackTransition)return On.onStart(()=>lm(Zr,Qi.fromStyles)),On.onDestroy(()=>ed(Zr,Qi.toStyles)),void c.push(On);Qi.timelines.forEach(sd=>sd.stretchStartingKeyframe=!0),o.append(Zr,Qi.timelines),p.push({instruction:Qi,player:On,element:Zr}),Qi.queriedElements.forEach(sd=>Ca(_,sd,[]).push(On)),Qi.preStyleProps.forEach((sd,NR)=>{const QP=Object.keys(sd);if(QP.length){let bm=v.get(NR);bm||v.set(NR,bm=new Set),QP.forEach(RU=>bm.add(RU))}}),Qi.postStyleProps.forEach((sd,NR)=>{const QP=Object.keys(sd);let bm=S.get(NR);bm||S.set(NR,bm=new Set),QP.forEach(RU=>bm.add(RU))})}});if(zn.length){const Be=[];zn.forEach(st=>{Be.push(`@${st.triggerName} has failed due to:\n`),st.errors.forEach(Lt=>Be.push(`- ${Lt}\n`))}),wt.forEach(st=>st.destroy()),this.reportError(Be)}const di=new Map,us=new Map;p.forEach(Be=>{const st=Be.element;o.has(st)&&(us.set(st,st),this._beforeAnimationBuild(Be.player.namespaceId,Be.instruction,di))}),c.forEach(Be=>{const st=Be.element;this._getPreviousPlayers(st,!1,Be.namespaceId,Be.triggerName,null).forEach(On=>{Ca(di,st,[]).push(On),On.destroy()})});const Oo=$.filter(Be=>rB(Be,v,S)),No=new Map;tB(No,this.driver,le,S,Nu).forEach(Be=>{rB(Be,v,S)&&Oo.push(Be)});const Fu=new Map;j.forEach((Be,st)=>{tB(Fu,this.driver,new Set(Be),v,"!")}),Oo.forEach(Be=>{const st=No.get(Be),Lt=Fu.get(Be);No.set(Be,Object.assign(Object.assign({},st),Lt))});const el=[],zy=[],Yy={};p.forEach(Be=>{const{element:st,player:Lt,instruction:On}=Be;if(o.has(st)){if(w.has(st))return Lt.onDestroy(()=>ed(st,On.toStyles)),Lt.disabled=!0,Lt.overrideTotalTime(On.totalTime),void c.push(Lt);let Zr=Yy;if(us.size>1){let Ta=st;const Wp=[];for(;Ta=Ta.parentNode;){const Qi=us.get(Ta);if(Qi){Zr=Qi;break}Wp.push(Ta)}Wp.forEach(Qi=>us.set(Qi,Zr))}const od=this._buildAnimation(Lt.namespaceId,On,di,u,Fu,No);if(Lt.setRealPlayer(od),Zr===Yy)el.push(Lt);else{const Ta=this.playersByElement.get(Zr);Ta&&Ta.length&&(Lt.parentPlayer=Mp(Ta)),c.push(Lt)}}else lm(st,On.fromStyles),Lt.onDestroy(()=>ed(st,On.toStyles)),zy.push(Lt),w.has(st)&&c.push(Lt)}),zy.forEach(Be=>{const st=u.get(Be.element);if(st&&st.length){const Lt=Mp(st);Be.setRealPlayer(Lt)}}),c.forEach(Be=>{Be.parentPlayer?Be.syncPlayerEvents(Be.parentPlayer):Be.destroy()});for(let Be=0;Be<$.length;Be++){const st=$[Be],Lt=st[ec];if(My(st,zN),Lt&&Lt.hasAnimation)continue;let On=[];if(_.size){let od=_.get(st);od&&od.length&&On.push(...od);let Ta=this.driver.query(st,$2,!0);for(let Wp=0;Wp<Ta.length;Wp++){let Qi=_.get(Ta[Wp]);Qi&&Qi.length&&On.push(...Qi)}}const Zr=On.filter(od=>!od.destroyed);Zr.length?h8(this,st,Zr):this.processLeaveNode(st)}return $.length=0,el.forEach(Be=>{this.players.push(Be),Be.onDone(()=>{Be.destroy();const st=this.players.indexOf(Be);this.players.splice(st,1)}),Be.play()}),el}elementContainsData(e,t){let o=!1;const c=t[ec];return c&&c.setForRemoval&&(o=!0),this.playersByElement.has(t)&&(o=!0),this.playersByQueriedElement.has(t)&&(o=!0),this.statesByElement.has(t)&&(o=!0),this._fetchNamespace(e).elementContainsData(t)||o}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,o,c,u){let p=[];if(t){const _=this.playersByQueriedElement.get(e);_&&(p=_)}else{const _=this.playersByElement.get(e);if(_){const v=!u||u==rR;_.forEach(S=>{S.queued||!v&&S.triggerName!=c||p.push(S)})}}return(o||c)&&(p=p.filter(_=>!(o&&o!=_.namespaceId||c&&c!=_.triggerName))),p}_beforeAnimationBuild(e,t,o){const u=t.element,p=t.isRemovalTransition?void 0:e,_=t.isRemovalTransition?void 0:t.triggerName;for(const v of t.timelines){const S=v.element,w=S!==u,M=Ca(o,S,[]);this._getPreviousPlayers(S,w,p,_,t.toState).forEach(j=>{const W=j.getRealPlayer();W.beforeDestroy&&W.beforeDestroy(),j.destroy(),M.push(j)})}lm(u,t.fromStyles)}_buildAnimation(e,t,o,c,u,p){const _=t.triggerName,v=t.element,S=[],w=new Set,M=new Set,F=t.timelines.map(W=>{const ee=W.element;w.add(ee);const $=ee[ec];if($&&$.removedBeforeQueried)return new Ny(W.duration,W.delay);const pe=ee!==v,le=function(n){const e=[];return iB(n,e),e}((o.get(ee)||o8).map(di=>di.getRealPlayer())).filter(di=>!!di.element&&di.element===ee),De=u.get(ee),Le=p.get(ee),wt=A3(0,this._normalizer,0,W.keyframes,De,Le),zn=this._buildPlayer(W,wt,le);if(W.subTimeline&&c&&M.add(ee),pe){const di=new lF(e,_,ee);di.setRealPlayer(zn),S.push(di)}return zn});S.forEach(W=>{Ca(this.playersByQueriedElement,W.element,[]).push(W),W.onDone(()=>function(n,e,t){let o;if(n instanceof Map){if(o=n.get(e),o){if(o.length){const c=o.indexOf(t);o.splice(c,1)}0==o.length&&n.delete(e)}}else if(o=n[e],o){if(o.length){const c=o.indexOf(t);o.splice(c,1)}0==o.length&&delete n[e]}return o}(this.playersByQueriedElement,W.element,W))}),w.forEach(W=>tc(W,x3));const j=Mp(F);return j.onDestroy(()=>{w.forEach(W=>My(W,x3)),ed(v,t.toStyles)}),M.forEach(W=>{Ca(c,W,[]).push(j)}),j}_buildPlayer(e,t,o){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,o):new Ny(e.duration,e.delay)}}class lF{constructor(e,t,o){this.namespaceId=e,this.triggerName=t,this.element=o,this._player=new Ny,this._containsRealPlayer=!1,this._queuedCallbacks={},this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,Object.keys(this._queuedCallbacks).forEach(t=>{this._queuedCallbacks[t].forEach(o=>U2(e,t,void 0,o))}),this._queuedCallbacks={},this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){const t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){Ca(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){const t=this._player;t.triggerCallback&&t.triggerCallback(e)}}function sP(n){return n&&1===n.nodeType}function eB(n,e){const t=n.style.display;return n.style.display=null!=e?e:"none",t}function tB(n,e,t,o,c){const u=[];t.forEach(v=>u.push(eB(v)));const p=[];o.forEach((v,S)=>{const w={};v.forEach(M=>{const F=w[M]=e.computeStyle(S,M,c);(!F||0==F.length)&&(S[ec]=s8,p.push(S))}),n.set(S,w)});let _=0;return t.forEach(v=>eB(v,u[_++])),p}function nB(n,e){const t=new Map;if(n.forEach(_=>t.set(_,[])),0==e.length)return t;const c=new Set(e),u=new Map;function p(_){if(!_)return 1;let v=u.get(_);if(v)return v;const S=_.parentNode;return v=t.has(S)?S:c.has(S)?1:p(S),u.set(_,v),v}return e.forEach(_=>{const v=p(_);1!==v&&t.get(v).push(_)}),t}const aP="$$classes";function tc(n,e){if(n.classList)n.classList.add(e);else{let t=n[aP];t||(t=n[aP]={}),t[e]=!0}}function My(n,e){if(n.classList)n.classList.remove(e);else{let t=n[aP];t&&delete t[e]}}function h8(n,e,t){Mp(t).onDone(()=>n.processLeaveNode(e))}function iB(n,e){for(let t=0;t<n.length;t++){const o=n[t];o instanceof I3?iB(o.players,e):e.push(o)}}function rB(n,e,t){const o=t.get(n);if(!o)return!1;let c=e.get(n);return c?o.forEach(u=>c.add(u)):e.set(n,o),t.delete(n),!0}class cP{constructor(e,t,o){this.bodyNode=e,this._driver=t,this._normalizer=o,this._triggerCache={},this.onRemovalComplete=(c,u)=>{},this._transitionEngine=new c8(e,t,o),this._timelineEngine=new t8(e,t,o),this._transitionEngine.onRemovalComplete=(c,u)=>this.onRemovalComplete(c,u)}registerTrigger(e,t,o,c,u){const p=e+"-"+c;let _=this._triggerCache[p];if(!_){const v=[],S=eF(this._driver,u,v);if(v.length)throw new Error(`The animation trigger "${c}" has failed to build due to the following errors:\n - ${v.join("\n - ")}`);_=function(n,e,t){return new Q6(n,e,t)}(c,S,this._normalizer),this._triggerCache[p]=_}this._transitionEngine.registerTrigger(t,c,_)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,o,c){this._transitionEngine.insertNode(e,t,o,c)}onRemove(e,t,o,c){this._transitionEngine.removeNode(e,t,c||!1,o)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,o,c){if("@"==o.charAt(0)){const[u,p]=D3(o);this._timelineEngine.command(u,t,p,c)}else this._transitionEngine.trigger(e,t,o,c)}listen(e,t,o,c,u){if("@"==o.charAt(0)){const[p,_]=D3(o);return this._timelineEngine.listen(p,t,_,u)}return this._transitionEngine.listen(e,t,o,c,u)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}function oB(n,e){let t=null,o=null;return Array.isArray(e)&&e.length?(t=dF(e[0]),e.length>1&&(o=dF(e[e.length-1]))):e&&(t=dF(e)),t||o?new _8(n,t,o):null}let _8=(()=>{class n{constructor(t,o,c){this._element=t,this._startStyles=o,this._endStyles=c,this._state=0;let u=n.initialStylesByElement.get(t);u||n.initialStylesByElement.set(t,u={}),this._initialStyles=u}start(){this._state<1&&(this._startStyles&&ed(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(ed(this._element,this._initialStyles),this._endStyles&&(ed(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(lm(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(lm(this._element,this._endStyles),this._endStyles=null),ed(this._element,this._initialStyles),this._state=3)}}return n.initialStylesByElement=new WeakMap,n})();function dF(n){let e=null;const t=Object.keys(n);for(let o=0;o<t.length;o++){const c=t[o];m8(c)&&(e=e||{},e[c]=n[c])}return e}function m8(n){return"display"===n||"position"===n}const sB="animation",aB="animationend";class y8{constructor(e,t,o,c,u,p,_){this._element=e,this._name=t,this._duration=o,this._delay=c,this._easing=u,this._fillMode=p,this._onDoneFn=_,this._finished=!1,this._destroyed=!1,this._startTime=0,this._position=0,this._eventFn=v=>this._handleCallback(v)}apply(){(function(n,e){const t=hF(n,"").trim();let o=0;t.length&&(function(n,e){let t=0;for(let o=0;o<n.length;o++)","===n.charAt(o)&&t++;return t}(t)+1,e=`${t}, ${e}`),lP(n,"",e)})(this._element,`${this._duration}ms ${this._easing} ${this._delay}ms 1 normal ${this._fillMode} ${this._name}`),dB(this._element,this._eventFn,!1),this._startTime=Date.now()}pause(){cB(this._element,this._name,"paused")}resume(){cB(this._element,this._name,"running")}setPosition(e){const t=lB(this._element,this._name);this._position=e*this._duration,lP(this._element,"Delay",`-${this._position}ms`,t)}getPosition(){return this._position}_handleCallback(e){const t=e._ngTestManualTimestamp||Date.now(),o=1e3*parseFloat(e.elapsedTime.toFixed(3));e.animationName==this._name&&Math.max(t-this._startTime,0)>=this._delay&&o>=this._duration&&this.finish()}finish(){this._finished||(this._finished=!0,this._onDoneFn(),dB(this._element,this._eventFn,!0))}destroy(){this._destroyed||(this._destroyed=!0,this.finish(),function(n,e){const o=hF(n,"").split(","),c=uF(o,e);c>=0&&(o.splice(c,1),lP(n,"",o.join(",")))}(this._element,this._name))}}function cB(n,e,t){lP(n,"PlayState",t,lB(n,e))}function lB(n,e){const t=hF(n,"");return t.indexOf(",")>0?uF(t.split(","),e):uF([t],e)}function uF(n,e){for(let t=0;t<n.length;t++)if(n[t].indexOf(e)>=0)return t;return-1}function dB(n,e,t){t?n.removeEventListener(aB,e):n.addEventListener(aB,e)}function lP(n,e,t,o){const c=sB+e;if(null!=o){const u=n.style[c];if(u.length){const p=u.split(",");p[o]=t,t=p.join(",")}}n.style[c]=t}function hF(n,e){return n.style[sB+e]||""}class uB{constructor(e,t,o,c,u,p,_,v){this.element=e,this.keyframes=t,this.animationName=o,this._duration=c,this._delay=u,this._finalStyles=_,this._specialStyles=v,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this.currentSnapshot={},this._state=0,this.easing=p||"linear",this.totalTime=c+u,this._buildStyler()}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}destroy(){this.init(),!(this._state>=4)&&(this._state=4,this._styler.destroy(),this._flushStartFns(),this._flushDoneFns(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}_flushDoneFns(){this._onDoneFns.forEach(e=>e()),this._onDoneFns=[]}_flushStartFns(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}finish(){this.init(),!(this._state>=3)&&(this._state=3,this._styler.finish(),this._flushStartFns(),this._specialStyles&&this._specialStyles.finish(),this._flushDoneFns())}setPosition(e){this._styler.setPosition(e)}getPosition(){return this._styler.getPosition()}hasStarted(){return this._state>=2}init(){this._state>=1||(this._state=1,this._styler.apply(),this._delay&&this._styler.pause())}play(){this.init(),this.hasStarted()||(this._flushStartFns(),this._state=2,this._specialStyles&&this._specialStyles.start()),this._styler.resume()}pause(){this.init(),this._styler.pause()}restart(){this.reset(),this.play()}reset(){this._state=0,this._styler.destroy(),this._buildStyler(),this._styler.apply()}_buildStyler(){this._styler=new y8(this.element,this.animationName,this._duration,this._delay,this.easing,"forwards",()=>this.finish())}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(o=>o()),t.length=0}beforeDestroy(){this.init();const e={};if(this.hasStarted()){const t=this._state>=3;Object.keys(this._finalStyles).forEach(o=>{"offset"!=o&&(e[o]=t?this._finalStyles[o]:Z2(this.element,o))})}this.currentSnapshot=e}}class R8 extends Ny{constructor(e,t){super(),this.element=e,this._startingStyles={},this.__initialized=!1,this._styles=M3(t)}init(){this.__initialized||!this._startingStyles||(this.__initialized=!0,Object.keys(this._styles).forEach(e=>{this._startingStyles[e]=this.element.style[e]}),super.init())}play(){!this._startingStyles||(this.init(),Object.keys(this._styles).forEach(e=>this.element.style.setProperty(e,this._styles[e])),super.play())}destroy(){!this._startingStyles||(Object.keys(this._startingStyles).forEach(e=>{const t=this._startingStyles[e];t?this.element.style.setProperty(e,t):this.element.style.removeProperty(e)}),this._startingStyles=null,super.destroy())}}class pB{constructor(){this._count=0}validateStyleProperty(e){return G2(e)}matchesElement(e,t){return W2(e,t)}containsElement(e,t){return K2(e,t)}query(e,t,o){return q2(e,t,o)}computeStyle(e,t,o){return window.getComputedStyle(e)[t]}buildKeyframeElement(e,t,o){o=o.map(_=>M3(_));let c=`@keyframes ${t} {\n`,u="";o.forEach(_=>{u=" ";const v=parseFloat(_.offset);c+=`${u}${100*v}% {\n`,u+=" ",Object.keys(_).forEach(S=>{const w=_[S];switch(S){case"offset":return;case"easing":return void(w&&(c+=`${u}animation-timing-function: ${w};\n`));default:return void(c+=`${u}${S}: ${w};\n`)}}),c+=`${u}}\n`}),c+="}\n";const p=document.createElement("style");return p.textContent=c,p}animate(e,t,o,c,u,p=[],_){const v=p.filter($=>$ instanceof uB),S={};j3(o,c)&&v.forEach($=>{let pe=$.currentSnapshot;Object.keys(pe).forEach(le=>S[le]=pe[le])});const w=function(n){let e={};return n&&(Array.isArray(n)?n:[n]).forEach(o=>{Object.keys(o).forEach(c=>{"offset"==c||"easing"==c||(e[c]=o[c])})}),e}(t=H3(e,t,S));if(0==o)return new R8(e,w);const M="gen_css_kf_"+this._count++,F=this.buildKeyframeElement(e,M,t);(function(n){var e;const t=null===(e=n.getRootNode)||void 0===e?void 0:e.call(n);return"undefined"!=typeof ShadowRoot&&t instanceof ShadowRoot?t:document.head})(e).appendChild(F);const W=oB(e,t),ee=new uB(e,t,M,o,c,u,w,W);return ee.onDestroy(()=>function(n){n.parentNode.removeChild(n)}(F)),ee}}class _B{constructor(e,t,o,c){this.element=e,this.keyframes=t,this.options=o,this._specialStyles=c,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this.time=0,this.parentPlayer=null,this.currentSnapshot={},this._duration=o.duration,this._delay=o.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:{},this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_triggerWebAnimation(e,t,o){return e.animate(t,o)}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const e={};this.hasStarted()&&Object.keys(this._finalKeyframe).forEach(t=>{"offset"!=t&&(e[t]=this._finished?this._finalKeyframe[t]:Z2(this.element,t))}),this.currentSnapshot=e}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(o=>o()),t.length=0}}class O8{constructor(){this._isNativeImpl=/\{\s*\[native\s+code\]\s*\}/.test(mB().toString()),this._cssKeyframesDriver=new pB}validateStyleProperty(e){return G2(e)}matchesElement(e,t){return W2(e,t)}containsElement(e,t){return K2(e,t)}query(e,t,o){return q2(e,t,o)}computeStyle(e,t,o){return window.getComputedStyle(e)[t]}overrideWebAnimationsSupport(e){this._isNativeImpl=e}animate(e,t,o,c,u,p=[],_){if(!_&&!this._isNativeImpl)return this._cssKeyframesDriver.animate(e,t,o,c,u,p);const w={duration:o,delay:c,fill:0==c?"both":"forwards"};u&&(w.easing=u);const M={},F=p.filter(W=>W instanceof _B);j3(o,c)&&F.forEach(W=>{let ee=W.currentSnapshot;Object.keys(ee).forEach($=>M[$]=ee[$])});const j=oB(e,t=H3(e,t=t.map(W=>kp(W,!1)),M));return new _B(e,t,w,j)}}function mB(){return w3()&&Element.prototype.animate||{}}let P8=(()=>{class n extends eR{constructor(t,o){super(),this._nextAnimationId=0,this._renderer=t.createRenderer(o.body,{id:"0",encapsulation:ui.None,styles:[],data:{animation:[]}})}build(t){const o=this._nextAnimationId.toString();this._nextAnimationId++;const c=Array.isArray(t)?b3(t):t;return gB(this._renderer,null,o,"register",[c]),new M8(o,this._renderer)}}return n.\u0275fac=function(t){return new(t||n)(ie(Dl),ie(Je))},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})();class M8 extends class{}{constructor(e,t){super(),this._id=e,this._renderer=t}create(e,t){return new k8(this._id,e,t||{},this._renderer)}}class k8{constructor(e,t,o,c){this.id=e,this.element=t,this._renderer=c,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",o)}_listen(e,t){return this._renderer.listen(this.element,`@@${this.id}:${e}`,t)}_command(e,...t){return gB(this._renderer,this.element,this.id,e,t)}onDone(e){this._listen("done",e)}onStart(e){this._listen("start",e)}onDestroy(e){this._listen("destroy",e)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(e){this._command("setPosition",e)}getPosition(){var e,t;return null!==(t=null===(e=this._renderer.engine.players[+this.id])||void 0===e?void 0:e.getPosition())&&void 0!==t?t:0}}function gB(n,e,t,o,c){return n.setProperty(e,`@@${t}:${o}`,c)}const EB="@.disabled";let L8=(()=>{class n{constructor(t,o,c){this.delegate=t,this.engine=o,this._zone=c,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),o.onRemovalComplete=(u,p)=>{p&&p.parentNode(u)&&p.removeChild(u.parentNode,u)}}createRenderer(t,o){const u=this.delegate.createRenderer(t,o);if(!(t&&o&&o.data&&o.data.animation)){let w=this._rendererCache.get(u);return w||(w=new yB("",u,this.engine),this._rendererCache.set(u,w)),w}const p=o.id,_=o.id+"-"+this._currentId;this._currentId++,this.engine.register(_,t);const v=w=>{Array.isArray(w)?w.forEach(v):this.engine.registerTrigger(p,_,t,w.name,w)};return o.data.animation.forEach(v),new x8(this,_,u,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(t,o,c){t>=0&&t<this._microtaskId?this._zone.run(()=>o(c)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(u=>{const[p,_]=u;p(_)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([o,c]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return n.\u0275fac=function(t){return new(t||n)(ie(Dl),ie(cP),ie(nt))},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})();class yB{constructor(e,t,o){this.namespaceId=e,this.delegate=t,this.engine=o,this.destroyNode=this.delegate.destroyNode?c=>t.destroyNode(c):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,o,c=!0){this.delegate.insertBefore(e,t,o),this.engine.onInsert(this.namespaceId,t,e,c)}removeChild(e,t,o){this.engine.onRemove(this.namespaceId,t,this.delegate,o)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,o,c){this.delegate.setAttribute(e,t,o,c)}removeAttribute(e,t,o){this.delegate.removeAttribute(e,t,o)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,o,c){this.delegate.setStyle(e,t,o,c)}removeStyle(e,t,o){this.delegate.removeStyle(e,t,o)}setProperty(e,t,o){"@"==t.charAt(0)&&t==EB?this.disableAnimations(e,!!o):this.delegate.setProperty(e,t,o)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,o){return this.delegate.listen(e,t,o)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}}class x8 extends yB{constructor(e,t,o,c){super(t,o,c),this.factory=e,this.namespaceId=t}setProperty(e,t,o){"@"==t.charAt(0)?"."==t.charAt(1)&&t==EB?this.disableAnimations(e,o=void 0===o||!!o):this.engine.process(this.namespaceId,e,t.substr(1),o):this.delegate.setProperty(e,t,o)}listen(e,t,o){if("@"==t.charAt(0)){const c=function(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(e);let u=t.substr(1),p="";return"@"!=u.charAt(0)&&([u,p]=function(n){const e=n.indexOf(".");return[n.substring(0,e),n.substr(e+1)]}(u)),this.engine.listen(this.namespaceId,c,u,p,_=>{this.factory.scheduleListenerCallback(_._data||-1,o,_)})}return this.delegate.listen(e,t,o)}}let V8=(()=>{class n extends cP{constructor(t,o,c){super(t.body,o,c)}ngOnDestroy(){this.flush()}}return n.\u0275fac=function(t){return new(t||n)(ie(Je),ie(z2),ie(oF))},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})();const Lp=new je("AnimationModuleType"),vB=[{provide:eR,useClass:P8},{provide:oF,useFactory:function(){return new q6}},{provide:cP,useClass:V8},{provide:Dl,useFactory:function(n,e,t){return new L8(n,e,t)},deps:[s,cP,nt]}],CB=[{provide:z2,useFactory:function(){return"function"==typeof mB()?new O8:new pB}},{provide:Lp,useValue:"BrowserAnimations"},...vB],SB=[{provide:z2,useClass:k3},{provide:Lp,useValue:"NoopAnimations"},...vB];let G8=(()=>{class n{static withConfig(t){return{ngModule:n,providers:t.disableAnimations?SB:CB}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({providers:CB,imports:[G]}),n})();function Ct(...n){let e=n[n.length-1];return ad(e)?(n.pop(),wm(n,e)):Hu(n)}class Vs extends xt{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return t&&!t.closed&&e.next(this._value),t}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new nl;return this._value}next(e){super.next(this._value=e)}}class W8 extends wn{notifyNext(e,t,o,c,u){this.destination.next(t)}notifyError(e,t){this.destination.error(e)}notifyComplete(e){this.destination.complete()}}class K8 extends wn{constructor(e,t,o){super(),this.parent=e,this.outerValue=t,this.outerIndex=o,this.index=0}_next(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)}_error(e){this.parent.notifyError(e,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}function q8(n,e,t,o,c=new K8(n,t,o)){if(!c.closed)return e instanceof tn?e.subscribe(c):Im(e)(c)}const TB={};function bB(...n){let e,t;return ad(n[n.length-1])&&(t=n.pop()),"function"==typeof n[n.length-1]&&(e=n.pop()),1===n.length&&Ir(n[0])&&(n=n[0]),Hu(n,t).lift(new z8(e))}class z8{constructor(e){this.resultSelector=e}call(e,t){return t.subscribe(new Y8(e,this.resultSelector))}}class Y8 extends W8{constructor(e,t){super(e),this.resultSelector=t,this.active=0,this.values=[],this.observables=[]}_next(e){this.values.push(TB),this.observables.push(e)}_complete(){const e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(let o=0;o<t;o++)this.add(q8(this,e[o],void 0,o))}}notifyComplete(e){0==(this.active-=1)&&this.destination.complete()}notifyNext(e,t,o){const c=this.values,p=this.toRespond?c[o]===TB?--this.toRespond:this.toRespond:0;c[o]=t,0===p&&(this.resultSelector?this._tryResultSelector(c):this.destination.next(c.slice()))}_tryResultSelector(e){let t;try{t=this.resultSelector.apply(this,e)}catch(o){return void this.destination.error(o)}this.destination.next(t)}}const uP=(()=>{function n(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return n.prototype=Object.create(Error.prototype),n})();function hP(...n){return il(1)(Ct(...n))}const um=new tn(n=>n.complete());function pP(n){return n?function(n){return new tn(e=>n.schedule(()=>e.complete()))}(n):um}function RB(n){return new tn(e=>{let t;try{t=n()}catch(c){return void e.error(c)}return(t?lr(t):pP()).subscribe(e)})}function td(n,e){return"function"==typeof e?t=>t.pipe(td((o,c)=>lr(n(o,c)).pipe(Cn((u,p)=>e(o,u,c,p))))):t=>t.lift(new X8(n))}class X8{constructor(e){this.project=e}call(e,t){return t.subscribe(new Q8(e,this.project))}}class Q8 extends $p{constructor(e,t){super(e),this.project=t,this.index=0}_next(e){let t;const o=this.index++;try{t=this.project(e,o)}catch(c){return void this.destination.error(c)}this._innerSub(t)}_innerSub(e){const t=this.innerSubscription;t&&t.unsubscribe();const o=new ju(this),c=this.destination;c.add(o),this.innerSubscription=cd(e,o),this.innerSubscription!==o&&c.add(this.innerSubscription)}_complete(){const{innerSubscription:e}=this;(!e||e.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(e){this.destination.next(e)}}const IB=(()=>{function n(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return n.prototype=Object.create(Error.prototype),n})();function Ao(n){return e=>0===n?pP():e.lift(new Z8(n))}class Z8{constructor(e){if(this.total=e,this.total<0)throw new IB}call(e,t){return t.subscribe(new eH(e,this.total))}}class eH extends wn{constructor(e,t){super(e),this.total=t,this.count=0}_next(e){const t=this.total,o=++this.count;o<=t&&(this.destination.next(e),o===t&&(this.destination.complete(),this.unsubscribe()))}}function hm(...n){const e=n[n.length-1];return ad(e)?(n.pop(),t=>hP(n,t,e)):t=>hP(n,t)}function wB(n,e){let t=!1;return arguments.length>=2&&(t=!0),function(c){return c.lift(new tH(n,e,t))}}class tH{constructor(e,t,o=!1){this.accumulator=e,this.seed=t,this.hasSeed=o}call(e,t){return t.subscribe(new nH(e,this.accumulator,this.seed,this.hasSeed))}}class nH extends wn{constructor(e,t,o,c){super(e),this.accumulator=t,this._seed=o,this.hasSeed=c,this.index=0}get seed(){return this._seed}set seed(e){this.hasSeed=!0,this._seed=e}_next(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)}_tryNext(e){const t=this.index++;let o;try{o=this.accumulator(this.seed,e,t)}catch(c){this.destination.error(c)}this.seed=o,this.destination.next(o)}}function xp(n,e){return function(o){return o.lift(new iH(n,e))}}class iH{constructor(e,t){this.predicate=e,this.thisArg=t}call(e,t){return t.subscribe(new rH(e,this.predicate,this.thisArg))}}class rH extends wn{constructor(e,t,o){super(e),this.predicate=t,this.thisArg=o,this.count=0}_next(e){let t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(o){return void this.destination.error(o)}t&&this.destination.next(e)}}function pm(n){return function(t){const o=new oH(n),c=t.lift(o);return o.caught=c}}class oH{constructor(e){this.selector=e}call(e,t){return t.subscribe(new sH(e,this.selector,this.caught))}}class sH extends $p{constructor(e,t,o){super(e),this.selector=t,this.caught=o}error(e){if(!this.isStopped){let t;try{t=this.selector(e,this.caught)}catch(u){return void super.error(u)}this._unsubscribeAndRecycle();const o=new ju(this);this.add(o);const c=cd(t,o);c!==o&&this.add(c)}}}function oR(n,e){return Gi(n,e,1)}function pF(n){return function(t){return 0===n?pP():t.lift(new aH(n))}}class aH{constructor(e){if(this.total=e,this.total<0)throw new IB}call(e,t){return t.subscribe(new cH(e,this.total))}}class cH extends wn{constructor(e,t){super(e),this.total=t,this.ring=new Array,this.count=0}_next(e){const t=this.ring,o=this.total,c=this.count++;t.length<o?t.push(e):t[c%o]=e}_complete(){const e=this.destination;let t=this.count;if(t>0){const o=this.count>=this.total?this.total:this.count,c=this.ring;for(let u=0;u<o;u++){const p=t++%o;e.next(c[p])}}e.complete()}}function AB(n=uH){return e=>e.lift(new lH(n))}class lH{constructor(e){this.errorFactory=e}call(e,t){return t.subscribe(new dH(e,this.errorFactory))}}class dH extends wn{constructor(e,t){super(e),this.errorFactory=t,this.hasValue=!1}_next(e){this.hasValue=!0,this.destination.next(e)}_complete(){if(this.hasValue)return this.destination.complete();{let e;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)}}}function uH(){return new uP}function DB(n=null){return e=>e.lift(new hH(n))}class hH{constructor(e){this.defaultValue=e}call(e,t){return t.subscribe(new pH(e,this.defaultValue))}}class pH extends wn{constructor(e,t){super(e),this.defaultValue=t,this.isEmpty=!0}_next(e){this.isEmpty=!1,this.destination.next(e)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}function ky(n,e){const t=arguments.length>=2;return o=>o.pipe(n?xp((c,u)=>n(c,u,o)):qp,Ao(1),t?DB(e):AB(()=>new uP))}function Fp(){}function cs(n,e,t){return function(c){return c.lift(new _H(n,e,t))}}class _H{constructor(e,t,o){this.nextOrObserver=e,this.error=t,this.complete=o}call(e,t){return t.subscribe(new mH(e,this.nextOrObserver,this.error,this.complete))}}class mH extends wn{constructor(e,t,o,c){super(e),this._tapNext=Fp,this._tapError=Fp,this._tapComplete=Fp,this._tapError=o||Fp,this._tapComplete=c||Fp,x(t)?(this._context=this,this._tapNext=t):t&&(this._context=t,this._tapNext=t.next||Fp,this._tapError=t.error||Fp,this._tapComplete=t.complete||Fp)}_next(e){try{this._tapNext.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.next(e)}_error(e){try{this._tapError.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.error(e)}_complete(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()}}class EH{constructor(e){this.callback=e}call(e,t){return t.subscribe(new yH(e,this.callback))}}class yH extends wn{constructor(e,t){super(e),this.add(new en(t))}}class Pu{constructor(e,t){this.id=e,this.url=t}}class fF extends Pu{constructor(e,t,o="imperative",c=null){super(e,t),this.navigationTrigger=o,this.restoredState=c}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class sR extends Pu{constructor(e,t,o){super(e,t),this.urlAfterRedirects=o}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class OB extends Pu{constructor(e,t,o){super(e,t),this.reason=o}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class vH extends Pu{constructor(e,t,o){super(e,t),this.error=o}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class CH extends Pu{constructor(e,t,o,c){super(e,t),this.urlAfterRedirects=o,this.state=c}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class SH extends Pu{constructor(e,t,o,c){super(e,t),this.urlAfterRedirects=o,this.state=c}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class TH extends Pu{constructor(e,t,o,c,u){super(e,t),this.urlAfterRedirects=o,this.state=c,this.shouldActivate=u}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class bH extends Pu{constructor(e,t,o,c){super(e,t),this.urlAfterRedirects=o,this.state=c}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class RH extends Pu{constructor(e,t,o,c){super(e,t),this.urlAfterRedirects=o,this.state=c}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class NB{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class PB{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class IH{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class wH{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class AH{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class DH{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class MB{constructor(e,t,o){this.routerEvent=e,this.position=t,this.anchor=o}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const cn="primary";class OH{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function Ly(n){return new OH(n)}const kB="ngNavigationCancelingError";function _F(n){const e=Error("NavigationCancelingError: "+n);return e[kB]=!0,e}function PH(n,e,t){const o=t.path.split("/");if(o.length>n.length||"full"===t.pathMatch&&(e.hasChildren()||o.length<n.length))return null;const c={};for(let u=0;u<o.length;u++){const p=o[u],_=n[u];if(p.startsWith(":"))c[p.substring(1)]=_;else if(p!==_.path)return null}return{consumed:n.slice(0,o.length),posParams:c}}function nd(n,e){const t=n?Object.keys(n):void 0,o=e?Object.keys(e):void 0;if(!t||!o||t.length!=o.length)return!1;let c;for(let u=0;u<t.length;u++)if(c=t[u],!LB(n[c],e[c]))return!1;return!0}function LB(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;const t=[...n].sort(),o=[...e].sort();return t.every((c,u)=>o[u]===c)}return n===e}function xB(n){return Array.prototype.concat.apply([],n)}function FB(n){return n.length>0?n[n.length-1]:null}function ho(n,e){for(const t in n)n.hasOwnProperty(t)&&e(n[t],t)}function id(n){return zd(n)?n:n_(n)?lr(Promise.resolve(n)):Ct(n)}const LH={exact:function BB(n,e,t){if(!_m(n.segments,e.segments)||!fP(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(const o in e.children)if(!n.children[o]||!BB(n.children[o],e.children[o],t))return!1;return!0},subset:jB},UB={exact:function(n,e){return nd(n,e)},subset:function(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>LB(n[t],e[t]))},ignored:()=>!0};function VB(n,e,t){return LH[t.paths](n.root,e.root,t.matrixParams)&&UB[t.queryParams](n.queryParams,e.queryParams)&&!("exact"===t.fragment&&n.fragment!==e.fragment)}function jB(n,e,t){return HB(n,e,e.segments,t)}function HB(n,e,t,o){if(n.segments.length>t.length){const c=n.segments.slice(0,t.length);return!(!_m(c,t)||e.hasChildren()||!fP(c,t,o))}if(n.segments.length===t.length){if(!_m(n.segments,t)||!fP(n.segments,t,o))return!1;for(const c in e.children)if(!n.children[c]||!jB(n.children[c],e.children[c],o))return!1;return!0}{const c=t.slice(0,n.segments.length),u=t.slice(n.segments.length);return!!(_m(n.segments,c)&&fP(n.segments,c,o)&&n.children[cn])&&HB(n.children[cn],e,u,o)}}function fP(n,e,t){return e.every((o,c)=>UB[t](n[c].parameters,o.parameters))}class fm{constructor(e,t,o){this.root=e,this.queryParams=t,this.fragment=o}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ly(this.queryParams)),this._queryParamMap}toString(){return BH.serialize(this)}}class gn{constructor(e,t){this.segments=e,this.children=t,this.parent=null,ho(t,(o,c)=>o.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return _P(this)}}class aR{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=Ly(this.parameters)),this._parameterMap}toString(){return qB(this)}}function _m(n,e){return n.length===e.length&&n.every((t,o)=>t.path===e[o].path)}class mF{}class GB{parse(e){const t=new $H(e);return new fm(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){const t=`/${cR(e.root,!0)}`,o=function(n){const e=Object.keys(n).map(t=>{const o=n[t];return Array.isArray(o)?o.map(c=>`${mP(t)}=${mP(c)}`).join("&"):`${mP(t)}=${mP(o)}`}).filter(t=>!!t);return e.length?`?${e.join("&")}`:""}(e.queryParams),c="string"==typeof e.fragment?`#${function(n){return encodeURI(n)}(e.fragment)}`:"";return`${t}${o}${c}`}}const BH=new GB;function _P(n){return n.segments.map(e=>qB(e)).join("/")}function cR(n,e){if(!n.hasChildren())return _P(n);if(e){const t=n.children[cn]?cR(n.children[cn],!1):"",o=[];return ho(n.children,(c,u)=>{u!==cn&&o.push(`${u}:${cR(c,!1)}`)}),o.length>0?`${t}(${o.join("//")})`:t}{const t=function(n,e){let t=[];return ho(n.children,(o,c)=>{c===cn&&(t=t.concat(e(o,c)))}),ho(n.children,(o,c)=>{c!==cn&&(t=t.concat(e(o,c)))}),t}(n,(o,c)=>c===cn?[cR(n.children[cn],!1)]:[`${c}:${cR(o,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[cn]?`${_P(n)}/${t[0]}`:`${_P(n)}/(${t.join("//")})`}}function WB(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function mP(n){return WB(n).replace(/%3B/gi,";")}function gF(n){return WB(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function gP(n){return decodeURIComponent(n)}function KB(n){return gP(n.replace(/\+/g,"%20"))}function qB(n){return`${gF(n.path)}${function(n){return Object.keys(n).map(e=>`;${gF(e)}=${gF(n[e])}`).join("")}(n.parameters)}`}const WH=/^[^\/()?;=#]+/;function EP(n){const e=n.match(WH);return e?e[0]:""}const KH=/^[^=?&#]+/,zH=/^[^?&#]+/;class $H{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new gn([],{}):new gn([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let o={};return this.peekStartsWith("(")&&(o=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(o[cn]=new gn(e,t)),o}parseSegment(){const e=EP(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new aR(gP(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=EP(this.remaining);if(!t)return;this.capture(t);let o="";if(this.consumeOptional("=")){const c=EP(this.remaining);c&&(o=c,this.capture(o))}e[gP(t)]=gP(o)}parseQueryParam(e){const t=function(n){const e=n.match(KH);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let o="";if(this.consumeOptional("=")){const p=function(n){const e=n.match(zH);return e?e[0]:""}(this.remaining);p&&(o=p,this.capture(o))}const c=KB(t),u=KB(o);if(e.hasOwnProperty(c)){let p=e[c];Array.isArray(p)||(p=[p],e[c]=p),p.push(u)}else e[c]=u}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const o=EP(this.remaining),c=this.remaining[o.length];if("/"!==c&&")"!==c&&";"!==c)throw new Error(`Cannot parse url '${this.url}'`);let u;o.indexOf(":")>-1?(u=o.substr(0,o.indexOf(":")),this.capture(u),this.capture(":")):e&&(u=cn);const p=this.parseChildren();t[u]=1===Object.keys(p).length?p[cn]:new gn([],p),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class zB{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=EF(e,this._root);return t?t.children.map(o=>o.value):[]}firstChild(e){const t=EF(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=yF(e,this._root);return t.length<2?[]:t[t.length-2].children.map(c=>c.value).filter(c=>c!==e)}pathFromRoot(e){return yF(e,this._root).map(t=>t.value)}}function EF(n,e){if(n===e.value)return e;for(const t of e.children){const o=EF(n,t);if(o)return o}return null}function yF(n,e){if(n===e.value)return[e];for(const t of e.children){const o=yF(n,t);if(o.length)return o.unshift(e),o}return[]}class Mu{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function lR(n){const e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}class YB extends zB{constructor(e,t){super(e),this.snapshot=t,vF(this,e)}toString(){return this.snapshot.toString()}}function $B(n,e){const t=function(n,e){const p=new yP([],{},{},"",{},cn,e,null,n.root,-1,{});return new XB("",new Mu(p,[]))}(n,e),o=new Vs([new aR("",{})]),c=new Vs({}),u=new Vs({}),p=new Vs({}),_=new Vs(""),v=new mm(o,c,p,_,u,cn,e,t.root);return v.snapshot=t.root,new YB(new Mu(v,[]),t)}class mm{constructor(e,t,o,c,u,p,_,v){this.url=e,this.params=t,this.queryParams=o,this.fragment=c,this.data=u,this.outlet=p,this.component=_,this._futureSnapshot=v}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Cn(e=>Ly(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Cn(e=>Ly(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function JB(n,e="emptyOnly"){const t=n.pathFromRoot;let o=0;if("always"!==e)for(o=t.length-1;o>=1;){const c=t[o],u=t[o-1];if(c.routeConfig&&""===c.routeConfig.path)o--;else{if(u.component)break;o--}}return function(n){return n.reduce((e,t)=>({params:Object.assign(Object.assign({},e.params),t.params),data:Object.assign(Object.assign({},e.data),t.data),resolve:Object.assign(Object.assign({},e.resolve),t._resolvedData)}),{params:{},data:{},resolve:{}})}(t.slice(o))}class yP{constructor(e,t,o,c,u,p,_,v,S,w,M){this.url=e,this.params=t,this.queryParams=o,this.fragment=c,this.data=u,this.outlet=p,this.component=_,this.routeConfig=v,this._urlSegment=S,this._lastPathIndex=w,this._resolve=M}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Ly(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ly(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(o=>o.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class XB extends zB{constructor(e,t){super(t),this.url=e,vF(this,t)}toString(){return QB(this._root)}}function vF(n,e){e.value._routerState=n,e.children.forEach(t=>vF(n,t))}function QB(n){const e=n.children.length>0?` { ${n.children.map(QB).join(", ")} } `:"";return`${n.value}${e}`}function CF(n){if(n.snapshot){const e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,nd(e.queryParams,t.queryParams)||n.queryParams.next(t.queryParams),e.fragment!==t.fragment&&n.fragment.next(t.fragment),nd(e.params,t.params)||n.params.next(t.params),function(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!nd(n[t],e[t]))return!1;return!0}(e.url,t.url)||n.url.next(t.url),nd(e.data,t.data)||n.data.next(t.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function SF(n,e){const t=nd(n.params,e.params)&&function(n,e){return _m(n,e)&&n.every((t,o)=>nd(t.parameters,e[o].parameters))}(n.url,e.url);return t&&!(!n.parent!=!e.parent)&&(!n.parent||SF(n.parent,e.parent))}function vP(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){const o=t.value;o._futureSnapshot=e.value;const c=function(n,e,t){return e.children.map(o=>{for(const c of t.children)if(n.shouldReuseRoute(o.value,c.value.snapshot))return vP(n,o,c);return vP(n,o)})}(n,e,t);return new Mu(o,c)}{if(n.shouldAttach(e.value)){const u=n.retrieve(e.value);if(null!==u){const p=u.route;return ZB(e,p),p}}const o=function(n){return new mm(new Vs(n.url),new Vs(n.params),new Vs(n.queryParams),new Vs(n.fragment),new Vs(n.data),n.outlet,n.component,n)}(e.value),c=e.children.map(u=>vP(n,u));return new Mu(o,c)}}function ZB(n,e){if(n.value.routeConfig!==e.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(n.children.length!==e.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");e.value._futureSnapshot=n.value;for(let t=0;t<n.children.length;++t)ZB(n.children[t],e.children[t])}function CP(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function dR(n){return"object"==typeof n&&null!=n&&n.outlets}function TF(n,e,t,o,c){let u={};return o&&ho(o,(p,_)=>{u[_]=Array.isArray(p)?p.map(v=>`${v}`):`${p}`}),new fm(t.root===n?e:ej(t.root,n,e),u,c)}function ej(n,e,t){const o={};return ho(n.children,(c,u)=>{o[u]=c===e?t:ej(c,e,t)}),new gn(n.segments,o)}class tj{constructor(e,t,o){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=o,e&&o.length>0&&CP(o[0]))throw new Error("Root segment cannot have matrix parameters");const c=o.find(dR);if(c&&c!==FB(o))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class bF{constructor(e,t,o){this.segmentGroup=e,this.processChildren=t,this.index=o}}function nj(n,e,t){if(n||(n=new gn([],{})),0===n.segments.length&&n.hasChildren())return SP(n,e,t);const o=function(n,e,t){let o=0,c=e;const u={match:!1,pathIndex:0,commandIndex:0};for(;c<n.segments.length;){if(o>=t.length)return u;const p=n.segments[c],_=t[o];if(dR(_))break;const v=`${_}`,S=o<t.length-1?t[o+1]:null;if(c>0&&void 0===v)break;if(v&&S&&"object"==typeof S&&void 0===S.outlets){if(!rj(v,S,p))return u;o+=2}else{if(!rj(v,{},p))return u;o++}c++}return{match:!0,pathIndex:c,commandIndex:o}}(n,e,t),c=t.slice(o.commandIndex);if(o.match&&o.pathIndex<n.segments.length){const u=new gn(n.segments.slice(0,o.pathIndex),{});return u.children[cn]=new gn(n.segments.slice(o.pathIndex),n.children),SP(u,0,c)}return o.match&&0===c.length?new gn(n.segments,{}):o.match&&!n.hasChildren()?RF(n,e,t):o.match?SP(n,0,c):RF(n,e,t)}function SP(n,e,t){if(0===t.length)return new gn(n.segments,{});{const o=function(n){return dR(n[0])?n[0].outlets:{[cn]:n}}(t),c={};return ho(o,(u,p)=>{"string"==typeof u&&(u=[u]),null!==u&&(c[p]=nj(n.children[p],e,u))}),ho(n.children,(u,p)=>{void 0===o[p]&&(c[p]=u)}),new gn(n.segments,c)}}function RF(n,e,t){const o=n.segments.slice(0,e);let c=0;for(;c<t.length;){const u=t[c];if(dR(u)){const v=aG(u.outlets);return new gn(o,v)}if(0===c&&CP(t[0])){o.push(new aR(n.segments[e].path,ij(t[0]))),c++;continue}const p=dR(u)?u.outlets[cn]:`${u}`,_=c<t.length-1?t[c+1]:null;p&&_&&CP(_)?(o.push(new aR(p,ij(_))),c+=2):(o.push(new aR(p,{})),c++)}return new gn(o,{})}function aG(n){const e={};return ho(n,(t,o)=>{"string"==typeof t&&(t=[t]),null!==t&&(e[o]=RF(new gn([],{}),0,t))}),e}function ij(n){const e={};return ho(n,(t,o)=>e[o]=`${t}`),e}function rj(n,e,t){return n==t.path&&nd(e,t.parameters)}class lG{constructor(e,t,o,c){this.routeReuseStrategy=e,this.futureState=t,this.currState=o,this.forwardEvent=c}activate(e){const t=this.futureState._root,o=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,o,e),CF(this.futureState.root),this.activateChildRoutes(t,o,e)}deactivateChildRoutes(e,t,o){const c=lR(t);e.children.forEach(u=>{const p=u.value.outlet;this.deactivateRoutes(u,c[p],o),delete c[p]}),ho(c,(u,p)=>{this.deactivateRouteAndItsChildren(u,o)})}deactivateRoutes(e,t,o){const c=e.value,u=t?t.value:null;if(c===u)if(c.component){const p=o.getContext(c.outlet);p&&this.deactivateChildRoutes(e,t,p.children)}else this.deactivateChildRoutes(e,t,o);else u&&this.deactivateRouteAndItsChildren(t,o)}deactivateRouteAndItsChildren(e,t){this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const o=t.getContext(e.value.outlet);if(o&&o.outlet){const c=o.outlet.detach(),u=o.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:c,route:e,contexts:u})}}deactivateRouteAndOutlet(e,t){const o=t.getContext(e.value.outlet),c=o&&e.value.component?o.children:t,u=lR(e);for(const p of Object.keys(u))this.deactivateRouteAndItsChildren(u[p],c);o&&o.outlet&&(o.outlet.deactivate(),o.children.onOutletDeactivated(),o.attachRef=null,o.resolver=null,o.route=null)}activateChildRoutes(e,t,o){const c=lR(t);e.children.forEach(u=>{this.activateRoutes(u,c[u.value.outlet],o),this.forwardEvent(new DH(u.value.snapshot))}),e.children.length&&this.forwardEvent(new wH(e.value.snapshot))}activateRoutes(e,t,o){const c=e.value,u=t?t.value:null;if(CF(c),c===u)if(c.component){const p=o.getOrCreateContext(c.outlet);this.activateChildRoutes(e,t,p.children)}else this.activateChildRoutes(e,t,o);else if(c.component){const p=o.getOrCreateContext(c.outlet);if(this.routeReuseStrategy.shouldAttach(c.snapshot)){const _=this.routeReuseStrategy.retrieve(c.snapshot);this.routeReuseStrategy.store(c.snapshot,null),p.children.onOutletReAttached(_.contexts),p.attachRef=_.componentRef,p.route=_.route.value,p.outlet&&p.outlet.attach(_.componentRef,_.route.value),oj(_.route)}else{const _=function(n){for(let e=n.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig;if(t&&t.component)return null}return null}(c.snapshot),v=_?_.module.componentFactoryResolver:null;p.attachRef=null,p.route=c,p.resolver=v,p.outlet&&p.outlet.activateWith(c,v),this.activateChildRoutes(e,null,p.children)}}else this.activateChildRoutes(e,null,o)}}function oj(n){CF(n.value),n.children.forEach(oj)}class IF{constructor(e,t){this.routes=e,this.module=t}}function Up(n){return"function"==typeof n}function gm(n){return n instanceof fm}const uR=Symbol("INITIAL_VALUE");function hR(){return td(n=>bB(n.map(e=>e.pipe(Ao(1),hm(uR)))).pipe(wB((e,t)=>{let o=!1;return t.reduce((c,u,p)=>c!==uR?c:(u===uR&&(o=!0),o||!1!==u&&p!==t.length-1&&!gm(u)?c:u),e)},uR),xp(e=>e!==uR),Cn(e=>gm(e)?e:!0===e),Ao(1)))}let sj=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=ki({type:n,selectors:[["ng-component"]],decls:1,vars:0,template:function(t,o){1&t&&Ue(0,"router-outlet")},directives:function(){return[MF]},encapsulation:2}),n})();function aj(n,e=""){for(let t=0;t<n.length;t++){const o=n[t];mG(o,gG(e,o))}}function mG(n,e){n.children&&aj(n.children,e)}function gG(n,e){return e?n||e.path?n&&!e.path?`${n}/`:!n&&e.path?e.path:`${n}/${e.path}`:"":n}function wF(n){const e=n.children&&n.children.map(wF),t=e?Object.assign(Object.assign({},n),{children:e}):Object.assign({},n);return!t.component&&(e||t.loadChildren)&&t.outlet&&t.outlet!==cn&&(t.component=sj),t}function nc(n){return n.outlet||cn}function cj(n,e){const t=n.filter(o=>nc(o)===e);return t.push(...n.filter(o=>nc(o)!==e)),t}const lj={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function TP(n,e,t){var o;if(""===e.path)return"full"===e.pathMatch&&(n.hasChildren()||t.length>0)?Object.assign({},lj):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const u=(e.matcher||PH)(t,n,e);if(!u)return Object.assign({},lj);const p={};ho(u.posParams,(v,S)=>{p[S]=v.path});const _=u.consumed.length>0?Object.assign(Object.assign({},p),u.consumed[u.consumed.length-1].parameters):p;return{matched:!0,consumedSegments:u.consumed,lastChild:u.consumed.length,parameters:_,positionalParamSegments:null!==(o=u.posParams)&&void 0!==o?o:{}}}function bP(n,e,t,o,c="corrected"){if(t.length>0&&function(n,e,t){return t.some(o=>RP(n,e,o)&&nc(o)!==cn)}(n,t,o)){const p=new gn(e,function(n,e,t,o){const c={};c[cn]=o,o._sourceSegment=n,o._segmentIndexShift=e.length;for(const u of t)if(""===u.path&&nc(u)!==cn){const p=new gn([],{});p._sourceSegment=n,p._segmentIndexShift=e.length,c[nc(u)]=p}return c}(n,e,o,new gn(t,n.children)));return p._sourceSegment=n,p._segmentIndexShift=e.length,{segmentGroup:p,slicedSegments:[]}}if(0===t.length&&function(n,e,t){return t.some(o=>RP(n,e,o))}(n,t,o)){const p=new gn(n.segments,function(n,e,t,o,c,u){const p={};for(const _ of o)if(RP(n,t,_)&&!c[nc(_)]){const v=new gn([],{});v._sourceSegment=n,v._segmentIndexShift="legacy"===u?n.segments.length:e.length,p[nc(_)]=v}return Object.assign(Object.assign({},c),p)}(n,e,t,o,n.children,c));return p._sourceSegment=n,p._segmentIndexShift=e.length,{segmentGroup:p,slicedSegments:t}}const u=new gn(n.segments,n.children);return u._sourceSegment=n,u._segmentIndexShift=e.length,{segmentGroup:u,slicedSegments:t}}function RP(n,e,t){return(!(n.hasChildren()||e.length>0)||"full"!==t.pathMatch)&&""===t.path}function dj(n,e,t,o){return!!(nc(n)===o||o!==cn&&RP(e,t,n))&&("**"===n.path||TP(e,n,t).matched)}function uj(n,e,t){return 0===e.length&&!n.children[t]}class pR{constructor(e){this.segmentGroup=e||null}}class hj{constructor(e){this.urlTree=e}}function IP(n){return new tn(e=>e.error(new pR(n)))}function pj(n){return new tn(e=>e.error(new hj(n)))}function SG(n){return new tn(e=>e.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${n}'`)))}class RG{constructor(e,t,o,c,u){this.configLoader=t,this.urlSerializer=o,this.urlTree=c,this.config=u,this.allowRedirects=!0,this.ngModule=e.get(bs)}apply(){const e=bP(this.urlTree.root,[],[],this.config).segmentGroup,t=new gn(e.segments,e.children);return this.expandSegmentGroup(this.ngModule,this.config,t,cn).pipe(Cn(u=>this.createUrlTree(AF(u),this.urlTree.queryParams,this.urlTree.fragment))).pipe(pm(u=>{if(u instanceof hj)return this.allowRedirects=!1,this.match(u.urlTree);throw u instanceof pR?this.noMatchError(u):u}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,cn).pipe(Cn(c=>this.createUrlTree(AF(c),e.queryParams,e.fragment))).pipe(pm(c=>{throw c instanceof pR?this.noMatchError(c):c}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,t,o){const c=e.segments.length>0?new gn([],{[cn]:e}):e;return new fm(c,t,o)}expandSegmentGroup(e,t,o,c){return 0===o.segments.length&&o.hasChildren()?this.expandChildren(e,t,o).pipe(Cn(u=>new gn([],u))):this.expandSegment(e,o,t,o.segments,c,!0)}expandChildren(e,t,o){const c=[];for(const u of Object.keys(o.children))"primary"===u?c.unshift(u):c.push(u);return lr(c).pipe(oR(u=>{const p=o.children[u],_=cj(t,u);return this.expandSegmentGroup(e,_,p,u).pipe(Cn(v=>({segment:v,outlet:u})))}),wB((u,p)=>(u[p.outlet]=p.segment,u),{}),function(n,e){const t=arguments.length>=2;return o=>o.pipe(n?xp((c,u)=>n(c,u,o)):qp,pF(1),t?DB(e):AB(()=>new uP))}())}expandSegment(e,t,o,c,u,p){return lr(o).pipe(oR(_=>this.expandSegmentAgainstRoute(e,t,o,_,c,u,p).pipe(pm(S=>{if(S instanceof pR)return Ct(null);throw S}))),ky(_=>!!_),pm((_,v)=>{if(_ instanceof uP||"EmptyError"===_.name){if(uj(t,c,u))return Ct(new gn([],{}));throw new pR(t)}throw _}))}expandSegmentAgainstRoute(e,t,o,c,u,p,_){return dj(c,t,u,p)?void 0===c.redirectTo?this.matchSegmentAgainstRoute(e,t,c,u,p):_&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,o,c,u,p):IP(t):IP(t)}expandSegmentAgainstRouteUsingRedirect(e,t,o,c,u,p){return"**"===c.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,o,c,p):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,o,c,u,p)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,o,c){const u=this.applyRedirectCommands([],o.redirectTo,{});return o.redirectTo.startsWith("/")?pj(u):this.lineralizeSegments(o,u).pipe(Gi(p=>{const _=new gn(p,{});return this.expandSegment(e,_,t,p,c,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,o,c,u,p){const{matched:_,consumedSegments:v,lastChild:S,positionalParamSegments:w}=TP(t,c,u);if(!_)return IP(t);const M=this.applyRedirectCommands(v,c.redirectTo,w);return c.redirectTo.startsWith("/")?pj(M):this.lineralizeSegments(c,M).pipe(Gi(F=>this.expandSegment(e,t,o,F.concat(u.slice(S)),p,!1)))}matchSegmentAgainstRoute(e,t,o,c,u){if("**"===o.path)return o.loadChildren?(o._loadedConfig?Ct(o._loadedConfig):this.configLoader.load(e.injector,o)).pipe(Cn(F=>(o._loadedConfig=F,new gn(c,{})))):Ct(new gn(c,{}));const{matched:p,consumedSegments:_,lastChild:v}=TP(t,o,c);if(!p)return IP(t);const S=c.slice(v);return this.getChildConfig(e,o,c).pipe(Gi(M=>{const F=M.module,j=M.routes,{segmentGroup:W,slicedSegments:ee}=bP(t,_,S,j),$=new gn(W.segments,W.children);if(0===ee.length&&$.hasChildren())return this.expandChildren(F,j,$).pipe(Cn(Le=>new gn(_,Le)));if(0===j.length&&0===ee.length)return Ct(new gn(_,{}));const pe=nc(o)===u;return this.expandSegment(F,$,j,ee,pe?cn:u,!0).pipe(Cn(De=>new gn(_.concat(De.segments),De.children)))}))}getChildConfig(e,t,o){return t.children?Ct(new IF(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?Ct(t._loadedConfig):this.runCanLoadGuards(e.injector,t,o).pipe(Gi(c=>c?this.configLoader.load(e.injector,t).pipe(Cn(u=>(t._loadedConfig=u,u))):function(n){return new tn(e=>e.error(_F(`Cannot load children because the guard of the route "path: '${n.path}'" returned false`)))}(t))):Ct(new IF([],e))}runCanLoadGuards(e,t,o){const c=t.canLoad;if(!c||0===c.length)return Ct(!0);const u=c.map(p=>{const _=e.get(p);let v;if(function(n){return n&&Up(n.canLoad)}(_))v=_.canLoad(t,o);else{if(!Up(_))throw new Error("Invalid CanLoad guard");v=_(t,o)}return id(v)});return Ct(u).pipe(hR(),cs(p=>{if(!gm(p))return;const _=_F(`Redirecting to "${this.urlSerializer.serialize(p)}"`);throw _.url=p,_}),Cn(p=>!0===p))}lineralizeSegments(e,t){let o=[],c=t.root;for(;;){if(o=o.concat(c.segments),0===c.numberOfChildren)return Ct(o);if(c.numberOfChildren>1||!c.children[cn])return SG(e.redirectTo);c=c.children[cn]}}applyRedirectCommands(e,t,o){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,o)}applyRedirectCreatreUrlTree(e,t,o,c){const u=this.createSegmentGroup(e,t.root,o,c);return new fm(u,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const o={};return ho(e,(c,u)=>{if("string"==typeof c&&c.startsWith(":")){const _=c.substring(1);o[u]=t[_]}else o[u]=c}),o}createSegmentGroup(e,t,o,c){const u=this.createSegments(e,t.segments,o,c);let p={};return ho(t.children,(_,v)=>{p[v]=this.createSegmentGroup(e,_,o,c)}),new gn(u,p)}createSegments(e,t,o,c){return t.map(u=>u.path.startsWith(":")?this.findPosParam(e,u,c):this.findOrReturn(u,o))}findPosParam(e,t,o){const c=o[t.path.substring(1)];if(!c)throw new Error(`Cannot redirect to '${e}'. Cannot find '${t.path}'.`);return c}findOrReturn(e,t){let o=0;for(const c of t){if(c.path===e.path)return t.splice(o),c;o++}return e}}function AF(n){const e={};for(const o of Object.keys(n.children)){const u=AF(n.children[o]);(u.segments.length>0||u.hasChildren())&&(e[o]=u)}return function(n){if(1===n.numberOfChildren&&n.children[cn]){const e=n.children[cn];return new gn(n.segments.concat(e.segments),e.children)}return n}(new gn(n.segments,e))}class fj{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class wP{constructor(e,t){this.component=e,this.route=t}}function AG(n,e,t){const o=n._root;return fR(o,e?e._root:null,t,[o.value])}function AP(n,e,t){const o=function(n){if(!n)return null;for(let e=n.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig}return null}(e);return(o?o.module.injector:t).get(n)}function fR(n,e,t,o,c={canDeactivateChecks:[],canActivateChecks:[]}){const u=lR(e);return n.children.forEach(p=>{(function(n,e,t,o,c={canDeactivateChecks:[],canActivateChecks:[]}){const u=n.value,p=e?e.value:null,_=t?t.getContext(n.value.outlet):null;if(p&&u.routeConfig===p.routeConfig){const v=function(n,e,t){if("function"==typeof t)return t(n,e);switch(t){case"pathParamsChange":return!_m(n.url,e.url);case"pathParamsOrQueryParamsChange":return!_m(n.url,e.url)||!nd(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!SF(n,e)||!nd(n.queryParams,e.queryParams);default:return!SF(n,e)}}(p,u,u.routeConfig.runGuardsAndResolvers);v?c.canActivateChecks.push(new fj(o)):(u.data=p.data,u._resolvedData=p._resolvedData),fR(n,e,u.component?_?_.children:null:t,o,c),v&&_&&_.outlet&&_.outlet.isActivated&&c.canDeactivateChecks.push(new wP(_.outlet.component,p))}else p&&_R(e,_,c),c.canActivateChecks.push(new fj(o)),fR(n,null,u.component?_?_.children:null:t,o,c)})(p,u[p.value.outlet],t,o.concat([p.value]),c),delete u[p.value.outlet]}),ho(u,(p,_)=>_R(p,t.getContext(_),c)),c}function _R(n,e,t){const o=lR(n),c=n.value;ho(o,(u,p)=>{_R(u,c.component?e?e.children.getContext(p):null:e,t)}),t.canDeactivateChecks.push(new wP(c.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,c))}class jG{}function _j(n){return new tn(e=>e.error(n))}class GG{constructor(e,t,o,c,u,p){this.rootComponentType=e,this.config=t,this.urlTree=o,this.url=c,this.paramsInheritanceStrategy=u,this.relativeLinkResolution=p}recognize(){const e=bP(this.urlTree.root,[],[],this.config.filter(p=>void 0===p.redirectTo),this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,cn);if(null===t)return null;const o=new yP([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},cn,this.rootComponentType,null,this.urlTree.root,-1,{}),c=new Mu(o,t),u=new XB(this.url,c);return this.inheritParamsAndData(u._root),u}inheritParamsAndData(e){const t=e.value,o=JB(t,this.paramsInheritanceStrategy);t.params=Object.freeze(o.params),t.data=Object.freeze(o.data),e.children.forEach(c=>this.inheritParamsAndData(c))}processSegmentGroup(e,t,o){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,o)}processChildren(e,t){const o=[];for(const u of Object.keys(t.children)){const p=t.children[u],_=cj(e,u),v=this.processSegmentGroup(_,p,u);if(null===v)return null;o.push(...v)}const c=mj(o);return function(n){n.sort((e,t)=>e.value.outlet===cn?-1:t.value.outlet===cn?1:e.value.outlet.localeCompare(t.value.outlet))}(c),c}processSegment(e,t,o,c){for(const u of e){const p=this.processSegmentAgainstRoute(u,t,o,c);if(null!==p)return p}return uj(t,o,c)?[]:null}processSegmentAgainstRoute(e,t,o,c){if(e.redirectTo||!dj(e,t,o,c))return null;let u,p=[],_=[];if("**"===e.path){const j=o.length>0?FB(o).parameters:{};u=new yP(o,j,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,yj(e),nc(e),e.component,e,gj(t),Ej(t)+o.length,vj(e))}else{const j=TP(t,e,o);if(!j.matched)return null;p=j.consumedSegments,_=o.slice(j.lastChild),u=new yP(p,j.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,yj(e),nc(e),e.component,e,gj(t),Ej(t)+p.length,vj(e))}const v=function(n){return n.children?n.children:n.loadChildren?n._loadedConfig.routes:[]}(e),{segmentGroup:S,slicedSegments:w}=bP(t,p,_,v.filter(j=>void 0===j.redirectTo),this.relativeLinkResolution);if(0===w.length&&S.hasChildren()){const j=this.processChildren(v,S);return null===j?null:[new Mu(u,j)]}if(0===v.length&&0===w.length)return[new Mu(u,[])];const M=nc(e)===c,F=this.processSegment(v,S,w,M?cn:c);return null===F?null:[new Mu(u,F)]}}function qG(n){const e=n.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function mj(n){const e=[],t=new Set;for(const o of n){if(!qG(o)){e.push(o);continue}const c=e.find(u=>o.value.routeConfig===u.value.routeConfig);void 0!==c?(c.children.push(...o.children),t.add(c)):e.push(o)}for(const o of t){const c=mj(o.children);e.push(new Mu(o.value,c))}return e.filter(o=>!t.has(o))}function gj(n){let e=n;for(;e._sourceSegment;)e=e._sourceSegment;return e}function Ej(n){let e=n,t=e._segmentIndexShift?e._segmentIndexShift:0;for(;e._sourceSegment;)e=e._sourceSegment,t+=e._segmentIndexShift?e._segmentIndexShift:0;return t-1}function yj(n){return n.data||{}}function vj(n){return n.resolve||{}}function DF(n){return td(e=>{const t=n(e);return t?lr(t).pipe(Cn(()=>e)):Ct(e)})}class eW extends class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}{}const OF=new je("ROUTES");class Cj{constructor(e,t,o,c){this.loader=e,this.compiler=t,this.onLoadStartListener=o,this.onLoadEndListener=c}load(e,t){if(t._loader$)return t._loader$;this.onLoadStartListener&&this.onLoadStartListener(t);const c=this.loadModuleFactory(t.loadChildren).pipe(Cn(u=>{this.onLoadEndListener&&this.onLoadEndListener(t);const p=u.create(e);return new IF(xB(p.injector.get(OF,void 0,et.Self|et.Optional)).map(wF),p)}),pm(u=>{throw t._loader$=void 0,u}));return t._loader$=new av(c,()=>new xt).pipe(gi()),t._loader$}loadModuleFactory(e){return"string"==typeof e?lr(this.loader.load(e)):id(e()).pipe(Gi(t=>t instanceof CD?Ct(t):lr(this.compiler.compileModuleAsync(t))))}}class tW{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new xy,this.attachRef=null}}class xy{constructor(){this.contexts=new Map}onChildOutletCreated(e,t){const o=this.getOrCreateContext(e);o.outlet=t,this.contexts.set(e,o)}onChildOutletDestroyed(e){const t=this.getContext(e);t&&(t.outlet=null,t.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let t=this.getContext(e);return t||(t=new tW,this.contexts.set(e,t)),t}getContext(e){return this.contexts.get(e)||null}}class iW{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,t){return e}}function rW(n){throw n}function oW(n,e,t){return e.parse("/")}function Sj(n,e){return Ct(null)}const sW={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},aW={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Do=(()=>{class n{constructor(t,o,c,u,p,_,v,S){this.rootComponentType=t,this.urlSerializer=o,this.rootContexts=c,this.location=u,this.config=S,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.lastLocationChangeInfo=null,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new xt,this.errorHandler=rW,this.malformedUriErrorHandler=oW,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:Sj,afterPreactivation:Sj},this.urlHandlingStrategy=new iW,this.routeReuseStrategy=new eW,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=p.get(bs),this.console=p.get(jl);const F=p.get(nt);this.isNgZoneEnabled=F instanceof nt&&nt.isInAngularZone(),this.resetConfig(S),this.currentUrlTree=new fm(new gn([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new Cj(_,v,j=>this.triggerEvent(new NB(j)),j=>this.triggerEvent(new PB(j))),this.routerState=$B(this.currentUrlTree,this.rootComponentType),this.transitions=new Vs({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var t;return null===(t=this.location.getState())||void 0===t?void 0:t.\u0275routerPageId}setupNavigations(t){const o=this.events;return t.pipe(xp(c=>0!==c.id),Cn(c=>Object.assign(Object.assign({},c),{extractedUrl:this.urlHandlingStrategy.extract(c.rawUrl)})),td(c=>{let u=!1,p=!1;return Ct(c).pipe(cs(_=>{this.currentNavigation={id:_.id,initialUrl:_.currentRawUrl,extractedUrl:_.extractedUrl,trigger:_.source,extras:_.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),td(_=>{const v=this.browserUrlTree.toString(),S=!this.navigated||_.extractedUrl.toString()!==v||v!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||S)&&this.urlHandlingStrategy.shouldProcessUrl(_.rawUrl))return DP(_.source)&&(this.browserUrlTree=_.extractedUrl),Ct(_).pipe(td(M=>{const F=this.transitions.getValue();return o.next(new fF(M.id,this.serializeUrl(M.extractedUrl),M.source,M.restoredState)),F!==this.transitions.getValue()?um:Promise.resolve(M)}),function(n,e,t,o){return td(c=>function(n,e,t,o,c){return new RG(n,e,t,o,c).apply()}(n,e,t,c.extractedUrl,o).pipe(Cn(u=>Object.assign(Object.assign({},c),{urlAfterRedirects:u}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),cs(M=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:M.urlAfterRedirects})}),function(n,e,t,o,c){return Gi(u=>function(n,e,t,o,c="emptyOnly",u="legacy"){try{const p=new GG(n,e,t,o,c,u).recognize();return null===p?_j(new jG):Ct(p)}catch(p){return _j(p)}}(n,e,u.urlAfterRedirects,t(u.urlAfterRedirects),o,c).pipe(Cn(p=>Object.assign(Object.assign({},u),{targetSnapshot:p}))))}(this.rootComponentType,this.config,M=>this.serializeUrl(M),this.paramsInheritanceStrategy,this.relativeLinkResolution),cs(M=>{"eager"===this.urlUpdateStrategy&&(M.extras.skipLocationChange||this.setBrowserUrl(M.urlAfterRedirects,M),this.browserUrlTree=M.urlAfterRedirects);const F=new CH(M.id,this.serializeUrl(M.extractedUrl),this.serializeUrl(M.urlAfterRedirects),M.targetSnapshot);o.next(F)}));if(S&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:F,extractedUrl:j,source:W,restoredState:ee,extras:$}=_,pe=new fF(F,this.serializeUrl(j),W,ee);o.next(pe);const le=$B(j,this.rootComponentType).snapshot;return Ct(Object.assign(Object.assign({},_),{targetSnapshot:le,urlAfterRedirects:j,extras:Object.assign(Object.assign({},$),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=_.rawUrl,this.browserUrlTree=_.urlAfterRedirects,_.resolve(null),um}),DF(_=>{const{targetSnapshot:v,id:S,extractedUrl:w,rawUrl:M,extras:{skipLocationChange:F,replaceUrl:j}}=_;return this.hooks.beforePreactivation(v,{navigationId:S,appliedUrlTree:w,rawUrlTree:M,skipLocationChange:!!F,replaceUrl:!!j})}),cs(_=>{const v=new SH(_.id,this.serializeUrl(_.extractedUrl),this.serializeUrl(_.urlAfterRedirects),_.targetSnapshot);this.triggerEvent(v)}),Cn(_=>Object.assign(Object.assign({},_),{guards:AG(_.targetSnapshot,_.currentSnapshot,this.rootContexts)})),function(n,e){return Gi(t=>{const{targetSnapshot:o,currentSnapshot:c,guards:{canActivateChecks:u,canDeactivateChecks:p}}=t;return 0===p.length&&0===u.length?Ct(Object.assign(Object.assign({},t),{guardsResult:!0})):function(n,e,t,o){return lr(n).pipe(Gi(c=>function(n,e,t,o,c){const u=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return u&&0!==u.length?Ct(u.map(_=>{const v=AP(_,e,c);let S;if(function(n){return n&&Up(n.canDeactivate)}(v))S=id(v.canDeactivate(n,e,t,o));else{if(!Up(v))throw new Error("Invalid CanDeactivate guard");S=id(v(n,e,t,o))}return S.pipe(ky())})).pipe(hR()):Ct(!0)}(c.component,c.route,t,e,o)),ky(c=>!0!==c,!0))}(p,o,c,n).pipe(Gi(_=>_&&function(n){return"boolean"==typeof n}(_)?function(n,e,t,o){return lr(e).pipe(oR(c=>hP(function(n,e){return null!==n&&e&&e(new IH(n)),Ct(!0)}(c.route.parent,o),function(n,e){return null!==n&&e&&e(new AH(n)),Ct(!0)}(c.route,o),function(n,e,t){const o=e[e.length-1],u=e.slice(0,e.length-1).reverse().map(p=>function(n){const e=n.routeConfig?n.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:n,guards:e}:null}(p)).filter(p=>null!==p).map(p=>RB(()=>Ct(p.guards.map(v=>{const S=AP(v,p.node,t);let w;if(function(n){return n&&Up(n.canActivateChild)}(S))w=id(S.canActivateChild(o,n));else{if(!Up(S))throw new Error("Invalid CanActivateChild guard");w=id(S(o,n))}return w.pipe(ky())})).pipe(hR())));return Ct(u).pipe(hR())}(n,c.path,t),function(n,e,t){const o=e.routeConfig?e.routeConfig.canActivate:null;if(!o||0===o.length)return Ct(!0);const c=o.map(u=>RB(()=>{const p=AP(u,e,t);let _;if(function(n){return n&&Up(n.canActivate)}(p))_=id(p.canActivate(e,n));else{if(!Up(p))throw new Error("Invalid CanActivate guard");_=id(p(e,n))}return _.pipe(ky())}));return Ct(c).pipe(hR())}(n,c.route,t))),ky(c=>!0!==c,!0))}(o,u,n,e):Ct(_)),Cn(_=>Object.assign(Object.assign({},t),{guardsResult:_})))})}(this.ngModule.injector,_=>this.triggerEvent(_)),cs(_=>{if(gm(_.guardsResult)){const S=_F(`Redirecting to "${this.serializeUrl(_.guardsResult)}"`);throw S.url=_.guardsResult,S}const v=new TH(_.id,this.serializeUrl(_.extractedUrl),this.serializeUrl(_.urlAfterRedirects),_.targetSnapshot,!!_.guardsResult);this.triggerEvent(v)}),xp(_=>!!_.guardsResult||(this.restoreHistory(_),this.cancelNavigationTransition(_,""),!1)),DF(_=>{if(_.guards.canActivateChecks.length)return Ct(_).pipe(cs(v=>{const S=new bH(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot);this.triggerEvent(S)}),td(v=>{let S=!1;return Ct(v).pipe(function(n,e){return Gi(t=>{const{targetSnapshot:o,guards:{canActivateChecks:c}}=t;if(!c.length)return Ct(t);let u=0;return lr(c).pipe(oR(p=>function(n,e,t,o){return function(n,e,t,o){const c=Object.keys(n);if(0===c.length)return Ct({});const u={};return lr(c).pipe(Gi(p=>function(n,e,t,o){const c=AP(n,e,o);return id(c.resolve?c.resolve(e,t):c(e,t))}(n[p],e,t,o).pipe(cs(_=>{u[p]=_}))),pF(1),Gi(()=>Object.keys(u).length===c.length?Ct(u):um))}(n._resolve,n,e,o).pipe(Cn(u=>(n._resolvedData=u,n.data=Object.assign(Object.assign({},n.data),JB(n,t).resolve),null)))}(p.route,o,n,e)),cs(()=>u++),pF(1),Gi(p=>u===c.length?Ct(t):um))})}(this.paramsInheritanceStrategy,this.ngModule.injector),cs({next:()=>S=!0,complete:()=>{S||(this.restoreHistory(v),this.cancelNavigationTransition(v,"At least one route resolver didn't emit any value."))}}))}),cs(v=>{const S=new RH(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot);this.triggerEvent(S)}))}),DF(_=>{const{targetSnapshot:v,id:S,extractedUrl:w,rawUrl:M,extras:{skipLocationChange:F,replaceUrl:j}}=_;return this.hooks.afterPreactivation(v,{navigationId:S,appliedUrlTree:w,rawUrlTree:M,skipLocationChange:!!F,replaceUrl:!!j})}),Cn(_=>{const v=function(n,e,t){const o=vP(n,e._root,t?t._root:void 0);return new YB(o,e)}(this.routeReuseStrategy,_.targetSnapshot,_.currentRouterState);return Object.assign(Object.assign({},_),{targetRouterState:v})}),cs(_=>{this.currentUrlTree=_.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(_.urlAfterRedirects,_.rawUrl),this.routerState=_.targetRouterState,"deferred"===this.urlUpdateStrategy&&(_.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,_),this.browserUrlTree=_.urlAfterRedirects)}),((n,e,t)=>Cn(o=>(new lG(e,o.targetRouterState,o.currentRouterState,t).activate(n),o)))(this.rootContexts,this.routeReuseStrategy,_=>this.triggerEvent(_)),cs({next(){u=!0},complete(){u=!0}}),function(n){return e=>e.lift(new EH(n))}(()=>{var _;if(!u&&!p){const v=`Navigation ID ${c.id} is not equal to the current navigation id ${this.navigationId}`;"replace"===this.canceledNavigationResolution?(this.restoreHistory(c),this.cancelNavigationTransition(c,v)):this.cancelNavigationTransition(c,v)}(null===(_=this.currentNavigation)||void 0===_?void 0:_.id)===c.id&&(this.currentNavigation=null)}),pm(_=>{if(p=!0,function(n){return n&&n[kB]}(_)){const v=gm(_.url);v||(this.navigated=!0,this.restoreHistory(c,!0));const S=new OB(c.id,this.serializeUrl(c.extractedUrl),_.message);o.next(S),v?setTimeout(()=>{const w=this.urlHandlingStrategy.merge(_.url,this.rawUrlTree),M={skipLocationChange:c.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||DP(c.source)};this.scheduleNavigation(w,"imperative",null,M,{resolve:c.resolve,reject:c.reject,promise:c.promise})},0):c.resolve(!1)}else{this.restoreHistory(c,!0);const v=new vH(c.id,this.serializeUrl(c.extractedUrl),_);o.next(v);try{c.resolve(this.errorHandler(_))}catch(S){c.reject(S)}}return um}))}))}resetRootComponentType(t){this.rootComponentType=t,this.routerState.root.component=this.rootComponentType}getTransition(){const t=this.transitions.value;return t.urlAfterRedirects=this.browserUrlTree,t}setTransition(t){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),t))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const o=this.extractLocationChangeInfoFromEvent(t);this.shouldScheduleNavigation(this.lastLocationChangeInfo,o)&&setTimeout(()=>{const{source:c,state:u,urlTree:p}=o,_={replaceUrl:!0};if(u){const v=Object.assign({},u);delete v.navigationId,delete v.\u0275routerPageId,0!==Object.keys(v).length&&(_.state=v)}this.scheduleNavigation(p,c,u,_)},0),this.lastLocationChangeInfo=o}))}extractLocationChangeInfoFromEvent(t){var o;return{source:"popstate"===t.type?"popstate":"hashchange",urlTree:this.parseUrl(t.url),state:(null===(o=t.state)||void 0===o?void 0:o.navigationId)?t.state:null,transitionId:this.getTransition().id}}shouldScheduleNavigation(t,o){if(!t)return!0;const c=o.urlTree.toString()===t.urlTree.toString();return o.transitionId!==t.transitionId||!c||!("hashchange"===o.source&&"popstate"===t.source||"popstate"===o.source&&"hashchange"===t.source)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(t){this.events.next(t)}resetConfig(t){aj(t),this.config=t.map(wF),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(t,o={}){const{relativeTo:c,queryParams:u,fragment:p,queryParamsHandling:_,preserveFragment:v}=o,S=c||this.routerState.root,w=v?this.currentUrlTree.fragment:p;let M=null;switch(_){case"merge":M=Object.assign(Object.assign({},this.currentUrlTree.queryParams),u);break;case"preserve":M=this.currentUrlTree.queryParams;break;default:M=u||null}return null!==M&&(M=this.removeEmptyProps(M)),function(n,e,t,o,c){if(0===t.length)return TF(e.root,e.root,e,o,c);const u=function(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new tj(!0,0,n);let e=0,t=!1;const o=n.reduce((c,u,p)=>{if("object"==typeof u&&null!=u){if(u.outlets){const _={};return ho(u.outlets,(v,S)=>{_[S]="string"==typeof v?v.split("/"):v}),[...c,{outlets:_}]}if(u.segmentPath)return[...c,u.segmentPath]}return"string"!=typeof u?[...c,u]:0===p?(u.split("/").forEach((_,v)=>{0==v&&"."===_||(0==v&&""===_?t=!0:".."===_?e++:""!=_&&c.push(_))}),c):[...c,u]},[]);return new tj(t,e,o)}(t);if(u.toRoot())return TF(e.root,new gn([],{}),e,o,c);const p=function(n,e,t){if(n.isAbsolute)return new bF(e.root,!0,0);if(-1===t.snapshot._lastPathIndex){const u=t.snapshot._urlSegment;return new bF(u,u===e.root,0)}const o=CP(n.commands[0])?0:1;return function(n,e,t){let o=n,c=e,u=t;for(;u>c;){if(u-=c,o=o.parent,!o)throw new Error("Invalid number of '../'");c=o.segments.length}return new bF(o,!1,c-u)}(t.snapshot._urlSegment,t.snapshot._lastPathIndex+o,n.numberOfDoubleDots)}(u,e,n),_=p.processChildren?SP(p.segmentGroup,p.index,u.commands):nj(p.segmentGroup,p.index,u.commands);return TF(p.segmentGroup,_,e,o,c)}(S,this.currentUrlTree,t,M,null!=w?w:null)}navigateByUrl(t,o={skipLocationChange:!1}){const c=gm(t)?t:this.parseUrl(t),u=this.urlHandlingStrategy.merge(c,this.rawUrlTree);return this.scheduleNavigation(u,"imperative",null,o)}navigate(t,o={skipLocationChange:!1}){return function(n){for(let e=0;e<n.length;e++){const t=n[e];if(null==t)throw new Error(`The requested path contains ${t} segment at index ${e}`)}}(t),this.navigateByUrl(this.createUrlTree(t,o),o)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let o;try{o=this.urlSerializer.parse(t)}catch(c){o=this.malformedUriErrorHandler(c,this.urlSerializer,t)}return o}isActive(t,o){let c;if(c=!0===o?Object.assign({},sW):!1===o?Object.assign({},aW):o,gm(t))return VB(this.currentUrlTree,t,c);const u=this.parseUrl(t);return VB(this.currentUrlTree,u,c)}removeEmptyProps(t){return Object.keys(t).reduce((o,c)=>{const u=t[c];return null!=u&&(o[c]=u),o},{})}processNavigations(){this.navigations.subscribe(t=>{this.navigated=!0,this.lastSuccessfulId=t.id,this.currentPageId=t.targetPageId,this.events.next(new sR(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,t.resolve(!0)},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)})}scheduleNavigation(t,o,c,u,p){var _,v;if(this.disposed)return Promise.resolve(!1);const S=this.getTransition(),w=DP(o)&&S&&!DP(S.source),j=(this.lastSuccessfulId===S.id||this.currentNavigation?S.rawUrl:S.urlAfterRedirects).toString()===t.toString();if(w&&j)return Promise.resolve(!0);let W,ee,$;p?(W=p.resolve,ee=p.reject,$=p.promise):$=new Promise((De,Le)=>{W=De,ee=Le});const pe=++this.navigationId;let le;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(c=this.location.getState()),le=c&&c.\u0275routerPageId?c.\u0275routerPageId:u.replaceUrl||u.skipLocationChange?null!==(_=this.browserPageId)&&void 0!==_?_:0:(null!==(v=this.browserPageId)&&void 0!==v?v:0)+1):le=0,this.setTransition({id:pe,targetPageId:le,source:o,restoredState:c,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:t,extras:u,resolve:W,reject:ee,promise:$,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),$.catch(De=>Promise.reject(De))}setBrowserUrl(t,o){const c=this.urlSerializer.serialize(t),u=Object.assign(Object.assign({},o.extras.state),this.generateNgRouterState(o.id,o.targetPageId));this.location.isCurrentPathEqualTo(c)||o.extras.replaceUrl?this.location.replaceState(c,"",u):this.location.go(c,"",u)}restoreHistory(t,o=!1){var c,u;if("computed"===this.canceledNavigationResolution){const p=this.currentPageId-t.targetPageId;"popstate"!==t.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(c=this.currentNavigation)||void 0===c?void 0:c.finalUrl)||0===p?this.currentUrlTree===(null===(u=this.currentNavigation)||void 0===u?void 0:u.finalUrl)&&0===p&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(p)}else"replace"===this.canceledNavigationResolution&&(o&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(t,o){const c=new OB(t.id,this.serializeUrl(t.extractedUrl),o);this.triggerEvent(c),t.resolve(!1)}generateNgRouterState(t,o){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:o}:{navigationId:t}}}return n.\u0275fac=function(t){return new(t||n)(ie(Sd),ie(mF),ie(xy),ie(Bi),ie(An),ie(Yr),ie(Hl),ie(void 0))},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})();function DP(n){return"imperative"!==n}let MF=(()=>{class n{constructor(t,o,c,u,p){this.parentContexts=t,this.location=o,this.resolver=c,this.changeDetector=p,this.activated=null,this._activatedRoute=null,this.activateEvents=new ft,this.deactivateEvents=new ft,this.name=u||cn,t.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const t=this.parentContexts.getContext(this.name);t&&t.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,t}attach(t,o){this.activated=t,this._activatedRoute=o,this.location.insert(t.hostView)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,o){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=t;const p=(o=o||this.resolver).resolveComponentFactory(t._futureSnapshot.routeConfig.component),_=this.parentContexts.getOrCreateContext(this.name).children,v=new uW(t,_,this.location.injector);this.activated=this.location.createComponent(p,this.location.length,v),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(t){return new(t||n)(Y(xy),Y(_r),Y(aa),fc("name"),Y(zo))},n.\u0275dir=Ae({type:n,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),n})();class uW{constructor(e,t,o){this.route=e,this.childContexts=t,this.parent=o}get(e,t){return e===mm?this.route:e===xy?this.childContexts:this.parent.get(e,t)}}class Tj{}class bj{preload(e,t){return Ct(null)}}let Rj=(()=>{class n{constructor(t,o,c,u,p){this.router=t,this.injector=u,this.preloadingStrategy=p,this.loader=new Cj(o,c,S=>t.triggerEvent(new NB(S)),S=>t.triggerEvent(new PB(S)))}setUpPreloading(){this.subscription=this.router.events.pipe(xp(t=>t instanceof sR),oR(()=>this.preload())).subscribe(()=>{})}preload(){const t=this.injector.get(bs);return this.processRoutes(t,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,o){const c=[];for(const u of o)if(u.loadChildren&&!u.canLoad&&u._loadedConfig){const p=u._loadedConfig;c.push(this.processRoutes(p.module,p.routes))}else u.loadChildren&&!u.canLoad?c.push(this.preloadConfig(t,u)):u.children&&c.push(this.processRoutes(t,u.children));return lr(c).pipe(il(),Cn(u=>{}))}preloadConfig(t,o){return this.preloadingStrategy.preload(o,()=>(o._loadedConfig?Ct(o._loadedConfig):this.loader.load(t.injector,o)).pipe(Gi(u=>(o._loadedConfig=u,this.processRoutes(u.module,u.routes)))))}}return n.\u0275fac=function(t){return new(t||n)(ie(Do),ie(Yr),ie(Hl),ie(An),ie(Tj))},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})(),kF=(()=>{class n{constructor(t,o,c={}){this.router=t,this.viewportScroller=o,this.options=c,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},c.scrollPositionRestoration=c.scrollPositionRestoration||"disabled",c.anchorScrolling=c.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(t=>{t instanceof fF?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof sR&&(this.lastId=t.id,this.scheduleScrollEvent(t,this.router.parseUrl(t.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(t=>{t instanceof MB&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,o){this.router.triggerEvent(new MB(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,o))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)(ie(Do),ie(LN),ie(void 0))},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})();const Em=new je("ROUTER_CONFIGURATION"),Ij=new je("ROUTER_FORROOT_GUARD"),pW=[Bi,{provide:mF,useClass:GB},{provide:Do,useFactory:function(n,e,t,o,c,u,p,_={},v,S){const w=new Do(null,n,e,t,o,c,u,xB(p));return v&&(w.urlHandlingStrategy=v),S&&(w.routeReuseStrategy=S),function(n,e){n.errorHandler&&(e.errorHandler=n.errorHandler),n.malformedUriErrorHandler&&(e.malformedUriErrorHandler=n.malformedUriErrorHandler),n.onSameUrlNavigation&&(e.onSameUrlNavigation=n.onSameUrlNavigation),n.paramsInheritanceStrategy&&(e.paramsInheritanceStrategy=n.paramsInheritanceStrategy),n.relativeLinkResolution&&(e.relativeLinkResolution=n.relativeLinkResolution),n.urlUpdateStrategy&&(e.urlUpdateStrategy=n.urlUpdateStrategy)}(_,w),_.enableTracing&&w.events.subscribe(M=>{var F,j;null===(F=console.group)||void 0===F||F.call(console,`Router Event: ${M.constructor.name}`),console.log(M.toString()),console.log(M),null===(j=console.groupEnd)||void 0===j||j.call(console)}),w},deps:[mF,xy,Bi,An,Yr,Hl,OF,Em,[class{},new Eo],[class{},new Eo]]},xy,{provide:mm,useFactory:function(n){return n.routerState.root},deps:[Do]},{provide:Yr,useClass:Ka},Rj,bj,class{preload(e,t){return t().pipe(pm(()=>Ct(null)))}},{provide:Em,useValue:{enableTracing:!1}}];function fW(){return new WT("Router",Do)}let _W=(()=>{class n{constructor(t,o){}static forRoot(t,o){return{ngModule:n,providers:[pW,wj(t),{provide:Ij,useFactory:EW,deps:[[Do,new Eo,new Na]]},{provide:Em,useValue:o||{}},{provide:Ep,useFactory:gW,deps:[zc,[new ph(Du),new Eo],Em]},{provide:kF,useFactory:mW,deps:[Do,LN,Em]},{provide:Tj,useExisting:o&&o.preloadingStrategy?o.preloadingStrategy:bj},{provide:WT,multi:!0,useFactory:fW},[LF,{provide:rp,multi:!0,useFactory:SW,deps:[LF]},{provide:Aj,useFactory:TW,deps:[LF]},{provide:op,multi:!0,useExisting:Aj}]]}}static forChild(t){return{ngModule:n,providers:[wj(t)]}}}return n.\u0275fac=function(t){return new(t||n)(ie(Ij,8),ie(Do,8))},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({}),n})();function mW(n,e,t){return t.scrollOffset&&e.setOffset(t.scrollOffset),new kF(n,e,t)}function gW(n,e,t={}){return t.useHash?new iN(n,e):new nN(n,e)}function EW(n){return"guarded"}function wj(n){return[{provide:F0,multi:!0,useValue:n},{provide:OF,multi:!0,useValue:n}]}let LF=(()=>{class n{constructor(t){this.injector=t,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new xt}appInitializer(){return this.injector.get(Tb,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let o=null;const c=new Promise(_=>o=_),u=this.injector.get(Do),p=this.injector.get(Em);return"disabled"===p.initialNavigation?(u.setUpLocationChangeListener(),o(!0)):"enabled"===p.initialNavigation||"enabledBlocking"===p.initialNavigation?(u.hooks.afterPreactivation=()=>this.initNavigation?Ct(null):(this.initNavigation=!0,o(!0),this.resultOfPreactivationDone),u.initialNavigation()):o(!0),c})}bootstrapListener(t){const o=this.injector.get(Em),c=this.injector.get(Rj),u=this.injector.get(kF),p=this.injector.get(Do),_=this.injector.get(zr);t===_.components[0]&&(("enabledNonBlocking"===o.initialNavigation||void 0===o.initialNavigation)&&p.initialNavigation(),c.setUpPreloading(),u.init(),p.resetRootComponentType(_.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return n.\u0275fac=function(t){return new(t||n)(ie(An))},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})();function SW(n){return n.appInitializer.bind(n)}function TW(n){return n.bootstrapListener.bind(n)}const Aj=new je("Router Initializer");function OP(n,e){return new tn(t=>{const o=n.length;if(0===o)return void t.complete();const c=new Array(o);let u=0,p=0;for(let _=0;_<o;_++){const v=lr(n[_]);let S=!1;t.add(v.subscribe({next:w=>{S||(S=!0,p++),c[_]=w},error:w=>t.error(w),complete:()=>{u++,(u===o||!S)&&(p===o&&t.next(e?e.reduce((w,M,F)=>(w[M]=c[F],w),{}):c),t.complete())}}))}})}let Dj=(()=>{class n{constructor(t,o){this._renderer=t,this._elementRef=o,this.onChange=c=>{},this.onTouched=()=>{}}setProperty(t,o){this._renderer.setProperty(this._elementRef.nativeElement,t,o)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}}return n.\u0275fac=function(t){return new(t||n)(Y(Ts),Y(Ot))},n.\u0275dir=Ae({type:n}),n})(),ym=(()=>{class n extends Dj{}return n.\u0275fac=function(){let e;return function(o){return(e||(e=pr(n)))(o||n)}}(),n.\u0275dir=Ae({type:n,features:[Dt]}),n})();const Qc=new je("NgValueAccessor"),wW={provide:Qc,useExisting:Ln(()=>NP),multi:!0},DW=new je("CompositionEventMode");let NP=(()=>{class n extends Dj{constructor(t,o,c){super(t,o),this._compositionMode=c,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function(){const n=Ea()?Ea().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}())}writeValue(t){this.setProperty("value",null==t?"":t)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}}return n.\u0275fac=function(t){return new(t||n)(Y(Ts),Y(Ot),Y(DW,8))},n.\u0275dir=Ae({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(t,o){1&t&&dn("input",function(u){return o._handleInput(u.target.value)})("blur",function(){return o.onTouched()})("compositionstart",function(){return o._compositionStart()})("compositionend",function(u){return o._compositionEnd(u.target.value)})},features:[Gt([wW]),Dt]}),n})();function Vp(n){return null==n||0===n.length}function Nj(n){return null!=n&&"number"==typeof n.length}const po=new je("NgValidators"),Bp=new je("NgAsyncValidators"),OW=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class NW{static min(e){return function(n){return e=>{if(Vp(e.value)||Vp(n))return null;const t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}(e)}static max(e){return function(n){return e=>{if(Vp(e.value)||Vp(n))return null;const t=parseFloat(e.value);return!isNaN(t)&&t>n?{max:{max:n,actual:e.value}}:null}}(e)}static required(e){return function(n){return Vp(n.value)?{required:!0}:null}(e)}static requiredTrue(e){return function(n){return!0===n.value?null:{required:!0}}(e)}static email(e){return function(n){return Vp(n.value)||OW.test(n.value)?null:{email:!0}}(e)}static minLength(e){return function(n){return e=>Vp(e.value)||!Nj(e.value)?null:e.value.length<n?{minlength:{requiredLength:n,actualLength:e.value.length}}:null}(e)}static maxLength(e){return function(n){return e=>Nj(e.value)&&e.value.length>n?{maxlength:{requiredLength:n,actualLength:e.value.length}}:null}(e)}static pattern(e){return function(n){if(!n)return jp;let e,t;return"string"==typeof n?(t="","^"!==n.charAt(0)&&(t+="^"),t+=n,"$"!==n.charAt(n.length-1)&&(t+="$"),e=new RegExp(t)):(t=n.toString(),e=n),o=>{if(Vp(o.value))return null;const c=o.value;return e.test(c)?null:{pattern:{requiredPattern:t,actualValue:c}}}}(e)}static nullValidator(e){return null}static compose(e){return Kj(e)}static composeAsync(e){return qj(e)}}function jp(n){return null}function Bj(n){return null!=n}function jj(n){const e=n_(n)?lr(n):n;return zd(e),e}function Hj(n){let e={};return n.forEach(t=>{e=null!=t?Object.assign(Object.assign({},e),t):e}),0===Object.keys(e).length?null:e}function Gj(n,e){return e.map(t=>t(n))}function Wj(n){return n.map(e=>function(n){return!n.validate}(e)?e:t=>e.validate(t))}function Kj(n){if(!n)return null;const e=n.filter(Bj);return 0==e.length?null:function(t){return Hj(Gj(t,e))}}function xF(n){return null!=n?Kj(Wj(n)):null}function qj(n){if(!n)return null;const e=n.filter(Bj);return 0==e.length?null:function(t){return function(...n){if(1===n.length){const e=n[0];if(Ir(e))return OP(e,null);if(rc(e)&&Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);return OP(t.map(o=>e[o]),t)}}if("function"==typeof n[n.length-1]){const e=n.pop();return OP(n=1===n.length&&Ir(n[0])?n[0]:n,null).pipe(Cn(t=>e(...t)))}return OP(n,null)}(Gj(t,e).map(jj)).pipe(Cn(Hj))}}function FF(n){return null!=n?qj(Wj(n)):null}function zj(n,e){return null===n?[e]:Array.isArray(n)?[...n,e]:[n,e]}function Yj(n){return n._rawValidators}function $j(n){return n._rawAsyncValidators}function UF(n){return n?Array.isArray(n)?n:[n]:[]}function PP(n,e){return Array.isArray(n)?n.includes(e):n===e}function Jj(n,e){const t=UF(e);return UF(n).forEach(c=>{PP(t,c)||t.push(c)}),t}function Xj(n,e){return UF(e).filter(t=>!PP(n,t))}let Qj=(()=>{class n{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=xF(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=FF(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t){this.control&&this.control.reset(t)}hasError(t,o){return!!this.control&&this.control.hasError(t,o)}getError(t,o){return this.control?this.control.getError(t,o):null}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=Ae({type:n}),n})(),ls=(()=>{class n extends Qj{get formDirective(){return null}get path(){return null}}return n.\u0275fac=function(){let e;return function(o){return(e||(e=pr(n)))(o||n)}}(),n.\u0275dir=Ae({type:n,features:[Dt]}),n})();class ku extends Qj{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Zj{constructor(e){this._cd=e}is(e){var t,o,c;return"submitted"===e?!!(null===(t=this._cd)||void 0===t?void 0:t.submitted):!!(null===(c=null===(o=this._cd)||void 0===o?void 0:o.control)||void 0===c?void 0:c[e])}}let e4=(()=>{class n extends Zj{constructor(t){super(t)}}return n.\u0275fac=function(t){return new(t||n)(Y(ku,2))},n.\u0275dir=Ae({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(t,o){2&t&&Jt("ng-untouched",o.is("untouched"))("ng-touched",o.is("touched"))("ng-pristine",o.is("pristine"))("ng-dirty",o.is("dirty"))("ng-valid",o.is("valid"))("ng-invalid",o.is("invalid"))("ng-pending",o.is("pending"))},features:[Dt]}),n})(),t4=(()=>{class n extends Zj{constructor(t){super(t)}}return n.\u0275fac=function(t){return new(t||n)(Y(ls,10))},n.\u0275dir=Ae({type:n,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(t,o){2&t&&Jt("ng-untouched",o.is("untouched"))("ng-touched",o.is("touched"))("ng-pristine",o.is("pristine"))("ng-dirty",o.is("dirty"))("ng-valid",o.is("valid"))("ng-invalid",o.is("invalid"))("ng-pending",o.is("pending"))("ng-submitted",o.is("submitted"))},features:[Dt]}),n})();function mR(n,e){jF(n,e),e.valueAccessor.writeValue(n.value),function(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,"change"===n.updateOn&&n4(n,e)})}(n,e),function(n,e){const t=(o,c)=>{e.valueAccessor.writeValue(o),c&&e.viewToModelUpdate(o)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}(n,e),function(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,"blur"===n.updateOn&&n._pendingChange&&n4(n,e),"submit"!==n.updateOn&&n.markAsTouched()})}(n,e),function(n,e){if(e.valueAccessor.setDisabledState){const t=o=>{e.valueAccessor.setDisabledState(o)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}(n,e)}function LP(n,e,t=!0){const o=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(o),e.valueAccessor.registerOnTouched(o)),FP(n,e),n&&(e._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function xP(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function jF(n,e){const t=Yj(n);null!==e.validator?n.setValidators(zj(t,e.validator)):"function"==typeof t&&n.setValidators([t]);const o=$j(n);null!==e.asyncValidator?n.setAsyncValidators(zj(o,e.asyncValidator)):"function"==typeof o&&n.setAsyncValidators([o]);const c=()=>n.updateValueAndValidity();xP(e._rawValidators,c),xP(e._rawAsyncValidators,c)}function FP(n,e){let t=!1;if(null!==n){if(null!==e.validator){const c=Yj(n);if(Array.isArray(c)&&c.length>0){const u=c.filter(p=>p!==e.validator);u.length!==c.length&&(t=!0,n.setValidators(u))}}if(null!==e.asyncValidator){const c=$j(n);if(Array.isArray(c)&&c.length>0){const u=c.filter(p=>p!==e.asyncValidator);u.length!==c.length&&(t=!0,n.setAsyncValidators(u))}}}const o=()=>{};return xP(e._rawValidators,o),xP(e._rawAsyncValidators,o),t}function n4(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function i4(n,e){jF(n,e)}function r4(n,e){n._syncPendingControls(),e.forEach(t=>{const o=t.control;"submit"===o.updateOn&&o._pendingChange&&(t.viewToModelUpdate(o._pendingValue),o._pendingChange=!1)})}function UP(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const gR="VALID",VP="INVALID",Uy="PENDING",ER="DISABLED";function WF(n){return(qF(n)?n.validators:n)||null}function o4(n){return Array.isArray(n)?xF(n):n||null}function KF(n,e){return(qF(e)?e.asyncValidators:n)||null}function s4(n){return Array.isArray(n)?FF(n):n||null}function qF(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}class zF{constructor(e,t){this._hasOwnPendingAsyncValidator=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=e,this._rawAsyncValidators=t,this._composedValidatorFn=o4(this._rawValidators),this._composedAsyncValidatorFn=s4(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===gR}get invalid(){return this.status===VP}get pending(){return this.status==Uy}get disabled(){return this.status===ER}get enabled(){return this.status!==ER}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._rawValidators=e,this._composedValidatorFn=o4(e)}setAsyncValidators(e){this._rawAsyncValidators=e,this._composedAsyncValidatorFn=s4(e)}addValidators(e){this.setValidators(Jj(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(Jj(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(Xj(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(Xj(e,this._rawAsyncValidators))}hasValidator(e){return PP(this._rawValidators,e)}hasAsyncValidator(e){return PP(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Uy,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=ER,this.errors=null,this._forEachChild(o=>{o.disable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(o=>o(!0))}enable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=gR,this._forEachChild(o=>{o.enable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(o=>o(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===gR||this.status===Uy)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?ER:gR}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Uy,this._hasOwnPendingAsyncValidator=!0;const t=jj(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(o=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(o,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}get(e){return function(n,e,t){if(null==e||(Array.isArray(e)||(e=e.split(".")),Array.isArray(e)&&0===e.length))return null;let o=n;return e.forEach(c=>{o=o instanceof yR?o.controls.hasOwnProperty(c)?o.controls[c]:null:o instanceof YF&&o.at(c)||null}),o}(this,e)}getError(e,t){const o=t?this.get(t):this;return o&&o.errors?o.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new ft,this.statusChanges=new ft}_calculateStatus(){return this._allControlsDisabled()?ER:this.errors?VP:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Uy)?Uy:this._anyControlsHaveStatus(VP)?VP:gR}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_isBoxedValue(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){qF(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class Vy extends zF{constructor(e=null,t,o){super(WF(t),KF(o,t)),this._onChange=[],this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(o=>o(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=null,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){UP(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){UP(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){this._isBoxedValue(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}}class yR extends zF{constructor(e,t,o){super(WF(t),KF(o,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,o={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:o.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,o={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:o.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){this._checkAllValuesPresent(e),Object.keys(e).forEach(o=>{this._throwIfControlMissing(o),this.controls[o].setValue(e[o],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(Object.keys(e).forEach(o=>{this.controls[o]&&this.controls[o].patchValue(e[o],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((o,c)=>{o.reset(e[c],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,o)=>(e[o]=t instanceof Vy?t.value:t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,o)=>!!o._syncPendingControls()||t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[e])throw new Error(`Cannot find form control with name: ${e}.`)}_forEachChild(e){Object.keys(this.controls).forEach(t=>{const o=this.controls[t];o&&e(o,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const t of Object.keys(this.controls)){const o=this.controls[t];if(this.contains(t)&&e(o))return!0}return!1}_reduceValue(){return this._reduceChildren({},(e,t,o)=>((t.enabled||this.disabled)&&(e[o]=t.value),e))}_reduceChildren(e,t){let o=e;return this._forEachChild((c,u)=>{o=t(o,c,u)}),o}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent(e){this._forEachChild((t,o)=>{if(void 0===e[o])throw new Error(`Must supply a value for form control with name: '${o}'.`)})}}class YF extends zF{constructor(e,t,o){super(WF(t),KF(o,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[e]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,o={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:o.emitEvent})}removeAt(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,o={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),t&&(this.controls.splice(e,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:o.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){this._checkAllValuesPresent(e),e.forEach((o,c)=>{this._throwIfControlMissing(c),this.at(c).setValue(o,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(e.forEach((o,c)=>{this.at(c)&&this.at(c).patchValue(o,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((o,c)=>{o.reset(e[c],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e instanceof Vy?e.value:e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_syncPendingControls(){let e=this.controls.reduce((t,o)=>!!o._syncPendingControls()||t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(e))throw new Error(`Cannot find form control at index ${e}`)}_forEachChild(e){this.controls.forEach((t,o)=>{e(t,o)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_checkAllValuesPresent(e){this._forEachChild((t,o)=>{if(void 0===e[o])throw new Error(`Must supply a value for form control at index: ${o}.`)})}_allControlsDisabled(){for(const e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}}const WW={provide:ls,useExisting:Ln(()=>BP)},vR=(()=>Promise.resolve(null))();let BP=(()=>{class n extends ls{constructor(t,o){super(),this.submitted=!1,this._directives=[],this.ngSubmit=new ft,this.form=new yR({},xF(t),FF(o))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){vR.then(()=>{const o=this._findContainer(t.path);t.control=o.registerControl(t.name,t.control),mR(t.control,t),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.push(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){vR.then(()=>{const o=this._findContainer(t.path);o&&o.removeControl(t.name),UP(this._directives,t)})}addFormGroup(t){vR.then(()=>{const o=this._findContainer(t.path),c=new yR({});i4(c,t),o.registerControl(t.name,c),c.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){vR.then(()=>{const o=this._findContainer(t.path);o&&o.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,o){vR.then(()=>{this.form.get(t.path).setValue(o)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submitted=!0,r4(this.form,this._directives),this.ngSubmit.emit(t),!1}onReset(){this.resetForm()}resetForm(t){this.form.reset(t),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}}return n.\u0275fac=function(t){return new(t||n)(Y(po,10),Y(Bp,10))},n.\u0275dir=Ae({type:n,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(t,o){1&t&&dn("submit",function(u){return o.onSubmit(u)})("reset",function(){return o.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Gt([WW]),Dt]}),n})(),u4=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=Ae({type:n,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),n})(),p4=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({}),n})();const $F=new je("NgModelWithFormControlWarning"),QW={provide:ls,useExisting:Ln(()=>CR)};let CR=(()=>{class n extends ls{constructor(t,o){super(),this.validators=t,this.asyncValidators=o,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new ft,this._setValidators(t),this._setAsyncValidators(o)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(FP(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){const o=this.form.get(t.path);return mR(o,t),o.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),o}getControl(t){return this.form.get(t.path)}removeControl(t){LP(t.control||null,t,!1),UP(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,o){this.form.get(t.path).setValue(o)}onSubmit(t){return this.submitted=!0,r4(this.form,this.directives),this.ngSubmit.emit(t),!1}onReset(){this.resetForm()}resetForm(t){this.form.reset(t),this.submitted=!1}_updateDomValue(){this.directives.forEach(t=>{const o=t.control,c=this.form.get(t.path);o!==c&&(LP(o||null,t),c instanceof Vy&&(mR(c,t),t.control=c))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){const o=this.form.get(t.path);i4(o,t),o.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){const o=this.form.get(t.path);o&&function(n,e){return FP(n,e)}(o,t)&&o.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){jF(this.form,this),this._oldForm&&FP(this._oldForm,this)}_checkFormPresent(){}}return n.\u0275fac=function(t){return new(t||n)(Y(po,10),Y(Bp,10))},n.\u0275dir=Ae({type:n,selectors:[["","formGroup",""]],hostBindings:function(t,o){1&t&&dn("submit",function(u){return o.onSubmit(u)})("reset",function(){return o.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Gt([QW]),Dt,Wi]}),n})();const t9={provide:ku,useExisting:Ln(()=>QF)};let iU,QF=(()=>{class n extends ku{constructor(t,o,c,u,p){super(),this._ngModelWarningConfig=p,this._added=!1,this.update=new ft,this._ngModelWarningSent=!1,this._parent=t,this._setValidators(o),this._setAsyncValidators(c),this.valueAccessor=function(n,e){if(!e)return null;let t,o,c;return Array.isArray(e),e.forEach(u=>{u.constructor===NP?t=u:function(n){return Object.getPrototypeOf(n.constructor)===ym}(u)?o=u:c=u}),c||o||t||null}(0,u)}set isDisabled(t){}ngOnChanges(t){this._added||this._setUpControl(),function(n,e){if(!n.hasOwnProperty("model"))return!1;const t=n.model;return!!t.isFirstChange()||!Object.is(e,t.currentValue)}(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return function(n,e){return[...e.path,n]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this.control.disabled&&this.valueAccessor.setDisabledState&&this.valueAccessor.setDisabledState(!0),this._added=!0}}return n.\u0275fac=function(t){return new(t||n)(Y(ls,13),Y(po,10),Y(Bp,10),Y(Qc,10),Y($F,8))},n.\u0275dir=Ae({type:n,selectors:[["","formControlName",""]],inputs:{isDisabled:["disabled","isDisabled"],name:["formControlName","name"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[Gt([t9]),Dt,Wi]}),n._ngModelWarningSentOnce=!1,n})(),A4=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({imports:[[p4]]}),n})(),D4=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:$F,useValue:t.warnOnNgModelWithFormControl}]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({imports:[A4]}),n})(),g9=(()=>{class n{group(t,o=null){const c=this._reduceControls(t);let _,u=null,p=null;return null!=o&&(function(n){return void 0!==n.asyncValidators||void 0!==n.validators||void 0!==n.updateOn}(o)?(u=null!=o.validators?o.validators:null,p=null!=o.asyncValidators?o.asyncValidators:null,_=null!=o.updateOn?o.updateOn:void 0):(u=null!=o.validator?o.validator:null,p=null!=o.asyncValidator?o.asyncValidator:null)),new yR(c,{asyncValidators:p,updateOn:_,validators:u})}control(t,o,c){return new Vy(t,o,c)}array(t,o,c){const u=t.map(p=>this._createControl(p));return new YF(u,o,c)}_reduceControls(t){const o={};return Object.keys(t).forEach(c=>{o[c]=this._createControl(t[c])}),o}_createControl(t){return t instanceof Vy||t instanceof yR||t instanceof YF?t:Array.isArray(t)?this.control(t[0],t.length>1?t[1]:null,t.length>2?t[2]:null):this.control(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Pe({factory:function(){return new n},token:n,providedIn:D4}),n})();try{iU="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(n){iU=!1}let By,ii=(()=>{class n{constructor(t){this._platformId=t,this.isBrowser=this._platformId?function(n){return n===rm}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!iU)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return n.\u0275fac=function(t){return new(t||n)(ie(Zo))},n.\u0275prov=Pe({factory:function(){return new n(ie(Zo))},token:n,providedIn:"root"}),n})(),SR=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({}),n})();const O4=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function N4(){if(By)return By;if("object"!=typeof document||!document)return By=new Set(O4),By;let n=document.createElement("input");return By=new Set(O4.filter(e=>(n.setAttribute("type",e),n.type===e))),By}let TR,vm,rU;function bR(n){return function(){if(null==TR&&"undefined"!=typeof window)try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>TR=!0}))}finally{TR=TR||!1}return TR}()?n:!!n.capture}function P4(){if(null==vm){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return vm=!1,vm;if("scrollBehavior"in document.documentElement.style)vm=!0;else{const n=Element.prototype.scrollTo;vm=!!n&&!/\{\s*\[native code\]\s*\}/.test(n.toString())}}return vm}function Cm(n){return n.composedPath?n.composedPath()[0]:n.target}function oU(){return"undefined"!=typeof __karma__&&!!__karma__||"undefined"!=typeof jasmine&&!!jasmine||"undefined"!=typeof jest&&!!jest||"undefined"!=typeof Mocha&&!!Mocha}function br(n){return null!=n&&"false"!=`${n}`}function Hp(n,e=0){return function(n){return!isNaN(parseFloat(n))&&!isNaN(Number(n))}(n)?Number(n):e}function HP(n){return Array.isArray(n)?n:[n]}function Rr(n){return null==n?"":"string"==typeof n?n:`${n}px`}function Lu(n){return n instanceof Ot?n.nativeElement:n}function IR(n,e,t,o){return x(t)&&(o=t,t=void 0),o?IR(n,e,t).pipe(Cn(c=>Ir(c)?o(...c):o(c))):new tn(c=>{M4(n,e,function(p){c.next(arguments.length>1?Array.prototype.slice.call(arguments):p)},c,t)})}function M4(n,e,t,o,c){let u;if(function(n){return n&&"function"==typeof n.addEventListener&&"function"==typeof n.removeEventListener}(n)){const p=n;n.addEventListener(e,t,c),u=()=>p.removeEventListener(e,t,c)}else if(function(n){return n&&"function"==typeof n.on&&"function"==typeof n.off}(n)){const p=n;n.on(e,t),u=()=>p.off(e,t)}else if(function(n){return n&&"function"==typeof n.addListener&&"function"==typeof n.removeListener}(n)){const p=n;n.addListener(e,t),u=()=>p.removeListener(e,t)}else{if(!n||!n.length)throw new TypeError("Invalid event target");for(let p=0,_=n.length;p<_;p++)M4(n[p],e,t,o,c)}o.add(u)}class I9 extends en{constructor(e,t){super()}schedule(e,t=0){return this}}class GP extends I9{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){if(this.closed)return this;this.state=e;const o=this.id,c=this.scheduler;return null!=o&&(this.id=this.recycleAsyncId(c,o,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(c,this.id,t),this}requestAsyncId(e,t,o=0){return setInterval(e.flush.bind(e,this),o)}recycleAsyncId(e,t,o=0){if(null!==o&&this.delay===o&&!1===this.pending)return t;clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const o=this._execute(e,t);if(o)return o;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let c,o=!1;try{this.work(e)}catch(u){o=!0,c=!!u&&u||new Error(u)}if(o)return this.unsubscribe(),c}_unsubscribe(){const e=this.id,t=this.scheduler,o=t.actions,c=o.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==c&&o.splice(c,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null}}let k4=(()=>{class n{constructor(t,o=n.now){this.SchedulerAction=t,this.now=o}schedule(t,o=0,c){return new this.SchedulerAction(this,t).schedule(c,o)}}return n.now=()=>Date.now(),n})();class Zc extends k4{constructor(e,t=k4.now){super(e,()=>Zc.delegate&&Zc.delegate!==this?Zc.delegate.now():t()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(e,t=0,o){return Zc.delegate&&Zc.delegate!==this?Zc.delegate.schedule(e,t,o):super.schedule(e,t,o)}flush(e){const{actions:t}=this;if(this.active)return void t.push(e);let o;this.active=!0;do{if(o=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,o){for(;e=t.shift();)e.unsubscribe();throw o}}}const jy=new Zc(GP);class A9{constructor(e){this.durationSelector=e}call(e,t){return t.subscribe(new D9(e,this.durationSelector))}}class D9 extends $p{constructor(e,t){super(e),this.durationSelector=t,this.hasValue=!1}_next(e){if(this.value=e,this.hasValue=!0,!this.throttled){let t;try{const{durationSelector:c}=this;t=c(e)}catch(c){return this.destination.error(c)}const o=cd(t,new ju(this));!o||o.closed?this.clearThrottle():this.add(this.throttled=o)}}clearThrottle(){const{value:e,hasValue:t,throttled:o}=this;o&&(this.remove(o),this.throttled=void 0,o.unsubscribe()),t&&(this.value=void 0,this.hasValue=!1,this.destination.next(e))}notifyNext(){this.clearThrottle()}notifyComplete(){this.clearThrottle()}}function sU(n){return!Ir(n)&&n-parseFloat(n)+1>=0}function L4(n=0,e,t){let o=-1;return sU(e)?o=Number(e)<1?1:Number(e):ad(e)&&(t=e),ad(t)||(t=jy),new tn(c=>{const u=sU(n)?n:+n-t.now();return t.schedule(O9,u,{index:0,period:o,subscriber:c})})}function O9(n){const{index:e,period:t,subscriber:o}=n;if(o.next(e),!o.closed){if(-1===t)return o.complete();n.index=e+1,this.schedule(n,t)}}function WP(n,e=jy){return function(n){return function(t){return t.lift(new A9(n))}}(()=>L4(n,e))}function fo(n){return e=>e.lift(new N9(n))}class N9{constructor(e){this.notifier=e}call(e,t){const o=new P9(e),c=cd(this.notifier,new ju(o));return c&&!o.seenValue?(o.add(c),t.subscribe(o)):o}}class P9 extends $p{constructor(e){super(e),this.seenValue=!1}notifyNext(){this.seenValue=!0,this.complete()}notifyComplete(){}}const x4=bR({passive:!0});let F4=(()=>{class n{constructor(t,o){this._platform=t,this._ngZone=o,this._monitoredElements=new Map}monitor(t){if(!this._platform.isBrowser)return um;const o=Lu(t),c=this._monitoredElements.get(o);if(c)return c.subject;const u=new xt,p="cdk-text-field-autofilled",_=v=>{"cdk-text-field-autofill-start"!==v.animationName||o.classList.contains(p)?"cdk-text-field-autofill-end"===v.animationName&&o.classList.contains(p)&&(o.classList.remove(p),this._ngZone.run(()=>u.next({target:v.target,isAutofilled:!1}))):(o.classList.add(p),this._ngZone.run(()=>u.next({target:v.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{o.addEventListener("animationstart",_,x4),o.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(o,{subject:u,unlisten:()=>{o.removeEventListener("animationstart",_,x4)}}),u}stopMonitoring(t){const o=Lu(t),c=this._monitoredElements.get(o);c&&(c.unlisten(),c.subject.complete(),o.classList.remove("cdk-text-field-autofill-monitored"),o.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(o))}ngOnDestroy(){this._monitoredElements.forEach((t,o)=>this.stopMonitoring(o))}}return n.\u0275fac=function(t){return new(t||n)(ie(ii),ie(nt))},n.\u0275prov=Pe({factory:function(){return new n(ie(ii),ie(nt))},token:n,providedIn:"root"}),n})(),U4=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({imports:[[SR]]}),n})();function B4(n){return e=>e.lift(new j9(n))}class j9{constructor(e){this.total=e}call(e,t){return t.subscribe(new H9(e,this.total))}}class H9 extends wn{constructor(e,t){super(e),this.total=t,this.count=0}_next(e){++this.count>this.total&&this.destination.next(e)}}class G9{constructor(e,t){this.compare=e,this.keySelector=t}call(e,t){return t.subscribe(new W9(e,this.compare,this.keySelector))}}class W9 extends wn{constructor(e,t,o){super(e),this.keySelector=o,this.hasKey=!1,"function"==typeof t&&(this.compare=t)}compare(e,t){return e===t}_next(e){let t;try{const{keySelector:c}=this;t=c?c(e):e}catch(c){return this.destination.error(c)}let o=!1;if(this.hasKey)try{const{compare:c}=this;o=c(this.key,t)}catch(c){return this.destination.error(c)}else this.hasKey=!0;o||(this.key=t,this.destination.next(e))}}function H4(n,e=jy){return t=>t.lift(new K9(n,e))}class K9{constructor(e,t){this.dueTime=e,this.scheduler=t}call(e,t){return t.subscribe(new q9(e,this.dueTime,this.scheduler))}}class q9 extends wn{constructor(e,t,o){super(e),this.dueTime=t,this.scheduler=o,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(z9,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:e}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(e)}}clearDebounce(){const e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)}}function z9(n){n.debouncedNext()}let cU=(()=>{class n{create(t){return"undefined"==typeof MutationObserver?null:new MutationObserver(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Pe({factory:function(){return new n},token:n,providedIn:"root"}),n})(),G4=(()=>{class n{constructor(t){this._mutationObserverFactory=t,this._observedElements=new Map}ngOnDestroy(){this._observedElements.forEach((t,o)=>this._cleanupObserver(o))}observe(t){const o=Lu(t);return new tn(c=>{const p=this._observeElement(o).subscribe(c);return()=>{p.unsubscribe(),this._unobserveElement(o)}})}_observeElement(t){if(this._observedElements.has(t))this._observedElements.get(t).count++;else{const o=new xt,c=this._mutationObserverFactory.create(u=>o.next(u));c&&c.observe(t,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(t,{observer:c,stream:o,count:1})}return this._observedElements.get(t).stream}_unobserveElement(t){this._observedElements.has(t)&&(this._observedElements.get(t).count--,this._observedElements.get(t).count||this._cleanupObserver(t))}_cleanupObserver(t){if(this._observedElements.has(t)){const{observer:o,stream:c}=this._observedElements.get(t);o&&o.disconnect(),c.complete(),this._observedElements.delete(t)}}}return n.\u0275fac=function(t){return new(t||n)(ie(cU))},n.\u0275prov=Pe({factory:function(){return new n(ie(cU))},token:n,providedIn:"root"}),n})(),W4=(()=>{class n{constructor(t,o,c){this._contentObserver=t,this._elementRef=o,this._ngZone=c,this.event=new ft,this._disabled=!1,this._currentSubscription=null}get disabled(){return this._disabled}set disabled(t){this._disabled=br(t),this._disabled?this._unsubscribe():this._subscribe()}get debounce(){return this._debounce}set debounce(t){this._debounce=Hp(t),this._subscribe()}ngAfterContentInit(){!this._currentSubscription&&!this.disabled&&this._subscribe()}ngOnDestroy(){this._unsubscribe()}_subscribe(){this._unsubscribe();const t=this._contentObserver.observe(this._elementRef);this._ngZone.runOutsideAngular(()=>{this._currentSubscription=(this.debounce?t.pipe(H4(this.debounce)):t).subscribe(this.event)})}_unsubscribe(){var t;null===(t=this._currentSubscription)||void 0===t||t.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)(Y(G4),Y(Ot),Y(nt))},n.\u0275dir=Ae({type:n,selectors:[["","cdkObserveContent",""]],inputs:{disabled:["cdkObserveContentDisabled","disabled"],debounce:"debounce"},outputs:{event:"cdkObserveContent"},exportAs:["cdkObserveContent"]}),n})(),lU=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({providers:[cU]}),n})();function KP(n,e){return(n.getAttribute(e)||"").match(/\S+/g)||[]}const q4="cdk-describedby-message-container",z4="cdk-describedby-message",qP="cdk-describedby-host";let J9=0;const rd=new Map;let _o=null,Y4=(()=>{class n{constructor(t){this._document=t}describe(t,o,c){if(!this._canBeDescribed(t,o))return;const u=dU(o,c);"string"!=typeof o?($4(o),rd.set(u,{messageElement:o,referenceCount:0})):rd.has(u)||this._createMessageElement(o,c),this._isElementDescribedByMessage(t,u)||this._addMessageReference(t,u)}removeDescription(t,o,c){if(!o||!this._isElementNode(t))return;const u=dU(o,c);if(this._isElementDescribedByMessage(t,u)&&this._removeMessageReference(t,u),"string"==typeof o){const p=rd.get(u);p&&0===p.referenceCount&&this._deleteMessageElement(u)}_o&&0===_o.childNodes.length&&this._deleteMessagesContainer()}ngOnDestroy(){const t=this._document.querySelectorAll(`[${qP}]`);for(let o=0;o<t.length;o++)this._removeCdkDescribedByReferenceIds(t[o]),t[o].removeAttribute(qP);_o&&this._deleteMessagesContainer(),rd.clear()}_createMessageElement(t,o){const c=this._document.createElement("div");$4(c),c.textContent=t,o&&c.setAttribute("role",o),this._createMessagesContainer(),_o.appendChild(c),rd.set(dU(t,o),{messageElement:c,referenceCount:0})}_deleteMessageElement(t){const o=rd.get(t),c=o&&o.messageElement;_o&&c&&_o.removeChild(c),rd.delete(t)}_createMessagesContainer(){if(!_o){const t=this._document.getElementById(q4);t&&t.parentNode&&t.parentNode.removeChild(t),_o=this._document.createElement("div"),_o.id=q4,_o.style.visibility="hidden",_o.classList.add("cdk-visually-hidden"),this._document.body.appendChild(_o)}}_deleteMessagesContainer(){_o&&_o.parentNode&&(_o.parentNode.removeChild(_o),_o=null)}_removeCdkDescribedByReferenceIds(t){const o=KP(t,"aria-describedby").filter(c=>0!=c.indexOf(z4));t.setAttribute("aria-describedby",o.join(" "))}_addMessageReference(t,o){const c=rd.get(o);(function(n,e,t){const o=KP(n,e);o.some(c=>c.trim()==t.trim())||(o.push(t.trim()),n.setAttribute(e,o.join(" ")))})(t,"aria-describedby",c.messageElement.id),t.setAttribute(qP,""),c.referenceCount++}_removeMessageReference(t,o){const c=rd.get(o);c.referenceCount--,function(n,e,t){const c=KP(n,e).filter(u=>u!=t.trim());c.length?n.setAttribute(e,c.join(" ")):n.removeAttribute(e)}(t,"aria-describedby",c.messageElement.id),t.removeAttribute(qP)}_isElementDescribedByMessage(t,o){const c=KP(t,"aria-describedby"),u=rd.get(o),p=u&&u.messageElement.id;return!!p&&-1!=c.indexOf(p)}_canBeDescribed(t,o){if(!this._isElementNode(t))return!1;if(o&&"object"==typeof o)return!0;const c=null==o?"":`${o}`.trim(),u=t.getAttribute("aria-label");return!(!c||u&&u.trim()===c)}_isElementNode(t){return t.nodeType===this._document.ELEMENT_NODE}}return n.\u0275fac=function(t){return new(t||n)(ie(Je))},n.\u0275prov=Pe({factory:function(){return new n(ie(Je))},token:n,providedIn:"root"}),n})();function dU(n,e){return"string"==typeof n?`${e||""}/${n}`:n}function $4(n){n.id||(n.id=`${z4}-${J9++}`)}function Z4(n){return 0===n.offsetX&&0===n.offsetY}function e5(n){const e=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!(!e||-1!==e.identifier||null!=e.radiusX&&1!==e.radiusX||null!=e.radiusY&&1!==e.radiusY)}"undefined"!=typeof Element&&Element;const t5=new je("cdk-input-modality-detector-options"),p7={ignoreKeys:[18,17,224,91,16]},Hy=bR({passive:!0,capture:!0});let i5=(()=>{class n{constructor(t,o,c,u){this._platform=t,this._mostRecentTarget=null,this._modality=new Vs(null),this._lastTouchMs=0,this._onKeydown=p=>{var _,v;(null===(v=null===(_=this._options)||void 0===_?void 0:_.ignoreKeys)||void 0===v?void 0:v.some(S=>S===p.keyCode))||(this._modality.next("keyboard"),this._mostRecentTarget=Cm(p))},this._onMousedown=p=>{Date.now()-this._lastTouchMs<650||(this._modality.next(Z4(p)?"keyboard":"mouse"),this._mostRecentTarget=Cm(p))},this._onTouchstart=p=>{e5(p)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Cm(p))},this._options=Object.assign(Object.assign({},p7),u),this.modalityDetected=this._modality.pipe(B4(1)),this.modalityChanged=this.modalityDetected.pipe(function(n,e){return t=>t.lift(new G9(n,e))}()),t.isBrowser&&o.runOutsideAngular(()=>{c.addEventListener("keydown",this._onKeydown,Hy),c.addEventListener("mousedown",this._onMousedown,Hy),c.addEventListener("touchstart",this._onTouchstart,Hy)})}get mostRecentModality(){return this._modality.value}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Hy),document.removeEventListener("mousedown",this._onMousedown,Hy),document.removeEventListener("touchstart",this._onTouchstart,Hy))}}return n.\u0275fac=function(t){return new(t||n)(ie(ii),ie(nt),ie(Je),ie(t5,8))},n.\u0275prov=Pe({factory:function(){return new n(ie(ii),ie(nt),ie(Je),ie(t5,8))},token:n,providedIn:"root"}),n})();const s5=new je("cdk-focus-monitor-default-options"),zP=bR({passive:!0,capture:!0});let Gy=(()=>{class n{constructor(t,o,c,u,p){this._ngZone=t,this._platform=o,this._inputModalityDetector=c,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new xt,this._rootNodeFocusAndBlurListener=_=>{const v=Cm(_),S="focus"===_.type?this._onFocus:this._onBlur;for(let w=v;w;w=w.parentElement)S.call(this,_,w)},this._document=u,this._detectionMode=(null==p?void 0:p.detectionMode)||0}monitor(t,o=!1){const c=Lu(t);if(!this._platform.isBrowser||1!==c.nodeType)return Ct(null);const u=function(n){if(function(){if(null==rU){const n="undefined"!=typeof document?document.head:null;rU=!(!n||!n.createShadowRoot&&!n.attachShadow)}return rU}()){const e=n.getRootNode?n.getRootNode():null;if("undefined"!=typeof ShadowRoot&&ShadowRoot&&e instanceof ShadowRoot)return e}return null}(c)||this._getDocument(),p=this._elementInfo.get(c);if(p)return o&&(p.checkChildren=!0),p.subject;const _={checkChildren:o,subject:new xt,rootNode:u};return this._elementInfo.set(c,_),this._registerGlobalListeners(_),_.subject}stopMonitoring(t){const o=Lu(t),c=this._elementInfo.get(o);c&&(c.subject.complete(),this._setClasses(o),this._elementInfo.delete(o),this._removeGlobalListeners(c))}focusVia(t,o,c){const u=Lu(t);u===this._getDocument().activeElement?this._getClosestElementsInfo(u).forEach(([_,v])=>this._originChanged(_,o,v)):(this._setOrigin(o),"function"==typeof u.focus&&u.focus(c))}ngOnDestroy(){this._elementInfo.forEach((t,o)=>this.stopMonitoring(o))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_toggleClass(t,o,c){c?t.classList.add(o):t.classList.remove(o)}_getFocusOrigin(t){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(t)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:"program"}_shouldBeAttributedToTouch(t){return 1===this._detectionMode||!!(null==t?void 0:t.contains(this._inputModalityDetector._mostRecentTarget))}_setClasses(t,o){this._toggleClass(t,"cdk-focused",!!o),this._toggleClass(t,"cdk-touch-focused","touch"===o),this._toggleClass(t,"cdk-keyboard-focused","keyboard"===o),this._toggleClass(t,"cdk-mouse-focused","mouse"===o),this._toggleClass(t,"cdk-program-focused","program"===o)}_setOrigin(t,o=!1){this._ngZone.runOutsideAngular(()=>{this._origin=t,this._originFromTouchInteraction="touch"===t&&o,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(t,o){const c=this._elementInfo.get(o),u=Cm(t);!c||!c.checkChildren&&o!==u||this._originChanged(o,this._getFocusOrigin(u),c)}_onBlur(t,o){const c=this._elementInfo.get(o);!c||c.checkChildren&&t.relatedTarget instanceof Node&&o.contains(t.relatedTarget)||(this._setClasses(o),this._emitOrigin(c.subject,null))}_emitOrigin(t,o){this._ngZone.run(()=>t.next(o))}_registerGlobalListeners(t){if(!this._platform.isBrowser)return;const o=t.rootNode,c=this._rootNodeFocusListenerCount.get(o)||0;c||this._ngZone.runOutsideAngular(()=>{o.addEventListener("focus",this._rootNodeFocusAndBlurListener,zP),o.addEventListener("blur",this._rootNodeFocusAndBlurListener,zP)}),this._rootNodeFocusListenerCount.set(o,c+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(fo(this._stopInputModalityDetector)).subscribe(u=>{this._setOrigin(u,!0)}))}_removeGlobalListeners(t){const o=t.rootNode;if(this._rootNodeFocusListenerCount.has(o)){const c=this._rootNodeFocusListenerCount.get(o);c>1?this._rootNodeFocusListenerCount.set(o,c-1):(o.removeEventListener("focus",this._rootNodeFocusAndBlurListener,zP),o.removeEventListener("blur",this._rootNodeFocusAndBlurListener,zP),this._rootNodeFocusListenerCount.delete(o))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(t,o,c){this._setClasses(t,o),this._emitOrigin(c.subject,o),this._lastFocusOrigin=o}_getClosestElementsInfo(t){const o=[];return this._elementInfo.forEach((c,u)=>{(u===t||c.checkChildren&&u.contains(t))&&o.push([u,c])}),o}}return n.\u0275fac=function(t){return new(t||n)(ie(nt),ie(ii),ie(i5),ie(Je,8),ie(s5,8))},n.\u0275prov=Pe({factory:function(){return new n(ie(nt),ie(ii),ie(i5),ie(Je,8),ie(s5,8))},token:n,providedIn:"root"}),n})();const a5="cdk-high-contrast-black-on-white",c5="cdk-high-contrast-white-on-black",uU="cdk-high-contrast-active";let l5=(()=>{class n{constructor(t,o){this._platform=t,this._document=o}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const t=this._document.createElement("div");t.style.backgroundColor="rgb(1,2,3)",t.style.position="absolute",this._document.body.appendChild(t);const o=this._document.defaultView||window,c=o&&o.getComputedStyle?o.getComputedStyle(t):null,u=(c&&c.backgroundColor||"").replace(/ /g,"");switch(this._document.body.removeChild(t),u){case"rgb(0,0,0)":return 2;case"rgb(255,255,255)":return 1}return 0}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const t=this._document.body.classList;t.remove(uU),t.remove(a5),t.remove(c5),this._hasCheckedHighContrastMode=!0;const o=this.getHighContrastMode();1===o?(t.add(uU),t.add(a5)):2===o&&(t.add(uU),t.add(c5))}}}return n.\u0275fac=function(t){return new(t||n)(ie(ii),ie(Je))},n.\u0275prov=Pe({factory:function(){return new n(ie(ii),ie(Je))},token:n,providedIn:"root"}),n})(),m7=(()=>{class n{constructor(t){t._applyBodyHighContrastModeCssClasses()}}return n.\u0275fac=function(t){return new(t||n)(ie(l5))},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({imports:[[SR,lU]]}),n})();const d5=new je("cdk-dir-doc",{providedIn:"root",factory:function(){return W0(Je)}});let Gp=(()=>{class n{constructor(t){if(this.value="ltr",this.change=new ft,t){const c=t.documentElement?t.documentElement.dir:null,u=(t.body?t.body.dir:null)||c;this.value="ltr"===u||"rtl"===u?u:"ltr"}}ngOnDestroy(){this.change.complete()}}return n.\u0275fac=function(t){return new(t||n)(ie(d5,8))},n.\u0275prov=Pe({factory:function(){return new n(ie(d5,8))},token:n,providedIn:"root"}),n})(),wR=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({}),n})();const u5=new Ol("12.2.13"),h5=new Ol("12.2.13"),b7=new je("mat-sanity-checks",{providedIn:"root",factory:function(){return!0}});let Sm,ds=(()=>{class n{constructor(t,o,c){this._hasDoneGlobalChecks=!1,this._document=c,t._applyBodyHighContrastModeCssClasses(),this._sanityChecks=o,this._hasDoneGlobalChecks||(this._checkDoctypeIsDefined(),this._checkThemeIsPresent(),this._checkCdkVersionMatch(),this._hasDoneGlobalChecks=!0)}_checkIsEnabled(t){return!(!Ms()||oU())&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[t])}_checkDoctypeIsDefined(){this._checkIsEnabled("doctype")&&!this._document.doctype&&console.warn("Current document does not have a doctype. This may cause some Angular Material components not to behave as expected.")}_checkThemeIsPresent(){if(!this._checkIsEnabled("theme")||!this._document.body||"function"!=typeof getComputedStyle)return;const t=this._document.createElement("div");t.classList.add("mat-theme-loaded-marker"),this._document.body.appendChild(t);const o=getComputedStyle(t);o&&"none"!==o.display&&console.warn("Could not find Angular Material core theme. Most Material components may not work as expected. For more info refer to the theming guide: https://material.angular.io/guide/theming"),this._document.body.removeChild(t)}_checkCdkVersionMatch(){this._checkIsEnabled("version")&&h5.full!==u5.full&&console.warn("The Angular Material version ("+h5.full+") does not match the Angular CDK version ("+u5.full+").\nPlease ensure the versions of these two packages exactly match.")}}return n.\u0275fac=function(t){return new(t||n)(ie(l5),ie(b7,8),ie(Je))},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({imports:[[wR],wR]}),n})();function hU(n){return class extends n{constructor(...e){super(...e),this._disabled=!1}get disabled(){return this._disabled}set disabled(e){this._disabled=br(e)}}}function pU(n,e){return class extends n{constructor(...t){super(...t),this.defaultColor=e,this.color=e}get color(){return this._color}set color(t){const o=t||this.defaultColor;o!==this._color&&(this._color&&this._elementRef.nativeElement.classList.remove(`mat-${this._color}`),o&&this._elementRef.nativeElement.classList.add(`mat-${o}`),this._color=o)}}}function p5(n){return class extends n{constructor(...e){super(...e),this._disableRipple=!1}get disableRipple(){return this._disableRipple}set disableRipple(e){this._disableRipple=br(e)}}}function R7(n,e=0){return class extends n{constructor(...t){super(...t),this._tabIndex=e,this.defaultTabIndex=e}get tabIndex(){return this.disabled?-1:this._tabIndex}set tabIndex(t){this._tabIndex=null!=t?Hp(t):this.defaultTabIndex}}}function I7(n){return class extends n{constructor(...e){super(...e),this.stateChanges=new xt,this.errorState=!1}updateErrorState(){const e=this.errorState,u=(this.errorStateMatcher||this._defaultErrorStateMatcher).isErrorState(this.ngControl?this.ngControl.control:null,this._parentFormGroup||this._parentForm);u!==e&&(this.errorState=u,this.stateChanges.next())}}}try{Sm="undefined"!=typeof Intl}catch(n){Sm=!1}let _5=(()=>{class n{isErrorState(t,o){return!!(t&&t.invalid&&(t.touched||o&&o.submitted))}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Pe({factory:function(){return new n},token:n,providedIn:"root"}),n})();class U7{constructor(e,t,o){this._renderer=e,this.element=t,this.config=o,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const m5={enterDuration:225,exitDuration:150},fU=bR({passive:!0}),g5=["mousedown","touchstart"],E5=["mouseup","mouseleave","touchend","touchcancel"];class B7{constructor(e,t,o,c){this._target=e,this._ngZone=t,this._isPointerDown=!1,this._activeRipples=new Set,this._pointerUpEventsRegistered=!1,c.isBrowser&&(this._containerElement=Lu(o))}fadeInRipple(e,t,o={}){const c=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),u=Object.assign(Object.assign({},m5),o.animation);o.centered&&(e=c.left+c.width/2,t=c.top+c.height/2);const p=o.radius||function(n,e,t){const o=Math.max(Math.abs(n-t.left),Math.abs(n-t.right)),c=Math.max(Math.abs(e-t.top),Math.abs(e-t.bottom));return Math.sqrt(o*o+c*c)}(e,t,c),_=e-c.left,v=t-c.top,S=u.enterDuration,w=document.createElement("div");w.classList.add("mat-ripple-element"),w.style.left=_-p+"px",w.style.top=v-p+"px",w.style.height=2*p+"px",w.style.width=2*p+"px",null!=o.color&&(w.style.backgroundColor=o.color),w.style.transitionDuration=`${S}ms`,this._containerElement.appendChild(w),function(n){window.getComputedStyle(n).getPropertyValue("opacity")}(w),w.style.transform="scale(1)";const M=new U7(this,w,o);return M.state=0,this._activeRipples.add(M),o.persistent||(this._mostRecentTransientRipple=M),this._runTimeoutOutsideZone(()=>{const F=M===this._mostRecentTransientRipple;M.state=1,!o.persistent&&(!F||!this._isPointerDown)&&M.fadeOut()},S),M}fadeOutRipple(e){const t=this._activeRipples.delete(e);if(e===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),this._activeRipples.size||(this._containerRect=null),!t)return;const o=e.element,c=Object.assign(Object.assign({},m5),e.config.animation);o.style.transitionDuration=`${c.exitDuration}ms`,o.style.opacity="0",e.state=2,this._runTimeoutOutsideZone(()=>{e.state=3,o.parentNode.removeChild(o)},c.exitDuration)}fadeOutAll(){this._activeRipples.forEach(e=>e.fadeOut())}fadeOutAllNonPersistent(){this._activeRipples.forEach(e=>{e.config.persistent||e.fadeOut()})}setupTriggerEvents(e){const t=Lu(e);!t||t===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=t,this._registerEvents(g5))}handleEvent(e){"mousedown"===e.type?this._onMousedown(e):"touchstart"===e.type?this._onTouchStart(e):this._onPointerUp(),this._pointerUpEventsRegistered||(this._registerEvents(E5),this._pointerUpEventsRegistered=!0)}_onMousedown(e){const t=Z4(e),o=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!t&&!o&&(this._isPointerDown=!0,this.fadeInRipple(e.clientX,e.clientY,this._target.rippleConfig))}_onTouchStart(e){if(!this._target.rippleDisabled&&!e5(e)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const t=e.changedTouches;for(let o=0;o<t.length;o++)this.fadeInRipple(t[o].clientX,t[o].clientY,this._target.rippleConfig)}}_onPointerUp(){!this._isPointerDown||(this._isPointerDown=!1,this._activeRipples.forEach(e=>{!e.config.persistent&&(1===e.state||e.config.terminateOnPointerUp&&0===e.state)&&e.fadeOut()}))}_runTimeoutOutsideZone(e,t=0){this._ngZone.runOutsideAngular(()=>setTimeout(e,t))}_registerEvents(e){this._ngZone.runOutsideAngular(()=>{e.forEach(t=>{this._triggerElement.addEventListener(t,this,fU)})})}_removeTriggerEvents(){this._triggerElement&&(g5.forEach(e=>{this._triggerElement.removeEventListener(e,this,fU)}),this._pointerUpEventsRegistered&&E5.forEach(e=>{this._triggerElement.removeEventListener(e,this,fU)}))}}const G7=new je("mat-ripple-global-options");let DR=(()=>{class n{constructor(t,o,c,u,p){this._elementRef=t,this._animationMode=p,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=u||{},this._rippleRenderer=new B7(this,o,t,c)}get disabled(){return this._disabled}set disabled(t){t&&this.fadeOutAllNonPersistent(),this._disabled=t,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(t){this._trigger=t,this._setupTriggerEventsIfEnabled()}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:Object.assign(Object.assign(Object.assign({},this._globalOptions.animation),"NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(t,o=0,c){return"number"==typeof t?this._rippleRenderer.fadeInRipple(t,o,Object.assign(Object.assign({},this.rippleConfig),c)):this._rippleRenderer.fadeInRipple(0,0,Object.assign(Object.assign({},this.rippleConfig),t))}}return n.\u0275fac=function(t){return new(t||n)(Y(Ot),Y(nt),Y(ii),Y(G7,8),Y(Lp,8))},n.\u0275dir=Ae({type:n,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(t,o){2&t&&Jt("mat-ripple-unbounded",o.unbounded)},inputs:{radius:["matRippleRadius","radius"],disabled:["matRippleDisabled","disabled"],trigger:["matRippleTrigger","trigger"],color:["matRippleColor","color"],unbounded:["matRippleUnbounded","unbounded"],centered:["matRippleCentered","centered"],animation:["matRippleAnimation","animation"]},exportAs:["matRipple"]}),n})(),_U=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({imports:[[ds,SR],ds]}),n})();const X7=["underline"],Q7=["connectionContainer"],Z7=["inputContainer"],eK=["label"];function tK(n,e){1&n&&(Kd(0),fe(1,"div",14),Ue(2,"div",15),Ue(3,"div",16),Ue(4,"div",17),_e(),fe(5,"div",18),Ue(6,"div",15),Ue(7,"div",16),Ue(8,"div",17),_e(),qd())}function nK(n,e){1&n&&(fe(0,"div",19),Hr(1,1),_e())}function iK(n,e){if(1&n&&(Kd(0),Hr(1,2),fe(2,"span"),Yt(3),_e(),qd()),2&n){const t=bn(2);Ke(3),Pt(t._control.placeholder)}}function rK(n,e){1&n&&Hr(0,3,["*ngSwitchCase","true"])}function oK(n,e){1&n&&(fe(0,"span",23),Yt(1," *"),_e())}function sK(n,e){if(1&n){const t=bl();fe(0,"label",20,21),dn("cdkObserveContent",function(){return $s(t),bn().updateOutlineGap()}),Qn(2,iK,4,1,"ng-container",12),Qn(3,rK,1,0,"ng-content",12),Qn(4,oK,2,0,"span",22),_e()}if(2&n){const t=bn();Jt("mat-empty",t._control.empty&&!t._shouldAlwaysFloat())("mat-form-field-empty",t._control.empty&&!t._shouldAlwaysFloat())("mat-accent","accent"==t.color)("mat-warn","warn"==t.color),Xe("cdkObserveContentDisabled","outline"!=t.appearance)("id",t._labelId)("ngSwitch",t._hasLabel()),yi("for",t._control.id)("aria-owns",t._control.id),Ke(2),Xe("ngSwitchCase",!1),Ke(1),Xe("ngSwitchCase",!0),Ke(1),Xe("ngIf",!t.hideRequiredMarker&&t._control.required&&!t._control.disabled)}}function aK(n,e){1&n&&(fe(0,"div",24),Hr(1,4),_e())}function cK(n,e){if(1&n&&(fe(0,"div",25,26),Ue(2,"span",27),_e()),2&n){const t=bn();Ke(2),Jt("mat-accent","accent"==t.color)("mat-warn","warn"==t.color)}}function lK(n,e){1&n&&(fe(0,"div"),Hr(1,5),_e()),2&n&&Xe("@transitionMessages",bn()._subscriptAnimationState)}function dK(n,e){if(1&n&&(fe(0,"div",31),Yt(1),_e()),2&n){const t=bn(2);Xe("id",t._hintLabelId),Ke(1),Pt(t.hintLabel)}}function uK(n,e){if(1&n&&(fe(0,"div",28),Qn(1,dK,2,2,"div",29),Hr(2,6),Ue(3,"div",30),Hr(4,7),_e()),2&n){const t=bn();Xe("@transitionMessages",t._subscriptAnimationState),Ke(1),Xe("ngIf",t.hintLabel)}}const hK=["*",[["","matPrefix",""]],[["mat-placeholder"]],[["mat-label"]],[["","matSuffix",""]],[["mat-error"]],[["mat-hint",3,"align","end"]],[["mat-hint","align","end"]]],pK=["*","[matPrefix]","mat-placeholder","mat-label","[matSuffix]","mat-error","mat-hint:not([align='end'])","mat-hint[align='end']"],S5=new je("MatError"),_K={transitionMessages:k2("transitionMessages",[L2("enter",Us({opacity:1,transform:"translateY(0%)"})),nR("void => enter",[Us({opacity:0,transform:"translateY(-5px)"}),tR("300ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])};let mU=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=Ae({type:n}),n})();const T5=new je("MatHint");let gU=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=Ae({type:n,selectors:[["mat-label"]]}),n})(),gK=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=Ae({type:n,selectors:[["mat-placeholder"]]}),n})();const b5=new je("MatPrefix"),R5=new je("MatSuffix");let I5=0;const yK=pU(class{constructor(n){this._elementRef=n}},"primary"),vK=new je("MAT_FORM_FIELD_DEFAULT_OPTIONS"),A5=new je("MatFormField");let CK=(()=>{class n extends yK{constructor(t,o,c,u,p,_,v,S){super(t),this._changeDetectorRef=o,this._dir=u,this._defaults=p,this._platform=_,this._ngZone=v,this._outlineGapCalculationNeededImmediately=!1,this._outlineGapCalculationNeededOnStable=!1,this._destroyed=new xt,this._showAlwaysAnimate=!1,this._subscriptAnimationState="",this._hintLabel="",this._hintLabelId="mat-hint-"+I5++,this._labelId="mat-form-field-label-"+I5++,this.floatLabel=this._getDefaultFloatLabelState(),this._animationsEnabled="NoopAnimations"!==S,this.appearance=p&&p.appearance?p.appearance:"legacy",this._hideRequiredMarker=!(!p||null==p.hideRequiredMarker)&&p.hideRequiredMarker}get appearance(){return this._appearance}set appearance(t){const o=this._appearance;this._appearance=t||this._defaults&&this._defaults.appearance||"legacy","outline"===this._appearance&&o!==t&&(this._outlineGapCalculationNeededOnStable=!0)}get hideRequiredMarker(){return this._hideRequiredMarker}set hideRequiredMarker(t){this._hideRequiredMarker=br(t)}_shouldAlwaysFloat(){return"always"===this.floatLabel&&!this._showAlwaysAnimate}_canLabelFloat(){return"never"!==this.floatLabel}get hintLabel(){return this._hintLabel}set hintLabel(t){this._hintLabel=t,this._processHints()}get floatLabel(){return"legacy"!==this.appearance&&"never"===this._floatLabel?"auto":this._floatLabel}set floatLabel(t){t!==this._floatLabel&&(this._floatLabel=t||this._getDefaultFloatLabelState(),this._changeDetectorRef.markForCheck())}get _control(){return this._explicitFormFieldControl||this._controlNonStatic||this._controlStatic}set _control(t){this._explicitFormFieldControl=t}getLabelId(){return this._hasFloatingLabel()?this._labelId:null}getConnectedOverlayOrigin(){return this._connectionContainerRef||this._elementRef}ngAfterContentInit(){this._validateControlChild();const t=this._control;t.controlType&&this._elementRef.nativeElement.classList.add(`mat-form-field-type-${t.controlType}`),t.stateChanges.pipe(hm(null)).subscribe(()=>{this._validatePlaceholders(),this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),t.ngControl&&t.ngControl.valueChanges&&t.ngControl.valueChanges.pipe(fo(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck()),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(fo(this._destroyed)).subscribe(()=>{this._outlineGapCalculationNeededOnStable&&this.updateOutlineGap()})}),sv(this._prefixChildren.changes,this._suffixChildren.changes).subscribe(()=>{this._outlineGapCalculationNeededOnStable=!0,this._changeDetectorRef.markForCheck()}),this._hintChildren.changes.pipe(hm(null)).subscribe(()=>{this._processHints(),this._changeDetectorRef.markForCheck()}),this._errorChildren.changes.pipe(hm(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._dir&&this._dir.change.pipe(fo(this._destroyed)).subscribe(()=>{"function"==typeof requestAnimationFrame?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>this.updateOutlineGap())}):this.updateOutlineGap()})}ngAfterContentChecked(){this._validateControlChild(),this._outlineGapCalculationNeededImmediately&&this.updateOutlineGap()}ngAfterViewInit(){this._subscriptAnimationState="enter",this._changeDetectorRef.detectChanges()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_shouldForward(t){const o=this._control?this._control.ngControl:null;return o&&o[t]}_hasPlaceholder(){return!!(this._control&&this._control.placeholder||this._placeholderChild)}_hasLabel(){return!(!this._labelChildNonStatic&&!this._labelChildStatic)}_shouldLabelFloat(){return this._canLabelFloat()&&(this._control&&this._control.shouldLabelFloat||this._shouldAlwaysFloat())}_hideControlPlaceholder(){return"legacy"===this.appearance&&!this._hasLabel()||this._hasLabel()&&!this._shouldLabelFloat()}_hasFloatingLabel(){return this._hasLabel()||"legacy"===this.appearance&&this._hasPlaceholder()}_getDisplayedMessages(){return this._errorChildren&&this._errorChildren.length>0&&this._control.errorState?"error":"hint"}_animateAndLockLabel(){this._hasFloatingLabel()&&this._canLabelFloat()&&(this._animationsEnabled&&this._label&&(this._showAlwaysAnimate=!0,IR(this._label.nativeElement,"transitionend").pipe(Ao(1)).subscribe(()=>{this._showAlwaysAnimate=!1})),this.floatLabel="always",this._changeDetectorRef.markForCheck())}_validatePlaceholders(){}_processHints(){this._validateHints(),this._syncDescribedByIds()}_validateHints(){}_getDefaultFloatLabelState(){return this._defaults&&this._defaults.floatLabel||"auto"}_syncDescribedByIds(){if(this._control){let t=[];if(this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&t.push(...this._control.userAriaDescribedBy.split(" ")),"hint"===this._getDisplayedMessages()){const o=this._hintChildren?this._hintChildren.find(u=>"start"===u.align):null,c=this._hintChildren?this._hintChildren.find(u=>"end"===u.align):null;o?t.push(o.id):this._hintLabel&&t.push(this._hintLabelId),c&&t.push(c.id)}else this._errorChildren&&t.push(...this._errorChildren.map(o=>o.id));this._control.setDescribedByIds(t)}}_validateControlChild(){}updateOutlineGap(){const t=this._label?this._label.nativeElement:null;if(!("outline"===this.appearance&&t&&t.children.length&&t.textContent.trim()&&this._platform.isBrowser))return;if(!this._isAttachedToDOM())return void(this._outlineGapCalculationNeededImmediately=!0);let o=0,c=0;const u=this._connectionContainerRef.nativeElement,p=u.querySelectorAll(".mat-form-field-outline-start"),_=u.querySelectorAll(".mat-form-field-outline-gap");if(this._label&&this._label.nativeElement.children.length){const v=u.getBoundingClientRect();if(0===v.width&&0===v.height)return this._outlineGapCalculationNeededOnStable=!0,void(this._outlineGapCalculationNeededImmediately=!1);const S=this._getStartEnd(v),w=t.children,M=this._getStartEnd(w[0].getBoundingClientRect());let F=0;for(let j=0;j<w.length;j++)F+=w[j].offsetWidth;o=Math.abs(M-S)-5,c=F>0?.75*F+10:0}for(let v=0;v<p.length;v++)p[v].style.width=`${o}px`;for(let v=0;v<_.length;v++)_[v].style.width=`${c}px`;this._outlineGapCalculationNeededOnStable=this._outlineGapCalculationNeededImmediately=!1}_getStartEnd(t){return this._dir&&"rtl"===this._dir.value?t.right:t.left}_isAttachedToDOM(){const t=this._elementRef.nativeElement;if(t.getRootNode){const o=t.getRootNode();return o&&o!==t}return document.documentElement.contains(t)}}return n.\u0275fac=function(t){return new(t||n)(Y(Ot),Y(zo),Y(Ot),Y(Gp,8),Y(vK,8),Y(ii),Y(nt),Y(Lp,8))},n.\u0275cmp=ki({type:n,selectors:[["mat-form-field"]],contentQueries:function(t,o,c){if(1&t&&(Xo(c,mU,5),Xo(c,mU,7),Xo(c,gU,5),Xo(c,gU,7),Xo(c,gK,5),Xo(c,S5,5),Xo(c,T5,5),Xo(c,b5,5),Xo(c,R5,5)),2&t){let u;jt(u=fn())&&(o._controlNonStatic=u.first),jt(u=fn())&&(o._controlStatic=u.first),jt(u=fn())&&(o._labelChildNonStatic=u.first),jt(u=fn())&&(o._labelChildStatic=u.first),jt(u=fn())&&(o._placeholderChild=u.first),jt(u=fn())&&(o._errorChildren=u),jt(u=fn())&&(o._hintChildren=u),jt(u=fn())&&(o._prefixChildren=u),jt(u=fn())&&(o._suffixChildren=u)}},viewQuery:function(t,o){if(1&t&&(pa(X7,5),pa(Q7,7),pa(Z7,5),pa(eK,5)),2&t){let c;jt(c=fn())&&(o.underlineRef=c.first),jt(c=fn())&&(o._connectionContainerRef=c.first),jt(c=fn())&&(o._inputContainerRef=c.first),jt(c=fn())&&(o._label=c.first)}},hostAttrs:[1,"mat-form-field"],hostVars:40,hostBindings:function(t,o){2&t&&Jt("mat-form-field-appearance-standard","standard"==o.appearance)("mat-form-field-appearance-fill","fill"==o.appearance)("mat-form-field-appearance-outline","outline"==o.appearance)("mat-form-field-appearance-legacy","legacy"==o.appearance)("mat-form-field-invalid",o._control.errorState)("mat-form-field-can-float",o._canLabelFloat())("mat-form-field-should-float",o._shouldLabelFloat())("mat-form-field-has-label",o._hasFloatingLabel())("mat-form-field-hide-placeholder",o._hideControlPlaceholder())("mat-form-field-disabled",o._control.disabled)("mat-form-field-autofilled",o._control.autofilled)("mat-focused",o._control.focused)("ng-untouched",o._shouldForward("untouched"))("ng-touched",o._shouldForward("touched"))("ng-pristine",o._shouldForward("pristine"))("ng-dirty",o._shouldForward("dirty"))("ng-valid",o._shouldForward("valid"))("ng-invalid",o._shouldForward("invalid"))("ng-pending",o._shouldForward("pending"))("_mat-animation-noopable",!o._animationsEnabled)},inputs:{color:"color",floatLabel:"floatLabel",appearance:"appearance",hideRequiredMarker:"hideRequiredMarker",hintLabel:"hintLabel"},exportAs:["matFormField"],features:[Gt([{provide:A5,useExisting:n}]),Dt],ngContentSelectors:pK,decls:15,vars:8,consts:[[1,"mat-form-field-wrapper"],[1,"mat-form-field-flex",3,"click"],["connectionContainer",""],[4,"ngIf"],["class","mat-form-field-prefix",4,"ngIf"],[1,"mat-form-field-infix"],["inputContainer",""],[1,"mat-form-field-label-wrapper"],["class","mat-form-field-label",3,"cdkObserveContentDisabled","id","mat-empty","mat-form-field-empty","mat-accent","mat-warn","ngSwitch","cdkObserveContent",4,"ngIf"],["class","mat-form-field-suffix",4,"ngIf"],["class","mat-form-field-underline",4,"ngIf"],[1,"mat-form-field-subscript-wrapper",3,"ngSwitch"],[4,"ngSwitchCase"],["class","mat-form-field-hint-wrapper",4,"ngSwitchCase"],[1,"mat-form-field-outline"],[1,"mat-form-field-outline-start"],[1,"mat-form-field-outline-gap"],[1,"mat-form-field-outline-end"],[1,"mat-form-field-outline","mat-form-field-outline-thick"],[1,"mat-form-field-prefix"],[1,"mat-form-field-label",3,"cdkObserveContentDisabled","id","ngSwitch","cdkObserveContent"],["label",""],["class","mat-placeholder-required mat-form-field-required-marker","aria-hidden","true",4,"ngIf"],["aria-hidden","true",1,"mat-placeholder-required","mat-form-field-required-marker"],[1,"mat-form-field-suffix"],[1,"mat-form-field-underline"],["underline",""],[1,"mat-form-field-ripple"],[1,"mat-form-field-hint-wrapper"],["class","mat-hint",3,"id",4,"ngIf"],[1,"mat-form-field-hint-spacer"],[1,"mat-hint",3,"id"]],template:function(t,o){1&t&&(Rl(hK),fe(0,"div",0),fe(1,"div",1,2),dn("click",function(u){return o._control.onContainerClick&&o._control.onContainerClick(u)}),Qn(3,tK,9,0,"ng-container",3),Qn(4,nK,2,0,"div",4),fe(5,"div",5,6),Hr(7),fe(8,"span",7),Qn(9,sK,5,16,"label",8),_e(),_e(),Qn(10,aK,2,0,"div",9),_e(),Qn(11,cK,3,4,"div",10),fe(12,"div",11),Qn(13,lK,2,1,"div",12),Qn(14,uK,5,2,"div",13),_e(),_e()),2&t&&(Ke(3),Xe("ngIf","outline"==o.appearance),Ke(1),Xe("ngIf",o._prefixChildren.length),Ke(5),Xe("ngIf",o._hasFloatingLabel()),Ke(1),Xe("ngIf",o._suffixChildren.length),Ke(1),Xe("ngIf","outline"!=o.appearance),Ke(1),Xe("ngSwitch",o._getDisplayedMessages()),Ke(1),Xe("ngSwitchCase","error"),Ke(1),Xe("ngSwitchCase","hint"))},directives:[qn,Cy,TN,W4],styles:[".mat-form-field{display:inline-block;position:relative;text-align:left}[dir=rtl] .mat-form-field{text-align:right}.mat-form-field-wrapper{position:relative}.mat-form-field-flex{display:inline-flex;align-items:baseline;box-sizing:border-box;width:100%}.mat-form-field-prefix,.mat-form-field-suffix{white-space:nowrap;flex:none;position:relative}.mat-form-field-infix{display:block;position:relative;flex:auto;min-width:0;width:180px}.cdk-high-contrast-active .mat-form-field-infix{border-image:linear-gradient(transparent, transparent)}.mat-form-field-label-wrapper{position:absolute;left:0;box-sizing:content-box;width:100%;height:100%;overflow:hidden;pointer-events:none}[dir=rtl] .mat-form-field-label-wrapper{left:auto;right:0}.mat-form-field-label{position:absolute;left:0;font:inherit;pointer-events:none;width:100%;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;transform-origin:0 0;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),color 400ms cubic-bezier(0.25, 0.8, 0.25, 1),width 400ms cubic-bezier(0.25, 0.8, 0.25, 1);display:none}[dir=rtl] .mat-form-field-label{transform-origin:100% 0;left:auto;right:0}.mat-form-field-empty.mat-form-field-label,.mat-form-field-can-float.mat-form-field-should-float .mat-form-field-label{display:block}.mat-form-field-autofill-control:-webkit-autofill+.mat-form-field-label-wrapper .mat-form-field-label{display:none}.mat-form-field-can-float .mat-form-field-autofill-control:-webkit-autofill+.mat-form-field-label-wrapper .mat-form-field-label{display:block;transition:none}.mat-input-server:focus+.mat-form-field-label-wrapper .mat-form-field-label,.mat-input-server[placeholder]:not(:placeholder-shown)+.mat-form-field-label-wrapper .mat-form-field-label{display:none}.mat-form-field-can-float .mat-input-server:focus+.mat-form-field-label-wrapper .mat-form-field-label,.mat-form-field-can-float .mat-input-server[placeholder]:not(:placeholder-shown)+.mat-form-field-label-wrapper .mat-form-field-label{display:block}.mat-form-field-label:not(.mat-form-field-empty){transition:none}.mat-form-field-underline{position:absolute;width:100%;pointer-events:none;transform:scale3d(1, 1.0001, 1)}.mat-form-field-ripple{position:absolute;left:0;width:100%;transform-origin:50%;transform:scaleX(0.5);opacity:0;transition:background-color 300ms cubic-bezier(0.55, 0, 0.55, 0.2)}.mat-form-field.mat-focused .mat-form-field-ripple,.mat-form-field.mat-form-field-invalid .mat-form-field-ripple{opacity:1;transform:none;transition:transform 300ms cubic-bezier(0.25, 0.8, 0.25, 1),opacity 100ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 300ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-subscript-wrapper{position:absolute;box-sizing:border-box;width:100%;overflow:hidden}.mat-form-field-subscript-wrapper .mat-icon,.mat-form-field-label-wrapper .mat-icon{width:1em;height:1em;font-size:inherit;vertical-align:baseline}.mat-form-field-hint-wrapper{display:flex}.mat-form-field-hint-spacer{flex:1 0 1em}.mat-error{display:block}.mat-form-field-control-wrapper{position:relative}.mat-form-field-hint-end{order:1}.mat-form-field._mat-animation-noopable .mat-form-field-label,.mat-form-field._mat-animation-noopable .mat-form-field-ripple{transition:none}\n",'.mat-form-field-appearance-fill .mat-form-field-flex{border-radius:4px 4px 0 0;padding:.75em .75em 0 .75em}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-form-field-flex{outline:solid 1px}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-focused .mat-form-field-flex{outline:dashed 3px}.mat-form-field-appearance-fill .mat-form-field-underline::before{content:"";display:block;position:absolute;bottom:0;height:1px;width:100%}.mat-form-field-appearance-fill .mat-form-field-ripple{bottom:0;height:2px}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-form-field-ripple{height:0}.mat-form-field-appearance-fill:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{opacity:1;transform:none;transition:opacity 600ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-fill._mat-animation-noopable:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{transition:none}.mat-form-field-appearance-fill .mat-form-field-subscript-wrapper{padding:0 1em}\n','.mat-input-element{font:inherit;background:transparent;color:currentColor;border:none;outline:none;padding:0;margin:0;width:100%;max-width:100%;vertical-align:bottom;text-align:inherit;box-sizing:content-box}.mat-input-element:-moz-ui-invalid{box-shadow:none}.mat-input-element::-ms-clear,.mat-input-element::-ms-reveal{display:none}.mat-input-element,.mat-input-element::-webkit-search-cancel-button,.mat-input-element::-webkit-search-decoration,.mat-input-element::-webkit-search-results-button,.mat-input-element::-webkit-search-results-decoration{-webkit-appearance:none}.mat-input-element::-webkit-contacts-auto-fill-button,.mat-input-element::-webkit-caps-lock-indicator,.mat-input-element:not([type=password])::-webkit-credentials-auto-fill-button{visibility:hidden}.mat-input-element[type=date],.mat-input-element[type=datetime],.mat-input-element[type=datetime-local],.mat-input-element[type=month],.mat-input-element[type=week],.mat-input-element[type=time]{line-height:1}.mat-input-element[type=date]::after,.mat-input-element[type=datetime]::after,.mat-input-element[type=datetime-local]::after,.mat-input-element[type=month]::after,.mat-input-element[type=week]::after,.mat-input-element[type=time]::after{content:" ";white-space:pre;width:1px}.mat-input-element::-webkit-inner-spin-button,.mat-input-element::-webkit-calendar-picker-indicator,.mat-input-element::-webkit-clear-button{font-size:.75em}.mat-input-element::placeholder{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-input-element::placeholder:-ms-input-placeholder{-ms-user-select:text}.mat-input-element::-moz-placeholder{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-input-element::-moz-placeholder:-ms-input-placeholder{-ms-user-select:text}.mat-input-element::-webkit-input-placeholder{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-input-element::-webkit-input-placeholder:-ms-input-placeholder{-ms-user-select:text}.mat-input-element:-ms-input-placeholder{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-input-element:-ms-input-placeholder:-ms-input-placeholder{-ms-user-select:text}.mat-form-field-hide-placeholder .mat-input-element::placeholder{color:transparent !important;-webkit-text-fill-color:transparent;transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element::placeholder{opacity:0}.mat-form-field-hide-placeholder .mat-input-element::-moz-placeholder{color:transparent !important;-webkit-text-fill-color:transparent;transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element::-moz-placeholder{opacity:0}.mat-form-field-hide-placeholder .mat-input-element::-webkit-input-placeholder{color:transparent !important;-webkit-text-fill-color:transparent;transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element::-webkit-input-placeholder{opacity:0}.mat-form-field-hide-placeholder .mat-input-element:-ms-input-placeholder{color:transparent !important;-webkit-text-fill-color:transparent;transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element:-ms-input-placeholder{opacity:0}textarea.mat-input-element{resize:vertical;overflow:auto}textarea.mat-input-element.cdk-textarea-autosize{resize:none}textarea.mat-input-element{padding:2px 0;margin:-2px 0}select.mat-input-element{-moz-appearance:none;-webkit-appearance:none;position:relative;background-color:transparent;display:inline-flex;box-sizing:border-box;padding-top:1em;top:-1em;margin-bottom:-1em}select.mat-input-element::-ms-expand{display:none}select.mat-input-element::-moz-focus-inner{border:0}select.mat-input-element:not(:disabled){cursor:pointer}select.mat-input-element::-ms-value{color:inherit;background:none}.mat-focused .cdk-high-contrast-active select.mat-input-element::-ms-value{color:inherit}.mat-form-field-type-mat-native-select .mat-form-field-infix::after{content:"";width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:5px solid;position:absolute;top:50%;right:0;margin-top:-2.5px;pointer-events:none}[dir=rtl] .mat-form-field-type-mat-native-select .mat-form-field-infix::after{right:auto;left:0}.mat-form-field-type-mat-native-select .mat-input-element{padding-right:15px}[dir=rtl] .mat-form-field-type-mat-native-select .mat-input-element{padding-right:0;padding-left:15px}.mat-form-field-type-mat-native-select .mat-form-field-label-wrapper{max-width:calc(100% - 10px)}.mat-form-field-type-mat-native-select.mat-form-field-appearance-outline .mat-form-field-infix::after{margin-top:-5px}.mat-form-field-type-mat-native-select.mat-form-field-appearance-fill .mat-form-field-infix::after{margin-top:-10px}\n',".mat-form-field-appearance-legacy .mat-form-field-label{transform:perspective(100px);-ms-transform:none}.mat-form-field-appearance-legacy .mat-form-field-prefix .mat-icon,.mat-form-field-appearance-legacy .mat-form-field-suffix .mat-icon{width:1em}.mat-form-field-appearance-legacy .mat-form-field-prefix .mat-icon-button,.mat-form-field-appearance-legacy .mat-form-field-suffix .mat-icon-button{font:inherit;vertical-align:baseline}.mat-form-field-appearance-legacy .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field-appearance-legacy .mat-form-field-suffix .mat-icon-button .mat-icon{font-size:inherit}.mat-form-field-appearance-legacy .mat-form-field-underline{height:1px}.cdk-high-contrast-active .mat-form-field-appearance-legacy .mat-form-field-underline{height:0;border-top:solid 1px}.mat-form-field-appearance-legacy .mat-form-field-ripple{top:0;height:2px;overflow:hidden}.cdk-high-contrast-active .mat-form-field-appearance-legacy .mat-form-field-ripple{height:0;border-top:solid 2px}.mat-form-field-appearance-legacy.mat-form-field-disabled .mat-form-field-underline{background-position:0;background-color:transparent}.cdk-high-contrast-active .mat-form-field-appearance-legacy.mat-form-field-disabled .mat-form-field-underline{border-top-style:dotted;border-top-width:2px}.mat-form-field-appearance-legacy.mat-form-field-invalid:not(.mat-focused) .mat-form-field-ripple{height:1px}\n",".mat-form-field-appearance-outline .mat-form-field-wrapper{margin:.25em 0}.mat-form-field-appearance-outline .mat-form-field-flex{padding:0 .75em 0 .75em;margin-top:-0.25em;position:relative}.mat-form-field-appearance-outline .mat-form-field-prefix,.mat-form-field-appearance-outline .mat-form-field-suffix{top:.25em}.mat-form-field-appearance-outline .mat-form-field-outline{display:flex;position:absolute;top:.25em;left:0;right:0;bottom:0;pointer-events:none}.mat-form-field-appearance-outline .mat-form-field-outline-start,.mat-form-field-appearance-outline .mat-form-field-outline-end{border:1px solid currentColor;min-width:5px}.mat-form-field-appearance-outline .mat-form-field-outline-start{border-radius:5px 0 0 5px;border-right-style:none}[dir=rtl] .mat-form-field-appearance-outline .mat-form-field-outline-start{border-right-style:solid;border-left-style:none;border-radius:0 5px 5px 0}.mat-form-field-appearance-outline .mat-form-field-outline-end{border-radius:0 5px 5px 0;border-left-style:none;flex-grow:1}[dir=rtl] .mat-form-field-appearance-outline .mat-form-field-outline-end{border-left-style:solid;border-right-style:none;border-radius:5px 0 0 5px}.mat-form-field-appearance-outline .mat-form-field-outline-gap{border-radius:.000001px;border:1px solid currentColor;border-left-style:none;border-right-style:none}.mat-form-field-appearance-outline.mat-form-field-can-float.mat-form-field-should-float .mat-form-field-outline-gap{border-top-color:transparent}.mat-form-field-appearance-outline .mat-form-field-outline-thick{opacity:0}.mat-form-field-appearance-outline .mat-form-field-outline-thick .mat-form-field-outline-start,.mat-form-field-appearance-outline .mat-form-field-outline-thick .mat-form-field-outline-end,.mat-form-field-appearance-outline .mat-form-field-outline-thick .mat-form-field-outline-gap{border-width:2px}.mat-form-field-appearance-outline.mat-focused .mat-form-field-outline,.mat-form-field-appearance-outline.mat-form-field-invalid .mat-form-field-outline{opacity:0;transition:opacity 100ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-outline.mat-focused .mat-form-field-outline-thick,.mat-form-field-appearance-outline.mat-form-field-invalid .mat-form-field-outline-thick{opacity:1}.cdk-high-contrast-active .mat-form-field-appearance-outline.mat-focused .mat-form-field-outline-thick{border:3px dashed}.mat-form-field-appearance-outline:not(.mat-form-field-disabled) .mat-form-field-flex:hover .mat-form-field-outline{opacity:0;transition:opacity 600ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-outline:not(.mat-form-field-disabled) .mat-form-field-flex:hover .mat-form-field-outline-thick{opacity:1}.mat-form-field-appearance-outline .mat-form-field-subscript-wrapper{padding:0 1em}.mat-form-field-appearance-outline._mat-animation-noopable:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-outline,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline-start,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline-end,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline-gap{transition:none}\n",".mat-form-field-appearance-standard .mat-form-field-flex{padding-top:.75em}.mat-form-field-appearance-standard .mat-form-field-underline{height:1px}.cdk-high-contrast-active .mat-form-field-appearance-standard .mat-form-field-underline{height:0;border-top:solid 1px}.mat-form-field-appearance-standard .mat-form-field-ripple{bottom:0;height:2px}.cdk-high-contrast-active .mat-form-field-appearance-standard .mat-form-field-ripple{height:0;border-top:solid 2px}.mat-form-field-appearance-standard.mat-form-field-disabled .mat-form-field-underline{background-position:0;background-color:transparent}.cdk-high-contrast-active .mat-form-field-appearance-standard.mat-form-field-disabled .mat-form-field-underline{border-top-style:dotted;border-top-width:2px}.mat-form-field-appearance-standard:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{opacity:1;transform:none;transition:opacity 600ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-standard._mat-animation-noopable:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{transition:none}\n"],encapsulation:2,data:{animation:[_K.transitionMessages]},changeDetection:0}),n})(),D5=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({imports:[[im,ds,lU],ds]}),n})();const SK=new je("MAT_INPUT_VALUE_ACCESSOR"),TK=["button","checkbox","file","hidden","image","radio","range","reset","submit"];let bK=0;const RK=I7(class{constructor(n,e,t,o){this._defaultErrorStateMatcher=n,this._parentForm=e,this._parentFormGroup=t,this.ngControl=o}});let IK=(()=>{class n extends RK{constructor(t,o,c,u,p,_,v,S,w,M){super(_,u,p,c),this._elementRef=t,this._platform=o,this._autofillMonitor=S,this._formField=M,this._uid="mat-input-"+bK++,this.focused=!1,this.stateChanges=new xt,this.controlType="mat-input",this.autofilled=!1,this._disabled=!1,this._required=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(W=>N4().has(W));const F=this._elementRef.nativeElement,j=F.nodeName.toLowerCase();this._inputValueAccessor=v||F,this._previousNativeValue=this.value,this.id=this.id,o.IOS&&w.runOutsideAngular(()=>{t.nativeElement.addEventListener("keyup",W=>{const ee=W.target;!ee.value&&0===ee.selectionStart&&0===ee.selectionEnd&&(ee.setSelectionRange(1,1),ee.setSelectionRange(0,0))})}),this._isServer=!this._platform.isBrowser,this._isNativeSelect="select"===j,this._isTextarea="textarea"===j,this._isInFormField=!!M,this._isNativeSelect&&(this.controlType=F.multiple?"mat-native-select-multiple":"mat-native-select")}get disabled(){return this.ngControl&&null!==this.ngControl.disabled?this.ngControl.disabled:this._disabled}set disabled(t){this._disabled=br(t),this.focused&&(this.focused=!1,this.stateChanges.next())}get id(){return this._id}set id(t){this._id=t||this._uid}get required(){return this._required}set required(t){this._required=br(t)}get type(){return this._type}set type(t){this._type=t||"text",this._validateType(),!this._isTextarea&&N4().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get value(){return this._inputValueAccessor.value}set value(t){t!==this.value&&(this._inputValueAccessor.value=t,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(t){this._readonly=br(t)}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(t=>{this.autofilled=t.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement)}ngDoCheck(){this.ngControl&&this.updateErrorState(),this._dirtyCheckNativeValue(),this._dirtyCheckPlaceholder()}focus(t){this._elementRef.nativeElement.focus(t)}_focusChanged(t){t!==this.focused&&(this.focused=t,this.stateChanges.next())}_onInput(){}_dirtyCheckPlaceholder(){var t,o;const c=(null===(o=null===(t=this._formField)||void 0===t?void 0:t._hideControlPlaceholder)||void 0===o?void 0:o.call(t))?null:this.placeholder;if(c!==this._previousPlaceholder){const u=this._elementRef.nativeElement;this._previousPlaceholder=c,c?u.setAttribute("placeholder",c):u.removeAttribute("placeholder")}}_dirtyCheckNativeValue(){const t=this._elementRef.nativeElement.value;this._previousNativeValue!==t&&(this._previousNativeValue=t,this.stateChanges.next())}_validateType(){TK.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){let t=this._elementRef.nativeElement.validity;return t&&t.badInput}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}get shouldLabelFloat(){if(this._isNativeSelect){const t=this._elementRef.nativeElement,o=t.options[0];return this.focused||t.multiple||!this.empty||!!(t.selectedIndex>-1&&o&&o.label)}return this.focused||!this.empty}setDescribedByIds(t){t.length?this._elementRef.nativeElement.setAttribute("aria-describedby",t.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}_isInlineSelect(){const t=this._elementRef.nativeElement;return this._isNativeSelect&&(t.multiple||t.size>1)}}return n.\u0275fac=function(t){return new(t||n)(Y(Ot),Y(ii),Y(ku,10),Y(BP,8),Y(CR,8),Y(_5),Y(SK,10),Y(F4),Y(nt),Y(A5,8))},n.\u0275dir=Ae({type:n,selectors:[["input","matInput",""],["textarea","matInput",""],["select","matNativeControl",""],["input","matNativeControl",""],["textarea","matNativeControl",""]],hostAttrs:[1,"mat-input-element","mat-form-field-autofill-control"],hostVars:11,hostBindings:function(t,o){1&t&&dn("focus",function(){return o._focusChanged(!0)})("blur",function(){return o._focusChanged(!1)})("input",function(){return o._onInput()}),2&t&&(Xd("disabled",o.disabled)("required",o.required),yi("id",o.id)("data-placeholder",o.placeholder)("readonly",o.readonly&&!o._isNativeSelect||null)("aria-invalid",o.empty&&o.required?null:o.errorState)("aria-required",o.required),Jt("mat-input-server",o._isServer)("mat-native-select-inline",o._isInlineSelect()))},inputs:{id:"id",disabled:"disabled",required:"required",type:"type",value:"value",readonly:"readonly",placeholder:"placeholder",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"]},exportAs:["matInput"],features:[Gt([{provide:mU,useExisting:n}]),Dt,Wi]}),n})(),wK=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({providers:[_5],imports:[[U4,D5,ds],U4,D5]}),n})();const O5=["mat-button",""],N5=["*"],DK=["mat-button","mat-flat-button","mat-icon-button","mat-raised-button","mat-stroked-button","mat-mini-fab","mat-fab"],OK=pU(hU(p5(class{constructor(n){this._elementRef=n}})));let M5=(()=>{class n extends OK{constructor(t,o,c){super(t),this._focusMonitor=o,this._animationMode=c,this.isRoundButton=this._hasHostAttributes("mat-fab","mat-mini-fab"),this.isIconButton=this._hasHostAttributes("mat-icon-button");for(const u of DK)this._hasHostAttributes(u)&&this._getHostElement().classList.add(u);t.nativeElement.classList.add("mat-button-base"),this.isRoundButton&&(this.color="accent")}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(t,o){t?this._focusMonitor.focusVia(this._getHostElement(),t,o):this._getHostElement().focus(o)}_getHostElement(){return this._elementRef.nativeElement}_isRippleDisabled(){return this.disableRipple||this.disabled}_hasHostAttributes(...t){return t.some(o=>this._getHostElement().hasAttribute(o))}}return n.\u0275fac=function(t){return new(t||n)(Y(Ot),Y(Gy),Y(Lp,8))},n.\u0275cmp=ki({type:n,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-icon-button",""],["button","mat-fab",""],["button","mat-mini-fab",""],["button","mat-stroked-button",""],["button","mat-flat-button",""]],viewQuery:function(t,o){if(1&t&&pa(DR,5),2&t){let c;jt(c=fn())&&(o.ripple=c.first)}},hostAttrs:[1,"mat-focus-indicator"],hostVars:5,hostBindings:function(t,o){2&t&&(yi("disabled",o.disabled||null),Jt("_mat-animation-noopable","NoopAnimations"===o._animationMode)("mat-button-disabled",o.disabled))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color"},exportAs:["matButton"],features:[Dt],attrs:O5,ngContentSelectors:N5,decls:4,vars:5,consts:[[1,"mat-button-wrapper"],["matRipple","",1,"mat-button-ripple",3,"matRippleDisabled","matRippleCentered","matRippleTrigger"],[1,"mat-button-focus-overlay"]],template:function(t,o){1&t&&(Rl(),fe(0,"span",0),Hr(1),_e(),Ue(2,"span",1),Ue(3,"span",2)),2&t&&(Ke(2),Jt("mat-button-ripple-round",o.isRoundButton||o.isIconButton),Xe("matRippleDisabled",o._isRippleDisabled())("matRippleCentered",o.isIconButton)("matRippleTrigger",o._getHostElement()))},directives:[DR],styles:[".mat-button .mat-button-focus-overlay,.mat-icon-button .mat-button-focus-overlay{opacity:0}.mat-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay,.mat-stroked-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay{opacity:.04}@media(hover: none){.mat-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay,.mat-stroked-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay{opacity:0}}.mat-button,.mat-icon-button,.mat-stroked-button,.mat-flat-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-button.mat-button-disabled,.mat-icon-button.mat-button-disabled,.mat-stroked-button.mat-button-disabled,.mat-flat-button.mat-button-disabled{cursor:default}.mat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-button.cdk-program-focused .mat-button-focus-overlay,.mat-icon-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-icon-button.cdk-program-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-program-focused .mat-button-focus-overlay,.mat-flat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-flat-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-raised-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-raised-button::-moz-focus-inner{border:0}.mat-raised-button.mat-button-disabled{cursor:default}.mat-raised-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-raised-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-raised-button::-moz-focus-inner{border:0}._mat-animation-noopable.mat-raised-button{transition:none;animation:none}.mat-stroked-button{border:1px solid currentColor;padding:0 15px;line-height:34px}.mat-stroked-button .mat-button-ripple.mat-ripple,.mat-stroked-button .mat-button-focus-overlay{top:-1px;left:-1px;right:-1px;bottom:-1px}.mat-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:56px;height:56px;padding:0;flex-shrink:0}.mat-fab::-moz-focus-inner{border:0}.mat-fab.mat-button-disabled{cursor:default}.mat-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-fab{transition:none;animation:none}.mat-fab .mat-button-wrapper{padding:16px 0;display:inline-block;line-height:24px}.mat-mini-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:40px;height:40px;padding:0;flex-shrink:0}.mat-mini-fab::-moz-focus-inner{border:0}.mat-mini-fab.mat-button-disabled{cursor:default}.mat-mini-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-mini-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-mini-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-mini-fab{transition:none;animation:none}.mat-mini-fab .mat-button-wrapper{padding:8px 0;display:inline-block;line-height:24px}.mat-icon-button{padding:0;min-width:0;width:40px;height:40px;flex-shrink:0;line-height:40px;border-radius:50%}.mat-icon-button i,.mat-icon-button .mat-icon{line-height:24px}.mat-button-ripple.mat-ripple,.mat-button-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-button-ripple.mat-ripple:not(:empty){transform:translateZ(0)}.mat-button-focus-overlay{opacity:0;transition:opacity 200ms cubic-bezier(0.35, 0, 0.25, 1),background-color 200ms cubic-bezier(0.35, 0, 0.25, 1)}._mat-animation-noopable .mat-button-focus-overlay{transition:none}.mat-button-ripple-round{border-radius:50%;z-index:1}.mat-button .mat-button-wrapper>*,.mat-flat-button .mat-button-wrapper>*,.mat-stroked-button .mat-button-wrapper>*,.mat-raised-button .mat-button-wrapper>*,.mat-icon-button .mat-button-wrapper>*,.mat-fab .mat-button-wrapper>*,.mat-mini-fab .mat-button-wrapper>*{vertical-align:middle}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button{display:inline-flex;justify-content:center;align-items:center;font-size:inherit;width:2.5em;height:2.5em}.cdk-high-contrast-active .mat-button,.cdk-high-contrast-active .mat-flat-button,.cdk-high-contrast-active .mat-raised-button,.cdk-high-contrast-active .mat-icon-button,.cdk-high-contrast-active .mat-fab,.cdk-high-contrast-active .mat-mini-fab{outline:solid 1px}.cdk-high-contrast-active .mat-button-base.cdk-keyboard-focused,.cdk-high-contrast-active .mat-button-base.cdk-program-focused{outline:solid 3px}\n"],encapsulation:2,changeDetection:0}),n})(),NK=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({imports:[[_U,ds],ds]}),n})();const PK=["thumbContainer"],MK=["toggleBar"],kK=["input"],LK=function(n){return{enterDuration:n}},xK=["*"],FK=new je("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1})});let UK=0;const VK={provide:Qc,useExisting:Ln(()=>k5),multi:!0};class BK{constructor(e,t){this.source=e,this.checked=t}}const jK=R7(pU(p5(hU(class{constructor(n){this._elementRef=n}}))));let k5=(()=>{class n extends jK{constructor(t,o,c,u,p,_){super(t),this._focusMonitor=o,this._changeDetectorRef=c,this.defaults=p,this._onChange=v=>{},this._onTouched=()=>{},this._uniqueId="mat-slide-toggle-"+ ++UK,this._required=!1,this._checked=!1,this.name=null,this.id=this._uniqueId,this.labelPosition="after",this.ariaLabel=null,this.ariaLabelledby=null,this.change=new ft,this.toggleChange=new ft,this.tabIndex=parseInt(u)||0,this.color=this.defaultColor=p.color||"accent",this._noopAnimations="NoopAnimations"===_}get required(){return this._required}set required(t){this._required=br(t)}get checked(){return this._checked}set checked(t){this._checked=br(t),this._changeDetectorRef.markForCheck()}get inputId(){return`${this.id||this._uniqueId}-input`}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{"keyboard"===t||"program"===t?this._inputElement.nativeElement.focus():t||Promise.resolve().then(()=>this._onTouched())})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}_onChangeEvent(t){t.stopPropagation(),this.toggleChange.emit(),this.defaults.disableToggleValue?this._inputElement.nativeElement.checked=this.checked:(this.checked=this._inputElement.nativeElement.checked,this._emitChangeEvent())}_onInputClick(t){t.stopPropagation()}writeValue(t){this.checked=!!t}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this.disabled=t,this._changeDetectorRef.markForCheck()}focus(t,o){o?this._focusMonitor.focusVia(this._inputElement,o,t):this._inputElement.nativeElement.focus(t)}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(new BK(this,this.checked))}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}}return n.\u0275fac=function(t){return new(t||n)(Y(Ot),Y(Gy),Y(zo),fc("tabindex"),Y(FK),Y(Lp,8))},n.\u0275cmp=ki({type:n,selectors:[["mat-slide-toggle"]],viewQuery:function(t,o){if(1&t&&(pa(PK,5),pa(MK,5),pa(kK,5)),2&t){let c;jt(c=fn())&&(o._thumbEl=c.first),jt(c=fn())&&(o._thumbBarEl=c.first),jt(c=fn())&&(o._inputElement=c.first)}},hostAttrs:[1,"mat-slide-toggle"],hostVars:12,hostBindings:function(t,o){2&t&&(Xd("id",o.id),yi("tabindex",o.disabled?null:-1)("aria-label",null)("aria-labelledby",null),Jt("mat-checked",o.checked)("mat-disabled",o.disabled)("mat-slide-toggle-label-before","before"==o.labelPosition)("_mat-animation-noopable",o._noopAnimations))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color",tabIndex:"tabIndex",name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],required:"required",checked:"checked",ariaDescribedby:["aria-describedby","ariaDescribedby"]},outputs:{change:"change",toggleChange:"toggleChange"},exportAs:["matSlideToggle"],features:[Gt([VK]),Dt],ngContentSelectors:xK,decls:16,vars:20,consts:[[1,"mat-slide-toggle-label"],["label",""],[1,"mat-slide-toggle-bar"],["toggleBar",""],["type","checkbox","role","switch",1,"mat-slide-toggle-input","cdk-visually-hidden",3,"id","required","tabIndex","checked","disabled","change","click"],["input",""],[1,"mat-slide-toggle-thumb-container"],["thumbContainer",""],[1,"mat-slide-toggle-thumb"],["mat-ripple","",1,"mat-slide-toggle-ripple","mat-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered","matRippleRadius","matRippleAnimation"],[1,"mat-ripple-element","mat-slide-toggle-persistent-ripple"],[1,"mat-slide-toggle-content",3,"cdkObserveContent"],["labelContent",""],[2,"display","none"]],template:function(t,o){if(1&t&&(Rl(),fe(0,"label",0,1),fe(2,"div",2,3),fe(4,"input",4,5),dn("change",function(u){return o._onChangeEvent(u)})("click",function(u){return o._onInputClick(u)}),_e(),fe(6,"div",6,7),Ue(8,"div",8),fe(9,"div",9),Ue(10,"div",10),_e(),_e(),_e(),fe(11,"span",11,12),dn("cdkObserveContent",function(){return o._onLabelTextChange()}),fe(13,"span",13),Yt(14,"\xa0"),_e(),Hr(15),_e(),_e()),2&t){const c=Bg(1),u=Bg(12);yi("for",o.inputId),Ke(2),Jt("mat-slide-toggle-bar-no-side-margin",!u.textContent||!u.textContent.trim()),Ke(2),Xe("id",o.inputId)("required",o.required)("tabIndex",o.tabIndex)("checked",o.checked)("disabled",o.disabled),yi("name",o.name)("aria-checked",o.checked.toString())("aria-label",o.ariaLabel)("aria-labelledby",o.ariaLabelledby)("aria-describedby",o.ariaDescribedby),Ke(5),Xe("matRippleTrigger",c)("matRippleDisabled",o.disableRipple||o.disabled)("matRippleCentered",!0)("matRippleRadius",20)("matRippleAnimation",function(n,e,t,o){return BD(Ee(),to(),n,e,t,o)}(18,LK,o._noopAnimations?0:150))}},directives:[DR,W4],styles:[".mat-slide-toggle{display:inline-block;height:24px;max-width:100%;line-height:24px;white-space:nowrap;outline:none;-webkit-tap-highlight-color:transparent}.mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container{transform:translate3d(16px, 0, 0)}[dir=rtl] .mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container{transform:translate3d(-16px, 0, 0)}.mat-slide-toggle.mat-disabled{opacity:.38}.mat-slide-toggle.mat-disabled .mat-slide-toggle-label,.mat-slide-toggle.mat-disabled .mat-slide-toggle-thumb-container{cursor:default}.mat-slide-toggle-label{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:flex;flex:1;flex-direction:row;align-items:center;height:inherit;cursor:pointer}.mat-slide-toggle-content{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.mat-slide-toggle-label-before .mat-slide-toggle-label{order:1}.mat-slide-toggle-label-before .mat-slide-toggle-bar{order:2}[dir=rtl] .mat-slide-toggle-label-before .mat-slide-toggle-bar,.mat-slide-toggle-bar{margin-right:8px;margin-left:0}[dir=rtl] .mat-slide-toggle-bar,.mat-slide-toggle-label-before .mat-slide-toggle-bar{margin-left:8px;margin-right:0}.mat-slide-toggle-bar-no-side-margin{margin-left:0;margin-right:0}.mat-slide-toggle-thumb-container{position:absolute;z-index:1;width:20px;height:20px;top:-3px;left:0;transform:translate3d(0, 0, 0);transition:all 80ms linear;transition-property:transform}._mat-animation-noopable .mat-slide-toggle-thumb-container{transition:none}[dir=rtl] .mat-slide-toggle-thumb-container{left:auto;right:0}.mat-slide-toggle-thumb{height:20px;width:20px;border-radius:50%}.mat-slide-toggle-bar{position:relative;width:36px;height:14px;flex-shrink:0;border-radius:8px}.mat-slide-toggle-input{bottom:0;left:10px}[dir=rtl] .mat-slide-toggle-input{left:auto;right:10px}.mat-slide-toggle-bar,.mat-slide-toggle-thumb{transition:all 80ms linear;transition-property:background-color;transition-delay:50ms}._mat-animation-noopable .mat-slide-toggle-bar,._mat-animation-noopable .mat-slide-toggle-thumb{transition:none}.mat-slide-toggle .mat-slide-toggle-ripple{position:absolute;top:calc(50% - 20px);left:calc(50% - 20px);height:40px;width:40px;z-index:1;pointer-events:none}.mat-slide-toggle .mat-slide-toggle-ripple .mat-ripple-element:not(.mat-slide-toggle-persistent-ripple){opacity:.12}.mat-slide-toggle-persistent-ripple{width:100%;height:100%;transform:none}.mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{opacity:.04}.mat-slide-toggle:not(.mat-disabled).cdk-keyboard-focused .mat-slide-toggle-persistent-ripple{opacity:.12}.mat-slide-toggle-persistent-ripple,.mat-slide-toggle.mat-disabled .mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{opacity:0}@media(hover: none){.mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{display:none}}.cdk-high-contrast-active .mat-slide-toggle-thumb,.cdk-high-contrast-active .mat-slide-toggle-bar{border:1px solid}.cdk-high-contrast-active .mat-slide-toggle.cdk-keyboard-focused .mat-slide-toggle-bar{outline:2px dotted;outline-offset:5px}\n"],encapsulation:2,changeDetection:0}),n})(),L5=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({}),n})(),WK=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({imports:[[L5,_U,ds,lU],L5,ds]}),n})();new class extends Zc{flush(e){this.active=!0,this.scheduled=void 0;const{actions:t}=this;let o,c=-1,u=t.length;e=e||t.shift();do{if(o=e.execute(e.state,e.delay))break}while(++c<u&&(e=t.shift()));if(this.active=!1,o){for(;++c<u&&(e=t.shift());)e.unsubscribe();throw o}}}(class extends GP{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}requestAsyncId(e,t,o=0){return null!==o&&o>0?super.requestAsyncId(e,t,o):(e.actions.push(this),e.scheduled||(e.scheduled=requestAnimationFrame(()=>e.flush(null))))}recycleAsyncId(e,t,o=0){if(null!==o&&o>0||null===o&&this.delay>0)return super.recycleAsyncId(e,t,o);0===e.actions.length&&(cancelAnimationFrame(t),e.scheduled=void 0)}});let YK=1;const $K=Promise.resolve(),$P={};function x5(n){return n in $P&&(delete $P[n],!0)}const F5={setImmediate(n){const e=YK++;return $P[e]=!0,$K.then(()=>x5(e)&&n()),e},clearImmediate(n){x5(n)}};new class extends Zc{flush(e){this.active=!0,this.scheduled=void 0;const{actions:t}=this;let o,c=-1,u=t.length;e=e||t.shift();do{if(o=e.execute(e.state,e.delay))break}while(++c<u&&(e=t.shift()));if(this.active=!1,o){for(;++c<u&&(e=t.shift());)e.unsubscribe();throw o}}}(class extends GP{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}requestAsyncId(e,t,o=0){return null!==o&&o>0?super.requestAsyncId(e,t,o):(e.actions.push(this),e.scheduled||(e.scheduled=F5.setImmediate(e.flush.bind(e,null))))}recycleAsyncId(e,t,o=0){if(null!==o&&o>0||null===o&&this.delay>0)return super.recycleAsyncId(e,t,o);0===e.actions.length&&(F5.clearImmediate(t),e.scheduled=void 0)}});new class extends Zc{}(class extends GP{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}schedule(e,t=0){return t>0?super.schedule(e,t):(this.delay=t,this.state=e,this.scheduler.flush(this),this)}execute(e,t){return t>0||this.closed?super.execute(e,t):this._execute(e,t)}requestAsyncId(e,t,o=0){return null!==o&&o>0||null===o&&this.delay>0?super.requestAsyncId(e,t,o):e.flush(this)}});class Bs{constructor(e,t,o){this.kind=e,this.value=t,this.error=o,this.hasValue="N"===e}observe(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}}do(e,t,o){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return o&&o()}}accept(e,t,o){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,o)}toObservable(){switch(this.kind){case"N":return Ct(this.value);case"E":return function(n,e){return new tn(t=>t.error(n))}(this.error);case"C":return pP()}throw new Error("unexpected notification kind value")}static createNext(e){return void 0!==e?new Bs("N",e):Bs.undefinedValueNotification}static createError(e){return new Bs("E",void 0,e)}static createComplete(){return Bs.completeNotification}}Bs.completeNotification=new Bs("C"),Bs.undefinedValueNotification=new Bs("N",void 0);let Wy=(()=>{class n{constructor(t,o,c){this._ngZone=t,this._platform=o,this._scrolled=new xt,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=c}register(t){this.scrollContainers.has(t)||this.scrollContainers.set(t,t.elementScrolled().subscribe(()=>this._scrolled.next(t)))}deregister(t){const o=this.scrollContainers.get(t);o&&(o.unsubscribe(),this.scrollContainers.delete(t))}scrolled(t=20){return this._platform.isBrowser?new tn(o=>{this._globalSubscription||this._addGlobalListener();const c=t>0?this._scrolled.pipe(WP(t)).subscribe(o):this._scrolled.subscribe(o);return this._scrolledCount++,()=>{c.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):Ct()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((t,o)=>this.deregister(o)),this._scrolled.complete()}ancestorScrolled(t,o){const c=this.getAncestorScrollContainers(t);return this.scrolled(o).pipe(xp(u=>!u||c.indexOf(u)>-1))}getAncestorScrollContainers(t){const o=[];return this.scrollContainers.forEach((c,u)=>{this._scrollableContainsElement(u,t)&&o.push(u)}),o}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(t,o){let c=Lu(o),u=t.getElementRef().nativeElement;do{if(c==u)return!0}while(c=c.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>IR(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return n.\u0275fac=function(t){return new(t||n)(ie(nt),ie(ii),ie(Je,8))},n.\u0275prov=Pe({factory:function(){return new n(ie(nt),ie(ii),ie(Je,8))},token:n,providedIn:"root"}),n})(),OR=(()=>{class n{constructor(t,o,c){this._platform=t,this._change=new xt,this._changeListener=u=>{this._change.next(u)},this._document=c,o.runOutsideAngular(()=>{if(t.isBrowser){const u=this._getWindow();u.addEventListener("resize",this._changeListener),u.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const t=this._getWindow();t.removeEventListener("resize",this._changeListener),t.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const t={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),t}getViewportRect(){const t=this.getViewportScrollPosition(),{width:o,height:c}=this.getViewportSize();return{top:t.top,left:t.left,bottom:t.top+c,right:t.left+o,height:c,width:o}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const t=this._document,o=this._getWindow(),c=t.documentElement,u=c.getBoundingClientRect();return{top:-u.top||t.body.scrollTop||o.scrollY||c.scrollTop||0,left:-u.left||t.body.scrollLeft||o.scrollX||c.scrollLeft||0}}change(t=20){return t>0?this._change.pipe(WP(t)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const t=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:t.innerWidth,height:t.innerHeight}:{width:0,height:0}}}return n.\u0275fac=function(t){return new(t||n)(ie(ii),ie(nt),ie(Je,8))},n.\u0275prov=Pe({factory:function(){return new n(ie(ii),ie(nt),ie(Je,8))},token:n,providedIn:"root"}),n})(),EU=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({}),n})(),G5=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({imports:[[wR,SR,EU],wR,EU]}),n})();class yU{attach(e){return this._attachedHost=e,e.attach(this)}detach(){let e=this._attachedHost;null!=e&&(this._attachedHost=null,e.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(e){this._attachedHost=e}}class W5 extends yU{constructor(e,t,o,c){super(),this.component=e,this.viewContainerRef=t,this.injector=o,this.componentFactoryResolver=c}}class vU extends yU{constructor(e,t,o){super(),this.templateRef=e,this.viewContainerRef=t,this.context=o}get origin(){return this.templateRef.elementRef}attach(e,t=this.context){return this.context=t,super.attach(e)}detach(){return this.context=void 0,super.detach()}}class Iq extends yU{constructor(e){super(),this.element=e instanceof Ot?e.nativeElement:e}}class wq extends class{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(e){return e instanceof W5?(this._attachedPortal=e,this.attachComponentPortal(e)):e instanceof vU?(this._attachedPortal=e,this.attachTemplatePortal(e)):this.attachDomPortal&&e instanceof Iq?(this._attachedPortal=e,this.attachDomPortal(e)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(e){this._disposeFn=e}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}{constructor(e,t,o,c,u){super(),this.outletElement=e,this._componentFactoryResolver=t,this._appRef=o,this._defaultInjector=c,this.attachDomPortal=p=>{const _=p.element,v=this._document.createComment("dom-portal");_.parentNode.insertBefore(v,_),this.outletElement.appendChild(_),this._attachedPortal=p,super.setDisposeFn(()=>{v.parentNode&&v.parentNode.replaceChild(_,v)})},this._document=u}attachComponentPortal(e){const o=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component);let c;return e.viewContainerRef?(c=e.viewContainerRef.createComponent(o,e.viewContainerRef.length,e.injector||e.viewContainerRef.injector),this.setDisposeFn(()=>c.destroy())):(c=o.create(e.injector||this._defaultInjector),this._appRef.attachView(c.hostView),this.setDisposeFn(()=>{this._appRef.detachView(c.hostView),c.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(c)),this._attachedPortal=e,c}attachTemplatePortal(e){let t=e.viewContainerRef,o=t.createEmbeddedView(e.templateRef,e.context);return o.rootNodes.forEach(c=>this.outletElement.appendChild(c)),o.detectChanges(),this.setDisposeFn(()=>{let c=t.indexOf(o);-1!==c&&t.remove(c)}),this._attachedPortal=e,o}dispose(){super.dispose(),null!=this.outletElement.parentNode&&this.outletElement.parentNode.removeChild(this.outletElement)}_getComponentRootNode(e){return e.hostView.rootNodes[0]}}let Aq=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({}),n})();const Y5=P4();class Pq{constructor(e,t){this._viewportRuler=e,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=t}attach(){}enable(){if(this._canBeEnabled()){const e=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=e.style.left||"",this._previousHTMLStyles.top=e.style.top||"",e.style.left=Rr(-this._previousScrollPosition.left),e.style.top=Rr(-this._previousScrollPosition.top),e.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const e=this._document.documentElement,o=e.style,c=this._document.body.style,u=o.scrollBehavior||"",p=c.scrollBehavior||"";this._isEnabled=!1,o.left=this._previousHTMLStyles.left,o.top=this._previousHTMLStyles.top,e.classList.remove("cdk-global-scrollblock"),Y5&&(o.scrollBehavior=c.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),Y5&&(o.scrollBehavior=u,c.scrollBehavior=p)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const t=this._document.body,o=this._viewportRuler.getViewportSize();return t.scrollHeight>o.height||t.scrollWidth>o.width}}class Mq{constructor(e,t,o,c){this._scrollDispatcher=e,this._ngZone=t,this._viewportRuler=o,this._config=c,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(e){this._overlayRef=e}enable(){if(this._scrollSubscription)return;const e=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=e.subscribe(()=>{const t=this._viewportRuler.getViewportScrollPosition().top;Math.abs(t-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=e.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class $5{enable(){}disable(){}attach(){}}function CU(n,e){return e.some(t=>n.bottom<t.top||n.top>t.bottom||n.right<t.left||n.left>t.right)}function J5(n,e){return e.some(t=>n.top<t.top||n.bottom>t.bottom||n.left<t.left||n.right>t.right)}class kq{constructor(e,t,o,c){this._scrollDispatcher=e,this._viewportRuler=t,this._ngZone=o,this._config=c,this._scrollSubscription=null}attach(e){this._overlayRef=e}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const t=this._overlayRef.overlayElement.getBoundingClientRect(),{width:o,height:c}=this._viewportRuler.getViewportSize();CU(t,[{width:o,height:c,bottom:c,right:o,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let Lq=(()=>{class n{constructor(t,o,c,u){this._scrollDispatcher=t,this._viewportRuler=o,this._ngZone=c,this.noop=()=>new $5,this.close=p=>new Mq(this._scrollDispatcher,this._ngZone,this._viewportRuler,p),this.block=()=>new Pq(this._viewportRuler,this._document),this.reposition=p=>new kq(this._scrollDispatcher,this._viewportRuler,this._ngZone,p),this._document=u}}return n.\u0275fac=function(t){return new(t||n)(ie(Wy),ie(OR),ie(nt),ie(Je))},n.\u0275prov=Pe({factory:function(){return new n(ie(Wy),ie(OR),ie(nt),ie(Je))},token:n,providedIn:"root"}),n})();class X5{constructor(e){if(this.scrollStrategy=new $5,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,e){const t=Object.keys(e);for(const o of t)void 0!==e[o]&&(this[o]=e[o])}}}class xq{constructor(e,t,o,c,u){this.offsetX=o,this.offsetY=c,this.panelClass=u,this.originX=e.originX,this.originY=e.originY,this.overlayX=t.overlayX,this.overlayY=t.overlayY}}class Fq{constructor(e,t){this.connectionPair=e,this.scrollableViewProperties=t}}let Q5=(()=>{class n{constructor(t){this._attachedOverlays=[],this._document=t}ngOnDestroy(){this.detach()}add(t){this.remove(t),this._attachedOverlays.push(t)}remove(t){const o=this._attachedOverlays.indexOf(t);o>-1&&this._attachedOverlays.splice(o,1),0===this._attachedOverlays.length&&this.detach()}}return n.\u0275fac=function(t){return new(t||n)(ie(Je))},n.\u0275prov=Pe({factory:function(){return new n(ie(Je))},token:n,providedIn:"root"}),n})(),Uq=(()=>{class n extends Q5{constructor(t){super(t),this._keydownListener=o=>{const c=this._attachedOverlays;for(let u=c.length-1;u>-1;u--)if(c[u]._keydownEvents.observers.length>0){c[u]._keydownEvents.next(o);break}}}add(t){super.add(t),this._isAttached||(this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return n.\u0275fac=function(t){return new(t||n)(ie(Je))},n.\u0275prov=Pe({factory:function(){return new n(ie(Je))},token:n,providedIn:"root"}),n})(),Vq=(()=>{class n extends Q5{constructor(t,o){super(t),this._platform=o,this._cursorStyleIsSet=!1,this._pointerDownListener=c=>{this._pointerDownEventTarget=Cm(c)},this._clickListener=c=>{const u=Cm(c),p="click"===c.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:u;this._pointerDownEventTarget=null;const _=this._attachedOverlays.slice();for(let v=_.length-1;v>-1;v--){const S=_[v];if(!(S._outsidePointerEvents.observers.length<1)&&S.hasAttached()){if(S.overlayElement.contains(u)||S.overlayElement.contains(p))break;S._outsidePointerEvents.next(c)}}}}add(t){if(super.add(t),!this._isAttached){const o=this._document.body;o.addEventListener("pointerdown",this._pointerDownListener,!0),o.addEventListener("click",this._clickListener,!0),o.addEventListener("auxclick",this._clickListener,!0),o.addEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=o.style.cursor,o.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const t=this._document.body;t.removeEventListener("pointerdown",this._pointerDownListener,!0),t.removeEventListener("click",this._clickListener,!0),t.removeEventListener("auxclick",this._clickListener,!0),t.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(t.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}}return n.\u0275fac=function(t){return new(t||n)(ie(Je),ie(ii))},n.\u0275prov=Pe({factory:function(){return new n(ie(Je),ie(ii))},token:n,providedIn:"root"}),n})(),SU=(()=>{class n{constructor(t,o){this._platform=o,this._document=t}ngOnDestroy(){const t=this._containerElement;t&&t.parentNode&&t.parentNode.removeChild(t)}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const t="cdk-overlay-container";if(this._platform.isBrowser||oU()){const c=this._document.querySelectorAll(`.${t}[platform="server"], .${t}[platform="test"]`);for(let u=0;u<c.length;u++)c[u].parentNode.removeChild(c[u])}const o=this._document.createElement("div");o.classList.add(t),oU()?o.setAttribute("platform","test"):this._platform.isBrowser||o.setAttribute("platform","server"),this._document.body.appendChild(o),this._containerElement=o}}return n.\u0275fac=function(t){return new(t||n)(ie(Je),ie(ii))},n.\u0275prov=Pe({factory:function(){return new n(ie(Je),ie(ii))},token:n,providedIn:"root"}),n})();class Bq{constructor(e,t,o,c,u,p,_,v,S){this._portalOutlet=e,this._host=t,this._pane=o,this._config=c,this._ngZone=u,this._keyboardDispatcher=p,this._document=_,this._location=v,this._outsideClickDispatcher=S,this._backdropElement=null,this._backdropClick=new xt,this._attachments=new xt,this._detachments=new xt,this._locationChanges=en.EMPTY,this._backdropClickHandler=w=>this._backdropClick.next(w),this._keydownEvents=new xt,this._outsidePointerEvents=new xt,c.scrollStrategy&&(this._scrollStrategy=c.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=c.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(e){let t=this._portalOutlet.attach(e);return!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host),this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Ao(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),t}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const e=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),e}dispose(){const e=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host&&this._host.parentNode&&(this._host.parentNode.removeChild(this._host),this._host=null),this._previousHostParent=this._pane=null,e&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(e){e!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=e,this.hasAttached()&&(e.attach(this),this.updatePosition()))}updateSize(e){this._config=Object.assign(Object.assign({},this._config),e),this._updateElementSize()}setDirection(e){this._config=Object.assign(Object.assign({},this._config),{direction:e}),this._updateElementDirection()}addPanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!0)}removePanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!1)}getDirection(){const e=this._config.direction;return e?"string"==typeof e?e:e.value:"ltr"}updateScrollStrategy(e){e!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=e,this.hasAttached()&&(e.attach(this),e.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const e=this._pane.style;e.width=Rr(this._config.width),e.height=Rr(this._config.height),e.minWidth=Rr(this._config.minWidth),e.minHeight=Rr(this._config.minHeight),e.maxWidth=Rr(this._config.maxWidth),e.maxHeight=Rr(this._config.maxHeight)}_togglePointerEvents(e){this._pane.style.pointerEvents=e?"":"none"}_attachBackdrop(){const e="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),"undefined"!=typeof requestAnimationFrame?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(e)})}):this._backdropElement.classList.add(e)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const e=this._backdropElement;if(!e)return;let t;const o=()=>{e&&(e.removeEventListener("click",this._backdropClickHandler),e.removeEventListener("transitionend",o),this._disposeBackdrop(e)),this._config.backdropClass&&this._toggleClasses(e,this._config.backdropClass,!1),clearTimeout(t)};e.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{e.addEventListener("transitionend",o)}),e.style.pointerEvents="none",t=this._ngZone.runOutsideAngular(()=>setTimeout(o,500))}_toggleClasses(e,t,o){const c=e.classList;HP(t).forEach(u=>{u&&(o?c.add(u):c.remove(u))})}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const e=this._ngZone.onStable.pipe(fo(sv(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._previousHostParent.removeChild(this._host)),e.unsubscribe())})})}_disposeScrollStrategy(){const e=this._scrollStrategy;e&&(e.disable(),e.detach&&e.detach())}_disposeBackdrop(e){e&&(e.parentNode&&e.parentNode.removeChild(e),this._backdropElement===e&&(this._backdropElement=null))}}const Z5="cdk-overlay-connected-position-bounding-box",jq=/([A-Za-z%]+)$/;class e6{constructor(e,t,o,c,u){this._viewportRuler=t,this._document=o,this._platform=c,this._overlayContainer=u,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new xt,this._resizeSubscription=en.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(e)}get positions(){return this._preferredPositions}attach(e){this._validatePositions(),e.hostElement.classList.add(Z5),this._overlayRef=e,this._boundingBox=e.hostElement,this._pane=e.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect();const e=this._originRect,t=this._overlayRect,o=this._viewportRect,c=[];let u;for(let p of this._preferredPositions){let _=this._getOriginPoint(e,p),v=this._getOverlayPoint(_,t,p),S=this._getOverlayFit(v,t,o,p);if(S.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(p,_);this._canFitWithFlexibleDimensions(S,v,o)?c.push({position:p,origin:_,overlayRect:t,boundingBoxRect:this._calculateBoundingBoxRect(_,p)}):(!u||u.overlayFit.visibleArea<S.visibleArea)&&(u={overlayFit:S,overlayPoint:v,originPoint:_,position:p,overlayRect:t})}if(c.length){let p=null,_=-1;for(const v of c){const S=v.boundingBoxRect.width*v.boundingBoxRect.height*(v.position.weight||1);S>_&&(_=S,p=v)}return this._isPushed=!1,void this._applyPosition(p.position,p.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(u.position,u.originPoint);this._applyPosition(u.position,u.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Tm(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(Z5),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(!this._isDisposed&&(!this._platform||this._platform.isBrowser)){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect();const e=this._lastPosition||this._preferredPositions[0],t=this._getOriginPoint(this._originRect,e);this._applyPosition(e,t)}}withScrollableContainers(e){return this._scrollables=e,this}withPositions(e){return this._preferredPositions=e,-1===e.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(e){return this._viewportMargin=e,this}withFlexibleDimensions(e=!0){return this._hasFlexibleDimensions=e,this}withGrowAfterOpen(e=!0){return this._growAfterOpen=e,this}withPush(e=!0){return this._canPush=e,this}withLockedPosition(e=!0){return this._positionLocked=e,this}setOrigin(e){return this._origin=e,this}withDefaultOffsetX(e){return this._offsetX=e,this}withDefaultOffsetY(e){return this._offsetY=e,this}withTransformOriginOn(e){return this._transformOriginSelector=e,this}_getOriginPoint(e,t){let o,c;if("center"==t.originX)o=e.left+e.width/2;else{const u=this._isRtl()?e.right:e.left,p=this._isRtl()?e.left:e.right;o="start"==t.originX?u:p}return c="center"==t.originY?e.top+e.height/2:"top"==t.originY?e.top:e.bottom,{x:o,y:c}}_getOverlayPoint(e,t,o){let c,u;return c="center"==o.overlayX?-t.width/2:"start"===o.overlayX?this._isRtl()?-t.width:0:this._isRtl()?0:-t.width,u="center"==o.overlayY?-t.height/2:"top"==o.overlayY?0:-t.height,{x:e.x+c,y:e.y+u}}_getOverlayFit(e,t,o,c){const u=n6(t);let{x:p,y:_}=e,v=this._getOffset(c,"x"),S=this._getOffset(c,"y");v&&(p+=v),S&&(_+=S);let F=0-_,j=_+u.height-o.height,W=this._subtractOverflows(u.width,0-p,p+u.width-o.width),ee=this._subtractOverflows(u.height,F,j),$=W*ee;return{visibleArea:$,isCompletelyWithinViewport:u.width*u.height===$,fitsInViewportVertically:ee===u.height,fitsInViewportHorizontally:W==u.width}}_canFitWithFlexibleDimensions(e,t,o){if(this._hasFlexibleDimensions){const c=o.bottom-t.y,u=o.right-t.x,p=t6(this._overlayRef.getConfig().minHeight),_=t6(this._overlayRef.getConfig().minWidth),S=e.fitsInViewportHorizontally||null!=_&&_<=u;return(e.fitsInViewportVertically||null!=p&&p<=c)&&S}return!1}_pushOverlayOnScreen(e,t,o){if(this._previousPushAmount&&this._positionLocked)return{x:e.x+this._previousPushAmount.x,y:e.y+this._previousPushAmount.y};const c=n6(t),u=this._viewportRect,p=Math.max(e.x+c.width-u.width,0),_=Math.max(e.y+c.height-u.height,0),v=Math.max(u.top-o.top-e.y,0),S=Math.max(u.left-o.left-e.x,0);let w=0,M=0;return w=c.width<=u.width?S||-p:e.x<this._viewportMargin?u.left-o.left-e.x:0,M=c.height<=u.height?v||-_:e.y<this._viewportMargin?u.top-o.top-e.y:0,this._previousPushAmount={x:w,y:M},{x:e.x+w,y:e.y+M}}_applyPosition(e,t){if(this._setTransformOrigin(e),this._setOverlayElementStyles(t,e),this._setBoundingBoxStyles(t,e),e.panelClass&&this._addPanelClasses(e.panelClass),this._lastPosition=e,this._positionChanges.observers.length){const o=this._getScrollVisibility(),c=new Fq(e,o);this._positionChanges.next(c)}this._isInitialRender=!1}_setTransformOrigin(e){if(!this._transformOriginSelector)return;const t=this._boundingBox.querySelectorAll(this._transformOriginSelector);let o,c=e.overlayY;o="center"===e.overlayX?"center":this._isRtl()?"start"===e.overlayX?"right":"left":"start"===e.overlayX?"left":"right";for(let u=0;u<t.length;u++)t[u].style.transformOrigin=`${o} ${c}`}_calculateBoundingBoxRect(e,t){const o=this._viewportRect,c=this._isRtl();let u,p,_,w,M,F;if("top"===t.overlayY)p=e.y,u=o.height-p+this._viewportMargin;else if("bottom"===t.overlayY)_=o.height-e.y+2*this._viewportMargin,u=o.height-_+this._viewportMargin;else{const j=Math.min(o.bottom-e.y+o.top,e.y),W=this._lastBoundingBoxSize.height;u=2*j,p=e.y-j,u>W&&!this._isInitialRender&&!this._growAfterOpen&&(p=e.y-W/2)}if("end"===t.overlayX&&!c||"start"===t.overlayX&&c)F=o.width-e.x+this._viewportMargin,w=e.x-this._viewportMargin;else if("start"===t.overlayX&&!c||"end"===t.overlayX&&c)M=e.x,w=o.right-e.x;else{const j=Math.min(o.right-e.x+o.left,e.x),W=this._lastBoundingBoxSize.width;w=2*j,M=e.x-j,w>W&&!this._isInitialRender&&!this._growAfterOpen&&(M=e.x-W/2)}return{top:p,left:M,bottom:_,right:F,width:w,height:u}}_setBoundingBoxStyles(e,t){const o=this._calculateBoundingBoxRect(e,t);!this._isInitialRender&&!this._growAfterOpen&&(o.height=Math.min(o.height,this._lastBoundingBoxSize.height),o.width=Math.min(o.width,this._lastBoundingBoxSize.width));const c={};if(this._hasExactPosition())c.top=c.left="0",c.bottom=c.right=c.maxHeight=c.maxWidth="",c.width=c.height="100%";else{const u=this._overlayRef.getConfig().maxHeight,p=this._overlayRef.getConfig().maxWidth;c.height=Rr(o.height),c.top=Rr(o.top),c.bottom=Rr(o.bottom),c.width=Rr(o.width),c.left=Rr(o.left),c.right=Rr(o.right),c.alignItems="center"===t.overlayX?"center":"end"===t.overlayX?"flex-end":"flex-start",c.justifyContent="center"===t.overlayY?"center":"bottom"===t.overlayY?"flex-end":"flex-start",u&&(c.maxHeight=Rr(u)),p&&(c.maxWidth=Rr(p))}this._lastBoundingBoxSize=o,Tm(this._boundingBox.style,c)}_resetBoundingBoxStyles(){Tm(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Tm(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(e,t){const o={},c=this._hasExactPosition(),u=this._hasFlexibleDimensions,p=this._overlayRef.getConfig();if(c){const w=this._viewportRuler.getViewportScrollPosition();Tm(o,this._getExactOverlayY(t,e,w)),Tm(o,this._getExactOverlayX(t,e,w))}else o.position="static";let _="",v=this._getOffset(t,"x"),S=this._getOffset(t,"y");v&&(_+=`translateX(${v}px) `),S&&(_+=`translateY(${S}px)`),o.transform=_.trim(),p.maxHeight&&(c?o.maxHeight=Rr(p.maxHeight):u&&(o.maxHeight="")),p.maxWidth&&(c?o.maxWidth=Rr(p.maxWidth):u&&(o.maxWidth="")),Tm(this._pane.style,o)}_getExactOverlayY(e,t,o){let c={top:"",bottom:""},u=this._getOverlayPoint(t,this._overlayRect,e);this._isPushed&&(u=this._pushOverlayOnScreen(u,this._overlayRect,o));let p=this._overlayContainer.getContainerElement().getBoundingClientRect().top;return u.y-=p,"bottom"===e.overlayY?c.bottom=this._document.documentElement.clientHeight-(u.y+this._overlayRect.height)+"px":c.top=Rr(u.y),c}_getExactOverlayX(e,t,o){let p,c={left:"",right:""},u=this._getOverlayPoint(t,this._overlayRect,e);return this._isPushed&&(u=this._pushOverlayOnScreen(u,this._overlayRect,o)),p=this._isRtl()?"end"===e.overlayX?"left":"right":"end"===e.overlayX?"right":"left","right"===p?c.right=this._document.documentElement.clientWidth-(u.x+this._overlayRect.width)+"px":c.left=Rr(u.x),c}_getScrollVisibility(){const e=this._getOriginRect(),t=this._pane.getBoundingClientRect(),o=this._scrollables.map(c=>c.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:J5(e,o),isOriginOutsideView:CU(e,o),isOverlayClipped:J5(t,o),isOverlayOutsideView:CU(t,o)}}_subtractOverflows(e,...t){return t.reduce((o,c)=>o-Math.max(c,0),e)}_getNarrowedViewportRect(){const e=this._document.documentElement.clientWidth,t=this._document.documentElement.clientHeight,o=this._viewportRuler.getViewportScrollPosition();return{top:o.top+this._viewportMargin,left:o.left+this._viewportMargin,right:o.left+e-this._viewportMargin,bottom:o.top+t-this._viewportMargin,width:e-2*this._viewportMargin,height:t-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(e,t){return"x"===t?null==e.offsetX?this._offsetX:e.offsetX:null==e.offsetY?this._offsetY:e.offsetY}_validatePositions(){}_addPanelClasses(e){this._pane&&HP(e).forEach(t=>{""!==t&&-1===this._appliedPanelClasses.indexOf(t)&&(this._appliedPanelClasses.push(t),this._pane.classList.add(t))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(e=>{this._pane.classList.remove(e)}),this._appliedPanelClasses=[])}_getOriginRect(){const e=this._origin;if(e instanceof Ot)return e.nativeElement.getBoundingClientRect();if(e instanceof Element)return e.getBoundingClientRect();const t=e.width||0,o=e.height||0;return{top:e.y,bottom:e.y+o,left:e.x,right:e.x+t,height:o,width:t}}}function Tm(n,e){for(let t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}function t6(n){if("number"!=typeof n&&null!=n){const[e,t]=n.split(jq);return t&&"px"!==t?null:parseFloat(e)}return n||null}function n6(n){return{top:Math.floor(n.top),right:Math.floor(n.right),bottom:Math.floor(n.bottom),left:Math.floor(n.left),width:Math.floor(n.width),height:Math.floor(n.height)}}class Hq{constructor(e,t,o,c,u,p,_){this._preferredPositions=[],this._positionStrategy=new e6(o,c,u,p,_).withFlexibleDimensions(!1).withPush(!1).withViewportMargin(0),this.withFallbackPosition(e,t),this.onPositionChange=this._positionStrategy.positionChanges}get positions(){return this._preferredPositions}attach(e){this._overlayRef=e,this._positionStrategy.attach(e),this._direction&&(e.setDirection(this._direction),this._direction=null)}dispose(){this._positionStrategy.dispose()}detach(){this._positionStrategy.detach()}apply(){this._positionStrategy.apply()}recalculateLastPosition(){this._positionStrategy.reapplyLastPosition()}withScrollableContainers(e){this._positionStrategy.withScrollableContainers(e)}withFallbackPosition(e,t,o,c){const u=new xq(e,t,o,c);return this._preferredPositions.push(u),this._positionStrategy.withPositions(this._preferredPositions),this}withDirection(e){return this._overlayRef?this._overlayRef.setDirection(e):this._direction=e,this}withOffsetX(e){return this._positionStrategy.withDefaultOffsetX(e),this}withOffsetY(e){return this._positionStrategy.withDefaultOffsetY(e),this}withLockedPosition(e){return this._positionStrategy.withLockedPosition(e),this}withPositions(e){return this._preferredPositions=e.slice(),this._positionStrategy.withPositions(this._preferredPositions),this}setOrigin(e){return this._positionStrategy.setOrigin(e),this}}const i6="cdk-global-overlay-wrapper";class Gq{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._leftOffset="",this._rightOffset="",this._alignItems="",this._justifyContent="",this._width="",this._height=""}attach(e){const t=e.getConfig();this._overlayRef=e,this._width&&!t.width&&e.updateSize({width:this._width}),this._height&&!t.height&&e.updateSize({height:this._height}),e.hostElement.classList.add(i6),this._isDisposed=!1}top(e=""){return this._bottomOffset="",this._topOffset=e,this._alignItems="flex-start",this}left(e=""){return this._rightOffset="",this._leftOffset=e,this._justifyContent="flex-start",this}bottom(e=""){return this._topOffset="",this._bottomOffset=e,this._alignItems="flex-end",this}right(e=""){return this._leftOffset="",this._rightOffset=e,this._justifyContent="flex-end",this}width(e=""){return this._overlayRef?this._overlayRef.updateSize({width:e}):this._width=e,this}height(e=""){return this._overlayRef?this._overlayRef.updateSize({height:e}):this._height=e,this}centerHorizontally(e=""){return this.left(e),this._justifyContent="center",this}centerVertically(e=""){return this.top(e),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const e=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement.style,o=this._overlayRef.getConfig(),{width:c,height:u,maxWidth:p,maxHeight:_}=o,v=!("100%"!==c&&"100vw"!==c||p&&"100%"!==p&&"100vw"!==p),S=!("100%"!==u&&"100vh"!==u||_&&"100%"!==_&&"100vh"!==_);e.position=this._cssPosition,e.marginLeft=v?"0":this._leftOffset,e.marginTop=S?"0":this._topOffset,e.marginBottom=this._bottomOffset,e.marginRight=this._rightOffset,v?t.justifyContent="flex-start":"center"===this._justifyContent?t.justifyContent="center":"rtl"===this._overlayRef.getConfig().direction?"flex-start"===this._justifyContent?t.justifyContent="flex-end":"flex-end"===this._justifyContent&&(t.justifyContent="flex-start"):t.justifyContent=this._justifyContent,t.alignItems=S?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const e=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement,o=t.style;t.classList.remove(i6),o.justifyContent=o.alignItems=e.marginTop=e.marginBottom=e.marginLeft=e.marginRight=e.position="",this._overlayRef=null,this._isDisposed=!0}}let Wq=(()=>{class n{constructor(t,o,c,u){this._viewportRuler=t,this._document=o,this._platform=c,this._overlayContainer=u}global(){return new Gq}connectedTo(t,o,c){return new Hq(o,c,t,this._viewportRuler,this._document,this._platform,this._overlayContainer)}flexibleConnectedTo(t){return new e6(t,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return n.\u0275fac=function(t){return new(t||n)(ie(OR),ie(Je),ie(ii),ie(SU))},n.\u0275prov=Pe({factory:function(){return new n(ie(OR),ie(Je),ie(ii),ie(SU))},token:n,providedIn:"root"}),n})(),Kq=0,Ky=(()=>{class n{constructor(t,o,c,u,p,_,v,S,w,M,F){this.scrollStrategies=t,this._overlayContainer=o,this._componentFactoryResolver=c,this._positionBuilder=u,this._keyboardDispatcher=p,this._injector=_,this._ngZone=v,this._document=S,this._directionality=w,this._location=M,this._outsideClickDispatcher=F}create(t){const o=this._createHostElement(),c=this._createPaneElement(o),u=this._createPortalOutlet(c),p=new X5(t);return p.direction=p.direction||this._directionality.value,new Bq(u,o,c,p,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher)}position(){return this._positionBuilder}_createPaneElement(t){const o=this._document.createElement("div");return o.id="cdk-overlay-"+Kq++,o.classList.add("cdk-overlay-pane"),t.appendChild(o),o}_createHostElement(){const t=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(t),t}_createPortalOutlet(t){return this._appRef||(this._appRef=this._injector.get(zr)),new wq(t,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return n.\u0275fac=function(t){return new(t||n)(ie(Lq),ie(SU),ie(aa),ie(Wq),ie(Uq),ie(An),ie(nt),ie(Je),ie(Gp),ie(Bi),ie(Vq))},n.\u0275prov=Pe({token:n,factory:n.\u0275fac}),n})();const Yq={provide:new je("cdk-connected-overlay-scroll-strategy"),deps:[Ky],useFactory:function(n){return()=>n.scrollStrategies.reposition()}};let $q=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({providers:[Ky,Yq],imports:[[wR,Aq,G5],G5]}),n})();const o6=new Set;let qy,s6=(()=>{class n{constructor(t){this._platform=t,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):Xq}matchMedia(t){return(this._platform.WEBKIT||this._platform.BLINK)&&function(n){if(!o6.has(n))try{qy||(qy=document.createElement("style"),qy.setAttribute("type","text/css"),document.head.appendChild(qy)),qy.sheet&&(qy.sheet.insertRule(`@media ${n} {body{ }}`,0),o6.add(n))}catch(e){console.error(e)}}(t),this._matchMedia(t)}}return n.\u0275fac=function(t){return new(t||n)(ie(ii))},n.\u0275prov=Pe({factory:function(){return new n(ie(ii))},token:n,providedIn:"root"}),n})();function Xq(n){return{matches:"all"===n||""===n,media:n,addListener:()=>{},removeListener:()=>{}}}let Qq=(()=>{class n{constructor(t,o){this._mediaMatcher=t,this._zone=o,this._queries=new Map,this._destroySubject=new xt}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(t){return a6(HP(t)).some(c=>this._registerQuery(c).mql.matches)}observe(t){let u=bB(a6(HP(t)).map(p=>this._registerQuery(p).observable));return u=hP(u.pipe(Ao(1)),u.pipe(B4(1),H4(0))),u.pipe(Cn(p=>{const _={matches:!1,breakpoints:{}};return p.forEach(({matches:v,query:S})=>{_.matches=_.matches||v,_.breakpoints[S]=v}),_}))}_registerQuery(t){if(this._queries.has(t))return this._queries.get(t);const o=this._mediaMatcher.matchMedia(t),u={observable:new tn(p=>{const _=v=>this._zone.run(()=>p.next(v));return o.addListener(_),()=>{o.removeListener(_)}}).pipe(hm(o),Cn(({matches:p})=>({query:t,matches:p})),fo(this._destroySubject)),mql:o};return this._queries.set(t,u),u}}return n.\u0275fac=function(t){return new(t||n)(ie(s6),ie(nt))},n.\u0275prov=Pe({factory:function(){return new n(ie(s6),ie(nt))},token:n,providedIn:"root"}),n})();function a6(n){return n.map(e=>e.split(",")).reduce((e,t)=>e.concat(t)).map(e=>e.trim())}const ez={tooltipState:k2("state",[L2("initial, void, hidden",Us({opacity:0,transform:"scale(0)"})),L2("visible",Us({transform:"scale(1)"})),nR("* => visible",tR("200ms cubic-bezier(0, 0, 0.2, 1)",y6([Us({opacity:0,transform:"scale(0)",offset:0}),Us({opacity:.5,transform:"scale(0.99)",offset:.5}),Us({opacity:1,transform:"scale(1)",offset:1})]))),nR("* => hidden",tR("100ms cubic-bezier(0, 0, 0.2, 1)",Us({opacity:0})))])},c6="tooltip-panel",l6=bR({passive:!0}),d6=new je("mat-tooltip-scroll-strategy"),rz={provide:d6,deps:[Ky],useFactory:function(n){return()=>n.scrollStrategies.reposition({scrollThrottle:20})}},oz=new je("mat-tooltip-default-options",{providedIn:"root",factory:function(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}});let az=(()=>{class n{constructor(t,o,c,u,p,_,v,S,w,M,F,j){this._overlay=t,this._elementRef=o,this._scrollDispatcher=c,this._viewContainerRef=u,this._ngZone=p,this._platform=_,this._ariaDescriber=v,this._focusMonitor=S,this._dir=M,this._defaultOptions=F,this._position="below",this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._viewportMargin=8,this._cssClassPrefix="mat",this.showDelay=this._defaultOptions.showDelay,this.hideDelay=this._defaultOptions.hideDelay,this.touchGestures="auto",this._message="",this._passiveListeners=[],this._destroyed=new xt,this._handleKeydown=W=>{this._isTooltipVisible()&&27===W.keyCode&&!function(n,...e){return e.length?e.some(t=>n[t]):n.altKey||n.shiftKey||n.ctrlKey||n.metaKey}(W)&&(W.preventDefault(),W.stopPropagation(),this._ngZone.run(()=>this.hide(0)))},this._scrollStrategy=w,this._document=j,F&&(F.position&&(this.position=F.position),F.touchGestures&&(this.touchGestures=F.touchGestures)),M.change.pipe(fo(this._destroyed)).subscribe(()=>{this._overlayRef&&this._updatePosition(this._overlayRef)}),p.runOutsideAngular(()=>{o.nativeElement.addEventListener("keydown",this._handleKeydown)})}get position(){return this._position}set position(t){var o;t!==this._position&&(this._position=t,this._overlayRef&&(this._updatePosition(this._overlayRef),null===(o=this._tooltipInstance)||void 0===o||o.show(0),this._overlayRef.updatePosition()))}get disabled(){return this._disabled}set disabled(t){this._disabled=br(t),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get message(){return this._message}set message(t){this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=null!=t?String(t).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this.message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(t){this._tooltipClass=t,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(fo(this._destroyed)).subscribe(t=>{t?"keyboard"===t&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const t=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),t.removeEventListener("keydown",this._handleKeydown),this._passiveListeners.forEach(([o,c])=>{t.removeEventListener(o,c,l6)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),this._ariaDescriber.removeDescription(t,this.message,"tooltip"),this._focusMonitor.stopMonitoring(t)}show(t=this.showDelay){if(this.disabled||!this.message||this._isTooltipVisible()&&!this._tooltipInstance._showTimeoutId&&!this._tooltipInstance._hideTimeoutId)return;const o=this._createOverlay();this._detach(),this._portal=this._portal||new W5(this._tooltipComponent,this._viewContainerRef),this._tooltipInstance=o.attach(this._portal).instance,this._tooltipInstance.afterHidden().pipe(fo(this._destroyed)).subscribe(()=>this._detach()),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),this._tooltipInstance.show(t)}hide(t=this.hideDelay){this._tooltipInstance&&this._tooltipInstance.hide(t)}toggle(){this._isTooltipVisible()?this.hide():this.show()}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(){if(this._overlayRef)return this._overlayRef;const t=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),o=this._overlay.position().flexibleConnectedTo(this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(t);return o.positionChanges.pipe(fo(this._destroyed)).subscribe(c=>{this._updateCurrentPositionClass(c.connectionPair),this._tooltipInstance&&c.scrollableViewProperties.isOverlayClipped&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({direction:this._dir,positionStrategy:o,panelClass:`${this._cssClassPrefix}-${c6}`,scrollStrategy:this._scrollStrategy()}),this._updatePosition(this._overlayRef),this._overlayRef.detachments().pipe(fo(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.outsidePointerEvents().pipe(fo(this._destroyed)).subscribe(()=>{var c;return null===(c=this._tooltipInstance)||void 0===c?void 0:c._handleBodyInteraction()}),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}_updatePosition(t){const o=t.getConfig().positionStrategy,c=this._getOrigin(),u=this._getOverlayPosition();o.withPositions([this._addOffset(Object.assign(Object.assign({},c.main),u.main)),this._addOffset(Object.assign(Object.assign({},c.fallback),u.fallback))])}_addOffset(t){return t}_getOrigin(){const t=!this._dir||"ltr"==this._dir.value,o=this.position;let c;"above"==o||"below"==o?c={originX:"center",originY:"above"==o?"top":"bottom"}:"before"==o||"left"==o&&t||"right"==o&&!t?c={originX:"start",originY:"center"}:("after"==o||"right"==o&&t||"left"==o&&!t)&&(c={originX:"end",originY:"center"});const{x:u,y:p}=this._invertPosition(c.originX,c.originY);return{main:c,fallback:{originX:u,originY:p}}}_getOverlayPosition(){const t=!this._dir||"ltr"==this._dir.value,o=this.position;let c;"above"==o?c={overlayX:"center",overlayY:"bottom"}:"below"==o?c={overlayX:"center",overlayY:"top"}:"before"==o||"left"==o&&t||"right"==o&&!t?c={overlayX:"end",overlayY:"center"}:("after"==o||"right"==o&&t||"left"==o&&!t)&&(c={overlayX:"start",overlayY:"center"});const{x:u,y:p}=this._invertPosition(c.overlayX,c.overlayY);return{main:c,fallback:{overlayX:u,overlayY:p}}}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(Ao(1),fo(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(t){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=t,this._tooltipInstance._markForCheck())}_invertPosition(t,o){return"above"===this.position||"below"===this.position?"top"===o?o="bottom":"bottom"===o&&(o="top"):"end"===t?t="start":"start"===t&&(t="end"),{x:t,y:o}}_updateCurrentPositionClass(t){const{overlayY:o,originX:c,originY:u}=t;let p;if(p="center"===o?this._dir&&"rtl"===this._dir.value?"end"===c?"left":"right":"start"===c?"left":"right":"bottom"===o&&"top"===u?"above":"below",p!==this._currentPosition){const _=this._overlayRef;if(_){const v=`${this._cssClassPrefix}-${c6}-`;_.removePanelClass(v+this._currentPosition),_.addPanelClass(v+p)}this._currentPosition=p}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||(this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",()=>{this._setupPointerExitEventsIfNeeded(),this.show()}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",()=>{this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(),500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const t=[];if(this._platformSupportsMouseEvents())t.push(["mouseleave",()=>this.hide()],["wheel",o=>this._wheelListener(o)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const o=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};t.push(["touchend",o],["touchcancel",o])}this._addListeners(t),this._passiveListeners.push(...t)}_addListeners(t){t.forEach(([o,c])=>{this._elementRef.nativeElement.addEventListener(o,c,l6)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(t){if(this._isTooltipVisible()){const o=this._document.elementFromPoint(t.clientX,t.clientY),c=this._elementRef.nativeElement;o!==c&&!c.contains(o)&&this.hide()}}_disableNativeGesturesIfNecessary(){const t=this.touchGestures;if("off"!==t){const o=this._elementRef.nativeElement,c=o.style;("on"===t||"INPUT"!==o.nodeName&&"TEXTAREA"!==o.nodeName)&&(c.userSelect=c.msUserSelect=c.webkitUserSelect=c.MozUserSelect="none"),("on"===t||!o.draggable)&&(c.webkitUserDrag="none"),c.touchAction="none",c.webkitTapHighlightColor="transparent"}}}return n.\u0275fac=function(t){return new(t||n)(Y(Ky),Y(Ot),Y(Wy),Y(_r),Y(nt),Y(ii),Y(Y4),Y(Gy),Y(void 0),Y(Gp),Y(void 0),Y(Je))},n.\u0275dir=Ae({type:n,inputs:{showDelay:["matTooltipShowDelay","showDelay"],hideDelay:["matTooltipHideDelay","hideDelay"],touchGestures:["matTooltipTouchGestures","touchGestures"],position:["matTooltipPosition","position"],disabled:["matTooltipDisabled","disabled"],message:["matTooltip","message"],tooltipClass:["matTooltipClass","tooltipClass"]}}),n})(),cz=(()=>{class n extends az{constructor(t,o,c,u,p,_,v,S,w,M,F,j){super(t,o,c,u,p,_,v,S,w,M,F,j),this._tooltipComponent=dz}}return n.\u0275fac=function(t){return new(t||n)(Y(Ky),Y(Ot),Y(Wy),Y(_r),Y(nt),Y(ii),Y(Y4),Y(Gy),Y(d6),Y(Gp,8),Y(oz,8),Y(Je))},n.\u0275dir=Ae({type:n,selectors:[["","matTooltip",""]],hostAttrs:[1,"mat-tooltip-trigger"],exportAs:["matTooltip"],features:[Dt]}),n})(),lz=(()=>{class n{constructor(t){this._changeDetectorRef=t,this._visibility="initial",this._closeOnInteraction=!1,this._onHide=new xt}show(t){clearTimeout(this._hideTimeoutId),this._closeOnInteraction=!0,this._showTimeoutId=setTimeout(()=>{this._visibility="visible",this._showTimeoutId=void 0,this._onShow(),this._markForCheck()},t)}hide(t){clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._visibility="hidden",this._hideTimeoutId=void 0,this._markForCheck()},t)}afterHidden(){return this._onHide}isVisible(){return"visible"===this._visibility}ngOnDestroy(){clearTimeout(this._showTimeoutId),clearTimeout(this._hideTimeoutId),this._onHide.complete()}_animationStart(){this._closeOnInteraction=!1}_animationDone(t){const o=t.toState;"hidden"===o&&!this.isVisible()&&this._onHide.next(),("visible"===o||"hidden"===o)&&(this._closeOnInteraction=!0)}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}_onShow(){}}return n.\u0275fac=function(t){return new(t||n)(Y(zo))},n.\u0275dir=Ae({type:n}),n})(),dz=(()=>{class n extends lz{constructor(t,o){super(t),this._breakpointObserver=o,this._isHandset=this._breakpointObserver.observe("(max-width: 599.98px) and (orientation: portrait), (max-width: 959.98px) and (orientation: landscape)")}}return n.\u0275fac=function(t){return new(t||n)(Y(zo),Y(Qq))},n.\u0275cmp=ki({type:n,selectors:[["mat-tooltip-component"]],hostAttrs:["aria-hidden","true"],hostVars:2,hostBindings:function(t,o){2&t&&Wg("zoom","visible"===o._visibility?1:null)},features:[Dt],decls:3,vars:7,consts:[[1,"mat-tooltip",3,"ngClass"]],template:function(t,o){if(1&t&&(fe(0,"div",0),dn("@state.start",function(){return o._animationStart()})("@state.done",function(u){return o._animationDone(u)}),Ll(1,"async"),Yt(2),_e()),2&t){let c;Jt("mat-tooltip-handset",null==(c=xl(1,5,o._isHandset))?null:c.matches),Xe("ngClass",o.tooltipClass)("@state",o._visibility),Ke(2),Pt(o.message)}},directives:[yy],pipes:[bp],styles:[".mat-tooltip-panel{pointer-events:none !important}.mat-tooltip{color:#fff;border-radius:4px;margin:14px;max-width:250px;padding-left:8px;padding-right:8px;overflow:hidden;text-overflow:ellipsis}.cdk-high-contrast-active .mat-tooltip{outline:solid 1px}.mat-tooltip-handset{margin:24px;padding-left:16px;padding-right:16px}\n"],encapsulation:2,data:{animation:[ez.tooltipState]},changeDetection:0}),n})(),uz=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({providers:[rz],imports:[[m7,im,$q,ds],ds,EU]}),n})();const u6_configs={AppID:"fee9eb8f5bb44a6893ec96fd5e993a31"};let hz=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=ki({type:n,selectors:[["app-root"]],decls:1,vars:0,template:function(t,o){1&t&&Ue(0,"router-outlet")},directives:[MF],styles:[""],changeDetection:0}),n})();function TU(n=0,e=jy){return(!sU(n)||n<0)&&(n=0),(!e||"function"!=typeof e.schedule)&&(e=jy),new tn(t=>(t.add(e.schedule(pz,n,{subscriber:t,counter:0,period:n})),t))}function pz(n){const{subscriber:e,counter:t,period:o}=n;e.next(t),this.schedule({subscriber:e,counter:t+1,period:o},o)}class mz{constructor(e,t){this.delay=e,this.scheduler=t}call(e,t){return t.subscribe(new bU(e,this.delay,this.scheduler))}}class bU extends wn{constructor(e,t,o){super(e),this.delay=t,this.scheduler=o,this.queue=[],this.active=!1,this.errored=!1}static dispatch(e){const t=e.source,o=t.queue,c=e.scheduler,u=e.destination;for(;o.length>0&&o[0].time-c.now()<=0;)o.shift().notification.observe(u);if(o.length>0){const p=Math.max(0,o[0].time-c.now());this.schedule(e,p)}else this.unsubscribe(),t.active=!1}_schedule(e){this.active=!0,this.destination.add(e.schedule(bU.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))}scheduleNotification(e){if(!0===this.errored)return;const t=this.scheduler,o=new gz(t.now()+this.delay,e);this.queue.push(o),!1===this.active&&this._schedule(t)}_next(e){this.scheduleNotification(Bs.createNext(e))}_error(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()}_complete(){this.scheduleNotification(Bs.createComplete()),this.unsubscribe()}}class gz{constructor(e,t){this.time=e,this.notification=t}}var Ez=ic(85),yz=ic.n(Ez);function vz(n,e){if(1&n){const t=bl();fe(0,"div",1),fe(1,"button",2),dn("click",function(){return $s(t),bn().onToggleFullScreen()}),fe(2,"div",3),Js(),fe(3,"svg",4),fe(4,"g",26),fe(5,"g",6),fe(6,"g",7),fe(7,"g",11),Ue(8,"path",27),Ue(9,"path",28),Ue(10,"path",29),Ue(11,"path",30),_e(),_e(),_e(),_e(),fe(12,"g",31),fe(13,"g",6),fe(14,"g",32),fe(15,"g",7),Ue(16,"path",33),Ue(17,"path",34),Ue(18,"path",35),Ue(19,"path",36),_e(),_e(),_e(),_e(),_e(),_e(),Xs(),fe(20,"p"),Yt(21),_e(),_e(),_e()}if(2&n){const t=bn();Ke(1),Jt("controls__button--active",t.fullScreenEnabled),Ke(3),Jt("controls__icon--shown",!t.fullScreenEnabled),Ke(8),Jt("controls__icon--shown",t.fullScreenEnabled),Ke(9),Pt(t.fullScreenEnabled?"Exit fullscreen":"Fullscreen")}}function Cz(n,e){if(1&n){const t=bl();fe(0,"div",1),fe(1,"button",37),dn("click",function(){return $s(t),bn().onToggleSmallScreen()}),fe(2,"div",3),Js(),fe(3,"svg",4),fe(4,"g",38),Ue(5,"path",39),_e(),fe(6,"defs"),fe(7,"filter",40),Ue(8,"feFlood",41),Ue(9,"feColorMatrix",42),Ue(10,"feOffset",43),Ue(11,"feGaussianBlur",44),Ue(12,"feComposite",45),Ue(13,"feColorMatrix",46),Ue(14,"feBlend",47),Ue(15,"feBlend",48),_e(),_e(),_e(),_e(),Xs(),fe(16,"p"),Yt(17,"Minimize"),_e(),_e(),_e()}if(2&n){const t=bn();Ke(1),Jt("controls__button--active",t.smallScreenEnabled)}}function Sz(n,e){if(1&n&&(fe(0,"div",8),Yt(1),_e()),2&n){const t=bn();Ke(1),Pt(t.text)}}const Tz=function(n,e,t,o){return{"spinner--connected":n,"spinner--ended":e,"spinner--small":t,"spinner--error":o}};function bz(n,e){if(1&n&&(Kd(0),Yt(1),qd()),2&n){const t=bn(2);Ke(1),Ci(" Calling to ",t.data.user.name," ")}}function Rz(n,e){1&n&&Yt(0),2&n&&Ci(" ",bn(2).data.user.name," is calling ")}function Iz(n,e){if(1&n){const t=bl();Kd(0),fe(1,"button",11),dn("click",function(){return $s(t),bn(2).onAcceptCall()}),_e(),qd()}}function wz(n,e){if(1&n){const t=bl();fe(0,"div",1),fe(1,"div",2),fe(2,"div",3),Ue(3,"img",4),_e(),fe(4,"p",5),Qn(5,bz,2,1,"ng-container",6),Qn(6,Rz,1,1,"ng-template",null,7,DE),_e(),_e(),fe(8,"div",8),Qn(9,Iz,2,0,"ng-container",9),fe(10,"span"),fe(11,"button",10),dn("click",function(){return $s(t),bn().onDeclineCall()}),_e(),_e(),_e(),_e()}if(2&n){const t=Bg(7),o=bn();Jt("video-call--full-screen",o.fullScreen),Xe("@fade",void 0),Ke(3),Xe("src",o.data.user.photoURL,bh),Ke(2),Xe("ngIf",o.data.outcome)("ngIfElse",t),Ke(4),Xe("ngIf",!o.data.outcome)}}function Az(n,e){if(1&n&&Ue(0,"ngx-spinner",15),2&n){const t=bn().ngIf,o=bn(2);Xe("error",t.error)("text",t.statusText)("connected",t.connected)("ended",t.ended)("small",o.smallScreenEnabled)}}function Dz(n,e){1&n&&Ue(0,"ngx-timer",16),2&n&&Xe("started",bn().ngIf.started)}function Oz(n,e){if(1&n&&(Ue(0,"div",17),Ll(1,"async")),2&n){const t=e.$implicit;Jt("hidden",!1===xl(1,3,bn(3).remoteStreamVideoToggle$)),Xe("id",t)}}function Nz(n,e){if(1&n){const t=bl();Js(),Xs(),fe(0,"ngx-controls",18),dn("toggleCamera",function(c){return $s(t),bn(3).onToggleCamera(c)})("toggleMicrophone",function(c){return $s(t),bn(3).onToggleMicrophone(c)})("toggleFullScreen",function(c){return $s(t),bn(3).onToggleFullScreen(c)})("toggleSmallScreen",function(c){return $s(t),bn(3).onToggleSmallScreen(c)})("endCall",function(){return $s(t),bn(3).onEndCall()}),_e()}if(2&n){const t=bn(3);Xe("cameraEnabled",t.cameraEnabled)("microphoneEnabled",t.microphoneEnabled)("fullScreenEnabled",t.fullScreenEnabled)("smallScreenEnabled",t.smallScreenEnabled)("displaySmallScreen",t.displaySmallScreen)}}function Pz(n,e){if(1&n&&(fe(0,"div",2),Qn(1,Az,1,5,"ngx-spinner",3),Qn(2,Dz,1,1,"ngx-timer",4),Ue(3,"div",5),Qn(4,Oz,2,5,"div",6),fe(5,"div",7),Js(),fe(6,"svg",8),fe(7,"g",9),Ue(8,"path",10),Ue(9,"path",11),_e(),fe(10,"defs"),fe(11,"clipPath",12),Ue(12,"rect",13),_e(),_e(),_e(),_e(),Qn(13,Nz,1,5,"ngx-controls",14),_e()),2&n){const t=e.ngIf,o=bn(2);Ke(1),Xe("ngIf",t.loading),Ke(1),Xe("ngIf",t.started),Ke(1),Jt("hidden",!o.cameraEnabled||o.smallScreenEnabled),Xe("id",o.localContainerId),Ke(1),Xe("ngForOf",o.remoteCalls),Ke(9),Xe("ngIf",t.connected&&!t.ended)}}function Mz(n,e){if(1&n&&(fe(0,"div"),Qn(1,Pz,14,7,"div",1),Ll(2,"async"),_e()),2&n){const t=bn();Xe("@fade",void 0)("@.disabled",!t.animate),Ke(1),Xe("ngIf",xl(2,3,t.streamState$))}}let h6=(()=>{class n{constructor(t,o,c,u){this.document=t,this.componentFactoryResolver=o,this.appRef=c,this.injector=u,this.wrapperSelector="ngx-webrtc-wrapper"}open(t,o={}){return this.appendComponent(t,o)}appendComponent(t,o){const c=this.componentFactoryResolver.resolveComponentFactory(t).create(this.injector),{instance:u}=c;Object.keys(o).forEach(_=>u[_]=o[_]),this.appRef.attachView(c.hostView);const p=c.hostView.rootNodes[0];return this.getContainer().append(p),u.afterClosed.pipe(Ao(1),function(n,e=jy){const o=function(n){return n instanceof Date&&!isNaN(+n)}(n)?+n-e.now():Math.abs(n);return c=>c.lift(new mz(o,e))}(250)).subscribe(()=>{this.appRef.detachView(c.hostView),c.destroy()}),u}getContainer(){let t=this.document.querySelector(`.${this.wrapperSelector}`);return t||(t=this.document.createElement("div"),t.setAttribute("class",this.wrapperSelector),t.setAttribute("style","position: fixed; top: 0; width: 100%;"),this.document.body.appendChild(t)),t}}return n.\u0275fac=function(t){return new(t||n)(ie(Je),ie(aa),ie(zr),ie(An))},n.\u0275prov=Pe({factory:function(){return new n(ie(Je),ie(aa),ie(zr),ie(yl))},token:n,providedIn:"root"}),n})();const XP_HIDDEN={opacity:0,"margin-top":"100%"},XP_SHOWN={opacity:1,"margin-top":0},p6=k2("fade",[nR(":enter",[Us(XP_HIDDEN),tR("250ms ease-in-out",Us(XP_SHOWN))]),nR(":leave",[Us(XP_SHOWN),tR("250ms ease-in-out",Us(XP_HIDDEN))])]);class f6{constructor(e){this.cdr=e,this.afterClosed=new xt,this.shown=!0}closeDialog(e){this.onAfterClosed(e)}onAfterClosed(e){this.shown=!1,this.cdr.markForCheck(),this.afterClosed.next(e)}}let kz=(()=>{class n{constructor(){this.cameraEnabled=!0,this.microphoneEnabled=!0,this.fullScreenEnabled=!1,this.smallScreenEnabled=!1,this.displaySmallScreen=!1,this.toggleCamera=new ft,this.toggleMicrophone=new ft,this.toggleFullScreen=new ft,this.toggleSmallScreen=new ft,this.endCall=new ft}onToggleCamera(){this.toggleCamera.emit(this.cameraEnabled)}onToggleMicrophone(){this.toggleMicrophone.emit(this.microphoneEnabled)}onToggleFullScreen(){this.toggleFullScreen.emit(this.fullScreenEnabled)}onToggleSmallScreen(){this.toggleSmallScreen.emit(this.smallScreenEnabled)}onEndCall(){this.endCall.emit()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=ki({type:n,selectors:[["ngx-controls"]],inputs:{cameraEnabled:"cameraEnabled",microphoneEnabled:"microphoneEnabled",fullScreenEnabled:"fullScreenEnabled",smallScreenEnabled:"smallScreenEnabled",displaySmallScreen:"displaySmallScreen"},outputs:{toggleCamera:"toggleCamera",toggleMicrophone:"toggleMicrophone",toggleFullScreen:"toggleFullScreen",toggleSmallScreen:"toggleSmallScreen",endCall:"endCall"},decls:43,vars:16,consts:[[1,"controls"],[1,"controls__item"],[1,"controls__button",3,"click"],[1,"controls__icon-wrapper"],["viewBox","0 0 64 64","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","video-camera",1,"controls__icon"],["id","Group"],["id","Group_2"],["id","Vector","d","M63.4134 16.2294C63.0454 15.9814 62.5787 15.928 62.1707 16.096L50.6668 20.6986V20C50.6668 16.3226 47.6748 13.3334 44.0001 13.3334H6.66663C2.992 13.3334 0 16.3226 0 20V44C0 47.6774 2.992 50.6666 6.66663 50.6666H44C47.6746 50.6666 50.6666 47.6772 50.6666 44V43.3014L62.1706 47.904C62.5812 48.072 63.048 48.0186 63.4132 47.7706C63.7786 47.5226 63.9999 47.1093 63.9999 46.6666V17.3334C64 16.8906 63.7786 16.4774 63.4134 16.2294Z","fill","white"],["id","no-camera",1,"controls__icon"],["id","Vector","d","M44.0002 13.3325H6.66735C2.99276 13.3325 0.000793457 16.3218 0.000793457 19.999V43.9988C0.000793457 47.6761 2.99276 50.6654 6.66735 50.6654H7.67797L44.9176 13.4257C44.6162 13.3832 44.315 13.3325 44.0002 13.3325Z","fill","white"],["id","Group_3"],["id","Group_4"],["id","Vector_2","d","M63.4134 16.2285C63.0454 15.9805 62.5788 15.9271 62.1708 16.0951L50.6669 20.6977V19.9991C50.6669 18.6417 50.2535 17.3831 49.5549 16.3297L63.608 2.2766C64.128 1.75661 64.128 0.911242 63.608 0.391247C63.088 -0.128748 62.2426 -0.128748 61.7226 0.391247L0.389996 61.724C-0.129999 62.244 -0.129999 63.0894 0.389996 63.6094C0.651369 63.868 0.992615 63.9988 1.33399 63.9988C1.67536 63.9988 2.01661 63.8681 2.27798 63.6094L15.2192 50.6655H44.0003C47.6749 50.6655 50.6669 47.6762 50.6669 43.9989V43.3003L62.1708 47.9029C62.5814 48.0709 63.0481 48.0175 63.4134 47.7695C63.7788 47.5215 64 47.1082 64 46.6655V17.3325C64 16.8898 63.7788 16.4765 63.4134 16.2285Z","fill","white"],["id","microphone",1,"controls__icon"],["id","Vector"],["fill-rule","evenodd","clip-rule","evenodd","d","M44.3474 12.1407L44.3468 17.2309V33.8672C44.3468 40.6024 38.9004 46.0823 32.206 46.0823C27.8366 46.0787 23.8059 43.7286 21.6503 39.9279L20.4131 36.8161C20.1824 35.875 20.0659 34.9098 20.0659 33.941V12.1407C20.0659 5.43551 25.5014 0 32.2066 0C38.9118 0 44.3474 5.43551 44.3474 12.1407Z","fill","white"],["fill-rule","evenodd","clip-rule","evenodd","d","M15.0971 33.7512C15.0947 36.1345 15.5932 38.4912 16.5596 40.6697L18.1223 43.4553C22.3699 49.6259 30.1387 52.3143 37.292 50.089C44.4453 47.8638 49.318 41.2426 49.3156 33.7518C49.3156 32.9026 50.0039 32.2143 50.8532 32.2143C51.7018 32.2143 52.3907 32.9026 52.3907 33.7518C52.4051 44.4499 44.0585 53.2951 33.3778 53.9017V60.9246H39.8098C40.6584 60.9246 41.3473 61.6135 41.3473 62.4622C41.3473 63.3114 40.6584 63.9997 39.8098 63.9997H24.6029C23.7537 63.9997 23.0654 63.3114 23.0654 62.4622C23.0654 61.6135 23.7537 60.9246 24.6029 60.9246H30.3033V53.847C25.6228 53.4212 21.2413 51.3623 17.926 48.0313C17.1926 47.298 16.5163 46.51 15.9031 45.6739L14.2418 42.9874C12.7757 40.1297 12.0148 36.9633 12.022 33.7512C12.022 32.902 12.7103 32.2137 13.5595 32.2137C14.4088 32.2137 15.0971 32.902 15.0971 33.7512Z","fill","white"],["id","no-microphone",1,"controls__icon"],["id","Vector","d","M52.9733 4.25592L44.3474 12.8813V12.1407C44.3474 5.43551 38.9118 0 32.2066 0C25.5014 0 20.0659 5.43551 20.0659 12.1407V33.941C20.0659 34.9098 20.1824 35.875 20.4131 36.8161L16.5596 40.6697C15.5932 38.4912 15.0947 36.1345 15.0971 33.7512C15.0971 32.902 14.4088 32.2137 13.5595 32.2137C12.7103 32.2137 12.022 32.902 12.022 33.7512C12.0148 36.9633 12.7757 40.1297 14.2418 42.9874L8.81411 48.4151C8.4117 48.8007 8.24954 49.3731 8.39008 49.9124C8.53002 50.4518 8.95105 50.8728 9.4898 51.0133C10.0291 51.1539 10.6021 50.9917 10.9877 50.5899L15.9031 45.6739C16.5163 46.51 17.1926 47.298 17.926 48.0313C21.2413 51.3623 25.6228 53.4212 30.3033 53.847V60.9246H24.6029C23.7537 60.9246 23.0654 61.6135 23.0654 62.4622C23.0654 63.3114 23.7537 63.9997 24.6029 63.9997H39.8098C40.6584 63.9997 41.3473 63.3114 41.3473 62.4622C41.3473 61.6135 40.6584 60.9246 39.8098 60.9246H33.3778V53.9017C44.0585 53.2951 52.4051 44.4499 52.3907 33.7518C52.3907 32.9026 51.7018 32.2143 50.8532 32.2143C50.0039 32.2143 49.3156 32.9026 49.3156 33.7518C49.318 41.2426 44.4453 47.8638 37.292 50.089C30.1387 52.3143 22.3699 49.6259 18.1224 43.4553L21.6503 39.9279C23.8059 43.7286 27.8366 46.0787 32.206 46.0823C38.9004 46.0823 44.3468 40.6024 44.3468 33.8672V17.2309L55.1475 6.43072C55.7481 5.83071 55.7481 4.85713 55.1475 4.25652C54.5469 3.65591 53.5733 3.65591 52.9733 4.25652V4.25592Z","fill","white"],["class","controls__item",4,"ngIf"],[1,"controls__button","controls__button--danger",3,"click"],["id","phone"],["id","Vector","d","M51.7097 13.2478C51.2458 12.7839 50.4959 12.7839 50.032 13.2478L1.38351 61.8963C0.919568 62.3602 0.919568 63.1101 1.38351 63.574C1.61488 63.8054 1.91864 63.9217 2.2224 63.9217C2.52615 63.9217 2.82991 63.8054 3.06129 63.574L51.7097 14.9256C52.1737 14.4628 52.1737 13.7117 51.7097 13.2478Z","fill","white"],["id","Vector_2","d","M16.9605 42.9635L26.1159 33.8081L21.3365 29.0287C18.91 26.6022 18.6869 24.3679 20.5878 21.5629C20.8535 21.1951 22.5444 19.6941 23.992 18.4839C24.9151 17.9333 25.5487 17.1181 25.8264 16.1155C26.1954 14.783 25.9225 13.2156 25.0516 11.6885C24.8463 11.3373 19.9625 3.06229 15.4583 0.680892C14.6171 0.235937 13.6714 0.0010004 12.721 0.0010004C11.1571 0.0010004 9.68576 0.610886 8.58109 1.71556L5.57082 4.72702C-3.21082 13.5098 -1.58525 24.419 10.2719 36.2749L16.9605 42.9635Z","fill","white"],["id","Vector_3","d","M63.313 48.5357C60.9304 44.0328 52.6566 39.1478 52.2923 38.9342C51.2304 38.329 50.1209 38.0099 49.0839 38.0099C47.5402 38.0099 46.2753 38.717 45.51 40.0033C44.2986 41.452 42.7964 43.1429 42.4345 43.4051C39.6129 45.3154 37.4071 45.1007 34.9652 42.6588L31.148 38.8416L21.9926 47.997L27.7189 53.7233C34.5356 60.5412 41.0367 63.9976 47.0371 63.9976C47.0383 63.9976 47.0383 63.9976 47.0383 63.9976C51.4534 63.9976 55.5672 62.1217 59.2669 58.4232L62.2771 55.413C64.1068 53.5845 64.5233 50.821 63.313 48.5357Z","fill","white"],["id","fullscreen",1,"controls__icon"],["id","Vector","d","M57.8018 53.4382L44.3964 40.0328L40.0328 44.3964L53.4382 57.8018H43.0205V64H64V43.0205H57.8018V53.4382Z","fill","white"],["id","Vector_2","d","M44.3964 23.9803L57.8018 10.5618V20.9795H64V0H43.0205V6.1982H53.4382L40.0328 19.6036L44.3964 23.9803Z","fill","white"],["id","Vector_3","d","M19.6036 40.0328L6.1982 53.4382V43.0205H0V64H20.9795V57.8018H10.5618L23.9803 44.3964L19.6036 40.0328Z","fill","white"],["id","Vector_4","d","M20.9795 6.1982V0H0V20.9795H6.1982V10.5618L19.6036 23.9803L23.9803 19.6036L10.5618 6.1982H20.9795Z","fill","white"],["id","exit-full-screen",1,"controls__icon"],["id","fullscreen_x5F_exit"],["id","Vector","d","M49.172 54.828L58.344 64L64 58.344L54.828 49.172L64 40H40V64L49.172 54.828Z","fill","white"],["id","Vector_2","d","M0 24H24V0L14.828 9.172L5.75 0.086L0.094 5.742L9.172 14.828L0 24Z","fill","white"],["id","Vector_3","d","M0 58.344L5.656 64L14.828 54.828L24 64V40H0L9.172 49.172L0 58.344Z","fill","white"],["id","Vector_4","d","M40 24H64L54.828 14.828L63.922 5.742L58.266 0.086L49.172 9.172L40 0V24Z","fill","white"],[1,"controls__button","controls__button--rotate",3,"click"],["filter","url(#filter0_d_0_4)"],["d","M-4.81762e-07 34.7678V57.0215C-4.81762e-07 60.8696 3.13284 64 6.98275 64H57.016C60.8672 64 64 60.8696 64 57.0215V7.05508C64 3.20697 60.8672 0.0757321 57.016 0.0757321H34.6959C35.8972 1.3077 36.6961 2.93443 36.871 4.74067H57.0168C58.2942 4.74067 59.3335 5.77899 59.3335 7.05508V57.0216C59.3335 58.2969 58.2942 59.3352 57.0168 59.3352H6.98342C5.7062 59.3352 4.66761 58.2969 4.66761 57.0216V36.9389C2.90982 36.7703 1.27948 36.0149 -4.81762e-07 34.7678ZM10.7807 30.6654H26.0384L1.34093 5.97437C-0.02533 4.60686 -0.02533 2.39174 1.34093 1.02583C2.70813 -0.341677 4.92462 -0.341677 6.29089 1.02423L30.9883 25.7159V10.4614C30.9883 8.52907 32.5556 6.96139 34.4888 6.96139C35.4553 6.96139 36.3305 7.35214 36.9642 7.98612C37.5976 8.62116 37.9897 9.49543 37.9897 10.4613V34.1643C37.9897 36.0966 36.4228 37.6635 34.4896 37.6635H10.7807C8.84705 37.6635 7.28056 36.0974 7.28056 34.1643C7.28056 32.2312 8.84705 30.6654 10.7807 30.6654Z","fill","white"],["id","filter0_d_0_4","x","-4","y","0","width","72","height","72","filterUnits","userSpaceOnUse","color-interpolation-filters","sRGB"],["flood-opacity","0","result","BackgroundImageFix"],["in","SourceAlpha","type","matrix","values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0","result","hardAlpha"],["dy","4"],["stdDeviation","2"],["in2","hardAlpha","operator","out"],["type","matrix","values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"],["mode","normal","in2","BackgroundImageFix","result","effect1_dropShadow_0_4"],["mode","normal","in","SourceGraphic","in2","effect1_dropShadow_0_4","result","shape"]],template:function(t,o){1&t&&(fe(0,"div",0),fe(1,"div",1),fe(2,"button",2),dn("click",function(){return o.onToggleCamera()}),fe(3,"div",3),Js(),fe(4,"svg",4),fe(5,"g",5),fe(6,"g",6),fe(7,"g",7),Ue(8,"path",8),_e(),_e(),_e(),fe(9,"g",9),fe(10,"g",6),fe(11,"g",7),Ue(12,"path",10),_e(),_e(),fe(13,"g",11),fe(14,"g",12),Ue(15,"path",13),_e(),_e(),_e(),_e(),_e(),Xs(),fe(16,"p"),Yt(17,"Camera"),_e(),_e(),_e(),fe(18,"div",1),fe(19,"button",2),dn("click",function(){return o.onToggleMicrophone()}),fe(20,"div",3),Js(),fe(21,"svg",4),fe(22,"g",14),fe(23,"g",15),Ue(24,"path",16),Ue(25,"path",17),_e(),_e(),fe(26,"g",18),Ue(27,"path",19),_e(),_e(),_e(),Xs(),fe(28,"p"),Yt(29,"Mic"),_e(),_e(),_e(),Qn(30,vz,22,7,"div",20),Qn(31,Cz,18,2,"div",20),fe(32,"div",1),fe(33,"button",21),dn("click",function(){return o.onEndCall()}),fe(34,"div",3),Js(),fe(35,"svg",4),fe(36,"g",22),fe(37,"g",6),Ue(38,"path",23),Ue(39,"path",24),Ue(40,"path",25),_e(),_e(),_e(),_e(),Xs(),fe(41,"p"),Yt(42,"End"),_e(),_e(),_e(),_e()),2&t&&(Jt("controls--small",o.smallScreenEnabled),Ke(2),Jt("controls__button--active",o.cameraEnabled),Ke(3),Jt("controls__icon--shown",o.cameraEnabled),Ke(4),Jt("controls__icon--shown",!o.cameraEnabled),Ke(10),Jt("controls__button--active",o.microphoneEnabled),Ke(3),Jt("controls__icon--shown",o.microphoneEnabled),Ke(4),Jt("controls__icon--shown",!o.microphoneEnabled),Ke(4),Xe("ngIf",!o.smallScreenEnabled),Ke(1),Xe("ngIf",o.displaySmallScreen))},directives:[qn],styles:["[_nghost-%COMP%]{transition:.3s}.controls[_ngcontent-%COMP%]{background:rgba(0,0,0,.3);bottom:0;display:flex;justify-content:center;padding:15px 0;position:absolute;left:0;width:100%}.controls--small[_ngcontent-%COMP%]{border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding:5px 0}.controls--small[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{height:32px;width:32px}.controls--small[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:16px;width:16px}.controls--small[_ngcontent-%COMP%]   .controls__item[_ngcontent-%COMP%]{margin:0}.controls--small[_ngcontent-%COMP%]   .controls__button[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:none}.controls__item[_ngcontent-%COMP%]{margin:0 5px;text-align:center}.controls__button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer}.controls__button[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#101316}.controls__button--active[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#0b73c9}.controls__button--active[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#158ef2}.controls__button--active.controls__button--rotate[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{transform:translate(-50%,-50%) rotate(-180deg)}.controls__button--danger[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#d73b3d}.controls__button--danger[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#e06567}.controls__button[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;margin:8px 0 0}.controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#313a42;border-radius:50%;box-shadow:0 3px 8px #00000080;margin:auto;position:relative;height:60px;width:60px;transition:.3s}.controls__icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%) rotate(0);height:32px;width:32px;transition:.3s}.controls__icon[_ngcontent-%COMP%]{opacity:0;transition:.3s}.controls__icon--shown[_ngcontent-%COMP%]{opacity:1}"],changeDetection:0}),n})(),Lz=(()=>{class n{constructor(){this.error=!1,this.connected=!0,this.ended=!1,this.small=!1}get color(){return this.ended?"#aaa":this.error?"#d73b3d":this.connected?"#37D425":"#1195E6"}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=ki({type:n,selectors:[["ngx-spinner"]],inputs:{error:"error",connected:"connected",ended:"ended",small:"small",text:"text"},decls:8,vars:9,consts:[[1,"spinner",3,"ngClass"],[1,"spinner__wrapper"],[1,"spinner__icon"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 32 32","fill","none"],["d","M5.25 5.5C3.45507 5.5 2 6.95508 2 8.75V19.25C2 21.0449 3.45507 22.5 5.25 22.5H14.75C16.5449 22.5 18 21.0449 18 19.25V8.75C18 6.95507 16.5449 5.5 14.75 5.5H5.25Z"],["d","M23.1232 20.6431L19.5 17.0935V10.9989L23.1121 7.3706C23.8988 6.58044 25.248 7.13753 25.248 8.25251V19.7502C25.248 20.8577 23.9143 21.4181 23.1232 20.6431Z"],[1,"spinner__cirle"],["class","spinner__text",4,"ngIf"],[1,"spinner__text"]],template:function(t,o){1&t&&(fe(0,"div",0),fe(1,"div",1),fe(2,"div",2),Js(),fe(3,"svg",3),Ue(4,"path",4),Ue(5,"path",5),_e(),_e(),Xs(),Ue(6,"div",6),Qn(7,Sz,2,1,"div",7),_e(),_e()),2&t&&(Xe("ngClass",VD(4,Tz,o.connected,o.ended,o.small,o.error)),Ke(4),yi("fill",o.color),Ke(1),yi("fill",o.color),Ke(2),Xe("ngIf",!o.small))},directives:[yy,qn],styles:[".spinner[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;position:relative;transition:.3s}.spinner--connected[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:#37d425}.spinner--ended[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:transparent}.spinner--error[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:#d73b3d}.spinner--small[_ngcontent-%COMP%]{border-radius:10px;height:200px}.spinner--small[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-width:4px;height:80px;width:80px}.spinner--small[_ngcontent-%COMP%]   .spinner__icon[_ngcontent-%COMP%]{top:26px;transform:translate(-35%)}.spinner--small[_ngcontent-%COMP%]   .spinner__icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:32px;width:32px}.spinner__wrapper[_ngcontent-%COMP%]{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%)}.spinner__cirle[_ngcontent-%COMP%]{animation:spin 2s linear infinite;border:5px solid #1195E6;border-radius:50%;border-top-color:transparent;height:160px;margin:auto;width:160px;transition:.3s}.spinner__icon[_ngcontent-%COMP%]{left:50%;position:absolute;top:52px;transform:translate(-40%);transition:.3s}.spinner__icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:64px;width:64px;transition:.3s}.spinner__text[_ngcontent-%COMP%]{color:#fff;font-size:1.3em;margin-top:25px;text-align:center}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"],changeDetection:0}),n})(),xz=(()=>{class n{constructor(){this.started=Date.now()}ngOnInit(){this.time$=L4(0,1e3).pipe(Cn(()=>this.format(Date.now()-this.started)))}format(t){const o=Math.floor(t/1e3%60).toString().padStart(2,"0"),c=Math.floor(t/6e4%60).toString().padStart(2,"0");return[Math.floor(t/36e5%24).toString().padStart(2,"0"),c,o].join(":")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=ki({type:n,selectors:[["ngx-timer"]],inputs:{started:"started"},decls:4,vars:3,consts:[[1,"timer"]],template:function(t,o){1&t&&(fe(0,"div",0),fe(1,"span"),Yt(2),Ll(3,"async"),_e(),_e()),2&t&&(Ke(2),Pt(xl(3,1,o.time$)))},pipes:[bp],styles:[".timer[_ngcontent-%COMP%]{color:#fff;position:relative;text-align:center;z-index:1}.timer[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:rgba(0,0,0,.3);border-radius:5px;padding:5px 10px}"],changeDetection:0}),n})(),Fz=(()=>{class n extends f6{constructor(t){super(t),this.fullScreen=!1}ngOnInit(){this.play(`assets/${this.data.outcome?"outcome":"income"}.mp3`)}ngOnDestroy(){this.stop()}onAcceptCall(){this.fullScreen=!0,this.cdr.markForCheck(),this.afterClosed.next(this.data)}onDeclineCall(){this.play("assets/cancel.mp3"),setTimeout(()=>this.closeDialog(null),200)}play(t,o=!0){this.audio&&this.stop(),this.audio=new Audio(t),this.audio.loop=o,this.audio.load(),this.audio.play()}stop(){this.audio.pause(),this.audio.remove()}}return n.\u0275fac=function(t){return new(t||n)(Y(zo))},n.\u0275cmp=ki({type:n,selectors:[["ngx-video-call"]],inputs:{data:"data"},features:[Dt],decls:1,vars:1,consts:[["class","video-call",3,"video-call--full-screen",4,"ngIf"],[1,"video-call"],[1,"video-call-user"],[1,"video-call-user__block","video-call-user__block--animated"],["alt","",1,"video-call-user__img",3,"src"],[1,"video-call-user__title"],[4,"ngIf","ngIfElse"],["income",""],[1,"video-call__actions"],[4,"ngIf"],["aria-label","Decline",1,"video-call__button","video-call__button--decline",3,"click"],["aria-label","Accept",1,"video-call__button","video-call__button--accept",3,"click"]],template:function(t,o){1&t&&Qn(0,wz,12,7,"div",0),2&t&&Xe("ngIf",o.shown&&o.data)},directives:[qn],styles:['[_nghost-%COMP%]{display:block;height:100vh;position:relative}.video-call[_ngcontent-%COMP%]{background-image:linear-gradient(#3F51B5,#313A42);background-size:cover;border-radius:10px;box-shadow:0 5px 10px #0000001a;display:flex;flex-direction:column;height:100%;justify-content:flex-end;left:0;left:50%;max-height:400px;max-width:400px;position:absolute;top:0;top:50%;transform:translate(-50%,-50%);width:100%;z-index:5;transition:.3s}.video-call--full-screen[_ngcontent-%COMP%]{background-image:linear-gradient(#22292F);border-radius:0;max-height:100%;max-width:100%}.video-call-user[_ngcontent-%COMP%]{left:50%;position:absolute;text-align:center;top:50%;transform:translate(-50%,-55%);z-index:1}.video-call-user__block[_ngcontent-%COMP%]{background:#fff;border-radius:50%;border:solid 5px #fff;height:180px;margin:0 auto;transform:scale(1);width:180px}.video-call-user__block--animated[_ngcontent-%COMP%]{animation:play 2s ease infinite;-webkit-backface-visibility:hidden;backface-visibility:hidden}.video-call-user__img[_ngcontent-%COMP%]{border-radius:50%;height:100%;left:0px;object-fit:cover;position:absolute;top:0px;width:100%}.video-call-user__title[_ngcontent-%COMP%]{color:#fff;font-size:1.2em;font-weight:700;margin:15px 0 0}.video-call__actions[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:10px 0}.video-call__button[_ngcontent-%COMP%]{border-radius:50%;box-shadow:0 0 #3f51b500,0 .05em .1em #0003;border:0;cursor:pointer;display:block;font-size:40px;height:1em;margin:0 5px;position:relative;transform:translate(0) scale(1);width:1em;transition:.3s}.video-call__button[_ngcontent-%COMP%]:before, .video-call__button[_ngcontent-%COMP%]:after{content:"";position:absolute}.video-call__button[_ngcontent-%COMP%]:before{background-color:#ffffff1a;border-radius:50%;height:1em;left:0;opacity:1;top:0;transform:translate(0) scale(0);width:1em}.video-call__button[_ngcontent-%COMP%]:after{background-position:50% 50%;background-repeat:no-repeat;background-size:cover;background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTYuNiAxMC44YzEuNCAyLjggMy44IDUuMSA2LjYgNi42bDIuMi0yLjJjLjMtLjMuNy0uNCAxLS4yIDEuMS40IDIuMy42IDMuNi42LjUgMCAxIC40IDEgMVYyMGMwIC41LS41IDEtMSAxLTkuNCAwLTE3LTcuNi0xNy0xNyAwLS42LjQtMSAxLTFoMy41Yy41IDAgMSAuNCAxIDEgMCAxLjIuMiAyLjUuNiAzLjYuMS40IDAgLjctLjIgMWwtMi4zIDIuMnoiIGZpbGw9IiNmZmZmZmYiLz48L3N2Zz4=);height:.5em;left:.25em;top:.25em;transform:translate(0);width:.5em;transition:.3s}.video-call__button--accept[_ngcontent-%COMP%]{animation:phone-outer 3s infinite;background-color:#3f51b5}.video-call__button--accept[_ngcontent-%COMP%]:before{animation:phone-inner 3s infinite}.video-call__button--accept[_ngcontent-%COMP%]:after{animation:phone-icon 3s infinite}.video-call__button--decline[_ngcontent-%COMP%]{background-color:#d73b3d}.video-call__button--decline[_ngcontent-%COMP%]:hover{background-color:#ce2a2c}.video-call__button--decline[_ngcontent-%COMP%]:after{top:.28em;transform:translate(0) rotate(135deg)}@keyframes play{0%{transform:scale(1)}15%{box-shadow:0 0 0 5px #9b9da466}25%{box-shadow:0 0 0 10px #9b9da466,0 0 0 20px #9b9da433}25%{box-shadow:0 0 0 15px #9b9da466,0 0 0 30px #9b9da433}}@keyframes phone-outer{0%{box-shadow:0 0 #3f51b500,0 .05em .1em #0003;transform:translate(0) scale(1)}33.3333%{box-shadow:0 0 #3f51b51a,0 .05em .1em #00000080;transform:translate(0) scale(1.1)}66.6666%{box-shadow:0 0 0 .5em #3f51b500,0 .05em .1em #0003;transform:translate(0) scale(1)}to{box-shadow:0 0 #3f51b500,0 .05em .1em #0003;transform:translate(0) scale(1)}}@keyframes phone-inner{0%{opacity:1;transform:translate(0) scale(0)}33.3333%{opacity:1;transform:translate(0) scale(.9)}66.6666%{opacity:0;transform:translate(0) scale(0)}to{opacity:0;transform:translate(0) scale(0)}}@keyframes phone-icon{0%{transform:translate(0)}2%{transform:translate(.01em)}4%{transform:translate(-.01em)}6%{transform:translate(.01em)}8%{transform:translate(-.01em)}10%{transform:translate(.01em)}12%{transform:translate(-.01em)}14%{transform:translate(.01em)}16%{transform:translate(-.01em)}18%{transform:translate(.01em)}20%{transform:translate(-.01em)}22%{transform:translate(.01em)}24%{transform:translate(-.01em)}26%{transform:translate(.01em)}28%{transform:translate(-.01em)}30%{transform:translate(.01em)}32%{transform:translate(-.01em)}34%{transform:translate(.01em)}36%{transform:translate(-.01em)}38%{transform:translate(.01em)}40%{transform:translate(-.01em)}42%{transform:translate(.01em)}44%{transform:translate(-.01em)}46%{transform:translate(0)}}'],data:{animation:[p6]},changeDetection:0}),n})();const _6={connected:!1,loading:!0,statusText:"Initializing",started:null,ended:!1,error:!1},Uz={mode:"rtc",codec:"h264"};let m6=(()=>{class n{constructor(t){this.config=t,this.agoraRTC=yz(),this.streamState=new Vs(_6),this.remoteStreamVideoToggle=new Vs(!0),this.callEnd=new xt,this.localContainerId="local-video",this.remoteCalls=[],this.remoteStreamVideoToggle$=this.remoteStreamVideoToggle.asObservable(),this.streamState$=this.streamState.asObservable(),this.agoraRTC.checkSystemRequirements()||this.handleError(new Error("Web RTC is not supported in this browser"))}init(t,o,c=!1){return this.uid=t,this.agoraRTC.setLogLevel(c?0:4),this.client=this.agoraRTC.createClient(Uz),this.assignClientHandlers(),this.initLocalStream().then(()=>{this.client.join(this.config.AppID,o,null,this.uid).then(()=>{this.localTracks.videoTrack.play(this.localContainerId),this.client.publish(Object.values(this.localTracks)),this.streamState.next(Object.assign(Object.assign({},this.streamState.value),{connected:!0,statusText:"Waiting others to join"}))})}),this.callEnd.asObservable()}deinit(){this.streamState.next(_6)}endCall(){this.client.leave().then(()=>{Object.values(this.localTracks).forEach(t=>{t.stop(),t.close()}),this.streamState.next(Object.assign(Object.assign({},this.streamState.value),{started:null,loading:!0,statusText:"",ended:!0})),this.remoteCalls=[],TU(500).pipe(Ao(1)).subscribe(()=>this.callEnd.next())})}toggleVideo(t){this.localTracks&&this.localTracks.videoTrack.setMuted(t)}toggleAudio(t){this.localTracks&&this.localTracks.audioTrack.setMuted(t)}toggleFullScreen(t){t?document.exitFullscreen():document.documentElement.requestFullscreen()}isVideoEnabled(){return!!this.localTracks&&!this.localTracks.videoTrack.muted}isAudioEnabled(){return!!this.localTracks&&!this.localTracks.audioTrack.muted}assignClientHandlers(){this.client.on("user-joined",t=>{this.streamState.next(Object.assign(Object.assign({},this.streamState.value),{started:Date.now(),loading:!1})),this.remoteCalls.length||this.remoteCalls.push(this.getRemoteId(t))}),this.client.on("user-published",(t,o)=>{const c=this.getRemoteId(t);this.client.subscribe(t,o).then(u=>{this.remoteCalls.includes(c)&&u.play(c)})}),this.client.on("user-info-updated",(t,o)=>{"mute-video"===o&&this.remoteStreamVideoToggle.next(!1),"unmute-video"===o&&this.remoteStreamVideoToggle.next(!0)}),this.client.on("user-left",()=>{this.endCall()})}initLocalStream(){return Promise.all([this.agoraRTC.createCameraVideoTrack(),this.agoraRTC.createMicrophoneAudioTrack()]).then(([t,o])=>{this.localTracks={audioTrack:o,videoTrack:t}}).catch(t=>{this.handleError(t)})}getRemoteId(t){return`remote_call-${t.uid}`}handleError(t){throw this.streamState.next(Object.assign(Object.assign({},this.streamState.value),{statusText:t.message,error:!0})),TU(5e3).pipe(Ao(1)).subscribe(()=>this.callEnd.next()),new Error(t.message)}}return n.\u0275fac=function(t){return new(t||n)(ie("AgoraConfig"))},n.\u0275prov=Pe({factory:function(){return new n(ie("AgoraConfig"))},token:n,providedIn:"root"}),n})(),g6=(()=>{class n extends f6{constructor(t,o){super(o),this.webRtcService=t,this.animate=!0,this.displaySmallScreen=!1,this.debug=!1,this.callEnd=new ft,this.smallScreenEnabled=!1,this.active=!1,this.streamState$=this.webRtcService.streamState$,this.remoteStreamVideoToggle$=this.webRtcService.remoteStreamVideoToggle$}ngOnInit(){this.webRtcService.init(this.uid,this.channel,this.debug).pipe(Ao(1)).subscribe(()=>{this.active=this.smallScreenEnabled,this.callEnd.emit(),this.closeDialog(!0)})}ngOnDestroy(){this.webRtcService.deinit()}get localContainerId(){return this.webRtcService.localContainerId}get remoteCalls(){return this.webRtcService.remoteCalls}get cameraEnabled(){return this.webRtcService.isVideoEnabled()}get microphoneEnabled(){return this.webRtcService.isAudioEnabled()}get fullScreenEnabled(){return!!document.fullscreenElement}onToggleCamera(t){this.webRtcService.toggleVideo(t)}onToggleMicrophone(t){this.webRtcService.toggleAudio(t)}onToggleFullScreen(t){this.webRtcService.toggleFullScreen(t)}onToggleSmallScreen(t){this.smallScreenEnabled=!t,this.active=!0}onEndCall(){this.webRtcService.endCall()}}return n.\u0275fac=function(t){return new(t||n)(Y(m6),Y(zo))},n.\u0275cmp=ki({type:n,selectors:[["ngx-webrtc"]],hostVars:4,hostBindings:function(t,o){2&t&&Jt("small-screen",o.smallScreenEnabled)("active",o.active)},inputs:{animate:"animate",displaySmallScreen:"displaySmallScreen",debug:"debug",uid:"uid",channel:"channel"},outputs:{callEnd:"callEnd"},features:[Dt],decls:1,vars:1,consts:[[4,"ngIf"],["class","container",4,"ngIf"],[1,"container"],[3,"error","text","connected","ended","small",4,"ngIf"],[3,"started",4,"ngIf"],[1,"container__local",3,"id"],["class","container__remote",3,"id","hidden",4,"ngFor","ngForOf"],[1,"container__user-icon"],["viewBox","0 0 64 64","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","user","clip-path","url(#clip0)"],["id","Vector","d","M31.5439 30.829C35.7793 30.829 39.4468 29.3099 42.4434 26.3129C45.4399 23.3163 46.959 19.6498 46.959 15.414C46.959 11.1796 45.4399 7.51267 42.4429 4.51512C39.4458 1.51904 35.7788 0 31.5439 0C27.3081 0 23.6416 1.51904 20.645 4.51561C17.6484 7.51218 16.1289 11.1792 16.1289 15.414C16.1289 19.6498 17.6484 23.3168 20.6455 26.3134C23.6426 29.3095 27.3096 30.829 31.5439 30.829V30.829Z","fill","#0B73C9"],["id","Vector_2","d","M58.5161 49.2127C58.4297 47.9656 58.2549 46.6053 57.9976 45.1688C57.7378 43.7215 57.4033 42.3533 57.0029 41.1029C56.5894 39.8104 56.0269 38.534 55.3315 37.3109C54.6099 36.0414 53.7622 34.9359 52.811 34.0262C51.8164 33.0746 50.5986 32.3094 49.1904 31.7513C47.7871 31.1962 46.2319 30.9149 44.5684 30.9149C43.915 30.9149 43.2832 31.183 42.063 31.9774C41.312 32.4672 40.4336 33.0336 39.4531 33.66C38.6147 34.1942 37.479 34.6947 36.0762 35.1478C34.7075 35.5907 33.3179 35.8153 31.9463 35.8153C30.5747 35.8153 29.1855 35.5907 27.8154 35.1478C26.4141 34.6952 25.2783 34.1947 24.4409 33.6605C23.4697 33.0399 22.5908 32.4735 21.8286 31.9769C20.6099 31.1825 19.9775 30.9144 19.3242 30.9144C17.6602 30.9144 16.1055 31.1962 14.7026 31.7518C13.2954 32.309 12.0771 33.0741 11.0815 34.0267C10.1309 34.9369 9.28271 36.0419 8.56201 37.3109C7.86719 38.534 7.30469 39.8099 6.89062 41.1034C6.49072 42.3538 6.15625 43.7215 5.89648 45.1688C5.63916 46.6033 5.46436 47.9642 5.37793 49.2142C5.29297 50.4388 5.25 51.7098 5.25 52.9934C5.25 56.3343 6.31201 59.0388 8.40625 61.0335C10.4746 63.0017 13.2114 64.0002 16.5396 64.0002H47.356C50.6841 64.0002 53.4199 63.0022 55.4888 61.0335C57.5835 59.0403 58.6455 56.3352 58.6455 52.993C58.645 51.7034 58.6016 50.4314 58.5161 49.2127V49.2127Z","fill","#0B73C9"],["id","clip0"],["width","64","height","64","fill","#0B73C9"],["ngxToggle","",3,"cameraEnabled","microphoneEnabled","fullScreenEnabled","smallScreenEnabled","displaySmallScreen","toggleCamera","toggleMicrophone","toggleFullScreen","toggleSmallScreen","endCall",4,"ngIf"],[3,"error","text","connected","ended","small"],[3,"started"],[1,"container__remote",3,"id"],["ngxToggle","",3,"cameraEnabled","microphoneEnabled","fullScreenEnabled","smallScreenEnabled","displaySmallScreen","toggleCamera","toggleMicrophone","toggleFullScreen","toggleSmallScreen","endCall"]],template:function(t,o){1&t&&Qn(0,Mz,3,5,"div",0),2&t&&Xe("ngIf",o.shown)},directives:function(){return[qn,Jc,Lz,xz,kz,Bz]},pipes:function(){return[bp]},styles:["ngx-timer[_ngcontent-%COMP%]{display:block;padding-top:25px}[_nghost-%COMP%]{bottom:0;max-width:100%;right:0;width:100%;transition:.3s}.active[_nghost-%COMP%]{position:fixed}.small-screen[_nghost-%COMP%]{max-width:210px}.small-screen[_nghost-%COMP%]   ngx-timer[_ngcontent-%COMP%]{padding-top:10px}.small-screen[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{border-radius:10px;box-shadow:#00000059 0 5px 15px;height:200px;max-width:200px;margin-right:10px;margin-bottom:10px}.small-screen[_nghost-%COMP%]   .container__remote[_ngcontent-%COMP%]{border-radius:10px;height:200px;width:200px}.small-screen[_nghost-%COMP%]   .container__remote[_ngcontent-%COMP%]    >div{border-radius:10px}.small-screen[_nghost-%COMP%]   .container__user-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:32px;width:32px}.container[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;max-width:100%;margin-left:auto;overflow:hidden;position:relative;transition:.3s}.container__local[_ngcontent-%COMP%]{border-radius:5px;height:20vh;opacity:1;overflow:hidden;position:absolute;right:1rem;top:1rem;width:20vw;z-index:1;transition:.3s}.container__local.hidden[_ngcontent-%COMP%]{opacity:0;visibility:hidden}.container__local[_ngcontent-%COMP%]:not(:empty){box-shadow:0 3px 8px #00000080}.container__remote[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;left:0;position:absolute;top:0;width:100vw;transition:.3s}.container__remote[_ngcontent-%COMP%]    >div{transition:.3s}.container__remote.hidden[_ngcontent-%COMP%]{display:none}.container__remote.hidden[_ngcontent-%COMP%] + .container__user-icon[_ngcontent-%COMP%]{display:block}.container__remote[_ngcontent-%COMP%]:empty{display:none}.container__user-icon[_ngcontent-%COMP%]{background:rgba(0,0,0,.3);border-radius:50%;box-shadow:0 3px 8px #00000080;display:none;left:50%;padding:20px;position:absolute;top:50%;transform:translate(-50%,-50%)}.container__user-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:64px;width:64px}@media screen and (max-width: 769px){ngx-controls[_ngcontent-%COMP%]{opacity:1!important}}"],data:{animation:[p6]},changeDetection:0}),n})(),Vz=(()=>{class n{constructor(t){this.dialog=t}open(t){const o=new xt,c=this.dialog.open(Fz,{data:t});return c.afterClosed.asObservable().pipe(td(u=>(null==u?void 0:u.channel)?this.dialog.open(g6,{uid:u.uid,channel:u.channel,debug:!!u.debug,displaySmallScreen:!0}).afterClosed.asObservable():Ct(!1)),Ao(1),cs(()=>o.next(!0))).subscribe(),{acceptCall:c.onAcceptCall.bind(c),close:c.closeDialog.bind(c),afterConfirmation:()=>c.afterClosed.asObservable().pipe(Ao(1)),afterCallEnd:()=>o.asObservable().pipe(Ao(1))}}}return n.\u0275fac=function(t){return new(t||n)(ie(h6))},n.\u0275prov=Pe({factory:function(){return new n(ie(h6))},token:n,providedIn:"root"}),n})(),Bz=(()=>{class n{constructor(t,o){this.renderer=t,this.el=o,this.subscription=new en,this.delay=5e3}onEnter(){this.subscription.unsubscribe(),this.setStyle(1)}onLeave(){this.hide()}ngOnInit(){this.hide()}hide(){this.subscription.unsubscribe(),this.subscription=TU(this.delay).pipe(Ao(1)).subscribe(()=>this.setStyle(0))}setStyle(t){this.renderer.setStyle(this.el.nativeElement,"opacity",t)}}return n.\u0275fac=function(t){return new(t||n)(Y(Ts),Y(Ot))},n.\u0275dir=Ae({type:n,selectors:[["","ngxToggle",""]],hostBindings:function(t,o){1&t&&dn("mouseenter",function(){return o.onEnter()})("mouseleave",function(){return o.onLeave()})}}),n})(),jz=(()=>{class n{static forRoot(t){return{ngModule:n,providers:[m6,{provide:"AgoraConfig",useValue:t}]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ln({type:n}),n.\u0275inj=qt({imports:[[im]]}),n})();const Hz=[{path:"",component:(()=>{class n{constructor(t,o,c,u,p){this.formBuilder=t,this.router=o,this.localStorage=c,this.videoCallDialogService=u,this.cdr=p,this.sessionKey="ngx-webrtc:channelId",this.outcome=!1}get channelId(){return this.localStorage.getItem(this.sessionKey)||"test-channel-ngx-webrtc"}get tooltipText(){return this.outcome?"Outcome":"Income"}ngOnInit(){this.form=this.formBuilder.group({channelId:[this.channelId,NW.required]})}onSubmit(){this.saveChannel(),this.router.navigate(["conference"],{queryParams:Object.assign({},this.form.value)})}onModalOpen(){this.saveChannel(),this.dialog=this.videoCallDialogService.open({uid:String(Math.floor(100*Math.random())),channel:this.channelId,outcome:this.outcome,user:{name:"Test User",photoURL:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTvDtoEwuV9E2kHqNDi6MnBzXlefn8TfyrwgQ&usqp=CAU"},debug:!0});const t=setTimeout(()=>{var o;return null===(o=this.dialog)||void 0===o?void 0:o.close()},7e3);this.dialog.afterConfirmation().pipe(xp(o=>!!o),cs(()=>clearTimeout(t))).subscribe(),this.dialog.afterCallEnd().subscribe(()=>{clearTimeout(t),this.dialog=null,this.cdr.markForCheck()})}saveChannel(){const{channelId:t}=this.form.value;this.localStorage.setItem(this.sessionKey,t)}}return n.\u0275fac=function(t){return new(t||n)(Y(g9),Y(Do),Y(Storage),Y(Vz),Y(zo))},n.\u0275cmp=ki({type:n,selectors:[["app-home"]],decls:25,vars:8,consts:[[1,"home"],[1,"home__welcome"],[1,"home__form",3,"formGroup","ngSubmit"],[1,"home__wrapper","home__wrapper--center"],["src","assets/user.svg","alt","User",1,"user"],[1,"home__title"],[1,"home__wrapper"],["matInput","","placeholder","Channel id","formControlName","channelId"],[1,"home__wrapper","home__wrapper--center","home__wrapper--buttons"],["mat-flat-button","","color","primary",1,"home__btn",3,"disabled"],["mat-raised-button","","type","button",1,"home__btn",3,"disabled","click"],[3,"checked","disabled","matTooltip","change","click"],[1,"home__footer"],["href","https://www.npmjs.com/package/ngx-webrtc-lib","target","_blank"],["viewBox","0 0 27.23 27.23"],["width","27.23","height","27.23","rx","2"],["fill","#fff","points","5.8 21.75 13.66 21.75 13.67 9.98 17.59 9.98 17.58 21.76 21.51 21.76 21.52 6.06 5.82 6.04 5.8 21.75"],["href","https://github.com/TarasMoskovych/ngx-webrtc","target","_blank"],["aria-hidden","true","role","img","viewBox","0 0 16 16","width","50","height","50",1,""],["fill-rule","evenodd","d","M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"]],template:function(t,o){1&t&&(fe(0,"div",0),fe(1,"div",1),fe(2,"form",2),dn("ngSubmit",function(){return!o.dialog&&o.onSubmit()}),fe(3,"div",3),Ue(4,"img",4),_e(),fe(5,"h1",5),Yt(6," Welcome "),_e(),fe(7,"mat-form-field",6),fe(8,"mat-label"),Yt(9,"Channel Id"),_e(),Ue(10,"input",7),_e(),fe(11,"div",8),fe(12,"button",9),Yt(13,"Start / Join call"),_e(),fe(14,"button",10),dn("click",function(){return!o.dialog&&o.onModalOpen()}),Yt(15,"Open Call Dialog "),fe(16,"mat-slide-toggle",11),dn("change",function(u){return o.outcome=u.checked})("click",function(u){return u.stopPropagation()}),_e(),_e(),_e(),_e(),fe(17,"div",12),fe(18,"a",13),Js(),fe(19,"svg",14),Ue(20,"rect",15),Ue(21,"polygon",16),_e(),_e(),Xs(),fe(22,"a",17),Js(),fe(23,"svg",18),Ue(24,"path",19),_e(),_e(),_e(),_e(),_e()),2&t&&(Ke(2),Xe("formGroup",o.form),Ke(5),Jt("mat-focused",o.form.valid),Ke(5),Xe("disabled",o.form.invalid||!!o.dialog),Ke(2),Xe("disabled",o.form.invalid||!!o.dialog),Ke(2),Xe("checked",o.outcome)("disabled",!!o.dialog)("matTooltip",o.tooltipText))},directives:[u4,t4,CR,CK,gU,IK,NP,e4,QF,M5,k5,cz],styles:[".home[_ngcontent-%COMP%]{align-items:center;background-color:#f2f2f2;display:flex;flex-wrap:wrap;justify-content:center;min-height:100vh;width:100%}.home__welcome[_ngcontent-%COMP%]{background:#fff;border-radius:10px;box-shadow:0 5px 10px #0000001a;overflow:hidden;padding:10px 40px;width:390px}.home__welcome[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]{height:150px}.home__title[_ngcontent-%COMP%]{color:#333;display:block;font-size:30px;font-weight:500;margin:10px 0 60px;text-align:center}.home__wrapper[_ngcontent-%COMP%]{width:100%}.home__wrapper--center[_ngcontent-%COMP%]{text-align:center}.home__wrapper--buttons[_ngcontent-%COMP%]{align-items:center;display:flex}.home__btn[_ngcontent-%COMP%]{margin:0 5px}.home__footer[_ngcontent-%COMP%]{margin-top:30px;text-align:center}.home__footer[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{fill:#333;cursor:pointer;height:24px;margin:0 5px;width:24px;transition:.3s}.home__footer[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]:hover{fill:#aaa}"],changeDetection:0}),n})()},{path:"conference",component:(()=>{class n{constructor(t,o){this.route=t,this.router=o,this.uid=String(Math.floor(100*Math.random()))}ngOnInit(){this.channel=this.route.snapshot.queryParams.channelId||"test-channel"}onCallEnd(){this.router.navigateByUrl("/")}}return n.\u0275fac=function(t){return new(t||n)(Y(mm),Y(Do))},n.\u0275cmp=ki({type:n,selectors:[["app-conference"]],decls:1,vars:4,consts:[[3,"animate","channel","debug","uid","callEnd"]],template:function(t,o){1&t&&(fe(0,"ngx-webrtc",0),dn("callEnd",function(){return o.onCallEnd()}),_e()),2&t&&Xe("animate",!1)("channel",o.channel)("debug",!0)("uid",o.uid)},directives:[g6],styles:[""],changeDetection:0}),n})()},{path:"**",redirectTo:""}];let Gz=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ln({type:n,bootstrap:[hz]}),n.\u0275inj=qt({providers:[{provide:Storage,useValue:window.localStorage}],imports:[[G,G8,jz.forRoot(u6_configs),D4,_W.forRoot(Hz),wK,NK,uz,WK]]}),n})();(function(){if(jT)throw new Error("Cannot enable prod mode after platform setup.");Cr=!1})(),I().bootstrapModule(Gz).catch(n=>console.error(n))},52:ba=>{function Ra(x,tl,cr,hs,ps,Ir,rc){try{var Uu=x[Ir](rc),fs=Uu.value}catch(en){return void cr(en)}Uu.done?tl(fs):Promise.resolve(fs).then(hs,ps)}ba.exports=function(x){return function(){var tl=this,cr=arguments;return new Promise(function(hs,ps){var Ir=x.apply(tl,cr);function rc(fs){Ra(Ir,hs,ps,rc,Uu,"next",fs)}function Uu(fs){Ra(Ir,hs,ps,rc,Uu,"throw",fs)}rc(void 0)})}},ba.exports.default=ba.exports,ba.exports.__esModule=!0}},ba=>{ba(ba.s=357)}]);