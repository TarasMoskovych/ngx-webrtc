(self.webpackChunkngx_webrtc=self.webpackChunkngx_webrtc||[]).push([[179],{149:(bc,Lm,Fm)=>{"use strict";function x(i){return"function"==typeof i}let Sc=!1;const Zi={Promise:void 0,set useDeprecatedSynchronousErrorHandling(i){if(i){const t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else Sc&&console.log("RxJS: Back to a better error behavior. Thank you. <3");Sc=i},get useDeprecatedSynchronousErrorHandling(){return Sc}};function Ko(i){setTimeout(()=>{throw i},0)}const qo={closed:!0,next(i){},error(i){if(Zi.useDeprecatedSynchronousErrorHandling)throw i;Ko(i)},complete(){}},lr=Array.isArray||(i=>i&&"number"==typeof i.length);function ja(i){return null!==i&&"object"==typeof i}const Yo=(()=>{function i(t){return Error.call(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((e,a)=>`${a+1}) ${e.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t,this}return i.prototype=Object.create(Error.prototype),i})();class mn{constructor(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}unsubscribe(){let t;if(this.closed)return;let{_parentOrParents:e,_ctorUnsubscribe:a,_unsubscribe:l,_subscriptions:u}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,e instanceof mn)e.remove(this);else if(null!==e)for(let f=0;f<e.length;++f)e[f].remove(this);if(x(l)){a&&(this._unsubscribe=void 0);try{l.call(this)}catch(f){t=f instanceof Yo?Wv(f.errors):[f]}}if(lr(u)){let f=-1,E=u.length;for(;++f<E;){const y=u[f];if(ja(y))try{y.unsubscribe()}catch(T){t=t||[],T instanceof Yo?t=t.concat(Wv(T.errors)):t.push(T)}}}if(t)throw new Yo(t)}add(t){let e=t;if(!t)return mn.EMPTY;switch(typeof t){case"function":e=new mn(t);case"object":if(e===this||e.closed||"function"!=typeof e.unsubscribe)return e;if(this.closed)return e.unsubscribe(),e;if(!(e instanceof mn)){const u=e;e=new mn,e._subscriptions=[u]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}let{_parentOrParents:a}=e;if(null===a)e._parentOrParents=this;else if(a instanceof mn){if(a===this)return e;e._parentOrParents=[a,this]}else{if(-1!==a.indexOf(this))return e;a.push(this)}const l=this._subscriptions;return null===l?this._subscriptions=[e]:l.push(e),e}remove(t){const e=this._subscriptions;if(e){const a=e.indexOf(t);-1!==a&&e.splice(a,1)}}}var i;function Wv(i){return i.reduce((t,e)=>t.concat(e instanceof Yo?e.errors:e),[])}mn.EMPTY=((i=new mn).closed=!0,i);const cp="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();class En extends mn{constructor(t,e,a){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=qo;break;case 1:if(!t){this.destination=qo;break}if("object"==typeof t){t instanceof En?(this.syncErrorThrowable=t.syncErrorThrowable,this.destination=t,t.add(this)):(this.syncErrorThrowable=!0,this.destination=new zv(this,t));break}default:this.syncErrorThrowable=!0,this.destination=new zv(this,t,e,a)}}[cp](){return this}static create(t,e,a){const l=new En(t,e,a);return l.syncErrorThrowable=!1,l}next(t){this.isStopped||this._next(t)}error(t){this.isStopped||(this.isStopped=!0,this._error(t))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(t){this.destination.next(t)}_error(t){this.destination.error(t),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:t}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this}}class zv extends En{constructor(t,e,a,l){super(),this._parentSubscriber=t;let u,f=this;x(e)?u=e:e&&(u=e.next,a=e.error,l=e.complete,e!==qo&&(f=Object.create(e),x(f.unsubscribe)&&this.add(f.unsubscribe.bind(f)),f.unsubscribe=this.unsubscribe.bind(this))),this._context=f,this._next=u,this._error=a,this._complete=l}next(t){if(!this.isStopped&&this._next){const{_parentSubscriber:e}=this;Zi.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}}error(t){if(!this.isStopped){const{_parentSubscriber:e}=this,{useDeprecatedSynchronousErrorHandling:a}=Zi;if(this._error)a&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)a?(e.syncErrorValue=t,e.syncErrorThrown=!0):Ko(t),this.unsubscribe();else{if(this.unsubscribe(),a)throw t;Ko(t)}}}complete(){if(!this.isStopped){const{_parentSubscriber:t}=this;if(this._complete){const e=()=>this._complete.call(this._context);Zi.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,e),this.unsubscribe()):(this.__tryOrUnsub(e),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(t,e){try{t.call(this._context,e)}catch(a){if(this.unsubscribe(),Zi.useDeprecatedSynchronousErrorHandling)throw a;Ko(a)}}__tryOrSetError(t,e,a){if(!Zi.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,a)}catch(l){return Zi.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=l,t.syncErrorThrown=!0,!0):(Ko(l),!0)}return!1}_unsubscribe(){const{_parentSubscriber:t}=this;this._context=null,this._parentSubscriber=null,t.unsubscribe()}}const ou="function"==typeof Symbol&&Symbol.observable||"@@observable";function lp(i){return i}function Kv(i){return 0===i.length?lp:1===i.length?i[0]:function(e){return i.reduce((a,l)=>l(a),e)}}let _n=(()=>{class i{constructor(e){this._isScalar=!1,e&&(this._subscribe=e)}lift(e){const a=new i;return a.source=this,a.operator=e,a}subscribe(e,a,l){const{operator:u}=this,f=function l0(i,t,e){if(i){if(i instanceof En)return i;if(i[cp])return i[cp]()}return i||t||e?new En(i,t,e):new En(qo)}(e,a,l);if(f.add(u?u.call(f,this.source):this.source||Zi.useDeprecatedSynchronousErrorHandling&&!f.syncErrorThrowable?this._subscribe(f):this._trySubscribe(f)),Zi.useDeprecatedSynchronousErrorHandling&&f.syncErrorThrowable&&(f.syncErrorThrowable=!1,f.syncErrorThrown))throw f.syncErrorValue;return f}_trySubscribe(e){try{return this._subscribe(e)}catch(a){Zi.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=a),function c0(i){for(;i;){const{closed:t,destination:e,isStopped:a}=i;if(t||a)return!1;i=e&&e instanceof En?e:null}return!0}(e)?e.error(a):console.warn(a)}}forEach(e,a){return new(a=qv(a))((l,u)=>{let f;f=this.subscribe(E=>{try{e(E)}catch(y){u(y),f&&f.unsubscribe()}},u,l)})}_subscribe(e){const{source:a}=this;return a&&a.subscribe(e)}[ou](){return this}pipe(...e){return 0===e.length?this:Kv(e)(this)}toPromise(e){return new(e=qv(e))((a,l)=>{let u;this.subscribe(f=>u=f,f=>l(f),()=>a(u))})}}return i.create=t=>new i(t),i})();function qv(i){if(i||(i=Zi.Promise||Promise),!i)throw new Error("no Promise impl found");return i}const bl=(()=>{function i(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return i.prototype=Object.create(Error.prototype),i})();class h0 extends mn{constructor(t,e){super(),this.subject=t,this.subscriber=e,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const t=this.subject,e=t.observers;if(this.subject=null,!e||0===e.length||t.isStopped||t.closed)return;const a=e.indexOf(this.subscriber);-1!==a&&e.splice(a,1)}}class Yv extends En{constructor(t){super(t),this.destination=t}}let Xt=(()=>{class i extends _n{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[cp](){return new Yv(this)}lift(e){const a=new Um(this,this);return a.operator=e,a}next(e){if(this.closed)throw new bl;if(!this.isStopped){const{observers:a}=this,l=a.length,u=a.slice();for(let f=0;f<l;f++)u[f].next(e)}}error(e){if(this.closed)throw new bl;this.hasError=!0,this.thrownError=e,this.isStopped=!0;const{observers:a}=this,l=a.length,u=a.slice();for(let f=0;f<l;f++)u[f].error(e);this.observers.length=0}complete(){if(this.closed)throw new bl;this.isStopped=!0;const{observers:e}=this,a=e.length,l=e.slice();for(let u=0;u<a;u++)l[u].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(e){if(this.closed)throw new bl;return super._trySubscribe(e)}_subscribe(e){if(this.closed)throw new bl;return this.hasError?(e.error(this.thrownError),mn.EMPTY):this.isStopped?(e.complete(),mn.EMPTY):(this.observers.push(e),new h0(this,e))}asObservable(){const e=new _n;return e.source=this,e}}return i.create=(t,e)=>new Um(t,e),i})();class Um extends Xt{constructor(t,e){super(),this.destination=t,this.source=e}next(t){const{destination:e}=this;e&&e.next&&e.next(t)}error(t){const{destination:e}=this;e&&e.error&&this.destination.error(t)}complete(){const{destination:t}=this;t&&t.complete&&this.destination.complete()}_subscribe(t){const{source:e}=this;return e?this.source.subscribe(t):mn.EMPTY}}function Sl(i){return i&&"function"==typeof i.schedule}function At(i,t){return function(a){if("function"!=typeof i)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return a.lift(new p0(i,t))}}class p0{constructor(t,e){this.project=t,this.thisArg=e}call(t,e){return e.subscribe(new f0(t,this.project,this.thisArg))}}class f0 extends En{constructor(t,e,a){super(t),this.project=e,this.count=0,this.thisArg=a||this}_next(t){let e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(a){return void this.destination.error(a)}this.destination.next(e)}}const $v=i=>t=>{for(let e=0,a=i.length;e<a&&!t.closed;e++)t.next(i[e]);t.complete()},dp=function _0(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}(),Xv=i=>i&&"number"==typeof i.length&&"function"!=typeof i;function Jv(i){return!!i&&"function"!=typeof i.subscribe&&"function"==typeof i.then}const Vm=i=>{if(i&&"function"==typeof i[ou])return(i=>t=>{const e=i[ou]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)})(i);if(Xv(i))return $v(i);if(Jv(i))return(i=>t=>(i.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,Ko),t))(i);if(i&&"function"==typeof i[dp])return(i=>t=>{const e=i[dp]();for(;;){let a;try{a=e.next()}catch(l){return t.error(l),t}if(a.done){t.complete();break}if(t.next(a.value),t.closed)break}return"function"==typeof e.return&&t.add(()=>{e.return&&e.return()}),t})(i);{const e=`You provided ${ja(i)?"an invalid object":`'${i}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(e)}};function Bm(i,t){return new _n(e=>{const a=new mn;let l=0;return a.add(t.schedule(function(){l!==i.length?(e.next(i[l++]),e.closed||a.add(this.schedule())):e.complete()})),a})}function Di(i,t){return t?function dr(i,t){if(null!=i){if(function S0(i){return i&&"function"==typeof i[ou]}(i))return function v0(i,t){return new _n(e=>{const a=new mn;return a.add(t.schedule(()=>{const l=i[ou]();a.add(l.subscribe({next(u){a.add(t.schedule(()=>e.next(u)))},error(u){a.add(t.schedule(()=>e.error(u)))},complete(){a.add(t.schedule(()=>e.complete()))}}))})),a})}(i,t);if(Jv(i))return function y0(i,t){return new _n(e=>{const a=new mn;return a.add(t.schedule(()=>i.then(l=>{a.add(t.schedule(()=>{e.next(l),a.add(t.schedule(()=>e.complete()))}))},l=>{a.add(t.schedule(()=>e.error(l)))}))),a})}(i,t);if(Xv(i))return Bm(i,t);if(function su(i){return i&&"function"==typeof i[dp]}(i)||"string"==typeof i)return function b0(i,t){if(!i)throw new Error("Iterable cannot be null");return new _n(e=>{const a=new mn;let l;return a.add(()=>{l&&"function"==typeof l.return&&l.return()}),a.add(t.schedule(()=>{l=i[dp](),a.add(t.schedule(function(){if(e.closed)return;let u,f;try{const E=l.next();u=E.value,f=E.done}catch(E){return void e.error(E)}f?e.complete():(e.next(u),this.schedule())}))})),a})}(i,t)}throw new TypeError((null!==i&&typeof i||i)+" is not observable")}(i,t):i instanceof _n?i:new _n(Vm(i))}class au extends En{constructor(t){super(),this.parent=t}_next(t){this.parent.notifyNext(t)}_error(t){this.parent.notifyError(t),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class hp extends En{notifyNext(t){this.destination.next(t)}notifyError(t){this.destination.error(t)}notifyComplete(){this.destination.complete()}}function Cl(i,t){if(t.closed)return;if(i instanceof _n)return i.subscribe(t);let e;try{e=Vm(i)(t)}catch(a){t.error(a)}return e}function Vi(i,t,e=Number.POSITIVE_INFINITY){return"function"==typeof t?a=>a.pipe(Vi((l,u)=>Di(i(l,u)).pipe(At((f,E)=>t(l,f,u,E))),e)):("number"==typeof t&&(e=t),a=>a.lift(new jm(i,e)))}class jm{constructor(t,e=Number.POSITIVE_INFINITY){this.project=t,this.concurrent=e}call(t,e){return e.subscribe(new Zv(t,this.project,this.concurrent))}}class Zv extends hp{constructor(t,e,a=Number.POSITIVE_INFINITY){super(t),this.project=e,this.concurrent=a,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)}_tryNext(t){let e;const a=this.index++;try{e=this.project(t,a)}catch(l){return void this.destination.error(l)}this.active++,this._innerSub(e)}_innerSub(t){const e=new au(this),a=this.destination;a.add(e);const l=Cl(t,e);l!==e&&a.add(l)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(t){this.destination.next(t)}notifyComplete(){const t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function Ha(i=Number.POSITIVE_INFINITY){return Vi(lp,i)}function cu(i,t){return t?Bm(i,t):new _n($v(i))}function ey(...i){let t=Number.POSITIVE_INFINITY,e=null,a=i[i.length-1];return Sl(a)?(e=i.pop(),i.length>1&&"number"==typeof i[i.length-1]&&(t=i.pop())):"number"==typeof a&&(t=i.pop()),null===e&&1===i.length&&i[0]instanceof _n?i[0]:Ha(t)(cu(i,e))}function qn(){return function(t){return t.lift(new Hm(t))}}class Hm{constructor(t){this.connectable=t}call(t,e){const{connectable:a}=this;a._refCount++;const l=new T0(t,a),u=e.subscribe(l);return l.closed||(l.connection=a.connect()),u}}class T0 extends En{constructor(t,e){super(t),this.connectable=e}_unsubscribe(){const{connectable:t}=this;if(!t)return void(this.connection=null);this.connectable=null;const e=t._refCount;if(e<=0)return void(this.connection=null);if(t._refCount=e-1,e>1)return void(this.connection=null);const{connection:a}=this,l=t._connection;this.connection=null,l&&(!a||l===a)&&l.unsubscribe()}}class Gm extends _n{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._refCount=0,this._isComplete=!1}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let t=this._connection;return t||(this._isComplete=!1,t=this._connection=new mn,t.add(this.source.subscribe(new oP(this.getSubject(),this))),t.closed&&(this._connection=null,t=mn.EMPTY)),t}refCount(){return qn()(this)}}const ty=(()=>{const i=Gm.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:i._subscribe},_isComplete:{value:i._isComplete,writable:!0},getSubject:{value:i.getSubject},connect:{value:i.connect},refCount:{value:i.refCount}}})();class oP extends Yv{constructor(t,e){super(t),this.connectable=e}_error(t){this._unsubscribe(),super._error(t)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const t=this.connectable;if(t){this.connectable=null;const e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}}}class er{constructor(t,e){this.subjectFactory=t,this.selector=e}call(t,e){const{selector:a}=this,l=this.subjectFactory(),u=a(l).subscribe(t);return u.add(e.subscribe(l)),u}}function sP(){return new Xt}function Pn(i){for(let t in i)if(i[t]===Pn)return t;throw Error("Could not find renamed property on target object.")}function zm(i,t){for(const e in t)t.hasOwnProperty(e)&&!i.hasOwnProperty(e)&&(i[e]=t[e])}function Mn(i){if("string"==typeof i)return i;if(Array.isArray(i))return"["+i.map(Mn).join(", ")+"]";if(null==i)return""+i;if(i.overriddenName)return`${i.overriddenName}`;if(i.name)return`${i.name}`;const t=i.toString();if(null==t)return""+t;const e=t.indexOf("\n");return-1===e?t:t.substring(0,e)}function Km(i,t){return null==i||""===i?null===t?"":t:null==t||""===t?i:i+" "+t}const aP=Pn({__forward_ref__:Pn});function kn(i){return i.__forward_ref__=kn,i.toString=function(){return Mn(this())},i}function Qe(i){return ny(i)?i():i}function ny(i){return"function"==typeof i&&i.hasOwnProperty(aP)&&i.__forward_ref__===kn}function iy(i){return i&&!!i.\u0275providers}const qm="https://g.co/ng/security#xss";class he extends Error{constructor(t,e){super(Ym(t,e)),this.code=t}}function Ym(i,t){return`NG0${Math.abs(i)}${t?": "+t.trim():""}`}function He(i){return"string"==typeof i?i:null==i?"":String(i)}function Bi(i,t){throw new he(-201,!1)}function $o(i,t){null==i&&function vn(i,t,e,a){throw new Error(`ASSERTION ERROR: ${i}`+(null==a?"":` [Expected=> ${e} ${a} ${t} <=Actual]`))}(t,i,null,"!=")}function Oe(i){return{token:i.token,providedIn:i.providedIn||null,factory:i.factory,value:void 0}}function xn(i){return{providers:i.providers||[],imports:i.imports||[]}}function xr(i){return Jm(i,pp)||Jm(i,Cc)}function Jm(i,t){return i.hasOwnProperty(t)?i[t]:null}function A0(i){return i&&(i.hasOwnProperty(mr)||i.hasOwnProperty(D0))?i[mr]:null}const pp=Pn({\u0275prov:Pn}),mr=Pn({\u0275inj:Pn}),Cc=Pn({ngInjectableDef:Pn}),D0=Pn({ngInjectorDef:Pn});var rt=(()=>((rt=rt||{})[rt.Default=0]="Default",rt[rt.Host=1]="Host",rt[rt.Self=2]="Self",rt[rt.SkipSelf=4]="SkipSelf",rt[rt.Optional=8]="Optional",rt))();let Qm;function wo(i){const t=Qm;return Qm=i,t}function ly(i,t,e){const a=xr(i);return a&&"root"==a.providedIn?void 0===a.value?a.value=a.factory():a.value:e&rt.Optional?null:void 0!==t?t:void Bi(Mn(i))}const Hn=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),uu={},dy="__NG_DI_FLAG__",Zm="ngTempTokenPath",dP="ngTokenPath",uP=/\n/gm,mp="\u0275",N0="__source";let ra;function hu(i){const t=ra;return ra=i,t}function hP(i,t=rt.Default){if(void 0===ra)throw new he(-203,!1);return null===ra?ly(i,void 0,t):ra.get(i,t&rt.Optional?null:void 0,t)}function pe(i,t=rt.Default){return(function O0(){return Qm}()||hP)(Qe(i),t)}function Ct(i,t=rt.Default){return pe(i,e_(t))}function e_(i){return typeof i>"u"||"number"==typeof i?i:0|(i.optional&&8)|(i.host&&1)|(i.self&&2)|(i.skipSelf&&4)}function _p(i){const t=[];for(let e=0;e<i.length;e++){const a=Qe(i[e]);if(Array.isArray(a)){if(0===a.length)throw new he(900,!1);let l,u=rt.Default;for(let f=0;f<a.length;f++){const E=a[f],y=uy(E);"number"==typeof y?-1===y?l=E.token:u|=y:l=E}t.push(pe(l,u))}else t.push(pe(a))}return t}function wl(i,t){return i[dy]=t,i.prototype[dy]=t,i}function uy(i){return i[dy]}function oa(i){return{toString:i}.toString()}var Ps=(()=>((Ps=Ps||{})[Ps.OnPush=0]="OnPush",Ps[Ps.Default=1]="Default",Ps))(),Ms=(()=>(function(i){i[i.Emulated=0]="Emulated",i[i.None=2]="None",i[i.ShadowDom=3]="ShadowDom"}(Ms||(Ms={})),Ms))();const Ga={},an=[],pu=Pn({\u0275cmp:Pn}),t_=Pn({\u0275dir:Pn}),Tc=Pn({\u0275pipe:Pn}),P0=Pn({\u0275mod:Pn}),Wa=Pn({\u0275fac:Pn}),ks=Pn({__NG_ELEMENT_ID__:Pn});let fP=0;function _r(i){return oa(()=>{const t=M0(i),e={...t,decls:i.decls,vars:i.vars,template:i.template,consts:i.consts||null,ngContentSelectors:i.ngContentSelectors,onPush:i.changeDetection===Ps.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&i.dependencies||null,getStandaloneInjector:null,data:i.data||{},encapsulation:i.encapsulation||Ms.Emulated,id:"c"+fP++,styles:i.styles||an,_:null,schemas:i.schemas||null,tView:null};Yn(e);const a=i.dependencies;return e.directiveDefs=i_(a,!1),e.pipeDefs=i_(a,!0),e})}function mP(i){return yn(i)||Er(i)}function _P(i){return null!==i}function Un(i){return oa(()=>({type:i.type,bootstrap:i.bootstrap||an,declarations:i.declarations||an,imports:i.imports||an,exports:i.exports||an,transitiveCompileScopes:null,schemas:i.schemas||null,id:i.id||null}))}function n_(i,t){if(null==i)return Ga;const e={};for(const a in i)if(i.hasOwnProperty(a)){let l=i[a],u=l;Array.isArray(l)&&(u=l[1],l=l[0]),e[l]=a,t&&(t[l]=u)}return e}function je(i){return oa(()=>{const t=M0(i);return Yn(t),t})}function Lr(i){return{type:i.type,name:i.name,factory:null,pure:!1!==i.pure,standalone:!0===i.standalone,onDestroy:i.type.prototype.ngOnDestroy||null}}function yn(i){return i[pu]||null}function Er(i){return i[t_]||null}function eo(i){return i[Tc]||null}function Fr(i,t){const e=i[P0]||null;if(!e&&!0===t)throw new Error(`Type ${Mn(i)} does not have '\u0275mod' property.`);return e}function M0(i){const t={};return{type:i.type,providersResolver:null,factory:null,hostBindings:i.hostBindings||null,hostVars:i.hostVars||0,hostAttrs:i.hostAttrs||null,contentQueries:i.contentQueries||null,declaredInputs:t,exportAs:i.exportAs||null,standalone:!0===i.standalone,selectors:i.selectors||an,viewQuery:i.viewQuery||null,features:i.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:n_(i.inputs,t),outputs:n_(i.outputs)}}function Yn(i){i.features?.forEach(t=>t(i))}function i_(i,t){if(!i)return null;const e=t?eo:mP;return()=>("function"==typeof i?i():i).map(a=>e(a)).filter(_P)}const sa=0,Fe=1,Dt=2,pi=3,Ls=4,Il=5,vr=6,fu=7,Zn=8,gp=9,mu=10,Pt=11,Ep=12,vp=13,py=14,_u=15,yr=16,yp=17,gu=18,aa=19,bp=20,k0=21,$n=22,fy=1,x0=2,r_=7,wc=8,Eu=9,Ur=10;function Ro(i){return Array.isArray(i)&&"object"==typeof i[fy]}function Xo(i){return Array.isArray(i)&&!0===i[fy]}function my(i){return 0!=(4&i.flags)}function Sp(i){return i.componentOffset>-1}function o_(i){return 1==(1&i.flags)}function Vr(i){return!!i.template}function Jo(i){return 0!=(256&i[Dt])}function Al(i,t){return i.hasOwnProperty(Wa)?i[Wa]:null}class CP{constructor(t,e,a){this.previousValue=t,this.currentValue=e,this.firstChange=a}isFirstChange(){return this.firstChange}}function Ao(){return B0}function B0(i){return i.type.prototype.ngOnChanges&&(i.setInput=vu),TP}function TP(){const i=Dl(this),t=i?.current;if(t){const e=i.previous;if(e===Ga)i.previous=t;else for(let a in t)e[a]=t[a];i.current=null,this.ngOnChanges(t)}}function vu(i,t,e,a){const l=this.declaredInputs[e],u=Dl(i)||function H0(i,t){return i[j0]=t}(i,{previous:Ga,current:null}),f=u.current||(u.current={}),E=u.previous,y=E[l];f[l]=new CP(y&&y.currentValue,t,E===Ga),i[a]=t}Ao.ngInherit=!0;const j0="__ngSimpleChanges__";function Dl(i){return i[j0]||null}const Qo=function(i,t,e){},G0="svg";function ji(i){for(;Array.isArray(i);)i=i[sa];return i}function a_(i,t){return ji(t[i])}function Do(i,t){return ji(t[i.index])}function K0(i,t){return i.data[t]}function yu(i,t){return i[t]}function to(i,t){const e=t[i];return Ro(e)?e:e[sa]}function c_(i){return 64==(64&i[Dt])}function Ic(i,t){return null==t?null:i[t]}function vy(i){i[gu]=0}function l_(i,t){i[Il]+=t;let e=i,a=i[pi];for(;null!==a&&(1===t&&1===e[Il]||-1===t&&0===e[Il]);)a[Il]+=t,e=a,a=a[pi]}const Et={lFrame:Ty(null),bindingsEnabled:!0};function Y0(){return Et.bindingsEnabled}function Ee(){return Et.lFrame.lView}function Wt(){return Et.lFrame.tView}function Fs(i){return Et.lFrame.contextLView=i,i[Zn]}function Us(i){return Et.lFrame.contextLView=null,i}function Oi(){let i=$0();for(;null!==i&&64===i.type;)i=i.parent;return i}function $0(){return Et.lFrame.currentTNode}function la(i,t){const e=Et.lFrame;e.currentTNode=i,e.isParent=t}function za(){return Et.lFrame.isParent}function yy(){Et.lFrame.isParent=!1}function Br(){const i=Et.lFrame;let t=i.bindingRootIndex;return-1===t&&(t=i.bindingRootIndex=i.tView.bindingStartIndex),t}function Nl(){return Et.lFrame.bindingIndex++}function Z0(i,t){const e=Et.lFrame;e.bindingIndex=e.bindingRootIndex=i,by(t)}function by(i){Et.lFrame.currentDirectiveIndex=i}function d_(){return Et.lFrame.currentQueryIndex}function Re(i){Et.lFrame.currentQueryIndex=i}function ew(i){const t=i[Fe];return 2===t.type?t.declTNode:1===t.type?i[vr]:null}function tw(i,t,e){if(e&rt.SkipSelf){let l=t,u=i;for(;!(l=l.parent,null!==l||e&rt.Host||(l=ew(u),null===l||(u=u[_u],10&l.type))););if(null===l)return!1;t=l,i=u}const a=Et.lFrame=Cy();return a.currentTNode=t,a.lView=i,!0}function Sy(i){const t=Cy(),e=i[Fe];Et.lFrame=t,t.currentTNode=e.firstChild,t.lView=i,t.tView=e,t.contextLView=i,t.bindingIndex=e.bindingStartIndex,t.inI18n=!1}function Cy(){const i=Et.lFrame,t=null===i?null:i.child;return null===t?Ty(i):t}function Ty(i){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:i,child:null,inI18n:!1};return null!==i&&(i.child=t),t}function nw(){const i=Et.lFrame;return Et.lFrame=i.parent,i.currentTNode=null,i.lView=null,i}const iw=nw;function wy(){const i=nw();i.isParent=!0,i.tView=null,i.selectedIndex=-1,i.contextLView=null,i.elementDepthCount=0,i.currentDirectiveIndex=-1,i.currentNamespace=null,i.bindingRootIndex=-1,i.bindingIndex=-1,i.currentQueryIndex=0}function jr(){return Et.lFrame.selectedIndex}function Pl(i){Et.lFrame.selectedIndex=i}function ai(){const i=Et.lFrame;return K0(i.tView,i.selectedIndex)}function Oo(){Et.lFrame.currentNamespace=G0}function Zo(){!function FP(){Et.lFrame.currentNamespace=null}()}function u_(i,t){for(let e=t.directiveStart,a=t.directiveEnd;e<a;e++){const u=i.data[e].type.prototype,{ngAfterContentInit:f,ngAfterContentChecked:E,ngAfterViewInit:y,ngAfterViewChecked:T,ngOnDestroy:R}=u;f&&(i.contentHooks??(i.contentHooks=[])).push(-e,f),E&&((i.contentHooks??(i.contentHooks=[])).push(e,E),(i.contentCheckHooks??(i.contentCheckHooks=[])).push(e,E)),y&&(i.viewHooks??(i.viewHooks=[])).push(-e,y),T&&((i.viewHooks??(i.viewHooks=[])).push(e,T),(i.viewCheckHooks??(i.viewCheckHooks=[])).push(e,T)),null!=R&&(i.destroyHooks??(i.destroyHooks=[])).push(e,R)}}function wp(i,t,e){Ay(i,t,3,e)}function h_(i,t,e,a){(3&i[Dt])===e&&Ay(i,t,e,a)}function Ry(i,t){let e=i[Dt];(3&e)===t&&(e&=2047,e+=1,i[Dt]=e)}function Ay(i,t,e,a){const u=a??-1,f=t.length-1;let E=0;for(let y=void 0!==a?65535&i[gu]:0;y<f;y++)if("number"==typeof t[y+1]){if(E=t[y],null!=a&&E>=a)break}else t[y]<0&&(i[gu]+=65536),(E<u||-1==u)&&(VP(i,e,t,y),i[gu]=(4294901760&i[gu])+y+2),y++}function VP(i,t,e,a){const l=e[a]<0,u=e[a+1],E=i[l?-e[a]:e[a]];if(l){if(i[Dt]>>11<i[gu]>>16&&(3&i[Dt])===t){i[Dt]+=2048,Qo(4,E,u);try{u.call(E)}finally{Qo(5,E,u)}}}else{Qo(4,E,u);try{u.call(E)}finally{Qo(5,E,u)}}}const Ml=-1;class kl{constructor(t,e,a){this.factory=t,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=a}}function Dy(i,t,e){let a=0;for(;a<e.length;){const l=e[a];if("number"==typeof l){if(0!==l)break;a++;const u=e[a++],f=e[a++],E=e[a++];i.setAttribute(t,f,E,u)}else{const u=l,f=e[++a];aw(u)?i.setProperty(t,u,f):i.setAttribute(t,u,f),a++}}return a}function Oy(i){return 3===i||4===i||6===i}function aw(i){return 64===i.charCodeAt(0)}function Su(i,t){if(null!==t&&0!==t.length)if(null===i||0===i.length)i=t.slice();else{let e=-1;for(let a=0;a<t.length;a++){const l=t[a];"number"==typeof l?e=l:0===e||cw(i,e,l,null,-1===e||2===e?t[++a]:null)}}return i}function cw(i,t,e,a,l){let u=0,f=i.length;if(-1===t)f=-1;else for(;u<i.length;){const E=i[u++];if("number"==typeof E){if(E===t){f=-1;break}if(E>t){f=u-1;break}}}for(;u<i.length;){const E=i[u];if("number"==typeof E)break;if(E===e){if(null===a)return void(null!==l&&(i[u+1]=l));if(a===i[u+1])return void(i[u+2]=l)}u++,null!==a&&u++,null!==l&&u++}-1!==f&&(i.splice(f,0,t),u=f+1),i.splice(u++,0,e),null!==a&&i.splice(u++,0,a),null!==l&&i.splice(u++,0,l)}function lw(i){return i!==Ml}function p_(i){return 32767&i}function f_(i,t){let e=function HP(i){return i>>16}(i),a=t;for(;e>0;)a=a[_u],e--;return a}let Ny=!0;function m_(i){const t=Ny;return Ny=i,t}const dw=255,Py=5;let uw=0;const da={};function __(i,t){const e=hw(i,t);if(-1!==e)return e;const a=t[Fe];a.firstCreatePass&&(i.injectorIndex=t.length,g_(a.data,i),g_(t,null),g_(a.blueprint,null));const l=My(i,t),u=i.injectorIndex;if(lw(l)){const f=p_(l),E=f_(l,t),y=E[Fe].data;for(let T=0;T<8;T++)t[u+T]=E[f+T]|y[f+T]}return t[u+8]=l,u}function g_(i,t){i.push(0,0,0,0,0,0,0,0,t)}function hw(i,t){return-1===i.injectorIndex||i.parent&&i.parent.injectorIndex===i.injectorIndex||null===t[i.injectorIndex+8]?-1:i.injectorIndex}function My(i,t){if(i.parent&&-1!==i.parent.injectorIndex)return i.parent.injectorIndex;let e=0,a=null,l=t;for(;null!==l;){if(a=Ew(l),null===a)return Ml;if(e++,l=l[_u],-1!==a.injectorIndex)return a.injectorIndex|e<<16}return Ml}function Ip(i,t,e){!function GP(i,t,e){let a;"string"==typeof e?a=e.charCodeAt(0)||0:e.hasOwnProperty(ks)&&(a=e[ks]),null==a&&(a=e[ks]=uw++);const l=a&dw;t.data[i+(l>>Py)]|=1<<l}(i,t,e)}function v_(i,t,e){if(e&rt.Optional||void 0!==i)return i;Bi()}function pw(i,t,e,a){if(e&rt.Optional&&void 0===a&&(a=null),!(e&(rt.Self|rt.Host))){const l=i[gp],u=wo(void 0);try{return l?l.get(t,a,e&rt.Optional):ly(t,a,e&rt.Optional)}finally{wo(u)}}return v_(a,0,e)}function fw(i,t,e,a=rt.Default,l){if(null!==i){if(1024&t[Dt]){const f=function KP(i,t,e,a,l){let u=i,f=t;for(;null!==u&&null!==f&&1024&f[Dt]&&!(256&f[Dt]);){const E=mw(u,f,e,a|rt.Self,da);if(E!==da)return E;let y=u.parent;if(!y){const T=f[k0];if(T){const R=T.get(e,da,a);if(R!==da)return R}y=Ew(f),f=f[_u]}u=y}return l}(i,t,e,a,da);if(f!==da)return f}const u=mw(i,t,e,a,da);if(u!==da)return u}return pw(t,e,a,l)}function mw(i,t,e,a,l){const u=function WP(i){if("string"==typeof i)return i.charCodeAt(0)||0;const t=i.hasOwnProperty(ks)?i[ks]:void 0;return"number"==typeof t?t>=0?t&dw:zP:t}(e);if("function"==typeof u){if(!tw(t,i,a))return a&rt.Host?v_(l,0,a):pw(t,e,a,l);try{const f=u(a);if(null!=f||a&rt.Optional)return f;Bi()}finally{iw()}}else if("number"==typeof u){let f=null,E=hw(i,t),y=Ml,T=a&rt.Host?t[yr][vr]:null;for((-1===E||a&rt.SkipSelf)&&(y=-1===E?My(i,t):t[E+8],y!==Ml&&ky(a,!1)?(f=t[Fe],E=p_(y),t=f_(y,t)):E=-1);-1!==E;){const R=t[Fe];if(gw(u,E,R.data)){const L=_w(E,t,e,f,a,T);if(L!==da)return L}y=t[E+8],y!==Ml&&ky(a,t[Fe].data[E+8]===T)&&gw(u,E,t)?(f=R,E=p_(y),t=f_(y,t)):E=-1}}return l}function _w(i,t,e,a,l,u){const f=t[Fe],E=f.data[i+8],R=Rp(E,f,e,null==a?Sp(E)&&Ny:a!=f&&0!=(3&E.type),l&rt.Host&&u===E);return null!==R?Ya(t,f,R,E):da}function Rp(i,t,e,a,l){const u=i.providerIndexes,f=t.data,E=1048575&u,y=i.directiveStart,R=u>>20,H=l?E+R:i.directiveEnd;for(let W=a?E:E+R;W<H;W++){const q=f[W];if(W<y&&e===q||W>=y&&q.type===e)return W}if(l){const W=f[y];if(W&&Vr(W)&&W.type===e)return y}return null}function Ya(i,t,e,a){let l=i[e];const u=t.data;if(function BP(i){return i instanceof kl}(l)){const f=l;f.resolving&&function ia(i,t){const e=t?`. Dependency path: ${t.join(" > ")} > ${i}`:"";throw new he(-200,`Circular dependency in DI detected for ${i}${e}`)}(function Jt(i){return"function"==typeof i?i.name||i.toString():"object"==typeof i&&null!=i&&"function"==typeof i.type?i.type.name||i.type.toString():He(i)}(u[e]));const E=m_(f.canSeeViewProviders);f.resolving=!0;const y=f.injectImpl?wo(f.injectImpl):null;tw(i,a,rt.Default);try{l=i[e]=f.factory(void 0,u,i,a),t.firstCreatePass&&e>=a.directiveStart&&function UP(i,t,e){const{ngOnChanges:a,ngOnInit:l,ngDoCheck:u}=t.type.prototype;if(a){const f=B0(t);(e.preOrderHooks??(e.preOrderHooks=[])).push(i,f),(e.preOrderCheckHooks??(e.preOrderCheckHooks=[])).push(i,f)}l&&(e.preOrderHooks??(e.preOrderHooks=[])).push(0-i,l),u&&((e.preOrderHooks??(e.preOrderHooks=[])).push(i,u),(e.preOrderCheckHooks??(e.preOrderCheckHooks=[])).push(i,u))}(e,u[e],t)}finally{null!==y&&wo(y),m_(E),f.resolving=!1,iw()}}return l}function gw(i,t,e){return!!(e[t+(i>>Py)]&1<<i)}function ky(i,t){return!(i&rt.Self||i&rt.Host&&t)}class Cu{constructor(t,e){this._tNode=t,this._lView=e}get(t,e,a){return fw(this._tNode,this._lView,t,e_(a),e)}}function zP(){return new Cu(Oi(),Ee())}function Hi(i){return oa(()=>{const t=i.prototype.constructor,e=t[Wa]||xy(t),a=Object.prototype;let l=Object.getPrototypeOf(i.prototype).constructor;for(;l&&l!==a;){const u=l[Wa]||xy(l);if(u&&u!==e)return u;l=Object.getPrototypeOf(l)}return u=>new u})}function xy(i){return ny(i)?()=>{const t=xy(Qe(i));return t&&t()}:Al(i)}function Ew(i){const t=i[Fe],e=t.type;return 2===e?t.declTNode:1===e?i[vr]:null}const Tu="__parameters__";function wu(i,t,e){return oa(()=>{const a=function Ly(i){return function(...e){if(i){const a=i(...e);for(const l in a)this[l]=a[l]}}}(t);function l(...u){if(this instanceof l)return a.apply(this,u),this;const f=new l(...u);return E.annotation=f,E;function E(y,T,R){const L=y.hasOwnProperty(Tu)?y[Tu]:Object.defineProperty(y,Tu,{value:[]})[Tu];for(;L.length<=R;)L.push(null);return(L[R]=L[R]||[]).push(f),y}}return e&&(l.prototype=Object.create(e.prototype)),l.prototype.ngMetadataName=i,l.annotationCls=l,l})}class Pe{constructor(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=Oe({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function Ul(i,t){i.forEach(e=>Array.isArray(e)?Ul(e,t):t(e))}function Cw(i,t,e){t>=i.length?i.push(e):i.splice(t,0,e)}function y_(i,t){return t>=i.length-1?i.pop():i.splice(t,1)[0]}function Ru(i,t){const e=[];for(let a=0;a<i;a++)e.push(t);return e}function no(i,t,e){let a=Du(i,t);return a>=0?i[1|a]=e:(a=~a,function Tw(i,t,e,a){let l=i.length;if(l==t)i.push(e,a);else if(1===l)i.push(a,i[0]),i[0]=e;else{for(l--,i.push(i[l-1],i[l]);l>t;)i[l]=i[l-2],l--;i[t]=e,i[t+1]=a}}(i,a,t,e)),a}function Au(i,t){const e=Du(i,t);if(e>=0)return i[1|e]}function Du(i,t){return function ww(i,t,e){let a=0,l=i.length>>e;for(;l!==a;){const u=a+(l-a>>1),f=i[u<<e];if(t===f)return u<<e;f>t?l=u:a=u+1}return~(l<<e)}(i,t,1)}const I_=wl(wu("Inject",i=>({token:i})),-1),Nu=wl(wu("Optional"),8),Op=wl(wu("SkipSelf"),4);var Wi=(()=>((Wi=Wi||{})[Wi.Important=1]="Important",Wi[Wi.DashCase=2]="DashCase",Wi))();const xp=new Map;let N_=0;const k_="__ngContext__";function ur(i,t){Ro(t)?(i[k_]=t[bp],function d1(i){xp.set(i[bp],i)}(t)):i[k_]=t}let $y;function L_(i,t){return $y(i,t)}function nr(i){const t=i[pi];return Xo(t)?t[pi]:t}function Xy(i){return ns(i[vp])}function V_(i){return ns(i[Ls])}function ns(i){for(;null!==i&&!Xo(i);)i=i[Ls];return i}function is(i,t,e,a,l){if(null!=a){let u,f=!1;Xo(a)?u=a:Ro(a)&&(f=!0,a=a[sa]);const E=ji(a);0===i&&null!==e?null==l?tb(t,e,E):Nc(t,e,E,l||null,!0):1===i&&null!==e?Nc(t,e,E,l||null,!0):2===i?function q_(i,t,e){const a=G_(i,t);a&&function _1(i,t,e,a){i.removeChild(t,e,a)}(i,a,t,e)}(t,E,f):3===i&&t.destroyNode(E),null!=u&&function v1(i,t,e,a,l){const u=e[r_];u!==ji(e)&&is(t,i,a,u,l);for(let E=Ur;E<e.length;E++){const y=e[E];Fu(y[Fe],y,i,t,a,u)}}(t,i,u,e,l)}}function B_(i,t,e){return i.createElement(t,e)}function Gw(i,t){const e=i[Eu],a=e.indexOf(t),l=t[pi];512&t[Dt]&&(t[Dt]&=-513,l_(l,-1)),e.splice(a,1)}function Bp(i,t){if(i.length<=Ur)return;const e=Ur+t,a=i[e];if(a){const l=a[yp];null!==l&&l!==i&&Gw(l,a),t>0&&(i[e-1][Ls]=a[Ls]);const u=y_(i,Ur+t);!function Vl(i,t){Fu(i,t,t[Pt],2,null,null),t[sa]=null,t[vr]=null}(a[Fe],a);const f=u[aa];null!==f&&f.detachView(u[Fe]),a[pi]=null,a[Ls]=null,a[Dt]&=-65}return a}function j_(i,t){if(!(128&t[Dt])){const e=t[Pt];e.destroyNode&&Fu(i,t,e,3,null,null),function Hw(i){let t=i[vp];if(!t)return jp(i[Fe],i);for(;t;){let e=null;if(Ro(t))e=t[vp];else{const a=t[Ur];a&&(e=a)}if(!e){for(;t&&!t[Ls]&&t!==i;)Ro(t)&&jp(t[Fe],t),t=t[pi];null===t&&(t=i),Ro(t)&&jp(t[Fe],t),e=t&&t[Ls]}t=e}}(t)}}function jp(i,t){if(!(128&t[Dt])){t[Dt]&=-65,t[Dt]|=128,function Qy(i,t){let e;if(null!=i&&null!=(e=i.destroyHooks))for(let a=0;a<e.length;a+=2){const l=t[e[a]];if(!(l instanceof kl)){const u=e[a+1];if(Array.isArray(u))for(let f=0;f<u.length;f+=2){const E=l[u[f]],y=u[f+1];Qo(4,E,y);try{y.call(E)}finally{Qo(5,E,y)}}else{Qo(4,l,u);try{u.call(l)}finally{Qo(5,l,u)}}}}}(i,t),function H_(i,t){const e=i.cleanup,a=t[fu];let l=-1;if(null!==e)for(let u=0;u<e.length-1;u+=2)if("string"==typeof e[u]){const f=e[u+3];f>=0?a[l=f]():a[l=-f].unsubscribe(),u+=2}else{const f=a[l=e[u+1]];e[u].call(f)}if(null!==a){for(let u=l+1;u<a.length;u++)(0,a[u])();t[fu]=null}}(i,t),1===t[Fe].type&&t[Pt].destroy();const e=t[yp];if(null!==e&&Xo(t[pi])){e!==t[pi]&&Gw(e,t);const a=t[aa];null!==a&&a.detachView(i)}!function Lp(i){xp.delete(i[bp])}(t)}}function Zy(i,t,e){return function eb(i,t,e){let a=t;for(;null!==a&&40&a.type;)a=(t=a).parent;if(null===a)return e[sa];{const{componentOffset:l}=a;if(l>-1){const{encapsulation:u}=i.data[a.directiveStart+l];if(u===Ms.None||u===Ms.Emulated)return null}return Do(a,e)}}(i,t.parent,e)}function Nc(i,t,e,a,l){i.insertBefore(t,e,a,l)}function tb(i,t,e){i.appendChild(t,e)}function nb(i,t,e,a,l){null!==a?Nc(i,t,e,a,l):tb(i,t,e)}function G_(i,t){return i.parentNode(t)}function ib(i,t,e){return W_(i,t,e)}let rb,lb,W_=function Ww(i,t,e){return 40&i.type?Do(i,e):null};function z_(i,t,e,a){const l=Zy(i,a,t),u=t[Pt],E=ib(a.parent||t[vr],a,t);if(null!=l)if(Array.isArray(e))for(let y=0;y<e.length;y++)nb(u,l,e[y],E,!1);else nb(u,l,e,E,!1);void 0!==rb&&rb(u,a,t,e,l)}function K_(i,t){if(null!==t){const e=t.type;if(3&e)return Do(t,i);if(4&e)return ob(-1,i[t.index]);if(8&e){const a=t.child;if(null!==a)return K_(i,a);{const l=i[t.index];return Xo(l)?ob(-1,l):ji(l)}}if(32&e)return L_(t,i)()||ji(i[t.index]);{const a=Kw(i,t);return null!==a?Array.isArray(a)?a[0]:K_(nr(i[yr]),a):K_(i,t.next)}}return null}function Kw(i,t){return null!==t?i[yr][vr].projection[t.projection]:null}function ob(i,t){const e=Ur+i+1;if(e<t.length){const a=t[e],l=a[Fe].firstChild;if(null!==l)return K_(a,l)}return t[r_]}function Y_(i,t,e,a,l,u,f){for(;null!=e;){const E=a[e.index],y=e.type;if(f&&0===t&&(E&&ur(ji(E),a),e.flags|=2),32!=(32&e.flags))if(8&y)Y_(i,t,e.child,a,l,u,!1),is(t,i,l,E,u);else if(32&y){const T=L_(e,a);let R;for(;R=T();)is(t,i,l,R,u);is(t,i,l,E,u)}else 16&y?sb(i,t,a,e,l,u):is(t,i,l,E,u);e=f?e.projectionNext:e.next}}function Fu(i,t,e,a,l,u){Y_(e,a,i.firstChild,t,l,u,!1)}function sb(i,t,e,a,l,u){const f=e[yr],y=f[vr].projection[a.projection];if(Array.isArray(y))for(let T=0;T<y.length;T++)is(t,i,l,y[T],u);else Y_(i,t,y,f[pi],l,u,!0)}function ab(i,t,e){""===e?i.removeAttribute(t,"class"):i.setAttribute(t,"class",e)}function cb(i,t,e){const{mergedAttrs:a,classes:l,styles:u}=e;null!==a&&Dy(i,t,a),null!==l&&ab(i,t,l),null!==u&&function y1(i,t,e){i.setAttribute(t,"style",e)}(i,t,u)}class Zw{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${qm})`}}function Pc(i){return i instanceof Zw?i.changingThisBreaksApplicationSecurity:i}const A1=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var Ni=(()=>((Ni=Ni||{})[Ni.NONE=0]="NONE",Ni[Ni.HTML=1]="HTML",Ni[Ni.STYLE=2]="STYLE",Ni[Ni.SCRIPT=3]="SCRIPT",Ni[Ni.URL=4]="URL",Ni[Ni.RESOURCE_URL=5]="RESOURCE_URL",Ni))();function fb(i){const t=function Gp(){const i=Ee();return i&&i[Ep]}();return t?t.sanitize(Ni.URL,i)||"":function Uu(i,t){const e=function w1(i){return i instanceof Zw&&i.getTypeName()||null}(i);if(null!=e&&e!==t){if("ResourceURL"===e&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${e} (see ${qm})`)}return e===t}(i,"URL")?Pc(i):function J_(i){return(i=String(i)).match(A1)?i:"unsafe:"+i}(He(i))}const Z_=new Pe("ENVIRONMENT_INITIALIZER"),fI=new Pe("INJECTOR",-1),mI=new Pe("INJECTOR_DEF_TYPES");class _I{get(t,e=uu){if(e===uu){const a=new Error(`NullInjectorError: No provider for ${Mn(t)}!`);throw a.name="NullInjectorError",a}return e}}function U1(...i){return{\u0275providers:gI(0,i),\u0275fromNgModule:!0}}function gI(i,...t){const e=[],a=new Set;let l;return Ul(t,u=>{const f=u;eg(f,e,[],a)&&(l||(l=[]),l.push(f))}),void 0!==l&&EI(l,e),e}function EI(i,t){for(let e=0;e<i.length;e++){const{providers:l}=i[e];mb(l,u=>{t.push(u)})}}function eg(i,t,e,a){if(!(i=Qe(i)))return!1;let l=null,u=A0(i);const f=!u&&yn(i);if(u||f){if(f&&!f.standalone)return!1;l=i}else{const y=i.ngModule;if(u=A0(y),!u)return!1;l=y}const E=a.has(l);if(f){if(E)return!1;if(a.add(l),f.dependencies){const y="function"==typeof f.dependencies?f.dependencies():f.dependencies;for(const T of y)eg(T,t,e,a)}}else{if(!u)return!1;{if(null!=u.imports&&!E){let T;a.add(l);try{Ul(u.imports,R=>{eg(R,t,e,a)&&(T||(T=[]),T.push(R))})}finally{}void 0!==T&&EI(T,t)}if(!E){const T=Al(l)||(()=>new l);t.push({provide:l,useFactory:T,deps:an},{provide:mI,useValue:l,multi:!0},{provide:Z_,useValue:()=>pe(l),multi:!0})}const y=u.providers;null==y||E||mb(y,R=>{t.push(R)})}}return l!==i&&void 0!==i.providers}function mb(i,t){for(let e of i)iy(e)&&(e=e.\u0275providers),Array.isArray(e)?mb(e,t):t(e)}const B1=Pn({provide:String,useValue:Pn});function Hu(i){return null!==i&&"object"==typeof i&&B1 in i}function ua(i){return"function"==typeof i}const gb=new Pe("Set Injector scope."),Wp={},yI={};let Eb;function zp(){return void 0===Eb&&(Eb=new _I),Eb}class ha{}class bI extends ha{get destroyed(){return this._destroyed}constructor(t,e,a,l){super(),this.parent=e,this.source=a,this.scopes=l,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,ig(t,f=>this.processProvider(f)),this.records.set(fI,Gu(void 0,this)),l.has("environment")&&this.records.set(ha,Gu(void 0,this));const u=this.records.get(gb);null!=u&&"string"==typeof u.value&&this.scopes.add(u.value),this.injectorDefTypes=new Set(this.get(mI.multi,an,rt.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();for(const t of this._onDestroyHooks)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(t){this._onDestroyHooks.push(t)}runInContext(t){this.assertNotDestroyed();const e=hu(this),a=wo(void 0);try{return t()}finally{hu(e),wo(a)}}get(t,e=uu,a=rt.Default){this.assertNotDestroyed(),a=e_(a);const l=hu(this),u=wo(void 0);try{if(!(a&rt.SkipSelf)){let E=this.records.get(t);if(void 0===E){const y=function W1(i){return"function"==typeof i||"object"==typeof i&&i instanceof Pe}(t)&&xr(t);E=y&&this.injectableDefInScope(y)?Gu(ng(t),Wp):null,this.records.set(t,E)}if(null!=E)return this.hydrate(t,E)}return(a&rt.Self?zp():this.parent).get(t,e=a&rt.Optional&&e===uu?null:e)}catch(f){if("NullInjectorError"===f.name){if((f[Zm]=f[Zm]||[]).unshift(Mn(t)),l)throw f;return function hy(i,t,e,a){const l=i[Zm];throw t[N0]&&l.unshift(t[N0]),i.message=function pP(i,t,e,a=null){i=i&&"\n"===i.charAt(0)&&i.charAt(1)==mp?i.slice(2):i;let l=Mn(t);if(Array.isArray(t))l=t.map(Mn).join(" -> ");else if("object"==typeof t){let u=[];for(let f in t)if(t.hasOwnProperty(f)){let E=t[f];u.push(f+":"+("string"==typeof E?JSON.stringify(E):Mn(E)))}l=`{${u.join(", ")}}`}return`${e}${a?"("+a+")":""}[${l}]: ${i.replace(uP,"\n  ")}`}("\n"+i.message,l,e,a),i[dP]=l,i[Zm]=null,i}(f,t,"R3InjectorError",this.source)}throw f}finally{wo(u),hu(l)}}resolveInjectorInitializers(){const t=hu(this),e=wo(void 0);try{const a=this.get(Z_.multi,an,rt.Self);for(const l of a)l()}finally{hu(t),wo(e)}}toString(){const t=[],e=this.records;for(const a of e.keys())t.push(Mn(a));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new he(205,!1)}processProvider(t){let e=ua(t=Qe(t))?t:Qe(t&&t.provide);const a=function j1(i){return Hu(i)?Gu(void 0,i.useValue):Gu(CI(i),Wp)}(t);if(ua(t)||!0!==t.multi)this.records.get(e);else{let l=this.records.get(e);l||(l=Gu(void 0,Wp,!0),l.factory=()=>_p(l.multi),this.records.set(e,l)),e=t,l.multi.push(t)}this.records.set(e,a)}hydrate(t,e){return e.value===Wp&&(e.value=yI,e.value=e.factory()),"object"==typeof e.value&&e.value&&function G1(i){return null!==i&&"object"==typeof i&&"function"==typeof i.ngOnDestroy}(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}injectableDefInScope(t){if(!t.providedIn)return!1;const e=Qe(t.providedIn);return"string"==typeof e?"any"===e||this.scopes.has(e):this.injectorDefTypes.has(e)}}function ng(i){const t=xr(i),e=null!==t?t.factory:Al(i);if(null!==e)return e;if(i instanceof Pe)throw new he(204,!1);if(i instanceof Function)return function SI(i){const t=i.length;if(t>0)throw Ru(t,"?"),new he(204,!1);const e=function cy(i){return i&&(i[pp]||i[Cc])||null}(i);return null!==e?()=>e.factory(i):()=>new i}(i);throw new he(204,!1)}function CI(i,t,e){let a;if(ua(i)){const l=Qe(i);return Al(l)||ng(l)}if(Hu(i))a=()=>Qe(i.useValue);else if(function _b(i){return!(!i||!i.useFactory)}(i))a=()=>i.useFactory(..._p(i.deps||[]));else if(function tg(i){return!(!i||!i.useExisting)}(i))a=()=>pe(Qe(i.useExisting));else{const l=Qe(i&&(i.useClass||i.provide));if(!function H1(i){return!!i.deps}(i))return Al(l)||ng(l);a=()=>new l(..._p(i.deps))}return a}function Gu(i,t,e=!1){return{factory:i,value:t,multi:e?[]:void 0}}function ig(i,t){for(const e of i)Array.isArray(e)?ig(e,t):e&&iy(e)?ig(e.\u0275providers,t):t(e)}class TI{}class rg{}class z1{resolveComponentFactory(t){throw function wI(i){const t=Error(`No component factory found for ${Mn(i)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=i,t}(t)}}let Wl=(()=>{class i{}return i.NULL=new z1,i})();function II(){return zl(Oi(),Ee())}function zl(i,t){return new cn(Do(i,t))}let cn=(()=>{class i{constructor(e){this.nativeElement=e}}return i.__NG_ELEMENT_ID__=II,i})();function K1(i){return i instanceof cn?i.nativeElement:i}class Kl{}let pa=(()=>{class i{}return i.__NG_ELEMENT_ID__=()=>function q1(){const i=Ee(),e=to(Oi().index,i);return(Ro(e)?e:i)[Pt]}(),i})(),RI=(()=>{class i{}return i.\u0275prov=Oe({token:i,providedIn:"root",factory:()=>null}),i})();class ql{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const AI=new ql("15.2.10"),vb={},yb="ngOriginalError";function Wu(i){return i[yb]}class Yl{constructor(){this._console=console}handleError(t){const e=this._findOriginalError(t);this._console.error("ERROR",t),e&&this._console.error("ORIGINAL ERROR",e)}_findOriginalError(t){let e=t&&Wu(t);for(;e&&Wu(e);)e=Wu(e);return e||null}}function ro(i){return i instanceof Function?i():i}function kI(i,t,e){let a=i.length;for(;;){const l=i.indexOf(t,e);if(-1===l)return l;if(0===l||i.charCodeAt(l-1)<=32){const u=t.length;if(l+u===a||i.charCodeAt(l+u)<=32)return l}e=l+1}}const Cb="ng-template";function Z1(i,t,e){let a=0,l=!0;for(;a<i.length;){let u=i[a++];if("string"==typeof u&&l){const f=i[a++];if(e&&"class"===u&&-1!==kI(f.toLowerCase(),t,0))return!0}else{if(1===u){for(;a<i.length&&"string"==typeof(u=i[a++]);)if(u.toLowerCase()===t)return!0;return!1}"number"==typeof u&&(l=!1)}}return!1}function xI(i){return 4===i.type&&i.value!==Cb}function LI(i,t,e){return t===(4!==i.type||e?i.value:Cb)}function eM(i,t,e){let a=4;const l=i.attrs||[],u=function VI(i){for(let t=0;t<i.length;t++)if(Oy(i[t]))return t;return i.length}(l);let f=!1;for(let E=0;E<t.length;E++){const y=t[E];if("number"!=typeof y){if(!f)if(4&a){if(a=2|1&a,""!==y&&!LI(i,y,e)||""===y&&1===t.length){if(rs(a))return!1;f=!0}}else{const T=8&a?y:t[++E];if(8&a&&null!==i.attrs){if(!Z1(i.attrs,T,e)){if(rs(a))return!1;f=!0}continue}const L=FI(8&a?"class":y,l,xI(i),e);if(-1===L){if(rs(a))return!1;f=!0;continue}if(""!==T){let H;H=L>u?"":l[L+1].toLowerCase();const W=8&a?H:null;if(W&&-1!==kI(W,T,0)||2&a&&T!==H){if(rs(a))return!1;f=!0}}}}else{if(!f&&!rs(a)&&!rs(y))return!1;if(f&&rs(y))continue;f=!1,a=y|1&a}}return rs(a)||f}function rs(i){return 0==(1&i)}function FI(i,t,e,a){if(null===t)return-1;let l=0;if(a||!e){let u=!1;for(;l<t.length;){const f=t[l];if(f===i)return l;if(3===f||6===f)u=!0;else{if(1===f||2===f){let E=t[++l];for(;"string"==typeof E;)E=t[++l];continue}if(4===f)break;if(0===f){l+=4;continue}}l+=u?1:2}return-1}return function Kp(i,t){let e=i.indexOf(4);if(e>-1)for(e++;e<i.length;){const a=i[e];if("number"==typeof a)return-1;if(a===t)return e;e++}return-1}(t,i)}function UI(i,t,e=!1){for(let a=0;a<t.length;a++)if(eM(i,t[a],e))return!0;return!1}function nM(i,t){e:for(let e=0;e<t.length;e++){const a=t[e];if(i.length===a.length){for(let l=0;l<i.length;l++)if(i[l]!==a[l])continue e;return!0}}return!1}function BI(i,t){return i?":not("+t.trim()+")":t}function S(i){let t=i[0],e=1,a=2,l="",u=!1;for(;e<i.length;){let f=i[e];if("string"==typeof f)if(2&a){const E=i[++e];l+="["+f+(E.length>0?'="'+E+'"':"")+"]"}else 8&a?l+="."+f:4&a&&(l+=" "+f);else""!==l&&!rs(f)&&(t+=BI(u,l),l=""),a=f,u=u||!rs(a);e++}return""!==l&&(t+=BI(u,l)),t}const vt={};function Ze(i){jI(Wt(),Ee(),jr()+i,!1)}function jI(i,t,e,a){if(!a)if(3==(3&t[Dt])){const u=i.preOrderCheckHooks;null!==u&&wp(t,u,e)}else{const u=i.preOrderHooks;null!==u&&h_(t,u,0,e)}Pl(e)}function HI(i,t=null,e=null,a){const l=GI(i,t,e,a);return l.resolveInjectorInitializers(),l}function GI(i,t=null,e=null,a,l=new Set){const u=[e||an,U1(i)];return a=a||("object"==typeof i?void 0:Mn(i)),new bI(u,t||zp(),a||null,l)}let No=(()=>{class i{static create(e,a){if(Array.isArray(e))return HI({name:""},a,e,"");{const l=e.name??"";return HI({name:l},e.parent,e.providers,l)}}}return i.THROW_IF_NOT_FOUND=uu,i.NULL=new _I,i.\u0275prov=Oe({token:i,providedIn:"any",factory:()=>pe(fI)}),i.__NG_ELEMENT_ID__=-1,i})();function ie(i,t=rt.Default){const e=Ee();return null===e?pe(i,t):fw(Oi(),e,Qe(i),t)}function qp(){throw new Error("invalid")}function nR(i,t){const e=i.contentQueries;if(null!==e)for(let a=0;a<e.length;a+=2){const u=e[a+1];if(-1!==u){const f=i.data[u];Re(e[a]),f.contentQueries(2,t[u],u)}}}function ug(i,t,e,a,l,u,f,E,y,T,R){const L=t.blueprint.slice();return L[sa]=l,L[Dt]=76|a,(null!==R||i&&1024&i[Dt])&&(L[Dt]|=1024),vy(L),L[pi]=L[_u]=i,L[Zn]=e,L[mu]=f||i&&i[mu],L[Pt]=E||i&&i[Pt],L[Ep]=y||i&&i[Ep]||null,L[gp]=T||i&&i[gp]||null,L[vr]=u,L[bp]=function zy(){return N_++}(),L[k0]=R,L[yr]=2==t.type?i[yr]:L,L}function Xl(i,t,e,a,l){let u=i.data[t];if(null===u)u=function Ob(i,t,e,a,l){const u=$0(),f=za(),y=i.data[t]=function vM(i,t,e,a,l,u){return{type:e,index:a,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:l,attrs:u,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,f?u:u&&u.parent,e,t,a,l);return null===i.firstChild&&(i.firstChild=y),null!==u&&(f?null==u.child&&null!==y.parent&&(u.child=y):null===u.next&&(u.next=y,y.prev=u)),y}(i,t,e,a,l),function MP(){return Et.lFrame.inI18n}()&&(u.flags|=32);else if(64&u.type){u.type=e,u.value=a,u.attrs=l;const f=function Cp(){const i=Et.lFrame,t=i.currentTNode;return i.isParent?t:t.parent}();u.injectorIndex=null===f?-1:f.injectorIndex}return la(u,!0),u}function Yp(i,t,e,a){if(0===e)return-1;const l=t.length;for(let u=0;u<e;u++)t.push(a),i.blueprint.push(a),i.data.push(null);return l}function Nb(i,t,e){Sy(t);try{const a=i.viewQuery;null!==a&&Hb(1,a,e);const l=i.template;null!==l&&iR(i,t,l,1,e),i.firstCreatePass&&(i.firstCreatePass=!1),i.staticContentQueries&&nR(i,t),i.staticViewQueries&&Hb(2,i.viewQuery,e);const u=i.components;null!==u&&function _M(i,t){for(let e=0;e<t.length;e++)fg(i,t[e])}(t,u)}catch(a){throw i.firstCreatePass&&(i.incompleteFirstPass=!0,i.firstCreatePass=!1),a}finally{t[Dt]&=-5,wy()}}function hg(i,t,e,a){const l=t[Dt];if(128!=(128&l)){Sy(t);try{vy(t),function J0(i){return Et.lFrame.bindingIndex=i}(i.bindingStartIndex),null!==e&&iR(i,t,e,2,a);const f=3==(3&l);if(f){const T=i.preOrderCheckHooks;null!==T&&wp(t,T,null)}else{const T=i.preOrderHooks;null!==T&&h_(t,T,0,null),Ry(t,0)}if(function kM(i){for(let t=Xy(i);null!==t;t=V_(t)){if(!t[x0])continue;const e=t[Eu];for(let a=0;a<e.length;a++){const l=e[a];512&l[Dt]||l_(l[pi],1),l[Dt]|=512}}}(t),function MM(i){for(let t=Xy(i);null!==t;t=V_(t))for(let e=Ur;e<t.length;e++){const a=t[e],l=a[Fe];c_(a)&&hg(l,a,l.template,a[Zn])}}(t),null!==i.contentQueries&&nR(i,t),f){const T=i.contentCheckHooks;null!==T&&wp(t,T)}else{const T=i.contentHooks;null!==T&&h_(t,T,1),Ry(t,1)}!function fM(i,t){const e=i.hostBindingOpCodes;if(null!==e)try{for(let a=0;a<e.length;a++){const l=e[a];if(l<0)Pl(~l);else{const u=l,f=e[++a],E=e[++a];Z0(f,u),E(2,t[u])}}}finally{Pl(-1)}}(i,t);const E=i.components;null!==E&&function mM(i,t){for(let e=0;e<t.length;e++)uR(i,t[e])}(t,E);const y=i.viewQuery;if(null!==y&&Hb(2,y,a),f){const T=i.viewCheckHooks;null!==T&&wp(t,T)}else{const T=i.viewHooks;null!==T&&h_(t,T,2),Ry(t,2)}!0===i.firstUpdatePass&&(i.firstUpdatePass=!1),t[Dt]&=-41,512&t[Dt]&&(t[Dt]&=-513,l_(t[pi],-1))}finally{wy()}}}function iR(i,t,e,a,l){const u=jr(),f=2&a;try{Pl(-1),f&&t.length>$n&&jI(i,t,$n,!1),Qo(f?2:0,l),e(a,l)}finally{Pl(u),Qo(f?3:1,l)}}function pg(i,t,e){if(my(t)){const l=t.directiveEnd;for(let u=t.directiveStart;u<l;u++){const f=i.data[u];f.contentQueries&&f.contentQueries(1,e[u],u)}}}function Pb(i,t,e){Y0()&&(function TM(i,t,e,a){const l=e.directiveStart,u=e.directiveEnd;Sp(e)&&function OM(i,t,e){const a=Do(t,i),l=kb(e),u=i[mu],f=kc(i,ug(i,l,null,e.onPush?32:16,a,t,u,u.createRenderer(a,e),null,null,null));i[t.index]=f}(t,e,i.data[l+e.componentOffset]),i.firstCreatePass||__(e,t),ur(a,t);const f=e.initialInputs;for(let E=l;E<u;E++){const y=i.data[E],T=Ya(t,i,E,e);ur(T,t),null!==f&&NM(0,E-l,T,y,0,f),Vr(y)&&(to(e.index,t)[Zn]=Ya(t,i,E,e))}}(i,t,e,Do(e,t)),64==(64&e.flags)&&lR(i,t,e))}function Mb(i,t,e=Do){const a=t.localNames;if(null!==a){let l=t.index+1;for(let u=0;u<a.length;u+=2){const f=a[u+1],E=-1===f?e(t,i):i[f];i[l++]=E}}}function kb(i){const t=i.tView;return null===t||t.incompleteFirstPass?i.tView=xb(1,null,i.template,i.decls,i.vars,i.directiveDefs,i.pipeDefs,i.viewQuery,i.schemas,i.consts):t}function xb(i,t,e,a,l,u,f,E,y,T){const R=$n+a,L=R+l,H=function gM(i,t){const e=[];for(let a=0;a<t;a++)e.push(a<i?null:vt);return e}(R,L),W="function"==typeof T?T():T;return H[Fe]={type:i,blueprint:H,template:e,queries:null,viewQuery:E,declTNode:t,data:H.slice().fill(null,R),bindingStartIndex:R,expandoStartIndex:L,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof u?u():u,pipeRegistry:"function"==typeof f?f():f,firstChild:null,schemas:y,consts:W,incompleteFirstPass:!1}}function rR(i,t,e,a){const l=pR(t);null===e?l.push(a):(l.push(e),i.firstCreatePass&&Wb(i).push(a,l.length-1))}function oR(i,t,e,a){for(let l in i)if(i.hasOwnProperty(l)){e=null===e?{}:e;const u=i[l];null===a?Lb(e,t,l,u):a.hasOwnProperty(l)&&Lb(e,t,a[l],u)}return e}function Lb(i,t,e,a){i.hasOwnProperty(e)?i[e].push(t,a):i[e]=[t,a]}function Po(i,t,e,a,l,u,f,E){const y=Do(t,e);let R,T=t.inputs;!E&&null!=T&&(R=T[a])?(zb(i,e,R,a,l),Sp(t)&&function SM(i,t){const e=to(t,i);16&e[Dt]||(e[Dt]|=32)}(e,t.index)):3&t.type&&(a=function bM(i){return"class"===i?"className":"for"===i?"htmlFor":"formaction"===i?"formAction":"innerHtml"===i?"innerHTML":"readonly"===i?"readOnly":"tabindex"===i?"tabIndex":i}(a),l=null!=f?f(l,t.value||"",a):l,u.setProperty(y,a,l))}function Fb(i,t,e,a){if(Y0()){const l=null===a?null:{"":-1},u=function IM(i,t){const e=i.directiveRegistry;let a=null,l=null;if(e)for(let u=0;u<e.length;u++){const f=e[u];if(UI(t,f.selectors,!1))if(a||(a=[]),Vr(f))if(null!==f.findHostDirectiveDefs){const E=[];l=l||new Map,f.findHostDirectiveDefs(f,E,l),a.unshift(...E,f),Ub(i,t,E.length)}else a.unshift(f),Ub(i,t,0);else l=l||new Map,f.findHostDirectiveDefs?.(f,a,l),a.push(f)}return null===a?null:[a,l]}(i,e);let f,E;null===u?f=E=null:[f,E]=u,null!==f&&aR(i,t,e,f,l,E),l&&function RM(i,t,e){if(t){const a=i.localNames=[];for(let l=0;l<t.length;l+=2){const u=e[t[l+1]];if(null==u)throw new he(-301,!1);a.push(t[l],u)}}}(e,a,l)}e.mergedAttrs=Su(e.mergedAttrs,e.attrs)}function aR(i,t,e,a,l,u){for(let T=0;T<a.length;T++)Ip(__(e,t),i,a[T].type);!function AM(i,t,e){i.flags|=1,i.directiveStart=t,i.directiveEnd=t+e,i.providerIndexes=t}(e,i.data.length,a.length);for(let T=0;T<a.length;T++){const R=a[T];R.providersResolver&&R.providersResolver(R)}let f=!1,E=!1,y=Yp(i,t,a.length,null);for(let T=0;T<a.length;T++){const R=a[T];e.mergedAttrs=Su(e.mergedAttrs,R.hostAttrs),DM(i,e,t,y,R),dR(y,R,l),null!==R.contentQueries&&(e.flags|=4),(null!==R.hostBindings||null!==R.hostAttrs||0!==R.hostVars)&&(e.flags|=64);const L=R.type.prototype;!f&&(L.ngOnChanges||L.ngOnInit||L.ngDoCheck)&&((i.preOrderHooks??(i.preOrderHooks=[])).push(e.index),f=!0),!E&&(L.ngOnChanges||L.ngDoCheck)&&((i.preOrderCheckHooks??(i.preOrderCheckHooks=[])).push(e.index),E=!0),y++}!function yM(i,t,e){const l=t.directiveEnd,u=i.data,f=t.attrs,E=[];let y=null,T=null;for(let R=t.directiveStart;R<l;R++){const L=u[R],H=e?e.get(L):null,q=H?H.outputs:null;y=oR(L.inputs,R,y,H?H.inputs:null),T=oR(L.outputs,R,T,q);const re=null===y||null===f||xI(t)?null:PM(y,R,f);E.push(re)}null!==y&&(y.hasOwnProperty("class")&&(t.flags|=8),y.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=E,t.inputs=y,t.outputs=T}(i,e,u)}function lR(i,t,e){const a=e.directiveStart,l=e.directiveEnd,u=e.index,f=function kP(){return Et.lFrame.currentDirectiveIndex}();try{Pl(u);for(let E=a;E<l;E++){const y=i.data[E],T=t[E];by(E),(null!==y.hostBindings||0!==y.hostVars||null!==y.hostAttrs)&&wM(y,T)}}finally{Pl(-1),by(f)}}function wM(i,t){null!==i.hostBindings&&i.hostBindings(1,t)}function Ub(i,t,e){t.componentOffset=e,(i.components??(i.components=[])).push(t.index)}function dR(i,t,e){if(e){if(t.exportAs)for(let a=0;a<t.exportAs.length;a++)e[t.exportAs[a]]=i;Vr(t)&&(e[""]=i)}}function DM(i,t,e,a,l){i.data[a]=l;const u=l.factory||(l.factory=Al(l.type)),f=new kl(u,Vr(l),ie);i.blueprint[a]=f,e[a]=f,function cR(i,t,e,a,l){const u=l.hostBindings;if(u){let f=i.hostBindingOpCodes;null===f&&(f=i.hostBindingOpCodes=[]);const E=~t.index;(function CM(i){let t=i.length;for(;t>0;){const e=i[--t];if("number"==typeof e&&e<0)return e}return 0})(f)!=E&&f.push(E),f.push(e,a,u)}}(i,t,a,Yp(i,e,l.hostVars,vt),l)}function fa(i,t,e,a,l,u){const f=Do(i,t);!function Vb(i,t,e,a,l,u,f){if(null==u)i.removeAttribute(t,l,e);else{const E=null==f?He(u):f(u,a||"",l);i.setAttribute(t,l,E,e)}}(t[Pt],f,u,i.value,e,a,l)}function NM(i,t,e,a,l,u){const f=u[t];if(null!==f){const E=a.setInput;for(let y=0;y<f.length;){const T=f[y++],R=f[y++],L=f[y++];null!==E?a.setInput(e,L,T,R):e[R]=L}}}function PM(i,t,e){let a=null,l=0;for(;l<e.length;){const u=e[l];if(0!==u)if(5!==u){if("number"==typeof u)break;if(i.hasOwnProperty(u)){null===a&&(a=[]);const f=i[u];for(let E=0;E<f.length;E+=2)if(f[E]===t){a.push(u,f[E+1],e[l+1]);break}}l+=2}else l+=2;else l+=4}return a}function Bb(i,t,e,a){return[i,!0,!1,t,null,0,a,e,null,null]}function uR(i,t){const e=to(t,i);if(c_(e)){const a=e[Fe];48&e[Dt]?hg(a,e,a.template,e[Zn]):e[Il]>0&&jb(e)}}function jb(i){for(let a=Xy(i);null!==a;a=V_(a))for(let l=Ur;l<a.length;l++){const u=a[l];if(c_(u))if(512&u[Dt]){const f=u[Fe];hg(f,u,f.template,u[Zn])}else u[Il]>0&&jb(u)}const e=i[Fe].components;if(null!==e)for(let a=0;a<e.length;a++){const l=to(e[a],i);c_(l)&&l[Il]>0&&jb(l)}}function fg(i,t){const e=to(t,i),a=e[Fe];(function hR(i,t){for(let e=t.length;e<i.blueprint.length;e++)t.push(i.blueprint[e])})(a,e),Nb(a,e,e[Zn])}function kc(i,t){return i[vp]?i[py][Ls]=t:i[vp]=t,i[py]=t,t}function mg(i){for(;i;){i[Dt]|=32;const t=nr(i);if(Jo(i)&&!t)return i;i=t}return null}function _g(i,t,e,a=!0){const l=t[mu];l.begin&&l.begin();try{hg(i,t,i.template,e)}catch(f){throw a&&Eg(t,f),f}finally{l.end&&l.end()}}function Hb(i,t,e){Re(0),t(i,e)}function pR(i){return i[fu]||(i[fu]=[])}function Wb(i){return i.cleanup||(i.cleanup=[])}function Eg(i,t){const e=i[gp],a=e?e.get(Yl,null):null;a&&a.handleError(t)}function zb(i,t,e,a,l){for(let u=0;u<e.length;){const f=e[u++],E=e[u++],y=t[f],T=i.data[f];null!==T.setInput?T.setInput(y,l,a,E):y[E]=l}}function vg(i,t,e){let a=e?i.styles:null,l=e?i.classes:null,u=0;if(null!==t)for(let f=0;f<t.length;f++){const E=t[f];"number"==typeof E?u=E:1==u?l=Km(l,E):2==u&&(a=Km(a,E+": "+t[++f]+";"))}e?i.styles=a:i.stylesWithoutHost=a,e?i.classes=l:i.classesWithoutHost=l}function yg(i,t,e,a,l=!1){for(;null!==e;){const u=t[e.index];if(null!==u&&a.push(ji(u)),Xo(u))for(let E=Ur;E<u.length;E++){const y=u[E],T=y[Fe].firstChild;null!==T&&yg(y[Fe],y,T,a)}const f=e.type;if(8&f)yg(i,t,e.child,a);else if(32&f){const E=L_(e,t);let y;for(;y=E();)a.push(y)}else if(16&f){const E=Kw(t,e);if(Array.isArray(E))a.push(...E);else{const y=nr(t[yr]);yg(y[Fe],y,E,a,!0)}}e=l?e.projectionNext:e.next}return a}class $p{get rootNodes(){const t=this._lView,e=t[Fe];return yg(e,t,e.firstChild,[])}constructor(t,e){this._lView=t,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Zn]}set context(t){this._lView[Zn]=t}get destroyed(){return 128==(128&this._lView[Dt])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[pi];if(Xo(t)){const e=t[wc],a=e?e.indexOf(this):-1;a>-1&&(Bp(t,a),y_(e,a))}this._attachedToViewContainer=!1}j_(this._lView[Fe],this._lView)}onDestroy(t){rR(this._lView[Fe],this._lView,null,t)}markForCheck(){mg(this._cdRefInjectingView||this._lView)}detach(){this._lView[Dt]&=-65}reattach(){this._lView[Dt]|=64}detectChanges(){_g(this._lView[Fe],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new he(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function m1(i,t){Fu(i,t,t[Pt],2,null,null)}(this._lView[Fe],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new he(902,!1);this._appRef=t}}class bg extends $p{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;_g(t[Fe],t,t[Zn],!1)}checkNoChanges(){}get context(){return null}}class fR extends Wl{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const e=yn(t);return new ma(e,this.ngModule)}}function Jl(i){const t=[];for(let e in i)i.hasOwnProperty(e)&&t.push({propName:i[e],templateName:e});return t}class Xp{constructor(t,e){this.injector=t,this.parentInjector=e}get(t,e,a){a=e_(a);const l=this.injector.get(t,vb,a);return l!==vb||e===vb?l:this.parentInjector.get(t,e,a)}}class ma extends rg{get inputs(){return Jl(this.componentDef.inputs)}get outputs(){return Jl(this.componentDef.outputs)}constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=function iM(i){return i.map(S).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!e}create(t,e,a,l){let u=(l=l||this.ngModule)instanceof ha?l:l?.injector;u&&null!==this.componentDef.getStandaloneInjector&&(u=this.componentDef.getStandaloneInjector(u)||u);const f=u?new Xp(t,u):t,E=f.get(Kl,null);if(null===E)throw new he(407,!1);const y=f.get(RI,null),T=E.createRenderer(null,this.componentDef),R=this.componentDef.selectors[0][0]||"div",L=a?function EM(i,t,e){return i.selectRootElement(t,e===Ms.ShadowDom)}(T,a,this.componentDef.encapsulation):B_(T,R,function Kb(i){const t=i.toLowerCase();return"svg"===t?G0:"math"===t?"math":null}(R)),H=this.componentDef.onPush?288:272,W=xb(0,null,null,1,0,null,null,null,null,null),q=ug(null,W,null,H,null,null,E,T,y,f,null);let re,ce;Sy(q);try{const Te=this.componentDef;let De,ue=null;Te.findHostDirectiveDefs?(De=[],ue=new Map,Te.findHostDirectiveDefs(Te,De,ue),De.push(Te)):De=[Te];const Ue=function Jp(i,t){const e=i[Fe],a=$n;return i[a]=t,Xl(e,a,2,"#host",null)}(q,L),qt=function xM(i,t,e,a,l,u,f,E){const y=l[Fe];!function LM(i,t,e,a){for(const l of i)t.mergedAttrs=Su(t.mergedAttrs,l.hostAttrs);null!==t.mergedAttrs&&(vg(t,t.mergedAttrs,!0),null!==e&&cb(a,e,t))}(a,i,t,f);const T=u.createRenderer(t,e),R=ug(l,kb(e),null,e.onPush?32:16,l[i.index],i,u,T,E||null,null,null);return y.firstCreatePass&&Ub(y,i,a.length-1),kc(l,R),l[i.index]=R}(Ue,L,Te,De,q,E,T);ce=K0(W,$n),L&&function gR(i,t,e,a){if(a)Dy(i,e,["ng-version",AI.full]);else{const{attrs:l,classes:u}=function rM(i){const t=[],e=[];let a=1,l=2;for(;a<i.length;){let u=i[a];if("string"==typeof u)2===l?""!==u&&t.push(u,i[++a]):8===l&&e.push(u);else{if(!rs(l))break;l=u}a++}return{attrs:t,classes:e}}(t.selectors[0]);l&&Dy(i,e,l),u&&u.length>0&&ab(i,e,u.join(" "))}}(T,Te,L,a),void 0!==e&&function UM(i,t,e){const a=i.projection=[];for(let l=0;l<t.length;l++){const u=e[l];a.push(null!=u?Array.from(u):null)}}(ce,this.ngContentSelectors,e),re=function FM(i,t,e,a,l,u){const f=Oi(),E=l[Fe],y=Do(f,l);aR(E,l,f,e,null,a);for(let R=0;R<e.length;R++)ur(Ya(l,E,f.directiveStart+R,f),l);lR(E,l,f),y&&ur(y,l);const T=Ya(l,E,f.directiveStart+f.componentOffset,f);if(i[Zn]=l[Zn]=T,null!==u)for(const R of u)R(T,t);return pg(E,f,i),T}(qt,Te,De,ue,q,[VM]),Nb(W,q,null)}finally{wy()}return new mR(this.componentType,re,zl(ce,q),q,ce)}}class mR extends TI{constructor(t,e,a,l,u){super(),this.location=a,this._rootLView=l,this._tNode=u,this.instance=e,this.hostView=this.changeDetectorRef=new bg(l),this.componentType=t}setInput(t,e){const a=this._tNode.inputs;let l;if(null!==a&&(l=a[t])){const u=this._rootLView;zb(u[Fe],u,l,t,e),mg(to(this._tNode.index,u))}}get injector(){return new Cu(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function VM(){const i=Oi();u_(Ee()[Fe],i)}function Ot(i){let t=function ER(i){return Object.getPrototypeOf(i.prototype).constructor}(i.type),e=!0;const a=[i];for(;t;){let l;if(Vr(i))l=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new he(903,!1);l=t.\u0275dir}if(l){if(e){a.push(l);const f=i;f.inputs=Sg(i.inputs),f.declaredInputs=Sg(i.declaredInputs),f.outputs=Sg(i.outputs);const E=l.hostBindings;E&&GM(i,E);const y=l.viewQuery,T=l.contentQueries;if(y&&jM(i,y),T&&HM(i,T),zm(i.inputs,l.inputs),zm(i.declaredInputs,l.declaredInputs),zm(i.outputs,l.outputs),Vr(l)&&l.data.animation){const R=i.data;R.animation=(R.animation||[]).concat(l.data.animation)}}const u=l.features;if(u)for(let f=0;f<u.length;f++){const E=u[f];E&&E.ngInherit&&E(i),E===Ot&&(e=!1)}}t=Object.getPrototypeOf(t)}!function BM(i){let t=0,e=null;for(let a=i.length-1;a>=0;a--){const l=i[a];l.hostVars=t+=l.hostVars,l.hostAttrs=Su(l.hostAttrs,e=Su(e,l.hostAttrs))}}(a)}function Sg(i){return i===Ga?{}:i===an?[]:i}function jM(i,t){const e=i.viewQuery;i.viewQuery=e?(a,l)=>{t(a,l),e(a,l)}:t}function HM(i,t){const e=i.contentQueries;i.contentQueries=e?(a,l,u)=>{t(a,l,u),e(a,l,u)}:t}function GM(i,t){const e=i.hostBindings;i.hostBindings=e?(a,l)=>{t(a,l),e(a,l)}:t}function Cg(i){return!!Yb(i)&&(Array.isArray(i)||!(i instanceof Map)&&Symbol.iterator in i)}function Yb(i){return null!==i&&("function"==typeof i||"object"==typeof i)}function os(i,t,e){return i[t]=e}function br(i,t,e){return!Object.is(i[t],e)&&(i[t]=e,!0)}function Za(i,t,e,a){const l=br(i,t,e);return br(i,t+1,a)||l}function zi(i,t,e,a){const l=Ee();return br(l,Nl(),t)&&(Wt(),fa(ai(),l,i,t,e,a)),zi}function en(i,t,e,a,l,u,f,E){const y=Ee(),T=Wt(),R=i+$n,L=T.firstCreatePass?function YM(i,t,e,a,l,u,f,E,y){const T=t.consts,R=Xl(t,i,4,f||null,Ic(T,E));Fb(t,e,R,Ic(T,y)),u_(t,R);const L=R.tView=xb(2,R,a,l,u,t.directiveRegistry,t.pipeRegistry,null,t.schemas,T);return null!==t.queries&&(t.queries.template(t,R),L.queries=t.queries.embeddedTView(R)),R}(R,T,y,t,e,a,l,u,f):T.data[R];la(L,!1);const H=y[Pt].createComment("");z_(T,y,H,L),ur(H,y),kc(y,y[R]=Bb(H,y,H,L)),o_(L)&&Pb(T,y,L),null!=f&&Mb(y,L,E)}function Qp(i){return yu(function PP(){return Et.lFrame.contextLView}(),$n+i)}function nt(i,t,e){const a=Ee();return br(a,Nl(),t)&&Po(Wt(),ai(),a,i,t,a[Pt],e,!1),nt}function Jb(i,t,e,a,l){const f=l?"class":"style";zb(i,e,t.inputs[f],f,a)}function Ne(i,t,e,a){const l=Ee(),u=Wt(),f=$n+i,E=l[Pt],y=u.firstCreatePass?function Qb(i,t,e,a,l,u){const f=t.consts,y=Xl(t,i,2,a,Ic(f,l));return Fb(t,e,y,Ic(f,u)),null!==y.attrs&&vg(y,y.attrs,!1),null!==y.mergedAttrs&&vg(y,y.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,y),y}(f,u,l,t,e,a):u.data[f],T=l[f]=B_(E,t,function rw(){return Et.lFrame.currentNamespace}()),R=o_(y);return la(y,!0),cb(E,T,y),32!=(32&y.flags)&&z_(u,l,T,y),0===function RP(){return Et.lFrame.elementDepthCount}()&&ur(T,l),function AP(){Et.lFrame.elementDepthCount++}(),R&&(Pb(u,l,y),pg(u,y,l)),null!==a&&Mb(l,y),Ne}function Ge(){let i=Oi();za()?yy():(i=i.parent,la(i,!1));const t=i;!function DP(){Et.lFrame.elementDepthCount--}();const e=Wt();return e.firstCreatePass&&(u_(e,i),my(i)&&e.queries.elementEnd(i)),null!=t.classesWithoutHost&&function ow(i){return 0!=(8&i.flags)}(t)&&Jb(e,t,Ee(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function sw(i){return 0!=(16&i.flags)}(t)&&Jb(e,t,Ee(),t.stylesWithoutHost,!1),Ge}function Tt(i,t,e,a){return Ne(i,t,e,a),Ge(),Tt}function Ku(i,t,e){const a=Ee(),l=Wt(),u=i+$n,f=l.firstCreatePass?function Ag(i,t,e,a,l){const u=t.consts,f=Ic(u,a),E=Xl(t,i,8,"ng-container",f);return null!==f&&vg(E,f,!0),Fb(t,e,E,Ic(u,l)),null!==t.queries&&t.queries.elementStart(t,E),E}(u,l,a,t,e):l.data[u];la(f,!0);const E=a[u]=a[Pt].createComment("");return z_(l,a,E,f),ur(E,a),o_(f)&&(Pb(l,a,f),pg(l,f,a)),null!=e&&Mb(a,f),Ku}function od(){let i=Oi();const t=Wt();return za()?yy():(i=i.parent,la(i,!1)),t.firstCreatePass&&(u_(t,i),my(i)&&t.queries.elementEnd(i)),od}function ga(){return Ee()}function ef(i){return!!i&&"function"==typeof i.then}function sd(i){return!!i&&"function"==typeof i.subscribe}const ec=sd;function tn(i,t,e,a){const l=Ee(),u=Wt(),f=Oi();return function qu(i,t,e,a,l,u,f){const E=o_(a),T=i.firstCreatePass&&Wb(i),R=t[Zn],L=pR(t);let H=!0;if(3&a.type||f){const re=Do(a,t),ce=f?f(re):re,Te=L.length,De=f?Ue=>f(ji(Ue[a.index])):a.index;let ue=null;if(!f&&E&&(ue=function XM(i,t,e,a){const l=i.cleanup;if(null!=l)for(let u=0;u<l.length-1;u+=2){const f=l[u];if(f===e&&l[u+1]===a){const E=t[fu],y=l[u+2];return E.length>y?E[y]:null}"string"==typeof f&&(u+=2)}return null}(i,t,l,a.index)),null!==ue)(ue.__ngLastListenerFn__||ue).__ngNextListenerFn__=u,ue.__ngLastListenerFn__=u,H=!1;else{u=OR(a,t,R,u,!1);const Ue=e.listen(ce,l,u);L.push(u,Ue),T&&T.push(l,De,Te,Te+1)}}else u=OR(a,t,R,u,!1);const W=a.outputs;let q;if(H&&null!==W&&(q=W[l])){const re=q.length;if(re)for(let ce=0;ce<re;ce+=2){const qt=t[q[ce]][q[ce+1]].subscribe(u),wn=L.length;L.push(u,qt),T&&T.push(l,a.index,wn,-(wn+1))}}}(u,l,l[Pt],f,i,t,a),tn}function DR(i,t,e,a){try{return Qo(6,t,e),!1!==e(a)}catch(l){return Eg(i,l),!1}finally{Qo(7,t,e)}}function OR(i,t,e,a,l){return function u(f){if(f===Function)return a;mg(i.componentOffset>-1?to(i.index,t):t);let y=DR(t,e,a,f),T=u.__ngNextListenerFn__;for(;T;)y=DR(t,e,T,f)&&y,T=T.__ngNextListenerFn__;return l&&!1===y&&(f.preventDefault(),f.returnValue=!1),y}}function ln(i=1){return function Iy(i){return(Et.lFrame.contextLView=function xP(i,t){for(;i>0;)t=t[_u],i--;return t}(i,Et.lFrame.contextLView))[Zn]}(i)}function JM(i,t){let e=null;const a=function tM(i){const t=i.attrs;if(null!=t){const e=t.indexOf(5);if(!(1&e))return t[e+1]}return null}(i);for(let l=0;l<t.length;l++){const u=t[l];if("*"!==u){if(null===a?UI(i,u,!0):nM(a,u))return l}else e=l}return e}function Yu(i){const t=Ee()[yr][vr];if(!t.projection){const a=t.projection=Ru(i?i.length:1,null),l=a.slice();let u=t.child;for(;null!==u;){const f=i?JM(u,i):0;null!==f&&(l[f]?l[f].projectionNext=u:a[f]=u,l[f]=u),u=u.next}}}function Sr(i,t=0,e){const a=Ee(),l=Wt(),u=Xl(l,$n+i,16,null,e||null);null===u.projection&&(u.projection=t),yy(),32!=(32&u.flags)&&function E1(i,t,e){sb(t[Pt],0,t,e,Zy(i,e,t),ib(e.parent||t[vr],e,t))}(l,a,u)}function Ng(i,t){return i<<17|t<<2}function Ea(i){return i>>17&32767}function Xu(i){return 2|i}function so(i){return(131068&i)>>2}function ad(i,t){return-131069&i|t<<2}function nS(i){return 1|i}function xR(i,t,e,a,l){const u=i[e+1],f=null===t;let E=a?Ea(u):so(u),y=!1;for(;0!==E&&(!1===y||f);){const R=i[E+1];tk(i[E],t)&&(y=!0,i[E+1]=a?nS(R):Xu(R)),E=a?Ea(R):so(R)}y&&(i[e+1]=a?Xu(u):nS(u))}function tk(i,t){return null===i||null==t||(Array.isArray(i)?i[1]:i)===t||!(!Array.isArray(i)||"string"!=typeof t)&&Du(i,t)>=0}function tc(i,t,e){return js(i,t,e,!1),tc}function Bt(i,t){return js(i,t,null,!0),Bt}function js(i,t,e,a){const l=Ee(),u=Wt(),f=function qa(i){const t=Et.lFrame,e=t.bindingIndex;return t.bindingIndex=t.bindingIndex+i,e}(2);u.firstUpdatePass&&function lS(i,t,e,a){const l=i.data;if(null===l[e+1]){const u=l[jr()],f=function cS(i,t){return t>=i.expandoStartIndex}(i,e);(function KR(i,t){return 0!=(i.flags&(t?8:16))})(u,a)&&null===t&&!f&&(t=!1),t=function jR(i,t,e,a){const l=function Tp(i){const t=Et.lFrame.currentDirectiveIndex;return-1===t?null:i[t]}(i);let u=a?t.residualClasses:t.residualStyles;if(null===l)0===(a?t.classBindings:t.styleBindings)&&(e=tf(e=xg(null,i,t,e,a),t.attrs,a),u=null);else{const f=t.directiveStylingLast;if(-1===f||i[f]!==l)if(e=xg(l,i,t,e,a),null===u){let y=function HR(i,t,e){const a=e?t.classBindings:t.styleBindings;if(0!==so(a))return i[Ea(a)]}(i,t,a);void 0!==y&&Array.isArray(y)&&(y=xg(null,i,t,y[1],a),y=tf(y,t.attrs,a),function GR(i,t,e,a){i[Ea(e?t.classBindings:t.styleBindings)]=a}(i,t,a,y))}else u=function rk(i,t,e){let a;const l=t.directiveEnd;for(let u=1+t.directiveStylingLast;u<l;u++)a=tf(a,i[u].hostAttrs,e);return tf(a,t.attrs,e)}(i,t,a)}return void 0!==u&&(a?t.residualClasses=u:t.residualStyles=u),e}(l,u,t,a),function iS(i,t,e,a,l,u){let f=u?t.classBindings:t.styleBindings,E=Ea(f),y=so(f);i[a]=e;let R,T=!1;if(Array.isArray(e)?(R=e[1],(null===R||Du(e,R)>0)&&(T=!0)):R=e,l)if(0!==y){const H=Ea(i[E+1]);i[a+1]=Ng(H,E),0!==H&&(i[H+1]=ad(i[H+1],a)),i[E+1]=function QM(i,t){return 131071&i|t<<17}(i[E+1],a)}else i[a+1]=Ng(E,0),0!==E&&(i[E+1]=ad(i[E+1],a)),E=a;else i[a+1]=Ng(y,0),0===E?E=a:i[y+1]=ad(i[y+1],a),y=a;T&&(i[a+1]=Xu(i[a+1])),xR(i,R,a,!0),xR(i,R,a,!1),function ek(i,t,e,a,l){const u=l?i.residualClasses:i.residualStyles;null!=u&&"string"==typeof t&&Du(u,t)>=0&&(e[a+1]=nS(e[a+1]))}(t,R,i,a,u),f=Ng(E,y),u?t.classBindings=f:t.styleBindings=f}(l,u,t,e,f,a)}}(u,i,f,a),t!==vt&&br(l,f,t)&&function uS(i,t,e,a,l,u,f,E){if(!(3&t.type))return;const y=i.data,T=y[E+1],R=function ZM(i){return 1==(1&i)}(T)?zR(y,t,e,l,so(T),f):void 0;nf(R)||(nf(u)||function kR(i){return 2==(2&i)}(T)&&(u=zR(y,null,e,l,E,f)),function qw(i,t,e,a,l){if(t)l?i.addClass(e,a):i.removeClass(e,a);else{let u=-1===a.indexOf("-")?void 0:Wi.DashCase;null==l?i.removeStyle(e,a,u):("string"==typeof l&&l.endsWith("!important")&&(l=l.slice(0,-10),u|=Wi.Important),i.setStyle(e,a,l,u))}}(a,f,a_(jr(),e),l,u))}(u,u.data[jr()],l,l[Pt],i,l[f+1]=function ok(i,t){return null==i||""===i||("string"==typeof t?i+=t:"object"==typeof i&&(i=Mn(Pc(i)))),i}(t,e),a,f)}function xg(i,t,e,a,l){let u=null;const f=e.directiveEnd;let E=e.directiveStylingLast;for(-1===E?E=e.directiveStart:E++;E<f&&(u=t[E],a=tf(a,u.hostAttrs,l),u!==i);)E++;return null!==i&&(e.directiveStylingLast=E),a}function tf(i,t,e){const a=e?1:2;let l=-1;if(null!==t)for(let u=0;u<t.length;u++){const f=t[u];"number"==typeof f?l=f:l===a&&(Array.isArray(i)||(i=void 0===i?[]:["",i]),no(i,f,!!e||t[++u]))}return void 0===i?null:i}function zR(i,t,e,a,l,u){const f=null===t;let E;for(;l>0;){const y=i[l],T=Array.isArray(y),R=T?y[1]:y,L=null===R;let H=e[l+1];H===vt&&(H=L?an:void 0);let W=L?Au(H,a):R===a?H:void 0;if(T&&!nf(W)&&(W=Au(y,a)),nf(W)&&(E=W,f))return E;const q=i[l+1];l=f?Ea(q):so(q)}if(null!==t){let y=u?t.residualClasses:t.residualStyles;null!=y&&(E=Au(y,a))}return E}function nf(i){return void 0!==i}function Ki(i,t=""){const e=Ee(),a=Wt(),l=i+$n,u=a.firstCreatePass?Xl(a,l,1,t,null):a.data[l],f=e[l]=function Lu(i,t){return i.createText(t)}(e[Pt],t);z_(a,e,f,u),la(u,!1)}function dd(i){return rf("",i,""),dd}function rf(i,t,e){const a=Ee(),l=function _a(i,t,e,a){return br(i,Nl(),e)?t+He(e)+a:vt}(a,i,t,e);return l!==vt&&function Qa(i,t,e){const a=a_(t,i);!function Bw(i,t,e){i.setValue(t,e)}(i[Pt],a,e)}(a,jr(),l),rf}function ud(i,t,e){const a=Ee();return br(a,Nl(),t)&&Po(Wt(),ai(),a,i,t,a[Pt],e,!0),ud}const Vc="en-US";let _S=Vc;function oh(i,t,e,a,l){if(i=Qe(i),Array.isArray(i))for(let u=0;u<i.length;u++)oh(i[u],t,e,a,l);else{const u=Wt(),f=Ee();let E=ua(i)?i:Qe(i.provide),y=CI(i);const T=Oi(),R=1048575&T.providerIndexes,L=T.directiveStart,H=T.providerIndexes>>20;if(ua(i)||!i.multi){const W=new kl(y,l,ie),q=bn(E,t,l?R:R+H,L);-1===q?(Ip(__(T,f),u,E),Wn(u,i,t.length),t.push(E),T.directiveStart++,T.directiveEnd++,l&&(T.providerIndexes+=1048576),e.push(W),f.push(W)):(e[q]=W,f[q]=W)}else{const W=bn(E,t,R+H,L),q=bn(E,t,R,R+H),ce=q>=0&&e[q];if(l&&!ce||!l&&!(W>=0&&e[W])){Ip(__(T,f),u,E);const Te=function Nk(i,t,e,a,l){const u=new kl(i,e,ie);return u.multi=[],u.index=t,u.componentProviders=0,md(u,l,a&&!e),u}(l?Ws:jg,e.length,l,a,y);!l&&ce&&(e[q].providerFactory=Te),Wn(u,i,t.length,0),t.push(E),T.directiveStart++,T.directiveEnd++,l&&(T.providerIndexes+=1048576),e.push(Te),f.push(Te)}else Wn(u,i,W>-1?W:q,md(e[l?q:W],y,!l&&a));!l&&a&&ce&&e[q].componentProviders++}}}function Wn(i,t,e,a){const l=ua(t),u=function vI(i){return!!i.useClass}(t);if(l||u){const y=(u?Qe(t.useClass):t).prototype.ngOnDestroy;if(y){const T=i.destroyHooks||(i.destroyHooks=[]);if(!l&&t.multi){const R=T.indexOf(e);-1===R?T.push(e,[a,y]):T[R+1].push(a,y)}else T.push(e,y)}}}function md(i,t,e){return e&&i.componentProviders++,i.multi.push(t)-1}function bn(i,t,e,a){for(let l=e;l<a;l++)if(t[l]===i)return l;return-1}function jg(i,t,e,a){return DS(this.multi,[])}function Ws(i,t,e,a){const l=this.multi;let u;if(this.providerFactory){const f=this.providerFactory.componentProviders,E=Ya(e,e[Fe],this.providerFactory.index,a);u=E.slice(0,f),DS(l,u);for(let y=f;y<E.length;y++)u.push(E[y])}else u=[],DS(l,u);return u}function DS(i,t){for(let e=0;e<i.length;e++)t.push((0,i[e])());return t}function An(i,t=[]){return e=>{e.providersResolver=(a,l)=>function Ok(i,t,e){const a=Wt();if(a.firstCreatePass){const l=Vr(i);oh(e,a.data,a.blueprint,l,!0),oh(t,a.data,a.blueprint,l,!1)}}(a,l?l(i):i,t)}}class sh{}class wA{}class RA extends sh{constructor(t,e){super(),this._parent=e,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new fR(this);const a=Fr(t);this._bootstrapComponents=ro(a.bootstrap),this._r3Injector=GI(t,e,[{provide:sh,useValue:this},{provide:Wl,useValue:this.componentFactoryResolver}],Mn(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class OS extends wA{constructor(t){super(),this.moduleType=t}create(t){return new RA(this.moduleType,t)}}class Pk extends sh{constructor(t,e,a){super(),this.componentFactoryResolver=new fR(this),this.instance=null;const l=new bI([...t,{provide:sh,useValue:this},{provide:Wl,useValue:this.componentFactoryResolver}],e||zp(),a,new Set(["environment"]));this.injector=l,l.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function ah(i,t,e=null){return new Pk(i,t,e).injector}let _d=(()=>{class i{constructor(e){this._injector=e,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e.id)){const a=gI(0,e.type),l=a.length>0?ah([a],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e.id,l)}return this.cachedInjectors.get(e.id)}ngOnDestroy(){try{for(const e of this.cachedInjectors.values())null!==e&&e.destroy()}finally{this.cachedInjectors.clear()}}}return i.\u0275prov=Oe({token:i,providedIn:"environment",factory:()=>new i(pe(ha))}),i})();function ff(i){i.getStandaloneInjector=t=>t.get(_d).getOrCreateStandaloneInjector(i)}function rr(i,t,e,a,l,u,f){return function Ed(i,t,e,a,l,u,f,E,y){const T=t+e;return function ko(i,t,e,a,l,u){const f=Za(i,t,e,a);return Za(i,t+2,l,u)||f}(i,T,l,u,f,E)?os(i,T+4,y?a.call(y,l,u,f,E):a(l,u,f,E)):lh(i,T+4)}(Ee(),Br(),i,t,e,a,l,u,f)}function lh(i,t){const e=i[t];return e===vt?void 0:e}function gf(i,t){const e=Wt();let a;const l=i+$n;e.firstCreatePass?(a=function MA(i,t){if(t)for(let e=t.length-1;e>=0;e--){const a=t[e];if(i===a.name)return a}}(t,e.pipeRegistry),e.data[l]=a,a.onDestroy&&(e.destroyHooks??(e.destroyHooks=[])).push(l,a.onDestroy)):a=e.data[l];const u=a.factory||(a.factory=Al(a.type)),f=wo(ie);try{const E=m_(!1),y=u();return m_(E),function $M(i,t,e,a){e>=i.data.length&&(i.data[e]=null,i.blueprint[e]=null),t[e]=a}(e,Ee(),l,y),y}finally{wo(f)}}function dh(i,t,e){const a=i+$n,l=Ee(),u=yu(l,a);return function Ef(i,t){return i[Fe].data[t].pure}(l,a)?function US(i,t,e,a,l,u){const f=t+e;return br(i,f,l)?os(i,f+1,u?a.call(u,l):a(l)):lh(i,f+1)}(l,Br(),t,u.transform,e,u):u.transform(e)}function qg(i){return t=>{setTimeout(i,void 0,t)}}const rn=class VS extends Xt{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,e,a){let l=t,u=e||(()=>null),f=a;if(t&&"object"==typeof t){const y=t;l=y.next?.bind(y),u=y.error?.bind(y),f=y.complete?.bind(y)}this.__isAsync&&(u=qg(u),l&&(l=qg(l)),f&&(f=qg(f)));const E=super.subscribe({next:l,error:u,complete:f});return t instanceof mn&&t.add(E),E}};function FA(){return this._results[Symbol.iterator]()}class Yg{get changes(){return this._changes||(this._changes=new rn)}constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=Yg.prototype;e[Symbol.iterator]||(e[Symbol.iterator]=FA)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){const a=this;a.dirty=!1;const l=function es(i){return i.flat(Number.POSITIVE_INFINITY)}(t);(this._changesDetected=!function Sw(i,t,e){if(i.length!==t.length)return!1;for(let a=0;a<i.length;a++){let l=i[a],u=t[a];if(e&&(l=e(l),u=e(u)),u!==l)return!1}return!0}(a._results,l,e))&&(a._results=l,a.length=l.length,a.last=l[this.length-1],a.first=l[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let ba=(()=>{class i{}return i.__NG_ELEMENT_ID__=BS,i})();const UA=ba,VA=class extends UA{constructor(t,e,a){super(),this._declarationLView=t,this._declarationTContainer=e,this.elementRef=a}createEmbeddedView(t,e){const a=this._declarationTContainer.tView,l=ug(this._declarationLView,a,t,16,null,a.declTNode,null,null,null,null,e||null);l[yp]=this._declarationLView[this._declarationTContainer.index];const f=this._declarationLView[aa];return null!==f&&(l[aa]=f.createEmbeddedView(a)),Nb(a,l,t),new $p(l)}};function BS(){return vf(Oi(),Ee())}function vf(i,t){return 4&i.type?new VA(t,i,zl(i,t)):null}let xo=(()=>{class i{}return i.__NG_ELEMENT_ID__=BA,i})();function BA(){return HA(Oi(),Ee())}const Hk=xo,jA=class extends Hk{constructor(t,e,a){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=a}get element(){return zl(this._hostTNode,this._hostLView)}get injector(){return new Cu(this._hostTNode,this._hostLView)}get parentInjector(){const t=My(this._hostTNode,this._hostLView);if(lw(t)){const e=f_(t,this._hostLView),a=p_(t);return new Cu(e[Fe].data[a+8],e)}return new Cu(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const e=jS(this._lContainer);return null!==e&&e[t]||null}get length(){return this._lContainer.length-Ur}createEmbeddedView(t,e,a){let l,u;"number"==typeof a?l=a:null!=a&&(l=a.index,u=a.injector);const f=t.createEmbeddedView(e||{},u);return this.insert(f,l),f}createComponent(t,e,a,l,u){const f=t&&!function Iu(i){return"function"==typeof i}(t);let E;if(f)E=e;else{const L=e||{};E=L.index,a=L.injector,l=L.projectableNodes,u=L.environmentInjector||L.ngModuleRef}const y=f?t:new ma(yn(t)),T=a||this.parentInjector;if(!u&&null==y.ngModule){const H=(f?T:this.parentInjector).get(ha,null);H&&(u=H)}const R=y.create(T,l,void 0,u);return this.insert(R.hostView,E),R}insert(t,e){const a=t._lView,l=a[Fe];if(function IP(i){return Xo(i[pi])}(a)){const R=this.indexOf(t);if(-1!==R)this.detach(R);else{const L=a[pi],H=new jA(L,L[vr],L[pi]);H.detach(H.indexOf(t))}}const u=this._adjustIndex(e),f=this._lContainer;!function $a(i,t,e,a){const l=Ur+a,u=e.length;a>0&&(e[l-1][Ls]=t),a<u-Ur?(t[Ls]=e[l],Cw(e,Ur+a,t)):(e.push(t),t[Ls]=null),t[pi]=e;const f=t[yp];null!==f&&e!==f&&function Vp(i,t){const e=i[Eu];t[yr]!==t[pi][pi][yr]&&(i[x0]=!0),null===e?i[Eu]=[t]:e.push(t)}(f,t);const E=t[aa];null!==E&&E.insertView(i),t[Dt]|=64}(l,a,f,u);const E=ob(u,f),y=a[Pt],T=G_(y,f[r_]);return null!==T&&function jw(i,t,e,a,l,u){a[sa]=l,a[vr]=t,Fu(i,a,e,1,l,u)}(l,f[vr],y,a,T,E),t.attachToViewContainerRef(),Cw(HS(f),u,t),t}move(t,e){return this.insert(t,e)}indexOf(t){const e=jS(this._lContainer);return null!==e?e.indexOf(t):-1}remove(t){const e=this._adjustIndex(t,-1),a=Bp(this._lContainer,e);a&&(y_(HS(this._lContainer),e),j_(a[Fe],a))}detach(t){const e=this._adjustIndex(t,-1),a=Bp(this._lContainer,e);return a&&null!=y_(HS(this._lContainer),e)?new $p(a):null}_adjustIndex(t,e=0){return t??this.length+e}};function jS(i){return i[wc]}function HS(i){return i[wc]||(i[wc]=[])}function HA(i,t){let e;const a=t[i.index];if(Xo(a))e=a;else{let l;if(8&i.type)l=ji(a);else{const u=t[Pt];l=u.createComment("");const f=Do(i,t);Nc(u,G_(u,f),l,function g1(i,t){return i.nextSibling(t)}(u,f),!1)}t[i.index]=e=Bb(a,t,l,i),kc(t,e)}return new jA(e,i,t)}class uh{constructor(t){this.queryList=t,this.matches=null}clone(){return new uh(this.queryList)}setDirty(){this.queryList.setDirty()}}class GS{constructor(t=[]){this.queries=t}createEmbeddedView(t){const e=t.queries;if(null!==e){const a=null!==t.contentQueries?t.contentQueries[0]:e.length,l=[];for(let u=0;u<a;u++){const f=e.getByIndex(u);l.push(this.queries[f.indexInDeclarationView].clone())}return new GS(l)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)null!==Jg(t,e).matches&&this.queries[e].setDirty()}}class GA{constructor(t,e,a=null){this.predicate=t,this.flags=e,this.read=a}}class Mi{constructor(t=[]){this.queries=t}elementStart(t,e){for(let a=0;a<this.queries.length;a++)this.queries[a].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let a=0;a<this.length;a++){const l=null!==e?e.length:0,u=this.getByIndex(a).embeddedTView(t,l);u&&(u.indexInDeclarationView=a,null!==e?e.push(u):e=[u])}return null!==e?new Mi(e):null}template(t,e){for(let a=0;a<this.queries.length;a++)this.queries[a].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class $g{constructor(t,e=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new $g(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let a=t.parent;for(;null!==a&&8&a.type&&a.index!==e;)a=a.parent;return e===(null!==a?a.index:-1)}return this._appliesToNextNode}matchTNode(t,e){const a=this.metadata.predicate;if(Array.isArray(a))for(let l=0;l<a.length;l++){const u=a[l];this.matchTNodeWithReadOption(t,e,WA(e,u)),this.matchTNodeWithReadOption(t,e,Rp(e,t,u,!1,!1))}else a===ba?4&e.type&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,Rp(e,t,a,!1,!1))}matchTNodeWithReadOption(t,e,a){if(null!==a){const l=this.metadata.read;if(null!==l)if(l===cn||l===xo||l===ba&&4&e.type)this.addMatch(e.index,-2);else{const u=Rp(e,t,l,!1,!1);null!==u&&this.addMatch(e.index,u)}else this.addMatch(e.index,a)}}addMatch(t,e){null===this.matches?this.matches=[t,e]:this.matches.push(t,e)}}function WA(i,t){const e=i.localNames;if(null!==e)for(let a=0;a<e.length;a+=2)if(e[a]===t)return e[a+1];return null}function Wk(i,t,e,a){return-1===e?function Gk(i,t){return 11&i.type?zl(i,t):4&i.type?vf(i,t):null}(t,i):-2===e?function zk(i,t,e){return e===cn?zl(t,i):e===ba?vf(t,i):e===xo?HA(t,i):void 0}(i,t,a):Ya(i,i[Fe],e,t)}function WS(i,t,e,a){const l=t[aa].queries[a];if(null===l.matches){const u=i.data,f=e.matches,E=[];for(let y=0;y<f.length;y+=2){const T=f[y];E.push(T<0?null:Wk(t,u[T],f[y+1],e.metadata.read))}l.matches=E}return l.matches}function Xg(i,t,e,a){const l=i.queries.getByIndex(e),u=l.matches;if(null!==u){const f=WS(i,t,l,e);for(let E=0;E<u.length;E+=2){const y=u[E];if(y>0)a.push(f[E/2]);else{const T=u[E+1],R=t[-y];for(let L=Ur;L<R.length;L++){const H=R[L];H[yp]===H[pi]&&Xg(H[Fe],H,T,a)}if(null!==R[Eu]){const L=R[Eu];for(let H=0;H<L.length;H++){const W=L[H];Xg(W[Fe],W,T,a)}}}}}return a}function _i(i){const t=Ee(),e=Wt(),a=d_();Re(a+1);const l=Jg(e,a);if(i.dirty&&function Ol(i){return 4==(4&i[Dt])}(t)===(2==(2&l.metadata.flags))){if(null===l.matches)i.reset([]);else{const u=l.crossesNgTemplate?Xg(e,t,a,[]):WS(e,t,l,a);i.reset(u,K1),i.notifyOnChanges()}return!0}return!1}function ls(i,t,e){const a=Wt();a.firstCreatePass&&(zS(a,new GA(i,t,e),-1),2==(2&t)&&(a.staticViewQueries=!0)),zA(a,Ee(),t)}function Sa(i,t,e,a){const l=Wt();if(l.firstCreatePass){const u=Oi();zS(l,new GA(t,e,a),u.index),function KA(i,t){const e=i.contentQueries||(i.contentQueries=[]);t!==(e.length?e[e.length-1]:-1)&&e.push(i.queries.length-1,t)}(l,i),2==(2&e)&&(l.staticContentQueries=!0)}zA(l,Ee(),e)}function bi(){return function Kk(i,t){return i[aa].queries[t].queryList}(Ee(),d_())}function zA(i,t,e){const a=new Yg(4==(4&e));rR(i,t,a,a.destroy),null===t[aa]&&(t[aa]=new GS),t[aa].queries.push(new uh(a))}function zS(i,t,e){null===i.queries&&(i.queries=new Mi),i.queries.track(new $g(t,e))}function Jg(i,t){return i.queries.getByIndex(t)}function KS(i,t){return vf(i,t)}function Sd(...i){}const w=new Pe("Application Initializer");let Tf=(()=>{class i{constructor(e){this.appInits=e,this.resolve=Sd,this.reject=Sd,this.initialized=!1,this.done=!1,this.donePromise=new Promise((a,l)=>{this.resolve=a,this.reject=l})}runInitializers(){if(this.initialized)return;const e=[],a=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let l=0;l<this.appInits.length;l++){const u=this.appInits[l]();if(ef(u))e.push(u);else if(ec(u)){const f=new Promise((E,y)=>{u.subscribe({complete:E,error:y})});e.push(f)}}Promise.all(e).then(()=>{a()}).catch(l=>{this.reject(l)}),0===e.length&&a(),this.initialized=!0}}return i.\u0275fac=function(e){return new(e||i)(pe(w,8))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const Cd=new Pe("AppId",{providedIn:"root",factory:function sD(){return`${Bn()}${Bn()}${Bn()}`}});function Bn(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const zt=new Pe("Platform Initializer"),aE=new Pe("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Ca=new Pe("AnimationModuleType");let Ke=(()=>{class i{log(e){console.log(e)}warn(e){console.warn(e)}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();const Ie=new Pe("LocaleId",{providedIn:"root",factory:()=>Ct(Ie,rt.Optional|rt.SkipSelf)||function wf(){return typeof $localize<"u"&&$localize.locale||Vc}()});class Wc{constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}}let zc=(()=>{class i{compileModuleSync(e){return new OS(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){const a=this.compileModuleSync(e),u=ro(Fr(e).declarations).reduce((f,E)=>{const y=yn(E);return y&&f.push(new ma(y)),f},[]);return new Wc(a,u)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const qe=(()=>Promise.resolve(0))();function le(i){typeof Zone>"u"?qe.then(()=>{i&&i.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",i)}class me{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:a=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new rn(!1),this.onMicrotaskEmpty=new rn(!1),this.onStable=new rn(!1),this.onError=new rn(!1),typeof Zone>"u")throw new he(908,!1);Zone.assertZonePatched();const l=this;l._nesting=0,l._outer=l._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(l._inner=l._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(l._inner=l._inner.fork(Zone.longStackTraceZoneSpec)),l.shouldCoalesceEventChangeDetection=!a&&e,l.shouldCoalesceRunChangeDetection=a,l.lastRequestAnimationFrameId=-1,l.nativeRequestAnimationFrame=function be(){let i=Hn.requestAnimationFrame,t=Hn.cancelAnimationFrame;if(typeof Zone<"u"&&i&&t){const e=i[Zone.__symbol__("OriginalDelegate")];e&&(i=e);const a=t[Zone.__symbol__("OriginalDelegate")];a&&(t=a)}return{nativeRequestAnimationFrame:i,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function zn(i){const t=()=>{!function Me(i){i.isCheckStableRunning||-1!==i.lastRequestAnimationFrameId||(i.lastRequestAnimationFrameId=i.nativeRequestAnimationFrame.call(Hn,()=>{i.fakeTopEventTask||(i.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{i.lastRequestAnimationFrameId=-1,Ta(i),i.isCheckStableRunning=!0,Kc(i),i.isCheckStableRunning=!1},void 0,()=>{},()=>{})),i.fakeTopEventTask.invoke()}),Ta(i))}(i)};i._inner=i._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,a,l,u,f,E)=>{try{return cD(i),e.invokeTask(l,u,f,E)}finally{(i.shouldCoalesceEventChangeDetection&&"eventTask"===u.type||i.shouldCoalesceRunChangeDetection)&&t(),lD(i)}},onInvoke:(e,a,l,u,f,E,y)=>{try{return cD(i),e.invoke(l,u,f,E,y)}finally{i.shouldCoalesceRunChangeDetection&&t(),lD(i)}},onHasTask:(e,a,l,u)=>{e.hasTask(l,u),a===l&&("microTask"==u.change?(i._hasPendingMicrotasks=u.microTask,Ta(i),Kc(i)):"macroTask"==u.change&&(i.hasPendingMacrotasks=u.macroTask))},onHandleError:(e,a,l,u)=>(e.handleError(l,u),i.runOutsideAngular(()=>i.onError.emit(u)),!1)})}(l)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!me.isInAngularZone())throw new he(909,!1)}static assertNotInAngularZone(){if(me.isInAngularZone())throw new he(909,!1)}run(t,e,a){return this._inner.run(t,e,a)}runTask(t,e,a,l){const u=this._inner,f=u.scheduleEventTask("NgZoneEvent: "+l,t,aD,Sd,Sd);try{return u.runTask(f,e,a)}finally{u.cancelTask(f)}}runGuarded(t,e,a){return this._inner.runGuarded(t,e,a)}runOutsideAngular(t){return this._outer.run(t)}}const aD={};function Kc(i){if(0==i._nesting&&!i.hasPendingMicrotasks&&!i.isStable)try{i._nesting++,i.onMicrotaskEmpty.emit(null)}finally{if(i._nesting--,!i.hasPendingMicrotasks)try{i.runOutsideAngular(()=>i.onStable.emit(null))}finally{i.isStable=!0}}}function Ta(i){i.hasPendingMicrotasks=!!(i._hasPendingMicrotasks||(i.shouldCoalesceEventChangeDetection||i.shouldCoalesceRunChangeDetection)&&-1!==i.lastRequestAnimationFrameId)}function cD(i){i._nesting++,i.isStable&&(i.isStable=!1,i.onUnstable.emit(null))}function lD(i){i._nesting--,Kc(i)}class Zk{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new rn,this.onMicrotaskEmpty=new rn,this.onStable=new rn,this.onError=new rn}run(t,e,a){return t.apply(e,a)}runGuarded(t,e,a){return t.apply(e,a)}runOutsideAngular(t){return t()}runTask(t,e,a,l){return t.apply(e,a)}}const dD=new Pe(""),cE=new Pe("");let ee,If=(()=>{class i{constructor(e,a,l){this._ngZone=e,this.registry=a,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,ee||(function wa(i){ee=i}(l),l.addToWindow(a)),this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{me.assertNotInAngularZone(),le(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())le(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(a=>!a.updateCb||!a.updateCb(e)||(clearTimeout(a.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,a,l){let u=-1;a&&a>0&&(u=setTimeout(()=>{this._callbacks=this._callbacks.filter(f=>f.timeoutId!==u),e(this._didWork,this.getPendingTasks())},a)),this._callbacks.push({doneCb:e,timeoutId:u,updateCb:l})}whenStable(e,a,l){if(l&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,a,l),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(e){this.registry.registerApplication(e,this)}unregisterApplication(e){this.registry.unregisterApplication(e)}findProviders(e,a,l){return[]}}return i.\u0275fac=function(e){return new(e||i)(pe(me),pe(oC),pe(cE))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac}),i})(),oC=(()=>{class i{constructor(){this._applications=new Map}registerApplication(e,a){this._applications.set(e,a)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,a=!0){return ee?.findTestabilityInTree(this,e,a)??null}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();const O=!1;let G=null;const lE=new Pe("AllowMultipleToken"),Rf=new Pe("PlatformDestroyListeners"),uD=new Pe("appBootstrapListener");class pD{constructor(t,e){this.name=t,this.token=e}}function Si(i,t,e=[]){const a=`Platform: ${t}`,l=new Pe(a);return(u=[])=>{let f=gt();if(!f||f.injector.get(lE,!1)){const E=[...e,...u,{provide:l,useValue:!0}];i?i(E):function hs(i){if(G&&!G.get(lE,!1))throw new he(400,!1);G=i;const t=i.get(on);(function Sn(i){const t=i.get(zt,null);t&&t.forEach(e=>e())})(i)}(function Xi(i=[],t){return No.create({name:t,providers:[{provide:gb,useValue:"platform"},{provide:Rf,useValue:new Set([()=>G=null])},...i]})}(E,a))}return function zs(i){const t=gt();if(!t)throw new he(401,!1);return t}()}}function gt(){return G?.get(on)??null}let on=(()=>{class i{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,a){const l=function Fn(i,t){let e;return e="noop"===i?new Zk:("zone.js"===i?void 0:i)||new me(t),e}(a?.ngZone,function qc(i){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!i||!i.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!i||!i.ngZoneRunCoalescing)||!1}}(a)),u=[{provide:me,useValue:l}];return l.run(()=>{const f=No.create({providers:u,parent:this.injector,name:e.moduleType.name}),E=e.create(f),y=E.injector.get(Yl,null);if(!y)throw new he(402,!1);return l.runOutsideAngular(()=>{const T=l.onError.subscribe({next:R=>{y.handleError(R)}});E.onDestroy(()=>{Df(this._modules,E),T.unsubscribe()})}),function Af(i,t,e){try{const a=e();return ef(a)?a.catch(l=>{throw t.runOutsideAngular(()=>i.handleError(l)),l}):a}catch(a){throw t.runOutsideAngular(()=>i.handleError(a)),a}}(y,l,()=>{const T=E.injector.get(Tf);return T.runInitializers(),T.donePromise.then(()=>(function sf(i){$o(i,"Expected localeId to be defined"),"string"==typeof i&&(_S=i.toLowerCase().replace(/_/g,"-"))}(E.injector.get(Ie,Vc)||Vc),this._moduleDoBootstrap(E),E))})})}bootstrapModule(e,a=[]){const l=ot({},a);return function sC(i,t,e){const a=new OS(e);return Promise.resolve(a)}(0,0,e).then(u=>this.bootstrapModuleFactory(u,l))}_moduleDoBootstrap(e){const a=e.injector.get(Yc);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(l=>a.bootstrap(l));else{if(!e.instance.ngDoBootstrap)throw new he(-403,!1);e.instance.ngDoBootstrap(a)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new he(404,!1);this._modules.slice().forEach(a=>a.destroy()),this._destroyListeners.forEach(a=>a());const e=this._injector.get(Rf,null);e&&(e.forEach(a=>a()),e.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return i.\u0275fac=function(e){return new(e||i)(pe(No))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();function ot(i,t){return Array.isArray(t)?t.reduce(ot,i):{...i,...t}}let Yc=(()=>{class i{get destroyed(){return this._destroyed}get injector(){return this._injector}constructor(e,a,l){this._zone=e,this._injector=a,this._exceptionHandler=l,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const u=new _n(E=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{E.next(this._stable),E.complete()})}),f=new _n(E=>{let y;this._zone.runOutsideAngular(()=>{y=this._zone.onStable.subscribe(()=>{me.assertNotInAngularZone(),le(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,E.next(!0))})})});const T=this._zone.onUnstable.subscribe(()=>{me.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{E.next(!1)}))});return()=>{y.unsubscribe(),T.unsubscribe()}});this.isStable=ey(u,f.pipe(function w0(){return i=>qn()(function Wm(i,t){return function(a){let l;if(l="function"==typeof i?i:function(){return i},"function"==typeof t)return a.lift(new er(l,t));const u=Object.create(a,ty);return u.source=a,u.subjectFactory=l,u}}(sP)(i))}()))}bootstrap(e,a){const l=e instanceof rg;if(!this._injector.get(Tf).done){!l&&function xs(i){const t=yn(i)||Er(i)||eo(i);return null!==t&&t.standalone}(e);throw new he(405,O)}let f;f=l?e:this._injector.get(Wl).resolveComponentFactory(e),this.componentTypes.push(f.componentType);const E=function ex(i){return i.isBoundToModule}(f)?void 0:this._injector.get(sh),T=f.create(No.NULL,[],a||f.selector,E),R=T.location.nativeElement,L=T.injector.get(dD,null);return L?.registerApplication(R),T.onDestroy(()=>{this.detachView(T.hostView),Df(this.components,T),L?.unregisterApplication(R)}),this._loadComponent(T),T}tick(){if(this._runningTick)throw new he(101,!1);try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const a=e;this._views.push(a),a.attachToAppRef(this)}detachView(e){const a=e;Df(this._views,a),a.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e);const a=this._injector.get(uD,[]);a.push(...this._bootstrapListeners),a.forEach(l=>l(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>Df(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new he(406,!1);const e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return i.\u0275fac=function(e){return new(e||i)(pe(me),pe(ha),pe(Yl))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function Df(i,t){const e=i.indexOf(t);e>-1&&i.splice(e,1)}let te=(()=>{class i{}return i.__NG_ELEMENT_ID__=at,i})();function at(i){return function Ae(i,t,e){if(Sp(i)&&!e){const a=to(i.index,t);return new $p(a,a)}return 47&i.type?new $p(t[yr],t):null}(Oi(),Ee(),16==(16&i))}class cC{constructor(){}supports(t){return Cg(t)}create(t){return new ox(t)}}const gD=(i,t)=>t;class ox{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||gD}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,a=this._removalsHead,l=0,u=null;for(;e||a;){const f=!a||e&&e.currentIndex<vD(a,l,u)?e:a,E=vD(f,l,u),y=f.currentIndex;if(f===a)l--,a=a._nextRemoved;else if(e=e._next,null==f.previousIndex)l++;else{u||(u=[]);const T=E-l,R=y-l;if(T!=R){for(let H=0;H<T;H++){const W=H<u.length?u[H]:u[H]=0,q=W+H;R<=q&&q<T&&(u[H]=W+1)}u[f.previousIndex]=R-T}}E!==y&&t(f,E,y)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}diff(t){if(null==t&&(t=[]),!Cg(t))throw new he(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let l,u,f,e=this._itHead,a=!1;if(Array.isArray(t)){this.length=t.length;for(let E=0;E<this.length;E++)u=t[E],f=this._trackByFn(E,u),null!==e&&Object.is(e.trackById,f)?(a&&(e=this._verifyReinsertion(e,u,f,E)),Object.is(e.item,u)||this._addIdentityChange(e,u)):(e=this._mismatch(e,u,f,E),a=!0),e=e._next}else l=0,function KM(i,t){if(Array.isArray(i))for(let e=0;e<i.length;e++)t(i[e]);else{const e=i[Symbol.iterator]();let a;for(;!(a=e.next()).done;)t(a.value)}}(t,E=>{f=this._trackByFn(l,E),null!==e&&Object.is(e.trackById,f)?(a&&(e=this._verifyReinsertion(e,E,f,l)),Object.is(e.item,E)||this._addIdentityChange(e,E)):(e=this._mismatch(e,E,f,l),a=!0),e=e._next,l++}),this.length=l;return this._truncate(e),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,a,l){let u;return null===t?u=this._itTail:(u=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,u,l)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(a,l))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,u,l)):t=this._addAfter(new sx(e,a),u,l),t}_verifyReinsertion(t,e,a,l){let u=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null);return null!==u?t=this._reinsertAfter(u,t._prev,l):t.currentIndex!=l&&(t.currentIndex=l,this._addToMoves(t,l)),t}_truncate(t){for(;null!==t;){const e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,a){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const l=t._prevRemoved,u=t._nextRemoved;return null===l?this._removalsHead=u:l._nextRemoved=u,null===u?this._removalsTail=l:u._prevRemoved=l,this._insertAfter(t,e,a),this._addToMoves(t,a),t}_moveAfter(t,e,a){return this._unlink(t),this._insertAfter(t,e,a),this._addToMoves(t,a),t}_addAfter(t,e,a){return this._insertAfter(t,e,a),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,a){const l=null===e?this._itHead:e._next;return t._next=l,t._prev=e,null===l?this._itTail=t:l._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new ED),this._linkedRecords.put(t),t.currentIndex=a,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const e=t._prev,a=t._next;return null===e?this._itHead=a:e._next=a,null===a?this._itTail=e:a._prev=e,t}_addToMoves(t,e){return t.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new ED),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class sx{constructor(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class ax{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let a;for(a=this._head;null!==a;a=a._nextDup)if((null===e||e<=a.currentIndex)&&Object.is(a.trackById,t))return a;return null}remove(t){const e=t._prevDup,a=t._nextDup;return null===e?this._head=a:e._nextDup=a,null===a?this._tail=e:a._prevDup=e,null===this._head}}class ED{constructor(){this.map=new Map}put(t){const e=t.trackById;let a=this.map.get(e);a||(a=new ax,this.map.set(e,a)),a.add(t)}get(t,e){const l=this.map.get(t);return l?l.get(t,e):null}remove(t){const e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function vD(i,t,e){const a=i.previousIndex;if(null===a)return a;let l=0;return e&&a<e.length&&(l=e[a]),a+t+l}class yD{constructor(){}supports(t){return t instanceof Map||Yb(t)}create(){return new bD}}class bD{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let e;for(e=this._mapHead;null!==e;e=e._next)t(e)}forEachPreviousItem(t){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)}forEachChangedItem(t){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}diff(t){if(t){if(!(t instanceof Map||Yb(t)))throw new he(900,!1)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(t,(a,l)=>{if(e&&e.key===l)this._maybeAddToChanges(e,a),this._appendAfter=e,e=e._next;else{const u=this._getOrCreateRecordForKey(l,a);e=this._insertBeforeOrAppend(e,u)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let a=e;null!==a;a=a._nextRemoved)a===this._mapHead&&(this._mapHead=null),this._records.delete(a.key),a._nextRemoved=a._next,a.previousValue=a.currentValue,a.currentValue=null,a._prev=null,a._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){const a=t._prev;return e._next=t,e._prev=a,t._prev=e,a&&(a._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){const l=this._records.get(t);this._maybeAddToChanges(l,e);const u=l._prev,f=l._next;return u&&(u._next=f),f&&(f._prev=u),l._next=null,l._prev=null,l}const a=new SD(t);return this._records.set(t,a),a.currentValue=e,this._addToAdditions(a),a}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){Object.is(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(a=>e(t[a],a))}}class SD{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function vh(){return new $c([new cC])}let $c=(()=>{class i{constructor(e){this.factories=e}static create(e,a){if(null!=a){const l=a.factories.slice();e=e.concat(l)}return new i(e)}static extend(e){return{provide:i,useFactory:a=>i.create(e,a||vh()),deps:[[i,new Op,new Nu]]}}find(e){const a=this.factories.find(l=>l.supports(e));if(null!=a)return a;throw new he(901,!1)}}return i.\u0275prov=Oe({token:i,providedIn:"root",factory:vh}),i})();function lC(){return new Of([new yD])}let Of=(()=>{class i{constructor(e){this.factories=e}static create(e,a){if(a){const l=a.factories.slice();e=e.concat(l)}return new i(e)}static extend(e){return{provide:i,useFactory:a=>i.create(e,a||lC()),deps:[[i,new Op,new Nu]]}}find(e){const a=this.factories.find(l=>l.supports(e));if(a)return a;throw new he(901,!1)}}return i.\u0275prov=Oe({token:i,providedIn:"root",factory:lC}),i})();const ux=Si(null,"core",[]);let uC=(()=>{class i{constructor(e){}}return i.\u0275fac=function(e){return new(e||i)(pe(Yc))},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({}),i})(),Xc=null;function Je(){return Xc}class hC{}const Zt=new Pe("DocumentToken");let pC=(()=>{class i{historyGo(e){throw new Error("Not implemented")}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=Oe({token:i,factory:function(){return function px(){return pe(pE)}()},providedIn:"platform"}),i})();const sc=new Pe("Location Initialized");let pE=(()=>{class i extends pC{constructor(e){super(),this._doc=e,this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Je().getBaseHref(this._doc)}onPopState(e){const a=Je().getGlobalEventTarget(this._doc,"window");return a.addEventListener("popstate",e,!1),()=>a.removeEventListener("popstate",e)}onHashChange(e){const a=Je().getGlobalEventTarget(this._doc,"window");return a.addEventListener("hashchange",e,!1),()=>a.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,a,l){Nf()?this._history.pushState(e,a,l):this._location.hash=l}replaceState(e,a,l){Nf()?this._history.replaceState(e,a,l):this._location.hash=l}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return i.\u0275fac=function(e){return new(e||i)(pe(Zt))},i.\u0275prov=Oe({token:i,factory:function(){return function fx(){return new pE(pe(Zt))}()},providedIn:"platform"}),i})();function Nf(){return!!window.history.pushState}function bh(i,t){if(0==i.length)return t;if(0==t.length)return i;let e=0;return i.endsWith("/")&&e++,t.startsWith("/")&&e++,2==e?i+t.substring(1):1==e?i+t:i+"/"+t}function Id(i){const t=i.match(/#|\?|$/),e=t&&t.index||i.length;return i.slice(0,e-("/"===i[e-1]?1:0))+i.slice(e)}function Ia(i){return i&&"?"!==i[0]?"?"+i:i}let fe=(()=>{class i{historyGo(e){throw new Error("Not implemented")}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=Oe({token:i,factory:function(){return Ct(ac)},providedIn:"root"}),i})();const Vt=new Pe("appBaseHref");let ac=(()=>{class i extends fe{constructor(e,a){super(),this._platformLocation=e,this._removeListenerFns=[],this._baseHref=a??this._platformLocation.getBaseHrefFromDOM()??Ct(Zt).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return bh(this._baseHref,e)}path(e=!1){const a=this._platformLocation.pathname+Ia(this._platformLocation.search),l=this._platformLocation.hash;return l&&e?`${a}${l}`:a}pushState(e,a,l,u){const f=this.prepareExternalUrl(l+Ia(u));this._platformLocation.pushState(e,a,f)}replaceState(e,a,l,u){const f=this.prepareExternalUrl(l+Ia(u));this._platformLocation.replaceState(e,a,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}}return i.\u0275fac=function(e){return new(e||i)(pe(pC),pe(Vt,8))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),fE=(()=>{class i extends fe{constructor(e,a){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=a&&(this._baseHref=a)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let a=this._platformLocation.hash;return null==a&&(a="#"),a.length>0?a.substring(1):a}prepareExternalUrl(e){const a=bh(this._baseHref,e);return a.length>0?"#"+a:a}pushState(e,a,l,u){let f=this.prepareExternalUrl(l+Ia(u));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.pushState(e,a,f)}replaceState(e,a,l,u){let f=this.prepareExternalUrl(l+Ia(u));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.replaceState(e,a,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}}return i.\u0275fac=function(e){return new(e||i)(pe(pC),pe(Vt,8))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac}),i})(),Sh=(()=>{class i{constructor(e){this._subject=new rn,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=e;const a=this._locationStrategy.getBaseHref();this._basePath=function wr(i){if(new RegExp("^(https?:)?//").test(i)){const[,e]=i.split(/\/\/[^\/]+/);return e}return i}(Id(Qc(a))),this._locationStrategy.onPopState(l=>{this._subject.emit({url:this.path(!0),pop:!0,state:l.state,type:l.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,a=""){return this.path()==this.normalize(e+Ia(a))}normalize(e){return i.stripTrailingSlash(function Jc(i,t){if(!i||!t.startsWith(i))return t;const e=t.substring(i.length);return""===e||["/",";","?","#"].includes(e[0])?e:t}(this._basePath,Qc(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,a="",l=null){this._locationStrategy.pushState(l,"",e,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Ia(a)),l)}replaceState(e,a="",l=null){this._locationStrategy.replaceState(l,"",e,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Ia(a)),l)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(a=>{this._notifyUrlChangeListeners(a.url,a.state)})),()=>{const a=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(a,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",a){this._urlChangeListeners.forEach(l=>l(e,a))}subscribe(e,a,l){return this._subject.subscribe({next:e,error:a,complete:l})}}return i.normalizeQueryParams=Ia,i.joinWithSlash=bh,i.stripTrailingSlash=Id,i.\u0275fac=function(e){return new(e||i)(pe(fe))},i.\u0275prov=Oe({token:i,factory:function(){return function Ch(){return new Sh(pe(fe))}()},providedIn:"root"}),i})();function Qc(i){return i.replace(/\/index.html$/,"")}const TC=/\s+/,wC=[];let TE=(()=>{class i{constructor(e,a,l,u){this._iterableDiffers=e,this._keyValueDiffers=a,this._ngEl=l,this._renderer=u,this.initialClasses=wC,this.stateMap=new Map}set klass(e){this.initialClasses=null!=e?e.trim().split(TC):wC}set ngClass(e){this.rawClass="string"==typeof e?e.trim().split(TC):e}ngDoCheck(){for(const a of this.initialClasses)this._updateState(a,!0);const e=this.rawClass;if(Array.isArray(e)||e instanceof Set)for(const a of e)this._updateState(a,!0);else if(null!=e)for(const a of Object.keys(e))this._updateState(a,Boolean(e[a]));this._applyStateDiff()}_updateState(e,a){const l=this.stateMap.get(e);void 0!==l?(l.enabled!==a&&(l.changed=!0,l.enabled=a),l.touched=!0):this.stateMap.set(e,{enabled:a,changed:!0,touched:!0})}_applyStateDiff(){for(const e of this.stateMap){const a=e[0],l=e[1];l.changed?(this._toggleClass(a,l.enabled),l.changed=!1):l.touched||(l.enabled&&this._toggleClass(a,!1),this.stateMap.delete(a)),l.touched=!1}}_toggleClass(e,a){(e=e.trim()).length>0&&e.split(TC).forEach(l=>{a?this._renderer.addClass(this._ngEl.nativeElement,l):this._renderer.removeClass(this._ngEl.nativeElement,l)})}}return i.\u0275fac=function(e){return new(e||i)(ie($c),ie(Of),ie(cn),ie(pa))},i.\u0275dir=je({type:i,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),i})();class xD{constructor(t,e,a,l){this.$implicit=t,this.ngForOf=e,this.index=a,this.count=l}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let jf=(()=>{class i{set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}constructor(e,a,l){this._viewContainer=e,this._template=a,this._differs=l,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const a=this._viewContainer;e.forEachOperation((l,u,f)=>{if(null==l.previousIndex)a.createEmbeddedView(this._template,new xD(l.item,this._ngForOf,-1,-1),null===f?void 0:f);else if(null==f)a.remove(null===u?void 0:u);else if(null!==u){const E=a.get(u);a.move(E,f),wE(E,l)}});for(let l=0,u=a.length;l<u;l++){const E=a.get(l).context;E.index=l,E.count=u,E.ngForOf=this._ngForOf}e.forEachIdentityChange(l=>{wE(a.get(l.currentIndex),l)})}static ngTemplateContextGuard(e,a){return!0}}return i.\u0275fac=function(e){return new(e||i)(ie(xo),ie(ba),ie($c))},i.\u0275dir=je({type:i,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),i})();function wE(i,t){i.context.$implicit=t.item}let hc=(()=>{class i{constructor(e,a){this._viewContainer=e,this._context=new FD,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=a}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){Ks("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){Ks("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,a){return!0}}return i.\u0275fac=function(e){return new(e||i)(ie(xo),ie(ba))},i.\u0275dir=je({type:i,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),i})();class FD{constructor(){this.$implicit=null,this.ngIf=null}}function Ks(i,t){if(t&&!t.createEmbeddedView)throw new Error(`${i} must be a TemplateRef, but received '${Mn(t)}'.`)}class go{constructor(t,e){this._viewContainerRef=t,this._templateRef=e,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(t){t&&!this._created?this.create():!t&&this._created&&this.destroy()}}let pc=(()=>{class i{constructor(){this._defaultViews=[],this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(e){this._ngSwitch=e,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(e){this._defaultViews.push(e)}_matchCase(e){const a=e==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||a,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),a}_updateDefaultCases(e){if(this._defaultViews.length>0&&e!==this._defaultUsed){this._defaultUsed=e;for(const a of this._defaultViews)a.enforceState(e)}}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275dir=je({type:i,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"},standalone:!0}),i})(),IE=(()=>{class i{constructor(e,a,l){this.ngSwitch=l,l._addCase(),this._view=new go(e,a)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return i.\u0275fac=function(e){return new(e||i)(ie(xo),ie(ba),ie(pc,9))},i.\u0275dir=je({type:i,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"},standalone:!0}),i})(),VD=(()=>{class i{constructor(e){this._viewContainerRef=e,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(e){if(e.ngTemplateOutlet||e.ngTemplateOutletInjector){const a=this._viewContainerRef;if(this._viewRef&&a.remove(a.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:l,ngTemplateOutletContext:u,ngTemplateOutletInjector:f}=this;this._viewRef=a.createEmbeddedView(l,u,f?{injector:f}:void 0)}else this._viewRef=null}else this._viewRef&&e.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return i.\u0275fac=function(e){return new(e||i)(ie(xo))},i.\u0275dir=je({type:i,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[Ao]}),i})();class Hf{createSubscription(t,e){return t.subscribe({next:e,error:a=>{throw a}})}dispose(t){t.unsubscribe()}}class Gf{createSubscription(t,e){return t.then(e,a=>{throw a})}dispose(t){}}const Wf=new Gf,RC=new Hf;let Nh=(()=>{class i{constructor(e){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=e}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(e){return this._obj?e!==this._obj?(this._dispose(),this.transform(e)):this._latestValue:(e&&this._subscribe(e),this._latestValue)}_subscribe(e){this._obj=e,this._strategy=this._selectStrategy(e),this._subscription=this._strategy.createSubscription(e,a=>this._updateLatestValue(e,a))}_selectStrategy(e){if(ef(e))return Wf;if(sd(e))return RC;throw function Ji(i,t){return new he(2100,!1)}()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(e,a){e===this._obj&&(this._latestValue=a,this._ref.markForCheck())}}return i.\u0275fac=function(e){return new(e||i)(ie(te,16))},i.\u0275pipe=Lr({name:"async",type:i,pure:!1,standalone:!0}),i})(),Kf=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({}),i})();const JD="browser";let Dx=(()=>{class i{}return i.\u0275prov=Oe({token:i,providedIn:"root",factory:()=>new el(pe(Zt),window)}),i})();class el{constructor(t,e){this.document=t,this.window=e,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const e=function tl(i,t){const e=i.getElementById(t)||i.getElementsByName(t)[0];if(e)return e;if("function"==typeof i.createTreeWalker&&i.body&&(i.body.createShadowRoot||i.body.attachShadow)){const a=i.createTreeWalker(i.body,NodeFilter.SHOW_ELEMENT);let l=a.currentNode;for(;l;){const u=l.shadowRoot;if(u){const f=u.getElementById(t)||u.querySelector(`[name="${t}"]`);if(f)return f}l=a.nextNode()}}return null}(this.document,t);e&&(this.scrollToElement(e),e.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=t)}}scrollToElement(t){const e=t.getBoundingClientRect(),a=e.left+this.window.pageXOffset,l=e.top+this.window.pageYOffset,u=this.offset();this.window.scrollTo(a-u[0],l-u[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=ZD(this.window.history)||ZD(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function ZD(i){return Object.getOwnPropertyDescriptor(i,"scrollRestoration")}class Zf extends hC{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class jE extends Zf{static makeCurrent(){!function ms(i){Xc||(Xc=i)}(new jE)}onAndCancel(t,e,a){return t.addEventListener(e,a,!1),()=>{t.removeEventListener(e,a,!1)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getBaseHref(t){const e=function HE(){return em=em||document.querySelector("base"),em?em.getAttribute("href"):null}();return null==e?null:function Xx(i){Na=Na||document.createElement("a"),Na.setAttribute("href",i);const t=Na.pathname;return"/"===t.charAt(0)?t:`/${t}`}(e)}resetBaseElement(){em=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return function kD(i,t){t=encodeURIComponent(t);for(const e of i.split(";")){const a=e.indexOf("="),[l,u]=-1==a?[e,""]:[e.slice(0,a),e.slice(a+1)];if(l.trim()===t)return decodeURIComponent(u)}return null}(document.cookie,t)}}let Na,em=null;const sO=new Pe("TRANSITION_ID"),aO=[{provide:w,useFactory:function Es(i,t,e){return()=>{e.get(Tf).donePromise.then(()=>{const a=Je(),l=t.querySelectorAll(`style[ng-transition="${i}"]`);for(let u=0;u<l.length;u++)a.remove(l[u])})}},deps:[sO,Zt,No],multi:!0}];let Jx=(()=>{class i{build(){return new XMLHttpRequest}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=Oe({token:i,factory:i.\u0275fac}),i})();const tm=new Pe("EventManagerPlugins");let Ld=(()=>{class i{constructor(e,a){this._zone=a,this._eventNameToPlugin=new Map,e.forEach(l=>{l.manager=this}),this._plugins=e.slice().reverse()}addEventListener(e,a,l){return this._findPluginFor(a).addEventListener(e,a,l)}addGlobalEventListener(e,a,l){return this._findPluginFor(a).addGlobalEventListener(e,a,l)}getZone(){return this._zone}_findPluginFor(e){const a=this._eventNameToPlugin.get(e);if(a)return a;const l=this._plugins;for(let u=0;u<l.length;u++){const f=l[u];if(f.supports(e))return this._eventNameToPlugin.set(e,f),f}throw new Error(`No event manager plugin found for event ${e}`)}}return i.\u0275fac=function(e){return new(e||i)(pe(tm),pe(me))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac}),i})();class nm{constructor(t){this._doc=t}addGlobalEventListener(t,e,a){const l=Je().getGlobalEventTarget(this._doc,t);if(!l)throw new Error(`Unsupported event target ${l} for event ${e}`);return this.addEventListener(l,e,a)}}let Pa=(()=>{class i{constructor(){this.usageCount=new Map}addStyles(e){for(const a of e)1===this.changeUsageCount(a,1)&&this.onStyleAdded(a)}removeStyles(e){for(const a of e)0===this.changeUsageCount(a,-1)&&this.onStyleRemoved(a)}onStyleRemoved(e){}onStyleAdded(e){}getAllStyles(){return this.usageCount.keys()}changeUsageCount(e,a){const l=this.usageCount;let u=l.get(e)??0;return u+=a,u>0?l.set(e,u):l.delete(e),u}ngOnDestroy(){for(const e of this.getAllStyles())this.onStyleRemoved(e);this.usageCount.clear()}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=Oe({token:i,factory:i.\u0275fac}),i})(),Fd=(()=>{class i extends Pa{constructor(e){super(),this.doc=e,this.styleRef=new Map,this.hostNodes=new Set,this.resetHostNodes()}onStyleAdded(e){for(const a of this.hostNodes)this.addStyleToHost(a,e)}onStyleRemoved(e){const a=this.styleRef;a.get(e)?.forEach(u=>u.remove()),a.delete(e)}ngOnDestroy(){super.ngOnDestroy(),this.styleRef.clear(),this.resetHostNodes()}addHost(e){this.hostNodes.add(e);for(const a of this.getAllStyles())this.addStyleToHost(e,a)}removeHost(e){this.hostNodes.delete(e)}addStyleToHost(e,a){const l=this.doc.createElement("style");l.textContent=a,e.appendChild(l);const u=this.styleRef.get(a);u?u.push(l):this.styleRef.set(a,[l])}resetHostNodes(){const e=this.hostNodes;e.clear(),e.add(this.doc.head)}}return i.\u0275fac=function(e){return new(e||i)(pe(Zt))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac}),i})();const im={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},xh=/%COMP%/g,il=new Pe("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function FC(i,t){return t.flat(100).map(e=>e.replace(xh,i))}function UC(i){return t=>{if("__ngUnwrap__"===t)return i;!1===i(t)&&(t.preventDefault(),t.returnValue=!1)}}let Lh=(()=>{class i{constructor(e,a,l,u){this.eventManager=e,this.sharedStylesHost=a,this.appId=l,this.removeStylesOnCompDestory=u,this.rendererByCompId=new Map,this.defaultRenderer=new om(e)}createRenderer(e,a){if(!e||!a)return this.defaultRenderer;const l=this.getOrCreateRenderer(e,a);return l instanceof fO?l.applyToHost(e):l instanceof Ys&&l.applyStyles(),l}getOrCreateRenderer(e,a){const l=this.rendererByCompId;let u=l.get(a.id);if(!u){const f=this.eventManager,E=this.sharedStylesHost,y=this.removeStylesOnCompDestory;switch(a.encapsulation){case Ms.Emulated:u=new fO(f,E,a,this.appId,y);break;case Ms.ShadowDom:return new Zx(f,E,e,a);default:u=new Ys(f,E,a,y)}u.onDestroy=()=>l.delete(a.id),l.set(a.id,u)}return u}ngOnDestroy(){this.rendererByCompId.clear()}begin(){}end(){}}return i.\u0275fac=function(e){return new(e||i)(pe(Ld),pe(Fd),pe(Cd),pe(il))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac}),i})();class om{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,e){return e?document.createElementNS(im[e]||e,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,e){(VC(t)?t.content:t).appendChild(e)}insertBefore(t,e,a){t&&(VC(t)?t.content:t).insertBefore(e,a)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t,e){let a="string"==typeof t?document.querySelector(t):t;if(!a)throw new Error(`The selector "${t}" did not match any elements`);return e||(a.textContent=""),a}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,a,l){if(l){e=l+":"+e;const u=im[l];u?t.setAttributeNS(u,e,a):t.setAttribute(e,a)}else t.setAttribute(e,a)}removeAttribute(t,e,a){if(a){const l=im[a];l?t.removeAttributeNS(l,e):t.removeAttribute(`${a}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,a,l){l&(Wi.DashCase|Wi.Important)?t.style.setProperty(e,a,l&Wi.Important?"important":""):t.style[e]=a}removeStyle(t,e,a){a&Wi.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,a){t[e]=a}setValue(t,e){t.nodeValue=e}listen(t,e,a){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,UC(a)):this.eventManager.addEventListener(t,e,UC(a))}}function VC(i){return"TEMPLATE"===i.tagName&&void 0!==i.content}class Zx extends om{constructor(t,e,a,l){super(t),this.sharedStylesHost=e,this.hostEl=a,this.shadowRoot=a.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const u=FC(l.id,l.styles);for(const f of u){const E=document.createElement("style");E.textContent=f,this.shadowRoot.appendChild(E)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,a){return super.insertBefore(this.nodeOrShadowRoot(t),e,a)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class Ys extends om{constructor(t,e,a,l,u=a.id){super(t),this.sharedStylesHost=e,this.removeStylesOnCompDestory=l,this.rendererUsageCount=0,this.styles=FC(u,a.styles)}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class fO extends Ys{constructor(t,e,a,l,u){const f=l+"-"+a.id;super(t,e,a,u,f),this.contentAttr=function dO(i){return"_ngcontent-%COMP%".replace(xh,i)}(f),this.hostAttr=function uO(i){return"_nghost-%COMP%".replace(xh,i)}(f)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,e){const a=super.createElement(t,e);return super.setAttribute(a,this.contentAttr,""),a}}let mO=(()=>{class i extends nm{constructor(e){super(e)}supports(e){return!0}addEventListener(e,a,l){return e.addEventListener(a,l,!1),()=>this.removeEventListener(e,a,l)}removeEventListener(e,a,l){return e.removeEventListener(a,l)}}return i.\u0275fac=function(e){return new(e||i)(pe(Zt))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac}),i})();const _O=["alt","control","meta","shift"],eL={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},sm={alt:i=>i.altKey,control:i=>i.ctrlKey,meta:i=>i.metaKey,shift:i=>i.shiftKey};let BC=(()=>{class i extends nm{constructor(e){super(e)}supports(e){return null!=i.parseEventName(e)}addEventListener(e,a,l){const u=i.parseEventName(a),f=i.eventCallback(u.fullKey,l,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Je().onAndCancel(e,u.domEventName,f))}static parseEventName(e){const a=e.toLowerCase().split("."),l=a.shift();if(0===a.length||"keydown"!==l&&"keyup"!==l)return null;const u=i._normalizeKey(a.pop());let f="",E=a.indexOf("code");if(E>-1&&(a.splice(E,1),f="code."),_O.forEach(T=>{const R=a.indexOf(T);R>-1&&(a.splice(R,1),f+=T+".")}),f+=u,0!=a.length||0===u.length)return null;const y={};return y.domEventName=l,y.fullKey=f,y}static matchEventFullKeyCode(e,a){let l=eL[e.key]||e.key,u="";return a.indexOf("code.")>-1&&(l=e.code,u="code."),!(null==l||!l)&&(l=l.toLowerCase()," "===l?l="space":"."===l&&(l="dot"),_O.forEach(f=>{f!==l&&(0,sm[f])(e)&&(u+=f+".")}),u+=l,u===a)}static eventCallback(e,a,l){return u=>{i.matchEventFullKeyCode(u,e)&&l.runGuarded(()=>a(u))}}static _normalizeKey(e){return"esc"===e?"escape":e}}return i.\u0275fac=function(e){return new(e||i)(pe(Zt))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac}),i})();const EO=[{provide:aE,useValue:JD},{provide:zt,useValue:function jC(){jE.makeCurrent()},multi:!0},{provide:Zt,useFactory:function JU(){return function C1(i){lb=i}(document),document},deps:[]}],QU=Si(ux,"browser",EO),iL=new Pe(""),rL=[{provide:cE,useClass:class cO{addToWindow(t){Hn.getAngularTestability=(a,l=!0)=>{const u=t.findTestabilityInTree(a,l);if(null==u)throw new Error("Could not find testability for element.");return u},Hn.getAllAngularTestabilities=()=>t.getAllTestabilities(),Hn.getAllAngularRootElements=()=>t.getAllRootElements(),Hn.frameworkStabilizers||(Hn.frameworkStabilizers=[]),Hn.frameworkStabilizers.push(a=>{const l=Hn.getAllAngularTestabilities();let u=l.length,f=!1;const E=function(y){f=f||y,u--,0==u&&a(f)};l.forEach(function(y){y.whenStable(E)})})}findTestabilityInTree(t,e,a){return null==e?null:t.getTestability(e)??(a?Je().isShadowRoot(e)?this.findTestabilityInTree(t,e.host,!0):this.findTestabilityInTree(t,e.parentElement,!0):null)}},deps:[]},{provide:dD,useClass:If,deps:[me,oC,cE]},{provide:If,useClass:If,deps:[me,oC,cE]}],vO=[{provide:gb,useValue:"root"},{provide:Yl,useFactory:function nL(){return new Yl},deps:[]},{provide:tm,useClass:mO,multi:!0,deps:[Zt,me,aE]},{provide:tm,useClass:BC,multi:!0,deps:[Zt]},{provide:Lh,useClass:Lh,deps:[Ld,Fd,Cd,il]},{provide:Kl,useExisting:Lh},{provide:Pa,useExisting:Fd},{provide:Fd,useClass:Fd,deps:[Zt]},{provide:Ld,useClass:Ld,deps:[tm,me]},{provide:class Ox{},useClass:Jx,deps:[]},[]];let oL=(()=>{class i{constructor(e){}static withServerTransition(e){return{ngModule:i,providers:[{provide:Cd,useValue:e.appId},{provide:sO,useExisting:Cd},aO]}}}return i.\u0275fac=function(e){return new(e||i)(pe(iL,12))},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({providers:[...vO,...rL],imports:[Kf,uC]}),i})(),yO=(()=>{class i{constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}}return i.\u0275fac=function(e){return new(e||i)(pe(Zt))},i.\u0275prov=Oe({token:i,factory:function(e){let a=null;return a=e?new e:function sL(){return new yO(pe(Zt))}(),a},providedIn:"root"}),i})();function vs(i,t){return new _n(e=>{const a=i.length;if(0===a)return void e.complete();const l=new Array(a);let u=0,f=0;for(let E=0;E<a;E++){const y=Di(i[E]);let T=!1;e.add(y.subscribe({next:R=>{T||(T=!0,f++),l[E]=R},error:R=>e.error(R),complete:()=>{u++,(u===a||!T)&&(f===a&&e.next(t?t.reduce((R,L,H)=>(R[L]=l[H],R),{}):l),e.complete())}}))}})}typeof window<"u"&&window;let lm=(()=>{class i{constructor(e,a){this._renderer=e,this._elementRef=a,this.onChange=l=>{},this.onTouched=()=>{}}setProperty(e,a){this._renderer.setProperty(this._elementRef.nativeElement,e,a)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}}return i.\u0275fac=function(e){return new(e||i)(ie(pa),ie(cn))},i.\u0275dir=je({type:i}),i})(),ol=(()=>{class i extends lm{}return i.\u0275fac=function(){let t;return function(a){return(t||(t=Hi(i)))(a||i)}}(),i.\u0275dir=je({type:i,features:[Ot]}),i})();const ys=new Pe("NgValueAccessor"),hL={provide:ys,useExisting:kn(()=>Ss),multi:!0},KC=new Pe("CompositionEventMode");let Ss=(()=>{class i extends lm{constructor(e,a,l){super(e,a),this._compositionMode=l,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function YE(){const i=Je()?Je().getUserAgent():"";return/android (\d+)/.test(i.toLowerCase())}())}writeValue(e){this.setProperty("value",e??"")}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}return i.\u0275fac=function(e){return new(e||i)(ie(pa),ie(cn),ie(KC,8))},i.\u0275dir=je({type:i,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,a){1&e&&tn("input",function(u){return a._handleInput(u.target.value)})("blur",function(){return a.onTouched()})("compositionstart",function(){return a._compositionStart()})("compositionend",function(u){return a._compositionEnd(u.target.value)})},features:[An([hL]),Ot]}),i})();const $E=!1;function _c(i){return null==i||("string"==typeof i||Array.isArray(i))&&0===i.length}function AO(i){return null!=i&&"number"==typeof i.length}const Fi=new Pe("NgValidators"),$s=new Pe("NgAsyncValidators"),qC=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class DO{static min(t){return function YC(i){return t=>{if(_c(t.value)||_c(i))return null;const e=parseFloat(t.value);return!isNaN(e)&&e<i?{min:{min:i,actual:t.value}}:null}}(t)}static max(t){return function XE(i){return t=>{if(_c(t.value)||_c(i))return null;const e=parseFloat(t.value);return!isNaN(e)&&e>i?{max:{max:i,actual:t.value}}:null}}(t)}static required(t){return function $C(i){return _c(i.value)?{required:!0}:null}(t)}static requiredTrue(t){return function JE(i){return!0===i.value?null:{required:!0}}(t)}static email(t){return function QE(i){return _c(i.value)||qC.test(i.value)?null:{email:!0}}(t)}static minLength(t){return function OO(i){return t=>_c(t.value)||!AO(t.value)?null:t.value.length<i?{minlength:{requiredLength:i,actualLength:t.value.length}}:null}(t)}static maxLength(t){return function ZE(i){return t=>AO(t.value)&&t.value.length>i?{maxlength:{requiredLength:i,actualLength:t.value.length}}:null}(t)}static pattern(t){return function XC(i){if(!i)return dm;let t,e;return"string"==typeof i?(e="","^"!==i.charAt(0)&&(e+="^"),e+=i,"$"!==i.charAt(i.length-1)&&(e+="$"),t=new RegExp(e)):(e=i.toString(),t=i),a=>{if(_c(a.value))return null;const l=a.value;return t.test(l)?null:{pattern:{requiredPattern:e,actualValue:l}}}}(t)}static nullValidator(t){return null}static compose(t){return Bd(t)}static composeAsync(t){return ev(t)}}function dm(i){return null}function JC(i){return null!=i}function QC(i){const t=ef(i)?Di(i):i;if($E&&!ec(t)){let e="Expected async validator to return Promise or Observable.";throw"object"==typeof i&&(e+=" Are you using a synchronous validator where an async validator is expected?"),new he(-1101,e)}return t}function NO(i){let t={};return i.forEach(e=>{t=null!=e?{...t,...e}:t}),0===Object.keys(t).length?null:t}function ZC(i,t){return t.map(e=>e(i))}function Vd(i){return i.map(t=>function pL(i){return!i.validate}(t)?t:e=>t.validate(e))}function Bd(i){if(!i)return null;const t=i.filter(JC);return 0==t.length?null:function(e){return NO(ZC(e,t))}}function jd(i){return null!=i?Bd(Vd(i)):null}function ev(i){if(!i)return null;const t=i.filter(JC);return 0==t.length?null:function(e){return function RO(...i){if(1===i.length){const t=i[0];if(lr(t))return vs(t,null);if(ja(t)&&Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);return vs(e.map(a=>t[a]),e)}}if("function"==typeof i[i.length-1]){const t=i.pop();return vs(i=1===i.length&&lr(i[0])?i[0]:i,null).pipe(At(e=>t(...e)))}return vs(i,null)}(ZC(e,t).map(QC)).pipe(At(NO))}}function um(i){return null!=i?ev(Vd(i)):null}function eT(i,t){return null===i?[t]:Array.isArray(i)?[...i,t]:[i,t]}function tv(i){return i._rawValidators}function tT(i){return i._rawAsyncValidators}function hm(i){return i?Array.isArray(i)?i:[i]:[]}function nv(i,t){return Array.isArray(i)?i.includes(t):i===t}function iv(i,t){const e=hm(t);return hm(i).forEach(l=>{nv(e,l)||e.push(l)}),e}function nT(i,t){return hm(t).filter(e=>!nv(i,e))}class rv{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=jd(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=um(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t){this.control&&this.control.reset(t)}hasError(t,e){return!!this.control&&this.control.hasError(t,e)}getError(t,e){return this.control?this.control.getError(t,e):null}}class Dr extends rv{get formDirective(){return null}get path(){return null}}class Xs extends rv{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class PO{constructor(t){this._cd=t}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let ov=(()=>{class i extends PO{constructor(e){super(e)}}return i.\u0275fac=function(e){return new(e||i)(ie(Xs,2))},i.\u0275dir=je({type:i,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,a){2&e&&Bt("ng-untouched",a.isUntouched)("ng-touched",a.isTouched)("ng-pristine",a.isPristine)("ng-dirty",a.isDirty)("ng-valid",a.isValid)("ng-invalid",a.isInvalid)("ng-pending",a.isPending)},features:[Ot]}),i})(),iT=(()=>{class i extends PO{constructor(e){super(e)}}return i.\u0275fac=function(e){return new(e||i)(ie(Dr,10))},i.\u0275dir=je({type:i,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(e,a){2&e&&Bt("ng-untouched",a.isUntouched)("ng-touched",a.isTouched)("ng-pristine",a.isPristine)("ng-dirty",a.isDirty)("ng-valid",a.isValid)("ng-invalid",a.isInvalid)("ng-pending",a.isPending)("ng-submitted",a.isSubmitted)},features:[Ot]}),i})();function xO(i,t){return i?`with name: '${t}'`:`at index: ${t}`}const pm=!1,Uh="VALID",cv="INVALID",sl="PENDING",gc="DISABLED";function Yr(i){return(fm(i)?i.validators:i)||null}function Vh(i,t){return(fm(t)?t.asyncValidators:i)||null}function fm(i){return null!=i&&!Array.isArray(i)&&"object"==typeof i}function hn(i,t,e){const a=i.controls;if(!(t?Object.keys(a):a).length)throw new he(1e3,pm?function gL(i){return`\n    There are no form controls registered with this ${i?"group":"array"} yet. If you're using ngModel,\n    you may want to check next tick (e.g. use setTimeout).\n  `}(t):"");if(!a[e])throw new he(1001,pm?function EL(i,t){return`Cannot find form control ${xO(i,t)}`}(t,e):"")}function oT(i,t,e){i._forEachChild((a,l)=>{if(void 0===e[l])throw new he(1002,pm?function vL(i,t){return`Must supply a value for form control ${xO(i,t)}`}(t,l):"")})}class mm{constructor(t,e){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(t),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===Uh}get invalid(){return this.status===cv}get pending(){return this.status==sl}get disabled(){return this.status===gc}get enabled(){return this.status!==gc}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._assignValidators(t)}setAsyncValidators(t){this._assignAsyncValidators(t)}addValidators(t){this.setValidators(iv(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(iv(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(nT(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(nT(t,this._rawAsyncValidators))}hasValidator(t){return nv(this._rawValidators,t)}hasAsyncValidator(t){return nv(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=sl,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=gc,this.errors=null,this._forEachChild(a=>{a.disable({...t,onlySelf:!0})}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...t,skipPristineCheck:e}),this._onDisabledChange.forEach(a=>a(!0))}enable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=Uh,this._forEachChild(a=>{a.enable({...t,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors({...t,skipPristineCheck:e}),this._onDisabledChange.forEach(a=>a(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Uh||this.status===sl)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?gc:Uh}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=sl,this._hasOwnPendingAsyncValidator=!0;const e=QC(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(a=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(a,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(!1!==e.emitEvent)}get(t){let e=t;return null==e||(Array.isArray(e)||(e=e.split(".")),0===e.length)?null:e.reduce((a,l)=>a&&a._find(l),this)}getError(t,e){const a=e?this.get(e):this;return a&&a.errors?a.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new rn,this.statusChanges=new rn}_calculateStatus(){return this._allControlsDisabled()?gc:this.errors?cv:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(sl)?sl:this._anyControlsHaveStatus(cv)?cv:Uh}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){fm(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}_assignValidators(t){this._rawValidators=Array.isArray(t)?t.slice():t,this._composedValidatorFn=function dt(i){return Array.isArray(i)?jd(i):i||null}(this._rawValidators)}_assignAsyncValidators(t){this._rawAsyncValidators=Array.isArray(t)?t.slice():t,this._composedAsyncValidatorFn=function LO(i){return Array.isArray(i)?um(i):i||null}(this._rawAsyncValidators)}}class Gd extends mm{constructor(t,e,a){super(Yr(e),Vh(a,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e,a={}){this.registerControl(t,e),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}removeControl(t,e={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(t,e,a={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){oT(this,!0,t),Object.keys(t).forEach(a=>{hn(this,!0,a),this.controls[a].setValue(t[a],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){null!=t&&(Object.keys(t).forEach(a=>{const l=this.controls[a];l&&l.patchValue(t[a],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t={},e={}){this._forEachChild((a,l)=>{a.reset(t[l],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(t,e,a)=>(t[a]=e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(e,a)=>!!a._syncPendingControls()||e);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(e=>{const a=this.controls[e];a&&t(a,e)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(const[e,a]of Object.entries(this.controls))if(this.contains(e)&&t(a))return!0;return!1}_reduceValue(){return this._reduceChildren({},(e,a,l)=>((a.enabled||this.disabled)&&(e[l]=a.value),e))}_reduceChildren(t,e){let a=t;return this._forEachChild((l,u)=>{a=e(a,l,u)}),a}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}}class sT extends Gd{}const Ts=new Pe("CallSetDisabledState",{providedIn:"root",factory:()=>jh}),jh="always";function Gh(i,t,e=jh){_m(i,t),t.valueAccessor.writeValue(i.value),(i.disabled||"always"===e)&&t.valueAccessor.setDisabledState?.(i.disabled),function aT(i,t){t.valueAccessor.registerOnChange(e=>{i._pendingValue=e,i._pendingChange=!0,i._pendingDirty=!0,"change"===i.updateOn&&gm(i,t)})}(i,t),function UO(i,t){const e=(a,l)=>{t.valueAccessor.writeValue(a),l&&t.viewToModelUpdate(a)};i.registerOnChange(e),t._registerOnDestroy(()=>{i._unregisterOnChange(e)})}(i,t),function al(i,t){t.valueAccessor.registerOnTouched(()=>{i._pendingTouched=!0,"blur"===i.updateOn&&i._pendingChange&&gm(i,t),"submit"!==i.updateOn&&i.markAsTouched()})}(i,t),function FO(i,t){if(t.valueAccessor.setDisabledState){const e=a=>{t.valueAccessor.setDisabledState(a)};i.registerOnDisabledChange(e),t._registerOnDestroy(()=>{i._unregisterOnDisabledChange(e)})}}(i,t)}function Wd(i,t,e=!0){const a=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(a),t.valueAccessor.registerOnTouched(a)),zd(i,t),i&&(t._invokeOnDestroyCallbacks(),i._registerOnCollectionChange(()=>{}))}function Wh(i,t){i.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function _m(i,t){const e=tv(i);null!==t.validator?i.setValidators(eT(e,t.validator)):"function"==typeof e&&i.setValidators([e]);const a=tT(i);null!==t.asyncValidator?i.setAsyncValidators(eT(a,t.asyncValidator)):"function"==typeof a&&i.setAsyncValidators([a]);const l=()=>i.updateValueAndValidity();Wh(t._rawValidators,l),Wh(t._rawAsyncValidators,l)}function zd(i,t){let e=!1;if(null!==i){if(null!==t.validator){const l=tv(i);if(Array.isArray(l)&&l.length>0){const u=l.filter(f=>f!==t.validator);u.length!==l.length&&(e=!0,i.setValidators(u))}}if(null!==t.asyncValidator){const l=tT(i);if(Array.isArray(l)&&l.length>0){const u=l.filter(f=>f!==t.asyncValidator);u.length!==l.length&&(e=!0,i.setAsyncValidators(u))}}}const a=()=>{};return Wh(t._rawValidators,a),Wh(t._rawAsyncValidators,a),e}function gm(i,t){i._pendingDirty&&i.markAsDirty(),i.setValue(i._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(i._pendingValue),i._pendingChange=!1}function cT(i,t){_m(i,t)}function dT(i,t){i._syncPendingControls(),t.forEach(e=>{const a=e.control;"submit"===a.updateOn&&a._pendingChange&&(e.viewToModelUpdate(a._pendingValue),a._pendingChange=!1)})}const HO={provide:Dr,useExisting:kn(()=>hv)},Em=(()=>Promise.resolve())();let hv=(()=>{class i extends Dr{constructor(e,a,l){super(),this.callSetDisabledState=l,this.submitted=!1,this._directives=new Set,this.ngSubmit=new rn,this.form=new Gd({},jd(e),um(a))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){Em.then(()=>{const a=this._findContainer(e.path);e.control=a.registerControl(e.name,e.control),Gh(e.control,e,this.callSetDisabledState),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){Em.then(()=>{const a=this._findContainer(e.path);a&&a.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){Em.then(()=>{const a=this._findContainer(e.path),l=new Gd({});cT(l,e),a.registerControl(e.name,l),l.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){Em.then(()=>{const a=this._findContainer(e.path);a&&a.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,a){Em.then(()=>{this.form.get(e.path).setValue(a)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submitted=!0,dT(this.form,this._directives),this.ngSubmit.emit(e),"dialog"===e?.target?.method}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}}return i.\u0275fac=function(e){return new(e||i)(ie(Fi,10),ie($s,10),ie(Ts,8))},i.\u0275dir=je({type:i,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(e,a){1&e&&tn("submit",function(u){return a.onSubmit(u)})("reset",function(){return a.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[An([HO]),Ot]}),i})();function uT(i,t){const e=i.indexOf(t);e>-1&&i.splice(e,1)}function cl(i){return"object"==typeof i&&null!==i&&2===Object.keys(i).length&&"value"in i&&"disabled"in i}const zh=class extends mm{constructor(t=null,e,a){super(Yr(e),Vh(a,e)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),fm(e)&&(e.nonNullable||e.initialValueIsDefault)&&(this.defaultValue=cl(t)?t.value:t)}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(a=>a(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=this.defaultValue,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){uT(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){uT(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){cl(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}};let Qn=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275dir=je({type:i,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),i})(),fT=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({}),i})();const gv=new Pe("NgModelWithFormControlWarning"),$r={provide:Dr,useExisting:kn(()=>qh)};let qh=(()=>{class i extends Dr{constructor(e,a,l){super(),this.callSetDisabledState=l,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new rn,this._setValidators(e),this._setAsyncValidators(a)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(zd(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){const a=this.form.get(e.path);return Gh(a,e,this.callSetDisabledState),a.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),a}getControl(e){return this.form.get(e.path)}removeControl(e){Wd(e.control||null,e,!1),function BO(i,t){const e=i.indexOf(t);e>-1&&i.splice(e,1)}(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,a){this.form.get(e.path).setValue(a)}onSubmit(e){return this.submitted=!0,dT(this.form,this.directives),this.ngSubmit.emit(e),"dialog"===e?.target?.method}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_updateDomValue(){this.directives.forEach(e=>{const a=e.control,l=this.form.get(e.path);a!==l&&(Wd(a||null,e),(i=>i instanceof zh)(l)&&(Gh(l,e,this.callSetDisabledState),e.control=l))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){const a=this.form.get(e.path);cT(a,e),a.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){const a=this.form.get(e.path);a&&function ws(i,t){return zd(i,t)}(a,e)&&a.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){_m(this.form,this),this._oldForm&&zd(this._oldForm,this)}_checkFormPresent(){}}return i.\u0275fac=function(e){return new(e||i)(ie(Fi,10),ie($s,10),ie(Ts,8))},i.\u0275dir=je({type:i,selectors:[["","formGroup",""]],hostBindings:function(e,a){1&e&&tn("submit",function(u){return a.onSubmit(u)})("reset",function(){return a.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[An([$r]),Ot,Ao]}),i})();const KO={provide:Xs,useExisting:kn(()=>bv)};let bv=(()=>{class i extends Xs{set isDisabled(e){}constructor(e,a,l,u,f){super(),this._ngModelWarningConfig=f,this._added=!1,this.update=new rn,this._ngModelWarningSent=!1,this._parent=e,this._setValidators(a),this._setAsyncValidators(l),this.valueAccessor=function uv(i,t){if(!t)return null;let e,a,l;return Array.isArray(t),t.forEach(u=>{u.constructor===Ss?e=u:function VO(i){return Object.getPrototypeOf(i.constructor)===ol}(u)?a=u:l=u}),l||a||e||null}(0,u)}ngOnChanges(e){this._added||this._setUpControl(),function dv(i,t){if(!i.hasOwnProperty("model"))return!1;const e=i.model;return!!e.isFirstChange()||!Object.is(t,e.currentValue)}(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return function Hh(i,t){return[...t.path,i]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}}return i._ngModelWarningSentOnce=!1,i.\u0275fac=function(e){return new(e||i)(ie(Dr,13),ie(Fi,10),ie($s,10),ie(ys,10),ie(gv,8))},i.\u0275dir=je({type:i,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[An([KO]),Ot,Ao]}),i})(),OL=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({imports:[fT]}),i})();class ym extends mm{constructor(t,e,a){super(Yr(e),Vh(a,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(t){return this.controls[this._adjustIndex(t)]}push(t,e={}){this.controls.push(t),this._registerControl(t),this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}insert(t,e,a={}){this.controls.splice(t,0,e),this._registerControl(e),this.updateValueAndValidity({emitEvent:a.emitEvent})}removeAt(t,e={}){let a=this._adjustIndex(t);a<0&&(a=0),this.controls[a]&&this.controls[a]._registerOnCollectionChange(()=>{}),this.controls.splice(a,1),this.updateValueAndValidity({emitEvent:e.emitEvent})}setControl(t,e,a={}){let l=this._adjustIndex(t);l<0&&(l=0),this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),this.controls.splice(l,1),e&&(this.controls.splice(l,0,e),this._registerControl(e)),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(t,e={}){oT(this,!1,t),t.forEach((a,l)=>{hn(this,!1,l),this.at(l).setValue(a,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){null!=t&&(t.forEach((a,l)=>{this.at(l)&&this.at(l).patchValue(a,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t=[],e={}){this._forEachChild((a,l)=>{a.reset(t[l],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this.controls.map(t=>t.getRawValue())}clear(t={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:t.emitEvent}))}_adjustIndex(t){return t<0?t+this.length:t}_syncPendingControls(){let t=this.controls.reduce((e,a)=>!!a._syncPendingControls()||e,!1);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){this.controls.forEach((e,a)=>{t(e,a)})}_updateValue(){this.value=this.controls.filter(t=>t.enabled||this.disabled).map(t=>t.value)}_anyControls(t){return this.controls.some(e=>e.enabled&&t(e))}_setUpControls(){this._forEachChild(t=>this._registerControl(t))}_allControlsDisabled(){for(const t of this.controls)if(t.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(t){t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)}_find(t){return this.at(t)??null}}function tN(i){return!!i&&(void 0!==i.asyncValidators||void 0!==i.validators||void 0!==i.updateOn)}let wv,$h=(()=>{class i{constructor(){this.useNonNullable=!1}get nonNullable(){const e=new i;return e.useNonNullable=!0,e}group(e,a=null){const l=this._reduceControls(e);let u={};return tN(a)?u=a:null!==a&&(u.validators=a.validator,u.asyncValidators=a.asyncValidator),new Gd(l,u)}record(e,a=null){const l=this._reduceControls(e);return new sT(l,a)}control(e,a,l){let u={};return this.useNonNullable?(tN(a)?u=a:(u.validators=a,u.asyncValidators=l),new zh(e,{...u,nonNullable:!0})):new zh(e,a,l)}array(e,a,l){const u=e.map(f=>this._createControl(f));return new ym(u,a,l)}_reduceControls(e){const a={};return Object.keys(e).forEach(l=>{a[l]=this._createControl(e[l])}),a}_createControl(e){return e instanceof zh||e instanceof mm?e:Array.isArray(e)?this.control(e[0],e.length>1?e[1]:null,e.length>2?e[2]:null):this.control(e)}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),CT=(()=>{class i extends $h{group(e,a=null){return super.group(e,a)}control(e,a,l){return super.control(e,a,l)}array(e,a,l){return super.array(e,a,l)}}return i.\u0275fac=function(){let t;return function(a){return(t||(t=Hi(i)))(a||i)}}(),i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),nN=(()=>{class i{static withConfig(e){return{ngModule:i,providers:[{provide:gv,useValue:e.warnOnNgModelWithFormControl??"always"},{provide:Ts,useValue:e.callSetDisabledState??jh}]}}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({imports:[OL]}),i})();try{wv=typeof Intl<"u"&&Intl.v8BreakIterator}catch{wv=!1}let fr,sr=(()=>{class i{constructor(e){this._platformId=e,this.isBrowser=this._platformId?function or(i){return i===JD}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!wv)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return i.\u0275fac=function(e){return new(e||i)(pe(aE))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const wT=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function Jh(){if(fr)return fr;if("object"!=typeof document||!document)return fr=new Set(wT),fr;let i=document.createElement("input");return fr=new Set(wT.filter(t=>(i.setAttribute("type",t),i.type===t))),fr}let pn,bm,hl,Iv;function Go(i){return function NL(){if(null==pn&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>pn=!0}))}finally{pn=pn||!1}return pn}()?i:!!i.capture}function Sm(){if(null==hl){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return hl=!1,hl;if("scrollBehavior"in document.documentElement.style)hl=!0;else{const i=Element.prototype.scrollTo;hl=!!i&&!/\{\s*\[native code\]\s*\}/.test(i.toString())}}return hl}function Qh(){if("object"!=typeof document||!document)return 0;if(null==bm){const i=document.createElement("div"),t=i.style;i.dir="rtl",t.width="1px",t.overflow="auto",t.visibility="hidden",t.pointerEvents="none",t.position="absolute";const e=document.createElement("div"),a=e.style;a.width="2px",a.height="1px",i.appendChild(e),document.body.appendChild(i),bm=0,0===i.scrollLeft&&(i.scrollLeft=1,bm=0===i.scrollLeft?1:2),i.remove()}return bm}function pl(i){return i.composedPath?i.composedPath()[0]:i.target}function RT(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}class Xr extends Xt{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const e=super._subscribe(t);return e&&!e.closed&&t.next(this._value),e}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new bl;return this._value}next(t){super.next(this._value=t)}}function ze(...i){let t=i[i.length-1];return Sl(t)?(i.pop(),Bm(i,t)):cu(i)}function bV(i){return t=>t.lift(new j4(i))}class j4{constructor(t){this.total=t}call(t,e){return e.subscribe(new H4(t,this.total))}}class H4 extends En{constructor(t,e){super(t),this.total=e,this.count=0}_next(t){++this.count>this.total&&this.destination.next(t)}}class W4{constructor(t,e){this.compare=t,this.keySelector=e}call(t,e){return e.subscribe(new z4(t,this.compare,this.keySelector))}}class z4 extends En{constructor(t,e,a){super(t),this.keySelector=a,this.hasKey=!1,"function"==typeof e&&(this.compare=e)}compare(t,e){return t===e}_next(t){let e;try{const{keySelector:l}=this;e=l?l(t):t}catch(l){return this.destination.error(l)}let a=!1;if(this.hasKey)try{const{compare:l}=this;a=l(this.key,e)}catch(l){return this.destination.error(l)}else this.hasKey=!0;a||(this.key=e,this.destination.next(t))}}function So(i){return t=>t.lift(new K4(i))}class K4{constructor(t){this.notifier=t}call(t,e){const a=new q4(t),l=Cl(this.notifier,new au(a));return l&&!a.seenValue?(a.add(l),e.subscribe(a)):a}}class q4 extends hp{constructor(t){super(t),this.seenValue=!1}notifyNext(){this.seenValue=!0,this.complete()}notifyComplete(){}}function ka(i){return null!=i&&"false"!=`${i}`}function cN(i,t=0){return function Y4(i){return!isNaN(parseFloat(i))&&!isNaN(Number(i))}(i)?Number(i):t}function lN(i){return Array.isArray(i)?i:[i]}function cr(i){return null==i?"":"string"==typeof i?i:`${i}px`}function Jd(i){return i instanceof cn?i.nativeElement:i}class $4 extends mn{constructor(t,e){super()}schedule(t,e=0){return this}}class zL extends $4{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){if(this.closed)return this;this.state=t;const a=this.id,l=this.scheduler;return null!=a&&(this.id=this.recycleAsyncId(l,a,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(l,this.id,e),this}requestAsyncId(t,e,a=0){return setInterval(t.flush.bind(t,this),a)}recycleAsyncId(t,e,a=0){if(null!==a&&this.delay===a&&!1===this.pending)return e;clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const a=this._execute(t,e);if(a)return a;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let l,a=!1;try{this.work(t)}catch(u){a=!0,l=!!u&&u||new Error(u)}if(a)return this.unsubscribe(),l}_unsubscribe(){const t=this.id,e=this.scheduler,a=e.actions,l=a.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==l&&a.splice(l,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null}}let SV=(()=>{class i{constructor(e,a=i.now){this.SchedulerAction=e,this.now=a}schedule(e,a=0,l){return new this.SchedulerAction(this,e).schedule(l,a)}}return i.now=()=>Date.now(),i})();class ml extends SV{constructor(t,e=SV.now){super(t,()=>ml.delegate&&ml.delegate!==this?ml.delegate.now():e()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(t,e=0,a){return ml.delegate&&ml.delegate!==this?ml.delegate.schedule(t,e,a):super.schedule(t,e,a)}flush(t){const{actions:e}=this;if(this.active)return void e.push(t);let a;this.active=!0;do{if(a=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,a){for(;t=e.shift();)t.unsubscribe();throw a}}}const Dv=new ml(zL);function CV(i,t=Dv){return e=>e.lift(new X4(i,t))}class X4{constructor(t,e){this.dueTime=t,this.scheduler=e}call(t,e){return e.subscribe(new J4(t,this.dueTime,this.scheduler))}}class J4 extends En{constructor(t,e,a){super(t),this.dueTime=e,this.scheduler=a,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(t){this.clearDebounce(),this.lastValue=t,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(Q4,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:t}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(t)}}clearDebounce(){const t=this.debouncedSubscription;null!==t&&(this.remove(t),t.unsubscribe(),this.debouncedSubscription=null)}}function Q4(i){i.debouncedNext()}let TV=(()=>{class i{create(e){return typeof MutationObserver>"u"?null:new MutationObserver(e)}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),Z4=(()=>{class i{constructor(e){this._mutationObserverFactory=e,this._observedElements=new Map}ngOnDestroy(){this._observedElements.forEach((e,a)=>this._cleanupObserver(a))}observe(e){const a=Jd(e);return new _n(l=>{const f=this._observeElement(a).subscribe(l);return()=>{f.unsubscribe(),this._unobserveElement(a)}})}_observeElement(e){if(this._observedElements.has(e))this._observedElements.get(e).count++;else{const a=new Xt,l=this._mutationObserverFactory.create(u=>a.next(u));l&&l.observe(e,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(e,{observer:l,stream:a,count:1})}return this._observedElements.get(e).stream}_unobserveElement(e){this._observedElements.has(e)&&(this._observedElements.get(e).count--,this._observedElements.get(e).count||this._cleanupObserver(e))}_cleanupObserver(e){if(this._observedElements.has(e)){const{observer:a,stream:l}=this._observedElements.get(e);a&&a.disconnect(),l.complete(),this._observedElements.delete(e)}}}return i.\u0275fac=function(e){return new(e||i)(pe(TV))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),ej=(()=>{class i{get disabled(){return this._disabled}set disabled(e){this._disabled=ka(e),this._disabled?this._unsubscribe():this._subscribe()}get debounce(){return this._debounce}set debounce(e){this._debounce=cN(e),this._subscribe()}constructor(e,a,l){this._contentObserver=e,this._elementRef=a,this._ngZone=l,this.event=new rn,this._disabled=!1,this._currentSubscription=null}ngAfterContentInit(){!this._currentSubscription&&!this.disabled&&this._subscribe()}ngOnDestroy(){this._unsubscribe()}_subscribe(){this._unsubscribe();const e=this._contentObserver.observe(this._elementRef);this._ngZone.runOutsideAngular(()=>{this._currentSubscription=(this.debounce?e.pipe(CV(this.debounce)):e).subscribe(this.event)})}_unsubscribe(){this._currentSubscription?.unsubscribe()}}return i.\u0275fac=function(e){return new(e||i)(ie(Z4),ie(cn),ie(me))},i.\u0275dir=je({type:i,selectors:[["","cdkObserveContent",""]],inputs:{disabled:["cdkObserveContentDisabled","disabled"],debounce:"debounce"},outputs:{event:"cdkObserveContent"},exportAs:["cdkObserveContent"]}),i})(),wV=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({providers:[TV]}),i})();class tj extends En{notifyNext(t,e,a,l,u){this.destination.next(e)}notifyError(t,e){this.destination.error(t)}notifyComplete(t){this.destination.complete()}}class nj extends En{constructor(t,e,a){super(),this.parent=t,this.outerValue=e,this.outerIndex=a,this.index=0}_next(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)}_error(t){this.parent.notifyError(t,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}function ij(i,t,e,a,l=new nj(i,e,a)){if(!l.closed)return t instanceof _n?t.subscribe(l):Vm(t)(l)}const IV={};function KL(...i){let t,e;return Sl(i[i.length-1])&&(e=i.pop()),"function"==typeof i[i.length-1]&&(t=i.pop()),1===i.length&&lr(i[0])&&(i=i[0]),cu(i,e).lift(new rj(t))}class rj{constructor(t){this.resultSelector=t}call(t,e){return e.subscribe(new oj(t,this.resultSelector))}}class oj extends tj{constructor(t,e){super(t),this.resultSelector=e,this.active=0,this.values=[],this.observables=[]}_next(t){this.values.push(IV),this.observables.push(t)}_complete(){const t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(let a=0;a<e;a++)this.add(ij(this,t[a],void 0,a))}}notifyComplete(t){0==(this.active-=1)&&this.destination.complete()}notifyNext(t,e,a){const l=this.values,f=this.toRespond?l[a]===IV?--this.toRespond:this.toRespond:0;l[a]=e,0===f&&(this.resultSelector?this._tryResultSelector(l):this.destination.next(l.slice()))}_tryResultSelector(t){let e;try{e=this.resultSelector.apply(this,t)}catch(a){return void this.destination.error(a)}this.destination.next(e)}}function dN(...i){return function sj(){return Ha(1)}()(ze(...i))}const RV=(()=>{function i(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return i.prototype=Object.create(Error.prototype),i})(),Zh=new _n(i=>i.complete());function uN(i){return i?function aj(i){return new _n(t=>i.schedule(()=>t.complete()))}(i):Zh}function Qr(i){return t=>0===i?uN():t.lift(new cj(i))}class cj{constructor(t){if(this.total=t,this.total<0)throw new RV}call(t,e){return e.subscribe(new lj(t,this.total))}}class lj extends En{constructor(t,e){super(t),this.total=e,this.count=0}_next(t){const e=this.total,a=++this.count;a<=e&&(this.destination.next(t),a===e&&(this.destination.complete(),this.unsubscribe()))}}function qL(...i){const t=i[i.length-1];return Sl(t)?(i.pop(),e=>dN(i,e,t)):e=>dN(i,e)}const AV=new Set;let Ov,dj=(()=>{class i{constructor(e){this._platform=e,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):hj}matchMedia(e){return(this._platform.WEBKIT||this._platform.BLINK)&&function uj(i){if(!AV.has(i))try{Ov||(Ov=document.createElement("style"),Ov.setAttribute("type","text/css"),document.head.appendChild(Ov)),Ov.sheet&&(Ov.sheet.insertRule(`@media ${i} {body{ }}`,0),AV.add(i))}catch(t){console.error(t)}}(e),this._matchMedia(e)}}return i.\u0275fac=function(e){return new(e||i)(pe(sr))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function hj(i){return{matches:"all"===i||""===i,media:i,addListener:()=>{},removeListener:()=>{}}}let pj=(()=>{class i{constructor(e,a){this._mediaMatcher=e,this._zone=a,this._queries=new Map,this._destroySubject=new Xt}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(e){return DV(lN(e)).some(l=>this._registerQuery(l).mql.matches)}observe(e){let u=KL(DV(lN(e)).map(f=>this._registerQuery(f).observable));return u=dN(u.pipe(Qr(1)),u.pipe(bV(1),CV(0))),u.pipe(At(f=>{const E={matches:!1,breakpoints:{}};return f.forEach(({matches:y,query:T})=>{E.matches=E.matches||y,E.breakpoints[T]=y}),E}))}_registerQuery(e){if(this._queries.has(e))return this._queries.get(e);const a=this._mediaMatcher.matchMedia(e),u={observable:new _n(f=>{const E=y=>this._zone.run(()=>f.next(y));return a.addListener(E),()=>{a.removeListener(E)}}).pipe(qL(a),At(({matches:f})=>({query:e,matches:f})),So(this._destroySubject)),mql:a};return this._queries.set(e,u),u}}return i.\u0275fac=function(e){return new(e||i)(pe(dj),pe(me))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function DV(i){return i.map(t=>t.split(",")).reduce((t,e)=>t.concat(e)).map(t=>t.trim())}function hN(i,t){return(i.getAttribute(t)||"").match(/\S+/g)||[]}const NV="cdk-describedby-message",pN="cdk-describedby-host";let YL=0,_j=(()=>{class i{constructor(e,a){this._platform=a,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+YL++,this._document=e,this._id=Ct(Cd)+"-"+YL++}describe(e,a,l){if(!this._canBeDescribed(e,a))return;const u=$L(a,l);"string"!=typeof a?(PV(a,this._id),this._messageRegistry.set(u,{messageElement:a,referenceCount:0})):this._messageRegistry.has(u)||this._createMessageElement(a,l),this._isElementDescribedByMessage(e,u)||this._addMessageReference(e,u)}removeDescription(e,a,l){if(!a||!this._isElementNode(e))return;const u=$L(a,l);if(this._isElementDescribedByMessage(e,u)&&this._removeMessageReference(e,u),"string"==typeof a){const f=this._messageRegistry.get(u);f&&0===f.referenceCount&&this._deleteMessageElement(u)}0===this._messagesContainer?.childNodes.length&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){const e=this._document.querySelectorAll(`[${pN}="${this._id}"]`);for(let a=0;a<e.length;a++)this._removeCdkDescribedByReferenceIds(e[a]),e[a].removeAttribute(pN);this._messagesContainer?.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(e,a){const l=this._document.createElement("div");PV(l,this._id),l.textContent=e,a&&l.setAttribute("role",a),this._createMessagesContainer(),this._messagesContainer.appendChild(l),this._messageRegistry.set($L(e,a),{messageElement:l,referenceCount:0})}_deleteMessageElement(e){this._messageRegistry.get(e)?.messageElement?.remove(),this._messageRegistry.delete(e)}_createMessagesContainer(){if(this._messagesContainer)return;const e="cdk-describedby-message-container",a=this._document.querySelectorAll(`.${e}[platform="server"]`);for(let u=0;u<a.length;u++)a[u].remove();const l=this._document.createElement("div");l.style.visibility="hidden",l.classList.add(e),l.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&l.setAttribute("platform","server"),this._document.body.appendChild(l),this._messagesContainer=l}_removeCdkDescribedByReferenceIds(e){const a=hN(e,"aria-describedby").filter(l=>0!=l.indexOf(NV));e.setAttribute("aria-describedby",a.join(" "))}_addMessageReference(e,a){const l=this._messageRegistry.get(a);(function fj(i,t,e){const a=hN(i,t);a.some(l=>l.trim()==e.trim())||(a.push(e.trim()),i.setAttribute(t,a.join(" ")))})(e,"aria-describedby",l.messageElement.id),e.setAttribute(pN,this._id),l.referenceCount++}_removeMessageReference(e,a){const l=this._messageRegistry.get(a);l.referenceCount--,function mj(i,t,e){const l=hN(i,t).filter(u=>u!=e.trim());l.length?i.setAttribute(t,l.join(" ")):i.removeAttribute(t)}(e,"aria-describedby",l.messageElement.id),e.removeAttribute(pN)}_isElementDescribedByMessage(e,a){const l=hN(e,"aria-describedby"),u=this._messageRegistry.get(a),f=u&&u.messageElement.id;return!!f&&-1!=l.indexOf(f)}_canBeDescribed(e,a){if(!this._isElementNode(e))return!1;if(a&&"object"==typeof a)return!0;const l=null==a?"":`${a}`.trim(),u=e.getAttribute("aria-label");return!(!l||u&&u.trim()===l)}_isElementNode(e){return e.nodeType===this._document.ELEMENT_NODE}}return i.\u0275fac=function(e){return new(e||i)(pe(Zt),pe(sr))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function $L(i,t){return"string"==typeof i?`${t||""}/${i}`:i}function PV(i,t){i.id||(i.id=`${NV}-${t}-${YL++}`)}function kV(i){return 0===i.buttons||0===i.offsetX&&0===i.offsetY}function xV(i){const t=i.touches&&i.touches[0]||i.changedTouches&&i.changedTouches[0];return!(!t||-1!==t.identifier||null!=t.radiusX&&1!==t.radiusX||null!=t.radiusY&&1!==t.radiusY)}const Sj=new Pe("cdk-input-modality-detector-options"),Cj={ignoreKeys:[18,17,224,91,16]},Nv=Go({passive:!0,capture:!0});let Tj=(()=>{class i{get mostRecentModality(){return this._modality.value}constructor(e,a,l,u){this._platform=e,this._mostRecentTarget=null,this._modality=new Xr(null),this._lastTouchMs=0,this._onKeydown=f=>{this._options?.ignoreKeys?.some(E=>E===f.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=pl(f))},this._onMousedown=f=>{Date.now()-this._lastTouchMs<650||(this._modality.next(kV(f)?"keyboard":"mouse"),this._mostRecentTarget=pl(f))},this._onTouchstart=f=>{xV(f)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=pl(f))},this._options={...Cj,...u},this.modalityDetected=this._modality.pipe(bV(1)),this.modalityChanged=this.modalityDetected.pipe(function G4(i,t){return e=>e.lift(new W4(i,t))}()),e.isBrowser&&a.runOutsideAngular(()=>{l.addEventListener("keydown",this._onKeydown,Nv),l.addEventListener("mousedown",this._onMousedown,Nv),l.addEventListener("touchstart",this._onTouchstart,Nv)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Nv),document.removeEventListener("mousedown",this._onMousedown,Nv),document.removeEventListener("touchstart",this._onTouchstart,Nv))}}return i.\u0275fac=function(e){return new(e||i)(pe(sr),pe(me),pe(Zt),pe(Sj,8))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const Ij=new Pe("cdk-focus-monitor-default-options"),fN=Go({passive:!0,capture:!0});let XL=(()=>{class i{constructor(e,a,l,u,f){this._ngZone=e,this._platform=a,this._inputModalityDetector=l,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new Xt,this._rootNodeFocusAndBlurListener=E=>{for(let T=pl(E);T;T=T.parentElement)"focus"===E.type?this._onFocus(E,T):this._onBlur(E,T)},this._document=u,this._detectionMode=f?.detectionMode||0}monitor(e,a=!1){const l=Jd(e);if(!this._platform.isBrowser||1!==l.nodeType)return ze(null);const u=function iN(i){if(function IT(){if(null==Iv){const i=typeof document<"u"?document.head:null;Iv=!(!i||!i.createShadowRoot&&!i.attachShadow)}return Iv}()){const t=i.getRootNode?i.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}(l)||this._getDocument(),f=this._elementInfo.get(l);if(f)return a&&(f.checkChildren=!0),f.subject;const E={checkChildren:a,subject:new Xt,rootNode:u};return this._elementInfo.set(l,E),this._registerGlobalListeners(E),E.subject}stopMonitoring(e){const a=Jd(e),l=this._elementInfo.get(a);l&&(l.subject.complete(),this._setClasses(a),this._elementInfo.delete(a),this._removeGlobalListeners(l))}focusVia(e,a,l){const u=Jd(e);u===this._getDocument().activeElement?this._getClosestElementsInfo(u).forEach(([E,y])=>this._originChanged(E,a,y)):(this._setOrigin(a),"function"==typeof u.focus&&u.focus(l))}ngOnDestroy(){this._elementInfo.forEach((e,a)=>this.stopMonitoring(a))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(e){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(e)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:e&&this._isLastInteractionFromInputLabel(e)?"mouse":"program"}_shouldBeAttributedToTouch(e){return 1===this._detectionMode||!!e?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(e,a){e.classList.toggle("cdk-focused",!!a),e.classList.toggle("cdk-touch-focused","touch"===a),e.classList.toggle("cdk-keyboard-focused","keyboard"===a),e.classList.toggle("cdk-mouse-focused","mouse"===a),e.classList.toggle("cdk-program-focused","program"===a)}_setOrigin(e,a=!1){this._ngZone.runOutsideAngular(()=>{this._origin=e,this._originFromTouchInteraction="touch"===e&&a,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(e,a){const l=this._elementInfo.get(a),u=pl(e);!l||!l.checkChildren&&a!==u||this._originChanged(a,this._getFocusOrigin(u),l)}_onBlur(e,a){const l=this._elementInfo.get(a);!l||l.checkChildren&&e.relatedTarget instanceof Node&&a.contains(e.relatedTarget)||(this._setClasses(a),this._emitOrigin(l,null))}_emitOrigin(e,a){e.subject.observers.length&&this._ngZone.run(()=>e.subject.next(a))}_registerGlobalListeners(e){if(!this._platform.isBrowser)return;const a=e.rootNode,l=this._rootNodeFocusListenerCount.get(a)||0;l||this._ngZone.runOutsideAngular(()=>{a.addEventListener("focus",this._rootNodeFocusAndBlurListener,fN),a.addEventListener("blur",this._rootNodeFocusAndBlurListener,fN)}),this._rootNodeFocusListenerCount.set(a,l+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(So(this._stopInputModalityDetector)).subscribe(u=>{this._setOrigin(u,!0)}))}_removeGlobalListeners(e){const a=e.rootNode;if(this._rootNodeFocusListenerCount.has(a)){const l=this._rootNodeFocusListenerCount.get(a);l>1?this._rootNodeFocusListenerCount.set(a,l-1):(a.removeEventListener("focus",this._rootNodeFocusAndBlurListener,fN),a.removeEventListener("blur",this._rootNodeFocusAndBlurListener,fN),this._rootNodeFocusListenerCount.delete(a))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(e,a,l){this._setClasses(e,a),this._emitOrigin(l,a),this._lastFocusOrigin=a}_getClosestElementsInfo(e){const a=[];return this._elementInfo.forEach((l,u)=>{(u===e||l.checkChildren&&u.contains(e))&&a.push([u,l])}),a}_isLastInteractionFromInputLabel(e){const{_mostRecentTarget:a,mostRecentModality:l}=this._inputModalityDetector;if("mouse"!==l||!a||a===e||"INPUT"!==e.nodeName&&"TEXTAREA"!==e.nodeName||e.disabled)return!1;const u=e.labels;if(u)for(let f=0;f<u.length;f++)if(u[f].contains(a))return!0;return!1}}return i.\u0275fac=function(e){return new(e||i)(pe(me),pe(sr),pe(Tj),pe(Zt,8),pe(Ij,8))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const FV="cdk-high-contrast-black-on-white",UV="cdk-high-contrast-white-on-black",JL="cdk-high-contrast-active";let VV=(()=>{class i{constructor(e,a){this._platform=e,this._document=a,this._breakpointSubscription=Ct(pj).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);const a=this._document.defaultView||window,l=a&&a.getComputedStyle?a.getComputedStyle(e):null,u=(l&&l.backgroundColor||"").replace(/ /g,"");switch(e.remove(),u){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const e=this._document.body.classList;e.remove(JL,FV,UV),this._hasCheckedHighContrastMode=!0;const a=this.getHighContrastMode();1===a?e.add(JL,FV):2===a&&e.add(JL,UV)}}}return i.\u0275fac=function(e){return new(e||i)(pe(sr),pe(Zt))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),Rj=(()=>{class i{constructor(e){e._applyBodyHighContrastModeCssClasses()}}return i.\u0275fac=function(e){return new(e||i)(pe(VV))},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({imports:[wV]}),i})();const Aj=new Pe("cdk-dir-doc",{providedIn:"root",factory:function Dj(){return Ct(Zt)}}),Oj=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let Pv=(()=>{class i{constructor(e){this.value="ltr",this.change=new rn,e&&(this.value=function Nj(i){const t=i?.toLowerCase()||"";return"auto"===t&&typeof navigator<"u"&&navigator?.language?Oj.test(navigator.language)?"rtl":"ltr":"rtl"===t?"rtl":"ltr"}((e.body?e.body.dir:null)||(e.documentElement?e.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}}return i.\u0275fac=function(e){return new(e||i)(pe(Aj,8))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),PT=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({}),i})();const Mj=new Pe("mat-sanity-checks",{providedIn:"root",factory:function Pj(){return!0}});let xa=(()=>{class i{constructor(e,a,l){this._sanityChecks=a,this._document=l,this._hasDoneGlobalChecks=!1,e._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(e){return!RT()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[e])}}return i.\u0275fac=function(e){return new(e||i)(pe(VV),pe(Mj,8),pe(Zt))},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({imports:[PT,PT]}),i})();function HV(i){return class extends i{get disabled(){return this._disabled}set disabled(t){this._disabled=ka(t)}constructor(...t){super(...t),this._disabled=!1}}}function GV(i,t){return class extends i{get color(){return this._color}set color(e){const a=e||this.defaultColor;a!==this._color&&(this._color&&this._elementRef.nativeElement.classList.remove(`mat-${this._color}`),a&&this._elementRef.nativeElement.classList.add(`mat-${a}`),this._color=a)}constructor(...e){super(...e),this.defaultColor=t,this.color=t}}}function WV(i){return class extends i{get disableRipple(){return this._disableRipple}set disableRipple(t){this._disableRipple=ka(t)}constructor(...t){super(...t),this._disableRipple=!1}}}function kj(i,t=0){return class extends i{get tabIndex(){return this.disabled?-1:this._tabIndex}set tabIndex(e){this._tabIndex=null!=e?cN(e):this.defaultTabIndex}constructor(...e){super(...e),this._tabIndex=t,this.defaultTabIndex=t}}}function xj(i){return class extends i{updateErrorState(){const t=this.errorState,u=(this.errorStateMatcher||this._defaultErrorStateMatcher).isErrorState(this.ngControl?this.ngControl.control:null,this._parentFormGroup||this._parentForm);u!==t&&(this.errorState=u,this.stateChanges.next())}constructor(...t){super(...t),this.errorState=!1}}}let Fj=(()=>{class i{isErrorState(e,a){return!!(e&&e.invalid&&(e.touched||a&&a.submitted))}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();class Uj{constructor(t,e,a,l=!1){this._renderer=t,this.element=e,this.config=a,this._animationForciblyDisabledThroughCss=l,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const zV=Go({passive:!0,capture:!0});class Vj{constructor(){this._events=new Map,this._delegateEventHandler=t=>{const e=pl(t);e&&this._events.get(t.type)?.forEach((a,l)=>{(l===e||l.contains(e))&&a.forEach(u=>u.handleEvent(t))})}}addHandler(t,e,a,l){const u=this._events.get(e);if(u){const f=u.get(a);f?f.add(l):u.set(a,new Set([l]))}else this._events.set(e,new Map([[a,new Set([l])]])),t.runOutsideAngular(()=>{document.addEventListener(e,this._delegateEventHandler,zV)})}removeHandler(t,e,a){const l=this._events.get(t);if(!l)return;const u=l.get(e);u&&(u.delete(a),0===u.size&&l.delete(e),0===l.size&&(this._events.delete(t),document.removeEventListener(t,this._delegateEventHandler,zV)))}}const KV={enterDuration:225,exitDuration:150},qV=Go({passive:!0,capture:!0}),YV=["mousedown","touchstart"],$V=["mouseup","mouseleave","touchend","touchcancel"];class kT{constructor(t,e,a,l){this._target=t,this._ngZone=e,this._platform=l,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,l.isBrowser&&(this._containerElement=Jd(a))}fadeInRipple(t,e,a={}){const l=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),u={...KV,...a.animation};a.centered&&(t=l.left+l.width/2,e=l.top+l.height/2);const f=a.radius||function jj(i,t,e){const a=Math.max(Math.abs(i-e.left),Math.abs(i-e.right)),l=Math.max(Math.abs(t-e.top),Math.abs(t-e.bottom));return Math.sqrt(a*a+l*l)}(t,e,l),E=t-l.left,y=e-l.top,T=u.enterDuration,R=document.createElement("div");R.classList.add("mat-ripple-element"),R.style.left=E-f+"px",R.style.top=y-f+"px",R.style.height=2*f+"px",R.style.width=2*f+"px",null!=a.color&&(R.style.backgroundColor=a.color),R.style.transitionDuration=`${T}ms`,this._containerElement.appendChild(R);const L=window.getComputedStyle(R),W=L.transitionDuration,q="none"===L.transitionProperty||"0s"===W||"0s, 0s"===W||0===l.width&&0===l.height,re=new Uj(this,R,a,q);R.style.transform="scale3d(1, 1, 1)",re.state=0,a.persistent||(this._mostRecentTransientRipple=re);let ce=null;return!q&&(T||u.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const Te=()=>this._finishRippleTransition(re),De=()=>this._destroyRipple(re);R.addEventListener("transitionend",Te),R.addEventListener("transitioncancel",De),ce={onTransitionEnd:Te,onTransitionCancel:De}}),this._activeRipples.set(re,ce),(q||!T)&&this._finishRippleTransition(re),re}fadeOutRipple(t){if(2===t.state||3===t.state)return;const e=t.element,a={...KV,...t.config.animation};e.style.transitionDuration=`${a.exitDuration}ms`,e.style.opacity="0",t.state=2,(t._animationForciblyDisabledThroughCss||!a.exitDuration)&&this._finishRippleTransition(t)}fadeOutAll(){this._getActiveRipples().forEach(t=>t.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(t=>{t.config.persistent||t.fadeOut()})}setupTriggerEvents(t){const e=Jd(t);!this._platform.isBrowser||!e||e===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=e,YV.forEach(a=>{kT._eventManager.addHandler(this._ngZone,a,e,this)}))}handleEvent(t){"mousedown"===t.type?this._onMousedown(t):"touchstart"===t.type?this._onTouchStart(t):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{$V.forEach(e=>{this._triggerElement.addEventListener(e,this,qV)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(t){0===t.state?this._startFadeOutTransition(t):2===t.state&&this._destroyRipple(t)}_startFadeOutTransition(t){const e=t===this._mostRecentTransientRipple,{persistent:a}=t.config;t.state=1,!a&&(!e||!this._isPointerDown)&&t.fadeOut()}_destroyRipple(t){const e=this._activeRipples.get(t)??null;this._activeRipples.delete(t),this._activeRipples.size||(this._containerRect=null),t===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),t.state=3,null!==e&&(t.element.removeEventListener("transitionend",e.onTransitionEnd),t.element.removeEventListener("transitioncancel",e.onTransitionCancel)),t.element.remove()}_onMousedown(t){const e=kV(t),a=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!e&&!a&&(this._isPointerDown=!0,this.fadeInRipple(t.clientX,t.clientY,this._target.rippleConfig))}_onTouchStart(t){if(!this._target.rippleDisabled&&!xV(t)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const e=t.changedTouches;for(let a=0;a<e.length;a++)this.fadeInRipple(e[a].clientX,e[a].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(t=>{!t.config.persistent&&(1===t.state||t.config.terminateOnPointerUp&&0===t.state)&&t.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const t=this._triggerElement;t&&(YV.forEach(e=>kT._eventManager.removeHandler(e,t,this)),this._pointerUpEventsRegistered&&$V.forEach(e=>t.removeEventListener(e,this,qV)))}}kT._eventManager=new Vj;const Hj=new Pe("mat-ripple-global-options");let QL=(()=>{class i{get disabled(){return this._disabled}set disabled(e){e&&this.fadeOutAllNonPersistent(),this._disabled=e,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(e){this._trigger=e,this._setupTriggerEventsIfEnabled()}constructor(e,a,l,u,f){this._elementRef=e,this._animationMode=f,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=u||{},this._rippleRenderer=new kT(this,a,e,l)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:{...this._globalOptions.animation,..."NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{},...this.animation},terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(e,a=0,l){return"number"==typeof e?this._rippleRenderer.fadeInRipple(e,a,{...this.rippleConfig,...l}):this._rippleRenderer.fadeInRipple(0,0,{...this.rippleConfig,...e})}}return i.\u0275fac=function(e){return new(e||i)(ie(cn),ie(me),ie(sr),ie(Hj,8),ie(Ca,8))},i.\u0275dir=je({type:i,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(e,a){2&e&&Bt("mat-ripple-unbounded",a.unbounded)},inputs:{color:["matRippleColor","color"],unbounded:["matRippleUnbounded","unbounded"],centered:["matRippleCentered","centered"],radius:["matRippleRadius","radius"],animation:["matRippleAnimation","animation"],disabled:["matRippleDisabled","disabled"],trigger:["matRippleTrigger","trigger"]},exportAs:["matRipple"]}),i})(),XV=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({imports:[xa,xa]}),i})();const Gj=["mat-button",""],Wj=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],zj=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"],Kj=[{selector:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{selector:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{selector:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{selector:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{selector:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{selector:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{selector:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],qj=GV(HV(WV(class{constructor(i){this._elementRef=i}})));let Yj=(()=>{class i extends qj{constructor(e,a,l,u){super(e),this._platform=a,this._ngZone=l,this._animationMode=u,this._focusMonitor=Ct(XL),this._isFab=!1;const f=e.nativeElement.classList;for(const E of Kj)this._hasHostAttributes(E.selector)&&E.mdcClasses.forEach(y=>{f.add(y)})}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(e="program",a){e?this._focusMonitor.focusVia(this._elementRef.nativeElement,e,a):this._elementRef.nativeElement.focus(a)}_hasHostAttributes(...e){return e.some(a=>this._elementRef.nativeElement.hasAttribute(a))}_isRippleDisabled(){return this.disableRipple||this.disabled}}return i.\u0275fac=function(e){qp()},i.\u0275dir=je({type:i,viewQuery:function(e,a){if(1&e&&ls(QL,5),2&e){let l;_i(l=bi())&&(a.ripple=l.first)}},features:[Ot]}),i})(),Xj=(()=>{class i extends Yj{constructor(e,a,l,u){super(e,a,l,u)}}return i.\u0275fac=function(e){return new(e||i)(ie(cn),ie(sr),ie(me),ie(Ca,8))},i.\u0275cmp=_r({type:i,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:7,hostBindings:function(e,a){2&e&&(zi("disabled",a.disabled||null),Bt("_mat-animation-noopable","NoopAnimations"===a._animationMode)("mat-unthemed",!a.color)("mat-mdc-button-base",!0))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color"},exportAs:["matButton"],features:[Ot],attrs:Gj,ngContentSelectors:zj,decls:8,vars:6,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],["matRipple","",1,"mat-mdc-button-ripple",3,"matRippleDisabled","matRippleTrigger"],[1,"mat-mdc-button-touch-target"]],template:function(e,a){1&e&&(Yu(Wj),Tt(0,"span",0),Sr(1),Ne(2,"span",1),Sr(3,1),Ge(),Sr(4,2),Tt(5,"span",2)(6,"span",3)(7,"span",4)),2&e&&(Bt("mdc-button__ripple",!a._isFab)("mdc-fab__ripple",a._isFab),Ze(6),nt("matRippleDisabled",a._isRippleDisabled())("matRippleTrigger",a._elementRef.nativeElement))},dependencies:[QL],styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(\n      100% + 4px\n    );width:calc(\n      100% + 4px\n    );display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{height:var(--mdc-text-button-container-height, 36px);border-radius:var(--mdc-text-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color, inherit)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-unelevated-button{height:var(--mdc-filled-button-container-height, 36px);border-radius:var(--mdc-filled-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color, transparent)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color, rgba(0, 0, 0, 0.12))}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color, inherit)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-raised-button{height:var(--mdc-protected-button-container-height, 36px);border-radius:var(--mdc-protected-button-container-shape, var(--mdc-shape-small, 4px));box-shadow:var(--mdc-protected-button-container-elevation, 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color, transparent)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color, rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color, inherit)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-raised-button.mdc-ripple-upgraded--background-focused,.mat-mdc-raised-button:not(.mdc-ripple-upgraded):focus{box-shadow:var(--mdc-protected-button-focus-container-elevation, 0px 2px 4px -1px rgba(0, 0, 0, 0.2), 0px 4px 5px 0px rgba(0, 0, 0, 0.14), 0px 1px 10px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation, 0px 2px 4px -1px rgba(0, 0, 0, 0.2), 0px 4px 5px 0px rgba(0, 0, 0, 0.14), 0px 1px 10px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled):active{box-shadow:var(--mdc-protected-button-pressed-container-elevation, 0px 5px 5px -3px rgba(0, 0, 0, 0.2), 0px 8px 10px 1px rgba(0, 0, 0, 0.14), 0px 3px 14px 2px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation, 0px 0px 0px 0px rgba(0, 0, 0, 0.2), 0px 0px 0px 0px rgba(0, 0, 0, 0.14), 0px 0px 0px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button{height:var(--mdc-outlined-button-container-height, 36px);border-radius:var(--mdc-outlined-button-container-shape, var(--mdc-shape-small, 4px));padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width, 1px)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color, inherit)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color, rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color, rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width, 1px)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width, 1px));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width, 1px))}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0;background-color:var(--mat-mdc-button-persistent-ripple-color)}.mat-mdc-button .mat-ripple-element,.mat-mdc-unelevated-button .mat-ripple-element,.mat-mdc-raised-button .mat-ripple-element,.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-mdc-button-ripple-color)}.mat-mdc-button .mdc-button__label,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-outlined-button .mdc-button__label{z-index:1}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button[disabled],.mat-mdc-unelevated-button[disabled],.mat-mdc-raised-button[disabled],.mat-mdc-outlined-button[disabled]{cursor:default;pointer-events:none}.mat-mdc-button .mat-mdc-button-touch-target,.mat-mdc-unelevated-button .mat-mdc-button-touch-target,.mat-mdc-raised-button .mat-mdc-button-touch-target,.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}[dir=rtl] .mat-mdc-button>.mat-icon,.mat-mdc-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:0}.mat-mdc-button .mdc-button__label+.mat-icon{margin-left:8px;margin-right:0}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon,.mat-mdc-button .mdc-button__label+.mat-icon[dir=rtl]{margin-left:0;margin-right:8px}.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem;margin-left:-4px;margin-right:8px}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon,[dir=rtl] .mat-mdc-raised-button>.mat-icon,[dir=rtl] .mat-mdc-outlined-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon[dir=rtl],.mat-mdc-raised-button>.mat-icon[dir=rtl],.mat-mdc-outlined-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:0}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon,[dir=rtl] .mat-mdc-raised-button>.mat-icon,[dir=rtl] .mat-mdc-outlined-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon[dir=rtl],.mat-mdc-raised-button>.mat-icon[dir=rtl],.mat-mdc-outlined-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:-4px}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon,.mat-mdc-raised-button .mdc-button__label+.mat-icon,.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-left:8px;margin-right:-4px}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon,[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon,[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon,.mat-mdc-unelevated-button .mdc-button__label+.mat-icon[dir=rtl],.mat-mdc-raised-button .mdc-button__label+.mat-icon[dir=rtl],.mat-mdc-outlined-button .mdc-button__label+.mat-icon[dir=rtl]{margin-left:-4px;margin-right:8px}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px) * -1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px) * -1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0}),i})(),Qj=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({imports:[xa,XV,xa]}),i})();const JV=Go({passive:!0});let Zj=(()=>{class i{constructor(e,a){this._platform=e,this._ngZone=a,this._monitoredElements=new Map}monitor(e){if(!this._platform.isBrowser)return Zh;const a=Jd(e),l=this._monitoredElements.get(a);if(l)return l.subject;const u=new Xt,f="cdk-text-field-autofilled",E=y=>{"cdk-text-field-autofill-start"!==y.animationName||a.classList.contains(f)?"cdk-text-field-autofill-end"===y.animationName&&a.classList.contains(f)&&(a.classList.remove(f),this._ngZone.run(()=>u.next({target:y.target,isAutofilled:!1}))):(a.classList.add(f),this._ngZone.run(()=>u.next({target:y.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{a.addEventListener("animationstart",E,JV),a.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(a,{subject:u,unlisten:()=>{a.removeEventListener("animationstart",E,JV)}}),u}stopMonitoring(e){const a=Jd(e),l=this._monitoredElements.get(a);l&&(l.unlisten(),l.subject.complete(),a.classList.remove("cdk-text-field-autofill-monitored"),a.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(a))}ngOnDestroy(){this._monitoredElements.forEach((e,a)=>this.stopMonitoring(a))}}return i.\u0275fac=function(e){return new(e||i)(pe(sr),pe(me))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),e5=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({}),i})();class QV{}class t5{}const Qd="*";function ZL(i,t){return{type:7,name:i,definitions:t,options:{}}}function xT(i,t=null){return{type:4,styles:t,timings:i}}function ZV(i,t=null){return{type:2,steps:i,options:t}}function _l(i){return{type:6,styles:i,offset:null}}function e2(i,t,e){return{type:0,name:i,styles:t,options:e}}function LT(i,t,e=null){return{type:1,expr:i,animation:t,options:e}}function e3(i){Promise.resolve().then(i)}class FT{constructor(t=0,e=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=t+e}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){e3(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(a=>a()),e.length=0}}class t3{constructor(t){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;let e=0,a=0,l=0;const u=this.players.length;0==u?e3(()=>this._onFinish()):this.players.forEach(f=>{f.onDone(()=>{++e==u&&this._onFinish()}),f.onDestroy(()=>{++a==u&&this._onDestroy()}),f.onStart(()=>{++l==u&&this._onStart()})}),this.totalTime=this.players.reduce((f,E)=>Math.max(f,E.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){const e=t*this.totalTime;this.players.forEach(a=>{const l=a.totalTime?Math.min(1,e/a.totalTime):1;a.setPosition(l)})}getPosition(){const t=this.players.reduce((e,a)=>null===e||a.totalTime>e.totalTime?a:e,null);return null!=t?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(a=>a()),e.length=0}}const t2="!",n5=["matFormFieldNotchedOutline",""],r5=["*"],o5=["textField"],s5=["iconPrefixContainer"],a5=["textPrefixContainer"];function c5(i,t){1&i&&Tt(0,"span",19)}function l5(i,t){if(1&i){const e=ga();Ne(0,"label",17),tn("cdkObserveContent",function(){return Fs(e),Us(ln(2)._refreshOutlineNotchWidth())}),Sr(1,1),en(2,c5,1,0,"span",18),Ge()}if(2&i){const e=ln(2);nt("floating",e._shouldLabelFloat())("cdkObserveContentDisabled",!e._hasOutline())("id",e._labelId),zi("for",e._control.id)("aria-owns",e._control.id),Ze(2),nt("ngIf",!e.hideRequiredMarker&&e._control.required)}}function d5(i,t){1&i&&en(0,l5,3,6,"label",16),2&i&&nt("ngIf",ln()._hasFloatingLabel())}function u5(i,t){1&i&&Tt(0,"div",20)}function h5(i,t){}function p5(i,t){1&i&&en(0,h5,0,0,"ng-template",22),2&i&&(ln(2),nt("ngTemplateOutlet",Qp(1)))}function f5(i,t){if(1&i&&(Ne(0,"div",21),en(1,p5,1,1,"ng-template",9),Ge()),2&i){const e=ln();nt("matFormFieldNotchedOutlineOpen",e._shouldLabelFloat())("matFormFieldNotchedOutlineLabelWidth",e._labelWidth),Ze(1),nt("ngIf",!e._forceDisplayInfixLabel())}}function m5(i,t){1&i&&(Ne(0,"div",23,24),Sr(2,2),Ge())}function _5(i,t){1&i&&(Ne(0,"div",25,26),Sr(2,3),Ge())}function g5(i,t){}function E5(i,t){1&i&&en(0,g5,0,0,"ng-template",22),2&i&&(ln(),nt("ngTemplateOutlet",Qp(1)))}function v5(i,t){1&i&&(Ne(0,"div",27),Sr(1,4),Ge())}function y5(i,t){1&i&&(Ne(0,"div",28),Sr(1,5),Ge())}function b5(i,t){1&i&&Tt(0,"div",29)}function S5(i,t){1&i&&(Ne(0,"div",30),Sr(1,6),Ge()),2&i&&nt("@transitionMessages",ln()._subscriptAnimationState)}function C5(i,t){if(1&i&&(Ne(0,"mat-hint",34),Ki(1),Ge()),2&i){const e=ln(2);nt("id",e._hintLabelId),Ze(1),dd(e.hintLabel)}}function T5(i,t){if(1&i&&(Ne(0,"div",31),en(1,C5,2,2,"mat-hint",32),Sr(2,7),Tt(3,"div",33),Sr(4,8),Ge()),2&i){const e=ln();nt("@transitionMessages",e._subscriptAnimationState),Ze(1),nt("ngIf",e.hintLabel)}}const w5=["*",[["mat-label"]],[["","matPrefix",""],["","matIconPrefix",""]],[["","matTextPrefix",""]],[["","matTextSuffix",""]],[["","matSuffix",""],["","matIconSuffix",""]],[["mat-error"],["","matError",""]],[["mat-hint",3,"align","end"]],[["mat-hint","align","end"]]],I5=["*","mat-label","[matPrefix], [matIconPrefix]","[matTextPrefix]","[matTextSuffix]","[matSuffix], [matIconSuffix]","mat-error, [matError]","mat-hint:not([align='end'])","mat-hint[align='end']"];let n2=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275dir=je({type:i,selectors:[["mat-label"]]}),i})();const R5=new Pe("MatError");let A5=0,n3=(()=>{class i{constructor(){this.align="start",this.id="mat-mdc-hint-"+A5++}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275dir=je({type:i,selectors:[["mat-hint"]],hostAttrs:[1,"mat-mdc-form-field-hint","mat-mdc-form-field-bottom-align"],hostVars:4,hostBindings:function(e,a){2&e&&(ud("id",a.id),zi("align",null),Bt("mat-mdc-form-field-hint-end","end"===a.align))},inputs:{align:"align",id:"id"}}),i})();const D5=new Pe("MatPrefix"),O5=new Pe("MatSuffix");let r3=(()=>{class i{constructor(e){this._elementRef=e,this.floating=!1}getWidth(){return function N5(i){if(null!==i.offsetParent)return i.scrollWidth;const e=i.cloneNode(!0);e.style.setProperty("position","absolute"),e.style.setProperty("transform","translate(-9999px, -9999px)"),document.documentElement.appendChild(e);const a=e.scrollWidth;return e.remove(),a}(this._elementRef.nativeElement)}get element(){return this._elementRef.nativeElement}}return i.\u0275fac=function(e){return new(e||i)(ie(cn))},i.\u0275dir=je({type:i,selectors:[["label","matFormFieldFloatingLabel",""]],hostAttrs:[1,"mdc-floating-label","mat-mdc-floating-label"],hostVars:2,hostBindings:function(e,a){2&e&&Bt("mdc-floating-label--float-above",a.floating)},inputs:{floating:"floating"}}),i})();const o3="mdc-line-ripple--active",mN="mdc-line-ripple--deactivating";let s3=(()=>{class i{constructor(e,a){this._elementRef=e,this._handleTransitionEnd=l=>{const u=this._elementRef.nativeElement.classList,f=u.contains(mN);"opacity"===l.propertyName&&f&&u.remove(o3,mN)},a.runOutsideAngular(()=>{e.nativeElement.addEventListener("transitionend",this._handleTransitionEnd)})}activate(){const e=this._elementRef.nativeElement.classList;e.remove(mN),e.add(o3)}deactivate(){this._elementRef.nativeElement.classList.add(mN)}ngOnDestroy(){this._elementRef.nativeElement.removeEventListener("transitionend",this._handleTransitionEnd)}}return i.\u0275fac=function(e){return new(e||i)(ie(cn),ie(me))},i.\u0275dir=je({type:i,selectors:[["div","matFormFieldLineRipple",""]],hostAttrs:[1,"mdc-line-ripple"]}),i})(),a3=(()=>{class i{constructor(e,a){this._elementRef=e,this._ngZone=a,this.labelWidth=0,this.open=!1}ngAfterViewInit(){const e=this._elementRef.nativeElement.querySelector(".mdc-floating-label");e?(this._elementRef.nativeElement.classList.add("mdc-notched-outline--upgraded"),"function"==typeof requestAnimationFrame&&(e.style.transitionDuration="0s",this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>e.style.transitionDuration="")}))):this._elementRef.nativeElement.classList.add("mdc-notched-outline--no-label")}_getNotchWidth(){return this.open?this.labelWidth>0?`calc(${this.labelWidth}px * var(--mat-mdc-form-field-floating-label-scale, 0.75) + 9px)`:"0px":null}}return i.\u0275fac=function(e){return new(e||i)(ie(cn),ie(me))},i.\u0275cmp=_r({type:i,selectors:[["div","matFormFieldNotchedOutline",""]],hostAttrs:[1,"mdc-notched-outline"],hostVars:2,hostBindings:function(e,a){2&e&&Bt("mdc-notched-outline--notched",a.open)},inputs:{labelWidth:["matFormFieldNotchedOutlineLabelWidth","labelWidth"],open:["matFormFieldNotchedOutlineOpen","open"]},attrs:n5,ngContentSelectors:r5,decls:4,vars:2,consts:[[1,"mdc-notched-outline__leading"],[1,"mdc-notched-outline__notch"],[1,"mdc-notched-outline__trailing"]],template:function(e,a){1&e&&(Yu(),Tt(0,"div",0),Ne(1,"div",1),Sr(2),Ge(),Tt(3,"div",2)),2&e&&(Ze(1),tc("width",a._getNotchWidth()))},encapsulation:2,changeDetection:0}),i})();const P5={transitionMessages:ZL("transitionMessages",[e2("enter",_l({opacity:1,transform:"translateY(0%)"})),LT("void => enter",[_l({opacity:0,transform:"translateY(-5px)"}),xT("300ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])};let c3=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275dir=je({type:i}),i})();const l3=new Pe("MatFormField"),M5=new Pe("MAT_FORM_FIELD_DEFAULT_OPTIONS");let d3=0,L5=(()=>{class i{get hideRequiredMarker(){return this._hideRequiredMarker}set hideRequiredMarker(e){this._hideRequiredMarker=ka(e)}get floatLabel(){return this._floatLabel||this._defaults?.floatLabel||"auto"}set floatLabel(e){e!==this._floatLabel&&(this._floatLabel=e,this._changeDetectorRef.markForCheck())}get appearance(){return this._appearance}set appearance(e){const a=this._appearance;this._appearance=e||this._defaults?.appearance||"fill","outline"===this._appearance&&this._appearance!==a&&(this._refreshOutlineNotchWidth(),this._needsOutlineLabelOffsetUpdateOnStable=!0)}get subscriptSizing(){return this._subscriptSizing||this._defaults?.subscriptSizing||"fixed"}set subscriptSizing(e){this._subscriptSizing=e||this._defaults?.subscriptSizing||"fixed"}get hintLabel(){return this._hintLabel}set hintLabel(e){this._hintLabel=e,this._processHints()}get _control(){return this._explicitFormFieldControl||this._formFieldControl}set _control(e){this._explicitFormFieldControl=e}constructor(e,a,l,u,f,E,y,T){this._elementRef=e,this._changeDetectorRef=a,this._ngZone=l,this._dir=u,this._platform=f,this._defaults=E,this._animationMode=y,this._document=T,this._hideRequiredMarker=!1,this.color="primary",this._appearance="fill",this._subscriptSizing=null,this._hintLabel="",this._hasIconPrefix=!1,this._hasTextPrefix=!1,this._hasIconSuffix=!1,this._hasTextSuffix=!1,this._labelId="mat-mdc-form-field-label-"+d3++,this._hintLabelId="mat-mdc-hint-"+d3++,this._subscriptAnimationState="",this._labelWidth=0,this._destroyed=new Xt,this._isFocused=null,this._needsOutlineLabelOffsetUpdateOnStable=!1,E&&(E.appearance&&(this.appearance=E.appearance),this._hideRequiredMarker=Boolean(E?.hideRequiredMarker),E.color&&(this.color=E.color))}ngAfterViewInit(){this._updateFocusState(),this._refreshOutlineNotchWidth(),this._document?.fonts?.ready?this._document.fonts.ready.then(()=>{this._refreshOutlineNotchWidth(),this._changeDetectorRef.markForCheck()}):setTimeout(()=>this._refreshOutlineNotchWidth(),100),this._subscriptAnimationState="enter",this._changeDetectorRef.detectChanges()}ngAfterContentInit(){this._assertFormFieldControl(),this._initializeControl(),this._initializeSubscript(),this._initializePrefixAndSuffix(),this._initializeOutlineLabelOffsetSubscriptions()}ngAfterContentChecked(){this._assertFormFieldControl()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}getLabelId(){return this._hasFloatingLabel()?this._labelId:null}getConnectedOverlayOrigin(){return this._textField||this._elementRef}_animateAndLockLabel(){this._hasFloatingLabel()&&(this.floatLabel="always")}_initializeControl(){const e=this._control;e.controlType&&this._elementRef.nativeElement.classList.add(`mat-mdc-form-field-type-${e.controlType}`),e.stateChanges.subscribe(()=>{this._updateFocusState(),this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),e.ngControl&&e.ngControl.valueChanges&&e.ngControl.valueChanges.pipe(So(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck())}_checkPrefixAndSuffixTypes(){this._hasIconPrefix=!!this._prefixChildren.find(e=>!e._isText),this._hasTextPrefix=!!this._prefixChildren.find(e=>e._isText),this._hasIconSuffix=!!this._suffixChildren.find(e=>!e._isText),this._hasTextSuffix=!!this._suffixChildren.find(e=>e._isText)}_initializePrefixAndSuffix(){this._checkPrefixAndSuffixTypes(),ey(this._prefixChildren.changes,this._suffixChildren.changes).subscribe(()=>{this._checkPrefixAndSuffixTypes(),this._changeDetectorRef.markForCheck()})}_initializeSubscript(){this._hintChildren.changes.subscribe(()=>{this._processHints(),this._changeDetectorRef.markForCheck()}),this._errorChildren.changes.subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._validateHints(),this._syncDescribedByIds()}_assertFormFieldControl(){}_updateFocusState(){this._control.focused&&!this._isFocused?(this._isFocused=!0,this._lineRipple?.activate()):!this._control.focused&&(this._isFocused||null===this._isFocused)&&(this._isFocused=!1,this._lineRipple?.deactivate()),this._textField?.nativeElement.classList.toggle("mdc-text-field--focused",this._control.focused)}_initializeOutlineLabelOffsetSubscriptions(){this._prefixChildren.changes.subscribe(()=>this._needsOutlineLabelOffsetUpdateOnStable=!0),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(So(this._destroyed)).subscribe(()=>{this._needsOutlineLabelOffsetUpdateOnStable&&(this._needsOutlineLabelOffsetUpdateOnStable=!1,this._updateOutlineLabelOffset())})}),this._dir.change.pipe(So(this._destroyed)).subscribe(()=>this._needsOutlineLabelOffsetUpdateOnStable=!0)}_shouldAlwaysFloat(){return"always"===this.floatLabel}_hasOutline(){return"outline"===this.appearance}_forceDisplayInfixLabel(){return!this._platform.isBrowser&&this._prefixChildren.length&&!this._shouldLabelFloat()}_hasFloatingLabel(){return!!this._labelChildNonStatic||!!this._labelChildStatic}_shouldLabelFloat(){return this._control.shouldLabelFloat||this._shouldAlwaysFloat()}_shouldForward(e){const a=this._control?this._control.ngControl:null;return a&&a[e]}_getDisplayedMessages(){return this._errorChildren&&this._errorChildren.length>0&&this._control.errorState?"error":"hint"}_refreshOutlineNotchWidth(){!this._hasOutline()||!this._floatingLabel||(this._labelWidth=this._floatingLabel.getWidth())}_processHints(){this._validateHints(),this._syncDescribedByIds()}_validateHints(){}_syncDescribedByIds(){if(this._control){let e=[];if(this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&e.push(...this._control.userAriaDescribedBy.split(" ")),"hint"===this._getDisplayedMessages()){const a=this._hintChildren?this._hintChildren.find(u=>"start"===u.align):null,l=this._hintChildren?this._hintChildren.find(u=>"end"===u.align):null;a?e.push(a.id):this._hintLabel&&e.push(this._hintLabelId),l&&e.push(l.id)}else this._errorChildren&&e.push(...this._errorChildren.map(a=>a.id));this._control.setDescribedByIds(e)}}_updateOutlineLabelOffset(){if(!this._platform.isBrowser||!this._hasOutline()||!this._floatingLabel)return;const e=this._floatingLabel.element;if(!this._iconPrefixContainer&&!this._textPrefixContainer)return void(e.style.transform="");if(!this._isAttachedToDom())return void(this._needsOutlineLabelOffsetUpdateOnStable=!0);const a=this._iconPrefixContainer?.nativeElement,l=this._textPrefixContainer?.nativeElement,u=a?.getBoundingClientRect().width??0,f=l?.getBoundingClientRect().width??0;e.style.transform=`var(\n        --mat-mdc-form-field-label-transform,\n        translateY(-50%) translateX(calc(${"rtl"===this._dir.value?"-1":"1"} * (${u+f}px + var(--mat-mdc-form-field-label-offset-x, 0px))))\n    )`}_isAttachedToDom(){const e=this._elementRef.nativeElement;if(e.getRootNode){const a=e.getRootNode();return a&&a!==e}return document.documentElement.contains(e)}}return i.\u0275fac=function(e){return new(e||i)(ie(cn),ie(te),ie(me),ie(Pv),ie(sr),ie(M5,8),ie(Ca,8),ie(Zt))},i.\u0275cmp=_r({type:i,selectors:[["mat-form-field"]],contentQueries:function(e,a,l){if(1&e&&(Sa(l,n2,5),Sa(l,n2,7),Sa(l,c3,5),Sa(l,D5,5),Sa(l,O5,5),Sa(l,R5,5),Sa(l,n3,5)),2&e){let u;_i(u=bi())&&(a._labelChildNonStatic=u.first),_i(u=bi())&&(a._labelChildStatic=u.first),_i(u=bi())&&(a._formFieldControl=u.first),_i(u=bi())&&(a._prefixChildren=u),_i(u=bi())&&(a._suffixChildren=u),_i(u=bi())&&(a._errorChildren=u),_i(u=bi())&&(a._hintChildren=u)}},viewQuery:function(e,a){if(1&e&&(ls(o5,5),ls(s5,5),ls(a5,5),ls(r3,5),ls(a3,5),ls(s3,5)),2&e){let l;_i(l=bi())&&(a._textField=l.first),_i(l=bi())&&(a._iconPrefixContainer=l.first),_i(l=bi())&&(a._textPrefixContainer=l.first),_i(l=bi())&&(a._floatingLabel=l.first),_i(l=bi())&&(a._notchedOutline=l.first),_i(l=bi())&&(a._lineRipple=l.first)}},hostAttrs:[1,"mat-mdc-form-field"],hostVars:42,hostBindings:function(e,a){2&e&&Bt("mat-mdc-form-field-label-always-float",a._shouldAlwaysFloat())("mat-mdc-form-field-has-icon-prefix",a._hasIconPrefix)("mat-mdc-form-field-has-icon-suffix",a._hasIconSuffix)("mat-form-field-invalid",a._control.errorState)("mat-form-field-disabled",a._control.disabled)("mat-form-field-autofilled",a._control.autofilled)("mat-form-field-no-animations","NoopAnimations"===a._animationMode)("mat-form-field-appearance-fill","fill"==a.appearance)("mat-form-field-appearance-outline","outline"==a.appearance)("mat-form-field-hide-placeholder",a._hasFloatingLabel()&&!a._shouldLabelFloat())("mat-focused",a._control.focused)("mat-primary","accent"!==a.color&&"warn"!==a.color)("mat-accent","accent"===a.color)("mat-warn","warn"===a.color)("ng-untouched",a._shouldForward("untouched"))("ng-touched",a._shouldForward("touched"))("ng-pristine",a._shouldForward("pristine"))("ng-dirty",a._shouldForward("dirty"))("ng-valid",a._shouldForward("valid"))("ng-invalid",a._shouldForward("invalid"))("ng-pending",a._shouldForward("pending"))},inputs:{hideRequiredMarker:"hideRequiredMarker",color:"color",floatLabel:"floatLabel",appearance:"appearance",subscriptSizing:"subscriptSizing",hintLabel:"hintLabel"},exportAs:["matFormField"],features:[An([{provide:l3,useExisting:i}])],ngContentSelectors:I5,decls:18,vars:23,consts:[["labelTemplate",""],[1,"mat-mdc-text-field-wrapper","mdc-text-field",3,"click"],["textField",""],["class","mat-mdc-form-field-focus-overlay",4,"ngIf"],[1,"mat-mdc-form-field-flex"],["matFormFieldNotchedOutline","",3,"matFormFieldNotchedOutlineOpen","matFormFieldNotchedOutlineLabelWidth",4,"ngIf"],["class","mat-mdc-form-field-icon-prefix",4,"ngIf"],["class","mat-mdc-form-field-text-prefix",4,"ngIf"],[1,"mat-mdc-form-field-infix"],[3,"ngIf"],["class","mat-mdc-form-field-text-suffix",4,"ngIf"],["class","mat-mdc-form-field-icon-suffix",4,"ngIf"],["matFormFieldLineRipple","",4,"ngIf"],[1,"mat-mdc-form-field-subscript-wrapper","mat-mdc-form-field-bottom-align",3,"ngSwitch"],["class","mat-mdc-form-field-error-wrapper",4,"ngSwitchCase"],["class","mat-mdc-form-field-hint-wrapper",4,"ngSwitchCase"],["matFormFieldFloatingLabel","",3,"floating","cdkObserveContentDisabled","id","cdkObserveContent",4,"ngIf"],["matFormFieldFloatingLabel","",3,"floating","cdkObserveContentDisabled","id","cdkObserveContent"],["aria-hidden","true","class","mat-mdc-form-field-required-marker mdc-floating-label--required",4,"ngIf"],["aria-hidden","true",1,"mat-mdc-form-field-required-marker","mdc-floating-label--required"],[1,"mat-mdc-form-field-focus-overlay"],["matFormFieldNotchedOutline","",3,"matFormFieldNotchedOutlineOpen","matFormFieldNotchedOutlineLabelWidth"],[3,"ngTemplateOutlet"],[1,"mat-mdc-form-field-icon-prefix"],["iconPrefixContainer",""],[1,"mat-mdc-form-field-text-prefix"],["textPrefixContainer",""],[1,"mat-mdc-form-field-text-suffix"],[1,"mat-mdc-form-field-icon-suffix"],["matFormFieldLineRipple",""],[1,"mat-mdc-form-field-error-wrapper"],[1,"mat-mdc-form-field-hint-wrapper"],[3,"id",4,"ngIf"],[1,"mat-mdc-form-field-hint-spacer"],[3,"id"]],template:function(e,a){1&e&&(Yu(w5),en(0,d5,1,1,"ng-template",null,0,KS),Ne(2,"div",1,2),tn("click",function(u){return a._control.onContainerClick&&a._control.onContainerClick(u)}),en(4,u5,1,0,"div",3),Ne(5,"div",4),en(6,f5,2,3,"div",5),en(7,m5,3,0,"div",6),en(8,_5,3,0,"div",7),Ne(9,"div",8),en(10,E5,1,1,"ng-template",9),Sr(11),Ge(),en(12,v5,2,0,"div",10),en(13,y5,2,0,"div",11),Ge(),en(14,b5,1,0,"div",12),Ge(),Ne(15,"div",13),en(16,S5,2,1,"div",14),en(17,T5,5,2,"div",15),Ge()),2&e&&(Ze(2),Bt("mdc-text-field--filled",!a._hasOutline())("mdc-text-field--outlined",a._hasOutline())("mdc-text-field--no-label",!a._hasFloatingLabel())("mdc-text-field--disabled",a._control.disabled)("mdc-text-field--invalid",a._control.errorState),Ze(2),nt("ngIf",!a._hasOutline()&&!a._control.disabled),Ze(2),nt("ngIf",a._hasOutline()),Ze(1),nt("ngIf",a._hasIconPrefix),Ze(1),nt("ngIf",a._hasTextPrefix),Ze(2),nt("ngIf",!a._hasOutline()||a._forceDisplayInfixLabel()),Ze(2),nt("ngIf",a._hasTextSuffix),Ze(1),nt("ngIf",a._hasIconSuffix),Ze(1),nt("ngIf",!a._hasOutline()),Ze(1),Bt("mat-mdc-form-field-subscript-dynamic-size","dynamic"===a.subscriptSizing),nt("ngSwitch",a._getDisplayedMessages()),Ze(1),nt("ngSwitchCase","error"),Ze(1),nt("ngSwitchCase","hint"))},dependencies:[hc,VD,pc,IE,ej,n3,r3,a3,s3],styles:['.mdc-text-field{border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:0;border-bottom-left-radius:0;display:inline-flex;align-items:baseline;padding:0 16px;position:relative;box-sizing:border-box;overflow:hidden;will-change:opacity,transform,color}.mdc-text-field .mdc-floating-label{top:50%;transform:translateY(-50%);pointer-events:none}.mdc-text-field__input{height:28px;width:100%;min-width:0;border:none;border-radius:0;background:none;appearance:none;padding:0}.mdc-text-field__input::-ms-clear{display:none}.mdc-text-field__input::-webkit-calendar-picker-indicator{display:none}.mdc-text-field__input:focus{outline:none}.mdc-text-field__input:invalid{box-shadow:none}@media all{.mdc-text-field__input::placeholder{opacity:0}}@media all{.mdc-text-field__input:-ms-input-placeholder{opacity:0}}@media all{.mdc-text-field--no-label .mdc-text-field__input::placeholder,.mdc-text-field--focused .mdc-text-field__input::placeholder{opacity:1}}@media all{.mdc-text-field--no-label .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mdc-text-field__input:-ms-input-placeholder{opacity:1}}.mdc-text-field__affix{height:28px;opacity:0;white-space:nowrap}.mdc-text-field--label-floating .mdc-text-field__affix,.mdc-text-field--no-label .mdc-text-field__affix{opacity:1}@supports(-webkit-hyphens: none){.mdc-text-field--outlined .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field__affix--prefix,.mdc-text-field__affix--prefix[dir=rtl]{padding-left:2px;padding-right:0}.mdc-text-field--end-aligned .mdc-text-field__affix--prefix{padding-left:0;padding-right:12px}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--end-aligned .mdc-text-field__affix--prefix[dir=rtl]{padding-left:12px;padding-right:0}.mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field__affix--suffix,.mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:12px}.mdc-text-field--end-aligned .mdc-text-field__affix--suffix{padding-left:2px;padding-right:0}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--end-aligned .mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:2px}.mdc-text-field--filled{height:56px}.mdc-text-field--filled::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}.mdc-text-field--filled .mdc-floating-label{left:16px;right:initial}[dir=rtl] .mdc-text-field--filled .mdc-floating-label,.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:16px}.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{height:100%}.mdc-text-field--filled.mdc-text-field--no-label .mdc-floating-label{display:none}.mdc-text-field--filled.mdc-text-field--no-label::before{display:none}@supports(-webkit-hyphens: none){.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field--outlined{height:56px;overflow:visible}.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) scale(1)}.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) scale(0.75)}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--outlined .mdc-text-field__input{height:100%}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-shape-small, 4px)}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading[dir=rtl]{border-top-left-radius:0;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px, var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px, var(--mdc-shape-small, 4px))*2)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing{border-top-left-radius:0;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing[dir=rtl]{border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-shape-small, 4px)}@supports(top: max(0%)){.mdc-text-field--outlined{padding-left:max(16px, calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px, var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-left:max(16px, calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-right:max(16px, var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-left:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-right:max(16px, var(--mdc-shape-small, 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-right:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:max(16px, var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-right:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-left:max(16px, calc(var(--mdc-shape-small, 4px) + 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-right:max(16px, calc(var(--mdc-shape-small, 4px) + 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:1px}.mdc-text-field--outlined .mdc-floating-label{left:4px;right:initial}[dir=rtl] .mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:4px}.mdc-text-field--outlined .mdc-text-field__input{display:flex;border:none !important;background-color:rgba(0,0,0,0)}.mdc-text-field--outlined .mdc-notched-outline{z-index:1}.mdc-text-field--textarea{flex-direction:column;align-items:center;width:auto;height:auto;padding:0}.mdc-text-field--textarea .mdc-floating-label{top:19px}.mdc-text-field--textarea .mdc-floating-label:not(.mdc-floating-label--float-above){transform:none}.mdc-text-field--textarea .mdc-text-field__input{flex-grow:1;height:auto;min-height:1.5rem;overflow-x:hidden;overflow-y:auto;box-sizing:border-box;resize:none;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--filled::before{display:none}.mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-10.25px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--filled .mdc-text-field__input{margin-top:23px;margin-bottom:9px}.mdc-text-field--textarea.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-27.25px) scale(1)}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-24.75px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label{top:18px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field__input{margin-bottom:2px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter{align-self:flex-end;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::after{display:inline-block;width:0;height:16px;content:"";vertical-align:-16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::before{display:none}.mdc-text-field__resizer{align-self:stretch;display:inline-flex;flex-direction:column;flex-grow:1;max-height:100%;max-width:100%;min-height:56px;min-width:fit-content;min-width:-moz-available;min-width:-webkit-fill-available;overflow:hidden;resize:both}.mdc-text-field--filled .mdc-text-field__resizer{transform:translateY(-1px)}.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateY(1px)}.mdc-text-field--outlined .mdc-text-field__resizer{transform:translateX(-1px) translateY(-1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer,.mdc-text-field--outlined .mdc-text-field__resizer[dir=rtl]{transform:translateX(1px) translateY(-1px)}.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateX(1px) translateY(1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input[dir=rtl],.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter[dir=rtl]{transform:translateX(-1px) translateY(1px)}.mdc-text-field--with-leading-icon{padding-left:0;padding-right:16px}[dir=rtl] .mdc-text-field--with-leading-icon,.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:16px;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 48px);left:48px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:48px}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100% / 0.75 - 64px / 0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label{left:36px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:36px}.mdc-text-field--with-leading-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) translateX(-32px) scale(1)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-37.25px) translateX(32px) scale(1)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) translateX(-32px) scale(0.75)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl],.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-34.75px) translateX(32px) scale(0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--with-trailing-icon{padding-left:16px;padding-right:0}[dir=rtl] .mdc-text-field--with-trailing-icon,.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0;padding-right:16px}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 64px)}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100% / 0.75 - 64px / 0.75)}.mdc-text-field--with-trailing-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 96px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100% / 0.75 - 96px / 0.75)}.mdc-text-field-helper-line{display:flex;justify-content:space-between;box-sizing:border-box}.mdc-text-field+.mdc-text-field-helper-line{padding-right:16px;padding-left:16px}.mdc-form-field>.mdc-text-field+label{align-self:flex-start}.mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--focused .mdc-notched-outline__trailing{border-width:2px}.mdc-text-field--focused+.mdc-text-field-helper-line .mdc-text-field-helper-text:not(.mdc-text-field-helper-text--validation-msg){opacity:1}.mdc-text-field--focused.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:2px}.mdc-text-field--focused.mdc-text-field--outlined.mdc-text-field--textarea .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--invalid+.mdc-text-field-helper-line .mdc-text-field-helper-text--validation-msg{opacity:1}.mdc-text-field--disabled{pointer-events:none}@media screen and (forced-colors: active){.mdc-text-field--disabled .mdc-text-field__input{background-color:Window}.mdc-text-field--disabled .mdc-floating-label{z-index:1}}.mdc-text-field--disabled .mdc-floating-label{cursor:default}.mdc-text-field--disabled.mdc-text-field--filled .mdc-text-field__ripple{display:none}.mdc-text-field--disabled .mdc-text-field__input{pointer-events:auto}.mdc-text-field--end-aligned .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--end-aligned .mdc-text-field__input[dir=rtl]{text-align:left}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix{direction:ltr}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--leading,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--leading{order:1}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{order:2}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input{order:3}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{order:4}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--trailing,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--trailing{order:5}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--prefix{padding-right:12px}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--suffix{padding-left:2px}.mdc-floating-label{position:absolute;left:0;-webkit-transform-origin:left top;transform-origin:left top;line-height:1.15rem;text-align:left;text-overflow:ellipsis;white-space:nowrap;cursor:text;overflow:hidden;will-change:transform}[dir=rtl] .mdc-floating-label,.mdc-floating-label[dir=rtl]{right:0;left:auto;-webkit-transform-origin:right top;transform-origin:right top;text-align:right}.mdc-floating-label--float-above{cursor:auto}.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after{margin-left:1px;margin-right:0px;content:"*"}[dir=rtl] .mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after,.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)[dir=rtl]::after{margin-left:0;margin-right:1px}.mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-notched-outline{display:flex;position:absolute;top:0;right:0;left:0;box-sizing:border-box;width:100%;max-width:100%;height:100%;text-align:left;pointer-events:none}[dir=rtl] .mdc-notched-outline,.mdc-notched-outline[dir=rtl]{text-align:right}.mdc-notched-outline__leading,.mdc-notched-outline__notch,.mdc-notched-outline__trailing{box-sizing:border-box;height:100%;border-top:1px solid;border-bottom:1px solid;pointer-events:none}.mdc-notched-outline__leading{border-left:1px solid;border-right:none;width:12px}[dir=rtl] .mdc-notched-outline__leading,.mdc-notched-outline__leading[dir=rtl]{border-left:none;border-right:1px solid}.mdc-notched-outline__trailing{border-left:none;border-right:1px solid;flex-grow:1}[dir=rtl] .mdc-notched-outline__trailing,.mdc-notched-outline__trailing[dir=rtl]{border-left:1px solid;border-right:none}.mdc-notched-outline__notch{flex:0 0 auto;width:auto;max-width:calc(100% - 12px * 2)}.mdc-notched-outline .mdc-floating-label{display:inline-block;position:relative;max-width:100%}.mdc-notched-outline .mdc-floating-label--float-above{text-overflow:clip}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:133.3333333333%}.mdc-notched-outline--notched .mdc-notched-outline__notch{padding-left:0;padding-right:8px;border-top:none}[dir=rtl] .mdc-notched-outline--notched .mdc-notched-outline__notch,.mdc-notched-outline--notched .mdc-notched-outline__notch[dir=rtl]{padding-left:8px;padding-right:0}.mdc-notched-outline--no-label .mdc-notched-outline__notch{display:none}.mdc-line-ripple::before,.mdc-line-ripple::after{position:absolute;bottom:0;left:0;width:100%;border-bottom-style:solid;content:""}.mdc-line-ripple::before{border-bottom-width:1px}.mdc-line-ripple::after{border-bottom-width:2px}.mdc-line-ripple::before{z-index:1}.mdc-line-ripple::after{transform:scaleX(0);opacity:0;z-index:2}.mdc-line-ripple--active::after{transform:scaleX(1);opacity:1}.mdc-line-ripple--deactivating::after{opacity:0}.mat-mdc-form-field-textarea-control{vertical-align:middle;resize:vertical;box-sizing:border-box;height:auto;margin:0;padding:0;border:none;overflow:auto}.mat-mdc-form-field-input-control.mat-mdc-form-field-input-control{font:inherit;letter-spacing:inherit;text-decoration:inherit;text-transform:inherit;border:none}.mat-mdc-form-field .mat-mdc-floating-label.mdc-floating-label{line-height:normal;pointer-events:all}.mdc-text-field--no-label:not(.mdc-text-field--textarea) .mat-mdc-form-field-input-control.mdc-text-field__input,.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control{height:auto}.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control.mdc-text-field__input[type=color]{height:23px}.mat-mdc-text-field-wrapper{height:auto;flex:auto}.mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-left:0;--mat-mdc-form-field-label-offset-x: -16px}.mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-right:0}[dir=rtl] .mat-mdc-text-field-wrapper{padding-left:16px;padding-right:16px}[dir=rtl] .mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-left:0}[dir=rtl] .mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-right:0}.mat-mdc-form-field-label-always-float .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms;opacity:1}.mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-floating-label{left:auto;right:auto}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-text-field__input{display:inline-block}.mat-mdc-form-field .mat-mdc-text-field-wrapper.mdc-text-field .mdc-notched-outline__notch{padding-top:0}.mat-mdc-text-field-wrapper::before{content:none}.mat-mdc-form-field-subscript-wrapper{box-sizing:border-box;width:100%;position:relative}.mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-error-wrapper{position:absolute;top:0;left:0;right:0;padding:0 16px}.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-error-wrapper{position:static}.mat-mdc-form-field-bottom-align::before{content:"";display:inline-block;height:16px}.mat-mdc-form-field-bottom-align.mat-mdc-form-field-subscript-dynamic-size::before{content:unset}.mat-mdc-form-field-hint-end{order:1}.mat-mdc-form-field-hint-wrapper{display:flex}.mat-mdc-form-field-hint-spacer{flex:1 0 1em}.mat-mdc-form-field-error{display:block}.mat-mdc-form-field-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;opacity:0;pointer-events:none}select.mat-mdc-form-field-input-control{-moz-appearance:none;-webkit-appearance:none;background-color:rgba(0,0,0,0);display:inline-flex;box-sizing:border-box}select.mat-mdc-form-field-input-control:not(:disabled){cursor:pointer}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{content:"";width:0;height:0;border-left:5px solid rgba(0,0,0,0);border-right:5px solid rgba(0,0,0,0);border-top:5px solid;position:absolute;right:0;top:50%;margin-top:-2.5px;pointer-events:none}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{right:auto;left:0}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:15px}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:0;padding-left:15px}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-mdc-text-field-wrapper{outline:solid 1px}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-form-field-disabled .mat-mdc-text-field-wrapper{outline-color:GrayText}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-focused .mat-mdc-text-field-wrapper{outline:dashed 3px}.cdk-high-contrast-active .mat-mdc-form-field.mat-focused .mdc-notched-outline{border:dashed 3px}.mat-mdc-form-field-input-control[type=date],.mat-mdc-form-field-input-control[type=datetime],.mat-mdc-form-field-input-control[type=datetime-local],.mat-mdc-form-field-input-control[type=month],.mat-mdc-form-field-input-control[type=week],.mat-mdc-form-field-input-control[type=time]{line-height:1}.mat-mdc-form-field-input-control::-webkit-datetime-edit{line-height:1;padding:0;margin-bottom:-2px}.mat-mdc-form-field{--mat-mdc-form-field-floating-label-scale: 0.75;display:inline-flex;flex-direction:column;min-width:0;text-align:left}[dir=rtl] .mat-mdc-form-field{text-align:right}.mat-mdc-form-field-flex{display:inline-flex;align-items:baseline;box-sizing:border-box;width:100%}.mat-mdc-text-field-wrapper{width:100%}.mat-mdc-form-field-icon-prefix,.mat-mdc-form-field-icon-suffix{align-self:center;line-height:0;pointer-events:auto}.mat-mdc-form-field-icon-prefix,[dir=rtl] .mat-mdc-form-field-icon-suffix{padding:0 4px 0 0}.mat-mdc-form-field-icon-suffix,[dir=rtl] .mat-mdc-form-field-icon-prefix{padding:0 0 0 4px}.mat-mdc-form-field-icon-prefix>.mat-icon,.mat-mdc-form-field-icon-suffix>.mat-icon{padding:12px;box-sizing:content-box}.mat-mdc-form-field-subscript-wrapper .mat-icon,.mat-mdc-form-field label .mat-icon{width:1em;height:1em;font-size:inherit}.mat-mdc-form-field-infix{flex:auto;min-width:0;width:180px;position:relative;box-sizing:border-box}.mat-mdc-form-field .mdc-notched-outline__notch{margin-left:-1px;-webkit-clip-path:inset(-9em -999em -9em 1px);clip-path:inset(-9em -999em -9em 1px)}[dir=rtl] .mat-mdc-form-field .mdc-notched-outline__notch{margin-left:0;margin-right:-1px;-webkit-clip-path:inset(-9em 1px -9em -999em);clip-path:inset(-9em 1px -9em -999em)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition-delay:40ms;transition-duration:110ms}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__affix{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled.mdc-ripple-upgraded--background-focused .mdc-text-field__ripple::before,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled:not(.mdc-ripple-upgraded):focus .mdc-text-field__ripple::before{transition-duration:75ms}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined{0%{transform:translateX(calc(0 - 0%)) translateY(-34.75px) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(-34.75px) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(-34.75px) scale(0.75)}100%{transform:translateX(calc(0 - 0%)) translateY(-34.75px) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea{transition:none}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-filled 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-filled{0%{transform:translateX(calc(0 - 0%)) translateY(-10.25px) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(-10.25px) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(-10.25px) scale(0.75)}100%{transform:translateX(calc(0 - 0%)) translateY(-10.25px) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-outlined{0%{transform:translateX(calc(0 - 0%)) translateY(-24.75px) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(-24.75px) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(-24.75px) scale(0.75)}100%{transform:translateX(calc(0 - 0%)) translateY(-24.75px) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon{0%{transform:translateX(calc(0 - 32px)) translateY(-34.75px) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 32px)) translateY(-34.75px) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 32px)) translateY(-34.75px) scale(0.75)}100%{transform:translateX(calc(0 - 32px)) translateY(-34.75px) scale(0.75)}}[dir=rtl] .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined[dir=rtl] .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon-rtl{0%{transform:translateX(calc(0 - -32px)) translateY(-34.75px) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - -32px)) translateY(-34.75px) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - -32px)) translateY(-34.75px) scale(0.75)}100%{transform:translateX(calc(0 - -32px)) translateY(-34.75px) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-floating-label{transition:transform 150ms cubic-bezier(0.4, 0, 0.2, 1),color 150ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-standard 250ms 1}@keyframes mdc-floating-label-shake-float-above-standard{0%{transform:translateX(calc(0 - 0%)) translateY(-106%) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(-106%) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(-106%) scale(0.75)}100%{transform:translateX(calc(0 - 0%)) translateY(-106%) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-line-ripple::after{transition:transform 180ms cubic-bezier(0.4, 0, 0.2, 1),opacity 180ms cubic-bezier(0.4, 0, 0.2, 1)}'],encapsulation:2,data:{animation:[P5.transitionMessages]},changeDetection:0}),i})(),p3=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({imports:[xa,Kf,wV,xa]}),i})();const F5=new Pe("MAT_INPUT_VALUE_ACCESSOR"),U5=["button","checkbox","file","hidden","image","radio","range","reset","submit"];let V5=0;const B5=xj(class{constructor(i,t,e,a){this._defaultErrorStateMatcher=i,this._parentForm=t,this._parentFormGroup=e,this.ngControl=a,this.stateChanges=new Xt}});let j5=(()=>{class i extends B5{get disabled(){return this._disabled}set disabled(e){this._disabled=ka(e),this.focused&&(this.focused=!1,this.stateChanges.next())}get id(){return this._id}set id(e){this._id=e||this._uid}get required(){return this._required??this.ngControl?.control?.hasValidator(DO.required)??!1}set required(e){this._required=ka(e)}get type(){return this._type}set type(e){this._type=e||"text",this._validateType(),!this._isTextarea&&Jh().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get value(){return this._inputValueAccessor.value}set value(e){e!==this.value&&(this._inputValueAccessor.value=e,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(e){this._readonly=ka(e)}constructor(e,a,l,u,f,E,y,T,R,L){super(E,u,f,l),this._elementRef=e,this._platform=a,this._autofillMonitor=T,this._formField=L,this._uid="mat-input-"+V5++,this.focused=!1,this.stateChanges=new Xt,this.controlType="mat-input",this.autofilled=!1,this._disabled=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(q=>Jh().has(q)),this._iOSKeyupListener=q=>{const re=q.target;!re.value&&0===re.selectionStart&&0===re.selectionEnd&&(re.setSelectionRange(1,1),re.setSelectionRange(0,0))};const H=this._elementRef.nativeElement,W=H.nodeName.toLowerCase();this._inputValueAccessor=y||H,this._previousNativeValue=this.value,this.id=this.id,a.IOS&&R.runOutsideAngular(()=>{e.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._isServer=!this._platform.isBrowser,this._isNativeSelect="select"===W,this._isTextarea="textarea"===W,this._isInFormField=!!L,this._isNativeSelect&&(this.controlType=H.multiple?"mat-native-select-multiple":"mat-native-select")}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(e=>{this.autofilled=e.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener)}ngDoCheck(){this.ngControl&&(this.updateErrorState(),null!==this.ngControl.disabled&&this.ngControl.disabled!==this.disabled&&(this.disabled=this.ngControl.disabled,this.stateChanges.next())),this._dirtyCheckNativeValue(),this._dirtyCheckPlaceholder()}focus(e){this._elementRef.nativeElement.focus(e)}_focusChanged(e){e!==this.focused&&(this.focused=e,this.stateChanges.next())}_onInput(){}_dirtyCheckNativeValue(){const e=this._elementRef.nativeElement.value;this._previousNativeValue!==e&&(this._previousNativeValue=e,this.stateChanges.next())}_dirtyCheckPlaceholder(){const e=this._getPlaceholder();if(e!==this._previousPlaceholder){const a=this._elementRef.nativeElement;this._previousPlaceholder=e,e?a.setAttribute("placeholder",e):a.removeAttribute("placeholder")}}_getPlaceholder(){return this.placeholder||null}_validateType(){U5.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){let e=this._elementRef.nativeElement.validity;return e&&e.badInput}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}get shouldLabelFloat(){if(this._isNativeSelect){const e=this._elementRef.nativeElement,a=e.options[0];return this.focused||e.multiple||!this.empty||!!(e.selectedIndex>-1&&a&&a.label)}return this.focused||!this.empty}setDescribedByIds(e){e.length?this._elementRef.nativeElement.setAttribute("aria-describedby",e.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}_isInlineSelect(){const e=this._elementRef.nativeElement;return this._isNativeSelect&&(e.multiple||e.size>1)}}return i.\u0275fac=function(e){return new(e||i)(ie(cn),ie(sr),ie(Xs,10),ie(hv,8),ie(qh,8),ie(Fj),ie(F5,10),ie(Zj),ie(me),ie(l3,8))},i.\u0275dir=je({type:i,selectors:[["input","matInput",""],["textarea","matInput",""],["select","matNativeControl",""],["input","matNativeControl",""],["textarea","matNativeControl",""]],hostAttrs:[1,"mat-mdc-input-element"],hostVars:18,hostBindings:function(e,a){1&e&&tn("focus",function(){return a._focusChanged(!0)})("blur",function(){return a._focusChanged(!1)})("input",function(){return a._onInput()}),2&e&&(ud("id",a.id)("disabled",a.disabled)("required",a.required),zi("name",a.name||null)("readonly",a.readonly&&!a._isNativeSelect||null)("aria-invalid",a.empty&&a.required?null:a.errorState)("aria-required",a.required)("id",a.id),Bt("mat-input-server",a._isServer)("mat-mdc-form-field-textarea-control",a._isInFormField&&a._isTextarea)("mat-mdc-form-field-input-control",a._isInFormField)("mdc-text-field__input",a._isInFormField)("mat-mdc-native-select-inline",a._isInlineSelect()))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["matInput"],features:[An([{provide:c3,useExisting:i}]),Ot,Ao]}),i})(),H5=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({imports:[xa,p3,p3,e5,xa]}),i})();const G5=["switch"],W5=["*"],z5=new Pe("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1})}),K5={provide:ys,useExisting:kn(()=>m3),multi:!0};class f3{constructor(t,e){this.source=t,this.checked=e}}let q5=0;const Y5=kj(GV(WV(HV(class{constructor(i){this._elementRef=i}}))));let $5=(()=>{class i extends Y5{get required(){return this._required}set required(e){this._required=ka(e)}get checked(){return this._checked}set checked(e){this._checked=ka(e),this._changeDetectorRef.markForCheck()}get inputId(){return`${this.id||this._uniqueId}-input`}constructor(e,a,l,u,f,E,y){super(e),this._focusMonitor=a,this._changeDetectorRef=l,this.defaults=f,this._onChange=T=>{},this._onTouched=()=>{},this._required=!1,this._checked=!1,this.name=null,this.labelPosition="after",this.ariaLabel=null,this.ariaLabelledby=null,this.change=new rn,this.toggleChange=new rn,this.tabIndex=parseInt(u)||0,this.color=this.defaultColor=f.color||"accent",this._noopAnimations="NoopAnimations"===E,this.id=this._uniqueId=`${y}${++q5}`}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{"keyboard"===e||"program"===e?(this._focused=!0,this._changeDetectorRef.markForCheck()):e||Promise.resolve().then(()=>{this._focused=!1,this._onTouched(),this._changeDetectorRef.markForCheck()})})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}writeValue(e){this.checked=!!e}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetectorRef.markForCheck()}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(this._createChangeEvent(this.checked))}}return i.\u0275fac=function(e){qp()},i.\u0275dir=je({type:i,inputs:{name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],required:"required",checked:"checked"},outputs:{change:"change",toggleChange:"toggleChange"},features:[Ot]}),i})(),m3=(()=>{class i extends $5{get buttonId(){return`${this.id||this._uniqueId}-button`}constructor(e,a,l,u,f,E){super(e,a,l,u,f,E,"mat-mdc-slide-toggle-"),this._labelId=this._uniqueId+"-label"}_handleClick(){this.toggleChange.emit(),this.defaults.disableToggleValue||(this.checked=!this.checked,this._onChange(this.checked),this.change.emit(new f3(this,this.checked)))}focus(){this._switchElement.nativeElement.focus()}_createChangeEvent(e){return new f3(this,e)}_getAriaLabelledBy(){return this.ariaLabelledby?this.ariaLabelledby:this.ariaLabel?null:this._labelId}}return i.\u0275fac=function(e){return new(e||i)(ie(cn),ie(XL),ie(te),function Ac(i){return function E_(i,t){if("class"===t)return i.classes;if("style"===t)return i.styles;const e=i.attrs;if(e){const a=e.length;let l=0;for(;l<a;){const u=e[l];if(Oy(u))break;if(0===u)l+=2;else if("number"==typeof u)for(l++;l<a&&"string"==typeof e[l];)l++;else{if(u===t)return e[l+1];l+=2}}}return null}(Oi(),i)}("tabindex"),ie(z5),ie(Ca,8))},i.\u0275cmp=_r({type:i,selectors:[["mat-slide-toggle"]],viewQuery:function(e,a){if(1&e&&ls(G5,5),2&e){let l;_i(l=bi())&&(a._switchElement=l.first)}},hostAttrs:[1,"mat-mdc-slide-toggle"],hostVars:11,hostBindings:function(e,a){2&e&&(ud("id",a.id),zi("tabindex",null)("aria-label",null)("name",null)("aria-labelledby",null),Bt("mat-mdc-slide-toggle-focused",a._focused)("mat-mdc-slide-toggle-checked",a.checked)("_mat-animation-noopable",a._noopAnimations))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color",tabIndex:"tabIndex"},exportAs:["matSlideToggle"],features:[An([K5]),Ot],ngContentSelectors:W5,decls:17,vars:24,consts:[[1,"mdc-form-field"],["role","switch","type","button",1,"mdc-switch",3,"tabIndex","disabled","click"],["switch",""],[1,"mdc-switch__track"],[1,"mdc-switch__handle-track"],[1,"mdc-switch__handle"],[1,"mdc-switch__shadow"],[1,"mdc-elevation-overlay"],[1,"mdc-switch__ripple"],["mat-ripple","",1,"mat-mdc-slide-toggle-ripple","mat-mdc-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],[1,"mdc-switch__icons"],["viewBox","0 0 24 24",1,"mdc-switch__icon","mdc-switch__icon--on"],["d","M19.69,5.23L8.96,15.96l-4.23-4.23L2.96,13.5l6,6L21.46,7L19.69,5.23z"],["viewBox","0 0 24 24",1,"mdc-switch__icon","mdc-switch__icon--off"],["d","M20 13H4v-2h16v2z"],[3,"for","click"]],template:function(e,a){if(1&e&&(Yu(),Ne(0,"div",0)(1,"button",1,2),tn("click",function(){return a._handleClick()}),Tt(3,"div",3),Ne(4,"div",4)(5,"div",5)(6,"div",6),Tt(7,"div",7),Ge(),Ne(8,"div",8),Tt(9,"div",9),Ge(),Ne(10,"div",10),Oo(),Ne(11,"svg",11),Tt(12,"path",12),Ge(),Ne(13,"svg",13),Tt(14,"path",14),Ge()()()()(),Zo(),Ne(15,"label",15),tn("click",function(u){return u.stopPropagation()}),Sr(16),Ge()()),2&e){const l=Qp(2);Bt("mdc-form-field--align-end","before"==a.labelPosition),Ze(1),Bt("mdc-switch--selected",a.checked)("mdc-switch--unselected",!a.checked)("mdc-switch--checked",a.checked)("mdc-switch--disabled",a.disabled),nt("tabIndex",a.tabIndex)("disabled",a.disabled),zi("id",a.buttonId)("name",a.name)("aria-label",a.ariaLabel)("aria-labelledby",a._getAriaLabelledBy())("aria-describedby",a.ariaDescribedby)("aria-required",a.required||null)("aria-checked",a.checked),Ze(8),nt("matRippleTrigger",l)("matRippleDisabled",a.disableRipple||a.disabled)("matRippleCentered",!0),Ze(6),nt("for",a.buttonId),zi("id",a._labelId)}},dependencies:[QL],styles:['.mdc-form-field{display:inline-flex;align-items:center;vertical-align:middle}.mdc-form-field[hidden]{display:none}.mdc-form-field>label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0;order:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{margin-left:auto;margin-right:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{padding-left:0;padding-right:4px}.mdc-form-field--nowrap>label{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.mdc-form-field--align-end>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px;order:-1}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{margin-left:0;margin-right:auto}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{padding-left:4px;padding-right:0}.mdc-form-field--space-between{justify-content:space-between}.mdc-form-field--space-between>label{margin:0}[dir=rtl] .mdc-form-field--space-between>label,.mdc-form-field--space-between>label[dir=rtl]{margin:0}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1);background-color:var(--mdc-elevation-overlay-color, #fff)}.mdc-switch{align-items:center;background:none;border:none;cursor:pointer;display:inline-flex;flex-shrink:0;margin:0;outline:none;overflow:visible;padding:0;position:relative}.mdc-switch[hidden]{display:none}.mdc-switch:disabled{cursor:default;pointer-events:none}.mdc-switch__track{overflow:hidden;position:relative;width:100%}.mdc-switch__track::before,.mdc-switch__track::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";height:100%;left:0;position:absolute;width:100%}@media screen and (forced-colors: active){.mdc-switch__track::before,.mdc-switch__track::after{border-color:currentColor}}.mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(-100%)}[dir=rtl] .mdc-switch__track::after,.mdc-switch__track[dir=rtl]::after{transform:translateX(100%)}.mdc-switch--selected .mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__track::before,.mdc-switch--selected .mdc-switch__track[dir=rtl]::before{transform:translateX(-100%)}.mdc-switch--selected .mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__handle-track{height:100%;pointer-events:none;position:absolute;top:0;transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);left:0;right:auto;transform:translateX(0)}[dir=rtl] .mdc-switch__handle-track,.mdc-switch__handle-track[dir=rtl]{left:auto;right:0}.mdc-switch--selected .mdc-switch__handle-track{transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__handle-track,.mdc-switch--selected .mdc-switch__handle-track[dir=rtl]{transform:translateX(-100%)}.mdc-switch__handle{display:flex;pointer-events:auto;position:absolute;top:50%;transform:translateY(-50%);left:0;right:auto}[dir=rtl] .mdc-switch__handle,.mdc-switch__handle[dir=rtl]{left:auto;right:0}.mdc-switch__handle::before,.mdc-switch__handle::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";width:100%;height:100%;left:0;position:absolute;top:0;transition:background-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1),border-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);z-index:-1}@media screen and (forced-colors: active){.mdc-switch__handle::before,.mdc-switch__handle::after{border-color:currentColor}}.mdc-switch__shadow{border-radius:inherit;bottom:0;left:0;position:absolute;right:0;top:0}.mdc-elevation-overlay{bottom:0;left:0;right:0;top:0}.mdc-switch__ripple{left:50%;position:absolute;top:50%;transform:translate(-50%, -50%);z-index:-1}.mdc-switch:disabled .mdc-switch__ripple{display:none}.mdc-switch__icons{height:100%;position:relative;width:100%;z-index:1}.mdc-switch__icon{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0;opacity:0;transition:opacity 30ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-switch--selected .mdc-switch__icon--on,.mdc-switch--unselected .mdc-switch__icon--off{opacity:1;transition:opacity 45ms 30ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle{display:inline-block;-webkit-tap-highlight-color:rgba(0,0,0,0);outline:0}.mat-mdc-slide-toggle .mdc-switch{width:var(--mdc-switch-track-width, 36px)}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-selected-handle-color, var(--mdc-theme-primary, #6200ee))}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-hover-handle-color, #310077)}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-focus-handle-color, #310077)}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-selected-pressed-handle-color, #310077)}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-selected-handle-color, #424242)}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-unselected-handle-color, #616161)}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-hover-handle-color, #212121)}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-focus-handle-color, #212121)}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-unselected-pressed-handle-color, #212121)}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-unselected-handle-color, #424242)}.mat-mdc-slide-toggle .mdc-switch .mdc-switch__handle::before{background:var(--mdc-switch-handle-surface-color, var(--mdc-theme-surface, #fff))}.mat-mdc-slide-toggle .mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation, 0px 2px 1px -1px rgba(0, 0, 0, 0.2), 0px 1px 1px 0px rgba(0, 0, 0, 0.14), 0px 1px 3px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-slide-toggle .mdc-switch:disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation, 0px 0px 0px 0px rgba(0, 0, 0, 0.2), 0px 0px 0px 0px rgba(0, 0, 0, 0.14), 0px 0px 0px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-slide-toggle .mdc-switch .mdc-switch__focus-ring-wrapper,.mat-mdc-slide-toggle .mdc-switch .mdc-switch__handle{height:var(--mdc-switch-handle-height, 20px)}.mat-mdc-slide-toggle .mdc-switch:disabled .mdc-switch__handle::after{opacity:var(--mdc-switch-disabled-handle-opacity, 0.38)}.mat-mdc-slide-toggle .mdc-switch .mdc-switch__handle{border-radius:var(--mdc-switch-handle-shape, 10px)}.mat-mdc-slide-toggle .mdc-switch .mdc-switch__handle{width:var(--mdc-switch-handle-width, 20px)}.mat-mdc-slide-toggle .mdc-switch .mdc-switch__handle-track{width:calc(100% - var(--mdc-switch-handle-width, 20px))}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled .mdc-switch__icon{fill:var(--mdc-switch-selected-icon-color, var(--mdc-theme-on-primary, #fff))}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-selected-icon-color, var(--mdc-theme-on-primary, #fff))}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled .mdc-switch__icon{fill:var(--mdc-switch-unselected-icon-color, var(--mdc-theme-on-primary, #fff))}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-unselected-icon-color, var(--mdc-theme-on-primary, #fff))}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-selected-icon-opacity, 0.38)}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-unselected-icon-opacity, 0.38)}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected .mdc-switch__icon{width:var(--mdc-switch-selected-icon-size, 18px);height:var(--mdc-switch-selected-icon-size, 18px)}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected .mdc-switch__icon{width:var(--mdc-switch-unselected-icon-size, 18px);height:var(--mdc-switch-unselected-icon-size, 18px)}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-hover-state-layer-color, var(--mdc-theme-primary, #6200ee))}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::before,.mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-focus-state-layer-color, var(--mdc-theme-primary, #6200ee))}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::before,.mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-pressed-state-layer-color, var(--mdc-theme-primary, #6200ee))}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-hover-state-layer-color, #424242)}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::before,.mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-focus-state-layer-color, #424242)}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::before,.mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-pressed-state-layer-color, #424242)}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-selected-hover-state-layer-opacity, 0.04)}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-selected-focus-state-layer-opacity, 0.12)}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-selected-pressed-state-layer-opacity, 0.1)}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-selected-pressed-state-layer-opacity, 0.1)}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-unselected-hover-state-layer-opacity, 0.04)}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-unselected-focus-state-layer-opacity, 0.12)}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity, 0.1)}.mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity, 0.1)}.mat-mdc-slide-toggle .mdc-switch .mdc-switch__ripple{height:var(--mdc-switch-state-layer-size, 48px);width:var(--mdc-switch-state-layer-size, 48px)}.mat-mdc-slide-toggle .mdc-switch .mdc-switch__track{height:var(--mdc-switch-track-height, 14px)}.mat-mdc-slide-toggle .mdc-switch:disabled .mdc-switch__track{opacity:var(--mdc-switch-disabled-track-opacity, 0.12)}.mat-mdc-slide-toggle .mdc-switch:enabled .mdc-switch__track::after{background:var(--mdc-switch-selected-track-color, #d7bbff)}.mat-mdc-slide-toggle .mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-hover-track-color, #d7bbff)}.mat-mdc-slide-toggle .mdc-switch:enabled:focus:not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-focus-track-color, #d7bbff)}.mat-mdc-slide-toggle .mdc-switch:enabled:active .mdc-switch__track::after{background:var(--mdc-switch-selected-pressed-track-color, #d7bbff)}.mat-mdc-slide-toggle .mdc-switch:disabled .mdc-switch__track::after{background:var(--mdc-switch-disabled-selected-track-color, #424242)}.mat-mdc-slide-toggle .mdc-switch:enabled .mdc-switch__track::before{background:var(--mdc-switch-unselected-track-color, #e0e0e0)}.mat-mdc-slide-toggle .mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-hover-track-color, #e0e0e0)}.mat-mdc-slide-toggle .mdc-switch:enabled:focus:not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-focus-track-color, #e0e0e0)}.mat-mdc-slide-toggle .mdc-switch:enabled:active .mdc-switch__track::before{background:var(--mdc-switch-unselected-pressed-track-color, #e0e0e0)}.mat-mdc-slide-toggle .mdc-switch:disabled .mdc-switch__track::before{background:var(--mdc-switch-disabled-unselected-track-color, #424242)}.mat-mdc-slide-toggle .mdc-switch .mdc-switch__track{border-radius:var(--mdc-switch-track-shape, 7px)}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple,.mat-mdc-slide-toggle .mdc-switch__ripple::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:50%;pointer-events:none}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple:not(:empty),.mat-mdc-slide-toggle .mdc-switch__ripple::after:not(:empty){transform:translateZ(0)}.mat-mdc-slide-toggle .mdc-switch__ripple::after{content:"";opacity:0}.mat-mdc-slide-toggle .mdc-switch:hover .mdc-switch__ripple::after{opacity:.04;transition:opacity 75ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mdc-switch .mdc-switch__ripple::after{opacity:.12}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mat-mdc-focus-indicator::before{content:""}.mat-mdc-slide-toggle .mat-ripple-element{opacity:.12}.mat-mdc-slide-toggle .mat-mdc-focus-indicator::before{border-radius:50%}.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle-track,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-elevation-overlay,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__icon,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::after,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::after{transition:none}'],encapsulation:2,changeDetection:0}),i})(),_3=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({}),i})(),Q5=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({imports:[_3,xa,XV,Kf,_3,xa]}),i})();function r2(i,t,e,a){return x(e)&&(a=e,e=void 0),a?r2(i,t,e).pipe(At(l=>lr(l)?a(...l):a(l))):new _n(l=>{g3(i,t,function u(f){l.next(arguments.length>1?Array.prototype.slice.call(arguments):f)},l,e)})}function g3(i,t,e,a,l){let u;if(function t6(i){return i&&"function"==typeof i.addEventListener&&"function"==typeof i.removeEventListener}(i)){const f=i;i.addEventListener(t,e,l),u=()=>f.removeEventListener(t,e,l)}else if(function e6(i){return i&&"function"==typeof i.on&&"function"==typeof i.off}(i)){const f=i;i.on(t,e),u=()=>f.off(t,e)}else if(function Z5(i){return i&&"function"==typeof i.addListener&&"function"==typeof i.removeListener}(i)){const f=i;i.addListener(t,e),u=()=>f.removeListener(t,e)}else{if(!i||!i.length)throw new TypeError("Invalid event target");for(let f=0,E=i.length;f<E;f++)g3(i[f],t,e,a,l)}a.add(u)}const r6=new class i6 extends ml{flush(t){this.active=!0,this.scheduled=void 0;const{actions:e}=this;let a,l=-1,u=e.length;t=t||e.shift();do{if(a=t.execute(t.state,t.delay))break}while(++l<u&&(t=e.shift()));if(this.active=!1,a){for(;++l<u&&(t=e.shift());)t.unsubscribe();throw a}}}(class n6 extends zL{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,a=0){return null!==a&&a>0?super.requestAsyncId(t,e,a):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame(()=>t.flush(null))))}recycleAsyncId(t,e,a=0){if(null!==a&&a>0||null===a&&this.delay>0)return super.recycleAsyncId(t,e,a);0===t.actions.length&&(cancelAnimationFrame(e),t.scheduled=void 0)}});let o6=1;const s6=Promise.resolve(),_N={};function E3(i){return i in _N&&(delete _N[i],!0)}const v3={setImmediate(i){const t=o6++;return _N[t]=!0,s6.then(()=>E3(t)&&i()),t},clearImmediate(i){E3(i)}},l6=new class c6 extends ml{flush(t){this.active=!0,this.scheduled=void 0;const{actions:e}=this;let a,l=-1,u=e.length;t=t||e.shift();do{if(a=t.execute(t.state,t.delay))break}while(++l<u&&(t=e.shift()));if(this.active=!1,a){for(;++l<u&&(t=e.shift());)t.unsubscribe();throw a}}}(class a6 extends zL{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,a=0){return null!==a&&a>0?super.requestAsyncId(t,e,a):(t.actions.push(this),t.scheduled||(t.scheduled=v3.setImmediate(t.flush.bind(t,null))))}recycleAsyncId(t,e,a=0){if(null!==a&&a>0||null===a&&this.delay>0)return super.recycleAsyncId(t,e,a);0===t.actions.length&&(v3.clearImmediate(e),t.scheduled=void 0)}});class u6{constructor(t){this.durationSelector=t}call(t,e){return e.subscribe(new h6(t,this.durationSelector))}}class h6 extends hp{constructor(t,e){super(t),this.durationSelector=e,this.hasValue=!1}_next(t){if(this.value=t,this.hasValue=!0,!this.throttled){let e;try{const{durationSelector:l}=this;e=l(t)}catch(l){return this.destination.error(l)}const a=Cl(e,new au(this));!a||a.closed?this.clearThrottle():this.add(this.throttled=a)}}clearThrottle(){const{value:t,hasValue:e,throttled:a}=this;a&&(this.remove(a),this.throttled=void 0,a.unsubscribe()),e&&(this.value=void 0,this.hasValue=!1,this.destination.next(t))}notifyNext(){this.clearThrottle()}notifyComplete(){this.clearThrottle()}}function o2(i){return!lr(i)&&i-parseFloat(i)+1>=0}function y3(i=0,t,e){let a=-1;return o2(t)?a=Number(t)<1?1:Number(t):Sl(t)&&(e=t),Sl(e)||(e=Dv),new _n(l=>{const u=o2(i)?i:+i-e.now();return e.schedule(p6,u,{index:0,period:a,subscriber:l})})}function p6(i){const{index:t,period:e,subscriber:a}=i;if(a.next(t),!a.closed){if(-1===e)return a.complete();i.index=t+1,this.schedule(i,e)}}function s2(i,t=Dv){return function d6(i){return function(e){return e.lift(new u6(i))}}(()=>y3(i,t))}function vc(i,t){return function(a){return a.lift(new f6(i,t))}}class f6{constructor(t,e){this.predicate=t,this.thisArg=e}call(t,e){return e.subscribe(new m6(t,this.predicate,this.thisArg))}}class m6 extends En{constructor(t,e,a){super(t),this.predicate=e,this.thisArg=a,this.count=0}_next(t){let e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(a){return void this.destination.error(a)}e&&this.destination.next(t)}}const _6=["contentWrapper"],g6=["*"],E6=new Pe("VIRTUAL_SCROLL_STRATEGY");let UT=(()=>{class i{constructor(e,a,l){this._ngZone=e,this._platform=a,this._scrolled=new Xt,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=l}register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){const a=this.scrollContainers.get(e);a&&(a.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=20){return this._platform.isBrowser?new _n(a=>{this._globalSubscription||this._addGlobalListener();const l=e>0?this._scrolled.pipe(s2(e)).subscribe(a):this._scrolled.subscribe(a);return this._scrolledCount++,()=>{l.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):ze()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((e,a)=>this.deregister(a)),this._scrolled.complete()}ancestorScrolled(e,a){const l=this.getAncestorScrollContainers(e);return this.scrolled(a).pipe(vc(u=>!u||l.indexOf(u)>-1))}getAncestorScrollContainers(e){const a=[];return this.scrollContainers.forEach((l,u)=>{this._scrollableContainsElement(u,e)&&a.push(u)}),a}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(e,a){let l=Jd(a),u=e.getElementRef().nativeElement;do{if(l==u)return!0}while(l=l.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>r2(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return i.\u0275fac=function(e){return new(e||i)(pe(me),pe(sr),pe(Zt,8))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),b3=(()=>{class i{constructor(e,a,l,u){this.elementRef=e,this.scrollDispatcher=a,this.ngZone=l,this.dir=u,this._destroyed=new Xt,this._elementScrolled=new _n(f=>this.ngZone.runOutsideAngular(()=>r2(this.elementRef.nativeElement,"scroll").pipe(So(this._destroyed)).subscribe(f)))}ngOnInit(){this.scrollDispatcher.register(this)}ngOnDestroy(){this.scrollDispatcher.deregister(this),this._destroyed.next(),this._destroyed.complete()}elementScrolled(){return this._elementScrolled}getElementRef(){return this.elementRef}scrollTo(e){const a=this.elementRef.nativeElement,l=this.dir&&"rtl"==this.dir.value;null==e.left&&(e.left=l?e.end:e.start),null==e.right&&(e.right=l?e.start:e.end),null!=e.bottom&&(e.top=a.scrollHeight-a.clientHeight-e.bottom),l&&0!=Qh()?(null!=e.left&&(e.right=a.scrollWidth-a.clientWidth-e.left),2==Qh()?e.left=e.right:1==Qh()&&(e.left=e.right?-e.right:e.right)):null!=e.right&&(e.left=a.scrollWidth-a.clientWidth-e.right),this._applyScrollToOptions(e)}_applyScrollToOptions(e){const a=this.elementRef.nativeElement;Sm()?a.scrollTo(e):(null!=e.top&&(a.scrollTop=e.top),null!=e.left&&(a.scrollLeft=e.left))}measureScrollOffset(e){const a="left",l="right",u=this.elementRef.nativeElement;if("top"==e)return u.scrollTop;if("bottom"==e)return u.scrollHeight-u.clientHeight-u.scrollTop;const f=this.dir&&"rtl"==this.dir.value;return"start"==e?e=f?l:a:"end"==e&&(e=f?a:l),f&&2==Qh()?e==a?u.scrollWidth-u.clientWidth-u.scrollLeft:u.scrollLeft:f&&1==Qh()?e==a?u.scrollLeft+u.scrollWidth-u.clientWidth:-u.scrollLeft:e==a?u.scrollLeft:u.scrollWidth-u.clientWidth-u.scrollLeft}}return i.\u0275fac=function(e){return new(e||i)(ie(cn),ie(UT),ie(me),ie(Pv,8))},i.\u0275dir=je({type:i,selectors:[["","cdk-scrollable",""],["","cdkScrollable",""]],standalone:!0}),i})(),a2=(()=>{class i{constructor(e,a,l){this._platform=e,this._change=new Xt,this._changeListener=u=>{this._change.next(u)},this._document=l,a.runOutsideAngular(()=>{if(e.isBrowser){const u=this._getWindow();u.addEventListener("resize",this._changeListener),u.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const e=this._getWindow();e.removeEventListener("resize",this._changeListener),e.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){const e=this.getViewportScrollPosition(),{width:a,height:l}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+l,right:e.left+a,height:l,width:a}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const e=this._document,a=this._getWindow(),l=e.documentElement,u=l.getBoundingClientRect();return{top:-u.top||e.body.scrollTop||a.scrollY||l.scrollTop||0,left:-u.left||e.body.scrollLeft||a.scrollX||l.scrollLeft||0}}change(e=20){return e>0?this._change.pipe(s2(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}}return i.\u0275fac=function(e){return new(e||i)(pe(sr),pe(me),pe(Zt,8))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const S3=new Pe("VIRTUAL_SCROLLABLE");let b6=(()=>{class i extends b3{constructor(e,a,l,u){super(e,a,l,u)}measureViewportSize(e){const a=this.elementRef.nativeElement;return"horizontal"===e?a.clientWidth:a.clientHeight}}return i.\u0275fac=function(e){return new(e||i)(ie(cn),ie(UT),ie(me),ie(Pv,8))},i.\u0275dir=je({type:i,features:[Ot]}),i})();const C6=typeof requestAnimationFrame<"u"?r6:l6;let T6=(()=>{class i extends b6{get orientation(){return this._orientation}set orientation(e){this._orientation!==e&&(this._orientation=e,this._calculateSpacerSize())}get appendOnly(){return this._appendOnly}set appendOnly(e){this._appendOnly=ka(e)}constructor(e,a,l,u,f,E,y,T){super(e,E,l,f),this.elementRef=e,this._changeDetectorRef=a,this._scrollStrategy=u,this.scrollable=T,this._platform=Ct(sr),this._detachedSubject=new Xt,this._renderedRangeSubject=new Xt,this._orientation="vertical",this._appendOnly=!1,this.scrolledIndexChange=new _n(R=>this._scrollStrategy.scrolledIndexChange.subscribe(L=>Promise.resolve().then(()=>this.ngZone.run(()=>R.next(L))))),this.renderedRangeStream=this._renderedRangeSubject,this._totalContentSize=0,this._totalContentWidth="",this._totalContentHeight="",this._renderedRange={start:0,end:0},this._dataLength=0,this._viewportSize=0,this._renderedContentOffset=0,this._renderedContentOffsetNeedsRewrite=!1,this._isChangeDetectionPending=!1,this._runAfterChangeDetection=[],this._viewportChanges=mn.EMPTY,this._viewportChanges=y.change().subscribe(()=>{this.checkViewportSize()}),this.scrollable||(this.elementRef.nativeElement.classList.add("cdk-virtual-scrollable"),this.scrollable=this)}ngOnInit(){this._platform.isBrowser&&(this.scrollable===this&&super.ngOnInit(),this.ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>{this._measureViewportSize(),this._scrollStrategy.attach(this),this.scrollable.elementScrolled().pipe(qL(null),s2(0,C6)).subscribe(()=>this._scrollStrategy.onContentScrolled()),this._markChangeDetectionNeeded()})))}ngOnDestroy(){this.detach(),this._scrollStrategy.detach(),this._renderedRangeSubject.complete(),this._detachedSubject.complete(),this._viewportChanges.unsubscribe(),super.ngOnDestroy()}attach(e){this.ngZone.runOutsideAngular(()=>{this._forOf=e,this._forOf.dataStream.pipe(So(this._detachedSubject)).subscribe(a=>{const l=a.length;l!==this._dataLength&&(this._dataLength=l,this._scrollStrategy.onDataLengthChanged()),this._doChangeDetection()})})}detach(){this._forOf=null,this._detachedSubject.next()}getDataLength(){return this._dataLength}getViewportSize(){return this._viewportSize}getRenderedRange(){return this._renderedRange}measureBoundingClientRectWithScrollOffset(e){return this.getElementRef().nativeElement.getBoundingClientRect()[e]}setTotalContentSize(e){this._totalContentSize!==e&&(this._totalContentSize=e,this._calculateSpacerSize(),this._markChangeDetectionNeeded())}setRenderedRange(e){(function S6(i,t){return i.start==t.start&&i.end==t.end})(this._renderedRange,e)||(this.appendOnly&&(e={start:0,end:Math.max(this._renderedRange.end,e.end)}),this._renderedRangeSubject.next(this._renderedRange=e),this._markChangeDetectionNeeded(()=>this._scrollStrategy.onContentRendered()))}getOffsetToRenderedContentStart(){return this._renderedContentOffsetNeedsRewrite?null:this._renderedContentOffset}setRenderedContentOffset(e,a="to-start"){e=this.appendOnly&&"to-start"===a?0:e;const u="horizontal"==this.orientation,f=u?"X":"Y";let y=`translate${f}(${Number((u&&this.dir&&"rtl"==this.dir.value?-1:1)*e)}px)`;this._renderedContentOffset=e,"to-end"===a&&(y+=` translate${f}(-100%)`,this._renderedContentOffsetNeedsRewrite=!0),this._renderedContentTransform!=y&&(this._renderedContentTransform=y,this._markChangeDetectionNeeded(()=>{this._renderedContentOffsetNeedsRewrite?(this._renderedContentOffset-=this.measureRenderedContentSize(),this._renderedContentOffsetNeedsRewrite=!1,this.setRenderedContentOffset(this._renderedContentOffset)):this._scrollStrategy.onRenderedOffsetChanged()}))}scrollToOffset(e,a="auto"){const l={behavior:a};"horizontal"===this.orientation?l.start=e:l.top=e,this.scrollable.scrollTo(l)}scrollToIndex(e,a="auto"){this._scrollStrategy.scrollToIndex(e,a)}measureScrollOffset(e){let a;return a=this.scrollable==this?l=>super.measureScrollOffset(l):l=>this.scrollable.measureScrollOffset(l),Math.max(0,a(e??("horizontal"===this.orientation?"start":"top"))-this.measureViewportOffset())}measureViewportOffset(e){let a;const l="left",u="right",f="rtl"==this.dir?.value;a="start"==e?f?u:l:"end"==e?f?l:u:e||("horizontal"===this.orientation?"left":"top");const E=this.scrollable.measureBoundingClientRectWithScrollOffset(a);return this.elementRef.nativeElement.getBoundingClientRect()[a]-E}measureRenderedContentSize(){const e=this._contentWrapper.nativeElement;return"horizontal"===this.orientation?e.offsetWidth:e.offsetHeight}measureRangeSize(e){return this._forOf?this._forOf.measureRangeSize(e,this.orientation):0}checkViewportSize(){this._measureViewportSize(),this._scrollStrategy.onDataLengthChanged()}_measureViewportSize(){this._viewportSize=this.scrollable.measureViewportSize(this.orientation)}_markChangeDetectionNeeded(e){e&&this._runAfterChangeDetection.push(e),this._isChangeDetectionPending||(this._isChangeDetectionPending=!0,this.ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>{this._doChangeDetection()})))}_doChangeDetection(){this._isChangeDetectionPending=!1,this._contentWrapper.nativeElement.style.transform=this._renderedContentTransform,this.ngZone.run(()=>this._changeDetectorRef.markForCheck());const e=this._runAfterChangeDetection;this._runAfterChangeDetection=[];for(const a of e)a()}_calculateSpacerSize(){this._totalContentHeight="horizontal"===this.orientation?"":`${this._totalContentSize}px`,this._totalContentWidth="horizontal"===this.orientation?`${this._totalContentSize}px`:""}}return i.\u0275fac=function(e){return new(e||i)(ie(cn),ie(te),ie(me),ie(E6,8),ie(Pv,8),ie(UT),ie(a2),ie(S3,8))},i.\u0275cmp=_r({type:i,selectors:[["cdk-virtual-scroll-viewport"]],viewQuery:function(e,a){if(1&e&&ls(_6,7),2&e){let l;_i(l=bi())&&(a._contentWrapper=l.first)}},hostAttrs:[1,"cdk-virtual-scroll-viewport"],hostVars:4,hostBindings:function(e,a){2&e&&Bt("cdk-virtual-scroll-orientation-horizontal","horizontal"===a.orientation)("cdk-virtual-scroll-orientation-vertical","horizontal"!==a.orientation)},inputs:{orientation:"orientation",appendOnly:"appendOnly"},outputs:{scrolledIndexChange:"scrolledIndexChange"},standalone:!0,features:[An([{provide:b3,useFactory:(t,e)=>t||e,deps:[[new Nu,new I_(S3)],i]}]),Ot,ff],ngContentSelectors:g6,decls:4,vars:4,consts:[[1,"cdk-virtual-scroll-content-wrapper"],["contentWrapper",""],[1,"cdk-virtual-scroll-spacer"]],template:function(e,a){1&e&&(Yu(),Ne(0,"div",0,1),Sr(2),Ge(),Tt(3,"div",2)),2&e&&(Ze(3),tc("width",a._totalContentWidth)("height",a._totalContentHeight))},styles:["cdk-virtual-scroll-viewport{display:block;position:relative;transform:translateZ(0)}.cdk-virtual-scrollable{overflow:auto;will-change:scroll-position;contain:strict;-webkit-overflow-scrolling:touch}.cdk-virtual-scroll-content-wrapper{position:absolute;top:0;left:0;contain:content}[dir=rtl] .cdk-virtual-scroll-content-wrapper{right:0;left:auto}.cdk-virtual-scroll-orientation-horizontal .cdk-virtual-scroll-content-wrapper{min-height:100%}.cdk-virtual-scroll-orientation-horizontal .cdk-virtual-scroll-content-wrapper>dl:not([cdkVirtualFor]),.cdk-virtual-scroll-orientation-horizontal .cdk-virtual-scroll-content-wrapper>ol:not([cdkVirtualFor]),.cdk-virtual-scroll-orientation-horizontal .cdk-virtual-scroll-content-wrapper>table:not([cdkVirtualFor]),.cdk-virtual-scroll-orientation-horizontal .cdk-virtual-scroll-content-wrapper>ul:not([cdkVirtualFor]){padding-left:0;padding-right:0;margin-left:0;margin-right:0;border-left-width:0;border-right-width:0;outline:none}.cdk-virtual-scroll-orientation-vertical .cdk-virtual-scroll-content-wrapper{min-width:100%}.cdk-virtual-scroll-orientation-vertical .cdk-virtual-scroll-content-wrapper>dl:not([cdkVirtualFor]),.cdk-virtual-scroll-orientation-vertical .cdk-virtual-scroll-content-wrapper>ol:not([cdkVirtualFor]),.cdk-virtual-scroll-orientation-vertical .cdk-virtual-scroll-content-wrapper>table:not([cdkVirtualFor]),.cdk-virtual-scroll-orientation-vertical .cdk-virtual-scroll-content-wrapper>ul:not([cdkVirtualFor]){padding-top:0;padding-bottom:0;margin-top:0;margin-bottom:0;border-top-width:0;border-bottom-width:0;outline:none}.cdk-virtual-scroll-spacer{height:1px;transform-origin:0 0;flex:0 0 auto}[dir=rtl] .cdk-virtual-scroll-spacer{transform-origin:100% 0}"],encapsulation:2,changeDetection:0}),i})(),c2=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({}),i})(),C3=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({imports:[PT,c2,T6,PT,c2]}),i})();class l2{attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null!=t&&(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class T3 extends l2{constructor(t,e,a,l,u){super(),this.component=t,this.viewContainerRef=e,this.injector=a,this.componentFactoryResolver=l,this.projectableNodes=u}}class w6 extends l2{constructor(t,e,a,l){super(),this.templateRef=t,this.viewContainerRef=e,this.context=a,this.injector=l}get origin(){return this.templateRef.elementRef}attach(t,e=this.context){return this.context=e,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class I6 extends l2{constructor(t){super(),this.element=t instanceof cn?t.nativeElement:t}}class R6{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(t){return t instanceof T3?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof w6?(this._attachedPortal=t,this.attachTemplatePortal(t)):this.attachDomPortal&&t instanceof I6?(this._attachedPortal=t,this.attachDomPortal(t)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class A6 extends R6{constructor(t,e,a,l,u){super(),this.outletElement=t,this._componentFactoryResolver=e,this._appRef=a,this._defaultInjector=l,this.attachDomPortal=f=>{const E=f.element,y=this._document.createComment("dom-portal");E.parentNode.insertBefore(y,E),this.outletElement.appendChild(E),this._attachedPortal=f,super.setDisposeFn(()=>{y.parentNode&&y.parentNode.replaceChild(E,y)})},this._document=u}attachComponentPortal(t){const a=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let l;return t.viewContainerRef?(l=t.viewContainerRef.createComponent(a,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector,t.projectableNodes||void 0),this.setDisposeFn(()=>l.destroy())):(l=a.create(t.injector||this._defaultInjector||No.NULL),this._appRef.attachView(l.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(l.hostView),l.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(l)),this._attachedPortal=t,l}attachTemplatePortal(t){let e=t.viewContainerRef,a=e.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return a.rootNodes.forEach(l=>this.outletElement.appendChild(l)),a.detectChanges(),this.setDisposeFn(()=>{let l=e.indexOf(a);-1!==l&&e.remove(l)}),this._attachedPortal=t,a}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}let D6=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({}),i})();const w3=Sm();class O6{constructor(t,e){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=e}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=cr(-this._previousScrollPosition.left),t.style.top=cr(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,a=t.style,l=this._document.body.style,u=a.scrollBehavior||"",f=l.scrollBehavior||"";this._isEnabled=!1,a.left=this._previousHTMLStyles.left,a.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),w3&&(a.scrollBehavior=l.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),w3&&(a.scrollBehavior=u,l.scrollBehavior=f)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const e=this._document.body,a=this._viewportRuler.getViewportSize();return e.scrollHeight>a.height||e.scrollWidth>a.width}}class N6{constructor(t,e,a,l){this._scrollDispatcher=t,this._ngZone=e,this._viewportRuler=a,this._config=l,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0).pipe(vc(e=>!e||!this._overlayRef.overlayElement.contains(e.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class I3{enable(){}disable(){}attach(){}}function d2(i,t){return t.some(e=>i.bottom<e.top||i.top>e.bottom||i.right<e.left||i.left>e.right)}function R3(i,t){return t.some(e=>i.top<e.top||i.bottom>e.bottom||i.left<e.left||i.right>e.right)}class P6{constructor(t,e,a,l){this._scrollDispatcher=t,this._viewportRuler=e,this._ngZone=a,this._config=l,this._scrollSubscription=null}attach(t){this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:a,height:l}=this._viewportRuler.getViewportSize();d2(e,[{width:a,height:l,bottom:l,right:a,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let M6=(()=>{class i{constructor(e,a,l,u){this._scrollDispatcher=e,this._viewportRuler=a,this._ngZone=l,this.noop=()=>new I3,this.close=f=>new N6(this._scrollDispatcher,this._ngZone,this._viewportRuler,f),this.block=()=>new O6(this._viewportRuler,this._document),this.reposition=f=>new P6(this._scrollDispatcher,this._viewportRuler,this._ngZone,f),this._document=u}}return i.\u0275fac=function(e){return new(e||i)(pe(UT),pe(a2),pe(me),pe(Zt))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();class k6{constructor(t){if(this.scrollStrategy=new I3,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){const e=Object.keys(t);for(const a of e)void 0!==t[a]&&(this[a]=t[a])}}}class x6{constructor(t,e){this.connectionPair=t,this.scrollableViewProperties=e}}let A3=(()=>{class i{constructor(e){this._attachedOverlays=[],this._document=e}ngOnDestroy(){this.detach()}add(e){this.remove(e),this._attachedOverlays.push(e)}remove(e){const a=this._attachedOverlays.indexOf(e);a>-1&&this._attachedOverlays.splice(a,1),0===this._attachedOverlays.length&&this.detach()}}return i.\u0275fac=function(e){return new(e||i)(pe(Zt))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),L6=(()=>{class i extends A3{constructor(e,a){super(e),this._ngZone=a,this._keydownListener=l=>{const u=this._attachedOverlays;for(let f=u.length-1;f>-1;f--)if(u[f]._keydownEvents.observers.length>0){const E=u[f]._keydownEvents;this._ngZone?this._ngZone.run(()=>E.next(l)):E.next(l);break}}}add(e){super.add(e),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return i.\u0275fac=function(e){return new(e||i)(pe(Zt),pe(me,8))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),F6=(()=>{class i extends A3{constructor(e,a,l){super(e),this._platform=a,this._ngZone=l,this._cursorStyleIsSet=!1,this._pointerDownListener=u=>{this._pointerDownEventTarget=pl(u)},this._clickListener=u=>{const f=pl(u),E="click"===u.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:f;this._pointerDownEventTarget=null;const y=this._attachedOverlays.slice();for(let T=y.length-1;T>-1;T--){const R=y[T];if(R._outsidePointerEvents.observers.length<1||!R.hasAttached())continue;if(R.overlayElement.contains(f)||R.overlayElement.contains(E))break;const L=R._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>L.next(u)):L.next(u)}}}add(e){if(super.add(e),!this._isAttached){const a=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(a)):this._addEventListeners(a),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=a.style.cursor,a.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const e=this._document.body;e.removeEventListener("pointerdown",this._pointerDownListener,!0),e.removeEventListener("click",this._clickListener,!0),e.removeEventListener("auxclick",this._clickListener,!0),e.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(e.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(e){e.addEventListener("pointerdown",this._pointerDownListener,!0),e.addEventListener("click",this._clickListener,!0),e.addEventListener("auxclick",this._clickListener,!0),e.addEventListener("contextmenu",this._clickListener,!0)}}return i.\u0275fac=function(e){return new(e||i)(pe(Zt),pe(sr),pe(me,8))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),D3=(()=>{class i{constructor(e,a){this._platform=a,this._document=e}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const e="cdk-overlay-container";if(this._platform.isBrowser||RT()){const l=this._document.querySelectorAll(`.${e}[platform="server"], .${e}[platform="test"]`);for(let u=0;u<l.length;u++)l[u].remove()}const a=this._document.createElement("div");a.classList.add(e),RT()?a.setAttribute("platform","test"):this._platform.isBrowser||a.setAttribute("platform","server"),this._document.body.appendChild(a),this._containerElement=a}}return i.\u0275fac=function(e){return new(e||i)(pe(Zt),pe(sr))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();class U6{constructor(t,e,a,l,u,f,E,y,T,R=!1){this._portalOutlet=t,this._host=e,this._pane=a,this._config=l,this._ngZone=u,this._keyboardDispatcher=f,this._document=E,this._location=y,this._outsideClickDispatcher=T,this._animationsDisabled=R,this._backdropElement=null,this._backdropClick=new Xt,this._attachments=new Xt,this._detachments=new Xt,this._locationChanges=mn.EMPTY,this._backdropClickHandler=L=>this._backdropClick.next(L),this._backdropTransitionendHandler=L=>{this._disposeBackdrop(L.target)},this._keydownEvents=new Xt,this._outsidePointerEvents=new Xt,l.scrollStrategy&&(this._scrollStrategy=l.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=l.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const e=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Qr(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof e?.onDestroy&&e.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){const t=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,t&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config={...this._config,...t},this._updateElementSize()}setDirection(t){this._config={...this._config,direction:t},this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const t=this._pane.style;t.width=cr(this._config.width),t.height=cr(this._config.height),t.minWidth=cr(this._config.minWidth),t.minHeight=cr(this._config.minHeight),t.maxWidth=cr(this._config.maxWidth),t.maxHeight=cr(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){const t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})}):this._backdropElement.classList.add(t)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const t=this._backdropElement;if(t){if(this._animationsDisabled)return void this._disposeBackdrop(t);t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",this._backdropTransitionendHandler)}),t.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(t)},500))}}_toggleClasses(t,e,a){const l=lN(e||[]).filter(u=>!!u);l.length&&(a?t.classList.add(...l):t.classList.remove(...l))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.pipe(So(ey(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),t.unsubscribe())})})}_disposeScrollStrategy(){const t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){t&&(t.removeEventListener("click",this._backdropClickHandler),t.removeEventListener("transitionend",this._backdropTransitionendHandler),t.remove(),this._backdropElement===t&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const O3="cdk-overlay-connected-position-bounding-box",V6=/([A-Za-z%]+)$/;class B6{get positions(){return this._preferredPositions}constructor(t,e,a,l,u){this._viewportRuler=e,this._document=a,this._platform=l,this._overlayContainer=u,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new Xt,this._resizeSubscription=mn.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(t)}attach(t){this._validatePositions(),t.hostElement.classList.add(O3),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._originRect,e=this._overlayRect,a=this._viewportRect,l=this._containerRect,u=[];let f;for(let E of this._preferredPositions){let y=this._getOriginPoint(t,l,E),T=this._getOverlayPoint(y,e,E),R=this._getOverlayFit(T,e,a,E);if(R.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(E,y);this._canFitWithFlexibleDimensions(R,T,a)?u.push({position:E,origin:y,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(y,E)}):(!f||f.overlayFit.visibleArea<R.visibleArea)&&(f={overlayFit:R,overlayPoint:T,originPoint:y,position:E,overlayRect:e})}if(u.length){let E=null,y=-1;for(const T of u){const R=T.boundingBoxRect.width*T.boundingBoxRect.height*(T.position.weight||1);R>y&&(y=R,E=T)}return this._isPushed=!1,void this._applyPosition(E.position,E.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(f.position,f.originPoint);this._applyPosition(f.position,f.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Tm(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(O3),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const t=this._lastPosition;if(t){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const e=this._getOriginPoint(this._originRect,this._containerRect,t);this._applyPosition(t,e)}else this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,e,a){let l,u;if("center"==a.originX)l=t.left+t.width/2;else{const f=this._isRtl()?t.right:t.left,E=this._isRtl()?t.left:t.right;l="start"==a.originX?f:E}return e.left<0&&(l-=e.left),u="center"==a.originY?t.top+t.height/2:"top"==a.originY?t.top:t.bottom,e.top<0&&(u-=e.top),{x:l,y:u}}_getOverlayPoint(t,e,a){let l,u;return l="center"==a.overlayX?-e.width/2:"start"===a.overlayX?this._isRtl()?-e.width:0:this._isRtl()?0:-e.width,u="center"==a.overlayY?-e.height/2:"top"==a.overlayY?0:-e.height,{x:t.x+l,y:t.y+u}}_getOverlayFit(t,e,a,l){const u=P3(e);let{x:f,y:E}=t,y=this._getOffset(l,"x"),T=this._getOffset(l,"y");y&&(f+=y),T&&(E+=T);let H=0-E,W=E+u.height-a.height,q=this._subtractOverflows(u.width,0-f,f+u.width-a.width),re=this._subtractOverflows(u.height,H,W),ce=q*re;return{visibleArea:ce,isCompletelyWithinViewport:u.width*u.height===ce,fitsInViewportVertically:re===u.height,fitsInViewportHorizontally:q==u.width}}_canFitWithFlexibleDimensions(t,e,a){if(this._hasFlexibleDimensions){const l=a.bottom-e.y,u=a.right-e.x,f=N3(this._overlayRef.getConfig().minHeight),E=N3(this._overlayRef.getConfig().minWidth);return(t.fitsInViewportVertically||null!=f&&f<=l)&&(t.fitsInViewportHorizontally||null!=E&&E<=u)}return!1}_pushOverlayOnScreen(t,e,a){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const l=P3(e),u=this._viewportRect,f=Math.max(t.x+l.width-u.width,0),E=Math.max(t.y+l.height-u.height,0),y=Math.max(u.top-a.top-t.y,0),T=Math.max(u.left-a.left-t.x,0);let R=0,L=0;return R=l.width<=u.width?T||-f:t.x<this._viewportMargin?u.left-a.left-t.x:0,L=l.height<=u.height?y||-E:t.y<this._viewportMargin?u.top-a.top-t.y:0,this._previousPushAmount={x:R,y:L},{x:t.x+R,y:t.y+L}}_applyPosition(t,e){if(this._setTransformOrigin(t),this._setOverlayElementStyles(e,t),this._setBoundingBoxStyles(e,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChanges.observers.length){const a=this._getScrollVisibility(),l=new x6(t,a);this._positionChanges.next(l)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const e=this._boundingBox.querySelectorAll(this._transformOriginSelector);let a,l=t.overlayY;a="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let u=0;u<e.length;u++)e[u].style.transformOrigin=`${a} ${l}`}_calculateBoundingBoxRect(t,e){const a=this._viewportRect,l=this._isRtl();let u,f,E,R,L,H;if("top"===e.overlayY)f=t.y,u=a.height-f+this._viewportMargin;else if("bottom"===e.overlayY)E=a.height-t.y+2*this._viewportMargin,u=a.height-E+this._viewportMargin;else{const W=Math.min(a.bottom-t.y+a.top,t.y),q=this._lastBoundingBoxSize.height;u=2*W,f=t.y-W,u>q&&!this._isInitialRender&&!this._growAfterOpen&&(f=t.y-q/2)}if("end"===e.overlayX&&!l||"start"===e.overlayX&&l)H=a.width-t.x+this._viewportMargin,R=t.x-this._viewportMargin;else if("start"===e.overlayX&&!l||"end"===e.overlayX&&l)L=t.x,R=a.right-t.x;else{const W=Math.min(a.right-t.x+a.left,t.x),q=this._lastBoundingBoxSize.width;R=2*W,L=t.x-W,R>q&&!this._isInitialRender&&!this._growAfterOpen&&(L=t.x-q/2)}return{top:f,left:L,bottom:E,right:H,width:R,height:u}}_setBoundingBoxStyles(t,e){const a=this._calculateBoundingBoxRect(t,e);!this._isInitialRender&&!this._growAfterOpen&&(a.height=Math.min(a.height,this._lastBoundingBoxSize.height),a.width=Math.min(a.width,this._lastBoundingBoxSize.width));const l={};if(this._hasExactPosition())l.top=l.left="0",l.bottom=l.right=l.maxHeight=l.maxWidth="",l.width=l.height="100%";else{const u=this._overlayRef.getConfig().maxHeight,f=this._overlayRef.getConfig().maxWidth;l.height=cr(a.height),l.top=cr(a.top),l.bottom=cr(a.bottom),l.width=cr(a.width),l.left=cr(a.left),l.right=cr(a.right),l.alignItems="center"===e.overlayX?"center":"end"===e.overlayX?"flex-end":"flex-start",l.justifyContent="center"===e.overlayY?"center":"bottom"===e.overlayY?"flex-end":"flex-start",u&&(l.maxHeight=cr(u)),f&&(l.maxWidth=cr(f))}this._lastBoundingBoxSize=a,Tm(this._boundingBox.style,l)}_resetBoundingBoxStyles(){Tm(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Tm(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,e){const a={},l=this._hasExactPosition(),u=this._hasFlexibleDimensions,f=this._overlayRef.getConfig();if(l){const R=this._viewportRuler.getViewportScrollPosition();Tm(a,this._getExactOverlayY(e,t,R)),Tm(a,this._getExactOverlayX(e,t,R))}else a.position="static";let E="",y=this._getOffset(e,"x"),T=this._getOffset(e,"y");y&&(E+=`translateX(${y}px) `),T&&(E+=`translateY(${T}px)`),a.transform=E.trim(),f.maxHeight&&(l?a.maxHeight=cr(f.maxHeight):u&&(a.maxHeight="")),f.maxWidth&&(l?a.maxWidth=cr(f.maxWidth):u&&(a.maxWidth="")),Tm(this._pane.style,a)}_getExactOverlayY(t,e,a){let l={top:"",bottom:""},u=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(u=this._pushOverlayOnScreen(u,this._overlayRect,a)),"bottom"===t.overlayY?l.bottom=this._document.documentElement.clientHeight-(u.y+this._overlayRect.height)+"px":l.top=cr(u.y),l}_getExactOverlayX(t,e,a){let f,l={left:"",right:""},u=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(u=this._pushOverlayOnScreen(u,this._overlayRect,a)),f=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===f?l.right=this._document.documentElement.clientWidth-(u.x+this._overlayRect.width)+"px":l.left=cr(u.x),l}_getScrollVisibility(){const t=this._getOriginRect(),e=this._pane.getBoundingClientRect(),a=this._scrollables.map(l=>l.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:R3(t,a),isOriginOutsideView:d2(t,a),isOverlayClipped:R3(e,a),isOverlayOutsideView:d2(e,a)}}_subtractOverflows(t,...e){return e.reduce((a,l)=>a-Math.max(l,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,a=this._viewportRuler.getViewportScrollPosition();return{top:a.top+this._viewportMargin,left:a.left+this._viewportMargin,right:a.left+t-this._viewportMargin,bottom:a.top+e-this._viewportMargin,width:t-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,e){return"x"===e?null==t.offsetX?this._offsetX:t.offsetX:null==t.offsetY?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&lN(t).forEach(e=>{""!==e&&-1===this._appliedPanelClasses.indexOf(e)&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){const t=this._origin;if(t instanceof cn)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();const e=t.width||0,a=t.height||0;return{top:t.y,bottom:t.y+a,left:t.x,right:t.x+e,height:a,width:e}}}function Tm(i,t){for(let e in t)t.hasOwnProperty(e)&&(i[e]=t[e]);return i}function N3(i){if("number"!=typeof i&&null!=i){const[t,e]=i.split(V6);return e&&"px"!==e?null:parseFloat(t)}return i||null}function P3(i){return{top:Math.floor(i.top),right:Math.floor(i.right),bottom:Math.floor(i.bottom),left:Math.floor(i.left),width:Math.floor(i.width),height:Math.floor(i.height)}}const M3="cdk-global-overlay-wrapper";class j6{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(t){const e=t.getConfig();this._overlayRef=t,this._width&&!e.width&&t.updateSize({width:this._width}),this._height&&!e.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(M3),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._xOffset=t,this._xPosition="left",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._xOffset=t,this._xPosition="right",this}start(t=""){return this._xOffset=t,this._xPosition="start",this}end(t=""){return this._xOffset=t,this._xPosition="end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._xPosition="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,a=this._overlayRef.getConfig(),{width:l,height:u,maxWidth:f,maxHeight:E}=a,y=!("100%"!==l&&"100vw"!==l||f&&"100%"!==f&&"100vw"!==f),T=!("100%"!==u&&"100vh"!==u||E&&"100%"!==E&&"100vh"!==E),R=this._xPosition,L=this._xOffset,H="rtl"===this._overlayRef.getConfig().direction;let W="",q="",re="";y?re="flex-start":"center"===R?(re="center",H?q=L:W=L):H?"left"===R||"end"===R?(re="flex-end",W=L):("right"===R||"start"===R)&&(re="flex-start",q=L):"left"===R||"start"===R?(re="flex-start",W=L):("right"===R||"end"===R)&&(re="flex-end",q=L),t.position=this._cssPosition,t.marginLeft=y?"0":W,t.marginTop=T?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=y?"0":q,e.justifyContent=re,e.alignItems=T?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,a=e.style;e.classList.remove(M3),a.justifyContent=a.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}let H6=(()=>{class i{constructor(e,a,l,u){this._viewportRuler=e,this._document=a,this._platform=l,this._overlayContainer=u}global(){return new j6}flexibleConnectedTo(e){return new B6(e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return i.\u0275fac=function(e){return new(e||i)(pe(a2),pe(Zt),pe(sr),pe(D3))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),G6=0,gN=(()=>{class i{constructor(e,a,l,u,f,E,y,T,R,L,H,W){this.scrollStrategies=e,this._overlayContainer=a,this._componentFactoryResolver=l,this._positionBuilder=u,this._keyboardDispatcher=f,this._injector=E,this._ngZone=y,this._document=T,this._directionality=R,this._location=L,this._outsideClickDispatcher=H,this._animationsModuleType=W}create(e){const a=this._createHostElement(),l=this._createPaneElement(a),u=this._createPortalOutlet(l),f=new k6(e);return f.direction=f.direction||this._directionality.value,new U6(u,a,l,f,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(e){const a=this._document.createElement("div");return a.id="cdk-overlay-"+G6++,a.classList.add("cdk-overlay-pane"),e.appendChild(a),a}_createHostElement(){const e=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(e),e}_createPortalOutlet(e){return this._appRef||(this._appRef=this._injector.get(Yc)),new A6(e,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return i.\u0275fac=function(e){return new(e||i)(pe(M6),pe(D3),pe(Wl),pe(H6),pe(L6),pe(No),pe(me),pe(Zt),pe(Pv),pe(Sh),pe(F6),pe(Ca,8))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const K6={provide:new Pe("cdk-connected-overlay-scroll-strategy"),deps:[gN],useFactory:function z6(i){return()=>i.scrollStrategies.reposition()}};let q6=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({providers:[gN,K6],imports:[PT,D6,C3,C3]}),i})();const Y6=["tooltip"],k3=new Pe("mat-tooltip-scroll-strategy"),J6={provide:k3,deps:[gN],useFactory:function X6(i){return()=>i.scrollStrategies.reposition({scrollThrottle:20})}},Z6=new Pe("mat-tooltip-default-options",{providedIn:"root",factory:function Q6(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}}),x3="tooltip-panel",L3=Go({passive:!0});let o8=(()=>{class i{get position(){return this._position}set position(e){e!==this._position&&(this._position=e,this._overlayRef&&(this._updatePosition(this._overlayRef),this._tooltipInstance?.show(0),this._overlayRef.updatePosition()))}get positionAtOrigin(){return this._positionAtOrigin}set positionAtOrigin(e){this._positionAtOrigin=ka(e),this._detach(),this._overlayRef=null}get disabled(){return this._disabled}set disabled(e){this._disabled=ka(e),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(e){this._showDelay=cN(e)}get hideDelay(){return this._hideDelay}set hideDelay(e){this._hideDelay=cN(e),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(e){this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=null!=e?String(e).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this.message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(e){this._tooltipClass=e,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}constructor(e,a,l,u,f,E,y,T,R,L,H,W){this._overlay=e,this._elementRef=a,this._scrollDispatcher=l,this._viewContainerRef=u,this._ngZone=f,this._platform=E,this._ariaDescriber=y,this._focusMonitor=T,this._dir=L,this._defaultOptions=H,this._position="below",this._positionAtOrigin=!1,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._viewportMargin=8,this._cssClassPrefix="mat",this._showDelay=this._defaultOptions.showDelay,this._hideDelay=this._defaultOptions.hideDelay,this.touchGestures="auto",this._message="",this._passiveListeners=[],this._destroyed=new Xt,this._scrollStrategy=R,this._document=W,H&&(H.position&&(this.position=H.position),H.positionAtOrigin&&(this.positionAtOrigin=H.positionAtOrigin),H.touchGestures&&(this.touchGestures=H.touchGestures)),L.change.pipe(So(this._destroyed)).subscribe(()=>{this._overlayRef&&this._updatePosition(this._overlayRef)})}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(So(this._destroyed)).subscribe(e=>{e?"keyboard"===e&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const e=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([a,l])=>{e.removeEventListener(a,l,L3)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),this._ariaDescriber.removeDescription(e,this.message,"tooltip"),this._focusMonitor.stopMonitoring(e)}show(e=this.showDelay,a){if(this.disabled||!this.message||this._isTooltipVisible())return void this._tooltipInstance?._cancelPendingAnimations();const l=this._createOverlay(a);this._detach(),this._portal=this._portal||new T3(this._tooltipComponent,this._viewContainerRef);const u=this._tooltipInstance=l.attach(this._portal).instance;u._triggerElement=this._elementRef.nativeElement,u._mouseLeaveHideDelay=this._hideDelay,u.afterHidden().pipe(So(this._destroyed)).subscribe(()=>this._detach()),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),u.show(e)}hide(e=this.hideDelay){const a=this._tooltipInstance;a&&(a.isVisible()?a.hide(e):(a._cancelPendingAnimations(),this._detach()))}toggle(e){this._isTooltipVisible()?this.hide():this.show(void 0,e)}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(e){if(this._overlayRef){const u=this._overlayRef.getConfig().positionStrategy;if((!this.positionAtOrigin||!e)&&u._origin instanceof cn)return this._overlayRef;this._detach()}const a=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),l=this._overlay.position().flexibleConnectedTo(this.positionAtOrigin&&e||this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(a);return l.positionChanges.pipe(So(this._destroyed)).subscribe(u=>{this._updateCurrentPositionClass(u.connectionPair),this._tooltipInstance&&u.scrollableViewProperties.isOverlayClipped&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({direction:this._dir,positionStrategy:l,panelClass:`${this._cssClassPrefix}-${x3}`,scrollStrategy:this._scrollStrategy()}),this._updatePosition(this._overlayRef),this._overlayRef.detachments().pipe(So(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.outsidePointerEvents().pipe(So(this._destroyed)).subscribe(()=>this._tooltipInstance?._handleBodyInteraction()),this._overlayRef.keydownEvents().pipe(So(this._destroyed)).subscribe(u=>{this._isTooltipVisible()&&27===u.keyCode&&!function B4(i,...t){return t.length?t.some(e=>i[e]):i.altKey||i.shiftKey||i.ctrlKey||i.metaKey}(u)&&(u.preventDefault(),u.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._defaultOptions?.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}_updatePosition(e){const a=e.getConfig().positionStrategy,l=this._getOrigin(),u=this._getOverlayPosition();a.withPositions([this._addOffset({...l.main,...u.main}),this._addOffset({...l.fallback,...u.fallback})])}_addOffset(e){return e}_getOrigin(){const e=!this._dir||"ltr"==this._dir.value,a=this.position;let l;"above"==a||"below"==a?l={originX:"center",originY:"above"==a?"top":"bottom"}:"before"==a||"left"==a&&e||"right"==a&&!e?l={originX:"start",originY:"center"}:("after"==a||"right"==a&&e||"left"==a&&!e)&&(l={originX:"end",originY:"center"});const{x:u,y:f}=this._invertPosition(l.originX,l.originY);return{main:l,fallback:{originX:u,originY:f}}}_getOverlayPosition(){const e=!this._dir||"ltr"==this._dir.value,a=this.position;let l;"above"==a?l={overlayX:"center",overlayY:"bottom"}:"below"==a?l={overlayX:"center",overlayY:"top"}:"before"==a||"left"==a&&e||"right"==a&&!e?l={overlayX:"end",overlayY:"center"}:("after"==a||"right"==a&&e||"left"==a&&!e)&&(l={overlayX:"start",overlayY:"center"});const{x:u,y:f}=this._invertPosition(l.overlayX,l.overlayY);return{main:l,fallback:{overlayX:u,overlayY:f}}}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(Qr(1),So(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(e){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=e,this._tooltipInstance._markForCheck())}_invertPosition(e,a){return"above"===this.position||"below"===this.position?"top"===a?a="bottom":"bottom"===a&&(a="top"):"end"===e?e="start":"start"===e&&(e="end"),{x:e,y:a}}_updateCurrentPositionClass(e){const{overlayY:a,originX:l,originY:u}=e;let f;if(f="center"===a?this._dir&&"rtl"===this._dir.value?"end"===l?"left":"right":"start"===l?"left":"right":"bottom"===a&&"top"===u?"above":"below",f!==this._currentPosition){const E=this._overlayRef;if(E){const y=`${this._cssClassPrefix}-${x3}-`;E.removePanelClass(y+this._currentPosition),E.addPanelClass(y+f)}this._currentPosition=f}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||(this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",e=>{let a;this._setupPointerExitEventsIfNeeded(),void 0!==e.x&&void 0!==e.y&&(a=e),this.show(void 0,a)}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",e=>{const a=e.targetTouches?.[0],l=a?{x:a.clientX,y:a.clientY}:void 0;this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(void 0,l),500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const e=[];if(this._platformSupportsMouseEvents())e.push(["mouseleave",a=>{const l=a.relatedTarget;(!l||!this._overlayRef?.overlayElement.contains(l))&&this.hide()}],["wheel",a=>this._wheelListener(a)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const a=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};e.push(["touchend",a],["touchcancel",a])}this._addListeners(e),this._passiveListeners.push(...e)}_addListeners(e){e.forEach(([a,l])=>{this._elementRef.nativeElement.addEventListener(a,l,L3)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(e){if(this._isTooltipVisible()){const a=this._document.elementFromPoint(e.clientX,e.clientY),l=this._elementRef.nativeElement;a!==l&&!l.contains(a)&&this.hide()}}_disableNativeGesturesIfNecessary(){const e=this.touchGestures;if("off"!==e){const a=this._elementRef.nativeElement,l=a.style;("on"===e||"INPUT"!==a.nodeName&&"TEXTAREA"!==a.nodeName)&&(l.userSelect=l.msUserSelect=l.webkitUserSelect=l.MozUserSelect="none"),("on"===e||!a.draggable)&&(l.webkitUserDrag="none"),l.touchAction="none",l.webkitTapHighlightColor="transparent"}}}return i.\u0275fac=function(e){qp()},i.\u0275dir=je({type:i,inputs:{position:["matTooltipPosition","position"],positionAtOrigin:["matTooltipPositionAtOrigin","positionAtOrigin"],disabled:["matTooltipDisabled","disabled"],showDelay:["matTooltipShowDelay","showDelay"],hideDelay:["matTooltipHideDelay","hideDelay"],touchGestures:["matTooltipTouchGestures","touchGestures"],message:["matTooltip","message"],tooltipClass:["matTooltipClass","tooltipClass"]}}),i})(),s8=(()=>{class i extends o8{constructor(e,a,l,u,f,E,y,T,R,L,H,W){super(e,a,l,u,f,E,y,T,R,L,H,W),this._tooltipComponent=c8,this._cssClassPrefix="mat-mdc",this._viewportMargin=8}_addOffset(e){const l=!this._dir||"ltr"==this._dir.value;return"top"===e.originY?e.offsetY=-8:"bottom"===e.originY?e.offsetY=8:"start"===e.originX?e.offsetX=l?-8:8:"end"===e.originX&&(e.offsetX=l?8:-8),e}}return i.\u0275fac=function(e){return new(e||i)(ie(gN),ie(cn),ie(UT),ie(xo),ie(me),ie(sr),ie(_j),ie(XL),ie(k3),ie(Pv,8),ie(Z6,8),ie(Zt))},i.\u0275dir=je({type:i,selectors:[["","matTooltip",""]],hostAttrs:[1,"mat-mdc-tooltip-trigger"],exportAs:["matTooltip"],features:[Ot]}),i})(),a8=(()=>{class i{constructor(e,a){this._changeDetectorRef=e,this._closeOnInteraction=!1,this._isVisible=!1,this._onHide=new Xt,this._animationsDisabled="NoopAnimations"===a}show(e){clearTimeout(this._hideTimeoutId),this._showTimeoutId=setTimeout(()=>{this._toggleVisibility(!0),this._showTimeoutId=void 0},e)}hide(e){clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0},e)}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){this._cancelPendingAnimations(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:e}){(!e||!this._triggerElement.contains(e))&&(this.isVisible()?this.hide(this._mouseLeaveHideDelay):this._finalizeAnimation(!1))}_onShow(){}_handleAnimationEnd({animationName:e}){(e===this._showAnimation||e===this._hideAnimation)&&this._finalizeAnimation(e===this._showAnimation)}_cancelPendingAnimations(){clearTimeout(this._showTimeoutId),clearTimeout(this._hideTimeoutId),this._showTimeoutId=this._hideTimeoutId=void 0}_finalizeAnimation(e){e?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next()}_toggleVisibility(e){const a=this._tooltip.nativeElement,l=this._showAnimation,u=this._hideAnimation;if(a.classList.remove(e?u:l),a.classList.add(e?l:u),this._isVisible=e,e&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const f=getComputedStyle(a);("0s"===f.getPropertyValue("animation-duration")||"none"===f.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}e&&this._onShow(),this._animationsDisabled&&(a.classList.add("_mat-animation-noopable"),this._finalizeAnimation(e))}}return i.\u0275fac=function(e){return new(e||i)(ie(te),ie(Ca,8))},i.\u0275dir=je({type:i}),i})(),c8=(()=>{class i extends a8{constructor(e,a,l){super(e,l),this._elementRef=a,this._isMultiline=!1,this._showAnimation="mat-mdc-tooltip-show",this._hideAnimation="mat-mdc-tooltip-hide"}_onShow(){this._isMultiline=this._isTooltipMultiline(),this._markForCheck()}_isTooltipMultiline(){const e=this._elementRef.nativeElement.getBoundingClientRect();return e.height>24&&e.width>=200}}return i.\u0275fac=function(e){return new(e||i)(ie(te),ie(cn),ie(Ca,8))},i.\u0275cmp=_r({type:i,selectors:[["mat-tooltip-component"]],viewQuery:function(e,a){if(1&e&&ls(Y6,7),2&e){let l;_i(l=bi())&&(a._tooltip=l.first)}},hostAttrs:["aria-hidden","true"],hostVars:2,hostBindings:function(e,a){1&e&&tn("mouseleave",function(u){return a._handleMouseLeave(u)}),2&e&&tc("zoom",a.isVisible()?1:null)},features:[Ot],decls:4,vars:4,consts:[[1,"mdc-tooltip","mdc-tooltip--shown","mat-mdc-tooltip",3,"ngClass","animationend"],["tooltip",""],[1,"mdc-tooltip__surface","mdc-tooltip__surface-animation"]],template:function(e,a){1&e&&(Ne(0,"div",0,1),tn("animationend",function(u){return a._handleAnimationEnd(u)}),Ne(2,"div",2),Ki(3),Ge()()),2&e&&(Bt("mdc-tooltip--multiline",a._isMultiline),nt("ngClass",a.tooltipClass),Ze(3),dd(a.message))},dependencies:[TE],styles:['.mdc-tooltip__surface{word-break:var(--mdc-tooltip-word-break, normal);overflow-wrap:anywhere}.mdc-tooltip{position:fixed;display:none;z-index:9}.mdc-tooltip-wrapper--rich{position:relative}.mdc-tooltip--shown,.mdc-tooltip--showing,.mdc-tooltip--hide{display:inline-flex}.mdc-tooltip--shown.mdc-tooltip--rich,.mdc-tooltip--showing.mdc-tooltip--rich,.mdc-tooltip--hide.mdc-tooltip--rich{display:inline-block;left:-320px;position:absolute}.mdc-tooltip__surface{line-height:16px;padding:4px 8px;min-width:40px;max-width:200px;min-height:24px;max-height:40vh;box-sizing:border-box;overflow:hidden;text-align:center}.mdc-tooltip__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-tooltip__surface::before{border-color:CanvasText}}.mdc-tooltip--rich .mdc-tooltip__surface{align-items:flex-start;display:flex;flex-direction:column;min-height:24px;min-width:40px;max-width:320px;position:relative}.mdc-tooltip--multiline .mdc-tooltip__surface{text-align:left}[dir=rtl] .mdc-tooltip--multiline .mdc-tooltip__surface,.mdc-tooltip--multiline .mdc-tooltip__surface[dir=rtl]{text-align:right}.mdc-tooltip__surface .mdc-tooltip__title{margin:0 8px}.mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(200px - (2 * 8px));margin:8px;text-align:left}[dir=rtl] .mdc-tooltip__surface .mdc-tooltip__content,.mdc-tooltip__surface .mdc-tooltip__content[dir=rtl]{text-align:right}.mdc-tooltip--rich .mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(320px - (2 * 8px));align-self:stretch}.mdc-tooltip__surface .mdc-tooltip__content-link{text-decoration:none}.mdc-tooltip--rich-actions,.mdc-tooltip__content,.mdc-tooltip__title{z-index:1}.mdc-tooltip__surface-animation{opacity:0;transform:scale(0.8);will-change:transform,opacity}.mdc-tooltip--shown .mdc-tooltip__surface-animation{transform:scale(1);opacity:1}.mdc-tooltip--hide .mdc-tooltip__surface-animation{transform:scale(1)}.mdc-tooltip__caret-surface-top,.mdc-tooltip__caret-surface-bottom{position:absolute;height:24px;width:24px;transform:rotate(35deg) skewY(20deg) scaleX(0.9396926208)}.mdc-tooltip__caret-surface-top .mdc-elevation-overlay,.mdc-tooltip__caret-surface-bottom .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-tooltip__caret-surface-bottom{outline:1px solid rgba(0,0,0,0);z-index:-1}@media screen and (forced-colors: active){.mdc-tooltip__caret-surface-bottom{outline-color:CanvasText}}.mdc-tooltip__surface{background-color:var(--mdc-plain-tooltip-container-color, #fff)}.mdc-tooltip__surface{border-radius:var(--mdc-plain-tooltip-container-shape, var(--mdc-shape-small, 4px))}.mdc-tooltip__caret-surface-top,.mdc-tooltip__caret-surface-bottom{border-radius:var(--mdc-plain-tooltip-container-shape, var(--mdc-shape-small, 4px))}.mdc-tooltip__surface{color:var(--mdc-plain-tooltip-supporting-text-color, #000)}.mdc-tooltip__surface{font-family:var(--mdc-plain-tooltip-supporting-text-font, inherit);font-size:var(--mdc-plain-tooltip-supporting-text-size, inherit);font-weight:var(--mdc-plain-tooltip-supporting-text-weight, inherit);letter-spacing:var(--mdc-plain-tooltip-supporting-text-tracking, inherit)}.mat-mdc-tooltip{position:relative;transform:scale(0)}.mat-mdc-tooltip::before{content:"";top:0;right:0;bottom:0;left:0;z-index:-1;position:absolute}.mat-mdc-tooltip-panel-below .mat-mdc-tooltip::before{top:-8px}.mat-mdc-tooltip-panel-above .mat-mdc-tooltip::before{bottom:-8px}.mat-mdc-tooltip-panel-right .mat-mdc-tooltip::before{left:-8px}.mat-mdc-tooltip-panel-left .mat-mdc-tooltip::before{right:-8px}.mat-mdc-tooltip._mat-animation-noopable{animation:none;transform:scale(1)}.mat-mdc-tooltip-panel-non-interactive{pointer-events:none}@keyframes mat-mdc-tooltip-show{0%{opacity:0;transform:scale(0.8)}100%{opacity:1;transform:scale(1)}}@keyframes mat-mdc-tooltip-hide{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0.8)}}.mat-mdc-tooltip-show{animation:mat-mdc-tooltip-show 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-mdc-tooltip-hide{animation:mat-mdc-tooltip-hide 75ms cubic-bezier(0.4, 0, 1, 1) forwards}'],encapsulation:2,changeDetection:0}),i})(),l8=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({providers:[J6],imports:[Rj,Kf,q6,xa,xa,c2]}),i})();function F3(i){return new he(3e3,!1)}function W8(){return typeof window<"u"&&typeof window.document<"u"}function u2(){return typeof process<"u"&&"[object process]"==={}.toString.call(process)}function ep(i){switch(i.length){case 0:return new FT;case 1:return i[0];default:return new t3(i)}}function U3(i,t,e,a,l=new Map,u=new Map){const f=[],E=[];let y=-1,T=null;if(a.forEach(R=>{const L=R.get("offset"),H=L==y,W=H&&T||new Map;R.forEach((q,re)=>{let ce=re,Te=q;if("offset"!==re)switch(ce=t.normalizePropertyName(ce,f),Te){case t2:Te=l.get(re);break;case Qd:Te=u.get(re);break;default:Te=t.normalizeStyleValue(re,ce,Te,f)}W.set(ce,Te)}),H||E.push(W),T=W,y=L}),f.length)throw function P8(i){return new he(3502,!1)}();return E}function h2(i,t,e,a){switch(t){case"start":i.onStart(()=>a(e&&p2(e,"start",i)));break;case"done":i.onDone(()=>a(e&&p2(e,"done",i)));break;case"destroy":i.onDestroy(()=>a(e&&p2(e,"destroy",i)))}}function p2(i,t,e){const u=f2(i.element,i.triggerName,i.fromState,i.toState,t||i.phaseName,e.totalTime??i.totalTime,!!e.disabled),f=i._data;return null!=f&&(u._data=f),u}function f2(i,t,e,a,l="",u=0,f){return{element:i,triggerName:t,fromState:e,toState:a,phaseName:l,totalTime:u,disabled:!!f}}function Zs(i,t,e){let a=i.get(t);return a||i.set(t,a=e),a}function V3(i){const t=i.indexOf(":");return[i.substring(1,t),i.slice(t+1)]}let m2=(i,t)=>!1,B3=(i,t,e)=>[],j3=null;function _2(i){const t=i.parentNode||i.host;return t===j3?null:t}(u2()||typeof Element<"u")&&(W8()?(j3=(()=>document.documentElement)(),m2=(i,t)=>{for(;t;){if(t===i)return!0;t=_2(t)}return!1}):m2=(i,t)=>i.contains(t),B3=(i,t,e)=>{if(e)return Array.from(i.querySelectorAll(t));const a=i.querySelector(t);return a?[a]:[]});let wm=null,H3=!1;const G3=m2,W3=B3;let z3=(()=>{class i{validateStyleProperty(e){return function K8(i){wm||(wm=function q8(){return typeof document<"u"?document.body:null}()||{},H3=!!wm.style&&"WebkitAppearance"in wm.style);let t=!0;return wm.style&&!function z8(i){return"ebkit"==i.substring(1,6)}(i)&&(t=i in wm.style,!t&&H3&&(t="Webkit"+i.charAt(0).toUpperCase()+i.slice(1)in wm.style)),t}(e)}matchesElement(e,a){return!1}containsElement(e,a){return G3(e,a)}getParentElement(e){return _2(e)}query(e,a,l){return W3(e,a,l)}computeStyle(e,a,l){return l||""}animate(e,a,l,u,f,E=[],y){return new FT(l,u)}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=Oe({token:i,factory:i.\u0275fac}),i})(),g2=(()=>{class i{}return i.NOOP=new z3,i})();const Y8=1e3,E2="ng-enter",EN="ng-leave",vN="ng-trigger",yN=".ng-trigger",q3="ng-animating",v2=".ng-animating";function Zd(i){if("number"==typeof i)return i;const t=i.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:y2(parseFloat(t[1]),t[2])}function y2(i,t){return"s"===t?i*Y8:i}function bN(i,t,e){return i.hasOwnProperty("duration")?i:function X8(i,t,e){let l,u=0,f="";if("string"==typeof i){const E=i.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===E)return t.push(F3()),{duration:0,delay:0,easing:""};l=y2(parseFloat(E[1]),E[2]);const y=E[3];null!=y&&(u=y2(parseFloat(y),E[4]));const T=E[5];T&&(f=T)}else l=i;if(!e){let E=!1,y=t.length;l<0&&(t.push(function d8(){return new he(3100,!1)}()),E=!0),u<0&&(t.push(function u8(){return new he(3101,!1)}()),E=!0),E&&t.splice(y,0,F3())}return{duration:l,delay:u,easing:f}}(i,t,e)}function VT(i,t={}){return Object.keys(i).forEach(e=>{t[e]=i[e]}),t}function Y3(i){const t=new Map;return Object.keys(i).forEach(e=>{t.set(e,i[e])}),t}function tp(i,t=new Map,e){if(e)for(let[a,l]of e)t.set(a,l);for(let[a,l]of i)t.set(a,l);return t}function X3(i,t,e){return e?t+":"+e+";":""}function J3(i){let t="";for(let e=0;e<i.style.length;e++){const a=i.style.item(e);t+=X3(0,a,i.style.getPropertyValue(a))}for(const e in i.style)i.style.hasOwnProperty(e)&&!e.startsWith("_")&&(t+=X3(0,eH(e),i.style[e]));i.setAttribute("style",t)}function gl(i,t,e){i.style&&(t.forEach((a,l)=>{const u=S2(l);e&&!e.has(l)&&e.set(l,i.style[u]),i.style[u]=a}),u2()&&J3(i))}function Im(i,t){i.style&&(t.forEach((e,a)=>{const l=S2(a);i.style[l]=""}),u2()&&J3(i))}function BT(i){return Array.isArray(i)?1==i.length?i[0]:ZV(i):i}const b2=new RegExp("{{\\s*(.+?)\\s*}}","g");function Q3(i){let t=[];if("string"==typeof i){let e;for(;e=b2.exec(i);)t.push(e[1]);b2.lastIndex=0}return t}function jT(i,t,e){const a=i.toString(),l=a.replace(b2,(u,f)=>{let E=t[f];return null==E&&(e.push(function p8(i){return new he(3003,!1)}()),E=""),E.toString()});return l==a?i:l}function SN(i){const t=[];let e=i.next();for(;!e.done;)t.push(e.value),e=i.next();return t}const Z8=/-+([a-z0-9])/g;function S2(i){return i.replace(Z8,(...t)=>t[1].toUpperCase())}function eH(i){return i.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function ea(i,t,e){switch(t.type){case 7:return i.visitTrigger(t,e);case 0:return i.visitState(t,e);case 1:return i.visitTransition(t,e);case 2:return i.visitSequence(t,e);case 3:return i.visitGroup(t,e);case 4:return i.visitAnimate(t,e);case 5:return i.visitKeyframes(t,e);case 6:return i.visitStyle(t,e);case 8:return i.visitReference(t,e);case 9:return i.visitAnimateChild(t,e);case 10:return i.visitAnimateRef(t,e);case 11:return i.visitQuery(t,e);case 12:return i.visitStagger(t,e);default:throw function f8(i){return new he(3004,!1)}()}}function Z3(i,t){return window.getComputedStyle(i)[t]}const wN="*";function sH(i,t){const e=[];return"string"==typeof i?i.split(/\s*,\s*/).forEach(a=>function aH(i,t,e){if(":"==i[0]){const y=function cH(i,t){switch(i){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,a)=>parseFloat(a)>parseFloat(e);case":decrement":return(e,a)=>parseFloat(a)<parseFloat(e);default:return t.push(function A8(i){return new he(3016,!1)}()),"* => *"}}(i,e);if("function"==typeof y)return void t.push(y);i=y}const a=i.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==a||a.length<4)return e.push(function R8(i){return new he(3015,!1)}()),t;const l=a[1],u=a[2],f=a[3];t.push(eB(l,f));"<"==u[0]&&!(l==wN&&f==wN)&&t.push(eB(f,l))}(a,e,t)):e.push(i),e}const IN=new Set(["true","1"]),RN=new Set(["false","0"]);function eB(i,t){const e=IN.has(i)||RN.has(i),a=IN.has(t)||RN.has(t);return(l,u)=>{let f=i==wN||i==l,E=t==wN||t==u;return!f&&e&&"boolean"==typeof l&&(f=l?IN.has(i):RN.has(i)),!E&&a&&"boolean"==typeof u&&(E=u?IN.has(t):RN.has(t)),f&&E}}const lH=new RegExp("s*:selfs*,?","g");function C2(i,t,e,a){return new dH(i).build(t,e,a)}class dH{constructor(t){this._driver=t}build(t,e,a){const l=new pH(e);return this._resetContextStyleTimingState(l),ea(this,BT(t),l)}_resetContextStyleTimingState(t){t.currentQuerySelector="",t.collectedStyles=new Map,t.collectedStyles.set("",new Map),t.currentTime=0}visitTrigger(t,e){let a=e.queryCount=0,l=e.depCount=0;const u=[],f=[];return"@"==t.name.charAt(0)&&e.errors.push(function _8(){return new he(3006,!1)}()),t.definitions.forEach(E=>{if(this._resetContextStyleTimingState(e),0==E.type){const y=E,T=y.name;T.toString().split(/\s*,\s*/).forEach(R=>{y.name=R,u.push(this.visitState(y,e))}),y.name=T}else if(1==E.type){const y=this.visitTransition(E,e);a+=y.queryCount,l+=y.depCount,f.push(y)}else e.errors.push(function g8(){return new he(3007,!1)}())}),{type:7,name:t.name,states:u,transitions:f,queryCount:a,depCount:l,options:null}}visitState(t,e){const a=this.visitStyle(t.styles,e),l=t.options&&t.options.params||null;if(a.containsDynamicStyles){const u=new Set,f=l||{};a.styles.forEach(E=>{E instanceof Map&&E.forEach(y=>{Q3(y).forEach(T=>{f.hasOwnProperty(T)||u.add(T)})})}),u.size&&(SN(u.values()),e.errors.push(function E8(i,t){return new he(3008,!1)}()))}return{type:0,name:t.name,style:a,options:l?{params:l}:null}}visitTransition(t,e){e.queryCount=0,e.depCount=0;const a=ea(this,BT(t.animation),e);return{type:1,matchers:sH(t.expr,e.errors),animation:a,queryCount:e.queryCount,depCount:e.depCount,options:Rm(t.options)}}visitSequence(t,e){return{type:2,steps:t.steps.map(a=>ea(this,a,e)),options:Rm(t.options)}}visitGroup(t,e){const a=e.currentTime;let l=0;const u=t.steps.map(f=>{e.currentTime=a;const E=ea(this,f,e);return l=Math.max(l,e.currentTime),E});return e.currentTime=l,{type:3,steps:u,options:Rm(t.options)}}visitAnimate(t,e){const a=function mH(i,t){if(i.hasOwnProperty("duration"))return i;if("number"==typeof i)return T2(bN(i,t).duration,0,"");const e=i;if(e.split(/\s+/).some(u=>"{"==u.charAt(0)&&"{"==u.charAt(1))){const u=T2(0,0,"");return u.dynamic=!0,u.strValue=e,u}const l=bN(e,t);return T2(l.duration,l.delay,l.easing)}(t.timings,e.errors);e.currentAnimateTimings=a;let l,u=t.styles?t.styles:_l({});if(5==u.type)l=this.visitKeyframes(u,e);else{let f=t.styles,E=!1;if(!f){E=!0;const T={};a.easing&&(T.easing=a.easing),f=_l(T)}e.currentTime+=a.duration+a.delay;const y=this.visitStyle(f,e);y.isEmptyStep=E,l=y}return e.currentAnimateTimings=null,{type:4,timings:a,style:l,options:null}}visitStyle(t,e){const a=this._makeStyleAst(t,e);return this._validateStyleAst(a,e),a}_makeStyleAst(t,e){const a=[],l=Array.isArray(t.styles)?t.styles:[t.styles];for(let E of l)"string"==typeof E?E===Qd?a.push(E):e.errors.push(new he(3002,!1)):a.push(Y3(E));let u=!1,f=null;return a.forEach(E=>{if(E instanceof Map&&(E.has("easing")&&(f=E.get("easing"),E.delete("easing")),!u))for(let y of E.values())if(y.toString().indexOf("{{")>=0){u=!0;break}}),{type:6,styles:a,easing:f,offset:t.offset,containsDynamicStyles:u,options:null}}_validateStyleAst(t,e){const a=e.currentAnimateTimings;let l=e.currentTime,u=e.currentTime;a&&u>0&&(u-=a.duration+a.delay),t.styles.forEach(f=>{"string"!=typeof f&&f.forEach((E,y)=>{const T=e.collectedStyles.get(e.currentQuerySelector),R=T.get(y);let L=!0;R&&(u!=l&&u>=R.startTime&&l<=R.endTime&&(e.errors.push(function y8(i,t,e,a,l){return new he(3010,!1)}()),L=!1),u=R.startTime),L&&T.set(y,{startTime:u,endTime:l}),e.options&&function Q8(i,t,e){const a=t.params||{},l=Q3(i);l.length&&l.forEach(u=>{a.hasOwnProperty(u)||e.push(function h8(i){return new he(3001,!1)}())})}(E,e.options,e.errors)})})}visitKeyframes(t,e){const a={type:5,styles:[],options:null};if(!e.currentAnimateTimings)return e.errors.push(function b8(){return new he(3011,!1)}()),a;let u=0;const f=[];let E=!1,y=!1,T=0;const R=t.steps.map(Te=>{const De=this._makeStyleAst(Te,e);let ue=null!=De.offset?De.offset:function fH(i){if("string"==typeof i)return null;let t=null;if(Array.isArray(i))i.forEach(e=>{if(e instanceof Map&&e.has("offset")){const a=e;t=parseFloat(a.get("offset")),a.delete("offset")}});else if(i instanceof Map&&i.has("offset")){const e=i;t=parseFloat(e.get("offset")),e.delete("offset")}return t}(De.styles),Ue=0;return null!=ue&&(u++,Ue=De.offset=ue),y=y||Ue<0||Ue>1,E=E||Ue<T,T=Ue,f.push(Ue),De});y&&e.errors.push(function S8(){return new he(3012,!1)}()),E&&e.errors.push(function C8(){return new he(3200,!1)}());const L=t.steps.length;let H=0;u>0&&u<L?e.errors.push(function T8(){return new he(3202,!1)}()):0==u&&(H=1/(L-1));const W=L-1,q=e.currentTime,re=e.currentAnimateTimings,ce=re.duration;return R.forEach((Te,De)=>{const ue=H>0?De==W?1:H*De:f[De],Ue=ue*ce;e.currentTime=q+re.delay+Ue,re.duration=Ue,this._validateStyleAst(Te,e),Te.offset=ue,a.styles.push(Te)}),a}visitReference(t,e){return{type:8,animation:ea(this,BT(t.animation),e),options:Rm(t.options)}}visitAnimateChild(t,e){return e.depCount++,{type:9,options:Rm(t.options)}}visitAnimateRef(t,e){return{type:10,animation:this.visitReference(t.animation,e),options:Rm(t.options)}}visitQuery(t,e){const a=e.currentQuerySelector,l=t.options||{};e.queryCount++,e.currentQuery=t;const[u,f]=function uH(i){const t=!!i.split(/\s*,\s*/).find(e=>":self"==e);return t&&(i=i.replace(lH,"")),i=i.replace(/@\*/g,yN).replace(/@\w+/g,e=>yN+"-"+e.slice(1)).replace(/:animating/g,v2),[i,t]}(t.selector);e.currentQuerySelector=a.length?a+" "+u:u,Zs(e.collectedStyles,e.currentQuerySelector,new Map);const E=ea(this,BT(t.animation),e);return e.currentQuery=null,e.currentQuerySelector=a,{type:11,selector:u,limit:l.limit||0,optional:!!l.optional,includeSelf:f,animation:E,originalSelector:t.selector,options:Rm(t.options)}}visitStagger(t,e){e.currentQuery||e.errors.push(function w8(){return new he(3013,!1)}());const a="full"===t.timings?{duration:0,delay:0,easing:"full"}:bN(t.timings,e.errors,!0);return{type:12,animation:ea(this,BT(t.animation),e),timings:a,options:null}}}class pH{constructor(t){this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function Rm(i){return i?(i=VT(i)).params&&(i.params=function hH(i){return i?VT(i):null}(i.params)):i={},i}function T2(i,t,e){return{duration:i,delay:t,easing:e}}function w2(i,t,e,a,l,u,f=null,E=!1){return{type:1,element:i,keyframes:t,preStyleProps:e,postStyleProps:a,duration:l,delay:u,totalTime:l+u,easing:f,subTimeline:E}}class AN{constructor(){this._map=new Map}get(t){return this._map.get(t)||[]}append(t,e){let a=this._map.get(t);a||this._map.set(t,a=[]),a.push(...e)}has(t){return this._map.has(t)}clear(){this._map.clear()}}const EH=new RegExp(":enter","g"),yH=new RegExp(":leave","g");function I2(i,t,e,a,l,u=new Map,f=new Map,E,y,T=[]){return(new bH).buildKeyframes(i,t,e,a,l,u,f,E,y,T)}class bH{buildKeyframes(t,e,a,l,u,f,E,y,T,R=[]){T=T||new AN;const L=new R2(t,e,T,l,u,R,[]);L.options=y;const H=y.delay?Zd(y.delay):0;L.currentTimeline.delayNextStep(H),L.currentTimeline.setStyles([f],null,L.errors,y),ea(this,a,L);const W=L.timelines.filter(q=>q.containsAnimation());if(W.length&&E.size){let q;for(let re=W.length-1;re>=0;re--){const ce=W[re];if(ce.element===e){q=ce;break}}q&&!q.allowOnlyTimelineStyles()&&q.setStyles([E],null,L.errors,y)}return W.length?W.map(q=>q.buildKeyframes()):[w2(e,[],[],[],0,H,"",!1)]}visitTrigger(t,e){}visitState(t,e){}visitTransition(t,e){}visitAnimateChild(t,e){const a=e.subInstructions.get(e.element);if(a){const l=e.createSubContext(t.options),u=e.currentTimeline.currentTime,f=this._visitSubInstructions(a,l,l.options);u!=f&&e.transformIntoNewTimeline(f)}e.previousNode=t}visitAnimateRef(t,e){const a=e.createSubContext(t.options);a.transformIntoNewTimeline(),this._applyAnimationRefDelays([t.options,t.animation.options],e,a),this.visitReference(t.animation,a),e.transformIntoNewTimeline(a.currentTimeline.currentTime),e.previousNode=t}_applyAnimationRefDelays(t,e,a){for(const l of t){const u=l?.delay;if(u){const f="number"==typeof u?u:Zd(jT(u,l?.params??{},e.errors));a.delayNextStep(f)}}}_visitSubInstructions(t,e,a){let u=e.currentTimeline.currentTime;const f=null!=a.duration?Zd(a.duration):null,E=null!=a.delay?Zd(a.delay):null;return 0!==f&&t.forEach(y=>{const T=e.appendInstructionToTimeline(y,f,E);u=Math.max(u,T.duration+T.delay)}),u}visitReference(t,e){e.updateOptions(t.options,!0),ea(this,t.animation,e),e.previousNode=t}visitSequence(t,e){const a=e.subContextCount;let l=e;const u=t.options;if(u&&(u.params||u.delay)&&(l=e.createSubContext(u),l.transformIntoNewTimeline(),null!=u.delay)){6==l.previousNode.type&&(l.currentTimeline.snapshotCurrentStyles(),l.previousNode=DN);const f=Zd(u.delay);l.delayNextStep(f)}t.steps.length&&(t.steps.forEach(f=>ea(this,f,l)),l.currentTimeline.applyStylesToKeyframe(),l.subContextCount>a&&l.transformIntoNewTimeline()),e.previousNode=t}visitGroup(t,e){const a=[];let l=e.currentTimeline.currentTime;const u=t.options&&t.options.delay?Zd(t.options.delay):0;t.steps.forEach(f=>{const E=e.createSubContext(t.options);u&&E.delayNextStep(u),ea(this,f,E),l=Math.max(l,E.currentTimeline.currentTime),a.push(E.currentTimeline)}),a.forEach(f=>e.currentTimeline.mergeTimelineCollectedStyles(f)),e.transformIntoNewTimeline(l),e.previousNode=t}_visitTiming(t,e){if(t.dynamic){const a=t.strValue;return bN(e.params?jT(a,e.params,e.errors):a,e.errors)}return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,e){const a=e.currentAnimateTimings=this._visitTiming(t.timings,e),l=e.currentTimeline;a.delay&&(e.incrementTime(a.delay),l.snapshotCurrentStyles());const u=t.style;5==u.type?this.visitKeyframes(u,e):(e.incrementTime(a.duration),this.visitStyle(u,e),l.applyStylesToKeyframe()),e.currentAnimateTimings=null,e.previousNode=t}visitStyle(t,e){const a=e.currentTimeline,l=e.currentAnimateTimings;!l&&a.hasCurrentStyleProperties()&&a.forwardFrame();const u=l&&l.easing||t.easing;t.isEmptyStep?a.applyEmptyStep(u):a.setStyles(t.styles,u,e.errors,e.options),e.previousNode=t}visitKeyframes(t,e){const a=e.currentAnimateTimings,l=e.currentTimeline.duration,u=a.duration,E=e.createSubContext().currentTimeline;E.easing=a.easing,t.styles.forEach(y=>{E.forwardTime((y.offset||0)*u),E.setStyles(y.styles,y.easing,e.errors,e.options),E.applyStylesToKeyframe()}),e.currentTimeline.mergeTimelineCollectedStyles(E),e.transformIntoNewTimeline(l+u),e.previousNode=t}visitQuery(t,e){const a=e.currentTimeline.currentTime,l=t.options||{},u=l.delay?Zd(l.delay):0;u&&(6===e.previousNode.type||0==a&&e.currentTimeline.hasCurrentStyleProperties())&&(e.currentTimeline.snapshotCurrentStyles(),e.previousNode=DN);let f=a;const E=e.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!l.optional,e.errors);e.currentQueryTotal=E.length;let y=null;E.forEach((T,R)=>{e.currentQueryIndex=R;const L=e.createSubContext(t.options,T);u&&L.delayNextStep(u),T===e.element&&(y=L.currentTimeline),ea(this,t.animation,L),L.currentTimeline.applyStylesToKeyframe(),f=Math.max(f,L.currentTimeline.currentTime)}),e.currentQueryIndex=0,e.currentQueryTotal=0,e.transformIntoNewTimeline(f),y&&(e.currentTimeline.mergeTimelineCollectedStyles(y),e.currentTimeline.snapshotCurrentStyles()),e.previousNode=t}visitStagger(t,e){const a=e.parentContext,l=e.currentTimeline,u=t.timings,f=Math.abs(u.duration),E=f*(e.currentQueryTotal-1);let y=f*e.currentQueryIndex;switch(u.duration<0?"reverse":u.easing){case"reverse":y=E-y;break;case"full":y=a.currentStaggerTime}const R=e.currentTimeline;y&&R.delayNextStep(y);const L=R.currentTime;ea(this,t.animation,e),e.previousNode=t,a.currentStaggerTime=l.currentTime-L+(l.startTime-a.currentTimeline.startTime)}}const DN={};class R2{constructor(t,e,a,l,u,f,E,y){this._driver=t,this.element=e,this.subInstructions=a,this._enterClassName=l,this._leaveClassName=u,this.errors=f,this.timelines=E,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=DN,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=y||new ON(this._driver,e,0),E.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,e){if(!t)return;const a=t;let l=this.options;null!=a.duration&&(l.duration=Zd(a.duration)),null!=a.delay&&(l.delay=Zd(a.delay));const u=a.params;if(u){let f=l.params;f||(f=this.options.params={}),Object.keys(u).forEach(E=>{(!e||!f.hasOwnProperty(E))&&(f[E]=jT(u[E],f,this.errors))})}}_copyOptions(){const t={};if(this.options){const e=this.options.params;if(e){const a=t.params={};Object.keys(e).forEach(l=>{a[l]=e[l]})}}return t}createSubContext(t=null,e,a){const l=e||this.element,u=new R2(this._driver,l,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(l,a||0));return u.previousNode=this.previousNode,u.currentAnimateTimings=this.currentAnimateTimings,u.options=this._copyOptions(),u.updateOptions(t),u.currentQueryIndex=this.currentQueryIndex,u.currentQueryTotal=this.currentQueryTotal,u.parentContext=this,this.subContextCount++,u}transformIntoNewTimeline(t){return this.previousNode=DN,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,e,a){const l={duration:e??t.duration,delay:this.currentTimeline.currentTime+(a??0)+t.delay,easing:""},u=new SH(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,l,t.stretchStartingKeyframe);return this.timelines.push(u),l}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,e,a,l,u,f){let E=[];if(l&&E.push(this.element),t.length>0){t=(t=t.replace(EH,"."+this._enterClassName)).replace(yH,"."+this._leaveClassName);let T=this._driver.query(this.element,t,1!=a);0!==a&&(T=a<0?T.slice(T.length+a,T.length):T.slice(0,a)),E.push(...T)}return!u&&0==E.length&&f.push(function I8(i){return new he(3014,!1)}()),E}}class ON{constructor(t,e,a,l){this._driver=t,this.element=e,this.startTime=a,this._elementTimelineStylesLookup=l,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(e),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(e,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(t){const e=1===this._keyframes.size&&this._pendingStyles.size;this.duration||e?(this.forwardTime(this.currentTime+t),e&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,e){return this.applyStylesToKeyframe(),new ON(this._driver,t,e||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,e){this._localTimelineStyles.set(t,e),this._globalTimelineStyles.set(t,e),this._styleSummary.set(t,{time:this.currentTime,value:e})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&this._previousKeyframe.set("easing",t);for(let[e,a]of this._globalTimelineStyles)this._backFill.set(e,a||Qd),this._currentKeyframe.set(e,Qd);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,e,a,l){e&&this._previousKeyframe.set("easing",e);const u=l&&l.params||{},f=function CH(i,t){const e=new Map;let a;return i.forEach(l=>{if("*"===l){a=a||t.keys();for(let u of a)e.set(u,Qd)}else tp(l,e)}),e}(t,this._globalTimelineStyles);for(let[E,y]of f){const T=jT(y,u,a);this._pendingStyles.set(E,T),this._localTimelineStyles.has(E)||this._backFill.set(E,this._globalTimelineStyles.get(E)??Qd),this._updateStyle(E,T)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((t,e)=>{this._currentKeyframe.set(e,t)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((t,e)=>{this._currentKeyframe.has(e)||this._currentKeyframe.set(e,t)}))}snapshotCurrentStyles(){for(let[t,e]of this._localTimelineStyles)this._pendingStyles.set(t,e),this._updateStyle(t,e)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const t=[];for(let e in this._currentKeyframe)t.push(e);return t}mergeTimelineCollectedStyles(t){t._styleSummary.forEach((e,a)=>{const l=this._styleSummary.get(a);(!l||e.time>l.time)&&this._updateStyle(a,e.value)})}buildKeyframes(){this.applyStylesToKeyframe();const t=new Set,e=new Set,a=1===this._keyframes.size&&0===this.duration;let l=[];this._keyframes.forEach((E,y)=>{const T=tp(E,new Map,this._backFill);T.forEach((R,L)=>{R===t2?t.add(L):R===Qd&&e.add(L)}),a||T.set("offset",y/this.duration),l.push(T)});const u=t.size?SN(t.values()):[],f=e.size?SN(e.values()):[];if(a){const E=l[0],y=new Map(E);E.set("offset",0),y.set("offset",1),l=[E,y]}return w2(this.element,l,u,f,this.duration,this.startTime,this.easing,!1)}}class SH extends ON{constructor(t,e,a,l,u,f,E=!1){super(t,e,f.delay),this.keyframes=a,this.preStyleProps=l,this.postStyleProps=u,this._stretchStartingKeyframe=E,this.timings={duration:f.duration,delay:f.delay,easing:f.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:e,duration:a,easing:l}=this.timings;if(this._stretchStartingKeyframe&&e){const u=[],f=a+e,E=e/f,y=tp(t[0]);y.set("offset",0),u.push(y);const T=tp(t[0]);T.set("offset",iB(E)),u.push(T);const R=t.length-1;for(let L=1;L<=R;L++){let H=tp(t[L]);const W=H.get("offset");H.set("offset",iB((e+W*a)/f)),u.push(H)}a=f,e=0,l="",t=u}return w2(this.element,t,this.preStyleProps,this.postStyleProps,a,e,l,!0)}}function iB(i,t=3){const e=Math.pow(10,t-1);return Math.round(i*e)/e}class A2{}const TH=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class wH extends A2{normalizePropertyName(t,e){return S2(t)}normalizeStyleValue(t,e,a,l){let u="";const f=a.toString().trim();if(TH.has(e)&&0!==a&&"0"!==a)if("number"==typeof a)u="px";else{const E=a.match(/^[+-]?[\d\.]+([a-z]*)$/);E&&0==E[1].length&&l.push(function m8(i,t){return new he(3005,!1)}())}return f+u}}function rB(i,t,e,a,l,u,f,E,y,T,R,L,H){return{type:0,element:i,triggerName:t,isRemovalTransition:l,fromState:e,fromStyles:u,toState:a,toStyles:f,timelines:E,queriedElements:y,preStyleProps:T,postStyleProps:R,totalTime:L,errors:H}}const D2={};class oB{constructor(t,e,a){this._triggerName=t,this.ast=e,this._stateStyles=a}match(t,e,a,l){return function IH(i,t,e,a,l){return i.some(u=>u(t,e,a,l))}(this.ast.matchers,t,e,a,l)}buildStyles(t,e,a){let l=this._stateStyles.get("*");return void 0!==t&&(l=this._stateStyles.get(t?.toString())||l),l?l.buildStyles(e,a):new Map}build(t,e,a,l,u,f,E,y,T,R){const L=[],H=this.ast.options&&this.ast.options.params||D2,q=this.buildStyles(a,E&&E.params||D2,L),re=y&&y.params||D2,ce=this.buildStyles(l,re,L),Te=new Set,De=new Map,ue=new Map,Ue="void"===l,qt={params:RH(re,H),delay:this.ast.options?.delay},wn=R?[]:I2(t,e,this.ast.animation,u,f,q,ce,qt,T,L);let Co=0;if(wn.forEach(nu=>{Co=Math.max(nu.duration+nu.delay,Co)}),L.length)return rB(e,this._triggerName,a,l,Ue,q,ce,[],[],De,ue,Co,L);wn.forEach(nu=>{const iu=nu.element,k4=Zs(De,iu,new Set);nu.preStyleProps.forEach(km=>k4.add(km));const o0=Zs(ue,iu,new Set);nu.postStyleProps.forEach(km=>o0.add(km)),iu!==e&&Te.add(iu)});const tu=SN(Te.values());return rB(e,this._triggerName,a,l,Ue,q,ce,wn,tu,De,ue,Co)}}function RH(i,t){const e=VT(t);for(const a in i)i.hasOwnProperty(a)&&null!=i[a]&&(e[a]=i[a]);return e}class AH{constructor(t,e,a){this.styles=t,this.defaultParams=e,this.normalizer=a}buildStyles(t,e){const a=new Map,l=VT(this.defaultParams);return Object.keys(t).forEach(u=>{const f=t[u];null!==f&&(l[u]=f)}),this.styles.styles.forEach(u=>{"string"!=typeof u&&u.forEach((f,E)=>{f&&(f=jT(f,l,e));const y=this.normalizer.normalizePropertyName(E,e);f=this.normalizer.normalizeStyleValue(E,y,f,e),a.set(E,f)})}),a}}class OH{constructor(t,e,a){this.name=t,this.ast=e,this._normalizer=a,this.transitionFactories=[],this.states=new Map,e.states.forEach(l=>{this.states.set(l.name,new AH(l.style,l.options&&l.options.params||{},a))}),sB(this.states,"true","1"),sB(this.states,"false","0"),e.transitions.forEach(l=>{this.transitionFactories.push(new oB(t,l,this.states))}),this.fallbackTransition=function NH(i,t,e){return new oB(i,{type:1,animation:{type:2,steps:[],options:null},matchers:[(f,E)=>!0],options:null,queryCount:0,depCount:0},t)}(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,e,a,l){return this.transitionFactories.find(f=>f.match(t,e,a,l))||null}matchStyles(t,e,a){return this.fallbackTransition.buildStyles(t,e,a)}}function sB(i,t,e){i.has(t)?i.has(e)||i.set(e,i.get(t)):i.has(e)&&i.set(t,i.get(e))}const PH=new AN;class MH{constructor(t,e,a){this.bodyNode=t,this._driver=e,this._normalizer=a,this._animations=new Map,this._playersById=new Map,this.players=[]}register(t,e){const a=[],l=[],u=C2(this._driver,e,a,l);if(a.length)throw function M8(i){return new he(3503,!1)}();this._animations.set(t,u)}_buildPlayer(t,e,a){const l=t.element,u=U3(0,this._normalizer,0,t.keyframes,e,a);return this._driver.animate(l,u,t.duration,t.delay,t.easing,[],!0)}create(t,e,a={}){const l=[],u=this._animations.get(t);let f;const E=new Map;if(u?(f=I2(this._driver,e,u,E2,EN,new Map,new Map,a,PH,l),f.forEach(R=>{const L=Zs(E,R.element,new Map);R.postStyleProps.forEach(H=>L.set(H,null))})):(l.push(function k8(){return new he(3300,!1)}()),f=[]),l.length)throw function x8(i){return new he(3504,!1)}();E.forEach((R,L)=>{R.forEach((H,W)=>{R.set(W,this._driver.computeStyle(L,W,Qd))})});const T=ep(f.map(R=>{const L=E.get(R.element);return this._buildPlayer(R,new Map,L)}));return this._playersById.set(t,T),T.onDestroy(()=>this.destroy(t)),this.players.push(T),T}destroy(t){const e=this._getPlayer(t);e.destroy(),this._playersById.delete(t);const a=this.players.indexOf(e);a>=0&&this.players.splice(a,1)}_getPlayer(t){const e=this._playersById.get(t);if(!e)throw function L8(i){return new he(3301,!1)}();return e}listen(t,e,a,l){const u=f2(e,"","","");return h2(this._getPlayer(t),a,u,l),()=>{}}command(t,e,a,l){if("register"==a)return void this.register(t,l[0]);if("create"==a)return void this.create(t,e,l[0]||{});const u=this._getPlayer(t);switch(a){case"play":u.play();break;case"pause":u.pause();break;case"reset":u.reset();break;case"restart":u.restart();break;case"finish":u.finish();break;case"init":u.init();break;case"setPosition":u.setPosition(parseFloat(l[0]));break;case"destroy":this.destroy(t)}}}const aB="ng-animate-queued",O2="ng-animate-disabled",UH=[],cB={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},VH={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},La="__ng_removed";class N2{get params(){return this.options.params}constructor(t,e=""){this.namespaceId=e;const a=t&&t.hasOwnProperty("value");if(this.value=function GH(i){return i??null}(a?t.value:t),a){const u=VT(t);delete u.value,this.options=u}else this.options={};this.options.params||(this.options.params={})}absorbOptions(t){const e=t.params;if(e){const a=this.options.params;Object.keys(e).forEach(l=>{null==a[l]&&(a[l]=e[l])})}}}const HT="void",P2=new N2(HT);class BH{constructor(t,e,a){this.id=t,this.hostElement=e,this._engine=a,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,Fa(e,this._hostClassName)}listen(t,e,a,l){if(!this._triggers.has(e))throw function F8(i,t){return new he(3302,!1)}();if(null==a||0==a.length)throw function U8(i){return new he(3303,!1)}();if(!function WH(i){return"start"==i||"done"==i}(a))throw function V8(i,t){return new he(3400,!1)}();const u=Zs(this._elementListeners,t,[]),f={name:e,phase:a,callback:l};u.push(f);const E=Zs(this._engine.statesByElement,t,new Map);return E.has(e)||(Fa(t,vN),Fa(t,vN+"-"+e),E.set(e,P2)),()=>{this._engine.afterFlush(()=>{const y=u.indexOf(f);y>=0&&u.splice(y,1),this._triggers.has(e)||E.delete(e)})}}register(t,e){return!this._triggers.has(t)&&(this._triggers.set(t,e),!0)}_getTrigger(t){const e=this._triggers.get(t);if(!e)throw function B8(i){return new he(3401,!1)}();return e}trigger(t,e,a,l=!0){const u=this._getTrigger(e),f=new M2(this.id,e,t);let E=this._engine.statesByElement.get(t);E||(Fa(t,vN),Fa(t,vN+"-"+e),this._engine.statesByElement.set(t,E=new Map));let y=E.get(e);const T=new N2(a,this.id);if(!(a&&a.hasOwnProperty("value"))&&y&&T.absorbOptions(y.options),E.set(e,T),y||(y=P2),T.value!==HT&&y.value===T.value){if(!function qH(i,t){const e=Object.keys(i),a=Object.keys(t);if(e.length!=a.length)return!1;for(let l=0;l<e.length;l++){const u=e[l];if(!t.hasOwnProperty(u)||i[u]!==t[u])return!1}return!0}(y.params,T.params)){const re=[],ce=u.matchStyles(y.value,y.params,re),Te=u.matchStyles(T.value,T.params,re);re.length?this._engine.reportError(re):this._engine.afterFlush(()=>{Im(t,ce),gl(t,Te)})}return}const H=Zs(this._engine.playersByElement,t,[]);H.forEach(re=>{re.namespaceId==this.id&&re.triggerName==e&&re.queued&&re.destroy()});let W=u.matchTransition(y.value,T.value,t,T.params),q=!1;if(!W){if(!l)return;W=u.fallbackTransition,q=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:e,transition:W,fromState:y,toState:T,player:f,isFallbackTransition:q}),q||(Fa(t,aB),f.onStart(()=>{Mv(t,aB)})),f.onDone(()=>{let re=this.players.indexOf(f);re>=0&&this.players.splice(re,1);const ce=this._engine.playersByElement.get(t);if(ce){let Te=ce.indexOf(f);Te>=0&&ce.splice(Te,1)}}),this.players.push(f),H.push(f),f}deregister(t){this._triggers.delete(t),this._engine.statesByElement.forEach(e=>e.delete(t)),this._elementListeners.forEach((e,a)=>{this._elementListeners.set(a,e.filter(l=>l.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);const e=this._engine.playersByElement.get(t);e&&(e.forEach(a=>a.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,e){const a=this._engine.driver.query(t,yN,!0);a.forEach(l=>{if(l[La])return;const u=this._engine.fetchNamespacesByElement(l);u.size?u.forEach(f=>f.triggerLeaveAnimation(l,e,!1,!0)):this.clearElementCache(l)}),this._engine.afterFlushAnimationsDone(()=>a.forEach(l=>this.clearElementCache(l)))}triggerLeaveAnimation(t,e,a,l){const u=this._engine.statesByElement.get(t),f=new Map;if(u){const E=[];if(u.forEach((y,T)=>{if(f.set(T,y.value),this._triggers.has(T)){const R=this.trigger(t,T,HT,l);R&&E.push(R)}}),E.length)return this._engine.markElementAsRemoved(this.id,t,!0,e,f),a&&ep(E).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){const e=this._elementListeners.get(t),a=this._engine.statesByElement.get(t);if(e&&a){const l=new Set;e.forEach(u=>{const f=u.name;if(l.has(f))return;l.add(f);const y=this._triggers.get(f).fallbackTransition,T=a.get(f)||P2,R=new N2(HT),L=new M2(this.id,f,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:f,transition:y,fromState:T,toState:R,player:L,isFallbackTransition:!0})})}}removeNode(t,e){const a=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,e),this.triggerLeaveAnimation(t,e,!0))return;let l=!1;if(a.totalAnimations){const u=a.players.length?a.playersByQueriedElement.get(t):[];if(u&&u.length)l=!0;else{let f=t;for(;f=f.parentNode;)if(a.statesByElement.get(f)){l=!0;break}}}if(this.prepareLeaveAnimationListeners(t),l)a.markElementAsRemoved(this.id,t,!1,e);else{const u=t[La];(!u||u===cB)&&(a.afterFlush(()=>this.clearElementCache(t)),a.destroyInnerAnimations(t),a._onRemovalComplete(t,e))}}insertNode(t,e){Fa(t,this._hostClassName)}drainQueuedTransitions(t){const e=[];return this._queue.forEach(a=>{const l=a.player;if(l.destroyed)return;const u=a.element,f=this._elementListeners.get(u);f&&f.forEach(E=>{if(E.name==a.triggerName){const y=f2(u,a.triggerName,a.fromState.value,a.toState.value);y._data=t,h2(a.player,E.phase,y,E.callback)}}),l.markedForDestroy?this._engine.afterFlush(()=>{l.destroy()}):e.push(a)}),this._queue=[],e.sort((a,l)=>{const u=a.transition.ast.depCount,f=l.transition.ast.depCount;return 0==u||0==f?u-f:this._engine.driver.containsElement(a.element,l.element)?1:-1})}destroy(t){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}elementContainsData(t){let e=!1;return this._elementListeners.has(t)&&(e=!0),e=!!this._queue.find(a=>a.element===t)||e,e}}class jH{_onRemovalComplete(t,e){this.onRemovalComplete(t,e)}constructor(t,e,a){this.bodyNode=t,this.driver=e,this._normalizer=a,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(l,u)=>{}}get queuedPlayers(){const t=[];return this._namespaceList.forEach(e=>{e.players.forEach(a=>{a.queued&&t.push(a)})}),t}createNamespace(t,e){const a=new BH(t,e,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,e)?this._balanceNamespaceList(a,e):(this.newHostElements.set(e,a),this.collectEnterElement(e)),this._namespaceLookup[t]=a}_balanceNamespaceList(t,e){const a=this._namespaceList,l=this.namespacesByHostElement;if(a.length-1>=0){let f=!1,E=this.driver.getParentElement(e);for(;E;){const y=l.get(E);if(y){const T=a.indexOf(y);a.splice(T+1,0,t),f=!0;break}E=this.driver.getParentElement(E)}f||a.unshift(t)}else a.push(t);return l.set(e,t),t}register(t,e){let a=this._namespaceLookup[t];return a||(a=this.createNamespace(t,e)),a}registerTrigger(t,e,a){let l=this._namespaceLookup[t];l&&l.register(e,a)&&this.totalAnimations++}destroy(t,e){if(!t)return;const a=this._fetchNamespace(t);this.afterFlush(()=>{this.namespacesByHostElement.delete(a.hostElement),delete this._namespaceLookup[t];const l=this._namespaceList.indexOf(a);l>=0&&this._namespaceList.splice(l,1)}),this.afterFlushAnimationsDone(()=>a.destroy(e))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){const e=new Set,a=this.statesByElement.get(t);if(a)for(let l of a.values())if(l.namespaceId){const u=this._fetchNamespace(l.namespaceId);u&&e.add(u)}return e}trigger(t,e,a,l){if(NN(e)){const u=this._fetchNamespace(t);if(u)return u.trigger(e,a,l),!0}return!1}insertNode(t,e,a,l){if(!NN(e))return;const u=e[La];if(u&&u.setForRemoval){u.setForRemoval=!1,u.setForMove=!0;const f=this.collectedLeaveElements.indexOf(e);f>=0&&this.collectedLeaveElements.splice(f,1)}if(t){const f=this._fetchNamespace(t);f&&f.insertNode(e,a)}l&&this.collectEnterElement(e)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,e){e?this.disabledNodes.has(t)||(this.disabledNodes.add(t),Fa(t,O2)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),Mv(t,O2))}removeNode(t,e,a,l){if(NN(e)){const u=t?this._fetchNamespace(t):null;if(u?u.removeNode(e,l):this.markElementAsRemoved(t,e,!1,l),a){const f=this.namespacesByHostElement.get(e);f&&f.id!==t&&f.removeNode(e,l)}}else this._onRemovalComplete(e,l)}markElementAsRemoved(t,e,a,l,u){this.collectedLeaveElements.push(e),e[La]={namespaceId:t,setForRemoval:l,hasAnimation:a,removedBeforeQueried:!1,previousTriggersValues:u}}listen(t,e,a,l,u){return NN(e)?this._fetchNamespace(t).listen(e,a,l,u):()=>{}}_buildInstruction(t,e,a,l,u){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,a,l,t.fromState.options,t.toState.options,e,u)}destroyInnerAnimations(t){let e=this.driver.query(t,yN,!0);e.forEach(a=>this.destroyActiveAnimationsForElement(a)),0!=this.playersByQueriedElement.size&&(e=this.driver.query(t,v2,!0),e.forEach(a=>this.finishActiveQueriedAnimationOnElement(a)))}destroyActiveAnimationsForElement(t){const e=this.playersByElement.get(t);e&&e.forEach(a=>{a.queued?a.markedForDestroy=!0:a.destroy()})}finishActiveQueriedAnimationOnElement(t){const e=this.playersByQueriedElement.get(t);e&&e.forEach(a=>a.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return ep(this.players).onDone(()=>t());t()})}processLeaveNode(t){const e=t[La];if(e&&e.setForRemoval){if(t[La]=cB,e.namespaceId){this.destroyInnerAnimations(t);const a=this._fetchNamespace(e.namespaceId);a&&a.clearElementCache(t)}this._onRemovalComplete(t,e.setForRemoval)}t.classList?.contains(O2)&&this.markElementAsDisabled(t,!1),this.driver.query(t,".ng-animate-disabled",!0).forEach(a=>{this.markElementAsDisabled(a,!1)})}flush(t=-1){let e=[];if(this.newHostElements.size&&(this.newHostElements.forEach((a,l)=>this._balanceNamespaceList(a,l)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let a=0;a<this.collectedEnterElements.length;a++)Fa(this.collectedEnterElements[a],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const a=[];try{e=this._flushAnimations(a,t)}finally{for(let l=0;l<a.length;l++)a[l]()}}else for(let a=0;a<this.collectedLeaveElements.length;a++)this.processLeaveNode(this.collectedLeaveElements[a]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(a=>a()),this._flushFns=[],this._whenQuietFns.length){const a=this._whenQuietFns;this._whenQuietFns=[],e.length?ep(e).onDone(()=>{a.forEach(l=>l())}):a.forEach(l=>l())}}reportError(t){throw function j8(i){return new he(3402,!1)}()}_flushAnimations(t,e){const a=new AN,l=[],u=new Map,f=[],E=new Map,y=new Map,T=new Map,R=new Set;this.disabledNodes.forEach($e=>{R.add($e);const st=this.driver.query($e,".ng-animate-queued",!0);for(let ft=0;ft<st.length;ft++)R.add(st[ft])});const L=this.bodyNode,H=Array.from(this.statesByElement.keys()),W=uB(H,this.collectedEnterElements),q=new Map;let re=0;W.forEach(($e,st)=>{const ft=E2+re++;q.set(st,ft),$e.forEach(gn=>Fa(gn,ft))});const ce=[],Te=new Set,De=new Set;for(let $e=0;$e<this.collectedLeaveElements.length;$e++){const st=this.collectedLeaveElements[$e],ft=st[La];ft&&ft.setForRemoval&&(ce.push(st),Te.add(st),ft.hasAnimation?this.driver.query(st,".ng-star-inserted",!0).forEach(gn=>Te.add(gn)):De.add(st))}const ue=new Map,Ue=uB(H,Array.from(Te));Ue.forEach(($e,st)=>{const ft=EN+re++;ue.set(st,ft),$e.forEach(gn=>Fa(gn,ft))}),t.push(()=>{W.forEach(($e,st)=>{const ft=q.get(st);$e.forEach(gn=>Mv(gn,ft))}),Ue.forEach(($e,st)=>{const ft=ue.get(st);$e.forEach(gn=>Mv(gn,ft))}),ce.forEach($e=>{this.processLeaveNode($e)})});const qt=[],wn=[];for(let $e=this._namespaceList.length-1;$e>=0;$e--)this._namespaceList[$e].drainQueuedTransitions(e).forEach(ft=>{const gn=ft.player,Pr=ft.element;if(qt.push(gn),this.collectedEnterElements.length){const To=Pr[La];if(To&&To.setForMove){if(To.previousTriggersValues&&To.previousTriggersValues.has(ft.triggerName)){const xm=To.previousTriggersValues.get(ft.triggerName),Ba=this.statesByElement.get(ft.element);if(Ba&&Ba.has(ft.triggerName)){const iP=Ba.get(ft.triggerName);iP.value=xm,Ba.set(ft.triggerName,iP)}}return void gn.destroy()}}const yl=!L||!this.driver.containsElement(L,Pr),na=ue.get(Pr),ap=q.get(Pr),Ai=this._buildInstruction(ft,a,ap,na,yl);if(Ai.errors&&Ai.errors.length)return void wn.push(Ai);if(yl)return gn.onStart(()=>Im(Pr,Ai.fromStyles)),gn.onDestroy(()=>gl(Pr,Ai.toStyles)),void l.push(gn);if(ft.isFallbackTransition)return gn.onStart(()=>Im(Pr,Ai.fromStyles)),gn.onDestroy(()=>gl(Pr,Ai.toStyles)),void l.push(gn);const F4=[];Ai.timelines.forEach(To=>{To.stretchStartingKeyframe=!0,this.disabledNodes.has(To.element)||F4.push(To)}),Ai.timelines=F4,a.append(Pr,Ai.timelines),f.push({instruction:Ai,player:gn,element:Pr}),Ai.queriedElements.forEach(To=>Zs(E,To,[]).push(gn)),Ai.preStyleProps.forEach((To,xm)=>{if(To.size){let Ba=y.get(xm);Ba||y.set(xm,Ba=new Set),To.forEach((iP,fF)=>Ba.add(fF))}}),Ai.postStyleProps.forEach((To,xm)=>{let Ba=T.get(xm);Ba||T.set(xm,Ba=new Set),To.forEach((iP,fF)=>Ba.add(fF))})});if(wn.length){const $e=[];wn.forEach(st=>{$e.push(function H8(i,t){return new he(3505,!1)}())}),qt.forEach(st=>st.destroy()),this.reportError($e)}const Co=new Map,tu=new Map;f.forEach($e=>{const st=$e.element;a.has(st)&&(tu.set(st,st),this._beforeAnimationBuild($e.player.namespaceId,$e.instruction,Co))}),l.forEach($e=>{const st=$e.element;this._getPreviousPlayers(st,!1,$e.namespaceId,$e.triggerName,null).forEach(gn=>{Zs(Co,st,[]).push(gn),gn.destroy()})});const nu=ce.filter($e=>pB($e,y,T)),iu=new Map;dB(iu,this.driver,De,T,Qd).forEach($e=>{pB($e,y,T)&&nu.push($e)});const o0=new Map;W.forEach(($e,st)=>{dB(o0,this.driver,new Set($e),y,t2)}),nu.forEach($e=>{const st=iu.get($e),ft=o0.get($e);iu.set($e,new Map([...Array.from(st?.entries()??[]),...Array.from(ft?.entries()??[])]))});const km=[],x4=[],L4={};f.forEach($e=>{const{element:st,player:ft,instruction:gn}=$e;if(a.has(st)){if(R.has(st))return ft.onDestroy(()=>gl(st,gn.toStyles)),ft.disabled=!0,ft.overrideTotalTime(gn.totalTime),void l.push(ft);let Pr=L4;if(tu.size>1){let na=st;const ap=[];for(;na=na.parentNode;){const Ai=tu.get(na);if(Ai){Pr=Ai;break}ap.push(na)}ap.forEach(Ai=>tu.set(Ai,Pr))}const yl=this._buildAnimation(ft.namespaceId,gn,Co,u,o0,iu);if(ft.setRealPlayer(yl),Pr===L4)km.push(ft);else{const na=this.playersByElement.get(Pr);na&&na.length&&(ft.parentPlayer=ep(na)),l.push(ft)}}else Im(st,gn.fromStyles),ft.onDestroy(()=>gl(st,gn.toStyles)),x4.push(ft),R.has(st)&&l.push(ft)}),x4.forEach($e=>{const st=u.get($e.element);if(st&&st.length){const ft=ep(st);$e.setRealPlayer(ft)}}),l.forEach($e=>{$e.parentPlayer?$e.syncPlayerEvents($e.parentPlayer):$e.destroy()});for(let $e=0;$e<ce.length;$e++){const st=ce[$e],ft=st[La];if(Mv(st,EN),ft&&ft.hasAnimation)continue;let gn=[];if(E.size){let yl=E.get(st);yl&&yl.length&&gn.push(...yl);let na=this.driver.query(st,v2,!0);for(let ap=0;ap<na.length;ap++){let Ai=E.get(na[ap]);Ai&&Ai.length&&gn.push(...Ai)}}const Pr=gn.filter(yl=>!yl.destroyed);Pr.length?zH(this,st,Pr):this.processLeaveNode(st)}return ce.length=0,km.forEach($e=>{this.players.push($e),$e.onDone(()=>{$e.destroy();const st=this.players.indexOf($e);this.players.splice(st,1)}),$e.play()}),km}elementContainsData(t,e){let a=!1;const l=e[La];return l&&l.setForRemoval&&(a=!0),this.playersByElement.has(e)&&(a=!0),this.playersByQueriedElement.has(e)&&(a=!0),this.statesByElement.has(e)&&(a=!0),this._fetchNamespace(t).elementContainsData(e)||a}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,e,a,l,u){let f=[];if(e){const E=this.playersByQueriedElement.get(t);E&&(f=E)}else{const E=this.playersByElement.get(t);if(E){const y=!u||u==HT;E.forEach(T=>{T.queued||!y&&T.triggerName!=l||f.push(T)})}}return(a||l)&&(f=f.filter(E=>!(a&&a!=E.namespaceId||l&&l!=E.triggerName))),f}_beforeAnimationBuild(t,e,a){const u=e.element,f=e.isRemovalTransition?void 0:t,E=e.isRemovalTransition?void 0:e.triggerName;for(const y of e.timelines){const T=y.element,R=T!==u,L=Zs(a,T,[]);this._getPreviousPlayers(T,R,f,E,e.toState).forEach(W=>{const q=W.getRealPlayer();q.beforeDestroy&&q.beforeDestroy(),W.destroy(),L.push(W)})}Im(u,e.fromStyles)}_buildAnimation(t,e,a,l,u,f){const E=e.triggerName,y=e.element,T=[],R=new Set,L=new Set,H=e.timelines.map(q=>{const re=q.element;R.add(re);const ce=re[La];if(ce&&ce.removedBeforeQueried)return new FT(q.duration,q.delay);const Te=re!==y,De=function KH(i){const t=[];return hB(i,t),t}((a.get(re)||UH).map(Co=>Co.getRealPlayer())).filter(Co=>!!Co.element&&Co.element===re),ue=u.get(re),Ue=f.get(re),qt=U3(0,this._normalizer,0,q.keyframes,ue,Ue),wn=this._buildPlayer(q,qt,De);if(q.subTimeline&&l&&L.add(re),Te){const Co=new M2(t,E,re);Co.setRealPlayer(wn),T.push(Co)}return wn});T.forEach(q=>{Zs(this.playersByQueriedElement,q.element,[]).push(q),q.onDone(()=>function HH(i,t,e){let a=i.get(t);if(a){if(a.length){const l=a.indexOf(e);a.splice(l,1)}0==a.length&&i.delete(t)}return a}(this.playersByQueriedElement,q.element,q))}),R.forEach(q=>Fa(q,q3));const W=ep(H);return W.onDestroy(()=>{R.forEach(q=>Mv(q,q3)),gl(y,e.toStyles)}),L.forEach(q=>{Zs(l,q,[]).push(W)}),W}_buildPlayer(t,e,a){return e.length>0?this.driver.animate(t.element,e,t.duration,t.delay,t.easing,a):new FT(t.duration,t.delay)}}class M2{constructor(t,e,a){this.namespaceId=t,this.triggerName=e,this.element=a,this._player=new FT,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(t){this._containsRealPlayer||(this._player=t,this._queuedCallbacks.forEach((e,a)=>{e.forEach(l=>h2(t,a,void 0,l))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){const e=this._player;e.triggerCallback&&t.onStart(()=>e.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,e){Zs(this._queuedCallbacks,t,[]).push(e)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){const e=this._player;e.triggerCallback&&e.triggerCallback(t)}}function NN(i){return i&&1===i.nodeType}function lB(i,t){const e=i.style.display;return i.style.display=t??"none",e}function dB(i,t,e,a,l){const u=[];e.forEach(y=>u.push(lB(y)));const f=[];a.forEach((y,T)=>{const R=new Map;y.forEach(L=>{const H=t.computeStyle(T,L,l);R.set(L,H),(!H||0==H.length)&&(T[La]=VH,f.push(T))}),i.set(T,R)});let E=0;return e.forEach(y=>lB(y,u[E++])),f}function uB(i,t){const e=new Map;if(i.forEach(E=>e.set(E,[])),0==t.length)return e;const a=1,l=new Set(t),u=new Map;function f(E){if(!E)return a;let y=u.get(E);if(y)return y;const T=E.parentNode;return y=e.has(T)?T:l.has(T)?a:f(T),u.set(E,y),y}return t.forEach(E=>{const y=f(E);y!==a&&e.get(y).push(E)}),e}function Fa(i,t){i.classList?.add(t)}function Mv(i,t){i.classList?.remove(t)}function zH(i,t,e){ep(e).onDone(()=>i.processLeaveNode(t))}function hB(i,t){for(let e=0;e<i.length;e++){const a=i[e];a instanceof t3?hB(a.players,t):t.push(a)}}function pB(i,t,e){const a=e.get(i);if(!a)return!1;let l=t.get(i);return l?a.forEach(u=>l.add(u)):t.set(i,a),e.delete(i),!0}class PN{constructor(t,e,a){this.bodyNode=t,this._driver=e,this._normalizer=a,this._triggerCache={},this.onRemovalComplete=(l,u)=>{},this._transitionEngine=new jH(t,e,a),this._timelineEngine=new MH(t,e,a),this._transitionEngine.onRemovalComplete=(l,u)=>this.onRemovalComplete(l,u)}registerTrigger(t,e,a,l,u){const f=t+"-"+l;let E=this._triggerCache[f];if(!E){const y=[],T=[],R=C2(this._driver,u,y,T);if(y.length)throw function N8(i,t){return new he(3404,!1)}();E=function DH(i,t,e){return new OH(i,t,e)}(l,R,this._normalizer),this._triggerCache[f]=E}this._transitionEngine.registerTrigger(e,l,E)}register(t,e){this._transitionEngine.register(t,e)}destroy(t,e){this._transitionEngine.destroy(t,e)}onInsert(t,e,a,l){this._transitionEngine.insertNode(t,e,a,l)}onRemove(t,e,a,l){this._transitionEngine.removeNode(t,e,l||!1,a)}disableAnimations(t,e){this._transitionEngine.markElementAsDisabled(t,e)}process(t,e,a,l){if("@"==a.charAt(0)){const[u,f]=V3(a);this._timelineEngine.command(u,e,f,l)}else this._transitionEngine.trigger(t,e,a,l)}listen(t,e,a,l,u){if("@"==a.charAt(0)){const[f,E]=V3(a);return this._timelineEngine.listen(f,e,E,u)}return this._transitionEngine.listen(t,e,a,l,u)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let $H=(()=>{class i{constructor(e,a,l){this._element=e,this._startStyles=a,this._endStyles=l,this._state=0;let u=i.initialStylesByElement.get(e);u||i.initialStylesByElement.set(e,u=new Map),this._initialStyles=u}start(){this._state<1&&(this._startStyles&&gl(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(gl(this._element,this._initialStyles),this._endStyles&&(gl(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(i.initialStylesByElement.delete(this._element),this._startStyles&&(Im(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Im(this._element,this._endStyles),this._endStyles=null),gl(this._element,this._initialStyles),this._state=3)}}return i.initialStylesByElement=new WeakMap,i})();function k2(i){let t=null;return i.forEach((e,a)=>{(function XH(i){return"display"===i||"position"===i})(a)&&(t=t||new Map,t.set(a,e))}),t}class fB{constructor(t,e,a,l){this.element=t,this.keyframes=e,this.options=a,this._specialStyles=l,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=a.duration,this._delay=a.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(t){const e=[];return t.forEach(a=>{e.push(Object.fromEntries(a))}),e}_triggerWebAnimation(t,e,a){return t.animate(this._convertKeyframesToObject(e),a)}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const t=new Map;this.hasStarted()&&this._finalKeyframe.forEach((a,l)=>{"offset"!==l&&t.set(l,this._finished?a:Z3(this.element,l))}),this.currentSnapshot=t}triggerCallback(t){const e="start"===t?this._onStartFns:this._onDoneFns;e.forEach(a=>a()),e.length=0}}class JH{validateStyleProperty(t){return!0}validateAnimatableStyleProperty(t){return!0}matchesElement(t,e){return!1}containsElement(t,e){return G3(t,e)}getParentElement(t){return _2(t)}query(t,e,a){return W3(t,e,a)}computeStyle(t,e,a){return window.getComputedStyle(t)[e]}animate(t,e,a,l,u,f=[]){const y={duration:a,delay:l,fill:0==l?"both":"forwards"};u&&(y.easing=u);const T=new Map,R=f.filter(W=>W instanceof fB);(function tH(i,t){return 0===i||0===t})(a,l)&&R.forEach(W=>{W.currentSnapshot.forEach((q,re)=>T.set(re,q))});let L=function J8(i){return i.length?i[0]instanceof Map?i:i.map(t=>Y3(t)):[]}(e).map(W=>tp(W));L=function nH(i,t,e){if(e.size&&t.length){let a=t[0],l=[];if(e.forEach((u,f)=>{a.has(f)||l.push(f),a.set(f,u)}),l.length)for(let u=1;u<t.length;u++){let f=t[u];l.forEach(E=>f.set(E,Z3(i,E)))}}return t}(t,L,T);const H=function YH(i,t){let e=null,a=null;return Array.isArray(t)&&t.length?(e=k2(t[0]),t.length>1&&(a=k2(t[t.length-1]))):t instanceof Map&&(e=k2(t)),e||a?new $H(i,e,a):null}(t,L);return new fB(t,L,y,H)}}let QH=(()=>{class i extends QV{constructor(e,a){super(),this._nextAnimationId=0,this._renderer=e.createRenderer(a.body,{id:"0",encapsulation:Ms.None,styles:[],data:{animation:[]}})}build(e){const a=this._nextAnimationId.toString();this._nextAnimationId++;const l=Array.isArray(e)?ZV(e):e;return mB(this._renderer,null,a,"register",[l]),new ZH(a,this._renderer)}}return i.\u0275fac=function(e){return new(e||i)(pe(Kl),pe(Zt))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac}),i})();class ZH extends t5{constructor(t,e){super(),this._id=t,this._renderer=e}create(t,e){return new eG(this._id,t,e||{},this._renderer)}}class eG{constructor(t,e,a,l){this.id=t,this.element=e,this._renderer=l,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",a)}_listen(t,e){return this._renderer.listen(this.element,`@@${this.id}:${t}`,e)}_command(t,...e){return mB(this._renderer,this.element,this.id,t,e)}onDone(t){this._listen("done",t)}onStart(t){this._listen("start",t)}onDestroy(t){this._listen("destroy",t)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(t){this._command("setPosition",t)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function mB(i,t,e,a,l){return i.setProperty(t,`@@${e}:${a}`,l)}const _B="@.disabled";let tG=(()=>{class i{constructor(e,a,l){this.delegate=e,this.engine=a,this._zone=l,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),a.onRemovalComplete=(u,f)=>{const E=f?.parentNode(u);E&&f.removeChild(E,u)}}createRenderer(e,a){const u=this.delegate.createRenderer(e,a);if(!(e&&a&&a.data&&a.data.animation)){let R=this._rendererCache.get(u);return R||(R=new gB("",u,this.engine,()=>this._rendererCache.delete(u)),this._rendererCache.set(u,R)),R}const f=a.id,E=a.id+"-"+this._currentId;this._currentId++,this.engine.register(E,e);const y=R=>{Array.isArray(R)?R.forEach(y):this.engine.registerTrigger(f,E,e,R.name,R)};return a.data.animation.forEach(y),new nG(this,E,u,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(e,a,l){e>=0&&e<this._microtaskId?this._zone.run(()=>a(l)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(u=>{const[f,E]=u;f(E)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([a,l]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return i.\u0275fac=function(e){return new(e||i)(pe(Kl),pe(PN),pe(me))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac}),i})();class gB{constructor(t,e,a,l){this.namespaceId=t,this.delegate=e,this.engine=a,this._onDestroy=l,this.destroyNode=this.delegate.destroyNode?u=>e.destroyNode(u):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),this._onDestroy?.()}createElement(t,e){return this.delegate.createElement(t,e)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,e){this.delegate.appendChild(t,e),this.engine.onInsert(this.namespaceId,e,t,!1)}insertBefore(t,e,a,l=!0){this.delegate.insertBefore(t,e,a),this.engine.onInsert(this.namespaceId,e,t,l)}removeChild(t,e,a){this.engine.onRemove(this.namespaceId,e,this.delegate,a)}selectRootElement(t,e){return this.delegate.selectRootElement(t,e)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,e,a,l){this.delegate.setAttribute(t,e,a,l)}removeAttribute(t,e,a){this.delegate.removeAttribute(t,e,a)}addClass(t,e){this.delegate.addClass(t,e)}removeClass(t,e){this.delegate.removeClass(t,e)}setStyle(t,e,a,l){this.delegate.setStyle(t,e,a,l)}removeStyle(t,e,a){this.delegate.removeStyle(t,e,a)}setProperty(t,e,a){"@"==e.charAt(0)&&e==_B?this.disableAnimations(t,!!a):this.delegate.setProperty(t,e,a)}setValue(t,e){this.delegate.setValue(t,e)}listen(t,e,a){return this.delegate.listen(t,e,a)}disableAnimations(t,e){this.engine.disableAnimations(t,e)}}class nG extends gB{constructor(t,e,a,l,u){super(e,a,l,u),this.factory=t,this.namespaceId=e}setProperty(t,e,a){"@"==e.charAt(0)?"."==e.charAt(1)&&e==_B?this.disableAnimations(t,a=void 0===a||!!a):this.engine.process(this.namespaceId,t,e.slice(1),a):this.delegate.setProperty(t,e,a)}listen(t,e,a){if("@"==e.charAt(0)){const l=function iG(i){switch(i){case"body":return document.body;case"document":return document;case"window":return window;default:return i}}(t);let u=e.slice(1),f="";return"@"!=u.charAt(0)&&([u,f]=function rG(i){const t=i.indexOf(".");return[i.substring(0,t),i.slice(t+1)]}(u)),this.engine.listen(this.namespaceId,l,u,f,E=>{this.factory.scheduleListenerCallback(E._data||-1,a,E)})}return this.delegate.listen(t,e,a)}}let oG=(()=>{class i extends PN{constructor(e,a,l,u){super(e.body,a,l)}ngOnDestroy(){this.flush()}}return i.\u0275fac=function(e){return new(e||i)(pe(Zt),pe(g2),pe(A2),pe(Yc))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac}),i})();const EB=[{provide:QV,useClass:QH},{provide:A2,useFactory:function sG(){return new wH}},{provide:PN,useClass:oG},{provide:Kl,useFactory:function aG(i,t,e){return new tG(i,t,e)},deps:[Lh,PN,me]}],x2=[{provide:g2,useFactory:()=>new JH},{provide:Ca,useValue:"BrowserAnimations"},...EB],vB=[{provide:g2,useClass:z3},{provide:Ca,useValue:"NoopAnimations"},...EB];let cG=(()=>{class i{static withConfig(e){return{ngModule:i,providers:e.disableAnimations?vB:x2}}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({providers:x2,imports:[oL]}),i})();const kN=(()=>{function i(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return i.prototype=Object.create(Error.prototype),i})();function yB(i){return new _n(t=>{let e;try{e=i()}catch(l){return void t.error(l)}return(e?Di(e):uN()).subscribe(t)})}function kv(i,t){return new _n(t?e=>t.schedule(lG,0,{error:i,subscriber:e}):e=>e.error(i))}function lG({error:i,subscriber:t}){t.error(i)}function Ua(i,t){return"function"==typeof t?e=>e.pipe(Ua((a,l)=>Di(i(a,l)).pipe(At((u,f)=>t(a,u,l,f))))):e=>e.lift(new dG(i))}class dG{constructor(t){this.project=t}call(t,e){return e.subscribe(new uG(t,this.project))}}class uG extends hp{constructor(t,e){super(t),this.project=e,this.index=0}_next(t){let e;const a=this.index++;try{e=this.project(t,a)}catch(l){return void this.destination.error(l)}this._innerSub(e)}_innerSub(t){const e=this.innerSubscription;e&&e.unsubscribe();const a=new au(this),l=this.destination;l.add(a),this.innerSubscription=Cl(t,a),this.innerSubscription!==a&&l.add(this.innerSubscription)}_complete(){const{innerSubscription:t}=this;(!t||t.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(t){this.destination.next(t)}}function xN(i=null){return t=>t.lift(new hG(i))}class hG{constructor(t){this.defaultValue=t}call(t,e){return e.subscribe(new pG(t,this.defaultValue))}}class pG extends En{constructor(t,e){super(t),this.defaultValue=e,this.isEmpty=!0}_next(t){this.isEmpty=!1,this.destination.next(t)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}function bB(i=_G){return t=>t.lift(new fG(i))}class fG{constructor(t){this.errorFactory=t}call(t,e){return e.subscribe(new mG(t,this.errorFactory))}}class mG extends En{constructor(t,e){super(t),this.errorFactory=e,this.hasValue=!1}_next(t){this.hasValue=!0,this.destination.next(t)}_complete(){if(this.hasValue)return this.destination.complete();{let t;try{t=this.errorFactory()}catch(e){t=e}this.destination.error(t)}}}function _G(){return new kN}function np(i,t){const e=arguments.length>=2;return a=>a.pipe(i?vc((l,u)=>i(l,u,a)):lp,Qr(1),e?xN(t):bB(()=>new kN))}function Am(i,t){return Vi(i,t,1)}function ip(){}function Nr(i,t,e){return function(l){return l.lift(new gG(i,t,e))}}class gG{constructor(t,e,a){this.nextOrObserver=t,this.error=e,this.complete=a}call(t,e){return e.subscribe(new EG(t,this.nextOrObserver,this.error,this.complete))}}class EG extends En{constructor(t,e,a,l){super(t),this._tapNext=ip,this._tapError=ip,this._tapComplete=ip,this._tapError=a||ip,this._tapComplete=l||ip,x(e)?(this._context=this,this._tapNext=e):e&&(this._context=e,this._tapNext=e.next||ip,this._tapError=e.error||ip,this._tapComplete=e.complete||ip)}_next(t){try{this._tapNext.call(this._context,t)}catch(e){return void this.destination.error(e)}this.destination.next(t)}_error(t){try{this._tapError.call(this._context,t)}catch(e){return void this.destination.error(e)}this.destination.error(t)}_complete(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()}}function Dm(i){return function(e){const a=new vG(i),l=e.lift(a);return a.caught=l}}class vG{constructor(t){this.selector=t}call(t,e){return e.subscribe(new yG(t,this.selector,this.caught))}}class yG extends hp{constructor(t,e,a){super(t),this.selector=e,this.caught=a}error(t){if(!this.isStopped){let e;try{e=this.selector(t,this.caught)}catch(u){return void super.error(u)}this._unsubscribeAndRecycle();const a=new au(this);this.add(a);const l=Cl(e,a);l!==a&&this.add(l)}}}function SB(i,t){let e=!1;return arguments.length>=2&&(e=!0),function(l){return l.lift(new bG(i,t,e))}}class bG{constructor(t,e,a=!1){this.accumulator=t,this.seed=e,this.hasSeed=a}call(t,e){return e.subscribe(new SG(t,this.accumulator,this.seed,this.hasSeed))}}class SG extends En{constructor(t,e,a,l){super(t),this.accumulator=e,this._seed=a,this.hasSeed=l,this.index=0}get seed(){return this._seed}set seed(t){this.hasSeed=!0,this._seed=t}_next(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)}_tryNext(t){const e=this.index++;let a;try{a=this.accumulator(this.seed,t,e)}catch(l){this.destination.error(l)}this.seed=a,this.destination.next(a)}}function L2(i){return function(e){return 0===i?uN():e.lift(new CG(i))}}class CG{constructor(t){if(this.total=t,this.total<0)throw new RV}call(t,e){return e.subscribe(new TG(t,this.total))}}class TG extends En{constructor(t,e){super(t),this.total=e,this.ring=new Array,this.count=0}_next(t){const e=this.ring,a=this.total,l=this.count++;e.length<a?e.push(t):e[l%a]=t}_complete(){const t=this.destination;let e=this.count;if(e>0){const a=this.count>=this.total?this.total:this.count,l=this.ring;for(let u=0;u<a;u++){const f=e++%a;t.next(l[f])}}t.complete()}}function CB(i,t){const e=arguments.length>=2;return a=>a.pipe(i?vc((l,u)=>i(l,u,a)):lp,L2(1),e?xN(t):bB(()=>new kN))}class IG{constructor(t,e){this.predicate=t,this.inclusive=e}call(t,e){return e.subscribe(new RG(t,this.predicate,this.inclusive))}}class RG extends En{constructor(t,e,a){super(t),this.predicate=e,this.inclusive=a,this.index=0}_next(t){const e=this.destination;let a;try{a=this.predicate(t,this.index++)}catch(l){return void e.error(l)}this.nextOrComplete(t,a)}nextOrComplete(t,e){const a=this.destination;Boolean(e)?a.next(t):(this.inclusive&&a.next(t),a.complete())}}class DG{constructor(t){this.value=t}call(t,e){return e.subscribe(new OG(t,this.value))}}class OG extends En{constructor(t,e){super(t),this.value=e}_next(t){this.destination.next(this.value)}}function F2(i){return t=>t.lift(new NG(i))}class NG{constructor(t){this.callback=t}call(t,e){return e.subscribe(new PG(t,this.callback))}}class PG extends En{constructor(t,e){super(t),this.add(new mn(e))}}const Nt="primary",GT=Symbol("RouteTitle");class MG{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function xv(i){return new MG(i)}function kG(i,t,e){const a=e.path.split("/");if(a.length>i.length||"full"===e.pathMatch&&(t.hasChildren()||a.length<i.length))return null;const l={};for(let u=0;u<a.length;u++){const f=a[u],E=i[u];if(f.startsWith(":"))l[f.substring(1)]=E;else if(f!==E.path)return null}return{consumed:i.slice(0,a.length),posParams:l}}function El(i,t){const e=i?Object.keys(i):void 0,a=t?Object.keys(t):void 0;if(!e||!a||e.length!=a.length)return!1;let l;for(let u=0;u<e.length;u++)if(l=e[u],!TB(i[l],t[l]))return!1;return!0}function TB(i,t){if(Array.isArray(i)&&Array.isArray(t)){if(i.length!==t.length)return!1;const e=[...i].sort(),a=[...t].sort();return e.every((l,u)=>a[u]===l)}return i===t}function wB(i){return Array.prototype.concat.apply([],i)}function IB(i){return i.length>0?i[i.length-1]:null}function Zr(i,t){for(const e in i)i.hasOwnProperty(e)&&t(i[e],e)}function rp(i){return ec(i)?i:ef(i)?Di(Promise.resolve(i)):ze(i)}const LN=!1,LG={exact:function DB(i,t,e){if(!Om(i.segments,t.segments)||!FN(i.segments,t.segments,e)||i.numberOfChildren!==t.numberOfChildren)return!1;for(const a in t.children)if(!i.children[a]||!DB(i.children[a],t.children[a],e))return!1;return!0},subset:OB},RB={exact:function FG(i,t){return El(i,t)},subset:function UG(i,t){return Object.keys(t).length<=Object.keys(i).length&&Object.keys(t).every(e=>TB(i[e],t[e]))},ignored:()=>!0};function AB(i,t,e){return LG[e.paths](i.root,t.root,e.matrixParams)&&RB[e.queryParams](i.queryParams,t.queryParams)&&!("exact"===e.fragment&&i.fragment!==t.fragment)}function OB(i,t,e){return NB(i,t,t.segments,e)}function NB(i,t,e,a){if(i.segments.length>e.length){const l=i.segments.slice(0,e.length);return!(!Om(l,e)||t.hasChildren()||!FN(l,e,a))}if(i.segments.length===e.length){if(!Om(i.segments,e)||!FN(i.segments,e,a))return!1;for(const l in t.children)if(!i.children[l]||!OB(i.children[l],t.children[l],a))return!1;return!0}{const l=e.slice(0,i.segments.length),u=e.slice(i.segments.length);return!!(Om(i.segments,l)&&FN(i.segments,l,a)&&i.children[Nt])&&NB(i.children[Nt],t,u,a)}}function FN(i,t,e){return t.every((a,l)=>RB[e](i[l].parameters,a.parameters))}class op{constructor(t=new Gt([],{}),e={},a=null){this.root=t,this.queryParams=e,this.fragment=a}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=xv(this.queryParams)),this._queryParamMap}toString(){return jG.serialize(this)}}class Gt{constructor(t,e){this.segments=t,this.children=e,this.parent=null,Zr(e,(a,l)=>a.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return UN(this)}}class WT{constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=xv(this.parameters)),this._parameterMap}toString(){return kB(this)}}function Om(i,t){return i.length===t.length&&i.every((e,a)=>e.path===t[a].path)}let zT=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=Oe({token:i,factory:function(){return new U2},providedIn:"root"}),i})();class U2{parse(t){const e=new XG(t);return new op(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){const e=`/${KT(t.root,!0)}`,a=function WG(i){const t=Object.keys(i).map(e=>{const a=i[e];return Array.isArray(a)?a.map(l=>`${VN(e)}=${VN(l)}`).join("&"):`${VN(e)}=${VN(a)}`}).filter(e=>!!e);return t.length?`?${t.join("&")}`:""}(t.queryParams),l="string"==typeof t.fragment?`#${function HG(i){return encodeURI(i)}(t.fragment)}`:"";return`${e}${a}${l}`}}const jG=new U2;function UN(i){return i.segments.map(t=>kB(t)).join("/")}function KT(i,t){if(!i.hasChildren())return UN(i);if(t){const e=i.children[Nt]?KT(i.children[Nt],!1):"",a=[];return Zr(i.children,(l,u)=>{u!==Nt&&a.push(`${u}:${KT(l,!1)}`)}),a.length>0?`${e}(${a.join("//")})`:e}{const e=function BG(i,t){let e=[];return Zr(i.children,(a,l)=>{l===Nt&&(e=e.concat(t(a,l)))}),Zr(i.children,(a,l)=>{l!==Nt&&(e=e.concat(t(a,l)))}),e}(i,(a,l)=>l===Nt?[KT(i.children[Nt],!1)]:[`${l}:${KT(a,!1)}`]);return 1===Object.keys(i.children).length&&null!=i.children[Nt]?`${UN(i)}/${e[0]}`:`${UN(i)}/(${e.join("//")})`}}function PB(i){return encodeURIComponent(i).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function VN(i){return PB(i).replace(/%3B/gi,";")}function V2(i){return PB(i).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function BN(i){return decodeURIComponent(i)}function MB(i){return BN(i.replace(/\+/g,"%20"))}function kB(i){return`${V2(i.path)}${function GG(i){return Object.keys(i).map(t=>`;${V2(t)}=${V2(i[t])}`).join("")}(i.parameters)}`}const zG=/^[^\/()?;=#]+/;function jN(i){const t=i.match(zG);return t?t[0]:""}const KG=/^[^=?&#]+/,YG=/^[^&#]+/;class XG{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Gt([],{}):new Gt([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let a={};return this.peekStartsWith("(")&&(a=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(a[Nt]=new Gt(t,e)),a}parseSegment(){const t=jN(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new he(4009,LN);return this.capture(t),new WT(BN(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const e=jN(this.remaining);if(!e)return;this.capture(e);let a="";if(this.consumeOptional("=")){const l=jN(this.remaining);l&&(a=l,this.capture(a))}t[BN(e)]=BN(a)}parseQueryParam(t){const e=function qG(i){const t=i.match(KG);return t?t[0]:""}(this.remaining);if(!e)return;this.capture(e);let a="";if(this.consumeOptional("=")){const f=function $G(i){const t=i.match(YG);return t?t[0]:""}(this.remaining);f&&(a=f,this.capture(a))}const l=MB(e),u=MB(a);if(t.hasOwnProperty(l)){let f=t[l];Array.isArray(f)||(f=[f],t[l]=f),f.push(u)}else t[l]=u}parseParens(t){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const a=jN(this.remaining),l=this.remaining[a.length];if("/"!==l&&")"!==l&&";"!==l)throw new he(4010,LN);let u;a.indexOf(":")>-1?(u=a.slice(0,a.indexOf(":")),this.capture(u),this.capture(":")):t&&(u=Nt);const f=this.parseChildren();e[u]=1===Object.keys(f).length?f[Nt]:new Gt([],f),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new he(4011,LN)}}function B2(i){return i.segments.length>0?new Gt([],{[Nt]:i}):i}function HN(i){const t={};for(const a of Object.keys(i.children)){const u=HN(i.children[a]);(u.segments.length>0||u.hasChildren())&&(t[a]=u)}return function JG(i){if(1===i.numberOfChildren&&i.children[Nt]){const t=i.children[Nt];return new Gt(i.segments.concat(t.segments),t.children)}return i}(new Gt(i.segments,t))}function Nm(i){return i instanceof op}const j2=!1;function QG(i,t,e,a,l){if(0===e.length)return Lv(t.root,t.root,t.root,a,l);const u=function VB(i){if("string"==typeof i[0]&&1===i.length&&"/"===i[0])return new UB(!0,0,i);let t=0,e=!1;const a=i.reduce((l,u,f)=>{if("object"==typeof u&&null!=u){if(u.outlets){const E={};return Zr(u.outlets,(y,T)=>{E[T]="string"==typeof y?y.split("/"):y}),[...l,{outlets:E}]}if(u.segmentPath)return[...l,u.segmentPath]}return"string"!=typeof u?[...l,u]:0===f?(u.split("/").forEach((E,y)=>{0==y&&"."===E||(0==y&&""===E?e=!0:".."===E?t++:""!=E&&l.push(E))}),l):[...l,u]},[]);return new UB(e,t,a)}(e);return u.toRoot()?Lv(t.root,t.root,new Gt([],{}),a,l):function f(y){const T=function eW(i,t,e,a){if(i.isAbsolute)return new Fv(t.root,!0,0);if(-1===a)return new Fv(e,e===t.root,0);return function BB(i,t,e){let a=i,l=t,u=e;for(;u>l;){if(u-=l,a=a.parent,!a)throw new he(4005,j2&&"Invalid number of '../'");l=a.segments.length}return new Fv(a,!1,l-u)}(e,a+(qT(i.commands[0])?0:1),i.numberOfDoubleDots)}(u,t,i.snapshot?._urlSegment,y),R=T.processChildren?Uv(T.segmentGroup,T.index,u.commands):H2(T.segmentGroup,T.index,u.commands);return Lv(t.root,T.segmentGroup,R,a,l)}(i.snapshot?._lastPathIndex)}function qT(i){return"object"==typeof i&&null!=i&&!i.outlets&&!i.segmentPath}function YT(i){return"object"==typeof i&&null!=i&&i.outlets}function Lv(i,t,e,a,l){let f,u={};a&&Zr(a,(y,T)=>{u[T]=Array.isArray(y)?y.map(R=>`${R}`):`${y}`}),f=i===t?e:FB(i,t,e);const E=B2(HN(f));return new op(E,u,l)}function FB(i,t,e){const a={};return Zr(i.children,(l,u)=>{a[u]=l===t?e:FB(l,t,e)}),new Gt(i.segments,a)}class UB{constructor(t,e,a){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=a,t&&a.length>0&&qT(a[0]))throw new he(4003,j2&&"Root segment cannot have matrix parameters");const l=a.find(YT);if(l&&l!==IB(a))throw new he(4004,j2&&"{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Fv{constructor(t,e,a){this.segmentGroup=t,this.processChildren=e,this.index=a}}function H2(i,t,e){if(i||(i=new Gt([],{})),0===i.segments.length&&i.hasChildren())return Uv(i,t,e);const a=function nW(i,t,e){let a=0,l=t;const u={match:!1,pathIndex:0,commandIndex:0};for(;l<i.segments.length;){if(a>=e.length)return u;const f=i.segments[l],E=e[a];if(YT(E))break;const y=`${E}`,T=a<e.length-1?e[a+1]:null;if(l>0&&void 0===y)break;if(y&&T&&"object"==typeof T&&void 0===T.outlets){if(!HB(y,T,f))return u;a+=2}else{if(!HB(y,{},f))return u;a++}l++}return{match:!0,pathIndex:l,commandIndex:a}}(i,t,e),l=e.slice(a.commandIndex);if(a.match&&a.pathIndex<i.segments.length){const u=new Gt(i.segments.slice(0,a.pathIndex),{});return u.children[Nt]=new Gt(i.segments.slice(a.pathIndex),i.children),Uv(u,0,l)}return a.match&&0===l.length?new Gt(i.segments,{}):a.match&&!i.hasChildren()?G2(i,t,e):a.match?Uv(i,0,l):G2(i,t,e)}function Uv(i,t,e){if(0===e.length)return new Gt(i.segments,{});{const a=function tW(i){return YT(i[0])?i[0].outlets:{[Nt]:i}}(e),l={};if(!a[Nt]&&i.children[Nt]&&1===i.numberOfChildren&&0===i.children[Nt].segments.length){const u=Uv(i.children[Nt],t,e);return new Gt(i.segments,u.children)}return Zr(a,(u,f)=>{"string"==typeof u&&(u=[u]),null!==u&&(l[f]=H2(i.children[f],t,u))}),Zr(i.children,(u,f)=>{void 0===a[f]&&(l[f]=u)}),new Gt(i.segments,l)}}function G2(i,t,e){const a=i.segments.slice(0,t);let l=0;for(;l<e.length;){const u=e[l];if(YT(u)){const y=iW(u.outlets);return new Gt(a,y)}if(0===l&&qT(e[0])){a.push(new WT(i.segments[t].path,jB(e[0]))),l++;continue}const f=YT(u)?u.outlets[Nt]:`${u}`,E=l<e.length-1?e[l+1]:null;f&&E&&qT(E)?(a.push(new WT(f,jB(E))),l+=2):(a.push(new WT(f,{})),l++)}return new Gt(a,{})}function iW(i){const t={};return Zr(i,(e,a)=>{"string"==typeof e&&(e=[e]),null!==e&&(t[a]=G2(new Gt([],{}),0,e))}),t}function jB(i){const t={};return Zr(i,(e,a)=>t[a]=`${e}`),t}function HB(i,t,e){return i==e.path&&El(t,e.parameters)}const $T="imperative";class vl{constructor(t,e){this.id=t,this.url=e}}class W2 extends vl{constructor(t,e,a="imperative",l=null){super(t,e),this.type=0,this.navigationTrigger=a,this.restoredState=l}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Pm extends vl{constructor(t,e,a){super(t,e),this.urlAfterRedirects=a,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class GN extends vl{constructor(t,e,a,l){super(t,e),this.reason=a,this.code=l,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class WN extends vl{constructor(t,e,a,l){super(t,e),this.reason=a,this.code=l,this.type=16}}class z2 extends vl{constructor(t,e,a,l){super(t,e),this.error=a,this.target=l,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class rW extends vl{constructor(t,e,a,l){super(t,e),this.urlAfterRedirects=a,this.state=l,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class oW extends vl{constructor(t,e,a,l){super(t,e),this.urlAfterRedirects=a,this.state=l,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class sW extends vl{constructor(t,e,a,l,u){super(t,e),this.urlAfterRedirects=a,this.state=l,this.shouldActivate=u,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class aW extends vl{constructor(t,e,a,l){super(t,e),this.urlAfterRedirects=a,this.state=l,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class cW extends vl{constructor(t,e,a,l){super(t,e),this.urlAfterRedirects=a,this.state=l,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class lW{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class dW{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class uW{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class hW{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class pW{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class fW{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class GB{constructor(t,e,a){this.routerEvent=t,this.position=e,this.anchor=a,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}let gW=(()=>{class i{createUrlTree(e,a,l,u,f,E){return QG(e||a.root,l,u,f,E)}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=Oe({token:i,factory:i.\u0275fac}),i})(),vW=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=Oe({token:i,factory:function(t){return gW.\u0275fac(t)},providedIn:"root"}),i})();class WB{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){const e=K2(t,this._root);return e?e.children.map(a=>a.value):[]}firstChild(t){const e=K2(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){const e=q2(t,this._root);return e.length<2?[]:e[e.length-2].children.map(l=>l.value).filter(l=>l!==t)}pathFromRoot(t){return q2(t,this._root).map(e=>e.value)}}function K2(i,t){if(i===t.value)return t;for(const e of t.children){const a=K2(i,e);if(a)return a}return null}function q2(i,t){if(i===t.value)return[t];for(const e of t.children){const a=q2(i,e);if(a.length)return a.unshift(t),a}return[]}class eu{constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}}function Vv(i){const t={};return i&&i.children.forEach(e=>t[e.value.outlet]=e),t}class zB extends WB{constructor(t,e){super(t),this.snapshot=e,Y2(this,t)}toString(){return this.snapshot.toString()}}function KB(i,t){const e=function yW(i,t){const f=new zN([],{},{},"",{},Nt,t,null,i.root,-1,{});return new YB("",new eu(f,[]))}(i,t),a=new Xr([new WT("",{})]),l=new Xr({}),u=new Xr({}),f=new Xr({}),E=new Xr(""),y=new Mm(a,l,f,E,u,Nt,t,e.root);return y.snapshot=e.root,new zB(new eu(y,[]),e)}class Mm{constructor(t,e,a,l,u,f,E,y){this.url=t,this.params=e,this.queryParams=a,this.fragment=l,this.data=u,this.outlet=f,this.component=E,this.title=this.data?.pipe(At(T=>T[GT]))??ze(void 0),this._futureSnapshot=y}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(At(t=>xv(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(At(t=>xv(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function qB(i,t="emptyOnly"){const e=i.pathFromRoot;let a=0;if("always"!==t)for(a=e.length-1;a>=1;){const l=e[a],u=e[a-1];if(l.routeConfig&&""===l.routeConfig.path)a--;else{if(u.component)break;a--}}return function bW(i){return i.reduce((t,e)=>({params:{...t.params,...e.params},data:{...t.data,...e.data},resolve:{...e.data,...t.resolve,...e.routeConfig?.data,...e._resolvedData}}),{params:{},data:{},resolve:{}})}(e.slice(a))}class zN{get title(){return this.data?.[GT]}constructor(t,e,a,l,u,f,E,y,T,R,L){this.url=t,this.params=e,this.queryParams=a,this.fragment=l,this.data=u,this.outlet=f,this.component=E,this.routeConfig=y,this._urlSegment=T,this._lastPathIndex=R,this._resolve=L}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=xv(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=xv(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(a=>a.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class YB extends WB{constructor(t,e){super(e),this.url=t,Y2(this,e)}toString(){return $B(this._root)}}function Y2(i,t){t.value._routerState=i,t.children.forEach(e=>Y2(i,e))}function $B(i){const t=i.children.length>0?` { ${i.children.map($B).join(", ")} } `:"";return`${i.value}${t}`}function $2(i){if(i.snapshot){const t=i.snapshot,e=i._futureSnapshot;i.snapshot=e,El(t.queryParams,e.queryParams)||i.queryParams.next(e.queryParams),t.fragment!==e.fragment&&i.fragment.next(e.fragment),El(t.params,e.params)||i.params.next(e.params),function xG(i,t){if(i.length!==t.length)return!1;for(let e=0;e<i.length;++e)if(!El(i[e],t[e]))return!1;return!0}(t.url,e.url)||i.url.next(e.url),El(t.data,e.data)||i.data.next(e.data)}else i.snapshot=i._futureSnapshot,i.data.next(i._futureSnapshot.data)}function X2(i,t){const e=El(i.params,t.params)&&function VG(i,t){return Om(i,t)&&i.every((e,a)=>El(e.parameters,t[a].parameters))}(i.url,t.url);return e&&!(!i.parent!=!t.parent)&&(!i.parent||X2(i.parent,t.parent))}function XT(i,t,e){if(e&&i.shouldReuseRoute(t.value,e.value.snapshot)){const a=e.value;a._futureSnapshot=t.value;const l=function CW(i,t,e){return t.children.map(a=>{for(const l of e.children)if(i.shouldReuseRoute(a.value,l.value.snapshot))return XT(i,a,l);return XT(i,a)})}(i,t,e);return new eu(a,l)}{if(i.shouldAttach(t.value)){const u=i.retrieve(t.value);if(null!==u){const f=u.route;return f.value._futureSnapshot=t.value,f.children=t.children.map(E=>XT(i,E)),f}}const a=function TW(i){return new Mm(new Xr(i.url),new Xr(i.params),new Xr(i.queryParams),new Xr(i.fragment),new Xr(i.data),i.outlet,i.component,i)}(t.value),l=t.children.map(u=>XT(i,u));return new eu(a,l)}}const J2="ngNavigationCancelingError";function XB(i,t){const{redirectTo:e,navigationBehaviorOptions:a}=Nm(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,l=JB(!1,0,t);return l.url=e,l.navigationBehaviorOptions=a,l}function JB(i,t,e){const a=new Error("NavigationCancelingError: "+(i||""));return a[J2]=!0,a.cancellationCode=t,e&&(a.url=e),a}function QB(i){return ZB(i)&&Nm(i.url)}function ZB(i){return i&&i[J2]}class wW{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new JT,this.attachRef=null}}let JT=(()=>{class i{constructor(){this.contexts=new Map}onChildOutletCreated(e,a){const l=this.getOrCreateContext(e);l.outlet=a,this.contexts.set(e,l)}onChildOutletDestroyed(e){const a=this.getContext(e);a&&(a.outlet=null,a.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let a=this.getContext(e);return a||(a=new wW,this.contexts.set(e,a)),a}getContext(e){return this.contexts.get(e)||null}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const KN=!1;let Q2=(()=>{class i{constructor(){this.activated=null,this._activatedRoute=null,this.name=Nt,this.activateEvents=new rn,this.deactivateEvents=new rn,this.attachEvents=new rn,this.detachEvents=new rn,this.parentContexts=Ct(JT),this.location=Ct(xo),this.changeDetector=Ct(te),this.environmentInjector=Ct(ha)}ngOnChanges(e){if(e.name){const{firstChange:a,previousValue:l}=e.name;if(a)return;this.isTrackedInParentContexts(l)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(l)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new he(4012,KN);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new he(4012,KN);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new he(4012,KN);this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,a){this.activated=e,this._activatedRoute=a,this.location.insert(e.hostView),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,a){if(this.isActivated)throw new he(4013,KN);this._activatedRoute=e;const l=this.location,f=e.snapshot.component,E=this.parentContexts.getOrCreateContext(this.name).children,y=new IW(e,E,l.injector);if(a&&function RW(i){return!!i.resolveComponentFactory}(a)){const T=a.resolveComponentFactory(f);this.activated=l.createComponent(T,l.length,y)}else this.activated=l.createComponent(f,{index:l.length,injector:y,environmentInjector:a??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275dir=je({type:i,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Ao]}),i})();class IW{constructor(t,e,a){this.route=t,this.childContexts=e,this.parent=a}get(t,e){return t===Mm?this.route:t===JT?this.childContexts:this.parent.get(t,e)}}let Z2=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=_r({type:i,selectors:[["ng-component"]],standalone:!0,features:[ff],decls:1,vars:0,template:function(e,a){1&e&&Tt(0,"router-outlet")},dependencies:[Q2],encapsulation:2}),i})();function e4(i,t){return i.providers&&!i._injector&&(i._injector=ah(i.providers,t,`Route: ${i.path}`)),i._injector??t}function tF(i){const t=i.children&&i.children.map(tF),e=t?{...i,children:t}:{...i};return!e.component&&!e.loadComponent&&(t||e.loadChildren)&&e.outlet&&e.outlet!==Nt&&(e.component=Z2),e}function Va(i){return i.outlet||Nt}function t4(i,t){const e=i.filter(a=>Va(a)===t);return e.push(...i.filter(a=>Va(a)!==t)),e}function QT(i){if(!i)return null;if(i.routeConfig?._injector)return i.routeConfig._injector;for(let t=i.parent;t;t=t.parent){const e=t.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}class PW{constructor(t,e,a,l){this.routeReuseStrategy=t,this.futureState=e,this.currState=a,this.forwardEvent=l}activate(t){const e=this.futureState._root,a=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,a,t),$2(this.futureState.root),this.activateChildRoutes(e,a,t)}deactivateChildRoutes(t,e,a){const l=Vv(e);t.children.forEach(u=>{const f=u.value.outlet;this.deactivateRoutes(u,l[f],a),delete l[f]}),Zr(l,(u,f)=>{this.deactivateRouteAndItsChildren(u,a)})}deactivateRoutes(t,e,a){const l=t.value,u=e?e.value:null;if(l===u)if(l.component){const f=a.getContext(l.outlet);f&&this.deactivateChildRoutes(t,e,f.children)}else this.deactivateChildRoutes(t,e,a);else u&&this.deactivateRouteAndItsChildren(e,a)}deactivateRouteAndItsChildren(t,e){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){const a=e.getContext(t.value.outlet),l=a&&t.value.component?a.children:e,u=Vv(t);for(const f of Object.keys(u))this.deactivateRouteAndItsChildren(u[f],l);if(a&&a.outlet){const f=a.outlet.detach(),E=a.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:f,route:t,contexts:E})}}deactivateRouteAndOutlet(t,e){const a=e.getContext(t.value.outlet),l=a&&t.value.component?a.children:e,u=Vv(t);for(const f of Object.keys(u))this.deactivateRouteAndItsChildren(u[f],l);a&&(a.outlet&&(a.outlet.deactivate(),a.children.onOutletDeactivated()),a.attachRef=null,a.resolver=null,a.route=null)}activateChildRoutes(t,e,a){const l=Vv(e);t.children.forEach(u=>{this.activateRoutes(u,l[u.value.outlet],a),this.forwardEvent(new fW(u.value.snapshot))}),t.children.length&&this.forwardEvent(new hW(t.value.snapshot))}activateRoutes(t,e,a){const l=t.value,u=e?e.value:null;if($2(l),l===u)if(l.component){const f=a.getOrCreateContext(l.outlet);this.activateChildRoutes(t,e,f.children)}else this.activateChildRoutes(t,e,a);else if(l.component){const f=a.getOrCreateContext(l.outlet);if(this.routeReuseStrategy.shouldAttach(l.snapshot)){const E=this.routeReuseStrategy.retrieve(l.snapshot);this.routeReuseStrategy.store(l.snapshot,null),f.children.onOutletReAttached(E.contexts),f.attachRef=E.componentRef,f.route=E.route.value,f.outlet&&f.outlet.attach(E.componentRef,E.route.value),$2(E.route.value),this.activateChildRoutes(t,null,f.children)}else{const E=QT(l.snapshot),y=E?.get(Wl)??null;f.attachRef=null,f.route=l,f.resolver=y,f.injector=E,f.outlet&&f.outlet.activateWith(l,f.injector),this.activateChildRoutes(t,null,f.children)}}else this.activateChildRoutes(t,null,a)}}class n4{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class qN{constructor(t,e){this.component=t,this.route=e}}function MW(i,t,e){const a=i._root;return ZT(a,t?t._root:null,e,[a.value])}function Bv(i,t){const e=Symbol(),a=t.get(i,e);return a===e?"function"!=typeof i||function Tl(i){return null!==xr(i)}(i)?t.get(i):i:a}function ZT(i,t,e,a,l={canDeactivateChecks:[],canActivateChecks:[]}){const u=Vv(t);return i.children.forEach(f=>{(function xW(i,t,e,a,l={canDeactivateChecks:[],canActivateChecks:[]}){const u=i.value,f=t?t.value:null,E=e?e.getContext(i.value.outlet):null;if(f&&u.routeConfig===f.routeConfig){const y=function LW(i,t,e){if("function"==typeof e)return e(i,t);switch(e){case"pathParamsChange":return!Om(i.url,t.url);case"pathParamsOrQueryParamsChange":return!Om(i.url,t.url)||!El(i.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!X2(i,t)||!El(i.queryParams,t.queryParams);default:return!X2(i,t)}}(f,u,u.routeConfig.runGuardsAndResolvers);y?l.canActivateChecks.push(new n4(a)):(u.data=f.data,u._resolvedData=f._resolvedData),ZT(i,t,u.component?E?E.children:null:e,a,l),y&&E&&E.outlet&&E.outlet.isActivated&&l.canDeactivateChecks.push(new qN(E.outlet.component,f))}else f&&e0(t,E,l),l.canActivateChecks.push(new n4(a)),ZT(i,null,u.component?E?E.children:null:e,a,l)})(f,u[f.value.outlet],e,a.concat([f.value]),l),delete u[f.value.outlet]}),Zr(u,(f,E)=>e0(f,e.getContext(E),l)),l}function e0(i,t,e){const a=Vv(i),l=i.value;Zr(a,(u,f)=>{e0(u,l.component?t?t.children.getContext(f):null:t,e)}),e.canDeactivateChecks.push(new qN(l.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,l))}function t0(i){return"function"==typeof i}function nF(i){return i instanceof kN||"EmptyError"===i?.name}const YN=Symbol("INITIAL_VALUE");function jv(){return Ua(i=>KL(i.map(t=>t.pipe(Qr(1),qL(YN)))).pipe(At(t=>{for(const e of t)if(!0!==e){if(e===YN)return YN;if(!1===e||e instanceof op)return e}return!0}),vc(t=>t!==YN),Qr(1)))}function i4(i){return function d0(...i){return Kv(i)}(Nr(t=>{if(Nm(t))throw XB(0,t)}),At(t=>!0===t))}const iF={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function r4(i,t,e,a,l){const u=rF(i,t,e);return u.matched?function ZW(i,t,e,a){const l=t.canMatch;return l&&0!==l.length?ze(l.map(f=>{const E=Bv(f,i);return rp(function HW(i){return i&&t0(i.canMatch)}(E)?E.canMatch(t,e):i.runInContext(()=>E(t,e)))})).pipe(jv(),i4()):ze(!0)}(a=e4(t,a),t,e).pipe(At(f=>!0===f?u:{...iF})):ze(u)}function rF(i,t,e){if(""===t.path)return"full"===t.pathMatch&&(i.hasChildren()||e.length>0)?{...iF}:{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};const l=(t.matcher||kG)(e,i,t);if(!l)return{...iF};const u={};Zr(l.posParams,(E,y)=>{u[y]=E.path});const f=l.consumed.length>0?{...u,...l.consumed[l.consumed.length-1].parameters}:u;return{matched:!0,consumedSegments:l.consumed,remainingSegments:e.slice(l.consumed.length),parameters:f,positionalParamSegments:l.posParams??{}}}function $N(i,t,e,a){if(e.length>0&&function n9(i,t,e){return e.some(a=>XN(i,t,a)&&Va(a)!==Nt)}(i,e,a)){const u=new Gt(t,function t9(i,t,e,a){const l={};l[Nt]=a,a._sourceSegment=i,a._segmentIndexShift=t.length;for(const u of e)if(""===u.path&&Va(u)!==Nt){const f=new Gt([],{});f._sourceSegment=i,f._segmentIndexShift=t.length,l[Va(u)]=f}return l}(i,t,a,new Gt(e,i.children)));return u._sourceSegment=i,u._segmentIndexShift=t.length,{segmentGroup:u,slicedSegments:[]}}if(0===e.length&&function i9(i,t,e){return e.some(a=>XN(i,t,a))}(i,e,a)){const u=new Gt(i.segments,function e9(i,t,e,a,l){const u={};for(const f of a)if(XN(i,e,f)&&!l[Va(f)]){const E=new Gt([],{});E._sourceSegment=i,E._segmentIndexShift=t.length,u[Va(f)]=E}return{...l,...u}}(i,t,e,a,i.children));return u._sourceSegment=i,u._segmentIndexShift=t.length,{segmentGroup:u,slicedSegments:e}}const l=new Gt(i.segments,i.children);return l._sourceSegment=i,l._segmentIndexShift=t.length,{segmentGroup:l,slicedSegments:e}}function XN(i,t,e){return(!(i.hasChildren()||t.length>0)||"full"!==e.pathMatch)&&""===e.path}function o4(i,t,e,a){return!!(Va(i)===a||a!==Nt&&XN(t,e,i))&&("**"===i.path||rF(t,i,e).matched)}function s4(i,t,e){return 0===t.length&&!i.children[e]}const JN=!1;class QN{constructor(t){this.segmentGroup=t||null}}class a4{constructor(t){this.urlTree=t}}function n0(i){return kv(new QN(i))}function c4(i){return kv(new a4(i))}function r9(i){return kv(new he(4e3,JN&&`Only absolute redirects can have named outlets. redirectTo: '${i}'`))}class a9{constructor(t,e,a,l,u){this.injector=t,this.configLoader=e,this.urlSerializer=a,this.urlTree=l,this.config=u,this.allowRedirects=!0}apply(){const t=$N(this.urlTree.root,[],[],this.config).segmentGroup,e=new Gt(t.segments,t.children);return this.expandSegmentGroup(this.injector,this.config,e,Nt).pipe(At(u=>this.createUrlTree(HN(u),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Dm(u=>{if(u instanceof a4)return this.allowRedirects=!1,this.match(u.urlTree);throw u instanceof QN?this.noMatchError(u):u}))}match(t){return this.expandSegmentGroup(this.injector,this.config,t.root,Nt).pipe(At(l=>this.createUrlTree(HN(l),t.queryParams,t.fragment))).pipe(Dm(l=>{throw l instanceof QN?this.noMatchError(l):l}))}noMatchError(t){return new he(4002,JN&&`Cannot match any routes. URL Segment: '${t.segmentGroup}'`)}createUrlTree(t,e,a){const l=B2(t);return new op(l,e,a)}expandSegmentGroup(t,e,a,l){return 0===a.segments.length&&a.hasChildren()?this.expandChildren(t,e,a).pipe(At(u=>new Gt([],u))):this.expandSegment(t,a,e,a.segments,l,!0)}expandChildren(t,e,a){const l=[];for(const u of Object.keys(a.children))"primary"===u?l.unshift(u):l.push(u);return Di(l).pipe(Am(u=>{const f=a.children[u],E=t4(e,u);return this.expandSegmentGroup(t,E,f,u).pipe(At(y=>({segment:y,outlet:u})))}),SB((u,f)=>(u[f.outlet]=f.segment,u),{}),CB())}expandSegment(t,e,a,l,u,f){return Di(a).pipe(Am(E=>this.expandSegmentAgainstRoute(t,e,a,E,l,u,f).pipe(Dm(T=>{if(T instanceof QN)return ze(null);throw T}))),np(E=>!!E),Dm((E,y)=>{if(nF(E))return s4(e,l,u)?ze(new Gt([],{})):n0(e);throw E}))}expandSegmentAgainstRoute(t,e,a,l,u,f,E){return o4(l,e,u,f)?void 0===l.redirectTo?this.matchSegmentAgainstRoute(t,e,l,u,f):E&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,a,l,u,f):n0(e):n0(e)}expandSegmentAgainstRouteUsingRedirect(t,e,a,l,u,f){return"**"===l.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,a,l,f):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,a,l,u,f)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,e,a,l){const u=this.applyRedirectCommands([],a.redirectTo,{});return a.redirectTo.startsWith("/")?c4(u):this.lineralizeSegments(a,u).pipe(Vi(f=>{const E=new Gt(f,{});return this.expandSegment(t,E,e,f,l,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,e,a,l,u,f){const{matched:E,consumedSegments:y,remainingSegments:T,positionalParamSegments:R}=rF(e,l,u);if(!E)return n0(e);const L=this.applyRedirectCommands(y,l.redirectTo,R);return l.redirectTo.startsWith("/")?c4(L):this.lineralizeSegments(l,L).pipe(Vi(H=>this.expandSegment(t,e,a,H.concat(T),f,!1)))}matchSegmentAgainstRoute(t,e,a,l,u){return"**"===a.path?(t=e4(a,t),a.loadChildren?(a._loadedRoutes?ze({routes:a._loadedRoutes,injector:a._loadedInjector}):this.configLoader.loadChildren(t,a)).pipe(At(E=>(a._loadedRoutes=E.routes,a._loadedInjector=E.injector,new Gt(l,{})))):ze(new Gt(l,{}))):r4(e,a,l,t).pipe(Ua(({matched:f,consumedSegments:E,remainingSegments:y})=>f?this.getChildConfig(t=a._injector??t,a,l).pipe(Vi(R=>{const L=R.injector??t,H=R.routes,{segmentGroup:W,slicedSegments:q}=$N(e,E,y,H),re=new Gt(W.segments,W.children);if(0===q.length&&re.hasChildren())return this.expandChildren(L,H,re).pipe(At(ue=>new Gt(E,ue)));if(0===H.length&&0===q.length)return ze(new Gt(E,{}));const ce=Va(a)===u;return this.expandSegment(L,re,H,q,ce?Nt:u,!0).pipe(At(De=>new Gt(E.concat(De.segments),De.children)))})):n0(e)))}getChildConfig(t,e,a){return e.children?ze({routes:e.children,injector:t}):e.loadChildren?void 0!==e._loadedRoutes?ze({routes:e._loadedRoutes,injector:e._loadedInjector}):function QW(i,t,e,a){const l=t.canLoad;return void 0===l||0===l.length?ze(!0):ze(l.map(f=>{const E=Bv(f,i);return rp(function UW(i){return i&&t0(i.canLoad)}(E)?E.canLoad(t,e):i.runInContext(()=>E(t,e)))})).pipe(jv(),i4())}(t,e,a).pipe(Vi(l=>l?this.configLoader.loadChildren(t,e).pipe(Nr(u=>{e._loadedRoutes=u.routes,e._loadedInjector=u.injector})):function o9(i){return kv(JB(JN&&`Cannot load children because the guard of the route "path: '${i.path}'" returned false`,3))}(e))):ze({routes:[],injector:t})}lineralizeSegments(t,e){let a=[],l=e.root;for(;;){if(a=a.concat(l.segments),0===l.numberOfChildren)return ze(a);if(l.numberOfChildren>1||!l.children[Nt])return r9(t.redirectTo);l=l.children[Nt]}}applyRedirectCommands(t,e,a){return this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),t,a)}applyRedirectCreateUrlTree(t,e,a,l){const u=this.createSegmentGroup(t,e.root,a,l);return new op(u,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){const a={};return Zr(t,(l,u)=>{if("string"==typeof l&&l.startsWith(":")){const E=l.substring(1);a[u]=e[E]}else a[u]=l}),a}createSegmentGroup(t,e,a,l){const u=this.createSegments(t,e.segments,a,l);let f={};return Zr(e.children,(E,y)=>{f[y]=this.createSegmentGroup(t,E,a,l)}),new Gt(u,f)}createSegments(t,e,a,l){return e.map(u=>u.path.startsWith(":")?this.findPosParam(t,u,l):this.findOrReturn(u,a))}findPosParam(t,e,a){const l=a[e.path.substring(1)];if(!l)throw new he(4001,JN&&`Cannot redirect to '${t}'. Cannot find '${e.path}'.`);return l}findOrReturn(t,e){let a=0;for(const l of e){if(l.path===t.path)return e.splice(a),l;a++}return t}}class l9{}class h9{constructor(t,e,a,l,u,f,E){this.injector=t,this.rootComponentType=e,this.config=a,this.urlTree=l,this.url=u,this.paramsInheritanceStrategy=f,this.urlSerializer=E}recognize(){const t=$N(this.urlTree.root,[],[],this.config.filter(e=>void 0===e.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,Nt).pipe(At(e=>{if(null===e)return null;const a=new zN([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Nt,this.rootComponentType,null,this.urlTree.root,-1,{}),l=new eu(a,e),u=new YB(this.url,l);return this.inheritParamsAndData(u._root),u}))}inheritParamsAndData(t){const e=t.value,a=qB(e,this.paramsInheritanceStrategy);e.params=Object.freeze(a.params),e.data=Object.freeze(a.data),t.children.forEach(l=>this.inheritParamsAndData(l))}processSegmentGroup(t,e,a,l){return 0===a.segments.length&&a.hasChildren()?this.processChildren(t,e,a):this.processSegment(t,e,a,a.segments,l)}processChildren(t,e,a){return Di(Object.keys(a.children)).pipe(Am(l=>{const u=a.children[l],f=t4(e,l);return this.processSegmentGroup(t,f,u,l)}),SB((l,u)=>l&&u?(l.push(...u),l):null),function wG(i,t=!1){return e=>e.lift(new IG(i,t))}(l=>null!==l),xN(null),CB(),At(l=>{if(null===l)return null;const u=d4(l);return function p9(i){i.sort((t,e)=>t.value.outlet===Nt?-1:e.value.outlet===Nt?1:t.value.outlet.localeCompare(e.value.outlet))}(u),u}))}processSegment(t,e,a,l,u){return Di(e).pipe(Am(f=>this.processSegmentAgainstRoute(f._injector??t,f,a,l,u)),np(f=>!!f),Dm(f=>{if(nF(f))return s4(a,l,u)?ze([]):ze(null);throw f}))}processSegmentAgainstRoute(t,e,a,l,u){if(e.redirectTo||!o4(e,a,l,u))return ze(null);let f;if("**"===e.path){const E=l.length>0?IB(l).parameters:{},y=h4(a)+l.length;f=ze({snapshot:new zN(l,E,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,p4(e),Va(e),e.component??e._loadedComponent??null,e,u4(a),y,f4(e)),consumedSegments:[],remainingSegments:[]})}else f=r4(a,e,l,t).pipe(At(({matched:E,consumedSegments:y,remainingSegments:T,parameters:R})=>{if(!E)return null;const L=h4(a)+y.length;return{snapshot:new zN(y,R,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,p4(e),Va(e),e.component??e._loadedComponent??null,e,u4(a),L,f4(e)),consumedSegments:y,remainingSegments:T}}));return f.pipe(Ua(E=>{if(null===E)return ze(null);const{snapshot:y,consumedSegments:T,remainingSegments:R}=E;t=e._injector??t;const L=e._loadedInjector??t,H=function f9(i){return i.children?i.children:i.loadChildren?i._loadedRoutes:[]}(e),{segmentGroup:W,slicedSegments:q}=$N(a,T,R,H.filter(ce=>void 0===ce.redirectTo));if(0===q.length&&W.hasChildren())return this.processChildren(L,H,W).pipe(At(ce=>null===ce?null:[new eu(y,ce)]));if(0===H.length&&0===q.length)return ze([new eu(y,[])]);const re=Va(e)===u;return this.processSegment(L,H,W,q,re?Nt:u).pipe(At(ce=>null===ce?null:[new eu(y,ce)]))}))}}function m9(i){const t=i.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function d4(i){const t=[],e=new Set;for(const a of i){if(!m9(a)){t.push(a);continue}const l=t.find(u=>a.value.routeConfig===u.value.routeConfig);void 0!==l?(l.children.push(...a.children),e.add(l)):t.push(a)}for(const a of e){const l=d4(a.children);t.push(new eu(a.value,l))}return t.filter(a=>!e.has(a))}function u4(i){let t=i;for(;t._sourceSegment;)t=t._sourceSegment;return t}function h4(i){let t=i,e=t._segmentIndexShift??0;for(;t._sourceSegment;)t=t._sourceSegment,e+=t._segmentIndexShift??0;return e-1}function p4(i){return i.data||{}}function f4(i){return i.resolve||{}}function m4(i){return"string"==typeof i.title||null===i.title}function oF(i){return Ua(t=>{const e=i(t);return e?Di(e).pipe(At(()=>t)):ze(t)})}const Hv=new Pe("ROUTES");let sF=(()=>{class i{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Ct(zc)}loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return ze(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);const a=rp(e.loadComponent()).pipe(At(g4),Nr(u=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=u}),F2(()=>{this.componentLoaders.delete(e)})),l=new Gm(a,()=>new Xt).pipe(qn());return this.componentLoaders.set(e,l),l}loadChildren(e,a){if(this.childrenLoaders.get(a))return this.childrenLoaders.get(a);if(a._loadedRoutes)return ze({routes:a._loadedRoutes,injector:a._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(a);const u=this.loadModuleFactoryOrRoutes(a.loadChildren).pipe(At(E=>{this.onLoadEndListener&&this.onLoadEndListener(a);let y,T,R=!1;Array.isArray(E)?T=E:(y=E.create(e).injector,T=wB(y.get(Hv,[],rt.Self|rt.Optional)));return{routes:T.map(tF),injector:y}}),F2(()=>{this.childrenLoaders.delete(a)})),f=new Gm(u,()=>new Xt).pipe(qn());return this.childrenLoaders.set(a,f),f}loadModuleFactoryOrRoutes(e){return rp(e()).pipe(At(g4),Vi(a=>a instanceof wA||Array.isArray(a)?ze(a):Di(this.compiler.compileModuleAsync(a))))}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function g4(i){return function C9(i){return i&&"object"==typeof i&&"default"in i}(i)?i.default:i}let eP=(()=>{class i{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new Xt,this.configLoader=Ct(sF),this.environmentInjector=Ct(ha),this.urlSerializer=Ct(zT),this.rootContexts=Ct(JT),this.navigationId=0,this.afterPreactivation=()=>ze(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=l=>this.events.next(new dW(l)),this.configLoader.onLoadStartListener=l=>this.events.next(new lW(l))}complete(){this.transitions?.complete()}handleNavigationRequest(e){const a=++this.navigationId;this.transitions?.next({...this.transitions.value,...e,id:a})}setupNavigations(e){return this.transitions=new Xr({id:0,targetPageId:0,currentUrlTree:e.currentUrlTree,currentRawUrl:e.currentUrlTree,extractedUrl:e.urlHandlingStrategy.extract(e.currentUrlTree),urlAfterRedirects:e.urlHandlingStrategy.extract(e.currentUrlTree),rawUrl:e.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:$T,restoredState:null,currentSnapshot:e.routerState.snapshot,targetSnapshot:null,currentRouterState:e.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(vc(a=>0!==a.id),At(a=>({...a,extractedUrl:e.urlHandlingStrategy.extract(a.rawUrl)})),Ua(a=>{let l=!1,u=!1;return ze(a).pipe(Nr(f=>{this.currentNavigation={id:f.id,initialUrl:f.rawUrl,extractedUrl:f.extractedUrl,trigger:f.source,extras:f.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Ua(f=>{const E=e.browserUrlTree.toString(),y=!e.navigated||f.extractedUrl.toString()!==E||E!==e.currentUrlTree.toString();if(!y&&"reload"!==(f.extras.onSameUrlNavigation??e.onSameUrlNavigation)){const R="";return this.events.next(new WN(f.id,e.serializeUrl(a.rawUrl),R,0)),e.rawUrlTree=f.rawUrl,f.resolve(null),Zh}if(e.urlHandlingStrategy.shouldProcessUrl(f.rawUrl))return E4(f.source)&&(e.browserUrlTree=f.extractedUrl),ze(f).pipe(Ua(R=>{const L=this.transitions?.getValue();return this.events.next(new W2(R.id,this.urlSerializer.serialize(R.extractedUrl),R.source,R.restoredState)),L!==this.transitions?.getValue()?Zh:Promise.resolve(R)}),function c9(i,t,e,a){return Ua(l=>function s9(i,t,e,a,l){return new a9(i,t,e,a,l).apply()}(i,t,e,l.extractedUrl,a).pipe(At(u=>({...l,urlAfterRedirects:u}))))}(this.environmentInjector,this.configLoader,this.urlSerializer,e.config),Nr(R=>{this.currentNavigation={...this.currentNavigation,finalUrl:R.urlAfterRedirects},a.urlAfterRedirects=R.urlAfterRedirects}),function g9(i,t,e,a,l){return Vi(u=>function u9(i,t,e,a,l,u,f="emptyOnly"){return new h9(i,t,e,a,l,f,u).recognize().pipe(Ua(E=>null===E?function d9(i){return new _n(t=>t.error(i))}(new l9):ze(E)))}(i,t,e,u.urlAfterRedirects,a.serialize(u.urlAfterRedirects),a,l).pipe(At(f=>({...u,targetSnapshot:f}))))}(this.environmentInjector,this.rootComponentType,e.config,this.urlSerializer,e.paramsInheritanceStrategy),Nr(R=>{if(a.targetSnapshot=R.targetSnapshot,"eager"===e.urlUpdateStrategy){if(!R.extras.skipLocationChange){const H=e.urlHandlingStrategy.merge(R.urlAfterRedirects,R.rawUrl);e.setBrowserUrl(H,R)}e.browserUrlTree=R.urlAfterRedirects}const L=new rW(R.id,this.urlSerializer.serialize(R.extractedUrl),this.urlSerializer.serialize(R.urlAfterRedirects),R.targetSnapshot);this.events.next(L)}));if(y&&e.urlHandlingStrategy.shouldProcessUrl(e.rawUrlTree)){const{id:R,extractedUrl:L,source:H,restoredState:W,extras:q}=f,re=new W2(R,this.urlSerializer.serialize(L),H,W);this.events.next(re);const ce=KB(L,this.rootComponentType).snapshot;return ze(a={...f,targetSnapshot:ce,urlAfterRedirects:L,extras:{...q,skipLocationChange:!1,replaceUrl:!1}})}{const R="";return this.events.next(new WN(f.id,e.serializeUrl(a.extractedUrl),R,1)),e.rawUrlTree=f.rawUrl,f.resolve(null),Zh}}),Nr(f=>{const E=new oW(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects),f.targetSnapshot);this.events.next(E)}),At(f=>a={...f,guards:MW(f.targetSnapshot,f.currentSnapshot,this.rootContexts)}),function WW(i,t){return Vi(e=>{const{targetSnapshot:a,currentSnapshot:l,guards:{canActivateChecks:u,canDeactivateChecks:f}}=e;return 0===f.length&&0===u.length?ze({...e,guardsResult:!0}):function zW(i,t,e,a){return Di(i).pipe(Vi(l=>function JW(i,t,e,a,l){const u=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return u&&0!==u.length?ze(u.map(E=>{const y=QT(t)??l,T=Bv(E,y);return rp(function jW(i){return i&&t0(i.canDeactivate)}(T)?T.canDeactivate(i,t,e,a):y.runInContext(()=>T(i,t,e,a))).pipe(np())})).pipe(jv()):ze(!0)}(l.component,l.route,e,t,a)),np(l=>!0!==l,!0))}(f,a,l,i).pipe(Vi(E=>E&&function FW(i){return"boolean"==typeof i}(E)?function KW(i,t,e,a){return Di(t).pipe(Am(l=>dN(function YW(i,t){return null!==i&&t&&t(new uW(i)),ze(!0)}(l.route.parent,a),function qW(i,t){return null!==i&&t&&t(new pW(i)),ze(!0)}(l.route,a),function XW(i,t,e){const a=t[t.length-1],u=t.slice(0,t.length-1).reverse().map(f=>function kW(i){const t=i.routeConfig?i.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:i,guards:t}:null}(f)).filter(f=>null!==f).map(f=>yB(()=>ze(f.guards.map(y=>{const T=QT(f.node)??e,R=Bv(y,T);return rp(function BW(i){return i&&t0(i.canActivateChild)}(R)?R.canActivateChild(a,i):T.runInContext(()=>R(a,i))).pipe(np())})).pipe(jv())));return ze(u).pipe(jv())}(i,l.path,e),function $W(i,t,e){const a=t.routeConfig?t.routeConfig.canActivate:null;if(!a||0===a.length)return ze(!0);const l=a.map(u=>yB(()=>{const f=QT(t)??e,E=Bv(u,f);return rp(function VW(i){return i&&t0(i.canActivate)}(E)?E.canActivate(t,i):f.runInContext(()=>E(t,i))).pipe(np())}));return ze(l).pipe(jv())}(i,l.route,e))),np(l=>!0!==l,!0))}(a,u,i,t):ze(E)),At(E=>({...e,guardsResult:E})))})}(this.environmentInjector,f=>this.events.next(f)),Nr(f=>{if(a.guardsResult=f.guardsResult,Nm(f.guardsResult))throw XB(0,f.guardsResult);const E=new sW(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects),f.targetSnapshot,!!f.guardsResult);this.events.next(E)}),vc(f=>!!f.guardsResult||(e.restoreHistory(f),this.cancelNavigationTransition(f,"",3),!1)),oF(f=>{if(f.guards.canActivateChecks.length)return ze(f).pipe(Nr(E=>{const y=new aW(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot);this.events.next(y)}),Ua(E=>{let y=!1;return ze(E).pipe(function E9(i,t){return Vi(e=>{const{targetSnapshot:a,guards:{canActivateChecks:l}}=e;if(!l.length)return ze(e);let u=0;return Di(l).pipe(Am(f=>function v9(i,t,e,a){const l=i.routeConfig,u=i._resolve;return void 0!==l?.title&&!m4(l)&&(u[GT]=l.title),function y9(i,t,e,a){const l=function b9(i){return[...Object.keys(i),...Object.getOwnPropertySymbols(i)]}(i);if(0===l.length)return ze({});const u={};return Di(l).pipe(Vi(f=>function S9(i,t,e,a){const l=QT(t)??a,u=Bv(i,l);return rp(u.resolve?u.resolve(t,e):l.runInContext(()=>u(t,e)))}(i[f],t,e,a).pipe(np(),Nr(E=>{u[f]=E}))),L2(1),function AG(i){return t=>t.lift(new DG(i))}(u),Dm(f=>nF(f)?Zh:kv(f)))}(u,i,t,a).pipe(At(f=>(i._resolvedData=f,i.data=qB(i,e).resolve,l&&m4(l)&&(i.data[GT]=l.title),null)))}(f.route,a,i,t)),Nr(()=>u++),L2(1),Vi(f=>u===l.length?ze(e):Zh))})}(e.paramsInheritanceStrategy,this.environmentInjector),Nr({next:()=>y=!0,complete:()=>{y||(e.restoreHistory(E),this.cancelNavigationTransition(E,"",2))}}))}),Nr(E=>{const y=new cW(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot);this.events.next(y)}))}),oF(f=>{const E=y=>{const T=[];y.routeConfig?.loadComponent&&!y.routeConfig._loadedComponent&&T.push(this.configLoader.loadComponent(y.routeConfig).pipe(Nr(R=>{y.component=R}),At(()=>{})));for(const R of y.children)T.push(...E(R));return T};return KL(E(f.targetSnapshot.root)).pipe(xN(),Qr(1))}),oF(()=>this.afterPreactivation()),At(f=>{const E=function SW(i,t,e){const a=XT(i,t._root,e?e._root:void 0);return new zB(a,t)}(e.routeReuseStrategy,f.targetSnapshot,f.currentRouterState);return a={...f,targetRouterState:E}}),Nr(f=>{e.currentUrlTree=f.urlAfterRedirects,e.rawUrlTree=e.urlHandlingStrategy.merge(f.urlAfterRedirects,f.rawUrl),e.routerState=f.targetRouterState,"deferred"===e.urlUpdateStrategy&&(f.extras.skipLocationChange||e.setBrowserUrl(e.rawUrlTree,f),e.browserUrlTree=f.urlAfterRedirects)}),((i,t,e)=>At(a=>(new PW(t,a.targetRouterState,a.currentRouterState,e).activate(i),a)))(this.rootContexts,e.routeReuseStrategy,f=>this.events.next(f)),Qr(1),Nr({next:f=>{l=!0,this.lastSuccessfulNavigation=this.currentNavigation,e.navigated=!0,this.events.next(new Pm(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(e.currentUrlTree))),e.titleStrategy?.updateTitle(f.targetRouterState.snapshot),f.resolve(!0)},complete:()=>{l=!0}}),F2(()=>{l||u||this.cancelNavigationTransition(a,"",1),this.currentNavigation?.id===a.id&&(this.currentNavigation=null)}),Dm(f=>{if(u=!0,ZB(f)){QB(f)||(e.navigated=!0,e.restoreHistory(a,!0));const E=new GN(a.id,this.urlSerializer.serialize(a.extractedUrl),f.message,f.cancellationCode);if(this.events.next(E),QB(f)){const y=e.urlHandlingStrategy.merge(f.url,e.rawUrlTree),T={skipLocationChange:a.extras.skipLocationChange,replaceUrl:"eager"===e.urlUpdateStrategy||E4(a.source)};e.scheduleNavigation(y,$T,null,T,{resolve:a.resolve,reject:a.reject,promise:a.promise})}else a.resolve(!1)}else{e.restoreHistory(a,!0);const E=new z2(a.id,this.urlSerializer.serialize(a.extractedUrl),f,a.targetSnapshot??void 0);this.events.next(E);try{a.resolve(e.errorHandler(f))}catch(y){a.reject(y)}}return Zh}))}))}cancelNavigationTransition(e,a,l){const u=new GN(e.id,this.urlSerializer.serialize(e.extractedUrl),a,l);this.events.next(u),e.resolve(!1)}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function E4(i){return i!==$T}let v4=(()=>{class i{buildTitle(e){let a,l=e.root;for(;void 0!==l;)a=this.getResolvedTitleForRoute(l)??a,l=l.children.find(u=>u.outlet===Nt);return a}getResolvedTitleForRoute(e){return e.data[GT]}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=Oe({token:i,factory:function(){return Ct(T9)},providedIn:"root"}),i})(),T9=(()=>{class i extends v4{constructor(e){super(),this.title=e}updateTitle(e){const a=this.buildTitle(e);void 0!==a&&this.title.setTitle(a)}}return i.\u0275fac=function(e){return new(e||i)(pe(yO))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),w9=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=Oe({token:i,factory:function(){return Ct(R9)},providedIn:"root"}),i})();class I9{shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}}let R9=(()=>{class i extends I9{}return i.\u0275fac=function(){let t;return function(a){return(t||(t=Hi(i)))(a||i)}}(),i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const tP=new Pe("",{providedIn:"root",factory:()=>({})});let D9=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=Oe({token:i,factory:function(){return Ct(O9)},providedIn:"root"}),i})(),O9=(()=>{class i{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,a){return e}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function N9(i){throw i}function P9(i,t,e){return t.parse("/")}const M9={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},k9={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let zo=(()=>{class i{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){if("computed"===this.canceledNavigationResolution)return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=Ct(Ke),this.isNgZoneEnabled=!1,this.options=Ct(tP,{optional:!0})||{},this.errorHandler=this.options.errorHandler||N9,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||P9,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=Ct(D9),this.routeReuseStrategy=Ct(w9),this.urlCreationStrategy=Ct(vW),this.titleStrategy=Ct(v4),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=wB(Ct(Hv,{optional:!0})??[]),this.navigationTransitions=Ct(eP),this.urlSerializer=Ct(zT),this.location=Ct(Sh),this.isNgZoneEnabled=Ct(me)instanceof me&&me.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new op,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=KB(this.currentUrlTree,null),this.navigationTransitions.setupNavigations(this).subscribe(e=>{this.lastSuccessfulId=e.id,this.currentPageId=this.browserPageId??0},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const e=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),$T,e)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const a="popstate"===e.type?"popstate":"hashchange";"popstate"===a&&setTimeout(()=>{this.navigateToSyncWithBrowser(e.url,a,e.state)},0)}))}navigateToSyncWithBrowser(e,a,l){const u={replaceUrl:!0},f=l?.navigationId?l:null;if(l){const y={...l};delete y.navigationId,delete y.\u0275routerPageId,0!==Object.keys(y).length&&(u.state=y)}const E=this.parseUrl(e);this.scheduleNavigation(E,a,f,u)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}resetConfig(e){this.config=e.map(tF),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,a={}){const{relativeTo:l,queryParams:u,fragment:f,queryParamsHandling:E,preserveFragment:y}=a,T=y?this.currentUrlTree.fragment:f;let R=null;switch(E){case"merge":R={...this.currentUrlTree.queryParams,...u};break;case"preserve":R=this.currentUrlTree.queryParams;break;default:R=u||null}return null!==R&&(R=this.removeEmptyProps(R)),this.urlCreationStrategy.createUrlTree(l,this.routerState,this.currentUrlTree,e,R,T??null)}navigateByUrl(e,a={skipLocationChange:!1}){const l=Nm(e)?e:this.parseUrl(e),u=this.urlHandlingStrategy.merge(l,this.rawUrlTree);return this.scheduleNavigation(u,$T,null,a)}navigate(e,a={skipLocationChange:!1}){return function x9(i){for(let t=0;t<i.length;t++){const e=i[t];if(null==e)throw new he(4008,false)}}(e),this.navigateByUrl(this.createUrlTree(e,a),a)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let a;try{a=this.urlSerializer.parse(e)}catch(l){a=this.malformedUriErrorHandler(l,this.urlSerializer,e)}return a}isActive(e,a){let l;if(l=!0===a?{...M9}:!1===a?{...k9}:a,Nm(e))return AB(this.currentUrlTree,e,l);const u=this.parseUrl(e);return AB(this.currentUrlTree,u,l)}removeEmptyProps(e){return Object.keys(e).reduce((a,l)=>{const u=e[l];return null!=u&&(a[l]=u),a},{})}scheduleNavigation(e,a,l,u,f){if(this.disposed)return Promise.resolve(!1);let E,y,T,R;return f?(E=f.resolve,y=f.reject,T=f.promise):T=new Promise((L,H)=>{E=L,y=H}),R="computed"===this.canceledNavigationResolution?l&&l.\u0275routerPageId?l.\u0275routerPageId:(this.browserPageId??0)+1:0,this.navigationTransitions.handleNavigationRequest({targetPageId:R,source:a,restoredState:l,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:e,extras:u,resolve:E,reject:y,promise:T,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),T.catch(L=>Promise.reject(L))}setBrowserUrl(e,a){const l=this.urlSerializer.serialize(e);if(this.location.isCurrentPathEqualTo(l)||a.extras.replaceUrl){const f={...a.extras.state,...this.generateNgRouterState(a.id,this.browserPageId)};this.location.replaceState(l,"",f)}else{const u={...a.extras.state,...this.generateNgRouterState(a.id,a.targetPageId)};this.location.go(l,"",u)}}restoreHistory(e,a=!1){if("computed"===this.canceledNavigationResolution){const u=this.currentPageId-(this.browserPageId??this.currentPageId);0!==u?this.location.historyGo(u):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===u&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(a&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,a){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:a}:{navigationId:e}}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();class y4{}let U9=(()=>{class i{constructor(e,a,l,u,f){this.router=e,this.injector=l,this.preloadingStrategy=u,this.loader=f}setUpPreloading(){this.subscription=this.router.events.pipe(vc(e=>e instanceof Pm),Am(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,a){const l=[];for(const u of a){u.providers&&!u._injector&&(u._injector=ah(u.providers,e,`Route: ${u.path}`));const f=u._injector??e,E=u._loadedInjector??f;(u.loadChildren&&!u._loadedRoutes&&void 0===u.canLoad||u.loadComponent&&!u._loadedComponent)&&l.push(this.preloadConfig(f,u)),(u.children||u._loadedRoutes)&&l.push(this.processRoutes(E,u.children??u._loadedRoutes))}return Di(l).pipe(Ha())}preloadConfig(e,a){return this.preloadingStrategy.preload(a,()=>{let l;l=a.loadChildren&&void 0===a.canLoad?this.loader.loadChildren(e,a):ze(null);const u=l.pipe(Vi(f=>null===f?ze(void 0):(a._loadedRoutes=f.routes,a._loadedInjector=f.injector,this.processRoutes(f.injector??e,f.routes))));return a.loadComponent&&!a._loadedComponent?Di([u,this.loader.loadComponent(a)]).pipe(Ha()):u})}}return i.\u0275fac=function(e){return new(e||i)(pe(zo),pe(zc),pe(ha),pe(y4),pe(sF))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const lF=new Pe("");let b4=(()=>{class i{constructor(e,a,l,u,f={}){this.urlSerializer=e,this.transitions=a,this.viewportScroller=l,this.zone=u,this.options=f,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},f.scrollPositionRestoration=f.scrollPositionRestoration||"disabled",f.anchorScrolling=f.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof W2?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof Pm&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof GB&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,a){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new GB(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,a))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return i.\u0275fac=function(e){qp()},i.\u0275prov=Oe({token:i,factory:i.\u0275fac}),i})();var ta=(()=>((ta=ta||{})[ta.COMPLETE=0]="COMPLETE",ta[ta.FAILED=1]="FAILED",ta[ta.REDIRECTING=2]="REDIRECTING",ta))();const Gv=!1;function sp(i,t){return{\u0275kind:i,\u0275providers:t}}const dF=new Pe("",{providedIn:"root",factory:()=>!1});function C4(){const i=Ct(No);return t=>{const e=i.get(Yc);if(t!==e.components[0])return;const a=i.get(zo),l=i.get(T4);1===i.get(uF)&&a.initialNavigation(),i.get(w4,null,rt.Optional)?.setUpPreloading(),i.get(lF,null,rt.Optional)?.init(),a.resetRootComponentType(e.componentTypes[0]),l.closed||(l.next(),l.complete(),l.unsubscribe())}}const T4=new Pe(Gv?"bootstrap done indicator":"",{factory:()=>new Xt}),uF=new Pe(Gv?"initial navigation":"",{providedIn:"root",factory:()=>1});function G9(){let i=[];return i=Gv?[{provide:Z_,multi:!0,useFactory:()=>{const t=Ct(zo);return()=>t.events.subscribe(e=>{console.group?.(`Router Event: ${e.constructor.name}`),console.log(function mW(i){if(!("type"in i))return`Unknown Router Event: ${i.constructor.name}`;switch(i.type){case 14:return`ActivationEnd(path: '${i.snapshot.routeConfig?.path||""}')`;case 13:return`ActivationStart(path: '${i.snapshot.routeConfig?.path||""}')`;case 12:return`ChildActivationEnd(path: '${i.snapshot.routeConfig?.path||""}')`;case 11:return`ChildActivationStart(path: '${i.snapshot.routeConfig?.path||""}')`;case 8:return`GuardsCheckEnd(id: ${i.id}, url: '${i.url}', urlAfterRedirects: '${i.urlAfterRedirects}', state: ${i.state}, shouldActivate: ${i.shouldActivate})`;case 7:return`GuardsCheckStart(id: ${i.id}, url: '${i.url}', urlAfterRedirects: '${i.urlAfterRedirects}', state: ${i.state})`;case 2:return`NavigationCancel(id: ${i.id}, url: '${i.url}')`;case 16:return`NavigationSkipped(id: ${i.id}, url: '${i.url}')`;case 1:return`NavigationEnd(id: ${i.id}, url: '${i.url}', urlAfterRedirects: '${i.urlAfterRedirects}')`;case 3:return`NavigationError(id: ${i.id}, url: '${i.url}', error: ${i.error})`;case 0:return`NavigationStart(id: ${i.id}, url: '${i.url}')`;case 6:return`ResolveEnd(id: ${i.id}, url: '${i.url}', urlAfterRedirects: '${i.urlAfterRedirects}', state: ${i.state})`;case 5:return`ResolveStart(id: ${i.id}, url: '${i.url}', urlAfterRedirects: '${i.urlAfterRedirects}', state: ${i.state})`;case 10:return`RouteConfigLoadEnd(path: ${i.route.path})`;case 9:return`RouteConfigLoadStart(path: ${i.route.path})`;case 4:return`RoutesRecognized(id: ${i.id}, url: '${i.url}', urlAfterRedirects: '${i.urlAfterRedirects}', state: ${i.state})`;case 15:return`Scroll(anchor: '${i.anchor}', position: '${i.position?`${i.position[0]}, ${i.position[1]}`:null}')`}}(e)),console.log(e),console.groupEnd?.()})}}]:[],sp(1,i)}const w4=new Pe(Gv?"router preloader":"");function W9(i){return sp(0,[{provide:w4,useExisting:U9},{provide:y4,useExisting:i}])}const r0=!1,I4=new Pe(r0?"router duplicate forRoot guard":"ROUTER_FORROOT_GUARD"),z9=[Sh,{provide:zT,useClass:U2},zo,JT,{provide:Mm,useFactory:function S4(i){return i.routerState.root},deps:[zo]},sF,r0?{provide:dF,useValue:!0}:[]];function K9(){return new pD("Router",zo)}let q9=(()=>{class i{constructor(e){}static forRoot(e,a){return{ngModule:i,providers:[z9,r0&&a?.enableTracing?G9().\u0275providers:[],{provide:Hv,multi:!0,useValue:e},{provide:I4,useFactory:J9,deps:[[zo,new Nu,new Op]]},{provide:tP,useValue:a||{}},a?.useHash?{provide:fe,useClass:fE}:{provide:fe,useClass:ac},{provide:lF,useFactory:()=>{const i=Ct(Dx),t=Ct(me),e=Ct(tP),a=Ct(eP),l=Ct(zT);return e.scrollOffset&&i.setOffset(e.scrollOffset),new b4(l,a,i,t,e)}},a?.preloadingStrategy?W9(a.preloadingStrategy).\u0275providers:[],{provide:pD,multi:!0,useFactory:K9},a?.initialNavigation?Q9(a):[],[{provide:R4,useFactory:C4},{provide:uD,multi:!0,useExisting:R4}]]}}static forChild(e){return{ngModule:i,providers:[{provide:Hv,multi:!0,useValue:e}]}}}return i.\u0275fac=function(e){return new(e||i)(pe(I4,8))},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({imports:[Z2]}),i})();function J9(i){if(r0&&i)throw new he(4007,"The Router was provided more than once. This can happen if 'forRoot' is used outside of the root injector. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function Q9(i){return["disabled"===i.initialNavigation?sp(3,[{provide:w,multi:!0,useFactory:()=>{const t=Ct(zo);return()=>{t.setUpLocationChangeListener()}}},{provide:uF,useValue:2}]).\u0275providers:[],"enabledBlocking"===i.initialNavigation?sp(2,[{provide:uF,useValue:0},{provide:w,multi:!0,deps:[No],useFactory:t=>{const e=t.get(sc,Promise.resolve());return()=>e.then(()=>new Promise(a=>{const l=t.get(zo),u=t.get(T4);(function V9(i,t){i.events.pipe(vc(e=>e instanceof Pm||e instanceof GN||e instanceof z2||e instanceof WN),At(e=>e instanceof Pm||e instanceof WN?ta.COMPLETE:e instanceof GN&&(0===e.code||1===e.code)?ta.REDIRECTING:ta.FAILED),vc(e=>e!==ta.REDIRECTING),Qr(1)).subscribe(()=>{t()})})(l,()=>{a(!0)}),t.get(eP).afterPreactivation=()=>(a(!0),u.closed?ze(void 0):u),l.initialNavigation()}))}}]).\u0275providers:[]]}const R4=new Pe(r0?"Router Initializer":""),A4_configs={AppID:"fee9eb8f5bb44a6893ec96fd5e993a31"};let e7=(()=>{class i{static#e=this.\u0275fac=function(a){return new(a||i)};static#t=this.\u0275cmp=_r({type:i,selectors:[["app-root"]],decls:1,vars:0,template:function(a,l){1&a&&Tt(0,"router-outlet")},dependencies:[Q2],changeDetection:0})}return i})();function hF(i=0,t=Dv){return(!o2(i)||i<0)&&(i=0),(!t||"function"!=typeof t.schedule)&&(t=Dv),new _n(e=>(e.add(t.schedule(t7,i,{subscriber:e,counter:0,period:i})),e))}function t7(i){const{subscriber:t,counter:e,period:a}=i;t.next(e),this.schedule({subscriber:t,counter:e+1,period:a},a)}class yc{constructor(t,e,a){this.kind=t,this.value=e,this.error=a,this.hasValue="N"===t}observe(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}}do(t,e,a){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return a&&a()}}accept(t,e,a){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,a)}toObservable(){switch(this.kind){case"N":return ze(this.value);case"E":return kv(this.error);case"C":return uN()}throw new Error("unexpected notification kind value")}static createNext(t){return typeof t<"u"?new yc("N",t):yc.undefinedValueNotification}static createError(t){return new yc("E",void 0,t)}static createComplete(){return yc.completeNotification}}yc.completeNotification=new yc("C"),yc.undefinedValueNotification=new yc("N",void 0);class r7{constructor(t,e){this.delay=t,this.scheduler=e}call(t,e){return e.subscribe(new pF(t,this.delay,this.scheduler))}}class pF extends En{constructor(t,e,a){super(t),this.delay=e,this.scheduler=a,this.queue=[],this.active=!1,this.errored=!1}static dispatch(t){const e=t.source,a=e.queue,l=t.scheduler,u=t.destination;for(;a.length>0&&a[0].time-l.now()<=0;)a.shift().notification.observe(u);if(a.length>0){const f=Math.max(0,a[0].time-l.now());this.schedule(t,f)}else this.unsubscribe(),e.active=!1}_schedule(t){this.active=!0,this.destination.add(t.schedule(pF.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))}scheduleNotification(t){if(!0===this.errored)return;const e=this.scheduler,a=new o7(e.now()+this.delay,t);this.queue.push(a),!1===this.active&&this._schedule(e)}_next(t){this.scheduleNotification(yc.createNext(t))}_error(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()}_complete(){this.scheduleNotification(yc.createComplete()),this.unsubscribe()}}class o7{constructor(t,e){this.time=t,this.notification=e}}var s7=Fm(890);function a7(i,t){if(1&i){const e=ga();Ne(0,"div",1)(1,"button",2),tn("click",function(){return Fs(e),Us(ln().onToggleFullScreen())}),Ne(2,"div",3),Oo(),Ne(3,"svg",4)(4,"g",26)(5,"g",6)(6,"g",7)(7,"g",11),Tt(8,"path",27)(9,"path",28)(10,"path",29)(11,"path",30),Ge()()()(),Ne(12,"g",31)(13,"g",6)(14,"g",32)(15,"g",7),Tt(16,"path",33)(17,"path",34)(18,"path",35)(19,"path",36),Ge()()()()()(),Zo(),Ne(20,"p"),Ki(21),Ge()()()}if(2&i){const e=ln();Ze(1),Bt("controls__button--active",e.fullScreenEnabled),Ze(3),Bt("controls__icon--shown",!e.fullScreenEnabled),Ze(8),Bt("controls__icon--shown",e.fullScreenEnabled),Ze(9),dd(e.fullScreenEnabled?"Exit fullscreen":"Fullscreen")}}function c7(i,t){if(1&i){const e=ga();Ne(0,"div",1)(1,"button",37),tn("click",function(){return Fs(e),Us(ln().onToggleSmallScreen())}),Ne(2,"div",3),Oo(),Ne(3,"svg",4)(4,"g",38),Tt(5,"path",39),Ge(),Ne(6,"defs")(7,"filter",40),Tt(8,"feFlood",41)(9,"feColorMatrix",42)(10,"feOffset",43)(11,"feGaussianBlur",44)(12,"feComposite",45)(13,"feColorMatrix",46)(14,"feBlend",47)(15,"feBlend",48),Ge()()()(),Zo(),Ne(16,"p"),Ki(17,"Minimize"),Ge()()()}if(2&i){const e=ln();Ze(1),Bt("controls__button--active",e.smallScreenEnabled)}}function l7(i,t){if(1&i&&(Ne(0,"div",8),Ki(1),Ge()),2&i){const e=ln();Ze(1),dd(e.text)}}const d7=function(i,t,e,a){return{"spinner--connected":i,"spinner--ended":t,"spinner--small":e,"spinner--error":a}};function u7(i,t){if(1&i&&(Ku(0),Ki(1),od()),2&i){const e=ln(2);Ze(1),rf(" Calling to ",e.data.user.name," ")}}function h7(i,t){1&i&&Ki(0),2&i&&rf(" ",ln(2).data.user.name," is calling ")}function p7(i,t){if(1&i){const e=ga();Ku(0),Ne(1,"button",11),tn("click",function(){return Fs(e),Us(ln(2).onAcceptCall())}),Ge(),od()}}function f7(i,t){if(1&i){const e=ga();Ne(0,"div",1)(1,"div",2)(2,"div",3),Tt(3,"img",4),Ge(),Ne(4,"p",5),en(5,u7,2,1,"ng-container",6),en(6,h7,1,1,"ng-template",null,7,KS),Ge()(),Ne(8,"div",8),en(9,p7,2,0,"ng-container",9),Ne(10,"span")(11,"button",10),tn("click",function(){return Fs(e),Us(ln().onDeclineCall())}),Ge()()()()}if(2&i){const e=Qp(7),a=ln();Bt("video-call--full-screen",a.fullScreen),nt("@fade",void 0),Ze(3),nt("src",a.data.user.photoURL,fb),Ze(2),nt("ngIf",a.data.outcome)("ngIfElse",e),Ze(4),nt("ngIf",!a.data.outcome)}}function m7(i,t){if(1&i&&Tt(0,"ngx-spinner",15),2&i){const e=ln().ngIf,a=ln(2);nt("error",e.error)("text",e.statusText)("connected",e.connected)("ended",e.ended)("small",a.smallScreenEnabled)}}function _7(i,t){1&i&&Tt(0,"ngx-timer",16),2&i&&nt("started",ln().ngIf.started)}function g7(i,t){if(1&i&&(Tt(0,"div",17),gf(1,"async")),2&i){const e=t.$implicit;Bt("hidden",!1===dh(1,3,ln(3).remoteStreamVideoToggle$)),nt("id",e)}}function E7(i,t){if(1&i){const e=ga();Oo(),Zo(),Ne(0,"ngx-controls",18),tn("toggleCamera",function(l){return Fs(e),Us(ln(3).onToggleCamera(l))})("toggleMicrophone",function(l){return Fs(e),Us(ln(3).onToggleMicrophone(l))})("toggleFullScreen",function(l){return Fs(e),Us(ln(3).onToggleFullScreen(l))})("toggleSmallScreen",function(l){return Fs(e),Us(ln(3).onToggleSmallScreen(l))})("endCall",function(){return Fs(e),Us(ln(3).onEndCall())}),Ge()}if(2&i){const e=ln(3);nt("cameraEnabled",e.cameraEnabled)("microphoneEnabled",e.microphoneEnabled)("fullScreenEnabled",e.fullScreenEnabled)("smallScreenEnabled",e.smallScreenEnabled)("displaySmallScreen",e.displaySmallScreen)}}function v7(i,t){if(1&i&&(Ne(0,"div",2),en(1,m7,1,5,"ngx-spinner",3),en(2,_7,1,1,"ngx-timer",4),Tt(3,"div",5),en(4,g7,2,5,"div",6),Ne(5,"div",7),Oo(),Ne(6,"svg",8)(7,"g",9),Tt(8,"path",10)(9,"path",11),Ge(),Ne(10,"defs")(11,"clipPath",12),Tt(12,"rect",13),Ge()()()(),en(13,E7,1,5,"ngx-controls",14),Ge()),2&i){const e=t.ngIf,a=ln(2);Ze(1),nt("ngIf",e.loading),Ze(1),nt("ngIf",e.started),Ze(1),Bt("hidden",!a.cameraEnabled||a.smallScreenEnabled),nt("id",a.localContainerId),Ze(1),nt("ngForOf",a.remoteCalls),Ze(9),nt("ngIf",e.connected&&!e.ended)}}function y7(i,t){if(1&i&&(Ne(0,"div"),en(1,v7,14,7,"div",1),gf(2,"async"),Ge()),2&i){const e=ln();nt("@fade",void 0)("@.disabled",!e.animate),Ze(1),nt("ngIf",dh(2,3,e.streamState$))}}const nP_HIDDEN={opacity:0,"margin-top":"100%"},nP_SHOWN={opacity:1,"margin-top":0},D4=ZL("fade",[LT(":enter",[_l(nP_HIDDEN),xT("250ms ease-in-out",_l(nP_SHOWN))]),LT(":leave",[_l(nP_SHOWN),xT("250ms ease-in-out",_l(nP_HIDDEN))])]);class O4{constructor(t){this.cdr=t,this.afterClosed=new Xt,this.shown=!0}closeDialog(t){this.onAfterClosed(t)}onAfterClosed(t){this.shown=!1,this.cdr.markForCheck(),this.afterClosed.next(t)}}let b7=(()=>{class i{constructor(){this.cameraEnabled=!0,this.microphoneEnabled=!0,this.fullScreenEnabled=!1,this.smallScreenEnabled=!1,this.displaySmallScreen=!1,this.toggleCamera=new rn,this.toggleMicrophone=new rn,this.toggleFullScreen=new rn,this.toggleSmallScreen=new rn,this.endCall=new rn}onToggleCamera(){this.toggleCamera.emit(this.cameraEnabled)}onToggleMicrophone(){this.toggleMicrophone.emit(this.microphoneEnabled)}onToggleFullScreen(){this.toggleFullScreen.emit(this.fullScreenEnabled)}onToggleSmallScreen(){this.toggleSmallScreen.emit(this.smallScreenEnabled)}onEndCall(){this.endCall.emit()}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=_r({type:i,selectors:[["ngx-controls"]],inputs:{cameraEnabled:"cameraEnabled",microphoneEnabled:"microphoneEnabled",fullScreenEnabled:"fullScreenEnabled",smallScreenEnabled:"smallScreenEnabled",displaySmallScreen:"displaySmallScreen"},outputs:{toggleCamera:"toggleCamera",toggleMicrophone:"toggleMicrophone",toggleFullScreen:"toggleFullScreen",toggleSmallScreen:"toggleSmallScreen",endCall:"endCall"},decls:43,vars:16,consts:[[1,"controls"],[1,"controls__item"],[1,"controls__button",3,"click"],[1,"controls__icon-wrapper"],["viewBox","0 0 64 64","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","video-camera",1,"controls__icon"],["id","Group"],["id","Group_2"],["id","Vector","d","M63.4134 16.2294C63.0454 15.9814 62.5787 15.928 62.1707 16.096L50.6668 20.6986V20C50.6668 16.3226 47.6748 13.3334 44.0001 13.3334H6.66663C2.992 13.3334 0 16.3226 0 20V44C0 47.6774 2.992 50.6666 6.66663 50.6666H44C47.6746 50.6666 50.6666 47.6772 50.6666 44V43.3014L62.1706 47.904C62.5812 48.072 63.048 48.0186 63.4132 47.7706C63.7786 47.5226 63.9999 47.1093 63.9999 46.6666V17.3334C64 16.8906 63.7786 16.4774 63.4134 16.2294Z","fill","white"],["id","no-camera",1,"controls__icon"],["id","Vector","d","M44.0002 13.3325H6.66735C2.99276 13.3325 0.000793457 16.3218 0.000793457 19.999V43.9988C0.000793457 47.6761 2.99276 50.6654 6.66735 50.6654H7.67797L44.9176 13.4257C44.6162 13.3832 44.315 13.3325 44.0002 13.3325Z","fill","white"],["id","Group_3"],["id","Group_4"],["id","Vector_2","d","M63.4134 16.2285C63.0454 15.9805 62.5788 15.9271 62.1708 16.0951L50.6669 20.6977V19.9991C50.6669 18.6417 50.2535 17.3831 49.5549 16.3297L63.608 2.2766C64.128 1.75661 64.128 0.911242 63.608 0.391247C63.088 -0.128748 62.2426 -0.128748 61.7226 0.391247L0.389996 61.724C-0.129999 62.244 -0.129999 63.0894 0.389996 63.6094C0.651369 63.868 0.992615 63.9988 1.33399 63.9988C1.67536 63.9988 2.01661 63.8681 2.27798 63.6094L15.2192 50.6655H44.0003C47.6749 50.6655 50.6669 47.6762 50.6669 43.9989V43.3003L62.1708 47.9029C62.5814 48.0709 63.0481 48.0175 63.4134 47.7695C63.7788 47.5215 64 47.1082 64 46.6655V17.3325C64 16.8898 63.7788 16.4765 63.4134 16.2285Z","fill","white"],["id","microphone",1,"controls__icon"],["id","Vector"],["fill-rule","evenodd","clip-rule","evenodd","d","M44.3474 12.1407L44.3468 17.2309V33.8672C44.3468 40.6024 38.9004 46.0823 32.206 46.0823C27.8366 46.0787 23.8059 43.7286 21.6503 39.9279L20.4131 36.8161C20.1824 35.875 20.0659 34.9098 20.0659 33.941V12.1407C20.0659 5.43551 25.5014 0 32.2066 0C38.9118 0 44.3474 5.43551 44.3474 12.1407Z","fill","white"],["fill-rule","evenodd","clip-rule","evenodd","d","M15.0971 33.7512C15.0947 36.1345 15.5932 38.4912 16.5596 40.6697L18.1223 43.4553C22.3699 49.6259 30.1387 52.3143 37.292 50.089C44.4453 47.8638 49.318 41.2426 49.3156 33.7518C49.3156 32.9026 50.0039 32.2143 50.8532 32.2143C51.7018 32.2143 52.3907 32.9026 52.3907 33.7518C52.4051 44.4499 44.0585 53.2951 33.3778 53.9017V60.9246H39.8098C40.6584 60.9246 41.3473 61.6135 41.3473 62.4622C41.3473 63.3114 40.6584 63.9997 39.8098 63.9997H24.6029C23.7537 63.9997 23.0654 63.3114 23.0654 62.4622C23.0654 61.6135 23.7537 60.9246 24.6029 60.9246H30.3033V53.847C25.6228 53.4212 21.2413 51.3623 17.926 48.0313C17.1926 47.298 16.5163 46.51 15.9031 45.6739L14.2418 42.9874C12.7757 40.1297 12.0148 36.9633 12.022 33.7512C12.022 32.902 12.7103 32.2137 13.5595 32.2137C14.4088 32.2137 15.0971 32.902 15.0971 33.7512Z","fill","white"],["id","no-microphone",1,"controls__icon"],["id","Vector","d","M52.9733 4.25592L44.3474 12.8813V12.1407C44.3474 5.43551 38.9118 0 32.2066 0C25.5014 0 20.0659 5.43551 20.0659 12.1407V33.941C20.0659 34.9098 20.1824 35.875 20.4131 36.8161L16.5596 40.6697C15.5932 38.4912 15.0947 36.1345 15.0971 33.7512C15.0971 32.902 14.4088 32.2137 13.5595 32.2137C12.7103 32.2137 12.022 32.902 12.022 33.7512C12.0148 36.9633 12.7757 40.1297 14.2418 42.9874L8.81411 48.4151C8.4117 48.8007 8.24954 49.3731 8.39008 49.9124C8.53002 50.4518 8.95105 50.8728 9.4898 51.0133C10.0291 51.1539 10.6021 50.9917 10.9877 50.5899L15.9031 45.6739C16.5163 46.51 17.1926 47.298 17.926 48.0313C21.2413 51.3623 25.6228 53.4212 30.3033 53.847V60.9246H24.6029C23.7537 60.9246 23.0654 61.6135 23.0654 62.4622C23.0654 63.3114 23.7537 63.9997 24.6029 63.9997H39.8098C40.6584 63.9997 41.3473 63.3114 41.3473 62.4622C41.3473 61.6135 40.6584 60.9246 39.8098 60.9246H33.3778V53.9017C44.0585 53.2951 52.4051 44.4499 52.3907 33.7518C52.3907 32.9026 51.7018 32.2143 50.8532 32.2143C50.0039 32.2143 49.3156 32.9026 49.3156 33.7518C49.318 41.2426 44.4453 47.8638 37.292 50.089C30.1387 52.3143 22.3699 49.6259 18.1224 43.4553L21.6503 39.9279C23.8059 43.7286 27.8366 46.0787 32.206 46.0823C38.9004 46.0823 44.3468 40.6024 44.3468 33.8672V17.2309L55.1475 6.43072C55.7481 5.83071 55.7481 4.85713 55.1475 4.25652C54.5469 3.65591 53.5733 3.65591 52.9733 4.25652V4.25592Z","fill","white"],["class","controls__item",4,"ngIf"],[1,"controls__button","controls__button--danger",3,"click"],["id","phone"],["id","Vector","d","M51.7097 13.2478C51.2458 12.7839 50.4959 12.7839 50.032 13.2478L1.38351 61.8963C0.919568 62.3602 0.919568 63.1101 1.38351 63.574C1.61488 63.8054 1.91864 63.9217 2.2224 63.9217C2.52615 63.9217 2.82991 63.8054 3.06129 63.574L51.7097 14.9256C52.1737 14.4628 52.1737 13.7117 51.7097 13.2478Z","fill","white"],["id","Vector_2","d","M16.9605 42.9635L26.1159 33.8081L21.3365 29.0287C18.91 26.6022 18.6869 24.3679 20.5878 21.5629C20.8535 21.1951 22.5444 19.6941 23.992 18.4839C24.9151 17.9333 25.5487 17.1181 25.8264 16.1155C26.1954 14.783 25.9225 13.2156 25.0516 11.6885C24.8463 11.3373 19.9625 3.06229 15.4583 0.680892C14.6171 0.235937 13.6714 0.0010004 12.721 0.0010004C11.1571 0.0010004 9.68576 0.610886 8.58109 1.71556L5.57082 4.72702C-3.21082 13.5098 -1.58525 24.419 10.2719 36.2749L16.9605 42.9635Z","fill","white"],["id","Vector_3","d","M63.313 48.5357C60.9304 44.0328 52.6566 39.1478 52.2923 38.9342C51.2304 38.329 50.1209 38.0099 49.0839 38.0099C47.5402 38.0099 46.2753 38.717 45.51 40.0033C44.2986 41.452 42.7964 43.1429 42.4345 43.4051C39.6129 45.3154 37.4071 45.1007 34.9652 42.6588L31.148 38.8416L21.9926 47.997L27.7189 53.7233C34.5356 60.5412 41.0367 63.9976 47.0371 63.9976C47.0383 63.9976 47.0383 63.9976 47.0383 63.9976C51.4534 63.9976 55.5672 62.1217 59.2669 58.4232L62.2771 55.413C64.1068 53.5845 64.5233 50.821 63.313 48.5357Z","fill","white"],["id","fullscreen",1,"controls__icon"],["id","Vector","d","M57.8018 53.4382L44.3964 40.0328L40.0328 44.3964L53.4382 57.8018H43.0205V64H64V43.0205H57.8018V53.4382Z","fill","white"],["id","Vector_2","d","M44.3964 23.9803L57.8018 10.5618V20.9795H64V0H43.0205V6.1982H53.4382L40.0328 19.6036L44.3964 23.9803Z","fill","white"],["id","Vector_3","d","M19.6036 40.0328L6.1982 53.4382V43.0205H0V64H20.9795V57.8018H10.5618L23.9803 44.3964L19.6036 40.0328Z","fill","white"],["id","Vector_4","d","M20.9795 6.1982V0H0V20.9795H6.1982V10.5618L19.6036 23.9803L23.9803 19.6036L10.5618 6.1982H20.9795Z","fill","white"],["id","exit-full-screen",1,"controls__icon"],["id","fullscreen_x5F_exit"],["id","Vector","d","M49.172 54.828L58.344 64L64 58.344L54.828 49.172L64 40H40V64L49.172 54.828Z","fill","white"],["id","Vector_2","d","M0 24H24V0L14.828 9.172L5.75 0.086L0.094 5.742L9.172 14.828L0 24Z","fill","white"],["id","Vector_3","d","M0 58.344L5.656 64L14.828 54.828L24 64V40H0L9.172 49.172L0 58.344Z","fill","white"],["id","Vector_4","d","M40 24H64L54.828 14.828L63.922 5.742L58.266 0.086L49.172 9.172L40 0V24Z","fill","white"],[1,"controls__button","controls__button--rotate",3,"click"],["filter","url(#filter0_d_0_4)"],["d","M-4.81762e-07 34.7678V57.0215C-4.81762e-07 60.8696 3.13284 64 6.98275 64H57.016C60.8672 64 64 60.8696 64 57.0215V7.05508C64 3.20697 60.8672 0.0757321 57.016 0.0757321H34.6959C35.8972 1.3077 36.6961 2.93443 36.871 4.74067H57.0168C58.2942 4.74067 59.3335 5.77899 59.3335 7.05508V57.0216C59.3335 58.2969 58.2942 59.3352 57.0168 59.3352H6.98342C5.7062 59.3352 4.66761 58.2969 4.66761 57.0216V36.9389C2.90982 36.7703 1.27948 36.0149 -4.81762e-07 34.7678ZM10.7807 30.6654H26.0384L1.34093 5.97437C-0.02533 4.60686 -0.02533 2.39174 1.34093 1.02583C2.70813 -0.341677 4.92462 -0.341677 6.29089 1.02423L30.9883 25.7159V10.4614C30.9883 8.52907 32.5556 6.96139 34.4888 6.96139C35.4553 6.96139 36.3305 7.35214 36.9642 7.98612C37.5976 8.62116 37.9897 9.49543 37.9897 10.4613V34.1643C37.9897 36.0966 36.4228 37.6635 34.4896 37.6635H10.7807C8.84705 37.6635 7.28056 36.0974 7.28056 34.1643C7.28056 32.2312 8.84705 30.6654 10.7807 30.6654Z","fill","white"],["id","filter0_d_0_4","x","-4","y","0","width","72","height","72","filterUnits","userSpaceOnUse","color-interpolation-filters","sRGB"],["flood-opacity","0","result","BackgroundImageFix"],["in","SourceAlpha","type","matrix","values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0","result","hardAlpha"],["dy","4"],["stdDeviation","2"],["in2","hardAlpha","operator","out"],["type","matrix","values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"],["mode","normal","in2","BackgroundImageFix","result","effect1_dropShadow_0_4"],["mode","normal","in","SourceGraphic","in2","effect1_dropShadow_0_4","result","shape"]],template:function(e,a){1&e&&(Ne(0,"div",0)(1,"div",1)(2,"button",2),tn("click",function(){return a.onToggleCamera()}),Ne(3,"div",3),Oo(),Ne(4,"svg",4)(5,"g",5)(6,"g",6)(7,"g",7),Tt(8,"path",8),Ge()()(),Ne(9,"g",9)(10,"g",6)(11,"g",7),Tt(12,"path",10),Ge()(),Ne(13,"g",11)(14,"g",12),Tt(15,"path",13),Ge()()()()(),Zo(),Ne(16,"p"),Ki(17,"Camera"),Ge()()(),Ne(18,"div",1)(19,"button",2),tn("click",function(){return a.onToggleMicrophone()}),Ne(20,"div",3),Oo(),Ne(21,"svg",4)(22,"g",14)(23,"g",15),Tt(24,"path",16)(25,"path",17),Ge()(),Ne(26,"g",18),Tt(27,"path",19),Ge()()(),Zo(),Ne(28,"p"),Ki(29,"Mic"),Ge()()(),en(30,a7,22,7,"div",20),en(31,c7,18,2,"div",20),Ne(32,"div",1)(33,"button",21),tn("click",function(){return a.onEndCall()}),Ne(34,"div",3),Oo(),Ne(35,"svg",4)(36,"g",22)(37,"g",6),Tt(38,"path",23)(39,"path",24)(40,"path",25),Ge()()()(),Zo(),Ne(41,"p"),Ki(42,"End"),Ge()()()()),2&e&&(Bt("controls--small",a.smallScreenEnabled),Ze(2),Bt("controls__button--active",a.cameraEnabled),Ze(3),Bt("controls__icon--shown",a.cameraEnabled),Ze(4),Bt("controls__icon--shown",!a.cameraEnabled),Ze(10),Bt("controls__button--active",a.microphoneEnabled),Ze(3),Bt("controls__icon--shown",a.microphoneEnabled),Ze(4),Bt("controls__icon--shown",!a.microphoneEnabled),Ze(4),nt("ngIf",!a.smallScreenEnabled),Ze(1),nt("ngIf",a.displaySmallScreen))},dependencies:[hc],styles:["[_nghost-%COMP%]{transition:.3s}.controls[_ngcontent-%COMP%]{background:rgba(0,0,0,.3);bottom:0;display:flex;justify-content:center;padding:15px 0;position:absolute;left:0;width:100%}.controls--small[_ngcontent-%COMP%]{border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding:5px 0}.controls--small[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{height:32px;width:32px}.controls--small[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:16px;width:16px}.controls--small[_ngcontent-%COMP%]   .controls__item[_ngcontent-%COMP%]{margin:0}.controls--small[_ngcontent-%COMP%]   .controls__button[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:none}.controls__item[_ngcontent-%COMP%]{margin:0 5px;text-align:center}.controls__button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer}.controls__button[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#101316}.controls__button--active[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#0b73c9}.controls__button--active[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#158ef2}.controls__button--active.controls__button--rotate[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{transform:translate(-50%,-50%) rotate(-180deg)}.controls__button--danger[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#d73b3d}.controls__button--danger[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#e06567}.controls__button[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;margin:8px 0 0}.controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#313a42;border-radius:50%;box-shadow:0 3px 8px #00000080;margin:auto;position:relative;height:60px;width:60px;transition:.3s}.controls__icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%) rotate(0);height:32px;width:32px;transition:.3s}.controls__icon[_ngcontent-%COMP%]{opacity:0;transition:.3s}.controls__icon--shown[_ngcontent-%COMP%]{opacity:1}"],changeDetection:0}),i})(),S7=(()=>{class i{constructor(){this.error=!1,this.connected=!0,this.ended=!1,this.small=!1}get color(){return this.ended?"#aaa":this.error?"#d73b3d":this.connected?"#37D425":"#1195E6"}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=_r({type:i,selectors:[["ngx-spinner"]],inputs:{text:"text",error:"error",connected:"connected",ended:"ended",small:"small"},decls:8,vars:9,consts:[[1,"spinner",3,"ngClass"],[1,"spinner__wrapper"],[1,"spinner__icon"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 32 32","fill","none"],["d","M5.25 5.5C3.45507 5.5 2 6.95508 2 8.75V19.25C2 21.0449 3.45507 22.5 5.25 22.5H14.75C16.5449 22.5 18 21.0449 18 19.25V8.75C18 6.95507 16.5449 5.5 14.75 5.5H5.25Z"],["d","M23.1232 20.6431L19.5 17.0935V10.9989L23.1121 7.3706C23.8988 6.58044 25.248 7.13753 25.248 8.25251V19.7502C25.248 20.8577 23.9143 21.4181 23.1232 20.6431Z"],[1,"spinner__cirle"],["class","spinner__text",4,"ngIf"],[1,"spinner__text"]],template:function(e,a){1&e&&(Ne(0,"div",0)(1,"div",1)(2,"div",2),Oo(),Ne(3,"svg",3),Tt(4,"path",4)(5,"path",5),Ge()(),Zo(),Tt(6,"div",6),en(7,l7,2,1,"div",7),Ge()()),2&e&&(nt("ngClass",rr(4,d7,a.connected,a.ended,a.small,a.error)),Ze(4),zi("fill",a.color),Ze(1),zi("fill",a.color),Ze(2),nt("ngIf",!a.small))},dependencies:[TE,hc],styles:[".spinner[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;position:relative;transition:.3s}.spinner--connected[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:#37d425}.spinner--ended[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:transparent}.spinner--error[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:#d73b3d}.spinner--small[_ngcontent-%COMP%]{border-radius:10px;height:200px}.spinner--small[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-width:4px;height:80px;width:80px}.spinner--small[_ngcontent-%COMP%]   .spinner__icon[_ngcontent-%COMP%]{top:26px;transform:translate(-35%)}.spinner--small[_ngcontent-%COMP%]   .spinner__icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:32px;width:32px}.spinner__wrapper[_ngcontent-%COMP%]{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%)}.spinner__cirle[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 2s linear infinite;border:5px solid #1195E6;border-radius:50%;border-top-color:transparent;height:160px;margin:auto;width:160px;transition:.3s}.spinner__icon[_ngcontent-%COMP%]{left:50%;position:absolute;top:52px;transform:translate(-40%);transition:.3s}.spinner__icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:64px;width:64px;transition:.3s}.spinner__text[_ngcontent-%COMP%]{color:#fff;font-size:1.3em;margin-top:25px;text-align:center}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"],changeDetection:0}),i})(),C7=(()=>{class i{constructor(){this.started=Date.now()}ngOnInit(){this.time$=y3(0,1e3).pipe(At(()=>this.format(Date.now()-this.started)))}format(e){const a=Math.floor(e/1e3%60).toString().padStart(2,"0"),l=Math.floor(e/6e4%60).toString().padStart(2,"0");return[Math.floor(e/36e5%24).toString().padStart(2,"0"),l,a].join(":")}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=_r({type:i,selectors:[["ngx-timer"]],inputs:{started:"started"},decls:4,vars:3,consts:[[1,"timer"]],template:function(e,a){1&e&&(Ne(0,"div",0)(1,"span"),Ki(2),gf(3,"async"),Ge()()),2&e&&(Ze(2),dd(dh(3,1,a.time$)))},dependencies:[Nh],styles:[".timer[_ngcontent-%COMP%]{color:#fff;position:relative;text-align:center;z-index:1}.timer[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:rgba(0,0,0,.3);border-radius:5px;padding:5px 10px}"],changeDetection:0}),i})(),T7=(()=>{class i extends O4{constructor(e){super(e),this.fullScreen=!1}ngOnInit(){this.play(`assets/${this.data.outcome?"outcome":"income"}.mp3`)}ngOnDestroy(){this.stop()}onAcceptCall(){this.fullScreen=!0,this.cdr.markForCheck(),this.afterClosed.next(this.data)}onDeclineCall(){this.play("assets/cancel.mp3"),setTimeout(()=>this.closeDialog(null),200)}play(e,a=!0){this.audio&&this.stop(),this.audio=new Audio(e),this.audio.loop=a,this.audio.load(),this.audio.play()}stop(){this.audio.pause(),this.audio.remove()}}return i.\u0275fac=function(e){return new(e||i)(ie(te))},i.\u0275cmp=_r({type:i,selectors:[["ngx-video-call"]],inputs:{data:"data"},features:[Ot],decls:1,vars:1,consts:[["class","video-call",3,"video-call--full-screen",4,"ngIf"],[1,"video-call"],[1,"video-call-user"],[1,"video-call-user__block","video-call-user__block--animated"],["alt","",1,"video-call-user__img",3,"src"],[1,"video-call-user__title"],[4,"ngIf","ngIfElse"],["income",""],[1,"video-call__actions"],[4,"ngIf"],["aria-label","Decline",1,"video-call__button","video-call__button--decline",3,"click"],["aria-label","Accept",1,"video-call__button","video-call__button--accept",3,"click"]],template:function(e,a){1&e&&en(0,f7,12,7,"div",0),2&e&&nt("ngIf",a.shown&&a.data)},dependencies:[hc],styles:['[_nghost-%COMP%]{display:block;height:100vh;position:relative}.video-call[_ngcontent-%COMP%]{background-image:linear-gradient(#3F51B5,#313A42);background-size:cover;border-radius:10px;box-shadow:0 5px 10px #0000001a;display:flex;flex-direction:column;height:100%;justify-content:flex-end;left:50%;max-height:400px;max-width:400px;position:absolute;top:50%;transform:translate(-50%,-50%);width:100%;z-index:5;transition:.3s}.video-call--full-screen[_ngcontent-%COMP%]{background-image:linear-gradient(#22292F);border-radius:0;max-height:100%;max-width:100%}.video-call-user[_ngcontent-%COMP%]{left:50%;position:absolute;text-align:center;top:50%;transform:translate(-50%,-55%);z-index:1}.video-call-user__block[_ngcontent-%COMP%]{background:#fff;border-radius:50%;border:solid 5px #fff;height:180px;margin:0 auto;transform:scale(1);width:180px}.video-call-user__block--animated[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_play 2s ease infinite;backface-visibility:hidden}.video-call-user__img[_ngcontent-%COMP%]{border-radius:50%;height:100%;left:0;object-fit:cover;position:absolute;top:0;width:100%}.video-call-user__title[_ngcontent-%COMP%]{color:#fff;font-size:1.2em;font-weight:700;margin:15px 0 0}.video-call__actions[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:10px 0}.video-call__button[_ngcontent-%COMP%]{border-radius:50%;box-shadow:0 0 #3f51b500,0 .05em .1em #0003;border:0;cursor:pointer;display:block;font-size:40px;height:1em;margin:0 5px;position:relative;transform:translateZ(0) scale(1);width:1em;transition:.3s}.video-call__button[_ngcontent-%COMP%]:before, .video-call__button[_ngcontent-%COMP%]:after{content:"";position:absolute}.video-call__button[_ngcontent-%COMP%]:before{background-color:#ffffff1a;border-radius:50%;height:1em;left:0;opacity:1;top:0;transform:translateZ(0) scale(0);width:1em}.video-call__button[_ngcontent-%COMP%]:after{background-position:50% 50%;background-repeat:no-repeat;background-size:cover;background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTYuNiAxMC44YzEuNCAyLjggMy44IDUuMSA2LjYgNi42bDIuMi0yLjJjLjMtLjMuNy0uNCAxLS4yIDEuMS40IDIuMy42IDMuNi42LjUgMCAxIC40IDEgMVYyMGMwIC41LS41IDEtMSAxLTkuNCAwLTE3LTcuNi0xNy0xNyAwLS42LjQtMSAxLTFoMy41Yy41IDAgMSAuNCAxIDEgMCAxLjIuMiAyLjUuNiAzLjYuMS40IDAgLjctLjIgMWwtMi4zIDIuMnoiIGZpbGw9IiNmZmZmZmYiLz48L3N2Zz4=);height:.5em;left:.25em;top:.25em;transform:translateZ(0);width:.5em;transition:.3s}.video-call__button--accept[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_phone-outer 3s infinite;background-color:#3f51b5}.video-call__button--accept[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_phone-inner 3s infinite}.video-call__button--accept[_ngcontent-%COMP%]:after{animation:_ngcontent-%COMP%_phone-icon 3s infinite}.video-call__button--decline[_ngcontent-%COMP%]{background-color:#d73b3d}.video-call__button--decline[_ngcontent-%COMP%]:hover{background-color:#ce2a2c}.video-call__button--decline[_ngcontent-%COMP%]:after{top:.28em;transform:translateZ(0) rotate(135deg)}@keyframes _ngcontent-%COMP%_play{0%{transform:scale(1)}15%{box-shadow:0 0 0 5px #9b9da466}25%{box-shadow:0 0 0 10px #9b9da466,0 0 0 20px #9b9da433}25%{box-shadow:0 0 0 15px #9b9da466,0 0 0 30px #9b9da433}}@keyframes _ngcontent-%COMP%_phone-outer{0%{box-shadow:0 0 #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}33.3333%{box-shadow:0 0 #3f51b51a,0 .05em .1em #00000080;transform:translateZ(0) scale(1.1)}66.6666%{box-shadow:0 0 0 .5em #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}to{box-shadow:0 0 #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}}@keyframes _ngcontent-%COMP%_phone-inner{0%{opacity:1;transform:translateZ(0) scale(0)}33.3333%{opacity:1;transform:translateZ(0) scale(.9)}66.6666%{opacity:0;transform:translateZ(0) scale(0)}to{opacity:0;transform:translateZ(0) scale(0)}}@keyframes _ngcontent-%COMP%_phone-icon{0%{transform:translateZ(0)}2%{transform:translate3d(.01em,0,0)}4%{transform:translate3d(-.01em,0,0)}6%{transform:translate3d(.01em,0,0)}8%{transform:translate3d(-.01em,0,0)}10%{transform:translate3d(.01em,0,0)}12%{transform:translate3d(-.01em,0,0)}14%{transform:translate3d(.01em,0,0)}16%{transform:translate3d(-.01em,0,0)}18%{transform:translate3d(.01em,0,0)}20%{transform:translate3d(-.01em,0,0)}22%{transform:translate3d(.01em,0,0)}24%{transform:translate3d(-.01em,0,0)}26%{transform:translate3d(.01em,0,0)}28%{transform:translate3d(-.01em,0,0)}30%{transform:translate3d(.01em,0,0)}32%{transform:translate3d(-.01em,0,0)}34%{transform:translate3d(.01em,0,0)}36%{transform:translate3d(-.01em,0,0)}38%{transform:translate3d(.01em,0,0)}40%{transform:translate3d(-.01em,0,0)}42%{transform:translate3d(.01em,0,0)}44%{transform:translate3d(-.01em,0,0)}46%{transform:translateZ(0)}}'],data:{animation:[D4]},changeDetection:0}),i})(),w7=(()=>{class i{constructor(e,a,l,u){this.document=e,this.componentFactoryResolver=a,this.appRef=l,this.injector=u,this.wrapperSelector="ngx-webrtc-wrapper"}open(e,a={}){return this.appendComponent(e,a)}appendComponent(e,a){const l=this.componentFactoryResolver.resolveComponentFactory(e).create(this.injector),{instance:u}=l;Object.keys(a).forEach(E=>u[E]=a[E]),this.appRef.attachView(l.hostView);const f=l.hostView.rootNodes[0];return this.getContainer().append(f),u.afterClosed.pipe(Qr(1),function i7(i,t=Dv){const a=function n7(i){return i instanceof Date&&!isNaN(+i)}(i)?+i-t.now():Math.abs(i);return l=>l.lift(new r7(a,t))}(250)).subscribe(()=>{this.appRef.detachView(l.hostView),l.destroy()}),u}getContainer(){let e=this.document.querySelector(`.${this.wrapperSelector}`);return e||(e=this.document.createElement("div"),e.setAttribute("class",this.wrapperSelector),e.setAttribute("style","position: fixed; top: 0; width: 100%; z-index: 1;"),this.document.body.appendChild(e)),e}}return i.\u0275fac=function(e){return new(e||i)(pe(Zt),pe(Wl),pe(Yc),pe(No))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const N4={connected:!1,loading:!0,statusText:"Initializing",started:null,ended:!1,error:!1},I7={mode:"rtc",codec:"h264"};let P4=(()=>{class i{constructor(e){this.config=e,this.agoraRTC=s7,this.streamState=new Xr(N4),this.remoteStreamVideoToggle=new Xr(!0),this.callEnd=new Xt,this.localContainerId="local-video",this.remoteCalls=[],this.remoteStreamVideoToggle$=this.remoteStreamVideoToggle.asObservable(),this.streamState$=this.streamState.asObservable(),this.agoraRTC.checkSystemRequirements()||this.handleError(new Error("Web RTC is not supported in this browser"))}init(e,a,l=!1){return this.uid=e,this.agoraRTC.setLogLevel(l?0:4),this.client=this.agoraRTC.createClient(I7),this.assignClientHandlers(),this.initLocalStream().then(()=>{this.client.join(this.config.AppID,a,null,this.uid).then(()=>{this.localTracks.videoTrack.play(this.localContainerId),this.client.publish(Object.values(this.localTracks)),this.streamState.next({...this.streamState.value,connected:!0,statusText:"Waiting others to join"})})}),this.callEnd.asObservable()}deinit(){this.streamState.next(N4)}endCall(){this.client.leave().then(()=>{Object.values(this.localTracks).forEach(e=>{e.stop(),e.close()}),this.streamState.next({...this.streamState.value,started:null,loading:!0,statusText:"",ended:!0}),this.remoteCalls=[],hF(500).pipe(Qr(1)).subscribe(()=>this.callEnd.next())})}toggleVideo(e){this.localTracks&&this.localTracks.videoTrack.setMuted(e)}toggleAudio(e){this.localTracks&&this.localTracks.audioTrack.setMuted(e)}toggleFullScreen(e){e?document.exitFullscreen():document.documentElement.requestFullscreen()}isVideoEnabled(){return!!this.localTracks&&!this.localTracks.videoTrack.muted}isAudioEnabled(){return!!this.localTracks&&!this.localTracks.audioTrack.muted}assignClientHandlers(){this.client.on("user-joined",e=>{this.streamState.next({...this.streamState.value,started:Date.now(),loading:!1}),this.remoteCalls.length||this.remoteCalls.push(this.getRemoteId(e))}),this.client.on("user-published",(e,a)=>{const l=this.getRemoteId(e);this.client.subscribe(e,a).then(u=>{this.remoteCalls.includes(l)&&u.play(l)})}),this.client.on("user-info-updated",(e,a)=>{"mute-video"===a&&this.remoteStreamVideoToggle.next(!1),"unmute-video"===a&&this.remoteStreamVideoToggle.next(!0)}),this.client.on("user-left",()=>{this.endCall()})}initLocalStream(){return Promise.all([this.agoraRTC.createCameraVideoTrack(),this.agoraRTC.createMicrophoneAudioTrack()]).then(([e,a])=>{this.localTracks={audioTrack:a,videoTrack:e}}).catch(e=>{this.handleError(e)})}getRemoteId(e){return`remote_call-${e.uid}`}handleError(e){throw this.streamState.next({...this.streamState.value,statusText:e.message,error:!0}),hF(5e3).pipe(Qr(1)).subscribe(()=>this.callEnd.next()),new Error(e.message)}}return i.\u0275fac=function(e){return new(e||i)(pe("AgoraConfig"))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),R7=(()=>{class i{onEnter(){this.subscription.unsubscribe(),this.setStyle(1)}onLeave(){this.hide()}constructor(e,a){this.renderer=e,this.el=a,this.subscription=new mn,this.delay=5e3}ngOnInit(){this.hide()}hide(){this.subscription.unsubscribe(),this.subscription=hF(this.delay).pipe(Qr(1)).subscribe(()=>this.setStyle(0))}setStyle(e){this.renderer.setStyle(this.el.nativeElement,"opacity",e)}}return i.\u0275fac=function(e){return new(e||i)(ie(pa),ie(cn))},i.\u0275dir=je({type:i,selectors:[["","ngxToggle",""]],hostBindings:function(e,a){1&e&&tn("mouseenter",function(){return a.onEnter()})("mouseleave",function(){return a.onLeave()})}}),i})(),M4=(()=>{class i extends O4{constructor(e,a){super(a),this.webRtcService=e,this.animate=!0,this.displaySmallScreen=!1,this.debug=!1,this.callEnd=new rn,this.smallScreenEnabled=!1,this.active=!1,this.streamState$=this.webRtcService.streamState$,this.remoteStreamVideoToggle$=this.webRtcService.remoteStreamVideoToggle$}ngOnInit(){this.webRtcService.init(this.uid,this.channel,this.debug).pipe(Qr(1)).subscribe(()=>{this.active=this.smallScreenEnabled,this.callEnd.emit(),this.closeDialog(!0)})}ngOnDestroy(){this.webRtcService.deinit()}get localContainerId(){return this.webRtcService.localContainerId}get remoteCalls(){return this.webRtcService.remoteCalls}get cameraEnabled(){return this.webRtcService.isVideoEnabled()}get microphoneEnabled(){return this.webRtcService.isAudioEnabled()}get fullScreenEnabled(){return!!document.fullscreenElement}onToggleCamera(e){this.webRtcService.toggleVideo(e)}onToggleMicrophone(e){this.webRtcService.toggleAudio(e)}onToggleFullScreen(e){this.webRtcService.toggleFullScreen(e)}onToggleSmallScreen(e){this.smallScreenEnabled=!e,this.active=!0}onEndCall(){this.webRtcService.endCall()}}return i.\u0275fac=function(e){return new(e||i)(ie(P4),ie(te))},i.\u0275cmp=_r({type:i,selectors:[["ngx-webrtc"]],hostVars:4,hostBindings:function(e,a){2&e&&Bt("small-screen",a.smallScreenEnabled)("active",a.active)},inputs:{uid:"uid",channel:"channel",animate:"animate",displaySmallScreen:"displaySmallScreen",debug:"debug"},outputs:{callEnd:"callEnd"},features:[Ot],decls:1,vars:1,consts:[[4,"ngIf"],["class","container",4,"ngIf"],[1,"container"],[3,"error","text","connected","ended","small",4,"ngIf"],[3,"started",4,"ngIf"],[1,"container__local",3,"id"],["class","container__remote",3,"id","hidden",4,"ngFor","ngForOf"],[1,"container__user-icon"],["viewBox","0 0 64 64","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","user","clip-path","url(#clip0)"],["id","Vector","d","M31.5439 30.829C35.7793 30.829 39.4468 29.3099 42.4434 26.3129C45.4399 23.3163 46.959 19.6498 46.959 15.414C46.959 11.1796 45.4399 7.51267 42.4429 4.51512C39.4458 1.51904 35.7788 0 31.5439 0C27.3081 0 23.6416 1.51904 20.645 4.51561C17.6484 7.51218 16.1289 11.1792 16.1289 15.414C16.1289 19.6498 17.6484 23.3168 20.6455 26.3134C23.6426 29.3095 27.3096 30.829 31.5439 30.829V30.829Z","fill","#0B73C9"],["id","Vector_2","d","M58.5161 49.2127C58.4297 47.9656 58.2549 46.6053 57.9976 45.1688C57.7378 43.7215 57.4033 42.3533 57.0029 41.1029C56.5894 39.8104 56.0269 38.534 55.3315 37.3109C54.6099 36.0414 53.7622 34.9359 52.811 34.0262C51.8164 33.0746 50.5986 32.3094 49.1904 31.7513C47.7871 31.1962 46.2319 30.9149 44.5684 30.9149C43.915 30.9149 43.2832 31.183 42.063 31.9774C41.312 32.4672 40.4336 33.0336 39.4531 33.66C38.6147 34.1942 37.479 34.6947 36.0762 35.1478C34.7075 35.5907 33.3179 35.8153 31.9463 35.8153C30.5747 35.8153 29.1855 35.5907 27.8154 35.1478C26.4141 34.6952 25.2783 34.1947 24.4409 33.6605C23.4697 33.0399 22.5908 32.4735 21.8286 31.9769C20.6099 31.1825 19.9775 30.9144 19.3242 30.9144C17.6602 30.9144 16.1055 31.1962 14.7026 31.7518C13.2954 32.309 12.0771 33.0741 11.0815 34.0267C10.1309 34.9369 9.28271 36.0419 8.56201 37.3109C7.86719 38.534 7.30469 39.8099 6.89062 41.1034C6.49072 42.3538 6.15625 43.7215 5.89648 45.1688C5.63916 46.6033 5.46436 47.9642 5.37793 49.2142C5.29297 50.4388 5.25 51.7098 5.25 52.9934C5.25 56.3343 6.31201 59.0388 8.40625 61.0335C10.4746 63.0017 13.2114 64.0002 16.5396 64.0002H47.356C50.6841 64.0002 53.4199 63.0022 55.4888 61.0335C57.5835 59.0403 58.6455 56.3352 58.6455 52.993C58.645 51.7034 58.6016 50.4314 58.5161 49.2127V49.2127Z","fill","#0B73C9"],["id","clip0"],["width","64","height","64","fill","#0B73C9"],["ngxToggle","",3,"cameraEnabled","microphoneEnabled","fullScreenEnabled","smallScreenEnabled","displaySmallScreen","toggleCamera","toggleMicrophone","toggleFullScreen","toggleSmallScreen","endCall",4,"ngIf"],[3,"error","text","connected","ended","small"],[3,"started"],[1,"container__remote",3,"id"],["ngxToggle","",3,"cameraEnabled","microphoneEnabled","fullScreenEnabled","smallScreenEnabled","displaySmallScreen","toggleCamera","toggleMicrophone","toggleFullScreen","toggleSmallScreen","endCall"]],template:function(e,a){1&e&&en(0,y7,3,5,"div",0),2&e&&nt("ngIf",a.shown)},dependencies:[jf,hc,b7,C7,S7,R7,Nh],styles:["ngx-timer[_ngcontent-%COMP%]{display:block;padding-top:25px}[_nghost-%COMP%]{bottom:0;max-width:100%;right:0;width:100%;transition:.3s}.active[_nghost-%COMP%]{position:fixed}.small-screen[_nghost-%COMP%]{max-width:210px}.small-screen[_nghost-%COMP%]   ngx-timer[_ngcontent-%COMP%]{padding-top:10px}.small-screen[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{border-radius:10px;box-shadow:#00000059 0 5px 15px;height:200px;max-width:200px;margin-right:10px;margin-bottom:10px}.small-screen[_nghost-%COMP%]   .container__remote[_ngcontent-%COMP%]{border-radius:10px;height:200px;width:200px}.small-screen[_nghost-%COMP%]   .container__remote[_ngcontent-%COMP%]    >div{border-radius:10px}.small-screen[_nghost-%COMP%]   .container__user-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:32px;width:32px}.container[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;max-width:100%;margin-left:auto;overflow:hidden;position:relative;transition:.3s}.container__local[_ngcontent-%COMP%]{border-radius:5px;height:20vh;opacity:1;overflow:hidden;position:absolute;right:1rem;top:1rem;width:20vw;z-index:1;transition:.3s}.container__local.hidden[_ngcontent-%COMP%]{opacity:0;visibility:hidden}.container__local[_ngcontent-%COMP%]:not(:empty){box-shadow:0 3px 8px #00000080}.container__remote[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;left:0;position:absolute;top:0;width:100vw;transition:.3s}.container__remote[_ngcontent-%COMP%]    >div{transition:.3s}.container__remote.hidden[_ngcontent-%COMP%]{display:none}.container__remote.hidden[_ngcontent-%COMP%] + .container__user-icon[_ngcontent-%COMP%]{display:block}.container__remote[_ngcontent-%COMP%]:empty{display:none}.container__user-icon[_ngcontent-%COMP%]{background:rgba(0,0,0,.3);border-radius:50%;box-shadow:0 3px 8px #00000080;display:none;left:50%;padding:20px;position:absolute;top:50%;transform:translate(-50%,-50%)}.container__user-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:64px;width:64px}@media screen and (max-width: 769px){ngx-controls[_ngcontent-%COMP%]{opacity:1!important}}"],data:{animation:[D4]},changeDetection:0}),i})(),A7=(()=>{class i{constructor(e){this.dialog=e}open(e){const a=new Xt,l=this.dialog.open(T7,{data:e});return l.afterClosed.asObservable().pipe(Ua(u=>u?.channel?this.dialog.open(M4,{uid:u.uid,channel:u.channel,debug:!!u.debug,displaySmallScreen:!0}).afterClosed.asObservable():ze(!1)),Qr(1),Nr(()=>a.next(!0))).subscribe(),{acceptCall:l.onAcceptCall.bind(l),close:l.closeDialog.bind(l),afterConfirmation:()=>l.afterClosed.asObservable().pipe(Qr(1)),afterCallEnd:()=>a.asObservable().pipe(Qr(1))}}}return i.\u0275fac=function(e){return new(e||i)(pe(w7))},i.\u0275prov=Oe({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),D7=(()=>{class i{static forRoot(e){return{ngModule:i,providers:[P4,{provide:"AgoraConfig",useValue:e}]}}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=Un({type:i}),i.\u0275inj=xn({imports:[Kf]}),i})();const O7=[{path:"",component:(()=>{class i{constructor(e,a,l,u,f){this.formBuilder=e,this.router=a,this.localStorage=l,this.videoCallDialogService=u,this.cdr=f,this.sessionKey="ngx-webrtc:channelId",this.outcome=!1}get channelId(){return this.localStorage.getItem(this.sessionKey)||"test-channel-ngx-webrtc"}get tooltipText(){return this.outcome?"Outcome":"Income"}ngOnInit(){this.form=this.formBuilder.group({channelId:[this.channelId,DO.required]})}onSubmit(){this.saveChannel(),this.router.navigate(["conference"],{queryParams:{...this.form.value}})}onModalOpen(){this.saveChannel(),this.dialog=this.videoCallDialogService.open({uid:String(Math.floor(100*Math.random())),channel:this.channelId,outcome:this.outcome,user:{name:"Test User",photoURL:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTvDtoEwuV9E2kHqNDi6MnBzXlefn8TfyrwgQ&usqp=CAU"},debug:!0});const e=setTimeout(()=>this.dialog?.close(),7e3);this.dialog.afterConfirmation().pipe(vc(a=>!!a),Nr(()=>clearTimeout(e))).subscribe(),this.dialog.afterCallEnd().subscribe(()=>{clearTimeout(e),this.dialog=null,this.cdr.markForCheck()})}saveChannel(){const{channelId:e}=this.form.value;this.localStorage.setItem(this.sessionKey,e)}static#e=this.\u0275fac=function(a){return new(a||i)(ie(CT),ie(zo),ie(Storage),ie(A7),ie(te))};static#t=this.\u0275cmp=_r({type:i,selectors:[["app-home"]],decls:25,vars:8,consts:[[1,"home"],[1,"home__welcome"],[1,"home__form",3,"formGroup","ngSubmit"],[1,"home__wrapper","home__wrapper--center"],["src","assets/user.svg","alt","User",1,"user"],[1,"home__title"],["appearance","outline",1,"home__wrapper"],["matInput","","placeholder","Channel id","formControlName","channelId"],[1,"home__wrapper","home__wrapper--center","home__wrapper--buttons"],["mat-flat-button","","color","primary",1,"home__btn",3,"disabled"],["mat-raised-button","","type","button",1,"home__btn",3,"disabled","click"],[3,"checked","disabled","matTooltip","change","click"],[1,"home__footer"],["href","https://www.npmjs.com/package/ngx-webrtc-lib","target","_blank"],["viewBox","0 0 27.23 27.23"],["width","27.23","height","27.23","rx","2"],["fill","#fff","points","5.8 21.75 13.66 21.75 13.67 9.98 17.59 9.98 17.58 21.76 21.51 21.76 21.52 6.06 5.82 6.04 5.8 21.75"],["href","https://github.com/TarasMoskovych/ngx-webrtc","target","_blank"],["aria-hidden","true","role","img","viewBox","0 0 16 16","width","50","height","50",1,""],["fill-rule","evenodd","d","M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"]],template:function(a,l){1&a&&(Ne(0,"div",0)(1,"div",1)(2,"form",2),tn("ngSubmit",function(){return!l.dialog&&l.onSubmit()}),Ne(3,"div",3),Tt(4,"img",4),Ge(),Ne(5,"h1",5),Ki(6," Welcome "),Ge(),Ne(7,"mat-form-field",6)(8,"mat-label"),Ki(9,"Channel Id"),Ge(),Tt(10,"input",7),Ge(),Ne(11,"div",8)(12,"button",9),Ki(13,"Start / Join call"),Ge(),Ne(14,"button",10),tn("click",function(){return!l.dialog&&l.onModalOpen()}),Ki(15,"Open Call Dialog "),Ne(16,"mat-slide-toggle",11),tn("change",function(f){return l.outcome=f.checked})("click",function(f){return f.stopPropagation()}),Ge()()()(),Ne(17,"div",12)(18,"a",13),Oo(),Ne(19,"svg",14),Tt(20,"rect",15)(21,"polygon",16),Ge()(),Zo(),Ne(22,"a",17),Oo(),Ne(23,"svg",18),Tt(24,"path",19),Ge()()()()()),2&a&&(Ze(2),nt("formGroup",l.form),Ze(5),Bt("mat-focused",l.form.valid),Ze(5),nt("disabled",l.form.invalid||!!l.dialog),Ze(2),nt("disabled",l.form.invalid||!!l.dialog),Ze(2),nt("checked",l.outcome)("disabled",!!l.dialog)("matTooltip",l.tooltipText))},dependencies:[Qn,Ss,ov,iT,qh,bv,j5,L5,n2,Xj,s8,m3],styles:[".home[_ngcontent-%COMP%]{align-items:center;background-color:#f2f2f2;display:flex;flex-wrap:wrap;justify-content:center;min-height:100vh;width:100%}.home__welcome[_ngcontent-%COMP%]{background:#fff;border-radius:10px;box-shadow:0 5px 10px #0000001a;overflow:hidden;padding:10px 35px;width:390px}.home__welcome[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]{height:150px}.home__title[_ngcontent-%COMP%]{color:#333;display:block;font-size:30px;font-weight:500;margin:10px 0 60px;text-align:center}.home__wrapper[_ngcontent-%COMP%]{width:100%}.home__wrapper--center[_ngcontent-%COMP%]{text-align:center}.home__wrapper--buttons[_ngcontent-%COMP%]{align-items:center;display:flex}.home__btn[_ngcontent-%COMP%]{letter-spacing:normal}.home__btn[_ngcontent-%COMP%]:first-of-type{margin-right:5px}.home__btn[_ngcontent-%COMP%]:last-of-type{margin-left:5px}.home__footer[_ngcontent-%COMP%]{margin-top:30px;text-align:center}.home__footer[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{fill:#333;cursor:pointer;height:24px;margin:0 5px;width:24px;transition:.3s}.home__footer[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]:hover{fill:#aaa}"],changeDetection:0})}return i})()},{path:"conference",component:(()=>{class i{constructor(e,a){this.route=e,this.router=a,this.uid=String(Math.floor(100*Math.random()))}ngOnInit(){this.channel=this.route.snapshot.queryParams.channelId||"test-channel"}onCallEnd(){this.router.navigateByUrl("/")}static#e=this.\u0275fac=function(a){return new(a||i)(ie(Mm),ie(zo))};static#t=this.\u0275cmp=_r({type:i,selectors:[["app-conference"]],decls:1,vars:4,consts:[[3,"animate","channel","debug","uid","callEnd"]],template:function(a,l){1&a&&(Ne(0,"ngx-webrtc",0),tn("callEnd",function(){return l.onCallEnd()}),Ge()),2&a&&nt("animate",!1)("channel",l.channel)("debug",!0)("uid",l.uid)},dependencies:[M4],changeDetection:0})}return i})()},{path:"**",redirectTo:""}];let N7=(()=>{class i{static#e=this.\u0275fac=function(a){return new(a||i)};static#t=this.\u0275mod=Un({type:i,bootstrap:[e7]});static#n=this.\u0275inj=xn({providers:[{provide:Storage,useValue:window.localStorage}],imports:[oL,cG,D7.forRoot(A4_configs),nN,q9.forRoot(O7),H5,Qj,l8,Q5]})}return i})();QU().bootstrapModule(N7).catch(i=>console.error(i))},890:function(bc,Lm,Fm){var x=Fm(156).default;bc.exports=function(){"use strict";let Zi=!0,Ko=!0;function qo(o,n,r){const s=o.match(n);return s&&s.length>=r&&parseInt(s[r],10)}function lr(o,n,r){if(!o.RTCPeerConnection)return;const s=o.RTCPeerConnection.prototype,c=s.addEventListener;s.addEventListener=function(h,p){if(h!==n)return c.apply(this,arguments);const m=_=>{const g=r(_);g&&(p.handleEvent?p.handleEvent(g):p(g))};return this._eventMap=this._eventMap||{},this._eventMap[n]||(this._eventMap[n]=new Map),this._eventMap[n].set(p,m),c.apply(this,[h,m])};const d=s.removeEventListener;s.removeEventListener=function(h,p){if(h!==n||!this._eventMap||!this._eventMap[n])return d.apply(this,arguments);if(!this._eventMap[n].has(p))return d.apply(this,arguments);const m=this._eventMap[n].get(p);return this._eventMap[n].delete(p),0===this._eventMap[n].size&&delete this._eventMap[n],0===Object.keys(this._eventMap).length&&delete this._eventMap,d.apply(this,[h,m])},Object.defineProperty(s,"on"+n,{get(){return this["_on"+n]},set(h){this["_on"+n]&&(this.removeEventListener(n,this["_on"+n]),delete this["_on"+n]),h&&this.addEventListener(n,this["_on"+n]=h)},enumerable:!0,configurable:!0})}function ja(o){return"boolean"!=typeof o?new Error("Argument type: "+typeof o+". Please use a boolean."):(Zi=o,o?"adapter.js logging disabled":"adapter.js logging enabled")}function ru(o){return"boolean"!=typeof o?new Error("Argument type: "+typeof o+". Please use a boolean."):(Ko=!o,"adapter.js deprecation warnings "+(o?"disabled":"enabled"))}function Yo(){if("object"==typeof window){if(Zi)return;typeof console<"u"&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function mn(o,n){Ko&&console.warn(o+" is deprecated, please use "+n+" instead.")}function Wv(o){return"[object Object]"===Object.prototype.toString.call(o)}function cp(o){return Wv(o)?Object.keys(o).reduce(function(n,r){const s=Wv(o[r]),c=s?cp(o[r]):o[r],d=s&&!Object.keys(c).length;return void 0===c||d?n:Object.assign(n,{[r]:c})},{}):o}function a0(o,n,r){n&&!r.has(n.id)&&(r.set(n.id,n),Object.keys(n).forEach(s=>{s.endsWith("Id")?a0(o,o.get(n[s]),r):s.endsWith("Ids")&&n[s].forEach(c=>{a0(o,o.get(c),r)})}))}function En(o,n,r){const s=r?"outbound-rtp":"inbound-rtp",c=new Map;if(null===n)return c;const d=[];return o.forEach(h=>{"track"===h.type&&h.trackIdentifier===n.id&&d.push(h)}),d.forEach(h=>{o.forEach(p=>{p.type===s&&p.trackId===h.id&&a0(o,p,c)})}),c}const zv=Yo;function c0(o,n){const r=o&&o.navigator;if(!r.mediaDevices)return;const s=function(h){if("object"!=typeof h||h.mandatory||h.optional)return h;const p={};return Object.keys(h).forEach(m=>{if("require"===m||"advanced"===m||"mediaSource"===m)return;const _="object"==typeof h[m]?h[m]:{ideal:h[m]};void 0!==_.exact&&"number"==typeof _.exact&&(_.min=_.max=_.exact);const g=function(v,b){return v?v+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==_.ideal){p.optional=p.optional||[];let v={};"number"==typeof _.ideal?(v[g("min",m)]=_.ideal,p.optional.push(v),v={},v[g("max",m)]=_.ideal,p.optional.push(v)):(v[g("",m)]=_.ideal,p.optional.push(v))}void 0!==_.exact&&"number"!=typeof _.exact?(p.mandatory=p.mandatory||{},p.mandatory[g("",m)]=_.exact):["min","max"].forEach(v=>{void 0!==_[v]&&(p.mandatory=p.mandatory||{},p.mandatory[g(v,m)]=_[v])})}),h.advanced&&(p.optional=(p.optional||[]).concat(h.advanced)),p},c=function(h,p){if(n.version>=61)return p(h);if((h=JSON.parse(JSON.stringify(h)))&&"object"==typeof h.audio){const m=function(_,g,v){g in _&&!(v in _)&&(_[v]=_[g],delete _[g])};m((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),m(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=s(h.audio)}if(h&&"object"==typeof h.video){let m=h.video.facingMode;m=m&&("object"==typeof m?m:{ideal:m});const _=n.version<66;if(m&&("user"===m.exact||"environment"===m.exact||"user"===m.ideal||"environment"===m.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||_)){let g;if(delete h.video.facingMode,"environment"===m.exact||"environment"===m.ideal?g=["back","rear"]:"user"!==m.exact&&"user"!==m.ideal||(g=["front"]),g)return r.mediaDevices.enumerateDevices().then(v=>{let b=(v=v.filter(C=>"videoinput"===C.kind)).find(C=>g.some(N=>C.label.toLowerCase().includes(N)));return!b&&v.length&&g.includes("back")&&(b=v[v.length-1]),b&&(h.video.deviceId=m.exact?{exact:b.deviceId}:{ideal:b.deviceId}),h.video=s(h.video),zv("chrome: "+JSON.stringify(h)),p(h)})}h.video=s(h.video)}return zv("chrome: "+JSON.stringify(h)),p(h)},d=function(h){return n.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=function(h,p,m){c(h,_=>{r.webkitGetUserMedia(_,p,g=>{m&&m(d(g))})})}.bind(r),r.mediaDevices.getUserMedia){const h=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(p){return c(p,m=>h(m).then(_=>{if(m.audio&&!_.getAudioTracks().length||m.video&&!_.getVideoTracks().length)throw _.getTracks().forEach(g=>{g.stop()}),new DOMException("","NotFoundError");return _},_=>Promise.reject(d(_))))}}}function l0(o){o.MediaStream=o.MediaStream||o.webkitMediaStream}function ou(o){if("object"==typeof o&&o.RTCPeerConnection&&!("ontrack"in o.RTCPeerConnection.prototype)){Object.defineProperty(o.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const n=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",s=>{let c;c=o.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===s.track.id):{track:s.track};const d=new Event("track");d.track=s.track,d.receiver=c,d.transceiver={receiver:c},d.streams=[r.stream],this.dispatchEvent(d)}),r.stream.getTracks().forEach(s=>{let c;c=o.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===s.id):{track:s};const d=new Event("track");d.track=s,d.receiver=c,d.transceiver={receiver:c},d.streams=[r.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),n.apply(this,arguments)}}else lr(o,"track",n=>(n.transceiver||Object.defineProperty(n,"transceiver",{value:{receiver:n.receiver}}),n))}function lp(o){if("object"==typeof o&&o.RTCPeerConnection&&!("getSenders"in o.RTCPeerConnection.prototype)&&"createDTMFSender"in o.RTCPeerConnection.prototype){const n=function(c,d){return{track:d,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===d.kind?c.createDTMFSender(d):null),this._dtmf},_pc:c}};if(!o.RTCPeerConnection.prototype.getSenders){o.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addTrack=function(h,p){let m=c.apply(this,arguments);return m||(m=n(this,h),this._senders.push(m)),m};const d=o.RTCPeerConnection.prototype.removeTrack;o.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);const p=this._senders.indexOf(h);-1!==p&&this._senders.splice(p,1)}}const r=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],r.apply(this,[c]),c.getTracks().forEach(d=>{this._senders.push(n(this,d))})};const s=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(d=>{const h=this._senders.find(p=>p.track===d);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if("object"==typeof o&&o.RTCPeerConnection&&"getSenders"in o.RTCPeerConnection.prototype&&"createDTMFSender"in o.RTCPeerConnection.prototype&&o.RTCRtpSender&&!("dtmf"in o.RTCRtpSender.prototype)){const n=o.RTCPeerConnection.prototype.getSenders;o.RTCPeerConnection.prototype.getSenders=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r},Object.defineProperty(o.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}}function d0(o){if(!o.RTCPeerConnection)return;const n=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){const[r,s,c]=arguments;if(arguments.length>0&&"function"==typeof r)return n.apply(this,arguments);if(0===n.length&&(0===arguments.length||"function"!=typeof r))return n.apply(this,[]);const d=function(p){const m={};return p.result().forEach(_=>{const g={id:_.id,timestamp:_.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[_.type]||_.type};_.names().forEach(v=>{g[v]=_.stat(v)}),m[g.id]=g}),m},h=function(p){return new Map(Object.keys(p).map(m=>[m,p[m]]))};return arguments.length>=2?n.apply(this,[function(m){s(h(d(m)))},r]):new Promise((p,m)=>{n.apply(this,[function(_){p(h(d(_)))},m])}).then(s,c)}}function Kv(o){if(!("object"==typeof o&&o.RTCPeerConnection&&o.RTCRtpSender&&o.RTCRtpReceiver))return;if(!("getStats"in o.RTCRtpSender.prototype)){const r=o.RTCPeerConnection.prototype.getSenders;r&&(o.RTCPeerConnection.prototype.getSenders=function(){const c=r.apply(this,[]);return c.forEach(d=>d._pc=this),c});const s=o.RTCPeerConnection.prototype.addTrack;s&&(o.RTCPeerConnection.prototype.addTrack=function(){const c=s.apply(this,arguments);return c._pc=this,c}),o.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(d=>En(d,c.track,!0))}}if(!("getStats"in o.RTCRtpReceiver.prototype)){const r=o.RTCPeerConnection.prototype.getReceivers;r&&(o.RTCPeerConnection.prototype.getReceivers=function(){const s=r.apply(this,[]);return s.forEach(c=>c._pc=this),s}),lr(o,"track",s=>(s.receiver._pc=s.srcElement,s)),o.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(c=>En(c,s.track,!1))}}if(!("getStats"in o.RTCRtpSender.prototype)||!("getStats"in o.RTCRtpReceiver.prototype))return;const n=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof o.MediaStreamTrack){const r=arguments[0];let s,c,d;return this.getSenders().forEach(h=>{h.track===r&&(s?d=!0:s=h)}),this.getReceivers().forEach(h=>(h.track===r&&(c?d=!0:c=h),h.track===r)),d||s&&c?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():c?c.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}function _n(o){o.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};const n=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return n.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const p=n.apply(this,arguments);return this._shimmedLocalStreams[h.id]?-1===this._shimmedLocalStreams[h.id].indexOf(p)&&this._shimmedLocalStreams[h.id].push(p):this._shimmedLocalStreams[h.id]=[h,p],p};const r=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(m=>{if(this.getSenders().find(_=>_.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();r.apply(this,arguments);const p=this.getSenders().filter(m=>-1===h.indexOf(m));this._shimmedLocalStreams[d.id]=[d].concat(p)};const s=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],s.apply(this,arguments)};const c=o.RTCPeerConnection.prototype.removeTrack;o.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const p=this._shimmedLocalStreams[h].indexOf(d);-1!==p&&this._shimmedLocalStreams[h].splice(p,1),1===this._shimmedLocalStreams[h].length&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function qv(o,n){if(!o.RTCPeerConnection)return;if(o.RTCPeerConnection.prototype.addTrack&&n.version>=65)return _n(o);const r=o.RTCPeerConnection.prototype.getLocalStreams;o.RTCPeerConnection.prototype.getLocalStreams=function(){const m=r.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(_=>this._reverseStreams[_.id])};const s=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(_=>{if(this.getSenders().find(g=>g.track===_))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const _=new o.MediaStream(m.getTracks());this._streams[m.id]=_,this._reverseStreams[_.id]=m,m=_}s.apply(this,[m])};const c=o.RTCPeerConnection.prototype.removeStream;function d(m,_){let g=_.sdp;return Object.keys(m._reverseStreams||[]).forEach(v=>{const b=m._reverseStreams[v];g=g.replace(new RegExp(m._streams[b.id].id,"g"),b.id)}),new RTCSessionDescription({type:_.type,sdp:g})}o.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},o.RTCPeerConnection.prototype.addTrack=function(m,_){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const g=[].slice.call(arguments,1);if(1!==g.length||!g[0].getTracks().find(b=>b===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(b=>b.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const v=this._streams[_.id];if(v)v.addTrack(m),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const b=new o.MediaStream([m]);this._streams[_.id]=b,this._reverseStreams[b.id]=_,this.addStream(b)}return this.getSenders().find(b=>b.track===m)},["createOffer","createAnswer"].forEach(function(m){const _=o.RTCPeerConnection.prototype[m],g={[m](){const v=arguments;return arguments.length&&"function"==typeof arguments[0]?_.apply(this,[b=>{const C=d(this,b);v[0].apply(null,[C])},b=>{v[1]&&v[1].apply(null,b)},arguments[2]]):_.apply(this,arguments).then(b=>d(this,b))}};o.RTCPeerConnection.prototype[m]=g[m]});const h=o.RTCPeerConnection.prototype.setLocalDescription;o.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(m,_){let g=_.sdp;return Object.keys(m._reverseStreams||[]).forEach(v=>{const b=m._reverseStreams[v],C=m._streams[b.id];g=g.replace(new RegExp(b.id,"g"),C.id)}),new RTCSessionDescription({type:_.type,sdp:g})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const p=Object.getOwnPropertyDescriptor(o.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(o.RTCPeerConnection.prototype,"localDescription",{get(){const m=p.get.apply(this);return""===m.type?m:d(this,m)}}),o.RTCPeerConnection.prototype.removeTrack=function(m){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(m._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let _;this._streams=this._streams||{},Object.keys(this._streams).forEach(g=>{this._streams[g].getTracks().find(v=>m.track===v)&&(_=this._streams[g])}),_&&(1===_.getTracks().length?this.removeStream(this._reverseStreams[_.id]):_.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function u0(o,n){!o.RTCPeerConnection&&o.webkitRTCPeerConnection&&(o.RTCPeerConnection=o.webkitRTCPeerConnection),o.RTCPeerConnection&&n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=o.RTCPeerConnection.prototype[r],c={[r](){return arguments[0]=new("addIceCandidate"===r?o.RTCIceCandidate:o.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};o.RTCPeerConnection.prototype[r]=c[r]})}function bl(o,n){lr(o,"negotiationneeded",r=>{const s=r.target;if(!(n.version<72||s.getConfiguration&&"plan-b"===s.getConfiguration().sdpSemantics)||"stable"===s.signalingState)return r})}var h0=Object.freeze({__proto__:null,fixNegotiationNeeded:bl,shimAddTrackRemoveTrack:qv,shimAddTrackRemoveTrackWithNative:_n,shimGetDisplayMedia:function(o,n){o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||o.navigator.mediaDevices&&("function"==typeof n?o.navigator.mediaDevices.getDisplayMedia=function(r){return n(r).then(s=>{const c=r.video&&r.video.width,d=r.video&&r.video.height;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxFrameRate:r.video&&r.video.frameRate||3}},c&&(r.video.mandatory.maxWidth=c),d&&(r.video.mandatory.maxHeight=d),o.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:lp,shimGetStats:d0,shimGetUserMedia:c0,shimMediaStream:l0,shimOnTrack:ou,shimPeerConnection:u0,shimSenderReceiverGetStats:Kv});function Yv(o,n){const r=o&&o.navigator,s=o&&o.MediaStreamTrack;if(r.getUserMedia=function(c,d,h){mn("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(c).then(d,h)},!(n.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const c=function(h,p,m){p in h&&!(m in h)&&(h[m]=h[p],delete h[p])},d=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(h){return"object"==typeof h&&"object"==typeof h.audio&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},s&&s.prototype.getSettings){const h=s.prototype.getSettings;s.prototype.getSettings=function(){const p=h.apply(this,arguments);return c(p,"mozAutoGainControl","autoGainControl"),c(p,"mozNoiseSuppression","noiseSuppression"),p}}if(s&&s.prototype.applyConstraints){const h=s.prototype.applyConstraints;s.prototype.applyConstraints=function(p){return"audio"===this.kind&&"object"==typeof p&&(p=JSON.parse(JSON.stringify(p)),c(p,"autoGainControl","mozAutoGainControl"),c(p,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[p])}}}}function Xt(o){"object"==typeof o&&o.RTCTrackEvent&&"receiver"in o.RTCTrackEvent.prototype&&!("transceiver"in o.RTCTrackEvent.prototype)&&Object.defineProperty(o.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Um(o,n){if("object"!=typeof o||!o.RTCPeerConnection&&!o.mozRTCPeerConnection)return;!o.RTCPeerConnection&&o.mozRTCPeerConnection&&(o.RTCPeerConnection=o.mozRTCPeerConnection),n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const d=o.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new("addIceCandidate"===c?o.RTCIceCandidate:o.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};o.RTCPeerConnection.prototype[c]=h[c]});const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){const[c,d,h]=arguments;return s.apply(this,[c||null]).then(p=>{if(n.version<53&&!d)try{p.forEach(m=>{m.type=r[m.type]||m.type})}catch(m){if("TypeError"!==m.name)throw m;p.forEach((_,g)=>{p.set(g,Object.assign({},_,{type:r[_.type]||_.type}))})}return p}).then(d,h)}}function Sl(o){if("object"!=typeof o||!o.RTCPeerConnection||!o.RTCRtpSender||o.RTCRtpSender&&"getStats"in o.RTCRtpSender.prototype)return;const n=o.RTCPeerConnection.prototype.getSenders;n&&(o.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(c=>c._pc=this),s});const r=o.RTCPeerConnection.prototype.addTrack;r&&(o.RTCPeerConnection.prototype.addTrack=function(){const s=r.apply(this,arguments);return s._pc=this,s}),o.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function At(o){if("object"!=typeof o||!o.RTCPeerConnection||!o.RTCRtpSender||o.RTCRtpSender&&"getStats"in o.RTCRtpReceiver.prototype)return;const n=o.RTCPeerConnection.prototype.getReceivers;n&&(o.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r}),lr(o,"track",r=>(r.receiver._pc=r.srcElement,r)),o.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function p0(o){o.RTCPeerConnection&&!("removeStream"in o.RTCPeerConnection.prototype)&&(o.RTCPeerConnection.prototype.removeStream=function(n){mn("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function f0(o){o.DataChannel&&!o.RTCDataChannel&&(o.RTCDataChannel=o.DataChannel)}function $v(o){if("object"!=typeof o||!o.RTCPeerConnection)return;const n=o.RTCPeerConnection.prototype.addTransceiver;n&&(o.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;void 0===r&&(r=[]),r=[...r];const s=r.length>0;s&&r.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=n.apply(this,arguments);if(s){const{sender:d}=c,h=d.getParameters();(!("encodings"in h)||1===h.encodings.length&&0===Object.keys(h.encodings[0]).length)&&(h.encodings=r,d.sendEncodings=r,this.setParametersPromises.push(d.setParameters(h).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return c})}function m0(o){if("object"!=typeof o||!o.RTCRtpSender)return;const n=o.RTCRtpSender.prototype.getParameters;n&&(o.RTCRtpSender.prototype.getParameters=function(){const r=n.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function _0(o){if("object"!=typeof o||!o.RTCPeerConnection)return;const n=o.RTCPeerConnection.prototype.createOffer;o.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}function dp(o){if("object"!=typeof o||!o.RTCPeerConnection)return;const n=o.RTCPeerConnection.prototype.createAnswer;o.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}var rP=Object.freeze({__proto__:null,shimAddTransceiver:$v,shimCreateAnswer:dp,shimCreateOffer:_0,shimGetDisplayMedia:function(o,n){o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||o.navigator.mediaDevices&&(o.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return!0===r.video?r.video={mediaSource:n}:r.video.mediaSource=n,o.navigator.mediaDevices.getUserMedia(r)})},shimGetParameters:m0,shimGetUserMedia:Yv,shimOnTrack:Xt,shimPeerConnection:Um,shimRTCDataChannel:f0,shimReceiverGetStats:At,shimRemoveStream:p0,shimSenderGetStats:Sl});function g0(o){if("object"==typeof o&&o.RTCPeerConnection){if("getLocalStreams"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in o.RTCPeerConnection.prototype)){const n=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(s=>n.call(this,s,r)),r.getVideoTracks().forEach(s=>n.call(this,s,r))},o.RTCPeerConnection.prototype.addTrack=function(r,...s){return s&&s.forEach(c=>{this._localStreams?this._localStreams.includes(c)||this._localStreams.push(c):this._localStreams=[c]}),n.apply(this,arguments)}}"removeStream"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(-1===r)return;this._localStreams.splice(r,1);const s=n.getTracks();this.getSenders().forEach(c=>{s.includes(c.track)&&this.removeTrack(c)})})}}function E0(o){if("object"==typeof o&&o.RTCPeerConnection&&("getRemoteStreams"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in o.RTCPeerConnection.prototype))){Object.defineProperty(o.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach(c=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(c))return;this._remoteStreams.push(c);const d=new Event("addstream");d.stream=c,this.dispatchEvent(d)})})}});const n=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(c=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(c)>=0)return;r._remoteStreams.push(c);const d=new Event("addstream");d.stream=c,r.dispatchEvent(d)})}),n.apply(r,arguments)}}}function Xv(o){if("object"!=typeof o||!o.RTCPeerConnection)return;const n=o.RTCPeerConnection.prototype,r=n.createOffer,s=n.createAnswer,c=n.setLocalDescription,d=n.setRemoteDescription,h=n.addIceCandidate;n.createOffer=function(m,_){const v=r.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return _?(v.then(m,_),Promise.resolve()):v},n.createAnswer=function(m,_){const v=s.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return _?(v.then(m,_),Promise.resolve()):v};let p=function(m,_,g){const v=c.apply(this,[m]);return g?(v.then(_,g),Promise.resolve()):v};n.setLocalDescription=p,p=function(m,_,g){const v=d.apply(this,[m]);return g?(v.then(_,g),Promise.resolve()):v},n.setRemoteDescription=p,p=function(m,_,g){const v=h.apply(this,[m]);return g?(v.then(_,g),Promise.resolve()):v},n.addIceCandidate=p}function Jv(o){const n=o&&o.navigator;if(n.mediaDevices&&n.mediaDevices.getUserMedia){const r=n.mediaDevices,s=r.getUserMedia.bind(r);n.mediaDevices.getUserMedia=c=>s(Vm(c))}!n.getUserMedia&&n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=function(r,s,c){n.mediaDevices.getUserMedia(r).then(s,c)}.bind(n))}function Vm(o){return o&&void 0!==o.video?Object.assign({},o,{video:cp(o.video)}):o}function v0(o){if(!o.RTCPeerConnection)return;const n=o.RTCPeerConnection;o.RTCPeerConnection=function(r,s){if(r&&r.iceServers){const c=[];for(let d=0;d<r.iceServers.length;d++){let h=r.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(mn("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(r.iceServers[d])}r.iceServers=c}return new n(r,s)},o.RTCPeerConnection.prototype=n.prototype,"generateCertificate"in n&&Object.defineProperty(o.RTCPeerConnection,"generateCertificate",{get:()=>n.generateCertificate})}function y0(o){"object"==typeof o&&o.RTCTrackEvent&&"receiver"in o.RTCTrackEvent.prototype&&!("transceiver"in o.RTCTrackEvent.prototype)&&Object.defineProperty(o.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Bm(o){const n=o.RTCPeerConnection.prototype.createOffer;o.RTCPeerConnection.prototype.createOffer=function(r){if(r){void 0!==r.offerToReceiveAudio&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const s=this.getTransceivers().find(d=>"audio"===d.receiver.track.kind);!1===r.offerToReceiveAudio&&s?"sendrecv"===s.direction?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":"recvonly"===s.direction&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):!0!==r.offerToReceiveAudio||s||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==r.offerToReceiveVideo&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const c=this.getTransceivers().find(d=>"video"===d.receiver.track.kind);!1===r.offerToReceiveVideo&&c?"sendrecv"===c.direction?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":"recvonly"===c.direction&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):!0!==r.offerToReceiveVideo||c||this.addTransceiver("video",{direction:"recvonly"})}return n.apply(this,arguments)}}function b0(o){"object"!=typeof o||o.AudioContext||(o.AudioContext=o.webkitAudioContext)}var S0=Object.freeze({__proto__:null,shimAudioContext:b0,shimCallbacksAPI:Xv,shimConstraints:Vm,shimCreateOfferLegacy:Bm,shimGetUserMedia:Jv,shimLocalStreamsAPI:g0,shimRTCIceServerUrls:v0,shimRemoteStreamsAPI:E0,shimTrackEventTransceiver:y0}),su=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function dr(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Di={exports:{}};!function(o){const n={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};n.localCName=n.generateIdentifier(),n.splitLines=function(r){return r.trim().split("\n").map(s=>s.trim())},n.splitSections=function(r){return r.split("\nm=").map((s,c)=>(c>0?"m="+s:s).trim()+"\r\n")},n.getDescription=function(r){const s=n.splitSections(r);return s&&s[0]},n.getMediaSections=function(r){const s=n.splitSections(r);return s.shift(),s},n.matchPrefix=function(r,s){return n.splitLines(r).filter(c=>0===c.indexOf(s))},n.parseCandidate=function(r){let s;s=0===r.indexOf("a=candidate:")?r.substring(12).split(" "):r.substring(10).split(" ");const c={foundation:s[0],component:{1:"rtp",2:"rtcp"}[s[1]]||s[1],protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]};for(let d=8;d<s.length;d+=2)switch(s[d]){case"raddr":c.relatedAddress=s[d+1];break;case"rport":c.relatedPort=parseInt(s[d+1],10);break;case"tcptype":c.tcpType=s[d+1];break;case"ufrag":c.ufrag=s[d+1],c.usernameFragment=s[d+1];break;default:void 0===c[s[d]]&&(c[s[d]]=s[d+1])}return c},n.writeCandidate=function(r){const s=[];s.push(r.foundation);const c=r.component;s.push("rtp"===c?1:"rtcp"===c?2:c),s.push(r.protocol.toUpperCase()),s.push(r.priority),s.push(r.address||r.ip),s.push(r.port);const d=r.type;return s.push("typ"),s.push(d),"host"!==d&&r.relatedAddress&&r.relatedPort&&(s.push("raddr"),s.push(r.relatedAddress),s.push("rport"),s.push(r.relatedPort)),r.tcpType&&"tcp"===r.protocol.toLowerCase()&&(s.push("tcptype"),s.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(s.push("ufrag"),s.push(r.usernameFragment||r.ufrag)),"candidate:"+s.join(" ")},n.parseIceOptions=function(r){return r.substring(14).split(" ")},n.parseRtpMap=function(r){let s=r.substring(9).split(" ");const c={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),c.name=s[0],c.clockRate=parseInt(s[1],10),c.channels=3===s.length?parseInt(s[2],10):1,c.numChannels=c.channels,c},n.writeRtpMap=function(r){let s=r.payloadType;void 0!==r.preferredPayloadType&&(s=r.preferredPayloadType);const c=r.channels||r.numChannels||1;return"a=rtpmap:"+s+" "+r.name+"/"+r.clockRate+(1!==c?"/"+c:"")+"\r\n"},n.parseExtmap=function(r){const s=r.substring(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1],attributes:s.slice(2).join(" ")}},n.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&"sendrecv"!==r.direction?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+"\r\n"},n.parseFmtp=function(r){const s={};let c;const d=r.substring(r.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)c=d[h].trim().split("="),s[c[0].trim()]=c[1];return s},n.writeFmtp=function(r){let s="",c=r.payloadType;if(void 0!==r.preferredPayloadType&&(c=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){const d=[];Object.keys(r.parameters).forEach(h=>{d.push(void 0!==r.parameters[h]?h+"="+r.parameters[h]:h)}),s+="a=fmtp:"+c+" "+d.join(";")+"\r\n"}return s},n.parseRtcpFb=function(r){const s=r.substring(r.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},n.writeRtcpFb=function(r){let s="",c=r.payloadType;return void 0!==r.preferredPayloadType&&(c=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(d=>{s+="a=rtcp-fb:"+c+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+"\r\n"}),s},n.parseSsrcMedia=function(r){const s=r.indexOf(" "),c={ssrc:parseInt(r.substring(7,s),10)},d=r.indexOf(":",s);return d>-1?(c.attribute=r.substring(s+1,d),c.value=r.substring(d+1)):c.attribute=r.substring(s+1),c},n.parseSsrcGroup=function(r){const s=r.substring(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(c=>parseInt(c,10))}},n.getMid=function(r){const s=n.matchPrefix(r,"a=mid:")[0];if(s)return s.substring(6)},n.parseFingerprint=function(r){const s=r.substring(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1].toUpperCase()}},n.getDtlsParameters=function(r,s){return{role:"auto",fingerprints:n.matchPrefix(r+s,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(r,s){let c="a=setup:"+s+"\r\n";return r.fingerprints.forEach(d=>{c+="a=fingerprint:"+d.algorithm+" "+d.value+"\r\n"}),c},n.parseCryptoLine=function(r){const s=r.substring(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},n.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+("object"==typeof r.keyParams?n.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+"\r\n"},n.parseCryptoKeyParams=function(r){if(0!==r.indexOf("inline:"))return null;const s=r.substring(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},n.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},n.getCryptoParameters=function(r,s){return n.matchPrefix(r+s,"a=crypto:").map(n.parseCryptoLine)},n.getIceParameters=function(r,s){const c=n.matchPrefix(r+s,"a=ice-ufrag:")[0],d=n.matchPrefix(r+s,"a=ice-pwd:")[0];return c&&d?{usernameFragment:c.substring(12),password:d.substring(10)}:null},n.writeIceParameters=function(r){let s="a=ice-ufrag:"+r.usernameFragment+"\r\na=ice-pwd:"+r.password+"\r\n";return r.iceLite&&(s+="a=ice-lite\r\n"),s},n.parseRtpParameters=function(r){const s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=n.splitLines(r)[0].split(" ");s.profile=c[2];for(let h=3;h<c.length;h++){const p=c[h],m=n.matchPrefix(r,"a=rtpmap:"+p+" ")[0];if(m){const _=n.parseRtpMap(m),g=n.matchPrefix(r,"a=fmtp:"+p+" ");switch(_.parameters=g.length?n.parseFmtp(g[0]):{},_.rtcpFeedback=n.matchPrefix(r,"a=rtcp-fb:"+p+" ").map(n.parseRtcpFb),s.codecs.push(_),_.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(_.name.toUpperCase())}}}n.matchPrefix(r,"a=extmap:").forEach(h=>{s.headerExtensions.push(n.parseExtmap(h))});const d=n.matchPrefix(r,"a=rtcp-fb:* ").map(n.parseRtcpFb);return s.codecs.forEach(h=>{d.forEach(p=>{h.rtcpFeedback.find(m=>m.type===p.type&&m.parameter===p.parameter)||h.rtcpFeedback.push(p)})}),s},n.writeRtpDescription=function(r,s){let c="";c+="m="+r+" ",c+=s.codecs.length>0?"9":"0",c+=" "+(s.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=s.codecs.map(h=>void 0!==h.preferredPayloadType?h.preferredPayloadType:h.payloadType).join(" ")+"\r\n",c+="c=IN IP4 0.0.0.0\r\n",c+="a=rtcp:9 IN IP4 0.0.0.0\r\n",s.codecs.forEach(h=>{c+=n.writeRtpMap(h),c+=n.writeFmtp(h),c+=n.writeRtcpFb(h)});let d=0;return s.codecs.forEach(h=>{h.maxptime>d&&(d=h.maxptime)}),d>0&&(c+="a=maxptime:"+d+"\r\n"),s.headerExtensions&&s.headerExtensions.forEach(h=>{c+=n.writeExtmap(h)}),c},n.parseRtpEncodingParameters=function(r){const s=[],c=n.parseRtpParameters(r),d=-1!==c.fecMechanisms.indexOf("RED"),h=-1!==c.fecMechanisms.indexOf("ULPFEC"),p=n.matchPrefix(r,"a=ssrc:").map(b=>n.parseSsrcMedia(b)).filter(b=>"cname"===b.attribute),m=p.length>0&&p[0].ssrc;let _;const g=n.matchPrefix(r,"a=ssrc-group:FID").map(b=>b.substring(17).split(" ").map(C=>parseInt(C,10)));g.length>0&&g[0].length>1&&g[0][0]===m&&(_=g[0][1]),c.codecs.forEach(b=>{if("RTX"===b.name.toUpperCase()&&b.parameters.apt){let C={ssrc:m,codecPayloadType:parseInt(b.parameters.apt,10)};m&&_&&(C.rtx={ssrc:_}),s.push(C),d&&(C=JSON.parse(JSON.stringify(C)),C.fec={ssrc:m,mechanism:h?"red+ulpfec":"red"},s.push(C))}}),0===s.length&&m&&s.push({ssrc:m});let v=n.matchPrefix(r,"b=");return v.length&&(v=0===v[0].indexOf("b=TIAS:")?parseInt(v[0].substring(7),10):0===v[0].indexOf("b=AS:")?1e3*parseInt(v[0].substring(5),10)*.95-16e3:void 0,s.forEach(b=>{b.maxBitrate=v})),s},n.parseRtcpParameters=function(r){const s={},c=n.matchPrefix(r,"a=ssrc:").map(p=>n.parseSsrcMedia(p)).filter(p=>"cname"===p.attribute)[0];c&&(s.cname=c.value,s.ssrc=c.ssrc);const d=n.matchPrefix(r,"a=rtcp-rsize");s.reducedSize=d.length>0,s.compound=0===d.length;const h=n.matchPrefix(r,"a=rtcp-mux");return s.mux=h.length>0,s},n.writeRtcpParameters=function(r){let s="";return r.reducedSize&&(s+="a=rtcp-rsize\r\n"),r.mux&&(s+="a=rtcp-mux\r\n"),void 0!==r.ssrc&&r.cname&&(s+="a=ssrc:"+r.ssrc+" cname:"+r.cname+"\r\n"),s},n.parseMsid=function(r){let s;const c=n.matchPrefix(r,"a=msid:");if(1===c.length)return s=c[0].substring(7).split(" "),{stream:s[0],track:s[1]};const d=n.matchPrefix(r,"a=ssrc:").map(h=>n.parseSsrcMedia(h)).filter(h=>"msid"===h.attribute);return d.length>0?(s=d[0].value.split(" "),{stream:s[0],track:s[1]}):void 0},n.parseSctpDescription=function(r){const s=n.parseMLine(r),c=n.matchPrefix(r,"a=max-message-size:");let d;c.length>0&&(d=parseInt(c[0].substring(19),10)),isNaN(d)&&(d=65536);const h=n.matchPrefix(r,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:s.fmt,maxMessageSize:d};const p=n.matchPrefix(r,"a=sctpmap:");if(p.length>0){const m=p[0].substring(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:d}}},n.writeSctpDescription=function(r,s){let c=[];return c="DTLS/SCTP"!==r.protocol?["m="+r.kind+" 9 "+r.protocol+" "+s.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+s.port+"\r\n"]:["m="+r.kind+" 9 "+r.protocol+" "+s.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+s.port+" "+s.protocol+" 65535\r\n"],void 0!==s.maxMessageSize&&c.push("a=max-message-size:"+s.maxMessageSize+"\r\n"),c.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,22)},n.writeSessionBoilerplate=function(r,s,c){let d;const h=void 0!==s?s:2;return d=r||n.generateSessionId(),"v=0\r\no="+(c||"thisisadapterortc")+" "+d+" "+h+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.getDirection=function(r,s){const c=n.splitLines(r);for(let d=0;d<c.length;d++)switch(c[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[d].substring(2)}return s?n.getDirection(s):"sendrecv"},n.getKind=function(r){return n.splitLines(r)[0].split(" ")[0].substring(2)},n.isRejected=function(r){return"0"===r.split(" ",2)[1]},n.parseMLine=function(r){const s=n.splitLines(r)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},n.parseOLine=function(r){const s=n.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},n.isValidSDP=function(r){if("string"!=typeof r||0===r.length)return!1;const s=n.splitLines(r);for(let c=0;c<s.length;c++)if(s[c].length<2||"="!==s[c].charAt(1))return!1;return!0},o.exports=n}(Di);var au=Di.exports,up=dr(au),hp=function Sc(o,n){return n.forEach(function(r){r&&"string"!=typeof r&&!Array.isArray(r)&&Object.keys(r).forEach(function(s){if("default"!==s&&!(s in o)){var c=Object.getOwnPropertyDescriptor(r,s);Object.defineProperty(o,s,c.get?c:{enumerable:!0,get:function(){return r[s]}})}})}),Object.freeze(o)}({__proto__:null,default:up},[au]);function Qv(o){if(!o.RTCIceCandidate||o.RTCIceCandidate&&"foundation"in o.RTCIceCandidate.prototype)return;const n=o.RTCIceCandidate;o.RTCIceCandidate=function(r){if("object"==typeof r&&r.candidate&&0===r.candidate.indexOf("a=")&&((r=JSON.parse(JSON.stringify(r))).candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){const s=new n(r),c=up.parseCandidate(r.candidate),d=Object.assign(s,c);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new n(r)},o.RTCIceCandidate.prototype=n.prototype,lr(o,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new o.RTCIceCandidate(r.candidate),writable:"false"}),r))}function Cl(o){!o.RTCIceCandidate||o.RTCIceCandidate&&"relayProtocol"in o.RTCIceCandidate.prototype||lr(o,"icecandidate",n=>{if(n.candidate){const r=up.parseCandidate(n.candidate.candidate);"relay"===r.type&&(n.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return n})}function Vi(o,n){if(!o.RTCPeerConnection)return;"sctp"in o.RTCPeerConnection.prototype||Object.defineProperty(o.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const r=function(p){if(!p||!p.sdp)return!1;const m=up.splitSections(p.sdp);return m.shift(),m.some(_=>{const g=up.parseMLine(_);return g&&"application"===g.kind&&-1!==g.protocol.indexOf("SCTP")})},s=function(p){const m=p.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===m||m.length<2)return-1;const _=parseInt(m[1],10);return _!=_?-1:_},c=function(p){let m=65536;return"firefox"===n.browser&&(m=n.version<57?-1===p?16384:2147483637:n.version<60?57===n.version?65535:65536:2147483637),m},d=function(p,m){let _=65536;"firefox"===n.browser&&57===n.version&&(_=65535);const g=up.matchPrefix(p.sdp,"a=max-message-size:");return g.length>0?_=parseInt(g[0].substr(19),10):"firefox"===n.browser&&-1!==m&&(_=2147483637),_},h=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===n.browser&&n.version>=76){const{sdpSemantics:p}=this.getConfiguration();"plan-b"===p&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const p=s(arguments[0]),m=c(p),_=d(arguments[0],p);let g;g=0===m&&0===_?Number.POSITIVE_INFINITY:0===m||0===_?Math.max(m,_):Math.min(m,_);const v={};Object.defineProperty(v,"maxMessageSize",{get:()=>g}),this._sctp=v}return h.apply(this,arguments)}}function jm(o){if(!o.RTCPeerConnection||!("createDataChannel"in o.RTCPeerConnection.prototype))return;function n(s,c){const d=s.send;s.send=function(){const h=arguments[0];if("open"===s.readyState&&c.sctp&&(h.length||h.size||h.byteLength)>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return d.apply(s,arguments)}}const r=o.RTCPeerConnection.prototype.createDataChannel;o.RTCPeerConnection.prototype.createDataChannel=function(){const s=r.apply(this,arguments);return n(s,this),s},lr(o,"datachannel",s=>(n(s.channel,s.target),s))}function Zv(o){if(!o.RTCPeerConnection||"connectionState"in o.RTCPeerConnection.prototype)return;const n=o.RTCPeerConnection.prototype;Object.defineProperty(n,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(n,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{const s=n[r];n[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const d=c.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const h=new Event("connectionstatechange",c);d.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function C0(o,n){if(!o.RTCPeerConnection||"chrome"===n.browser&&n.version>=71||"safari"===n.browser&&n.version>=605)return;const r=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&-1!==s.sdp.indexOf("\na=extmap-allow-mixed")){const c=s.sdp.split("\n").filter(d=>"a=extmap-allow-mixed"!==d.trim()).join("\n");o.RTCSessionDescription&&s instanceof o.RTCSessionDescription?arguments[0]=new o.RTCSessionDescription({type:s.type,sdp:c}):s.sdp=c}return r.apply(this,arguments)}}function Ha(o,n){if(!o.RTCPeerConnection||!o.RTCPeerConnection.prototype)return;const r=o.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(o.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===n.browser&&n.version<78||"firefox"===n.browser&&n.version<68||"safari"===n.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function cu(o,n){if(!o.RTCPeerConnection||!o.RTCPeerConnection.prototype)return;const r=o.RTCPeerConnection.prototype.setLocalDescription;r&&0!==r.length&&(o.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if("object"!=typeof s||s.type&&s.sdp)return r.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer"}return s.sdp||"offer"!==s.type&&"answer"!==s.type?r.apply(this,[s]):("offer"===s.type?this.createOffer:this.createAnswer).apply(this).then(c=>r.apply(this,[c]))})}var ey=Object.freeze({__proto__:null,removeExtmapAllowMixed:C0,shimAddIceCandidateNullOrEmpty:Ha,shimConnectionState:Zv,shimMaxMessageSize:Vi,shimParameterlessSetLocalDescription:cu,shimRTCIceCandidate:Qv,shimRTCIceCandidateRelayProtocol:Cl,shimSendThrowTypeError:jm});!function({window:o}={},n={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const r=Yo,s=function(d){const h={browser:null,version:null};if(void 0===d||!d.navigator)return h.browser="Not a browser.",h;const{navigator:p}=d;if(p.mozGetUserMedia)h.browser="firefox",h.version=qo(p.userAgent,/Firefox\/(\d+)\./,1);else if(p.webkitGetUserMedia||!1===d.isSecureContext&&d.webkitRTCPeerConnection)h.browser="chrome",h.version=qo(p.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!p.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=qo(p.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return h}(o),c={browserDetails:s,commonShim:ey,extractVersion:qo,disableLog:ja,disableWarnings:ru,sdp:hp};switch(s.browser){case"chrome":if(!h0||!u0||!n.shimChrome)return r("Chrome shim is not included in this adapter release."),c;if(null===s.version)return r("Chrome shim can not determine version, not shimming."),c;r("adapter.js shimming chrome."),c.browserShim=h0,Ha(o,s),cu(o),c0(o,s),l0(o),u0(o,s),ou(o),qv(o,s),lp(o),d0(o),Kv(o),bl(o,s),Qv(o),Cl(o),Zv(o),Vi(o,s),jm(o),C0(o,s);break;case"firefox":if(!rP||!Um||!n.shimFirefox)return r("Firefox shim is not included in this adapter release."),c;r("adapter.js shimming firefox."),c.browserShim=rP,Ha(o,s),cu(o),Yv(o,s),Um(o,s),Xt(o),p0(o),Sl(o),At(o),f0(o),$v(o),m0(o),_0(o),dp(o),Qv(o),Zv(o),Vi(o,s),jm(o);break;case"safari":if(!S0||!n.shimSafari)return r("Safari shim is not included in this adapter release."),c;r("adapter.js shimming safari."),c.browserShim=S0,Ha(o,s),cu(o),v0(o),Bm(o),Xv(o),g0(o),E0(o),y0(o),Jv(o),b0(o),Qv(o),Cl(o),Vi(o,s),jm(o),C0(o,s);break;default:r("Unsupported browser!")}}({window:typeof window>"u"?void 0:window});var qn=function(o){try{return!!o()}catch{return!0}},Hm=!qn(function(){var o=function(){}.bind();return"function"!=typeof o||o.hasOwnProperty("prototype")}),T0=Hm,Gm=Function.prototype,ty=Gm.call,oP=T0&&Gm.bind.bind(ty,ty),hi=T0?oP:function(o){return function(){return ty.apply(o,arguments)}},Ns=hi({}.isPrototypeOf),Wm=function(o){return o&&o.Math==Math&&o},er=Wm("object"==typeof globalThis&&globalThis)||Wm("object"==typeof window&&window)||Wm("object"==typeof self&&self)||Wm("object"==typeof su&&su)||function(){return this}()||su||Function("return this")(),w0=Function.prototype,Pn=w0.apply,zm=w0.call,Mn="object"==typeof Reflect&&Reflect.apply||(Hm?zm.bind(Pn):function(){return zm.apply(Pn,arguments)}),Km=hi,aP=Km({}.toString),kn=Km("".slice),Qe=function(o){return kn(aP(o),8,-1)},ny=Qe,iy=hi,I0=function(o){if("Function"===ny(o))return iy(o)},qm="object"==typeof document&&document.all,he={all:qm,IS_HTMLDDA:void 0===qm&&void 0!==qm},Ym=he.all,He=he.IS_HTMLDDA?function(o){return"function"==typeof o||o===Ym}:function(o){return"function"==typeof o},Jt={},ia=!qn(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),$m=Function.prototype.call,Bi=Hm?$m.bind($m):function(){return $m.apply($m,arguments)},Mr={},cP={}.propertyIsEnumerable,R0=Object.getOwnPropertyDescriptor,_F=R0&&!cP.call({1:2},1);Mr.f=_F?function(o){var n=R0(this,o);return!!n&&n.enumerable}:cP;var kr,ry,lu=function(o,n){return{enumerable:!(1&o),configurable:!(2&o),writable:!(4&o),value:n}},gF=qn,EF=Qe,oy=Object,vF=hi("".split),sy=gF(function(){return!oy("z").propertyIsEnumerable(0)})?function(o){return"String"==EF(o)?vF(o,""):oy(o)}:oy,ay=function(o){return null==o},$o=ay,vn=TypeError,Xm=function(o){if($o(o))throw vn("Can't call method on "+o);return o},yF=sy,bF=Xm,Oe=function(o){return yF(bF(o))},lP=He,xn=he.all,xr=he.IS_HTMLDDA?function(o){return"object"==typeof o?null!==o:lP(o)||o===xn}:function(o){return"object"==typeof o?null!==o:lP(o)},Tl={},Jm=Tl,cy=er,A0=He,pp=function(o){return A0(o)?o:void 0},mr=function(o,n){return arguments.length<2?pp(Jm[o])||pp(cy[o]):Jm[o]&&Jm[o][n]||cy[o]&&cy[o][n]},Cc=typeof navigator<"u"&&String(navigator.userAgent)||"",rt=Cc,Qm=er.process,O0=er.Deno,wo=Qm&&Qm.versions||O0&&O0.version,ly=wo&&wo.v8;ly&&(ry=(kr=ly.split("."))[0]>0&&kr[0]<4?1:+(kr[0]+kr[1])),!ry&&rt&&(!(kr=rt.match(/Edge\/(\d+)/))||kr[1]>=74)&&(kr=rt.match(/Chrome\/(\d+)/))&&(ry=+kr[1]);var du=ry,Hn=du,CF=er.String,fp=!!Object.getOwnPropertySymbols&&!qn(function(){var o=Symbol();return!CF(o)||!(Object(o)instanceof Symbol)||!Symbol.sham&&Hn&&Hn<41}),uu=fp&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,dy=mr,Zm=He,dP=Ns,uP=Object,mp=uu?function(o){return"symbol"==typeof o}:function(o){var n=dy("Symbol");return Zm(n)&&dP(n.prototype,uP(o))},N0=String,ra=function(o){try{return N0(o)}catch{return"Object"}},hu=He,hP=ra,pe=TypeError,Io=function(o){if(hu(o))return o;throw pe(hP(o)+" is not a function")},Ct=Io,e_=ay,_p=function(o,n){var r=o[n];return e_(r)?void 0:Ct(r)},wl=Bi,uy=He,hy=xr,pP=TypeError,oa={exports:{}},Ps=er,Ms=Object.defineProperty,an="__core-js_shared__",pu=er[an]||function(o,n){try{Ms(Ps,o,{value:n,configurable:!0,writable:!0})}catch{Ps[o]=n}return n}(an,{}),t_=pu;(oa.exports=function(o,n){return t_[o]||(t_[o]=void 0!==n?n:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Tc=oa.exports,P0=Xm,Wa=Object,ks=function(o){return Wa(P0(o))},fP=ks,_r=hi({}.hasOwnProperty),gr=Object.hasOwn||function(o,n){return _r(fP(o),n)},mP=hi,_P=0,Un=Math.random(),gP=mP(1..toString),n_=function(o){return"Symbol("+(void 0===o?"":o)+")_"+gP(++_P+Un,36)},Lr=gr,yn=n_,Er=fp,eo=uu,xs=er.Symbol,Fr=Tc("wks"),M0=eo?xs.for||xs:xs&&xs.withoutSetter||yn,Yn=function(o){return Lr(Fr,o)||(Fr[o]=Er&&Lr(xs,o)?xs[o]:M0("Symbol."+o)),Fr[o]},i_=Bi,sa=xr,Fe=mp,Dt=_p,Ls=TypeError,Il=Yn("toPrimitive"),vr=function(o,n){if(!sa(o)||Fe(o))return o;var r,s=Dt(o,Il);if(s){if(void 0===n&&(n="default"),r=i_(s,o,n),!sa(r)||Fe(r))return r;throw Ls("Can't convert object to primitive value")}return void 0===n&&(n="number"),function(o,n){var r,s;if("string"===n&&uy(r=o.toString)&&!hy(s=wl(r,o))||uy(r=o.valueOf)&&!hy(s=wl(r,o))||"string"!==n&&uy(r=o.toString)&&!hy(s=wl(r,o)))return s;throw pP("Can't convert object to primitive value")}(o,n)},fu=mp,Zn=function(o){var n=vr(o,"string");return fu(n)?n:n+""},gp=xr,mu=er.document,Pt=gp(mu)&&gp(mu.createElement),Ep=function(o){return Pt?mu.createElement(o):{}},vp=Ep,py=!ia&&!qn(function(){return 7!=Object.defineProperty(vp("div"),"a",{get:function(){return 7}}).a}),yr=Bi,yp=Mr,gu=lu,aa=Oe,bp=Zn,k0=gr,$n=py,EP=Object.getOwnPropertyDescriptor;Jt.f=ia?EP:function(o,n){if(o=aa(o),n=bp(n),$n)try{return EP(o,n)}catch{}if(k0(o,n))return gu(!yr(yp.f,o,n),o[n])};var fy=qn,x0=He,r_=/#|\.prototype\./,wc=function(o,n){var r=Ur[Eu(o)];return r==Ro||r!=TF&&(x0(n)?fy(n):!!n)},Eu=wc.normalize=function(o){return String(o).replace(r_,".").toLowerCase()},Ur=wc.data={},TF=wc.NATIVE="N",Ro=wc.POLYFILL="P",Xo=wc,my=Io,Sp=Hm,o_=I0(I0.bind),Vr=function(o,n){return my(o),void 0===n?o:Sp?o_(o,n):function(){return o.apply(n,arguments)}},Jo={},vP=ia&&qn(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),yP=xr,bP=String,wF=TypeError,ca=function(o){if(yP(o))return o;throw wF(bP(o)+" is not an object")},RF=py,_y=ca,SP=Zn,DF=TypeError,L0=Object.defineProperty,OF=Object.getOwnPropertyDescriptor,F0="enumerable",U0="configurable",s_="writable";Jo.f=ia?vP?function(o,n,r){if(_y(o),n=SP(n),_y(r),"function"==typeof o&&"prototype"===n&&"value"in r&&s_ in r&&!r[s_]){var s=OF(o,n);s&&s[s_]&&(o[n]=r.value,r={configurable:U0 in r?r[U0]:s[U0],enumerable:F0 in r?r[F0]:s[F0],writable:!1})}return L0(o,n,r)}:L0:function(o,n,r){if(_y(o),n=SP(n),_y(r),RF)try{return L0(o,n,r)}catch{}if("get"in r||"set"in r)throw DF("Accessors not supported");return"value"in r&&(o[n]=r.value),o};var V0=Jo,NF=lu,Rl=ia?function(o,n,r){return V0.f(o,n,NF(1,r))}:function(o,n,r){return o[n]=r,o},gy=er,Al=Mn,CP=I0,Ao=He,B0=Jt.f,TP=Xo,vu=Tl,j0=Vr,Dl=Rl,H0=gr,Ey=function(o){var n=function(r,s,c){if(this instanceof n){switch(arguments.length){case 0:return new o;case 1:return new o(r);case 2:return new o(r,s)}return new o(r,s,c)}return Al(o,this,arguments)};return n.prototype=o.prototype,n},In=function(o,n){var r,s,c,d,h,p,m,_,g,v=o.target,b=o.global,C=o.stat,N=o.proto,P=b?gy:C?gy[v]:(gy[v]||{}).prototype,D=b?vu:vu[v]||Dl(vu,v,{})[v],k=D.prototype;for(d in n)s=!(r=TP(b?d:v+(C?".":"#")+d,o.forced))&&P&&H0(P,d),p=D[d],s&&(m=o.dontCallGetSet?(g=B0(P,d))&&g.value:P[d]),h=s&&m?m:n[d],s&&typeof p==typeof h||(_=o.bind&&s?j0(h,gy):o.wrap&&s?Ey(h):N&&Ao(h)?CP(h):h,(o.sham||h&&h.sham||p&&p.sham)&&Dl(_,"sham",!0),Dl(D,d,_),N&&(H0(vu,c=v+"Prototype")||Dl(vu,c,{}),Dl(vu[c],d,h),o.real&&k&&(r||!k[d])&&Dl(k,d,h)))},Qo=Math.ceil,G0=Math.floor,W0=Math.trunc||function(o){var n=+o;return(n>0?G0:Qo)(n)},ji=function(o){var n=+o;return n!=n||0===n?0:W0(n)},wP=ji,a_=Math.max,Do=Math.min,z0=function(o,n){var r=wP(o);return r<0?a_(r+n,0):Do(r,n)},K0=ji,yu=Math.min,Ol=function(o){return function(o){return o>0?yu(K0(o),9007199254740991):0}(o.length)},c_=Oe,IP=z0,Ic=Ol,vy=function(o){return function(n,r,s){var c,d=c_(n),h=Ic(d),p=IP(s,h);if(o&&r!=r){for(;h>p;)if((c=d[p++])!=c)return!0}else for(;h>p;p++)if((o||p in d)&&d[p]===r)return o||p||0;return!o&&-1}},l_={includes:vy(!0),indexOf:vy(!1)},Et=l_.includes;In({target:"Array",proto:!0,forced:qn(function(){return!Array(1).includes()})},{includes:function(o){return Et(this,o,arguments.length>1?arguments[1]:void 0)}});var q0=Tl,bu=function(o){return q0[o+"Prototype"]},RP=bu("Array").includes,AP=xr,DP=Qe,Y0=Yn("match"),NP=TypeError,Ee={};Ee[Yn("toStringTag")]="z";var Wt="[object z]"===String(Ee),Fs=Wt,Us=He,Oi=Qe,$0=Yn("toStringTag"),Cp=Object,la="Arguments"==Oi(function(){return arguments}()),za=Fs?Oi:function(o){var n,r,s;return void 0===o?"Undefined":null===o?"Null":"string"==typeof(r=function(c,d){try{return c[d]}catch{}}(n=Cp(o),$0))?r:la?Oi(n):"Object"==(s=Oi(n))&&Us(n.callee)?"Arguments":s},yy=za,PP=String,Rc=function(o){if("Symbol"===yy(o))throw TypeError("Cannot convert a Symbol value to a string");return PP(o)},X0=Yn("match"),Br=In,Ka=function(o){if(function(o){var n;return AP(o)&&(void 0!==(n=o[Y0])?!!n:"RegExp"==DP(o))}(o))throw NP("The method doesn't accept regular expressions");return o},J0=Xm,Nl=Rc,MP=hi("".indexOf);Br({target:"String",proto:!0,forced:!function(o){var n=/./;try{"/./"[o](n)}catch{try{return n[X0]=!1,"/./"[o](n)}catch{}}return!1}("includes")},{includes:function(o){return!!~MP(Nl(J0(this)),Nl(Ka(o)),arguments.length>1?arguments[1]:void 0)}});var Q0=bu("String").includes,Z0=Ns,kP=RP,by=Q0,Tp=Array.prototype,d_=String.prototype,Re=dr(function(o){var n=o.includes;return o===Tp||Z0(Tp,o)&&n===Tp.includes?kP:"string"==typeof o||o===d_||Z0(d_,o)&&n===d_.includes?by:n}),ew={exports:{}},Cy=Jo.f;In({target:"Object",stat:!0,forced:Object.defineProperty!==Cy,sham:!ia},{defineProperty:Cy});var Ty=Tl.Object,nw=ew.exports=function(o,n,r){return Ty.defineProperty(o,n,r)};Ty.defineProperty.sham&&(nw.sham=!0);var iw=dr(ew.exports),wy=Qe,Iy=Array.isArray||function(o){return"Array"==wy(o)},xP=TypeError,jr=Zn,Pl=Jo,ai=lu,Oo=function(o,n,r){var s=jr(n);s in o?Pl.f(o,s,ai(0,r)):o[s]=r},LP=He,Zo=pu,FP=hi(Function.toString);LP(Zo.inspectSource)||(Zo.inspectSource=function(o){return FP(o)});var rw=Zo.inspectSource,UP=hi,u_=qn,wp=He,h_=za,Ry=rw,Ay=function(){},VP=[],Ml=mr("Reflect","construct"),kl=/^\s*(?:class|function)\b/,BP=UP(kl.exec),PF=!kl.exec(Ay),xl=function(o){if(!wp(o))return!1;try{return Ml(Ay,VP,o),!0}catch{return!1}},jP=function(o){if(!wp(o))return!1;switch(h_(o)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return PF||!!BP(kl,Ry(o))}catch{return!0}};jP.sham=!0;var ow=!Ml||u_(function(){var o;return xl(xl.call)||!xl(Object)||!xl(function(){o=!0})||o})?jP:xl,sw=Iy,MF=ow,kF=xr,Dy=Yn("species"),Oy=Array,Su=function(o,n){return new(function(o){var n;return sw(o)&&(MF(n=o.constructor)&&(n===Oy||sw(n.prototype))||kF(n)&&null===(n=n[Dy]))&&(n=void 0),void 0===n?Oy:n}(o))(0===n?0:n)},cw=qn,lw=du,p_=Yn("species"),HP=In,f_=qn,Ny=Iy,m_=xr,xF=ks,dw=Ol,Py=function(o){if(o>9007199254740991)throw xP("Maximum allowed index exceeded");return o},uw=Oo,da=Su,__=du,g_=Yn("isConcatSpreadable"),hw=__>=51||!f_(function(){var o=[];return o[g_]=!1,o.concat()[0]!==o}),My=function(o){if(!m_(o))return!1;var n=o[g_];return void 0!==n?!!n:Ny(o)};HP({target:"Array",proto:!0,arity:1,forced:!hw||!function(o){return lw>=51||!cw(function(){var n=[];return(n.constructor={})[p_]=function(){return{foo:1}},1!==n[o](Boolean).foo})}("concat")},{concat:function(o){var n,r,s,c,d,h=xF(this),p=da(h,0),m=0;for(n=-1,s=arguments.length;n<s;n++)if(My(d=-1===n?h:arguments[n]))for(c=dw(d),Py(m+c),r=0;r<c;r++,m++)r in d&&uw(p,m,d[r]);else Py(m+1),uw(p,m++,d);return p.length=m,p}});var Ip={},E_={},v_=gr,pw=Oe,fw=l_.indexOf,mw=E_,_w=hi([].push),Rp=function(o,n){var r,s=pw(o),c=0,d=[];for(r in s)!v_(mw,r)&&v_(s,r)&&_w(d,r);for(;n.length>c;)v_(s,r=n[c++])&&(~fw(d,r)||_w(d,r));return d},Ya=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],WP=Rp,gw=Ya,ky=Object.keys||function(o){return WP(o,gw)},Hi=Jo,xy=ca,KP=Oe,Ew=ky;Ip.f=ia&&!vP?Object.defineProperties:function(o,n){xy(o);for(var r,s=KP(n),c=Ew(n),d=c.length,h=0;d>h;)Hi.f(o,r=c[h++],s[r]);return o};var Ac,Ll=mr("document","documentElement"),Tu=n_,Fl=Tc("keys"),Ap=function(o){return Fl[o]||(Fl[o]=Tu(o))},Ly=ca,wu=Ip,qP=Ya,YP=E_,Pe=Ll,LF=Ep,vw="prototype",yw="script",$P=Ap("IE_PROTO"),bw=function(){},XP=function(o){return"<script>"+o+"</"+yw+">"},JP=function(o){o.write(XP("")),o.close();var n=o.parentWindow.Object;return o=null,n},Dc=function(){try{Ac=new ActiveXObject("htmlfile")}catch{}var o,n;Dc=typeof document<"u"?document.domain&&Ac?JP(Ac):("javascript:",(n=LF("iframe")).style.display="none",Pe.appendChild(n),n.src=String("javascript:"),(o=n.contentWindow.document).open(),o.write(XP("document.F=Object")),o.close(),o.F):JP(Ac);for(var s=qP.length;s--;)delete Dc[vw][qP[s]];return Dc()};YP[$P]=!0;var Fy=Object.create||function(o,n){var r;return null!==o?(bw[vw]=Ly(o),r=new bw,bw[vw]=null,r[$P]=o):r=Dc(),void 0===n?r:wu.f(r,n)},Uy={},Gi=Rp,Vy=Ya.concat("length","prototype");Uy.f=Object.getOwnPropertyNames||function(o){return Gi(o,Vy)};var Iu={},Sw=z0,es=Ol,Ul=Oo,Cw=Array,y_=Math.max,Ru=function(o,n,r){for(var s=es(o),c=Sw(n,s),d=Sw(void 0===r?s:r,s),h=Cw(y_(d-c,0)),p=0;c<d;c++,p++)Ul(h,p,o[c]);return h.length=p,h},QP=Qe,FF=Oe,Tw=Uy.f,UF=Ru,no="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Iu.f=function(o){return no&&"Window"==QP(o)?function(n){try{return Tw(n)}catch{return UF(no)}}(o):Tw(FF(o))};var Au={};Au.f=Object.getOwnPropertySymbols;var Du=Rl,b_=function(o,n,r,s){return s&&s.enumerable?o[n]=r:Du(o,n,r),o},ww=Jo,Iw=function(o,n,r){return ww.f(o,n,r)},Ou={};Ou.f=Yn;var S_,Dp,C_,T_=Tl,w_=gr,I_=Ou,Nu=Jo.f,ci=function(o){var n=T_.Symbol||(T_.Symbol={});w_(n,o)||Nu(n,o,{value:I_.f(o)})},Op=Bi,e1=mr,Rw=Yn,Np=b_,Pp=function(){var o=e1("Symbol"),n=o&&o.prototype,r=n&&n.valueOf,s=Rw("toPrimitive");n&&!n[s]&&Np(n,s,function(c){return Op(r,this)},{arity:1})},Aw=za,n1=Wt,Pu=Jo.f,Mp=Rl,r1=gr,VF=Wt?{}.toString:function(){return"[object "+Aw(this)+"]"},By=Yn("toStringTag"),Mu=function(o,n,r,s){if(o){var c=r?o:o.prototype;r1(c,By)||Pu(c,By,{configurable:!0,value:n}),s&&!n1&&Mp(c,"toString",VF)}},Dw=er.WeakMap,o1=He(Dw)&&/native code/.test(String(Dw)),R_=xr,Nw=Rl,jy=gr,jF=Ap,Pw=E_,s1="Object already initialized",Hy=er.TypeError;if(o1||pu.state){var ts=pu.state||(pu.state=new(0,er.WeakMap));ts.get=ts.get,ts.has=ts.has,ts.set=ts.set,S_=function(o,n){if(ts.has(o))throw Hy(s1);return n.facade=o,ts.set(o,n),n},Dp=function(o){return ts.get(o)||{}},C_=function(o){return ts.has(o)}}else{var kp=jF("state");Pw[kp]=!0,S_=function(o,n){if(jy(o,kp))throw Hy(s1);return n.facade=o,Nw(o,kp,n),n},Dp=function(o){return jy(o,kp)?o[kp]:{}},C_=function(o){return jy(o,kp)}}var Gy={set:S_,get:Dp,has:C_,enforce:function(o){return C_(o)?Dp(o):S_(o,{})},getterFor:function(o){return function(n){var r;if(!R_(n)||(r=Dp(n)).type!==o)throw Hy("Incompatible receiver, "+o+" required");return r}}},Wy=Vr,HF=sy,GF=ks,WF=Ol,zF=Su,c1=hi([].push),Oc=function(o){var n=1==o,r=2==o,s=3==o,c=4==o,d=6==o,h=7==o,p=5==o||d;return function(m,_,g,v){for(var b,C,N=GF(m),P=HF(N),D=Wy(_,g),k=WF(P),V=0,U=v||zF,Y=n?U(m,k):r||h?U(m,0):void 0;k>V;V++)if((p||V in P)&&(C=D(b=P[V],V,N),o))if(n)Y[V]=C;else if(C)switch(o){case 3:return!0;case 5:return b;case 6:return V;case 2:c1(Y,b)}else switch(o){case 4:return!1;case 7:c1(Y,b)}return d?-1:s||c?c:Y}},Mw={forEach:Oc(0),map:Oc(1),filter:Oc(2),some:Oc(3),every:Oc(4),find:Oc(5),findIndex:Oc(6),filterReject:Oc(7)},ku=In,D_=er,O_=Bi,kw=hi,Wi=ia,xu=fp,l1=qn,tr=gr,xw=Ns,xp=ca,N_=Oe,zy=Zn,d1=Rc,P_=lu,Lp=Fy,Lw=ky,io=Uy,M_=Iu,Fw=Au,k_=Jt,ur=Jo,Fp=Ip,Ky=Mr,qy=b_,u1=Iw,x_=Tc,Uw=E_,Yy=n_,h1=Yn,Vw=Ou,p1=ci,f1=Pp,$y=Mu,L_=Gy,F_=Mw.forEach,nr=Ap("hidden"),U_="Symbol",Up="prototype",Xy=L_.set,V_=L_.getterFor(U_),ns=Object[Up],is=D_.Symbol,Lu=is&&is[Up],Bw=D_.TypeError,Jy=D_.QObject,B_=k_.f,Vl=ur.f,jw=M_.f,m1=Ky.f,Hw=kw([].push),$a=x_("symbols"),Vp=x_("op-symbols"),Gw=x_("wks"),Bp=!Jy||!Jy[Up]||!Jy[Up].findChild,j_=Wi&&l1(function(){return 7!=Lp(Vl({},"a",{get:function(){return Vl(this,"a",{value:7}).a}})).a})?function(o,n,r){var s=B_(ns,n);s&&delete ns[n],Vl(o,n,r),s&&o!==ns&&Vl(ns,n,s)}:Vl,jp=function(o,n){var r=$a[o]=Lp(Lu);return Xy(r,{type:U_,tag:o,description:n}),Wi||(r.description=n),r},H_=function(o,n,r){o===ns&&H_(Vp,n,r),xp(o);var s=zy(n);return xp(r),tr($a,s)?(r.enumerable?(tr(o,nr)&&o[nr][s]&&(o[nr][s]=!1),r=Lp(r,{enumerable:P_(0,!1)})):(tr(o,nr)||Vl(o,nr,P_(1,{})),o[nr][s]=!0),j_(o,s,r)):Vl(o,s,r)},Qy=function(o,n){xp(o);var r=N_(n),s=Lw(r).concat(tb(r));return F_(s,function(c){Wi&&!O_(Zy,r,c)||H_(o,c,r[c])}),o},Zy=function(o){var n=zy(o),r=O_(m1,this,n);return!(this===ns&&tr($a,n)&&!tr(Vp,n))&&(!(r||!tr(this,n)||!tr($a,n)||tr(this,nr)&&this[nr][n])||r)},eb=function(o,n){var r=N_(o),s=zy(n);if(r!==ns||!tr($a,s)||tr(Vp,s)){var c=B_(r,s);return!c||!tr($a,s)||tr(r,nr)&&r[nr][s]||(c.enumerable=!0),c}},Nc=function(o){var n=jw(N_(o)),r=[];return F_(n,function(s){tr($a,s)||tr(Uw,s)||Hw(r,s)}),r},tb=function(o){var n=o===ns,r=jw(n?Vp:N_(o)),s=[];return F_(r,function(c){!tr($a,c)||n&&!tr(ns,c)||Hw(s,$a[c])}),s};xu||(is=function(){if(xw(Lu,this))throw Bw("Symbol is not a constructor");var o=arguments.length&&void 0!==arguments[0]?d1(arguments[0]):void 0,n=Yy(o),r=function(s){this===ns&&O_(r,Vp,s),tr(this,nr)&&tr(this[nr],n)&&(this[nr][n]=!1),j_(this,n,P_(1,s))};return Wi&&Bp&&j_(ns,n,{configurable:!0,set:r}),jp(n,o)},qy(Lu=is[Up],"toString",function(){return V_(this).tag}),qy(is,"withoutSetter",function(o){return jp(Yy(o),o)}),Ky.f=Zy,ur.f=H_,Fp.f=Qy,k_.f=eb,io.f=M_.f=Nc,Fw.f=tb,Vw.f=function(o){return jp(h1(o),o)},Wi&&u1(Lu,"description",{configurable:!0,get:function(){return V_(this).description}})),ku({global:!0,constructor:!0,wrap:!0,forced:!xu,sham:!xu},{Symbol:is}),F_(Lw(Gw),function(o){p1(o)}),ku({target:U_,stat:!0,forced:!xu},{useSetter:function(){Bp=!0},useSimple:function(){Bp=!1}}),ku({target:"Object",stat:!0,forced:!xu,sham:!Wi},{create:function(o,n){return void 0===n?Lp(o):Qy(Lp(o),n)},defineProperty:H_,defineProperties:Qy,getOwnPropertyDescriptor:eb}),ku({target:"Object",stat:!0,forced:!xu},{getOwnPropertyNames:Nc}),f1(),$y(is,U_),Uw[nr]=!0;var nb=fp&&!!Symbol.for&&!!Symbol.keyFor,_1=In,KF=mr,G_=gr,g1=Rc,ib=Tc,Ww=nb,W_=ib("string-to-symbol-registry"),rb=ib("symbol-to-string-registry");_1({target:"Symbol",stat:!0,forced:!Ww},{for:function(o){var n=g1(o);if(G_(W_,n))return W_[n];var r=KF("Symbol")(n);return W_[n]=r,rb[r]=n,r}});var zw=In,z_=gr,K_=mp,Kw=ra,ob=nb,q_=Tc("symbol-to-string-registry");zw({target:"Symbol",stat:!0,forced:!ob},{keyFor:function(o){if(!K_(o))throw TypeError(Kw(o)+" is not a symbol");if(z_(q_,o))return q_[o]}});var Y_=hi([].slice),Fu=Iy,E1=He,sb=Qe,v1=Rc,qw=hi([].push),y1=In,ab=mr,cb=Mn,$_=Bi,Bl=hi,jl=qn,Yw=He,$w=mp,b1=Y_,S1=function(o){if(E1(o))return o;if(Fu(o)){for(var n=o.length,r=[],s=0;s<n;s++){var c=o[s];"string"==typeof c?qw(r,c):"number"!=typeof c&&"Number"!=sb(c)&&"String"!=sb(c)||qw(r,v1(c))}var d=r.length,h=!0;return function(p,m){if(h)return h=!1,m;if(Fu(this))return m;for(var _=0;_<d;_++)if(r[_]===p)return m}}},lb=fp,C1=String,Xa=ab("JSON","stringify"),Hl=Bl(/./.exec),X_=Bl("".charAt),Xw=Bl("".charCodeAt),Jw=Bl("".replace),Qw=Bl(1..toString),Zw=/[\uD800-\uDFFF]/g,eI=/^[\uD800-\uDBFF]$/,tI=/^[\uDC00-\uDFFF]$/,nI=!lb||jl(function(){var o=ab("Symbol")();return"[null]"!=Xa([o])||"{}"!=Xa({a:o})||"{}"!=Xa(Object(o))}),iI=jl(function(){return'"\\udf06\\ud834"'!==Xa("\udf06\ud834")||'"\\udead"'!==Xa("\udead")}),T1=function(o,n){var r=b1(arguments),s=S1(n);if(Yw(s)||void 0!==o&&!$w(o))return r[1]=function(c,d){if(Yw(s)&&(d=$_(s,this,C1(c),d)),!$w(d))return d},cb(Xa,null,r)},Pc=function(o,n,r){var s=X_(r,n-1),c=X_(r,n+1);return Hl(eI,o)&&!Hl(tI,c)||Hl(tI,o)&&!Hl(eI,s)?"\\u"+Qw(Xw(o,0),16):o};Xa&&y1({target:"JSON",stat:!0,arity:3,forced:nI||iI},{stringify:function(o,n,r){var s=b1(arguments),c=cb(nI?T1:Xa,null,s);return iI&&"string"==typeof c?Jw(c,Zw,Pc):c}});var Uu=Au,w1=ks;In({target:"Object",stat:!0,forced:!fp||qn(function(){Uu.f(1)})},{getOwnPropertySymbols:function(o){var n=Uu.f;return n?n(w1(o)):[]}}),ci("asyncIterator"),ci("hasInstance"),ci("isConcatSpreadable"),ci("iterator"),ci("match"),ci("matchAll"),ci("replace"),ci("search"),ci("species"),ci("split");var qF=Pp;ci("toPrimitive"),qF();var YF=mr,$F=Mu;ci("toStringTag"),$F(YF("Symbol"),"Symbol"),ci("unscopables"),Mu(er.JSON,"JSON",!0);var Vu,I1,db,R1=Tl.Symbol,Bu={},ub=ia,J_=Function.prototype,Ja=ub&&Object.getOwnPropertyDescriptor,Gl=gr(J_,"name"),hb={EXISTS:Gl,PROPER:Gl&&"something"===function(){}.name,CONFIGURABLE:Gl&&(!ub||ub&&Ja(J_,"name").configurable)},rI=!qn(function(){function o(){}return o.prototype.constructor=null,Object.getPrototypeOf(new o)!==o.prototype}),oI=gr,XF=He,JF=ks,QF=rI,Q_=Ap("IE_PROTO"),Hp=Object,ZF=Hp.prototype,sI=QF?Hp.getPrototypeOf:function(o){var n=JF(o);if(oI(n,Q_))return n[Q_];var r=n.constructor;return XF(r)&&n instanceof r?r.prototype:n instanceof Hp?ZF:null},aI=qn,D1=He,O1=xr,N1=Fy,cI=sI,lI=b_,ju=Yn("iterator"),dI=!1;[].keys&&("next"in(db=[].keys())?(I1=cI(cI(db)))!==Object.prototype&&(Vu=I1):dI=!0);var pb=!O1(Vu)||aI(function(){var o={};return Vu[ju].call(o)!==o});D1((Vu=pb?{}:N1(Vu))[ju])||lI(Vu,ju,function(){return this});var uI={IteratorPrototype:Vu,BUGGY_SAFARI_ITERATORS:dI},Ni=uI.IteratorPrototype,P1=Fy,M1=lu,fb=Mu,hI=Bu,k1=function(){return this},x1=hi,L1=Io,F1=He,pI=String,eU=TypeError,Gp=ca,fI=Object.setPrototypeOf||("__proto__"in{}?function(){var o,n=!1,r={};try{(o=function(o,n,r){try{return x1(L1(Object.getOwnPropertyDescriptor(o,n)[r]))}catch{}}(Object.prototype,"__proto__","set"))(r,[]),n=r instanceof Array}catch{}return function(s,c){return Gp(s),function(o){if("object"==typeof o||F1(o))return o;throw eU("Can't set "+pI(o)+" as a prototype")}(c),n?o(s,c):s.__proto__=c,s}}():void 0),mI=In,_I=Bi,gI=sI,EI=Mu,eg=b_,V1=Bu,B1=hb.PROPER,Hu=uI.BUGGY_SAFARI_ITERATORS,tg=Yn("iterator"),ua="values",vI="entries",gb=function(){return this},Wp=function(o,n,r,s,c,d,h){!function(o,n,r,s){var c=n+" Iterator";o.prototype=P1(Ni,{next:M1(+!s,r)}),fb(o,c,!1,!0),hI[c]=k1}(r,n,s);var p,m,_,g=function(k){if(k===c&&P)return P;if(!Hu&&k in C)return C[k];switch(k){case"keys":case ua:case vI:return function(){return new r(this,k)}}return function(){return new r(this)}},v=n+" Iterator",b=!1,C=o.prototype,N=C[tg]||C["@@iterator"]||c&&C[c],P=!Hu&&N||g(c),D="Array"==n&&C.entries||N;if(D&&(p=gI(D.call(new o)))!==Object.prototype&&p.next&&(EI(p,v,!0,!0),V1[v]=gb),B1&&c==ua&&N&&N.name!==ua&&(b=!0,P=function(){return _I(N,this)}),c)if(m={values:g(ua),keys:d?P:g("keys"),entries:g(vI)},h)for(_ in m)(Hu||b||!(_ in C))&&eg(C,_,m[_]);else mI({target:n,proto:!0,forced:Hu||b},m);return h&&C[tg]!==P&&eg(C,tg,P,{name:c}),V1[n]=P,m},yI=function(o,n){return{value:o,done:n}},Eb=Oe,zp=Bu,bI=Wp,ng=yI,SI="Array Iterator",j1=Gy.set,CI=Gy.getterFor(SI);bI(Array,"Array",function(o,n){j1(this,{type:SI,target:Eb(o),index:0,kind:n})},function(){var o=CI(this),n=o.target,r=o.kind,s=o.index++;return!n||s>=n.length?(o.target=void 0,ng(void 0,!0)):ng("keys"==r?s:"values"==r?n[s]:[s,n[s]],!1)},"values"),zp.Arguments=zp.Array;var H1=er,G1=za,W1=Rl,ig=Bu,TI=Yn("toStringTag");for(var rg in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var wI=H1[rg],og=wI&&wI.prototype;og&&G1(og)!==TI&&W1(og,TI,rg),ig[rg]=ig.Array}var iU=R1,Wl=Jo.f,II=Yn("metadata"),zl=Function.prototype;void 0===zl[II]&&Wl(zl,II,{value:null}),ci("dispose"),ci("metadata");var cn=iU;ci("asyncDispose");var K1=hi,Kl=mr("Symbol"),pa=Kl.keyFor,q1=K1(Kl.prototype.valueOf),RI=Kl.isRegisteredSymbol||function(o){try{return void 0!==pa(q1(o))}catch{return!1}};In({target:"Symbol",stat:!0},{isRegisteredSymbol:RI});for(var ql=Tc,AI=mr,vb=hi,yb=mp,Y1=Yn,Wu=AI("Symbol"),Yl=Wu.isWellKnownSymbol,DI=AI("Object","getOwnPropertyNames"),$1=vb(Wu.prototype.valueOf),OI=ql("wks"),bb=0,NI=DI(Wu),X1=NI.length;bb<X1;bb++)try{var PI=NI[bb];yb(Wu[PI])&&Y1(PI)}catch{}var $l=function(o){if(Yl&&Yl(o))return!0;try{for(var n=$1(o),r=0,s=DI(OI),c=s.length;r<c;r++)if(OI[s[r]]==n)return!0}catch{}return!1};In({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:$l}),ci("matcher"),ci("observable"),In({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:RI}),In({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:$l}),ci("metadataKey"),ci("patternMatch"),ci("replaceAll");var ro=dr(cn),Sb=hi,J1=ji,rU=Rc,oU=Xm,MI=Sb("".charAt),Q1=Sb("".charCodeAt),kI=Sb("".slice),Cb=function(o){return function(n,r){var s,c,d=rU(oU(n)),h=J1(r),p=d.length;return h<0||h>=p?o?"":void 0:(s=Q1(d,h))<55296||s>56319||h+1===p||(c=Q1(d,h+1))<56320||c>57343?o?MI(d,h):s:o?kI(d,h,h+2):c-56320+(s-55296<<10)+65536}},Z1=(Cb(!1),Cb(!0)),xI=Rc,eM=Wp,rs=yI,FI="String Iterator",UI=Gy.set,tM=Gy.getterFor(FI);eM(String,"String",function(o){UI(this,{type:FI,string:xI(o),index:0})},function(){var o,n=tM(this),r=n.string,s=n.index;return s>=r.length?rs(void 0,!0):(o=Z1(r,s),n.index+=o.length,rs(o,!1))});var VI=dr(Ou.f("iterator"));function Kp(o){return(Kp="function"==typeof ro&&"symbol"==typeof VI?function(n){return typeof n}:function(n){return n&&"function"==typeof ro&&n.constructor===ro&&n!==ro.prototype?"symbol":typeof n})(o)}var nM=dr(Ou.f("toPrimitive"));function S(o,n,r){return(n=function BI(o){var n=function(r,s){if("object"!==Kp(r)||null===r)return r;var c=r[nM];if(void 0!==c){var d=c.call(r,"string");if("object"!==Kp(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}(o);return"symbol"===Kp(n)?n:String(n)}(n))in o?iw(o,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):o[n]=r,o}var iM=bu("Array").keys,rM=za,vt=gr,Ze=Ns,jI=iM,sg=Array.prototype,oM={DOMTokenList:!0,NodeList:!0},oo=dr(function(o){var n=o.keys;return o===sg||Ze(sg,o)&&n===sg.keys||vt(oM,rM(o))?jI:n}),Tb=ra,sM=TypeError,wb=Ru,aM=Math.floor,Ib=function(o,n){var r=o.length,s=aM(r/2);return r<8?sU(o,n):HI(o,Ib(wb(o,0,s),n),Ib(wb(o,s),n),n)},sU=function(o,n){for(var r,s,c=o.length,d=1;d<c;){for(s=d,r=o[d];s&&n(o[s-1],r)>0;)o[s]=o[--s];s!==d++&&(o[s]=r)}return o},HI=function(o,n,r,s){for(var c=n.length,d=r.length,h=0,p=0;h<c||p<d;)o[h+p]=h<c&&p<d?s(n[h],r[p])<=0?n[h++]:r[p++]:h<c?n[h++]:r[p++];return o},GI=Ib,No=qn,WI=function(o,n){var r=[][o];return!!r&&No(function(){r.call(null,n||function(){return 1},1)})},ag=Cc.match(/firefox\/(\d+)/i),Rb=!!ag&&+ag[1],cM=/MSIE|Trident/.test(Cc),lM=Cc.match(/AppleWebKit\/(\d+)\./),cU=In,zI=hi,KI=Io,lU=ks,qI=Ol,zu=function(o,n){if(!delete o[n])throw sM("Cannot delete property "+Tb(n)+" of "+Tb(o))},YI=Rc,cg=qn,lg=GI,dM=WI,Ab=Rb,uM=cM,$I=du,XI=!!lM&&+lM[1],Mc=[],JI=zI(Mc.sort),QI=zI(Mc.push),hM=cg(function(){Mc.sort(void 0)}),ZI=cg(function(){Mc.sort(null)}),eR=dM("sort"),dg=!cg(function(){if($I)return $I<70;if(!(Ab&&Ab>3)){if(uM)return!0;if(XI)return XI<603;var o,n,r,s,c="";for(o=65;o<76;o++){switch(n=String.fromCharCode(o),o){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(s=0;s<47;s++)Mc.push({k:n+s,v:r})}for(Mc.sort(function(d,h){return h.v-d.v}),s=0;s<Mc.length;s++)n=Mc[s].k.charAt(0),c.charAt(c.length-1)!==n&&(c+=n);return"DGBEFHACIJK"!==c}});cU({target:"Array",proto:!0,forced:hM||!ZI||!eR||!dg},{sort:function(o){void 0!==o&&KI(o);var n=lU(this);if(dg)return void 0===o?JI(n):JI(n,o);var r,s,c=[],d=qI(n);for(s=0;s<d;s++)s in n&&QI(c,n[s]);for(lg(c,function(h){return function(p,m){return void 0===m?-1:void 0===p?1:void 0!==h?+h(p,m)||0:YI(p)>YI(m)?1:-1}}(o)),r=qI(c),s=0;s<r;)n[s]=c[s++];for(;s<d;)zu(n,s++);return n}});var dU=bu("Array").sort,Db=Ns,pM=dU,tR=Array.prototype,ie=dr(function(o){var n=o.sort;return o===tR||Db(tR,o)&&n===tR.sort?pM:n}),qp=mr,fM=Uy,nR=Au,mM=ca,_M=hi([].concat),ug=qp("Reflect","ownKeys")||function(o){var n=fM.f(mM(o)),r=nR.f;return r?_M(n,r(o)):n},Xl=gr,Ob=ug,Yp=Jt,Nb=Jo,hg=xr,iR=Rl,pg=Error,Pb=hi("".replace),Mb=String(pg("zxcasd").stack),kb=/\n\s*at [^:]*:[^\n]*/,xb=kb.test(Mb),gM=lu,EM=!qn(function(){var o=Error("a");return!("stack"in o)||(Object.defineProperty(o,"stack",gM(1,7)),7!==o.stack)}),rR=Rl,oR=EM,Lb=Error.captureStackTrace,yM=Bu,bM=Yn("iterator"),Po=Array.prototype,SM=za,sR=_p,uU=ay,Fb=Bu,aR=Yn("iterator"),cR=function(o){if(!uU(o))return sR(o,aR)||sR(o,"@@iterator")||Fb[SM(o)]},CM=Bi,TM=Io,lR=ca,wM=ra,IM=cR,Ub=TypeError,RM=Bi,dR=ca,AM=_p,DM=Vr,OM=Bi,fa=ca,Vb=ra,PM=Ol,Bb=Ns,kM=cR,uR=function(o,n,r){var s,c;dR(o);try{if(!(s=AM(o,"return"))){if("throw"===n)throw r;return r}s=RM(s,o)}catch(d){c=!0,s=d}if("throw"===n)throw r;if(c)throw s;return dR(s),r},jb=TypeError,fg=function(o,n){this.stopped=o,this.result=n},hR=fg.prototype,kc=function(o,n,r){var s,c,d,h,p,m,_,v=!(!r||!r.AS_ENTRIES),b=!(!r||!r.IS_RECORD),C=!(!r||!r.IS_ITERATOR),N=!(!r||!r.INTERRUPTED),P=DM(n,r&&r.that),D=function(V){return s&&uR(s,"normal",V),new fg(!0,V)},k=function(V){return v?(fa(V),N?P(V[0],V[1],D):P(V[0],V[1])):N?P(V,D):P(V)};if(b)s=o.iterator;else if(C)s=o;else{if(!(c=kM(o)))throw jb(Vb(o)+" is not iterable");if(function(o){return void 0!==o&&(yM.Array===o||Po[bM]===o)}(c)){for(d=0,h=PM(o);h>d;d++)if((p=k(o[d]))&&Bb(hR,p))return p;return new fg(!1)}s=function(o,n){var r=arguments.length<2?IM(o):n;if(TM(r))return lR(CM(r,o));throw Ub(wM(o)+" is not iterable")}(o,c)}for(m=b?o.next:s.next;!(_=OM(m,s)).done;){try{p=k(_.value)}catch(V){uR(s,"throw",V)}if("object"==typeof p&&p&&Bb(hR,p))return p}return new fg(!1)},mg=Rc,_g=In,hU=Ns,Hb=sI,Gb=fI,Wb=Fy,gg=Rl,Eg=lu,zb=function(o,n){hg(n)&&"cause"in n&&iR(o,"cause",n.cause)},Qa=function(o,n,r,s){oR&&(Lb?Lb(o,n):rR(o,"stack",function(o,n){if(xb&&"string"==typeof o&&!pg.prepareStackTrace)for(;n--;)o=Pb(o,kb,"");return o}(r,s)))},vg=kc,yg=function(o,n){return void 0===o?arguments.length<2?"":n:mg(o)},$p=Yn("toStringTag"),bg=Error,fR=[].push,Jl=function(o,n){var r,s=hU(Kb,this);Gb?r=Gb(bg(),s?Hb(this):Kb):(r=s?this:Wb(Kb),gg(r,$p,"Error")),void 0!==n&&gg(r,"message",yg(n)),Qa(r,Jl,r.stack,1),arguments.length>2&&zb(r,arguments[2]);var c=[];return vg(o,fR,{that:c}),gg(r,"errors",c),r};Gb?Gb(Jl,bg):function(o,n,r){for(var s=Ob(n),c=Nb.f,d=Yp.f,h=0;h<s.length;h++){var p=s[h];Xl(o,p)||r&&Xl(r,p)||c(o,p,d(n,p))}}(Jl,bg,{name:!0});var Kb=Jl.prototype=Wb(bg.prototype,{constructor:Eg(1,Jl),message:Eg(1,""),name:Eg(1,"AggregateError")});_g({global:!0,constructor:!0,arity:2},{AggregateError:Jl});var Xp,ma,mR,_R,Jp=typeof process<"u"&&"process"==Qe(process),xM=mr,LM=Iw,FM=ia,gR=Yn("species"),UM=Ns,VM=TypeError,ER=ow,Ot=ra,BM=TypeError,Sg=ca,HM=ay,GM=Yn("species"),vR=function(o,n){var r,s=Sg(o).constructor;return void 0===s||HM(r=Sg(s)[GM])?n:function(o){if(ER(o))return o;throw BM(Ot(o)+" is not a constructor")}(r)},WM=TypeError,yR=/(?:ipad|iphone|ipod).*applewebkit/i.test(Cc),Mo=er,bR=Mn,SR=Vr,CR=He,pU=gr,qb=qn,zM=Ll,Cg=Y_,TR=Ep,KM=function(o,n){if(o<n)throw WM("Not enough arguments");return o},Yb=yR,qM=Jp,os=Mo.setImmediate,Ql=Mo.clearImmediate,br=Mo.process,Za=Mo.Dispatch,Tg=Mo.Function,ko=Mo.MessageChannel,zi=Mo.String,xc=0,_a={},Zl="onreadystatechange";qb(function(){Xp=Mo.location});var Lc=function(o){if(pU(_a,o)){var n=_a[o];delete _a[o],n()}},Fc=function(o){return function(){Lc(o)}},ed=function(o){Lc(o.data)},td=function(o){Mo.postMessage(zi(o),Xp.protocol+"//"+Xp.host)};os&&Ql||(os=function(o){KM(arguments.length,1);var n=CR(o)?o:Tg(o),r=Cg(arguments,1);return _a[++xc]=function(){bR(n,void 0,r)},ma(xc),xc},Ql=function(o){delete _a[o]},qM?ma=function(o){br.nextTick(Fc(o))}:Za&&Za.now?ma=function(o){Za.now(Fc(o))}:ko&&!Yb?(_R=(mR=new ko).port2,mR.port1.onmessage=ed,ma=SR(_R.postMessage,_R)):Mo.addEventListener&&CR(Mo.postMessage)&&!Mo.importScripts&&Xp&&"file:"!==Xp.protocol&&!qb(td)?(ma=td,Mo.addEventListener("message",ed,!1)):ma=Zl in TR("script")?function(o){zM.appendChild(TR("script"))[Zl]=function(){zM.removeChild(this),Lc(o)}}:function(o){setTimeout(Fc(o),0)});var nd={set:os,clear:Ql},id=function(){this.head=null,this.tail=null};id.prototype={add:function(o){var n={item:o,next:null},r=this.tail;r?r.next=n:this.head=n,this.tail=n},get:function(){var o=this.head;if(o)return null===(this.head=o.next)&&(this.tail=null),o.item}};var rd,wg,Ig,Rg,$b,Xb=id,wR=/ipad|iphone|ipod/i.test(Cc)&&typeof Pebble<"u",IR=/web0s(?!.*chrome)/i.test(Cc),Uc=er,RR=Vr,en=nd.set,$M=Xb,Qp=yR,nt=wR,Jb=IR,Qb=Jp,Ne=Uc.MutationObserver||Uc.WebKitMutationObserver,Ge=Uc.document,Tt=Uc.process,Ag=Uc.Promise,Ku=(0,Jt.f)(Uc,"queueMicrotask"),od=Ku&&Ku.value;if(!od){var Zp=new $M,ga=function(){var o,n;for(Qb&&(o=Tt.domain)&&o.exit();n=Zp.get();)try{n()}catch(r){throw Zp.head&&rd(),r}o&&o.enter()};Qp||Qb||Jb||!Ne||!Ge?!nt&&Ag&&Ag.resolve?((Rg=Ag.resolve(void 0)).constructor=Ag,$b=RR(Rg.then,Rg),rd=function(){$b(ga)}):Qb?rd=function(){Tt.nextTick(ga)}:(en=RR(en,Uc),rd=function(){en(ga)}):(wg=!0,Ig=Ge.createTextNode(""),new Ne(ga).observe(Ig,{characterData:!0}),rd=function(){Ig.data=wg=!wg}),od=function(o){Zp.head||rd(),Zp.add(o)}}var ef=od,sd=function(o){try{return{error:!1,value:o()}}catch(n){return{error:!0,value:n}}},ec=er.Promise,tn="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,AR=!tn&&!Jp&&"object"==typeof window&&"object"==typeof document,XM=er,qu=ec,DR=He,OR=Xo,ln=rw,Yu=AR,Sr=tn,Dg=du,Og=qu&&qu.prototype,NR=Yn("species"),Zb=!1,eS=DR(XM.PromiseRejectionEvent),$u={CONSTRUCTOR:OR("Promise",function(){var o=ln(qu),n=o!==String(qu);if(!n&&66===Dg||!Og.catch||!Og.finally)return!0;if(!Dg||Dg<51||!/native code/.test(o)){var r=new qu(function(c){c(1)}),s=function(c){c(function(){},function(){})};if((r.constructor={})[NR]=s,!(Zb=r.then(function(){})instanceof s))return!0}return!n&&(Yu||Sr)&&!eS}),REJECTION_EVENT:eS,SUBCLASSING:Zb},Vs={},tS=Io,MR=TypeError,Ng=function(o){var n,r;this.promise=new o(function(s,c){if(void 0!==n||void 0!==r)throw MR("Bad Promise constructor");n=s,r=c}),this.resolve=tS(n),this.reject=tS(r)};Vs.f=function(o){return new Ng(o)};var Ea,kR,QM=In,Xu=Jp,so=er,ad=Bi,ZM=b_,nS=Mu,mU=Io,iS=He,ek=xr,tk=vR,Pi=nd.set,Pg=ef,ik=sd,LR=Xb,FR=Gy,Mg=ec,cd=Vs,kg="Promise",UR=$u.CONSTRUCTOR,VR=$u.REJECTION_EVENT,oS=FR.getterFor(kg),BR=FR.set,tc=Mg,Bt=Mg&&Mg.prototype,Bs=so.TypeError,sS=so.document,aS=so.process,ss=cd.f,js=ss,Hs=!!(sS&&sS.createEvent&&so.dispatchEvent),cS="unhandledrejection",lS=function(o){var n;return!(!ek(o)||!iS(n=o.then))&&n},jR=function(o,n){var r,s,c,d=n.value,h=1==n.state,p=h?o.ok:o.fail,m=o.resolve,_=o.reject,g=o.domain;try{p?(h||(2===n.rejection&&tf(n),n.rejection=1),!0===p?r=d:(g&&g.enter(),r=p(d),g&&(g.exit(),c=!0)),r===o.promise?_(Bs("Promise-chain cycle")):(s=lS(r))?ad(s,r,m,_):m(r)):_(d)}catch(v){g&&!c&&g.exit(),_(v)}},HR=function(o,n){o.notified||(o.notified=!0,Pg(function(){for(var r,s=o.reactions;r=s.get();)jR(r,o);o.notified=!1,n&&!o.rejection&&rk(o)}))},GR=function(o,n,r){var s,c;Hs?((s=sS.createEvent("Event")).promise=n,s.reason=r,s.initEvent(o,!1,!0),so.dispatchEvent(s)):s={promise:n,reason:r},!VR&&(c=so["on"+o])?c(s):o===cS&&function(o,n){try{1==arguments.length?console.error(o):console.error(o,n)}catch{}}("Unhandled promise rejection",r)},rk=function(o){ad(Pi,so,function(){var n,r=o.facade,s=o.value;if(xg(o)&&(n=ik(function(){Xu?aS.emit("unhandledRejection",s,r):GR(cS,r,s)}),o.rejection=Xu||xg(o)?2:1,n.error))throw n.value})},xg=function(o){return 1!==o.rejection&&!o.parent},tf=function(o){ad(Pi,so,function(){var n=o.facade;Xu?aS.emit("rejectionHandled",n):GR("rejectionhandled",n,o.value)})},Ju=function(o,n,r){return function(s){o(n,s,r)}},ld=function(o,n,r){o.done||(o.done=!0,r&&(o=r),o.value=n,o.state=2,HR(o,!0))},dS=function(o,n,r){if(!o.done){o.done=!0,r&&(o=r);try{if(o.facade===n)throw Bs("Promise can't be resolved itself");var s=lS(n);s?Pg(function(){var c={done:!1};try{ad(s,n,Ju(dS,c,o),Ju(ld,c,o))}catch(d){ld(c,d,o)}}):(o.value=n,o.state=1,HR(o,!1))}catch(c){ld({done:!1},c,o)}}};UR&&(Bt=(tc=function(o){(function(o,n){if(UM(n,o))return o;throw VM("Incorrect invocation")})(this,Bt),mU(o),ad(Ea,this);var n=oS(this);try{o(Ju(dS,n),Ju(ld,n))}catch(r){ld(n,r)}}).prototype,(Ea=function(o){BR(this,{type:kg,done:!1,notified:!1,parent:!1,reactions:new LR,rejection:!1,state:0,value:void 0})}).prototype=ZM(Bt,"then",function(o,n){var r=oS(this),s=ss(tk(this,tc));return r.parent=!0,s.ok=!iS(o)||o,s.fail=iS(n)&&n,s.domain=Xu?aS.domain:void 0,0==r.state?r.reactions.add(s):Pg(function(){jR(s,r)}),s.promise}),kR=function(){var o=new Ea,n=oS(o);this.promise=o,this.resolve=Ju(dS,n),this.reject=Ju(ld,n)},cd.f=ss=function(o){return o===tc||void 0===o?new kR(o):js(o)}),QM({global:!0,constructor:!0,wrap:!0,forced:UR},{Promise:tc}),nS(tc,kg,!1,!0),function(o){var n=xM(o);FM&&n&&!n[gR]&&LM(n,gR,{configurable:!0,get:function(){return this}})}(kg);var WR=Yn("iterator"),uS=!1;try{var zR=0,nf={next:function(){return{done:!!zR++}},return:function(){uS=!0}};nf[WR]=function(){return this},Array.from(nf,function(){throw 2})}catch{}var ok=ec,Ki=$u.CONSTRUCTOR||!function(o,n){if(!n&&!uS)return!1;var r=!1;try{var s={};s[WR]=function(){return{next:function(){return{done:r=!0}}}},o(s)}catch{}return r}(function(o){ok.all(o).then(void 0,function(){})}),dd=Bi,rf=Io,qR=Vs,YR=sd,$R=kc;In({target:"Promise",stat:!0,forced:Ki},{all:function(o){var n=this,r=qR.f(n),s=r.resolve,c=r.reject,d=YR(function(){var h=rf(n.resolve),p=[],m=0,_=1;$R(o,function(g){var v=m++,b=!1;_++,dd(h,n,g).then(function(C){b||(b=!0,p[v]=C,--_||s(p))},c)}),--_||s(p)});return d.error&&c(d.value),r.promise}}),In({target:"Promise",proto:!0,forced:$u.CONSTRUCTOR,real:!0},{catch:function(o){return this.then(void 0,o)}});var QR=Bi,ZR=Io,eA=Vs,sk=sd,ak=kc;In({target:"Promise",stat:!0,forced:Ki},{race:function(o){var n=this,r=eA.f(n),s=r.reject,c=sk(function(){var d=ZR(n.resolve);ak(o,function(h){QR(d,n,h).then(r.resolve,s)})});return c.error&&s(c.value),r.promise}});var ck=Bi,lk=Vs;In({target:"Promise",stat:!0,forced:$u.CONSTRUCTOR},{reject:function(o){var n=lk.f(this);return ck(n.reject,void 0,o),n.promise}});var dk=ca,uk=xr,hk=Vs,tA=function(o,n){if(dk(o),uk(n)&&n.constructor===o)return n;var r=hk.f(o);return(0,r.resolve)(n),r.promise},pk=In,fk=ec,mk=$u.CONSTRUCTOR,_k=tA,gk=mr("Promise"),Ek=!mk;pk({target:"Promise",stat:!0,forced:!0},{resolve:function(o){return _k(Ek&&this===gk?fk:this,o)}});var vk=Bi,yk=Io,bk=Vs,Sk=sd,nA=kc;In({target:"Promise",stat:!0,forced:Ki},{allSettled:function(o){var n=this,r=bk.f(n),s=r.resolve,c=r.reject,d=Sk(function(){var h=yk(n.resolve),p=[],m=0,_=1;nA(o,function(g){var v=m++,b=!1;_++,vk(h,n,g).then(function(C){b||(b=!0,p[v]={status:"fulfilled",value:C},--_||s(p))},function(C){b||(b=!0,p[v]={status:"rejected",reason:C},--_||s(p))})}),--_||s(p)});return d.error&&c(d.value),r.promise}});var iA=Bi,rA=Io,oA=mr,sA=Vs,aA=sd,cA=kc,hS="No one promise resolved";In({target:"Promise",stat:!0,forced:Ki},{any:function(o){var n=this,r=oA("AggregateError"),s=sA.f(n),c=s.resolve,d=s.reject,h=aA(function(){var p=rA(n.resolve),m=[],_=0,g=1,v=!1;cA(o,function(b){var C=_++,N=!1;g++,iA(p,n,b).then(function(P){N||v||(v=!0,c(P))},function(P){N||v||(N=!0,m[C]=P,--g||d(new r(m,hS)))})}),--g||d(new r(m,hS))});return h.error&&d(h.value),s.promise}});var hd=mr,Ck=He,Tk=vR,pd=tA,gU=ec&&ec.prototype;In({target:"Promise",proto:!0,real:!0,forced:!!ec&&qn(function(){gU.finally.call({then:function(){}},function(){})})},{finally:function(o){var n=Tk(this,hd("Promise")),r=Ck(o);return this.then(r?function(s){return pd(n,o()).then(function(){return s})}:o,r?function(s){return pd(n,o()).then(function(){throw s})}:o)}});var Cr=Tl.Promise,z=dr(Cr);const uA=()=>{};function Qu(){const o={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:uA};return o.promise=new z((n,r)=>{o.resolve=s=>{o.isFinished||(o.isResolved=!0,o.isFinished=!0,n(s),o.value=s)},o.reject=s=>{o.isFinished||(o.isRejected=!0,o.isFinished=!0,r(s))}}),o}const pS=new Map,ke=new Map,va=new Map;var ei,_t,o;(o=ei||(ei={})).WIN_10="Windows 10",o.WIN_81="Windows 8.1",o.WIN_8="Windows 8",o.WIN_7="Windows 7",o.WIN_VISTA="Windows Vista",o.WIN_SERVER_2003="Windows Server 2003",o.WIN_XP="Windows XP",o.WIN_2000="Windows 2000",o.ANDROID="Android",o.HARMONY_OS="HarmonyOS",o.OPEN_BSD="Open BSD",o.SUN_OS="Sun OS",o.LINUX="Linux",o.IOS="iOS",o.MAC_OS="Mac OS",o.QNX="QNX",o.UNIX="UNIX",o.BEOS="BeOS",o.OS_2="OS/2",o.SEARCH_BOT="Search Bot",function(o){o.CHROME="Chrome",o.SAFARI="Safari",o.EDGE="Edge",o.FIREFOX="Firefox",o.OPERA="OPR",o.QQ="QQBrowser",o.WECHAT="MicroMessenger"}(_t||(_t={}));var Vc={exports:{}};!function(o,n){!function(r,s){var c="function",d="undefined",h="object",p="string",m="major",_="model",g="name",v="type",b="vendor",C="version",N="architecture",P="console",D="mobile",k="tablet",V="smarttv",U="wearable",Y="embedded",oe="Amazon",K="Apple",X="ASUS",$="BlackBerry",J="Browser",ve="Chrome",ye="Firefox",Ye="Google",lt="Microsoft",bt="Motorola",ne="Opera",ae="Samsung",xe="Sony",ht="Xiaomi",de="Zebra",I="Facebook",F="Chromium OS",j="Mac OS",se=function(On){for(var Kn={},$t=0;$t<On.length;$t++)Kn[On[$t].toUpperCase()]=On[$t];return Kn},Be=function(On,Kn){return typeof On===p&&-1!==Kt(Kn).indexOf(Kt(On))},Kt=function(On){return On.toLowerCase()},Ui=function(On,Kn){if(typeof On===p)return On=On.replace(/^\s\s*/,""),typeof Kn===d?On:On.substring(0,350)},yo=function(On,Kn){for(var $t,bo,Ec,Nn,pt,Jr,Xd=0;Xd<Kn.length&&!pt;){var Ma=Kn[Xd],WL=Kn[Xd+1];for($t=bo=0;$t<Ma.length&&!pt&&Ma[$t];)if(pt=Ma[$t++].exec(On))for(Ec=0;Ec<WL.length;Ec++)Jr=pt[++bo],typeof(Nn=WL[Ec])===h&&Nn.length>0?2===Nn.length?this[Nn[0]]=typeof Nn[1]==c?Nn[1].call(this,Jr):Nn[1]:3===Nn.length?this[Nn[0]]=typeof Nn[1]!==c||Nn[1].exec&&Nn[1].test?Jr?Jr.replace(Nn[1],Nn[2]):s:Jr?Nn[1].call(this,Jr,Nn[2]):s:4===Nn.length&&(this[Nn[0]]=Jr?Nn[3].call(this,Jr.replace(Nn[1],Nn[2])):s):this[Nn]=Jr||s;Xd+=2}},fl=function(On,Kn){for(var $t in Kn)if(typeof Kn[$t]===h&&Kn[$t].length>0){for(var bo=0;bo<Kn[$t].length;bo++)if(Be(Kn[$t][bo],On))return"?"===$t?s:$t}else if(Be(Kn[$t],On))return"?"===$t?s:$t;return On},OT={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},NT={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[C,[g,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[C,[g,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[g,C],[/opios[\/ ]+([\w\.]+)/i],[C,[g,ne+" Mini"]],[/\bopr\/([\w\.]+)/i],[C,[g,ne]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[g,C],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[C,[g,"UC"+J]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[C,[g,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[C,[g,"WeChat"]],[/konqueror\/([\w\.]+)/i],[C,[g,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[C,[g,"IE"]],[/yabrowser\/([\w\.]+)/i],[C,[g,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[g,/(.+)/,"$1 Secure "+J],C],[/\bfocus\/([\w\.]+)/i],[C,[g,ye+" Focus"]],[/\bopt\/([\w\.]+)/i],[C,[g,ne+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[C,[g,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[C,[g,"Dolphin"]],[/coast\/([\w\.]+)/i],[C,[g,ne+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[C,[g,"MIUI "+J]],[/fxios\/([-\w\.]+)/i],[C,[g,ye]],[/\bqihu|(qi?ho?o?|360)browser/i],[[g,"360 "+J]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[g,/(.+)/,"$1 "+J],C],[/(comodo_dragon)\/([\w\.]+)/i],[[g,/_/g," "],C],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[g,C],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[g],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[g,I],C],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[g,C],[/\bgsa\/([\w\.]+) .*safari\//i],[C,[g,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[C,[g,ve+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[g,ve+" WebView"],C],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[C,[g,"Android "+J]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[g,C],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[C,[g,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[C,g],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[g,[C,fl,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[g,C],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[g,"Netscape"],C],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[C,[g,ye+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[g,C],[/(cobalt)\/([\w\.]+)/i],[g,[C,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[N,"amd64"]],[/(ia32(?=;))/i],[[N,Kt]],[/((?:i[346]|x)86)[;\)]/i],[[N,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[N,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[N,"armhf"]],[/windows (ce|mobile); ppc;/i],[[N,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[N,/ower/,"",Kt]],[/(sun4\w)[;\)]/i],[[N,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[N,Kt]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[_,[b,ae],[v,k]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[_,[b,ae],[v,D]],[/\((ip(?:hone|od)[\w ]*);/i],[_,[b,K],[v,D]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[_,[b,K],[v,k]],[/(macintosh);/i],[_,[b,K]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[_,[b,"Sharp"],[v,D]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[_,[b,"Huawei"],[v,k]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[_,[b,"Huawei"],[v,D]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[_,/_/g," "],[b,ht],[v,D]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[_,/_/g," "],[b,ht],[v,k]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[_,[b,"OPPO"],[v,D]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[_,[b,"Vivo"],[v,D]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[_,[b,"Realme"],[v,D]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[_,[b,bt],[v,D]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[_,[b,bt],[v,k]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[_,[b,"LG"],[v,k]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[_,[b,"LG"],[v,D]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[_,[b,"Lenovo"],[v,k]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[_,/_/g," "],[b,"Nokia"],[v,D]],[/(pixel c)\b/i],[_,[b,Ye],[v,k]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[_,[b,Ye],[v,D]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[_,[b,xe],[v,D]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[_,"Xperia Tablet"],[b,xe],[v,k]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[_,[b,"OnePlus"],[v,D]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[_,[b,oe],[v,k]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[_,/(.+)/g,"Fire Phone $1"],[b,oe],[v,D]],[/(playbook);[-\w\),; ]+(rim)/i],[_,b,[v,k]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[_,[b,$],[v,D]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[_,[b,X],[v,k]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[_,[b,X],[v,D]],[/(nexus 9)/i],[_,[b,"HTC"],[v,k]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[b,[_,/_/g," "],[v,D]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[_,[b,"Acer"],[v,k]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[_,[b,"Meizu"],[v,D]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[b,_,[v,D]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[b,_,[v,k]],[/(surface duo)/i],[_,[b,lt],[v,k]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[_,[b,"Fairphone"],[v,D]],[/(u304aa)/i],[_,[b,"AT&T"],[v,D]],[/\bsie-(\w*)/i],[_,[b,"Siemens"],[v,D]],[/\b(rct\w+) b/i],[_,[b,"RCA"],[v,k]],[/\b(venue[\d ]{2,7}) b/i],[_,[b,"Dell"],[v,k]],[/\b(q(?:mv|ta)\w+) b/i],[_,[b,"Verizon"],[v,k]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[_,[b,"Barnes & Noble"],[v,k]],[/\b(tm\d{3}\w+) b/i],[_,[b,"NuVision"],[v,k]],[/\b(k88) b/i],[_,[b,"ZTE"],[v,k]],[/\b(nx\d{3}j) b/i],[_,[b,"ZTE"],[v,D]],[/\b(gen\d{3}) b.+49h/i],[_,[b,"Swiss"],[v,D]],[/\b(zur\d{3}) b/i],[_,[b,"Swiss"],[v,k]],[/\b((zeki)?tb.*\b) b/i],[_,[b,"Zeki"],[v,k]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[b,"Dragon Touch"],_,[v,k]],[/\b(ns-?\w{0,9}) b/i],[_,[b,"Insignia"],[v,k]],[/\b((nxa|next)-?\w{0,9}) b/i],[_,[b,"NextBook"],[v,k]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[b,"Voice"],_,[v,D]],[/\b(lvtel\-)?(v1[12]) b/i],[[b,"LvTel"],_,[v,D]],[/\b(ph-1) /i],[_,[b,"Essential"],[v,D]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[_,[b,"Envizen"],[v,k]],[/\b(trio[-\w\. ]+) b/i],[_,[b,"MachSpeed"],[v,k]],[/\btu_(1491) b/i],[_,[b,"Rotor"],[v,k]],[/(shield[\w ]+) b/i],[_,[b,"Nvidia"],[v,k]],[/(sprint) (\w+)/i],[b,_,[v,D]],[/(kin\.[onetw]{3})/i],[[_,/\./g," "],[b,lt],[v,D]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[_,[b,de],[v,k]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[_,[b,de],[v,D]],[/smart-tv.+(samsung)/i],[b,[v,V]],[/hbbtv.+maple;(\d+)/i],[[_,/^/,"SmartTV"],[b,ae],[v,V]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[b,"LG"],[v,V]],[/(apple) ?tv/i],[b,[_,K+" TV"],[v,V]],[/crkey/i],[[_,ve+"cast"],[b,Ye],[v,V]],[/droid.+aft(\w)( bui|\))/i],[_,[b,oe],[v,V]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[_,[b,"Sharp"],[v,V]],[/(bravia[\w ]+)( bui|\))/i],[_,[b,xe],[v,V]],[/(mitv-\w{5}) bui/i],[_,[b,ht],[v,V]],[/Hbbtv.*(technisat) (.*);/i],[b,_,[v,V]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[b,Ui],[_,Ui],[v,V]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[v,V]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[b,_,[v,P]],[/droid.+; (shield) bui/i],[_,[b,"Nvidia"],[v,P]],[/(playstation [345portablevi]+)/i],[_,[b,xe],[v,P]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[_,[b,lt],[v,P]],[/((pebble))app/i],[b,_,[v,U]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[_,[b,K],[v,U]],[/droid.+; (glass) \d/i],[_,[b,Ye],[v,U]],[/droid.+; (wt63?0{2,3})\)/i],[_,[b,de],[v,U]],[/(quest( 2| pro)?)/i],[_,[b,I],[v,U]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[b,[v,Y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[_,[v,D]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[_,[v,k]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[v,k]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[v,D]],[/(android[-\w\. ]{0,9});.+buil/i],[_,[b,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[C,[g,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[C,[g,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[g,C],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[C,g]],os:[[/microsoft (windows) (vista|xp)/i],[g,C],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[g,[C,fl,OT]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[g,"Windows"],[C,fl,OT]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[C,/_/g,"."],[g,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[g,j],[C,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[C,g],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[g,C],[/\(bb(10);/i],[C,[g,$]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[C,[g,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[C,[g,ye+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[C,[g,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[C,[g,"watchOS"]],[/crkey\/([\d\.]+)/i],[C,[g,ve+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[g,F],C],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[g,C],[/(sunos) ?([\w\.\d]*)/i],[[g,"Solaris"],C],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[g,C]]},Os=function(On,Kn){if(typeof On===h&&(Kn=On,On=s),!(this instanceof Os))return new Os(On,Kn).getResult();var $t=typeof r!==d&&r.navigator?r.navigator:s,bo=On||($t&&$t.userAgent?$t.userAgent:""),Ec=$t&&$t.userAgentData?$t.userAgentData:s,Nn=Kn?function(pt,Jr){var Xd={};for(var Ma in pt)Xd[Ma]=Jr[Ma]&&Jr[Ma].length%2==0?Jr[Ma].concat(pt[Ma]):pt[Ma];return Xd}(NT,Kn):NT;return this.getBrowser=function(){var Jr,pt={};return pt[g]=s,pt[C]=s,yo.call(pt,bo,Nn.browser),pt[m]=typeof(Jr=pt[C])===p?Jr.replace(/[^\d\.]/g,"").split(".")[0]:s,$t&&$t.brave&&typeof $t.brave.isBrave==c&&(pt[g]="Brave"),pt},this.getCPU=function(){var pt={};return pt[N]=s,yo.call(pt,bo,Nn.cpu),pt},this.getDevice=function(){var pt={};return pt[b]=s,pt[_]=s,pt[v]=s,yo.call(pt,bo,Nn.device),!pt[v]&&Ec&&Ec.mobile&&(pt[v]=D),"Macintosh"==pt[_]&&$t&&typeof $t.standalone!==d&&$t.maxTouchPoints&&$t.maxTouchPoints>2&&(pt[_]="iPad",pt[v]=k),pt},this.getEngine=function(){var pt={};return pt[g]=s,pt[C]=s,yo.call(pt,bo,Nn.engine),pt},this.getOS=function(){var pt={};return pt[g]=s,pt[C]=s,yo.call(pt,bo,Nn.os),!pt[g]&&Ec&&"Unknown"!=Ec.platform&&(pt[g]=Ec.platform.replace(/chrome os/i,F).replace(/macos/i,j)),pt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return bo},this.setUA=function(pt){return bo=typeof pt===p&&pt.length>350?Ui(pt,350):pt,this},this.setUA(bo),this};Os.VERSION="0.7.34",Os.BROWSER=se([g,C,m]),Os.CPU=se([N]),Os.DEVICE=se([_,b,v,P,D,V,k,U,Y]),Os.ENGINE=Os.OS=se([g,C]),o.exports&&(n=o.exports=Os),n.UAParser=Os;var $d=typeof r!==d&&(r.jQuery||r.Zepto);if($d&&!$d.ua){var Cm=new Os;$d.ua=Cm.getResult(),$d.ua.get=function(){return Cm.getUA()},$d.ua.set=function(On){Cm.setUA(On);var Kn=Cm.getResult();for(var $t in Kn)$d.ua[$t]=Kn[$t]}}}("object"==typeof window?window:su)}(Vc,Vc.exports);const fS=new(dr(Vc.exports));let as=fS.getResult(),Zu=null;function Ve(o){if(!Zu){o&&fS.setUA(o),as=fS.getResult();const n=function(d){if("Blink"===d.engine.name&&"WeChat"!==d.browser.name)return _t.CHROME;switch(d.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return _t.CHROME;case"Safari":case"Mobile Safari":return _t.SAFARI;case"Edge":return _t.EDGE;case"Firefox":return _t.FIREFOX;case"QQBrowser":return _t.QQ;case"Opera":return _t.OPERA;case"WeChat":return _t.WECHAT;default:return d.browser.name||""}}(as),r=function(d){let h;return h="Blink"===d.engine.name?d.engine.version||"":d.browser.version||"",h.split(".")[0]}(as),s="Windows"===(d=as).os.name?d.os.version?d.os.name+" "+d.os.version:d.os.name:d.os.name||"",c=as.os.version;if(!(n&&r&&s&&c))return{name:n,version:r,os:s,osVersion:c};Zu={name:n,version:r,os:s,osVersion:c}}var d;return Zu}function mS(){return Ve().os}function _S(){const o=Ve();return"".concat(o.os," ").concat(o.osVersion)}function sf(){const o=Ve();return!!("WebKit"===as.engine.name&&o.os===ei.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&o.name!==_t.SAFARI||ir()&&o.name!==_t.SAFARI)}function Lg(){return Ve().name===_t.CHROME}function qi(){return Ve().name===_t.SAFARI}function jt(){return Ve().name===_t.FIREFOX}function ir(){return Ve().os===ei.IOS}function gS(o){const n=Ve();return!(n.name!==_t.CHROME||!n.osVersion)&&Number(n.version)>=o}function pA(o){const n=Ve();return!(n.name!==_t.EDGE||!n.osVersion)&&Number(n.version)>=o}function eh(o){const n=Ve();return!(n.name!==_t.OPERA||!n.osVersion)&&Number(n.version)>=o}function fA(){const o=Ve();return!(o.name!==_t.CHROME||!o.osVersion)&&Number(o.version)<=90}function mA(){const o=Ve();if(o.os!==ei.IOS||!o.osVersion)return!1;const n=o.osVersion.split(".");return Number(n[0])<14||14===Number(n[0])&&Number(n[1])<=6}function th(){const o=Ve();if(o.os!==ei.IOS||!o.osVersion)return!1;const n=o.osVersion.split(".");return 15===Number(n[0])}function nh(){const o=Ve();if(o.os!==ei.IOS||!o.osVersion)return!1;const n=o.osVersion.split(".");return 16===Number(n[0])}function ES(){const o=Ve();if(o.os!==ei.IOS||!o.osVersion)return!1;const n=o.osVersion.split(".");return 15===Number(n[0])&&Number(n[1])>=1}function Gs(){return qi()&&navigator.maxTouchPoints>0}function vS(){return Ve().name===_t.WECHAT}function _A(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function cs(){const o=Ve();return o.name!==_t.EDGE&&o.name!==_t.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Bc(){return mS()===ei.ANDROID}function af(){const o=Ve();return Bc()&&(o.name===_t.CHROME||o.name===_t.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}var M;!function(o){o.UNEXPECTED_ERROR="UNEXPECTED_ERROR",o.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",o.TIMEOUT="TIMEOUT",o.INVALID_PARAMS="INVALID_PARAMS",o.NOT_READABLE="NOT_READABLE",o.NOT_SUPPORTED="NOT_SUPPORTED",o.INVALID_OPERATION="INVALID_OPERATION",o.OPERATION_ABORTED="OPERATION_ABORTED",o.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",o.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",o.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",o.DATACHANNEL_FAILED="DATACHANNEL_FAILED",o.NETWORK_ERROR="NETWORK_ERROR",o.NETWORK_TIMEOUT="NETWORK_TIMEOUT",o.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",o.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",o.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",o.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",o.ELECTRON_IS_NULL="ELECTRON_IS_NULL",o.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",o.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",o.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",o.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",o.PERMISSION_DENIED="PERMISSION_DENIED",o.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",o.TRACK_IS_DISABLED="TRACK_IS_DISABLED",o.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",o.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",o.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",o.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",o.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",o.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",o.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",o.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",o.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",o.UID_CONFLICT="UID_CONFLICT",o.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",o.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",o.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",o.INVALID_TRACK="INVALID_TRACK",o.SENDER_NOT_FOUND="SENDER_NOT_FOUND",o.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",o.SET_ANSWER_FAILED="SET_ANSWER_FAILED",o.ICE_FAILED="ICE_FAILED",o.PC_CLOSED="PC_CLOSED",o.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",o.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",o.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",o.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",o.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",o.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",o.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",o.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",o.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",o.INVALID_REMOTE_USER="INVALID_REMOTE_USER",o.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",o.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",o.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",o.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",o.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",o.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",o.WS_ABORT="WS_ABORT",o.WS_DISCONNECT="WS_DISCONNECT",o.WS_ERR="WS_ERR",o.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",o.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",o.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",o.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",o.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",o.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",o.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",o.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",o.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",o.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",o.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",o.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",o.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",o.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",o.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",o.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",o.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",o.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",o.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",o.INVALID_PLUGIN="INVALID_PLUGIN",o.DISCONNECT_P2P="DISCONNECT_P2P",o.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",o.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",o.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",o.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",o.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",o.PROHIBITED_OPERATION="PROHIBITED_OPERATION",o.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED"}(M||(M={}));let Q=class extends Error{constructor(o){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(n),S(this,"code",void 0),S(this,"message",void 0),S(this,"data",void 0),S(this,"name","AgoraRTCException"),this.code=o,this.message="AgoraRTCError ".concat(this.code,": ").concat(n),this.data=r}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),"\n").concat(this.stack):"".concat(this.stack)}print(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",n=arguments.length>1?arguments[1]:void 0;return"error"===o&&(n||console).error(this.toString()),"warning"===o&&(n||console).warn(this.toString()),this}throw(o){throw this.print("error",o),this}};function jc(o,n){if("boolean"!=typeof o)throw new Q(M.INVALID_PARAMS,"Invalid ".concat(n,": The value is of the boolean type."))}function Gn(o,n,r){if(!Re(r).call(r,o))throw new Q(M.INVALID_PARAMS,"".concat(n," can only be set as ").concat(JSON.stringify(r)))}function wt(o,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(o<r||o>s||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&("number"!=typeof(c=o)||c%1!=0))throw new Q(M.INVALID_PARAMS,"invalid ".concat(n,": the value range is [").concat(r,", ").concat(s,"]. integer only"));var c}function yS(o,n){if("number"!=typeof o){if(!(o.min||o.max||o.ideal||o.exact))throw new Q(M.INVALID_PARAMS,"".concat(n," is not a valid ConstrainLong"));void 0!==o.min&&wt(o.min,"".concat(n,".min"),0,1/0),void 0!==o.max&&wt(o.max,"".concat(n,".max"),1,1/0),void 0!==o.exact&&wt(o.exact,"".concat(n,".exact"),1,1/0),void 0!==o.ideal&&wt(o.ideal,"".concat(n,".ideal"),1,1/0)}else wt(o,n,1,1/0)}function fi(o,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,c=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==o)throw new Q(M.INVALID_PARAMS,"".concat(n||"param"," cannot be empty"));if(!Ik(o,r,s,c))throw new Q(M.INVALID_PARAMS,"Invalid ".concat(n||"string param",": Length of the string: [").concat(r,",").concat(s,"].").concat(c?" ASCII characters only.":""))}function nc(o,n){if(!Array.isArray(o))throw new Q(M.INVALID_PARAMS,"".concat(n," should be an array"))}function nn(o){return null==o}function Ik(o){return"string"==typeof o&&o.length<=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:255)&&o.length>=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)&&(!(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])||function(c){if("string"!=typeof c)return!1;for(let d=0;d<c.length;d+=1){const h=c.charCodeAt(d);if(h<0||h>255)return!1}return!0}(o))}function Rk(o,n,r){if("getBigUint64"in DataView.prototype)return o.getBigUint64(n,r);const s=o.getUint32(n,r),c=o.getUint32(n+4,r),d=Number(!!r),h=Number(!r);return BigInt(s*h+c*d)<<BigInt(32)|BigInt(s*d+c*h)}function Ak(o,n,r,s){if("setBigUint64"in DataView.prototype)return o.setBigUint64(n,r,s);const c=Number(r>>BigInt(32)),d=Number(r&BigInt(4294967295));s?(o.setUint32(n+4,c,s),o.setUint32(n,d,s)):(o.setUint32(n,c,s),o.setUint32(n+4,d,s))}var cf,lf;(function(o){o.COVERED="COVERED",o.POSITION="POSITION",o.SIZE="SIZE",o.STYLE="STYLE"})(cf||(cf={})),function(o){o.UNMOUNTED="UNMOUNTED",o.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(lf||(lf={}));const df=new class{constructor(){S(this,"_clientSize",null),S(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),S(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),S(this,"getStyle",o=>window.getComputedStyle(o,null)),S(this,"checkCssVisibleProperty",o=>{var n;let r=!0;const s=this.getStyle(o),{display:c,visibility:d,opacity:h,filter:p}=s;return("none"===c||Re(n=["hidden","collapse"]).call(n,d)||Number(h)<.1)&&(r=!1),!!r&&(p&&p.split(" ").filter(m=>{var _;const g=m.split("(")[0];return Re(_=["brightness","blur","opacity"]).call(_,g)}).map(m=>{const[_,g]=m.split(/\(|\)/);return[_,Number(g.match(/^[0-9\.]+/))]}).forEach(m=>{const[_,g]=m;switch(_){case"brightness":(g<.1||g>3)&&(r=!1);break;case"blur":g>3&&(r=!1);break;case"opacity":g<.1&&(r=!1)}}),r)}),S(this,"checkPropertyUpToAllParentNodes",(o,n)=>{let r=!0,s=!0;let d=o;for(;d&&s;)n(d)||(r=!1,s=!1),d=d.parentElement,d||(s=!1);return r}),S(this,"checkActualCssVisibleIncludeInherit",o=>this.checkPropertyUpToAllParentNodes(o,this.checkCssVisibleProperty)),S(this,"getSizeAboutClient",o=>{const{width:n,height:r,left:s,right:c,top:d,bottom:h}=o.getBoundingClientRect(),p=this.getClientWidth(),m=this.getClientHeight();return{width:n,height:r,left:s,right:c,top:d,bottom:h,clientWidth:p,clientHeight:m,clientMin:Math.min(p,m)}}),S(this,"checkActualSize",()=>{const{width:o,height:n,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(o,n,r)}),S(this,"elementFromPoint",(o,n)=>document.elementFromPoint?document.elementFromPoint(o,n):null),S(this,"checkCoverForAPoint",(o,n,r)=>{const s=this.elementFromPoint(o,n);return null!==s&&s!==r}),S(this,"getPointPositionList",()=>{const{width:o,height:n,left:r,top:s}=this._clientSize,c=o/6,d=n/6,h=[],p=10**6;for(let m=0;m<5;m++)for(let _=0;_<5;_++)h.push({x:(r*p+(0===m?.1:4===m?(c*m*p-1e5)/p:c*m)*p)/p,y:(s*p+(0===_?.1:4===_?(d*_*p-1e5)/p:d*_)*p)/p});return[...h]}),S(this,"checkElementCover",o=>this.getPointPositionList().map(n=>this.checkCoverForAPoint(n.x,n.y,o)).filter(n=>!!n).length>6),S(this,"checkSizeIsVisible",(o,n,r)=>(o>50||r/o<=10)&&(n>50||r/n<=10)),S(this,"checkSizeOfPartInClient",()=>{const{left:o,right:n,top:r,bottom:s,clientHeight:c,clientWidth:d,clientMin:h}=this._clientSize;let p,m,_,g;if(o<0)p=0;else{if(!(o<d))return!1;p=o}if(n<0)return!1;if(m=n<d?n:d,r<0)_=0;else{if(!(r<c))return!1;_=r}return!(s<0)&&(g=s<c?s:c,this.checkSizeIsVisible(m-p,g-_,h))}),S(this,"returnHiddenResult",o=>(this._clientSize=null,{visible:!1,reason:o})),S(this,"checkOneElementVisible",o=>{if(o instanceof HTMLElement){if(this.checkElementIsMountedOnDom(o)){if(this.checkActualCssVisibleIncludeInherit(o)){if(this._clientSize=this.getSizeAboutClient(o),this.checkElementCover(o))return this.returnHiddenResult(cf.COVERED);{const n=this.checkActualSize(),r=this.checkSizeOfPartInClient();return n&&!r?this.returnHiddenResult(cf.POSITION):n?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(cf.SIZE)}}return this.returnHiddenResult(cf.STYLE)}return this.returnHiddenResult(lf.UNMOUNTED)}return this.returnHiddenResult(lf.INVALID_HTML_ELEMENT)}),S(this,"checkElementIsMountedOnDom",o=>this.checkPropertyUpToAllParentNodes(o,n=>"HTML"!==n.nodeName.toUpperCase()?null!==n.parentElement:!!document.documentElement))}};function bS(o){return(new TextEncoder).encode(o)}const gA=function(o,n){const r=new Uint8Array(o.byteLength+n.byteLength);return r.set(new Uint8Array(o),0),r.set(new Uint8Array(n),o.byteLength),r},EA=function(){var o=x(function*(n){const r=function(h){const p=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),m=new Uint8Array(new ArrayBuffer(p.length));for(let _=0;_<p.length;_+=1)m[_]=p.charCodeAt(_);return m}(),s=yield window.crypto.subtle.importKey("spki",r,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),c=bS(n),d=yield window.crypto.subtle.encrypt({name:"RSA-OAEP"},s,c);return function(h){let p="";for(let m=0;m<h.length;m+=1)p+=String.fromCharCode(h[m]);return window.btoa(p)}(new Uint8Array(d))});return function(r){return o.apply(this,arguments)}}(),uf=function(){var o=x(function*(n){return function(r,s){let c="";return new Uint8Array(r).forEach(d=>{c+=d.toString(16).padStart(2,"0")}),c}(yield crypto.subtle.digest("SHA-256",bS(n)))});return function(r){return o.apply(this,arguments)}}();class Yt{constructor(){S(this,"_events",{}),S(this,"addListener",this.on)}getListeners(n){return this._events[n]?this._events[n].map(r=>r.listener):[]}on(n,r){this._events[n]||(this._events[n]=[]);const s=this._events[n];-1===this._indexOfListener(s,r)&&s.push({listener:r,once:!1})}once(n,r){this._events[n]||(this._events[n]=[]);const s=this._events[n];-1===this._indexOfListener(s,r)&&s.push({listener:r,once:!0})}off(n,r){if(!this._events[n])return;const s=this._events[n],c=this._indexOfListener(s,r);-1!==c&&s.splice(c,1),0===this._events[n].length&&delete this._events[n]}removeAllListeners(n){n?delete this._events[n]:this._events={}}emit(n){this._events[n]||(this._events[n]=[]);const r=this._events[n].map(h=>h);for(var s=arguments.length,c=new Array(s>1?s-1:0),d=1;d<s;d++)c[d-1]=arguments[d];for(let h=0;h<r.length;h+=1){const p=r[h];p.once&&this.off(n,p.listener),p.listener.apply(this,c||[])}}safeEmit(n){for(var r=arguments.length,s=new Array(r>1?r-1:0),c=1;c<r;c++)s[c-1]=arguments[c];[...this._events[n]||[]].forEach(d=>{d.once&&this.off(n,d.listener);try{d.listener.apply(this,s)}catch(h){console.error("safeEmit event:".concat(n," error ").concat(h?.toString()))}})}_indexOfListener(n,r){let s=n.length;for(;s--;)if(n[s].listener===r)return s;return-1}}let hf=null;function vA(){if(hf)return hf;if(window.electron)return hf=window.electron;if(!window.require)return null;try{return hf=window.require("electron"),hf}catch{return null}}var Vn,dn,SS,Xe,et,Xn,li,ic;function CS(o){return wt(o.timeout,"config.timeout",0,1e5),wt(o.timeoutFactor,"config.timeoutFactor",0,100,!1),wt(o.maxRetryCount,"config.maxRetryConfig",0,1/0),wt(o.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function ih(o){if(!Array.isArray(o)||o.length<1)return!1;try{o.forEach(n=>{if(!n.urls)throw Error()})}catch{return!1}return!0}function TS(o){return fi(o.turnServerURL,"turnServerURL"),fi(o.username,"username"),fi(o.password,"password"),o.udpport&&wt(o.udpport,"udpport",1,99999,!0),o.forceturn&&jc(o.forceturn,"forceturn"),o.security&&jc(o.security,"security"),o.tcpport&&wt(o.tcpport,"tcpport",1,99999,!0),!0}function yA(o){return void 0!==o.level&&Gn(o.level,"level",[1,2,3]),void 0!==o.delay&&wt(o.delay,"delay",0,3e3,!0),!0}function Qt(o,n){for(var r=arguments.length,s=new Array(r>2?r-2:0),c=2;c<r;c++)s[c-2]=arguments[c];return 0===o.getListeners(n).length?z.reject(new Q(M.UNEXPECTED_ERROR,"can not emit promise")):new z((d,h)=>{o.emit(n,...s,d,h)})}function Mt(o,n){if(0===o.getListeners(n).length)return z.resolve();for(var r=arguments.length,s=new Array(r>2?r-2:0),c=2;c<r;c++)s[c-2]=arguments[c];return Qt(o,n,...s)}function hr(o,n){if(0===o.getListeners(n).length)return null;for(var r=arguments.length,s=new Array(r>2?r-2:0),c=2;c<r;c++)s[c-2]=arguments[c];return rc(o,n,...s)}function rc(o,n){let r=null,s=null;for(var c=arguments.length,d=new Array(c>2?c-2:0),h=2;h<c;h++)d[h-2]=arguments[h];if(o.emit(n,...d,p=>{r=p},p=>{s=p}),null!==s)throw s;if(null===r)throw new Q(M.UNEXPECTED_ERROR,"handler is not sync");return r}(function(o){o.CREATE_CLIENT="createClient",o.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",o.SET_AREA="setArea",o.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",o.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",o.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",o.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",o.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",o.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",o.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",o.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",o.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",o.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",o.START_PROXY_SERVER="Client.startProxyServer",o.STOP_PROXY_SERVER="Client.stopProxyServer",o.SET_PROXY_SERVER="Client.setProxyServer",o.SET_TURN_SERVER="Client.setTurnServer",o.SET_CLIENT_ROLE="Client.setClientRole",o.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",o.ENABLE_DUAL_STREAM="Client.enableDualStream",o.DISABLE_DUAL_STREAM="Client.disableDualStream",o.JOIN="Client.join",o.LEAVE="Client.leave",o.PUBLISH="Client.publish",o.UNPUBLISH="Client.unpublish",o.SUBSCRIBE="Client.subscribe",o.MASS_SUBSCRIBE="Client.massSubscribe",o.MASS_UNSUBSCRIBE="Client.massUnsubscribe",o.UNSUBSCRIBE="Client.unsubscribe",o.RENEW_TOKEN="Client.renewToken",o.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",o.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",o.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",o.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",o.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",o.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",o.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",o.DATACHANNEL_FAILBACK="Client._datachannelFailback",o.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",o.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",o.START_LIVE_STREAMING="Client.startLiveStreaming",o.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",o.STOP_LIVE_STREAMING="Client.stopLiveStreaming",o.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",o.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",o.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",o.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",o.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",o.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",o.SET_CONFIG_DISTRIBUTE="_configDistribute",o.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",o.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",o.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",o.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",o.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",o.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",o.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",o.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",o.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",o.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",o.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",o.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",o.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",o.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",o.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",o.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",o.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",o.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",o.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",o.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",o.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",o.STREAM_TYPE_CHANGE="streamTypeChange",o.CONNECTION_STATE_CHANGE="connectionStateChange",o.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",o.IMAGE_MODERATION_UPLOAD="imageModerationUpload"})(Vn||(Vn={})),function(o){o.TRACER="tracer"}(dn||(dn={})),function(o){o[o.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",o[o.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",o[o.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(SS||(SS={})),function(o){o.LEAVE="LEAVE",o.NETWORK_ERROR="NETWORK_ERROR",o.SERVER_ERROR="SERVER_ERROR",o.UID_BANNED="UID_BANNED",o.IP_BANNED="IP_BANNED",o.CHANNEL_BANNED="CHANNEL_BANNED",o.FALLBACK="FALLBACK",o.LICENSE_MISSING="LICENSE_MISSING",o.LICENSE_EXPIRED="LICENSE_EXPIRED",o.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",o.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",o.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",o.LICENSE_ILLEGAL="LICENSE_ILLEGAL",o.TOKEN_EXPIRE="TOKEN_EXPIRE"}(Xe||(Xe={})),function(o){o.CONNECTION_STATE_CHANGE="connection-state-change",o.MEDIA_RECONNECT_START="media-reconnect-start",o.MEDIA_RECONNECT_END="media-reconnect-end",o.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",o.USER_JOINED="user-joined",o.USER_LEAVED="user-left",o.USER_PUBLISHED="user-published",o.USER_UNPUBLISHED="user-unpublished",o.USER_INFO_UPDATED="user-info-updated",o.CLIENT_BANNED="client-banned",o.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",o.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",o.VOLUME_INDICATOR="volume-indicator",o.CRYPT_ERROR="crypt-error",o.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",o.NETWORK_QUALITY="network-quality",o.STREAM_TYPE_CHANGED="stream-type-changed",o.STREAM_FALLBACK="stream-fallback",o.RECEIVE_METADATA="receive-metadata",o.STREAM_MESSAGE="stream-message",o.LIVE_STREAMING_ERROR="live-streaming-error",o.LIVE_STREAMING_WARNING="live-streaming-warning",o.INJECT_STREAM_STATUS="stream-inject-status",o.EXCEPTION="exception",o.ERROR="error",o.P2P_LOST="p2p_lost",o.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",o.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",o.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",o.PUBLISHED_USER_LIST="published-user-list",o.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",o.CONTENT_INSPECT_ERROR="content-inspect-error",o.CONTENT_INSPECT_RESULT="content-inspect-result",o.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}(et||(et={})),function(o){o.NETWORK_ERROR="NETWORK_ERROR",o.SERVER_ERROR="SERVER_ERROR",o.MULTI_IP="MULTI_IP",o.TIMEOUT="TIMEOUT",o.OFFLINE="OFFLINE",o.LEAVE="LEAVE",o.P2P_FAILED="P2P_FAILED",o.FALLBACK="FALLBACK"}(Xn||(Xn={})),function(o){o.ONLINE="ONLINE",o.OFFLINE="OFFLINE"}(li||(li={})),function(o){o.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",o.ONLINE="ONLINE",o.OFFLINE="OFFLINE"}(ic||(ic={}));const Rn=new class extends Yt{set networkState(o){this.emit(ic.NETWORK_STATE_CHANGE,o,this._networkState),o===li.ONLINE?this.emit(ic.ONLINE):o===li.OFFLINE&&(this.onlineWaiter=new z(n=>{this.once(ic.ONLINE,()=>{this.onlineWaiter=void 0,n(li.ONLINE)})}),this.emit(ic.OFFLINE)),this._networkState=o}get networkState(){return this._networkState}get isOnline(){return this._networkState===li.ONLINE}constructor(){super(),S(this,"_moduleName","network-indicator"),S(this,"_networkState",li.ONLINE),S(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=li.ONLINE}),window.addEventListener("offline",()=>{this.networkState=li.OFFLINE})}};function wS(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function fd(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?wS(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):wS(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}function IS(o,n){const r=o.indexOf(n);-1!==r&&o.splice(r,1)}function rh(o){const n=[];return o.forEach(r=>{-1===n.indexOf(r)&&n.push(r)}),n}function ao(o){void 0!==z?z.resolve().then(o):setTimeout(o,0)}function Ln(o){return JSON.parse(JSON.stringify(o))}function Hc(o){try{return Ln(o)}catch{return o}}const bA={};function pf(o,n){bA[n]||(bA[n]=!0,o())}function Fg(o){const n=window.atob(o),r=new Uint8Array(new ArrayBuffer(n.length));for(let s=0;s<n.length;s+=1)r[s]=n.charCodeAt(s);return r}function Ug(o){let n="";for(let r=0;r<o.length;r+=1)n+=String.fromCharCode(o[r]);return window.btoa(n)}function ya(o){return window.TextEncoder?(new TextEncoder).encode(o).length:o.length}function SA(o){let n=0;return/DingTalk/i.test(navigator.userAgent)&&o.realFormData&&(o=o.realFormData),o.forEach(r=>{n+="string"==typeof r?ya(r):r.size}),n+138}function Dk(o){const n=new Q(M.TIMEOUT,"timeout");return new z((r,s)=>{window.setTimeout(()=>s(n),o)})}function mi(o){return new z(n=>{window.setTimeout(n,o)})}function It(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,n=arguments.length>1?arguments[1]:void 0;const r=Math.random().toString(16).substr(2,o).toLowerCase();return r.length===o?"".concat(n).concat(r):"".concat(n).concat(r)+It(o-r.length,"")}function Vg(){return It(32,"").toUpperCase()}const Bg=()=>{},CA=new class{constructor(){S(this,"fnMap",new Map)}throttleByKey(o,n,r,s){for(var c=arguments.length,d=new Array(c>4?c-4:0),h=4;h<c;h++)d[h-4]=arguments[h];if(this.fnMap.has(n)){const p=this.fnMap.get(n);if(p.threshold!==r){p.fn(...p.args),clearTimeout(p.timer);const m=window.setTimeout(()=>{const _=this.fnMap.get(n);_&&_.fn(..._.args),this.fnMap.delete(n)},r);this.fnMap.set(n,{fn:o,threshold:r,timer:m,args:d,skipFn:s})}else p.skipFn&&p.skipFn(...p.args),this.fnMap.set(n,fd(fd({},p),{},{fn:o,args:d,skipFn:s}))}else{const p=window.setTimeout(()=>{const m=this.fnMap.get(n);m&&m.fn(...m.args),this.fnMap.delete(n)},r);this.fnMap.set(n,{fn:o,threshold:r,timer:p,args:d,skipFn:s})}}},RS=CA.throttleByKey.bind(CA);function TA(o){return"object"==typeof o&&null!==o&&!(o instanceof RegExp)}function AS(o,n){if(!TA(o)||!TA(n)||Array.isArray(o)&&!Array.isArray(n)||!Array.isArray(o)&&Array.isArray(n))return n;if(Array.isArray(n)&&Array.isArray(o)){const r=[...o];for(let s=0;s<n.length;s++)r[s]=AS(o[s],n[s]);return r}{const r=fd({},o);for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=Object.prototype.hasOwnProperty.call(o,s)?AS(o[s],n[s]):n[s]);return r}}let Ok=1,oh=console;class Wn{static setLogger(n){oh=n}constructor(n){S(this,"lockingPromise",z.resolve()),S(this,"locks",0),S(this,"name",""),S(this,"lockId",void 0),this.lockId=Ok++,n&&(this.name=n),oh.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(n){let r;this.locks+=1,oh.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat("string"==typeof n?n:""));const s=new z(d=>{r=()=>{this.locks-=1,oh.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat("string"==typeof n?n:"")),d()}}),c=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>s),c}}function md(o,n){return function(r,s,c){const d=c.value;if("function"!=typeof d)throw new Error("Cannot use mutex on object property.");return c.value=x(function*(){const h=this[n];if(!h)throw new Error("mutex property key ".concat(n," doesn't exist on ").concat(o));const p=yield h.lock("From ".concat(o,".").concat(s));try{for(var m=arguments.length,_=new Array(m),g=0;g<m;g++)_[g]=arguments[g];return yield d.apply(this,_)}finally{p()}}),c}}const bn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function jg(o,n){const r=Math.floor(n.timeout*Math.pow(n.timeoutFactor,o));return Math.min(n.maxRetryTimeout,r)}function Ws(o,n,r,s){const c=Object.assign({},bn,s);let d=c.timeout;const h=function(){var _=x(function*(){var g;yield(g=d,new z(v=>{window.setTimeout(v,g)})),d*=c.timeoutFactor,d=Math.min(c.maxRetryTimeout,d)});return function(){return _.apply(this,arguments)}}();let p=!1;const m=new z(function(){var _=x(function*(g,v){n=n||(()=>!1),r=r||(()=>!0);for(let b=0;b<c.maxRetryCount;b+=1){if(p)return v(new Q(M.OPERATION_ABORTED));try{const C=yield o();if(!n(C,b)||b+1===c.maxRetryCount)return g(C);yield h()}catch(C){if(!r(C,b)||b+1===c.maxRetryCount)return v(C);yield h()}}});return function(g,v){return _.apply(this,arguments)}}());return m.cancel=()=>p=!0,m}var DS=Io,Nk=ks,An=sy,sh=Ol,wA=TypeError,IA=function(o){return function(n,r,s,c){DS(r);var d=Nk(n),h=An(d),p=sh(d),m=o?p-1:0,_=o?-1:1;if(s<2)for(;;){if(m in h){c=h[m],m+=_;break}if(m+=_,o?m<0:p<=m)throw wA("Reduce of empty array with no initial value")}for(;o?m>=0:p>m;m+=_)m in h&&(c=r(c,h[m],m,d));return c}},EU=[IA(!1),IA(!0)][0];In({target:"Array",proto:!0,forced:!Jp&&du>79&&du<83||!WI("reduce")},{reduce:function(o){var n=arguments.length;return EU(this,o,n,n>1?arguments[1]:void 0)}});var RA=bu("Array").reduce,OS=Ns,Pk=RA,ah=Array.prototype,_d=dr(function(o){var n=o.reduce;return o===ah||OS(ah,o)&&n===ah.reduce?Pk:n});let ff=class{constructor(o){S(this,"input",[]),S(this,"size",void 0),this.size=o}add(o){this.input.push(o),this.input.length>this.size&&this.input.splice(0,1)}mean(){var o;return 0===this.input.length?0:_d(o=this.input).call(o,(n,r)=>n+r)/this.input.length}};var mf,Hg={exports:{}},NS=function(o,n){return function(){for(var r=new Array(arguments.length),s=0;s<r.length;s++)r[s]=arguments[s];return o.apply(n,r)}},AA=NS,Gg=Object.prototype.toString,PS=(mf=Object.create(null),function(o){var n=Gg.call(o);return mf[n]||(mf[n]=n.slice(8,-1).toLowerCase())});function gd(o){return o=o.toLowerCase(),function(n){return PS(n)===o}}function MS(o){return Array.isArray(o)}function Wg(o){return void 0===o}var kS=gd("ArrayBuffer");function Mk(o){return null!==o&&"object"==typeof o}function _f(o){if("object"!==PS(o))return!1;var n=Object.getPrototypeOf(o);return null===n||n===Object.prototype}var kk=gd("Date"),xk=gd("File"),vU=gd("Blob"),Lk=gd("FileList");function xS(o){return"[object Function]"===Gg.call(o)}var Fk=gd("URLSearchParams");function LS(o,n){if(null!=o)if("object"!=typeof o&&(o=[o]),MS(o))for(var r=0,s=o.length;r<s;r++)n.call(null,o[r],r,o);else for(var c in o)Object.prototype.hasOwnProperty.call(o,c)&&n.call(null,o[c],c,o)}var FS,Uk=(FS=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(o){return FS&&o instanceof FS}),rr={isArray:MS,isArrayBuffer:kS,isBuffer:function(o){return null!==o&&!Wg(o)&&null!==o.constructor&&!Wg(o.constructor)&&"function"==typeof o.constructor.isBuffer&&o.constructor.isBuffer(o)},isFormData:function(o){var n="[object FormData]";return o&&("function"==typeof FormData&&o instanceof FormData||Gg.call(o)===n||xS(o.toString)&&o.toString()===n)},isArrayBufferView:function(o){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(o):o&&o.buffer&&kS(o.buffer)},isString:function(o){return"string"==typeof o},isNumber:function(o){return"number"==typeof o},isObject:Mk,isPlainObject:_f,isUndefined:Wg,isDate:kk,isFile:xk,isBlob:vU,isFunction:xS,isStream:function(o){return Mk(o)&&xS(o.pipe)},isURLSearchParams:Fk,isStandardBrowserEnv:function(){return(typeof navigator>"u"||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&typeof window<"u"&&typeof document<"u"},forEach:LS,merge:function o(){var n={};function r(d,h){n[h]=_f(n[h])&&_f(d)?o(n[h],d):_f(d)?o({},d):MS(d)?d.slice():d}for(var s=0,c=arguments.length;s<c;s++)LS(arguments[s],r);return n},extend:function(o,n,r){return LS(n,function(s,c){o[c]=r&&"function"==typeof s?AA(s,r):s}),o},trim:function(o){return o.trim?o.trim():o.replace(/^\s+|\s+$/g,"")},stripBOM:function(o){return 65279===o.charCodeAt(0)&&(o=o.slice(1)),o},inherits:function(o,n,r,s){o.prototype=Object.create(n.prototype,s),o.prototype.constructor=o,r&&Object.assign(o.prototype,r)},toFlatObject:function(o,n,r){var s,c,d,h={};n=n||{};do{for(c=(s=Object.getOwnPropertyNames(o)).length;c-- >0;)h[d=s[c]]||(n[d]=o[d],h[d]=!0);o=Object.getPrototypeOf(o)}while(o&&(!r||r(o,n))&&o!==Object.prototype);return n},kindOf:PS,kindOfTest:gd,endsWith:function(o,n,r){o=String(o),(void 0===r||r>o.length)&&(r=o.length);var s=o.indexOf(n,r-=n.length);return-1!==s&&s===r},toArray:function(o){if(!o)return null;var n=o.length;if(Wg(n))return null;for(var r=new Array(n);n-- >0;)r[n]=o[n];return r},isTypedArray:Uk,isFileList:Lk},ch=rr;function DA(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var OA=function(o,n,r){if(!n)return o;var s;if(r)s=r(n);else if(ch.isURLSearchParams(n))s=n.toString();else{var c=[];ch.forEach(n,function(h,p){null!=h&&(ch.isArray(h)?p+="[]":h=[h],ch.forEach(h,function(m){ch.isDate(m)?m=m.toISOString():ch.isObject(m)&&(m=JSON.stringify(m)),c.push(DA(p)+"="+DA(m))}))}),s=c.join("&")}if(s){var d=o.indexOf("#");-1!==d&&(o=o.slice(0,d)),o+=(-1===o.indexOf("?")?"?":"&")+s}return o},Vk=rr;function zg(){this.handlers=[]}zg.prototype.use=function(o,n,r){return this.handlers.push({fulfilled:o,rejected:n,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},zg.prototype.eject=function(o){this.handlers[o]&&(this.handlers[o]=null)},zg.prototype.forEach=function(o){Vk.forEach(this.handlers,function(n){null!==n&&o(n)})};var lh,US,NA=zg,PA=rr;function Ed(){if(US)return lh;US=1;var o=rr;function n(c,d,h,p,m){Error.call(this),this.message=c,this.name="AxiosError",d&&(this.code=d),h&&(this.config=h),p&&(this.request=p),m&&(this.response=m)}o.inherits(n,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var r=n.prototype,s={};return["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(c){s[c]={value:c}}),Object.defineProperties(n,s),Object.defineProperty(r,"isAxiosError",{value:!0}),n.from=function(c,d,h,p,m,_){var g=Object.create(r);return o.toFlatObject(c,g,function(v){return v!==Error.prototype}),n.call(g,c.message,d,h,p,m),g.name=c.name,_&&Object.assign(g,_),g},lh=n}var Kg,gf,MA,Bk,dh,kA,xA={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};function LA(){if(gf)return Kg;gf=1;var o=rr;return Kg=function(n,r){r=r||new FormData;var s=[];function c(d){return null===d?"":o.isDate(d)?d.toISOString():o.isArrayBuffer(d)||o.isTypedArray(d)?"function"==typeof Blob?new Blob([d]):Buffer.from(d):d}return function d(h,p){if(o.isPlainObject(h)||o.isArray(h)){if(-1!==s.indexOf(h))throw Error("Circular reference detected in "+p);s.push(h),o.forEach(h,function(m,_){if(!o.isUndefined(m)){var g,v=p?p+"."+_:_;if(m&&!p&&"object"==typeof m)if(o.endsWith(_,"{}"))m=JSON.stringify(m);else if(o.endsWith(_,"[]")&&(g=o.toArray(m)))return void g.forEach(function(b){!o.isUndefined(b)&&r.append(v,c(b))});d(m,v)}}),s.pop()}else r.append(p,c(h))}(n),r}}var VS,qg,rn,FA,Yg,ba,UA,VA,BS,vf,xo,BA,jS=function(o,n){return o&&!function(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}(n)?function(o,n){return n?o.replace(/\/+$/,"")+"/"+n.replace(/^\/+/,""):o}(o,n):n};function uh(){if(ba)return Yg;ba=1;var o=Ed();function n(r){o.call(this,r??"canceled",o.ERR_CANCELED),this.name="CanceledError"}return rr.inherits(n,o,{__CANCEL__:!0}),Yg=n}var Mi=rr,$g=function(o,n){PA.forEach(o,function(r,s){s!==n&&s.toUpperCase()===n.toUpperCase()&&(o[n]=r,delete o[s])})},WA=Ed(),Gk=xA,Wk=LA(),zk={"Content-Type":"application/x-www-form-urlencoded"};function WS(o,n){!Mi.isUndefined(o)&&Mi.isUndefined(o["Content-Type"])&&(o["Content-Type"]=n)}var Xg,_i={transitional:Gk,adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&"[object process]"===Object.prototype.toString.call(process))&&(Xg=function GA(){if(vf)return BS;vf=1;var o=rr,n=function jk(){if(Bk)return MA;Bk=1;var o=Ed();return MA=function(n,r,s){var c=s.config.validateStatus;s.status&&c&&!c(s.status)?r(new o("Request failed with status code "+s.status,[o.ERR_BAD_REQUEST,o.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):n(s)}}(),r=function Ef(){if(kA)return dh;kA=1;var o=rr;return dh=o.isStandardBrowserEnv()?{write:function(n,r,s,c,d,h){var p=[];p.push(n+"="+encodeURIComponent(r)),o.isNumber(s)&&p.push("expires="+new Date(s).toGMTString()),o.isString(c)&&p.push("path="+c),o.isString(d)&&p.push("domain="+d),!0===h&&p.push("secure"),document.cookie=p.join("; ")},read:function(n){var r=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove:function(n){this.write(n,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}}(),s=OA,c=jS,d=function HS(){if(qg)return VS;qg=1;var o=rr,n=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return VS=function(r){var s,c,d,h={};return r&&o.forEach(r.split("\n"),function(p){if(d=p.indexOf(":"),s=o.trim(p.substr(0,d)).toLowerCase(),c=o.trim(p.substr(d+1)),s){if(h[s]&&n.indexOf(s)>=0)return;h[s]="set-cookie"===s?(h[s]?h[s]:[]).concat([c]):h[s]?h[s]+", "+c:c}}),h}}(),h=function HA(){if(FA)return rn;FA=1;var o=rr;return rn=o.isStandardBrowserEnv()?function(){var n,r=/(msie|trident)/i.test(navigator.userAgent),s=document.createElement("a");function c(d){var h=d;return r&&(s.setAttribute("href",h),h=s.href),s.setAttribute("href",h),{href:s.href,protocol:s.protocol?s.protocol.replace(/:$/,""):"",host:s.host,search:s.search?s.search.replace(/^\?/,""):"",hash:s.hash?s.hash.replace(/^#/,""):"",hostname:s.hostname,port:s.port,pathname:"/"===s.pathname.charAt(0)?s.pathname:"/"+s.pathname}}return n=c(window.location.href),function(d){var h=o.isString(d)?c(d):d;return h.protocol===n.protocol&&h.host===n.host}}():function(){return!0}}(),p=xA,m=Ed(),_=uh(),g=function GS(){return VA||(VA=1,UA=function(o){var n=/^([-+\w]{1,25})(:?\/\/|:)/.exec(o);return n&&n[1]||""}),UA}();return BS=function(v){return new Promise(function(b,C){var N,P=v.data,D=v.headers,k=v.responseType;function V(){v.cancelToken&&v.cancelToken.unsubscribe(N),v.signal&&v.signal.removeEventListener("abort",N)}o.isFormData(P)&&o.isStandardBrowserEnv()&&delete D["Content-Type"];var U=new XMLHttpRequest;if(v.auth){var Y=v.auth.username||"",oe=v.auth.password?unescape(encodeURIComponent(v.auth.password)):"";D.Authorization="Basic "+btoa(Y+":"+oe)}var K=c(v.baseURL,v.url);function X(){if(U){var ve="getAllResponseHeaders"in U?d(U.getAllResponseHeaders()):null;n(function(Ye){b(Ye),V()},function(Ye){C(Ye),V()},{data:k&&"text"!==k&&"json"!==k?U.response:U.responseText,status:U.status,statusText:U.statusText,headers:ve,config:v,request:U}),U=null}}if(U.open(v.method.toUpperCase(),s(K,v.params,v.paramsSerializer),!0),U.timeout=v.timeout,"onloadend"in U?U.onloadend=X:U.onreadystatechange=function(){U&&4===U.readyState&&(0!==U.status||U.responseURL&&0===U.responseURL.indexOf("file:"))&&setTimeout(X)},U.onabort=function(){U&&(C(new m("Request aborted",m.ECONNABORTED,v,U)),U=null)},U.onerror=function(){C(new m("Network Error",m.ERR_NETWORK,v,U,U)),U=null},U.ontimeout=function(){var ve=v.timeout?"timeout of "+v.timeout+"ms exceeded":"timeout exceeded";v.timeoutErrorMessage&&(ve=v.timeoutErrorMessage),C(new m(ve,(v.transitional||p).clarifyTimeoutError?m.ETIMEDOUT:m.ECONNABORTED,v,U)),U=null},o.isStandardBrowserEnv()){var $=(v.withCredentials||h(K))&&v.xsrfCookieName?r.read(v.xsrfCookieName):void 0;$&&(D[v.xsrfHeaderName]=$)}"setRequestHeader"in U&&o.forEach(D,function(ve,ye){void 0===P&&"content-type"===ye.toLowerCase()?delete D[ye]:U.setRequestHeader(ye,ve)}),o.isUndefined(v.withCredentials)||(U.withCredentials=!!v.withCredentials),k&&"json"!==k&&(U.responseType=v.responseType),"function"==typeof v.onDownloadProgress&&U.addEventListener("progress",v.onDownloadProgress),"function"==typeof v.onUploadProgress&&U.upload&&U.upload.addEventListener("progress",v.onUploadProgress),(v.cancelToken||v.signal)&&(N=function(ve){U&&(C(!ve||ve&&ve.type?new _:ve),U.abort(),U=null)},v.cancelToken&&v.cancelToken.subscribe(N),v.signal&&(v.signal.aborted?N():v.signal.addEventListener("abort",N))),P||(P=null);var J=g(K);J&&-1===["http","https","file"].indexOf(J)?C(new m("Unsupported protocol "+J+":",m.ERR_BAD_REQUEST,v)):U.send(P)})}}()),Xg),transformRequest:[function(o,n){if($g(n,"Accept"),$g(n,"Content-Type"),Mi.isFormData(o)||Mi.isArrayBuffer(o)||Mi.isBuffer(o)||Mi.isStream(o)||Mi.isFile(o)||Mi.isBlob(o))return o;if(Mi.isArrayBufferView(o))return o.buffer;if(Mi.isURLSearchParams(o))return WS(n,"application/x-www-form-urlencoded;charset=utf-8"),o.toString();var r,s=Mi.isObject(o),c=n&&n["Content-Type"];if((r=Mi.isFileList(o))||s&&"multipart/form-data"===c){var d=this.env&&this.env.FormData;return Wk(r?{"files[]":o}:o,d&&new d)}return s||"application/json"===c?(WS(n,"application/json"),function(h,p,m){if(Mi.isString(h))try{return(0,JSON.parse)(h),Mi.trim(h)}catch(_){if("SyntaxError"!==_.name)throw _}return(0,JSON.stringify)(h)}(o)):o}],transformResponse:[function(o){var n=this.transitional||_i.transitional,c=!(n&&n.silentJSONParsing)&&"json"===this.responseType;if(c||n&&n.forcedJSONParsing&&Mi.isString(o)&&o.length)try{return JSON.parse(o)}catch(d){if(c)throw"SyntaxError"===d.name?WA.from(d,WA.ERR_BAD_RESPONSE,this,null,this.response):d}return o}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:BA?xo:(BA=1,xo=null)},validateStatus:function(o){return o>=200&&o<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Mi.forEach(["delete","get","head"],function(o){_i.headers[o]={}}),Mi.forEach(["post","put","patch"],function(o){_i.headers[o]=Mi.merge(zk)});var ls,Sa,bi=_i,Kk=rr,zA=bi;function zS(){return Sa?ls:(Sa=1,ls=function(o){return!(!o||!o.__CANCEL__)})}var KA=rr,Jg=function(o,n,r){var s=this||zA;return Kk.forEach(r,function(c){o=c.call(s,o,n)}),o},KS=zS(),Hr=bi,hh=uh();function qS(o){if(o.cancelToken&&o.cancelToken.throwIfRequested(),o.signal&&o.signal.aborted)throw new hh}var qA,qk,ds=rr,YS=function(o,n){n=n||{};var r={};function s(_,g){return ds.isPlainObject(_)&&ds.isPlainObject(g)?ds.merge(_,g):ds.isPlainObject(g)?ds.merge({},g):ds.isArray(g)?g.slice():g}function c(_){return ds.isUndefined(n[_])?ds.isUndefined(o[_])?void 0:s(void 0,o[_]):s(o[_],n[_])}function d(_){if(!ds.isUndefined(n[_]))return s(void 0,n[_])}function h(_){return ds.isUndefined(n[_])?ds.isUndefined(o[_])?void 0:s(void 0,o[_]):s(void 0,n[_])}function p(_){return _ in n?s(o[_],n[_]):_ in o?s(void 0,o[_]):void 0}var m={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:p};return ds.forEach(Object.keys(o).concat(Object.keys(n)),function(_){var g=m[_]||c,v=g(_);ds.isUndefined(v)&&g!==p||(r[_]=v)}),r};function Qg(){return qk?qA:(qk=1,qA={version:"0.27.2"})}var yf=Qg().version,Gc=Ed(),bf={};["object","boolean","number","function","string","symbol"].forEach(function(o,n){bf[o]=function(r){return typeof r===o||"a"+(n<1?"n ":" ")+o}});var YA={};bf.transitional=function(o,n,r){function s(c,d){return"[Axios v"+yf+"] Transitional option '"+c+"'"+d+(r?". "+r:"")}return function(c,d,h){if(!1===o)throw new Gc(s(d," has been removed"+(n?" in "+n:"")),Gc.ERR_DEPRECATED);return n&&!YA[d]&&(YA[d]=!0,console.warn(s(d," has been deprecated since v"+n+" and will be removed in the near future"))),!o||o(c,d,h)}};var $S,$A,XA,JA,Zg,XS,Sf=rr,JS=OA,Yk=NA,QS=function(o){return qS(o),o.headers=o.headers||{},o.data=Jg.call(o,o.data,o.headers,o.transformRequest),o.headers=KA.merge(o.headers.common||{},o.headers[o.method]||{},o.headers),KA.forEach(["delete","get","head","post","put","patch","common"],function(n){delete o.headers[n]}),(o.adapter||Hr.adapter)(o).then(function(n){return qS(o),n.data=Jg.call(o,n.data,n.headers,o.transformResponse),n},function(n){return KS(n)||(qS(o),n&&n.response&&(n.response.data=Jg.call(o,n.response.data,n.response.headers,o.transformResponse))),Promise.reject(n)})},eE=YS,ZA=jS,vd={assertOptions:function(o,n,r){if("object"!=typeof o)throw new Gc("options must be an object",Gc.ERR_BAD_OPTION_VALUE);for(var s=Object.keys(o),c=s.length;c-- >0;){var d=s[c],h=n[d];if(h){var p=o[d],m=void 0===p||h(p,d,o);if(!0!==m)throw new Gc("option "+d+" must be "+m,Gc.ERR_BAD_OPTION_VALUE)}else if(!0!==r)throw new Gc("Unknown option "+d,Gc.ERR_BAD_OPTION)}},validators:bf},ph=vd.validators;function yd(o){this.defaults=o,this.interceptors={request:new Yk,response:new Yk}}yd.prototype.request=function(o,n){"string"==typeof o?(n=n||{}).url=o:n=o||{},n.method=(n=eE(this.defaults,n)).method?n.method.toLowerCase():this.defaults.method?this.defaults.method.toLowerCase():"get";var r=n.transitional;void 0!==r&&vd.assertOptions(r,{silentJSONParsing:ph.transitional(ph.boolean),forcedJSONParsing:ph.transitional(ph.boolean),clarifyTimeoutError:ph.transitional(ph.boolean)},!1);var s=[],c=!0;this.interceptors.request.forEach(function(v){"function"==typeof v.runWhen&&!1===v.runWhen(n)||(c=c&&v.synchronous,s.unshift(v.fulfilled,v.rejected))});var d,h=[];if(this.interceptors.response.forEach(function(v){h.push(v.fulfilled,v.rejected)}),!c){var p=[QS,void 0];for(Array.prototype.unshift.apply(p,s),p=p.concat(h),d=Promise.resolve(n);p.length;)d=d.then(p.shift(),p.shift());return d}for(var m=n;s.length;){var _=s.shift(),g=s.shift();try{m=_(m)}catch(v){g(v);break}}try{d=QS(m)}catch(v){return Promise.reject(v)}for(;h.length;)d=d.then(h.shift(),h.shift());return d},yd.prototype.getUri=function(o){o=eE(this.defaults,o);var n=ZA(o.baseURL,o.url);return JS(n,o.params,o.paramsSerializer)},Sf.forEach(["delete","get","head","options"],function(o){yd.prototype[o]=function(n,r){return this.request(eE(r||{},{method:o,url:n,data:(r||{}).data}))}}),Sf.forEach(["post","put","patch"],function(o){function n(r){return function(s,c,d){return this.request(eE(d||{},{method:o,headers:r?{"Content-Type":"multipart/form-data"}:{},url:s,data:c}))}}yd.prototype[o]=n(),yd.prototype[o+"Form"]=n(!0)});var tE=rr,yU=NS,nE=yd,bU=YS,co=function o(n){var r=new nE(n),s=yU(nE.prototype.request,r);return tE.extend(s,nE.prototype,r),tE.extend(s,r),s.create=function(c){return o(bU(n,c))},s}(bi);co.Axios=nE,co.CanceledError=uh(),co.CancelToken=function(){if($A)return $S;$A=1;var o=uh();function n(r){if("function"!=typeof r)throw new TypeError("executor must be a function.");var s;this.promise=new Promise(function(d){s=d});var c=this;this.promise.then(function(d){if(c._listeners){var h,p=c._listeners.length;for(h=0;h<p;h++)c._listeners[h](d);c._listeners=null}}),this.promise.then=function(d){var h,p=new Promise(function(m){c.subscribe(m),h=m}).then(d);return p.cancel=function(){c.unsubscribe(h)},p},r(function(d){c.reason||(c.reason=new o(d),s(c.reason))})}return n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.prototype.subscribe=function(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]},n.prototype.unsubscribe=function(r){if(this._listeners){var s=this._listeners.indexOf(r);-1!==s&&this._listeners.splice(s,1)}},n.source=function(){var r;return{token:new n(function(s){r=s}),cancel:r}},$S=n}(),co.isCancel=zS(),co.VERSION=Qg().version,co.toFormData=LA(),co.AxiosError=Ed(),co.Cancel=co.CanceledError,co.all=function(o){return Promise.all(o)},co.spread=JA?XA:(JA=1,XA=function(o){return function(n){return o.apply(null,n)}}),co.isAxiosError=function(){if(XS)return Zg;XS=1;var o=rr;return Zg=function(n){return o.isObject(n)&&!0===n.isAxiosError}}(),Hg.exports=co,Hg.exports.default=co;var Tr=dr(Hg.exports);function eD(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function ZS(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?eD(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):eD(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}let Cf,iE=0,rE=0;function oE(o,n,r,s){return new z((c,d)=>{n.responseType=n.responseType||"json",n.data&&!r?(n.data=JSON.stringify(n.data),iE+=ya(n.data)):r&&(n.data.size?iE+=n.data.size:n.data instanceof FormData?iE+=SA(n.data):iE+=ya(JSON.stringify(n.data))),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json",n.method="POST",n.url=o,Tr.request(n).then(h=>{"string"==typeof h.data?rE+=ya(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?rE+=h.data.byteLength:rE+=ya(JSON.stringify(h.data)),s&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{Tr.isCancel(h)?d(new Q(M.OPERATION_ABORTED,"cancel token canceled")):d("ECONNABORTED"===h.code?new Q(M.NETWORK_TIMEOUT,h.message):h.response?new Q(M.NETWORK_RESPONSE_ERROR,h.response.status):new Q(M.NETWORK_ERROR,h.message))})})}function $k(o,n){return eC.apply(this,arguments)}function eC(){return eC=x(function*(o,n){const r=new Blob([n.data],{type:"buffer"});return yield oE(o,ZS(ZS({},n),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}),eC.apply(this,arguments)}const nD=()=>void 0!==window.isSecureContext;function tC(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function we(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?tC(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):tC(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}var tt;!function(o){o.SET_SESSION_ID="SET_SESSION_ID",o.SET_P2P_ID="SET_P2P_id",o.SET_DC_ID="SET_DC_id",o.SET_UID="SET_UID",o.SET_PUB_ID="SET_PUB_ID",o.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",o.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",o.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",o.AVOID_JOIN_START="AVOID_JOIN_START",o.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",o.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",o.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",o.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",o.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",o.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",o.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",o.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",o.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",o.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",o.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",o.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",o.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",o.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",o.RESET_KEY_METRICS="RESET_KEY_METRICS",o.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",o.SET_USE_P2P="SET_USE_P2P"}(tt||(tt={}));class iD{constructor(n,r,s,c){S(this,"state",void 0),this.state={codec:n,audioCodec:r,mode:s,clientId:c,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1}}dispatch(n){this.state=function(r,s){switch(s.type){case tt.SET_SESSION_ID:return we(we({},r),{},{sessionId:s.sessionId});case tt.SET_P2P_ID:return we(we({},r),{},{p2pId:s.p2pId});case tt.SET_UID:return we(we({},r),{},{uid:s.uid});case tt.SET_PUB_ID:return we(we({},r),{},{pubId:s.pubId});case tt.KEY_METRIC_CLIENT_CREATED:return we(we({},r),{},{keyMetrics:we(we({},r.keyMetrics),{},{clientCreated:s.metric})});case tt.KEY_METRIC_JOIN_START:return we(we({},r),{},{keyMetrics:we(we({},r.keyMetrics),{},{joinStart:s.metric})});case tt.AVOID_JOIN_START:return we(we({},r),{},{avoidJoinStart:s.avoidJoinStart});case tt.KEY_METRIC_JOIN_END:return we(we({},r),{},{keyMetrics:we(we({},r.keyMetrics),{},{joinEnd:s.metric})});case tt.KEY_METRIC_REQUEST_AP_START:return we(we({},r),{},{keyMetrics:we(we({},r.keyMetrics),{},{requestAPStart:s.metric})});case tt.KEY_METRIC_REQUEST_AP_END:return we(we({},r),{},{keyMetrics:we(we({},r.keyMetrics),{},{requestAPEnd:s.metric})});case tt.KEY_METRIC_JOIN_GATEWAY_START:return we(we({},r),{},{keyMetrics:we(we({},r.keyMetrics),{},{joinGatewayStart:s.metric})});case tt.KEY_METRIC_JOIN_GATEWAY_END:return we(we({},r),{},{keyMetrics:we(we({},r.keyMetrics),{},{joinGatewayEnd:s.metric})});case tt.KEY_METRIC_PEER_CONNECTION_START:return we(we({},r),{},{keyMetrics:we(we({},r.keyMetrics),{},{peerConnectionStart:s.metric})});case tt.KEY_METRIC_PEER_CONNECTION_END:return we(we({},r),{},{keyMetrics:we(we({},r.keyMetrics),{},{peerConnectionEnd:s.metric})});case tt.KEY_METRIC_DESCRIPTION_START:return we(we({},r),{},{keyMetrics:we(we({},r.keyMetrics),{},{descriptionStart:s.metric})});case tt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return we(we({},r),{},{keyMetrics:we(we({},r.keyMetrics),{},{signalChannelOpen:s.metric})});case tt.KEY_METRIC_ICE_CONNECTION_END:return we(we({},r),{},{keyMetrics:we(we({},r.keyMetrics),{},{iceConnectionEnd:s.metric})});case tt.KEY_METRIC_PUBLISH:{const c=r.keyMetrics.publish,d=c.findIndex(h=>h.trackId===s.metric.trackId);return-1!==d?(c[d]=we(we({},c[d]),s.metric),we(we({},r),{},{keyMetrics:we(we({},r.keyMetrics),{},{publish:[...c]})})):we(we({},r),{},{keyMetrics:we(we({},r.keyMetrics),{},{publish:[...r.keyMetrics.publish,s.metric]})})}case tt.KEY_METRIC_SUBSCRIBE:{const c=r.keyMetrics.subscribe,d=c.findIndex(h=>h.userId===s.metric.userId&&h.type===s.metric.type);return-1!==d?(c[d]=we(we({},c[d]),s.metric),we(we({},r),{},{keyMetrics:we(we({},r.keyMetrics),{},{subscribe:[...c]})})):we(we({},r),{},{keyMetrics:we(we({},r.keyMetrics),{},{subscribe:[...r.keyMetrics.subscribe,s.metric]})})}case tt.SET_CLOUD_PROXY_SERVER_MODE:return r.cloudProxyServerMode=s.mode,r;case tt.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof s.index?r.joinChannelServiceRecords=[...r.joinChannelServiceRecords,s.record]:(r.joinChannelServiceRecords[s.index]=we(we({},r.joinChannelServiceRecords[s.index]),s.record),r.joinChannelServiceRecords=[...r.joinChannelServiceRecords]),r;case tt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return r.joinChannelServiceRecords=[],r;case tt.RESET_KEY_METRICS:return r.keyMetrics={publish:[],subscribe:[]},r;case tt.SET_USE_DATACHANNEL:return we(we({},r),{},{useDataChannel:s.val});case tt.SET_USE_P2P:return we(we({},r),{},{useP2P:s.val});default:return r}}(this.state,n)}set sessionId(n){this.dispatch({type:tt.SET_SESSION_ID,sessionId:n})}get sessionId(){return this.state.sessionId}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(n){this.dispatch({type:tt.SET_P2P_ID,p2pId:n})}get p2pId(){return this.state.p2pId}set dcId(n){this.dispatch({type:tt.SET_DC_ID,dcId:n})}get dcId(){return this.state.dcId}set uid(n){this.dispatch({type:tt.SET_UID,uid:n})}get uid(){return this.state.uid}set pubId(n){this.dispatch({type:tt.SET_PUB_ID,pubId:n})}get pubId(){return this.state.pubId}set cloudProxyServerMode(n){this.dispatch({type:tt.SET_CLOUD_PROXY_SERVER_MODE,mode:n})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(n){this.dispatch({type:tt.SET_USE_DATACHANNEL,val:n})}get useDataChannel(){return this.state.useDataChannel}set useP2P(n){this.dispatch({type:tt.SET_USE_P2P,val:n})}get useP2P(){return this.state.useP2P}clientCreated(){this.dispatch({type:tt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:tt.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:tt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:tt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:tt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:tt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:tt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:tt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:tt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:tt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:tt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:tt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(n,r,s,c){this.dispatch({type:tt.KEY_METRIC_PUBLISH,metric:we(we({trackId:n,type:r},s&&{publishStart:s}),c&&{publishEnd:c})})}subscribe(n,r,s,c,d,h,p){this.dispatch({type:tt.KEY_METRIC_SUBSCRIBE,metric:we(we(we(we(we({userId:n,type:r},s&&{subscribeStart:s}),c&&{subscribeEnd:c}),d&&{firstFrame:d}),h&&{streamAdded:h}),p&&{firstDecoded:p})})}massSubscribe(n,r,s,c){n.forEach(d=>{this.dispatch({type:tt.KEY_METRIC_SUBSCRIBE,metric:we(we(we({userId:d.userId,type:d.type},r&&{subscribeStart:r}),s&&{subscribeEnd:s}),c&&{firstFrame:c})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(n,r){"gateway"===n.service&&Array.isArray(n.urls)&&(n.urls=n.urls.map(s=>s.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return"number"!=typeof r?(this.dispatch({type:tt.RECORD_JOIN_CHANNEL_SERVICE,record:we(we({},n),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(r<0||r>=this.state.joinChannelServiceRecords.length||this.dispatch({type:tt.RECORD_JOIN_CHANNEL_SERVICE,record:n,index:r}),r)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:tt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:tt.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(n){this.dispatch({type:tt.AVOID_JOIN_START,avoidJoinStart:n})}}const Lo=function(o){if(o.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return o;const n=o.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(n&&n[1]&&n[2]){const c=n[2];return"".concat(n[1],".").concat(c)}const r=o.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(r&&r[1]&&r[2]){const c=r[2];return"".concat(r[1],".").concat(100*(Number(c)+1))}return"4.0.0.999"}("4.19.1"),nC=function(){try{return!0===JSON.parse("true")}catch{return!0}}(),rD="v4.19.1-0-g605286cc(10/11/2023, 2:37:03 PM)",Yi={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,RTM2_FLAG:void 0,AP_RTM:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,USE_XR:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:1e4,P2P:!1,SHOW_P2P_LOG:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0}};function kt(o,n,r){var s,c;Re(s=Object.keys(Yi)).call(s,o)&&(!r&&Re(c=Object.keys(bd)).call(c,o)||(Yi[o]=n))}function B(o){return Yi[o]}const bd={},iC=new class extends Yt{reportLogUploadError(o){this.emit("REPORT_LOG_UPLOAD",o)}};class SU{constructor(n){S(this,"logger",void 0),S(this,"prefixLists",[]),this.logger=n}debug(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];this.logger.debug(...this.prefixLists,...r)}info(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];this.logger.info(...this.prefixLists,...r)}warning(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];this.logger.warning(...this.prefixLists,...r)}error(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];this.logger.error(...this.prefixLists,...r)}prefix(n){return this.prefixLists.push(n),this}popPrefix(){return this.prefixLists.pop(),this}}function oD(){const o=new Date;return o.toTimeString().split(" ")[0]+":"+o.getMilliseconds()}function Xk(){const o=new Date,n=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return n?n?.[0]+":"+o.getUTCMilliseconds():o.toTimeString().split(" ")[0]+":"+o.getMilliseconds()}const us={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Sd=Date.now(),sE=o=>{for(const n in us)if(Object.prototype.hasOwnProperty.call(us,n)&&us[n]===o)return n;return"DEFAULT"},w=new class{constructor(){S(this,"proxyServerURL",void 0),S(this,"logLevel",us.DEBUG),S(this,"uploadState","collecting"),S(this,"uploadLogWaitingList",[]),S(this,"uploadLogUploadingList",[]),S(this,"uploadErrorCount",0),S(this,"currentLogID",0),S(this,"url",void 0),S(this,"extLog",(o,n)=>{this.appendLogToWaitingList(o,...n)})}debug(){for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];const s=[us.DEBUG].concat(n);this.log.apply(this,s)}info(){for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];const s=[us.INFO].concat(n);this.log.apply(this,s)}warning(){for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];const s=[us.WARNING].concat(n);this.log.apply(this,s)}warn(){this.warning(...arguments)}error(){for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];const s=[us.ERROR].concat(n);this.log.apply(this,s)}upload(){for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];const s=[us.DEBUG].concat(n);this.uploadLog.apply(this,s)}setLogLevel(o){o=Math.min(Math.max(0,o),4),this.logLevel=o}enableLogUpload(){kt("UPLOAD_LOG",!0)}disableLogUpload(){kt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(o){this.proxyServerURL=o}prefix(o){return new SU(this).prefix(o)}log(){for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];if(Date.now()-Sd<100)return void setTimeout(()=>{this.log(...n)},Date.now()-Sd);const s=Math.max(0,Math.min(4,n[0]));if(n[0]=oD()+" Agora-SDK [".concat(sE(s),"]:"),this.appendLogToWaitingList(s,...n),s<this.logLevel)return;const c=oD()+" %cAgora-SDK [".concat(sE(s),"]:");let d=[];if(!B("USE_NEW_LOG"))switch(s){case us.DEBUG:d=[c,"color: #64B5F6;"].concat(n.slice(1)),console.log.apply(console,d);break;case us.INFO:d=[c,"color: #1E88E5; font-weight: bold;"].concat(n.slice(1)),console.log.apply(console,d);break;case us.WARNING:d=[c,"color: #FB8C00; font-weight: bold;"].concat(n.slice(1)),console.warn.apply(console,d);break;case us.ERROR:d=[c,"color: #B00020; font-weight: bold;"].concat(n.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];if(Date.now()-Sd<100)return void setTimeout(()=>{this.uploadLog(...n)},Date.now()-Sd);const s=Math.max(0,Math.min(4,n[0]));n[0]=oD()+" Agora-SDK [".concat(sE(s),"]:"),this.appendLogToWaitingList(s,...n)}appendLogToWaitingList(o){if(!B("UPLOAD_LOG"))return;for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];Array.isArray(r[0])?r[0][0]=Xk()+" Agora-SDK [".concat(sE(o),"]:"):r[0]=Xk()+" Agora-SDK [".concat(sE(o),"]:");let c="";r.forEach(d=>{"object"==typeof d&&(d=JSON.stringify(d)),c+="".concat(d," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:o,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}uploadLogs(){var o=this;return x(function*(){const n=o.uploadLogUploadingList,r={sdk_version:Lo,process_id:B("PROCESS_ID"),payload:JSON.stringify(n)};return Ws(x(function*(){const s=yield Tr.post(o.url||(o.proxyServerURL?"https://".concat(o.proxyServerURL,"/ls/?h=").concat(B("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(B("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if("OK"!==s.data){const c=new Error("unexpected upload log response");throw c.response=s,c}}),()=>(o.uploadLogUploadingList=[],!1),s=>(iC.reportLogUploadError(s.response?{status:s.response.status,data:s.response.data,headers:s.response.headers,message:s.message}:s.request?{status:s.request.status,message:s.message}:{status:-1,message:s.message}),!0),{timeout:B("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:B("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})})()}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,B("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),B("UPLOAD_LOG_INTERVAL"))}).catch(o=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),B("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),B("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var Tf,Cd;function sD(o){return fi(o.reportId,"params.reportId",0,100,!1),fi(o.category,"params.category",0,100,!1),fi(o.event,"params.event",0,100,!1),fi(o.label,"params.label",0,100,!1),wt(o.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(function(o){o.FREE="free",o.UPLOADING="uploading"})(Tf||(Tf={})),function(o){o[o.MISC=0]="MISC",o[o.INTERNAL_EVENT=1]="INTERNAL_EVENT",o[o.PUBLIC_EVENT=2]="PUBLIC_EVENT",o[o.WEB_EVENT=3]="WEB_EVENT",o[o.INTERNAL_API=4]="INTERNAL_API",o[o.WEB_API=5]="WEB_API",o[o.PUBLIC_API=6]="PUBLIC_API"}(Cd||(Cd={}));const CU={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var Bn,zt,aE,Jk;function Ca(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function Ke(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?Ca(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):Ca(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}(function(o){o.PUBLISH="publish",o.SUBSCRIBE="subscribe",o.WS_COMPRESSOR_INIT="ws_compressor_init",o.SESSION_INIT="session_init",o.JOIN_CHOOSE_SERVER="join_choose_server",o.REQ_USER_ACCOUNT="req_user_account",o.JOIN_GATEWAY="join_gateway",o.REJOIN_GATEWAY="rejoin_gateway",o.STREAM_SWITCH="stream_switch",o.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",o.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",o.FIRST_VIDEO_RECEIVED="first_video_received",o.FIRST_AUDIO_RECEIVED="first_audio_received",o.FIRST_VIDEO_DECODE="first_video_decode",o.FIRST_AUDIO_DECODE="first_audio_decode",o.ON_ADD_AUDIO_STREAM="on_add_audio_stream",o.ON_ADD_VIDEO_STREAM="on_add_video_stream",o.ON_UPDATE_STREAM="on_update_stream",o.ON_REMOVE_STREAM="on_remove_stream",o.USER_ANALYTICS="req_user_analytics",o.PC_STATS="pc_stats"})(Bn||(Bn={})),function(o){o.SESSION="io.agora.pb.Wrtc.Session",o.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",o.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",o.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",o.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",o.PUBLISH="io.agora.pb.Wrtc.Publish",o.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",o.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",o.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",o.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",o.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",o.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",o.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",o.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",o.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",o.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",o.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",o.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",o.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",o.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",o.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",o.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",o.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",o.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",o.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",o.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",o.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",o.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",o.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",o.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",o.PC_STATS="io.agora.pb.Wrtc.PCStats"}(zt||(zt={})),function(o){o[o.WORKER_EVENT=156]="WORKER_EVENT",o[o.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(aE||(aE={})),function(o){o[o.SESSION=26]="SESSION",o[o.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",o[o.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",o[o.JOIN_GATEWAY=28]="JOIN_GATEWAY",o[o.PUBLISH=30]="PUBLISH",o[o.SUBSCRIBE=29]="SUBSCRIBE",o[o.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",o[o.STREAM_SWITCH=32]="STREAM_SWITCH",o[o.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",o[o.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",o[o.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",o[o.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",o[o.API_INVOKE=41]="API_INVOKE",o[o.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",o[o.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",o[o.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",o[o.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",o[o.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",o[o.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",o[o.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",o[o.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",o[o.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",o[o.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",o[o.WORKER_EVENT=156]="WORKER_EVENT",o[o.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",o[o.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",o[o.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",o[o.USER_ANALYTICS=1e4]="USER_ANALYTICS",o[o.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(Jk||(Jk={}));class wf{constructor(){var n=this;S(this,"baseInfoMap",new Map),S(this,"proxyServer",void 0),S(this,"eventUploadTimer",void 0),S(this,"setSessionIdTimer",void 0),S(this,"url",void 0),S(this,"backupUrl",void 0),S(this,"_appId",void 0),S(this,"keyEventUploadPendingItems",[]),S(this,"normalEventUploadPendingItems",[]),S(this,"apiInvokeUploadPendingItems",[]),S(this,"apiInvokeCount",0),S(this,"ltsList",[]),S(this,"lastSendNormalEventTime",Date.now()),S(this,"customReportCounterTimer",void 0),S(this,"customReportCount",0),S(this,"extApiInvoke",function(){var r=x(function*(s){for(const c of s){const d=Ke(Ke({},c),{},{sid:null,invokeId:++n.apiInvokeCount,tag:dn.TRACER});n.sendApiInvoke(d)}});return function(s){return r.apply(this,arguments)}}()),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),B("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),B("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(n){return this.baseInfoMap.get(n)}adjustSessionStartTime(n){if(!this.baseInfoMap.has(n)&&!this.baseInfoMap.get(n))return void w.error("adjust session ".concat(n," start time, sid is not exist or info is undefined"));const r=this.baseInfoMap.get(n),s=Date.now(),c=r.startTime;r.startTime=s,w.debug("rewrite session ".concat(n," startTime: ").concat(s," , ").concat(s-c,"ms")),this.baseInfoMap.set(n,r)}setAppId(n){this._appId=n}reportApiInvoke(n,r,s){r.timeout=r.timeout||6e4,r.reportResult=void 0===r.reportResult||r.reportResult;const c=Date.now();this.apiInvokeCount+=1;const d=this.apiInvokeCount,h=()=>({tag:r.tag,invokeId:d,sid:n,name:r.name,apiInvokeTime:c,options:r.options,states:r.states||null}),p=!!B("SHOW_REPORT_INVOKER_LOG");p&&w.info("".concat(r.name," start"),r.options);let m=!1;mi(r.timeout).then(()=>{m||(this.sendApiInvoke(Ke(Ke({},h()),{},{error:M.API_INVOKE_TIMEOUT,success:!1})),w.debug("".concat(r.name," timeout")))});const _=new Q(M.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:g=>{const v=()=>{if(m)throw _;return m=!0,this.sendApiInvoke(Ke(Ke({},h()),{},{success:!0},r.reportResult&&{result:g})),p&&w.info("".concat(r.name," onSuccess")),g};return s?RS(v,r.name+"Success",s,()=>m=!0):v()},onError:g=>{const v=()=>{if(m)throw g;m=!0,this.sendApiInvoke(Ke(Ke({},h()),{},{success:!1,error:g})),p&&w.info("".concat(r.name," onFailure"),g.toString())};return s?RS(v,r.name+"Error",s,()=>m=!0):v()}}}sessionInit(n,r){if(this.baseInfoMap.has(n))return;const s=Date.now(),c=this.createBaseInfo(n,s);c.cname=r.cname;const d=Object.assign({},{willUploadConsoleLog:B("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:nC?"global":"oversea",areas:B("AREAS")&&B("AREAS").join(",")},r.extend),h=Date.now(),p=Ke(Ke({},c),{},{eventType:Bn.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,build:rD,lts:h,elapse:h-s,extend:JSON.stringify(d),mode:r.mode,process:B("PROCESS_ID"),appType:B("APP_TYPE"),success:!0,version:Lo});this.send({type:zt.SESSION,data:p},!0)}joinChooseServer(n,r){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=Ke(Ke({},c),{},{eventType:Bn.JOIN_CHOOSE_SERVER,lts:d,eventElapse:d-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:d-s.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3});this.send({type:zt.JOIN_CHOOSE_SERVER,data:h},!0)}reqUserAccount(n,r){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=Ke(Ke({},c),{},{eventType:Bn.REQ_USER_ACCOUNT,lts:d,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:d-s.startTime,eventElapse:d-r.lts,extend:JSON.stringify(r.extend)});this.send({type:zt.REQ_USER_ACCOUNT,data:h},!0)}joinGateway(n,r){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info;r.vid&&(c.vid=r.vid),c.uid=r.uid,c.cid=r.cid;const d=Date.now(),{firstSuccess:h,avoidJoinStartTime:p,isProxy:m,addr:_}=r,g=d-(h&&p?p:s.startTime),v=Ke(Ke({},c),{},{eventType:Bn.JOIN_GATEWAY,lts:d,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,elapse:g,eventElapse:d-r.lts,firstSuccess:h,signalChannel:r.signalChannel}),b=v.success?1:0;if(r.succ&&(s.lastJoinSuccessTime=d),h)this.send({type:zt.JOIN_GATEWAY,data:v},!0);else{let C;if(_)if(m){const P=_.match(/h=(\d{1,3}-){3}\d{1,3}/g),D=_.match(/p=[0-9]{1,6}/g);C={isSuccess:b,gatewayIp:P&&P.length?P[0].split("=")[1].replace(/-/g,"."):"",port:D&&D.length?D[0].split("=")[1]:"",isProxy:m?1:0}}else{const P=_.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),D=_.match(/(:|p=)[0-9]{1,6}/g);C={isSuccess:b,gatewayIp:P&&P.length?P[0].split("//")[1].replace(/-/g,"."):"",port:D&&D.length?D[0].split(/:|p=/g)[1]:"",isProxy:m?1:0}}else C={isSuccess:b,gatewayIp:"",port:"",isProxy:m?1:0};delete v.success,delete v.eventType,delete v.firstSuccess,v.vid=Number(v.vid);const N=Object.assign({},v,C,{eventType:Bn.REJOIN_GATEWAY});this.send({type:zt.RE_JOIN_GATEWAY,data:N},!0)}}joinChannelTimeout(n,r){const s=this.baseInfoMap.get(n);if(!s)return;const c=Date.now(),d=Ke(Ke({},s.info),{},{lts:c,timeout:r,elapse:c-s.startTime});this.send({type:zt.JOIN_CHANNEL_TIMEOUT,data:d},!0)}publish(n,r){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=Ke(Ke({},c),{},{eventType:Bn.PUBLISH,lts:d,eventElapse:r.eventElapse,elapse:d-s.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:zt.PUBLISH,data:h},!0)}subscribe(n,r,s){const c=this.baseInfoMap.get(n);if(!c)return;const d=c.info,h=Date.now(),p=Ke(Ke({},d),{},{eventType:Bn.SUBSCRIBE,lts:h,eventElapse:r.eventElapse,elapse:h-c.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid},s&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof r.peerid?p.peerSuid=r.peerid:p.peer=r.peerid,this.send({type:zt.SUBSCRIBE,data:p},!0)}wsCompressorInit(n){var r;const s=[...oo(r=this.baseInfoMap).call(r)],d=this.baseInfoMap.get(s.length?s[0]:"UnableToGetSid");if(!d)return;const h=d.info,p=Date.now(),m=Ke(Ke({},h),{},{eventType:Bn.WS_COMPRESSOR_INIT,lts:p,eventElapse:n.eventElapse,elapse:p-d.startTime,status:n.status?1:2});this.send({type:zt.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(n,r,s,c){const d=this.baseInfoMap.get(n);if(!d)return;const h=d.info,p=Date.now(),m=Ke(Ke(Ke({},h),c),{},{elapse:p-d.startTime,eventType:r,lts:p,firstDecodeFrame:Math.max(p-d.startTime,0),apEnd:Math.max(c.apEnd-d.startTime,0),apStart:Math.max(c.apStart-d.startTime,0),joinGwEnd:Math.max(c.joinGwEnd-d.startTime,0),joinGwStart:Math.max(c.joinGwStart-d.startTime,0),pcEnd:Math.max(c.pcEnd-d.startTime,0),pcStart:Math.max(c.pcStart-d.startTime,0),subscriberEnd:Math.max(c.subscriberEnd-d.startTime,0),subscriberStart:Math.max(c.subscriberStart-d.startTime,0),videoAddNotify:Math.max(c.videoAddNotify-d.startTime,0)});this.send({type:s,data:m},!0)}firstRemoteFrame(n,r,s,c){const d=this.baseInfoMap.get(n);if(!d)return;const h=d.info,p=Date.now(),m=Ke(Ke(Ke({},h),c),{},{elapse:p-d.startTime,eventType:r,lts:p});this.send({type:s,data:m},!0)}pcStats(n,r){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=Ke(Ke(Ke({},c),r),{},{vid:void 0===c.vid?0:Number(c.vid),elapse:d-s.startTime,eventType:Bn.PC_STATS,lts:d});this.send({type:zt.PC_STATS,data:h},!0)}onGatewayStream(n,r,s,c){const d=this.baseInfoMap.get(n);if(!d)return;const h=d.info,p=Date.now(),m=Ke(Ke(Ke({},h),c),{},{eventType:r,lts:p});this.send({type:s,data:m},!0)}streamSwitch(n,r){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=Ke(Ke({},c),{},{eventType:Bn.STREAM_SWITCH,lts:d,isDual:r.isdual,elapse:d-s.startTime,success:r.succ});this.send({type:zt.STREAM_SWITCH,data:h},!0)}requestProxyAppCenter(n,r){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=Ke(Ke({},c),{},{eventType:Bn.REQUEST_PROXY_APPCENTER,lts:d,eventElapse:d-r.lts,elapse:d-s.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:zt.REQUEST_PROXY_APPCENTER,data:h},!0)}requestProxyWorkerManager(n,r){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=Ke(Ke({},c),{},{eventType:Bn.REQUEST_PROXY_WORKER_MANAGER,lts:d,eventElapse:d-r.lts,elapse:d-s.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:zt.REQUEST_PROXY_WORKER_MANAGER,data:h},!0)}setProxyServer(n){this.proxyServer=n,w.debug(n?"reportProxyServerurl: ".concat(n):"disable reportProxyServerurl: ".concat(n))}peerPublishStatus(n,r){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=Ke(Ke({},c),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:d,elapse:d-s.startTime,joinChannelSuccessElapse:d-(s.lastJoinSuccessTime||d),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:zt.PEER_PUBLISH_STATUS,data:h},!0)}workerEvent(n,r){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now();(function(p,m,_){const g=p[m];if(!g||"string"!=typeof g)return[p];p[m]="";const v=ya(JSON.stringify(p));let b=0;const C=[];let N=0;for(let P=0;P<g.length;P++)N+=g.charCodeAt(P)<=127?1:3,N<=1300-v||(C[C.length]=fd(fd({},p),{},{[m]:g.substring(b,P)}),b=P,N=g.charCodeAt(P)<=127?1:3);return b!==g.length-1&&(C[C.length]=fd(fd({},p),{},{[m]:g.substring(b)})),C})(Ke(Ke(Ke({},c),r),{},{elapse:d-s.startTime,lts:d,productType:"WebRTC"}),"payload").forEach(p=>this.send({type:zt.WORKER_EVENT,data:p},!0))}apworkerEvent(n,r){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=Ke(Ke(Ke({},c),r),{},{elapse:d-s.startTime,lts:d});this.send({type:zt.AP_WORKER_EVENT,data:h},!0)}joinWebProxyAP(n,r){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=Ke(Ke(Ke({},c),r),{},{elapse:d-s.startTime,lts:d,extend:r.extend||void 0});this.send({type:zt.JOIN_WEB_PROXY_AP,data:h},!0)}WebSocketQuit(n,r){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=Ke(Ke(Ke({},c),r),{},{elapse:d-s.startTime,lts:d});this.send({type:zt.WEBSOCKET_QUIT,data:h},!0)}sendCustomReportMessage(n,r){var s=this;return x(function*(){if(s.customReportCount+=r.length,s.customReportCount>B("CUSTOM_REPORT_LIMIT"))throw new Q(M.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);s.customReportCounterTimer||(s.customReportCounterTimer=window.setInterval(()=>{s.customReportCount=0},5e3));const c=Date.now(),d=r.map(h=>({type:zt.USER_ANALYTICS,data:Ke(Ke({sid:n},h),{},{lts:c})}));try{B("NEW_REPORT_SERVER")?yield s.postDataToStatsCollector2(d):yield s.postDataToStatsCollector(d)}catch(h){throw w.error("send custom report message failed",h.toString()),new Q(M.CUSTOM_REPORT_SEND_FAILED,h.message)}})()}sendApiInvoke(n){const r=B("NOT_REPORT_EVENT");if(n.tag&&Re(r)&&Re(r).call(r,n.tag))return!1;if(null===n.sid)return this.apiInvokeUploadPendingItems.push(n),!1;const s=this.baseInfoMap.get(n.sid);if(!s)return this.apiInvokeUploadPendingItems.push(n),!1;const{cname:c,uid:d,cid:h}=s.info;let p;if(n.lts=n.lts||Date.now(),n.error)if(n.error instanceof Q){const{code:_,message:g}=n.error;p=_||g||n.error.toString()}else p=n.error.toString();const m={invokeId:n.invokeId,sid:n.sid,cname:c,cid:h,uid:d,lts:n.lts,success:n.success,elapse:n.lts-s.startTime,execElapse:n.lts-n.apiInvokeTime,apiName:n.name,options:n.options?JSON.stringify(n.options):void 0,execStates:n.states?JSON.stringify(n.states):void 0,execResult:n.result?JSON.stringify(n.result):void 0,errorCode:n.error?p:void 0,errorMsg:n.error?JSON.stringify(n.error):void 0};return this.send({type:zt.API_INVOKE,data:m},!1),!0}appendSessionId(){wf.__CLIENT_LIST__.forEach(n=>{if(n._sessionId){const r=this.apiInvokeUploadPendingItems.length;for(let s=0;s<r;s++){const c=this.apiInvokeUploadPendingItems.shift();c&&(c.sid=n._sessionId,this.sendApiInvoke(Object.assign({},c)))}}})}send(n,r){if(r)return this.keyEventUploadPendingItems.push(n),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(n),this.normalEventUploadPendingItems.length>B("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(n,r){const s=[],c=[];for(;n.length;){const h=n.shift();s.length<20?s.push(h):c.push(h)}n.push(...c);for(const h of[...s]){var d;-1!==this.ltsList.indexOf(h.data.lts)?(h.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(h.data.lts)):(this.ltsList.push(h.data.lts),ie(d=this.ltsList).call(d,(p,m)=>p-m))}return r||(this.lastSendNormalEventTime=Date.now()),B("ENABLE_EVENT_REPORT")&&s.length&&(B("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((h=>p=>{B("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(h):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(h),this.normalEventUploadPendingItems.length>B("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-B("NORMAL_EVENT_QUEUE_CAPACITY")),w.warning("report: drop normal events"))))})(s)),n}postDataToStatsCollector2(n){var r=this;return x(function*(){Rn.networkState===li.OFFLINE&&(yield z.race([Rn.onlineWaiter,mi(2*bn.maxRetryTimeout)]));const s=h=>{let p=new Uint8Array;return h.forEach(m=>{const _=bS(JSON.stringify(m.data)),g=new ArrayBuffer(5),v=(C=>{let N=0;return Object.entries(zt).forEach(P=>{let[D,k]=P;k===C.type&&(N=EventNameToID[D])}),N})(m),b=new DataView(g);b.setUint16(0,_.byteLength,!0),b.setUint8(2,255&v),b.setUint8(3,v>>>8&255),b.setUint8(4,v>>>16&255),p=gA(p,new Uint8Array(g)),p=gA(p,_)}),p},c="event";let d=r.proxyServer?"https://".concat(r.proxyServer,"/rs/?h=").concat(B("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(c):"https://".concat(B("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(c);for(let h=0;h<2;h+=1){1===h&&(d=r.proxyServer?"https://".concat(r.proxyServer,"/rs/?h=").concat(B("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(c):"https://".concat(B("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(c));try{yield oE(d,{timeout:1e4,data:s(n),headers:Ke(Ke({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},r._appId&&{appid:r._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(p){if(1===h)throw p;continue}return}})()}postDataToStatsCollector(n){var r=arguments,s=this;return x(function*(){let c=r.length>1&&void 0!==r[1]&&r[1];const d={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:n.map(m=>JSON.stringify(m)),vid:(m=>{const _=m&&m.data.sid&&s.baseInfoMap.get(m.data.sid);return _&&_.info.vid&&+_.info.vid||0})(n[0])};Rn.networkState===li.OFFLINE&&(yield z.race([Rn.onlineWaiter,mi(2*bn.maxRetryTimeout)]));const h=c?"/events/proto-raws":"/events/messages";let p=s.url||(s.proxyServer?"https://".concat(s.proxyServer,"/rs/?h=").concat(B("EVENT_REPORT_DOMAIN"),"&p=").concat(B("STATS_COLLECTOR_PORT"),"&d=").concat(h):"https://".concat(B("EVENT_REPORT_DOMAIN"),":").concat(B("STATS_COLLECTOR_PORT")).concat(h));for(let m=0;m<2;m+=1){1===m&&(p=s.backupUrl||(s.proxyServer?"https://".concat(s.proxyServer,"/rs/?h=").concat(B("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(B("STATS_COLLECTOR_PORT"),"&d=").concat(h):"https://".concat(B("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(B("STATS_COLLECTOR_PORT")).concat(h)));try{c?yield $k(p,{timeout:1e4,data:d}):yield oE(p,{timeout:1e4,data:d})}catch(_){if(1===m)throw _;continue}return}})()}createBaseInfo(n,r){const s=Object.assign({},CU);return s.sid=n,this.baseInfoMap.set(n,{info:s,startTime:r}),s}reportResourceTiming(n,r){const s=performance.getEntriesByName(n),c=s[s.length-1];c&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:c,tag:dn.TRACER}).onSuccess()}}function Ie(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(n,r,s){const c=s.value;if("function"==typeof c){const d=o.className||n.__className__||("AgoraRTCClient"===n.constructor.name?"Client":n.constructor.name);s.value=function(){for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];let _=p;if(o.argsMap)try{_=o.argsMap(this,...p)}catch(v){w.warning(v),_=[]}try{JSON.stringify(_)}catch{w.warning("arguments for method ".concat(d,".").concat(String(r)," not serializable for apiInvoke.")),_=[]}const g=(o.report||Se).reportApiInvoke(this._sessionId||null,{name:"".concat(d,".").concat(String(r)),options:_,tag:dn.TRACER,reportResult:o.reportResult},o.throttleTime);try{const v=c.apply(this,p);return v instanceof z?v.then(b=>(g.onSuccess(o.reportResult&&b),b)).catch(b=>{throw g.onError(b),b}):(g.onSuccess(o.reportResult&&v),v)}catch(v){throw g.onError(v),v}}}return s}}S(wf,"__CLIENT_LIST__",[]);const Se=new wf;iC.on("REPORT_LOG_UPLOAD",o=>{o.networkState=Rn.networkState,Se.reportApiInvoke(null,{name:"logUploadError",options:o,tag:dn.TRACER})});const TU=["CHINA","GLOBAL"],Fo=function(){const o="us".concat("erna","me"),n="pa".concat("sswo","rd"),r=["t","s","t"];r.splice(1,0,"e");const s=r.join(""),c=[];for(let p=0;p<6;p++)c.push("1");const d=c.join(""),h={};return h[o]=s,h[n]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Fo,nC||(Yi.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Yi.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Yi.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Yi.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Yi.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Yi.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Yi.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Yi.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Yi.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Yi.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Yi.AREAS=["NORTH_AMERICA","OVERSEA"]);const Qk=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Wc=[];function zc(o,n){return!!n&&Wc.some(r=>r.uid===o&&r.channelName===n)}wf.__CLIENT_LIST__=Wc;var rC,Gr,fh,mh,Wr,$i,Ce,qe,le,be,zr,me,aD,Kc,Me,zn,Ta,cD=bu("Array").values,lD=za,Zk=gr,dD=Ns,cE=cD,If=Array.prototype,oC={DOMTokenList:!0,NodeList:!0},wa=dr(function(o){var n=o.values;return o===If||dD(If,o)&&n===If.values||Zk(oC,lD(o))?cE:n});function ee(o,n,r,s){var c,d=arguments.length,h=d<3?n:null===s?s=Object.getOwnPropertyDescriptor(n,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect.decorate(o,n,r,s);else for(var p=o.length-1;p>=0;p--)(c=o[p])&&(h=(d<3?c(h):d>3?c(n,r,h):c(n,r))||h);return d>3&&h&&Object.defineProperty(n,r,h),h}function O(o,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(o,n)}(function(o){o.L1T1="L1T1",o.L1T2="L1T2",o.L1T3="L1T3",o.L2T1_KEY="L2T1_KEY",o.L2T2_KEY="L2T2_KEY",o.L2T3_KEY="L2T3_KEY",o.L3T1_KEY="L3T1_KEY",o.L3T2_KEY="L3T2_KEY",o.L3T3_KEY="L3T3_KEY"})(rC||(rC={})),function(o){o.CERTIFICATE="certificate",o.CODEC="codec",o.CANDIDATE_PAIR="candidate-pair",o.LOCAL_CANDIDATE="local-candidate",o.REMOTE_CANDIDATE="remote-candidate",o.INBOUND="inbound-rtp",o.TRACK="track",o.OUTBOUND="outbound-rtp",o.PC="peer-connection",o.REMOTE_INBOUND="remote-inbound-rtp",o.REMOTE_OUTBOUND="remote-outbound-rtp",o.TRANSPORT="transport",o.CSRC="csrc",o.DATA_CHANNEL="data-channel",o.STREAM="stream",o.SENDER="sender",o.RECEIVER="receiver"}(Gr||(Gr={})),function(o){o[o.ACCESS_POINT=101]="ACCESS_POINT",o[o.UNILBS=201]="UNILBS",o[o.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(fh||(fh={})),function(o){o[o.IIIEGAL_APPID=1]="IIIEGAL_APPID",o[o.IIIEGAL_UID=2]="IIIEGAL_UID",o[o.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(mh||(mh={})),function(o){o[o.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",o[o.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",o[o.INTERNAL_ERROR=8]="INTERNAL_ERROR",o[o.NO_AUTHORIZED=9]="NO_AUTHORIZED",o[o.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",o[o.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",o[o.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",o[o.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",o[o.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",o[o.USER_OVERLOAD=16]="USER_OVERLOAD",o[o.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",o[o.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(Wr||(Wr={})),function(o){o[o.NO_FLAG_SET=100]="NO_FLAG_SET",o[o.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",o[o.INVALID_FALG_SET=102]="INVALID_FALG_SET",o[o.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",o[o.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",o[o.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",o[o.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",o[o.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",o[o.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",o[o.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",o[o.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",o[o.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",o[o.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",o[o.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",o[o.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",o[o.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",o[o.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",o[o.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",o[o.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}($i||($i={})),function(o){o[o.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",o[o.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",o[o.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",o[o.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",o[o.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",o[o.K_TICKET_INVALID=7]="K_TICKET_INVALID",o[o.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",o[o.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",o[o.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",o[o.K_UID_BANNED=14]="K_UID_BANNED",o[o.K_IP_BANNED=15]="K_IP_BANNED",o[o.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",o[o.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",o[o.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",o[o.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",o[o.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",o[o.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",o[o.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",o[o.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",o[o.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",o[o.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",o[o.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",o[o.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",o[o.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",o[o.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",o[o.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",o[o.ERR_INVALID_UID=117]="ERR_INVALID_UID",o[o.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",o[o.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",o[o.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",o[o.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",o[o.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",o[o.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",o[o.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",o[o.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",o[o.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",o[o.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",o[o.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",o[o.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",o[o.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",o[o.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",o[o.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",o[o.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",o[o.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",o[o.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",o[o.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",o[o.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",o[o.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",o[o.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",o[o.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",o[o.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",o[o.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",o[o.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",o[o.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",o[o.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",o[o.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",o[o.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",o[o.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",o[o.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",o[o.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",o[o.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",o[o.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",o[o.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",o[o.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(Ce||(Ce={})),function(o){o.CONNECTING="connecting",o.CONNECTED="connected",o.RECONNECTING="reconnecting",o.CLOSED="closed"}(qe||(qe={})),function(o){o.WS_CONNECTED="ws_connected",o.WS_RECONNECTING="ws_reconnecting",o.WS_CLOSED="ws_closed",o.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",o.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",o.ON_BINARY_DATA="on_binary_data",o.REQUEST_RECOVER="request_recover",o.REQUEST_JOIN_INFO="request_join_info",o.REQUEST_REJOIN_INFO="req_rejoin_info",o.IS_P2P_DISCONNECTED="is_p2p_dis",o.DISCONNECT_P2P="dis_p2p",o.ABORT_P2P_EXECUTION="abort_p2p_execution",o.NEED_RENEW_SESSION="need-sid",o.REPORT_JOIN_GATEWAY="report_join_gateway",o.REQUEST_TIMEOUT="request_timeout",o.REQUEST_SUCCESS="request_success",o.JOIN_RESPONSE="join_response",o.DATACHANNEL_PRECONNECT="datachannel_preconnect",o.DATACHANNEL_CONNECTING="datachannel_connecting",o.DATACHANNEL_FAILBACK="datachannel_failback",o.P2P_START="p2p_start",o.P2P_CONNECTION="p2p_connection",o.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",o.P2P_SUBSCRIBE="p2p_subscribe",o.P2P_UNSUBSCRIBE="p2p_unsubscribe",o.P2P_EXCHANGE_SDP="p2p_exchange_sdp",o.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",o.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream"}(le||(le={})),function(o){o.PING="ping",o.PING_BACK="ping_back",o.JOIN="join_v3",o.REJOIN="rejoin_v3",o.LEAVE="leave",o.SET_CLIENT_ROLE="set_client_role",o.PUBLISH="publish",o.PUBLISH_DATASTREAM="publish_datastream",o.UNPUBLISH="unpublish",o.UNPUBLISH_DATASTREAM="unpublish_datastream",o.SUBSCRIBE="subscribe",o.SUBSCRIBE_DATASTREAM="subscribe_datastream",o.SUBSCRIBE_STREAMS="subscribe_streams",o.UNSUBSCRIBE="unsubscribe",o.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",o.UNSUBSCRIBE_STREAMS="unsubscribe_streams",o.SUBSCRIBE_CHANGE="subscribe_change",o.TRAFFIC_STATS="traffic_stats",o.RENEW_TOKEN="renew_token",o.SWITCH_VIDEO_STREAM="switch_video_stream",o.DEFAULT_VIDEO_STREAM="default_video_stream",o.SET_FALLBACK_OPTION="set_fallback_option",o.GATEWAY_INFO="gateway_info",o.CONTROL="control",o.SEND_METADATA="send_metadata",o.DATA_STREAM="data_stream",o.PICK_SVC_LAYER="pick_svc_layer",o.RESTART_ICE="restart_ice",o.CONNECT_PC="connect_pc",o.SET_VIDEO_PROFILE="set_video_profile",o.SET_PARAMETER="set_parameter",o.SET_RTM2_FLAG="set_rtm2_flag"}(be||(be={})),function(o){o.PUBLISH_STATS="publish_stats",o.PUBLISH_RELATED_STATS="publish_related_stats",o.SUBSCRIBE_STATS="subscribe_stats",o.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",o.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",o.DENOISER_STATS="denoiser_stats",o.TRANSPORT_STATS="transport_stats",o.EXTENSION_USAGE_STATS="extension_usage_stats"}(zr||(zr={})),function(o){o.ON_USER_ONLINE="on_user_online",o.ON_USER_OFFLINE="on_user_offline",o.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",o.ON_PUBLISH_STREAM="on_publish_stream",o.ON_UPLINK_STATS="on_uplink_stats",o.ON_P2P_LOST="on_p2p_lost",o.ON_REMOVE_STREAM="on_remove_stream",o.ON_ADD_AUDIO_STREAM="on_add_audio_stream",o.ON_ADD_VIDEO_STREAM="on_add_video_stream",o.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",o.ON_USER_BANNED="on_user_banned",o.ON_USER_LICENSE_BANNED="on_user_license_banned",o.ON_NOTIFICATION="on_notification",o.ON_CRYPT_ERROR="on_crypt_error",o.MUTE_AUDIO="mute_audio",o.MUTE_VIDEO="mute_video",o.UNMUTE_AUDIO="unmute_audio",o.UNMUTE_VIDEO="unmute_video",o.ON_P2P_OK="on_p2p_ok",o.RECEIVE_METADATA="receive_metadata",o.ON_DATA_STREAM="on_data_stream",o.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",o.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",o.ENABLE_LOCAL_VIDEO="enable_local_video",o.DISABLE_LOCAL_VIDEO="disable_local_video",o.ENABLE_LOCAL_AUDIO="enable_local_audio",o.DISABLE_LOCAL_AUDIO="disable_local_audio",o.ON_PUBLISHED_USER_LIST="on_published_user_list"}(me||(me={})),function(o){o.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",o.NEED_ANSWER="NEED_ANSWER",o.NEED_RENEGOTIATE="NEED_RENEGOTIATE",o.P2P_LOST="P2P_LOST",o.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",o.NEED_UNPUB="NEED_UNPUB",o.NEED_UNSUB="NEED_UNSUB",o.NEED_UPLOAD="NEED_UPLOAD",o.NEED_CONTROL="NEED_CONTROL",o.START_RECONNECT="START_RECONNECT",o.END_RECONNECT="END_RECONNECT",o.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(aD||(aD={})),function(o){o.SEND_ONLY="SEND_ONLY",o.RECEIVE_ONLY="RECEIVE_ONLY"}(Kc||(Kc={})),function(o){o.CONNECTED="websocket:connected",o.RECONNECTING="websocket:reconnecting",o.WILL_RECONNECT="websocket:will_reconnect",o.CLOSED="websocket:closed",o.FAILED="websocket:failed",o.ON_MESSAGE="websocket:on_message",o.REQUEST_NEW_URLS="websocket:request_new_urls",o.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",o.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"}(Me||(Me={}));class G extends Q{constructor(n){super(n,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),S(this,"name","AgoraRTCException")}print(){return super.print(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",w)}throw(){super.throw(w)}}function lE(o){if("string"!=typeof o||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(o))throw w.error("Invalid Channel Name ".concat(o)),new G(M.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Rf(o){if(!("number"==typeof(n=o)&&Math.floor(n)===n&&0<=n&&n<=4294967295||Ik(o,1,255)))throw new G(M.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var n;"string"==typeof o&&w.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}(function(o){o.TRANSCODE="mix_streaming",o.RAW="raw_streaming",o.INJECT="inject_streaming"})(zn||(zn={})),function(o){o[o.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",o[o.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",o[o.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",o[o.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",o[o.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",o[o.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",o[o.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",o[o.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",o[o.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",o[o.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",o[o.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(Ta||(Ta={}));const uD={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},sC={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function hD(o,n){fi(o.url,"".concat(n,".url"),1,1e3,!1),nn(o.x)||wt(o.x,"".concat(n,".x"),0,1e4),nn(o.y)||wt(o.y,"".concat(n,".y"),0,1e4),nn(o.width)||wt(o.width,"".concat(n,".width"),0,1e4),nn(o.height)||wt(o.height,"".concat(n,".height"),0,1e4),nn(o.zOrder)||wt(o.zOrder,"".concat(n,".zOrder"),0,255),nn(o.alpha)||wt(o.alpha,"".concat(n,".alpha"),0,1,!1)}const ex={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},pD={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var hs,_h,Sn,tx,Si,zs,Xi,Td,gt,on,qc,Fn,Af,ot;function Yc(o){if(!o.channelName)throw new G(M.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof o.uid)throw new G(M.INVALID_PARAMS,"invalid uid in info, uid must be a number");return o.token&&fi(o.token,"info.token",1,2047),Rf(o.uid),lE(o.channelName),!0}(function(o){o.WARNING="@live_uap-warning",o.ERROR="@line_uap-error",o.PUBLISH_STREAM_STATUS="@live_uap-publish-status",o.INJECT_STREAM_STATUS="@live_uap-inject-status",o.WORKER_STATUS="@live_uap-worker-status",o.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(hs||(hs={})),function(o){o.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(_h||(_h={})),function(o){o[o.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",o[o.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",o[o.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",o[o.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",o[o.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",o[o.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",o[o.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",o[o.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",o[o.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",o[o.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",o[o.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",o[o.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",o[o.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",o[o.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",o[o.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",o[o.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",o[o.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",o[o.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",o[o.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",o[o.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",o[o.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(Sn||(Sn={})),function(o){o.CONNECT_FAILED="connect failed",o.CONNECT_TIMEOUT="connect timeout",o.WS_DISCONNECTED="websocket disconnected",o.REQUEST_TIMEOUT="request timeout",o.REQUEST_FAILED="request failed",o.WAIT_STATUS_TIMEOUT="wait status timeout",o.WAIT_STATUS_ERROR="wait status error",o.BAD_STATE="bad state",o.WS_ABORT="ws abort",o.AP_REQUEST_TIMEOUT="AP request timeout",o.AP_JSON_PARSE_ERROR="AP json parse error",o.AP_REQUEST_ERROR="AP request error",o.AP_REQUEST_ABORT="AP request abort"}(tx||(tx={})),function(o){o[o.SetSdkProfile=0]="SetSdkProfile",o[o.SetSourceChannel=1]="SetSourceChannel",o[o.SetSourceUserId=2]="SetSourceUserId",o[o.SetDestChannel=3]="SetDestChannel",o[o.StartPacketTransfer=4]="StartPacketTransfer",o[o.StopPacketTransfer=5]="StopPacketTransfer",o[o.UpdateDestChannel=6]="UpdateDestChannel",o[o.Reconnect=7]="Reconnect",o[o.SetVideoProfile=8]="SetVideoProfile"}(Si||(Si={})),function(o){o.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",o.NETWORK_CONNECTED="NETWORK_CONNECTED",o.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",o.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",o.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",o.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",o.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",o.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",o.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",o.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(zs||(zs={})),function(o){o.RELAY_STATE_IDLE="RELAY_STATE_IDLE",o.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",o.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",o.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(Xi||(Xi={})),function(o){o.RELAY_OK="RELAY_OK",o.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",o.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",o.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(Td||(Td={})),function(o){o.High="high",o.Low="low",o.Audio="audio",o.Screen="screen",o.ScreenLow="screen_low"}(gt||(gt={})),function(o){o.DISCONNECT="disconnect",o.CONNECTION_STATE_CHANGE="connection-state-change",o.NETWORK_QUALITY="network-quality",o.STREAM_TYPE_CHANGE="stream-type-change",o.IS_P2P_DISCONNECTED="is-p2p-dis",o.DISCONNECT_P2P="dis-p2p",o.REQUEST_NEW_GATEWAY_LIST="req-gate-url",o.NEED_RENEW_SESSION="need-sid",o.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",o.JOIN_RESPONSE="join-response",o.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",o.RESET_CONNECTION_EVENTS="reset-connection-events",o.DATACHANNEL_PRECONNECT="datachannel_preconnect",o.DATACHANNEL_FAILBACK="datachannel_failback",o.RESET_SIGNAL="reset-signal"}(on||(on={})),function(o){o.P2P_DISCONNECTED="P2P_DISCONNECTED",o.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",o.TIMEOUT="TIMEOUT",o.UNKNOWN_REASON="UNKNOWN_REASON"}(qc||(qc={})),function(o){o[o.Nothing=0]="Nothing",o[o.Audio=1]="Audio",o[o.LwoVideo=2]="LwoVideo",o[o.Video=4]="Video",o[o.Data=8]="Data",o[o.DataStream0=256]="DataStream0",o[o.DataStream1=512]="DataStream1",o[o.DataStream2=1024]="DataStream2",o[o.DataStream3=2048]="DataStream3",o[o.DataStream4=4096]="DataStream4",o[o.DataStream5=8192]="DataStream5",o[o.DataStream6=16384]="DataStream6",o[o.DataStream7=32768]="DataStream7"}(Fn||(Fn={})),function(o){o[o.websocket=0]="websocket",o[o.datachannel=1]="datachannel"}(Af||(Af={})),function(o){o.CHINA="CHINA",o.ASIA="ASIA",o.NORTH_AMERICA="NORTH_AMERICA",o.EUROPE="EUROPE",o.JAPAN="JAPAN",o.INDIA="INDIA",o.KOREA="KOREA",o.HKMC="HKMC",o.US="US",o.OCEANIA="OCEANIA",o.SOUTH_AMERICA="SOUTH_AMERICA",o.AFRICA="AFRICA",o.OVERSEA="OVERSEA",o.GLOBAL="GLOBAL",o.EXTENSIONS="EXTENSIONS"}(ot||(ot={}));const Df=[ot.AFRICA,ot.ASIA,ot.CHINA,ot.EUROPE,ot.GLOBAL,ot.INDIA,ot.JAPAN,ot.NORTH_AMERICA,ot.OCEANIA,ot.OVERSEA,ot.SOUTH_AMERICA];var ti;!function(o){o.CHINA="CN",o.ASIA="AS",o.NORTH_AMERICA="NA",o.EUROPE="EU",o.JAPAN="JP",o.INDIA="IN",o.KOREA="KR",o.HKMC="HK",o.US="US",o.OCEANIA="OC",o.SOUTH_AMERICA="SA",o.AFRICA="AF",o.OVERSEA="OVERSEA",o.GLOBAL="GLOBAL",o.EXTENSIONS="GLOBAL"}(ti||(ti={}));const dE={CHINA:{},ASIA:{CODE:ti.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ti.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ti.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ti.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","\tuap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ti.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ti.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ti.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ti.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ti.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ti.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ti.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ti.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ti.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};var uE,nx,ge,ki,ps,te,at,Ae,ix,Uo,Vo,Jn,oc,Cn,lo,fD,Kr,uo,ho,xt,fs,hE;nC&&(dE.CHINA={CODE:ti.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(o){o.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(uE||(uE={}));class mD extends Yt{constructor(n,r){super(),S(this,"onICEConnectionStateChange",void 0),S(this,"onConnectionStateChange",void 0),S(this,"onDTLSTransportStateChange",void 0),S(this,"onDTLSTransportError",void 0),S(this,"onICETransportStateChange",void 0),S(this,"onFirstAudioReceived",void 0),S(this,"onFirstVideoReceived",void 0),S(this,"onFirstAudioDecoded",void 0),S(this,"onFirstVideoDecoded",void 0),S(this,"onFirstVideoDecodedTimeout",void 0),S(this,"onSelectedLocalCandidateChanged",void 0),S(this,"onSelectedRemoteCandidateChanged",void 0)}}class gh extends mD{constructor(n,r){super(n,r)}}(function(o){o.SEND="sendonly",o.RECV="recvonly",o.SENDRECV="sendrecv",o.INACTIVE="inactive"})(nx||(nx={})),function(o){o.VIDEO="video",o.AUDIO="audio"}(ge||(ge={})),function(o){o[o.UDP=0]="UDP",o[o.TCP=1]="TCP",o[o.RELAY=2]="RELAY"}(ki||(ki={})),function(o){o[o.FIRST_CONNECTION=0]="FIRST_CONNECTION",o[o.TCP_RESTART=1]="TCP_RESTART",o[o.RELAY_RESTART=2]="RELAY_RESTART",o[o.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",o[o.OLD_RESTART=11]="OLD_RESTART",o[o.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(ps||(ps={})),function(o){o.LocalVideoTrack="videoTrack",o.LocalAudioTrack="audioTrack",o.LocalVideoLowTrack="videoLowTrack"}(te||(te={})),function(o){o.New="new",o.Connected="connected",o.Reconnecting="reconnecting",o.Disconnected="disconnected"}(at||(at={})),function(o){o.StateChange="stateChange",o.IceConnectionStateChange="iceConnectionStateChange",o.RequestMuteLocal="requestMuteLocal",o.RequestUnmuteLocal="requestUnmuteLocal",o.RequestRePublish="requestRePublish",o.RequestRePublishDataChannel="requestRePublishDataChannel",o.RequestReSubscribe="requestReSubscribe",o.RequestUploadStats="requestUploadStats",o.MediaReconnectStart="MediaReconnectStart",o.MediaReconnectEnd="MediaReconnectEnd",o.NeedSignalRTT="NeedSignalRTT",o.RequestRestartICE="RequestRestartIce",o.PeerConnectionStateChange="PeerConnectionStateChange",o.RequestReconnect="RequestReconnect",o.RequestReconnectPC="RequestReconnectPC",o.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",o.P2PLost="P2PLost",o.UpdateVideoEncoder="UpdateVideoEncoder",o.ConnectionTypeChange="ConnectionTypeChange",o.RequestLowStreamParameter="RequestLowStreamParameter",o.QueryClientConnectionState="QueryClientConnectionState",o.LocalCandidate="LocalCandidate",o.RequestP2PMuteLocal="requestP2PMuteLocal",o.RequestP2PPublish="RequestP2PPublish",o.RequestP2PUnPublish="RequestP2PUnPublish",o.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",o.RequestP2PMuteRemote="RequestP2PMuteRemote",o.RequestP2PRestartICE="RequestP2PRestartICE"}(Ae||(Ae={})),function(o){o.MUTE_LOCAL_VIDEO="mute_local_video",o.MUTE_LOCAL_AUDIO="mute_local_audio",o.UNMUTE_LOCAL_VIDEO="unmute_local_video",o.UNMUTE_LOCAL_AUDIO="unmute_local_audio",o.MUTE_REMOTE_VIDEO="mute_remote_video",o.MUTE_REMOTE_AUDIO="mute_remote_audio",o.UNMUTE_REMOTE_VIDEO="unmute_remote_video",o.UNMUTE_REMOTE_AUDIO="unmute_remote_audio"}(ix||(ix={})),function(o){o.CONNECTING="CONNECTING",o.RECONNECTING="RECONNECTING",o.CONNECTED="CONNECTED",o.CLOSED="CLOSED"}(Uo||(Uo={})),function(o){o[o.CONNECT_AP=0]="CONNECT_AP",o[o.AP_CONNECTED=1]="AP_CONNECTED",o[o.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",o[o.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",o[o.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",o[o.CONNECT_WORKER=5]="CONNECT_WORKER",o[o.WORKER_CONNECTED=6]="WORKER_CONNECTED",o[o.CLOSED=7]="CLOSED"}(Vo||(Vo={})),function(o){o.CONNECTION_STATE_CHANGE="connection-state-change",o.STATE_CHANGE="state-change",o.INSPECT_RESULT="inspect-result",o.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",o.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(Jn||(Jn={})),function(o){o.NETWORK_ERROR="NETWORK_ERROR",o.SERVER_ERROR="SERVER_ERROR",o.MULTI_IP="MULTI_IP",o.TIMEOUT="TIMEOUT",o.OFFLINE="OFFLINE",o.LEAVE="LEAVE",o.P2P_FAILED="P2P_FAILED",o.FALLBACK="FALLBACK"}(oc||(oc={})),function(o){o.CONNECTED="transmitter:connected",o.RECONNECTING="transmitter:reconnecting",o.WILL_RECONNECT="transmitter:will_reconnect",o.CLOSED="transmitter:closed",o.FAILED="transmitter:failed",o.ON_MESSAGE="transmitter:on_message",o.REQUEST_NEW_URLS="transmitter:request_new_urls",o.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",o.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",o.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",o.FAILBACK="transmitter:failback"}(Cn||(Cn={})),function(o){o.CAMERA_CHANGED="camera-changed",o.MICROPHONE_CHANGED="microphone-changed",o.PLAYBACK_DEVICE_CHANGED="playback-device-changed",o.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",o.AUTOPLAY_FAILED="autoplay-failed",o.SECURITY_POLICY_VIOLATION="security-policy-violation"}(lo||(lo={})),function(o){o[o.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",o[o.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",o[o.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",o[o.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",o[o.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",o[o.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",o[o.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",o[o.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",o[o.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",o[o.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",o[o.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",o[o.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",o[o.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",o[o.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",o[o.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",o[o.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",o[o.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",o[o.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",o[o.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",o[o.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(fD||(fD={})),function(o){o.CONNECTING="CONNECTING",o.RECONNECTING="RECONNECTING",o.CONNECTED="CONNECTED",o.CLOSED="CLOSED"}(Kr||(Kr={})),function(o){o.CONNECTION_STATE_CHANGE="connection-state-change",o.STATE_CHANGE="state-change",o.INSPECT_RESULT="inspect-result",o.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",o.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(uo||(uo={})),function(o){o[o.CONNECT_AP=0]="CONNECT_AP",o[o.AP_CONNECTED=1]="AP_CONNECTED",o[o.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",o[o.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",o[o.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",o[o.CONNECT_WORKER=5]="CONNECT_WORKER",o[o.WORKER_CONNECTED=6]="WORKER_CONNECTED",o[o.CLOSED=7]="CLOSED"}(ho||(ho={})),function(o){o.CALL="call",o.CANDIDATE="candidate",o.PUBLISH="publish",o.UNPUBLISH="unpublish",o.SUBSCRIBE="subscribe",o.UNSUBSCRIBE="unsubscribe",o.CONTROL="control",o.RESTART_ICE="restart_ice",o.ACK="ack",o.JOIN="join",o.EXCHANGE_SDP="exchange_sdp",o.DO_SUBSCRIBE="do_subscribe",o.DO_UNSUBSCRIBE="do_unsubscribe"}(xt||(xt={})),function(o){o.MUTE_LOCAL_AUDIO="mute_local_audio",o.MUTE_LOCAL_VIDEO="mute_local_video",o.UNMUTE_LOCAL_AUDIO="unmute_local_audio",o.UNMUTE_LOCAL_VIDEO="unmute_local_video"}(fs||(fs={})),function(o){o[o.SUCCESS=1]="SUCCESS",o[o.FAILED=0]="FAILED"}(hE||(hE={}));const aC={[fh.ACCESS_POINT]:{[$i.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[$i.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[$i.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[$i.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[$i.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[$i.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[fh.UNILBS]:{[Wr.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Wr.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Wr.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Wr.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Wr.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Wr.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Wr.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Wr.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Wr.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Wr.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Wr.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Wr.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[fh.STRING_UID_ALLOCATOR]:{[mh.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[mh.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[mh.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function wd(o){const n=aC[Math.floor(o/1e4)];if(!n)return{desc:"unkonw error",retry:!1};const r=n[o%1e4];if(!r){if(Math.floor(o/1e4)===fh.ACCESS_POINT){const s=o%1e4;if("1"===s.toString()[0])return{desc:o.toString(),retry:!1};if("2"===s.toString()[0])return{desc:o.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return r}const wU={[Ce.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ce.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ce.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ce.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ce.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ce.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ce.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ce.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ce.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ce.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ce.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ce.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ce.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ce.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ce.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ce.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ce.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ce.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ce.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ce.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ce.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ce.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ce.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ce.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ce.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ce.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ce.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ce.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ce.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ce.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ce.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ce.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ce.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ce.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ce.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ce.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ce.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ce.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ce.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ce.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ce.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ce.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ce.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ce.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ce.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ce.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ce.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ce.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ce.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ce.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ce.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ce.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ce.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ce.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ce.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ce.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ce.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ce.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ce.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ce.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ce.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ce.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ce.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Eh(o){return wU[o]||{desc:"UNKNOW_ERROR_".concat(o),action:"failed"}}function rx(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function _D(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?rx(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):rx(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}function cC(o){return o.every(n=>n.readyState===WebSocket.CLOSED||n.readyState===WebSocket.CLOSING)}function gD(o,n){if("string"==typeof o)return o;const{proxy:r,host:s,port:c}=o;if(n){const d=B("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===d?"wss://".concat(s,"/ws/?p=").concat(Number(c)+150):"wss://".concat(s,":").concat(d,"/ws/?p=").concat(Number(c)+150)}return r?"wss://".concat(r,"/ws/?h=").concat(s,"&p=").concat(c):"wss://".concat(s,":").concat(c)}const ox=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,sx=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,ax=/wss:\/\/(.+):([0-9]+)\/?/,ED=/wss:\/\/(.[^\/]+)\/?/;let vD=0;class yD{constructor(n,r){S(this,"id",0),S(this,"store",void 0),S(this,"recordIndex",void 0),S(this,"websockets",[]),S(this,"try443PortDuration",2e3),S(this,"forceCloseWSDuration",5e3),S(this,"try443PortTimeout",null),S(this,"forceCloseTimeout",null),S(this,"isTry443PortFailed",!1),S(this,"isNormalPortFailed",!1),S(this,"useDoubleDomain",!1),S(this,"useProxy",!1),S(this,"startTime",Date.now()),this.id=++vD,this.try443PortDuration=B("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=n||5e3,this.store=r}closeAllWebsockets(){this.websockets.forEach(n=>{n.onopen=null,n.onclose=null,n.onmessage=null,n.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var n;const r=Date.now()-this.startTime;for(var s=arguments.length,c=new Array(s),d=0;d<s;d++)c[d]=arguments[d];w.debug("[choose-best-ws ".concat(null===(n=this.store)||void 0===n?void 0:n.clientId," ").concat(this.id,"] ").concat(r,"ms:"),...c)}createWebSocket(n,r,s){this.logger("createWebSocket:",n,{isTry443Port:r,hasTimeoutDetection:s});const c=B("GATEWAY_DOMAINS"),d=Date.now(),h=[],p=c.find(g=>{var v;return Re(v=n.host).call(v,g)});p||(this.useDoubleDomain=!1);const m=[];if(this.useDoubleDomain)c.forEach(g=>{m.push(gD(_D(_D({},n),{},{host:n.host.replace(p,g)}),r))});else{const g=_D({},n);if(r&&p){const v=c.find(b=>b!==p);v&&(g.host=g.host.replace(p,v))}m.push(gD(g,r))}try{m.forEach(g=>{const v=new WebSocket(g);v.binaryType="arraybuffer",h.push(v),this.logger("ws is connecting:",v.url)})}catch(g){if(this.logger("ws create failed"),h.forEach(v=>v.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(n,r,s);if(!r&&443!==Number(n.port))return this.createWebSocket(n,!0,s);throw new G(M.WS_ERR,"init websocket failed! Error: ".concat(g.toString()))}const _=Qu();return this.store&&this.store.recordJoinChannelService({urls:h.map(g=>g.url),service:"gateway"},this.recordIndex),h.forEach(g=>{g.onopen=()=>{this.logger("onopen: ws ".concat(g.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach(v=>{v!==g&&(v.onopen=null,v.onclose=null,v.onmessage=null,v.close(),this.logger("close backup websocket: ".concat(v.url)))}),this.websockets.length=0,_.resolve(g)},g.onclose=v=>{this.logger("onclose: ws ".concat(g.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(g.readyState)),r?this.isTry443PortFailed=cC(h):this.isNormalPortFailed=cC(h),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(r&&this.isTry443PortFailed||!r&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(v.reason)),_.reject({code:v.code,reason:qc.A_ROUND_WS_FAILED}))},g.onmessage=v=>this.logger("".concat(g.url," onmessage: ").concat(v.data))}),this.websockets.push(...h),s||(()=>{const g=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",_.isResolved),this.websockets.forEach(v=>v.readyState!==WebSocket.OPEN&&v.close())};if(r||this.useProxy)return this.logger("add 5s timeout at ".concat(r?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(g,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",_.isResolved),_.isResolved)return g();Ve().os===ei.MAC_OS&&jt()&&g(),this.createWebSocket(n,!0,!0).then(v=>_.resolve(v)).catch(v=>{this.isNormalPortFailed&&_.reject(v),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(g,this.forceCloseWSDuration)},this.try443PortDuration)})(),_.promise}chooseBestWebsocket(n,r,s,c){return this.useDoubleDomain=!!r,"string"==typeof n&&(n=function(d){let h,p,m;return[,h,p,m]=d.match(ox)||[],h||([,p,m]=d.match(sx)||[]),p&&m||([,p,m]=d.match(ax)||[]),p&&m||([,p]=d.match(ED)||[]),p||w.warning("un-destructible url: ",d),{proxy:h,host:p,port:m||"443"}}(n)),this.recordIndex=c,this.useProxy=!!n.proxy,s&&this.useProxy&&(w.warn("cannot use 443 only when use proxy"),s=!1),this.createWebSocket(n,!!s,!1).finally(()=>this.clearTimeout())}}function bD(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}class SD extends Yt{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(n){var r;Re(r=["tryNext","recover"]).call(r,n)&&this.resetReconnectCount(n),this._reconnectMode=n}get state(){return this._state}set state(n){n!==this._state&&(this._state=n,"reconnecting"===this._state?this.emit(Me.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(Me.CONNECTED):"closed"===this._state?this.emit(Me.CLOSED):"failed"===this._state&&this.emit(Me.FAILED))}resetReconnectCount(n){w.debug("websocket reset reconnect count, reason: "+n),this.reconnectCount=0}constructor(n,r){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),S(this,"connectionID",0),S(this,"currentURLIndex",0),S(this,"urls",[]),S(this,"_reconnectMode","tryNext"),S(this,"reconnectReason",void 0),S(this,"_initMutex",new Wn("websocket")),S(this,"name",void 0),S(this,"_state","closed"),S(this,"reconnectInterrupter",void 0),S(this,"websocket",void 0),S(this,"retryConfig",void 0),S(this,"reconnectCount",0),S(this,"forceCloseTimeout",5e3),S(this,"onlineReconnectListener",void 0),S(this,"useCompress",void 0),S(this,"tryDoubleDomain",!1),S(this,"use443PortOnly",!1),S(this,"wsInflateLength",0),S(this,"wsDeflateLength",0),S(this,"closeEstablishingWs",()=>{}),S(this,"store",void 0),S(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=n,this.retryConfig=function(v){for(var b=1;b<arguments.length;b++){var C=null!=arguments[b]?arguments[b]:{};b%2?bD(Object(C),!0).forEach(function(N){S(v,N,C[N])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(C)):bD(Object(C)).forEach(function(N){Object.defineProperty(v,N,Object.getOwnPropertyDescriptor(C,N))})}return v}({},r),this.useCompress=s,this.tryDoubleDomain=c,this.use443PortOnly=d;const{timeout:p,timeoutFactor:m}=r,_=Math.max(300,Math.floor(3*p/5)),g=Math.max(1.2,Math.floor(8*m)/10);li.ONLINE&&(this.retryConfig.timeout=_,this.retryConfig.timeoutFactor=g),Rn.on(ic.NETWORK_STATE_CHANGE,(v,b)=>{v!==b&&(this.resetReconnectCount("network state change: ".concat(b," -> ").concat(v)),v===li.ONLINE?(this.retryConfig.timeout=_,this.retryConfig.timeoutFactor=g):(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m))})}getConnection(){return this.websocket||void 0}init(n){var r=arguments,s=this;return x(function*(){let c=r.length>1&&void 0!==r[1]?r[1]:5e3;const d=yield s._initMutex.lock();s.forceCloseTimeout=c,s.urls=n,s.state="connecting";try{const h=Qu();s.createWebSocketConnection(s.urls[s.currentURLIndex]).then(h.resolve).catch(h.reject),s.once(Me.CLOSED,()=>{h.reject(new Q(M.WS_DISCONNECT))}),s.once(Me.CONNECTED,h.resolve),yield h.promise}catch{}finally{d()}})()}close(n,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const s=this.websocket;r?setTimeout(()=>s.close(),500):s.close(),this.websocket=void 0}this.state=n?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(n,r){if(!this.websocket)return void w.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==n&&(this.reconnectMode=n),w.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(r)]},this.joinGatewayRecordIndex);const s=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),s&&s.bind(this.websocket)({code:9999,reason:r})}sendMessage(n){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Q(M.WS_ABORT,"websocket is not ready");try{r||(n=JSON.stringify(n)),this.websocket.send(n)}catch(s){throw new Q(M.WS_ERR,"send websocket message error"+s.toString())}}setWsInflateData(n){this.wsDeflateLength=this.wsDeflateLength+n.originLength,this.wsInflateLength=this.wsInflateLength+n.compressedLength}getWsInflateData(){const n=this.wsInflateLength,r=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:n,wsDeflateLength:r}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}createWebSocketConnection(n){var r=this;return x(function*(){var s;const c=Qu();r.connectionID+=1,r.joinGatewayRecordIndex=void 0;const d=v=>{var b;null===(b=r.store)||void 0===b||b.signalChannelOpen(),w.debug("[".concat(r.name,"] websocket opened:"),v),r.reconnectMode="retry",r.state="connected",r.resetReconnectCount("opened"),c.resolve()},h=function(){var v=x(function*(b){var C;if(w.debug("[".concat(r.name,"] websocket close ").concat(null===(C=r.websocket)||void 0===C?void 0:C.url,", code: ").concat(b.code,", reason: ").concat(b.reason,", current mode: ").concat(r.reconnectMode)),r.reconnectCount>=r.retryConfig.maxRetryCount)c.reject(new Q(M.WS_DISCONNECT,"websocket close: ".concat(b.code))),r.close();else{"connected"===r.state&&(r.reconnectReason=b.reason,r.state="reconnecting");const N=hr(r,Me.WILL_RECONNECT,r.reconnectMode,b.reason)||r.reconnectMode,P=yield r.reconnectWithAction(N);if("closed"===r.state)return void w.debug("[".concat(r.connectionID,"] ws is closed, no need to reconnect"));if(!P)return c.reject(new Q(M.WS_DISCONNECT,"websocket reconnect failed: ".concat(b.code))),r.close(!0);c.resolve()}});return function(C){return v.apply(this,arguments)}}(),p=v=>{r.emit(Me.ON_MESSAGE,v)},m=v=>{w.warn("[".concat(r.connectionID,"] ws open error ").concat(v))};r.websocket&&(r.websocket.onclose=null,r.websocket.close()),B("GATEWAY_WSS_ADDRESS")&&r.name.startsWith("gateway")&&(n=B("GATEWAY_WSS_ADDRESS")),w.debug("[".concat(r.name,"] start connect, url:"),n);const _=null===(s=r.store)||void 0===s?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var g;const v=yield r.chooseBestWebsocketConnection(n);r.websocket=v,d&&d(r.websocket.url),r.websocket.onclose=h,r.websocket.onmessage=p,r.websocket.onerror=m,null===(g=r.store)||void 0===g||g.recordJoinChannelService({endTs:Date.now(),status:"success"},_),r.joinGatewayRecordIndex=_}catch(v){const b="closed"===r.state,C=v instanceof Q,N=C&&v.code===M.WS_ABORT,P=C&&v.code===M.WS_ERR,D=C?v.message:v&&(v.reason||v.toString());w.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(D)),r.store&&r.store.recordJoinChannelService({endTs:Date.now(),status:N?"aborted":"error",errors:[v]},_),b||P?(c.reject(b?new Q(M.WS_DISCONNECT,"websocket is closed: ".concat(D)):new Q(M.WS_ERR,"init websocket failed: ".concat(D))),P&&w.error("[".concat(r.name,"] init websocket failed: ").concat(D))):h&&h(v)}return c.promise})()}reconnectWithAction(n){var r=arguments,s=this;return x(function*(){let c=!(r.length>1&&void 0!==r[1])||r[1];if(s.reconnectCount>=s.retryConfig.maxRetryCount||0===s.urls.length||"closed"===s.state)return!1;w.warning("[choose-best-ws] action: =>",n),s.onlineReconnectListener||Rn.isOnline||!Rn.onlineWaiter||(s.onlineReconnectListener=Rn.onlineWaiter.then(()=>{s.onlineReconnectListener=void 0}));let d=!0;if(s.reconnectInterrupter=()=>d=!1,c){const m=jg(s.reconnectCount,s.retryConfig);w.debug("[".concat(s.name,"] wait ").concat(m,"ms to reconnect websocket, mode: ").concat(n)),yield z.race([mi(m),s.onlineReconnectListener||new z(()=>{})])}if("closed"===s._state||!d)return!1;s.reconnectCount+=1;const h=function(){var m=x(function*(_,g){s.emit(Me.RECONNECT_CREATE_CONNECTION,g),yield s.createWebSocketConnection(_)});return function(g,v){return m.apply(this,arguments)}}();try{if("retry"===n)s.emit(Me.RECONNECT_WAITTING_FINISH,n),yield h(s.urls[s.currentURLIndex],n);else if("tryNext"===n){if(s.currentURLIndex+=1,s.currentURLIndex>=s.urls.length)return s.reconnectWithAction("recover",!1);w.debug("[".concat(s.name,"] websocket url length: ").concat(s.urls.length," current index: ").concat(s.currentURLIndex)),s.emit(Me.RECONNECT_WAITTING_FINISH,n),yield h(s.urls[s.currentURLIndex],n)}else"recover"===n&&(w.debug("[".concat(s.name,"] request new urls")),s.resetReconnectCount("recover mode"),s.emit(Me.RECONNECT_WAITTING_FINISH,n),s.urls=yield Qt(s,Me.REQUEST_NEW_URLS),s.currentURLIndex=0,yield h(s.urls[s.currentURLIndex],n))}catch(m){var p;w.error("[".concat(s.name,"] reconnect failed ").concat(m&&m.toString()));const _=null==m||null===(p=m.data)||void 0===p?void 0:p.desc;return Array.isArray(_)&&Re(_).call(_,"dynamic key expired")?(s.emit(Me.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):s.reconnectWithAction(n,c)}return!0})()}}class vh extends SD{constructor(n,r){super(n,r,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(n,r){var s=this;return x(function*(){const c=Qu(),d=new yD(s.forceCloseTimeout,s.store);s.closeEstablishingWs=()=>{w.debug("[choose-best-ws] close establishing websockets"),d.closeAllWebsockets(),c.reject(new Q(M.WS_ABORT,"choose best websocket aborted"))};const h=B("GATEWAY_DOMAINS");return w.debug("[choose-best-ws] currentDomain: ",n,", domains: ",h,"total: ".concat(s.urls.length),"current: ".concat(s.currentURLIndex+1)),d.chooseBestWebsocket(n,s.tryDoubleDomain,s.use443PortOnly,r).then(c.resolve).catch(c.reject),c.promise.finally(()=>{s.closeEstablishingWs=void 0})})()}}class $c extends SD{constructor(n,r){super(n,r,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(n,r){var s=this;return x(function*(){return new z((c,d)=>{let h=!1;const p=[];s.closeEstablishingWs=()=>{w.debug("[choose-best-ws] close establishing websockets"),p.forEach(P=>{P.onclose=null,P.onopen=null,P.onmessage=null,P.close()}),d(new Q(M.WS_ABORT,"choose best websocket aborted"))};const m=B("GATEWAY_DOMAINS");let _;const g=n.indexOf("?h="),v=m.find(P=>-1!==g?Re(n).call(n,P,g):Re(n).call(n,P));w.debug("[choose-best-ws] currentDomain: ",v,", domains: ",m);let b=!s.tryDoubleDomain||!v;if(!b&&v){var C;const P=Date.now();try{m.forEach(D=>{const k=-1===g?n.replace(v,D):n.substr(0,g)+n.substr(g).replace(v,D),V=new WebSocket(k);V.binaryType="arraybuffer",p.push(V),w.debug("[choose-best-ws] ws is connecting:",V.url)})}catch{for(w.debug("[choose-best-ws] ws create failed, fallback to single url"),p.forEach(k=>k.close());p.length;)p.pop();b=!0}null===(C=s.store)||void 0===C||C.recordJoinChannelService({urls:p.map(D=>D.url),service:"gateway"},r),p.forEach(D=>{D.onopen=()=>{if(h)return;const k=Date.now()-P;w.debug("[choose-best-ws] ws open cost ".concat(k,"ms")),p.filter(V=>V!==D).forEach(V=>{w.debug("[choose-best-ws]close backup websocket: ".concat(V.url)),V.close()}),h=!0,c(D)},D.onclose=k=>{_=k,!h&&(p.find(V=>!(V.readyState===WebSocket.CLOSED||V.readyState===WebSocket.CLOSING))||(w.debug("[choose-best-ws] all websocket is closed"),h=!0,d(_)))},D.onmessage=k=>{w.debug("[choose-best-ws]".concat(D.url," onmessage: ").concat(k.data))}}),mi(s.forceCloseTimeout).then(()=>{p.forEach(D=>{D.readyState!==WebSocket.OPEN&&D.close()})})}if(b){var N;let P;w.debug("[choose-best-ws] use single url: ",n),null===(N=s.store)||void 0===N||N.recordJoinChannelService({urls:[n],service:"gateway"},r);try{P=new WebSocket(n),p.push(P),P.binaryType="arraybuffer"}catch(D){const k=new Q(M.WS_ERR,"init websocket failed! Error: ".concat(D.toString()));return w.error("[".concat(s.name,"]").concat(k)),void d(k)}P.onopen=()=>{c(P)},P.onclose=D=>{d(D)},P.onmessage=D=>{w.debug("[choose-best-ws]".concat(P.url," onmessage: ").concat(D.data))},mi(s.forceCloseTimeout).then(()=>{P&&P.readyState!==WebSocket.OPEN&&P.close()})}}).then(c=>(s.closeEstablishingWs=void 0,c)).catch(c=>{throw s.closeEstablishingWs=void 0,c})})()}}class cx extends Yt{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===qe.CONNECTED?this.emit(le.WS_CONNECTED):n===qe.RECONNECTING?this.emit(le.WS_RECONNECTING,this._websocketReconnectReason):n===qe.CLOSED&&this.emit(le.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(n,r){super(),S(this,"_disconnectedReason",void 0),S(this,"_websocketReconnectReason",void 0),S(this,"_connectionState",qe.CLOSED),S(this,"reconnectToken",void 0),S(this,"websocket",void 0),S(this,"openConnectionTime",void 0),S(this,"clientId",void 0),S(this,"lastMsgTime",Date.now()),S(this,"uploadCache",[]),S(this,"uploadCacheInterval",void 0),S(this,"rttRolling",new ff(5)),S(this,"pingpongTimer",void 0),S(this,"wsInflateDataTimer",void 0),S(this,"pingpongTimeoutCount",0),S(this,"joinResponse",void 0),S(this,"multiIpOption",void 0),S(this,"initError",void 0),S(this,"spec",void 0),S(this,"store",void 0),S(this,"onWebsocketMessage",s=>{if(s.data instanceof ArrayBuffer)return void this.emit(le.ON_BINARY_DATA,s.data);const c=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===me.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===me.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Xe.UID_BANNED);break;case 15:this.close(Xe.IP_BANNED);break;case 16:this.close(Xe.CHANNEL_BANNED)}if(c._type===me.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Ce.ERR_LICENSE_MISSING:this.close(Xe.LICENSE_MISSING);break;case Ce.ERR_LICENSE_EXPIRED:this.close(Xe.LICENSE_EXPIRED);break;case Ce.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Xe.LICENSE_MINUTES_EXCEEDED);break;case Ce.ERR_LICENSE_PERIOD_INVALID:this.close(Xe.LICENSE_PERIOD_INVALID);break;case Ce.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Xe.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ce.ERR_LICENSE_ILLEGAL:this.close(Xe.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=n.clientId,this.spec=n,this.store=r,this.websocket=new vh("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===qe.CONNECTED&&this.reconnect("retry",Xn.OFFLINE)})}request(n,r,s,c){var d=this;return x(function*(){const h=It(6,""),p={_id:h,_type:n,_message:r},m=d.websocket.connectionID,_=()=>new z((P,D)=>{if(d.connectionState===qe.CONNECTED)return P();const k=()=>{d.off(le.WS_CLOSED,V),P()},V=()=>{d.off(le.WS_CONNECTED,k),D(new G(M.WS_ABORT))};d.once(le.WS_CONNECTED,k),d.once(le.WS_CLOSED,V),n!==be.PUBLISH&&n!==be.SUBSCRIBE&&n!==be.UNSUBSCRIBE&&n!==be.UNPUBLISH&&n!==be.CONTROL&&n!==be.RESTART_ICE||d.once(le.DISCONNECT_P2P,()=>{D(new G(M.DISCONNECT_P2P))}),n!==be.PUBLISH&&n!==be.RESTART_ICE||d.once(le.ABORT_P2P_EXECUTION,()=>{D(new G(M.DISCONNECT_P2P))})});if(d.connectionState!==qe.CONNECTING&&d.connectionState!==qe.RECONNECTING||n===be.JOIN||n===be.REJOIN||(yield _()),d.websocket.sendMessage(p,!0),c)return;const g=new z((P,D)=>{let k=!1;const V=(Y,oe)=>{k=!0,P({isSuccess:"success"===Y,message:oe||{}}),d.off(le.WS_CLOSED,U),d.off(le.WS_RECONNECTING,U),d.emit(le.REQUEST_SUCCESS,n,r)};d.once("res-@".concat(h),V);const U=()=>{D(new G(M.WS_ABORT,"type: ".concat(n))),d.off(le.WS_CLOSED,U),d.off(le.WS_RECONNECTING,U),d.off("res-@".concat(h),V)};d.once(le.WS_CLOSED,U),d.once(le.WS_RECONNECTING,U),mi(B("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||k||(w.warning("[".concat(d.clientId,"] ws request timeout, type: ").concat(n)),d.emit(le.REQUEST_TIMEOUT,n,r))})});let v=null;try{v=yield g}catch(P){if(d.connectionState===qe.CLOSED||n===be.LEAVE)throw new G(M.WS_ABORT);return!d.spec.forceWaitGatewayResponse||s?P.throw():n===be.JOIN||n===be.REJOIN?null:(yield _(),yield d.request(n,r))}if(v.isSuccess)return v.message;const b=Number(v.message.error_code||v.message.code),C=Eh(b),N=new G(M.UNEXPECTED_RESPONSE,"".concat(C.desc,": ").concat(v.message.error_str),{code:b,data:v.message});return"success"===C.action?v.message:(w.warning("[".concat(d.clientId,"] [").concat(d.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(b,", message: ").concat(C.desc,", action: ").concat(C.action)),b===Ce.ERR_TOO_MANY_BROADCASTERS?((n===be.JOIN||n===be.REJOIN)&&(d.initError=N,d.close()),N.throw()):"failed"===C.action?N.throw():"quit"===C.action?(d.initError=N,d.close(),N.throw()):(b===Ce.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=v.message.option,w.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",Xn.MULTI_IP)):d.reconnect(C.action,Xn.SERVER_ERROR),n===be.JOIN||n===be.REJOIN?null:yield d.request(n,r)))})()}waitMessage(n,r){return new z(s=>{const c=d=>{(!r||r(d))&&(this.off(n,c),s(d))};this.on(n,c)})}upload(n,r){const s={_type:n,_message:r};try{this.websocket.sendMessage(s)}catch{const d=B("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==qe.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},B("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,r){this.websocket.sendMessage({_type:n,_message:r})}init(n,r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new z((s,c)=>{this.once(le.WS_CONNECTED,()=>s(this.joinResponse)),this.once(le.WS_CLOSED,()=>c(this.initError||new G(M.WS_ABORT))),this.connectionState=qe.CONNECTING,this.websocket.init(n).catch(c),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=n||Xe.LEAVE,this.connectionState=qe.CLOSED,w.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),n===Xe.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new vh("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}join(){var n=this;return x(function*(){if(!n.joinResponse){n.emit(le.ABORT_P2P_EXECUTION);const r=yield Qt(n,le.REQUEST_JOIN_INFO),s=yield n.request(be.JOIN,r);if(!s)return n.emit(le.REPORT_JOIN_GATEWAY,qc.TIMEOUT,n.url||""),!1;n.joinResponse=s,n.emit(le.JOIN_RESPONSE,n.joinResponse),n.reconnectToken=n.joinResponse.rejoin_token}return n.connectionState=qe.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),!0})()}rejoin(){var n=this;return x(function*(){if(!n.reconnectToken)throw new G(M.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=rc(n,le.REQUEST_REJOIN_INFO);r.token=n.reconnectToken;const s=yield n.request(be.REJOIN,r);return!!s&&(n.connectionState=qe.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),s.peers&&s.peers.forEach(c=>{n.emit(me.ON_USER_ONLINE,{uid:c.uid}),c.audio&&n.emit(me.ON_ADD_AUDIO_STREAM,{uid:c.uid,uint_id:c.uint_id,audio:!0,ssrcId:c.audio_ssrc}),c.video&&n.emit(me.ON_ADD_VIDEO_STREAM,{uid:c.uid,uint_id:c.uint_id,video:!0,ssrcId:c.video_ssrc}),n.emit(c.audio_mute?me.MUTE_AUDIO:me.UNMUTE_AUDIO,{uid:c.uid}),n.emit(c.video_mute?me.MUTE_VIDEO:me.UNMUTE_VIDEO,{uid:c.uid}),n.emit(c.audio_enable_local?me.ENABLE_LOCAL_AUDIO:me.DISABLE_LOCAL_AUDIO,{uid:c.uid}),n.emit(c.video_enable_local?me.ENABLE_LOCAL_VIDEO:me.DISABLE_LOCAL_VIDEO,{uid:c.uid}),c.audio||c.video||n.emit(me.ON_REMOVE_STREAM,{uid:c.uid,uint_id:c.uint_id})}),!0)})()}reconnect(n,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,r)}handleNotification(n){w.debug("[".concat(this.clientId,"] receive notification: "),n);const r=Eh(n.code);if("success"!==r.action){if("failed"!==r.action)return"quit"===r.action?("ERR_REPEAT_JOIN_CHANNEL"===r.desc&&this.close(Xe.UID_BANNED),void this.close()):void this.reconnect(r.action,Xn.SERVER_ERROR);w.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=B("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=n&&(w.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>B("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Xn.TIMEOUT):this.request(be.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-r;this.rttRolling.add(s),B("REPORT_STATS")&&this.send(be.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWsInflateData(){const{wsInflateLength:n,wsDeflateLength:r}=this.websocket.getWsInflateData();0!==n&&0!==r&&this.upload(zr.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:n})}handleWebsocketEvents(){this.websocket.on(Me.RECONNECT_WAITTING_FINISH,n=>{this.emit(le.WS_RECONNECT_WAITTING_FINISH,n)}),this.websocket.on(Me.RECONNECT_CREATE_CONNECTION,n=>{this.emit(le.WS_RECONNECT_CREATE_CONNECTION,n)}),this.websocket.on(Me.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Me.CLOSED,()=>{this.connectionState=qe.CLOSED}),this.websocket.on(Me.FAILED,()=>{this._disconnectedReason=Xe.NETWORK_ERROR,this.connectionState=qe.CLOSED}),this.websocket.on(Me.RECONNECTING,n=>{this._websocketReconnectReason=n,this.joinResponse=void 0,this.connectionState=this.connectionState===qe.CONNECTED?qe.RECONNECTING:qe.CONNECTING}),this.websocket.on(Me.WILL_RECONNECT,(n,r,s)=>{const c=rc(this,le.IS_P2P_DISCONNECTED),d=c||"retry"!==n;c&&"retry"===n&&(w.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),n="tryNext",r=qc.P2P_DISCONNECTED),d&&(w.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(n)),this.emit(le.REPORT_JOIN_GATEWAY,r||qc.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(le.NEED_RENEW_SESSION),this.emit(le.DISCONNECT_P2P)),s(n)}),this.websocket.on(Me.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(n=>{w.warning("[".concat(this.clientId,"] rejoin failed ").concat(n)),this.reconnect("tryNext",Xn.SERVER_ERROR)}):this.join().catch(n=>{if(this.emit(le.REPORT_JOIN_GATEWAY,n.message||n.code||qc.UNKNOWN_REASON,this.url||""),n instanceof G&&n.code===M.UNEXPECTED_RESPONSE&&n.data.code===Ce.ERR_NO_AUTHORIZED)return w.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Xn.SERVER_ERROR);w.error("[".concat(this.clientId,"] join gateway request failed"),n.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Xn.SERVER_ERROR):(this.initError=n,this.close())})}),this.websocket.on(Me.REQUEST_NEW_URLS,(n,r)=>{Qt(this,le.REQUEST_RECOVER,this.multiIpOption).then(n).catch(r)}),this.websocket.on(Me.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(me.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var lC="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",Of=Xm,lx=Rc,dC=lC,dx=hi("".replace),IU=RegExp("^["+dC+"]+"),ux=RegExp("(^|[^"+dC+"])["+dC+"]+$"),uC=function(o){return function(n){var r=lx(Of(n));return 1&o&&(r=dx(r,IU,"")),2&o&&(r=dx(r,ux,"$1")),r}},yh={start:uC(1),end:uC(2),trim:uC(3)},RU=hb.PROPER,AU=qn,hx=lC,DU=yh.trim;In({target:"String",proto:!0,forced:function(o){return AU(function(){return!!hx[o]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[o]()||RU&&hx[o].name!==o})}("trim")},{trim:function(){return DU(this)}});var ni,di,OU=bu("String").trim,NU=Ns,PU=OU,CD=String.prototype,TD=dr(function(o){var n=o.trim;return"string"==typeof o||o===CD||NU(CD,o)&&n===CD.trim?PU:n});function Xc(o,n,r){return{sampleRate:o,stereo:n,bitrate:r}}function Je(o,n,r,s,c){return{width:o,height:n,frameRate:r,bitrateMin:s,bitrateMax:c}}function ms(o,n,r,s,c){return{width:{max:o},height:{max:n},frameRate:r,bitrateMin:s,bitrateMax:c}}function hC(o,n){return{numSpatialLayers:o,numTemporalLayers:n}}(function(o){o[o.CHOOSE_SERVER=11]="CHOOSE_SERVER",o[o.CLOUD_PROXY=18]="CLOUD_PROXY",o[o.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",o[o.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"})(ni||(ni={})),function(o){o.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",o.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",o.IOS_INTERRUPTION_START="ios-interruption-start",o.IOS_INTERRUPTION_END="ios-interruption-end",o.STATE_CHANGE="state-change"}(di||(di={}));const Zt={"90p":Je(160,90),"90p_1":Je(160,90),"120p":Je(160,120,15,30,65),"120p_1":Je(160,120,15,30,65),"120p_3":Je(120,120,15,30,50),"120p_4":Je(212,120),"180p":Je(320,180,15,30,140),"180p_1":Je(320,180,15,30,140),"180p_3":Je(180,180,15,30,100),"180p_4":Je(240,180,15,30,120),"240p":Je(320,240,15,40,200),"240p_1":Je(320,240,15,40,200),"240p_3":Je(240,240,15,40,140),"240p_4":Je(424,240,15,40,220),"360p":Je(640,360,15,80,400),"360p_1":Je(640,360,15,80,400),"360p_3":Je(360,360,15,80,260),"360p_4":Je(640,360,30,80,600),"360p_6":Je(360,360,30,80,400),"360p_7":Je(480,360,15,80,320),"360p_8":Je(480,360,30,80,490),"360p_9":Je(640,360,15,80,800),"360p_10":Je(640,360,24,80,800),"360p_11":Je(640,360,24,80,1e3),"480p":Je(640,480,15,100,500),"480p_1":Je(640,480,15,100,500),"480p_2":Je(640,480,30,100,1e3),"480p_3":Je(480,480,15,100,400),"480p_4":Je(640,480,30,100,750),"480p_6":Je(480,480,30,100,600),"480p_8":Je(848,480,15,100,610),"480p_9":Je(848,480,30,100,930),"480p_10":Je(640,480,10,100,400),"720p":Je(1280,720,15,120,1130),"720p_1":Je(1280,720,15,120,1130),"720p_2":Je(1280,720,30,120,2e3),"720p_3":Je(1280,720,30,120,1710),"720p_5":Je(960,720,15,120,910),"720p_6":Je(960,720,30,120,1380),"1080p":Je(1920,1080,15,120,2080),"1080p_1":Je(1920,1080,15,120,2080),"1080p_2":Je(1920,1080,30,120,3e3),"1080p_3":Je(1920,1080,30,120,3150),"1080p_5":Je(1920,1080,60,120,4780),"1440p":Je(2560,1440,30,120,4850),"1440p_1":Je(2560,1440,30,120,4850),"1440p_2":Je(2560,1440,60,120,7350),"4k":Je(3840,2160,30,120,8910),"4k_1":Je(3840,2160,30,120,8910),"4k_3":Je(3840,2160,60,120,13500)},pC={"480p":ms(640,480,5),"480p_1":ms(640,480,5),"480p_2":ms(640,480,30),"480p_3":ms(640,480,15),"720p":ms(1280,720,5),"720p_1":ms(1280,720,5),"720p_2":ms(1280,720,30),"720p_3":ms(1280,720,15),"1080p":ms(1920,1080,5),"1080p_1":ms(1920,1080,5),"1080p_2":ms(1920,1080,30),"1080p_3":ms(1920,1080,15)},px={"1SL1TL":hC(1,1),"3SL3TL":hC(3,3),"2SL3TL":hC(2,3)};function sc(o){return o||(o="480p_1"),"string"==typeof o?Object.assign({},Zt[o]):o}function pE(o){return"string"==typeof o?Object.assign({},pC[o]):o}function Nf(o){return"string"==typeof o?Object.assign({},px[o]):o}const fx={speech_low_quality:Xc(16e3,!1),speech_standard:Xc(32e3,!1,18),music_standard:Xc(48e3,!1),standard_stereo:Xc(48e3,!0,56),high_quality:Xc(48e3,!1,128),high_quality_stereo:Xc(48e3,!0,192)};function bh(o){return"string"==typeof o?Object.assign({},fx[o]):o}const Id=[];function Ia(o){return Gn(o,"mediaSource",["screen","window","application"]),!0}var fe,Vt,ac,fE,Sh,Ch,Jc,Qc,wr,Pf;(function(o){o.NEED_RENEGOTIATE="@need_renegotiate",o.NEED_REPLACE_TRACK="@need_replace_track",o.NEED_CLOSE="@need_close",o.NEED_ENABLE_TRACK="@need_enable_track",o.NEED_DISABLE_TRACK="@need_disable_track",o.NEED_SESSION_ID="@need_sid",o.SET_OPTIMIZATION_MODE="@set_optimization_mode",o.GET_STATS="@get_stats",o.GET_LOW_VIDEO_TRACK="@get_low_video_track",o.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",o.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",o.NEED_MUTE_TRACK="@need_mute_track",o.NEED_UNMUTE_TRACK="@need_unmute_track"})(fe||(fe={})),function(o){o.SCREEN_TRACK="screen_track",o.CUSTOM_TRACK="custome_track",o.LOW_STREAM="low_stream"}(Vt||(Vt={})),function(o){o[o.HIGH_STREAM=0]="HIGH_STREAM",o[o.LOW_STREAM=1]="LOW_STREAM"}(ac||(ac={})),function(o){o[o.HIGH_STREAM=0]="HIGH_STREAM",o[o.LOW_STREAM=1]="LOW_STREAM"}(fE||(fE={})),function(o){o[o.DISABLE=0]="DISABLE",o[o.LOW_STREAM=1]="LOW_STREAM",o[o.AUDIO_ONLY=2]="AUDIO_ONLY"}(Sh||(Sh={})),function(o){o.TRANSCEIVER_UPDATED="transceiver-updated"}(Ch||(Ch={})),function(o){o.SOURCE_STATE_CHANGE="source-state-change",o.TRACK_ENDED="track-ended",o.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",o.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",o.CLOSED="closed"}(Jc||(Jc={})),function(o){o.FIRST_FRAME_DECODED="first-frame-decoded",o.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(Qc||(Qc={})),function(o){o.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",o.RECEIVE_TRACK_BUFFER="receive_track_buffer",o.ON_AUDIO_BUFFER="on_audio_buffer",o.UPDATE_SOURCE="update_source"}(wr||(wr={})),function(o){o.UPDATE_TRACK_SOURCE="update-track-source"}(Pf||(Pf={}));const Ir={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},gi={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Ei={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Ht={uplinkNetworkQuality:0,downlinkNetworkQuality:0},ii={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var Le,qr,Rd,cc,xi;(function(o){o.ON_TRACK="on_track",o.ON_NODE="on_node"})(Le||(Le={})),function(o){o.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",o.REQUEST_CONSTRAINTS="request_constraints"}(qr||(qr={})),function(o){o.IDLE="IDLE",o.INITING="INITING",o.INITEND="INITEND"}(Rd||(Rd={})),function(o){o.STATE_CHANGE="state_change",o.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",o.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",o.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(cc||(cc={})),function(o){o.NONE="none",o.INIT="init",o.CANPLAY="canplay",o.PLAYING="playing",o.PAUSED="paused",o.SUSPEND="suspend",o.STALLED="stalled",o.WAITING="waiting",o.ERROR="error",o.DESTROYED="destroyed",o.ABORT="abort",o.ENDED="ended",o.EMPTIED="emptied",o.LOADEDDATA="loadeddata"}(xi||(xi={}));const fC={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};var Th;!function(o){o.OPEN="open",o.MESSAGE="message",o.CLOSE="close",o.CLOSING="closing",o.ERROR="error"}(Th||(Th={}));class mx extends Yt{constructor(n,r){super(),S(this,"_ID",void 0),S(this,"_rtpTransceiver",void 0),S(this,"_lowRtpTransceiver",void 0),S(this,"_hints",[]),S(this,"_isClosed",!1),S(this,"_originMediaStreamTrack",void 0),S(this,"_mediaStreamTrack",void 0),S(this,"_external",{}),this._ID=r||It(8,"track-"),this._originMediaStreamTrack=n,this._mediaStreamTrack=n,Re(Id).call(Id,this)||Id.push(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(n){if(!n){Se.reportApiInvoke(null,{name:Vn.GET_MEDIA_STREAM_TRACK,options:[],tag:dn.TRACER}).onSuccess(this._mediaStreamTrack&&"string"==typeof this._mediaStreamTrack.label?this._mediaStreamTrack.label:"")}return this._mediaStreamTrack}getRTCRtpTransceiver(n){return n===ac.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(n){const r=Id.indexOf(n);-1!==r&&Id.splice(r,1)}(this),this.emit(Jc.CLOSED)}_updateRtpTransceiver(n,r){if(r===ac.LOW_STREAM){if(this._lowRtpTransceiver===n)return;this._lowRtpTransceiver=n}else{if(this._rtpTransceiver===n)return;this._rtpTransceiver=n}this.emit(Ch.TRANSCEIVER_UPDATED,n,r)}}class Li extends mx{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(n){this._processorContext=n}constructor(n,r){super(n,r),S(this,"_enabled",!0),S(this,"_muted",!1),S(this,"_isExternalTrack",!1),S(this,"_isClosed",!1),S(this,"_enabledMutex",void 0),S(this,"processor",void 0),S(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Wn("".concat(this.getTrackId())),n.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var n,r;return null!==(n=null===(r=this._originMediaStreamTrack)||void 0===r?void 0:r.label)&&void 0!==n?n:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,w.debug("[".concat(this.getTrackId(),"] close")),this.emit(fe.NEED_CLOSE),super.close())}_updateOriginMediaStreamTrack(n,r){var s=arguments,c=this;return x(function*(){c._isExternalTrack=s.length>2&&void 0!==s[2]&&s[2],n!==c._originMediaStreamTrack&&(c._originMediaStreamTrack&&(c._originMediaStreamTrack.removeEventListener("ended",c._handleTrackEnded),r&&c._originMediaStreamTrack.stop()),n.addEventListener("ended",c._handleTrackEnded),c._originMediaStreamTrack=n,c._muted&&(c._originMediaStreamTrack.enabled=!1),c._mediaStreamTrack=c._originMediaStreamTrack,c._updatePlayerSource(),yield Mt(c,fe.NEED_REPLACE_TRACK,c),c.processor&&c.processor.updateInput({track:c._originMediaStreamTrack,context:c.processorContext}))})()}_getDefaultPlayerConfig(){return{}}onTrackEnded(){w.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Jc.TRACK_ENDED)}stateCheck(n,r){if(w.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(n,": ").concat(r,"]")),jc(r,n),this._enabled&&this._muted&&"enabled"===n&&!1===r)throw new Q(M.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",w);if(!this._enabled&&!this._muted&&"muted"===n&&!0===r)throw new Q(M.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",w)}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function Mf(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}const kf=window.AudioContext||window.webkitAudioContext;let pr=null;const it=new class extends Yt{constructor(){var o;super(...arguments),o=this,S(this,"prevState",void 0),S(this,"curState",void 0),S(this,"currentTime",void 0),S(this,"currentTimeStuckAt",void 0),S(this,"interruptDetectorTrack",void 0),S(this,"onLocalAudioTrackMute",()=>{w.info("ios15-interruption-start"),this.emit(di.IOS_15_16_INTERRUPTION_START)}),S(this,"onLocalAudioTrackUnmute",x(function*(){w.info("ios15-interruption-end"),"running"!==o.curState||o.duringInterruption?w.info("ios15-interruption-end-canceled"):(pr&&(yield pr.suspend()),o.emit(di.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(o){w.debug("webaudio bindInterruptDetectorTrack ".concat(o.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=o,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(o){w.debug("webaudio unbindInterruptDetectorTrack ".concat(o.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===o&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function xf(){if(!pr){if(function mC(){if(!kf)return void w.error("your browser is not support web audio");w.info("create audio context");const o=function(n){for(var r=1;r<arguments.length;r++){var s=null!=arguments[r]?arguments[r]:{};r%2?Mf(Object(s),!0).forEach(function(c){S(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):Mf(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}({},B("WEBAUDIO_INIT_OPTIONS"));var n;w.debug("audio context init option:",JSON.stringify(o)),pr=new kf(o),it.curState=pr.state,pr.onstatechange=()=>{it.prevState=it.curState,it.curState=pr?pr.state:void 0;const{prevState:n,curState:r}=it,s="running"===r,c="interrupted"===r,d="running"===n,h="suspended"===n,p="interrupted"===n,m=Ve().osVersion;(ir()||Gs())&&d&&c&&(w.info("ios".concat(m,"-interruption-start")),it.emit(di.IOS_INTERRUPTION_START)),(ir()||Gs())&&(h||p)&&s&&(w.info("ios".concat(m,"-interruption-end")),it.emit(di.IOS_INTERRUPTION_END)),n!==r&&(w.debug("AudioContext State Change","".concat(n,"=>").concat(r)),it.emit(di.STATE_CHANGE))},setInterval(()=>{var n;const r=null===(n=pr)||void 0===n?void 0:n.currentTime;it.currentTime!==r?(it.currentTimeStuckAt&&(w.debug("AudioContext current time resume at ".concat(r)),it.currentTimeStuckAt=void 0),it.currentTime=r):(r!==it.currentTimeStuckAt&&(Se.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:r},tag:dn.TRACER}).onSuccess(),w.warning("AudioContext current time stuck at ".concat(r))),it.currentTimeStuckAt=r)},5e3),(n=x(function*(r){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let c,d=!1,h=!1,p=!1;function m(k){"running"===r.state?_(!1):ir()||Gs()?"suspended"===r.state&&(_(!0),k&&r.resume().then(v,v)):"closed"!==r.state&&(_(!0),k&&r.resume().then(v,v))}function _(k){if(d!==k){d=k;for(let V=0,U=s;V<U.length;V+=1){const Y=U[V];k?window.addEventListener(Y,b,{capture:!0,passive:!0}):window.removeEventListener(Y,b,{capture:!0,passive:!0})}}}function v(){m(!1)}function b(){m(!0)}function C(k){if(!p)if(c.paused)if(k){let V;N(!1),p=!0;try{V=c.play(),V?V.then(P,P):(c.addEventListener("playing",P),c.addEventListener("abort",P),c.addEventListener("error",P))}catch{P()}}else N(!0);else N(!1)}function N(k){if(h!==k){h=k;for(let V=0,U=s;V<U.length;V++){const Y=U[V];k?window.addEventListener(Y,D,{capture:!0,passive:!0}):window.removeEventListener(Y,D,{capture:!0,passive:!0})}}}function P(){c.removeEventListener("playing",P),c.removeEventListener("abort",P),c.removeEventListener("error",P),p=!1,C(!1)}function D(){C(!0)}if(ir()){const k=r.createMediaStreamDestination(),V=document.createElement("div");V.innerHTML="<audio x-webkit-airplay='deny'></audio>",c=V.children.item(0),c.controls=!1,c.disableRemotePlayback=!0,c.preload="auto",c.srcObject=k.stream,C(!0)}it.on(di.STATE_CHANGE,function g(){m(!0)}),m(!1)}),function(r){return n.apply(this,arguments)})(pr)}(),!pr)throw new Q(M.NOT_SUPPORTED,"can not create audio context");return pr}return pr}function _x(){return!!pr}function wh(o){if(function(){if(null!==_C)return _C;const s=xf(),c=s.createBufferSource(),d=s.createGain(),h=s.createGain();c.connect(d),c.connect(h),c.disconnect(d);let p=!1;try{c.disconnect(d)}catch{p=!0}return c.disconnect(),_C=p,p}())return;const n=o.connect,r=o.disconnect;o.connect=(s,c,d)=>{var h;return o._inputNodes||(o._inputNodes=[]),Re(h=o._inputNodes).call(h,s)||(s instanceof AudioNode?(o._inputNodes.push(s),n.call(o,s,c,d)):n.call(o,s,c)),o},o.disconnect=(s,c,d)=>{r.call(o),s?IS(o._inputNodes,s):o._inputNodes=[];for(const h of o._inputNodes)n.call(o,h)}}let _C=null;function gC(o,n){let r=!1;const s=1/n;if(B("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{r?window.clearInterval(c):o(performance.now()/1e3)},1e3*s)}else{const c=xf();let d=c.createGain();d.gain.value=0,d.connect(c.destination);const h=()=>{if(r)return void(d=null);const p=c.createOscillator();p.onended=h,p.connect(d),p.start(0),p.stop(c.currentTime+s),o(c.currentTime)};h()}return()=>{r=!0}}const Ci={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1};function Lt(){return Ci}class wD{constructor(){S(this,"context",void 0),S(this,"analyserNode",void 0),S(this,"sourceNode",void 0),this.context=xf(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(n){if(n!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=n,n?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||ir()||Gs()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode))return 0;const n=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(n);else{const s=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(s);for(let c=0;c<n.length;++c)n[c]=s[c]/128-1}const r=_d(n).call(n,(s,c)=>s+c*c,0)/n.length;return Math.max(10*Math.log10(r)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var n,r;null===(n=this.sourceNode)||void 0===n||n.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(r=this.sourceNode)||void 0===r||r.connect(this.analyserNode)}catch{w.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class gx extends Yt{get processSourceNode(){return this.sourceNode}set processedNode(n){var r;if(!this.isDestroyed&&this._processedNode!==n){try{var s;null===(s=this.sourceNode)||void 0===s||s.disconnect(this.outputNode)}catch{}null===(r=this._processedNode)||void 0===r||r.disconnect(),this._processedNode=n,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),S(this,"outputNode",void 0),S(this,"outputTrack",void 0),S(this,"isPlayed",!1),S(this,"context",void 0),S(this,"audioBufferNode",void 0),S(this,"destNode",void 0),S(this,"audioOutputLevel",0),S(this,"volumeLevelAnalyser",void 0),S(this,"_processedNode",void 0),S(this,"playNode",void 0),S(this,"isDestroyed",!1),S(this,"onNoAudioInput",void 0),S(this,"isNoAudioInput",!1),S(this,"_noAudioInputCount",0),this.context=xf(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),wh(this.outputNode),this.volumeLevelAnalyser=new wD}startGetAudioBuffer(n){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(n),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=r=>{this.emit(wr.ON_AUDIO_BUFFER,function(s){for(let c=0;c<s.outputBuffer.numberOfChannels;c+=1){const d=s.outputBuffer.getChannelData(c);for(let h=0;h<d.length;h+=1)d[h]=0}return s.inputBuffer}(r))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Lt().webAudioMediaStreamDest)throw new Q(M.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(n){"running"!==this.context.state&&ao(()=>{it.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=n||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}checkHasAudioInput(){var n=arguments,r=this;return x(function*(){let s=n.length>0&&void 0!==n[0]?n[0]:0;if(s>5)return r.isNoAudioInput=!0,r.onNoAudioInput&&r.onNoAudioInput(),!1;ir()||Gs()?"suspended"===r.context.state&&r.context.resume():"running"!==r.context.state&&r.context.resume();const c=r.volumeLevelAnalyser.getAnalyserNode();let d;c.getFloatTimeDomainData?(d=new Float32Array(c.fftSize),c.getFloatTimeDomainData(d)):(d=new Uint8Array(c.fftSize),c.getByteTimeDomainData(d));let h=!1;for(let p=0;p<d.length;p++)0!==d[p]&&(h=!0);return h?(r.isNoAudioInput=!1,!0):(yield mi(200),(yield r.checkHasAudioInput(s?s+1:1))&&h)})()}getAudioVolume(){return this.outputNode.gain.value}setVolume(n){this.outputNode.gain.setValueAtTime(n,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var n,r;null===(n=this.processedNode)||void 0===n||n.disconnect(),null===(r=this.sourceNode)||void 0===r||r.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var n;this.processedNode?null===(n=this.processedNode)||void 0===n||n.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class po extends gx{get isFreeze(){return!1}constructor(n,r,s){var c,d;if(super(),c=this,S(this,"sourceNode",void 0),S(this,"track",void 0),S(this,"clonedTrack",void 0),S(this,"audioElement",void 0),S(this,"isCurrentTrackCloned",!1),S(this,"isRemoteTrack",!1),S(this,"originVolumeLevelAnalyser",void 0),S(this,"rebuildWebAudio",x(function*(){if(w.debug("ready to rebuild web audio, state:",c.context.state),c.isNoAudioInput&&(yield c.checkHasAudioInput()),!c.isNoAudioInput||c.isDestroyed)return document.body.removeEventListener("click",c.rebuildWebAudio,!0),void w.debug("rebuild web audio success, current volume status",c.getAccurateVolumeLevel());c.context.resume().then(()=>w.info("resume success")),w.debug("rebuild web audio because of ios 12 bugs"),c.disconnect();const m=c.track;c.track=c.track.clone(),c.isCurrentTrackCloned?m.stop():c.isCurrentTrackCloned=!0;const _=new MediaStream([c.track]);c.sourceNode=c.context.createMediaStreamSource(_),wh(c.sourceNode),c.volumeLevelAnalyser.rebuildAnalyser();const g=c.outputNode.gain.value;c.outputNode=c.context.createGain(),c.outputNode.gain.setValueAtTime(g,c.context.currentTime),wh(c.outputNode),c.emit(wr.UPDATE_SOURCE),c.connect(),c.audioElement.srcObject=_,c.isPlayed&&c.play(c.playNode),c.checkHasAudioInput()})),"audio"!==n.kind)throw new Q(M.UNEXPECTED_ERROR);this.track=n;const h=new MediaStream([this.track]);if(this.isRemoteTrack=!!r,this.sourceNode=this.context.createMediaStreamSource(h),wh(this.sourceNode),s){const m=s.clone();m.enabled=!0,this.clonedTrack=m,w.debug("create an unmuted track ".concat(m.id," from the original track ").concat(s.id," to get the volume"));const _=this.context.createMediaStreamSource(new MediaStream([m]));wh(_),this.originVolumeLevelAnalyser=new wD,this.originVolumeLevelAnalyser.updateSource(_)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=h;const p=Ve();r&&p.os===ei.IOS&&Number(null===(d=p.osVersion)||void 0===d?void 0:d.split(".")[0])<15&&(it.on(di.STATE_CHANGE,()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(n){this.sourceNode.disconnect(),this.track=n,this.isCurrentTrackCloned=!1;const r=new MediaStream([n]);this.sourceNode=this.context.createMediaStreamSource(r),wh(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(wr.UPDATE_SOURCE),this.audioElement.srcObject=r}destroy(){var n;this.audioElement.srcObject=null,this.audioElement.remove(),it.off("state-change",this.rebuildWebAudio),null===(n=this.originVolumeLevelAnalyser)||void 0===n||n.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(n){return this.context.createMediaStreamSource(new MediaStream([n]))}updateOriginTrack(n){const r=n.clone();r.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=r),w.debug("create an unmuted track ".concat(r.id," from the original track ").concat(n.id," to get the volume"));const s=this.context.createMediaStreamSource(new MediaStream([r]));wh(s),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(s)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}function mE(o,n,r){return EC.apply(this,arguments)}function EC(){return EC=x(function*(o,n,r){const s=(d,h)=>d?"number"!=typeof d?d.max||d.exact||d.ideal||d.min||h:d:h,c={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxHeight:s(n.height,1080),maxWidth:s(n.width,1920)}}};return n.frameRate&&"number"!=typeof n.frameRate?(c.video.mandatory.maxFrameRate=n.frameRate.max,c.video.mandatory.minFrameRate=n.frameRate.min):"number"==typeof n.frameRate&&(c.video.mandatory.maxFrameRate=n.frameRate),yield navigator.mediaDevices.getUserMedia(c)}),EC.apply(this,arguments)}function vC(){return vC=x(function*(o,n){const r=yield ID(o.mediaSource),{sourceId:s,audio:c}=yield function(d){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new z((p,m)=>{const _=document.createElement("div");_.innerText="share screen",_.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const g=document.createElement("div");g.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const v=document.createElement("div");v.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",v.setAttribute("style","height: 12%;");const b=document.createElement("div");b.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const C=document.createElement("div");C.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const N=document.createElement("button");N.innerHTML="cancel",N.setAttribute("style","width: 85px;"),N.onclick=()=>{document.body.removeChild(k);const V=new Error("NotAllowedError");V.name="NotAllowedError",m(V)};let P=h;const D=document.createElement("div");if(h){const V=document.createElement("input");V.setAttribute("type","checkbox");const U=document.createElement("span");V.setAttribute("style","margin-right: 6px;"),U.innerText="Share audio",V.checked=P,V.onchange=()=>{P=V.checked},D.appendChild(V),D.appendChild(U)}C.appendChild(D),C.appendChild(N),g.appendChild(v),g.appendChild(b),g.appendChild(C);const k=document.createElement("div");k.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),k.appendChild(_),k.appendChild(g),document.body.appendChild(k),d.map(V=>{if(V.id){const U=document.createElement("div");U.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Y=V.thumbnail;try{const{width:oe}=Y.getSize();oe>1920&&(Y=Y.resize({width:1920}))}catch(oe){throw oe&&oe.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),oe}U.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Y.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+V.name.replace(/[\u00A0-\u9999<>\&]/g,function(oe){return"&#"+oe.charCodeAt(0)+";"})+"</span>",U.onclick=()=>{document.body.removeChild(k),p({sourceId:V.id,audio:P})},b.appendChild(U)}})})}(r,n);return yield mE(s,o,c)}),vC.apply(this,arguments)}function ID(o){return Ad.apply(this,arguments)}function Ad(){return Ad=x(function*(o){let n=["window","screen"];"application"!==o&&"window"!==o||(n=["window"]),"screen"===o&&(n=["screen"]);const r=vA();if(!r)throw console.error("failed to fetch electron, please mount it to window"),new Q(M.ELECTRON_IS_NULL);let s=null;try{var c;s=(null===(c=r.desktopCapturer)||void 0===c?void 0:c.getSources({types:n}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:n})}catch{s=null}s&&s.then||(s=new z((d,h)=>{r.desktopCapturer.getSources({types:n},(p,m)=>{p?h(p):d(m)})}));try{return yield s}catch(d){throw new Q(M.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}),Ad.apply(this,arguments)}function RD(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}const Ti=new Wn("safari");let ct=!1,Rt=!1;function fo(o,n){return Ih.apply(this,arguments)}function Ih(){return Ih=x(function*(o,n){let r=0,s=null;for(;r<2;)try{s=yield lc(o,n,r>0);break}catch(c){if(c instanceof Q)throw w.error("[".concat(n,"] ").concat(c.toString())),c;const d=mo(c.name||c.code||c,c.message);if(d.code===M.MEDIA_OPTION_INVALID){w.debug("[".concat(n,"] detect media option invalid, retry")),r+=1,yield mi(500);continue}throw w.error("[".concat(n,"] ").concat(d.toString())),d}if(!s)throw new Q(M.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return s}),Ih.apply(this,arguments)}function lc(o,n,r){return Rh.apply(this,arguments)}function Rh(){return Rh=x(function*(o,n,r){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Q(M.NOT_SUPPORTED,"can not find getUserMedia");r&&(o.video&&(delete o.video.width,delete o.video.height),o.screen&&(delete o.screen.width,delete o.screen.height));const s=Lt(),c=new MediaStream;if(o.audioSource&&c.addTrack(o.audioSource),o.videoSource&&c.addTrack(o.videoSource),!o.audio&&!o.video&&!o.screen)return w.debug("Using Video Source/ Audio Source"),c;if(o.screen)if(vA())Ah(c,o.screen.sourceId?yield mE(o.screen.sourceId,o.screen,o.screenAudio):yield function Ex(o,n){return vC.apply(this,arguments)}(o.screen,o.screenAudio));else if(Lg()&&o.screen.extensionId&&o.screen.mandatory){if(!s.getStreamFromExtension)throw new Q(M.NOT_SUPPORTED,"This browser does not support screen sharing");w.debug("[".concat(n,'] Screen access on chrome stable, looking for extension"'));const b=yield(h=o.screen.extensionId,p=n,new z((C,N)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},P=>{if(!P||!P.streamId)return w.error("[".concat(p,"] No response from Chrome Plugin. Plugin not installed properly"),P),void N(new Q(M.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));C(P.streamId)})}catch(P){w.error("[".concat(p,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),P.toString()),N(new Q(M.CHROME_PLUGIN_NOT_INSTALL))}}));o.screen.mandatory.chromeMediaSourceId=b,Ah(c,yield navigator.mediaDevices.getUserMedia({video:{mandatory:o.screen.mandatory}}))}else if(s.getDisplayMedia){var d;o.screen.mediaSource&&Ia(o.screen.mediaSource);const b={width:o.screen.width,height:o.screen.height,frameRate:o.screen.frameRate,displaySurface:null!==(d=o.screen.displaySurface)&&void 0!==d?d:"screen"===o.screen.mediaSource?"monitor":o.screen.mediaSource},{selfBrowserSurface:C,surfaceSwitching:N,systemAudio:P}=o.screen,D={selfBrowserSurface:C,surfaceSwitching:N,systemAudio:P};!C&&delete D.selfBrowserSurface,!N&&delete D.surfaceSwitching,!P&&delete D.systemAudio,w.debug("[".concat(n,"] getDisplayMedia:"),JSON.stringify({video:b,audio:!!o.screenAudio,controls:D}));const k=yield navigator.mediaDevices.getDisplayMedia(function(V){for(var U=1;U<arguments.length;U++){var Y=null!=arguments[U]?arguments[U]:{};U%2?RD(Object(Y),!0).forEach(function(oe){S(V,oe,Y[oe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(V,Object.getOwnPropertyDescriptors(Y)):RD(Object(Y)).forEach(function(oe){Object.defineProperty(V,oe,Object.getOwnPropertyDescriptor(Y,oe))})}return V}({video:b,audio:!!o.screenAudio},D));Ah(c,k)}else{if(!jt())throw w.error("[".concat(n,"] This browser does not support screenSharing")),new Q(M.NOT_SUPPORTED,"This browser does not support screen sharing");{o.screen.mediaSource&&Ia(o.screen.mediaSource);const b={video:{mediaSource:o.screen.mediaSource,width:o.screen.width,height:o.screen.height,frameRate:o.screen.frameRate}};w.debug("[".concat(n,"] getUserMedia: ").concat(JSON.stringify(b))),Ah(c,yield navigator.mediaDevices.getUserMedia(b))}}var h,p;if(!o.video&&!o.audio)return c;let m={video:o.video,audio:o.audio},_=B("MEDIA_DEVICE_CONSTRAINTS");if(_)try{"string"==typeof _&&(_=JSON.parse(_)),m=AS(m,_)}catch{}w.debug("[".concat(n,"] GetUserMedia"),JSON.stringify(m)),Ve();let g,v=null;(qi()||ir()||sf())&&(v=yield Ti.lock());try{g=yield navigator.mediaDevices.getUserMedia(m)}catch(b){throw v&&v(),b}return m.audio&&(ct=!0),m.video&&(Rt=!0),Ah(c,g),v&&v(),c}),Rh.apply(this,arguments)}function mo(o,n){switch(o){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Q(M.MEDIA_OPTION_INVALID,"".concat(o,": ").concat(n));case"NotFoundError":case"DevicesNotFoundError":return new Q(M.DEVICE_NOT_FOUND,"".concat(o,": ").concat(n));case"NotSupportedError":return new Q(M.NOT_SUPPORTED,"".concat(o,": ").concat(n));case"NotReadableError":return new Q(M.NOT_READABLE,"".concat(o,": ").concat(n));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Q(M.PERMISSION_DENIED,"".concat(o,": ").concat(n));case"ConstraintNotSatisfiedError":return new Q(M.CONSTRAINT_NOT_SATISFIED,"".concat(o,": ").concat(n));default:return w.error("getUserMedia unexpected error",o),new Q(M.UNEXPECTED_ERROR,"".concat(o,": ").concat(n))}}function Ah(o,n){const r=o.getVideoTracks()[0],s=o.getAudioTracks()[0],c=n.getVideoTracks()[0],d=n.getAudioTracks()[0];d&&(s&&o.removeTrack(s),o.addTrack(d)),c&&(r&&o.removeTrack(r),o.addTrack(c))}const sn=new class extends Yt{get state(){return this._state}set state(o){o!==this._state&&(this.emit(cc.STATE_CHANGE,o),this._state=o)}constructor(){super(),S(this,"_state",Rd.IDLE),S(this,"isAccessMicrophonePermission",!1),S(this,"isAccessCameraPermission",!1),S(this,"lastAccessMicrophonePermission",!1),S(this,"lastAccessCameraPermission",!1),S(this,"checkdeviceMatched",!1),S(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(B("ENUMERATE_DEVICES_INTERVAL")||(Bc()||mS()===ei.HARMONY_OS)&&cs())&&this.updateDevicesInfo()},B("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(o=>w.error(o.toString()))}enumerateDevices(o,n){var r=arguments,s=this;return x(function*(){let c=r.length>2&&void 0!==r[2]&&r[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Q(M.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const d=yield navigator.mediaDevices.enumerateDevices(),h=s.checkMediaDeviceInfoIsOk(d);let p=!s.isAccessMicrophonePermission&&o,m=!s.isAccessCameraPermission&&n;h.audio&&(p=!1),h.video&&(m=!1);let _=null,g=null,v=null;if(!c&&(p||m)){if(Ti.isLocked&&(w.debug("[device manager] wait GUM lock"),(yield Ti.lock())(),w.debug("[device manager] GUM unlock")),ct&&(p=!1,s.isAccessMicrophonePermission=!0),Rt&&(m=!1,s.isAccessCameraPermission=!0),w.debug("[device manager] check media device permissions",o,n,p,m),p&&m){try{v=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(b){const C=mo(b.name||b.code||b,b.message);if(C.code===M.PERMISSION_DENIED)throw C;w.warning("getUserMedia failed in getDevices",C)}s.isAccessCameraPermission=!0,s.isAccessMicrophonePermission=!0}else if(p){try{_=yield navigator.mediaDevices.getUserMedia({audio:o})}catch(b){const C=mo(b.name||b.code||b,b.message);if(C.code===M.PERMISSION_DENIED)throw C;w.warning("getUserMedia failed in getDevices",C)}s.isAccessMicrophonePermission=!0}else if(m){try{g=yield navigator.mediaDevices.getUserMedia({video:n})}catch(b){const C=mo(b.name||b.code||b,b.message);if(C.code===M.PERMISSION_DENIED)throw C;w.warning("getUserMedia failed in getDevices",C)}s.isAccessCameraPermission=!0}w.debug("[device manager] mic permission",o,"cam permission",n)}try{const b=yield navigator.mediaDevices.enumerateDevices();return _&&_.getTracks().forEach(C=>C.stop()),g&&g.getTracks().forEach(C=>C.stop()),v&&v.getTracks().forEach(C=>C.stop()),_=null,g=null,v=null,b}catch(b){return _&&_.getTracks().forEach(C=>C.stop()),g&&g.getTracks().forEach(C=>C.stop()),v&&v.getTracks().forEach(C=>C.stop()),_=null,g=null,v=null,new Q(M.ENUMERATE_DEVICES_FAILED,b.toString()).throw()}})()}getRecordingDevices(){var o=arguments,n=this;return x(function*(){let r=o.length>0&&void 0!==o[0]&&o[0];return(yield n.enumerateDevices(!0,!1,r)).filter(s=>"audioinput"===s.kind)})()}getCamerasDevices(){var o=arguments,n=this;return x(function*(){let r=o.length>0&&void 0!==o[0]&&o[0];return(yield n.enumerateDevices(!1,!0,r)).filter(s=>"videoinput"===s.kind)})()}getSpeakers(){var o=arguments,n=this;return x(function*(){let r=o.length>0&&void 0!==o[0]&&o[0];return(yield n.enumerateDevices(!0,!1,r)).filter(s=>"audiooutput"===s.kind)})()}searchDeviceIdByName(o){let n=null;return this.deviceInfoMap.forEach(r=>{r.device.label===o&&(n=r.device.deviceId)}),n}getDeviceById(o){var n=this;return x(function*(){const r=(yield n.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===o);if(!r)throw new Q(M.DEVICE_NOT_FOUND,"deviceId: ".concat(o));return r})()}init(){var o=this;return x(function*(){o.state=Rd.INITING;try{yield o.updateDevicesInfo(),o.state=Rd.INITEND}catch(n){throw w.warning("Device Detection functionality cannot start properly.",n.toString()),o.state=Rd.IDLE,!("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)&&new Q(M.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),n}})()}updateDevicesInfo(){var o=this;return x(function*(){const n=yield o.enumerateDevices(!0,!0,!0),r=Date.now(),s=[];if(n[0]&&n[0].label&&!1===o.checkdeviceMatched){o.checkdeviceMatched=!0;const d=n.find(p=>"audioinput"===p.kind&&"default"===p.deviceId),h=n.find(p=>"audiooutput"===p.kind&&"default"===p.deviceId);d&&h?h.groupId===d.groupId?w.debug("[device-check] default input ".concat(d.label," and output ").concat(h.label," is the same group")):w.warning("[device-check] default input ".concat(d.label," and output ").concat(h.label," is not the same group")):w.debug("[device-check] default input or output not found")}const c=o.checkMediaDeviceInfoIsOk(n);if(n.forEach(d=>{if(!d.deviceId)return;const h=o.deviceInfoMap.get("".concat(d.kind,"_").concat(d.deviceId));if("ACTIVE"!==(h?h.state:"INACTIVE")){const p={initAt:r,updateAt:r,device:d,state:"ACTIVE"};o.deviceInfoMap.set("".concat(d.kind,"_").concat(d.deviceId),p),s.push(p)}h&&(h.updateAt=r)}),o.deviceInfoMap.forEach((d,h)=>{"ACTIVE"===d.state&&d.updateAt!==r&&(d.state="INACTIVE",s.push(d))}),o.state!==Rd.INITEND)return c.audio&&(o.lastAccessMicrophonePermission=!0,o.isAccessMicrophonePermission=!0),void(c.video&&(o.lastAccessCameraPermission=!0,o.isAccessCameraPermission=!0));s.forEach(d=>{switch(d.device.kind){case"audioinput":o.lastAccessMicrophonePermission&&o.isAccessMicrophonePermission&&o.emit(cc.RECORDING_DEVICE_CHANGED,d);break;case"videoinput":o.lastAccessCameraPermission&&o.isAccessCameraPermission&&o.emit(cc.CAMERA_DEVICE_CHANGED,d);break;case"audiooutput":o.lastAccessMicrophonePermission&&o.isAccessMicrophonePermission&&o.emit(cc.PLAYOUT_DEVICE_CHANGED,d)}}),c.audio&&(o.lastAccessMicrophonePermission=!0,o.isAccessMicrophonePermission=!0),c.video&&(o.lastAccessCameraPermission=!0,o.isAccessCameraPermission=!0)})()}checkMediaDeviceInfoIsOk(o){const n=o.filter(c=>"audioinput"===c.kind),r=o.filter(c=>"videoinput"===c.kind),s={audio:!1,video:!1};for(const c of n)if(c.label&&c.deviceId){s.audio=!0;break}for(const c of r)if(c.label&&c.deviceId){s.video=!0;break}return s}};let yC=!1;const Ut=new class extends Yt{constructor(){super(...arguments),S(this,"onAutoplayFailed",void 0),S(this,"onAudioAutoplayFailed",void 0)}};function AD(){if(Ve(),!yC){const o=n=>{n.preventDefault(),yC=!1,af()?document.body.removeEventListener("click",o,!0):(document.body.removeEventListener("touchstart",o,!0),document.body.removeEventListener("mousedown",o,!0))};yC=!0,af()?document.body.addEventListener("click",o,!0):(document.body.addEventListener("touchstart",o,!0),document.body.addEventListener("mousedown",o,!0)),w.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Ut.onAutoplayFailed?Ut.onAutoplayFailed():w.warning(Ut.onAudioAutoplayFailed?"AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .":"We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),Ut.emit("autoplay-failed")}}function Lf(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function DD(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?Lf(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):Lf(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}function Ff(o,n,r,s){if(!o)return;const c=Se.getBaseInfoBySessionId(o);if(!c)return;const d=c.info,h=Date.now(),p=DD(DD({},d),{},{vid:void 0===d.vid?0:Number(d.vid),lts:h,elapse:h-c.startTime,cbRegistered:Ut.onAutoplayFailed||Ut.onAudioAutoplayFailed?1:-1,errorMsg:r,mediaType:n,trackId:s,extend:void 0});Se.send({type:zt.AUTOPLAY_FAILED,data:p},!0)}const vx=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Rr=new class{constructor(){S(this,"onAutoplayFailed",void 0),S(this,"elementMap",new Map),S(this,"elementStateMap",new Map),S(this,"elementsNeedToResume",[]),S(this,"sinkIdMap",new Map),S(this,"autoResumeAfterInterruption",()=>{Array.from(this.elementMap.entries()).forEach(o=>{let[n,r]=o;const s=this.elementStateMap.get(n),c=r.srcObject.getAudioTracks()[0];th()?c&&"live"===c.readyState&&"running"===it.curState&&(w.debug("auto resume after interruption for iOS 15"),r.pause(),r.play()):s&&"paused"===s&&c&&"live"===c.readyState&&"running"===it.curState&&(w.debug("auto resume after interruption for iOS"),r.play())})}),S(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(o=>{let[n,r]=o;const s=r.srcObject.getAudioTracks()[0];s&&"live"===s.readyState&&(w.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r.pause(),r.play())})}),this.autoResumeAudioElement(),it.on(di.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),it.on(di.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),it.on(di.STATE_CHANGE,()=>{ir()&&"suspended"===it.prevState&&"running"===it.curState&&this.autoResumeAfterInterruption()})}setSinkID(o,n){var r=this;return x(function*(){const s=r.elementMap.get(o);if(r.sinkIdMap.set(o,n),s)try{yield s.setSinkId(n)}catch(c){throw new Q(M.PERMISSION_DENIED,"can not set sink id: "+c.toString())}})()}play(o,n,r,s){if(this.elementMap.has(n))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([o]),this.bindAudioElementEvents(n,c),this.elementMap.set(n,c),this.elementStateMap.set(n,xi.INIT),this.setVolume(n,r);const d=this.sinkIdMap.get(n);if(d)try{c.setSinkId(d).catch(p=>{w.warning("[".concat(n,"] set sink id failed"),p.toString())})}catch(p){w.warning("[".concat(n,"] set sink id failed"),p.toString())}const h=c.play();h&&h.then&&h.catch(p=>{s&&Ff(s,"audio",p.message,n),w.warning("audio element play warning",p.toString()),this.elementMap.has(n)&&"NotAllowedError"===p.name&&(w.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),ao(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),AD()}))})}updateTrack(o,n){const r=this.elementMap.get(o);r&&(r.srcObject=new MediaStream([n]))}isPlaying(o){return this.elementMap.has(o)&&"playing"===this.elementStateMap.get(o)}setVolume(o,n){const r=this.elementMap.get(o);r&&(n=Math.max(0,Math.min(100,n)),r.volume=n/100)}stop(o){const n=this.elementMap.get(o);if(this.sinkIdMap.delete(o),!n)return;const r=this.elementsNeedToResume.indexOf(n);this.elementsNeedToResume.splice(r,1),n.srcObject=null,n.remove(),this.elementMap.delete(o),this.elementStateMap.delete(o)}bindAudioElementEvents(o,n){vx.forEach(r=>{n.addEventListener(r,s=>{const c=this.elementStateMap.get(o),d="pause"===s.type?"paused":s.type;if(w.debug("[".concat(o,"] audio-element-status change ").concat(c," => ").concat(d)),"error"===s.type){const h=n?.error;h&&w.error("[".concat(o,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(o,d)})})}getPlayerState(o){return this.elementStateMap.get(o)||"uninit"}autoResumeAudioElement(){const o=()=>{this.elementsNeedToResume.forEach(n=>{n.play().then(r=>{w.debug("Auto resume audio element success")}).catch(r=>{w.warning("Auto resume audio element failed!",r)})}),this.elementsNeedToResume=[]};new z(n=>{document.body?n():window.addEventListener("load",()=>n())}).then(()=>{af()?document.body.addEventListener("click",o,!0):(document.body.addEventListener("touchstart",o,!0),document.body.addEventListener("mousedown",o,!0))})}};function un(){return function(o,n,r){const s=r.value;return"function"==typeof s&&(r.value=function(){this._isClosed&&new Q(M.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",w);for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];const p=s.apply(this,d);return p instanceof z?new z((m,_)=>{p.then(m).catch(_)}):p}),r}}function Uf(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function Dh(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?Uf(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):Uf(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}class OD extends Yt{constructor(n){super(),S(this,"name","VideoProcessorDestination"),S(this,"ID","0"),S(this,"_source",void 0),S(this,"videoContext",void 0),S(this,"inputTrack",void 0),this.videoContext=n}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Q(M.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Q(M.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(n){if(n.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");n.track&&n.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=n.track,this.emit(Le.ON_TRACK,n.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Le.ON_TRACK,void 0)}}class bC extends Yt{set chained(n){this._chained=n}get chained(){return this._chained}constructor(n,r){super(),S(this,"constraintsMap",new Map),S(this,"statsRegistry",[]),S(this,"usageRegistry",[]),S(this,"trackId",void 0),S(this,"direction",void 0),S(this,"_chained",!1),this.trackId=n,this.direction=r}getConstraints(){var n=this;return x(function*(){return yield Qt(n,qr.REQUEST_CONSTRAINTS)})()}requestApplyConstraints(n,r){var s=this;return x(function*(){var c;return w.info("processor ".concat(r.name," requestApplyConstraints for ").concat(s.trackId)),n&&s.constraintsMap.set(r,n),Mt(s,qr.REQUEST_UPDATE_CONSTRAINTS,Array.from(wa(c=s.constraintsMap).call(c)))})()}requestRevertConstraints(n){var r=this;return x(function*(){var s;if(r.constraintsMap.has(n))return w.info("processor ".concat(n.name," requestRevertConstraints for ").concat(r.trackId)),r.constraintsMap.delete(n),Mt(r,qr.REQUEST_UPDATE_CONSTRAINTS,Array.from(wa(s=r.constraintsMap).call(s)))})()}registerStats(n,r,s){this.statsRegistry.find(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===r)||this.statsRegistry.push({processorName:n.name,processorID:n.ID,type:r,cb:s})}unregisterStats(n,r){const s=this.statsRegistry.findIndex(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===r);-1!==s&&this.statsRegistry.splice(s,1)}gatherStats(){const n=[];for(const{processorID:r,processorName:s,type:c,cb:d}of this.statsRegistry)try{const h=d();n.push({processorID:r,processorName:s,type:c,stats:h})}catch(h){w.error(new Q(M.UNEXPECTED_ERROR,h.message))}return n}registerUsage(n,r){this.usageRegistry.find(s=>s.processorID===n.ID&&s.processorName===n.name)||this.usageRegistry.push({processorID:n.ID,processorName:n.name,cb:r})}unregisterUsage(n){const r=this.usageRegistry.findIndex(s=>s.processorID===n.ID&&s.processorName===n.name);-1!==r&&this.usageRegistry.splice(r,1)}gatherUsage(){var n=this;return x(function*(){const r=[];if(!n.chained)return[];for(const{cb:s}of n.usageRegistry)try{let c=s();c instanceof z&&(c=yield c),r.push(Dh(Dh({},c),{},{direction:n.direction}))}catch(c){w.error("gather extension usage error",c)}return r})()}getDirection(){return this.direction}}class _E extends Yt{constructor(n){super(),S(this,"name","AudioProcessorDestination"),S(this,"ID","0"),S(this,"inputTrack",void 0),S(this,"inputNode",void 0),S(this,"audioProcessorContext",void 0),S(this,"_source",void 0),this.audioProcessorContext=n}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Q(M.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Q(M.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Le.ON_TRACK,void 0),this.emit(Le.ON_NODE,void 0)}updateInput(n){if(n.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");n.track&&this.inputTrack!==n.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=n.track,this.emit(Le.ON_TRACK,this.inputTrack)),n.node&&this.inputNode!==n.node&&(this.audioProcessorContext.chained=!0,this.inputNode=n.node,this.emit(Le.ON_NODE,this.inputNode))}}class gE extends Yt{set chained(n){this._chained=n}get chained(){return this._chained}constructor(n,r,s){super(),S(this,"constraintsMap",new Map),S(this,"statsRegistry",[]),S(this,"audioContext",void 0),S(this,"trackId",void 0),S(this,"direction",void 0),S(this,"usageRegistry",[]),S(this,"_chained",!1),this.audioContext=n,this.trackId=r,this.direction=s}getConstraints(){var n=this;return x(function*(){return Qt(n,qr.REQUEST_CONSTRAINTS)})()}getAudioContext(){return this.audioContext}requestApplyConstraints(n,r){var s=this;return x(function*(){var c;return w.info("processor ".concat(r.name," requestApplyConstraints for ").concat(s.trackId)),n&&s.constraintsMap.set(r,n),Mt(s,qr.REQUEST_UPDATE_CONSTRAINTS,Array.from(wa(c=s.constraintsMap).call(c)))})()}requestRevertConstraints(n){var r=this;return x(function*(){var s;if(r.constraintsMap.has(n))return r.constraintsMap.delete(n),Mt(r,qr.REQUEST_UPDATE_CONSTRAINTS,Array.from(wa(s=r.constraintsMap).call(s)))})()}registerStats(n,r,s){this.statsRegistry.find(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===r)||this.statsRegistry.push({processorName:n.name,processorID:n.ID,type:r,cb:s})}unregisterStats(n,r){const s=this.statsRegistry.findIndex(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===r);-1!==s&&this.statsRegistry.splice(s,1)}gatherStats(){const n=[];for(const{processorID:r,processorName:s,type:c,cb:d}of this.statsRegistry)try{const h=d();n.push({processorID:r,processorName:s,type:c,stats:h})}catch(h){w.error(new Q(M.UNEXPECTED_ERROR,h.message))}return n}registerUsage(n,r){this.usageRegistry.find(s=>s.processorID===n.ID&&s.processorName===n.name)||this.usageRegistry.push({processorID:n.ID,processorName:n.name,cb:r})}unregisterUsage(n){const r=this.usageRegistry.findIndex(s=>s.processorID===n.ID&&s.processorName===n.name);-1!==r&&this.usageRegistry.splice(r,1)}gatherUsage(){var n=this;return x(function*(){const r=[];if(!n.chained)return[];for(const{cb:s}of n.usageRegistry)try{let c=s();c instanceof z&&(c=yield c),r.push(Dh(Dh({},c),{},{direction:n.direction}))}catch(c){w.error("gather extension usage error",c)}return r})()}getDirection(){return this.direction}}class SC extends Yt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),S(this,"context",void 0),S(this,"processSourceNode",void 0),S(this,"outputTrack",void 0),S(this,"processedNode",void 0),S(this,"clonedTrack",void 0),S(this,"outputNode",void 0),this.outputNode=new yx}setVolume(){}createOutputTrack(){throw new Q(M.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class yx{disconnect(){}connect(){}}let Dd=null;class bx{constructor(){S(this,"state","open"),S(this,"trigger",void 0),S(this,"tasks",[]),w.debug("[macro-task-queue] is created."),this.trigger=window.setTimeout(()=>{this.state="closed",w.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map(n=>n.key),"]")),this.trigger=void 0,this.tasks.forEach(n=>{let{func:r}=n;return r()}),this.tasks.length=0,w.debug("[macro-task-queue] is closed.")})}enqueue(n,r){"closed"!==this.state&&(this.tasks.push({key:n,func:r}),w.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof n?n:"")))}runTask(n){if("closed"===this.state)return;const r=this.tasks.findIndex(s=>s.key===n);if(-1!==r){const s=this.tasks.splice(r,1);w.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof n?n:"")),s[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,w.debug("[macro-task-queue] is closed."))}}function EE(o){return function(n,r,s){var c;const d=null!==(c=s.value)&&void 0!==c?c:s.get,h=function(){Dd&&"open"===Dd.state&&Dd.runTask(o);for(var p=arguments.length,m=new Array(p),_=0;_<p;_++)m[_]=arguments[_];return d?.apply(this,...m)};return s.value?s.value=h:s.get=h,s}}function Vf(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function Od(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?Vf(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):Vf(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}class mt extends Li{get _source(){return this._trackSource}set _source(n){this._trackSource=n}get processorContext(){return this._processorContext}set processorContext(n){this._processorContext=n}get processorDestination(){return this._processorDestination}set processorDestination(n){this._processorDestination=n}get isPlaying(){return this._useAudioElement?Rr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(n,r,s,c,d){super(n,s),S(this,"trackMediaType","audio"),S(this,"_encoderConfig",void 0),S(this,"_trackSource",void 0),S(this,"_enabled",!0),S(this,"_volume",100),S(this,"_useAudioElement",!1),S(this,"_bypassWebAudio",!1),S(this,"processor",void 0),S(this,"_processorContext",void 0),S(this,"_processorDestination",void 0),S(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!c;const h=()=>{this.processorContext=new gE(this._source.context,this.getTrackId(),"local"),this.processorDestination=new _E(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(wr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})},p=d&&qi()&&!_x();B("DISABLE_WEBAUDIO")?(this._source=new SC,this._useAudioElement=!0,this._bypassWebAudio=!0):p?this._source=new SC:(this._source=new po(n,!1,this._getOriginVolumeLevel?n:void 0),B("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),h(),!B("DISABLE_WEBAUDIO")&&p&&(Dd||(Dd=new bx),Dd).enqueue("INIT_WEBAUDIO",()=>{this._source=new po(n,!1,this._getOriginVolumeLevel?n:void 0),B("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),h(),this.emit(Pf.UPDATE_TRACK_SOURCE)})}setVolume(n){wt(n,"volume",0,1e3),this._volume=n,this._source.setVolume(n/100),this._useAudioElement&&Rr.setVolume(this.getTrackId(),n);try{if(this._bypassWebAudio)return void w.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,Mt(this,fe.NEED_REPLACE_TRACK,this).then(()=>{w.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{w.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}setPlaybackDevice(n){var r=this;return x(function*(){if(!r._useAudioElement)throw new Q(M.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield Rr.setSinkID(r.getTrackId(),n)})()}setEnabled(n,r,s){var c=this;return x(function*(){return c._setEnabled(n,r,s)})()}_setEnabled(n,r,s){var c=this;return x(function*(){if(!s){if(n===c._enabled)return;c.stateCheck("enabled",n)}if(w.info("[".concat(c.getTrackId(),"] start setEnabled"),n),n){c._originMediaStreamTrack.enabled=!0;try{s||(c._enabled=!0),yield Mt(c,fe.NEED_ENABLE_TRACK,c),w.info("[".concat(c.getTrackId(),"] setEnabled to ").concat(n," success"))}catch(d){throw s||(c._enabled=!1),w.error("[".concat(c.getTrackId(),"] setEnabled to true error"),d.toString()),d}}else{c._originMediaStreamTrack.enabled=!1,s||(c._enabled=!1);try{yield Mt(c,fe.NEED_DISABLE_TRACK,c)}catch(d){throw s||(c._enabled=!0),w.error("[".concat(c.getTrackId(),"] setEnabled to false error"),d.toString()),d}}})()}setMuted(n){var r=this;return x(function*(){n!==r._muted&&(r.stateCheck("muted",n),r._muted=n,r._originMediaStreamTrack.enabled=!n,w.debug("[".concat(r.getTrackId(),"] start set muted: ").concat(n)),n?yield Mt(r,fe.NEED_MUTE_TRACK,r):yield Mt(r,fe.NEED_UNMUTE_TRACK,r))})()}getStats(){return pf(()=>{w.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),hr(this,fe.GET_STATS)||Od({},Ir)}setAudioFrameCallback(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!n)return this._source.removeAllListeners(wr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(wr.ON_AUDIO_BUFFER),this._source.on(wr.ON_AUDIO_BUFFER,s=>n(s))}play(){w.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(w.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Rr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){w.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Rr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];w.debug("[".concat(this.getTrackId(),"] update player source track")),n&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Rr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}_updateOriginMediaStreamTrack(n,r){var s=this;return x(function*(){s._originMediaStreamTrack!==n&&(s._originMediaStreamTrack&&(s._originMediaStreamTrack.removeEventListener("ended",s._handleTrackEnded),r&&s._originMediaStreamTrack.stop()),n.addEventListener("ended",s._handleTrackEnded),s._originMediaStreamTrack=n,s._muted&&(s._originMediaStreamTrack.enabled=!1),s.processor&&s.processor.updateInput({track:n,context:s.processorContext}),s._mediaStreamTrack!==s._source.outputTrack?(s._mediaStreamTrack=s._originMediaStreamTrack,s._updatePlayerSource(),yield Mt(s,fe.NEED_REPLACE_TRACK,s)):s._source.updateTrack(s._originMediaStreamTrack),s._getOriginVolumeLevel&&s._source.updateOriginTrack(n))})()}renewMediaStreamTrack(n){return z.resolve(void 0)}pipe(n){if(this._bypassWebAudio)throw new Q(M.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===n)return n;if(n._source)throw new Q(M.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),n}unpipe(){var n;if(!this.processor)return;const r=this.processor;null===(n=this._source.processSourceNode)||void 0===n||n.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){var n=this;this.processorDestination.on(Le.ON_TRACK,function(){var r=x(function*(s){s?s!==n._mediaStreamTrack&&(n._mediaStreamTrack=s,n._updatePlayerSource(!1),n._source.processedNode=n._source.createMediaStreamSourceNode(s),yield Mt(n,fe.NEED_REPLACE_TRACK,n)):n._mediaStreamTrack!==n._originMediaStreamTrack&&(n._mediaStreamTrack=n._originMediaStreamTrack,n._updatePlayerSource(),yield Mt(n,fe.NEED_REPLACE_TRACK,n))});return function(s){return r.apply(this,arguments)}}()),this.processorDestination.on(Le.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Le.ON_TRACK),this.processorDestination.removeAllListeners(Le.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(qr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(qr.REQUEST_CONSTRAINTS)}}ee([EE("INIT_WEBAUDIO"),O("design:type",Object),O("design:paramtypes",[Object])],mt.prototype,"_source",null),ee([EE("INIT_WEBAUDIO"),O("design:type",gE),O("design:paramtypes",[gE])],mt.prototype,"processorContext",null),ee([EE("INIT_WEBAUDIO"),O("design:type",_E),O("design:paramtypes",[_E])],mt.prototype,"processorDestination",null),ee([Ie({argsMap:(o,n)=>[o.getTrackId(),n],throttleTime:300}),O("design:type",Function),O("design:paramtypes",[Number]),O("design:returntype",void 0)],mt.prototype,"setVolume",null),ee([Ie({argsMap:(o,n)=>[o.getTrackId(),n]}),un(),O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",z)],mt.prototype,"setPlaybackDevice",null),ee([md("LocalAudioTrack","_enabledMutex"),Ie({argsMap:(o,n)=>[o.getTrackId(),n]}),un(),O("design:type",Function),O("design:paramtypes",[Boolean,Object,Boolean]),O("design:returntype",z)],mt.prototype,"setEnabled",null),ee([md("LocalAudioTrack","_enabledMutex"),Ie({argsMap:(o,n)=>[o.getTrackId(),n]}),un(),O("design:type",Function),O("design:paramtypes",[Boolean]),O("design:returntype",z)],mt.prototype,"setMuted",null),ee([un(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",Object)],mt.prototype,"getStats",null),ee([un(),O("design:type",Function),O("design:paramtypes",[Object,Number]),O("design:returntype",void 0)],mt.prototype,"setAudioFrameCallback",null),ee([Ie({argsMap:o=>[o.getTrackId()]}),un(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],mt.prototype,"play",null),ee([Ie({argsMap:o=>[o.getTrackId()]}),un(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],mt.prototype,"stop",null),ee([Ie({argsMap:o=>[o.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],mt.prototype,"close",null),ee([Ie({argsMap:(o,n)=>[o.getTrackId(),n.name]}),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",Object)],mt.prototype,"pipe",null),ee([Ie({argsMap:o=>[o.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],mt.prototype,"unpipe",null);class Zc extends mt{get __className__(){return"MicrophoneAudioTrack"}constructor(n,r,s,c){super(n,r.encoderConfig?bh(r.encoderConfig):{},c,B("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),S(this,"_config",void 0),S(this,"_deviceName","default"),S(this,"_constraints",void 0),S(this,"_originalConstraints",void 0),S(this,"_enabled",!0),this._config=r,this._constraints=s,this._originalConstraints=s,this._deviceName=n.label,"boolean"==typeof r.bypassWebAudio&&(this._bypassWebAudio=r.bypassWebAudio),(th()||nh())&&it.bindInterruptDetectorTrack(this),this.on(Pf.UPDATE_TRACK_SOURCE,()=>{this.bindProcessorContextEvents()}),_x()&&this.bindProcessorContextEvents()}setDevice(n){var r=this;return x(function*(){if(w.info("[".concat(r.getTrackId(),"] start set device to ").concat(n)),r._enabled)try{const s=yield sn.getDeviceById(n),c={};c.audio=Od({},r._constraints),c.audio.deviceId={exact:n},r._originMediaStreamTrack.stop();let d=null;try{d=yield fo(c,r.getTrackId())}catch(h){throw w.error("[".concat(r.getTrackId(),"] setDevice failed"),h.toString()),d=yield fo({audio:r._constraints},r.getTrackId()),yield r._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),h}yield r._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),r._deviceName=s.label,r._config.microphoneId=n,r._constraints.deviceId={exact:n}}catch(s){throw w.error("[".concat(r.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=yield sn.getDeviceById(n);r._deviceName=s.label,r._config.microphoneId=n,r._constraints.deviceId={exact:n}}catch(s){throw w.error("[".concat(r.getTrackId(),"] setDevice error"),s.toString()),s}w.info("[".concat(r.getTrackId(),"] set device to ").concat(n," success"))})()}setEnabled(n,r,s){var c=()=>super._setEnabled,d=this;return x(function*(){if(r)return w.debug("[".concat(d.getTrackId(),"] setEnabled false (do not close microphone)")),yield c().call(d,n);if(!s){if(n===d._enabled)return;d.stateCheck("enabled",n)}if(w.info("[".concat(d.getTrackId(),"] start setEnabled"),n),!n){var h;d._originMediaStreamTrack.onended=null,d._originMediaStreamTrack.stop(),null===(h=d._source.clonedTrack)||void 0===h||h.stop(),s||(d._enabled=!1);try{yield Mt(d,fe.NEED_DISABLE_TRACK,d)}catch(_){throw w.error("[".concat(d.getTrackId(),"] setEnabled false failed"),_.toString()),_}return}const p=Od({},d._constraints),m=sn.searchDeviceIdByName(d._deviceName);m&&!p.deviceId&&(p.deviceId=m);try{s||(d._enabled=!0);const _=yield fo({audio:d._constraints},d.getTrackId());yield d._updateOriginMediaStreamTrack(_.getAudioTracks()[0],!1),yield Mt(d,fe.NEED_ENABLE_TRACK,d)}catch(_){throw s||(d._enabled=!1),w.error("[".concat(d.getTrackId(),"] setEnabled true failed"),_.toString()),_}w.info("[".concat(d.getTrackId(),"] setEnabled success"))})()}close(){super.close(),(th()||nh())&&it.unbindInterruptDetectorTrack(this)}onTrackEnded(){var n=this;if((ir()||Gs())&&this._enabled&&!this._isClosed&&it.duringInterruption){const r=function(){var s=x(function*(){it.off(di.IOS_INTERRUPTION_END,r),n._enabled&&!n._isClosed&&(w.debug("[".concat(n.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),yield n.setEnabled(!1),yield n.setEnabled(!0))});return function(){return s.apply(this,arguments)}}();it.on(di.IOS_INTERRUPTION_END,r)}else w.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Jc.TRACK_ENDED)}renewMediaStreamTrack(n){var r=this;return x(function*(){const s=n||r._constraints,c=sn.searchDeviceIdByName(r._deviceName);if(c&&!s.deviceId&&(s.deviceId=c),r._constraints=s,r._enabled){r._originMediaStreamTrack.stop();const d=yield fo({audio:r._constraints},r.getTrackId());yield r._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!0)}})()}bindProcessorContextEvents(){var n=this;this.processorContext.on(qr.REQUEST_UPDATE_CONSTRAINTS,function(){var r=x(function*(s,c,d){try{const h=Object.assign({},n._originalConstraints,...s);yield n.renewMediaStreamTrack(h),c()}catch(h){d(h)}});return function(s,c,d){return r.apply(this,arguments)}}()),this.processorContext.on(qr.REQUEST_CONSTRAINTS,function(){var r=x(function*(s){s(n._originMediaStreamTrack.getSettings())});return function(s){return r.apply(this,arguments)}}())}}ee([Ie({argsMap:(o,n)=>[o.getTrackId(),n]}),un(),O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",z)],Zc.prototype,"setDevice",null),ee([md("MicrophoneAudioTrack","_enabledMutex"),Ie({argsMap:(o,n,r)=>[o.getTrackId(),n,r]}),un(),O("design:type",Function),O("design:paramtypes",[Boolean,Boolean,Boolean]),O("design:returntype",z)],Zc.prototype,"setEnabled",null),ee([Ie({argsMap:o=>[o.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],Zc.prototype,"close",null);class Ra extends mt{get __className__(){return"BufferSourceAudioTrack"}constructor(n,r,s,c){super(r.createOutputTrack(),s,c),S(this,"source",void 0),S(this,"_bufferSource",void 0),this.source=n,this._bufferSource=r,this._bufferSource.on(wr.AUDIO_SOURCE_STATE_CHANGE,d=>{this.safeEmit(Jc.SOURCE_STATE_CHANGE,d)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(n){n&&this._bufferSource.updateOptions(n),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(n){this._bufferSource.seekAudioBuffer(n)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(n){wt(n,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(n)}}ee([Ie({argsMap:(o,n)=>[o.getTrackId(),n,o.duration]}),un(),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",void 0)],Ra.prototype,"startProcessAudioBuffer",null),ee([Ie({argsMap:o=>[o.getTrackId()]}),un(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],Ra.prototype,"pauseProcessAudioBuffer",null),ee([Ie({argsMap:o=>[o.getTrackId()]}),un(),O("design:type",Function),O("design:paramtypes",[Number]),O("design:returntype",void 0)],Ra.prototype,"seekAudioBuffer",null),ee([Ie({argsMap:o=>[o.getTrackId()]}),un(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],Ra.prototype,"resumeProcessAudioBuffer",null),ee([Ie({argsMap:o=>[o.getTrackId()]}),un(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],Ra.prototype,"stopProcessAudioBuffer",null),ee([Ie({argsMap:o=>[o.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],Ra.prototype,"close",null),ee([Ie({argsMap:o=>[o.getTrackId()]}),un(),O("design:type",Function),O("design:paramtypes",[Number]),O("design:returntype",void 0)],Ra.prototype,"setAudioBufferPlaybackSpeed",null);class Dn extends mt{get __className__(){return"MixingAudioTrack"}get isActive(){for(const n of this.trackList)if(n._enabled&&!n._isClosed&&!n.muted)return!0;return!1}constructor(){const n=xf().createMediaStreamDestination();super(n.stream.getAudioTracks()[0],void 0,It(8,"track-mix-")),S(this,"trackList",void 0),S(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=n,this.trackList=[]}hasAudioTrack(n){return-1!==this.trackList.indexOf(n)}addAudioTrack(n){-1===this.trackList.indexOf(n)?(w.debug("add ".concat(n.getTrackId()," to mixing track")),n._source.outputNode.connect(this.destNode),this.trackList.push(n),this.updateEncoderConfig()):w.debug("track ".concat(n.getTrackId()," is already added"))}removeAudioTrack(n){if(-1!==this.trackList.indexOf(n)){w.debug("remove ".concat(n.getTrackId()," from mixing track"));try{n._source.outputNode.disconnect(this.destNode)}catch{}IS(this.trackList,n),this.updateEncoderConfig()}}updateEncoderConfig(){const n={};this.trackList.forEach(r=>{r._encoderConfig&&((r._encoderConfig.bitrate||0)>(n.bitrate||0)&&(n.bitrate=r._encoderConfig.bitrate),(r._encoderConfig.sampleRate||0)>(n.sampleRate||0)&&(n.sampleRate=r._encoderConfig.sampleRate),(r._encoderConfig.sampleSize||0)>(n.sampleSize||0)&&(n.sampleSize=r._encoderConfig.sampleSize),r._encoderConfig.stereo&&(n.stereo=!0))}),this._encoderConfig=n}_updateRtpTransceiver(n){this._rtpTransceiver!==n&&(this._rtpTransceiver=n,this.trackList.forEach(r=>{r instanceof Dn?r.emit(Ch.TRANSCEIVER_UPDATED,n):r._updateRtpTransceiver(n)}))}}function vE(o){const n={};o.facingMode&&(n.facingMode=o.facingMode),o.cameraId&&(n.deviceId={exact:o.cameraId});const r=sc(o.encoderConfig);return null!=r.width&&(n.width=r.width),null!=r.height&&(n.height=r.height),!_A()&&r.frameRate&&(n.frameRate=r.frameRate),Ve().name===_t.EDGE&&"object"==typeof n.frameRate&&(n.frameRate.max=60),jt()&&(n.frameRate={ideal:30,max:30}),n}function yE(o){const n={};if(_A()||(void 0!==o.AGC&&(n.autoGainControl=o.AGC),void 0!==o.AEC&&(n.echoCancellation=o.AEC),void 0!==o.ANS&&(n.noiseSuppression=o.ANS,Lg()&&o.ANS&&(n.googHighpassFilter=o.ANS))),o.encoderConfig){const r=bh(o.encoderConfig);n.channelCount=r.stereo?2:1,n.sampleRate=r.sampleRate,n.sampleSize=r.sampleSize}return o.microphoneId&&(n.deviceId={exact:o.microphoneId}),Bc()&&(n.sampleRate=void 0),n}class Sx extends gx{set currentState(n){n!==this._currentState&&(this._currentState=n,this.safeEmit(wr.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),S(this,"audioBuffer",void 0),S(this,"sourceNode",void 0),S(this,"startPlayTime",0),S(this,"startPlayOffset",0),S(this,"pausePlayTime",0),S(this,"options",void 0),S(this,"currentLoopCount",0),S(this,"currentPlaybackSpeed",100),S(this,"_currentState","stopped"),this.audioBuffer=n,this.options=r,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:(this.playbackSpeed/100*(this.context.currentTime-this.startPlayTime)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(n){"stopped"===this.currentState?(this.options=n,this.startPlayOffset=this.options.startPlayTime||0):w.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(n){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=n,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=n))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(n){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=n/100),this.currentPlaybackSpeed=n}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const n=this.context.createBufferSource();return n.buffer=this.audioBuffer,n.loop=!!this.options.loop,n.connect(this.outputNode),n.playbackRate.value=this.currentPlaybackSpeed/100,n}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const ND=new Map;function Bf(){return Bf=x(function*(o,n){let r=null;if("string"==typeof o){const c=ND.get(o);if(c)return w.debug("use cached audio resource: ",o),c;try{r=(yield Ws(()=>Tr.get(o,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(d){throw new Q(M.FETCH_AUDIO_FILE_FAILED,d.toString())}}else r=yield new z((d,h)=>{const p=new FileReader;p.onload=m=>{m.target?d(m.target.result):h(new Q(M.READ_LOCAL_AUDIO_FILE_ERROR))},p.onerror=()=>{h(new Q(M.READ_LOCAL_AUDIO_FILE_ERROR))},p.readAsArrayBuffer(o)});const s=yield function(c){const d=xf();return new z((h,p)=>{d.decodeAudioData(c,m=>{h(m)},m=>{p(new Q(M.DECODE_AUDIO_FILE_FAILED,m.toString()))})})}(r);return"string"==typeof o&&n&&ND.set(o,s),s}),Bf.apply(this,arguments)}const CC=o=>{const n=document.createElement("canvas");return n.width=2,n.height=2,new z((r,s)=>{n.toBlob(function(){var c=x(function*(d){if(n.remove(),d){const h=yield PD(d);r({buffer:h,width:n.width,height:n.height})}else s(new Q(M.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(d){return c.apply(this,arguments)}}(),o,1)})},PD=function(){var o=x(function*(n){const r=yield n.arrayBuffer();return new Uint8Array(r)});return function(r){return o.apply(this,arguments)}}(),dc=new class extends Yt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),S(this,"_lastHiddenTime",0),S(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),w.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};function bE(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function SE(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?bE(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):bE(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}class CE{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(n){n!==this._videoElementStatus&&(w.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(n)),this._videoElementStatus=n)}constructor(n){S(this,"trackId",void 0),S(this,"config",void 0),S(this,"onFirstVideoFrameDecoded",void 0),S(this,"freezeTimeCounterList",[]),S(this,"renderFreezeAccTime",0),S(this,"isKeepLastFrame",!1),S(this,"timeUpdatedCount",0),S(this,"freezeTime",0),S(this,"playbackTime",0),S(this,"lastTimeUpdatedTime",0),S(this,"autoplayFailed",!1),S(this,"videoTrack",void 0),S(this,"videoElement",void 0),S(this,"cacheVideoElement",void 0),S(this,"videoElementCheckInterval",void 0),S(this,"_videoElementStatus",xi.NONE),S(this,"isGettingVideoDimensions",!1),S(this,"startGetVideoDimensions",()=>{const r=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return w.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(r,500)};!this.isGettingVideoDimensions&&r()}),S(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===it.curState&&(w.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(_S())),ES()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),S(this,"handleVideoEvents",r=>{switch(r.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=xi.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=xi.CANPLAY;break;case"stalled":this.videoElementStatus=xi.STALLED;break;case"suspend":this.videoElementStatus=xi.SUSPEND;break;case"pause":this.videoElementStatus=xi.PAUSED,ir()||Gs()||qi()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(w.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=xi.WAITING;break;case"abort":this.videoElementStatus=xi.ABORT;break;case"ended":this.videoElementStatus=xi.ENDED;break;case"emptied":this.videoElementStatus=xi.EMPTIED;break;case"error":{this.videoElementStatus=xi.ERROR;const s=this.videoElement.error;s&&w.error("[".concat(this.trackId,"] media error, code: ").concat(s.code,", message: ").concat(s.message));break}case"timeupdate":{const s=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=s);const c=s-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=s,dc.lastVisibleTime<dc.lastHiddenTime||d<dc.lastHiddenTime||d<dc.lastVisibleTime)return;for(c>B("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),S(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(w.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(_S())),ES()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=n.trackId,this.config=n,this.videoElement=n.element instanceof HTMLVideoElement?n.element:document.createElement("video"),it.on(di.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),it.on(di.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var n;return null!==(n=this.videoElement.parentElement)&&void 0!==n?n:void 0}updateConfig(n){this.config=n,this.trackId=n.trackId,n.element!==this.videoElement&&(this.destroy(),this.videoElement=n.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(n){this.videoTrack!==n&&(this.videoTrack=n,this.initVideoElement())}play(n){const r=this.videoElement.play();r&&r.catch&&r.catch(c=>{n&&Ff(n,"video",c.message,this.trackId),"NotAllowedError"===c.name?(w.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):w.warning("[".concat(this.trackId,"] play warning: "),c)});const s=Ve();if(("Safari"===s.name&&15===Number(s.version)||th())&&r&&r.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};r.then(c).catch(c)}}getCurrentFrame(){const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const r=n.getContext("2d");if(!r)return w.error("create canvas context failed!"),new ImageData(2,2);r.drawImage(this.videoElement,0,0,n.width,n.height);const s=r.getImageData(0,0,n.width,n.height);return n.remove(),s}getCurrentFrameToUint8Array(n){var r=arguments,s=this;return x(function*(){let c=r.length>1&&void 0!==r[1]?r[1]:1;const d=document.createElement("canvas");d.width=s.videoElement.videoWidth,d.height=s.videoElement.videoHeight;const h=d.getContext("2d");return h?(h.drawImage(s.videoElement,0,0,d.width,d.height),new z((p,m)=>{d.toBlob(function(){var _=x(function*(g){if(d.remove(),g){const v=yield PD(g);p({buffer:v,width:d.width,height:d.height})}else m(new Q(M.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(g){return _.apply(this,arguments)}}(),n,c<0?.1:c>1?1:c)})):yield CC(n)})()}destroy(){it.off(di.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),it.off(di.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=xi.INIT,!this.videoElementCheckInterval&&(MD.forEach(d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{var d;(d=this.videoElement)!==document.body&&document.body.contains(d)||(this.videoElementStatus=xi.DESTROYED)},1e3),B("ENABLE_VIDEO_FRAME_CALLBACK"))){var n,r;let d;const h=(p,m)=>{if(this.videoElementStatus===xi.PLAYING){if(d){const v=m.presentationTime-d.presentationTime;v>B("VIDEO_FREEZE_DURATION")&&dc.lastVisibleTime>=dc.lastHiddenTime&&d.timestamp>dc.lastVisibleTime&&d.timestamp>dc.lastHiddenTime&&(this.renderFreezeAccTime+=v)}d=SE(SE({},m),{},{timestamp:p})}var _,g;B("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(_=(g=this.videoElement).requestVideoFrameCallback)||void 0===_||_.call(g,h))};null===(n=(r=this.videoElement).requestVideoFrameCallback)||void 0===n||n.call(r,h)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Bc()&&(this.videoElement.poster="noposter");const s=Ve();"Safari"===s.name&&15===Number(s.version)||th()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.videoElement.style.objectFit=this.config.fit?this.config.fit:"cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,jt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,jt()&&this.videoElement.load());const c=this.videoElement.play();void 0!==c&&c.catch(d=>{w.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())})}resetVideoElement(){MD.forEach(n=>{this.videoElement&&this.videoElement.removeEventListener(n,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=xi.NONE}handleAutoPlayFailed(){const n=r=>{r.preventDefault(),this.videoElement.play().then(()=>{w.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(s=>{w.error(s)}),this.autoplayFailed=!1,af()?document.body.removeEventListener("click",n,!0):(document.body.removeEventListener("touchstart",n,!0),document.body.removeEventListener("mousedown",n,!0))};af()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0)),AD()}}const MD=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Tx extends CE{constructor(n){super(n),S(this,"container",void 0),S(this,"slot",void 0),this.slot=n.element,this.updateConfig(n)}updateConfig(n){this.config=n,this.trackId=n.trackId;const r=n.element;r!==this.slot&&(this.destroy(),this.slot=r),this.createElements()}updateVideoTrack(n){this.videoTrack!==n&&(this.videoTrack=n,this.createElements())}play(n){var r;null!==(r=this.container)&&void 0!==r&&r.contains(this.videoElement)&&super.play(n)}getCurrentFrame(){var n;return null!==(n=this.container)&&void 0!==n&&n.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}getCurrentFrameToUint8Array(n){var r=arguments,s=()=>super.getCurrentFrameToUint8Array,c=this;return x(function*(){var d;let h=r.length>1&&void 0!==r[1]?r[1]:1;return null!==(d=c.container)&&void 0!==d&&d.contains(c.videoElement)?yield s().call(c,n,h):yield CC(n)})()}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",B("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var n;!this.container||null!==(n=this.container)&&void 0!==n&&n.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var n;if(null!==(n=this.container)&&void 0!==n&&n.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var n;null!==(n=this.container)&&void 0!==n&&n.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function kD(o){return new z((n,r)=>{let s=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const d=ir()?"canplay":"playing";c.addEventListener(d,()=>{const h=c.videoWidth,p=c.videoHeight;!h&&jt()||(s=!0,c.srcObject=null,c.remove(),n([h,p]))}),c.srcObject=new MediaStream([o]),c.play().catch(Bg),setTimeout(()=>{s||(c.srcObject=null,c.remove(),n([c.videoWidth,c.videoHeight]))},4e3)})}const TC=function(){var o=x(function*(n,r,s){const c=function(p){const m=[];for(let _=0;_<p.length;_+=2)m.push(parseInt(p.slice(_,_+2),16));return Uint8Array.from(m)}(function(p){const m="0123456789abcdef";function _(ve){let ye,Ye="";for(ye=0;ye<=3;ye++)Ye+=m.charAt(ve>>8*ye+4&15)+m.charAt(ve>>8*ye&15);return Ye}function g(ve,ye){const Ye=(65535&ve)+(65535&ye);return(ve>>16)+(ye>>16)+(Ye>>16)<<16|65535&Ye}function v(ve,ye,Ye,ut,yt,lt){return g((bt=g(g(ye,ve),g(ut,lt)))<<(ne=yt)|bt>>>32-ne,Ye);var bt,ne}function b(ve,ye,Ye,ut,yt,lt,bt){return v(ye&Ye|~ye&ut,ve,ye,yt,lt,bt)}function C(ve,ye,Ye,ut,yt,lt,bt){return v(ye&ut|Ye&~ut,ve,ye,yt,lt,bt)}function N(ve,ye,Ye,ut,yt,lt,bt){return v(ye^Ye^ut,ve,ye,yt,lt,bt)}function P(ve,ye,Ye,ut,yt,lt,bt){return v(Ye^(ye|~ut),ve,ye,yt,lt,bt)}const D=function(ve){let ye;const Ye=1+(ve.length+8>>6),ut=new Array(16*Ye);for(ye=0;ye<16*Ye;ye++)ut[ye]=0;for(ye=0;ye<ve.length;ye++)ut[ye>>2]|=ve.charCodeAt(ye)<<ye%4*8;return ut[ye>>2]|=128<<ye%4*8,ut[16*Ye-2]=8*ve.length,ut}(p);let k,V,U,Y,oe,K=1732584193,X=-271733879,$=-1732584194,J=271733878;for(k=0;k<D.length;k+=16)V=K,U=X,Y=$,oe=J,K=b(K,X,$,J,D[k+0],7,-680876936),J=b(J,K,X,$,D[k+1],12,-389564586),$=b($,J,K,X,D[k+2],17,606105819),X=b(X,$,J,K,D[k+3],22,-1044525330),K=b(K,X,$,J,D[k+4],7,-176418897),J=b(J,K,X,$,D[k+5],12,1200080426),$=b($,J,K,X,D[k+6],17,-1473231341),X=b(X,$,J,K,D[k+7],22,-45705983),K=b(K,X,$,J,D[k+8],7,1770035416),J=b(J,K,X,$,D[k+9],12,-1958414417),$=b($,J,K,X,D[k+10],17,-42063),X=b(X,$,J,K,D[k+11],22,-1990404162),K=b(K,X,$,J,D[k+12],7,1804603682),J=b(J,K,X,$,D[k+13],12,-40341101),$=b($,J,K,X,D[k+14],17,-1502002290),X=b(X,$,J,K,D[k+15],22,1236535329),K=C(K,X,$,J,D[k+1],5,-165796510),J=C(J,K,X,$,D[k+6],9,-1069501632),$=C($,J,K,X,D[k+11],14,643717713),X=C(X,$,J,K,D[k+0],20,-373897302),K=C(K,X,$,J,D[k+5],5,-701558691),J=C(J,K,X,$,D[k+10],9,38016083),$=C($,J,K,X,D[k+15],14,-660478335),X=C(X,$,J,K,D[k+4],20,-405537848),K=C(K,X,$,J,D[k+9],5,568446438),J=C(J,K,X,$,D[k+14],9,-1019803690),$=C($,J,K,X,D[k+3],14,-187363961),X=C(X,$,J,K,D[k+8],20,1163531501),K=C(K,X,$,J,D[k+13],5,-1444681467),J=C(J,K,X,$,D[k+2],9,-51403784),$=C($,J,K,X,D[k+7],14,1735328473),X=C(X,$,J,K,D[k+12],20,-1926607734),K=N(K,X,$,J,D[k+5],4,-378558),J=N(J,K,X,$,D[k+8],11,-2022574463),$=N($,J,K,X,D[k+11],16,1839030562),X=N(X,$,J,K,D[k+14],23,-35309556),K=N(K,X,$,J,D[k+1],4,-1530992060),J=N(J,K,X,$,D[k+4],11,1272893353),$=N($,J,K,X,D[k+7],16,-155497632),X=N(X,$,J,K,D[k+10],23,-1094730640),K=N(K,X,$,J,D[k+13],4,681279174),J=N(J,K,X,$,D[k+0],11,-358537222),$=N($,J,K,X,D[k+3],16,-722521979),X=N(X,$,J,K,D[k+6],23,76029189),K=N(K,X,$,J,D[k+9],4,-640364487),J=N(J,K,X,$,D[k+12],11,-421815835),$=N($,J,K,X,D[k+15],16,530742520),X=N(X,$,J,K,D[k+2],23,-995338651),K=P(K,X,$,J,D[k+0],6,-198630844),J=P(J,K,X,$,D[k+7],10,1126891415),$=P($,J,K,X,D[k+14],15,-1416354905),X=P(X,$,J,K,D[k+5],21,-57434055),K=P(K,X,$,J,D[k+12],6,1700485571),J=P(J,K,X,$,D[k+3],10,-1894986606),$=P($,J,K,X,D[k+10],15,-1051523),X=P(X,$,J,K,D[k+1],21,-2054922799),K=P(K,X,$,J,D[k+8],6,1873313359),J=P(J,K,X,$,D[k+15],10,-30611744),$=P($,J,K,X,D[k+6],15,-1560198380),X=P(X,$,J,K,D[k+13],21,1309151649),K=P(K,X,$,J,D[k+4],6,-145523070),J=P(J,K,X,$,D[k+11],10,-1120210379),$=P($,J,K,X,D[k+2],15,718787259),X=P(X,$,J,K,D[k+9],21,-343485551),K=g(K,V),X=g(X,U),$=g($,Y),J=g(J,oe);return _(K)+_(X)+_($)+_(J)}(""+r+s)).slice(0,16),d=c.slice(0,12),h=yield window.crypto.subtle.importKey("raw",c,"AES-GCM",!0,["encrypt"]);return new Uint8Array(yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:d},h,n))});return function(r,s,c){return o.apply(this,arguments)}}(),wC=function(){var o=x(function*(n,r,s){return yield TC(n.buffer,r,s)});return function(r,s,c){return o.apply(this,arguments)}}();function TE(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function _o(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?TE(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):TE(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}class We extends Li{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==xi.PLAYING)}get processorContext(){return this._processorContext}set processorContext(n){this._processorContext=n}get __className__(){return"LocalVideoTrack"}constructor(n,r,s,c,d,h){if(super(n,d),S(this,"trackMediaType","video"),S(this,"_player",void 0),S(this,"_videoVisibleTimer",null),S(this,"_previousVideoVisibleStatus",void 0),S(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),S(this,"_encoderConfig",void 0),S(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),S(this,"_optimizationMode",void 0),S(this,"_videoHeight",void 0),S(this,"_videoWidth",void 0),S(this,"_forceBitrateLimit",void 0),S(this,"_enabled",!0),S(this,"processorDestination",void 0),S(this,"_processorContext",void 0),qi()){const{width:p,height:m}=n.getSettings();this._videoWidth=p,this._videoHeight=m}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=r,this._scalabilityMode=s,this._optimizationMode=c,this._hints=h||[],-1===this._hints.indexOf(Vt.SCREEN_TRACK))this.updateBitrateFromProfile();else if(function(p,m,_){const g=Ve();return!(g.name!==p||!g.osVersion)&&115===Number(g.version)}(_t.CHROME)&&-1!==mS().indexOf("Windows")){const p=function(m,_){if("VideoFrame"in window&&"TransformStream"in window&&Lt().supportWebRTCInsertableStream){const g=new MediaStreamTrackProcessor(m),v=new MediaStreamTrackGenerator({kind:"video"});let b,C,N=Date.now();const P=()=>{D&&(clearInterval(D),D=void 0),b&&(b.close(),b=void 0),m.stop(),C=void 0,v.removeEventListener("ended",P)};let D=window.setInterval(()=>{if(C&&b&&Date.now()-N>1e3)try{"live"===v.readyState?C.enqueue(b.clone()):P()}catch{P()}},1e3);const k=new TransformStream({transform:(V,U)=>{"live"===v.readyState?(C=U,N=Date.now(),void 0===b?(b=V,U.enqueue(V.clone())):(U.enqueue(b),b=V)):V.close()}});return v.addEventListener("ended",P),g.readable.pipeThrough(k).pipeTo(v.writable),v}}(n);p&&(w.info("local screen video track begin to inject frame"),this._mediaStreamTrack=p)}r&&-1!==this._hints.indexOf(Vt.CUSTOM_TRACK)&&this.setEncoderConfiguration(r),this.processorContext=new bC(this.getTrackId(),"local"),this.processorDestination=new OD(this.processorContext),this.bindProcessorDestinationEvents()}play(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof n){const c=document.getElementById(n);c?n=c:(w.warning("[".concat(this.getTrackId(),'] can not find "#').concat(n,'" element, use document.body')),n=document.body)}w.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const s=_o(_o(_o({},this._getDefaultPlayerConfig()),r),{},{trackId:this.getTrackId(),element:n});this._player?this._player.updateConfig(s):(this._player=n instanceof HTMLVideoElement?new CE(s):new Tx(s),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Jc.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},B("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,w.debug("[".concat(this.getTrackId(),"] stop video playback")))}setEnabled(n,r){var s=this;return x(function*(){if(!r){if(n===s._enabled)return;s.stateCheck("enabled",n)}if(w.info("[".concat(s.getTrackId(),"] start setEnabled"),n),!n){s._originMediaStreamTrack.enabled=!1;try{yield Mt(s,fe.NEED_DISABLE_TRACK,s)}catch(c){throw w.error("[".concat(s.getTrackId(),"] setEnabled to false error"),c.toString()),c}return r||(s._enabled=!1),void w.info("[".concat(s.getTrackId(),"] setEnabled to false success"))}s._originMediaStreamTrack.enabled=!0;try{yield Mt(s,fe.NEED_ENABLE_TRACK,s)}catch(c){throw w.error("[".concat(s.getTrackId(),"] setEnabled to true error"),c.toString()),c}w.info("[".concat(s.getTrackId(),"] setEnabled to true success")),r||(s._enabled=!0)})()}setMuted(n){var r=this;return x(function*(){n!==r._muted&&(r.stateCheck("muted",n),r._muted=n,r._originMediaStreamTrack.enabled=!n,w.debug("[".concat(r.getTrackId(),"] start set muted: ").concat(n)),n?yield Mt(r,fe.NEED_MUTE_TRACK,r):yield Mt(r,fe.NEED_UNMUTE_TRACK,r))})()}setEncoderConfiguration(n,r){var s=this;return x(function*(){if(!s._enabled)throw new Q(M.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(n=sc(n),s._forceBitrateLimit&&(n.bitrateMax=s._forceBitrateLimit.max_bitrate?s._forceBitrateLimit.max_bitrate:n.bitrateMax,n.bitrateMin=s._forceBitrateLimit.min_bitrate?s._forceBitrateLimit.min_bitrate:n.bitrateMin),n.width||n.height||n.frameRate){const c=vE({encoderConfig:n});(qi()||ir()||Gs())&&(c.deviceId=void 0),w.debug("[".concat(s.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(n),JSON.stringify(c));try{yield s._originMediaStreamTrack.applyConstraints(c),s.updateMediaStreamTrackResolution()}catch(d){const h=new Q(M.UNEXPECTED_ERROR,d.toString());throw w.error("[".concat(s.getTrackId(),"] applyConstraints error"),h.toString()),h}}s._encoderConfig=n,-1===s._hints.indexOf(Vt.SCREEN_TRACK)&&s.updateBitrateFromProfile();try{yield Mt(s,fe.NEED_UPDATE_VIDEO_ENCODER,s)}catch(c){return c.throw(w)}})()}getStats(){return pf(()=>{w.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),hr(this,fe.GET_STATS)||_o({},gi)}setBeautyEffect(n){return x(function*(){w.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")})()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}getCurrentFrameImage(n){var r=arguments,s=this;return x(function*(){return s._player?s._player.getCurrentFrameToUint8Array(n,r.length>1&&void 0!==r[1]?r[1]:1):yield CC(n)})()}setBitrateLimit(n){var r=this;return x(function*(){if(w.debug("[".concat(r.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(n))),n){r._forceBitrateLimit=n,r._encoderConfig&&(r._encoderConfig.bitrateMax=r._encoderConfig.bitrateMax&&r._encoderConfig.bitrateMax<n.max_bitrate?r._encoderConfig.bitrateMax:n.max_bitrate,r._encoderConfig.bitrateMin=n.min_bitrate);try{yield Mt(r,fe.NEED_UPDATE_VIDEO_ENCODER,r)}catch(s){return s.throw(w)}}})()}setOptimizationMode(n){var r=this;return x(function*(){if("motion"!==n&&"detail"!==n&&"balanced"!==n)return void w.error(M.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=r._optimizationMode;try{r._optimizationMode=n,yield Mt(r,fe.SET_OPTIMIZATION_MODE,r)}catch(c){throw r._optimizationMode=s,w.error("[".concat(r.getTrackId(),"] set optimization mode failed"),c.toString()),c}w.info("[".concat(r.getTrackId(),"] set optimization mode success (").concat(n,")"))})()}setScalabiltyMode(n){if(1===n.numSpatialLayers&&1!==n.numTemporalLayers)return w.error(M.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=n,w.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(n,")"))}updateMediaStreamTrackResolution(){kD(this._originMediaStreamTrack).then(n=>{let[r,s]=n;this._videoHeight=s,this._videoWidth=r}).catch(Bg)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:n,height:r,frameRate:s}=this.getMediaStreamTrackSettings();if(!n||!r||!s)return;const[c,d]=function(h,p,m,_){let g;const v=200*Math.pow(m/15,.6)*Math.pow(h*p/640/360,.75),b=v;if("STANDARD_BITRATE"===_)g=4*v;else{if("COMPATIABLE_BITRATE"!==_)return;g=2*v}return[Math.floor(g),Math.floor(b)]}(n,r,s,B("BITRATE_ADAPTER_TYPE"))||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=d,this._encoderConfig.bitrateMax=c,w.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(n,", h: ").concat(r,", fps: ").concat(s,"] => [brMax: ").concat(c,", brMin: ").concat(d,"]")))}getVideoElementVisibleStatus(){try{var n,r;const s=null==this||null===(n=this._player)||void 0===n?void 0:n.getContainerElement(),c={track:this,element:null==this||null===(r=this._player)||void 0===r?void 0:r.getVideoElement(),slot:s?.parentElement},{element:d,slot:h}=c;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const p=df.checkOneElementVisible(d),m=Object.assign({},p);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;Se.reportApiInvoke(null,{tag:dn.TRACER,name:Vn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(m.visible?"Video is visible":"Invisible because of ".concat(m.reason))}return m}return}catch(s){throw new Q(M.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}renewMediaStreamTrack(n){return x(function*(){})()}pipe(n){if(this.processor===n)return n;if(n._source)throw new Q(M.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),n}unpipe(){if(!this.processor)return;const n=this.processor;this.processor._source=void 0,this.processor=void 0,n.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(n){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=this._encoderConfig;n&&(s=_o(_o({},s),sc(n))),s=Hc(s);const c=It(8,"track-video-cloned-"),d=new We(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,s,Hc(this._scalabilityMode),this._optimizationMode,c,Hc(this._hints));return n&&s&&d.setEncoderConfiguration(s),w.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(r)),d}replaceTrack(n,r){var s=this;return x(function*(){if(!(n instanceof MediaStreamTrack))throw new Q(M.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==n.kind)throw new Q(M.INVALID_PARAMS,"track should be a video MediaStreamTrack");yield s._updateOriginMediaStreamTrack(n,r,!0),s.updateMediaStreamTrackResolution()})()}bindProcessorDestinationEvents(){var n=this;this.processorDestination.on(Le.ON_TRACK,function(){var r=x(function*(s){s?s!==n._mediaStreamTrack&&(n._mediaStreamTrack=s,n._updatePlayerSource(),yield Mt(n,fe.NEED_REPLACE_TRACK,n)):n._mediaStreamTrack!==n._originMediaStreamTrack&&(n._mediaStreamTrack=n._originMediaStreamTrack,n._updatePlayerSource(),yield Mt(n,fe.NEED_REPLACE_TRACK,n))});return function(s){return r.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Le.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(qr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(qr.REQUEST_CONSTRAINTS)}}ee([Ie({argsMap:(o,n,r)=>[o.getTrackId(),"string"==typeof n?n:n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),un(),O("design:type",Function),O("design:paramtypes",[Object,Object]),O("design:returntype",void 0)],We.prototype,"play",null),ee([Ie({argsMap:o=>[o.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],We.prototype,"stop",null),ee([md("LocalVideoTrack","_enabledMutex"),Ie({argsMap:(o,n)=>[o.getTrackId(),n]}),un(),O("design:type",Function),O("design:paramtypes",[Boolean,Boolean]),O("design:returntype",z)],We.prototype,"setEnabled",null),ee([md("LocalVideoTrack","_enabledMutex"),Ie({argsMap:(o,n)=>[o.getTrackId(),n]}),un(),O("design:type",Function),O("design:paramtypes",[Boolean]),O("design:returntype",z)],We.prototype,"setMuted",null),ee([Ie({argsMap:(o,n)=>[o.getTrackId(),n]}),un(),O("design:type",Function),O("design:paramtypes",[Object,Boolean]),O("design:returntype",z)],We.prototype,"setEncoderConfiguration",null),ee([un(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",Object)],We.prototype,"getStats",null),ee([Ie({argsMap:(o,n,r)=>[o.getTrackId(),n,r]}),un(),O("design:type",Function),O("design:paramtypes",[Boolean,Object]),O("design:returntype",z)],We.prototype,"setBeautyEffect",null),ee([un(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",ImageData)],We.prototype,"getCurrentFrameData",null),ee([un(),O("design:type",Function),O("design:paramtypes",[String,Number]),O("design:returntype",z)],We.prototype,"getCurrentFrameImage",null),ee([un(),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",z)],We.prototype,"setBitrateLimit",null),ee([un(),O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",z)],We.prototype,"setOptimizationMode",null),ee([un(),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",void 0)],We.prototype,"setScalabiltyMode",null),ee([un(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],We.prototype,"updateMediaStreamTrackResolution",null),ee([Ie({argsMap:(o,n)=>[o.getTrackId(),n.name]}),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",Object)],We.prototype,"pipe",null),ee([Ie({argsMap:o=>[o.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],We.prototype,"unpipe",null),ee([Ie({argsMap:o=>[o.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],We.prototype,"close",null),ee([Ie({argsMap:(o,n,r)=>[o.getTrackId(),n.label,r]}),O("design:type",Function),O("design:paramtypes",[MediaStreamTrack,Boolean]),O("design:returntype",z)],We.prototype,"replaceTrack",null);class uc extends We{get __className__(){return"CameraVideoTrack"}constructor(n,r,s,c,d,h){var p;super(n,sc(r.encoderConfig),c,d,h),p=this,S(this,"_config",void 0),S(this,"_originalConstraints",void 0),S(this,"_constraints",void 0),S(this,"_enabled",!0),S(this,"_deviceName","default"),S(this,"tryResumeVideoForIOS15_16WeChat",x(function*(){(th()||nh())&&!function(){const m=Ve();if(m.os!==ei.IOS||!m.osVersion)return!1;const _=m.osVersion.split(".");return 15===Number(_[0])&&Number(_[1])>=2}()&&vS()&&p._enabled&&!p._isClosed&&(w.debug("[".concat(p.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),yield p.renewMediaStreamTrack())})),this._config=r,this._originalConstraints=s,this._constraints=s,this._deviceName=n.label,this._encoderConfig=sc(this._config.encoderConfig),it.on(di.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),it.on(di.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}setDevice(n){var r=this;return x(function*(){return"string"==typeof n?r._setDeviceById(n):n.deviceId?r._setDeviceById(n.deviceId):n.facingMode?r._setDeviceByFacingModel(n.facingMode):void 0})()}_setDeviceById(n){var r=this;return x(function*(){if(w.info("[".concat(r.getTrackId(),"] set device to ").concat(n)),r._enabled)try{const s=yield sn.getDeviceById(n),c={};c.video=_o({},r._constraints),c.video.deviceId={exact:n},c.video.facingMode=void 0,r._originMediaStreamTrack.stop();let d=null;try{d=yield fo(c,r.getTrackId())}catch(h){throw w.error("[".concat(r.getTrackId(),"] setDevice failed"),h.toString()),d=yield fo({video:r._constraints},r.getTrackId()),yield r._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),h}yield r._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),r.updateMediaStreamTrackResolution(),r._deviceName=s.label,r._config.cameraId=n,r._constraints.deviceId={exact:n}}catch(s){throw w.error("[".concat(r.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=yield sn.getDeviceById(n);r._deviceName=s.label,r._config.cameraId=n,r._constraints.deviceId={exact:n}}catch(s){throw w.error("[".concat(r.getTrackId(),"] setDevice error"),s.toString()),s}w.info("[".concat(r.getTrackId(),"] setDevice success"))})()}_setDeviceByFacingModel(n){var r=this;return x(function*(){w.info("[".concat(r.getTrackId(),"] set facingMode ").concat(n));const s={video:_o(_o({},r._constraints),{},{deviceId:void 0,facingMode:{exact:n}})};if(r._enabled){r._originMediaStreamTrack.stop();let c=null;try{c=yield fo(s,r.getTrackId())}catch(d){throw w.error("[".concat(r.getTrackId(),"] setDeviceByFacingModel failed"),d.toString()),c=yield fo({video:r._constraints},r.getTrackId()),yield r._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),d}yield r._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),r.updateMediaStreamTrackResolution()}r._deviceName="",r._config.facingMode=n,r._config.cameraId=void 0,r._constraints=_o({},s.video),w.info("[".concat(r.getTrackId(),"] setDeviceByFacingModel success"))})()}setEnabled(n,r){var s=this;return x(function*(){if(!r){if(n===s._enabled)return;s.stateCheck("enabled",n)}if(w.info("[".concat(s.getTrackId(),"] start setEnabled"),n),n){try{if(s.isExternalTrack)s._originMediaStreamTrack.enabled=!0;else{const c=yield fo({video:s._constraints},s.getTrackId());yield s._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1)}yield Mt(s,fe.NEED_ENABLE_TRACK,s)}catch(c){throw w.error("[".concat(s.getTrackId(),"] setEnabled true error"),c.toString()),c}s.updateMediaStreamTrackResolution(),w.info("[".concat(s.getTrackId(),"] setEnabled to true success")),r||(s._enabled=!0)}else{s.isExternalTrack?s._originMediaStreamTrack.enabled=!1:(s._originMediaStreamTrack.onended=null,s._originMediaStreamTrack.stop()),r||(s._enabled=!1);try{yield Mt(s,fe.NEED_DISABLE_TRACK,s)}catch(c){throw w.error("[".concat(s.getTrackId(),"] setEnabled to false error"),c.toString()),c}w.info("[".concat(s.getTrackId(),"] setEnabled to false success"))}})()}setEncoderConfiguration(n,r){var s=this;return x(function*(){if(!s._enabled)throw new Q(M.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");n=sc(n),s._forceBitrateLimit&&(n.bitrateMax=s._forceBitrateLimit.max_bitrate?s._forceBitrateLimit.max_bitrate:n.bitrateMax,n.bitrateMin=s._forceBitrateLimit.min_bitrate?s._forceBitrateLimit.min_bitrate:n.bitrateMin);const c=Ln(s._config);c.encoderConfig=n;const d=vE(c);(qi()||ir()||Gs())&&(d.deviceId=void 0),w.debug("[".concat(s.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(n),JSON.stringify(d));try{yield s._originMediaStreamTrack.applyConstraints(d),s.updateMediaStreamTrackResolution()}catch(h){const p=new Q(M.UNEXPECTED_ERROR,h.toString());throw w.error("[".concat(s.getTrackId(),"] applyConstraints error"),p.toString()),p}s._config=c,s._constraints=d,s._originalConstraints=d,s._encoderConfig=n,-1===s._hints.indexOf(Vt.SCREEN_TRACK)&&s.updateBitrateFromProfile();try{yield Mt(s,fe.NEED_UPDATE_VIDEO_ENCODER,s)}catch(h){return h.throw(w)}})()}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){var n=this;if((ir()||Gs())&&this._enabled&&!this._isClosed&&it.duringInterruption){const r=function(){var s=x(function*(){it.off(di.IOS_INTERRUPTION_END,r),n._enabled&&!n._isClosed&&(w.debug("[".concat(n.getTrackId(),"] try capture camera media device for interrupted iOS device.")),yield n.setEnabled(!1),yield n.setEnabled(!0))});return function(){return s.apply(this,arguments)}}();it.on(di.IOS_INTERRUPTION_END,r)}else w.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Jc.TRACK_ENDED)}renewMediaStreamTrack(n){var r=this;return x(function*(){const s=n||r._constraints,c=sn.searchDeviceIdByName(r._deviceName);if(c&&!s.deviceId&&(s.deviceId={exact:c}),r._enabled){const d=yield fo({video:s},r.getTrackId());r._constraints=s,yield r._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!0),r.updateMediaStreamTrackResolution()}})()}close(){super.close(),it.off(di.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),it.off(di.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(n){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=this._encoderConfig;n&&(s=_o(_o({},s),sc(n))),s=Hc(s);const c=It(8,"track-cam-cloned-"),d=new uc(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,Hc(_o(_o({},this._config),{},{encoderConfig:s})),Hc(this._constraints),Hc(this._scalabilityMode),this._optimizationMode,c);return n&&s&&d.setEncoderConfiguration(s),w.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(r)),d}bindProcessorContextEvents(){var n=this;this.processorContext.on(qr.REQUEST_UPDATE_CONSTRAINTS,function(){var r=x(function*(s,c,d){try{const h=Object.assign({},n._originalConstraints,...s);yield n.renewMediaStreamTrack(h),c()}catch(h){d(h)}});return function(s,c,d){return r.apply(this,arguments)}}()),this.processorContext.on(qr.REQUEST_CONSTRAINTS,function(){var r=x(function*(s){s(n._originMediaStreamTrack.getSettings())});return function(s){return r.apply(this,arguments)}}())}}function xD(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function jf(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?xD(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):xD(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}function wE(o,n,r,s){r.optimizationMode&&(s&&s.width&&s.height?(r.encoderConfig=jf(jf({},s),{},{bitrateMin:s.bitrateMin,bitrateMax:s.bitrateMax}),"motion"!==r.optimizationMode&&"detail"!==r.optimizationMode||(n.contentHint=r.optimizationMode,n.contentHint===r.optimizationMode?w.debug("[".concat(o,"] set content hint to"),r.optimizationMode):w.debug("[".concat(o,"] set content hint failed")))):w.warning("[".concat(o,"] can not apply optimization mode bitrate config, no encoderConfig")))}function LD(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function hc(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?LD(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):LD(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}ee([Ie({argsMap:(o,n)=>[o.getTrackId(),n]}),un(),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",z)],uc.prototype,"setDevice",null),ee([md("CameraVideoTrack","_enabledMutex"),Ie({argsMap:(o,n)=>[o.getTrackId(),n]}),un(),O("design:type",Function),O("design:paramtypes",[Boolean,Boolean]),O("design:returntype",z)],uc.prototype,"setEnabled",null),ee([Ie({argsMap:(o,n)=>[o.getTrackId(),n]}),un(),O("design:type",Function),O("design:paramtypes",[Object,Boolean]),O("design:returntype",z)],uc.prototype,"setEncoderConfiguration",null),ee([Ie({argsMap:o=>[o.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],uc.prototype,"close",null);class FD extends mx{getUserId(){return this._userId}constructor(n,r,s,c){super(n,"track-".concat(n.kind,"-").concat(r,"-").concat(c.clientId,"_").concat(It(5,""))),S(this,"_userId",void 0),S(this,"_uintId",void 0),S(this,"_isDestroyed",!1),S(this,"store",void 0),S(this,"processor",void 0),this._userId=r,this._uintId=s,this.store=c}_updateOriginMediaStreamTrack(n){this._originMediaStreamTrack=n,this._mediaStreamTrack=n,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,w.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}class Ks extends FD{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==xi.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(n,r,s,c){super(n,r,s,c),S(this,"_videoVisibleTimer",null),S(this,"_previousVideoVisibleStatus",void 0),S(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),S(this,"trackMediaType","video"),S(this,"_videoWidth",void 0),S(this,"_videoHeight",void 0),S(this,"_player",void 0),S(this,"processorDestination",void 0),S(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new bC(this.getTrackId(),"remote"),this.processorDestination=new OD(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return pf(()=>{w.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),hr(this,fe.GET_STATS)||hc({},ii)}play(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof n){const c=document.getElementById(n);c?n=c:(w.warning("[".concat(this.getTrackId(),'] can not find "#').concat(n,'" element, use document.body')),n=document.body)}w.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const s=hc(hc({fit:"cover"},r),{},{trackId:this.getTrackId(),element:n});this._player?this._player.updateConfig(s):(this._player=n instanceof HTMLVideoElement?new CE(s):new Tx(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Qc.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Qc.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},B("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,w.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){kD(this._originMediaStreamTrack).then(n=>{let[r,s]=n;this._videoHeight=s,this._videoWidth=r}).catch(Bg)}_updatePlayerSource(){w.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var n,r;const s=null==this||null===(n=this._player)||void 0===n?void 0:n.getContainerElement(),c={track:this,element:null==this||null===(r=this._player)||void 0===r?void 0:r.getVideoElement(),slot:s?.parentElement},{element:d,slot:h}=c;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const p=df.checkOneElementVisible(d),m=Object.assign({},p);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;Se.reportApiInvoke(null,{tag:dn.TRACER,name:Vn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(m.visible?"Video is visible":"Invisible because of ".concat(m.reason))}return m}return}catch(s){throw new Q(M.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(n){if(this.processor===n)return n;if(n._source)throw new Q(M.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),n}unpipe(){if(!this.processor)return;const n=this.processor;this.processor._source=void 0,this.processor=void 0,n.reset()}bindProcessorDestinationEvents(){var n=this;this.processorDestination.on(Le.ON_TRACK,function(){var r=x(function*(s){s?s!==n._mediaStreamTrack&&(n._mediaStreamTrack=s,n._updatePlayerSource()):n._mediaStreamTrack!==n._originMediaStreamTrack&&(n._mediaStreamTrack=n._originMediaStreamTrack,n._updatePlayerSource())});return function(s){return r.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Le.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}ee([Ie({argsMap:(o,n,r)=>[o.getTrackId(),"string"==typeof n?n:n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),O("design:type",Function),O("design:paramtypes",[Object,Object]),O("design:returntype",void 0)],Ks.prototype,"play",null),ee([Ie({argsMap:o=>[o.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],Ks.prototype,"stop",null),ee([Ie({argsMap:(o,n)=>[o.getTrackId(),n.name]}),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",Object)],Ks.prototype,"pipe",null),ee([Ie({argsMap:o=>[o.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],Ks.prototype,"unpipe",null);class go extends FD{get isPlaying(){return this._useAudioElement?Rr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(n,r,s,c){super(n,r,s,c),S(this,"trackMediaType","audio"),S(this,"_source",void 0),S(this,"_useAudioElement",!0),S(this,"_volume",100),S(this,"processorContext",void 0),S(this,"processorDestination",void 0),S(this,"_played",!1),S(this,"_bypassWebAudio",!1),B("DISABLE_WEBAUDIO")?(this._source=new SC,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new po(n,!0),B("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(wr.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Qc.FIRST_FRAME_DECODED)}),this.processorContext=new gE(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new _E(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(wr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!n)return this._source.removeAllListeners(wr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(wr.ON_AUDIO_BUFFER),this._source.on(wr.ON_AUDIO_BUFFER,s=>n(s))}setVolume(n){this._volume=n,this._useAudioElement?Rr.setVolume(this.getTrackId(),n):this._source.setVolume(n/100)}setPlaybackDevice(n){var r=this;return x(function*(){if(!r._useAudioElement)throw new Q(M.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield Rr.setSinkID(r.getTrackId(),n)})()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return pf(()=>{w.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),hr(this,fe.GET_STATS)||hc({},Ei)}play(){w.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(w.debug("[".concat(this.getTrackId(),"] use audio element to play")),Rr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){w.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Rr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];w.debug("[".concat(this.getTrackId(),"] update player source track")),n&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Rr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(n){if(this._bypassWebAudio)throw new Q(M.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===n)return n;if(n._source)throw new Q(M.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),n}unpipe(){var n;if(this._bypassWebAudio)throw new Q(M.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;null===(n=this._source.processSourceNode)||void 0===n||n.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){var n=this;this.processorDestination.on(Le.ON_TRACK,function(){var r=x(function*(s){s?s!==n._mediaStreamTrack&&(n._mediaStreamTrack=s,n._updatePlayerSource(!1),n._source.processedNode=n._source.createMediaStreamSourceNode(s)):n._mediaStreamTrack!==n._originMediaStreamTrack&&(n._mediaStreamTrack=n._originMediaStreamTrack,n._updatePlayerSource())});return function(s){return r.apply(this,arguments)}}()),this.processorDestination.on(Le.ON_NODE,r=>{this._source.processedNode=r;const s=!r;this._useAudioElement!==s&&(this._played?(this.stop(),this._useAudioElement=s,this.play()):this._useAudioElement=s)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Le.ON_TRACK),this.processorDestination.removeAllListeners(Le.ON_NODE)}}function pc(o){let n=o.length;for(;--n>=0;)o[n]=0}ee([Ie({argsMap:(o,n)=>[o.getTrackId(),n],throttleTime:300}),O("design:type",Function),O("design:paramtypes",[Number]),O("design:returntype",void 0)],go.prototype,"setVolume",null),ee([Ie({argsMap:(o,n)=>[o.getTrackId(),n]}),O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",z)],go.prototype,"setPlaybackDevice",null),ee([Ie({argsMap:o=>[o.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],go.prototype,"play",null),ee([Ie({argsMap:o=>[o.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],go.prototype,"stop",null),ee([Ie({argsMap:(o,n)=>[o.getTrackId(),n.name]}),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",Object)],go.prototype,"pipe",null),ee([Ie({argsMap:o=>[o.getTrackId()]}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],go.prototype,"unpipe",null);const IC=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),AE=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),VD=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),wx=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ji=new Array(576);pc(Ji);const Hf=new Array(60);pc(Hf);const Gf=new Array(512);pc(Gf);const Wf=new Array(256);pc(Wf);const RC=new Array(29);pc(RC);const Nh=new Array(30);function AC(o,n,r,s,c){this.static_tree=o,this.extra_bits=n,this.extra_base=r,this.elems=s,this.max_length=c,this.has_stree=o&&o.length}let BD,jD,HD;function DC(o,n){this.dyn_tree=o,this.max_code=0,this.stat_desc=n}pc(Nh);const GD=o=>o<256?Gf[o]:Gf[256+(o>>>7)],zf=(o,n)=>{o.pending_buf[o.pending++]=255&n,o.pending_buf[o.pending++]=n>>>8&255},Eo=(o,n,r)=>{o.bi_valid>16-r?(o.bi_buf|=n<<o.bi_valid&65535,zf(o,o.bi_buf),o.bi_buf=n>>16-o.bi_valid,o.bi_valid+=r-16):(o.bi_buf|=n<<o.bi_valid&65535,o.bi_valid+=r)},Aa=(o,n,r)=>{Eo(o,r[2*n],r[2*n+1])},WD=(o,n)=>{let r=0;do{r|=1&o,o>>>=1,r<<=1}while(--n>0);return r>>>1},zD=(o,n,r)=>{const s=new Array(16);let c,d,h=0;for(c=1;c<=15;c++)h=h+r[c-1]<<1,s[c]=h;for(d=0;d<=n;d++){let p=o[2*d+1];0!==p&&(o[2*d]=WD(s[p]++,p))}},KD=o=>{let n;for(n=0;n<286;n++)o.dyn_ltree[2*n]=0;for(n=0;n<30;n++)o.dyn_dtree[2*n]=0;for(n=0;n<19;n++)o.bl_tree[2*n]=0;o.dyn_ltree[512]=1,o.opt_len=o.static_len=0,o.sym_next=o.matches=0},qD=o=>{o.bi_valid>8?zf(o,o.bi_buf):o.bi_valid>0&&(o.pending_buf[o.pending++]=o.bi_buf),o.bi_buf=0,o.bi_valid=0},YD=(o,n,r,s)=>{const c=2*n,d=2*r;return o[c]<o[d]||o[c]===o[d]&&s[n]<=s[r]},DE=(o,n,r)=>{const s=o.heap[r];let c=r<<1;for(;c<=o.heap_len&&(c<o.heap_len&&YD(n,o.heap[c+1],o.heap[c],o.depth)&&c++,!YD(n,s,o.heap[c],o.depth));)o.heap[r]=o.heap[c],r=c,c<<=1;o.heap[r]=s},$D=(o,n,r)=>{let s,c,d,h,p=0;if(0!==o.sym_next)do{s=255&o.pending_buf[o.sym_buf+p++],s+=(255&o.pending_buf[o.sym_buf+p++])<<8,c=o.pending_buf[o.sym_buf+p++],0===s?Aa(o,c,n):(d=Wf[c],Aa(o,d+256+1,n),h=IC[d],0!==h&&(c-=RC[d],Eo(o,c,h)),s--,d=GD(s),Aa(o,d,r),h=AE[d],0!==h&&(s-=Nh[d],Eo(o,s,h)))}while(p<o.sym_next);Aa(o,256,n)},OC=(o,n)=>{const r=n.dyn_tree,s=n.stat_desc.static_tree,c=n.stat_desc.has_stree,d=n.stat_desc.elems;let h,p,m,_=-1;for(o.heap_len=0,o.heap_max=573,h=0;h<d;h++)0!==r[2*h]?(o.heap[++o.heap_len]=_=h,o.depth[h]=0):r[2*h+1]=0;for(;o.heap_len<2;)m=o.heap[++o.heap_len]=_<2?++_:0,r[2*m]=1,o.depth[m]=0,o.opt_len--,c&&(o.static_len-=s[2*m+1]);for(n.max_code=_,h=o.heap_len>>1;h>=1;h--)DE(o,r,h);m=d;do{h=o.heap[1],o.heap[1]=o.heap[o.heap_len--],DE(o,r,1),p=o.heap[1],o.heap[--o.heap_max]=h,o.heap[--o.heap_max]=p,r[2*m]=r[2*h]+r[2*p],o.depth[m]=(o.depth[h]>=o.depth[p]?o.depth[h]:o.depth[p])+1,r[2*h+1]=r[2*p+1]=m,o.heap[1]=m++,DE(o,r,1)}while(o.heap_len>=2);o.heap[--o.heap_max]=o.heap[1],((g,v)=>{const b=v.dyn_tree,C=v.max_code,N=v.stat_desc.static_tree,P=v.stat_desc.has_stree,D=v.stat_desc.extra_bits,k=v.stat_desc.extra_base,V=v.stat_desc.max_length;let U,Y,oe,K,X,$,J=0;for(K=0;K<=15;K++)g.bl_count[K]=0;for(b[2*g.heap[g.heap_max]+1]=0,U=g.heap_max+1;U<573;U++)Y=g.heap[U],K=b[2*b[2*Y+1]+1]+1,K>V&&(K=V,J++),b[2*Y+1]=K,Y>C||(g.bl_count[K]++,X=0,Y>=k&&(X=D[Y-k]),$=b[2*Y],g.opt_len+=$*(K+X),P&&(g.static_len+=$*(N[2*Y+1]+X)));if(0!==J){do{for(K=V-1;0===g.bl_count[K];)K--;g.bl_count[K]--,g.bl_count[K+1]+=2,g.bl_count[V]--,J-=2}while(J>0);for(K=V;0!==K;K--)for(Y=g.bl_count[K];0!==Y;)oe=g.heap[--U],oe>C||(b[2*oe+1]!==K&&(g.opt_len+=(K-b[2*oe+1])*b[2*oe],b[2*oe+1]=K),Y--)}})(o,n),zD(r,_,o.bl_count)},XD=(o,n,r)=>{let s,c,d=-1,h=n[1],p=0,m=7,_=4;for(0===h&&(m=138,_=3),n[2*(r+1)+1]=65535,s=0;s<=r;s++)c=h,h=n[2*(s+1)+1],++p<m&&c===h||(p<_?o.bl_tree[2*c]+=p:0!==c?(c!==d&&o.bl_tree[2*c]++,o.bl_tree[32]++):p<=10?o.bl_tree[34]++:o.bl_tree[36]++,p=0,d=c,0===h?(m=138,_=3):c===h?(m=6,_=3):(m=7,_=4))},OE=(o,n,r)=>{let s,c,d=-1,h=n[1],p=0,m=7,_=4;for(0===h&&(m=138,_=3),s=0;s<=r;s++)if(c=h,h=n[2*(s+1)+1],!(++p<m&&c===h)){if(p<_)do{Aa(o,c,o.bl_tree)}while(0!=--p);else 0!==c?(c!==d&&(Aa(o,c,o.bl_tree),p--),Aa(o,16,o.bl_tree),Eo(o,p-3,2)):p<=10?(Aa(o,17,o.bl_tree),Eo(o,p-3,3)):(Aa(o,18,o.bl_tree),Eo(o,p-11,7));p=0,d=c,0===h?(m=138,_=3):c===h?(m=6,_=3):(m=7,_=4)}};let NE=!1;const Ix=(o,n,r,s)=>{Eo(o,0+(s?1:0),3),qD(o),zf(o,r),zf(o,~r),r&&o.pending_buf.set(o.window.subarray(n,n+r),o.pending),o.pending+=r};var Rx={_tr_init:o=>{NE||((()=>{let n,r,s,c,d;const h=new Array(16);for(s=0,c=0;c<28;c++)for(RC[c]=s,n=0;n<1<<IC[c];n++)Wf[s++]=c;for(Wf[s-1]=c,d=0,c=0;c<16;c++)for(Nh[c]=d,n=0;n<1<<AE[c];n++)Gf[d++]=c;for(d>>=7;c<30;c++)for(Nh[c]=d<<7,n=0;n<1<<AE[c]-7;n++)Gf[256+d++]=c;for(r=0;r<=15;r++)h[r]=0;for(n=0;n<=143;)Ji[2*n+1]=8,n++,h[8]++;for(;n<=255;)Ji[2*n+1]=9,n++,h[9]++;for(;n<=279;)Ji[2*n+1]=7,n++,h[7]++;for(;n<=287;)Ji[2*n+1]=8,n++,h[8]++;for(zD(Ji,287,h),n=0;n<30;n++)Hf[2*n+1]=5,Hf[2*n]=WD(n,5);BD=new AC(Ji,IC,257,286,15),jD=new AC(Hf,AE,0,30,15),HD=new AC(new Array(0),VD,0,19,7)})(),NE=!0),o.l_desc=new DC(o.dyn_ltree,BD),o.d_desc=new DC(o.dyn_dtree,jD),o.bl_desc=new DC(o.bl_tree,HD),o.bi_buf=0,o.bi_valid=0,KD(o)},_tr_stored_block:Ix,_tr_flush_block:(o,n,r,s)=>{let c,d,h=0;o.level>0?(2===o.strm.data_type&&(o.strm.data_type=(p=>{let m,_=4093624447;for(m=0;m<=31;m++,_>>>=1)if(1&_&&0!==p.dyn_ltree[2*m])return 0;if(0!==p.dyn_ltree[18]||0!==p.dyn_ltree[20]||0!==p.dyn_ltree[26])return 1;for(m=32;m<256;m++)if(0!==p.dyn_ltree[2*m])return 1;return 0})(o)),OC(o,o.l_desc),OC(o,o.d_desc),h=(p=>{let m;for(XD(p,p.dyn_ltree,p.l_desc.max_code),XD(p,p.dyn_dtree,p.d_desc.max_code),OC(p,p.bl_desc),m=18;m>=3&&0===p.bl_tree[2*wx[m]+1];m--);return p.opt_len+=3*(m+1)+5+5+4,m})(o),c=o.opt_len+3+7>>>3,d=o.static_len+3+7>>>3,d<=c&&(c=d)):c=d=r+5,r+4<=c&&-1!==n?Ix(o,n,r,s):4===o.strategy||d===c?(Eo(o,2+(s?1:0),3),$D(o,Ji,Hf)):(Eo(o,4+(s?1:0),3),((p,m,_,g)=>{let v;for(Eo(p,m-257,5),Eo(p,_-1,5),Eo(p,g-4,4),v=0;v<g;v++)Eo(p,p.bl_tree[2*wx[v]+1],3);OE(p,p.dyn_ltree,m-1),OE(p,p.dyn_dtree,_-1)})(o,o.l_desc.max_code+1,o.d_desc.max_code+1,h+1),$D(o,o.dyn_ltree,o.dyn_dtree)),KD(o),s&&qD(o)},_tr_tally:(o,n,r)=>(o.pending_buf[o.sym_buf+o.sym_next++]=n,o.pending_buf[o.sym_buf+o.sym_next++]=n>>8,o.pending_buf[o.sym_buf+o.sym_next++]=r,0===n?o.dyn_ltree[2*r]++:(o.matches++,n--,o.dyn_ltree[2*(Wf[r]+256+1)]++,o.dyn_dtree[2*GD(n)]++),o.sym_next===o.sym_end),_tr_align:o=>{var n;Eo(o,2,3),Aa(o,256,Ji),16===(n=o).bi_valid?(zf(n,n.bi_buf),n.bi_buf=0,n.bi_valid=0):n.bi_valid>=8&&(n.pending_buf[n.pending++]=255&n.bi_buf,n.bi_buf>>=8,n.bi_valid-=8)}},qf=(o,n,r,s)=>{let c=65535&o|0,d=o>>>16&65535|0,h=0;for(;0!==r;){h=r>2e3?2e3:r,r-=h;do{c=c+n[s++]|0,d=d+c|0}while(--h);c%=65521,d%=65521}return c|d<<16|0};const Ax=new Uint32Array((()=>{let o,n=[];for(var r=0;r<256;r++){o=r;for(var s=0;s<8;s++)o=1&o?3988292384^o>>>1:o>>>1;n[r]=o}return n})());var or=(o,n,r,s)=>{const c=Ax,d=s+r;o^=-1;for(let h=s;h<d;h++)o=o>>>8^c[255&(o^n[h])];return-1^o},Ph={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Yf={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:kU,_tr_stored_block:QD,_tr_flush_block:Dx,_tr_tally:el,_tr_align:ZD}=Rx,{Z_NO_FLUSH:tl,Z_PARTIAL_FLUSH:xU,Z_FULL_FLUSH:Ox,Z_FINISH:qs,Z_BLOCK:PE,Z_OK:Ar,Z_STREAM_END:eO,Z_STREAM_ERROR:Da,Z_DATA_ERROR:Nx,Z_BUF_ERROR:Mh,Z_DEFAULT_COMPRESSION:Px,Z_FILTERED:ME,Z_HUFFMAN_ONLY:kE,Z_RLE:Mx,Z_FIXED:LU,Z_DEFAULT_STRATEGY:kx,Z_UNKNOWN:xx,Z_DEFLATED:xE}=Yf,NC=286,FU=30,Lx=19,Fx=2*NC+1,Ux=15,fc=262,Md=(o,n)=>(o.msg=Ph[n],n),Vx=o=>2*o-(o>4?9:0),nl=o=>{let n=o.length;for(;--n>=0;)o[n]=0},wi=o=>{let n,r,s,c=o.w_size;n=o.hash_size,s=n;do{r=o.head[--s],o.head[s]=r>=c?r-c:0}while(--n);n=c,s=n;do{r=o.prev[--s],o.prev[s]=r>=c?r-c:0}while(--n)};let kd=(o,n,r)=>(n<<o.hash_shift^r)&o.hash_mask;const _s=o=>{const n=o.state;let r=n.pending;r>o.avail_out&&(r=o.avail_out),0!==r&&(o.output.set(n.pending_buf.subarray(n.pending_out,n.pending_out+r),o.next_out),o.next_out+=r,n.pending_out+=r,o.total_out+=r,o.avail_out-=r,n.pending-=r,0===n.pending&&(n.pending_out=0))},gs=(o,n)=>{Dx(o,o.block_start>=0?o.block_start:-1,o.strstart-o.block_start,n),o.block_start=o.strstart,_s(o.strm)},Tn=(o,n)=>{o.pending_buf[o.pending++]=n},LE=(o,n)=>{o.pending_buf[o.pending++]=n>>>8&255,o.pending_buf[o.pending++]=255&n},tO=(o,n,r,s)=>{let c=o.avail_in;return c>s&&(c=s),0===c?0:(o.avail_in-=c,n.set(o.input.subarray(o.next_in,o.next_in+c),r),1===o.state.wrap?o.adler=qf(o.adler,n,c,r):2===o.state.wrap&&(o.adler=or(o.adler,n,c,r)),o.next_in+=c,o.total_in+=c,c)},nO=(o,n)=>{let r,s,c=o.max_chain_length,d=o.strstart,h=o.prev_length,p=o.nice_match;const m=o.strstart>o.w_size-fc?o.strstart-(o.w_size-fc):0,_=o.window,g=o.w_mask,v=o.prev,b=o.strstart+258;let C=_[d+h-1],N=_[d+h];o.prev_length>=o.good_match&&(c>>=2),p>o.lookahead&&(p=o.lookahead);do{if(r=n,_[r+h]===N&&_[r+h-1]===C&&_[r]===_[d]&&_[++r]===_[d+1]){d+=2,r++;do{}while(_[++d]===_[++r]&&_[++d]===_[++r]&&_[++d]===_[++r]&&_[++d]===_[++r]&&_[++d]===_[++r]&&_[++d]===_[++r]&&_[++d]===_[++r]&&_[++d]===_[++r]&&d<b);if(s=258-(b-d),d=b-258,s>h){if(o.match_start=n,h=s,s>=p)break;C=_[d+h-1],N=_[d+h]}}}while((n=v[n&g])>m&&0!=--c);return h<=o.lookahead?h:o.lookahead},Xf=o=>{const n=o.w_size;let r,s,c;do{if(s=o.window_size-o.lookahead-o.strstart,o.strstart>=n+(n-fc)&&(o.window.set(o.window.subarray(n,n+n-s),0),o.match_start-=n,o.strstart-=n,o.block_start-=n,o.insert>o.strstart&&(o.insert=o.strstart),wi(o),s+=n),0===o.strm.avail_in)break;if(r=tO(o.strm,o.window,o.strstart+o.lookahead,s),o.lookahead+=r,o.lookahead+o.insert>=3)for(c=o.strstart-o.insert,o.ins_h=o.window[c],o.ins_h=kd(o,o.ins_h,o.window[c+1]);o.insert&&(o.ins_h=kd(o,o.ins_h,o.window[c+3-1]),o.prev[c&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=c,c++,o.insert--,!(o.lookahead+o.insert<3)););}while(o.lookahead<fc&&0!==o.strm.avail_in)},Bx=(o,n)=>{let r,s,c,d=o.pending_buf_size-5>o.w_size?o.w_size:o.pending_buf_size-5,h=0,p=o.strm.avail_in;do{if(r=65535,c=o.bi_valid+42>>3,o.strm.avail_out<c||(c=o.strm.avail_out-c,s=o.strstart-o.block_start,r>s+o.strm.avail_in&&(r=s+o.strm.avail_in),r>c&&(r=c),r<d&&(0===r&&n!==qs||n===tl||r!==s+o.strm.avail_in)))break;h=n===qs&&r===s+o.strm.avail_in?1:0,QD(o,0,0,h),o.pending_buf[o.pending-4]=r,o.pending_buf[o.pending-3]=r>>8,o.pending_buf[o.pending-2]=~r,o.pending_buf[o.pending-1]=~r>>8,_s(o.strm),s&&(s>r&&(s=r),o.strm.output.set(o.window.subarray(o.block_start,o.block_start+s),o.strm.next_out),o.strm.next_out+=s,o.strm.avail_out-=s,o.strm.total_out+=s,o.block_start+=s,r-=s),r&&(tO(o.strm,o.strm.output,o.strm.next_out,r),o.strm.next_out+=r,o.strm.avail_out-=r,o.strm.total_out+=r)}while(0===h);return p-=o.strm.avail_in,p&&(p>=o.w_size?(o.matches=2,o.window.set(o.strm.input.subarray(o.strm.next_in-o.w_size,o.strm.next_in),0),o.strstart=o.w_size,o.insert=o.strstart):(o.window_size-o.strstart<=p&&(o.strstart-=o.w_size,o.window.set(o.window.subarray(o.w_size,o.w_size+o.strstart),0),o.matches<2&&o.matches++,o.insert>o.strstart&&(o.insert=o.strstart)),o.window.set(o.strm.input.subarray(o.strm.next_in-p,o.strm.next_in),o.strstart),o.strstart+=p,o.insert+=p>o.w_size-o.insert?o.w_size-o.insert:p),o.block_start=o.strstart),o.high_water<o.strstart&&(o.high_water=o.strstart),h?4:n!==tl&&n!==qs&&0===o.strm.avail_in&&o.strstart===o.block_start?2:(c=o.window_size-o.strstart,o.strm.avail_in>c&&o.block_start>=o.w_size&&(o.block_start-=o.w_size,o.strstart-=o.w_size,o.window.set(o.window.subarray(o.w_size,o.w_size+o.strstart),0),o.matches<2&&o.matches++,c+=o.w_size,o.insert>o.strstart&&(o.insert=o.strstart)),c>o.strm.avail_in&&(c=o.strm.avail_in),c&&(tO(o.strm,o.window,o.strstart,c),o.strstart+=c,o.insert+=c>o.w_size-o.insert?o.w_size-o.insert:c),o.high_water<o.strstart&&(o.high_water=o.strstart),c=o.bi_valid+42>>3,c=o.pending_buf_size-c>65535?65535:o.pending_buf_size-c,d=c>o.w_size?o.w_size:c,s=o.strstart-o.block_start,(s>=d||(s||n===qs)&&n!==tl&&0===o.strm.avail_in&&s<=c)&&(r=s>c?c:s,h=n===qs&&0===o.strm.avail_in&&r===s?1:0,QD(o,o.block_start,r,h),o.block_start+=r,_s(o.strm)),h?3:1)},iO=(o,n)=>{let r,s;for(;;){if(o.lookahead<fc){if(Xf(o),o.lookahead<fc&&n===tl)return 1;if(0===o.lookahead)break}if(r=0,o.lookahead>=3&&(o.ins_h=kd(o,o.ins_h,o.window[o.strstart+3-1]),r=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),0!==r&&o.strstart-r<=o.w_size-fc&&(o.match_length=nO(o,r)),o.match_length>=3)if(s=el(o,o.strstart-o.match_start,o.match_length-3),o.lookahead-=o.match_length,o.match_length<=o.max_lazy_match&&o.lookahead>=3){o.match_length--;do{o.strstart++,o.ins_h=kd(o,o.ins_h,o.window[o.strstart+3-1]),r=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart}while(0!=--o.match_length);o.strstart++}else o.strstart+=o.match_length,o.match_length=0,o.ins_h=o.window[o.strstart],o.ins_h=kd(o,o.ins_h,o.window[o.strstart+1]);else s=el(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++;if(s&&(gs(o,!1),0===o.strm.avail_out))return 1}return o.insert=o.strstart<2?o.strstart:2,n===qs?(gs(o,!0),0===o.strm.avail_out?3:4):o.sym_next&&(gs(o,!1),0===o.strm.avail_out)?1:2},xd=(o,n)=>{let r,s,c;for(;;){if(o.lookahead<fc){if(Xf(o),o.lookahead<fc&&n===tl)return 1;if(0===o.lookahead)break}if(r=0,o.lookahead>=3&&(o.ins_h=kd(o,o.ins_h,o.window[o.strstart+3-1]),r=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),o.prev_length=o.match_length,o.prev_match=o.match_start,o.match_length=2,0!==r&&o.prev_length<o.max_lazy_match&&o.strstart-r<=o.w_size-fc&&(o.match_length=nO(o,r),o.match_length<=5&&(o.strategy===ME||3===o.match_length&&o.strstart-o.match_start>4096)&&(o.match_length=2)),o.prev_length>=3&&o.match_length<=o.prev_length){c=o.strstart+o.lookahead-3,s=el(o,o.strstart-1-o.prev_match,o.prev_length-3),o.lookahead-=o.prev_length-1,o.prev_length-=2;do{++o.strstart<=c&&(o.ins_h=kd(o,o.ins_h,o.window[o.strstart+3-1]),r=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart)}while(0!=--o.prev_length);if(o.match_available=0,o.match_length=2,o.strstart++,s&&(gs(o,!1),0===o.strm.avail_out))return 1}else if(o.match_available){if(s=el(o,0,o.window[o.strstart-1]),s&&gs(o,!1),o.strstart++,o.lookahead--,0===o.strm.avail_out)return 1}else o.match_available=1,o.strstart++,o.lookahead--}return o.match_available&&(s=el(o,0,o.window[o.strstart-1]),o.match_available=0),o.insert=o.strstart<2?o.strstart:2,n===qs?(gs(o,!0),0===o.strm.avail_out?3:4):o.sym_next&&(gs(o,!1),0===o.strm.avail_out)?1:2};function Oa(o,n,r,s,c){this.good_length=o,this.max_lazy=n,this.nice_length=r,this.max_chain=s,this.func=c}const Jf=[new Oa(0,0,0,0,Bx),new Oa(4,4,8,4,iO),new Oa(4,5,16,8,iO),new Oa(4,6,32,32,iO),new Oa(4,4,16,16,xd),new Oa(8,16,32,32,xd),new Oa(8,16,128,128,xd),new Oa(8,32,128,256,xd),new Oa(32,128,258,1024,xd),new Oa(32,258,258,4096,xd)];function PC(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=xE,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Fx),this.dyn_dtree=new Uint16Array(2*(2*FU+1)),this.bl_tree=new Uint16Array(2*(2*Lx+1)),nl(this.dyn_ltree),nl(this.dyn_dtree),nl(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Ux+1),this.heap=new Uint16Array(2*NC+1),nl(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*NC+1),nl(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const mc=o=>{if(!o)return 1;const n=o.state;return!n||n.strm!==o||42!==n.status&&57!==n.status&&69!==n.status&&73!==n.status&&91!==n.status&&103!==n.status&&113!==n.status&&666!==n.status?1:0},jx=o=>{if(mc(o))return Md(o,Da);o.total_in=o.total_out=0,o.data_type=xx;const n=o.state;return n.pending=0,n.pending_out=0,n.wrap<0&&(n.wrap=-n.wrap),n.status=2===n.wrap?57:n.wrap?42:113,o.adler=2===n.wrap?0:1,n.last_flush=-2,kU(n),Ar},Hx=o=>{const n=jx(o);var r;return n===Ar&&((r=o.state).window_size=2*r.w_size,nl(r.head),r.max_lazy_match=Jf[r.level].max_lazy,r.good_match=Jf[r.level].good_length,r.nice_match=Jf[r.level].nice_length,r.max_chain_length=Jf[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0),n},MC=(o,n,r,s,c,d)=>{if(!o)return Da;let h=1;if(n===Px&&(n=6),s<0?(h=0,s=-s):s>15&&(h=2,s-=16),c<1||c>9||r!==xE||s<8||s>15||n<0||n>9||d<0||d>LU||8===s&&1!==h)return Md(o,Da);8===s&&(s=9);const p=new PC;return o.state=p,p.strm=o,p.status=42,p.wrap=h,p.gzhead=null,p.w_bits=s,p.w_size=1<<p.w_bits,p.w_mask=p.w_size-1,p.hash_bits=c+7,p.hash_size=1<<p.hash_bits,p.hash_mask=p.hash_size-1,p.hash_shift=~~((p.hash_bits+3-1)/3),p.window=new Uint8Array(2*p.w_size),p.head=new Uint16Array(p.hash_size),p.prev=new Uint16Array(p.w_size),p.lit_bufsize=1<<c+6,p.pending_buf_size=4*p.lit_bufsize,p.pending_buf=new Uint8Array(p.pending_buf_size),p.sym_buf=p.lit_bufsize,p.sym_end=3*(p.lit_bufsize-1),p.level=n,p.strategy=d,p.method=r,Hx(o)};var FE={deflateInit:(o,n)=>MC(o,n,xE,15,8,kx),deflateInit2:MC,deflateReset:Hx,deflateResetKeep:jx,deflateSetHeader:(o,n)=>mc(o)||2!==o.state.wrap?Da:(o.state.gzhead=n,Ar),deflate:(o,n)=>{if(mc(o)||n>PE||n<0)return o?Md(o,Da):Da;const r=o.state;if(!o.output||0!==o.avail_in&&!o.input||666===r.status&&n!==qs)return Md(o,0===o.avail_out?Mh:Da);const s=r.last_flush;if(r.last_flush=n,0!==r.pending){if(_s(o),0===o.avail_out)return r.last_flush=-1,Ar}else if(0===o.avail_in&&Vx(n)<=Vx(s)&&n!==qs)return Md(o,Mh);if(666===r.status&&0!==o.avail_in)return Md(o,Mh);if(42===r.status&&0===r.wrap&&(r.status=113),42===r.status){let c=xE+(r.w_bits-8<<4)<<8,d=-1;if(d=r.strategy>=kE||r.level<2?0:r.level<6?1:6===r.level?2:3,c|=d<<6,0!==r.strstart&&(c|=32),c+=31-c%31,LE(r,c),0!==r.strstart&&(LE(r,o.adler>>>16),LE(r,65535&o.adler)),o.adler=1,r.status=113,_s(o),0!==r.pending)return r.last_flush=-1,Ar}if(57===r.status)if(o.adler=0,Tn(r,31),Tn(r,139),Tn(r,8),r.gzhead)Tn(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Tn(r,255&r.gzhead.time),Tn(r,r.gzhead.time>>8&255),Tn(r,r.gzhead.time>>16&255),Tn(r,r.gzhead.time>>24&255),Tn(r,9===r.level?2:r.strategy>=kE||r.level<2?4:0),Tn(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(Tn(r,255&r.gzhead.extra.length),Tn(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(o.adler=or(o.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(Tn(r,0),Tn(r,0),Tn(r,0),Tn(r,0),Tn(r,0),Tn(r,9===r.level?2:r.strategy>=kE||r.level<2?4:0),Tn(r,3),r.status=113,_s(o),0!==r.pending)return r.last_flush=-1,Ar;if(69===r.status){if(r.gzhead.extra){let c=r.pending,d=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+d>r.pending_buf_size;){let p=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+p),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>c&&(o.adler=or(o.adler,r.pending_buf,r.pending-c,c)),r.gzindex+=p,_s(o),0!==r.pending)return r.last_flush=-1,Ar;c=0,d-=p}let h=new Uint8Array(r.gzhead.extra);r.pending_buf.set(h.subarray(r.gzindex,r.gzindex+d),r.pending),r.pending+=d,r.gzhead.hcrc&&r.pending>c&&(o.adler=or(o.adler,r.pending_buf,r.pending-c,c)),r.gzindex=0}r.status=73}if(73===r.status){if(r.gzhead.name){let c,d=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>d&&(o.adler=or(o.adler,r.pending_buf,r.pending-d,d)),_s(o),0!==r.pending)return r.last_flush=-1,Ar;d=0}c=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,Tn(r,c)}while(0!==c);r.gzhead.hcrc&&r.pending>d&&(o.adler=or(o.adler,r.pending_buf,r.pending-d,d)),r.gzindex=0}r.status=91}if(91===r.status){if(r.gzhead.comment){let c,d=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>d&&(o.adler=or(o.adler,r.pending_buf,r.pending-d,d)),_s(o),0!==r.pending)return r.last_flush=-1,Ar;d=0}c=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,Tn(r,c)}while(0!==c);r.gzhead.hcrc&&r.pending>d&&(o.adler=or(o.adler,r.pending_buf,r.pending-d,d))}r.status=103}if(103===r.status){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(_s(o),0!==r.pending))return r.last_flush=-1,Ar;Tn(r,255&o.adler),Tn(r,o.adler>>8&255),o.adler=0}if(r.status=113,_s(o),0!==r.pending)return r.last_flush=-1,Ar}if(0!==o.avail_in||0!==r.lookahead||n!==tl&&666!==r.status){let c=0===r.level?Bx(r,n):r.strategy===kE?((d,h)=>{let p;for(;;){if(0===d.lookahead&&(Xf(d),0===d.lookahead)){if(h===tl)return 1;break}if(d.match_length=0,p=el(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,p&&(gs(d,!1),0===d.strm.avail_out))return 1}return d.insert=0,h===qs?(gs(d,!0),0===d.strm.avail_out?3:4):d.sym_next&&(gs(d,!1),0===d.strm.avail_out)?1:2})(r,n):r.strategy===Mx?((d,h)=>{let p,m,_,g;const v=d.window;for(;;){if(d.lookahead<=258){if(Xf(d),d.lookahead<=258&&h===tl)return 1;if(0===d.lookahead)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(_=d.strstart-1,m=v[_],m===v[++_]&&m===v[++_]&&m===v[++_])){g=d.strstart+258;do{}while(m===v[++_]&&m===v[++_]&&m===v[++_]&&m===v[++_]&&m===v[++_]&&m===v[++_]&&m===v[++_]&&m===v[++_]&&_<g);d.match_length=258-(g-_),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(p=el(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(p=el(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),p&&(gs(d,!1),0===d.strm.avail_out))return 1}return d.insert=0,h===qs?(gs(d,!0),0===d.strm.avail_out?3:4):d.sym_next&&(gs(d,!1),0===d.strm.avail_out)?1:2})(r,n):Jf[r.level].func(r,n);if(3!==c&&4!==c||(r.status=666),1===c||3===c)return 0===o.avail_out&&(r.last_flush=-1),Ar;if(2===c&&(n===xU?ZD(r):n!==PE&&(QD(r,0,0,!1),n===Ox&&(nl(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),_s(o),0===o.avail_out))return r.last_flush=-1,Ar}return n!==qs?Ar:r.wrap<=0?eO:(2===r.wrap?(Tn(r,255&o.adler),Tn(r,o.adler>>8&255),Tn(r,o.adler>>16&255),Tn(r,o.adler>>24&255),Tn(r,255&o.total_in),Tn(r,o.total_in>>8&255),Tn(r,o.total_in>>16&255),Tn(r,o.total_in>>24&255)):(LE(r,o.adler>>>16),LE(r,65535&o.adler)),_s(o),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?Ar:eO)},deflateEnd:o=>{if(mc(o))return Da;const n=o.state.status;return o.state=null,113===n?Md(o,Nx):Ar},deflateSetDictionary:(o,n)=>{let r=n.length;if(mc(o))return Da;const s=o.state,c=s.wrap;if(2===c||1===c&&42!==s.status||s.lookahead)return Da;if(1===c&&(o.adler=qf(o.adler,n,r,0)),s.wrap=0,r>=s.w_size){0===c&&(nl(s.head),s.strstart=0,s.block_start=0,s.insert=0);let m=new Uint8Array(s.w_size);m.set(n.subarray(r-s.w_size,r),0),n=m,r=s.w_size}const d=o.avail_in,h=o.next_in,p=o.input;for(o.avail_in=r,o.next_in=0,o.input=n,Xf(s);s.lookahead>=3;){let m=s.strstart,_=s.lookahead-2;do{s.ins_h=kd(s,s.ins_h,s.window[m+3-1]),s.prev[m&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=m,m++}while(--_);s.strstart=m,s.lookahead=2,Xf(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,o.next_in=h,o.input=p,o.avail_in=d,s.wrap=c,Ar},deflateInfo:"pako deflate (from Nodeca project)"};const Gx=(o,n)=>Object.prototype.hasOwnProperty.call(o,n);var Qf={assign:function(o){const n=Array.prototype.slice.call(arguments,1);for(;n.length;){const r=n.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const s in r)Gx(r,s)&&(o[s]=r[s])}}return o},flattenChunks:o=>{let n=0;for(let s=0,c=o.length;s<c;s++)n+=o[s].length;const r=new Uint8Array(n);for(let s=0,c=0,d=o.length;s<d;s++){let h=o[s];r.set(h,c),c+=h.length}return r}};let Wx=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Wx=!1}const UE=new Uint8Array(256);for(let o=0;o<256;o++)UE[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;UE[254]=UE[254]=1;var VE={string2buf:o=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(o);let n,r,s,c,d,h=o.length,p=0;for(c=0;c<h;c++)r=o.charCodeAt(c),55296==(64512&r)&&c+1<h&&(s=o.charCodeAt(c+1),56320==(64512&s)&&(r=65536+(r-55296<<10)+(s-56320),c++)),p+=r<128?1:r<2048?2:r<65536?3:4;for(n=new Uint8Array(p),d=0,c=0;d<p;c++)r=o.charCodeAt(c),55296==(64512&r)&&c+1<h&&(s=o.charCodeAt(c+1),56320==(64512&s)&&(r=65536+(r-55296<<10)+(s-56320),c++)),r<128?n[d++]=r:r<2048?(n[d++]=192|r>>>6,n[d++]=128|63&r):r<65536?(n[d++]=224|r>>>12,n[d++]=128|r>>>6&63,n[d++]=128|63&r):(n[d++]=240|r>>>18,n[d++]=128|r>>>12&63,n[d++]=128|r>>>6&63,n[d++]=128|63&r);return n},buf2string:(o,n)=>{const r=n||o.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(o.subarray(0,n));let s,c;const d=new Array(2*r);for(c=0,s=0;s<r;){let h=o[s++];if(h<128){d[c++]=h;continue}let p=UE[h];if(p>4)d[c++]=65533,s+=p-1;else{for(h&=2===p?31:3===p?15:7;p>1&&s<r;)h=h<<6|63&o[s++],p--;p>1?d[c++]=65533:h<65536?d[c++]=h:(h-=65536,d[c++]=55296|h>>10&1023,d[c++]=56320|1023&h)}}return((h,p)=>{if(p<65534&&h.subarray&&Wx)return String.fromCharCode.apply(null,h.length===p?h:h.subarray(0,p));let m="";for(let _=0;_<p;_++)m+=String.fromCharCode(h[_]);return m})(d,c)},utf8border:(o,n)=>{(n=n||o.length)>o.length&&(n=o.length);let r=n-1;for(;r>=0&&128==(192&o[r]);)r--;return r<0||0===r?n:r+UE[o[r]]>n?r:n}},zx=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Kx=Object.prototype.toString,{Z_NO_FLUSH:VU,Z_SYNC_FLUSH:BU,Z_FULL_FLUSH:jU,Z_FINISH:HU,Z_OK:kC,Z_STREAM_END:qx,Z_DEFAULT_COMPRESSION:GU,Z_DEFAULT_STRATEGY:Yx,Z_DEFLATED:$x}=Yf;function BE(o){this.options=Qf.assign({level:GU,method:$x,chunkSize:16384,windowBits:15,memLevel:8,strategy:Yx},o||{});let n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zx,this.strm.avail_out=0;let r=FE.deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(r!==kC)throw new Error(Ph[r]);if(n.header&&FE.deflateSetHeader(this.strm,n.header),n.dictionary){let s;if(s="string"==typeof n.dictionary?VE.string2buf(n.dictionary):"[object ArrayBuffer]"===Kx.call(n.dictionary)?new Uint8Array(n.dictionary):n.dictionary,r=FE.deflateSetDictionary(this.strm,s),r!==kC)throw new Error(Ph[r]);this._dict_set=!0}}function oO(o,n){const r=new BE(n);if(r.push(o,!0),r.err)throw r.msg||Ph[r.err];return r.result}BE.prototype.push=function(o,n){const r=this.strm,s=this.options.chunkSize;let c,d;if(this.ended)return!1;for(d=n===~~n?n:!0===n?HU:VU,r.input="string"==typeof o?VE.string2buf(o):"[object ArrayBuffer]"===Kx.call(o)?new Uint8Array(o):o,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(s),r.next_out=0,r.avail_out=s),(d===BU||d===jU)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(c=FE.deflate(r,d),c===qx)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),c=FE.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===kC;if(0!==r.avail_out){if(d>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},BE.prototype.onData=function(o){this.chunks.push(o)},BE.prototype.onEnd=function(o){o===kC&&(this.result=Qf.flattenChunks(this.chunks)),this.chunks=[],this.err=o,this.msg=this.strm.msg};var WU={Deflate:BE,deflate:oO,deflateRaw:function(o,n){return(n=n||{}).raw=!0,oO(o,n)},gzip:function(o,n){return(n=n||{}).gzip=!0,oO(o,n)},constants:Yf};const xC=16209;var zU=function(o,n){let r,s,c,d,h,p,m,_,g,v,b,C,N,P,D,k,V,U,Y,oe,K,X,$,J;const ve=o.state;r=o.next_in,$=o.input,s=r+(o.avail_in-5),c=o.next_out,J=o.output,d=c-(n-o.avail_out),h=c+(o.avail_out-257),p=ve.dmax,m=ve.wsize,_=ve.whave,g=ve.wnext,v=ve.window,b=ve.hold,C=ve.bits,N=ve.lencode,P=ve.distcode,D=(1<<ve.lenbits)-1,k=(1<<ve.distbits)-1;e:do{C<15&&(b+=$[r++]<<C,C+=8,b+=$[r++]<<C,C+=8),V=N[b&D];t:for(;;){if(U=V>>>24,b>>>=U,C-=U,U=V>>>16&255,0===U)J[c++]=65535&V;else{if(!(16&U)){if(!(64&U)){V=N[(65535&V)+(b&(1<<U)-1)];continue t}if(32&U){ve.mode=16191;break e}o.msg="invalid literal/length code",ve.mode=xC;break e}Y=65535&V,U&=15,U&&(C<U&&(b+=$[r++]<<C,C+=8),Y+=b&(1<<U)-1,b>>>=U,C-=U),C<15&&(b+=$[r++]<<C,C+=8,b+=$[r++]<<C,C+=8),V=P[b&k];n:for(;;){if(U=V>>>24,b>>>=U,C-=U,U=V>>>16&255,!(16&U)){if(!(64&U)){V=P[(65535&V)+(b&(1<<U)-1)];continue n}o.msg="invalid distance code",ve.mode=xC;break e}if(oe=65535&V,U&=15,C<U&&(b+=$[r++]<<C,C+=8,C<U&&(b+=$[r++]<<C,C+=8)),oe+=b&(1<<U)-1,oe>p){o.msg="invalid distance too far back",ve.mode=xC;break e}if(b>>>=U,C-=U,U=c-d,oe>U){if(U=oe-U,U>_&&ve.sane){o.msg="invalid distance too far back",ve.mode=xC;break e}if(K=0,X=v,0===g){if(K+=m-U,U<Y){Y-=U;do{J[c++]=v[K++]}while(--U);K=c-oe,X=J}}else if(g<U){if(K+=m+g-U,U-=g,U<Y){Y-=U;do{J[c++]=v[K++]}while(--U);if(K=0,g<Y){U=g,Y-=U;do{J[c++]=v[K++]}while(--U);K=c-oe,X=J}}}else if(K+=g-U,U<Y){Y-=U;do{J[c++]=v[K++]}while(--U);K=c-oe,X=J}for(;Y>2;)J[c++]=X[K++],J[c++]=X[K++],J[c++]=X[K++],Y-=3;Y&&(J[c++]=X[K++],Y>1&&(J[c++]=X[K++]))}else{K=c-oe;do{J[c++]=J[K++],J[c++]=J[K++],J[c++]=J[K++],Y-=3}while(Y>2);Y&&(J[c++]=J[K++],Y>1&&(J[c++]=J[K++]))}break}}break}}while(r<s&&c<h);Y=C>>3,r-=Y,C-=Y<<3,b&=(1<<C)-1,o.next_in=r,o.next_out=c,o.avail_in=r<s?s-r+5:5-(r-s),o.avail_out=c<h?h-c+257:257-(c-h),ve.hold=b,ve.bits=C};const KU=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),qU=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),YU=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),$U=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Zf=(o,n,r,s,c,d,h,p)=>{const m=p.bits;let _,g,v,b,C,N,P=0,D=0,k=0,V=0,U=0,Y=0,oe=0,K=0,X=0,$=0,J=null;const ve=new Uint16Array(16),ye=new Uint16Array(16);let Ye,ut,yt,lt=null;for(P=0;P<=15;P++)ve[P]=0;for(D=0;D<s;D++)ve[n[r+D]]++;for(U=m,V=15;V>=1&&0===ve[V];V--);if(U>V&&(U=V),0===V)return c[d++]=20971520,c[d++]=20971520,p.bits=1,0;for(k=1;k<V&&0===ve[k];k++);for(U<k&&(U=k),K=1,P=1;P<=15;P++)if(K<<=1,K-=ve[P],K<0)return-1;if(K>0&&(0===o||1!==V))return-1;for(ye[1]=0,P=1;P<15;P++)ye[P+1]=ye[P]+ve[P];for(D=0;D<s;D++)0!==n[r+D]&&(h[ye[n[r+D]]++]=D);if(0===o?(J=lt=h,N=20):1===o?(J=KU,lt=qU,N=257):(J=YU,lt=$U,N=0),$=0,D=0,P=k,C=d,Y=U,oe=0,v=-1,X=1<<U,b=X-1,1===o&&X>852||2===o&&X>592)return 1;for(;;){Ye=P-oe,h[D]+1<N?(ut=0,yt=h[D]):h[D]>=N?(ut=lt[h[D]-N],yt=J[h[D]-N]):(ut=96,yt=0),_=1<<P-oe,g=1<<Y,k=g;do{g-=_,c[C+($>>oe)+g]=Ye<<24|ut<<16|yt|0}while(0!==g);for(_=1<<P-1;$&_;)_>>=1;if(0!==_?($&=_-1,$+=_):$=0,D++,0==--ve[P]){if(P===V)break;P=n[r+h[D]]}if(P>U&&($&b)!==v){for(0===oe&&(oe=U),C+=k,Y=P-oe,K=1<<Y;Y+oe<V&&(K-=ve[Y+oe],!(K<=0));)Y++,K<<=1;if(X+=1<<Y,1===o&&X>852||2===o&&X>592)return 1;v=$&b,c[v]=U<<24|Y<<16|C-d|0}}return 0!==$&&(c[C+$]=P-oe<<24|64<<16|0),p.bits=U,0};const{Z_FINISH:jE,Z_BLOCK:em,Z_TREES:HE,Z_OK:Na,Z_STREAM_END:Xx,Z_NEED_DICT:sO,Z_STREAM_ERROR:Es,Z_DATA_ERROR:aO,Z_MEM_ERROR:cO,Z_BUF_ERROR:Jx,Z_DEFLATED:tm}=Yf,Ld=16180,nm=16190,Pa=16191,xh=16199,rm=16200,ri=16209,lO=o=>(o>>>24&255)+(o>>>8&65280)+((65280&o)<<8)+((255&o)<<24);function Qx(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const il=o=>{if(!o)return 1;const n=o.state;return!n||n.strm!==o||n.mode<Ld||n.mode>16211?1:0},dO=o=>{if(il(o))return Es;const n=o.state;return o.total_in=o.total_out=n.total=0,o.msg="",n.wrap&&(o.adler=1&n.wrap),n.mode=Ld,n.last=0,n.havedict=0,n.flags=-1,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(852),n.distcode=n.distdyn=new Int32Array(592),n.sane=1,n.back=-1,Na},uO=o=>{if(il(o))return Es;const n=o.state;return n.wsize=0,n.whave=0,n.wnext=0,dO(o)},FC=(o,n)=>{let r;if(il(o))return Es;const s=o.state;return n<0?(r=0,n=-n):(r=5+(n>>4),n<48&&(n&=15)),n&&(n<8||n>15)?Es:(null!==s.window&&s.wbits!==n&&(s.window=null),s.wrap=r,s.wbits=n,uO(o))},UC=(o,n)=>{if(!o)return Es;const r=new Qx;o.state=r,r.strm=o,r.window=null,r.mode=Ld;const s=FC(o,n);return s!==Na&&(o.state=null),s};let Lh,om,hO=!0;const pO=o=>{if(hO){Lh=new Int32Array(512),om=new Int32Array(32);let n=0;for(;n<144;)o.lens[n++]=8;for(;n<256;)o.lens[n++]=9;for(;n<280;)o.lens[n++]=7;for(;n<288;)o.lens[n++]=8;for(Zf(1,o.lens,0,288,Lh,0,o.work,{bits:9}),n=0;n<32;)o.lens[n++]=5;Zf(2,o.lens,0,32,om,0,o.work,{bits:5}),hO=!1}o.lencode=Lh,o.lenbits=9,o.distcode=om,o.distbits=5},VC=(o,n,r,s)=>{let c;const d=o.state;return null===d.window&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),s>=d.wsize?(d.window.set(n.subarray(r-d.wsize,r),0),d.wnext=0,d.whave=d.wsize):(c=d.wsize-d.wnext,c>s&&(c=s),d.window.set(n.subarray(r-s,r-s+c),d.wnext),(s-=c)?(d.window.set(n.subarray(r-s,r),0),d.wnext=s,d.whave=d.wsize):(d.wnext+=c,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=c))),0};var Ys={inflateReset:uO,inflateReset2:FC,inflateResetKeep:dO,inflateInit:o=>UC(o,15),inflateInit2:UC,inflate:(o,n)=>{let r,s,c,d,h,p,m,_,g,v,b,C,N,P,D,k,V,U,Y,oe,K,X,$=0;const J=new Uint8Array(4);let ve,ye;const Ye=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(il(o)||!o.output||!o.input&&0!==o.avail_in)return Es;r=o.state,r.mode===Pa&&(r.mode=16192),h=o.next_out,c=o.output,m=o.avail_out,d=o.next_in,s=o.input,p=o.avail_in,_=r.hold,g=r.bits,v=p,b=m,X=Na;e:for(;;)switch(r.mode){case Ld:if(0===r.wrap){r.mode=16192;break}for(;g<16;){if(0===p)break e;p--,_+=s[d++]<<g,g+=8}if(2&r.wrap&&35615===_){0===r.wbits&&(r.wbits=15),r.check=0,J[0]=255&_,J[1]=_>>>8&255,r.check=or(r.check,J,2,0),_=0,g=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&_)<<8)+(_>>8))%31){o.msg="incorrect header check",r.mode=ri;break}if((15&_)!==tm){o.msg="unknown compression method",r.mode=ri;break}if(_>>>=4,g-=4,K=8+(15&_),0===r.wbits&&(r.wbits=K),K>15||K>r.wbits){o.msg="invalid window size",r.mode=ri;break}r.dmax=1<<r.wbits,r.flags=0,o.adler=r.check=1,r.mode=512&_?16189:Pa,_=0,g=0;break;case 16181:for(;g<16;){if(0===p)break e;p--,_+=s[d++]<<g,g+=8}if(r.flags=_,(255&r.flags)!==tm){o.msg="unknown compression method",r.mode=ri;break}if(57344&r.flags){o.msg="unknown header flags set",r.mode=ri;break}r.head&&(r.head.text=_>>8&1),512&r.flags&&4&r.wrap&&(J[0]=255&_,J[1]=_>>>8&255,r.check=or(r.check,J,2,0)),_=0,g=0,r.mode=16182;case 16182:for(;g<32;){if(0===p)break e;p--,_+=s[d++]<<g,g+=8}r.head&&(r.head.time=_),512&r.flags&&4&r.wrap&&(J[0]=255&_,J[1]=_>>>8&255,J[2]=_>>>16&255,J[3]=_>>>24&255,r.check=or(r.check,J,4,0)),_=0,g=0,r.mode=16183;case 16183:for(;g<16;){if(0===p)break e;p--,_+=s[d++]<<g,g+=8}r.head&&(r.head.xflags=255&_,r.head.os=_>>8),512&r.flags&&4&r.wrap&&(J[0]=255&_,J[1]=_>>>8&255,r.check=or(r.check,J,2,0)),_=0,g=0,r.mode=16184;case 16184:if(1024&r.flags){for(;g<16;){if(0===p)break e;p--,_+=s[d++]<<g,g+=8}r.length=_,r.head&&(r.head.extra_len=_),512&r.flags&&4&r.wrap&&(J[0]=255&_,J[1]=_>>>8&255,r.check=or(r.check,J,2,0)),_=0,g=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&r.flags&&(C=r.length,C>p&&(C=p),C&&(r.head&&(K=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(s.subarray(d,d+C),K)),512&r.flags&&4&r.wrap&&(r.check=or(r.check,s,C,d)),p-=C,d+=C,r.length-=C),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&r.flags){if(0===p)break e;C=0;do{K=s[d+C++],r.head&&K&&r.length<65536&&(r.head.name+=String.fromCharCode(K))}while(K&&C<p);if(512&r.flags&&4&r.wrap&&(r.check=or(r.check,s,C,d)),p-=C,d+=C,K)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&r.flags){if(0===p)break e;C=0;do{K=s[d+C++],r.head&&K&&r.length<65536&&(r.head.comment+=String.fromCharCode(K))}while(K&&C<p);if(512&r.flags&&4&r.wrap&&(r.check=or(r.check,s,C,d)),p-=C,d+=C,K)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&r.flags){for(;g<16;){if(0===p)break e;p--,_+=s[d++]<<g,g+=8}if(4&r.wrap&&_!==(65535&r.check)){o.msg="header crc mismatch",r.mode=ri;break}_=0,g=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),o.adler=r.check=0,r.mode=Pa;break;case 16189:for(;g<32;){if(0===p)break e;p--,_+=s[d++]<<g,g+=8}o.adler=r.check=lO(_),_=0,g=0,r.mode=nm;case nm:if(0===r.havedict)return o.next_out=h,o.avail_out=m,o.next_in=d,o.avail_in=p,r.hold=_,r.bits=g,sO;o.adler=r.check=1,r.mode=Pa;case Pa:if(n===em||n===HE)break e;case 16192:if(r.last){_>>>=7&g,g-=7&g,r.mode=16206;break}for(;g<3;){if(0===p)break e;p--,_+=s[d++]<<g,g+=8}switch(r.last=1&_,_>>>=1,g-=1,3&_){case 0:r.mode=16193;break;case 1:if(pO(r),r.mode=xh,n===HE){_>>>=2,g-=2;break e}break;case 2:r.mode=16196;break;case 3:o.msg="invalid block type",r.mode=ri}_>>>=2,g-=2;break;case 16193:for(_>>>=7&g,g-=7&g;g<32;){if(0===p)break e;p--,_+=s[d++]<<g,g+=8}if((65535&_)!=(_>>>16^65535)){o.msg="invalid stored block lengths",r.mode=ri;break}if(r.length=65535&_,_=0,g=0,r.mode=16194,n===HE)break e;case 16194:r.mode=16195;case 16195:if(C=r.length,C){if(C>p&&(C=p),C>m&&(C=m),0===C)break e;c.set(s.subarray(d,d+C),h),p-=C,d+=C,m-=C,h+=C,r.length-=C;break}r.mode=Pa;break;case 16196:for(;g<14;){if(0===p)break e;p--,_+=s[d++]<<g,g+=8}if(r.nlen=257+(31&_),_>>>=5,g-=5,r.ndist=1+(31&_),_>>>=5,g-=5,r.ncode=4+(15&_),_>>>=4,g-=4,r.nlen>286||r.ndist>30){o.msg="too many length or distance symbols",r.mode=ri;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;g<3;){if(0===p)break e;p--,_+=s[d++]<<g,g+=8}r.lens[Ye[r.have++]]=7&_,_>>>=3,g-=3}for(;r.have<19;)r.lens[Ye[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,ve={bits:r.lenbits},X=Zf(0,r.lens,0,19,r.lencode,0,r.work,ve),r.lenbits=ve.bits,X){o.msg="invalid code lengths set",r.mode=ri;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;$=r.lencode[_&(1<<r.lenbits)-1],D=$>>>24,k=$>>>16&255,V=65535&$,!(D<=g);){if(0===p)break e;p--,_+=s[d++]<<g,g+=8}if(V<16)_>>>=D,g-=D,r.lens[r.have++]=V;else{if(16===V){for(ye=D+2;g<ye;){if(0===p)break e;p--,_+=s[d++]<<g,g+=8}if(_>>>=D,g-=D,0===r.have){o.msg="invalid bit length repeat",r.mode=ri;break}K=r.lens[r.have-1],C=3+(3&_),_>>>=2,g-=2}else if(17===V){for(ye=D+3;g<ye;){if(0===p)break e;p--,_+=s[d++]<<g,g+=8}_>>>=D,g-=D,K=0,C=3+(7&_),_>>>=3,g-=3}else{for(ye=D+7;g<ye;){if(0===p)break e;p--,_+=s[d++]<<g,g+=8}_>>>=D,g-=D,K=0,C=11+(127&_),_>>>=7,g-=7}if(r.have+C>r.nlen+r.ndist){o.msg="invalid bit length repeat",r.mode=ri;break}for(;C--;)r.lens[r.have++]=K}}if(r.mode===ri)break;if(0===r.lens[256]){o.msg="invalid code -- missing end-of-block",r.mode=ri;break}if(r.lenbits=9,ve={bits:r.lenbits},X=Zf(1,r.lens,0,r.nlen,r.lencode,0,r.work,ve),r.lenbits=ve.bits,X){o.msg="invalid literal/lengths set",r.mode=ri;break}if(r.distbits=6,r.distcode=r.distdyn,ve={bits:r.distbits},X=Zf(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,ve),r.distbits=ve.bits,X){o.msg="invalid distances set",r.mode=ri;break}if(r.mode=xh,n===HE)break e;case xh:r.mode=rm;case rm:if(p>=6&&m>=258){o.next_out=h,o.avail_out=m,o.next_in=d,o.avail_in=p,r.hold=_,r.bits=g,zU(o,b),h=o.next_out,c=o.output,m=o.avail_out,d=o.next_in,s=o.input,p=o.avail_in,_=r.hold,g=r.bits,r.mode===Pa&&(r.back=-1);break}for(r.back=0;$=r.lencode[_&(1<<r.lenbits)-1],D=$>>>24,k=$>>>16&255,V=65535&$,!(D<=g);){if(0===p)break e;p--,_+=s[d++]<<g,g+=8}if(k&&!(240&k)){for(U=D,Y=k,oe=V;$=r.lencode[oe+((_&(1<<U+Y)-1)>>U)],D=$>>>24,k=$>>>16&255,V=65535&$,!(U+D<=g);){if(0===p)break e;p--,_+=s[d++]<<g,g+=8}_>>>=U,g-=U,r.back+=U}if(_>>>=D,g-=D,r.back+=D,r.length=V,0===k){r.mode=16205;break}if(32&k){r.back=-1,r.mode=Pa;break}if(64&k){o.msg="invalid literal/length code",r.mode=ri;break}r.extra=15&k,r.mode=16201;case 16201:if(r.extra){for(ye=r.extra;g<ye;){if(0===p)break e;p--,_+=s[d++]<<g,g+=8}r.length+=_&(1<<r.extra)-1,_>>>=r.extra,g-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;$=r.distcode[_&(1<<r.distbits)-1],D=$>>>24,k=$>>>16&255,V=65535&$,!(D<=g);){if(0===p)break e;p--,_+=s[d++]<<g,g+=8}if(!(240&k)){for(U=D,Y=k,oe=V;$=r.distcode[oe+((_&(1<<U+Y)-1)>>U)],D=$>>>24,k=$>>>16&255,V=65535&$,!(U+D<=g);){if(0===p)break e;p--,_+=s[d++]<<g,g+=8}_>>>=U,g-=U,r.back+=U}if(_>>>=D,g-=D,r.back+=D,64&k){o.msg="invalid distance code",r.mode=ri;break}r.offset=V,r.extra=15&k,r.mode=16203;case 16203:if(r.extra){for(ye=r.extra;g<ye;){if(0===p)break e;p--,_+=s[d++]<<g,g+=8}r.offset+=_&(1<<r.extra)-1,_>>>=r.extra,g-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){o.msg="invalid distance too far back",r.mode=ri;break}r.mode=16204;case 16204:if(0===m)break e;if(C=b-m,r.offset>C){if(C=r.offset-C,C>r.whave&&r.sane){o.msg="invalid distance too far back",r.mode=ri;break}C>r.wnext?(C-=r.wnext,N=r.wsize-C):N=r.wnext-C,C>r.length&&(C=r.length),P=r.window}else P=c,N=h-r.offset,C=r.length;C>m&&(C=m),m-=C,r.length-=C;do{c[h++]=P[N++]}while(--C);0===r.length&&(r.mode=rm);break;case 16205:if(0===m)break e;c[h++]=r.length,m--,r.mode=rm;break;case 16206:if(r.wrap){for(;g<32;){if(0===p)break e;p--,_|=s[d++]<<g,g+=8}if(b-=m,o.total_out+=b,r.total+=b,4&r.wrap&&b&&(o.adler=r.check=r.flags?or(r.check,c,b,h-b):qf(r.check,c,b,h-b)),b=m,4&r.wrap&&(r.flags?_:lO(_))!==r.check){o.msg="incorrect data check",r.mode=ri;break}_=0,g=0}r.mode=16207;case 16207:if(r.wrap&&r.flags){for(;g<32;){if(0===p)break e;p--,_+=s[d++]<<g,g+=8}if(4&r.wrap&&_!==(4294967295&r.total)){o.msg="incorrect length check",r.mode=ri;break}_=0,g=0}r.mode=16208;case 16208:X=Xx;break e;case ri:X=aO;break e;case 16210:return cO;default:return Es}return o.next_out=h,o.avail_out=m,o.next_in=d,o.avail_in=p,r.hold=_,r.bits=g,(r.wsize||b!==o.avail_out&&r.mode<ri&&(r.mode<16206||n!==jE))&&VC(o,o.output,o.next_out,b-o.avail_out),v-=o.avail_in,b-=o.avail_out,o.total_in+=v,o.total_out+=b,r.total+=b,4&r.wrap&&b&&(o.adler=r.check=r.flags?or(r.check,c,b,o.next_out-b):qf(r.check,c,b,o.next_out-b)),o.data_type=r.bits+(r.last?64:0)+(r.mode===Pa?128:0)+(r.mode===xh||16194===r.mode?256:0),(0===v&&0===b||n===jE)&&X===Na&&(X=Jx),X},inflateEnd:o=>{if(il(o))return Es;let n=o.state;return n.window&&(n.window=null),o.state=null,Na},inflateGetHeader:(o,n)=>{if(il(o))return Es;const r=o.state;return 2&r.wrap?(r.head=n,n.done=!1,Na):Es},inflateSetDictionary:(o,n)=>{const r=n.length;let s,c,d;return il(o)?Es:(s=o.state,0!==s.wrap&&s.mode!==nm?Es:s.mode===nm&&(c=1,c=qf(c,n,r,0),c!==s.check)?aO:(d=VC(o,n,r,r),d?(s.mode=16210,cO):(s.havedict=1,Na)))},inflateInfo:"pako inflate (from Nodeca project)"},fO=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const mO=Object.prototype.toString,{Z_NO_FLUSH:_O,Z_FINISH:eL,Z_OK:sm,Z_STREAM_END:BC,Z_NEED_DICT:am,Z_STREAM_ERROR:XU,Z_DATA_ERROR:tL,Z_MEM_ERROR:gO}=Yf;function WE(o){this.options=Qf.assign({chunkSize:65536,windowBits:15,to:""},o||{});const n=this.options;n.raw&&n.windowBits>=0&&n.windowBits<16&&(n.windowBits=-n.windowBits,0===n.windowBits&&(n.windowBits=-15)),!(n.windowBits>=0&&n.windowBits<16)||o&&o.windowBits||(n.windowBits+=32),n.windowBits>15&&n.windowBits<48&&!(15&n.windowBits)&&(n.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zx,this.strm.avail_out=0;let r=Ys.inflateInit2(this.strm,n.windowBits);if(r!==sm)throw new Error(Ph[r]);if(this.header=new fO,Ys.inflateGetHeader(this.strm,this.header),n.dictionary&&("string"==typeof n.dictionary?n.dictionary=VE.string2buf(n.dictionary):"[object ArrayBuffer]"===mO.call(n.dictionary)&&(n.dictionary=new Uint8Array(n.dictionary)),n.raw&&(r=Ys.inflateSetDictionary(this.strm,n.dictionary),r!==sm)))throw new Error(Ph[r])}function jC(o,n){const r=new WE(n);if(r.push(o),r.err)throw r.msg||Ph[r.err];return r.result}WE.prototype.push=function(o,n){const r=this.strm,s=this.options.chunkSize,c=this.options.dictionary;let d,h,p;if(this.ended)return!1;for(h=n===~~n?n:!0===n?eL:_O,r.input="[object ArrayBuffer]"===mO.call(o)?new Uint8Array(o):o,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(s),r.next_out=0,r.avail_out=s),d=Ys.inflate(r,h),d===am&&c&&(d=Ys.inflateSetDictionary(r,c),d===sm?d=Ys.inflate(r,h):d===tL&&(d=am));r.avail_in>0&&d===BC&&r.state.wrap>0&&0!==o[r.next_in];)Ys.inflateReset(r),d=Ys.inflate(r,h);switch(d){case XU:case tL:case am:case gO:return this.onEnd(d),this.ended=!0,!1}if(p=r.avail_out,r.next_out&&(0===r.avail_out||d===BC))if("string"===this.options.to){let m=VE.utf8border(r.output,r.next_out),_=r.next_out-m,g=VE.buf2string(r.output,m);r.next_out=_,r.avail_out=s-_,_&&r.output.set(r.output.subarray(m,m+_),0),this.onData(g)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(d!==sm||0!==p){if(d===BC)return d=Ys.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},WE.prototype.onData=function(o){this.chunks.push(o)},WE.prototype.onEnd=function(o){o===sm&&(this.result="string"===this.options.to?this.chunks.join(""):Qf.flattenChunks(this.chunks)),this.chunks=[],this.err=o,this.msg=this.strm.msg};var nL={Inflate:WE,inflate:jC,inflateRaw:function(o,n){return(n=n||{}).raw=!0,jC(o,n)},ungzip:jC,constants:Yf};const{deflate:EO}=WU,{inflate:vO}=nL;var HC,ZU=EO,sL=vO;!function(o){o[o.ONE_BYTE=0]="ONE_BYTE",o[o.TWO_BYTE=1]="TWO_BYTE"}(HC||(HC={}));class yO{constructor(){S(this,"_sequence",0),S(this,"_startTime",Date.now()),S(this,"isUseOneByte",!0)}get startTime(){const n=Date.now()-this._startTime;return n<Math.pow(2,16)?n:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(n){const r={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:n};if(n.byteLength>128){const p=new Uint8Array(4);p.set([1,0,0,0]);const _={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[{id:0,length:4,data:p.buffer}]};r.commonPacketHeader.extension=1,r.extension=_,r.payload=this.compress(n),r.commonPacketHeader.length=8+(r.extension.length+2)+r.payload.byteLength}else r.commonPacketHeader.length=8+r.payload.byteLength;const s=new ArrayBuffer(r.commonPacketHeader.length),c=new Uint8Array(s),d=new DataView(s);let h=0;if(d.setUint16(h,r.commonPacketHeader.extension<<15|r.commonPacketHeader.reserved<<14|r.commonPacketHeader.length,!0),h+=2,d.setUint32(h,r.commonPacketHeader.sequence,!0),h+=4,d.setUint16(h,r.commonStreamHeader,!0),h+=2,r.extension){const p=this.serializeExtension(r.extension);c.set(new Uint8Array(p),h),h+=p.byteLength}if(c.set(new Uint8Array(r.payload),h),h+=r.payload.byteLength,h!==r.commonPacketHeader.length)throw Error("serialize error!");return s}deserialize(n){if(n.byteLength<4)return new ArrayBuffer(0);const r=new DataView(n);let s=0;const c=r.getUint16(s,!0);s+=2;const d=(32768&c)>>15;let h,p;if(r.getUint16(s+2,!0),r.getUint16(s,!0),s+=4,r.getUint16(s,!0),s+=2,d){p=this.deserializeExtension(n.slice(s)),s+=2+p.length,h=n.slice(s);let m=!1;if(p.datas.length>0){const _=p.datas.find(g=>0===g.id);_&&(m=1==(1&new DataView(_.data).getUint32(0,!0)))}h=m?this.decompress(h):h}else h=n.slice(8);return h}serializeExtension(n){const{profile:r,length:s,datas:c}=n,d=new ArrayBuffer(s+2),h=new Uint8Array(d),p=new DataView(d);let m=0;if(p.setUint8(m++,r),p.setUint8(m++,s),c.forEach(_=>{r?(p.setUint8(m++,_.id),p.setUint8(m++,_.length),h.set(new Uint8Array(_.data),m),m+=_.data.byteLength):(p.setUint8(m++,_.id|_.length<<4),h.set(new Uint8Array(_.data),m),m+=_.data.byteLength)}),m!==s+2)throw Error("serialize extension error, is ".concat(m,"!==").concat(s+2));return d}deserializeExtension(n){const r=new DataView(n);let s=0;const c=r.getUint8(s);s++;const d=r.getUint8(s);s++;const h=c===HC.TWO_BYTE,p=[],m=new DataView(n,2);let _=0;for(;_<d;){let g=0,v=0,b=new ArrayBuffer(0);h?(g=m.getUint8(_),_++,v=m.getUint8(_),_++):(g=15&m.getUint8(_),v=m.getUint8(_)>>4,_++),v>0&&(b=m.buffer.slice(_+2,_+2+v),_+=b.byteLength),p.push({id:g,length:v,data:b})}if(_!==d)throw Error("parse error");return{profile:c,length:d,datas:p}}decompress(n){return sL(new Uint8Array(n))}compress(n){return ZU(new Uint8Array(n))}}class GC extends Yt{constructor(n,r){super(),S(this,"_version",1),S(this,"_type",3),S(this,"_config",void 0),S(this,"_originDataChannel",void 0),S(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),S(this,"_dataStreamPacketHandler",void 0),S(this,"_datachannelEventMap",new Map),this._config=n,r&&(this._originDataChannel=r,this._bandDataChannelEvents(r)),this._initPacketHeader(),this._dataStreamPacketHandler=new yO}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return B("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var n,r;return null!==(n=null===(r=this._originDataChannel)||void 0===r?void 0:r.readyState)&&void 0!==n?n:"connecting"}get _originDataChannelId(){var n,r;return null!==(n=null===(r=this._originDataChannel)||void 0===r?void 0:r.id)&&void 0!==n?n:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}_waitTillOpen(){var n=this;return x(function*(){return new z((r,s)=>{if(n._originDataChannel){"open"===n._originDataChannel.readyState&&r();const c=setTimeout(()=>{var d;s(new Q(M.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(d=n._originDataChannel)||void 0===d?void 0:d.id)))},1e4);n._originDataChannel.onopen=()=>{clearTimeout(c),n._originDataChannel&&n._bandDataChannelEvents(n._originDataChannel),r()},n._originDataChannel.onerror=()=>{throw clearTimeout(c),new Q(M.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new Q(M.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})})()}_updateOriginDataChannel(n){this._originDataChannel=n,this._bandDataChannelEvents(n)}_initPacketHeader(){const n=new DataView(this._dataStreamPacketHeader);n.setUint16(0,this._version),n.setUint8(2,this._type),n.setUint8(3,this._config.id)}_bandDataChannelEvents(n){this._unbindDataChannelEvents(n),[Th.OPEN,Th.CLOSE,Th.ERROR].forEach(r=>{const s=()=>{this.emit(r)};this._datachannelEventMap.set(r,s),n.addEventListener(r,s)})}_unbindDataChannelEvents(n){Array.from(this._datachannelEventMap.entries()).forEach(r=>{let[s,c]=r;n.removeEventListener(s,c)}),this._datachannelEventMap.clear()}}class rl extends GC{constructor(n){super(n),S(this,"_messageListener",void 0),this._messageListener=r=>{if(r.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const s=r.data.slice(0,this._dataStreamPacketHeader.byteLength);if(new DataView(s).getUint8(3)!==this.id)return;let c=r.data.slice(this._dataStreamPacketHeader.byteLength);c=this._dataStreamPacketHandler.deserialize(c),this.emit(Th.MESSAGE,c)}}_updateOriginDataChannel(n){super._updateOriginDataChannel(n),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class bO extends GC{send(n){if(this._originDataChannel){let r=n;r=this._dataStreamPacketHandler.serialize(n);const s=new Uint8Array(this._dataStreamPacketHeader.byteLength+r.byteLength);s.set(new Uint8Array(this._dataStreamPacketHeader),0),s.set(new Uint8Array(r),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(s.buffer)}}}class aL extends Yt{constructor(){super(...arguments),S(this,"resultStorage",new Map)}setLocalAudioStats(n,r,s){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",n,this.checkAudioInputLevel(s,r)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",n,this.checkSendAudioBitrate(s,r))}setLocalVideoStats(n,r,s){this.record("SEND_VIDEO_BITRATE_TOO_LOW",n,this.checkSendVideoBitrate(s,r)),this.record("FRAMERATE_INPUT_TOO_LOW",n,this.checkFramerateInput(s,r)),this.record("FRAMERATE_SENT_TOO_LOW",n,this.checkFramerateSent(s))}setRemoteAudioStats(n,r){const s=n.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",s,this.checkAudioOutputLevel(r))}setRemoteVideoStats(n,r){const s=n.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",s,this.checkVideoDecode(r))}record(n,r,s){if(B("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(n)||this.resultStorage.set(n,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(n);if(c&&(c.result.push(s),c.result.length>=5)){var d;const h=Re(d=c.result).call(d,!0);c.isPrevNormal&&!h&&this.emit("exception",zE[n],n,r),!c.isPrevNormal&&h&&this.emit("exception",zE[n]+2e3,n+"_RECOVER",r),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(n){return!(n.receiveBitrate>0&&0===n.receiveLevel)}checkAudioInputLevel(n,r){return r instanceof Dn&&!r.isActive||!!r.muted||0!==n.sendVolumeLevel}checkFramerateInput(n,r){let s=null;r._encoderConfig&&r._encoderConfig.frameRate&&(s=Bo(r._encoderConfig.frameRate));const c=n.captureFrameRate;return!s||!c||!(s>10&&c<5||s<10&&s>=5&&c<=1)}checkFramerateSent(n){return!(n.captureFrameRate&&n.sendFrameRate&&n.captureFrameRate>5&&n.sendFrameRate<=1)}checkSendVideoBitrate(n,r){return!!r.muted||0!==n.sendBitrate}checkSendAudioBitrate(n,r){return r instanceof Dn&&!r.isActive||!!r.muted||0!==n.sendBitrate}checkVideoDecode(n){return 0===n.receiveBitrate||0!==n.decodeFrameRate}}const zE={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},vi=new class{markSubscribeStart(o,n){performance.mark("agora-web-sdk/".concat(o,"/subscribe-").concat(n))}markPublishStart(o,n){performance.mark("agora-web-sdk/".concat(o,"/publish-").concat(n))}measureFromSubscribeStart(o,n){const r=performance.getEntriesByName("agora-web-sdk/".concat(o,"/subscribe-").concat(n));if(r.length>0){const s=r[r.length-1];return Math.round(performance.now()-s.startTime)}return 0}measureFromPublishStart(o,n){const r=performance.getEntriesByName("agora-web-sdk/".concat(o,"/publish-").concat(n));if(r.length>0){const s=r[r.length-1];return Math.round(performance.now()-s.startTime)}return 0}};function cL(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function Fh(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?cL(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):cL(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}class cm{constructor(n){S(this,"store",void 0),S(this,"onStatsException",void 0),S(this,"onUploadPublishDuration",void 0),S(this,"onStatsChanged",void 0),S(this,"localStats",new Map),S(this,"remoteStats",new Map),S(this,"updateStatsInterval",void 0),S(this,"trafficStats",void 0),S(this,"trafficStatsPeerList",[]),S(this,"uplinkStats",void 0),S(this,"exceptionMonitor",void 0),S(this,"p2pChannel",void 0),S(this,"scalabilityMode",rC.L1T1),S(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=n,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new aL,this.exceptionMonitor.on("exception",(r,s,c)=>{this.onStatsException&&this.onStatsException(r,s,c)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(te.LocalAudioTrack)||Fh({},Ir)}getLocalVideoTrackStats(){return this.localStats.get(te.LocalVideoTrack)||Fh({},gi)}getRemoteAudioTrackStats(n){const r=(d,h)=>{if(!this.trafficStats)return h;const p=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return p&&(h.publishDuration=p.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},s={};if(n){var c;const d=null===(c=this.remoteStats.get(n))||void 0===c?void 0:c.audioStats;d&&(s[n]=r(n,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{audioStats:p}]=d;p&&(s[h]=r(h,p))});return s}getRemoteNetworkQualityStats(n){const r={};if(n){var s;const c=null===(s=this.remoteStats.get(n))||void 0===s?void 0:s.networkStats;c&&(r[n]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[d,{networkStats:h}]=c;h&&(r[d]=h)});return r}getRemoteVideoTrackStats(n){const r=(d,h)=>{if(!this.trafficStats)return h;const p=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return p&&(h.publishDuration=p.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},s={};if(n){var c;const d=null===(c=this.remoteStats.get(n))||void 0===c?void 0:c.videoStats;d&&(s[n]=r(n,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{videoStats:p}]=d;p&&(s[h]=r(h,p))});return s}getRTCStats(){let n=0,r=0,s=0,c=0;const d=this.localStats.get(te.LocalAudioTrack);d&&(n+=d.sendBytes,r+=d.sendBitrate);const h=this.localStats.get(te.LocalVideoTrack);h&&(n+=h.sendBytes,r+=h.sendBitrate);const p=this.localStats.get(te.LocalVideoLowTrack);p&&(n+=p.sendBytes,r+=p.sendBitrate),this.remoteStats.forEach(_=>{let{audioStats:g,videoStats:v}=_;g&&(s+=g.receiveBytes,c+=g.receiveBitrate),v&&(s+=v.receiveBytes,c+=v.receiveBitrate)});let m=1;return this.trafficStats&&(m+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:m,SendBitrate:r,SendBytes:n,RecvBytes:s,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(n){this.localStats.set(n,void 0)}removeLocalStats(n){n?this.localStats.delete(n):this.localStats.clear()}addRemoteStats(n){this.remoteStats.set(n,{})}removeRemoteStats(n){n?this.remoteStats.delete(n):this.remoteStats.clear()}addP2PChannel(n){this.p2pChannel=n}updateTrafficStats(n){n.peer_delay=n.peer_delay.filter(r=>void 0!==r.B_ppad||void 0!==r.B_ppvd),n.peer_delay.filter(r=>-1===this.trafficStatsPeerList.indexOf(r.peer_uid)).forEach(r=>{var s;const c=null===(s=this.p2pChannel)||void 0===s?void 0:s.getRemoteMedia(r.peer_uid),d=null!=c&&c.videoSSRC?vi.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=null!=c&&c.audioSSRC?vi.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;void 0!==r.B_ppad&&void 0!==r.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(r.peer_uid,r.B_ppad,r.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(r.peer_uid))}),this.trafficStats=n}updateUplinkStats(n){this.uplinkStats&&this.uplinkStats.B_fir!==n.B_fir&&w.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(n.B_fir)),this.uplinkStats=n}static isRemoteVideoFreeze(n,r,s){return!!n&&(!!s&&r.framesDecodeFreezeTime>s.framesDecodeFreezeTime||!(!s||r.framesDecodeCount>s.framesDecodeCount))}static isRemoteAudioFreeze(n){return!!n&&n._isFreeze()}isLocalVideoFreeze(n){return!(!n.inputFrame||!n.sentFrame)&&n.inputFrame.frameRate>5&&n.sentFrame.frameRate<3}updateLocalStats(n){Array.from(this.localStats.entries()).forEach(r=>{let[s,c]=r;switch(s){case te.LocalVideoTrack:case te.LocalVideoLowTrack:{const h=c,p=Fh({},gi),m=n.getStats(),_=n.getLocalMedia(s);if(m){const g=m.videoSend.find(v=>v.ssrc===_?.ssrcs[0].ssrcId);if(g){const v=n.getLocalVideoSize(),b=n.getEncoderConfig(te.LocalVideoTrack);"H264"!==g.codec&&"H265"!==g.codec&&"VP8"!==g.codec&&"VP9"!==g.codec&&"AV1X"!==g.codec&&"AV1"!==g.codec||(p.codecType=g.codec),p.sendBytes=g.bytes,p.sendBitrate=h?8*Math.max(0,p.sendBytes-h.sendBytes):0,g.inputFrame?(p.captureFrameRate=g.inputFrame.frameRate,p.captureResolutionHeight=g.inputFrame.height,p.captureResolutionWidth=g.inputFrame.width):v&&(p.captureResolutionWidth=v.width,p.captureResolutionHeight=v.height),g.sentFrame?(p.sendFrameRate=g.sentFrame.frameRate,p.sendResolutionHeight=g.sentFrame.height,p.sendResolutionWidth=g.sentFrame.width):v&&(p.sendResolutionWidth=v.width,p.sendResolutionHeight=v.height),g.avgEncodeMs&&(p.encodeDelay=g.avgEncodeMs),b&&b.bitrateMax&&(p.targetSendBitrate=1e3*b.bitrateMax),p.sendPackets=g.packets,p.sendPacketsLost=g.packetsLost,p.sendJitterMs=g.jitterMs,p.sendRttMs=g.rttMs,p.totalDuration=h?h.totalDuration+1:1,p.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(g)&&(p.totalFreezeTime+=1),g.scalabilityMode&&this.scalabilityMode!==g.scalabilityMode&&(w.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(g.scalabilityMode)),this.scalabilityMode=g.scalabilityMode)}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var d;this.localStats.set(s,p),(h?.sendResolutionWidth!==p.sendResolutionWidth||h?.sendResolutionHeight!==p.sendResolutionHeight)&&(null===(d=this.onStatsChanged)||void 0===d||d.call(this,"resolution",{width:p.sendResolutionWidth,height:p.sendResolutionHeight})),p&&_&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,_.track,p);break}case te.LocalAudioTrack:{const h=c,p=Fh({},Ir),m=n.getStats(),_=n.getLocalMedia(s);if(m){const g=m.audioSend.find(v=>v.ssrc===_?.ssrcs[0].ssrcId);if(g){if("opus"!==g.codec&&"aac"!==g.codec&&"PCMU"!==g.codec&&"PCMA"!==g.codec&&"G722"!==g.codec||(p.codecType=g.codec),g.inputLevel)p.sendVolumeLevel=Math.round(32767*g.inputLevel);else{const v=n.getLocalAudioVolume();v&&(p.sendVolumeLevel=Math.round(32767*v))}p.sendBytes=g.bytes,p.sendPackets=g.packets,p.sendPacketsLost=g.packetsLost,p.sendJitterMs=g.jitterMs,p.sendRttMs=g.rttMs,p.sendBitrate=h?8*Math.max(0,p.sendBytes-h.sendBytes):0}}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(te.LocalAudioTrack,p),p&&_&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,_.track,p);break}}})}updateRemoteStats(n){Array.from(this.remoteStats.entries()).forEach(r=>{let[s,{videoStats:c,audioStats:d,videoPcStats:h}]=r;const p=d,m=c,_=h,g=Fh({},Ei),v=Fh({},ii),b=Fh({},Ht),{audioTrack:C,videoTrack:N,audioSSRC:P,videoSSRC:D}=n.getRemoteMedia(s),k=n.getStats(),V=k?.audioRecv.find(oe=>oe.ssrc===P),U=k?.videoRecv.find(oe=>oe.ssrc===D),Y=this.trafficStats&&this.trafficStats.peer_delay.find(oe=>oe.peer_uid===s);if(V&&("opus"!==V.codec&&"aac"!==V.codec&&"PCMU"!==V.codec&&"PCMA"!==V.codec&&"G722"!==V.codec||(g.codecType=V.codec),V.outputLevel?g.receiveLevel=Math.round(32767*V.outputLevel):C&&(g.receiveLevel=Math.round(32767*C.getVolumeLevel())),g.receiveBytes=V.bytes,g.receivePackets=V.packets,g.receivePacketsLost=V.packetsLost,g.packetLossRate=g.receivePacketsLost/(g.receivePackets+g.receivePacketsLost),g.receiveBitrate=p?8*Math.max(0,g.receiveBytes-p.receiveBytes):0,g.totalDuration=p?p.totalDuration+1:1,g.totalFreezeTime=p?p.totalFreezeTime:0,g.freezeRate=g.totalFreezeTime/g.totalDuration,g.receiveDelay=V.jitterBufferMs,g.totalDuration>10&&cm.isRemoteAudioFreeze(C)&&(g.totalFreezeTime+=1)),U){"H264"!==U.codec&&"H265"!==U.codec&&"VP8"!==U.codec&&"VP9"!==U.codec&&"AV1X"!==U.codec&&"AV1"!==U.codec||(v.codecType=U.codec),v.receiveBytes=U.bytes,v.receiveBitrate=m?8*Math.max(0,v.receiveBytes-m.receiveBytes):0,v.decodeFrameRate=U.decodeFrameRate<0?0:U.decodeFrameRate,v.renderFrameRate=U.decodeFrameRate<0?0:U.decodeFrameRate,U.outputFrame&&(v.renderFrameRate=U.outputFrame.frameRate),U.receivedFrame?(v.receiveFrameRate=U.receivedFrame.frameRate,v.receiveResolutionHeight=U.receivedFrame.height,v.receiveResolutionWidth=U.receivedFrame.width):N&&(v.receiveResolutionHeight=N._videoHeight||0,v.receiveResolutionWidth=N._videoWidth||0),void 0!==U.framesRateFirefox&&(v.receiveFrameRate=Math.round(U.framesRateFirefox)),v.receivePackets=U.packets,v.receivePacketsLost=U.packetsLost,v.packetLossRate=v.receivePacketsLost/(v.receivePackets+v.receivePacketsLost),v.totalDuration=m?m.totalDuration+1:1,v.totalFreezeTime=m?m.totalFreezeTime:0,v.receiveDelay=U.jitterBufferMs||0;const oe=!!D&&n.getRemoteVideoIsReady(D);N&&oe&&cm.isRemoteVideoFreeze(N,U,_)&&(v.totalFreezeTime+=1),v.freezeRate=v.totalFreezeTime/v.totalDuration}Y&&(g.end2EndDelay=Y.B_ad,v.end2EndDelay=Y.B_vd,g.transportDelay=Y.B_ed,v.transportDelay=Y.B_ed,g.currentPacketLossRate=Y.B_ealr4/100,v.currentPacketLossRate=Y.B_evlr4/100,b.uplinkNetworkQuality=Y.B_punq?Y.B_punq:0,b.downlinkNetworkQuality=Y.B_pdnq?Y.B_pdnq:0),this.remoteStats.set(s,{audioStats:g,videoStats:v,videoPcStats:U,networkStats:b}),C&&this.exceptionMonitor.setRemoteAudioStats(C,g),N&&this.exceptionMonitor.setRemoteVideoStats(N,v)})}}function SO(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function WC(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?SO(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):SO(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}function KE(o){return o.match(/^[\.\:\d]+$/)?"".concat(o.replace(/[^\d]/g,"-"),".").concat(B("TURN_DOMAIN")):(w.info("Cannot recognized as IP address ".concat(o,". Used As Host instead")),o)}function lL(o,n){var r,s;const c=B("GATEWAY_DOMAINS");let d=c[1]&&-1!==n.indexOf(c[1])?1:0;o.addresses=o.addresses||[];const h=o.addresses.map(m=>m.domain_prefix?{address:"".concat(m.domain_prefix,".").concat(c[d++%c.length],":").concat(m.port)}:m.ip.match(/^[\.\:\d]+$/)?{ip:m.ip,port:m.port,address:"".concat(m.ip.replace(/[^\d]/g,"-"),".").concat(c[d++%c.length],":").concat(m.port)}:(w.info("Cannot recognized as IP address ".concat(m.ip,". Used As Host instead")),{ip:m.ip,port:m.port,address:"".concat(m.ip,":").concat(m.port)}));if(null!==(r=o.detail)&&void 0!==r&&r[18]&&"string"==typeof(null===(s=o.detail)||void 0===s?void 0:s[18])){const _=o.detail[18]?.split(";");for(let g=0;g<_.length;g++){var p;const v=TD(p=_[g]).call(p);h[g]&&v&&(h[g].ip6=v)}}return{gatewayAddrs:h,uid:o.uid,cid:o.cid,cert:o.cert,vid:o.detail&&o.detail[8],uni_lbs_ip:o.detail&&o.detail[1],res:o,csIp:o.detail&&o.detail[502]}}function Bo(o){return"number"==typeof o?o:o.exact||o.ideal||o.max||o.min||0}function zC(o){const n=o._encoderConfig;if(!n)return{};const r={resolution:n.width&&n.height?"".concat(Bo(n.width),"x").concat(Bo(n.height)):void 0,maxVideoBW:n.bitrateMax,minVideoBW:n.bitrateMin};return"number"==typeof n.frameRate?(r.maxFrameRate=n.frameRate,r.minFrameRate=n.frameRate):n.frameRate&&(r.maxFrameRate=n.frameRate.max||n.frameRate.ideal||n.frameRate.exact||n.frameRate.min,r.minFrameRate=n.frameRate.min||n.frameRate.ideal||n.frameRate.exact||n.frameRate.max),r}function CO(o){const n={connectionType:0,googRtt:o.rtt};switch(o.selectedCandidatePair.localCandidate.candidateType){case"relay":{const r=o.selectedCandidatePair.localCandidate.relayProtocol;"udp"===r&&(n.connectionType=1),"tcp"===r&&(n.connectionType=3),"tls"===r&&(n.connectionType=4);break}case"srflx":n.connectionType=2}return n}function dL(o){return o>=0&&o<.17?1:o>=.17&&o<.36?2:o>=.36&&o<.59?3:o>=.59&&o<=1?4:o>1?5:0}function TO(o,n){let r,s,c;switch(n){case ni.CHOOSE_SERVER:s=4096,c="choose server";break;case ni.CLOUD_PROXY:s=1048576,c="proxy";break;case ni.CLOUD_PROXY_5:s=4194304,c="proxy5";break;case ni.CLOUD_PROXY_FALLBACK:s=4194310,c="proxy fallback";break;default:throw new G(M.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:o.detail&&o.detail[502],retry:!1})}if(o.response_body.forEach(d=>{d.buffer&&d.buffer.flag===s&&(r={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map(h=>WC(WC({},h),{},{ticket:d.buffer.cert})),server_ts:o.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:WC(WC({},d.buffer.detail),o.detail),flag:d.buffer.flag,opid:o.opid,cert:d.buffer.cert})}),!r)throw new G(M.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:o.detail&&o.detail[502]});return r}function eV(o,n){return wO.apply(this,arguments)}function wO(){return wO=x(function*(o,n){return yield z.all(o.addresses.map(function(){var r=x(function*(s){return{address:KE(s.ip),tcpport:s.port,udpport:s.port,username:n&&B("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?n.toString():Fo.username,password:n&&B("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?yield uf(n.toString()):Fo.password}});return function(s){return r.apply(this,arguments)}}()))}),wO.apply(this,arguments)}function IO(o,n){const r=n._videoHeight||n.getMediaStreamTrack(!0).getSettings().height;return r?Math.max(r/Bo(o.height),1):(w.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Ud(o){let{candidateType:n,relayProtocol:r,type:s,address:c,port:d,protocol:h}=o;return"local-candidate"===s?{candidateType:n,relayProtocol:r,protocol:h}:{candidateType:n,relayProtocol:r,address:c,port:d,protocol:h}}function uL(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}class tV extends Yt{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(n){var r;Re(r=["tryNext","recover"]).call(r,n)&&this.resetReconnectCount(n),this._reconnectMode=n}get state(){return this._state}set state(n){n!==this._state&&(this._state=n,"reconnecting"===this._state?this.emit(Cn.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(Cn.CONNECTED):"closed"===this._state?this.emit(Cn.CLOSED):"failed"===this._state&&this.emit(Cn.FAILED))}constructor(n,r,s,c){super(),S(this,"connectionID",0),S(this,"currentURLIndex",0),S(this,"reconnectReason",void 0),S(this,"_reconnectMode","tryNext"),S(this,"_name",void 0),S(this,"_state","closed"),S(this,"_retryConfig",void 0),S(this,"_reconnectCount",0),S(this,"_forceCloseTimeout",5e3),S(this,"_onlineReconnectListener",void 0),S(this,"_closeEstablishingTransmitter",()=>{}),S(this,"_store",void 0),S(this,"_joinChannelServiceRecordIndex",void 0),S(this,"_useCompress",void 0),S(this,"_inflateLength",0),S(this,"_deflateLength",0),this._store=c,this._name=n,this._retryConfig=function(d){for(var h=1;h<arguments.length;h++){var p=null!=arguments[h]?arguments[h]:{};h%2?uL(Object(p),!0).forEach(function(m){S(d,m,p[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(p)):uL(Object(p)).forEach(function(m){Object.defineProperty(d,m,Object.getOwnPropertyDescriptor(p,m))})}return d}({},r),this._useCompress=s}resetReconnectCount(n){w.debug("".concat(this._name," reset reconnect count, reason: ").concat(n)),this._reconnectCount=0}close(n,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const s=this._transmitter;r?setTimeout(()=>s.close(),500):s.close(),this._transmitter=void 0}this.state=n?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(n,r){if(!this._transmitter)return void w.warning("[".concat(this._name,"] can not reconnect, no websocket"));var s;void 0!==n&&(this.reconnectMode=n),w.debug("[".concat(this._name,"] reconnect is triggered initiative")),"number"==typeof this._joinChannelServiceRecordIndex&&(null===(s=this._store)||void 0===s||s.recordJoinChannelService({status:"error",errors:[new Error(r)]},this._joinChannelServiceRecordIndex));const c=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),c&&c.bind(this._transmitter)({code:9999,reason:r})}getInflateData(){const n=this._inflateLength,r=this._deflateLength;return this.clearInflateData(),{inflateLength:n,deflateLength:r}}setInflateData(n){this._deflateLength=this._deflateLength+n.originLength,this._inflateLength=this._inflateLength+n.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}var jo;!function(o){o[o.Default=0]="Default",o[o.Ack=1]="Ack"}(jo||(jo={}));class nV{constructor(n,r,s){S(this,"version",1),S(this,"initialRTO",void 0),S(this,"maxBatchAckCount",void 0),S(this,"maxRTO",void 0),S(this,"initialRTT",void 0),S(this,"ID",void 0),S(this,"rtt",void 0),S(this,"packetNumber",1),S(this,"rtoRatioMap",new Map),S(this,"timeoutMap",new Map),S(this,"unorderedPacketQueue",[]),S(this,"batchAckPacketQueue",[]),S(this,"lastOrderedPacketNumber",0),S(this,"batchAckTimer",void 0),S(this,"sendImpl",void 0),S(this,"receiveImpl",void 0),this.sendImpl=n,this.receiveImpl=r,this.ID=It(7,"transmitter-"),this.initialRTO=void 0!==s?.initialRTO?s.initialRTO:B("TRANSMITTER_INITIAL_RTO"),this.initialRTT=void 0!==s?.initialRTT?s.initialRTT:B("TRANSMITTER_INITIAL_RTT"),this.rtt=void 0!==s?.initialRTT?s.initialRTT:B("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=void 0!==s?.maxBatchAckCount?s.maxBatchAckCount:B("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=void 0!==s?.maxRTO?s.maxRTO:B("TRANSMITTER_MAX_RTO")}packetize(n,r){return{type:jo.Default,version:this.version,packetNumber:r,payload:n}}serialize(n){switch(n.type){case jo.Default:{let r;r="string"==typeof n.payload?(new TextEncoder).encode(n.payload):n.payload;const s=new ArrayBuffer(r.length+15),c=new DataView(s);return c.setUint16(0,n.version),c.setUint8(2,n.type),c.setUint32(3,n.packetNumber),Ak(c,7,BigInt(n.sendTs)),new Uint8Array(c.buffer).set(r,15),s}case jo.Ack:{const r=new ArrayBuffer(16),s=new DataView(r);return s.setUint16(0,n.version),s.setUint8(2,n.type),s.setUint32(3,n.maxAckPacketNumber),s.setUint8(7,n.shift),Ak(s,8,BigInt(n.ackSendTs)),r}}}deserialize(n){const r=new DataView(n),s=r.getUint16(0),c=r.getUint8(2);switch(c){case jo.Default:{const d=r.getUint32(3),h=Rk(r,7),p=n.slice(15),m=(new TextDecoder).decode(p);return{version:s,type:c,packetNumber:d,sendTs:Number(h),payload:m}}case jo.Ack:{const d=r.getUint32(3),h=r.getUint8(7),p=Rk(r,8);return{version:s,type:c,maxAckPacketNumber:d,shift:h,ackSendTs:Number(p)}}default:throw w.error("[".concat(this.ID,"] Unrecognized packet type ").concat(c)),new Error("Unrecognized packet type ".concat(c))}}sendMessage(n){const r=this.packetize(n,this.packetNumber);this.packetNumber=4294967295===this.packetNumber?1:this.packetNumber+1;const s=this.calculateRTO(r),c=window.setTimeout(()=>{this.resendMessage(r)},s);this.timeoutMap.set(r.packetNumber,c),this.sendPacket(r)}onData(n){const r=this.deserialize(n);r.type===jo.Default?this.ack(r):r.type===jo.Ack&&(this.updateRTT(r,Math.round(performance.now())),this.clearRTO(r))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(n=>{let[r,s]=n;window.clearTimeout(s)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,void 0!==this.batchAckTimer&&window.clearTimeout(this.batchAckTimer)}resendMessage(n){const r=this.calculateRTO(n),s=window.setTimeout(()=>{this.resendMessage(n)},r);this.timeoutMap.set(n.packetNumber,s),this.sendPacket(n)}calculateRTO(n){const r=this.rtoRatioMap.get(n.packetNumber);if(void 0===r)return this.rtoRatioMap.set(n.packetNumber,1),this.initialRTO;{const s=9*this.rtt/8*r;return this.rtoRatioMap.set(n.packetNumber,r+1),s>this.maxRTO?this.maxRTO:s}}updateRTT(n,r){this.rtt=this.rtt*(7/8)+(r-n.ackSendTs-this.rtt)/8}ack(n){if(n.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(n):(this.batchAckPacketQueue.push(n),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(n.payload);;){const r=this.unorderedPacketQueue[0];if(!r){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(r.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else n.packetNumber<=this.lastOrderedPacketNumber?this.sendPacket({ackSendTs:n.sendTs,maxAckPacketNumber:n.packetNumber,shift:0,type:jo.Ack,version:this.version}):n.packetNumber>this.lastOrderedPacketNumber&&(this.unorderedPacketQueue[n.packetNumber-this.lastOrderedPacketNumber-2]=n,this.sendPacket({ackSendTs:n.sendTs,maxAckPacketNumber:n.packetNumber,shift:0,type:jo.Ack,version:this.version}))}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0,this.sendPacket({ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:jo.Ack,version:this.version}),this.batchAckPacketQueue=[]}sendPacket(n){n.type===jo.Default&&(n.sendTs=Math.round(performance.now()));const r=this.serialize(n);this.sendImpl(r)}clearRTO(n){for(let r=n.maxAckPacketNumber-n.shift;r<=n.maxAckPacketNumber;r++){const s=this.timeoutMap.get(r);void 0!==s&&window.clearTimeout(s),this.timeoutMap.delete(r),this.rtoRatioMap.delete(r)}}}class RO extends tV{constructor(n,r){super(n,r,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3?arguments[3]:void 0),S(this,"_initMutex",void 0),S(this,"_reconnectInterrupter",void 0),S(this,"_url",void 0),S(this,"_transmitter",void 0),S(this,"_addresses",void 0),S(this,"_reliableTransmission",void 0),this._initMutex=new Wn("datachannel");const{timeout:s,timeoutFactor:c}=r,d=Math.max(300,Math.floor(3*s/5)),h=Math.max(1.2,Math.floor(8*c)/10);li.ONLINE&&(this._retryConfig.timeout=d,this._retryConfig.timeoutFactor=h),Rn.on(ic.NETWORK_STATE_CHANGE,(p,m)=>{p!==m&&(this.resetReconnectCount("network state change: ".concat(m," -> ").concat(p)),p===li.ONLINE?(this._retryConfig.timeout=d,this._retryConfig.timeoutFactor=h):(this._retryConfig.timeout=s,this._retryConfig.timeoutFactor=c))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}init(n){var r=arguments,s=this;return x(function*(){s._forceCloseTimeout=r.length>1&&void 0!==r[1]?r[1]:5e3;return s._initMutex.lock().then(h=>new z((p,m)=>{((h,p)=>{s._addresses=n,s.currentURLIndex=s._addresses.findIndex(_=>_.fingerprint||B("FINGERPRINT"));const m=s._addresses[s.currentURLIndex];s.state="connecting",s.createTransmitterConnection(m).then(h).catch(p),s.once(Cn.CLOSED,()=>p(new G(M.WS_DISCONNECT))),s.once(Cn.CONNECTED,()=>h())})(p,m)}).then(()=>{h()}).catch(()=>{h()}))})()}sendMessage(n){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new G(M.WS_ABORT,"datachannel is not ready");try{r||(n=JSON.stringify(n)),this._reliableTransmission.sendMessage(n)}catch(s){throw new G(M.WS_ERR,"send datachannel signal message error"+s.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(n){const r=JSON.stringify(n);return{compressed:r,compressedLength:r.length,origin:n}}sendMessageWithUint8Array(n){return{compressed:n,compressedLength:n.byteLength,origin:n}}createTransmitterConnection(n){var r=this;return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(n.ip,":").concat(n.port),new z((s,c)=>{var d;const h=()=>{w.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),s()},p=function(){var v=x(function*(b){var C;if(null===(C=r._closeEstablishingTransmitter)||void 0===C||C.call(r),w.debug("[".concat(r._name,"] datachannel close ").concat(r._url,", code: ").concat(b.code,", reason: ").concat(b.reason,", current mode: ").concat(r.reconnectMode)),r._reconnectCount<r._retryConfig.maxRetryCount){"connected"===r.state&&(r.reconnectReason=b.reason,r.state="reconnecting");const N=hr(r,Cn.WILL_RECONNECT,r.reconnectMode)||r.reconnectMode,P=yield r.reconnectWithAction(N);if("closed"===r.state)return void w.debug("[".concat(r.connectionID,"] dc is closed, no need to reconnect"));if(!P)return c(new G(M.WS_DISCONNECT,"datachannel reconnect failed: ".concat(b.code))),void r.close(!0);s()}else c(new G(M.WS_DISCONNECT,"datachannel close: ".concat(b.code))),r.close()});return function(C){return v.apply(this,arguments)}}(),m=v=>{var b;null===(b=this._reliableTransmission)||void 0===b||b.onData(v.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),w.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(n)));const _=null===(d=this._store)||void 0===d?void 0:d.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),g=Date.now();Qt(this,Cn.TO_CONNECT_DATACHANNEL,n).then(v=>{var b,C;if(!v)throw new Error("transmissonInfo not exist yet");const{transmitter:N,close:P}=v;this._transmitter=N,null===(b=this._store)||void 0===b||b.signalChannelOpen();const D=Date.now()-g;w.debug("[choose dc] dc open cost ".concat(D,"ms")),this._reliableTransmission=new nV(k=>{var V;this._transmitter&&"open"===this._transmitter.readyState&&(null===(V=this._transmitter)||void 0===V||V.send(k))},k=>{"string"==typeof k&&this.emit(Cn.ON_MESSAGE,k)}),this._closeEstablishingTransmitter=()=>{var k;null===(k=this._reliableTransmission)||void 0===k||k.close(),this._reliableTransmission=void 0,P()},h&&h(),N.onclose=p,N.onmessage=m,null===(C=this._store)||void 0===C||C.recordJoinChannelService({endTs:Date.now(),status:"success"},_),this._joinChannelServiceRecordIndex=_}).catch(v=>{var b;if(null===(b=this._store)||void 0===b||b.recordJoinChannelService({endTs:Date.now(),status:v instanceof G&&v.code===M.WS_ABORT?"aborted":"error",errors:[v]},_),"closed"!==this.state){if(v instanceof G&&v.code===M.WS_ERR){const C=new G(M.WS_ERR,"init datachannel failed! Error: ".concat(v.toString()));return w.error("[".concat(this._name,"]").concat(C)),void c(C)}p&&p(v)}else c(new G(M.WS_DISCONNECT,"datachannel is closed: ".concat(v.toString())))})})}reconnectWithAction(n){var r=arguments,s=this;return x(function*(){let c=!(r.length>1&&void 0!==r[1])||r[1];if(s._reconnectCount>=s._retryConfig.maxRetryCount||!s._addresses||"closed"===s.state)return!1;s._onlineReconnectListener||Rn.networkState!==li.OFFLINE||(s._onlineReconnectListener=Rn.onlineWaiter&&Rn.onlineWaiter.then(()=>{s._onlineReconnectListener=void 0}));let d=!0;if(s._reconnectInterrupter=()=>{d=!1},c){const _=jg(s._reconnectCount,s._retryConfig);w.debug("[".concat(s._name,"] wait ").concat(_,"ms to reconnect datachannel, mode: ").concat(n)),yield z.race([mi(_),s._onlineReconnectListener||new z(()=>{})])}if("closed"===s.state||!d)return!1;s._reconnectCount+=1;const h=function(){var _=x(function*(g,v){s.emit(Cn.RECONNECT_CREATE_CONNECTION,v),yield s.createTransmitterConnection(g)});return function(v,b){return _.apply(this,arguments)}}();try{if("retry"===n){const _=s._addresses[s.currentURLIndex];s.emit(Cn.RECONNECT_WAITTING_FINISH,n),yield h(_,n)}else if("tryNext"===n){s.currentURLIndex+=1;for(let g=s.currentURLIndex;g<s._addresses.length;g++){if(s._addresses[g].fingerprint||B("FINGERPRINT")){s.currentURLIndex=g;break}s.currentURLIndex+=1}if(s.currentURLIndex>=s._addresses.length)return w.debug("[".concat(s._name,"] the available addresses are exhausted, change to recover")),yield s.reconnectWithAction("recover",!1);w.debug("[".concat(s._name,"] datachannel url length: ").concat(s._addresses.length," current index: ").concat(s.currentURLIndex));const _=s._addresses[s.currentURLIndex];s.emit(Cn.RECONNECT_WAITTING_FINISH,n),yield h(_,n)}else"recover"===n&&(w.debug("[".concat(s._name,"] start to failback to websocket")),s.resetReconnectCount("recover mode"),s.emit(Cn.RECONNECT_WAITTING_FINISH,n),s.emit(Cn.FAILBACK));return!0}catch(_){var p,m;return w.error("[".concat(s._name,"] reconnect failed"),_.toString()),null!=_&&null!==(p=_.data)&&void 0!==p&&p.desc&&Array.isArray(_.data.desc)&&_.data.desc.length&&Re(m=_.data.desc).call(m,"dynamic key expired")?(s.emit(Cn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):yield s.reconnectWithAction(n,c)}})()}}class vs extends Yt{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===qe.CONNECTED?this.emit(le.WS_CONNECTED):n===qe.RECONNECTING?this.emit(le.WS_RECONNECTING,this._websocketReconnectReason):n===qe.CLOSED&&this.emit(le.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(n,r){super(),S(this,"_disconnectedReason",void 0),S(this,"_websocketReconnectReason",void 0),S(this,"_connectionState",qe.CLOSED),S(this,"reconnectToken",void 0),S(this,"websocket",void 0),S(this,"openConnectionTime",void 0),S(this,"clientId",void 0),S(this,"lastMsgTime",Date.now()),S(this,"uploadCache",[]),S(this,"uploadCacheInterval",void 0),S(this,"rttRolling",new ff(5)),S(this,"pingpongTimer",void 0),S(this,"inflateDataTimer",void 0),S(this,"pingpongTimeoutCount",0),S(this,"joinResponse",void 0),S(this,"multiIpOption",void 0),S(this,"initError",void 0),S(this,"spec",void 0),S(this,"store",void 0),S(this,"onWebsocketMessage",s=>{if(s instanceof ArrayBuffer)return void this.emit(le.ON_BINARY_DATA,s);const c=JSON.parse(s);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")&&(this.emit(c._type,c._message),c._type===me.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===me.ON_USER_BANNED))switch(c._message.error_code){case 14:this.close(Xe.UID_BANNED);break;case 15:this.close(Xe.IP_BANNED);break;case 16:this.close(Xe.CHANNEL_BANNED)}}),this.clientId=n.clientId,this.spec=n,this.store=r,this.websocket=new RO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===qe.CONNECTED&&this.reconnect("retry",oc.OFFLINE)})}request(n,r,s,c){var d=this;return x(function*(){const h=It(6,""),p={_id:h,_type:n,_message:r},m=d.websocket.connectionID,_=()=>new z((P,D)=>{if(d.connectionState===qe.CONNECTED)return P();const k=()=>{d.off(le.WS_CLOSED,V),P()},V=()=>{d.off(le.WS_CONNECTED,k),D(new G(M.WS_ABORT))};d.once(le.WS_CONNECTED,k),d.once(le.WS_CLOSED,V),n!==be.PUBLISH&&n!==be.SUBSCRIBE&&n!==be.UNSUBSCRIBE&&n!==be.UNPUBLISH&&n!==be.CONTROL&&n!==be.RESTART_ICE||d.once(le.DISCONNECT_P2P,()=>{D(new G(M.DISCONNECT_P2P))}),n!==be.PUBLISH&&n!==be.RESTART_ICE||d.once(le.ABORT_P2P_EXECUTION,()=>{D(new G(M.DISCONNECT_P2P))})});if(d.connectionState!==qe.CONNECTING&&d.connectionState!==qe.RECONNECTING||n===be.JOIN||n===be.REJOIN||(yield _()),n===be.LEAVE&&(d.websocket.unbindDcCloseEventListener(),c=!0),d.websocket.sendMessage(p,!0,!1),c)return;const g=new z((P,D)=>{let k=!1;const V=(Y,oe)=>{k=!0,P({isSuccess:"success"===Y,message:oe||{}}),d.off(le.WS_CLOSED,U),d.off(le.WS_RECONNECTING,U),d.emit(le.REQUEST_SUCCESS,n,r)};d.once("res-@".concat(h),V);const U=()=>{D(new G(M.WS_ABORT,"type: ".concat(n))),d.off(le.WS_CLOSED,U),d.off(le.WS_RECONNECTING,U),d.off("res-@".concat(h),V)};d.once(le.WS_CLOSED,U),d.once(le.WS_RECONNECTING,U),mi(B("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||k||(w.warning("dc request timeout, type: ".concat(n)),d.emit(le.REQUEST_TIMEOUT,n,r))})});let v=null;try{v=yield g}catch(P){if(d.connectionState===qe.CLOSED||n===be.LEAVE)throw new G(M.WS_ABORT);return!d.spec.forceWaitGatewayResponse||s?P.throw():n===be.JOIN||n===be.REJOIN?null:(yield _(),yield d.request(n,r))}if(v.isSuccess)return v.message;const b=Number(v.message.error_code||v.message.code),C=Eh(b),N=new G(M.UNEXPECTED_RESPONSE,"".concat(C.desc,": ").concat(v.message.error_str),{code:b,data:v.message});return"success"===C.action?v.message:(w.warning("[".concat(d.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(b,", message: ").concat(C.desc,", action: ").concat(C.action)),b===Ce.ERR_TOO_MANY_BROADCASTERS?((n===be.JOIN||n===be.REJOIN)&&(d.initError=N,d.close()),N.throw()):"failed"===C.action?N.throw():"quit"===C.action?(d.initError=N,d.close(),N.throw()):(b===Ce.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=v.message.option,w.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",oc.MULTI_IP)):d.reconnect(C.action,oc.SERVER_ERROR),n===be.JOIN||n===be.REJOIN?null:yield d.request(n,r)))})()}waitMessage(n,r){return new z(s=>{const c=d=>{(!r||r(d))&&(this.off(n,c),s(d))};this.on(n,c)})}upload(n,r){const s={_type:n,_message:r};try{this.websocket.sendMessage(s)}catch{const d=B("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==qe.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},B("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,r){this.websocket.sendMessage({_type:n,_message:r})}init(n,r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new z((s,c)=>{this.once(le.WS_CONNECTED,()=>s(this.joinResponse)),this.once(le.WS_CLOSED,()=>c(this.initError||new G(M.WS_ABORT))),this.connectionState=qe.CONNECTING,this.websocket.init(n).catch(c),this.websocket.once(Cn.FAILBACK,()=>{void 0===this.openConnectionTime&&c(new G(M.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{r&&void 0===this.openConnectionTime&&(w.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),c(new G(M.INIT_DATACHANNEL_TIMEOUT)))},B("DC_JOIN_WITH_FAILBACK"))})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=n||Xe.LEAVE,this.connectionState=qe.CLOSED,w.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),n===Xe.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new RO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}join(){var n=this;return x(function*(){if(!n.joinResponse){n.emit(le.ABORT_P2P_EXECUTION);const r=yield Qt(n,le.DATACHANNEL_CONNECTING),s=yield n.request(be.JOIN,r);if(!s)return n.emit(le.REPORT_JOIN_GATEWAY,M.TIMEOUT,n.url||""),!1;n.joinResponse=s,n.emit(le.JOIN_RESPONSE,n.joinResponse),n.reconnectToken=n.joinResponse.rejoin_token}return n.connectionState=qe.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),!0})()}rejoin(){var n=this;return x(function*(){if(!n.reconnectToken)throw new G(M.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=rc(n,le.REQUEST_REJOIN_INFO);r.token=n.reconnectToken;const s=yield n.request(be.REJOIN,r);return!!s&&(n.connectionState=qe.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),s.peers&&s.peers.forEach(c=>{n.emit(me.ON_USER_ONLINE,{uid:c.uid}),c.audio&&n.emit(me.ON_ADD_AUDIO_STREAM,{uid:c.uid,uint_id:c.uint_id,audio:!0,ssrcId:c.audio_ssrc}),c.video&&n.emit(me.ON_ADD_VIDEO_STREAM,{uid:c.uid,uint_id:c.uint_id,video:!0,ssrcId:c.video_ssrc}),n.emit(c.audio_mute?me.MUTE_AUDIO:me.UNMUTE_AUDIO,{uid:c.uid}),n.emit(c.video_mute?me.MUTE_VIDEO:me.UNMUTE_VIDEO,{uid:c.uid}),n.emit(c.audio_enable_local?me.ENABLE_LOCAL_AUDIO:me.DISABLE_LOCAL_AUDIO,{uid:c.uid}),n.emit(c.video_enable_local?me.ENABLE_LOCAL_VIDEO:me.DISABLE_LOCAL_VIDEO,{uid:c.uid}),c.audio||c.video||n.emit(me.ON_REMOVE_STREAM,{uid:c.uid,uint_id:c.uint_id})}),!0)})()}reconnect(n,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,r)}handleNotification(n){w.debug("[".concat(this.clientId,"] receive notification: "),n);const r=Eh(n.code);if("success"!==r.action){if("failed"!==r.action)return"quit"===r.action?("ERR_REPEAT_JOIN_CHANNEL"===r.desc&&this.close(Xe.UID_BANNED),void this.close()):void this.reconnect(r.action,oc.SERVER_ERROR);w.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=B("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=n&&(w.warning("PINGPONG Timeout. Last Socket Message: ".concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>B("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",oc.TIMEOUT):this.request(be.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-r;this.rttRolling.add(s),B("REPORT_STATS")&&this.send(be.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleInflateData(){const{inflateLength:n,deflateLength:r}=this.websocket.getInflateData();0!==n&&0!==r&&this.upload(zr.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:n})}handleWebsocketEvents(){var n=this;this.websocket.on(Cn.RECONNECT_WAITTING_FINISH,r=>{this.emit(le.WS_RECONNECT_WAITTING_FINISH,r)}),this.websocket.on(Cn.RECONNECT_CREATE_CONNECTION,r=>{this.emit(le.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Cn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Cn.CLOSED,()=>{this.connectionState=qe.CLOSED}),this.websocket.on(Cn.FAILED,()=>{this._disconnectedReason=Xe.NETWORK_ERROR,this.connectionState=qe.CLOSED}),this.websocket.on(Cn.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState=this.connectionState===qe.CONNECTED?qe.RECONNECTING:qe.CONNECTING}),this.websocket.on(Cn.WILL_RECONNECT,(r,s)=>{if(rc(this,le.IS_P2P_DISCONNECTED)&&"retry"===r)return w.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(le.NEED_RENEW_SESSION),this.emit(le.DISCONNECT_P2P),s("tryNext");"retry"!==r&&(w.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0,this.emit(le.NEED_RENEW_SESSION),this.emit(le.DISCONNECT_P2P)),s(r)}),this.websocket.on(Cn.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{w.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",oc.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(le.REPORT_JOIN_GATEWAY,r.message||r.code,this.url||""),r instanceof G&&r.code===M.UNEXPECTED_RESPONSE&&r.data.code===Ce.ERR_NO_AUTHORIZED)return w.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",oc.SERVER_ERROR);w.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",oc.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(Cn.REQUEST_NEW_URLS,(r,s)=>{Qt(this,le.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(Cn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(me.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(Cn.TO_CONNECT_DATACHANNEL,function(){var r=x(function*(s,c,d){return Qt(n,le.DATACHANNEL_PRECONNECT,s).then(c).catch(d)});return function(s,c,d){return r.apply(this,arguments)}}()),this.websocket.on(Cn.FAILBACK,()=>{void 0!==this.openConnectionTime&&this.emit(le.DATACHANNEL_FAILBACK)})}}class lm extends Yt{constructor(n){super(),S(this,"_signal",void 0),S(this,"_sequence",0),S(this,"_userMap",new Map),S(this,"_encoder",new TextEncoder),this._signal=n}send(n,r,s,c,d){var h=this;return x(function*(){var p,m,_;"string"!=typeof r&&(r=JSON.stringify(r)),c=null!==(p=c)&&void 0!==p?p:It(6,""),d=null!==(m=d)&&void 0!==m?m:h._sequence++;const g={_id:c,_type:n,_seq:null!==(_=d)&&void 0!==_?_:h._sequence++,_message:r};if(B("SHOW_P2P_LOG")&&w.debug("send message",g),h.sendStreamMessage(JSON.stringify(g)),s)return;const v=new z((C,N)=>{const P=window.setTimeout(()=>{h.off("res-@".concat(c),D),w.warning("[external-signal] request timeout, type: ".concat(n)),N(new Q(0===h._userMap.size?M.INVALID_REMOTE_USER:M.TIMEOUT))},B("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),D=(k,V)=>{P&&window.clearTimeout(P),"success"===k?C({isSuccess:!0,message:V}):N(new Q(M.UNEXPECTED_ERROR,V))};h.once("res-@".concat(c),D)});let b;try{b=yield v}catch(C){if(C.code===M.TIMEOUT)return yield h.send(n,r,!1,c,d);throw C}return b.isSuccess?b.message:void 0})()}sendStreamMessage(n){this._splitMessage(n).forEach(r=>{this._signal.request(be.DATA_STREAM,{payload:Ug(this._encoder.encode(r))})})}onMessage(n){const{_uid:r}=n;let s;const c=this._userMap.get(r);if(c?s=c.splitMessageMap:(s=new Map,this._userMap.set(r,{isStart:!1,splitMessageMap:s,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map})),"id"in n&&"total"in n){var d;const{id:h,total:p}=n,m=null!==(d=s.get(h))&&void 0!==d?d:[];if(m.push(n),s.has(h)||s.set(h,m),m.length!==p)return;{const _=ie(m).call(m,(g,v)=>g.index-v.index).map(g=>g.payload).join("");s.delete(h),(n=JSON.parse(_))._uid=r}}this.handleReceivedMessage(n)}setStart(n){this._userMap.has(n)?this._userMap.get(n).isStart=!0:this._userMap.set(n,{isStart:!0,splitMessageMap:new Map,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map}),this.handleReceivedMessage()}setEnd(n){return this._userMap.delete(n),0===this._userMap.size}ack(n,r,s){this.send(xt.ACK,JSON.stringify({success:!s,message:r}),!0,n)}handleReceivedMessage(n){const r=()=>{this._userMap.forEach(_=>{const{receivedMessagesMap:g,nextExpectedSequenceNumber:v}=_;for(;g.has(v);){const b=g.get(v);g.delete(v),this.receiveMessage(b),_.nextExpectedSequenceNumber++}})};if(!n)return void r();const{_uid:s,_seq:c}=n,d=this._userMap.get(s),{receivedMessagesMap:h,isStart:p,nextExpectedSequenceNumber:m}=d;c<m?w.debug("[external-signal] receive old message, seq: ".concat(c)):(h.set(c,n),p&&c===m&&(this.receiveMessage(n),h.delete(m),d.nextExpectedSequenceNumber++,r()))}receiveMessage(n){const{_id:r,_type:s,_message:c,_uid:d}=n;if(B("SHOW_P2P_LOG")&&w.debug("\u6536\u5230\u6d88\u606f",n),r)switch(n._type){case xt.PUBLISH:const h=JSON.parse(c);this._signal.emit(s,h,d),this.ack(n._id);break;case xt.CONTROL:case xt.UNPUBLISH:case xt.DO_SUBSCRIBE:case xt.DO_UNSUBSCRIBE:{const p=JSON.parse(c);p.uid=d,Qt(this._signal,s,p).then(m=>{this.ack(n._id,m)}).catch(m=>{this.ack(n._id,void 0,!0)});break}case xt.ACK:{const{success:p,message:m}=JSON.parse(c);this.emit("res-@".concat(r),p?"success":"failed",m);break}case xt.CALL:Qt(this,s,c).then(p=>{this.ack(r,p)});break;case xt.RESTART_ICE:case xt.EXCHANGE_SDP:case xt.SUBSCRIBE:case xt.UNSUBSCRIBE:Qt(this._signal,s,c).then(p=>{this.ack(r,p)}).catch(p=>{this.ack(n._id,void 0,!0)});break;case xt.CANDIDATE:this._signal.emit(s,c),this.ack(r);break;case xt.JOIN:this.emit(s,JSON.parse(c));break;default:this.emit(s,c),this.ack(r)}}_splitMessage(n){if(n.length<lm.MAX_MESSAGE_SIZE)return[n];const r=[],s=It(6,"");let c=0;const d=Math.ceil(n.length/800);for(;n.length>0;){c++;const h=n.slice(0,800);r.push({id:s,index:c,total:d,payload:h}),n=n.slice(800)}return r.map(h=>JSON.stringify(h))}clear(){this._sequence=0,this._userMap.clear()}}S(lm,"MAX_MESSAGE_SIZE",1024);class ol extends Yt{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===qe.CONNECTED?this.emit(le.WS_CONNECTED):n===qe.RECONNECTING?this.emit(le.WS_RECONNECTING,this._websocketReconnectReason):n===qe.CLOSED&&this.emit(le.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(n,r){super(),S(this,"_disconnectedReason",void 0),S(this,"_websocketReconnectReason",void 0),S(this,"_connectionState",qe.CLOSED),S(this,"reconnectToken",void 0),S(this,"_userInRoom",!1),S(this,"_userOnlineTime",void 0),S(this,"websocket",void 0),S(this,"openConnectionTime",void 0),S(this,"clientId",void 0),S(this,"lastMsgTime",Date.now()),S(this,"uploadCache",[]),S(this,"uploadCacheInterval",void 0),S(this,"rttRolling",new ff(5)),S(this,"pingpongTimer",void 0),S(this,"wsInflateDataTimer",void 0),S(this,"pingpongTimeoutCount",0),S(this,"joinResponse",void 0),S(this,"multiIpOption",void 0),S(this,"initError",void 0),S(this,"spec",void 0),S(this,"store",void 0),S(this,"_external_signal",void 0),S(this,"onWebsocketMessage",s=>{if(s.data instanceof ArrayBuffer)return void this.emit(le.ON_BINARY_DATA,s.data);const c=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case me.ON_DATA_STREAM:return void this.handleDataStream(c._message);case me.MUTE_AUDIO:case me.MUTE_VIDEO:case me.ON_P2P_LOST:return;case me.ON_USER_ONLINE:this.emit(c._type,c._message);const{uid:d}=c._message;return this._external_signal.setStart(d),void this._external_signal.send(xt.JOIN,{onlineTime:this._userOnlineTime},!0)}if(this.emit(c._type,c._message),c._type===me.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===me.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Xe.UID_BANNED);break;case 15:this.close(Xe.IP_BANNED);break;case 16:this.close(Xe.CHANNEL_BANNED)}if(c._type===me.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Ce.ERR_LICENSE_MISSING:this.close(Xe.LICENSE_MISSING);break;case Ce.ERR_LICENSE_EXPIRED:this.close(Xe.LICENSE_EXPIRED);break;case Ce.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Xe.LICENSE_MINUTES_EXCEEDED);break;case Ce.ERR_LICENSE_PERIOD_INVALID:this.close(Xe.LICENSE_PERIOD_INVALID);break;case Ce.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Xe.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ce.ERR_LICENSE_ILLEGAL:this.close(Xe.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=n.clientId,this.spec=n,this.store=r,this.websocket=new vh("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===qe.CONNECTED&&this.reconnect("retry",Xn.OFFLINE)}),this._external_signal=new lm(this),this._handleSignalP2PEvents()}request(n,r,s,c){var d=this;return x(function*(){const h=It(6,""),p={_id:h,_type:n,_message:r},m=d.websocket.connectionID,_=()=>new z((P,D)=>{if(d.connectionState===qe.CONNECTED)return P();const k=()=>{d.off(le.WS_CLOSED,V),P()},V=()=>{d.off(le.WS_CONNECTED,k),D(new Q(M.WS_ABORT))};d.once(le.WS_CONNECTED,k),d.once(le.WS_CLOSED,V),n!==be.PUBLISH&&n!==be.SUBSCRIBE&&n!==be.UNSUBSCRIBE&&n!==be.UNPUBLISH&&n!==be.CONTROL&&n!==be.RESTART_ICE||d.once(le.DISCONNECT_P2P,()=>{D(new Q(M.DISCONNECT_P2P))}),n!==be.PUBLISH&&n!==be.RESTART_ICE||d.once(le.ABORT_P2P_EXECUTION,()=>{D(new Q(M.DISCONNECT_P2P))})});if(d.connectionState!==qe.CONNECTING&&d.connectionState!==qe.RECONNECTING||n===be.JOIN||n===be.REJOIN||(yield _()),d.websocket.sendMessage(p,!0),c)return;const g=new z((P,D)=>{let k=!1;const V=(Y,oe)=>{k=!0,P({isSuccess:"success"===Y,message:oe||{}}),d.off(le.WS_CLOSED,U),d.off(le.WS_RECONNECTING,U),d.emit(le.REQUEST_SUCCESS,n,r)};d.once("res-@".concat(h),V);const U=()=>{D(new Q(M.WS_ABORT,"type: ".concat(n))),d.off(le.WS_CLOSED,U),d.off(le.WS_RECONNECTING,U),d.off("res-@".concat(h),V)};d.once(le.WS_CLOSED,U),d.once(le.WS_RECONNECTING,U),mi(B("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||k||(w.warning("[".concat(d.clientId,"] ws request timeout, type: ").concat(n)),d.emit(le.REQUEST_TIMEOUT,n,r))})});let v=null;try{v=yield g}catch(P){if(d.connectionState===qe.CLOSED||n===be.LEAVE)throw new Q(M.WS_ABORT);return!d.spec.forceWaitGatewayResponse||s?P.throw():n===be.JOIN||n===be.REJOIN?null:(yield _(),yield d.request(n,r))}if(v.isSuccess)return v.message;const b=Number(v.message.error_code||v.message.code),C=Eh(b),N=new Q(M.UNEXPECTED_RESPONSE,"".concat(C.desc,": ").concat(v.message.error_str),{code:b,data:v.message});return"success"===C.action?v.message:(w.warning("[".concat(d.clientId,"] [").concat(d.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(b,", message: ").concat(C.desc,", action: ").concat(C.action)),b===Ce.ERR_TOO_MANY_BROADCASTERS?((n===be.JOIN||n===be.REJOIN)&&(d.initError=N,d.close()),N.throw()):"failed"===C.action?N.throw():"quit"===C.action?(d.initError=N,d.close(),N.throw()):(b===Ce.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=v.message.option,w.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",Xn.MULTI_IP)):d.reconnect(C.action,Xn.SERVER_ERROR),n===be.JOIN||n===be.REJOIN?null:yield d.request(n,r)))})()}waitMessage(n,r){return new z(s=>{const c=d=>{(!r||r(d))&&(this.off(n,c),s(d))};this.on(n,c)})}upload(n,r){const s={_type:n,_message:r};try{this.websocket.sendMessage(s)}catch{const d=B("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==qe.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},B("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,r){this.websocket.sendMessage({_type:n,_message:r})}sendExtensionMessage(n,r,s){var c=this;return x(function*(){return yield c.waitTillUserOnline(),yield c._external_signal.send(n,r,s)})()}init(n,r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new z((s,c)=>{this.once(le.WS_CONNECTED,()=>s(this.joinResponse)),this.once(le.WS_CLOSED,()=>c(this.initError||new Q(M.WS_ABORT))),this.connectionState=qe.CONNECTING,this.websocket.init(n).catch(c),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=n||Xe.LEAVE,this.connectionState=qe.CLOSED,w.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),n===Xe.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new vh("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}join(){var n=this;return x(function*(){if(!n.joinResponse){n.emit(le.ABORT_P2P_EXECUTION);const r=yield Qt(n,le.REQUEST_JOIN_INFO),s=yield n.request(be.JOIN,r);if(!s)return n.emit(le.REPORT_JOIN_GATEWAY,M.TIMEOUT,n.url||""),!1;n.joinResponse=s,n.emit(le.JOIN_RESPONSE,n.joinResponse),n.reconnectToken=n.joinResponse.rejoin_token}return n.connectionState=qe.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),n._userOnlineTime=(new Date).getTime(),n._external_signal.clear(),!0})()}rejoin(){var n=this;return x(function*(){if(!n.reconnectToken)throw new Q(M.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=rc(n,le.REQUEST_REJOIN_INFO);return r.token=n.reconnectToken,!!(yield n.request(be.REJOIN,r))&&(n.connectionState=qe.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),!0)})()}reconnect(n,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,r)}handleDataStream(n){try{var r;const s=Fg(n.payload),c=(new TextDecoder).decode(s),d=JSON.parse(c);"total"in d&&"id"in d||Re(r=Object.values(xt)).call(r,d._type)?(n.seq&&delete n.seq,d._uid=n.uid,this._external_signal.onMessage(d)):this.emit(me.ON_DATA_STREAM,n)}catch{}}handleNotification(n){w.debug("[".concat(this.clientId,"] receive notification: "),n);const r=Eh(n.code);if("success"!==r.action){if("failed"!==r.action)return"quit"===r.action?("ERR_REPEAT_JOIN_CHANNEL"===r.desc&&this.close(Xe.UID_BANNED),void this.close()):void this.reconnect(r.action,Xn.SERVER_ERROR);w.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=B("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=n&&(w.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>B("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Xn.TIMEOUT):this.request(be.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-r;this.rttRolling.add(s),B("REPORT_STATS")&&this.send(be.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWsInflateData(){const{wsInflateLength:n,wsDeflateLength:r}=this.websocket.getWsInflateData();0!==n&&0!==r&&this.upload(zr.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:n})}handleWebsocketEvents(){this.websocket.on(Me.RECONNECT_WAITTING_FINISH,n=>{this.emit(le.WS_RECONNECT_WAITTING_FINISH,n)}),this.websocket.on(Me.RECONNECT_CREATE_CONNECTION,n=>{this.emit(le.WS_RECONNECT_CREATE_CONNECTION,n)}),this.websocket.on(Me.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Me.CLOSED,()=>{this.connectionState=qe.CLOSED}),this.websocket.on(Me.FAILED,()=>{this._disconnectedReason=Xe.NETWORK_ERROR,this.connectionState=qe.CLOSED}),this.websocket.on(Me.RECONNECTING,n=>{this._websocketReconnectReason=n,this.joinResponse=void 0,this.connectionState=this.connectionState===qe.CONNECTED?qe.RECONNECTING:qe.CONNECTING}),this.websocket.on(Me.WILL_RECONNECT,(n,r,s)=>{if(rc(this,le.IS_P2P_DISCONNECTED)&&"retry"===n)return w.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(le.NEED_RENEW_SESSION),this.emit(le.DISCONNECT_P2P),s("tryNext");"retry"!==n&&(w.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(n)),this.reconnectToken=void 0,this.emit(le.NEED_RENEW_SESSION),this.emit(le.DISCONNECT_P2P)),s(n)}),this.websocket.on(Me.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(n=>{w.warning("[".concat(this.clientId,"] rejoin failed ").concat(n)),this.reconnect("tryNext",Xn.SERVER_ERROR)}):this.join().catch(n=>{if(this.emit(le.REPORT_JOIN_GATEWAY,n.message||n.code,this.url||""),n instanceof Q&&n.code===M.UNEXPECTED_RESPONSE&&n.data.code===Ce.ERR_NO_AUTHORIZED)return w.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Xn.SERVER_ERROR);w.error("[".concat(this.clientId,"] join gateway request failed"),n.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Xn.SERVER_ERROR):(this.initError=n,this.close())})}),this.websocket.on(Me.REQUEST_NEW_URLS,(n,r)=>{Qt(this,le.REQUEST_RECOVER,this.multiIpOption).then(n).catch(r)}),this.websocket.on(Me.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(me.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}_handleSignalP2PEvents(){var n=this;this._external_signal.on(xt.JOIN,function(){var r=x(function*(s){if(n._userOnlineTime&&n._userOnlineTime<s.onlineTime){const c=yield Qt(n,le.P2P_START,void 0),d=yield n._external_signal.send(xt.CALL,c);n.emit(le.P2P_CONNECTION,d,!0)}n._userInRoom=!0,n.emit("user-online")});return function(s){return r.apply(this,arguments)}}()),this.on(me.ON_USER_OFFLINE,function(){var r=x(function*(s){n._external_signal.clear(),n._userInRoom=!1});return function(s){return r.apply(this,arguments)}}()),this._external_signal.on(xt.CALL,function(){var r=x(function*(s,c,d){n._userInRoom=!0,n.emit("user-online");try{c(yield Qt(n,le.P2P_START,s))}catch(h){d(h)}});return function(s,c,d){return r.apply(this,arguments)}}())}waitTillUserOnline(){var n=this;return x(function*(){return new z(r=>{if(n._userInRoom)r();else{const s=()=>{n.off("user-online",s),r()};n.on("user-online",s)}})})()}}function ys(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function bs(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?ys(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):ys(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}const qE=new Map;class hL extends Yt{get state(){return this._state}set state(n){if(n===this._state)return;const r=this._state;this._state=n,"DISCONNECTED"===n&&this._disconnectedReason?this.emit(on.CONNECTION_STATE_CHANGE,n,r,this._disconnectedReason):this.emit(on.CONNECTION_STATE_CHANGE,n,r)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(n){w.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(n)),this._joinGatewayStartTime=n}constructor(n,r){super(),S(this,"store",void 0),S(this,"joinInfo",void 0),S(this,"key",void 0),S(this,"ntpOffset",0),S(this,"signal",void 0),S(this,"role",void 0),S(this,"inChannelInfo",{joinAt:null,duration:0}),S(this,"spec",void 0),S(this,"_state","DISCONNECTED"),S(this,"_statsCollector",void 0),S(this,"_disconnectedReason",void 0),S(this,"isSignalRecover",!1),S(this,"hasChangeBGPAddress",!1),S(this,"trafficStatsInterval",void 0),S(this,"networkQualityInterval",void 0),S(this,"_joinGatewayStartTime",0),S(this,"_signalTimeout",!1),S(this,"_clientRoleOptions",void 0),S(this,"_isProactiveJoin",!1),this.store=n,this.spec=r,this.signal=this.store.useP2P?new ol(bs(bs({},r),{},{retryConfig:r.websocketRetryConfig}),n):this.store.useDataChannel?new vs(bs(bs({},r),{},{retryConfig:r.websocketRetryConfig}),n):new cx(bs(bs({},r),{},{retryConfig:r.websocketRetryConfig}),n),this._statsCollector=r.statsCollector,this.role=r.role||"audience",this._clientRoleOptions=r.clientRoleOptions,this.handleSignalEvents()}join(n,r,s){var c=this;return x(function*(){if(c.signal instanceof vs){let _=!1;"disabled"!==n.cloudProxyServer?(w.debug("[".concat(c.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(n.cloudProxyServer,")")),_=!0):"".concat(n.apResponse.cid,"_").concat(n.apResponse.cert).length>255||"".concat(n.apResponse.cid,"_").concat(n.apResponse.cert).length<22?(w.debug("[".concat(c.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),_=!0):n.apResponse.addresses.some(g=>g.fingerprint)||B("FINGERPRINT")||(w.debug("[".concat(c.store.clientId,"] Dc is not supported, because fingerprint does not exist")),_=!0),_&&c.resetSignal()}c.store.joinGatewayStart(),"disabled"!==n.cloudProxyServer&&(c.hasChangeBGPAddress=!0);const d=Date.now();let h=qE.get(n.cname);if(h||(h=new Map,qE.set(n.cname,h)),c._isProactiveJoin=!0,h.has(n.uid)){const _=new G(M.UID_CONFLICT);throw Se.joinGateway(n.sid,{lts:d,succ:!1,ec:_.message,addr:null,uid:n.uid,cid:n.cid,firstSuccess:c._isProactiveJoin,avoidJoinStartTime:c.store.avoidJoinStart,isProxy:!!n.proxyServer,signalChannel:c.signal instanceof vs?"1":"0"}),c._isProactiveJoin=!1,_}h.set(n.uid,!0),c.joinInfo=n,c.key=r;let p=0;c.joinGatewayStartTime=d;const m=n.proxyServer;try{let _;if(w.debug("[".concat(c.store.clientId,"] use ").concat(c.signal instanceof vs?"datachannel":"websocket"," join uid ").concat(p)),c.signal instanceof vs)_=yield c.signal.init(n.apResponse.addresses,s);else{const g=n.gatewayAddrs.map(v=>{let{address:b}=v;const[C,N]=b.split(":"),P={host:C,port:N};return n.proxyServer&&(P.proxy=n.proxyServer),P});_=yield c.signal.init(g,s)}p=_.uid,w.debug("[".concat(c.store.clientId,"] ").concat(c.signal instanceof vs?"datachannel":"websocket"," join uid ").concat(p," cost ").concat(Date.now()-c.joinGatewayStartTime))}catch(_){throw _&&_.code===M.INIT_WEBSOCKET_TIMEOUT?(w.warning("[".concat(c.store.clientId,"] User join failed"),_.toString()),_):_&&_.code===M.INIT_DATACHANNEL_TIMEOUT?(w.warning("[".concat(c.store.clientId,"] User join datachannel failed"),_.toString()),c.resetSignal(),_):(w.error("[".concat(c.store.clientId,"] User join failed"),_.toString()),Se.joinGateway(n.sid,{lts:d,succ:!1,ec:_.message,addr:c.signal.url,uid:n.uid,cid:n.cid,firstSuccess:c._isProactiveJoin,avoidJoinStartTime:c.store.avoidJoinStart,isProxy:!!m,signalChannel:c.signal instanceof vs?"1":"0"}),c._isProactiveJoin=!1,h.delete(n.uid),c.signal.close(),_)}return c.state="CONNECTED",c.inChannelInfo.joinAt=Date.now(),w.debug("[".concat(c.store.clientId,"] Connected to gateway server")),c.trafficStatsInterval=window.setInterval(()=>{c.updateTrafficStats().catch(_=>{w.warning("[".concat(c.store.clientId,"] get traffic stats error"),_.toString())})},3e3),c.networkQualityInterval=window.setInterval(()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?c.emit(on.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):c.emit(on.NETWORK_QUALITY,c._signalTimeout?{downlinkNetworkQuality:5,uplinkNetworkQuality:5}:"CONNECTED"===c.state&&c._statsCollector.trafficStats?{uplinkNetworkQuality:dL(c._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:dL(c._statsCollector.trafficStats.B_dnq)}:{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),c.store.joinGatewayEnd(),p})()}leave(){var n=arguments,r=this;return x(function*(){let s=n.length>0&&void 0!==n[0]&&n[0],c=n.length>1?n[1]:void 0;if("DISCONNECTED"!==r.state){c!==Xe.FALLBACK&&(r.state="DISCONNECTING");try{s||r.signal.connectionState!==qe.CONNECTED||(yield(d=r.signal.request(be.LEAVE,void 0,!0),3e3,z.race([d,Dk(3e3)])))}catch(d){w.warning("[".concat(r.store.clientId,"] leave request failed, ignore"),d)}r.signal.close(c),c!==Xe.FALLBACK&&(r.state="DISCONNECTED"),r.reset()}var d})()}publish(n,r,s){var c=this;return x(function*(){if("CONNECTED"!==c.state&&"RECONNECTING"!==c.state)throw new G(M.INVALID_OPERATION,"can not publish when connection state is ".concat(c.state));const d={state:"offer",p2p_id:c.store.p2pId,ortc:r,mode:c.spec.mode,extend:B("PUB_EXTEND"),twcc:!!B("PUBLISH_TWCC"),rtx:!!B("USE_PUB_RTX")};try{return(yield c.signal.request(be.PUBLISH,d,!0))._message}catch(h){if(s&&h.data&&h.data.code===Ce.ERR_PUBLISH_REQUEST_INVALID)return w.warning("[".concat(c.store.clientId,"] receive publish error code, retry"),h.toString()),yield c.tryUnpubBeforeRepub(n,r),c.publish(n,r,!1);throw h}})()}publishDataChannel(n,r,s){var c=this;return x(function*(){var d;if("CONNECTED"!==c.state&&"RECONNECTING"!==c.state)throw new G(M.INVALID_OPERATION,"can not publish when connection state is ".concat(c.state));const h={stream_id:r.streamId,ordered:r.ordered?1:0,max_retrans_times:null!==(d=r.maxRetransmits)&&void 0!==d?d:10,channel_id:r.channelId,metadata:r.metadata};try{yield c.signal.request(be.PUBLISH_DATASTREAM,h,!0)}catch(p){if(s&&p.data&&p.data.code===Ce.ERR_PUBLISH_REQUEST_INVALID)return w.warning("[".concat(c.store.clientId,"] receive publish datachannels error code, retry"),p.toString()),yield c.tryUnpubDataChannelBeforeRepub(n,r),c.publishDataChannel(n,r,!1);throw p}})()}unpublish(n,r){var s=this;return x(function*(){try{if("CONNECTED"!==s.state&&"RECONNECTING"!==s.state)throw new G(M.INVALID_OPERATION,"can not publish when connection state is ".concat(s.state));yield s.signal.request(be.UNPUBLISH,{stream_id:r,ortc:n},!0)}catch(c){w.warning("[".concat(s.store.clientId,"] unpublish warning: "),c)}})()}unpublishDataChannel(n){var r=this;return x(function*(){try{if("CONNECTED"!==r.state&&"RECONNECTING"!==r.state)throw new G(M.INVALID_OPERATION,"can not publish when connection state is ".concat(r.state));yield z.all(n.map(s=>r.signal.request(be.UNPUBLISH_DATASTREAM,{channel_id:s},!0)))}catch(s){w.warning("unpublish datachannels warning: ",s)}})()}subscribe(n,r,s){var c=this;return x(function*(){if("CONNECTED"!==c.state&&"RECONNECTING"!==c.state)throw new G(M.INVALID_OPERATION,"can not subscribe when connection state is ".concat(c.state));const d={stream_id:n,stream_type:r.stream_type,mode:c.spec.mode,codec:c.spec.codec,p2p_id:c.store.p2pId,twcc:!!B("SUBSCRIBE_TWCC"),rtx:!!B("USE_SUB_RTX"),extend:B("SUB_EXTEND"),ssrcId:r.ssrcId,svc:Array.isArray(B("SVC"))&&0!==B("SVC").length?B("SVC"):void 0};try{return(yield c.signal.request(be.SUBSCRIBE,d,!0))._message}catch(h){if(s&&h.data&&h.data.code===Ce.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(c.store.clientId,"] receiver subscribe error code, retry"),h.toString()),yield c.tryUnsubBeforeResub(n,r),yield c.subscribe(n,r,!1);throw h}})()}subscribeDataChannel(n,r,s){var c=this;return x(function*(){if("CONNECTED"!==c.state&&"RECONNECTING"!==c.state)throw new G(M.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(c.state));const d={uid:n,stream_id:r.id,channel_id:r.datachannelId};try{return void(yield c.signal.request(be.SUBSCRIBE_DATASTREAM,d,!0))}catch(h){if(s&&h.data&&h.data.code===Ce.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(c.store.clientId,"] receiver subscribe datachannel error code, retry"),h.toString()),yield c.tryUnsubDataChannelBeforeResub(n,r),yield c.subscribeDataChannel(n,r,!1);throw h}})()}subscribeAll(n,r){var s=this;return x(function*(){if("CONNECTED"!==s.state&&"RECONNECTING"!==s.state)throw new G(M.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(s.state));const c={p2p_id:s.store.p2pId,users:n,dtx:!1,rtx:!!B("USE_SUB_RTX")};try{return yield s.signal.request(be.SUBSCRIBE_STREAMS,c,!0)}catch(d){if(r&&d.data&&d.data.code===Ce.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(s.store.clientId,"] receiver massSubscribe error code, retry"),d.toString()),yield s.tryMassUnsubBeforeResub(n),yield s.subscribeAll(n,!1);throw d}})()}setVideoProfile(n){var r=this;return x(function*(){const s=function(c){if(!(c.bitrateMax&&c.bitrateMin&&c.frameRate&&c.height&&c.width))return;let d=c.frameRate,h=c.width,p=c.height,m=!0;return"number"!=typeof d&&(d=d.exact||d.ideal||d.max||d.min||0,d||(m=!1)),"number"!=typeof h&&(h=h.exact||h.ideal||h.max||h.min||0,h||(m=!1)),"number"!=typeof p&&(p=p.exact||p.ideal||p.max||p.min||0,d||(m=!1)),m?{stream_type:0,width:h,height:p,fps:d,start_bps:1e3*c.bitrateMax,min_bps:1e3*c.bitrateMin,target_bps:1e3*c.bitrateMax}:void 0}(n);if(s)return r.signal.request(be.SET_VIDEO_PROFILE,s);w.debug("[".concat(r.store.clientId,"] encoder config is not complete, do not report to gateway"))})()}unsubscribe(n,r){var s=this;return x(function*(){try{yield s.signal.request(be.UNSUBSCRIBE,{p2p_id:s.store.p2pId,ortc:n,stream_id:r},!0)}catch(c){w.warning("[".concat(s.store.clientId,"] unsubscribe warning: "),c)}})()}unsubscribeDataChannel(n,r){var s=this;return x(function*(){try{if("CONNECTED"!==s.state&&"RECONNECTING"!==s.state)throw new G(M.INVALID_OPERATION,"can not publish when connection state is ".concat(s.state));yield z.all(n.map(c=>s.signal.request(be.UNSUBSCRIBE_DATASTREAM,{stream_id:c,uid:r},!0)))}catch(c){w.warning("unsubscribeDataChannel warning: ",c)}})()}massUnsubscribe(n){var r=this;return x(function*(){try{yield r.signal.request(be.UNSUBSCRIBE_STREAMS,n,!0)}catch(s){w.warning("[".concat(r.store.clientId,"] massUnsubscribeAll warning: "),s)}})()}reconnectPC(n){var r=this;return x(function*(){const{iceParameters:s,dtlsParameters:c,rtpCapabilities:d}=n;return{gatewayEstablishParams:yield r.signal.request(be.CONNECT_PC,{p2p_id:r.store.p2pId,stream_id:r.store.uid,ortc:{iceParameters:s,dtlsParameters:c,rtpCapabilities:d}},!0),gatewayAddress:r.getCurrentGatewayAddress()}})()}getGatewayInfo(){return this.signal.request(be.GATEWAY_INFO)}renewToken(n){var r=this;return x(function*(){yield r.signal.request(be.RENEW_TOKEN,n),r.key=n.token})()}setClientRole(n,r){var s=this;return x(function*(){if(r&&(s._clientRoleOptions=Object.assign({},r)),"CONNECTED"!==s.state)return void(s.role=n);let c,d=0;"audience"===n?s._clientRoleOptions&&s._clientRoleOptions.delay?(c=s._clientRoleOptions.delay,d=1):d=s._clientRoleOptions&&s._clientRoleOptions.level?s._clientRoleOptions.level:2:d=0,yield s.signal.request(be.SET_CLIENT_ROLE,{role:n,level:d,delay:c,client_ts:Date.now()}),s.role=n})()}setRemoteVideoStreamType(n,r){var s=this;return x(function*(){yield s.signal.request(be.SWITCH_VIDEO_STREAM,{stream_id:n,stream_type:r})})()}setDefaultRemoteVideoStreamType(n){var r=this;return x(function*(){yield r.signal.request(be.DEFAULT_VIDEO_STREAM,{stream_type:n})})()}setStreamFallbackOption(n,r){var s=this;return x(function*(){yield s.signal.request(be.SET_FALLBACK_OPTION,{stream_id:n,fallback_type:r})})()}pickSVCLayer(n,r){var s=this;return x(function*(){yield s.signal.request(be.PICK_SVC_LAYER,{stream_id:n,spatial_layer:r.spatialLayer,temporal_layer:r.temporalLayer})})()}setRTM2Flag(n){var r=this;return x(function*(){yield r.signal.request(be.SET_RTM2_FLAG,{rtm2_flag:n})})()}sendExtensionMessage(n,r,s){var c=this;return x(function*(){if(c.signal instanceof ol)return c.signal.sendExtensionMessage(n,r,s)})()}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),bs({},this.inChannelInfo)}getGatewayVersion(){var n=this;return x(function*(){return(yield n.signal.request(be.GATEWAY_INFO)).version})()}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const n=qE.get(this.joinInfo.cname);n&&n.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const n=function(r){let s;return s=r.startsWith("dc")?r.match(/(dc\:\/\/)?([^:]+):(\d+)/):r.match(/(wss\:\/\/)?([^:]+):(\d+)/),s?{username:Fo.username,password:Fo.password,turnServerURL:s[2],tcpport:parseInt(s[3])+30,udpport:parseInt(s[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],n&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(bs(bs({},Fo),{},{turnServerURL:n.turnServerURL,tcpport:n.tcpport,udpport:n.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}updateTrafficStats(){var n=this;return x(function*(){if("CONNECTED"!==n.state)return;const r=yield n.signal.request(be.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),null!=r.ntp_offset&&(n.ntpOffset=r.ntp_offset),r.peer_delay.forEach(s=>{const c=n._statsCollector.trafficStats&&n._statsCollector.trafficStats.peer_delay.find(d=>d.peer_uid===s.peer_uid);c&&c.B_st!==s.B_st&&ao(()=>{n.emit(on.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),n._statsCollector.updateTrafficStats(r)})()}getJoinMessage(n){if(!this.joinInfo||!this.key)throw new G(M.UNEXPECTED_ERROR,"can not generate join message, no join info");const r=Object.assign({},this.joinInfo.apResponse);let s=B("REPORT_APP_SCENARIO");if("string"!=typeof s)try{s=JSON.stringify(s)}catch{s=void 0}s&&s.length>128&&(s=void 0);const c=bs({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Lo,browser:navigator.userAgent,process_id:B("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:r,extend:B("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s,attributes:{userAttributes:{enablePublishedUserList:B("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:B("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:"number"==typeof B("SUBSCRIBE_AUDIO_FILTER_TOPN")?B("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:"boolean"==typeof B("ENABLE_PUBLISH_AUDIO_FILTER")?B("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:"boolean"==typeof B("ENABLE_USER_LICENSE_CHECK")?B("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:!0===B("USE_PUB_RTX")||!0===B("USE_SUB_RTX")||void 0,disableFEC:B("DISABLE_FEC"),enableNTPReport:!!B("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!B("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:"boolean"==typeof B("ENABLE_DATASTREAM_2")?B("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:"number"==typeof B("RTM2_FLAG")?B("RTM2_FLAG"):void 0,enableUserAutoRebalanceCheck:!!B("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:"boolean"==typeof B("USE_XR")?B("USE_XR"):void 0}},join_ts:this.joinGatewayStartTime},n);return this.joinInfo.stringUid&&(c.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(c.aes_mode=this.joinInfo.aesmode,B("ENCRYPT_AES")?(c.aes_secret=this.joinInfo.aespassword,c.aes_encrypt=!0):c.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(c.aes_salt=this.joinInfo.aessalt)),r.addresses[this.signal.websocket.currentURLIndex]&&(c.ap_response.ticket=r.addresses[this.signal.websocket.currentURLIndex].ticket,delete r.addresses),void 0!==this.joinInfo.defaultVideoStream&&(c.default_video_stream=this.joinInfo.defaultVideoStream),c}getRejoinMessage(){if(!this.joinInfo)throw new G(M.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){var n=this;this.signal.on(le.WS_RECONNECT_WAITTING_FINISH,r=>{var s;Re(s=["tryNext","recover"]).call(s,r)&&this.joinInfo&&Se.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(le.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(le.WS_RECONNECTING,r=>{this.joinInfo&&Se.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||Xn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Se.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(le.WS_CLOSED,r=>{let s;switch(r){case Xe.LEAVE:s=Xn.LEAVE;break;case Xe.UID_BANNED:case Xe.IP_BANNED:case Xe.CHANNEL_BANNED:case Xe.SERVER_ERROR:s=Xn.SERVER_ERROR;break;case Xe.FALLBACK:s=Xn.FALLBACK;break;case Xe.LICENSE_MISSING:case Xe.LICENSE_EXPIRED:case Xe.LICENSE_MINUTES_EXCEEDED:case Xe.LICENSE_PERIOD_INVALID:case Xe.LICENSE_MULTIPLE_SDK_SERVICE:case Xe.LICENSE_ILLEGAL:case Xe.TOKEN_EXPIRE:s=r;break;default:s=Xn.NETWORK_ERROR}w.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+Xn.NETWORK_ERROR)),this.joinInfo&&Se.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===Xe.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=r,r!==Xe.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(le.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&("audience"===this.role&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(w.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),Se.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof vs?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion)){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void w.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));kt("EVENT_REPORT_DOMAIN",r[1]),kt("EVENT_REPORT_BACKUP_DOMAIN",r[1]),kt("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}),this.signal.on(me.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(le.REQUEST_RECOVER,(r,s,c)=>{if(!this.joinInfo)return c(new G(M.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Qt(this,on.REQUEST_NEW_GATEWAY_LIST).then(s).catch(c)}),this.signal.on(le.REQUEST_JOIN_INFO,function(){var r=x(function*(s){var c;if(n.updateTurnConfigFromSignal(),n.store.useP2P)return void s(n.getJoinMessage({ortc:{}}));const{iceParameters:d,dtlsParameters:h,rtpCapabilities:p}=yield Qt(n,on.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:null===(c=n.joinInfo)||void 0===c?void 0:c.turnServer});s(n.getJoinMessage({ortc:{iceParameters:d,dtlsParameters:h,rtpCapabilities:p,version:"2"}}))});return function(s){return r.apply(this,arguments)}}()),this.signal.on(le.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(le.REPORT_JOIN_GATEWAY,(r,s)=>{this.joinInfo&&(Se.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof vs?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(le.IS_P2P_DISCONNECTED,r=>{r(rc(this,on.IS_P2P_DISCONNECTED))}),this.signal.on(le.DISCONNECT_P2P,()=>{this.emit(on.DISCONNECT_P2P)}),this.signal.on(le.NEED_RENEW_SESSION,()=>{this.emit(on.NEED_RENEW_SESSION)}),this.signal.on(le.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(le.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(le.JOIN_RESPONSE,r=>{const s=this.getCurrentGatewayAddress();this.emit(on.JOIN_RESPONSE,r,s)}),this.signal.on(le.DATACHANNEL_PRECONNECT,function(){var r=x(function*(s,c,d){n.updateTurnConfigFromSignal();const h=n.getCurrentGatewayAddress();return Qt(n,on.DATACHANNEL_PRECONNECT,s,h).then(c).catch(d)});return function(s,c,d){return r.apply(this,arguments)}}()),this.signal.on(le.DATACHANNEL_CONNECTING,function(){var r=x(function*(s){const{iceParameters:c,dtlsParameters:d,rtpCapabilities:h}=yield Qt(n,on.REQUEST_DC_CONNECTION_PARAMS);s(n.getJoinMessage({ortc:{iceParameters:c,dtlsParameters:d,rtpCapabilities:h,version:"2"}}))});return function(s){return r.apply(this,arguments)}}()),this.signal.on(le.DATACHANNEL_FAILBACK,()=>{w.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(on.DATACHANNEL_FAILBACK)})}tryUnsubBeforeResub(n,r){var s=this;return x(function*(){try{yield s.signal.request(be.UNSUBSCRIBE,{p2p_id:s.store.p2pId,stream_id:n,ortc:[r]},!0)}catch(c){throw w.warning("[".concat(s.store.clientId,"] tryUnsubBeforeResub warning"),c),c}})()}tryUnsubDataChannelBeforeResub(n,r){var s=this;return x(function*(){try{yield s.signal.request(be.UNSUBSCRIBE,{stream_id:r.id},!0)}catch(c){throw w.warning("unsubscribe datachannel warning",c),c}})()}tryUnpubBeforeRepub(n,r){var s=this;return x(function*(){try{yield s.signal.request(be.UNPUBLISH,{stream_id:n,ortc:r},!0)}catch(c){throw w.warning("[".concat(s.store.clientId,"] tryUnpubBeforeRepub warning: "),c),c}})()}tryUnpubDataChannelBeforeRepub(n,r){var s=this;return x(function*(){try{yield s.signal.request(be.UNPUBLISH_DATASTREAM,{channnel_id:r.channelId},!0)}catch(c){throw w.warning("unpublish datastream warning: ",c),c}})()}tryMassUnsubBeforeResub(n){var r=this;return x(function*(){const s={users:n.map(c=>({stream_id:c.stream_id,stream_type:c.stream_type}))};try{yield r.signal.request(be.UNSUBSCRIBE_STREAMS,s,!0)}catch(c){throw w.warning("[".concat(r.store.clientId,"] tryMassUnsubBeforeResub warning"),c),c}})()}muteLocal(n,r){var s=this;return x(function*(){const c={action:n.find(d=>d.stream_type===gt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:s.store.p2pId,ortc:n,stream_id:r};try{yield s.signal.request(be.CONTROL,c,!0,!0)}catch(d){throw w.warning("[".concat(s.store.clientId,"] gateway muteLocal warning: "),d),d}})()}unmuteLocal(n,r){var s=this;return x(function*(){const c={action:n.find(d=>d.stream_type===gt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:s.store.p2pId,ortc:n,stream_id:r};try{yield s.signal.request(be.CONTROL,c,!0,!0)}catch(d){throw w.warning("[".concat(s.store.clientId,"] gateway unmuteLocal warning: "),d),d}})()}muteRemote(n,r){var s=this;return x(function*(){const c={action:n===ge.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:s.store.p2pId,stream_id:r};try{yield s.signal.request(be.CONTROL,c,!0,!0)}catch(d){throw w.warning("[".concat(s.store.clientId,"] gateway muteRemote warning: "),d),d}})()}unmuteRemote(n,r){var s=this;return x(function*(){const c={action:n===ge.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:s.store.p2pId,stream_id:r};try{yield s.signal.request(be.CONTROL,c,!0,!0)}catch(d){throw w.warning("[".concat(s.store.clientId,"] gateway unmuteRemote warning: "),d),d}})()}uploadStats(n,r){this.signal.upload(n,r)}getSignalRTT(){return this.signal.rtt}restartICE(n){var r=this;return x(function*(){const s={p2p_id:r.store.p2pId,stream_id:r.store.uid,ortc:n};try{return yield r.signal.request(be.RESTART_ICE,s,!0)}catch(c){throw w.warning("[".concat(r.store.clientId,"] P2PChannel.restartICE warning: "),c),c}})()}reconnect(){"CONNECTED"===this.state&&this.signal.reconnect(void 0,Xn.P2P_FAILED)}getCurrentGatewayAddress(){var n;if(!B("GATEWAY_WSS_ADDRESS"))return null!==(n=this.joinInfo)&&void 0!==n&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}setPublishAudioFilterEnabled(n){var r=this;return x(function*(){yield r.signal.request(be.SET_PARAMETER,{enablePublishAudioFilter:n})})()}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(Xe.FALLBACK)),this.store.useDataChannel=!1,this.signal=new cx(bs(bs({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(on.RESET_SIGNAL,Af.websocket)}}let YE=0,KC=0;function Ss(o,n,r,s){return new z((c,d)=>{n.timeout=n.timeout||B("HTTP_CONNECT_TIMEOUT"),n.responseType=n.responseType||"json",n.data&&!r?(n.data=JSON.stringify(n.data),YE+=ya(n.data)):r&&(n.data.size?YE+=n.data.size:n.data instanceof FormData?YE+=SA(n.data):YE+=ya(JSON.stringify(n.data))),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json",n.method="POST",n.url=o,Tr.request(n).then(h=>{"string"==typeof h.data?KC+=ya(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?KC+=h.data.byteLength:KC+=ya(JSON.stringify(h.data)),s&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{Tr.isCancel(h)?d(new G(M.OPERATION_ABORTED,"cancel token canceled")):d("ECONNABORTED"===h.code?new G(M.NETWORK_TIMEOUT,h.message):h.response?new G(M.NETWORK_RESPONSE_ERROR,h.response.status):new G(M.NETWORK_ERROR,h.message))})})}!function(){var o;function n(ne){var ae=0;return function(){return ae<ne.length?{done:!1,value:ne[ae++]}:{done:!0}}}var s,r="function"==typeof Object.defineProperties?Object.defineProperty:function(ne,ae,_e){return ne==Array.prototype||ne==Object.prototype||(ne[ae]=_e.value),ne},c=function(ne){ne=["object"==typeof globalThis&&globalThis,ne,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof su&&su];for(var ae=0;ae<ne.length;++ae){var _e=ne[ae];if(_e&&_e.Math==Math)return _e}throw Error("Cannot find global object")}(this);function d(ne,ae){if(ae)e:{var _e=c;ne=ne.split(".");for(var xe=0;xe<ne.length-1;xe++){var ht=ne[xe];if(!(ht in _e))break e;_e=_e[ht]}(ae=ae(xe=_e[ne=ne[ne.length-1]]))!=xe&&null!=ae&&r(_e,ne,{configurable:!0,writable:!0,value:ae})}}function h(ne){return(ne={next:ne})[Symbol.iterator]=function(){return this},ne}function p(ne){var ae=typeof Symbol<"u"&&Symbol.iterator&&ne[Symbol.iterator];return ae?ae.call(ne):{next:n(ne)}}if(d("Symbol",function(ne){function ae(ht,de){this.A=ht,r(this,"description",{configurable:!0,writable:!0,value:de})}if(ne)return ne;ae.prototype.toString=function(){return this.A};var _e="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",xe=0;return function ht(de){if(this instanceof ht)throw new TypeError("Symbol is not a constructor");return new ae(_e+(de||"")+"_"+xe++,de)}}),d("Symbol.iterator",function(ne){if(ne)return ne;ne=Symbol("Symbol.iterator");for(var ae="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),_e=0;_e<ae.length;_e++){var xe=c[ae[_e]];"function"==typeof xe&&"function"!=typeof xe.prototype[ne]&&r(xe.prototype,ne,{configurable:!0,writable:!0,value:function(){return h(n(this))}})}return ne}),"function"==typeof Object.setPrototypeOf)s=Object.setPrototypeOf;else{var m;e:{var _={};try{_.__proto__={a:!0},m=_.a;break e}catch{}m=!1}s=m?function(ne,ae){if(ne.__proto__=ae,ne.__proto__!==ae)throw new TypeError(ne+" is not extensible");return ne}:null}var g=s;function v(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function b(ne){if(ne.m)throw new TypeError("Generator is already running");ne.m=!0}function C(ne,ae){return ne.h=3,{value:ae}}function N(ne){this.g=new v,this.G=ne}function P(ne,ae,_e,xe){try{var ht=ae.call(ne.g.j,_e);if(!(ht instanceof Object))throw new TypeError("Iterator result "+ht+" is not an object");if(!ht.done)return ne.g.m=!1,ht;var de=ht.value}catch(I){return ne.g.j=null,ne.g.s(I),D(ne)}return ne.g.j=null,xe.call(ne.g,de),D(ne)}function D(ne){for(;ne.g.h;)try{var ae=ne.G(ne.g);if(ae)return ne.g.m=!1,{value:ae.value,done:!1}}catch(_e){ne.g.v=void 0,ne.g.s(_e)}if(ne.g.m=!1,ne.g.l){if(ae=ne.g.l,ne.g.l=null,ae.F)throw ae.D;return{value:ae.return,done:!0}}return{value:void 0,done:!0}}function k(ne){this.next=function(ae){return ne.o(ae)},this.throw=function(ae){return ne.s(ae)},this.return=function(ae){return function(_e,xe){b(_e.g);var ht=_e.g.j;return ht?P(_e,"return"in ht?ht.return:function(de){return{value:de,done:!0}},xe,_e.g.return):(_e.g.return(xe),D(_e))}(ne,ae)},this[Symbol.iterator]=function(){return this}}function V(ne,ae){return ae=new k(new N(ae)),g&&ne.prototype&&g(ae,ne.prototype),ae}if(v.prototype.o=function(ne){this.v=ne},v.prototype.s=function(ne){this.l={D:ne,F:!0},this.h=this.C||this.u},v.prototype.return=function(ne){this.l={return:ne},this.h=this.u},N.prototype.o=function(ne){return b(this.g),this.g.j?P(this,this.g.j.next,ne,this.g.o):(this.g.o(ne),D(this))},N.prototype.s=function(ne){return b(this.g),this.g.j?P(this,this.g.j.throw,ne,this.g.o):(this.g.s(ne),D(this))},d("Array.prototype.entries",function(ne){return ne||function(){return function(ae,_e){ae instanceof String&&(ae+="");var xe=0,ht=!1,de={next:function(){if(!ht&&xe<ae.length){var I=xe++;return{value:_e(I,ae[I]),done:!1}}return ht=!0,{done:!0,value:void 0}}};return de[Symbol.iterator]=function(){return de},de}(this,function(ae,_e){return[ae,_e]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var U=function(ne,ae){for(var _e=0;_e<ne.length;_e++)ae(ne[_e])},Y=function(ne){return ne.replace(/\r?\n|\r/g,"\r\n")},oe=function(ne,ae,_e){return ae instanceof Blob?(_e=void 0!==_e?String(_e+""):"string"==typeof ae.name?ae.name:"blob",ae.name===_e&&"[object Blob]"!==Object.prototype.toString.call(ae)||(ae=new File([ae],_e)),[String(ne),ae]):[String(ne),String(ae)]},K=function(ne,ae){if(ne.length<ae)throw new TypeError(ae+" argument required, but only "+ne.length+" present.")},X="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,$=X.FormData,J=X.XMLHttpRequest&&X.XMLHttpRequest.prototype.send,ve=X.Request&&X.fetch,ye=X.navigator&&X.navigator.sendBeacon,Ye=X.Element&&X.Element.prototype,ut=X.Symbol&&Symbol.toStringTag;ut&&(Blob.prototype[ut]||(Blob.prototype[ut]="Blob"),"File"in X&&!File.prototype[ut]&&(File.prototype[ut]="File"));try{new File([],"")}catch{X.File=function(ae,_e,xe){return ae=new Blob(ae,xe||{}),Object.defineProperties(ae,{name:{value:_e},lastModified:{value:+(xe&&void 0!==xe.lastModified?new Date(xe.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),ut&&Object.defineProperty(ae,ut,{value:"File"}),ae}}var yt=function(ne){return ne.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},lt=function(ne){this.i=[];var ae=this;ne&&U(ne.elements,function(_e){if(_e.name&&!_e.disabled&&"submit"!==_e.type&&"button"!==_e.type&&!_e.matches("form fieldset[disabled] *"))if("file"===_e.type){var xe=_e.files&&_e.files.length?_e.files:[new File([],"",{type:"application/octet-stream"})];U(xe,function(ht){ae.append(_e.name,ht)})}else"select-multiple"===_e.type||"select-one"===_e.type?U(_e.options,function(ht){!ht.disabled&&ht.selected&&ae.append(_e.name,ht.value)}):"checkbox"===_e.type||"radio"===_e.type?_e.checked&&ae.append(_e.name,_e.value):(xe="textarea"===_e.type?Y(_e.value):_e.value,ae.append(_e.name,xe))})};if((o=lt.prototype).append=function(ne,ae,_e){K(arguments,2),this.i.push(oe(ne,ae,_e))},o.delete=function(ne){K(arguments,1);var ae=[];ne=String(ne),U(this.i,function(_e){_e[0]!==ne&&ae.push(_e)}),this.i=ae},o.entries=function ne(){var ae,_e=this;return V(ne,function(xe){if(1==xe.h&&(ae=0),3!=xe.h)return ae<_e.i.length?xe=C(xe,_e.i[ae]):(xe.h=0,xe=void 0),xe;ae++,xe.h=2})},o.forEach=function(ne,ae){K(arguments,1);for(var _e=p(this),xe=_e.next();!xe.done;xe=_e.next()){var ht=p(xe.value);xe=ht.next().value,ht=ht.next().value,ne.call(ae,ht,xe,this)}},o.get=function(ne){K(arguments,1);var ae=this.i;ne=String(ne);for(var _e=0;_e<ae.length;_e++)if(ae[_e][0]===ne)return ae[_e][1];return null},o.getAll=function(ne){K(arguments,1);var ae=[];return ne=String(ne),U(this.i,function(_e){_e[0]===ne&&ae.push(_e[1])}),ae},o.has=function(ne){K(arguments,1),ne=String(ne);for(var ae=0;ae<this.i.length;ae++)if(this.i[ae][0]===ne)return!0;return!1},o.keys=function ne(){var ae,_e,de=this;return V(ne,function(I){if(1==I.h&&(ae=p(de),_e=ae.next()),3!=I.h)return _e.done?void(I.h=0):C(I,p(_e.value).next().value);_e=ae.next(),I.h=2})},o.set=function(ne,ae,_e){K(arguments,2),ne=String(ne);var xe=[],ht=oe(ne,ae,_e),de=!0;U(this.i,function(I){I[0]===ne?de&&(de=!xe.push(ht)):xe.push(I)}),de&&xe.push(ht),this.i=xe},o.values=function ne(){var ae,_e,ht,de=this;return V(ne,function(I){if(1==I.h&&(ae=p(de),_e=ae.next()),3!=I.h)return _e.done?void(I.h=0):((ht=p(_e.value)).next(),C(I,ht.next().value));_e=ae.next(),I.h=2})},lt.prototype._asNative=function(){for(var ne=new $,ae=p(this),_e=ae.next();!_e.done;_e=ae.next()){var xe=p(_e.value);_e=xe.next().value,xe=xe.next().value,ne.append(_e,xe)}return ne},lt.prototype._blob=function(){var ne="----formdata-polyfill-"+Math.random(),ae=[],_e="--"+ne+'\r\nContent-Disposition: form-data; name="';return this.forEach(function(xe,ht){return"string"==typeof xe?ae.push(_e+yt(Y(ht))+'"\r\n\r\n'+Y(xe)+"\r\n"):ae.push(_e+yt(Y(ht))+'"; filename="'+yt(xe.name)+'"\r\nContent-Type: '+(xe.type||"application/octet-stream")+"\r\n\r\n",xe,"\r\n")}),ae.push("--"+ne+"--"),new Blob(ae,{type:"multipart/form-data; boundary="+ne})},lt.prototype[Symbol.iterator]=function(){return this.entries()},lt.prototype.toString=function(){return"[object FormData]"},Ye&&!Ye.matches&&(Ye.matches=Ye.matchesSelector||Ye.mozMatchesSelector||Ye.msMatchesSelector||Ye.oMatchesSelector||Ye.webkitMatchesSelector||function(ne){for(var ae=(ne=(this.document||this.ownerDocument).querySelectorAll(ne)).length;0<=--ae&&ne.item(ae)!==this;);return-1<ae}),ut&&(lt.prototype[ut]="FormData"),J){var bt=X.XMLHttpRequest.prototype.setRequestHeader;X.XMLHttpRequest.prototype.setRequestHeader=function(ne,ae){bt.call(this,ne,ae),"content-type"===ne.toLowerCase()&&(this.B=!0)},X.XMLHttpRequest.prototype.send=function(ne){ne instanceof lt?(ne=ne._blob(),this.B||this.setRequestHeader("Content-Type",ne.type),J.call(this,ne)):J.call(this,ne)}}ve&&(X.fetch=function(ne,ae){return ae&&ae.body&&ae.body instanceof lt&&(ae.body=ae.body._blob()),ve.call(this,ne,ae)}),ye&&(X.navigator.sendBeacon=function(ne,ae){return ae instanceof lt&&(ae=ae._asNative()),ye.call(this,ne,ae)}),X.FormData=lt}}();const $E=()=>{const o=B("AREAS");return 0===o.length&&o.push(ot.GLOBAL),_d(o).call(o,(n,r,s)=>{const c=_c(r);return c?0===s?c:"".concat(n,",").concat(c):n},"")},_c=o=>o===ot.OVERSEA?"".concat(ti.ASIA,",").concat(ti.EUROPE,",").concat(ti.AFRICA,",").concat(ti.NORTH_AMERICA,",").concat(ti.SOUTH_AMERICA,",").concat(ti.OCEANIA):ti[o],AO=o=>{const n={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return o.map(r=>{const s=dE[r],c=Object.keys(s);c&&c.map(d=>{"CODE"!==d&&(n[d]=n[d].concat(s[d]))})}),n},Fi={GLOBAL:{ASIA:[ot.CHINA,ot.JAPAN,ot.INDIA,ot.KOREA,ot.HKMC],EUROPE:[],NORTH_AMERICA:[ot.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},$s=Object.keys(Fi[ot.GLOBAL]),qC=[ot.CHINA,ot.NORTH_AMERICA,ot.EUROPE,ot.ASIA,ot.JAPAN,ot.INDIA,ot.OCEANIA,ot.SOUTH_AMERICA,ot.AFRICA,ot.KOREA,ot.HKMC,ot.US],DO=function(o,n){let r=[];if(Re(o).call(o,ot.GLOBAL)){const d=[ot.GLOBAL,ot.OVERSEA],h=Object.keys(dE);if(n===ot.GLOBAL)throw new G(M.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(n===ot.CHINA)r=[ot.OVERSEA];else if(c=n,Re($s).call($s,c)){const p=Fi[ot.GLOBAL][n]||[],m=[...d,n,...p];r=h.filter(_=>!Re(m).call(m,_))}else if(function(p){let m=!1;return $s.forEach(_=>{var g;Re(g=Fi[ot.GLOBAL][_]).call(g,p)&&(m=!0)}),m}(n)){const p=function(_){let g;return $s.forEach(v=>{var b;Re(b=Fi[ot.GLOBAL][v]).call(b,_)&&(g=v)}),g}(n),m=[...d,p,n];r=h.filter(_=>!Re(m).call(m,_))}else r=o;r=function(p){const m=[];return qC.forEach(_=>{Re(p).call(p,_)&&m.push(_)}),m.concat(p.filter(_=>!Re(qC).call(qC,_)))}(r)}else r=o;var c;return r};function YC(o){var n,r;if(!o&&Re(n=B("AREAS")).call(n,ot.EXTENSIONS))return w.debug("update area from ap : reset"),void XE(TU,!0);if(!Re(r=B("AREAS")).call(r,ot.GLOBAL)||!o)return;let s=dE.EXTENSIONS;s&&(s={CODE:_c(ot.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(o,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(o,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(o,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(o,".agora.io"),"cds-ap-web-2-".concat(o,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(o,".agora.io"),"sua-ap-web-2-".concat(o,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(o,".agora.io"),"uap-ap-web-2-".concat(o,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(o,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(o,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(o,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(o,".agora.io")]},w.debug("update area from ap success: ".concat(o,",config is "),s),kt("AREAS",[ot.EXTENSIONS],!0),Object.keys(s).map(c=>{kt(c,"LOG_UPLOAD_SERVER"===c||"EVENT_REPORT_DOMAIN"===c||"EVENT_REPORT_BACKUP_DOMAIN"===c||"PROXY_SERVER_TYPE3"===c?s[c][0]:s[c])}))}function XE(o){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=Se.reportApiInvoke(null,{name:Vn.SET_AREA,options:o,tag:dn.TRACER});try{let s=[];if("string"==typeof o&&(s=[o]),Array.isArray(o)&&(o.forEach(d=>{if(!Re(Df).call(Df,d))throw new G(M.INVALID_PARAMS,"invalid area code")}),s=o),"[object Object]"===Object.prototype.toString.call(o)){const{areaCode:d,excludedArea:h}=o;if(!d)throw new G(M.INVALID_PARAMS,"area code is needed");let p=d;"string"==typeof d&&(p=[d]),s=h?DO(p,h):p}if(!n){if(bd.AREAS){const d=new G(M.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r.onError(d),void w.warning("setArea is prohibited because of config-distribute")}if(Re(s).call(s,ot.GLOBAL)&&B("AREAS")===ot.EXTENSIONS){const d=new G(M.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r.onError(d),void w.warning("setArea is prohibited because of ap extensions")}}kt("AREAS",s,n);const c=AO(s);Object.keys(c).map(d=>{kt(d,"LOG_UPLOAD_SERVER"===d||"EVENT_REPORT_DOMAIN"===d||"EVENT_REPORT_BACKUP_DOMAIN"===d||"PROXY_SERVER_TYPE3"===d?c[d][0]:c[d])}),w.debug("set area success:",s.join(","))}catch(s){throw r.onError(s),s}r.onSuccess()}function $C(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function JE(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?$C(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):$C(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}let QE=1;let ZE=1;function XC(o,n,r,s){let{url:c,areaCode:d}=o;const h=Date.now();let p;const[m,_]=ZC(n,d,[ni.CHOOSE_SERVER]);let g=Rn.networkState;return Ws(x(function*(){g&&Rn.networkState===li.OFFLINE&&Rn.onlineWaiter&&(yield z.race([Rn.onlineWaiter,mi(s&&s.maxRetryTimeout||bn.maxRetryTimeout)])),g=Rn.networkState;const{data:v,headers:b}=yield Ss(c,{data:m,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p="1"===b.http3?1:-1,Se.reportResourceTiming(c,n.sid),JC(v,c,n,h,[ni.CHOOSE_SERVER],p);const C=TO(v,ni.CHOOSE_SERVER);return QC(C),lL(C,c)}),v=>(v&&Se.joinChooseServer(n.sid,{lts:h,succ:!0,csAddr:c,opid:_,serverList:v.gatewayAddrs.map(b=>b.address),ec:null,cid:v.cid.toString(),uid:v.uid.toString(),csIp:v.csIp,unilbsServerIds:[ni.CHOOSE_SERVER].toString(),isHttp3:p}),!1),v=>v.code!==M.OPERATION_ABORTED&&(v.code===M.CAN_NOT_GET_GATEWAY_SERVER?v.data.retry:(Se.joinChooseServer(n.sid,{lts:h,succ:!1,csAddr:c,serverList:null,opid:_,ec:v.code,csIp:v.data&&v.data.csIp,unilbsServerIds:[ni.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:g}),isHttp3:p}),w.warning("[".concat(n.clientId,"] Choose server network error, retry"),v),!0)),s)}function dm(o,n,r,s){let c,{url:d,areaCode:h,serviceIds:p}=o;const m=Date.now(),[_,g]=ZC(n,h,p);let v;return Ws(x(function*(){v&&Rn.networkState===li.OFFLINE&&Rn.onlineWaiter&&(yield z.race([Rn.onlineWaiter,mi(s&&s.maxRetryTimeout||bn.maxRetryTimeout)])),v=Rn.networkState;const{data:b,headers:C}=yield Ss(d,{data:_,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c="1"===C.http3?1:-1,Se.reportResourceTiming(d,n.sid),JC(b,d,n,m,p,c);const N=TO(b,ni.CHOOSE_SERVER),P=TO(b,"proxy5"===n.cloudProxyServer?ni.CLOUD_PROXY_5:"proxy3"===n.cloudProxyServer||"proxy4"===n.cloudProxyServer?ni.CLOUD_PROXY:ni.CLOUD_PROXY_FALLBACK);return QC(N),{gatewayInfo:lL(N,d),proxyInfo:P,url:d}}),b=>(b.gatewayInfo&&Se.joinChooseServer(n.sid,{lts:m,succ:!0,csAddr:d,serverList:b.gatewayInfo.gatewayAddrs.map(C=>C.address),ec:null,opid:g,cid:b.gatewayInfo.cid.toString(),uid:b.gatewayInfo.uid.toString(),csIp:b.gatewayInfo.csIp,unilbsServerIds:p.toString(),isHttp3:c}),b.proxyInfo&&Se.joinWebProxyAP(n.sid,{lts:m,sucess:1,apServerAddr:d,turnServerAddrList:b.proxyInfo.addresses.map(C=>C.ip).join(","),errorCode:null,eventType:n.cloudProxyServer,unilbsServerIds:p.toString()}),!1),b=>b.code!==M.OPERATION_ABORTED&&(b.code===M.CAN_NOT_GET_GATEWAY_SERVER?b.data.retry:(Se.joinWebProxyAP(n.sid,{lts:m,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:b.code,eventType:n.cloudProxyServer,unilbsServerIds:p.toString(),extend:JSON.stringify({networkState:v})}),w.warning("[".concat(n.clientId,"] multi unilbs network error, retry"),b),!0)),s)}const JC=(o,n,r,s,c,d)=>{const h=[],p=m=>{4096===m.flag?Se.joinChooseServer(r.sid,{lts:s,succ:!1,csAddr:n,opid:o.opid,serverList:null,ec:m.error.message,csIp:m.error.data&&m.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:d}):1048576!==m.flag&&4194304!==m.flag&&4194310!==m.flag||Se.joinWebProxyAP(r.sid,{lts:s,sucess:0,apServerAddr:n,turnServerAddrList:null,errorCode:m.error.code,eventType:r.cloudProxyServer,unilbsServerIds:c.toString()})};if(o.response_body.forEach(m=>{const _=m.buffer.code;if(23===m.uri&&0===_&&!m.buffer.edges_services)if(4194310===m.buffer.flag)w.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),m.buffer.edges_services=[];else{const g={error:new G(M.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:o.detail[502]}),flag:m.buffer.flag};h.push(g),p(g)}if(0!==_){const g=wd(_),v={error:new G(M.CAN_NOT_GET_GATEWAY_SERVER,g.desc,{desc:g.desc,retry:g.retry,csIp:o.detail[502]}),flag:m.buffer.flag};4194310===m.buffer.flag?w.warning(v.error.toString()):h.push(v),p(v)}}),h.length)throw w.warning("[".concat(r.clientId,"] multi unilbs ").concat(n," failed, ").concat(h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message,", retry: ").concat(m.error.data.retry)).join(" | "))),new G(M.CAN_NOT_GET_GATEWAY_SERVER,h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message)).join(" | "),{retry:!!h.find(m=>m.error.data.retry),csIp:o.detail[502],desc:[...new Set(h.map(m=>{var _;return null==m||null===(_=m.error)||void 0===_||null===(_=_.data)||void 0===_?void 0:_.desc}).filter(m=>!!m))]})},QC=o=>{var n,r,s,c;if(o.addresses&&0===o.addresses.length&&0===o.code)throw new G(M.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:o.detail&&o.detail[502]});if(B("AP_AREA")&&(null!==(s=o.detail)&&void 0!==s&&s[23]&&"string"==typeof(null===(c=o.detail)||void 0===c?void 0:c[23])?YC(o.detail[23].toLowerCase()):YC()),null!==(n=o.detail)&&void 0!==n&&n[19]&&"string"==typeof(null===(r=o.detail)||void 0===r?void 0:r[19])){const p=o.detail[19]?.split(";");for(let m=0;m<p.length;m++){var d;const _=TD(d=p[m]).call(d);o.addresses[m]&&p&&(o.addresses[m].fingerprint=_)}}if(B("GATEWAY_ADDRESS")&&B("GATEWAY_ADDRESS").length>0){w.debug("assign gateway address to",B("GATEWAY_ADDRESS"));const h=B("GATEWAY_ADDRESS").map(p=>{var m,_;const g=null!==(m=null===(_=o.addresses.find(v=>v.ip===p.ip&&v.port===p.port))||void 0===_?void 0:_.fingerprint)&&void 0!==m?m:"";return{ip:p.ip,port:p.port,ticket:o.addresses[0]&&o.addresses[0].ticket,fingerprint:g}});o.addresses=h}},NO=(o,n)=>{if(o.response_body&&o.response_body.length){const r=o.response_body[0];if(0!==r.buffer.code){const s=wd(r.buffer.code);throw new G(M.UPDATE_TICKET_FAILED,"[".concat(r.buffer.code,"]: ").concat(s.desc),{retry:s.retry})}return r.buffer.ticket}throw w.debug("update ticket request received ap response without response body:",n),new G(M.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},ZC=(o,n,r)=>{const s=Math.floor(1e12*Math.random()),c={appid:o.appId,client_ts:Date.now(),opid:s,sid:o.sid,request_bodies:[{uri:22,buffer:{cname:o.cname,detail:JE({6:o.stringUid,11:n,12:B("USE_NEW_TOKEN")?"1":void 0,22:n},B("AP_RTM")?{26:"RTM2"}:{}),key:o.token,service_ids:r,uid:o.uid||0}}]};c.request_bodies.forEach(h=>{o.multiIP&&o.multiIP.gateway_ip&&(h.buffer.detail[5]=JSON.stringify({vocs_ip:[o.multiIP.uni_lbs_ip],vos_ip:[o.multiIP.gateway_ip]}))});const d=new FormData;return d.append("request",JSON.stringify(c)),[d,s]},pL=(o,n)=>{const r=Math.floor(1e12*Math.random()),s={appid:o.appId,client_ts:Date.now(),opid:r,sid:o.sid,request_bodies:[{uri:28,buffer:{cname:o.cname,detail:{1:"",6:o.stringUid,12:"1"},token:o.token,service_ids:n,uid:o.uid||0,edges_services:o.apResponse.addresses.map(d=>({ip:d.ip,port:d.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(s)),[c,r]};let Vd=0;function Bd(o){return z.all(o.map(n=>n.then(r=>{throw r},r=>r))).then(n=>{throw n},n=>n)}const jd=function(){var o=x(function*(n){let{fragementLength:r,referenceList:s,asyncMapHandler:c,allFailedhandler:d,promisesCollector:h}=n,p=0;const m=r;let _,g=0;const v=function(){var b=x(function*(){const C=(()=>{const N=p*m;return s.slice(N,N+m).map(c)})();h&&h.push(...C);try{_=yield Bd(C)}catch(N){if(g+=m,p++,!(g>=s.length))return void(yield v());d(N)}C.forEach(N=>N.cancel())});return function(){return b.apply(this,arguments)}}();return yield v(),_});return function(r){return o.apply(this,arguments)}}();function ev(o,n,r,s){return um.apply(this,arguments)}function um(){return um=x(function*(o,n,r,s){return{gatewayInfo:yield(d=x(function*(h,p,m,_){let g=null;const v=[],b=function(){var N=x(function*(){const P=B("WEBCS_DOMAIN").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(V=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(V+"/api/v2/transpond/webrtc?v=2"):"https://".concat(V,"/api/v2/transpond/webrtc?v=2"),areaCode:$E()})),D=_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(V=>V.url)}),k=yield jd({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:V=>(w.debug("[".concat(h.clientId,"] Connect to choose_server:"),V.url),XC(V,h,p,m)),allFailedhandler:V=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},D),V[0]},promisesCollector:v});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},D),k});return function(){return N.apply(this,arguments)}}(),C=function(){var N=x(function*(){if(yield mi(1e3),null!==g)return g;const P=B("WEBCS_DOMAIN_BACKUP_LIST").map(V=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(V+"/api/v2/transpond/webrtc?v=2"):"https://".concat(V,"/api/v2/transpond/webrtc?v=2"),areaCode:$E()})),D=_.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(V=>V.url)}),k=yield jd({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:V=>(w.debug("[".concat(h.clientId,"] Connect to backup choose_server:"),V.url),XC(V,h,p,m)),allFailedhandler:V=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},D),V[0]},promisesCollector:v});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},D),k});return function(){return N.apply(this,arguments)}}();try{return g=yield Bd([b(),C()]),v.length&&v.forEach(N=>N.cancel&&"function"==typeof N.cancel&&N.cancel()),g}catch(N){throw N[0]}}),function(h,p,m,_){return d.apply(this,arguments)})(o,n,r,s)};var d}),um.apply(this,arguments)}function eT(o,n,r,s,c){return tv.apply(this,arguments)}function tv(){return tv=x(function*(o,n,r,s,c){const d=o.cloudProxyServer;if("disabled"===d){if(!s)return;if(o.useLocalAccessPoint)return yield ev(o,n,r,c);if(B("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:_,proxyInfo:g}=yield nT(o,n,r,c);return o.turnServer&&"auto"!==o.turnServer.mode||(o.turnServer={mode:"manual",servers:g.map(v=>({turnServerURL:v.address,tcpport:v.tcpport||Fo.tcpport,udpport:v.udpport||Fo.udpport,username:v.username||Fo.username,password:v.password||Fo.password,forceturn:!1,security:!0}))}),{gatewayInfo:_}}return yield ev(o,n,r,c)}const{proxyInfo:h,gatewayInfo:p}=yield nT(o,n,r,c),m={gatewayInfo:p};return o.turnServer={mode:"manual",servers:h.map(_=>({turnServerURL:_.address,tcpport:"proxy3"===d?void 0:_.tcpport?_.tcpport:Fo.tcpport,udpport:"proxy4"===d?void 0:_.udpport?_.udpport:Fo.udpport,username:_.username||Fo.username,password:_.password||Fo.password,forceturn:"proxy4"!==d,security:"proxy5"===d}))},w.debug("[".concat(o.clientId,"] set proxy server: ").concat(o.proxyServer,", mode: ").concat(d)),m}),tv.apply(this,arguments)}function tT(o,n,r,s,c){return hm.apply(this,arguments)}function hm(){return hm=x(function*(o,n,r,s,c){let h=[];h=B("ACCOUNT_REGISTER").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(n.proxyServer?m=>"https://".concat(n.proxyServer,"/ap/?url=").concat(m+"/api/v1"):m=>"https://".concat(m,"/api/v1"));const p=c?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const m=yield(_=x(function*(g,v,b,C,N){const P=Date.now(),D={sid:b.sid,opid:10,appid:b.appId,string_uid:v};let k=g[0];const V=yield Ws(()=>Ss(k+"".concat(-1===k.indexOf("?")?"?":"&","action=stringuid"),{data:D,cancelToken:C,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(U,Y)=>{if(0===U.code){if(U.uid<=0||U.uid>=Math.pow(2,32))throw w.error("Invalid Uint Uid ".concat(v," => ").concat(U.uid),U),Se.reqUserAccount(D.sid,{lts:P,success:!1,serverAddr:k,stringUid:D.string_uid,uid:U.uid,errorCode:M.INVALID_UINT_UID_FROM_STRING_UID,extend:D}),new G(M.INVALID_UINT_UID_FROM_STRING_UID);return Se.reqUserAccount(D.sid,{lts:P,success:!0,serverAddr:k,stringUid:D.string_uid,uid:U.uid,errorCode:null,extend:D}),!1}const oe=wd(U.code);return oe.retry&&(k=g[(Y+1)%g.length]),Se.reqUserAccount(D.sid,{lts:P,success:!1,serverAddr:k,stringUid:D.string_uid,uid:U.uid,errorCode:oe.desc,extend:D}),oe.retry},(U,Y)=>U.code!==M.OPERATION_ABORTED&&(Se.reqUserAccount(D.sid,{lts:P,success:!1,serverAddr:k,stringUid:D.string_uid,uid:null,errorCode:U.code,extend:D}),k=g[(Y+1)%g.length],!0),N);if(0!==V.code){const U=wd(V.code);throw new G(M.UNEXPECTED_RESPONSE,U.desc)}return V}),function(g,v,b,C,N){return _.apply(this,arguments)})(h,o,n,r,s);return c?.recordJoinChannelService({status:"success",endTs:Date.now()},p),m.uid}catch(m){throw c?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[m]},p),m}var _}),hm.apply(this,arguments)}function iv(){return iv=x(function*(o,n,r){const s=B("CDS_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(p=>o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(p+"/api/v1"):"https://".concat(p,"/api/v1?action=config")).map(p=>function(m,_,g,v){const b=Ve(),C={flag:64,cipher_method:0,features:{device:b.name,system:b.os,system_general:navigator.userAgent,vendor:_.appId,version:Lo,cname:_.cname,sid:_.sid,session_id:_.sid,detail:"",proxyServer:_.proxyServer}};return Ws(()=>Ss(m,{data:C,timeout:1e3,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,N=>N.code!==M.OPERATION_ABORTED,v)}(p,o,n,r));let c=null,d=null,h={};try{c=yield Bd(s)}catch(p){if(p.code===M.OPERATION_ABORTED)throw p;d=p}if(s.forEach(p=>p.cancel()),Se.reportApiInvoke(o.sid,{name:Vn.REQUEST_CONFIG_DISTRIBUTE,options:{error:d,res:c}}).onSuccess(),c&&c.test_tags)try{h=function(p){if(!p.test_tags)return{};const m=p.test_tags,_=Object.keys(m),g={};return _.forEach(v=>{var b;const C=TD(b=v.slice(4)).call(b),N=JSON.parse(m[v])[1];g[C]=N}),g}(c)}catch{}return h}),iv.apply(this,arguments)}function nT(o,n,r,s){return rv.apply(this,arguments)}function rv(){return rv=x(function*(o,n,r,s){const c=B("PROXY_SERVER_TYPE3"),d=(C,N,P)=>{let D=P||c;return Array.isArray(D)&&(D=N%2==0?c[1]:c[0]),"https://".concat(D,"/ap/?url=").concat(C)};let h=null;const p=[],m=function(){var C=x(function*(){const N=B("WEBCS_DOMAIN").slice(0,B("AJAX_REQUEST_CONCURRENT")).map((k,V)=>{let U;return U="disabled"===o.cloudProxyServer&&o.proxyServer?d("".concat(k,"/api/v2/transpond/webrtc?v=2"),V,o.proxyServer):"disabled"===o.cloudProxyServer||"fallback"===o.cloudProxyServer?"https://".concat(k,"/api/v2/transpond/webrtc?v=2"):d("".concat(k,"/api/v2/transpond/webrtc?v=2"),V),{url:U,areaCode:$E(),serviceIds:[ni.CHOOSE_SERVER,"proxy5"===o.cloudProxyServer?ni.CLOUD_PROXY_5:"proxy3"===o.cloudProxyServer||"proxy4"===o.cloudProxyServer?ni.CLOUD_PROXY:ni.CLOUD_PROXY_FALLBACK]}}),P=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(k=>k.url)}),D=yield jd({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:k=>(w.debug("[".concat(o.clientId,"] Connect to choose_server:"),k.url),dm(k,o,n,r)),allFailedhandler:k=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:k},P),k[0]},promisesCollector:p});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},P),D});return function(){return C.apply(this,arguments)}}(),_=function(){var C=x(function*(){if(yield mi(1e3),null!==h)return h;const N=B("WEBCS_DOMAIN_BACKUP_LIST").map((k,V)=>{let U;return U="disabled"===o.cloudProxyServer&&o.proxyServer?d("".concat(k,"/api/v2/transpond/webrtc?v=2"),V,o.proxyServer):"disabled"===o.cloudProxyServer||"fallback"===o.cloudProxyServer?"https://".concat(k,"/api/v2/transpond/webrtc?v=2"):d("".concat(k,"/api/v2/transpond/webrtc?v=2"),V),{url:U,areaCode:$E(),serviceIds:[ni.CHOOSE_SERVER,"proxy5"===o.cloudProxyServer?ni.CLOUD_PROXY_5:"proxy3"===o.cloudProxyServer||"proxy4"===o.cloudProxyServer?ni.CLOUD_PROXY:ni.CLOUD_PROXY_FALLBACK]}}),P=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(k=>k.url)}),D=yield jd({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:k=>(w.debug("[".concat(o.clientId,"] Connect to backup choose_server:"),k.url),dm(k,o,n,r)),allFailedhandler:k=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:k},P),k[0]},promisesCollector:p});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},P),D});return function(){return C.apply(this,arguments)}}();let g,v,b;try{({gatewayInfo:g,proxyInfo:v,url:b}=yield Bd([m(),_()]))}catch(C){throw C[0]}if(p.length&&p.forEach(C=>C.cancel&&"function"==typeof C.cancel&&C.cancel()),!g||!v)throw new G(M.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(o.apUrl=b,"disabled"!==o.cloudProxyServer&&Array.isArray(c)&&b){const C=/^https?:\/\/(.+?)(\/.*)?$/.exec(b)[1];Re(c).call(c,C)&&(o.proxyServer=C,w.setProxyServer(C),Se.setProxyServer(C))}return h={gatewayInfo:g,proxyInfo:yield eV(v,g.uid)},h}),rv.apply(this,arguments)}function Dr(o,n,r,s){return Xs.apply(this,arguments)}function Xs(){return Xs=x(function*(o,n,r,s){const c=B("UAP_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(d=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap"));return yield function OO(o,n,r,s,c){QE+=1;const d={sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(Date.now()/1e3),seq:QE,requestId:QE,version:Lo,cname:r.cname},h={service_name:n,json_body:JSON.stringify(d)};let p,m,_=o[0];return Ws(x(function*(){p=Date.now();const g=yield Ss(_,{data:h,cancelToken:s,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(m=Date.now()-p,0!==g.code){const C=new G(M.UNEXPECTED_RESPONSE,"live streaming ap error, code"+g.code,{retry:!0,responseTime:m});throw w.error(C.toString()),C}const v=JSON.parse(g.json_body);if(200!==v.code){const C=new G(M.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(v.code,", reason: ").concat(v.reason),{code:v.code,responseTime:m});throw w.error(C.toString()),C}if(!v.servers||0===v.servers.length){const C=new G(M.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:v.code,responseTime:m});throw w.error(C.toString()),C}const b=(N=n,{addressList:(C=v).servers.map(P=>"wss://".concat(P.address.replace(/\./g,"-"),".").concat(B("WORKER_DOMAIN"),":").concat(P.wss,"?serviceName=").concat(encodeURIComponent(N))),workerToken:C.workerToken,vid:C.vid});var C,N;return B("LIVE_STREAMING_ADDRESS")&&(b.addressList=B("LIVE_STREAMING_ADDRESS")instanceof Array?B("LIVE_STREAMING_ADDRESS"):[B("LIVE_STREAMING_ADDRESS")]),JE(JE({},b),{},{responseTime:m})}),(g,v)=>(Se.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:n,responseDetail:JSON.stringify(g.addressList),firstSuccess:0===v,responseTime:m,serverIp:o[v%o.length]}),!1),(g,v)=>(Se.apworkerEvent(r.sid,{success:!1,sc:g.data&&g.data.code||200,serviceName:n,responseTime:m,serverIp:o[v%o.length]}),!!(g.code!==M.OPERATION_ABORTED&&g.code!==M.UNEXPECTED_RESPONSE||g.data&&g.data.retry)&&(_=o[(v+1)%o.length],!0)),c)}(c,o,n,r,s)}),Xs.apply(this,arguments)}function MO(){return MO=x(function*(o,n,r){const s=B("UAP_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(c=>o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(c+"/api/v1?action=uap"):"https://".concat(c,"/api/v1?action=uap")).map(c=>function(d,h,p,m){const _={command:"convergeAllocateEdge",sid:h.sid,appId:h.appId,token:h.token,ts:Date.now(),version:Lo,cname:h.cname,uid:h.uid.toString(),requestId:ZE,seq:ZE};ZE+=1;const g={service_name:"tele_channel",json_body:JSON.stringify(_)};return Ws(x(function*(){const v=yield Ss(d,{data:g,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==v.code){const C=new G(M.UNEXPECTED_RESPONSE,"cross channel ap error, code"+v.code,{retry:!0});throw w.error(C.toString()),C}const b=JSON.parse(v.json_body);if(200!==b.code){const C=new G(M.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(b.code,", reason: ").concat(b.reason));throw w.error(C.toString()),C}if(!b.servers||0===b.servers.length){const C=new G(M.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw w.error(C.toString()),C}return{vid:b.vid,workerToken:b.workerToken,addressList:(B("CHANNEL_MEDIA_RELAY_SERVERS")||b.servers).map(C=>"wss://".concat(C.address.replace(/\./g,"-"),".").concat(B("WORKER_DOMAIN"),":").concat(C.wss))}}),void 0,v=>!!(v.code!==M.OPERATION_ABORTED&&v.code!==M.UNEXPECTED_RESPONSE||v.data&&v.data.retry),m)}(c,o,n,r));try{const c=yield Bd(s);return s.forEach(d=>d.cancel()),c}catch(c){throw c[0]}}),MO.apply(this,arguments)}function ov(){return ov=x(function*(o,n,r){let s=null;const c=[],d=function(){var h=x(function*(p){const m=B(p?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(_=>o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"));return p&&(yield mi(1e3),null!==s)?s:yield jd({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:_=>(w.debug("[".concat(o.clientId,"] update ticket, Connect to ").concat(p?"backup":""," choose_server:"),_),function(g,v,b,C){const[N]=pL(v,[ni.CHOOSE_SERVER]);let P=Rn.networkState;return Ws(x(function*(){P&&Rn.networkState===li.OFFLINE&&Rn.onlineWaiter&&(yield z.race([Rn.onlineWaiter,mi(C&&C.maxRetryTimeout||bn.maxRetryTimeout)])),P=Rn.networkState;const D=yield Ss(g,{data:N,cancelToken:b,headers:{"Content-Type":"multipart/form-data;"}},!0);return NO(D,g)}),()=>!1,D=>D.code!==M.OPERATION_ABORTED&&(D.code===M.UPDATE_TICKET_FAILED?D.data.retry:(w.warning("[".concat(v.clientId,"] update ticket network error, retry"),D),!0)),C)}(_,o,n,r)),allFailedhandler:_=>{throw _[0]},promisesCollector:c})});return function(m){return h.apply(this,arguments)}}();try{return s=yield Bd([d(!1),d(!0)]),c.length&&c.forEach(h=>h.cancel&&"function"==typeof h.cancel&&h.cancel()),s}catch(h){throw h[0]}}),ov.apply(this,arguments)}function iT(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function sv(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?iT(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):iT(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}class av extends Yt{constructor(){super(),S(this,"configs",void 0),S(this,"joinInfo",void 0),S(this,"cancelToken",void 0),S(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),S(this,"interval",void 0),S(this,"mutex",new Wn("config-distribute")),S(this,"mutableParamsRead",!1)}startGetConfigDistribute(n,r){this.joinInfo=n,this.cancelToken=r,this.interval&&this.stopGetConfigDistribute(),B("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},B("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}awaitConfigDistributeComplete(){var n=this;return x(function*(){n.mutex.isLocked&&(yield n.mutex.lock())()})()}updateConfigDistribute(){var n=this;return x(function*(){if(n.mutableParamsRead||(n.mutableParamsRead=!0,Se.reportApiInvoke(null,{options:void 0,name:Vn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:dn.TRACER}).onSuccess(JSON.stringify(bd))),!n.joinInfo||!n.cancelToken||!n.retryConfig)return void w.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const s=yield n.mutex.lock();try{r=yield function nv(o,n,r){return iv.apply(this,arguments)}(n.joinInfo,n.cancelToken,n.retryConfig),w.debug("[config-distribute] get config distribute",JSON.stringify(r)),r.limit_bitrate&&n.handleBitrateLimit(r.limit_bitrate),n.cacheGlobalParameterConfig(r),n.configs=r}catch(c){const d=new G(M.NETWORK_RESPONSE_ERROR,c);w.warning("[config-distribute] ".concat(d.toString()))}finally{s()}})()}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(n){var r;(r=n)&&r.uplink&&r.id&&void 0!==r.uplink.max_bitrate&&void 0!==r.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==n.id&&this.emit(uE.UPDATE_BITRATE_LIMIT,n):this.emit(uE.UPDATE_BITRATE_LIMIT,n))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&sv({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(n){var r;const s=ie(r=Object.keys(n).filter(d=>/^webrtc_ng_global_parameter/.test(d))).call(r);for(let d=0;d<s.length;d++)for(let h=s.length-1;h>d;h--){const p=s[h];if("number"==typeof n[p].__priority){const _=s[h-1];if("number"==typeof n[_].__priority){if(!(n[p].__priority>n[_].__priority))continue;{const g=p;s[h]=s[h-1],s[h-1]=g}}else{const g=p;s[h]=s[h-1],s[h-1]=g}}}const c={};s.forEach(d=>{const h=n[d],p=h.__expires;Object.keys(h).forEach(m=>{"__priority"===m||"__expires"===m||Object.prototype.hasOwnProperty.call(c,m)||(c[m]=sv({value:h[m]},p&&{expires:p}))})});try{!function(p){try{const m=Date.now();Object.keys(p).forEach(_=>{switch(_){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":if(Object.prototype.hasOwnProperty.call(Yi,_)){const{value:g,expires:v}=p[_];if(v&&v<=m)return;bd[_]=g,Yi[_]=g,w.debug("Update global parameters from config distribute",_,g)}}})}catch(m){w.error("Error update config immediately: ".concat(p),m.message)}}(c);const d=JSON.stringify(c),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),w.debug("Caching global parameters ".concat(d))}catch(d){w.error("Error caching global parameters:",d.message)}}}function kO(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function Hd(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?kO(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):kO(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}class fL extends Yt{constructor(n,r,s,c){super(),S(this,"spec",void 0),S(this,"token",void 0),S(this,"websocket",void 0),S(this,"pingpongTimer",void 0),S(this,"reconnectMode","retry"),S(this,"serviceMode",void 0),S(this,"reqId",0),S(this,"commandReqId",0),S(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),S(this,"handleWebSocketMessage",d=>{if(!d.data)return;const h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):this.serviceMode===zn.INJECT?this.emit(hs.INJECT_STREAM_STATUS,h):(Se.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===zn.TRANSCODE?1:2}),this.emit(hs.PUBLISH_STREAM_STATUS,h))}),this.spec=r,this.token=n,this.serviceMode=c,this.websocket=new $c("live-streaming",s),this.websocket.on(Me.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Me.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Me.REQUEST_NEW_URLS,(d,h)=>{Qt(this,hs.REQUEST_NEW_ADDRESS).then(d).catch(h)}),this.websocket.on(Me.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(n){return this.websocket.init(n)}request(n,r,s,c){var d=this;return x(function*(){d.reqId+=1,"request"===n&&(d.commandReqId+=1);const h=d.commandReqId,p=d.reqId;if(!p||!d.websocket)throw new G(M.UNEXPECTED_ERROR);const m=Hd({command:n,sdkVersion:"4.19.1"===Lo?"0.0.1":Lo,seq:p,requestId:p,allocate:s,cname:d.spec.cname,appId:d.spec.appId,sid:d.spec.sid,uid:d.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},r);if("closed"===d.websocket.state)throw new G(M.WS_DISCONNECT);const _=()=>new z((C,N)=>{d.websocket.once(Me.CLOSED,()=>N(new G(M.WS_ABORT))),d.websocket.once(Me.CONNECTED,C)});"connected"!==d.websocket.state&&(yield _()),m.clientRequest&&(m.clientRequest.workerToken=d.token);const g=new z((C,N)=>{const P=()=>{N(new G(M.WS_ABORT))};d.websocket.once(Me.RECONNECTING,P),d.websocket.once(Me.CLOSED,P),d.once("@".concat(p,"-").concat(d.spec.sid),D=>{C(D)})});c&&Se.workerEvent(d.spec.sid,Hd(Hd({},c),{},{requestId:h,actionType:"request",payload:JSON.stringify(r.clientRequest),serverCode:0,code:0}));const v=Date.now();d.websocket.sendMessage(m);let b=null;try{b=yield g}catch(C){if("closed"===d.websocket.state)throw C;return yield _(),yield d.request(n,r,s)}return c&&Se.workerEvent(d.spec.sid,Hd(Hd({},c),{},{requestId:h,actionType:"response",payload:JSON.stringify(b.serverResponse),serverCode:b.code,success:200===b.code,responseTime:Date.now()-v})),200!==b.code&&d.handleResponseError(b),b})()}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const n="4.19.1"===Lo?"0.0.1":Lo;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:n,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(n){switch(n.code){case Sn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void w.warning("live stream response already exists stream");case Sn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Sn.LIVE_STREAM_RESPONSE_BAD_STREAM:case Sn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new G(M.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:n.code}).throw();case Sn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===n.serverResponse.command||"UninjectStream"===n.serverResponse.command)return;throw new G(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Sn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new G(M.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:n.code}).throw();case Sn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const r=new G(M.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(hs.WARNING,r,n.serverResponse.url)}case Sn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const r=new G(M.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(hs.WARNING,r,n.serverResponse.url)}case Sn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new G(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Sn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new G(M.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:n.code}).throw();case Sn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const r=new G(M.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(hs.WARNING,r,n.serverResponse.url)}case Sn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new G(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code}).throw();case Sn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new G(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Sn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Sn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===n.serverResponse.command||"UninjectStream"===n.serverResponse.command)return;throw new G(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Sn.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===n.serverResponse.command||"UninjectStream"===n.serverResponse.command)return;if("UpdateTranscoding"===n.serverResponse.command||"ControlStream"===n.serverResponse.command)return new G(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:n.code}).throw();throw new G(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Sn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new G(M.LIVE_STREAMING_CDN_ERROR,"",{code:n.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(Bg)},6e3)}}function mL(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function Or(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?mL(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):mL(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}class rV extends Yt{constructor(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bn,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:bn;super(),S(this,"onLiveStreamWarning",void 0),S(this,"onLiveStreamError",void 0),S(this,"onInjectStatusChange",void 0),S(this,"spec",void 0),S(this,"retryTimeout",1e4),S(this,"connection",void 0),S(this,"httpRetryConfig",void 0),S(this,"wsRetryConfig",void 0),S(this,"streamingTasks",new Map),S(this,"isStartingStreamingTask",!1),S(this,"taskMutex",new Wn("live-streaming")),S(this,"cancelToken",Tr.CancelToken.source()),S(this,"transcodingConfig",void 0),S(this,"injectConfig",Or({},pD)),S(this,"injectLoopTimes",0),S(this,"uapResponse",void 0),S(this,"lastTaskId",1),S(this,"statusError",new Map),this.spec=n,this.httpRetryConfig=s,this.wsRetryConfig=r}setTranscodingConfig(n){var r=this;return x(function*(){const s=Or(Or({},ex),n);var p;66!==s.videoCodecProfile&&77!==s.videoCodecProfile&&100!==s.videoCodecProfile&&(w.debug("[".concat(r.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(p=>Or(Or(Or({},uD),p),{},{zOrder:p.zOrder?p.zOrder+1:1}))),nn((p=s).width)||wt(p.width,"config.width",0,1e4),nn(p.height)||wt(p.height,"config.height",0,1e4),nn(p.videoBitrate)||wt(p.videoBitrate,"config.videoBitrate",1,1e6),nn(p.videoFrameRate)||wt(p.videoFrameRate,"config.videoFrameRate"),nn(p.lowLatency)||jc(p.lowLatency,"config.lowLatency"),nn(p.audioSampleRate)||Gn(p.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),nn(p.audioBitrate)||wt(p.audioBitrate,"config.audioBitrate",1,128),nn(p.audioChannels)||Gn(p.audioChannels,"config.audioChannels",[1,2,3,4,5]),nn(p.videoGop)||wt(p.videoGop,"config.videoGop"),nn(p.videoCodecProfile)||Gn(p.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),nn(p.userCount)||wt(p.userCount,"config.userCount",0,17),nn(p.backgroundColor)||wt(p.backgroundColor,"config.backgroundColor",0,16777215),nn(p.userConfigExtraInfo)||fi(p.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),p.transcodingUsers&&!nn(p.transcodingUsers)&&(nc(p.transcodingUsers,"config.transcodingUsers"),p.transcodingUsers.forEach((m,_)=>{Rf(m.uid),nn(m.x)||wt(m.x,"transcodingUser[".concat(_,"].x"),0,1e4),nn(m.y)||wt(m.y,"transcodingUser[".concat(_,"].y"),0,1e4),nn(m.width)||wt(m.width,"transcodingUser[".concat(_,"].width"),0,1e4),nn(m.height)||wt(m.height,"transcodingUser[".concat(_,"].height"),0,1e4),nn(m.zOrder)||wt(m.zOrder-1,"transcodingUser[".concat(_,"].zOrder"),0,100),nn(m.alpha)||wt(m.alpha,"transcodingUser[".concat(_,"].alpha"),0,1,!1)})),nn(p.watermark)||hD(p.watermark,"watermark"),nn(p.backgroundImage)||hD(p.backgroundImage,"backgroundImage"),p.images&&!nn(p.images)&&(nc(p.images,"config.images"),p.images.forEach((m,_)=>{hD(m,"images[".concat(_,"]"))}));const c=[];s.images&&c.push(...s.images.map(p=>Or(Or(Or({},sC),p),{},{zOrder:255}))),s.backgroundImage&&(c.push(Or(Or(Or({},sC),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(c.push(Or(Or(Or({},sC),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=c,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(p=>Or({},p)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const d=(s.userConfigs||[]).map(p=>"number"==typeof p.uid?z.resolve(p.uid):tT(p.uid,r.spec,r.cancelToken.token,r.httpRetryConfig));if((yield z.all(d)).forEach((p,m)=>{s.userConfigs&&s.userConfigs[m]&&(s.userConfigs[m].uid=p)}),r.transcodingConfig=s,r.connection)try{var h;const p=yield r.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:r.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(wa(h=r.streamingTasks).call(h)).map(m=>m.taskId).join("#")});w.debug("[".concat(r.spec.clientId,"] update live transcoding config success, code: ").concat(p.code,", config:"),JSON.stringify(r.transcodingConfig))}catch(p){if(!p.data||!p.data.retry)throw p;p.data.changeAddress&&r.connection.tryNextAddress(),r.streamingTasks.forEach(m=>{w.warning("[".concat(r.spec.clientId,"] live streaming receive error"),p.toString(),"try to republish",m.url),r.startLiveStreamingTask(m.url,m.mode,p).then(()=>{w.debug("[".concat(r.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(_=>{w.error("[".concat(r.spec.clientId,"] live streaming republish failed"),m.url,_.toString()),r.onLiveStreamError&&r.onLiveStreamError(m.url,_)})})}})()}setInjectStreamConfig(n,r){this.injectConfig=Object.assign({},this.injectConfig,n),this.injectLoopTimes=r}startLiveStreamingTask(n,r,s){var c=this;return x(function*(){var d;if(Array.from(wa(d=c.streamingTasks).call(d)).find(_=>_.mode===zn.INJECT)&&r===zn.INJECT)return new G(M.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!c.transcodingConfig&&r===zn.TRANSCODE)throw new G(M.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let h={command:"PublishStream",ts:Date.now(),url:n,uid:c.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};w.debug("[".concat(c.spec.clientId,"] start live streaming ").concat(n,", mode: ").concat(r));const p=yield c.taskMutex.lock();if(!c.connection&&s)return void p();if(c.streamingTasks.get(n)&&!s)return p(),new G(M.LIVE_STREAMING_TASK_CONFLICT).throw();try{c.connection||(c.connection=yield c.connect(r))}catch(_){throw p(),_}switch(r){case zn.TRANSCODE:h.transcodingConfig=Or({},c.transcodingConfig);break;case zn.RAW:break;case zn.INJECT:h={cname:c.spec.cname,command:"InjectStream",sid:c.spec.sid,transcodingConfig:c.injectConfig,ts:Date.now(),url:n,loopTimes:c.injectLoopTimes}}c.uapResponse&&c.uapResponse.vid&&(h.vid=c.uapResponse.vid),c.isStartingStreamingTask=!0;const m=c.lastTaskId++;try{const _=new z((v,b)=>{mi(c.retryTimeout).then(()=>{if(s)return b(s);const C=c.statusError.get(n);return C?(c.statusError.delete(n),b(C)):void 0})}),g=yield z.race([c.connection.request("request",{clientRequest:h},!0,{url:n,command:"PublishStream",workerType:r===zn.TRANSCODE?1:2,requestByUser:!s,tid:m.toString()}),_]);c.isStartingStreamingTask=!1,w.debug("[".concat(c.spec.clientId,"] live streaming started, code: ").concat(g.code)),c.streamingTasks.set(n,{clientRequest:h,mode:r,url:n,taskId:m}),p()}catch(_){if(p(),c.isStartingStreamingTask=!1,!_.data||!_.data.retry||s)throw _;return _.data.changeAddress?(c.connection.tryNextAddress(),yield c.startLiveStreamingTask(n,r,_)):yield c.startLiveStreamingTask(n,r,_)}})()}stopLiveStreamingTask(n){return new z((r,s)=>{const c=this.streamingTasks.get(n);if(!c||!this.connection)return new G(M.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=c.mode;c.abortTask=()=>{w.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(n),r()},this.connection.request("request",{clientRequest:{command:d===zn.INJECT?"UninjectStream":"UnpublishStream",url:c.url}},!1,{url:n,command:"UnPublishStream",workerType:d===zn.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{w.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(n),0===this.streamingTasks.size&&d!==zn.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),r(),d===zn.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(Ta.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,n)}).catch(s)})}controlInjectStream(n,r,s,c){var d=this;return x(function*(){const h=d.streamingTasks.get(n);if(!h||!d.connection||h.mode!==zn.INJECT)throw new G(M.INVALID_OPERATION,"can not find inject stream task to control");return(yield d.connection.request("request",{clientRequest:{command:"ControlStream",url:n,control:r,audioVolume:s,position:c}})).serverResponse})()}resetAllTask(){var n;const r=Array.from(wa(n=this.streamingTasks).call(n));this.terminate();for(const s of r)this.startLiveStreamingTask(s.url,s.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(s.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Tr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}connect(n){var r=this;return x(function*(){if(r.connection)throw new G(M.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=yield Qt(r,_h.REQUEST_WORKER_MANAGER_LIST,n);return r.uapResponse=s,r.connection=new fL(s.workerToken,r.spec,r.wsRetryConfig,n),r.connection.on(hs.WARNING,(c,d)=>r.onLiveStreamWarning&&r.onLiveStreamWarning(d,c)),r.connection.on(hs.PUBLISH_STREAM_STATUS,c=>r.handlePublishStreamServer(c)),r.connection.on(hs.INJECT_STREAM_STATUS,c=>r.handleInjectStreamServerStatus(c)),r.connection.on(hs.REQUEST_NEW_ADDRESS,(c,d)=>{if(!r.connection)return d(new G(M.UNEXPECTED_ERROR,"can not get new live streaming address list"));Qt(r,_h.REQUEST_WORKER_MANAGER_LIST,n).then(h=>{r.uapResponse=h,c(h.addressList)}).catch(d)}),yield r.connection.init(s.addressList),r.connection})()}handlePublishStreamServer(n){const r=n.serverStatus&&n.serverStatus.url||"empty_url",s=this.streamingTasks.get(r),c=n.reason;switch(n.code){case Sn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new G(M.LIVE_STREAMING_CDN_ERROR,"",{code:n.code});if(s)return w.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(r,h);if(!this.isStartingStreamingTask)return;this.statusError.set(r,h)}case Sn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new G(M.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(r,h)}case Sn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Sn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(wa(d=this.streamingTasks).call(d));for(const p of h)p.abortTask?p.abortTask():(w.warning("[".concat(this.spec.clientId,"] publish stream status code"),n.code,"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,new G(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code})).then(()=>{w.debug("[".concat(this.spec.clientId,"] republish live stream success"),p.url)}).catch(m=>{w.error(m.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,m)}));return}}}handleInjectStreamServerStatus(n){const r=Number(n.uid),s=n.serverStatus&&n.serverStatus.url;switch(n.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(Ta.INJECT_STREAM_STATUS_START_SUCCESS,r,s));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(Ta.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,r,s),void this.streamingTasks.delete(s);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(Ta.INJECT_STREAM_STATUS_START_UNAUTHORIZED,r,s),void this.streamingTasks.delete(s);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(Ta.INJECT_STREAM_STATUS_BROKEN,r,s),void this.streamingTasks.delete(s);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(Ta.INJECT_STREAM_STATUS_START_TIMEOUT,r,s),void this.streamingTasks.delete(s);default:return void w.debug("inject stream server status",n)}}hasUrl(n){return this.streamingTasks.has(n)}}class rT{constructor(){S(this,"destChannelMediaInfos",new Map),S(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(n){Yc(n),this.srcChannelMediaInfo=n}addDestChannelInfo(n){Yc(n),this.destChannelMediaInfos.set(n.channelName,n)}removeDestChannelInfo(n){lE(n),this.destChannelMediaInfos.delete(n)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function _L(o){if(!(o instanceof rT))return new G(M.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const n=o.getSrcChannelMediaInfo(),r=o.getDestChannelMediaInfo();return n?0===r.size?new G(M.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new G(M.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class oV extends Yt{constructor(n,r,s){super(),S(this,"ws",void 0),S(this,"requestId",1),S(this,"heartBeatTimer",void 0),S(this,"joinInfo",void 0),S(this,"clientId",void 0),S(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),S(this,"onClose",c=>{this.emit("close"),this.dispose()}),S(this,"onMessage",c=>{const d=JSON.parse(c.data);if(!d||"serverResponse"!==d.command||!d.requestId)return d&&"serverStatus"===d.command&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)}),this.joinInfo=n,this.clientId=r,this.ws=new $c("cross-channel-".concat(this.clientId),s),this.ws.on(Me.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Me.CONNECTED,this.onOpen),this.ws.on(Me.ON_MESSAGE,this.onMessage),this.ws.on(Me.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(n){const r=this.requestId++;return n.requestId=r,n.seq=r,this.ws.sendMessage(n),r}waitStatus(n){return new z((r,s)=>{const c=window.setTimeout(()=>{s(new G(M.TIMEOUT,"wait status timeout, status: ".concat(n)))},5e3);this.once(n,d=>{window.clearTimeout(c),d.state&&0!==d.state?s(new G(M.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(n))):r(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),s(new G(M.WS_ABORT))})})}request(n){var r=this;return x(function*(){if("closed"===r.ws.state)throw new G(M.WS_DISCONNECT);"connected"!==r.ws.state&&(yield new z((p,m)=>{r.ws.once(Me.CLOSED,()=>m(new G(M.WS_ABORT))),r.ws.once(Me.CONNECTED,p)}));const c=r.sendMessage(n),d=new z((p,m)=>{const _=()=>{m(new G(M.WS_ABORT))};r.ws.once(Me.RECONNECTING,_),r.ws.once(Me.CLOSED,_),r.once("req_".concat(c),p),mi(3e3).then(()=>{r.removeAllListeners("req_".concat(c)),r.ws.off(Me.RECONNECTING,_),r.ws.off(Me.CLOSED,_),m(new G(M.TIMEOUT,"cross channel ws request timeout"))})}),h=yield d;if(!h||200!==h.code)throw new G(M.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(h)));return h})()}connect(n){var r=this;return x(function*(){r.ws.removeAllListeners(Me.REQUEST_NEW_URLS),r.ws.on(Me.REQUEST_NEW_URLS,s=>{s(n)}),yield r.ws.init(n)})()}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(n){const r=this.requestId++;return n.requestId=r,this.ws.sendMessage(n),r}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class sV extends Yt{set state(n){n!==this._state&&(n!==Xi.RELAY_STATE_FAILURE&&(this.errorCode=Td.RELAY_OK),this.emit("state",n,this.errorCode),this._state=n)}get state(){return this._state}constructor(n,r,s,c,d){var h;super(),h=this,S(this,"joinInfo",void 0),S(this,"sid",void 0),S(this,"clientId",void 0),S(this,"cancelToken",Tr.CancelToken.source()),S(this,"workerToken",void 0),S(this,"requestId",0),S(this,"signal",void 0),S(this,"prevChannelMediaConfig",void 0),S(this,"httpRetryConfig",void 0),S(this,"_resolution",void 0),S(this,"_state",Xi.RELAY_STATE_IDLE),S(this,"errorCode",Td.RELAY_OK),S(this,"onStatus",p=>{w.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(p))),p&&p.command&&("onAudioPacketReceived"===p.command&&this.emit("event",zs.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===p.command&&this.emit("event",zs.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===p.command&&(this.errorCode=Td.SRC_TOKEN_EXPIRED,this.state=Xi.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===p.command&&(this.errorCode=Td.DEST_TOKEN_EXPIRED,this.state=Xi.RELAY_STATE_FAILURE))}),S(this,"onReconnect",x(function*(){w.debug("[".concat(h.clientId,"] ChannelMediaSocket disconnect, reconnecting")),h.emit("event",zs.NETWORK_DISCONNECTED),h.state=Xi.RELAY_STATE_IDLE,h.prevChannelMediaConfig&&h.sendStartRelayMessage(h.prevChannelMediaConfig).catch(p=>{h.state!==Xi.RELAY_STATE_IDLE&&(w.error("auto restart channel media relay failed",p.toString()),h.errorCode=Td.SERVER_CONNECTION_LOST,h.state=Xi.RELAY_STATE_FAILURE)})})),this.joinInfo=n,this.clientId=r,this.sid=Vg(),this.signal=new oV(this.joinInfo,this.clientId,s),this.httpRetryConfig=c,this._resolution=d}startChannelMediaRelay(n){var r=this;return x(function*(){if(r.state!==Xi.RELAY_STATE_IDLE)throw new G(M.INVALID_OPERATION);r.state=Xi.RELAY_STATE_CONNECTING,yield r.connect(),w.debug("[".concat(r.clientId,"] startChannelMediaRelay: connect success"));try{yield r.sendStartRelayMessage(n)}catch(s){throw s.data&&s.data.serverResponse&&"SetSourceChannel"===s.data.serverResponse.command?new G(M.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&"SetDestChannelStatus"===s.serverResponse.command?new G(M.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&"StartPacketTransfer"===s.serverResponse.command?new G(M.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}r.prevChannelMediaConfig=n})()}updateChannelMediaRelay(n){var r=this;return x(function*(){if(r.state!==Xi.RELAY_STATE_RUNNING)throw new G(M.INVALID_OPERATION);yield r.sendUpdateMessage(n),r.prevChannelMediaConfig=n})()}setVideoProfile(n){var r=this;return x(function*(){if(r._resolution=n,r.state!==Xi.RELAY_STATE_RUNNING)throw new G(M.INVALID_OPERATION);const s=r.genMessage(Si.SetVideoProfile);yield r.signal.request(s),w.debug("[".concat(r.clientId,"] startChannelMediaRelay: setVideoProfile success"))})()}stopChannelMediaRelay(){var n=this;return x(function*(){yield n.sendStopRelayMessage(),w.debug("[".concat(n.clientId,"] stopChannelMediaRelay: send stop message success")),n.state=Xi.RELAY_STATE_IDLE,n.dispose()})()}dispose(){w.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Tr.CancelToken.source(),this.state=Xi.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}connect(){var n=this;return x(function*(){const r=yield function PO(o,n,r){return MO.apply(this,arguments)}(n.joinInfo,n.cancelToken.token,n.httpRetryConfig);n.workerToken=r.workerToken,yield n.signal.connect(r.addressList),n.emit("event",zs.NETWORK_CONNECTED),n.signal.on("status",n.onStatus),n.signal.on("reconnecting",n.onReconnect)})()}sendStartRelayMessage(n){var r=this;return x(function*(){const s=r.genMessage(Si.StopPacketTransfer);yield r.signal.request(s),yield r.signal.waitStatus("Normal Quit"),w.debug("[".concat(r.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const c=r.genMessage(Si.SetSdkProfile,n);yield r.signal.request(c),w.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const d=r.genMessage(Si.SetSourceChannel,n);yield r.signal.request(d),yield r.signal.waitStatus("SetSourceChannelStatus"),r.emit("event",zs.PACKET_JOINED_SRC_CHANNEL),w.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const h=r.genMessage(Si.SetSourceUserId,n);yield r.signal.request(h),w.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const p=r.genMessage(Si.SetDestChannel,n);yield r.signal.request(p),yield r.signal.waitStatus("SetDestChannelStatus"),r.emit("event",zs.PACKET_JOINED_DEST_CHANNEL),w.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=r.genMessage(Si.StartPacketTransfer,n);yield r.signal.request(m),r.emit("event",zs.PACKET_SENT_TO_DEST_CHANNEL),r.state=Xi.RELAY_STATE_RUNNING,w.debug("[".concat(r.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),r.setVideoProfile(r._resolution)})()}sendUpdateMessage(n){var r=this;return x(function*(){const s=r.genMessage(Si.UpdateDestChannel,n);yield r.signal.request(s),r.emit("event",zs.PACKET_UPDATE_DEST_CHANNEL),w.debug("[".concat(r.clientId,"] sendUpdateMessage: UpdateDestChannel success"))})()}sendStopRelayMessage(){var n=this;return x(function*(){const r=n.genMessage(Si.StopPacketTransfer);yield n.signal.request(r),w.debug("[".concat(n.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))})()}genMessage(n,r){const s=[],c=[],d=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Lo,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.19.1"===h.sdkVersion&&(h.sdkVersion="0.0.1");let p=null,m=null;switch(n){case Si.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case Si.SetSourceChannel:if(m=r&&r.getSrcChannelMediaInfo(),!m)throw new G(M.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:m.channelName,token:m.token||this.joinInfo.appId},h;case Si.SetSourceUserId:if(m=r&&r.getSrcChannelMediaInfo(),!m)throw new G(M.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:m.uid+""},h;case Si.SetDestChannel:if(p=r&&r.getDestChannelMediaInfo(),!p)throw new G(M.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(_=>{s.push(_.channelName),c.push(_.uid+""),d.push(_.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:s,uid:c,token:d},h;case Si.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case Si.Reconnect:return h.clientRequest={command:"Reconnect"},h;case Si.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case Si.UpdateDestChannel:if(p=r&&r.getDestChannelMediaInfo(),!p)throw new G(M.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(_=>{s.push(_.channelName),c.push(_.uid+""),d.push(_.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:s,uid:c,token:d},h;case Si.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}class Ii{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(n,r){S(this,"uid",void 0),S(this,"_uintid",void 0),S(this,"_trust_in_room_",!0),S(this,"_trust_audio_enabled_state_",!0),S(this,"_trust_video_enabled_state_",!0),S(this,"_trust_audio_mute_state_",!0),S(this,"_trust_video_mute_state_",!0),S(this,"_audio_muted_",!1),S(this,"_video_muted_",!1),S(this,"_audio_enabled_",!0),S(this,"_video_enabled_",!0),S(this,"_audio_added_",!1),S(this,"_video_added_",!1),S(this,"_trust_video_stream_added_state_",!0),S(this,"_trust_audio_stream_added_state_",!0),S(this,"_audioTrack",void 0),S(this,"_videoTrack",void 0),S(this,"_dataChannels",[]),S(this,"_audioSSRC",void 0),S(this,"_videoSSRC",void 0),S(this,"_audioOrtc",void 0),S(this,"_videoOrtc",void 0),S(this,"_cname",void 0),S(this,"_rtxSsrcId",void 0),this.uid=n,this._uintid=r}}var xO=Cr,gL=Vs;In({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var o=gL.f(this);return{promise:o.promise,resolve:o.resolve,reject:o.reject}}});var EL=Vs,vL=sd;In({target:"Promise",stat:!0,forced:!0},{try:function(o){var n=EL.f(this),r=vL(o);return(r.error?n.reject:n.resolve)(r.value),n.promise}});var pm=dr(xO),Uh=Ou.f("asyncIterator"),cv=dr(Uh);function sl(o,n){this.v=o,this.k=n}function gc(o){var n,r;function s(d,h){try{var p=o[d](h),m=p.value,_=m instanceof sl;pm.resolve(_?m.v:m).then(function(g){if(_){var v="return"===d?"return":"next";if(!m.k||g.done)return s(v,g);g=o[v](g).value}c(p.done?"return":"normal",g)},function(g){s("throw",g)})}catch(g){c("throw",g)}}function c(d,h){switch(d){case"return":n.resolve({value:h,done:!0});break;case"throw":n.reject(h);break;default:n.resolve({value:h,done:!1})}(n=n.next)?s(n.key,n.arg):r=null}this._invoke=function(d,h){return new pm(function(p,m){var _={key:d,arg:h,resolve:p,reject:m,next:null};r?r=r.next=_:(n=r=_,s(d,h))})},"function"!=typeof o.return&&(this.return=void 0)}function Yr(o){return function(){return new gc(o.apply(this,arguments))}}function dt(o){return new sl(o,0)}function Vh(o){var n={},r=!1;function s(c,d){return r=!0,{done:!1,value:new sl(d=new pm(function(h){h(o[c](d))}),1)}}return n[void 0!==ro&&VI||"@@iterator"]=function(){return this},n.next=function(c){return r?(r=!1,c):s("next",c)},"function"==typeof o.throw&&(n.throw=function(c){if(r)throw r=!1,c;return s("throw",c)}),"function"==typeof o.return&&(n.return=function(c){return r?(r=!1,c):s("return",c)}),n}gc.prototype["function"==typeof ro&&cv||"@@asyncIterator"]=function(){return this},gc.prototype.next=function(o){return this._invoke("next",o)},gc.prototype.throw=function(o){return this._invoke("throw",o)},gc.prototype.return=function(o){return this._invoke("return",o)};var LO=dr(Uh),fm={exports:{}};!function(o,n){o.exports=(()=>{var r={8:(d,h,p)=>{p.r(h),p.d(h,{Parser:()=>ye,Printer:()=>bt,parse:()=>xe,print:()=>ht});const m="\n",_="".concat("\r").concat(m),g=" ";let v;function b(de){return de>="0"&&de<="9"}function C(de){return de>="!"&&de<="~"}function N(de){return C(de)||de>="\x80"&&de<="\xff"}function P(de){return"!"===de||de>="#"&&de<="'"||de>="*"&&de<="+"||de>="-"&&de<="."||de>="0"&&de<="9"||de>="A"&&de<="Z"||de>="^"&&de<="~"}function D(de){return de>="1"&&de<="9"}function k(de){return de>="A"&&de<="Z"||de>="a"&&de<="z"}function V(de){return"d"===de||"h"===de||"m"===de||"s"===de}function U(de){return de>"\x01"&&de<"\t"||de>"\v"&&de<"\f"||de>"\x0e"&&de<"\xff"}function Y(de){return k(de)||b(de)||"+"===de||"/"===de}function oe(de){return b(de)||k(de)||"+"===de||"/"===de||"-"===de||"_"===de}function K(de){return k(de)||b(de)||"+"===de||"/"===de}function X(de,I){var F=Object.keys(de);if(Object.getOwnPropertySymbols){var j=Object.getOwnPropertySymbols(de);I&&(j=j.filter(function(se){return Object.getOwnPropertyDescriptor(de,se).enumerable})),F.push.apply(F,j)}return F}function $(de){for(var I=1;I<arguments.length;I++){var F=null!=arguments[I]?arguments[I]:{};I%2?X(Object(F),!0).forEach(function(j){J(de,j,F[j])}):Object.getOwnPropertyDescriptors?Object.defineProperties(de,Object.getOwnPropertyDescriptors(F)):X(Object(F)).forEach(function(j){Object.defineProperty(de,j,Object.getOwnPropertyDescriptor(F,j))})}return de}function J(de,I,F){return I in de?Object.defineProperty(de,I,{value:F,enumerable:!0,configurable:!0,writable:!0}):de[I]=F,de}var de;(de=v||(v={})).VERSION="v",de.ORIGIN="o",de.SESSION_NAME="s",de.INFORMATION="i",de.URI="u",de.EMAIL="e",de.PHONE="p",de.CONNECTION="c",de.BANDWIDTH="b",de.TIME="t",de.REPEAT="r",de.ZONE_ADJUSTMENTS="z",de.KEY="k",de.ATTRIBUTE="a",de.MEDIA="m";class ve{consumeText(I,F){let j=F;for(;j<I.length;){const se=I[j];if("\0"===se||"\r"===se||se===m)break;j+=1}if(j-F==0)throw new Error("Invalid text, at ".concat(I));return j}consumeUnicastAddress(I,F,j){return this.consumeTill(I,F,g)}consumeOneOrMore(I,F,j){let se=F;for(;j(I[se]);)se++;if(se-F==0)throw new Error("Invalid rule at ".concat(F,"."));return se}consumeSpace(I,F){if(I[F]===g)return F+1;throw new Error("Invalid space at ".concat(F,"."))}consumeIP4Address(I,F){let j=F;for(let se=0;se<4;se++)if(j=this.consumeDecimalUChar(I,j),3!==se){if("."!==I[j])throw new Error("Invalid IP4 address.");j++}return j}consumeDecimalUChar(I,F){let j=F;for(let Be=0;Be<3&&b(I[j]);Be++,j++);if(j-F==0)throw new Error("Invalid decimal uchar.");const se=parseInt(I.slice(F,j));if(se>=0&&se<=255)return j;throw new Error("Invalid decimal uchar")}consumeIP6Address(I,F){let j=this.consumeHexpart(I,F);return":"===I[j]&&(j+=1,j=this.consumeIP4Address(I,j)),j}consumeHexpart(I,F){let j=F;if(":"===I[j]&&":"===I[j+1]){j+=2;try{j=this.consumeHexseq(I,j)}catch{}return j}if(j=this.consumeHexseq(I,j),":"===I[j]&&":"===I[j+1]){j+=2;try{j=this.consumeHexseq(I,j)}catch{}return j}return j}consumeHexseq(I,F){let j=F;for(;j=this.consumeHex4(I,j),":"===I[j]&&":"!==I[j+1];)j+=1;return j}consumeHex4(I,F){let j=0;for(;j<4;j++)if(!((se=I[F+j])>="0"&&se<="9"||se>="a"&&se<="f"||se>="A"&&se<="F")){if(0===j)throw new Error("Invalid hex 4");break}var se;return F+j}consumeFQDN(I,F){let j=F;for(;b(I[j])||k(I[j])||"-"===I[j]||"."===I[j];)j+=1;if(j-F<4)throw new Error("Invalid FQDN");return j}consumeExtnAddr(I,F){return this.consumeOneOrMore(I,F,N)}consumeMulticastAddress(I,F,j){switch(j){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(I,F);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(I,F);default:try{return this.consumeFQDN(I,F)}catch{return this.consumeExtnAddr(I,F)}}}consumeIP6MulticastAddress(I,F){const j=this.consumeHexpart(I,F);return"/"===I[j]?this.consumeInteger(I,j+1):j}consumeIP4MulticastAddress(I,F){let j=F+3;const se=I.slice(F,j),Be=parseInt(se);if(Be<224||Be>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Kt=0;Kt<3;Kt++){if("."!==I[j])throw new Error("Invalid IP4 multicast address.");j+=1,j=this.consumeDecimalUChar(I,j)}return"/"===I[j]&&(j+=1),j=this.consumeTTL(I,j),"/"===I[j]&&(j=this.consumeInteger(I,j)),j}consumeInteger(I,F){if(!D(I[F]))throw new Error("Invalid integer.");for(F+=1;b(I[F]);)F+=1;return F}consumeTTL(I,F){if("0"===I[F])return F+1;if(!D(I[F]))throw new Error("Invalid TTL.");F+=1;for(let j=0;j<2&&b(I[F]);j++)F+=1;return F}consumeToken(I,F){return this.consumeOneOrMore(I,F,P)}consumeTime(I,F){let j=F;if("0"===I[j])return j+1;for(D(I[j])&&(j+=1);b(I[j]);)j++;if(j-F<10)throw new Error("Invalid time");return j}consumeAddress(I,F){return this.consumeTill(I,F,g)}consumeTypedTime(I,F){let j=F;return j=this.consumeOneOrMore(I,j,b),V(I[j])?j+1:j}consumeRepeatInterval(I,F){if(!D(I[F]))throw new Error("Invalid repeat interval");for(F+=1;b(I[F]);)F+=1;return V(I[F])&&(F+=1),F}consumePort(I,F){return this.consumeOneOrMore(I,F,b)}consume(I,F,j){for(let se=0;se<j.length;se++){if(F+se>=I.length)throw new Error("consume exceeding value length");if(I[F+se]!==j[se])throw new Error("consume ".concat(j," failed at ").concat(se))}return F+j.length}consumeTill(I,F,j){let se=F;for(;se<I.length&&("string"!=typeof j||I[se]!==j)&&("function"!=typeof j||!j(I[se]));)se++;return se}}class ye extends ve{constructor(){super(),J(this,"records",[]),J(this,"currentLine",0)}parse(I){const F=this.probeEOL(I);this.records=I.split(F).filter(Kn=>!!Kn.trim()).map(this.parseLine),this.currentLine=0;const j=this.parseVersion(),se=this.parseOrigin(),Be=this.parseSessionName(),Kt=this.parseInformation(),Ui=this.parseUri(),yo=this.parseEmail(),fl=this.parsePhone(),OT=this.parseConnection(),NT=this.parseBandWidth(),Os=this.parseTimeFields(),$d=this.parseKey(),Cm=this.parseSessionAttribute(),On=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:j,origin:se,sessionName:Be,information:Kt,uri:Ui,emails:yo,phones:fl,connection:OT,bandwidths:NT,timeFields:Os,key:$d,attributes:Cm,mediaDescriptions:On}}getCurrentRecord(){const I=this.records[this.currentLine];if(!I)throw new Error("Record doesn't exit.");return I}probeEOL(I){for(let F=0;F<I.length;F++)if(I[F]===m)return"\r"===I[F-1]?_:m;throw new Error("Invalid newline character.")}parseLine(I,F){if(I.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const j=I[0];if("="!==I[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:j,value:I.slice(2),line:F,cur:0}}parseSessionAttribute(){const I=new ut;for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==v.ATTRIBUTE)break;const j={attField:this.extractOneOrMore(F,se=>P(se)&&":"!==se),_cur:0};":"===F.value[F.cur]&&(F.cur+=1,j.attValue=this.extractOneOrMore(F,U)),I.parse(j),this.currentLine++}return I.digest()}parseMediaAttributes(I){const F=new yt(I);for(;this.currentLine<this.records.length;){const j=this.getCurrentRecord();if(j.type!==v.ATTRIBUTE)break;const se={attField:this.extractOneOrMore(j,Be=>P(Be)&&":"!==Be),_cur:0};":"===j.value[j.cur]&&(j.cur+=1,se.attValue=this.extractOneOrMore(j,U)),F.parse(se),this.currentLine++}return F.digest()}parseKey(){const I=this.getCurrentRecord();if(I.type===v.KEY){if("prompt"===I.value||"clear:"===I.value||"base64:"===I.value||"uri:"===I.value)return I.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const I=this.getCurrentRecord();if(I.type===v.ZONE_ADJUSTMENTS){const F=[];for(;;)try{const j=this.extract(I,this.consumeTime);this.consumeSpaceForRecord(I);let se=!1;"-"===I.value[I.cur]&&(se=!0,I.cur+=1);const Be=this.extract(I,this.consumeTypedTime);F.push({time:j,typedTime:Be,back:se})}catch{break}if(0===F.length)throw new Error("Invalid zone adjustments");return this.currentLine++,F}return[]}parseRepeat(){const I=[];for(;;){const F=this.getCurrentRecord();if(F.type!==v.REPEAT)break;{const j=this.extract(F,this.consumeRepeatInterval),se=this.parseTypedTime(F);I.push({repeatInterval:j,typedTimes:se}),this.currentLine++}}return I}parseTypedTime(I){const F=[];for(;;)try{this.consumeSpaceForRecord(I),F.push(this.extract(I,this.consumeTypedTime))}catch{break}if(0===F.length)throw new Error("Invalid typed time.");return F}parseTime(){const I=this.getCurrentRecord(),F=this.extract(I,this.consumeTime);this.consumeSpaceForRecord(I);const j=this.extract(I,this.consumeTime);return this.currentLine++,{startTime:F,stopTime:j}}parseBandWidth(){const I=[];for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==v.BANDWIDTH)break;{const j=this.extractOneOrMore(F,P);if(":"!==F.value[F.cur])throw new Error("Invalid bandwidth field.");F.cur++;const se=this.extractOneOrMore(F,b);I.push({bwtype:j,bandwidth:se}),this.currentLine++}}return I}parseVersion(){const I=this.getCurrentRecord();if(I.type!==v.VERSION)throw new Error("first sdp record must be version");const F=I.value.slice(0,this.consumeOneOrMore(I.value,0,b));if(F.length!==I.value.length)throw new Error('invalid proto version, "v='.concat(I.value,'"'));return this.currentLine++,F}parseOrigin(){const I=this.getCurrentRecord();if(I.type!==v.ORIGIN)throw new Error("second line of sdp must be origin");const F=this.extractOneOrMore(I,N);this.consumeSpaceForRecord(I);const j=this.extractOneOrMore(I,b);this.consumeSpaceForRecord(I);const se=this.extractOneOrMore(I,b);this.consumeSpaceForRecord(I);const Be=this.extractOneOrMore(I,P);this.consumeSpaceForRecord(I);const Kt=this.extractOneOrMore(I,P);this.consumeSpaceForRecord(I);const Ui=this.extract(I,this.consumeUnicastAddress);return this.currentLine++,{username:F,sessId:j,sessVersion:se,nettype:Be,addrtype:Kt,unicastAddress:Ui}}parseSessionName(){const I=this.getCurrentRecord();if(I.type===v.SESSION_NAME){const F=this.extract(I,this.consumeText);return this.currentLine++,F}}parseInformation(){const I=this.getCurrentRecord();if(I.type!==v.INFORMATION)return;const F=this.extract(I,this.consumeText);return this.currentLine++,F}parseUri(){const I=this.getCurrentRecord();if(I.type===v.URI)return this.currentLine++,I.value}parseEmail(){const I=[];for(;;){const F=this.getCurrentRecord();if(F.type!==v.EMAIL)break;I.push(F.value),this.currentLine++}return I}parsePhone(){const I=[];for(;;){const F=this.getCurrentRecord();if(F.type!==v.PHONE)break;I.push(F.value),this.currentLine++}return I}parseConnection(){const I=this.getCurrentRecord();if(I.type===v.CONNECTION){const F=this.extractOneOrMore(I,P);this.consumeSpaceForRecord(I);const j=this.extractOneOrMore(I,P);this.consumeSpaceForRecord(I);const se=this.extract(I,this.consumeAddress);return this.currentLine++,{nettype:F,addrtype:j,address:se}}}parseMedia(){const I=this.getCurrentRecord(),F=this.extract(I,this.consumeToken);this.consumeSpaceForRecord(I);let j=this.extract(I,this.consumePort);"/"===I.value[I.cur]&&(I.cur+=1,j+=this.extract(I,this.consumeInteger)),this.consumeSpaceForRecord(I);const se=[];for(se.push(this.extract(I,this.consumeToken));"/"===I.value[I.cur];)I.cur+=1,se.push(this.extract(I,this.consumeToken));if(0===se.length)throw new Error("Invalid proto");const Be=this.parseFmt(I);return this.currentLine++,{mediaType:F,port:j,protos:se,fmts:Be}}parseTimeFields(){const I=[];for(;this.getCurrentRecord().type===v.TIME;){const F=this.parseTime(),j=this.parseRepeat(),se=this.parseZone();I.push({time:F,repeats:j,zones:se})}return I}parseMediaDescription(){const I=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.MEDIA;){const F=this.parseMedia(),j=this.parseInformation(),se=this.parseConnections(),Be=this.parseBandWidth(),Kt=this.parseKey(),Ui=this.parseMediaAttributes(F);I.push({media:F,information:j,connections:se,bandwidths:Be,key:Kt,attributes:Ui})}return I}parseConnections(){const I=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.CONNECTION;)I.push(this.parseConnection());return I}parseFmt(I){const F=[];for(;;)try{this.consumeSpaceForRecord(I),F.push(this.extract(I,this.consumeToken))}catch{break}if(0===F.length)throw new Error("Invalid fmts");return F}extract(I,F,...j){const se=F.call(this,I.value,I.cur,...j),Be=I.value.slice(I.cur,se);return I.cur=se,Be}extractOneOrMore(I,F){const j=this.consumeOneOrMore(I.value,I.cur,F),se=I.value.slice(I.cur,j);return I.cur=j,se}consumeSpaceForRecord(I){if(I.value[I.cur]!==g)throw new Error("Invalid space at ".concat(I.cur,"."));I.cur+=1}}class Ye extends ve{constructor(...I){super(...I),J(this,"attributes",void 0),J(this,"digested",!1)}extractOneOrMore(I,F,j){const se=this.consumeOneOrMore(I.attValue,I._cur,F),Be=I.attValue.slice(I._cur,se),[Kt,Ui]=j||[];if("number"==typeof Kt&&Be.length<Kt)throw new Error("error in length, should be more or equal than ".concat(Kt," characters."));if("number"==typeof Ui&&Be.length>Ui)throw new Error("error in length, should be less or equal than ".concat(Ui," characters."));return I._cur=se,Be}consumeAttributeSpace(I){if(I.attValue[I._cur]!==g)throw new Error("Invalid space at ".concat(I._cur,"."));I._cur+=1}extract(I,F,...j){if(!I.attValue)throw new Error("Nothing to extract from attValue.");const se=F.call(this,I.attValue,I._cur,...j),Be=I.attValue.slice(I._cur,se);return I._cur=se,Be}atEnd(I){if(!I.attValue)throw new Error;return I._cur>=I.attValue.length}peekChar(I){if(!I.attValue)throw new Error;return I.attValue[I._cur]}peek(I,F){if(!I.attValue)throw new Error;for(let j=0;j<F.length;j++)if(F[j]!==I.attValue[I._cur+j])return!1;return!0}parseIceUfrag(I){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(I,Y,[4,256])}parseIcePwd(I){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(I,Y,[22,256])}parseIceOptions(I){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const F=[];for(;!this.atEnd(I);){F.push(this.extractOneOrMore(I,Y));try{this.consumeAttributeSpace(I)}catch(j){if(this.atEnd(I))break;throw j}}this.attributes.iceOptions=F}parseFingerprint(I){const F=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);const j=this.extract(I,this.consumeTill);this.attributes.fingerprints.push({hashFunction:F,fingerprint:j})}parseExtmap(I){const F=this.extractOneOrMore(I,b);let j;"/"===this.peekChar(I)&&(this.extract(I,this.consume,"/"),j=this.extract(I,this.consumeToken)),this.consumeAttributeSpace(I);const se=this.extract(I,this.consumeTill,g),Be=$($({entry:parseInt(F,10)},j&&{direction:j}),{},{extensionName:se});this.peekChar(I)===g&&(this.consumeAttributeSpace(I),Be.extensionAttributes=this.extract(I,this.consumeTill)),this.attributes.extmaps.push(Be)}parseSetup(I){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const F=this.extract(I,this.consumeTill);if("active"!==F&&"passive"!==F&&"actpass"!==F&&"holdconn"!==F)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=F}}class ut extends Ye{constructor(...I){super(...I),J(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(I){if(this.digested)throw new Error("already digested");try{switch(I.attField){case"group":this.parseGroup(I);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(I);break;case"ice-pwd":this.parseIcePwd(I);break;case"ice-options":this.parseIceOptions(I);break;case"fingerprint":this.parseFingerprint(I);break;case"setup":this.parseSetup(I);break;case"tls-id":this.parseTlsId(I);break;case"identity":this.parseIdentity(I);break;case"extmap":this.parseExtmap(I);break;case"msid-semantic":this.parseMsidSemantic(I);break;default:I.ignored=!0,this.attributes.unrecognized.push(I)}}catch(F){throw console.error("parsing session attribute ".concat(I.attField,' error, "a=').concat(I.attField,":").concat(I.attValue,'"')),F}if(!I.ignored&&I.attValue&&!this.atEnd(I))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(I){const F=this.extract(I,this.consumeToken),j=[];for(;!this.atEnd(I)&&this.peekChar(I)===g;)this.consumeAttributeSpace(I),j.push(this.extract(I,this.consumeToken));this.attributes.groups.push({semantic:F,identificationTag:j})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(I){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(I,oe)}parseIdentity(I){const F=this.extractOneOrMore(I,K),j=[];for(;!this.atEnd(I)&&this.peekChar(I)===g;){this.consumeAttributeSpace(I);const se=this.extract(I,this.consumeToken);this.extract(I,this.consume,"=");const Be=this.extractOneOrMore(I,Kt=>Kt!==g&&U(Kt));j.push({name:se,value:Be})}this.attributes.identities.push({assertionValue:F,extensions:j})}parseMsidSemantic(I){this.peekChar(I)===g&&this.consumeAttributeSpace(I);const F={semantic:this.extract(I,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(I)}catch{break}if("*"===this.peekChar(I)){this.extract(I,this.consume,"*"),F.applyForAll=!0;break}{const j=this.extract(I,this.consumeTill,g);F.identifierList.push(j)}}this.attributes.msidSemantic=F}}class yt extends Ye{constructor(I){super(),J(this,"attributes",void 0),-1!==I.protos.indexOf("RTP")||I.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(I){if(this.digested)throw new Error("already digested");try{switch(I.attField){case"extmap":this.parseExtmap(I);break;case"setup":this.parseSetup(I);break;case"ice-ufrag":this.parseIceUfrag(I);break;case"ice-pwd":this.parseIcePwd(I);break;case"ice-options":this.parseIceOptions(I);break;case"candidate":this.parseCandidate(I);break;case"remote-candidate":this.parseRemoteCandidate(I);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(I);break;case"rtpmap":this.parseRtpmap(I);break;case"ptime":this.parsePtime(I);break;case"maxptime":this.parseMaxPtime(I);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(I);break;case"ssrc":this.parseSSRC(I);break;case"fmtp":this.parseFmtp(I);break;case"rtcp-fb":this.parseRtcpFb(I);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(I);break;case"mid":this.parseMid(I);break;case"msid":this.parseMsid(I);break;case"imageattr":this.parseImageAttr(I);break;case"rid":this.parseRid(I);break;case"simulcast":this.parseSimulcast(I);break;case"sctp-port":this.parseSctpPort(I);break;case"max-message-size":this.parseMaxMessageSize(I);break;case"ssrc-group":this.parseSSRCGroup(I);break;default:I.ignored=!0,this.attributes.unrecognized.push(I)}}catch(F){throw console.error("parsing media attribute ".concat(I.attField,' error, "a=').concat(I.attField,":").concat(I.attValue,'"')),F}if(!I.ignored&&I.attValue&&!this.atEnd(I))throw new Error("attribute parsing error")}parseCandidate(I){const F=this.extractOneOrMore(I,Y,[1,32]);this.consumeAttributeSpace(I);const j=this.extractOneOrMore(I,b,[1,5]);this.consumeAttributeSpace(I);const se=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);const Be=this.extractOneOrMore(I,b,[1,10]);this.consumeAttributeSpace(I);const Kt=this.extract(I,this.consumeAddress);this.consumeAttributeSpace(I);const Ui=this.extract(I,this.consumePort);this.consumeAttributeSpace(I),this.extract(I,this.consume,"typ"),this.consumeAttributeSpace(I);const yo={foundation:F,componentId:j,transport:se,priority:Be,connectionAddress:Kt,port:Ui,type:this.extract(I,this.consumeToken),extension:{}};for(this.peek(I," raddr")&&(this.extract(I,this.consume," raddr"),this.consumeAttributeSpace(I),yo.relAddr=this.extract(I,this.consumeAddress)),this.peek(I," rport")&&(this.extract(I,this.consume," rport"),this.consumeAttributeSpace(I),yo.relPort=this.extract(I,this.consumePort));this.peekChar(I)===g;){this.consumeAttributeSpace(I);const fl=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I),yo.extension[fl]=this.extractOneOrMore(I,C)}this.attributes.candidates.push(yo)}parseRemoteCandidate(I){const F=[];for(;;){const j=this.extractOneOrMore(I,b,[1,5]);this.consumeAttributeSpace(I);const se=this.extract(I,this.consumeAddress);this.consumeAttributeSpace(I);const Be=this.extract(I,this.consumePort);F.push({componentId:j,connectionAddress:se,port:Be});try{this.consumeAttributeSpace(I)}catch{break}}this.attributes.remoteCandidatesList.push(F)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(I){const F=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);const j=this.extract(I,this.consumeTill,"/");this.extract(I,this.consume,"/");const se={encodingName:j,clockRate:this.extractOneOrMore(I,b)};this.atEnd(I)||"/"!==this.peekChar(I)||(this.extract(I,this.consume,"/"),se.encodingParameters=parseInt(this.extract(I,this.consumeTill),10));const Be=this.attributes.payloads.find(Kt=>Kt.payloadType===parseInt(F,10));Be?Be.rtpMap=se:this.attributes.payloads.push({payloadType:parseInt(F,10),rtpMap:se,rtcpFeedbacks:[]})}parsePtime(I){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(I,this.consumeTill)}parseMaxPtime(I){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(I,this.consumeTill)}parseDirection(I){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=I.attField}parseSSRC(I){const F=this.extractOneOrMore(I,b);this.consumeAttributeSpace(I);const j=this.extract(I,this.consumeTill,":");let se;":"===this.peekChar(I)&&(this.extract(I,this.consume,":"),se=this.extract(I,this.consumeTill));const Be=this.attributes.ssrcs.find(Kt=>Kt.ssrcId===parseInt(F,10));Be?Be.attributes[j]=se:this.attributes.ssrcs.push({ssrcId:parseInt(F,10),attributes:{[j]:se}})}parseFmtp(I){const F=this.extract(I,this.consumeTill,g);this.consumeAttributeSpace(I);const j=this.extract(I,this.consumeTill),se={};j.split(";").forEach(Kt=>{let[Ui,yo]=Kt.split("=");Ui=Ui.trim();const fl="string"==typeof yo?yo.trim():null;"string"==typeof Ui&&Ui.length>0&&(se[Ui]=fl)});const Be=this.attributes.payloads.find(Kt=>Kt.payloadType===parseInt(F,10));Be?Be.fmtp={parameters:se}:this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[],fmtp:{parameters:se}})}parseFmtParameters(I){const F={},j=this.extract(I,this.consumeTill,"=");I._cur++;const se=this.extract(I,this.consumeTill,";");for(F[j]=se;";"===I.attValue[I._cur];){const Be=this.extract(I,this.consumeTill,"=");I._cur++;const Kt=this.extract(I,this.consumeTill,";");F[Be]=Kt}return F}parseRtcpFb(I){let F="";F="*"===this.peekChar(I)?this.extract(I,this.consume,"*"):this.extract(I,this.consumeTill,g),this.consumeAttributeSpace(I);const j=this.extract(I,this.consumeTill,g);let se;if("trr-int"===j)se={type:j,interval:this.extract(I,this.consumeTill)};else{const Be={type:j};this.peekChar(I)===g&&(this.consumeAttributeSpace(I),Be.parameter=this.extract(I,this.consumeToken),this.peekChar(I)===g&&(Be.additional=this.extract(I,this.consumeTill))),se=Be}if("*"===F)this.attributes.rtcpFeedbackWildcards.push(se);else{const Be=this.attributes.payloads.find(Kt=>Kt.payloadType===parseInt(F,10));Be?Be.rtcpFeedbacks.push(se):this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[se]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(I){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const F={port:this.extract(I,this.consumePort)};this.peekChar(I)===g&&(this.consumeAttributeSpace(I),F.netType=this.extractOneOrMore(I,P),this.consumeAttributeSpace(I),F.addressType=this.extractOneOrMore(I,P),this.consumeAttributeSpace(I),F.address=this.extract(I,this.consumeAddress)),this.attributes.rtcp=F}parseMsid(I){const F={id:this.extractOneOrMore(I,P,[1,64])};this.peekChar(I)===g&&(this.consumeAttributeSpace(I),F.appdata=this.extractOneOrMore(I,P,[1,64])),this.attributes.msids.push(F)}parseImageAttr(I){this.attributes.imageattr.push(I.attValue)}parseRid(I){const F=this.extractOneOrMore(I,se=>k(se)||b(se)||"_"===se||"-"===se);this.consumeAttributeSpace(I);const j={id:F,direction:this.extract(I,this.consumeToken),params:[]};if(this.peekChar(I)===g){if(this.consumeAttributeSpace(I),this.peek(I,"pt=")){this.extract(I,this.consume,"pt=");const se=[];for(;;){const Be=this.extract(I,this.consumeToken);se.push(Be);try{this.extract(I,this.consume,",")}catch{break}}j.payloads=se,this.peekChar(I)===g&&this.extract(I,this.consume,g)}for(;;){const se=this.extract(I,this.consumeToken);switch(se){case"depend":{const Be={type:se,rids:this.extract(I,this.consume,"=").split(",")};j.params.push(Be);break}default:{const Be={type:se};"="===this.peekChar(I)&&(this.extract(I,this.consume,"="),Be.val=this.extract(I,this.consumeTill,";")),j.params.push(Be)}}try{this.extract(I,this.consume,";")}catch{break}}}this.attributes.rids.push(j)}parseSimulcast(I){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=I.attValue,this.extract(I,this.consumeTill)}parseSctpPort(I){this.attributes.sctpPort=this.extractOneOrMore(I,b,[1,5])}parseMaxMessageSize(I){this.attributes.maxMessageSize=this.extractOneOrMore(I,b,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(I){this.attributes.mid=this.extract(I,this.consumeToken)}parseSSRCGroup(I){const F=this.extract(I,this.consumeToken),j=[];for(;;)try{this.consumeAttributeSpace(I);const se=this.extract(I,this.consumeInteger);j.push(parseInt(se,10))}catch{break}this.attributes.ssrcGroups.push({semantic:F,ssrcIds:j})}}function lt(de,I,F){return I in de?Object.defineProperty(de,I,{value:F,enumerable:!0,configurable:!0,writable:!0}):de[I]=F,de}class bt{constructor(){lt(this,"eol",_)}print(I,F){let j="";return F&&(this.eol=F),j+=this.printVersion(I.version),j+=this.printOrigin(I.origin),j+=this.printSessionName(I.sessionName),j+=this.printInformation(I.information),j+=this.printUri(I.uri),j+=this.printEmail(I.emails),j+=this.printPhone(I.phones),j+=this.printConnection(I.connection),j+=this.printBandwidth(I.bandwidths),j+=this.printTimeFields(I.timeFields),j+=this.printKey(I.key),j+=this.printSessionAttributes(I.attributes),j+=this.printMediaDescription(I.mediaDescriptions),j}printVersion(I){return"v=".concat(I).concat(this.eol)}printOrigin(I){return"o=".concat(I.username," ").concat(I.sessId," ").concat(I.sessVersion," ").concat(I.nettype," ").concat(I.addrtype," ").concat(I.unicastAddress).concat(this.eol)}printSessionName(I){return I?"s=".concat(I).concat(this.eol):""}printInformation(I){return I?"i=".concat(I).concat(this.eol):""}printUri(I){return I?"u=".concat(I).concat(this.eol):""}printEmail(I){let F="";for(const j of I)F+="e=".concat(j).concat(this.eol);return F}printPhone(I){let F="";for(const j of I)F+="e=".concat(j).concat(this.eol);return F}printConnection(I){return I?"c=".concat(I.nettype," ").concat(I.addrtype," ").concat(I.address).concat(this.eol):""}printBandwidth(I){let F="";for(const j of I)F+="b=".concat(j.bwtype,":").concat(j.bandwidth).concat(this.eol);return F}printTimeFields(I){let F="";for(const j of I){F+="t=".concat(j.time.startTime," ").concat(j.time.startTime).concat(this.eol);for(const se of j.repeats)F+="r=".concat(se.repeatInterval," ").concat(se.typedTimes.join(" ")).concat(this.eol);j.zoneAdjustments&&(F+="z=",F+="z=".concat(j.zoneAdjustments.map(se=>"".concat(se.time," ").concat(se.back?"-":""," ").concat(se.typedTime)).join(" ")).concat(this.eol),F+=this.eol)}return F}printKey(I){return I?"k=".concat(I).concat(this.eol):""}printAttributes(I){let F="";for(const j of I)F+="a=".concat(j.attField).concat(j.attValue?":".concat(j.attValue):"").concat(this.eol);return F}printMediaDescription(I){let F="";for(const j of I)F+=this.printMedia(j.media),F+=this.printInformation(j.information),F+=this.printConnections(j.connections),F+=this.printBandwidth(j.bandwidths),F+=this.printKey(j.key),F+=this.printMediaAttributes(j);return F}printConnections(I){let F="";for(const j of I)F+=this.printConnection(j);return F}printMedia(I){return"m=".concat(I.mediaType," ").concat(I.port," ").concat(I.protos.join("/")," ").concat(I.fmts.join(" ")).concat(this.eol)}printSessionAttributes(I){return new ae(this.eol).print(I)}printMediaAttributes(I){return new _e(this.eol).print(I)}}class ne{constructor(I){lt(this,"eol",void 0),this.eol=I}printIceUfrag(I){return void 0===I?"":"a=ice-ufrag:".concat(I).concat(this.eol)}printIcePwd(I){return void 0===I?"":"a=ice-pwd:".concat(I).concat(this.eol)}printIceOptions(I){return void 0===I?"":"a=ice-options:".concat(I.join(g)).concat(this.eol)}printFingerprints(I){return I.length>0?I.map(F=>"a=fingerprint:".concat(F.hashFunction).concat(g).concat(F.fingerprint)).join(this.eol)+this.eol:""}printExtmap(I){return I.map(F=>"a=extmap:".concat(F.entry).concat(F.direction?"/".concat(F.direction):"").concat(g).concat(F.extensionName).concat(F.extensionAttributes?"".concat(g).concat(F.extensionAttributes):"").concat(this.eol)).join("")}printSetup(I){return void 0===I?"":"a=setup:".concat(I).concat(this.eol)}printUnrecognized(I){return I.map(F=>"a=".concat(F.attField).concat(F.attValue?":".concat(F.attValue):"").concat(this.eol)).join("")}}class ae extends ne{print(I){let F="";return F+=this.printGroups(I.groups),F+=this.printMsidSemantic(I.msidSemantic),F+=this.printIceLite(I.iceLite),F+=this.printIceUfrag(I.iceUfrag),F+=this.printIcePwd(I.icePwd),F+=this.printIceOptions(I.iceOptions),F+=this.printFingerprints(I.fingerprints),F+=this.printSetup(I.setup),F+=this.printTlsId(I.tlsId),F+=this.printIdentity(I.identities),F+=this.printExtmap(I.extmaps),F+=this.printUnrecognized(I.unrecognized),F}printGroups(I){let F="";return I.length>0&&(F+=I.map(j=>"a=group:".concat(j.semantic).concat(j.identificationTag.map(se=>"".concat(g).concat(se)).join("")).concat(this.eol)).join("")),F}printIceLite(I){return void 0===I?"":"a=ice-lite"+this.eol}printTlsId(I){return I?"a=tls-id:".concat(I).concat(this.eol):""}printIdentity(I){return 0===I.length?"":I.map(F=>"a=identity:".concat(F.assertionValue).concat(F.extensions.map(j=>"".concat(g).concat(j.name).concat(j.value?"=".concat(j.value):"")))).join(this.eol)+this.eol}printMsidSemantic(I){if(!I)return"";let F="a=msid-semantic:".concat(I.semantic);return I.applyForAll?F+="".concat(g,"*"):I.identifierList.length>0&&(F+=I.identifierList.map(j=>"".concat(g).concat(j))),F+this.eol}}class _e extends ne{print(I){const F=I.attributes;let j="";return j+=this.printRTCP(F.rtcp),j+=this.printIceUfrag(F.iceUfrag),j+=this.printIcePwd(F.icePwd),j+=this.printIceOptions(F.iceOptions),j+=this.printCandidates(F.candidates),j+=this.printRemoteCandidatesList(F.remoteCandidatesList),j+=this.printEndOfCandidates(F.endOfCandidates),j+=this.printFingerprints(F.fingerprints),j+=this.printSetup(F.setup),j+=this.printMid(F.mid),j+=this.printExtmap(F.extmaps),j+=this.printRTPRelated(F),j+=this.printPtime(F.ptime),j+=this.printMaxPtime(F.maxPtime),j+=this.printDirection(F.direction),j+=this.printSSRCGroups(F.ssrcGroups),j+=this.printSSRC(F.ssrcs),j+=this.printRTCPMux(F.rtcpMux),j+=this.printRTCPMuxOnly(F.rtcpMuxOnly),j+=this.printRTCPRsize(F.rtcpRsize),j+=this.printMSId(F.msids),j+=this.printImageattr(F.imageattr),j+=this.printRid(F.rids),j+=this.printSimulcast(F.simulcast),j+=this.printSCTPPort(F.sctpPort),j+=this.printMaxMessageSize(F.maxMessageSize),j+=this.printUnrecognized(F.unrecognized),j}printCandidates(I){return I.map(F=>"a=candidate:".concat(F.foundation).concat(g).concat(F.componentId).concat(g).concat(F.transport).concat(g).concat(F.priority).concat(g).concat(F.connectionAddress).concat(g).concat(F.port).concat(g,"typ").concat(g).concat(F.type).concat(F.relAddr?"".concat(g,"raddr").concat(g).concat(F.relAddr):"").concat(F.relPort?"".concat(g,"rport").concat(g).concat(F.relPort):"").concat(Object.keys(F.extension).map(j=>"".concat(g).concat(j).concat(g).concat(F.extension[j])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(I){return I.map(F=>"a=remote-candidates:".concat(F.join(g)).concat(this.eol)).join("")}printEndOfCandidates(I){return void 0===I?"":"a=end-of-candidates"+this.eol}printRTPRelated(I){if(!I.payloads)return"";const F=I.payloads;let j="";j+=I.rtcpFeedbackWildcards.map(se=>this.printRTCPFeedback("*",se)).join("");for(const se of F)j+=this.printRtpMap(se.payloadType,se.rtpMap),j+=this.printFmtp(se.payloadType,se.fmtp),j+=se.rtcpFeedbacks.map(Be=>this.printRTCPFeedback(se.payloadType,Be)).join("");return j}printFmtp(I,F){if(!F)return"";const j=Object.keys(F.parameters);return 1===j.length&&null===F.parameters[j[0]]?"a=fmtp:".concat(I).concat(g).concat(j[0]).concat(this.eol):"a=fmtp:".concat(I).concat(g).concat(Object.keys(F.parameters).map(se=>"".concat(se,"=").concat(F.parameters[se])).join(";")).concat(this.eol)}printRtpMap(I,F){return F?"a=rtpmap:".concat(I).concat(g).concat(F.encodingName,"/").concat(F.clockRate).concat(F.encodingParameters?"/".concat(F.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(I,F){let j="a=rtcp-fb:".concat(I).concat(g),se=F;return"trr-int"===se.type?j+="ttr-int".concat(g).concat(se.interval):(j+="".concat(se.type),se.parameter&&(j+="".concat(g).concat(se.parameter),se.additional&&(j+="".concat(g).concat(se.additional)))),j+this.eol}printPtime(I){return void 0===I?"":"a=ptime:".concat(I).concat(this.eol)}printMaxPtime(I){return void 0===I?"":"a=maxptime:".concat(I).concat(this.eol)}printDirection(I){return void 0===I?"":"a=".concat(I).concat(this.eol)}printSSRC(I){return I.map(F=>Object.keys(F.attributes).map(j=>"a=ssrc:".concat(F.ssrcId.toString(10)).concat(g).concat(j).concat(F.attributes[j]?":".concat(F.attributes[j]):"").concat(this.eol)).join("")).join("")}printRTCPMux(I){return void 0===I?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(I){return void 0===I?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(I){return void 0===I?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(I){if(void 0===I)return"";let F="a=rtcp:".concat(I.port);return I.netType&&(F+="".concat(g).concat(I.netType)),I.addressType&&(F+="".concat(g).concat(I.addressType)),I.address&&(F+="".concat(g).concat(I.address)),F+this.eol}printMSId(I){return I.map(F=>"a=msid:".concat(F.id).concat(F.appdata?"".concat(g).concat(F.appdata):"").concat(this.eol)).join("")}printImageattr(I){return I.map(F=>"a=imageattr:".concat(F).concat(this.eol)).join("")}printRid(I){return I.map(F=>{let j="a=rid:".concat(F.id).concat(g).concat(F.direction);return F.payloads&&(j+="".concat(g,"pt=").concat(F.payloads.join(","))),F.params.length>0&&(j+="".concat(g).concat(F.params.map(se=>"depend"===se.type?"depend=".concat(se.rids.join(",")):"".concat(se.type,"=").concat(se.val)).join(";"))),j+this.eol}).join("")}printSimulcast(I){return void 0===I?"":"a=simulcast:".concat(I).concat(this.eol)}printSCTPPort(I){return void 0===I?"":"a=sctp-port:".concat(I).concat(this.eol)}printMaxMessageSize(I){return void 0===I?"":"a=max-message-size:".concat(I).concat(this.eol)}printMid(I){return void 0===I?"":"a=mid:".concat(I).concat(this.eol)}printSSRCGroups(I){return I.map(F=>"a=ssrc-group:".concat(F.semantic).concat(F.ssrcIds.map(j=>"".concat(g).concat(j.toString(10))).join("")).concat(this.eol)).join("")}}function xe(de){return(new ye).parse(de)}function ht(de,I){return(new bt).print(de,I)}}},s={};function c(d){if(s[d])return s[d].exports;var h=s[d]={exports:{}};return r[d](h,h.exports,c),h.exports}return c.d=(d,h)=>{for(var p in h)c.o(h,p)&&!c.o(d,p)&&Object.defineProperty(d,p,{enumerable:!0,get:h[p]})},c.o=(d,h)=>Object.prototype.hasOwnProperty.call(d,h),c.r=d=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})},c(8)})()}(fm);var hn=fm.exports;function oT(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function mm(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?oT(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):oT(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}function Gd(o){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:d,filterAudioFec:h,filterAudioCodec:p,filterVideoCodec:m}=n,{useXR:_}=r;let g=[],v=[],b=[],C=[],N=!1,P=!1;if(hn.parse(o).mediaDescriptions.forEach(D=>{s&&s!==D.attributes.direction||("video"!==D.media.mediaType||N||(v=D.attributes.payloads,C=D.attributes.extmaps,N=!0),"audio"!==D.media.mediaType||P||(g=D.attributes.payloads,b=D.attributes.extmaps,P=!0))}),!C||0===v.length)throw new Error("Cannot get video capabilities from SDP.");if(!b||0===g.length)throw new Error("Cannot get audio capabilities from SDP.");return v.forEach(D=>{var k;null!==(k=D.rtpMap)&&void 0!==k&&k.clockRate&&(D.rtpMap.clockRate=parseInt(D.rtpMap.clockRate)),_&&D.rtcpFeedbacks.push({type:"rrtr"})}),g.forEach(D=>{var k;null!==(k=D.rtpMap)&&void 0!==k&&k.clockRate&&(D.rtpMap.clockRate=parseInt(D.rtpMap.clockRate)),_&&D.rtcpFeedbacks.push({type:"rrtr"})}),c&&(g=g.filter(D=>{var k;return"rtx"!==(null===(k=D.rtpMap)||void 0===k?void 0:k.encodingName.toLowerCase())}),v=v.filter(D=>{var k;return"rtx"!==(null===(k=D.rtpMap)||void 0===k?void 0:k.encodingName.toLowerCase())})),d&&(v=v.filter(D=>{var k;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(k=D.rtpMap)||void 0===k?void 0:k.encodingName)||"")})),h&&(g=g.filter(D=>{var k;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(k=D.rtpMap)||void 0===k?void 0:k.encodingName)||"")})),p&&p?.length>0&&(g=g.filter(D=>{var k;return Re(p).call(p,(null===(k=D.rtpMap)||void 0===k?void 0:k.encodingName.toLowerCase())||"")})),m&&m?.length>0&&(v=v.filter(D=>{var k;return Re(m).call(m,(null===(k=D.rtpMap)||void 0===k?void 0:k.encodingName.toLowerCase())||"")})),{audioCodecs:g,videoCodecs:v,audioExtensions:b,videoExtensions:C}}function Bh(o){const n=hn.parse(o);let r,s;for(const c of n.mediaDescriptions){if(!r){const d=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");r={iceUfrag:d,icePwd:h}}if(!s){const d=c.attributes.fingerprints;d.length>0&&(s={fingerprints:d})}}if(!s&&n.attributes.fingerprints.length>0&&(s={fingerprints:n.attributes.fingerprints}),!s||!r)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:r,dtlsParameters:s}}function yL(o,n){const r=[],s=o.attributes.ssrcGroups.filter(h=>"FID"===h.semantic),c=o.attributes.ssrcGroups.find(h=>"SIM"===h.semantic),d=o.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var p;const m=null===(p=s.find(_=>_.ssrcIds[0]===h))||void 0===p?void 0:p.ssrcIds[1];r.push({ssrcId:h,rtx:n?m:void 0})});else if(s.length>0)r.push({ssrcId:s[0].ssrcIds[0],rtx:n?s[0].ssrcIds[1]:void 0});else{if(0===d.length)throw new Error("No ssrcs found on local media description.");r.push({ssrcId:d[0].ssrcId})}return r}function sT(o,n){const{cname:r}=o;let s;n&&n.ip&&"number"==typeof n.port?(s=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:n.ip,port:n.port.toString(),type:"host",extension:{}}],w.debug("Using remote candidate from AP ".concat(n.ip,":").concat(n.port)),n.ip6&&(s.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:n.ip6,port:n.port.toString(),type:"host",extension:{}}),w.debug("Using IPV6 remote candidate from AP ".concat(n.ip6,":").concat(n.port)))):s=o.iceParameters.candidates.map(p=>({foundation:p.foundation,componentId:"1",transport:p.protocol,priority:p.priority.toString(),connectionAddress:p.ip,port:p.port.toString(),type:p.type,extension:{}}));const c={fingerprints:o.dtlsParameters.fingerprints.map(p=>({hashFunction:p.algorithm,fingerprint:p.fingerprint}))},d={iceUfrag:o.iceParameters.iceUfrag,icePwd:o.iceParameters.icePwd};let h;switch(o.dtlsParameters.role){case"server":h="passive";break;case"client":h="active";break;case"auto":h="actpass"}return{dtlsParameters:c,iceParameters:d,candidates:s,rtpCapabilities:aT(o.rtpCapabilities),setup:h,cname:r}}function Cs(o,n,r){const s=[],c=[];return o.forEach(d=>{let{ssrcId:h,rtx:p}=d;const m=It(8,"track-"),_={ssrcId:h,attributes:mm({label:m,mslabel:r=r||It(10,""),msid:"".concat(r," ").concat(m)},n&&{cname:n})};if(s.push(_),void 0!==p){const g={ssrcId:p,attributes:mm({label:m,mslabel:r,msid:"".concat(r," ").concat(m)},n&&{cname:n})};s.push(g),c.push({semantic:"FID",ssrcIds:[h,p]})}}),o.length>1&&c.push({semantic:"SIM",ssrcIds:o.map(d=>{let{ssrcId:h}=d;return h})}),{ssrcs:s,ssrcGroups:c}}function Ts(o,n){n instanceof mt&&o.attributes.payloads.forEach(r=>{var s;const c=null===(s=r.rtpMap)||void 0===s?void 0:s.encodingName.toLowerCase();if(!c||-1===["opus","pcmu","pcma","g722"].indexOf(c))return;r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.minptime="10",r.fmtp.parameters.useinbandfec="1";const d=n._encoderConfig;d&&"pcmu"!==c&&"pcma"!==c&&"g722"!==c&&(d.bitrate&&!jt()&&(r.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(r.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),r.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"))})}function jh(o){const n=o.attributes.unrecognized.findIndex(r=>"x-google-flag"===r.attField&&"conference"===r.attValue);-1!==n&&o.attributes.unrecognized.splice(n,1)}function Hh(o,n){var r;if(!(n instanceof We&&n._encoderConfig&&-1===n._hints.indexOf(Vt.SCREEN_TRACK)))return;const s=n._encoderConfig;Lt().supportMinBitrate&&s.bitrateMin&&o.attributes.payloads.forEach(c=>{var d,h;Re(d=["h264","h265","vp8","vp9","av1"]).call(d,(null===(h=c.rtpMap)||void 0===h?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(s.bitrateMin))}),Lt().supportMinBitrate&&!Re(r=n._hints).call(r,Vt.LOW_STREAM)&&s.bitrateMax&&o.attributes.payloads.forEach(c=>{var d,h;Re(d=["h264","h265","vp8","vp9","av1"]).call(d,(null===(h=c.rtpMap)||void 0===h?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(B("X_GOOGLE_START_BITRATE")||Math.floor(s.bitrateMax)))})}function Gh(o){if("video"!==o.media.mediaType)return;const n=Ve();if(n.name!==_t.SAFARI&&n.os!==ei.IOS)return;const r=o.attributes.extmaps.findIndex(s=>/video-orientation/g.test(s.extensionName));-1!==r&&o.attributes.extmaps.splice(r,1)}function Wd(o,n,r){if(!n)return;let s,c;if("video"===o.media.mediaType?(s=r.videoExtensions,c=r.videoCodecs):(s=r.audioExtensions,c=r.audioCodecs),!0===n.twcc){const d=s.find(h=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===h.extensionName);d&&(o.attributes.extmaps.find(p=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===p.extensionName)||o.attributes.extmaps.push({entry:d.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),(p=c,m=o.attributes.payloads,m.filter(_=>!!p.find(g=>g.payloadType===_.payloadType&&!!g.rtcpFeedbacks.find(v=>"transport-cc"===v.type)))).forEach(p=>{p.rtcpFeedbacks.find(m=>"transport-cc"===m.type)||p.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(!1===n.twcc){const d=o.attributes.extmaps.findIndex(h=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===h.extensionName);-1!==d&&o.attributes.extmaps.splice(d,1),o.attributes.payloads.forEach(h=>{const p=h.rtcpFeedbacks.findIndex(m=>"transport-cc"===m.type);-1!==p&&h.rtcpFeedbacks.splice(p,1)})}var p,m;if(!0===n.remb){const d=s.find(h=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===h.extensionName);d&&(o.attributes.extmaps.find(p=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===p.extensionName)||o.attributes.extmaps.push({entry:d.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(p,m){return m.filter(_=>!!p.find(g=>g.payloadType===_.payloadType&&!!g.rtcpFeedbacks.find(v=>"goog-remb"===v.type)))}(c,o.attributes.payloads).forEach(p=>{p.rtcpFeedbacks.find(m=>"goog-remb"===m.type)||p.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(!1===n.remb){const d=o.attributes.extmaps.findIndex(h=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===h.extensionName);-1!==d&&o.attributes.extmaps.splice(d,1),o.attributes.payloads.forEach(h=>{const p=h.rtcpFeedbacks.findIndex(m=>"goog-remb"===m.type);-1!==p&&h.rtcpFeedbacks.splice(p,1)})}}function Wh(o,n,r){if(jt()||"video"!==o.media.mediaType||!(n instanceof We)||"vp9"!==r&&"vp8"!==r||"vp8"===r&&!B("SIMULCAST")||void 0===n._scalabilityMode||n._scalabilityMode.numSpatialLayers<=1)return;const s="vp8"===r?2:n._scalabilityMode.numSpatialLayers,c=o.attributes.ssrcs[0],d=o.attributes.ssrcGroups.find(p=>"FID"===p.semantic&&p.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let p=1;p<s;p++)o.attributes.ssrcs.push({ssrcId:c.ssrcId+p,attributes:Ln(c.attributes)}),h.ssrcIds.push(c.ssrcId+p),d&&(o.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+p,attributes:Ln(c.attributes)}),o.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+p,d.ssrcIds[1]+p]}));o.attributes.ssrcGroups.unshift(h)}function FO(){return _m.apply(this,arguments)}function _m(){return _m=x(function*(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{filterRTX:r,filterVideoFec:s,filterAudioFec:c,filterAudioCodec:d,filterVideoCodec:h}=o,{useXR:p}=n,m=new RTCPeerConnection;m.addTransceiver("video",{direction:"sendonly"}),m.addTransceiver("audio",{direction:"sendonly"}),m.addTransceiver("video",{direction:"recvonly"}),m.addTransceiver("audio",{direction:"recvonly"});const _=(yield m.createOffer()).sdp,g=Gd(_,{filterRTX:r,filterVideoFec:s,filterAudioFec:c,filterAudioCodec:d,filterVideoCodec:h},{useXR:p},"sendonly"),v=Gd(_,{filterRTX:r,filterVideoFec:s,filterAudioFec:c,filterAudioCodec:d,filterVideoCodec:h},{useXR:p},"recvonly"),b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(zd(g,v,"videoExtensions",b,C,N),zd(g,v,"videoCodecs",b,C,N),zd(g,v,"audioExtensions",b,C,N),zd(g,v,"audioCodecs",b,C,N),B("RAISE_H264_BASELINE_PRIORITY")){const P=N.videoCodecs.findIndex(D=>{var k,V;return"h264"===(null===(k=D.rtpMap)||void 0===k?void 0:k.encodingName.toLocaleLowerCase())&&"42001f"===(null===(V=D.fmtp)||void 0===V?void 0:V.parameters["profile-level-id"])});if(-1!==P){const D=N.videoCodecs.findIndex(k=>{var V;return"h264"===(null===(V=k.rtpMap)||void 0===V?void 0:V.encodingName.toLocaleLowerCase())});if(D<P){w.debug("raising H264 baseline profile priority");const k=N.videoCodecs[P];N.videoCodecs.splice(P,1),N.videoCodecs.splice(D,0,k)}-1!==D&&(C.videoCodecs=C.videoCodecs.filter(k=>{var V,U;return!("h264"===(null===(V=k.rtpMap)||void 0===V?void 0:V.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(U=k.fmtp)||void 0===U?void 0:U.parameters["profile-level-id"]))})),-1!==D&&B("FILTER_SEND_H264_BASELINE")&&(b.videoCodecs=b.videoCodecs.filter(k=>{var V,U;return!("h264"===(null===(V=k.rtpMap)||void 0===V?void 0:V.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(U=k.fmtp)||void 0===U?void 0:U.parameters["profile-level-id"]))}))}}try{m.close()}catch{}return{send:b,recv:C,sendrecv:N}}),_m.apply(this,arguments)}function zd(o,n,r,s,c,d){if("videoExtensions"===r||"audioExtensions"===r){const h=[];return o[r].forEach(p=>{n[r].some((m,_)=>{if(p.entry===m.entry&&p.extensionName===m.extensionName)return h.push(_),!0})?d[r].push(p):s[r].push(p)}),void n[r].forEach((p,m)=>{-1===h.indexOf(m)&&c[r].push(p)})}if("videoCodecs"===r||"audioCodecs"===r){const h=[];return o[r].forEach(p=>{n[r].some((m,_)=>{if(p.payloadType===m.payloadType&&JSON.stringify(p)===JSON.stringify(m))return h.push(_),!0})?d[r].push(p):s[r].push(p)}),void n[r].forEach((p,m)=>{-1===h.indexOf(m)&&c[r].push(p)})}}function aT(o){const{send:n,recv:r,sendrecv:s}=o;if(!s){if(!n||!r)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:n,recv:r}}let c,d;return n?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...n.audioCodecs,...s.audioCodecs],c.videoCodecs=[...n.videoCodecs,...s.videoCodecs],c.audioExtensions=[...n.audioExtensions,...s.audioExtensions],c.videoExtensions=[...n.videoExtensions,...s.videoExtensions]):c=s,r?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...r.audioCodecs,...s.audioCodecs],d.videoCodecs=[...r.videoCodecs,...s.videoCodecs],d.audioExtensions=[...r.audioExtensions,...s.audioExtensions],d.videoExtensions=[...r.videoExtensions,...s.videoExtensions]):d=s,{send:c,recv:d}}function al(o){"audio"===o.media.mediaType&&o.attributes.payloads.filter(n=>{var r;return"opus"===(null===(r=n.rtpMap)||void 0===r?void 0:r.encodingName.toLowerCase())}).forEach(n=>{n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"})}function gm(o){o.mediaDescriptions.forEach(n=>{"video"!==n.media.mediaType&&"audio"!==n.media.mediaType||n.attributes.payloads.forEach(r=>{-1===r.rtcpFeedbacks.findIndex(s=>"rrtr"===s.type)&&r.rtcpFeedbacks.push({type:"rrtr"})})})}function UO(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function cT(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?UO(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):UO(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}function ws(o){if(Array.isArray(o))return o.map(r=>r);if(!bL(o))return o;const n={};for(const r in o){const s=o[r];n[r]=bL(s)||Array.isArray(s)?ws(s):s}return n}function bL(o){return!("object"!=typeof o||Array.isArray(o)||!o)}class lT{constructor(n){S(this,"input",[]),S(this,"size",void 0),this.size=n}add(n){this.input.push(n),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const Is={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},lv={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Is,remoteCandidate:Is}},SL={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},dv={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},VO={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},dT={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function uv(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function BO(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?uv(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):uv(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}class jO{constructor(n,r){var s=this;S(this,"onFirstVideoReceived",void 0),S(this,"onFirstVideoDecoded",void 0),S(this,"onFirstAudioReceived",void 0),S(this,"onFirstVideoDecodedTimeout",void 0),S(this,"onFirstAudioDecoded",void 0),S(this,"onSelectedLocalCandidateChanged",void 0),S(this,"onSelectedRemoteCandidateChanged",void 0),S(this,"videoIsReady",!1),S(this,"videoIsReady2",{}),S(this,"pc",void 0),S(this,"options",void 0),S(this,"intervalTimer",void 0),S(this,"stats",ws(lv)),S(this,"isFirstVideoReceived",{}),S(this,"isFirstVideoDecoded",{}),S(this,"isFirstAudioReceived",{}),S(this,"isFirstAudioDecoded",{}),S(this,"isFirstVideoDecodedTimeout",{}),S(this,"lossRateWindowStats",[]),this.pc=n,this.options=r,this.intervalTimer=window.setInterval(x(function*(){s.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new z(n=>{n({local:BO({},Is),remote:BO({},Is)})})}setVideoIsReady(n){this.videoIsReady=n}setVideoIsReady2(n,r){this.videoIsReady2[n]=r}getVideoIsReady(n){return this.videoIsReady2[n]||!1}setIsFirstAudioDecoded(n){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(n){this.lossRateWindowStats.push(n),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let c=0,d=0,h=0,p=0;for(const m of s)n[m].forEach((_,g)=>{if(!this.lossRateWindowStats[r-1][m][g]||!this.lossRateWindowStats[0][m][g])return;const v=this.lossRateWindowStats[r-1][m][g].packets-this.lossRateWindowStats[0][m][g].packets,b=this.lossRateWindowStats[r-1][m][g].packetsLost-this.lossRateWindowStats[0][m][g].packetsLost;"videoSend"===m||"audioSend"===m?(c+=v,h+=b):(d+=v,p+=b),_.packetLostRate=Number.isNaN(v)||Number.isNaN(v)||v<=0||b<=0?0:b/(v+b)});n.sendPacketLossRate=c<=0||h<=0?0:h/(c+h),n.recvPacketLossRate=d<=0||p<=0?0:p/(d+p)}}function HO(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function Em(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?HO(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):HO(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}class hv extends jO{constructor(){super(...arguments),S(this,"_stats",lv),S(this,"lastDecodeVideoReceiverStats",new Map)}updateStats(){var n=this;return x(function*(){const r=yield n._getStats(),s=n.statsResponsesToObjects(r);n._stats=ws(lv);const c=s.filter(h=>"ssrc"===h.type);n.processSSRCStats(c);const d=s.find(h=>"VideoBwe"===h.type);d&&n.processBandwidthStats(d),n._stats.timestamp=Date.now(),n.calcLossRate(n._stats),n.stats=n._stats})()}processBandwidthStats(n){this._stats.bitrate={actualEncoded:Number(n.googActualEncBitrate),targetEncoded:Number(n.googTargetEncBitrate),retransmit:Number(n.googRetransmitBitrate),transmit:Number(n.googTransmitBitrate)},this._stats.sendBandwidth=Number(n.googAvailableSendBandwidth)}processSSRCStats(n){n.forEach(r=>{var s;const c=Re(s=r.id).call(s,"send");switch("".concat(r.mediaType,"_").concat(c?"send":"recv")){case"video_send":{const d=ws(dv);d.codec=r.googCodecName,d.adaptionChangeReason="none",r.googCpuLimitedResolution&&(d.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(d.adaptionChangeReason="bandwidth"),d.avgEncodeMs=Number(r.googAvgEncodeMs),d.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},d.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},d.firsCount=Number(r.googFirReceived),d.nacksCount=Number(r.googNacksReceived),d.plisCount=Number(r.googPlisReceived),d.frameCount=Number(r.framesEncoded),d.bytes=Number(r.bytesSent),d.packets=Number(r.packetsSent),d.packetsLost=Number(r.packetsLost),d.ssrc=Number(r.ssrc),d.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(d),this._stats.rtt=d.rttMs;break}case"video_recv":{const d=ws(SL),h=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(d.codec=r.googCodecName,d.targetDelayMs=Number(r.googTargetDelayMs),d.renderDelayMs=Number(r.googRenderDelayMs),d.currentDelayMs=Number(r.googCurrentDelayMs),d.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),d.decodeMs=Number(r.googDecodeMs),d.maxDecodeMs=Number(r.googMaxDecodeMs),d.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},d.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},d.decodeFrameRate=Number(r.googFrameRateDecoded),d.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},d.jitterBufferMs=Number(r.googJitterBufferMs),d.firsCount=Number(r.googFirsSent),d.nacksCount=Number(r.googNacksSent),d.plisCount=Number(r.googPlisSent),d.framesDecodeCount=Number(r.framesDecoded),d.bytes=Number(r.bytesReceived),d.packets=Number(r.packetsReceived),d.packetsLost=Number(r.packetsLost),d.ssrc=Number(r.ssrc),d.packets>0&&!this.isFirstVideoReceived[d.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(d.ssrc),this.isFirstVideoReceived[d.ssrc]=!0),d.framesDecodeCount>0&&!this.isFirstVideoDecoded[d.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(d.ssrc,d.decodedFrame.width,d.decodedFrame.height),this.isFirstVideoDecoded[d.ssrc]=!0),h){const p=h.stats,m=Date.now()-h.lts;d.framesDecodeFreezeTime=p.framesDecodeFreezeTime,d.framesDecodeInterval=p.framesDecodeInterval,d.framesDecodeCount>p.framesDecodeCount&&this.isFirstVideoDecoded[d.ssrc]?(h.lts=Date.now(),d.framesDecodeInterval=m,d.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?d.framesDecodeFreezeTime+=d.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):d.framesDecodeCount<h.stats.framesDecodeCount&&(d.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(d.ssrc,{stats:Em({},d),lts:Date.now()}),this._stats.videoRecv.push(d);break}case"audio_recv":{const d=ws(dT);d.codec=r.googCodecName,d.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,d.decodingCNG=Number(r.googDecodingCNG),d.decodingCTN=Number(r.googDecodingCTN),d.decodingCTSG=Number(r.googDecodingCTSG),d.decodingNormal=Number(r.googDecodingNormal),d.decodingPLC=Number(r.googDecodingPLC),d.decodingPLCCNG=Number(r.googDecodingPLCCNG),d.expandRate=Number(r.googExpandRate),d.accelerateRate=Number(r.googAccelerateRate),d.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),d.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),d.speechExpandRate=Number(r.googSpeechExpandRate),d.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),d.jitterBufferMs=Number(r.googJitterBufferMs),d.jitterMs=Number(r.googJitterReceived),d.bytes=Number(r.bytesReceived),d.packets=Number(r.packetsReceived),d.packetsLost=Number(r.packetsLost),d.ssrc=Number(r.ssrc),d.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),d.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),d.receivedFrames>0&&!this.isFirstAudioReceived[d.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(d.ssrc),this.isFirstAudioReceived[d.ssrc]=!0),d.decodingNormal>0&&!this.isFirstAudioDecoded[d.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(d.ssrc),this.isFirstAudioDecoded[d.ssrc]=!0),this._stats.audioRecv.push(d);break}case"audio_send":{const d=ws(VO);d.codec=r.googCodecName,d.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,d.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),d.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),d.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),d.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),d.bytes=Number(r.bytesSent),d.packets=Number(r.packetsSent),d.packetsLost=Number(r.packetsLost),d.ssrc=Number(r.ssrc),d.rttMs=Number(r.googRtt||0),this._stats.rtt=d.rttMs,this._stats.audioSend.push(d);break}}})}_getStats(){return new z((n,r)=>{this.pc.getStats(n,r)})}statsResponsesToObjects(n){const r=[];return n.result().forEach(s=>{const c={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(d=>{c[d]=s.stat(d)}),r.push(c)}),r}}function uT(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function cl(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?uT(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):uT(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}class zh extends jO{constructor(){super(...arguments),S(this,"_stats",lv),S(this,"report",void 0),S(this,"lastDecodeVideoReceiverStats",new Map),S(this,"lastVideoFramesRecv",new Map),S(this,"lastVideoFramesSent",new Map),S(this,"lastVideoFramesDecode",new Map),S(this,"lastVideoJBDelay",new Map),S(this,"lastAudioJBDelay",new Map),S(this,"mediaBytesSent",new Map),S(this,"mediaBytesRetransmit",new Map),S(this,"mediaBytesTargetEncode",new Map),S(this,"lastEncoderMs",new Map)}updateStats(){var n=this;return x(function*(){n.report=yield n.pc.getStats(),n._stats=ws(lv),n.report.forEach(r=>{switch(r.type){case Gr.OUTBOUND:case Gr.INBOUND:{const s=r.mediaType||r.kind,c=!s&&"frameWidth"in r,d=!s&&!("frameWidth"in r);r.type===Gr.OUTBOUND?"audio"===s||d?n.processAudioOutboundStats(r):("video"===s||c)&&n.processVideoOutboundStats(r):r.type===Gr.INBOUND&&("audio"===s||d?n.processAudioInboundStats(r):("video"===s||c)&&n.processVideoInboundStats(r));break}case Gr.TRANSPORT:{const s=n.report.get(r.selectedCandidatePairId);s&&n.processCandidatePairStats(s);break}case Gr.CANDIDATE_PAIR:r.selected&&n.processCandidatePairStats(r)}}),n.updateSendBitrate(),n._stats.timestamp=Date.now(),n.calcLossRate(n._stats),n.stats=n._stats})()}getSelectedCandidatePair(){var n=this;return x(function*(){const r=yield n.pc.getStats(),s={local:cl({},Is),remote:cl({},Is)};return r.forEach(c=>{let d;if(c.type===Gr.TRANSPORT&&(d=r.get(c.selectedCandidatePairId)),c.type===Gr.CANDIDATE_PAIR&&c.selected&&(d=c),d){const h=(p,m)=>{p.type=m.type,p.id=m.id,m.address&&(p.address=m.address),m.candidateType&&(p.candidateType=m.candidateType),m.port&&(p.port=m.port),m.priority&&(p.priority=m.priority),m.protocol&&(p.protocol=m.protocol),m.relayProtocol&&(p.relayProtocol=m.relayProtocol)};if(d.localCandidateId){const p=r.get(d.localCandidateId);p&&h(s.local,p)}if(d.remoteCandidateId){const p=r.get(d.remoteCandidateId);p&&h(s.remote,p)}}}),s})()}processCandidatePairStats(n){if(this._stats.sendBandwidth=n.availableOutgoingBitrate||0,n.currentRoundTripTime&&(this._stats.rtt=1e3*n.currentRoundTripTime),this._stats.videoSend.forEach(r=>{n.currentRoundTripTime&&(r.rttMs=1e3*n.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{n.currentRoundTripTime&&(r.rttMs=1e3*n.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=n.id,n.localCandidateId){const r=this.report.get(n.localCandidateId);r&&this.processCandidateStats(r)}if(n.remoteCandidateId){const r=this.report.get(n.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(n){let r;n.type===Gr.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),n.type===Gr.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=n.type,r.id=n.id,n.address&&(r.address=n.address),n.candidateType&&(r.candidateType=n.candidateType),n.port&&(r.port=n.port),n.priority&&(r.priority=n.priority),n.protocol&&(r.protocol=n.protocol),n.relayProtocol&&(r.relayProtocol=n.relayProtocol),n.type===Gr.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(cl({},r),cl({},this.stats.selectedCandidatePair.localCandidate)),n.type===Gr.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(cl({},r),cl({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(n){let r=this._stats.audioRecv.find(s=>s.ssrc===n.ssrc);r||(r=ws(dT),this._stats.audioRecv.push(r)),r.ssrc=n.ssrc,r.packets=n.packetsReceived,r.packetsLost=n.packetsLost,r.bytes=n.bytesReceived,r.jitterMs=1e3*n.jitter,this.processAudioTrackReceiverStats(n,n.trackId,r),n.codecId&&(r.codec=this.getCodecFromCodecStats(n.codecId)),r.receivedFrames||(r.receivedFrames=n.packetsReceived),r.droppedFrames||(r.droppedFrames=n.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),"number"==typeof n.concealedSamples&&(r.concealedSamples=n.concealedSamples)}processVideoInboundStats(n){let r=this._stats.videoRecv.find(h=>h.ssrc===n.ssrc);r||(r=ws(SL),this._stats.videoRecv.push(r)),r.ssrc=n.ssrc,r.packets=n.packetsReceived,r.packetsLost=n.packetsLost,r.bytes=n.bytesReceived,r.firsCount=n.firCount,r.nacksCount=n.nackCount,r.plisCount=n.pliCount,r.framesDecodeCount=n.framesDecoded,r.totalInterFrameDelay=n.totalInterFrameDelay,r.totalSquaredInterFrameDelay=n.totalSquaredInterFrameDelay;const s=this.lastDecodeVideoReceiverStats.get(r.ssrc),c=this.lastVideoFramesDecode.get(r.ssrc),d=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,r.decodedFrame?r.decodedFrame.width:0,r.decodedFrame?r.decodedFrame.height:0),this.isFirstVideoDecoded[r.ssrc]=!0),s){const h=s.stats,p=d-s.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&p>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(s.lts=Date.now(),r.framesDecodeInterval=p,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),n.framesDecoded&&n.qpSum&&(r.qpSumPerFrame=s.stats.framesDecodeCount>n.framesDecoded?n.qpSum/n.framesDecoded:(n.qpSum-s.qpSum)/(n.framesDecoded-s.stats.framesDecodeCount))}c&&d-c.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-c.count)/((d-c.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:r.decodeFrameRate})):c?r.decodeFrameRate=c.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:0}),n.totalDecodeTime&&(r.decodeMs=1e3*n.totalDecodeTime),this.processVideoTrackReceiverStats(n,n.trackId,r),n.codecId&&(r.codec=this.getCodecFromCodecStats(n.codecId)),n.framerateMean&&(r.framesRateFirefox=n.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:cl({},r),lts:s?s.lts:Date.now(),qpSum:n.qpSum})}processVideoOutboundStats(n){let r=this._stats.videoSend.find(c=>c.ssrc===n.ssrc);r||(r=ws(dv),this._stats.videoSend.push(r));const s=this.mediaBytesSent.get(n.ssrc);if(s)s.add(n.bytesSent);else{const c=new lT(10);c.add(n.bytesSent),this.mediaBytesSent.set(n.ssrc,c)}if(void 0!==n.retransmittedBytesSent){const c=this.mediaBytesRetransmit.get(n.ssrc);if(c)c.add(n.retransmittedBytesSent);else{const d=new lT(10);d.add(n.retransmittedBytesSent),this.mediaBytesRetransmit.set(n.ssrc,d)}}if(n.totalEncodedBytesTarget){const c=this.mediaBytesTargetEncode.get(n.ssrc);if(c)c.add(n.totalEncodedBytesTarget);else{const d=new lT(10);d.add(n.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(n.ssrc,d)}}if(r.ssrc=n.ssrc,r.bytes=n.bytesSent,r.packets=n.packetsSent,r.firsCount=n.firCount,r.nacksCount=n.nackCount,r.plisCount=n.pliCount,r.frameCount=n.framesEncoded,r.adaptionChangeReason=n.qualityLimitationReason,r.scalabilityMode=n.scalabilityMode,n.totalEncodeTime&&n.framesEncoded){const c=this.lastEncoderMs.get(n.ssrc);r.avgEncodeMs=!c||c.lastFrameCount>n.framesEncoded?1e3*n.totalEncodeTime/n.framesEncoded:1e3*(n.totalEncodeTime-c.lastEncoderTime)/(n.framesEncoded-c.lastFrameCount)}if(n.framesEncoded&&n.qpSum){const c=this.lastEncoderMs.get(n.ssrc);r.qpSumPerFrame=!c||c.lastFrameCount>n.framesEncoded?n.qpSum/n.framesEncoded:(n.qpSum-c.lastQpSum)/(n.framesEncoded-c.lastFrameCount)}if(this.lastEncoderMs.set(n.ssrc,{lastFrameCount:n.framesEncoded,lastEncoderTime:n.totalEncodeTime,lastQpSum:n.qpSum,lts:Date.now()}),n.codecId&&(r.codec=this.getCodecFromCodecStats(n.codecId)),n.mediaSourceId&&this.processVideoMediaSource(n.mediaSourceId,r),this.processVideoTrackSenderStats(n,n.trackId,r),n.remoteId)this.processRemoteInboundStats(n.remoteId,r);else{const c=this.findRemoteStatsId(n.ssrc,Gr.REMOTE_INBOUND);c&&this.processRemoteInboundStats(c,r)}}processAudioOutboundStats(n){let r=this._stats.audioSend.find(s=>s.ssrc===n.ssrc);if(r||(r=ws(VO),this._stats.audioSend.push(r)),r.ssrc=n.ssrc,r.packets=n.packetsSent,r.bytes=n.bytesSent,n.mediaSourceId&&this.processAudioMediaSource(n.mediaSourceId,r),n.codecId&&(r.codec=this.getCodecFromCodecStats(n.codecId)),this.processAudioTrackSenderStats(n,n.trackId,r),n.remoteId)this.processRemoteInboundStats(n.remoteId,r);else{const s=this.findRemoteStatsId(n.ssrc,Gr.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,r)}}findRemoteStatsId(n,r){var s;const c=Array.from(wa(s=this.report).call(s)).find(d=>d.type===r&&d.ssrc===n);return c?c.id:null}processVideoMediaSource(n,r){const s=this.report.get(n);s&&s.width&&s.height&&s.framesPerSecond&&(r.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(n,r){const s=this.report.get(n);s&&(r.inputLevel=s.audioLevel)}processVideoTrackSenderStats(n,r,s){var c,d,h,p;const m=r?this.report.get(r):void 0,_=null!==(c=m?.framesSent)&&void 0!==c?c:n.framesSent;if("number"!=typeof _)return;let g=null!==(d=m?.frameWidth)&&void 0!==d?d:n.frameWidth,v=null!==(h=m?.frameHeight)&&void 0!==h?h:n.frameHeight,b=null!==(p=m?.framesPerSecond)&&void 0!==p?p:n.framesPerSecond;if("number"==typeof g&&"number"==typeof v||(g=0,v=0),null==b){const C=Date.now(),N=this.lastVideoFramesSent.get(s.ssrc);N&&C-N.lts>=800?(b=Math.round((_-N.count)/((C-N.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:_,lts:C,rate:b})):N?b=N.rate:this.lastVideoFramesSent.set(s.ssrc,{count:_,lts:C,rate:0})}s.sentFrame={width:g,height:v,frameRate:Math.max(0,b)}}processVideoTrackReceiverStats(n,r,s){var c,d,h,p,m;const _=r?this.report.get(r):void 0,g=null!==(c=_?.framesReceived)&&void 0!==c?c:n.framesReceived,v=null!==(d=_?.frameWidth)&&void 0!==d?d:n.frameWidth,b=null!==(h=_?.frameHeight)&&void 0!==h?h:n.frameHeight,C=null!==(p=_?.jitterBufferDelay)&&void 0!==p?p:n.jitterBufferDelay,N=null!==(m=_?.jitterBufferEmittedCount)&&void 0!==m?m:n.jitterBufferEmittedCount;if("number"==typeof g){const P=this.lastVideoFramesRecv.get(s.ssrc),D=Date.now();s.framesReceivedCount=g;let k=0;P&&D-P.lts>=800?(k=Math.round((g-P.count)/((D-P.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:g,lts:D,rate:k})):P?k=P.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:g,lts:D,rate:0}),s.receivedFrame={width:v||0,height:b||0,frameRate:k||0},s.decodedFrame={width:v||0,height:b||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:v||0,height:b||0,frameRate:s.decodeFrameRate||0}}if(C&&N){const P=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let D=P.jitterBufferMs;const k=N-P.jitterBufferEmittedCount;k>0&&(D=1e3*(C-P.jitterBufferDelay)/k),s.jitterBufferMs=D,s.currentDelayMs=Math.round(D),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:C,jitterBufferEmittedCount:N,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(n,r,s){var c,d,h,p;const m=r?this.report.get(r):void 0,_=null!==(c=null!==(d=m?.echoReturnLoss)&&void 0!==d?d:n.echoReturnLoss)&&void 0!==c?c:0,g=null!==(h=null!==(p=m?.echoReturnLossEnhancement)&&void 0!==p?p:n.echoReturnLossEnhancement)&&void 0!==h?h:0;s.aecReturnLoss=_,s.aecReturnLossEnhancement=g}processAudioTrackReceiverStats(n,r,s){var c,d,h,p,m,_,g;const v=r?this.report.get(r):void 0,b=null!==(c=v?.removedSamplesForAcceleration)&&void 0!==c?c:n.removedSamplesForAcceleration,C=null!==(d=v?.totalSamplesReceived)&&void 0!==d?d:n.totalSamplesReceived,N=null!==(h=v?.jitterBufferDelay)&&void 0!==h?h:n.jitterBufferDelay,P=null!==(p=v?.jitterBufferEmittedCount)&&void 0!==p?p:n.jitterBufferEmittedCount,D=null!==(m=v?.audioLevel)&&void 0!==m?m:n?.audioLevel,k=null!==(_=v?.totalSamplesDuration)&&void 0!==_?_:n?.totalSamplesDuration,V=null!==(g=v?.concealedSamples)&&void 0!==g?g:n.concealedSamples;if(b&&C&&(s.accelerateRate=b/C),N&&P){const Y=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let oe=Y.jitterBufferMs;const K=P-Y.jitterBufferEmittedCount;K>0&&(oe=1e3*(N-Y.jitterBufferDelay)/K),s.jitterBufferMs=Math.round(oe),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:N,jitterBufferEmittedCount:P,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=D;let U=1920;k&&C&&(U=C/k/50,s.receivedFrames=Math.round(C/U)),V&&(s.droppedFrames=Math.round(V/U))}processRemoteInboundStats(n,r){const s=this.report.get(n);s&&(r.packetsLost=s.packetsLost,s.roundTripTime&&(r.rttMs=1e3*s.roundTripTime),s.jitter&&(r.jitterMs=1e3*s.jitter),s.timestamp&&(r.timestamp=s.timestamp))}getCodecFromCodecStats(n){const r=this.report.get(n);if(!r)return"";const s=r.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let n=0,r=null,s=null;this.mediaBytesSent.forEach(d=>{n+=d.diffMean()}),this.mediaBytesRetransmit.forEach(d=>{r=null===r?d.diffMean():r+d.diffMean()}),this.mediaBytesTargetEncode.forEach(d=>{s=null===s?d.diffMean():s+d.diffMean()}),this._stats.bitrate={actualEncoded:8*(null!==r?n-r:n)/(this.options.updateInterval/1e3),transmit:8*n/(this.options.updateInterval/1e3)},null!==r&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),null!==s&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}}class aV extends jO{updateStats(){return z.resolve()}}function pv(o){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const d=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return d?d<76?new hv(o,{updateInterval:n,lossRateInterval:r,freezeRateLimit:s,firstVideoDecodedTimeout:c}):new zh(o,{updateInterval:n,lossRateInterval:r,freezeRateLimit:s,firstVideoDecodedTimeout:c}):window.RTCStatsReport&&o.getStats()instanceof z?new zh(o,{updateInterval:n,lossRateInterval:r,freezeRateLimit:s,firstVideoDecodedTimeout:c}):new aV(o,{updateInterval:n,lossRateInterval:r,freezeRateLimit:s,firstVideoDecodedTimeout:c})}function hT(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function CL(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?hT(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):hT(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}class ui extends gh{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(n,r){super(n,r),S(this,"store",void 0),S(this,"peerConnection",void 0),S(this,"remoteSDP",void 0),S(this,"initialOffer",void 0),S(this,"statsFilter",void 0),S(this,"useRTX",!1),S(this,"localCapabilities",void 0),S(this,"localCandidateCount",0),S(this,"allCandidatesReceived",!1),S(this,"establishPromise",void 0),S(this,"mutex",new Wn("P2PConnection-mutex")),this.store=r,this.peerConnection=new RTCPeerConnection(ui.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.statsFilter=pv(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,jt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(){var n=this;return x(function*(){try{const r=yield n.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Bh(r.sdp),c=Gd(r.sdp,{filterRTX:!n.useRTX,filterVideoFec:B("FILTER_VIDEO_FEC"),filterAudioFec:B("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return n.localCapabilities=c,n.initialOffer=r,CL(CL({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:c},offerSDP:r.sdp})}catch(r){throw new Q(M.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}})()}connect(n,r,s,c,d,h){var p=this;return x(function*(){try{if(!p.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");p.remoteSDP=new class{constructor(_){S(this,"sessionDesc",void 0),S(this,"localCapabilities",void 0),S(this,"rtpCapabilities",void 0),S(this,"candidates",void 0),S(this,"iceParameters",void 0),S(this,"dtlsParameters",void 0),S(this,"setup",void 0),S(this,"currentMidIndex",void 0),S(this,"cname",void 0),_=Ln(_);const{remoteIceParameters:g,remoteDtlsParameters:v,candidates:b,remoteRTPCapabilities:C,remoteSetup:N,localCapabilities:P,cname:k}=_,V=hn.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=C,this.candidates=b,this.iceParameters=g,this.dtlsParameters=v,this.setup=N,this.localCapabilities=P,this.cname=k;for(let U=0;U<V.mediaDescriptions.length;U++){const Y=V.mediaDescriptions[U];Y.attributes.iceUfrag=g.iceUfrag,Y.attributes.icePwd=g.icePwd,Y.attributes.fingerprints=v.fingerprints,Y.attributes.candidates=b,Y.attributes.setup=N,"video"===Y.media.mediaType&&(Y.media.fmts=C.videoCodecs.map(oe=>oe.payloadType.toString(10)),Y.attributes.payloads=C.videoCodecs,Y.attributes.extmaps=C.videoExtensions),"audio"===Y.media.mediaType&&(Y.media.fmts=C.audioCodecs.map(oe=>oe.payloadType.toString(10)),Y.attributes.payloads=C.audioCodecs,Y.attributes.extmaps=C.audioExtensions),V.mediaDescriptions[U]=this.mungMediaDesc(Y)}this.sessionDesc=V,this.currentMidIndex=V.mediaDescriptions.length-1}toString(){return hn.print(this.sessionDesc)}send(_,g,v){const{ssrcs:b,ssrcGroups:C}=Cs(g,this.cname),N=this.sessionDesc.mediaDescriptions.find(k=>_===ge.VIDEO?"video"===k.media.mediaType:"audio"===k.media.mediaType),P=b[0].attributes.label,D=b[0].attributes.mslabel;return N.attributes.ssrcs=N.attributes.ssrcs.concat(b),N.attributes.ssrcGroups=N.attributes.ssrcGroups.concat(C),{id:P,mslabel:D}}batchSend(_){return _.map(g=>{let{kind:v,ssrcMsg:b}=g;return this.send(v,b,void 0)})}stopSending(_){this.sessionDesc.mediaDescriptions.forEach(g=>{const v=[],b=[],C=[];g.attributes.ssrcs.forEach(N=>{Re(_).call(_,N.attributes.label||"")?C.push(N):v.push(N)}),g.attributes.ssrcGroups.forEach(N=>{var P;Re(P=C.map(D=>D.ssrcId)).call(P,N.ssrcIds[0])||b.push(N)}),g.attributes.ssrcs=v,g.attributes.ssrcGroups=b})}mute(_){const g=this.sessionDesc.mediaDescriptions.find(v=>v.attributes.mid===_);if(!g)throw new Error("mediaDescription not found with ".concat(_," in remote SDP when calling RemoteSDP.mute."));g.attributes.direction="inactive"}unmute(_){const g=this.sessionDesc.mediaDescriptions.find(v=>v.attributes.mid===_);if(!g)throw new Error("mediaDescription not found with ".concat(_," in remote SDP when calling RemoteSDP.unmute."));g.attributes.direction="sendonly"}receive(_,g,v){_.forEach((b,C)=>{const N=b._mediaStreamTrack,P=this.sessionDesc.mediaDescriptions.findIndex(k=>k.attributes.mid===N.kind),D=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[P],b);this.sessionDesc.mediaDescriptions[P]=D})}stopReceiving(_){}updateCandidates(_){_===ki.TCP?this.candidates.forEach(g=>{-1===this.candidates.findIndex(v=>"tcp"===v.transport&&v.connectionAddress===g.connectionAddress&&v.port===g.port)&&this.candidates.push(cT(cT({},g),{},{foundation:"tcpcandidate",priority:Number(g.priority)-1+"",transport:"tcp",port:Number(g.port)+90+""}))}):this.candidates=this.candidates.filter(g=>"tcp"!==g.transport);for(const g of this.sessionDesc.mediaDescriptions)g.attributes.candidates=this.candidates}restartICE(_){_=Ln(_),this.iceParameters=_,this.sessionDesc.mediaDescriptions.forEach(g=>{g.attributes.iceUfrag=_.iceUfrag,g.attributes.icePwd=_.icePwd})}predictReceivingMids(_){const g=[];for(let v=0;v<_;v++)g.push((this.currentMidIndex+v+1).toString(10));return g}mungRecvMediaDsec(_,g){const v=Ln(_);return Ts(v,g),Hh(v,g),v}updateRecvMedia(_,g){const v=this.sessionDesc.mediaDescriptions.findIndex(b=>b.attributes.mid===_);if(-1!==v){const b=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[v],g);this.sessionDesc.mediaDescriptions[v]=b}}bumpMid(_){this.currentMidIndex+=_}updateTrackLabel(_,g,v){const b=this.sessionDesc.mediaDescriptions.find(N=>_===ge.VIDEO?"video"===N.attributes.mid:"audio"===N.attributes.mid);if(b){const N=b.attributes.ssrcs.find(P=>P.attributes.label===g);var C;N&&(N.attributes.label=v,null===(C=N.attributes.msid)||void 0===C||C.replace(g,v))}}mungMediaDesc(_){const g=Ln(_);return jh(g),function(v){const b=v.attributes.extmaps.find(C=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===C.extensionName);b&&v.attributes.extmaps.splice(v.attributes.extmaps.indexOf(b),1),v.attributes.payloads.forEach(C=>{const N=C.rtcpFeedbacks.findIndex(P=>"transport-cc"===P.type);-1!==N&&C.rtcpFeedbacks.splice(N,1)})}(g),g}getSSRC(_){for(const g of this.sessionDesc.mediaDescriptions)for(const v of g.attributes.ssrcs)if(v.attributes.label===_)return[v]}}({remoteIceParameters:n,remoteDtlsParameters:r,candidates:s,remoteRTPCapabilities:c.send,remoteSetup:d,localCapabilities:p.localCapabilities,sdkCodec:p.store.codec,cname:h});const m=p.remoteSDP.toString();yield p.peerConnection.setLocalDescription(p.initialOffer),yield p.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(m){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(m.toString()))}})()}send(n,r){var s=this;return Yr(function*(){const c=yield dt(s.mutex.lock());try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=n.map(b=>s.peerConnection.addTrack(b._mediaStreamTrack)),h=yield dt(s.peerConnection.createOffer()),p=hn.parse(h.sdp),m=n.map(b=>{const C=b._mediaStreamTrack,N=p.mediaDescriptions.find(P=>P.attributes.mid===C.kind);if(!N)throw new Error("Cannot extract ssrc from mediaDescription.");return function(P,D,k){const V=P.attributes.ssrcs.filter(Y=>Y.attributes.label===D),U=P.attributes.ssrcGroups;if(0===V.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(U&&V.length>1){const Y=U.find(oe=>-1!==oe.ssrcIds.indexOf(V[0].ssrcId));return Y?[{ssrcId:Y.ssrcIds[0],rtx:k?Y.ssrcIds[1]:void 0}]:[{ssrcId:V[0].ssrcId}]}return[{ssrcId:V[0].ssrcId}]}(N,C.id,s.useRTX)});let _;try{_=yield m}catch(b){throw d.forEach(C=>{qi()&&C.replaceTrack(null),s.peerConnection.removeTrack(C)}),b}const g=s.mungSendOfferSDP(h.sdp,n);s.remoteSDP.receive(n,r,_);const v=s.remoteSDP.toString();return yield dt(s.peerConnection.setLocalDescription({type:"offer",sdp:g})),yield dt(s.applySendEncodings(d,n)),yield dt(s.peerConnection.setRemoteDescription({type:"answer",sdp:v})),n.map((b,C)=>({localSSRC:m[C],id:b._mediaStreamTrack.id}))}catch(d){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}})()}stopSending(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=r.peerConnection.getSenders().filter(h=>{var p;return-1!==n.indexOf((null===(p=h.track)||void 0===p?void 0:p.id)||"")});if(s.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(h=>{qi()&&h.replaceTrack(null),r.peerConnection.removeTrack(h)});const c=yield r.peerConnection.createOffer();yield r.peerConnection.setLocalDescription(c),r.remoteSDP.stopReceiving(n);const d=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}})()}receive(n,r,s,c){var d=this;return x(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{id:h,mslabel:p}=d.remoteSDP.send(n,r,c),m=new z((v,b)=>{const C=setTimeout(()=>{b(new Error("Cannot receive track, id: ".concat(h)))},1e4),N=P=>{const D=Ve();if(("Safari"===D.name&&11===Number(D.version)||ir())&&P.track.id!==h&&P.streams[0].id===p){var k;const V=P.streams[0].getTracks()[0];return null===(k=d.remoteSDP)||void 0===k||k.updateTrackLabel(n,h,P.track.id),d.peerConnection.removeEventListener("track",N),clearTimeout(C),void v(V)}if(P.track.id===h)return d.peerConnection.removeEventListener("track",N),clearTimeout(C),void v(P.track)};d.peerConnection.addEventListener("track",N)}),_=d.remoteSDP.toString();yield d.peerConnection.setRemoteDescription({type:"offer",sdp:_});const g=yield d.peerConnection.createAnswer();return yield d.peerConnection.setLocalDescription(g),{track:yield m,id:h}}catch(h){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}stopReceiving(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.remoteSDP.stopSending(n);const s=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=yield r.peerConnection.createAnswer();yield r.peerConnection.setLocalDescription(c)}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}})()}muteRemote(n){return x(function*(){})()}unmuteRemote(n){return x(function*(){})()}muteLocal(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=r.peerConnection.getSenders().filter(c=>{var d;return-1!==n.indexOf((null===(d=c.track)||void 0===d?void 0:d.id)||"")});if(s.length!==n.length)throw new Error("sender' length doesn't match mids' length.");s.map(c=>{if(qi()&&c.track)c.track.enabled=!1;else{const d=c.getParameters();d.encodings.forEach(h=>h.active=!1),c.setParameters(d)}})}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}})()}unmuteLocal(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=r.peerConnection.getSenders().filter(h=>{var p;return-1!==n.indexOf((null===(p=h.track)||void 0===p?void 0:p.id)||"")});if(s.length!==n.length)throw new Error("Senders' length doesn't match mids' length.");s.map(function(){var h=x(function*(p){if(qi()&&p.track)p.track.enabled=!0;else{const m=p.getParameters();m.encodings.forEach(_=>_.active=!0),yield p.setParameters(m)}});return function(p){return h.apply(this,arguments)}}());const c=yield r.peerConnection.createOffer();yield r.peerConnection.setLocalDescription(c);const d=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}})()}restartICE(n){var r=this;return Yr(function*(){const s=yield dt(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Lt().supportPCSetConfiguration){const m=r.peerConnection.getConfiguration(),_=n===ki.RELAY?"relay":"all";m.iceTransportPolicy!==_&&(w.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(m.iceTransportPolicy,"] to [").concat(_,"]")),m.iceTransportPolicy=_,r.peerConnection.setConfiguration(m))}else if(n===ki.RELAY)return;n!==ki.RELAY&&r.remoteSDP.updateCandidates(n);const c=yield dt(r.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=Bh(c.sdp),{remoteIceParameters:h}=yield d.iceParameters;r.remoteSDP.restartICE(h);const p=r.remoteSDP.toString();yield dt(r.peerConnection.setLocalDescription(c)),yield dt(r.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(c){w.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}})()}close(){var n;this.peerConnection.close(),null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}updateEncoderConfig(n,r){var s=this;return x(function*(){try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const c=yield s.peerConnection.createOffer(),d=s.mungSendOfferSDP(c.sdp,[r]);s.remoteSDP.updateRecvMedia(r._mediaStreamTrack.kind,r);const h=s.remoteSDP.toString();yield s.peerConnection.setLocalDescription({type:"offer",sdp:d}),yield s.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(c){throw new Q(M.EXCHANGE_SDP_FAILED,c.toString())}})()}updateSendParameters(n,r){var s=this;return x(function*(){const c=s.peerConnection.getSenders().filter(d=>{var h;return(null===(h=d.track)||void 0===h?void 0:h.id)===n});1===c.length&&(yield s.applySendEncodings(c,[r]))})()}setStatsRemoteVideoIsReady(n,r){this.statsFilter.setVideoIsReady2(n,r)}replaceTrack(n,r){var s=this;return x(function*(){const c=s.peerConnection.getSenders().find(d=>{var h;return(null===(h=d.track)||void 0===h?void 0:h.id)===r});c&&(yield c.replaceTrack(n._mediaStreamTrack))})()}createDataChannels(n,r){throw new Q(M.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(n){throw new Q(M.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;null===(n=this.onICEConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},B("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const r={iceServers:[],sdpSemantics:"plan-b"};return n.iceServers?r.iceServers=n.iceServers:n.turnServer&&"off"!==n.turnServer.mode&&(ih(n.turnServer.servers)?r.iceServers=n.turnServer.servers:(r.iceServers&&r.iceServers.push(...ui.turnServerConfigToIceServers(n.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&n.turnServer.serversFromGateway&&r.iceServers.push(...ui.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(n){const r=[];return n.forEach(s=>{s.security?s.tcpport&&r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),r}updateRtpSenderEncodings(n,r){var s=this;return x(function*(){var c;if(r||(r=s.peerConnection.getSenders().find(g=>{var v;return(null===(v=g.track)||void 0===v?void 0:v.id)===n._mediaStreamTrack.id})),!r)return w.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(!Lt().supportSetRtpSenderParameters)return w.warn("Browser not support set rtp-sender parameters");const d={},h={};if(n instanceof We)switch(n._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(B("DSCP_TYPE")&&cs()){var p;const g=B("DSCP_TYPE");Re(p=["very-low","low","medium","high"]).call(p,g)&&(h.networkPriority=g)}const m=r.getParameters(),_=null===(c=m.encodings)||void 0===c?void 0:c[0];_&&Object.assign(_,h),Object.assign(m,d),w.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),yield r.setParameters(m)})()}applySendEncodings(n,r){var s=this;return x(function*(){try{if(!Lt().supportSetRtpSenderParameters||n.length!==r.length)return;for(let c=0;c<n.length;c++){const d=n[c],h=r[c];d&&h&&(yield s.updateRtpSenderEncodings(h,d))}}catch{w.debug("[".concat(s.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(n,r){const s=hn.parse(n);return r.forEach((c,d)=>{const h=c._mediaStreamTrack,p=s.mediaDescriptions.find(m=>m.attributes.mid===h.kind);p&&Ts(p,c)}),hn.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,r,s)=>{var c;null===(c=this.onFirstVideoDecoded)||void 0===c||c.call(this,n,r,s)},this.statsFilter.onSelectedLocalCandidateChanged=(n,r)=>{var s;null===(s=this.onSelectedLocalCandidateChanged)||void 0===s||s.call(this,n,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,r)=>{var s;null===(s=this.onSelectedRemoteCandidateChanged)||void 0===s||s.call(this,n,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}batchReceive(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=r.remoteSDP.batchSend(n).map((h,p)=>{let{id:m,mslabel:_}=h;const{kind:g}=n[p];return new z((v,b)=>{const C=setTimeout(()=>{b(new Error("Cannot receive track, id: ".concat(m)))},1e4),N=P=>{const D=Ve();if("Safari"===D.name&&11===Number(D.version)&&P.track.id!==m&&P.streams[0].id===_){var k;const V=P.streams[0].getTracks()[0];return null===(k=r.remoteSDP)||void 0===k||k.updateTrackLabel(g,m,P.track.id),r.peerConnection.removeEventListener("track",N),clearTimeout(C),void v({track:V,id:m})}if(P.track.id===m)return r.peerConnection.removeEventListener("track",N),clearTimeout(C),void v({track:P.track,id:m})};r.peerConnection.addEventListener("track",N)})}),c=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"offer",sdp:c});const d=yield r.peerConnection.createAnswer();return yield r.peerConnection.setLocalDescription(d),yield z.all(s)}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}})()}getRemoteSSRC(n){var r=this;return x(function*(){if(r.remoteSDP)return r.remoteSDP.getSSRC(n)?.[0].ssrcId})()}setConfiguration(n){if(Lt().supportPCSetConfiguration){const r=ui.resolvePCConfiguration(n);this.peerConnection.setConfiguration(r)}}}function Rs(o,n,r){const s=o[n];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return r.value=x(function*(){const c=this.mutex,d=yield c.lock("Locking from P2PConnection.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield s.apply(this,p)}finally{d()}}),r}function TL(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function ll(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?TL(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):TL(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}ee([Rs,O("design:type",Function),O("design:paramtypes",[Object,Object,Array,Object,String,String]),O("design:returntype",z)],ui.prototype,"connect",null),ee([Rs,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],ui.prototype,"stopSending",null),ee([Rs,O("design:type",Function),O("design:paramtypes",[String,Array,String,Object]),O("design:returntype",z)],ui.prototype,"receive",null),ee([Rs,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],ui.prototype,"stopReceiving",null),ee([Rs,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",z)],ui.prototype,"muteRemote",null),ee([Rs,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",z)],ui.prototype,"unmuteRemote",null),ee([Rs,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],ui.prototype,"muteLocal",null),ee([Rs,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],ui.prototype,"unmuteLocal",null),ee([Rs,O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],ui.prototype,"close",null),ee([Rs,O("design:type",Function),O("design:paramtypes",[String,Li]),O("design:returntype",z)],ui.prototype,"updateEncoderConfig",null),ee([Rs,O("design:type",Function),O("design:paramtypes",[String,Li]),O("design:returntype",z)],ui.prototype,"updateSendParameters",null),ee([Rs,O("design:type",Function),O("design:paramtypes",[Li,String]),O("design:returntype",z)],ui.prototype,"replaceTrack",null),ee([Rs,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",z)],ui.prototype,"getRemoteSSRC",null);function pT(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function Kd(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?pT(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):pT(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}let Qn=class s0 extends gh{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var n,r;return null!==(n=null===(r=this.peerConnection.getReceivers()[0])||void 0===r||null===(r=r.transport)||void 0===r?void 0:r.state)&&void 0!==n?n:null}constructor(n,r){super(n,r),S(this,"store",void 0),S(this,"peerConnection",void 0),S(this,"remoteSDP",void 0),S(this,"initialOffer",void 0),S(this,"transportEventReceiver",void 0),S(this,"statsFilter",void 0),S(this,"useXR",B("USE_XR")),S(this,"localCapabilities",void 0),S(this,"localCandidateCount",0),S(this,"allCandidatesReceived",!1),S(this,"dataStreamChannelMap",new Map),S(this,"establishPromise",void 0),S(this,"mutex",new Wn("P2PConnection-mutex")),this.store=r,this.peerConnection=new RTCPeerConnection(s0.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.statsFilter=pv(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,jt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(){var n=this;return x(function*(){try{n.peerConnection.addTransceiver("video",{direction:"recvonly"}),n.peerConnection.addTransceiver("audio",{direction:"recvonly"});const r=yield n.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Bh(r.sdp),c=yield FO({filterRTX:!B("USE_PUB_RTX")&&!B("USE_SUB_RTX"),filterVideoFec:B("FILTER_VIDEO_FEC"),filterAudioFec:B("FILTER_AUDIO_FEC")},{useXR:n.useXR});return n.localCapabilities=aT(c),n.initialOffer=r,Kd(Kd({},s),{},{rtpCapabilities:c,offerSDP:r.sdp})}catch(r){throw new Q(M.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}})()}connect(n,r,s,c,d,h){var p=this;return x(function*(){try{if(!p.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");p.remoteSDP=new class{get localCapabilities(){return Ln(this._localCapabilities)}get rtpCapabilities(){return Ln(this._rtpCapabilities)}get candidates(){return Ln(this._candidates)}get iceParameters(){return Ln(this._iceParameters)}get dtlsParameters(){return Ln(this._dtlsParameters)}constructor(N){S(this,"sessionDesc",void 0),S(this,"_localCapabilities",void 0),S(this,"_rtpCapabilities",void 0),S(this,"_candidates",void 0),S(this,"_iceParameters",void 0),S(this,"_dtlsParameters",void 0),S(this,"setup",void 0),S(this,"currentMidIndex",void 0),S(this,"cname",void 0),S(this,"firefoxSsrcMidMap",new Map),N=Ln(N);const{remoteIceParameters:P,remoteDtlsParameters:D,candidates:k,remoteRTPCapabilities:V,remoteSetup:U,localCapabilities:Y,cname:oe}=N,K=hn.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n");this._rtpCapabilities=V,this._candidates=k,this._iceParameters=P,this._dtlsParameters=D,this._localCapabilities=Y,this.setup=U,this.cname=oe;const X=this.rtpCapabilities.send;for(const $ of K.mediaDescriptions){if($.attributes.iceUfrag=P.iceUfrag,$.attributes.icePwd=P.icePwd,$.attributes.fingerprints=D.fingerprints,$.attributes.candidates=k,$.attributes.setup=U,"video"===$.media.mediaType&&($.media.fmts=X.videoCodecs.map(J=>J.payloadType.toString(10)),$.attributes.payloads=X.videoCodecs,$.attributes.extmaps=X.videoExtensions,B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:J,ssrcGroups:ve}=Cs([{ssrcId:4e4,rtx:B("USE_SUB_RTX")?40001:void 0}],this.cname);$.attributes.ssrcs=J,$.attributes.ssrcGroups=ve}if("audio"===$.media.mediaType&&($.media.fmts=X.audioCodecs.map(J=>J.payloadType.toString(10)),$.attributes.payloads=X.audioCodecs,$.attributes.extmaps=X.audioExtensions,al($),B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:J,ssrcGroups:ve}=Cs([{ssrcId:2e4}],this.cname);$.attributes.ssrcs=J,$.attributes.ssrcGroups=ve}}this.sessionDesc=K,this.currentMidIndex=K.mediaDescriptions.length-1}preloadRemoteMedia(){const N=B("PRELOAD_MEDIA_COUNT"),P=this.candidates,D=this.dtlsParameters,k=this.iceParameters,V=this.rtpCapabilities.send;for(let U=1;U<N;U++){const Y=2*U+2e4,oe=2*U+4e4,{ssrcs:K,ssrcGroups:X}=Cs([{ssrcId:Y}],this.cname),{ssrcs:$,ssrcGroups:J}=Cs([{ssrcId:oe,rtx:B("USE_SUB_RTX")?oe+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:V.videoCodecs.map(ve=>ve.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:k.iceUfrag,icePwd:k.icePwd,unrecognized:[],candidates:P,extmaps:V.videoExtensions,fingerprints:D.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:$,ssrcGroups:J,rtcpFeedbackWildcards:[],payloads:V.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*U)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:V.audioCodecs.map(ve=>ve.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:k.iceUfrag,icePwd:k.icePwd,unrecognized:[],candidates:P,extmaps:V.audioExtensions,fingerprints:D.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:K,ssrcGroups:X,rtcpFeedbackWildcards:[],payloads:V.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*U+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return hn.print(this.sessionDesc)}send(N,P,D,k){const{ssrcs:V,ssrcGroups:U}=Cs(P,this.cname,B("SYNC_GROUP")?D:void 0),Y=this.findPreloadMediaDesc(V);if(Y){if(jt()&&this.firefoxSsrcMidMap.set(V[0].ssrcId,Y.attributes.mid),k&&(k.twcc||k.remb)){const oe=this.sessionDesc.mediaDescriptions.indexOf(Y);return this.sessionDesc.mediaDescriptions[oe]=this.mungSendMediaDesc(Y,k),{mid:Y.attributes.mid,needExchangeSDP:!0}}return{mid:Y.attributes.mid,needExchangeSDP:!1}}{const oe=this.findAvailableMediaIndex(N,V);let K;return-1===oe||1===oe&&(qi()||fA())||0===oe&&B("USE_SUB_RTX")||mA()?(K=this.createOrRecycleSendMedia(N,V,U,"sendonly",k),this.updateBundleMids()):(K=Ln(this.sessionDesc.mediaDescriptions[oe]),K.attributes.direction="sendonly",K.attributes.ssrcs=V,K.attributes.ssrcGroups=U,this.sessionDesc.mediaDescriptions[oe]=this.mungSendMediaDesc(K,k)),jt()&&this.firefoxSsrcMidMap.set(V[0].ssrcId,K.attributes.mid),{mid:K.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:N,needExchangeSDP:P}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:N.attributes.mid,needExchangeSDP:P}}batchSend(N){const P=N.map(V=>{let{kind:U,ssrcMsg:Y,mslabel:oe}=V;return this.send(U,Y,oe)}),D=[];let k=!1;return P.forEach(V=>{let{mid:U,needExchangeSDP:Y}=V;Y&&(k=!0),D.push(U)}),{mids:D,needExchangeSDP:k}}stopSending(N){const P=this.sessionDesc.mediaDescriptions.filter(D=>D.attributes.mid&&-1!==N.indexOf(D.attributes.mid));if(P.length!==N.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");P.forEach(D=>{"0"===D.attributes.mid||jt()||mA()?D.attributes.ssrcs=[]:(D.attributes.ssrcs=[],D.attributes.direction="inactive",D.media.port="0")}),this.updateBundleMids()}mute(N){const P=this.sessionDesc.mediaDescriptions.find(D=>D.attributes.mid===N);if(!P)throw new Error("mediaDescription not found with ".concat(N," in remote SDP when calling RemoteSDP.mute."));P.attributes.direction="inactive"}unmute(N){const P=this.sessionDesc.mediaDescriptions.find(D=>D.attributes.mid===N);if(!P)throw new Error("mediaDescription not found with ".concat(N," in remote SDP when calling RemoteSDP.unmute."));P.attributes.direction="sendonly"}muteRemote(N){const P=this.sessionDesc.mediaDescriptions.filter(D=>Re(N).call(N,D.attributes.mid||""));if(P.length!==N.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");P.forEach(D=>{D.attributes.direction="inactive"})}unmuteRemote(N){const P=this.sessionDesc.mediaDescriptions.filter(D=>Re(N).call(N,D.attributes.mid||""));if(P.length!==N.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");P.forEach(D=>{D.attributes.direction="recvonly"})}receive(N,P,D,k){N.forEach((V,U)=>{this.createOrRecycleRecvMedia(V,[],"recvonly",P,D,k[U])}),this.updateBundleMids()}stopReceiving(N){const P=this.sessionDesc.mediaDescriptions.filter(D=>-1!==N.indexOf(D.attributes.mid));if(P.length!==N.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");P.forEach(D=>{D.media.port="0",D.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(N){const P=this._candidates.filter(D=>"udp"===D.transport);if(N===ki.TCP){if(0===P.length)return;if(B("TCP_CANDIDATE_ONLY")){const D=this._candidates.filter(k=>"tcp"===k.transport);P.forEach(k=>{-1===D.findIndex(V=>V.connectionAddress===k.connectionAddress)&&D.push(ll(ll({},k),{},{foundation:"tcpcandidate",priority:Number(k.priority)-1+"",transport:"tcp",port:Number(k.port)+90+""}))}),this._candidates=D}else{const D=[];P.forEach(k=>{D.push(ll(ll({},k),{},{foundation:"tcpcandidate",priority:Number(k.priority)-1+"",transport:"tcp",port:Number(k.port)+90+""}))}),this._candidates=[...P,...D]}}else if(N===ki.RELAY){if(0!==P.length)return;{const D=this._candidates.filter(k=>"tcp"===k.transport);D.forEach(k=>{P.push(ll(ll({},k),{},{foundation:"udpcandidate",priority:Number(k.priority)+1+"",transport:"udp",port:Number(k.port)-90+""}))}),this._candidates=[...P,...D]}}else 0===P.length?(this._candidates.filter(D=>"tcp"===D.transport).forEach(D=>{P.push(ll(ll({},D),{},{foundation:"udpcandidate",priority:Number(D.priority)+1+"",transport:"udp",port:Number(D.port)-90+""}))}),this._candidates=P):this._candidates=this._candidates.filter(D=>"tcp"!==D.transport);for(const D of this.sessionDesc.mediaDescriptions)D.attributes.candidates=this.candidates}restartICE(N){N=Ln(N),this._iceParameters=N,this.sessionDesc.mediaDescriptions.forEach(P=>{P.attributes.iceUfrag=N.iceUfrag,P.attributes.icePwd=N.icePwd})}predictReceivingMids(N){const P=[];for(let D=0;D<N;D++)P.push((this.currentMidIndex+D+1).toString(10));return P}findAvailableMediaIndex(N,P){return this.sessionDesc.mediaDescriptions.findIndex(D=>{const k=D.media.mediaType===N&&"0"!==D.media.port&&("sendonly"===D.attributes.direction||"sendrecv"===D.attributes.direction)&&0===D.attributes.ssrcs.length;if(jt()){if(k){const V=this.firefoxSsrcMidMap.get(P[0].ssrcId);return!(V||"0"!==D.attributes.mid&&"1"!==D.attributes.mid)||!(!V||V!==D.attributes.mid)}return!1}return k})}createOrRecycleDataChannel(){for(const D of this.sessionDesc.mediaDescriptions)if("application"===D.media.mediaType)return{mediaDesc:D,needExchangeSDP:!1};this.currentMidIndex+=1;const N="".concat(this.currentMidIndex),P={media:{mediaType:"application",port:"9",protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(N),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(P),{mediaDesc:P,needExchangeSDP:!0}}createOrRecycleRecvMedia(N,P,D,k,V,U){const Y=N._mediaStreamTrack.kind,oe=this.rtpCapabilities.recv,K=this.localCapabilities.send;let X=[];if(Y===ge.VIDEO){var $,J;if(B("H264_PROFILE_LEVEL_ID")&&"h264"===k&&(X=oe.videoCodecs.filter(yt=>{var lt,bt,ne;return Re(lt=(null===(bt=yt.rtpMap)||void 0===bt?void 0:bt.encodingName.toLowerCase())||"").call(lt,k)&&(null==yt||null===(ne=yt.fmtp)||void 0===ne?void 0:ne.parameters["profile-level-id"])===B("H264_PROFILE_LEVEL_ID")})),!X||0===(null===($=X)||void 0===$?void 0:$.length)){const yt=K.videoCodecs.filter(lt=>{var bt,ne;return Re(bt=(null===(ne=lt.rtpMap)||void 0===ne?void 0:ne.encodingName.toLowerCase())||"").call(bt,k)});0!==yt.length&&(X=oe.videoCodecs.filter(lt=>yt.some(bt=>bt.payloadType===lt.payloadType)))}if(B("USE_PUB_RTX")){const yt=X.map(bt=>bt.payloadType.toString()),lt=oe.videoCodecs.filter(bt=>{var ne,ae;return"rtx"===(null===(ne=bt.rtpMap)||void 0===ne?void 0:ne.encodingName)&&Re(yt).call(yt,(null===(ae=bt.fmtp)||void 0===ae?void 0:ae.parameters.apt)||"")});X=[...X,...lt]}0===X.length&&(w.warning("codec ".concat(k," not included in rtpCapabilities, fallback to default payloads: ").concat(null===(J=oe.videoCodecs[0].rtpMap)||void 0===J?void 0:J.encodingName)),X=oe.videoCodecs)}else X=oe.audioCodecs.filter(yt=>{var lt,bt;return Re(lt=(null===(bt=yt.rtpMap)||void 0===bt?void 0:bt.encodingName.toLowerCase())||"").call(lt,V)}),0===X.length&&(w.warning("codec ".concat(V," not included in rtpCapabilities, fallback to opus")),X=oe.audioCodecs.filter(yt=>{var lt,bt;return Re(lt=(null===(bt=yt.rtpMap)||void 0===bt?void 0:bt.encodingName.toLowerCase())||"").call(lt,"opus")}));const ve=Y===ge.VIDEO?oe.videoExtensions:oe.audioExtensions;this.currentMidIndex+=1;const ye="".concat(this.currentMidIndex);let Ye={media:{mediaType:Y,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:X.map(yt=>yt.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:ve,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:P,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:X,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:D,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(ye)}};Ye=this.mungRecvMediaDsec(Ye,N,U);const ut=this.findFirstClosedMedia(Y);if(ut){const yt=this.sessionDesc.mediaDescriptions.indexOf(ut);this.sessionDesc.mediaDescriptions[yt]=Ye}else this.sessionDesc.mediaDescriptions.push(Ye);return Ye}createOrRecycleSendMedia(N,P,D,k,V){const U=this.rtpCapabilities.send,Y=N===ge.VIDEO?U.videoCodecs:U.audioCodecs,oe=N===ge.VIDEO?U.videoExtensions:U.audioExtensions;this.currentMidIndex+=1;const K="".concat(this.currentMidIndex);let X={media:{mediaType:N,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:Y.map(J=>J.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:oe,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:P,ssrcGroups:D,rtcpFeedbackWildcards:[],payloads:Y,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:k,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(K)}};X=this.mungSendMediaDesc(X,V);const $=this.findFirstClosedMedia(N);if($){const J=this.sessionDesc.mediaDescriptions.indexOf($);this.sessionDesc.mediaDescriptions[J]=X}else this.sessionDesc.mediaDescriptions.push(X);return X}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(N=>"0"!==N.media.port).map(N=>N.attributes.mid)}mungRecvMediaDsec(N,P,D){const k=Ln(N);return jh(k),Ts(k,P),Hh(k,P),Gh(k),Wd(k,D,this.localCapabilities.send),k}mungSendMediaDesc(N,P){const D=Ln(N);return Wd(D,P,this.localCapabilities.recv),al(D),D}updateRecvMedia(N,P){const D=this.sessionDesc.mediaDescriptions.findIndex(k=>k.attributes.mid===N);if(-1!==D){const k=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[D],P);this.sessionDesc.mediaDescriptions[D]=k}}bumpMid(N){this.currentMidIndex+=N}findFirstClosedMedia(N){return this.sessionDesc.mediaDescriptions.find(P=>jt()?"0"===P.media.port&&P.media.mediaType===N:"0"===P.media.port)}findPreloadMediaDesc(N){return this.sessionDesc.mediaDescriptions.find(P=>{var D;return(null===(D=P.attributes)||void 0===D||null===(D=D.ssrcs[0])||void 0===D?void 0:D.ssrcId)===N[0].ssrcId})}getSSRC(N){var P;return null===(P=this.sessionDesc.mediaDescriptions.find(D=>D.attributes.mid===N))||void 0===P?void 0:P.attributes.ssrcs}}({remoteIceParameters:n,remoteDtlsParameters:r,candidates:s,remoteRTPCapabilities:c,remoteSetup:d,localCapabilities:p.localCapabilities,cname:h});const m=p.remoteSDP.toString(),_=hn.parse(p.initialOffer.sdp),g=_.mediaDescriptions.find(N=>"audio"===N.media.mediaType);g&&al(g),p.useXR&&gm(_);const v=hn.print(_),b=p.logSDPExchange(v||"","offer","local","connect");p.store.descriptionStart(),yield p.peerConnection.setLocalDescription({type:"offer",sdp:v}),b?.(m),yield p.peerConnection.setRemoteDescription({type:"answer",sdp:m});const C=p.peerConnection.getTransceivers()[0];if(null!=C&&C.receiver&&p.tryBindTransportEvents(C.receiver),B("PRELOAD_MEDIA_COUNT")>0){p.remoteSDP.preloadRemoteMedia();const N=p.remoteSDP.toString();yield p.peerConnection.setRemoteDescription({type:"offer",sdp:N});const P=yield p.peerConnection.createAnswer();yield p.peerConnection.setLocalDescription(P)}}catch(m){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(m.toString()))}})()}send(n,r,s){var c=this;return Yr(function*(){const d=yield dt(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[];n.forEach(P=>{const D=c.peerConnection.addTransceiver(P._mediaStreamTrack,{direction:"sendonly"});h.push(D),P._updateRtpTransceiver(D)}),jt()&&!0===B("SIMULCAST")&&(yield dt(c.applySimulcastForFirefox(h,n)));const p=yield dt(c.peerConnection.createOffer()),m=c.remoteSDP.predictReceivingMids(n.length),_=c.mungSendOfferSDP(p.sdp,n,m),g=hn.parse(_),v=m.map(P=>{const D=g.mediaDescriptions.find(k=>k.attributes.mid===P);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return yL(D,B("USE_PUB_RTX"))});let b;try{b=yield v}catch(P){b=[],c.remoteSDP.receive(n,r,s,b);const D=c.remoteSDP.toString();throw yield dt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield dt(c.peerConnection.setRemoteDescription({type:"answer",sdp:D})),yield dt(c.stopSending(m,!0)),P}c.remoteSDP.receive(n,r,s,b);const C=c.remoteSDP.toString(),N=c.logSDPExchange(_,"offer","local","send");return yield dt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield dt(c.applySimulcastEncodings(h,n)),yield dt(c.applySendEncodings(h,n)),N?.(C),yield dt(c.peerConnection.setRemoteDescription({type:"answer",sdp:C})),h.map((P,D)=>({localSSRC:v[D],id:m[D],transceiver:P}))}catch(h){throw h instanceof Q?h:new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}createDataChannels(n,r){var s=this;return x(function*(){try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let c=s.dataStreamChannelMap.get(n);c&&"open"===c.readyState?w.debug("[P2PConnection] Channels are already available and can be reused directly."):(c=s.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:B("DATASTREAM_MAX_RETRANSMITS")}),c.binaryType="arraybuffer",s.dataStreamChannelMap.set(n,c)),r.forEach(h=>{h._updateOriginDataChannel(c)});const{needExchangeSDP:d}=s.remoteSDP.sendDataChannel();if(d){const h=s.remoteSDP.toString();yield s.peerConnection.setRemoteDescription({type:"offer",sdp:h});const p=yield s.peerConnection.createAnswer();yield s.peerConnection.setLocalDescription(p),w.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else w.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(c){throw c instanceof Q?c:new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(c.toString()))}})()}stopDataChannels(n){var r=this;return x(function*(){try{return r.dataStreamChannelMap.get(n)?.close(),void r.dataStreamChannelMap.delete(n)}catch(s){throw s instanceof Q?s:new Q(M.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}})()}stopSending(n,r){var s=this;return x(function*(){const c=r?void 0:yield s.mutex.lock("From P2PConnection.stopSending");try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const d=s.peerConnection.getTransceivers().filter(_=>-1!==n.indexOf(_.mid));if(d.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");d.map(_=>{var g;_.direction="inactive",null===(g=_.stop)||void 0===g||g.call(_)});const h=yield s.peerConnection.createOffer(),p=s.logSDPExchange(h.sdp||"","offer","local","stopSending");yield s.peerConnection.setLocalDescription(h),s.remoteSDP.stopReceiving(n);const m=s.remoteSDP.toString();p?.(m),yield s.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(d){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(d.toString()))}finally{c&&c()}})()}receive(n,r,s,c){var d=this;return x(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{mid:h,needExchangeSDP:p}=d.remoteSDP.send(n,r,s,c);if(p){const _=d.remoteSDP.toString(),g=d.logSDPExchange(_,"offer","remote","receive");yield d.peerConnection.setRemoteDescription({type:"offer",sdp:_});const v=yield d.peerConnection.createAnswer(),b=d.mungReceiveAnswerSDP(v.sdp,h,n);g?.(b||""),yield d.peerConnection.setLocalDescription({type:"answer",sdp:b}),w.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP."))}else w.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(n," no need to exchange SDP."));const m=d.peerConnection.getTransceivers().find(_=>_.mid===h);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:h,transceiver:m}}catch(h){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}batchReceive(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:c}=r.remoteSDP.batchSend(n);if(c){const d=r.remoteSDP.toString(),h=r.logSDPExchange(d,"offer","remote","receive");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:d});const p=yield r.peerConnection.createAnswer();h?.(p.sdp||""),yield r.peerConnection.setLocalDescription(p),w.debug("[".concat(r.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else w.debug("[".concat(r.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return s.map(d=>{const h=r.peerConnection.getTransceivers().find(p=>p.mid===d);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:d,transceiver:h}})}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}})()}stopReceiving(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.remoteSDP.stopSending(n);const s=r.remoteSDP.toString(),c=r.logSDPExchange(s,"offer","remote","stopReceiving");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield r.peerConnection.createAnswer();c?.(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}})()}muteRemote(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(n," before remote SDP created."));r.remoteSDP.mute(n);const s=r.remoteSDP.toString(),c=r.logSDPExchange(s,"offer","remote","muteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield r.peerConnection.createAnswer();c?.(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}})()}unmuteRemote(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(n," before remote SDP created."));r.remoteSDP.unmute(n);const s=r.remoteSDP.toString(),c=r.logSDPExchange(s,"offer","remote","unmuteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield r.peerConnection.createAnswer();c?.(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}})()}muteLocal(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=r.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==n.indexOf(p.mid));if(s.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(p=>{p.direction="inactive"});const c=yield r.peerConnection.createOffer(),d=r.logSDPExchange(c.sdp||"","offer","local","muteLocal");yield r.peerConnection.setLocalDescription(c),r.remoteSDP.muteRemote(n);const h=r.remoteSDP.toString();d?.(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}})()}unmuteLocal(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=r.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==n.indexOf(p.mid));if(s.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(function(){var p=x(function*(m,_){m.direction="sendonly"});return function(m,_){return p.apply(this,arguments)}}());const c=yield r.peerConnection.createOffer(),d=r.logSDPExchange(c.sdp||"","offer","local","unmuteLocal");yield r.peerConnection.setLocalDescription(c),r.remoteSDP.unmuteRemote(n);const h=r.remoteSDP.toString();d?.(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}})()}restartICE(n){var r=this;return Yr(function*(){const s=yield dt(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Lt().supportPCSetConfiguration){const _=r.peerConnection.getConfiguration(),g=n===ki.RELAY?"relay":"all";_.iceTransportPolicy!==g&&(w.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_.iceTransportPolicy,"] to [").concat(g,"]")),_.iceTransportPolicy=g,r.peerConnection.setConfiguration(_))}else if(n===ki.RELAY)return;r.remoteSDP.updateCandidates(n);const c=yield dt(r.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=Bh(c.sdp),{remoteIceParameters:h}=yield d.iceParameters;r.remoteSDP.restartICE(h);const p=r.remoteSDP.toString(),m=r.logSDPExchange(c.sdp||"","offer","local","restartICE");r.store.descriptionStart(),yield dt(r.peerConnection.setLocalDescription(c)),m?.(p),yield dt(r.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(c){w.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}})()}close(){var n;this.peerConnection.close(),null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}updateEncoderConfig(n,r){var s=this;return x(function*(){try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const c=yield s.peerConnection.createOffer(),d=s.mungSendOfferSDP(c.sdp,[r],[n]);s.remoteSDP.updateRecvMedia(n,r);const h=s.remoteSDP.toString(),p=s.logSDPExchange(d,"offer","local","updateEncoderConfig");yield s.peerConnection.setLocalDescription({type:"offer",sdp:d}),p?.(h),yield s.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(c){throw new Q(M.EXCHANGE_SDP_FAILED,c.toString())}})()}updateSendParameters(n,r){var s=this;return x(function*(){const c=s.peerConnection.getTransceivers().filter(d=>d.mid===n);1===c.length&&(s.isVP8Simulcast(r)?jt()||(yield s.applySimulcastEncodings(c,[r])):yield s.applySendEncodings(c,[r]))})()}setStatsRemoteVideoIsReady(n,r){this.statsFilter.setVideoIsReady2(n,r)}replaceTrack(n,r){var s=this;return x(function*(){const c=s.peerConnection.getTransceivers().find(d=>d.mid===r);c&&(yield c.sender.replaceTrack(n._mediaStreamTrack))})()}getSelectedCandidatePair(){var n=this;return x(function*(){const r=n.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:c,remote:d}=s.getSelectedCandidatePair();return{local:Kd(Kd({},Is),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port}),remote:Kd(Kd({},Is),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})}}return n.statsFilter.getSelectedCandidatePair()})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;null===(n=this.onICEConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},B("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const r={iceServers:[]};return n.iceServers?r.iceServers=n.iceServers:n.turnServer&&"off"!==n.turnServer.mode&&(ih(n.turnServer.servers)?r.iceServers=n.turnServer.servers:(r.iceServers&&r.iceServers.push(...s0.turnServerConfigToIceServers(n.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&n.turnServer.serversFromGateway&&r.iceServers.push(...s0.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),B("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(r.iceTransportPolicy="relay")}))),B("ENABLE_ENCODED_TRANSFORM")&&Lt().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(n){const r=[];return n.forEach(s=>{s.security?s.tcpport&&r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(KE(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!B("FORCE_TURN_TCP")&&r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),r}tryBindTransportEvents(n){const r=n.transport;if(r){this.transportEventReceiver=n,r.onstatechange=()=>{var c;null!=r&&r.state&&(null===(c=this.onDTLSTransportStateChange)||void 0===c||c.call(this,r.state))},r.onerror=c=>{var d;null===(d=this.onDTLSTransportError)||void 0===d||d.call(this,"error"in c?c.error:c)};const s=r.iceTransport;s&&(s.onstatechange=()=>{const c=r?.iceTransport.state;var d;c&&(null===(d=this.onICETransportStateChange)||void 0===d||d.call(this,c))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:c,remote:d}=s.getSelectedCandidatePair();w.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(n,r){var s=this;return x(function*(){var c;if(r||(r=s.peerConnection.getSenders().find(v=>v.track===n._mediaStreamTrack)),!r)return w.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(s.isVP8Simulcast(n))return w.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Lt().supportSetRtpSenderParameters)return w.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(n._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(n._encoderConfig){var p;const{bitrateMax:v,frameRate:b,scaleResolutionDownBy:C}=n._encoderConfig;v&&(h.maxBitrate=1e3*v),Re(p=n._hints).call(p,Vt.LOW_STREAM)&&(b&&(h.maxFramerate=Bo(b)),C&&C>=1&&(h.scaleResolutionDownBy=C))}if(B("DSCP_TYPE")&&cs()){var m;const v=B("DSCP_TYPE");Re(m=["very-low","low","medium","high"]).call(m,v)&&(h.networkPriority=v)}const _=r.getParameters(),g=null===(c=_.encodings)||void 0===c?void 0:c[0];jt()&&!g&&(d.encodings=[h]),g&&Object.assign(g,h),Object.assign(_,d),w.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),yield r.setParameters(_)})()}applySendEncodings(n,r){var s=this;return x(function*(){try{if(!Lt().supportSetRtpSenderParameters||n.length!==r.length)return;for(let c=0;c<n.length;c++){const d=n[c],h=r[c];h instanceof We&&!s.isVP8Simulcast(h)&&(yield s.updateRtpSenderEncodings(h,d.sender))}}catch{w.debug("[".concat(s.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(n,r,s){const c=hn.parse(n);return r.forEach((d,h)=>{const p=s[h],m=c.mediaDescriptions.find(_=>_.attributes.mid===p);m&&(Ts(m,d),Wh(m,d,this.store.codec))}),hn.print(c)}mungReceiveAnswerSDP(n,r,s){const c=hn.parse(n),d=c.mediaDescriptions.find(h=>h.attributes.mid===r);return d&&(s===ge.AUDIO&&"audio"===d.media.mediaType&&al(d),this.useXR&&gm(c)),hn.print(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,r,s)=>{var c;null===(c=this.onFirstVideoDecoded)||void 0===c||c.call(this,n,r,s)},this.statsFilter.onSelectedLocalCandidateChanged=(n,r)=>{var s;null===(s=this.onSelectedLocalCandidateChanged)||void 0===s||s.call(this,n,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,r)=>{var s;null===(s=this.onSelectedRemoteCandidateChanged)||void 0===s||s.call(this,n,r)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var r;null===(r=this.onFirstVideoDecodedTimeout)||void 0===r||r.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(n,r){var s=this;return x(function*(){if(n.length===r.length)for(let _=0;_<n.length;_++){var c,d,h,p,m;const g=n[_],v=r[_];if(v instanceof We&&!Re(c=v._hints).call(c,Vt.LOW_STREAM)&&null!==(d=v._encoderConfig)&&void 0!==d&&d.bitrateMax&&(null===(h=v._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(p=v._scalabilityMode)&&void 0!==p&&p.numSpatialLayers&&(null===(m=v._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===s.store.codec){const b={},C={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{rid:"m",active:!0,maxBitrate:C.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:C.high}];const N=g.sender.getParameters();yield g.sender.setParameters(Object.assign(N,b))}}})()}applySimulcastEncodings(n,r){var s=this;return x(function*(){if(!jt()&&n.length===r.length)for(let c=0;c<n.length;c++){const d=r[c];if(d instanceof We&&s.isVP8Simulcast(d)){const h=n[c],p={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=h.sender.getParameters();yield h.sender.setParameters(Object.assign(_,p))}}})()}isVP8Simulcast(n){var r,s,c,d,h;return!!(n instanceof We&&B("SIMULCAST")&&"vp8"===this.store.codec&&!Re(r=n._hints).call(r,Vt.LOW_STREAM)&&null!==(s=n._encoderConfig)&&void 0!==s&&s.bitrateMax&&(null===(c=n._encoderConfig)||void 0===c?void 0:c.bitrateMax)>200&&null!==(d=n._scalabilityMode)&&void 0!==d&&d.numSpatialLayers&&(null===(h=n._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,r,s,c){if(B("SDP_LOGGING"))return w.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(r," SDP during P2PConnection.").concat(c,"\n"),n),"offer"===r?d=>{this.logSDPExchange(d,"answer","local"===s?"remote":"local",c)}:void 0}getRemoteSSRC(n){var r=this;return x(function*(){if(r.remoteSDP)return r.remoteSDP.getSSRC(n)?.[0].ssrcId})()}setConfiguration(n){if(Lt().supportPCSetConfiguration){const r=s0.resolvePCConfiguration(n);this.peerConnection.setConfiguration(r)}}};function vo(o,n,r){const s=o[n];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return r.value=x(function*(){const c=this.mutex,d=yield c.lock("From P2PConnection.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield s.apply(this,p)}finally{d()}}),r}function fv(o,n){let r=document.createElement("video"),s=document.createElement("canvas");r.setAttribute("style","display:none"),s.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),s.width=Bo(n.width),s.height=Bo(n.height);const c=Bo(n.framerate||15);document.body.append(r),document.body.append(s);let d=o._mediaStreamTrack;r.srcObject=new MediaStream([d]),r.play();const h=s.getContext("2d");if(!h)throw new G(M.UNEXPECTED_ERROR,"can not get canvas context");const p=Lt(),m=s.captureStream(p.supportRequestFrame?0:c).getVideoTracks()[0];m.canvas||(m.canvas=s),s.startCapture=()=>{if(!r)return s.stopCapture&&s.stopCapture();if(r.paused&&r.play(),r.videoHeight>2&&r.videoWidth>2){const b=s.width*(r.videoHeight/r.videoWidth);Math.abs(b-s.height)>=2&&(w.debug("adjust low stream resolution","".concat(s.width,"x").concat(s.height," -> ").concat(s.width,"x").concat(b)),s.height=b)}h.drawImage(r,0,0,s.width,s.height),m.requestFrame&&m.requestFrame(),d!==o._mediaStreamTrack&&(d=o._mediaStreamTrack,r.srcObject=new MediaStream([d]))},s.stopCapture=gC(()=>s.startCapture&&s.startCapture(),c);const _=m.stop;return m.stop=()=>{_.call(m),r&&(r.remove(),r.srcObject=null,r=null),s&&(s.width=0,s.remove(),s.stopCapture&&s.stopCapture(),s.startCapture=void 0,s.stopCapture=void 0,s=null),w.debug("clean low stream renderer")},m}function WO(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function wL(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?WO(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):WO(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}ee([vo,O("design:type",Function),O("design:paramtypes",[Object,Object,Array,Object,String,String]),O("design:returntype",z)],Qn.prototype,"connect",null),ee([vo,O("design:type",Function),O("design:paramtypes",[Object,Array]),O("design:returntype",z)],Qn.prototype,"createDataChannels",null),ee([vo,O("design:type",Function),O("design:paramtypes",[String,Array,String,Object]),O("design:returntype",z)],Qn.prototype,"receive",null),ee([vo,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],Qn.prototype,"batchReceive",null),ee([vo,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],Qn.prototype,"stopReceiving",null),ee([vo,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",z)],Qn.prototype,"muteRemote",null),ee([vo,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",z)],Qn.prototype,"unmuteRemote",null),ee([vo,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],Qn.prototype,"muteLocal",null),ee([vo,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],Qn.prototype,"unmuteLocal",null),ee([vo,O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],Qn.prototype,"close",null),ee([vo,O("design:type",Function),O("design:paramtypes",[String,Li]),O("design:returntype",z)],Qn.prototype,"updateEncoderConfig",null),ee([vo,O("design:type",Function),O("design:paramtypes",[String,Li]),O("design:returntype",z)],Qn.prototype,"updateSendParameters",null),ee([vo,O("design:type",Function),O("design:paramtypes",[Li,String]),O("design:returntype",z)],Qn.prototype,"replaceTrack",null),ee([vo,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",z)],Qn.prototype,"getRemoteSSRC",null);const fT="v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0\na=msid-semantic: WMS\na=ice-lite\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 127.0.0.1\na=mid:0\n";class zO{get localCapabilities(){return Ln(this._localCapabilities)}get rtpCapabilities(){return Ln(this._rtpCapabilities)}get candidates(){return Ln(this._candidates)}get iceParameters(){return Ln(this._iceParameters)}get dtlsParameters(){return Ln(this._dtlsParameters)}constructor(n){S(this,"sessionDesc",void 0),S(this,"_localCapabilities",void 0),S(this,"_rtpCapabilities",void 0),S(this,"_candidates",void 0),S(this,"_iceParameters",void 0),S(this,"_dtlsParameters",void 0),S(this,"setup",void 0),S(this,"currentMidIndex",void 0),S(this,"cname",void 0),S(this,"firefoxSsrcMidMap",new Map),n=Ln(n);const{remoteIceParameters:r,remoteDtlsParameters:s,candidates:c,remoteRTPCapabilities:d,remoteSetup:h,localCapabilities:p,cname:m}=n,_=hn.parse(fT);this._rtpCapabilities=d,this._candidates=c,this._iceParameters=r,this._dtlsParameters=s,this._localCapabilities=p,this.setup=h,this.cname=m;const g=this.rtpCapabilities.send;for(const v of _.mediaDescriptions){if(v.attributes.iceUfrag=r.iceUfrag,v.attributes.icePwd=r.icePwd,v.attributes.fingerprints=s.fingerprints,v.attributes.candidates=c,v.attributes.setup=h,"application"===v.media.mediaType&&(v.attributes.sctpPort="5000"),"video"===v.media.mediaType&&(v.media.fmts=g.videoCodecs.map(b=>b.payloadType.toString(10)),v.attributes.payloads=g.videoCodecs,v.attributes.extmaps=g.videoExtensions,B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:b,ssrcGroups:C}=Cs([{ssrcId:4e4,rtx:B("USE_SUB_RTX")?40001:void 0}],this.cname);v.attributes.ssrcs=b,v.attributes.ssrcGroups=C}if("audio"===v.media.mediaType&&(v.media.fmts=g.audioCodecs.map(b=>b.payloadType.toString(10)),v.attributes.payloads=g.audioCodecs,v.attributes.extmaps=g.audioExtensions,al(v),B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:b,ssrcGroups:C}=Cs([{ssrcId:2e4}],this.cname);v.attributes.ssrcs=b,v.attributes.ssrcGroups=C}}this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}updateRemoteRTPCapabilities(n){const r=hn.parse(fT);this._rtpCapabilities=n;const s=this.rtpCapabilities.send;for(const c of r.mediaDescriptions){if(c.attributes.iceUfrag=this._iceParameters.iceUfrag,c.attributes.icePwd=this._iceParameters.icePwd,c.attributes.fingerprints=this._dtlsParameters.fingerprints,c.attributes.candidates=this._candidates,c.attributes.setup=this.setup,"application"===c.media.mediaType&&(c.attributes.sctpPort="5000"),"video"===c.media.mediaType&&(c.media.fmts=s.videoCodecs.map(d=>d.payloadType.toString(10)),c.attributes.payloads=s.videoCodecs,c.attributes.extmaps=s.videoExtensions,B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:d,ssrcGroups:h}=Cs([{ssrcId:4e4,rtx:B("USE_SUB_RTX")?40001:void 0}],this.cname);c.attributes.ssrcs=d,c.attributes.ssrcGroups=h}if("audio"===c.media.mediaType&&(c.media.fmts=s.audioCodecs.map(d=>d.payloadType.toString(10)),c.attributes.payloads=s.audioCodecs,c.attributes.extmaps=s.audioExtensions,B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:d,ssrcGroups:h}=Cs([{ssrcId:2e4}],this.cname);c.attributes.ssrcs=d,c.attributes.ssrcGroups=h}}this.sessionDesc=r,this.currentMidIndex=r.mediaDescriptions.length-1}preloadRemoteMedia(n){const r=this.candidates,s=this.dtlsParameters,c=this.iceParameters,d=this.rtpCapabilities.send;for(let h=1;h<n;h++){const p=2*h+2e4,m=2*h+4e4,{ssrcs:_,ssrcGroups:g}=Cs([{ssrcId:p}],this.cname),{ssrcs:v,ssrcGroups:b}=Cs([{ssrcId:m,rtx:B("USE_SUB_RTX")?m+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.videoCodecs.map(C=>C.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:c.iceUfrag,icePwd:c.icePwd,unrecognized:[],candidates:r,extmaps:d.videoExtensions,fingerprints:s.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:v,ssrcGroups:b,rtcpFeedbackWildcards:[],payloads:d.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.audioCodecs.map(C=>C.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:c.iceUfrag,icePwd:c.icePwd,unrecognized:[],candidates:r,extmaps:d.audioExtensions,fingerprints:s.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:g,rtcpFeedbackWildcards:[],payloads:d.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return hn.print(this.sessionDesc)}send(n,r,s,c){const{ssrcs:d,ssrcGroups:h}=Cs(r,this.cname,B("SYNC_GROUP")?s:void 0),p=this.findPreloadMediaDesc(d);if(p){if(jt()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,p.attributes.mid),c&&(c.twcc||c.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(p);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(p,c),{mid:p.attributes.mid,needExchangeSDP:!0}}return{mid:p.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(n,d);let _;return-1===m||qi()||ir()||fA()||0===m&&B("USE_SUB_RTX")?(_=this.createOrRecycleSendMedia(n,d,h,"sendonly",c),this.updateBundleMids()):(_=Ln(this.sessionDesc.mediaDescriptions[m]),_.attributes.direction="sendonly",_.attributes.ssrcs=d,_.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(_,c)),jt()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,_.attributes.mid),{mid:_.attributes.mid,needExchangeSDP:!0}}}batchSend(n){const r=n.map(d=>{let{kind:h,ssrcMsg:p,mslabel:m}=d;return this.send(h,p,m)}),s=[];let c=!1;return r.forEach(d=>{let{mid:h,needExchangeSDP:p}=d;p&&(c=!0),s.push(h)}),{mids:s,needExchangeSDP:c}}stopSending(n){const r=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&-1!==n.indexOf(s.attributes.mid));if(r.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(s=>{"0"===s.attributes.mid||jt()||qi()||ir()?s.attributes.ssrcs=[]:(s.attributes.ssrcs=[],s.attributes.direction="inactive",s.media.port="0")}),this.updateBundleMids()}mute(n){const r=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===n);if(!r)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(n){const r=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===n);if(!r)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}muteRemote(n){const r=this.sessionDesc.mediaDescriptions.filter(s=>Re(n).call(n,s.attributes.mid||""));if(r.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(n){const r=this.sessionDesc.mediaDescriptions.filter(s=>Re(n).call(n,s.attributes.mid||""));if(r.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="recvonly"})}receive(n,r,s,c){n.forEach((d,h)=>{this.createOrRecycleRecvMedia(d,[],"recvonly",r,s,c[h])}),this.updateBundleMids()}stopReceiving(n){const r=this.sessionDesc.mediaDescriptions.filter(s=>-1!==n.indexOf(s.attributes.mid));if(r.length!==n.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(n){n===ki.TCP?this._candidates.forEach(r=>{-1===this._candidates.findIndex(s=>"tcp"===s.transport&&s.connectionAddress===r.connectionAddress&&s.port===r.port)&&this._candidates.push(wL(wL({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}):this._candidates=this._candidates.filter(r=>"tcp"!==r.transport);for(const r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}restartICE(n){n=Ln(n),this._iceParameters=n,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=n.iceUfrag,r.attributes.icePwd=n.icePwd})}predictReceivingMids(n){const r=[];for(let s=0;s<n;s++)r.push((this.currentMidIndex+s+1).toString(10));return r}findAvailableMediaIndex(n,r){return this.sessionDesc.mediaDescriptions.findIndex(s=>{const c=s.media.mediaType===n&&"0"!==s.media.port&&("sendonly"===s.attributes.direction||"sendrecv"===s.attributes.direction)&&0===s.attributes.ssrcs.length;if(jt()){if(c){const d=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(d||"0"!==s.attributes.mid&&"1"!==s.attributes.mid)||!(!d||d!==s.attributes.mid)}return!1}return c})}createOrRecycleRecvMedia(n,r,s,c,d,h){const p=n._mediaStreamTrack.kind,m=this.rtpCapabilities.recv,_=this.localCapabilities.send;let g=[];if(p===ge.VIDEO){var v,b;if(B("H264_PROFILE_LEVEL_ID")&&"h264"===c&&(g=m.videoCodecs.filter(k=>{var V,U,Y;return Re(V=(null===(U=k.rtpMap)||void 0===U?void 0:U.encodingName.toLowerCase())||"").call(V,c)&&(null==k||null===(Y=k.fmtp)||void 0===Y?void 0:Y.parameters["profile-level-id"])===B("H264_PROFILE_LEVEL_ID")})),!g||0===(null===(v=g)||void 0===v?void 0:v.length)){const k=_.videoCodecs.filter(V=>{var U,Y;return Re(U=(null===(Y=V.rtpMap)||void 0===Y?void 0:Y.encodingName.toLowerCase())||"").call(U,c)});0!==k.length&&(g=m.videoCodecs.filter(V=>k.some(U=>U.payloadType===V.payloadType)))}if(B("USE_PUB_RTX")){const k=g.map(U=>U.payloadType.toString()),V=m.videoCodecs.filter(U=>{var Y,oe;return"rtx"===(null===(Y=U.rtpMap)||void 0===Y?void 0:Y.encodingName)&&Re(k).call(k,(null===(oe=U.fmtp)||void 0===oe?void 0:oe.parameters.apt)||"")});g=[...g,...V]}0===g.length&&(w.warning("codec ".concat(c," not included in rtpCapabilities, fallback to default payloads: ").concat(null===(b=m.videoCodecs[0].rtpMap)||void 0===b?void 0:b.encodingName)),g=m.videoCodecs)}else g=m.audioCodecs.filter(k=>{var V,U;return Re(V=(null===(U=k.rtpMap)||void 0===U?void 0:U.encodingName.toLowerCase())||"").call(V,d)}),0===g.length&&(w.warning("codec ".concat(d," not included in rtpCapabilities, fallback to opus")),g=m.audioCodecs.filter(k=>{var V,U;return Re(V=(null===(U=k.rtpMap)||void 0===U?void 0:U.encodingName.toLowerCase())||"").call(V,"opus")}));const C=p===ge.VIDEO?m.videoExtensions:m.audioExtensions;this.currentMidIndex+=1;const N="".concat(this.currentMidIndex);let P={media:{mediaType:p,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:g.map(k=>k.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:C,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:g,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(N)}};P=this.mungRecvMediaDsec(P,n,h);const D=this.findFirstClosedMedia(p);if(D){const k=this.sessionDesc.mediaDescriptions.indexOf(D);this.sessionDesc.mediaDescriptions[k]=P}else this.sessionDesc.mediaDescriptions.push(P);return P}createOrRecycleSendMedia(n,r,s,c,d){const h=this.rtpCapabilities.send,p=n===ge.VIDEO?h.videoCodecs:h.audioCodecs,m=n===ge.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const _="".concat(this.currentMidIndex);let g={media:{mediaType:n,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:c,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};g=this.mungSendMediaDesc(g,d);const v=this.findFirstClosedMedia(n);if(v){const b=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[b]=g}else this.sessionDesc.mediaDescriptions.push(g);return g}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(n=>"0"!==n.media.port).map(n=>n.attributes.mid)}mungRecvMediaDsec(n,r,s){const c=Ln(n);return jh(c),Ts(c,r),Hh(c,r),Gh(c),Wd(c,s,this.localCapabilities.send),c}mungSendMediaDesc(n,r){const s=Ln(n);return Wd(s,r,this.localCapabilities.recv),al(s),s}updateRecvMedia(n,r){const s=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===n);if(-1!==s){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],r);this.sessionDesc.mediaDescriptions[s]=c}}bumpMid(n){this.currentMidIndex+=n}findFirstClosedMedia(n){return this.sessionDesc.mediaDescriptions.find(r=>jt()?"0"===r.media.port&&r.media.mediaType===n:"0"===r.media.port)}findPreloadMediaDesc(n){return this.sessionDesc.mediaDescriptions.find(r=>{var s;return(null===(s=r.attributes)||void 0===s||null===(s=s.ssrcs[0])||void 0===s?void 0:s.ssrcId)===n[0].ssrcId})}getSSRC(n){var r;return null===(r=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===n))||void 0===r?void 0:r.attributes.ssrcs}}function gv(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function Ev(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?gv(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):gv(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}class Ri extends gh{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(n,r,s){super(n,r),S(this,"store",void 0),S(this,"peerConnection",void 0),S(this,"remoteSDP",void 0),S(this,"initialOffer",void 0),S(this,"transportEventReceiver",void 0),S(this,"statsFilter",void 0),S(this,"useXR",B("USE_XR")),S(this,"localCapabilities",void 0),S(this,"localCandidateCount",0),S(this,"allCandidatesReceived",!1),S(this,"dataStreamChannelMap",new Map),S(this,"establishPromise",void 0),S(this,"mutex",new Wn("NVExtentionsConnection-mutex")),S(this,"rtcMedia",void 0),this.store=r,this.peerConnection=s,this.statsFilter=pv(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,jt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(n){var r=this;return x(function*(){try{const s=yield r.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Bh(s.sdp),d=yield FO({filterRTX:!B("USE_PUB_RTX")&&!B("USE_SUB_RTX"),filterVideoFec:B("FILTER_VIDEO_FEC"),filterAudioFec:B("FILTER_AUDIO_FEC")},{useXR:r.useXR});return r.localCapabilities=d,r.initialOffer=s,Ev(Ev({},c),{},{rtpCapabilities:d,offerSDP:s.sdp})}catch(s){throw new G(M.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}})()}connect(n,r,s,c,d,h){var p=this;return x(function*(){try{if(!p.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");p.remoteSDP=new zO({remoteIceParameters:n,remoteDtlsParameters:r,candidates:s,remoteRTPCapabilities:c,remoteSetup:d,localCapabilities:aT(p.localCapabilities),cname:h});const m=p.remoteSDP.toString(),_=hn.parse(p.initialOffer.sdp),g=_.mediaDescriptions.find(C=>"audio"===C.media.mediaType);g&&al(g),p.useXR&&gm(_);const v=hn.print(_),b=p.logSDPExchange(v||"","offer","local","connect");yield p.peerConnection.setLocalDescription({type:"offer",sdp:v}),b?.(m),yield p.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(m){throw new G(M.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(m.toString()))}})()}updateRemoteConnect(n){var r=this;return x(function*(){var s,c,d;null===(s=r.remoteSDP)||void 0===s||s.updateRemoteRTPCapabilities(n),null===(c=r.remoteSDP)||void 0===c||c.preloadRemoteMedia(2);const h=null===(d=r.remoteSDP)||void 0===d?void 0:d.toString();yield r.peerConnection.setRemoteDescription({type:"offer",sdp:h});const p=yield r.peerConnection.createAnswer();yield r.peerConnection.setLocalDescription(p),w.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")})()}send(n,r,s){var c=this;return Yr(function*(){const d=yield dt(c.mutex.lock("From NVExtentionsConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const h=[];n.forEach(P=>{const D=c.peerConnection.addTransceiver(P._mediaStreamTrack,{direction:"sendonly"});h.push(D)}),jt()&&!0===B("SIMULCAST")&&(yield dt(c.applySimulcastForFirefox(h,n)));const p=yield dt(c.peerConnection.createOffer()),m=c.remoteSDP.predictReceivingMids(n.length),_=c.mungSendOfferSDP(p.sdp,n,m),g=hn.parse(_),v=m.map(P=>{const D=g.mediaDescriptions.find(k=>k.attributes.mid===P);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return yL(D,B("USE_PUB_RTX"))});let b;try{b=yield v}catch(P){b=[],c.remoteSDP.receive(n,r,s,b);const D=c.remoteSDP.toString();throw yield dt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield dt(c.peerConnection.setRemoteDescription({type:"answer",sdp:D})),yield dt(c.stopSending(m,!0)),P}c.remoteSDP.receive(n,r,s,b);const C=c.remoteSDP.toString(),N=c.logSDPExchange(_,"offer","local","send");return yield dt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield dt(c.applySimulcastEncodings(h,n)),yield dt(c.applySendEncodings(h,n)),N?.(C),yield dt(c.peerConnection.setRemoteDescription({type:"answer",sdp:C})),h.map((P,D)=>({localSSRC:v[D],id:m[D],transceiver:P}))}catch(h){throw h instanceof G?h:new G(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(h.toString()))}finally{d()}})()}stopSending(n,r){var s=this;return x(function*(){const c=r?void 0:yield s.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!s.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const d=s.peerConnection.getTransceivers().filter(_=>-1!==n.indexOf(_.mid));if(d.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");d.map(_=>{var g;_.direction="inactive",null===(g=_.stop)||void 0===g||g.call(_)});const h=yield s.peerConnection.createOffer(),p=s.logSDPExchange(h.sdp||"","offer","local","stopSending");yield s.peerConnection.setLocalDescription(h),s.remoteSDP.stopReceiving(n);const m=s.remoteSDP.toString();p?.(m),yield s.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(d){throw new G(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(d.toString()))}finally{c&&c()}})()}createDataChannels(n,r){var s=this;return x(function*(){try{if(!s.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let c=s.dataStreamChannelMap.get(n);return c&&"open"===c.readyState?w.debug("[P2PConnection] Channels are already available and can be reused directly."):(c=s.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:B("DATASTREAM_MAX_RETRANSMITS")}),c.binaryType="arraybuffer",s.dataStreamChannelMap.set(n,c)),void r.forEach(d=>{d._updateOriginDataChannel(c)})}catch(c){throw c instanceof G?c:new G(M.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(c.toString()))}})()}stopDataChannels(n){var r=this;return x(function*(){try{return r.dataStreamChannelMap.get(n)?.close(),void r.dataStreamChannelMap.delete(n)}catch(s){throw s instanceof G?s:new G(M.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(s.toString()))}})()}receive(n,r,s,c){var d=this;return x(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(n," before remoteSDP created."));const{mid:h,needExchangeSDP:p}=d.remoteSDP.send(n,r,s,c);if(p){const _=d.remoteSDP.toString(),g=d.logSDPExchange(_,"offer","remote","receive");yield d.peerConnection.setRemoteDescription({type:"offer",sdp:_});const v=yield d.peerConnection.createAnswer(),b=d.mungReceiveAnswerSDP(v.sdp,h,n);g?.(b||""),yield d.peerConnection.setLocalDescription({type:"answer",sdp:b}),w.debug("[NVExtentionsConnection] receive ".concat(n," by exchanging SDP."))}else w.debug("[NVExtentionsConnection] receive ".concat(n," no need to exchange SDP."));const m=d.peerConnection.getTransceivers().find(_=>_.mid===h);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:h}}catch(h){throw new G(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(h.toString()))}})()}batchReceive(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:c}=r.remoteSDP.batchSend(n);if(c){const d=r.remoteSDP.toString(),h=r.logSDPExchange(d,"offer","remote","receive");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:d});const p=yield r.peerConnection.createAnswer();h?.(p.sdp||""),yield r.peerConnection.setLocalDescription(p),w.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else w.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return s.map(d=>{const h=r.peerConnection.getTransceivers().find(p=>p.mid===d);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:d}})}catch(s){throw new G(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(s.toString()))}})()}stopReceiving(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");r.remoteSDP.stopSending(n);const s=r.remoteSDP.toString(),c=r.logSDPExchange(s,"offer","remote","stopReceiving");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield r.peerConnection.createAnswer();c?.(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(s){throw new G(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(s.toString()))}})()}muteRemote(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(n," before remote SDP created."));r.remoteSDP.mute(n);const s=r.remoteSDP.toString(),c=r.logSDPExchange(s,"offer","remote","muteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield r.peerConnection.createAnswer();c?.(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(s){throw new G(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(s.toString()))}})()}unmuteRemote(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(n," before remote SDP created."));r.remoteSDP.unmute(n);const s=r.remoteSDP.toString(),c=r.logSDPExchange(s,"offer","remote","unmuteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield r.peerConnection.createAnswer();c?.(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(s){throw new G(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(s.toString()))}})()}muteLocal(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const s=r.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==n.indexOf(p.mid));if(s.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(p=>{p.direction="inactive"});const c=yield r.peerConnection.createOffer(),d=r.logSDPExchange(c.sdp||"","offer","local","muteLocal");yield r.peerConnection.setLocalDescription(c),r.remoteSDP.muteRemote(n);const h=r.remoteSDP.toString();d?.(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new G(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(s.toString()))}})()}unmuteLocal(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const s=r.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==n.indexOf(p.mid));if(s.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(function(){var p=x(function*(m,_){m.direction="sendonly"});return function(m,_){return p.apply(this,arguments)}}());const c=yield r.peerConnection.createOffer(),d=r.logSDPExchange(c.sdp||"","offer","local","unmuteLocal");yield r.peerConnection.setLocalDescription(c),r.remoteSDP.unmuteRemote(n);const h=r.remoteSDP.toString();d?.(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new G(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(s.toString()))}})()}restartICE(n){var r=this;return Yr(function*(){const s=yield dt(r.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Lt().supportPCSetConfiguration){const _=r.peerConnection.getConfiguration(),g=n===ki.RELAY?"relay":"all";_.iceTransportPolicy!==g&&(w.debug("restartICE change iceTransportPolicy from [".concat(_.iceTransportPolicy,"] to [").concat(g,"]")),_.iceTransportPolicy=g,r.peerConnection.setConfiguration(_))}else if(n===ki.RELAY)return;n!==ki.RELAY&&r.remoteSDP.updateCandidates(n);const c=yield dt(r.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=Bh(c.sdp),{remoteIceParameters:h}=yield d.iceParameters;r.remoteSDP.restartICE(h);const p=r.remoteSDP.toString(),m=r.logSDPExchange(c.sdp||"","offer","local","restartICE");yield dt(r.peerConnection.setLocalDescription(c)),m?.(p),yield dt(r.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(c){w.warning("restart ICE failed, abort operation",c)}finally{s()}})()}close(){var n;null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}updateEncoderConfig(n,r){var s=this;return x(function*(){try{if(!s.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const c=yield s.peerConnection.createOffer(),d=s.mungSendOfferSDP(c.sdp,[r],[n]);s.remoteSDP.updateRecvMedia(n,r);const h=s.remoteSDP.toString(),p=s.logSDPExchange(d,"offer","local","updateEncoderConfig");yield s.peerConnection.setLocalDescription({type:"offer",sdp:d}),p?.(h),yield s.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(c){throw new G(M.EXCHANGE_SDP_FAILED,c.toString())}})()}updateSendParameters(n,r){var s=this;return x(function*(){const c=s.peerConnection.getTransceivers().filter(d=>d.mid===n);1===c.length&&(s.isVP8Simulcast(r)?jt()||(yield s.applySimulcastEncodings(c,[r])):yield s.applySendEncodings(c,[r]))})()}setStatsRemoteVideoIsReady(n,r){this.statsFilter.setVideoIsReady2(n,r)}replaceTrack(n,r){var s=this;return x(function*(){const c=s.peerConnection.getTransceivers().find(d=>d.mid===r);c&&(yield c.sender.replaceTrack(n._mediaStreamTrack))})()}getP2PConnectionParams(){var n;if(null===(n=this.peerConnection.currentLocalDescription)||void 0===n||!n.sdp||!this.localCapabilities)throw new Error;return Ev(Ev({},Bh(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;null===(n=this.onICEConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,w.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,w.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},B("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const r={iceServers:[]};return n.iceServers?r.iceServers=n.iceServers:n.turnServer&&"off"!==n.turnServer.mode&&(ih(n.turnServer.servers)?r.iceServers=n.turnServer.servers:(r.iceServers&&r.iceServers.push(...Ri.turnServerConfigToIceServers(n.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&n.turnServer.serversFromGateway&&r.iceServers.push(...Ri.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),B("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(n){const r=[];return n.forEach(s=>{s.security?s.tcpport&&r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(KE(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!B("FORCE_TURN_TCP")&&r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),r}applySendEncodings(n,r){var s=this;return x(function*(){try{if(!Lt().supportSetRtpSenderParameters||n.length!==r.length)return;for(let b=0;b<n.length;b++){const C=n[b],N=r[b];if(N&&N instanceof We){var c,d,h;if(s.isVP8Simulcast(N))continue;const P={},D={};switch(N._optimizationMode){case"motion":P.degradationPreference="maintain-framerate";break;case"detail":P.degradationPreference="maintain-resolution";break;default:P.degradationPreference="balanced"}var p,m,_,g;if(null!==(c=N._encoderConfig)&&void 0!==c&&c.bitrateMax&&(D.maxBitrate=1e3*(null===(p=N._encoderConfig)||void 0===p?void 0:p.bitrateMax)),Re(d=N._hints).call(d,Vt.LOW_STREAM)&&(null!==(m=N._encoderConfig)&&void 0!==m&&m.frameRate&&(D.maxFramerate=Bo(N._encoderConfig.frameRate)),null!==(_=N._encoderConfig)&&void 0!==_&&_.scaleResolutionDownBy&&(null===(g=N._encoderConfig)||void 0===g?void 0:g.scaleResolutionDownBy)>1&&(D.scaleResolutionDownBy=N._encoderConfig.scaleResolutionDownBy)),B("DSCP_TYPE")&&cs()){var v;const U=B("DSCP_TYPE");Re(v=["very-low","low","medium","high"]).call(v,U)&&(D.networkPriority=U)}const k=C.sender.getParameters(),V=null===(h=k.encodings)||void 0===h?void 0:h[0];jt()&&!V&&(P.encodings=[D]),V&&Object.assign(V,D),Object.assign(k,P),yield C.sender.setParameters(k)}}}catch{w.debug("Apply RTPSendEncodings failed.")}})()}mungSendOfferSDP(n,r,s){const c=hn.parse(n);return r.forEach((d,h)=>{const p=s[h],m=c.mediaDescriptions.find(_=>_.attributes.mid===p);m&&(Ts(m,d),Wh(m,d,this.store.codec))}),hn.print(c)}mungReceiveAnswerSDP(n,r,s){const c=hn.parse(n),d=c.mediaDescriptions.find(h=>h.attributes.mid===r);return d&&s===ge.AUDIO&&"audio"===d.media.mediaType&&al(d),this.useXR&&gm(c),hn.print(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,r,s)=>{var c;null===(c=this.onFirstVideoDecoded)||void 0===c||c.call(this,n,r,s)},this.statsFilter.onSelectedLocalCandidateChanged=(n,r)=>{var s;null===(s=this.onSelectedLocalCandidateChanged)||void 0===s||s.call(this,n,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,r)=>{var s;null===(s=this.onSelectedRemoteCandidateChanged)||void 0===s||s.call(this,n,r)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var r;null===(r=this.onFirstVideoDecodedTimeout)||void 0===r||r.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(n,r){var s=this;return x(function*(){if(n.length===r.length)for(let _=0;_<n.length;_++){var c,d,h,p,m;const g=n[_],v=r[_];if(v instanceof We&&!Re(c=v._hints).call(c,Vt.LOW_STREAM)&&null!==(d=v._encoderConfig)&&void 0!==d&&d.bitrateMax&&(null===(h=v._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(p=v._scalabilityMode)&&void 0!==p&&p.numSpatialLayers&&(null===(m=v._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===s.store.codec){const b={},C={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{rid:"m",active:!0,maxBitrate:C.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:C.high}];const N=g.sender.getParameters();yield g.sender.setParameters(Object.assign(N,b))}}})()}applySimulcastEncodings(n,r){var s=this;return x(function*(){if(!jt()&&n.length===r.length)for(let c=0;c<n.length;c++){const d=r[c];if(d instanceof We&&s.isVP8Simulcast(d)){const h=n[c],p={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=h.sender.getParameters();yield h.sender.setParameters(Object.assign(_,p))}}})()}isVP8Simulcast(n){var r,s,c,d,h;return!!(n instanceof We&&B("SIMULCAST")&&"vp8"===this.store.codec&&!Re(r=n._hints).call(r,Vt.LOW_STREAM)&&null!==(s=n._encoderConfig)&&void 0!==s&&s.bitrateMax&&(null===(c=n._encoderConfig)||void 0===c?void 0:c.bitrateMax)>200&&null!==(d=n._scalabilityMode)&&void 0!==d&&d.numSpatialLayers&&(null===(h=n._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,r,s,c){if(B("SDP_LOGGING"))return w.upload("exchanging ".concat(s," ").concat(r," SDP during NVExtentionsConnection.").concat(c,"\n"),n),"offer"===r?d=>{this.logSDPExchange(d,"answer","local"===s?"remote":"local",c)}:void 0}getRemoteSSRC(n){var r=this;return x(function*(){if(r.remoteSDP)return r.remoteSDP.getSSRC(n)?.[0].ssrcId})()}setConfiguration(n){if(Lt().supportPCSetConfiguration){const r=Ri.resolvePCConfiguration(n);this.peerConnection.setConfiguration(r)}}}function $r(o,n,r){const s=o[n];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return r.value=x(function*(){const c=this.mutex,d=yield c.lock("From NVExtentionsConnection.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield s.apply(this,p)}finally{d()}}),r}function qh(o){var n,r,s,c=2;for(typeof Symbol<"u"&&(r=LO,s=Symbol.iterator);c--;){if(r&&null!=(n=o[r]))return n.call(o);if(s&&null!=(n=o[s]))return new vv(n.call(o));r="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function vv(o){function n(r){if(Object(r)!==r)return z.reject(new TypeError(r+" is not an object."));var s=r.done;return z.resolve(r.value).then(function(c){return{value:c,done:s}})}return(vv=function(r){this.s=r,this.n=r.next}).prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(r){var s=this.s.return;return void 0===s?z.resolve({value:r,done:!0}):n(s.apply(this.s,arguments))},throw:function(r){var s=this.s.return;return void 0===s?z.reject(r):n(s.apply(this.s,arguments))}},new vv(o)}ee([$r,O("design:type",Function),O("design:paramtypes",[Object,Object,Array,Object,String,String]),O("design:returntype",z)],Ri.prototype,"connect",null),ee([$r,O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",z)],Ri.prototype,"updateRemoteConnect",null),ee([$r,O("design:type",Function),O("design:paramtypes",[Object,Array]),O("design:returntype",z)],Ri.prototype,"createDataChannels",null),ee([$r,O("design:type",Function),O("design:paramtypes",[String,Array,String,Object]),O("design:returntype",z)],Ri.prototype,"receive",null),ee([$r,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],Ri.prototype,"batchReceive",null),ee([$r,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],Ri.prototype,"stopReceiving",null),ee([$r,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",z)],Ri.prototype,"muteRemote",null),ee([$r,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",z)],Ri.prototype,"unmuteRemote",null),ee([$r,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],Ri.prototype,"muteLocal",null),ee([$r,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],Ri.prototype,"unmuteLocal",null),ee([$r,O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],Ri.prototype,"close",null),ee([$r,O("design:type",Function),O("design:paramtypes",[String,Li]),O("design:returntype",z)],Ri.prototype,"updateEncoderConfig",null),ee([$r,O("design:type",Function),O("design:paramtypes",[String,Li]),O("design:returntype",z)],Ri.prototype,"updateSendParameters",null),ee([$r,O("design:type",Function),O("design:paramtypes",[Li,String]),O("design:returntype",z)],Ri.prototype,"replaceTrack",null),ee([$r,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",z)],Ri.prototype,"getRemoteSSRC",null);class jn extends gh{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(n,r){super(n,r),S(this,"store",void 0),S(this,"peerConnection",void 0),S(this,"cname",void 0),S(this,"mutex",new Wn("DataChannelConnection-mutex")),S(this,"dataChannel",void 0),S(this,"_p2pConnection",void 0),S(this,"establishPromise",void 0),S(this,"_nvMedia",void 0),this.store=r,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(jn.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new Ri(n,r,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}establish(){var n=this;return x(function*(){var r;const s=null===(r=n._nvMedia)||void 0===r?void 0:r.getLocalRtpCapabilities();return yield n._p2pConnection.establish(s)})()}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}connect(n,r,s,c,d,h){var p=this;return x(function*(){return p.cname=h,yield p._p2pConnection.connect(n,r,s,c,d,h),yield new z((m,_)=>{const g=setTimeout(()=>{p.closeSignal(),_(new G(M.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(s))))},2e3);p.dataChannel.onopen=()=>{if("open"===p.dataChannel.readyState)return clearTimeout(g),void m()},p.dataChannel.onerror=v=>{p.closeSignal(),_(v)}}),{transmitter:p.dataChannel,close:p.closeSignal.bind(p)}})()}send(n,r,s){var c=this;return Yr(function*(){const d=yield dt(c.mutex.lock("From DataChannelConnection.send"));try{return yield*Vh(qh(c._p2pConnection.send(n,r,s)))}finally{d()}})()}stopSending(n,r){var s=this;return x(function*(){return s._p2pConnection.stopSending(n,r)})()}createDataChannels(n,r){var s=this;return x(function*(){return s._p2pConnection.createDataChannels(n,r)})()}stopDataChannels(n){var r=this;return x(function*(){return r._p2pConnection.stopDataChannels(n)})()}receive(n,r,s,c){var d=this;return x(function*(){return d._nvMedia?(w.debug("[DataChannelConnection] receive ".concat(n," by DataChannel.")),yield d._nvMedia.reveiveByRTCMedia(n,r,d.cname)):(w.debug("[DataChannelConnection] receive ".concat(n," by WebRTC.")),yield d._p2pConnection.receive(n,r,s,c))})()}batchReceive(n){var r=this;return x(function*(){return[...yield r._p2pConnection.batchReceive(n)]})()}stopReceiving(n){var r=this;return x(function*(){return yield r._p2pConnection.stopReceiving(n)})()}muteRemote(n){var r=this;return x(function*(){return yield r._p2pConnection.muteRemote(n)})()}unmuteRemote(n){var r=this;return x(function*(){return yield r._p2pConnection.unmuteRemote(n)})()}muteLocal(n){var r=this;return x(function*(){return yield r._p2pConnection.muteLocal(n)})()}unmuteLocal(n){var r=this;return x(function*(){return yield r._p2pConnection.unmuteLocal(n)})()}restartICE(n){var r=this;return Yr(function*(){return yield*Vh(qh(r._p2pConnection.restartICE(n)))})()}close(){var n;null===(n=this._nvMedia)||void 0===n||n.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(n){return this._p2pConnection.getRemoteVideoIsReady(n)}updateRemoteConnect(n){var r;null===(r=this._nvMedia)||void 0===r||r.setRemoteRtpCapabilities(n),this._p2pConnection.updateRemoteConnect(n)}updateEncoderConfig(n,r){var s=this;return x(function*(){return yield s._p2pConnection.updateEncoderConfig(n,r)})()}updateSendParameters(n,r){var s=this;return x(function*(){return yield s._p2pConnection.updateSendParameters(n,r)})()}setStatsRemoteVideoIsReady(n,r){this._p2pConnection.setStatsRemoteVideoIsReady(n,r)}replaceTrack(n,r){var s=this;return x(function*(){return yield s._p2pConnection.replaceTrack(n,r)})()}getRemoteSSRC(n){var r=this;return x(function*(){return r._p2pConnection.getRemoteSSRC(n)})()}logSDPExchange(n,r,s,c){if(B("SDP_LOGGING"))return w.upload("exchanging ".concat(s," ").concat(r," SDP during DataChannelConnection.").concat(c,"\n"),n),"offer"===r?d=>{this.logSDPExchange(d,"answer","local"===s?"remote":"local",c)}:void 0}static resolvePCConfiguration(n){const r={iceServers:[]};return n.iceServers?r.iceServers=n.iceServers:n.turnServer&&"off"!==n.turnServer.mode&&(ih(n.turnServer.servers)?r.iceServers=n.turnServer.servers:(r.iceServers&&r.iceServers.push(...jn.turnServerConfigToIceServers(n.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&n.turnServer.serversFromGateway&&r.iceServers.push(...jn.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),B("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(n){const r=[];return n.forEach(s=>{s.security?s.tcpport&&r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(KE(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!B("FORCE_TURN_TCP")&&r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),r}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=n=>{var r;return null===(r=this.onICEConnectionStateChange)||void 0===r?void 0:r.call(this,n)},this._p2pConnection.onConnectionStateChange=n=>{var r;return null===(r=this.onConnectionStateChange)||void 0===r?void 0:r.call(this,n)},this._p2pConnection.onDTLSTransportStateChange=n=>{var r;return null===(r=this.onDTLSTransportStateChange)||void 0===r?void 0:r.call(this,n)},this._p2pConnection.onDTLSTransportError=n=>{var r;return null===(r=this.onDTLSTransportError)||void 0===r?void 0:r.call(this,n)},this._p2pConnection.onICETransportStateChange=n=>{var r;return null===(r=this.onICETransportStateChange)||void 0===r?void 0:r.call(this,n)},this._p2pConnection.onFirstAudioReceived=n=>{var r;return null===(r=this.onFirstAudioReceived)||void 0===r?void 0:r.call(this,n)},this._p2pConnection.onFirstVideoReceived=n=>{var r;return null===(r=this.onFirstVideoReceived)||void 0===r?void 0:r.call(this,n)},this._p2pConnection.onFirstAudioDecoded=n=>{var r;return null===(r=this.onFirstAudioDecoded)||void 0===r?void 0:r.call(this,n)},this._p2pConnection.onFirstVideoDecoded=(n,r,s)=>{var c;return null===(c=this.onFirstVideoDecoded)||void 0===c?void 0:c.call(this,n,r,s)},this._p2pConnection.onFirstVideoDecodedTimeout=n=>{var r;return null===(r=this.onFirstVideoDecodedTimeout)||void 0===r?void 0:r.call(this,n)},this._p2pConnection.onSelectedLocalCandidateChanged=(n,r)=>{var s;return null===(s=this.onSelectedLocalCandidateChanged)||void 0===s?void 0:s.call(this,n,r)},this._p2pConnection.onSelectedRemoteCandidateChanged=(n,r)=>{var s;return null===(s=this.onSelectedRemoteCandidateChanged)||void 0===s?void 0:s.call(this,n,r)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(n){n.onConnectionStateChange=void 0,n.onICEConnectionStateChange=void 0,n.onICETransportStateChange=void 0,n.onDTLSTransportStateChange=void 0,n.onDTLSTransportError=void 0,n.onFirstAudioDecoded=void 0,n.onFirstAudioReceived=void 0,n.onFirstVideoDecoded=void 0,n.onFirstVideoReceived=void 0,n.onSelectedLocalCandidateChanged=void 0,n.onSelectedRemoteCandidateChanged=void 0,n.onFirstVideoDecodedTimeout=void 0}setConfiguration(n){this._p2pConnection.setConfiguration(n)}}function Ho(o,n,r){const s=o[n];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return r.value=x(function*(){const c=this.mutex,d=yield c.lock("From DataChannelConnection.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield s.apply(this,p)}finally{d()}}),r}function yv(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function _T(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?yv(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):yv(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}ee([Ho,O("design:type",Function),O("design:paramtypes",[Object,Object,Array,Object,String,String]),O("design:returntype",z)],jn.prototype,"connect",null),ee([Ho,O("design:type",Function),O("design:paramtypes",[Object,Array]),O("design:returntype",z)],jn.prototype,"createDataChannels",null),ee([Ho,O("design:type",Function),O("design:paramtypes",[String,Array,String,Object]),O("design:returntype",z)],jn.prototype,"receive",null),ee([Ho,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],jn.prototype,"stopReceiving",null),ee([Ho,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",z)],jn.prototype,"muteRemote",null),ee([Ho,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",z)],jn.prototype,"unmuteRemote",null),ee([Ho,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],jn.prototype,"muteLocal",null),ee([Ho,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],jn.prototype,"unmuteLocal",null),ee([Ho,O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],jn.prototype,"close",null),ee([Ho,O("design:type",Function),O("design:paramtypes",[String,Li]),O("design:returntype",z)],jn.prototype,"updateEncoderConfig",null),ee([Ho,O("design:type",Function),O("design:paramtypes",[String,Li]),O("design:returntype",z)],jn.prototype,"updateSendParameters",null),ee([Ho,O("design:type",Function),O("design:paramtypes",[Li,String]),O("design:returntype",z)],jn.prototype,"replaceTrack",null),ee([Ho,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",z)],jn.prototype,"getRemoteSSRC",null);class KO extends Yt{constructor(){super(),S(this,"uplinkStatsUploadInterval",void 0),S(this,"uplinkRelatedStatsUploadInterval",void 0),S(this,"uplinkDenoiserStatsUploadInterval",void 0),S(this,"transportStatsUploadInterval",void 0),S(this,"uplinkExtensionStatsUploadInterval",void 0),S(this,"downlinkExtensionStatsUploadInterval",void 0),S(this,"extensionUsageStatsUploadInterval",void 0),S(this,"downlinkStatsUploadInterval",void 0),S(this,"downlinkRelatedStatsUploadInterval",void 0),S(this,"lastStats",void 0),S(this,"uploadUnplinkStarted",!1),S(this,"uploadDownlinkStarted",!1),S(this,"uploadTransportStarted",!1),S(this,"uploadExtensionUsageStarted",!1),S(this,"requestStats",void 0),S(this,"requestTransportStats",void 0),S(this,"requestLocalMedia",void 0),S(this,"requestRemoteMedia",void 0),S(this,"requestAllTracks",void 0),S(this,"requestVideoIsReady",void 0),S(this,"requestUpload",void 0)}startUploadTransportStats(n){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval(()=>{var r;const s=null===(r=this.requestStats)||void 0===r?void 0:r.call(this);if(s){const d=CO(s);if(n){var c;const h=null===(c=this.requestStats)||void 0===c?void 0:c.call(this,!0);if(h){const p=CO(h);d.connectionType+=p.connectionType<<3}d.connectionType+=110}else d.connectionType+=100;ao(()=>{var h;null===(h=this.requestUpload)||void 0===h||h.call(this,zr.TRANSPORT_STATS,d)})}},1e3))}startUploadExtensionUsageStats(){var n=this;if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const r=new Map;this.extensionUsageStatsUploadInterval=window.setInterval(x(function*(){var s,c,d;const h=Date.now(),p={connectionInterval:B("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:h};let m=[];const _=(null===(s=n.requestAllTracks)||void 0===s?void 0:s.call(n))||[];for(const C of _)!C.muted&&C.enabled&&(m=m.concat(yield C.getProcessorUsage()));const g=(null===(c=n.requestRemoteMedia)||void 0===c?void 0:c.call(n))||[];for(const[C,N]of g)N.has(ge.VIDEO)&&C.videoTrack&&(m=m.concat(yield C.videoTrack.getProcessorUsage())),N.has(ge.AUDIO)&&C.audioTrack&&(m=m.concat(yield C.audioTrack.getProcessorUsage()));if(0===m.length)return;p.details=function(C,N){const P={};for(const{id:U,value:Y,level:oe,direction:K}of C){var D;const X=null!==(D=N.get(U))&&void 0!==D?D:0,$=2===Y?X+B("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:X;var k,V;N.set(U,$),P[U]?(2===Y&&(P[U].value=Y),oe>P[U].level&&(P[U].level=oe),"remote"===K&&(P[U].remoteUidCount+=1),P[U].totalTs=null!==(k=N.get(U))&&void 0!==k?k:0):P[U]={value:Y,level:oe,remoteUidCount:"local"===K?0:1,totalTs:null!==(V=N.get(U))&&void 0!==V?V:0}}return Object.keys(P).map(U=>{const{level:Y,value:oe,totalTs:K}=P[U];return{id:U,level:Y,value:oe,totalTs:K}})}(m,r);const v=Date.now();null===(d=n.requestUpload)||void 0===d||d.call(n,zr.EXTENSION_USAGE_STATS,{usageStats:p,sendTs:v>h?v:h+1})}),B("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval(()=>{var n;const r=null===(n=this.requestStats)||void 0===n?void 0:n.call(this);r&&(this.uploadUplinkStats(r),this.lastStats=r)},3e3),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval(()=>{var n;const r=null===(n=this.requestStats)||void 0===n?void 0:n.call(this);r&&this.uploadRelatedUplinkStats(r,this.lastStats),this.lastStats=r},1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval(()=>{var n;const r=null===(n=this.requestAllTracks)||void 0===n?void 0:n.call(this);r&&this.uploadDenoiserStats(r)},2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval(()=>{var n;const r=null===(n=this.requestAllTracks)||void 0===n?void 0:n.call(this);r&&this.uploadExtensionStats(r)},2e3))}uploadUplinkStats(n){var r;((null===(r=this.requestLocalMedia)||void 0===r?void 0:r.call(this))||[]).forEach(s=>{let[c,{track:d,ssrcs:h}]=s;switch(c){case te.LocalVideoLowTrack:case te.LocalVideoTrack:{const p=function(g,v,b){var C;const N=v.videoSend.find(D=>D.ssrc===g);if(!N)return null;const P={id:It(10,""),timestamp:new Date(v.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:N.ssrc.toString()};switch(P.A_vstd=b._originMediaStreamTrack&&!b._originMediaStreamTrack.enabled||b._mediaStreamTrack&&!b._mediaStreamTrack.enabled?"1":"0",N.sentFrame&&(P.A_fhs=N.sentFrame.height.toString(),P.A_frs=N.sentFrame.frameRate.toString(),P.A_fws=N.sentFrame.width.toString()),N.adaptionChangeReason){case"none":P.A_ac="0";break;case"cpu":P.A_ac="1";break;case"bandwidth":P.A_ac="2";break;case"other":P.A_ac="3"}return P.A_lvps=fC[b._player?b._player.videoElementStatus:"uninit"].toString(),P.A_nr=null===(C=N.nacksCount)||void 0===C?void 0:C.toString(),N.avgEncodeMs&&(P.A_aem=N.avgEncodeMs.toFixed(0).toString()),B("P2P")&&(N.bytes&&(P.bytesSent=N.bytes.toString()),"number"==typeof N.packetsLost&&(P.packetsLost=N.packetsLost.toString()),N.packets&&(P.packetsSent=N.packets.toString())),P}(h[0].ssrcId,n,d),m=c===te.LocalVideoTrack?function(g,v,b){var C,N,P,D,k,V,U,Y;const oe=v.videoSend.find(ve=>ve.ssrc===g);if(!oe)return null;const K={id:It(10,""),timestamp:new Date(v.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:oe.ssrc.toString()},X=null!==(C=null!==(N=null===(P=oe.inputFrame)||void 0===P?void 0:P.height)&&void 0!==N?N:b?._videoHeight)&&void 0!==C?C:0,$=null!==(D=null!==(k=null===(V=oe.inputFrame)||void 0===V?void 0:V.width)&&void 0!==k?k:b?._videoWidth)&&void 0!==D?D:0,J=null!==(U=null===(Y=oe.inputFrame)||void 0===Y?void 0:Y.frameRate)&&void 0!==U?U:0;return X&&(K.A_fhi=X+""),$&&(K.A_fwi=$+""),J&&(K.A_fri=J+""),K}(h[0].ssrcId,n,d):null;p&&ao(()=>{var g;return null===(g=this.requestUpload)||void 0===g?void 0:g.call(this,zr.PUBLISH_STATS,{stream_type:c===te.LocalVideoLowTrack?"low":"high",stats:_T(_T({},p),m)})});const _=function(g){const v={id:"bweforvideo",timestamp:new Date(g.timestamp).toISOString(),type:"VideoBwe"};return g.bitrate.retransmit&&(v.A_rb=g.bitrate.retransmit.toString()),g.bitrate.targetEncoded&&(v.A_teb=g.bitrate.targetEncoded.toString()),v.A_aeb=g.bitrate.actualEncoded.toString(),v.A_tb=g.bitrate.transmit.toString(),void 0!==g.sendBandwidth&&(v.A_asb=g.sendBandwidth.toString()),v}(n);_&&setTimeout(()=>{var g;return null===(g=this.requestUpload)||void 0===g?void 0:g.call(this,zr.PUBLISH_STATS,{stream_type:c===te.LocalVideoLowTrack?"low":"high",stats:_})},1e3);break}case te.LocalAudioTrack:{const p=function(m,_,g){const v=_.audioSend.find(C=>C.ssrc===m);if(!v)return null;const b={id:It(10,""),timestamp:new Date(_.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:v.ssrc.toString()};return b.A_astd=g._originMediaStreamTrack&&!g._originMediaStreamTrack.enabled||g._mediaStreamTrack&&!g._mediaStreamTrack.enabled?"1":"0",b.A_ail=v.inputLevel?Math.round(100*v.inputLevel).toString():Math.round(100*g._source.getAccurateVolumeLevel()).toString(),b.A_apil=Math.round(100*g._source.getAccurateVolumeLevel()).toString(),v.aecReturnLoss&&(b.A_ecrl=Math.round(v.aecReturnLoss).toString()),v.aecReturnLossEnhancement&&(b.A_ecrle=Math.round(v.aecReturnLossEnhancement).toString()),B("P2P")&&(v.bytes&&(b.bytesSent=v.bytes.toString()),"number"==typeof v.packetsLost&&(b.packetsLost=v.packetsLost.toString()),v.packets&&(b.packetsSent=v.packets.toString())),b}(h[0].ssrcId,n,d);p&&ao(()=>{var m;return null===(m=this.requestUpload)||void 0===m?void 0:m.call(this,zr.PUBLISH_STATS,{stream_type:"high",stats:p})});break}}})}uploadRelatedUplinkStats(n,r){var s;((null===(s=this.requestLocalMedia)||void 0===s?void 0:s.call(this))||[]).filter(c=>{let[d]=c;return d===te.LocalVideoLowTrack||d===te.LocalVideoTrack}).forEach(c=>{let[d,{ssrcs:h}]=c;const p=function(m,_){const g=_.videoSend.find(v=>v.ssrc===m);return g?{mediaType:"video",isVideoMute:!1,frameRateInput:g.inputFrame&&g.inputFrame.frameRate.toString(),frameRateSent:g.sentFrame&&g.sentFrame.frameRate.toString(),googRtt:g.rttMs.toString(),qpSumPerFrame:Math.floor(g.qpSumPerFrame).toString()}:null}(h[0].ssrcId,n);p&&ao(()=>{var m;null===(m=this.requestUpload)||void 0===m||m.call(this,zr.PUBLISH_RELATED_STATS,{stream_type:d===te.LocalVideoLowTrack?"low":"high",stats:p})})})}uploadDenoiserStats(n){for(let d=0;d<n.length;d++){const h=n[d];if(h instanceof Zc){var r,s,c;const p=null===(r=(s=h._external).getDenoiserStats)||void 0===r?void 0:r.call(s);return void(p&&(null===(c=this.requestUpload)||void 0===c||c.call(this,zr.DENOISER_STATS,p)))}}}uploadExtensionStats(n){for(let r=0;r<n.length;r++)n[r].getProcessorStats().forEach(s=>{var c;null===(c=this.requestUpload)||void 0===c||c.call(this,s.type,s.stats)})}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let n;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let r=!1;this.downlinkStatsUploadInterval=window.setInterval(()=>{var s;const c=null===(s=this.requestStats)||void 0===s?void 0:s.call(this,!0);c&&(this.uploadDownlinkStats(c,r,n),n=c),r=!r},3e3),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval(()=>{var s;const c=null===(s=this.requestStats)||void 0===s?void 0:s.call(this,!0);c&&(this.uploadRelatedDownlinkStats(c,this.lastStats),this.lastStats=c)},1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval(()=>{var s;const c=null===(s=this.requestRemoteMedia)||void 0===s?void 0:s.call(this);c&&this.uploadDownlinkExtensionStats(c)},2e3)}uploadDownlinkStats(n,r,s){var c;((null===(c=this.requestRemoteMedia)||void 0===c?void 0:c.call(this))||[]).forEach(d=>{let[h,p]=d;if(p.has(ge.VIDEO)&&h.videoTrack){const m=h.videoTrack?function(_,g,v,b,C){const N=g.videoRecv.find(V=>V.ssrc===_);if(!N)return null;const P={id:It(10,""),timestamp:new Date(g.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:N.ssrc.toString()};var D,k;if(P.bytesReceived=N.bytes.toString(),P.packetsLost=N.packetsLost.toString(),P.packetsReceived=N.packets.toString(),N.framesRateFirefox&&(P.A_frr=N.framesRateFirefox.toString()),N.receivedFrame?(P.A_frr=N.receivedFrame.frameRate.toString(),P.A_fhr=N.receivedFrame.height.toString(),P.A_fwr=N.receivedFrame.width.toString()):(P.A_fhr=null===(D=b._videoHeight)||void 0===D?void 0:D.toString(),P.A_fwr=null===(k=b._videoWidth)||void 0===k?void 0:k.toString()),P.A_frd=N.decodeFrameRate.toString(),N.outputFrame&&(P.A_fro=N.outputFrame.frameRate.toString()),void 0!==N.jitterBufferMs&&(P.A_jbm=Math.floor(N.jitterBufferMs).toString()),void 0!==N.currentDelayMs&&(P.A_cdm=Math.floor(N.currentDelayMs).toString()),P.A_fs=N.firsCount.toString(),P.A_ns=N.nacksCount.toString(),P.A_ps=N.plisCount.toString(),b&&(P.A_vrtd=b._originMediaStreamTrack.enabled&&b._mediaStreamTrack.enabled?"0":"1"),b._player&&b._player.freezeTimeCounterList.length>0&&(P.A_vrft=Math.round(b._player.freezeTimeCounterList.splice(0,1)[0]).toString()),C&&b._player&&"visible"===dc.visibility){const V=Math.min(6e3,b._player.renderFreezeAccTime);P.A_vrrft=Math.round(V).toString(),b._player.renderFreezeAccTime=Math.max(0,b._player.renderFreezeAccTime-V)}if(P.A_rvps=fC[b._player?b._player.videoElementStatus:"uninit"].toString(),v){const V=v.videoRecv.find(U=>U.ssrc===_);if(V&&void 0!==N.totalInterFrameDelay&&void 0!==N.totalSquaredInterFrameDelay&&void 0!==V.totalInterFrameDelay&&void 0!==V.totalSquaredInterFrameDelay){const U=N.totalInterFrameDelay-V.totalInterFrameDelay,oe=N.framesDecodeCount-V.framesDecodeCount,K=U/oe*1e3,X=Math.round(1e3*Math.sqrt((N.totalSquaredInterFrameDelay-V.totalSquaredInterFrameDelay-Math.pow(U,2)/oe)/oe));!isNaN(X)&&K+X>Math.max(3*K,K+150)&&(P.A_ifdsd=X.toString())}}return P}(h._videoSSRC,n,s,h.videoTrack,r):void 0;m&&ao(()=>{var _;return null===(_=this.requestUpload)||void 0===_?void 0:_.call(this,zr.SUBSCRIBE_STATS,{stream_id:h.uid,stats:m})})}if(p.has(ge.AUDIO)&&h.audioTrack){const m=h.audioTrack?function(_,g,v,b){const C=g.audioRecv.find(P=>P.ssrc===_);if(!C)return null;const N={id:It(10,""),timestamp:new Date(g.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:C.ssrc.toString()};if(N.bytesReceived=C.bytes.toString(),N.packetsLost=C.packetsLost.toString(),N.packetsReceived=C.packets.toString(),N.A_aol=C.outputLevel?Math.round(100*C.outputLevel).toString():Math.round(100*b._source.getAccurateVolumeLevel()).toString(),N.A_apol=Math.round(100*b._source.getAccurateVolumeLevel()).toString(),b&&(N.A_artd=b._originMediaStreamTrack.enabled&&b._mediaStreamTrack.enabled?"0":"1"),N.A_jr=C.jitterMs.toString(),N.A_jbm=Math.floor(C.jitterBufferMs).toString(),N.A_cdm=Math.floor(C.jitterBufferMs).toString(),N.A_raps=fC[Rr.getPlayerState(b.getTrackId())].toString(),v){const P=v.audioRecv.find(D=>D.ssrc===_);if(P){const D=C.concealedSamples-P.concealedSamples;D>0&&(N.A_cs=Math.round(D).toString())}}return N}(h._audioSSRC,n,s,h.audioTrack):void 0;m&&ao(()=>{var _;return null===(_=this.requestUpload)||void 0===_?void 0:_.call(this,zr.SUBSCRIBE_STATS,{stream_id:h.uid,stats:m})})}})}uploadRelatedDownlinkStats(n,r){var s;((null===(s=this.requestRemoteMedia)||void 0===s?void 0:s.call(this))||[]).forEach(c=>{let[d,h]=c;if(h.has(ge.VIDEO)&&d.videoTrack){var p;const m=!0===(d._videoSSRC&&(null===(p=this.requestVideoIsReady)||void 0===p?void 0:p.call(this,d._videoSSRC))||!1),_=function(g,v,b,C,N,P){const D=b.videoRecv.find(Y=>Y.ssrc===g),k=N?N.videoRecv.find(Y=>Y.ssrc===g):void 0;if(!D)return null;const V=cm.isRemoteVideoFreeze(P,D,k)&&v,U={mediaType:"video",isVideoMute:!1,peerId:C,frameRateReceived:D.receivedFrame&&D.receivedFrame.frameRate.toString(),frameRateDecoded:D.decodedFrame&&D.decodedFrame.frameRate.toString(),isFreeze:V,bytesReceived:D.bytes.toString(),packetsReceived:D.packets.toString(),packetsLost:D.packetsLost.toString(),qpSumPerFrame:Math.floor(D.qpSumPerFrame).toString()};return D.framesRateFirefox&&(U.frameRateDecoded=D.framesRateFirefox.toString(),U.frameRateReceived=D.framesRateFirefox.toString()),U}(d._videoSSRC,m,n,d.uid,r,d.videoTrack);_&&ao(()=>{var g;null===(g=this.requestUpload)||void 0===g||g.call(this,zr.SUBSCRIBE_RELATED_STATS,{stream_id:d.uid,stats:_})})}if(h.has(ge.AUDIO)&&d.audioTrack){const m=function(_,g,v,b){const C=g.audioRecv.find(P=>P.ssrc===_);if(!C)return null;const N=cm.isRemoteAudioFreeze(b);return{mediaType:"audio",isAudioMute:!1,peerId:v,googJitterReceived:C.jitterMs.toString(),isFreeze:N,bytesReceived:C.bytes.toString(),packetsReceived:C.packets.toString(),packetsLost:C.packetsLost.toString(),frameReceived:C.receivedFrames.toString(),frameDropped:C.droppedFrames.toString()}}(d._audioSSRC,n,d.uid,d.audioTrack);m&&ao(()=>{var _;null===(_=this.requestUpload)||void 0===_||_.call(this,zr.SUBSCRIBE_RELATED_STATS,{stream_id:d.uid,stats:m})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(n){n.forEach(r=>{let[s,c]=r;c.has(ge.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach(d=>{var h;null===(h=this.requestUpload)||void 0===h||h.call(this,d.type,d.stats)}),c.has(ge.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach(d=>{var h;null===(h=this.requestUpload)||void 0===h||h.call(this,d.type,d.stats)})})}}function bv(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function dl(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?bv(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):bv(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}function gT(o){var n,r,s,c=2;for(typeof Symbol<"u"&&(r=LO,s=Symbol.iterator);c--;){if(r&&null!=(n=o[r]))return n.call(o);if(s&&null!=(n=o[s]))return new Sv(n.call(o));r="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function Sv(o){function n(r){if(Object(r)!==r)return z.reject(new TypeError(r+" is not an object."));var s=r.done;return z.resolve(r.value).then(function(c){return{value:c,done:s}})}return(Sv=function(r){this.s=r,this.n=r.next}).prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(r){var s=this.s.return;return void 0===s?z.resolve({value:r,done:!0}):n(s.apply(this.s,arguments))},throw:function(r){var s=this.s.return;return void 0===s?z.reject(r):n(s.apply(this.s,arguments))}},new Sv(o)}class oi extends Yt{get state(){return this._state}set state(n){const r=this._state;this._state=n,this.emit(Ae.StateChange,r,this._state)}constructor(n,r){var s;super(),s=this,S(this,"store",void 0),S(this,"statsUploader",void 0),S(this,"connection",void 0),S(this,"localTrackMap",new Map),S(this,"remoteUserMap",new Map),S(this,"localDataChannels",[]),S(this,"remoteDataChannelMap",new Map),S(this,"pendingLocalTracks",[]),S(this,"pendingRemoteTracks",[]),S(this,"pendingLocalDataChannels",[]),S(this,"pendingRemoteDataChannels",[]),S(this,"statsCollector",void 0),S(this,"isPlanB",!1),S(this,"shouldForwardP2PCreation",void 0),S(this,"iceFailedCount",0),S(this,"dtlsFailedCount",0),S(this,"mutex",new Wn("P2PChannel-mutex")),S(this,"_state",at.Disconnected),S(this,"_pcStatsUploadType",B("NEW_ICE_RESTART")?ps.FIRST_CONNECTION:ps.OLD_FIRST_CONNECTION),S(this,"_isInRestartIce",!1),S(this,"_isStartRestartIce",!1),S(this,"_restartStates",["disconnected","failed"]),S(this,"_restartTimer",void 0),S(this,"_isFirstConnected",!0),S(this,"handleMuteLocalTrack",function(){var c=x(function*(d,h,p){const m=yield s.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!s.connection||s.state!==at.Connected)return void p(new Q(M.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const _=s.filterTobeMutedTracks(d);if(0===_.length)return void h();const g=_.find(b=>"videoLowTrack"===b[0]);g&&g[1].track._originMediaStreamTrack.stop(),yield s.connection.muteLocal(_.map(b=>{let[,{id:C}]=b;return C}));const v=s.createMuteMessage(_);yield Mt(s,Ae.RequestMuteLocal,v),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),S(this,"handleUnmuteLocalTrack",function(){var c=x(function*(d,h,p){const m=yield s.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!s.connection||s.state!==at.Connected)return void p(new Q(M.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const _=s.filterTobeUnmutedTracks(d);if(0===_.length)return void h();const g=_.find(b=>"videoLowTrack"===b[0]);if(g){const b=g[1];if(b.track._originMediaStreamTrack.stop(),!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Lt().supportDualStreamEncoding){const C=d._mediaStreamTrack.clone();b.track._mediaStreamTrack=C,b.track._originMediaStreamTrack=C}else{const C=fv(d,rc(s,Ae.RequestLowStreamParameter));b.track._mediaStreamTrack=C,b.track._originMediaStreamTrack=C}yield new z((C,N)=>{s.handleReplaceTrack(b.track,C,N,!0)})}yield s.connection.unmuteLocal(_.map(b=>{let[,{id:C}]=b;return C}));const v=s.createUnmuteMessage(_);yield Mt(s,Ae.RequestUnmuteLocal,v),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),S(this,"handleUpdateVideoEncoder",function(){var c=x(function*(d,h,p){const m=yield s.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const _=s.localTrackMap.get(te.LocalVideoTrack);if(!s.connection||!_||_.track!==d||s.state!==at.Connected)return void h();const{id:g,track:v}=_;yield s.connection.updateSendParameters(g,v),yield s.connection.updateEncoderConfig(g,v),s.emit(Ae.UpdateVideoEncoder,v),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),S(this,"handleSetOptimizationMode",function(){var c=x(function*(d,h,p){const m=yield s.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const _=s.localTrackMap.get(te.LocalVideoTrack);if(!s.connection||!_||_.track!==d||s.state!==at.Connected)return;const{id:g,track:v}=_;yield s.connection.updateSendParameters(g,v),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),S(this,"handleReplaceTrack",function(){var c=x(function*(d,h,p,m){let _;w.debug("[".concat(s.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(d.getTrackId(),"]")),"boolean"==typeof m&&m||(_=yield s.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var g;const b=Array.from(s.localTrackMap.entries()).find(C=>{let[,{track:N}]=C;return d===N});if(!s.connection||!b||s.state!==at.Connected)return void h();if(yield null===(g=s.connection)||void 0===g?void 0:g.replaceTrack(d,b[1].id),s.isPlanB){const C=b[1];C.id=d._mediaStreamTrack.id,s.localTrackMap.set(b[0],C)}if(b[0]===te.LocalVideoTrack&&!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Lt().supportDualStreamEncoding){const C=s.localTrackMap.get(te.LocalVideoLowTrack);if(C){const N=d._mediaStreamTrack.clone();C.track._originMediaStreamTrack.stop(),C.track._mediaStreamTrack=N,C.track._originMediaStreamTrack=N,yield new z((P,D)=>{s.handleReplaceTrack(C.track,P,D,!0)})}}h()}catch(b){p(b)}finally{var v;null===(v=_)||void 0===v||v()}});return function(d,h,p,m){return c.apply(this,arguments)}}()),S(this,"handleGetLocalVideoStats",c=>{c(this.statsCollector.getLocalVideoTrackStats())}),S(this,"handleGetLocalAudioStats",c=>{c(this.statsCollector.getLocalAudioTrackStats())}),S(this,"handleGetRemoteVideoStats",c=>this.statsCollector.getRemoteVideoTrackStats(c.uid)[c.uid]),S(this,"handleGetRemoteAudioStats",c=>this.statsCollector.getRemoteAudioTrackStats(c.uid)[c.uid]),this.store=n,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new KO,this.bindStatsUploaderEvents(),this.isPlanB=!Lt().supportUnifiedPlan||B("CHROME_FORCE_PLAN_B")&&cs(),this.shouldForwardP2PCreation=B("FORWARD_P2P_CREATION")&&Lt().supportPCSetConfiguration&&function(){const c=mS();return c===ei.ANDROID||c===ei.IOS||c===ei.HARMONY_OS}(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new jn({},this.store):this.isPlanB?new ui({},this.store):new Qn({},this.store),this.bindConnectionEvents(this.connection))}startP2PConnection(n,r){var s=this;return x(function*(){var c;s.state=at.New;const d=s.shouldForwardP2PCreation&&"closed"===(null===(c=s.connection)||void 0===c?void 0:c.peerConnectionState);if(s.shouldForwardP2PCreation&&!d||(d&&s.connection&&(w.warning("[".concat(s.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),s.connection.close(),s.unbindConnectionEvents(s.connection)),s.connection=s.store.useDataChannel?new jn(n,s.store):s.isPlanB?new ui(n,s.store):new Qn(n,s.store),s.bindConnectionEvents(s.connection)),!s.connection)throw new Q(M.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return s._pcStatsUploadType=B("NEW_ICE_RESTART")?ps.FIRST_CONNECTION:ps.OLD_FIRST_CONNECTION,s._isFirstConnected=!0,s._isInRestartIce=!1,s._isStartRestartIce=!1,s.connection.setConfiguration(n),s.connection.establishPromise})()}connect(n,r,s,c,d,h){var p=this;return x(function*(){if(!p.connection)throw new Q(M.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");p.connection instanceof jn?p.connection.updateRemoteConnect(c):(p.store.peerConnectionStart(),yield p.connection.connect(n,r,s,c,d,h),p.statsUploader.startUploadTransportStats(),p.statsUploader.startUploadExtensionUsageStats(),p.state=at.Connected)})()}preConnect(n,r,s,c,d,h){var p=this;return x(function*(){if(!p.connection)throw new Q(M.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");p.store.peerConnectionStart();const m=yield p.connection.connect(n,r,s,c,d,h);return p.statsUploader.startUploadTransportStats(),p.statsUploader.startUploadExtensionUsageStats(),p.state=at.Connected,m})()}getEstablishParams(){if(this.connection instanceof jn)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}publishDataChannel(n){var r=this;return x(function*(){if(!r.connection){if(r.state===at.Disconnected)throw new Q(M.UNEXPECTED_ERROR,"PeerConnection already disconnected.");const c=n.filter(d=>-1!==r.pendingLocalDataChannels.findIndex(h=>h.id===d.id));return void(r.pendingLocalDataChannels=r.pendingLocalDataChannels.concat(c))}const s=r.filterTobePublishedDataChannels(n);0!==s.length&&(s.forEach(c=>{const d=Date.now();r.store.publish(c.id.toString(),"datachannel",d)}),yield r.connection.createDataChannels(r.store.uid,s),s.forEach(c=>{r.localDataChannels.push(c);const d=Date.now();r.store.publish(c.id+"","datachannel",void 0,d)}))})()}publish(n,r,s){var c=this;return Yr(function*(){const d=yield dt(c.mutex.lock("From P2PChannel.publish"));try{if(!c.connection||c.state!==at.Connected){if(c.state===at.Disconnected)throw new Q(M.UNEXPECTED_ERROR,"PeerConnection already disconnected.");c.throwIfTrackTypeNotMatch(n);const p=n.filter(m=>-1===c.pendingLocalTracks.indexOf(m));return void(c.pendingLocalTracks=c.pendingLocalTracks.concat(p))}c.store.pubId=c.store.pubId+1,vi.markPublishStart(c.store.clientId,c.store.pubId);const h=c.filterTobePublishedTracks(n,r,s);if(0===h.length)return void(yield dt(c.tryToUnmuteAudio(n)));yield*Vh(gT(c.doPublish(c.connection,h)))}finally{d()}})()}doPublish(n,r){var s=this;return Yr(function*(){r.forEach(g=>{let{track:v,type:b}=g;const C=Date.now();s.store.publish(v.getTrackId(),b===te.LocalAudioTrack?"audio":"video",C)}),s.bindLocalTrackEvents(r);const c=yield dt(n.send(r.map(g=>{let{track:v}=g;return v}),s.store.codec,s.store.audioCodec)),d=(yield dt(c.next())).value,h=s.createGatewayPublishMessage(r,d);let p;try{p=yield h}catch(g){throw c.throw(g),g?.code===M.WS_ABORT&&r.forEach(v=>{let{track:b}=v;-1===s.pendingLocalTracks.indexOf(b)&&s.pendingLocalTracks.push(b)}),s.unbindLocalTrackEvents(r),g}const m=s.mapPubResToRemoteConfig(h,p),_=(yield dt(c.next(m))).value;r.forEach(g=>{let{type:v}=g;s.statsCollector.addLocalStats(v)}),s.assignLocalTracks(r,_),s.statsUploader.startUploadUplinkStats(),r.forEach(g=>{let{track:v,type:b}=g;const C=Date.now();s.store.publish(v.getTrackId(),b===te.LocalAudioTrack?"audio":"video",void 0,C)})})()}updateVideoStreamParameter(n,r){var s=this;return x(function*(){const c=s.localTrackMap.get(r);if(!c)return;if(!(c.track instanceof We))return w.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(s.connection instanceof Qn||s.connection instanceof ui))return w.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:d}=c,h=function(p,m){const _={};return p.height&&p.width&&(_.scaleResolutionDownBy=IO(p,m)),_.maxFramerate=p.framerate?Bo(p.framerate):void 0,_.maxBitrate=p.bitrate?1e3*p.bitrate:void 0,_}(n,d);if(d._encoderConfig||(d._encoderConfig={}),r!==te.LocalVideoLowTrack||!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Lt().supportDualStreamEncoding)null!=h.scaleResolutionDownBy&&(d._encoderConfig.scaleResolutionDownBy=h.scaleResolutionDownBy);else{const p=d._originMediaStreamTrack;if(!p.canvas)return w.warn("[".concat(d.getTrackId(),"] no canvas on track"));!function(m,_){const g=m.canvas;_.width&&(g.width=Bo(_.width)),_.height&&(g.height=Bo(_.height)),_.framerate&&(g.stopCapture&&g.stopCapture(),g.stopCapture=gC(()=>{!g.startCapture&&g.stopCapture&&g.stopCapture(),g.startCapture&&g.startCapture()},Bo(_.framerate)))}(p,n)}null!=h.maxBitrate&&(d._encoderConfig.bitrateMax=h.maxBitrate/1e3),null!=h.maxFramerate&&(d._encoderConfig.frameRate&&"object"==typeof d._encoderConfig.frameRate?d._encoderConfig.frameRate.max=h.maxFramerate:d._encoderConfig.frameRate={max:h.maxFramerate}),w.debug("[".concat(d.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(d._encoderConfig))),yield s.connection.updateRtpSenderEncodings(d)})()}publishLowStream(n){var r=this;return Yr(function*(){if(!r.connection||r.state!==at.Connected)return;const s=yield dt(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const d=r.localTrackMap.get(te.LocalVideoTrack);if(!d)throw new Q(M.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(te.LocalVideoLowTrack))throw new Q(M.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const h=[{track:r.getLowVideoTrack(d.track,n),type:te.LocalVideoLowTrack}];if(yield*Vh(gT(r.doPublish(r.connection,h))),d.track.muted||!d.track.enabled){var c;const p=null===(c=r.localTrackMap.get(te.LocalVideoLowTrack))||void 0===c?void 0:c.id;void 0!==p&&(yield dt(r.connection.muteLocal([p])))}}finally{s()}})()}republish(){var n=this;return x(function*(){n.pendingLocalTracks.length>0&&(w.debug("[".concat(n.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield Qt(n,Ae.RequestRePublish,n.pendingLocalTracks),n.emit(Ae.MediaReconnectEnd,n.store.uid),n.pendingLocalTracks=[]),n.pendingLocalDataChannels.length>0&&(w.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),yield Qt(n,Ae.RequestRePublishDataChannel,n.pendingLocalDataChannels),n.pendingLocalDataChannels=[])})()}reSubscribe(n){var r=this;return x(function*(){for(let s=r.pendingRemoteTracks.length-1;s>=0;s--){const{user:c,kind:d}=r.pendingRemoteTracks[s];(d!==ge.AUDIO||c._audio_added_&&c._audioSSRC)&&(d!==ge.VIDEO||c._video_added_&&c._videoSSRC)||r.pendingRemoteTracks.splice(s,1)}if(n)yield Qt(r,Ae.RequestReSubscribe,r.pendingRemoteTracks);else for(const{user:s,kind:c}of r.pendingRemoteTracks)yield r.subscribe(s,c,c===ge.VIDEO?s._videoSSRC:s._audioSSRC);r.pendingRemoteTracks.forEach(s=>{let{user:c}=s;r.emit(Ae.MediaReconnectEnd,c.uid)}),r.pendingRemoteTracks=[]})()}unpublish(n){var r=this;return x(function*(){if(!r.connection||r.state!==at.Connected)return void n.forEach(d=>{const h=r.pendingLocalTracks.indexOf(d);-1!==h&&r.pendingLocalTracks.splice(h,1)});const s=r.filterTobeUnpublishedTracks(n);if(0===s.length)return;const c=s.find(d=>"videoLowTrack"===d[0]);return c&&c[1].track.close(),r.doUnpublish(r.connection,s)})()}unpublishDataChannel(n){var r=this;return x(function*(){if(!r.connection||r.state!==at.Connected)return void n.forEach(c=>{const d=r.pendingLocalDataChannels.indexOf(c);-1!==d&&r.pendingLocalDataChannels.splice(d,1)});const s=r.filterTobeUnpublishedDataChannels(n);return 0!==s.length?(s.forEach(c=>{const d=r.localDataChannels.indexOf(c);-1!==d&&r.localDataChannels.splice(d,1)}),0===r.localDataChannels.length&&(yield r.connection.stopDataChannels(r.store.uid)),s.map(c=>c.id)):void 0})()}unpublishLowStream(){var n=this;return x(function*(){if(!n.connection||n.state!==at.Connected)return;const r=n.localTrackMap.get(te.LocalVideoLowTrack);return r?(r.track.close(),n.doUnpublish(n.connection,[[te.LocalVideoLowTrack,r]])):void 0})()}doUnpublish(n,r){var s=this;return x(function*(){const c=s.createGatewayUnpublishMessage(r);return yield n.stopSending(r.map(d=>{let[,{id:h}]=d;return h})),s.withdrawLocalTracks(r),s.unbindLocalTrackEvents(r.map(d=>{let[h,{track:p}]=d;return{type:h,track:p}})),r.forEach(d=>{let[h]=d;s.statsCollector.removeLocalStats(h)}),0===s.localTrackMap.size&&s.statsUploader.stopUploadUplinkStats(),c})()}subscribeDataChannel(n,r){var s=this;return x(function*(){if(!s.connection||s.state!==at.Connected)throw new Q(M.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const c=r.filter(d=>{var h;return!(null!==(h=s.remoteDataChannelMap.get(n))&&void 0!==h&&h.get(d.id))});if(0!==c.length)return yield s.connection.createDataChannels(n.uid,c),c.forEach(d=>{var h;s.remoteDataChannelMap.has(n)?null===(h=s.remoteDataChannelMap.get(n))||void 0===h||h.set(d.id,d):s.remoteDataChannelMap.set(n,new Map([[d.id,d]]));const p=s.pendingRemoteDataChannels.findIndex(m=>{let{user:_,id:g}=m;return _.uid===n.uid&&g===d.id});-1!==p&&s.pendingRemoteDataChannels.splice(p,1)}),c.map(d=>d.id)})()}subscribe(n,r,s,c,d){var h=this;return x(function*(){var p;if(!h.connection||h.state!==at.Connected)throw new Q(M.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(p=h.remoteUserMap.get(n))&&void 0!==p&&p.has(r))return;let m,_,g;if(d){const C=d.find(P=>{let{stream_type:D}=P;return D===r});if(!C)throw new Q(M.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(n.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const N=yield h.connection.receive(r,C.ssrcs,String(n._uintid),C.attributes);h.connection instanceof Qn&&(g=N.transceiver),m=N.track,_=N.id}else{const C=yield h.connection.receive(r,[{ssrcId:s,rtx:c}],String(n._uintid),void 0);h.connection instanceof Qn&&(g=C.transceiver),m=C.track,_=C.id}r===ge.AUDIO?(n._audioTrack?n._audioTrack._updateOriginMediaStreamTrack(m):(n._audioTrack=new go(m,n.uid,n._uintid,h.store),w.info("[".concat(h.store.clientId,"] [").concat(h.store.p2pId,"] create remote audio track: ").concat(n._audioTrack.getTrackId()))),g&&n._audioTrack._updateRtpTransceiver(g),h.bindRemoteTrackEvents(n,n._audioTrack)):(n._videoTrack?n._videoTrack._updateOriginMediaStreamTrack(m):(n._videoTrack=new Ks(m,n.uid,n._uintid,h.store),w.info("[".concat(h.store.clientId,"] [").concat(h.store.p2pId,"] create remote video track: ").concat(n._videoTrack.getTrackId()))),g&&n._videoTrack._updateRtpTransceiver(g),h.bindRemoteTrackEvents(n,n._videoTrack));const v=h.remoteUserMap.get(n);v?v.set(r,_):h.remoteUserMap.set(n,new Map([[r,_]])),h.statsCollector.addRemoteStats(n.uid),h.statsUploader.startUploadDownlinkStats();const b=h.pendingRemoteTracks.findIndex(C=>{let{user:N,kind:P}=C;return N.uid===n.uid&&r===P});-1!==b&&(h.pendingRemoteTracks.splice(b,1),h.emit(Ae.MediaReconnectEnd,n.uid))})()}massSubscribe(n){var r=this;return x(function*(){return r.massSubscribeNoLock(n)})()}massSubscribeNoLock(n){var r=this;return x(function*(){if(!r.connection||r.state!==at.Connected)throw new Q(M.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");n=n.filter(c=>{var d;let{user:h,mediaType:p}=c;return!(null!==(d=r.remoteUserMap.get(h))&&void 0!==d&&d.has(p))});const s=yield r.connection.batchReceive(n.map(c=>{let{user:d,mediaType:h,ssrcId:p,rtxSsrcId:m}=c;return{kind:h,ssrcMsg:[{ssrcId:p,rtx:m}],mslabel:String(d._uintid)}}));n.forEach((c,d)=>{let{user:h,mediaType:p}=c;const{track:m,id:_,transceiver:g}=s[d];p===ge.AUDIO?(h._audioTrack?h._audioTrack._updateOriginMediaStreamTrack(m):(h._audioTrack=new go(m,h.uid,h._uintid,r.store),w.info("[".concat(r.store.clientId,"] [").concat(r.store.p2pId,"] create remote audio track: ").concat(h._audioTrack.getTrackId()))),g&&h._audioTrack._updateRtpTransceiver(g),r.bindRemoteTrackEvents(h,h._audioTrack)):(h._videoTrack?h._videoTrack._updateOriginMediaStreamTrack(m):(h._videoTrack=new Ks(m,h.uid,h._uintid,r.store),w.info("[".concat(r.store.clientId,"] [").concat(r.store.p2pId,"] create remote video track: ").concat(h._videoTrack.getTrackId()))),g&&h._videoTrack._updateRtpTransceiver(g),r.bindRemoteTrackEvents(h,h._videoTrack));const v=r.remoteUserMap.get(h);v?v.set(p,_):r.remoteUserMap.set(h,new Map([[p,_]])),r.statsCollector.addRemoteStats(h.uid),r.statsUploader.startUploadDownlinkStats();const b=r.pendingRemoteTracks.findIndex(C=>{let{user:N,kind:P}=C;return N.uid===h.uid&&p===P});-1!==b&&(r.pendingRemoteTracks.splice(b,1),r.emit(Ae.MediaReconnectEnd,h.uid))})})()}unsubscribe(n,r,s){var c=this;return x(function*(){const d=c.pendingRemoteTracks.filter(m=>{let{user:_,kind:g}=m;return void 0!==r?_.uid===n.uid&&r===g:_.uid===n.uid});if(d.forEach(m=>{const _=c.pendingRemoteTracks.indexOf(m);c.pendingRemoteTracks.splice(_,1)}),c.connection&&c.state===at.Connected||s||d.forEach(m=>{let{kind:_}=m;var g;if(_===ge.AUDIO)null===(g=n._audioTrack)||void 0===g||g._destroy(),n._audioTrack=void 0;else if(_===ge.VIDEO){var v;null===(v=n._videoTrack)||void 0===v||v._destroy(),n._videoTrack=void 0}}),!c.connection||c.state!==at.Connected)return;const h=c.filterTobeUnSubscribedTracks(n,r);if(0===h.length)return;yield c.connection.stopReceiving(h.map(m=>{let[,{id:_}]=m;return _}));const p=c.createUnsubscribeMessage(h);return c.withdrawRemoteTracks(h),0===c.remoteUserMap.size&&c.statsUploader.stopUploadDownlinkStats(),h.forEach(m=>{let[_,{kind:g}]=m;var v,b;if(g===ge.VIDEO&&_._videoSSRC&&(null===(v=c.connection)||void 0===v||v.setStatsRemoteVideoIsReady(_._videoSSRC,!1)),g===ge.VIDEO)c.unbindRemoteTrackEvents(_._videoTrack),s||(null===(b=_._videoTrack)||void 0===b||b._destroy(),_._videoTrack=void 0);else if(g===ge.AUDIO){var C;c.unbindRemoteTrackEvents(_._audioTrack),!s&&(null===(C=_._audioTrack)||void 0===C||C._destroy(),_._audioTrack=void 0)}}),p})()}unsubscribeDataChannel(n,r){var s=this;return x(function*(){if(r.forEach(h=>{const p=s.pendingRemoteDataChannels.findIndex(m=>m.id===h.id);-1!==p&&s.pendingRemoteDataChannels.splice(p,1)}),!s.connection)return;const c=s.filterTobeUnSubscribedDataChannels(n,r);if(0===c.length)return;r.forEach(h=>{h._close()});const d=s.remoteDataChannelMap.get(n);return c.forEach(h=>{d&&d.delete(h.id)}),d&&0===d.size&&(s.remoteDataChannelMap.delete(n),yield s.connection.stopDataChannels(n.uid)),c.map(h=>h.id)})()}massUnsubscribe(n){var r=this;return x(function*(){return r.massUnsubscribeNoLock(n)})()}massUnsubscribeNoLock(n){var r=this;return x(function*(){let s=[];for(const{user:h,mediaType:p}of n){const m=r.pendingRemoteTracks.filter(_=>{let{user:g,kind:v}=_;return void 0!==p?g.uid===h.uid&&p===v:g.uid===h.uid});m.forEach(_=>{const g=r.pendingRemoteTracks.indexOf(_);r.pendingRemoteTracks.splice(g,1)}),s=s.concat(m)}if(!r.connection||r.state!==at.Connected)return void s.forEach(h=>{let{user:p,kind:m}=h;var _;if(m===ge.AUDIO)null===(_=p._audioTrack)||void 0===_||_._destroy(),p._audioTrack=void 0;else if(m===ge.VIDEO){var g;null===(g=p._videoTrack)||void 0===g||g._destroy(),p._videoTrack=void 0}});const c=_d(n).call(n,(h,p)=>{let{user:m,mediaType:_}=p;const g=r.filterTobeUnSubscribedTracks(m,_);return h.concat(g)},[]);if(0===c.length)return;yield r.connection.stopReceiving(c.map(h=>{let[,{id:p}]=h;return p}));const d=r.createUnsubscribeAllMessage(c);return r.withdrawRemoteTracks(c),0===r.remoteUserMap.size&&r.statsUploader.stopUploadDownlinkStats(),c.forEach(h=>{let[p,{kind:m}]=h;var _,g;if(m===ge.VIDEO&&p._videoSSRC&&(null===(_=r.connection)||void 0===_||_.setStatsRemoteVideoIsReady(p._videoSSRC,!1)),m===ge.VIDEO)r.unbindRemoteTrackEvents(p._videoTrack),null===(g=p._videoTrack)||void 0===g||g._destroy(),p._videoTrack=void 0;else if(m===ge.AUDIO){var v;r.unbindRemoteTrackEvents(p._audioTrack),null===(v=p._audioTrack)||void 0===v||v._destroy(),p._audioTrack=void 0}}),d})()}muteRemote(n,r){var s=this;return x(function*(){if(!s.connection)return;const c=s.remoteUserMap.get(n);if(!c)return void w.warning("[".concat(s.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(n.uid,"."));if(!c.get(r))return void w.warning("[".concat(s.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(n.uid," media type ").concat(r,"."));const d=r===ge.VIDEO?n._videoSSRC:n._audioSSRC;void 0!==d&&s.connection.setStatsRemoteVideoIsReady(d,!1)})()}unmuteRemote(n,r){var s=this;return x(function*(){return s.unmuteRemoteNoLock(n,r)})()}unmuteRemoteNoLock(n,r){var s=this;return x(function*(){if(!s.connection)return;const c=s.remoteUserMap.get(n);c?c.get(r)||w.warning("[".concat(s.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(n.uid," media type ").concat(r,".")):w.warning("[".concat(s.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(n.uid,"."))})()}getAllTracks(n){const r=this.localTrackMap.get(te.LocalAudioTrack);if(r?.track instanceof Dn){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(c=>{let[d]=c;return d!==te.LocalAudioTrack}).filter(c=>{let[d]=c;return!(n&&d===te.LocalVideoLowTrack)}).map(c=>{let[,{track:d}]=c;return d}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[c]=s;return!(n&&c===te.LocalVideoLowTrack)}).map(s=>{let[,{track:c}]=s;return c})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(n,r,s,c,d){if(n){const p=this.localTrackMap.get(te.LocalAudioTrack),m=this.localTrackMap.get(c?te.LocalVideoLowTrack:te.LocalVideoTrack);Se.publish(this.store.sessionId,{eventElapse:vi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:r,audioName:p?.track.getTrackLabel(),videoName:m?.track.getTrackLabel(),screenshare:-1!==m?.track._hints.indexOf(Vt.SCREEN_TRACK),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}else{var h;s||(s=[]);const p=s.find(_=>_ instanceof mt),m=c?null===(h=this.localTrackMap.get(te.LocalVideoTrack))||void 0===h?void 0:h.track:s.find(_=>_ instanceof We);Se.publish(this.store.sessionId,{eventElapse:vi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:r,audioName:p?.getTrackLabel(),videoName:m?.getTrackLabel(),screenshare:-1!==m?._hints.indexOf(Vt.SCREEN_TRACK),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}}reportSubscribeEvent(n,r,s,c){const d=c===ge.VIDEO?s._videoSSRC:s._audioSSRC;d&&Se.subscribe(this.store.sessionId,{succ:n,ec:r,video:c===ge.VIDEO,audio:c===ge.AUDIO,peerid:s.uid,subscribeRequestid:c===ge.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:vi.measureFromSubscribeStart(this.store.clientId,d)})}reset(){w.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Wn("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new jn({},this.store):this.isPlanB?new ui({},this.store):new Qn({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const n=this.localTrackMap.get(te.LocalAudioTrack);if(n?.track instanceof Dn){if(n.track.trackList.length>0){const r=n.track;n.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}n.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=at.Disconnected}getStats(){var n;return null===(n=this.connection)||void 0===n?void 0:n.getStats()}getRemoteVideoIsReady(n){var r;return(null===(r=this.connection)||void 0===r?void 0:r.getRemoteVideoIsReady(n))||!1}getLocalAudioVolume(){const n=this.localTrackMap.get(te.LocalAudioTrack);if(n)return n.track.getVolumeLevel()}getLocalVideoSize(){const n=this.localTrackMap.get(te.LocalVideoTrack);if(n)return{width:n.track._videoWidth||0,height:n.track._videoHeight||0}}getEncoderConfig(n){const r=this.localTrackMap.get(n);return r&&r.track instanceof We||r&&r.track instanceof mt?r.track._encoderConfig:void 0}getLocalMedia(n){return this.localTrackMap.get(n)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(n,r){if(!n)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(n);return!!s&&(!r||s.has(r))}hasRemoteMediaWithLock(n,r){var s=this;return x(function*(){if(!n)return s.remoteUserMap.size>0;const c=s.remoteUserMap.get(n);return!!c&&(!r||c.has(r))})()}getRemoteMedia(n){var r;const s=Array.from(oo(r=this.remoteUserMap).call(r)).find(c=>c.uid===n);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let n=Array.from(this.remoteUserMap.entries()).map(s=>{let[c]=s;return{uid:c.uid,level:c.audioTrack?100*c.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(te.LocalAudioTrack);return r&&n.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),n=ie(n).call(n,(s,c)=>s.level-c.level),n}disconnectForReconnect(){var n=this;return x(function*(){n.connection&&(w.debug("[".concat(n.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),n.state=at.Reconnecting,B("KEEP_LAST_FRAME")&&0!==n.remoteUserMap.size&&Array.from(n.remoteUserMap.entries()).forEach(r=>{let[s]=r;var c;s._videoTrack&&s._videoTrack._player&&(null===(c=s._videoTrack._player.getVideoElement())||void 0===c||c.pause(),s._videoTrack._player.isKeepLastFrame=!0,s._videoTrack._originMediaStreamTrack.stop())}),n.connection.close(),n.unbindConnectionEvents(n.connection),n.connection=void 0,n.shouldForwardP2PCreation&&(n.connection=n.store.useDataChannel?new jn({},n.store):n.isPlanB?new ui({},n.store):new Qn({},n.store),n.bindConnectionEvents(n.connection)),0!==n.localTrackMap.size&&(Array.from(n.localTrackMap.entries()).forEach(r=>{var s;let[c,{track:d}]=r;switch(c){case te.LocalVideoTrack:Re(s=d._hints).call(s,Vt.LOW_STREAM)?d.close():n.pendingLocalTracks.push(d);break;case te.LocalAudioTrack:d instanceof Dn?n.pendingLocalTracks=n.pendingLocalTracks.concat(d.trackList):n.pendingLocalTracks.push(d)}}),n.emit(Ae.MediaReconnectStart,n.store.uid)),n.unbindLocalTrackEvents(),n.localTrackMap.clear(),0!==n.remoteUserMap.size&&Array.from(n.remoteUserMap.entries()).forEach(r=>{let[s,c]=r;Array.from(oo(c).call(c)).forEach(d=>{n.setPendingRemoteMedia(s,d)}),n.emit(Ae.MediaReconnectStart,s.uid)}),n.unbindAllRemoteTrackEvents(),n.remoteUserMap.clear(),0!==n.localDataChannels.length&&(n.localDataChannels.forEach(r=>{n.pendingLocalDataChannels.push(r)}),n.localDataChannels.length=0),0!==n.remoteDataChannelMap.size&&(Array.from(n.remoteDataChannelMap.entries()).forEach(r=>{let[s,c]=r;Array.from(oo(c).call(c)).forEach(d=>{n.setPendingRemoteDataChannel(s,d)})}),n.remoteDataChannelMap.clear()),n.statsUploader.stopUploadUplinkStats(),n.statsUploader.stopUploadDownlinkStats(),n.statsUploader.stopUploadTransportStats(),w.debug("[".concat(n.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))})()}hasPendingRemoteDataChannel(n,r){for(const s of this.pendingRemoteDataChannels){const{user:c,id:d}=s;if((n instanceof Ii?n.uid:n)===c.uid&&d===r)return!0}return!1}setPendingRemoteDataChannel(n,r){this.hasPendingRemoteDataChannel(n,r)||this.pendingRemoteDataChannels.push({user:n,id:r})}hasPendingRemoteMedia(n,r){for(const s of this.pendingRemoteTracks){const{user:c,kind:d}=s;if((n instanceof Ii?n.uid:n)===c.uid&&r===d)return!0}return!1}setPendingRemoteMedia(n,r){this.hasPendingRemoteMedia(n,r)||this.pendingRemoteTracks.push({user:n,kind:r})}restartICE(n){var r=this;return Yr(function*(){if(!r.connection||r.state!==at.Connected||r.connection instanceof jn)return;const s=yield dt(r.mutex.lock("From P2PChannel.restartICE"));let c;try{c=yield dt(r.connection.restartICE(n));const h=yield dt(c.next());if(h.done)return;const p=h.value,m=yield p;switch(r.reportPCDisconnectedOrFailed(n),n){case ki.TCP:r._pcStatsUploadType=ps.TCP_RESTART;break;case ki.RELAY:r._pcStatsUploadType=ps.RELAY_RESTART;break;default:r._pcStatsUploadType=ps.OLD_RESTART}r._isInRestartIce=!0,c.next(m)}catch(h){var d;null===(d=c)||void 0===d||d.throw(h)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const n=this.connection.getStats(),r=this.localTrackMap.get(te.LocalVideoTrack),s=this.localTrackMap.get(te.LocalAudioTrack),c=n.videoSend.find(N=>N.ssrc===r?.ssrcs[0].ssrcId),d=n.audioSend.find(N=>N.ssrc===s?.ssrcs[0].ssrcId);if(!c||!d)return 1;const h=hr(this,Ae.NeedSignalRTT),p=c?c.rttMs:void 0,m=d?d.rttMs:void 0,_=p&&m?(p+m)/2:p||m,v=100*n.sendPacketLossRate*.7/50+.3*((_&&h?(_+h)/2:_||h)||0)/1500,b=v<.17?1:v<.36?2:v<.59?3:v<.1?4:5,C=r?.track;if(C&&C._encoderConfig&&-1===C._hints.indexOf(Vt.SCREEN_TRACK)){const N=C._encoderConfig.bitrateMax,P=n.bitrate.actualEncoded;if(N&&P){const D=(1e3*N-P)/(1e3*N);return Qk[D<.15?0:D<.3?1:D<.45?2:D<.6?3:4][b]}}return b}getDownlinkNetworkQuality(){if(!this.connection)return 0;const n=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[c]=s;const d=c._audioSSRC,h=c._videoSSRC,p=n.audioRecv.find(P=>P.ssrc===d),m=n.videoRecv.find(P=>P.ssrc===h);if(!p&&!m)return void(r+=1);const _=hr(this,Ae.NeedSignalRTT),g=n.rtt,v=(g&&_?(g+_)/2:g||_)||0,b=p?p.jitterMs:void 0,C=n.recvPacketLossRate;let N=.7*C*100/50+.3*v/1500;b&&(N=.6*C*100/50+.2*v/1500+.2*b/400),r+=N<.1?1:N<.17?2:N<.36?3:N<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}muteLocalTrack(n){var r=this;return x(function*(){return new z((s,c)=>{r.handleMuteLocalTrack(n,s,c)})})()}filterTobePublishedTracks(n,r,s){const c=[],d=Lt(),h=this.getAllTracks();n=rh(n=n.filter(_=>-1===h.indexOf(_)));let p=!1,m=!1;for(const _ of n){if(_ instanceof We&&(this.localTrackMap.has(te.LocalVideoTrack)||p?new Q(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(c.push({track:_,type:te.LocalVideoTrack}),p=!0),r)){const g=this.getLowVideoTrack(_,s);c.push({track:g,type:te.LocalVideoLowTrack})}if(_ instanceof mt){const g=this.localTrackMap.get(te.LocalAudioTrack);if(g){if(!(g.track instanceof Dn))throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");g.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(m){const v=c.find(b=>{let{type:C}=b;return C===te.LocalAudioTrack});if(!(v.track instanceof Dn))throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(_)}else{if(!d.webAudioMediaStreamDest||_ instanceof Dn||_._bypassWebAudio)c.push({track:_,type:te.LocalAudioTrack});else{const v=new Dn;v.addAudioTrack(_),c.push({track:v,type:te.LocalAudioTrack})}m=!0}}}return c}filterTobeUnpublishedTracks(n){const r=[],s=this.getAllTracks();n=rh(n=n.filter(c=>-1!==s.indexOf(c)));for(const c of n){if(c instanceof mt){const d=this.localTrackMap.get(te.LocalAudioTrack);if(!d)continue;d.track instanceof Dn?(d.track.removeAudioTrack(c),this.unbindLocalAudioTrackEvents(c),0===d.track.trackList.length&&(r.push([te.LocalAudioTrack,d]),d.track.close())):r.push([te.LocalAudioTrack,d])}if(c instanceof We){const d=this.localTrackMap.get(te.LocalVideoTrack);if(!d)continue;r.push([te.LocalVideoTrack,d]);const h=this.localTrackMap.get(te.LocalVideoLowTrack);h&&r.push([te.LocalVideoLowTrack,h])}}return r}filterTobePublishedDataChannels(n){return(n=rh(n)).filter(r=>-1===this.localDataChannels.findIndex(s=>s.id===r.id))}filterTobeUnpublishedDataChannels(n){return(n=(n=rh(n)).filter(r=>-1!==this.localDataChannels.indexOf(r))).filter(r=>r._originDataChannel)}bindLocalTrackEvents(n){n.forEach(r=>{let{track:s,type:c}=r;switch(c){case te.LocalVideoTrack:s.addListener(fe.GET_STATS,this.handleGetLocalVideoStats),s.addListener(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(fe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(fe.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),s.addListener(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case te.LocalAudioTrack:this.bindLocalAudioTrackEvents(s)}})}bindLocalAudioTrackEvents(n,r){n instanceof Dn?n.trackList.forEach(s=>{s.addListener(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(fe.GET_STATS,this.handleGetLocalAudioStats),s.addListener(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.addListener(fe.GET_STATS,this.handleGetLocalAudioStats),n.addListener(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||n.addListener(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(n){n||(n=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:c}]=r;return{track:c,type:s}})),n.forEach(r=>{let{track:s,type:c}=r;switch(c){case te.LocalVideoTrack:s.off(fe.GET_STATS,this.handleGetLocalVideoStats),s.off(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(fe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(fe.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),s.off(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case te.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s)}})}unbindLocalAudioTrackEvents(n){n instanceof Dn?n.trackList.forEach(r=>{r.off(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(fe.GET_STATS,this.handleGetLocalAudioStats),r.off(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.off(fe.GET_STATS,this.handleGetLocalAudioStats),n.off(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(n,r){r instanceof Ks&&r.addListener(fe.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(n))}),r instanceof go&&r.addListener(fe.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(n))})}unbindRemoteTrackEvents(n){n&&n.removeAllListeners(fe.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r,s]=n;s.has(ge.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(ge.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(n,r){return n.map((s,c)=>{var d;let h,p,{track:m,type:_}=s;switch(_){case te.LocalAudioTrack:h=gt.Audio,p={dtx:m instanceof Zc&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case te.LocalVideoTrack:h=Re(d=m._hints).call(d,Vt.SCREEN_TRACK)?gt.Screen:gt.High,p=dl(dl({},zC(m)),{},{codec:this.store.codec});break;case te.LocalVideoLowTrack:h=gt.Low,p=dl(dl({},zC(m)),{},{codec:this.store.codec})}return{stream_type:h,attributes:p,ssrcs:r[c]}})}createGatewayUnpublishMessage(n){return n.map(r=>{var s;let c,[d,{track:h,ssrcs:p,id:m}]=r;switch(d){case te.LocalVideoTrack:c=Re(s=h._hints).call(s,Vt.SCREEN_TRACK)?gt.Screen:gt.High;break;case te.LocalAudioTrack:c=gt.Audio;break;case te.LocalVideoLowTrack:c=gt.Low}return{stream_type:c,ssrcs:p,mid:m}})}assignLocalTracks(n,r){n.forEach((s,c)=>{let{track:d,type:h}=s;this.localTrackMap.set(h,{track:d,id:r[c].id,ssrcs:r[c].localSSRC})})}withdrawLocalTracks(n){n.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(n){var r=this;n.onConnectionStateChange=function(){var s=x(function*(c){if(w.info("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(c,")")),r.emit(Ae.PeerConnectionStateChange,c),"connected"!==c||r.store.keyMetrics.peerConnectionEnd||r.store.peerConnectionEnd(),"connected"===c&&(r._restartTimer&&(clearTimeout(r._restartTimer),r._restartTimer=void 0),(r._isFirstConnected||r._isInRestartIce)&&r.reportPCStats(Date.now(),!0,r._pcStatsUploadType),r._isInRestartIce=!1,r._isFirstConnected=!1,r._isStartRestartIce=!1),B("NEW_ICE_RESTART")){var d;if(Re(d=r._restartStates).call(d,c)){if(r._isStartRestartIce)return;r._isStartRestartIce=!0;const h=_=>{("disconnected"===n.iceConnectionState||"checking"===n.iceConnectionState||"failed"===n.iceConnectionState)&&(w.debug("[".concat(r.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(_)),"CONNECTED"===hr(r,Ae.QueryClientConnectionState)&&r.emit(Ae.RequestRestartICE,_))},p=()=>{"disconnected"!==n.iceConnectionState&&"checking"!==n.iceConnectionState&&"failed"!==n.iceConnectionState||(r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),w.debug("[".concat(r.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>r.emit(Ae.P2PLost),0),r.iceFailedCount+=1,r.requestReconnect())},m=B("ICE_RESTART_INTERVAL");return void(r._restartTimer=window.setTimeout(()=>{if(B("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Lt().supportPCSetConfiguration)h(ki.RELAY),r._restartTimer=window.setTimeout(p,m);else if(jt())h(ki.UDP),r._restartTimer=window.setTimeout(p,4e3);else{if(h(ki.TCP),Lt().supportPCSetConfiguration)return void(r._restartTimer=window.setTimeout(()=>{h(ki.RELAY),r._restartTimer=window.setTimeout(p,m)},m));r._restartTimer=window.setTimeout(p,m)}},800))}}else{if("disconnected"===c&&"disconnected"===n.iceConnectionState)return setTimeout(()=>{"disconnected"===n.iceConnectionState&&B("ICE_RESTART")&&"CONNECTED"===hr(r,Ae.QueryClientConnectionState)&&r.emit(Ae.RequestRestartICE)},800),void setTimeout(()=>{"disconnected"===n.peerConnectionState&&(w.debug("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),r._isInRestartIce=!1,setTimeout(()=>r.emit(Ae.P2PLost),0),r.iceFailedCount+=1,r.requestReconnect())},4e3);"failed"===c&&(w.debug("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection state failed, force reconnect")),r.reportPCDisconnectedOrFailed(),setTimeout(()=>r.emit(Ae.P2PLost),0),r.iceFailedCount+=1,yield r.requestReconnect())}});return function(c){return s.apply(this,arguments)}}(),n.onICEConnectionStateChange=s=>{"connected"!==s||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(s,")")),Se.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:s,tag:dn.TRACER}).onSuccess(),this.emit(Ae.IceConnectionStateChange,s)},n.onICETransportStateChange=s=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(s,")"))},n.onDTLSTransportStateChange=s=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(s,")"))},n.onDTLSTransportError=s=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(s,")"))},n.onFirstAudioDecoded=s=>{var c;const d=Array.from(oo(c=this.remoteUserMap).call(c)).find(p=>p._audioSSRC===s);var h;d&&(this.store.subscribe(d.uid,"audio",void 0,void 0,void 0,Date.now()),null===(h=d.audioTrack)||void 0===h||h.emit(Qc.FIRST_FRAME_DECODED),Se.firstRemoteFrame(this.store.sessionId,Bn.FIRST_AUDIO_DECODE,zt.FIRST_AUDIO_DECODE,{peer:d._uintid,subscribeElapse:vi.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId}))},n.onFirstAudioReceived=s=>{var c;const d=Array.from(oo(c=this.remoteUserMap).call(c)).find(h=>h._audioSSRC===s);d&&Se.firstRemoteFrame(this.store.sessionId,Bn.FIRST_AUDIO_RECEIVED,zt.FIRST_AUDIO_RECEIVED,{peer:d._uintid,subscribeElapse:vi.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId})},n.onFirstVideoDecoded=(s,c,d)=>{this.reportVideoFirstFrameDecoded(s,c,d)},n.onFirstVideoReceived=s=>{var c;const d=Array.from(oo(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===s);d&&Se.firstRemoteFrame(this.store.sessionId,Bn.FIRST_VIDEO_RECEIVED,zt.FIRST_VIDEO_RECEIVED,{peer:d._uintid,subscribeElapse:vi.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId})},n.onSelectedLocalCandidateChanged=(s,c)=>{const d="relay"===s.candidateType;"unknown"!==c.candidateType&&d===("relay"===c.candidateType)||this.emit(Ae.ConnectionTypeChange,d),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ud(c))," -> ").concat(JSON.stringify(Ud(s)),")"))},n.onSelectedRemoteCandidateChanged=(s,c)=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ud(c))," -> ").concat(JSON.stringify(Ud(s)),")"))},n.onFirstVideoDecodedTimeout=s=>{this.reportVideoFirstFrameDecoded(s,void 0,void 0,!0)}}unbindConnectionEvents(n){n.onConnectionStateChange=void 0,n.onICEConnectionStateChange=void 0,n.onICETransportStateChange=void 0,n.onDTLSTransportStateChange=void 0,n.onDTLSTransportError=void 0,n.onFirstAudioDecoded=void 0,n.onFirstAudioReceived=void 0,n.onFirstVideoDecoded=void 0,n.onFirstVideoReceived=void 0,n.onSelectedLocalCandidateChanged=void 0,n.onSelectedRemoteCandidateChanged=void 0,n.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(n){const r=[];if(-1===this.getAllTracks().indexOf(n))return r;const s=this.localTrackMap.get(te.LocalAudioTrack);if(n instanceof mt&&s?.track instanceof Dn)return s.track.isActive||r.push([te.LocalAudioTrack,s]),r;const c=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return n===h});if(c&&(r.push(c),c[0]===te.LocalVideoTrack)){const d=this.localTrackMap.get(te.LocalVideoLowTrack);d&&r.push([te.LocalVideoLowTrack,d])}return r}filterTobeUnmutedTracks(n){const r=[],s=this.localTrackMap.get(te.LocalAudioTrack);if(n instanceof mt&&s?.track instanceof Dn)return s.track.isActive&&r.push([te.LocalAudioTrack,s]),r;const c=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return n===h});if(c)if(c[0]===te.LocalVideoTrack){r.push(c);const d=this.localTrackMap.get(te.LocalVideoLowTrack);d&&r.push([te.LocalVideoLowTrack,d])}else r.push(c);return r}createMuteMessage(n){return n.map(r=>{var s;let c,[d,{track:h,ssrcs:p,id:m}]=r;switch(d){case te.LocalAudioTrack:c=gt.Audio;break;case te.LocalVideoTrack:c=Re(s=h._hints).call(s,Vt.SCREEN_TRACK)?gt.Screen:gt.High;break;case te.LocalVideoLowTrack:c=gt.Low}return{stream_type:c,ssrcs:p,mid:m}})}createUnmuteMessage(n){return n.map(r=>{var s;let c,[d,{track:h,ssrcs:p,id:m}]=r;switch(d){case te.LocalAudioTrack:c=gt.Audio;break;case te.LocalVideoTrack:c=Re(s=h._hints).call(s,Vt.SCREEN_TRACK)?gt.Screen:gt.High;break;case te.LocalVideoLowTrack:c=gt.Low}return{stream_type:c,ssrcs:p,mid:m}})}filterTobeUnSubscribedTracks(n,r){const s=[],c=this.remoteUserMap.get(n);if(!c)return s;if(r){const d=c.get(r);if(!d)return s;s.push([n,{kind:r,id:d}])}else Array.from(c.entries()).forEach(d=>{let[h,p]=d;s.push([n,{kind:h,id:p}])});return s}filterTobeUnSubscribedDataChannels(n,r){const s=[];return r.forEach(c=>{var d;null!==(d=this.remoteDataChannelMap.get(n))&&void 0!==d&&d.has(c.id)&&s.push(c)}),s}createUnsubscribeMessage(n){const r=[];return n.forEach(s=>{let[c,{kind:d}]=s;switch(d){case ge.VIDEO:return void(c._videoSSRC&&r.push({stream_type:ge.VIDEO,ssrcId:c._videoSSRC}));case ge.AUDIO:return void(c._audioSSRC&&r.push({stream_type:ge.AUDIO,ssrcId:c._audioSSRC}))}}),r}createUnsubscribeAllMessage(n){const r=new Map;return n.forEach(s=>{let[c,{kind:d}]=s;if(r.has(c)){let h=r.get(c);h|=d===ge.VIDEO?Fn.Video:Fn.Audio,r.set(c,h)}else r.set(c,d===ge.VIDEO?Fn.Video:Fn.Audio)}),{users:Array.from(r.entries()).map(s=>{let[c,d]=s;return{stream_id:c.uid,stream_type:d}})}}withdrawRemoteTracks(n){n.forEach(r=>{let[s,{kind:c}]=r;const d=this.remoteUserMap.get(s);d&&(d.delete(c),0===Array.from(d.entries()).length&&this.remoteUserMap.delete(s))})}updateBitrateLimit(n){var r=this;return x(function*(){const s=r.localTrackMap.get(te.LocalVideoTrack),c=r.localTrackMap.get(te.LocalVideoLowTrack);s&&(yield s.track.setBitrateLimit(n.uplink)),c&&n.low_stream_uplink&&(yield c.track.setBitrateLimit({max_bitrate:n.low_stream_uplink.bitrate,min_bitrate:n.low_stream_uplink.bitrate||0}))})()}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(n,r){return n.map((s,c)=>{var d;let{stream_type:h}=s;return null===(d=r.find(p=>{let{stream_type:m}=p;return h===m}))||void 0===d?void 0:d.attributes})}tryToUnmuteAudio(n){var r=this;return x(function*(){for(let c=0;c<n.length;c++)if(n[c]instanceof mt){var s;const d=r.filterTobeUnmutedTracks(n[c]);if(0===d.length)continue;yield null===(s=r.connection)||void 0===s?void 0:s.unmuteLocal(d.map(p=>{let[,{id:m}]=p;return m}));const h=r.createUnmuteMessage(d);return void(yield Mt(r,Ae.RequestUnmuteLocal,h))}})()}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=n=>{var r;return!(null===(r=this.connection)||void 0===r||!r.getRemoteVideoIsReady(n))},this.statsUploader.requestUpload=(n,r)=>this.emit(Ae.RequestUploadStats,n,r),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){var n=this;return x(function*(){n.dtlsFailedCount+=1,yield mi(jg(n.dtlsFailedCount,bn)),n.emit(Ae.RequestReconnect)})()}reconnectP2P(){var n=this;return x(function*(){const r=Array.from(n.localTrackMap.entries()),s=n.createGatewayUnpublishMessage(r);Array.from(n.remoteUserMap.entries()),s.length>0&&(yield Qt(n,Ae.RequestUnpublishForReconnectPC,s)),n.disconnectForReconnect(),n.emit(Ae.RequestReconnectPC)})()}canPublishLowStream(){return this.localTrackMap.has(te.LocalVideoTrack)||this.pendingLocalTracks.some(n=>n instanceof We)}throwIfTrackTypeNotMatch(n){if(n.filter(r=>r instanceof We).length>1)throw new Q(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n.filter(r=>r instanceof mt).length>1&&(n.some(r=>r instanceof mt&&r._bypassWebAudio)||!Lt().webAudioMediaStreamDest))throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of n){if(r instanceof We&&this.pendingLocalTracks.some(s=>s instanceof We))throw new Q(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof mt&&this.pendingLocalTracks.some(s=>s instanceof mt)&&(!Lt().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof mt&&s._bypassWebAudio)))throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(n,r){const s=!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Lt().supportDualStreamEncoding,c=dl(dl({},{width:160,height:120,framerate:15,bitrate:50}),r);let d;d=s?n._mediaStreamTrack.clone():fv(n,c);const h=It(8,"track-low-"),p=new We(d,dl(dl({},s&&{scaleResolutionDownBy:IO(c,n)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return p.on(Ch.TRANSCEIVER_UPDATED,m=>{n._updateRtpTransceiver(m,ac.LOW_STREAM)}),p._hints.push(Vt.LOW_STREAM),n.addListener(fe.NEED_CLOSE,()=>{p.close()}),p}globalLock(){var n=this;return x(function*(){return n.mutex.lock("From P2PChannel.globalLock")})()}reportPCStats(n,r,s){var c=arguments,d=this;return x(function*(){let h=c.length>3&&void 0!==c[3]?c[3]:null;if(d.connection&&d.connection instanceof Qn){var p,m,_,g;const v=d.store.keyMetrics.descriptionStart||0,{iceConnectionState:b,dtlsTransportState:C,peerConnectionState:N}=d.connection,{local:P,remote:D}=yield d.connection.getSelectedCandidatePair();Se.pcStats(d.store.sessionId,{startTime:v,eventElapse:n-v||0,iceconnectionsate:b,dtlsstate:C,connectionstate:N,intSucc:r?1:2,error:h,selectedLocalCandidateProtocol:null!==(p=P?.protocol)&&void 0!==p?p:"",selectedLocalCandidateType:null!==(m=P.candidateType)&&void 0!==m?m:"",selectedLocalCandidateAddress:"".concat(P.address,":").concat(P.port),selectedRemoteCandidateProtocol:null!==(_=D.protocol)&&void 0!==_?_:"",selectedRemoteCandidateType:null!==(g=D.candidateType)&&void 0!==g?g:"",selectedRemoteCandidateAddress:"".concat(D.address,":").concat(D.port),restartCnt:s})}})()}reportVideoFirstFrameDecoded(n,r,s,c){var d;const h=Array.from(oo(d=this.remoteUserMap).call(d)).find(p=>p._videoSSRC===n);if(h){c||this.store.subscribe(h.uid,"video",void 0,void 0,void 0,void 0,Date.now());const p=this.store.keyMetrics,m=p.subscribe.find(_=>_.userId===h.uid&&"video"===_.type);Se.firstRemoteVideoDecode(this.store.sessionId,Bn.FIRST_VIDEO_DECODE,zt.FIRST_VIDEO_DECODE,{peer:h._uintid,videowidth:r,videoheight:s,subscribeElapse:vi.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId,apEnd:p.requestAPEnd||0,apStart:p.requestAPStart||0,joinGwEnd:p.joinGatewayEnd||0,joinGwStart:p.joinGatewayStart||0,pcEnd:p.peerConnectionEnd||0,pcStart:p.peerConnectionStart||0,subscriberEnd:m?.subscribeEnd||0,subscriberStart:m?.subscribeStart||0,videoAddNotify:m?.streamAdded||0,state:c?1:0})}}remoteMediaSsrcChanged(n,r,s){var c=this;return x(function*(){if(!c.connection)return!1;const d=c.remoteUserMap.get(n);if(!d)return!1;const h=d.get(r);if(!h)return!1;const p=yield c.connection.getRemoteSSRC(h);return void 0!==p&&p!==s})()}resetConnection(n){w.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(n)),this.state===at.Connected?(w.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=n===Af.datachannel?new jn({},this.store):this.isPlanB?new ui({},this.store):new Qn({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(n=>{let[r,{track:s}]=n;r===te.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,ac.LOW_STREAM):s._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(n){this.connection&&this.connection instanceof Qn&&("disconnected"!==this.connection.iceConnectionState&&"checking"!==this.connection.iceConnectionState&&"failed"!==this.connection.iceConnectionState||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this.reportPCStats(Date.now(),!1,this._pcStatsUploadType===ps.TCP_RESTART&&n===ki.RELAY?this._pcStatsUploadType:ps.DISCONNECTED_OR_FAILED)))}}function Qi(o,n,r){const s=o[n];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return r.value=x(function*(){const c=this.mutex,d=yield c.lock("From P2PChannel.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield s.apply(this,p)}finally{d()}}),r}function RL(o){let n={};e:for(;!QO(o);){let r=Qs(o);switch(r>>>3){case 0:break e;case 1:n.requestId=ZO(o,Qs(o));break;case 2:n.requestType=Qs(o)>>>0;break;case 3:n.scorePorn=Tv(o);break;case 4:n.scoreSexy=Tv(o);break;case 5:n.scoreNeutral=Tv(o);break;case 6:n.requestScene=Qs(o)>>>0;break;case 7:n.scene=Qs(o)>>>0;break;default:YO(o,7&r)}}return n}function cV(o,n){let r=o.service;void 0!==r&&(St(n,8),St(n,r));let s=o.vendor;void 0!==s&&(St(n,16),St(n,s));let c=o.token;void 0!==c&&(St(n,26),Js(n,c));let d=o.callbackUrl;void 0!==d&&(St(n,34),Js(n,d))}function ET(o){let n=Qs(o),r=o.limit;return o.limit=o.offset+n,r}function YO(o,n){switch(n){case 0:for(;128&bT(o););break;case 2:yT(o,Qs(o));break;case 5:yT(o,4);break;case 1:yT(o,8);break;default:throw new Error("Unimplemented type: "+n)}}ee([Qi,O("design:type",Function),O("design:paramtypes",[Object,Boolean]),O("design:returntype",z)],oi.prototype,"startP2PConnection",null),ee([Qi,O("design:type",Function),O("design:paramtypes",[Object,Object,Array,Object,String,String]),O("design:returntype",z)],oi.prototype,"connect",null),ee([Qi,O("design:type",Function),O("design:paramtypes",[Object,Object,Array,Object,String,String]),O("design:returntype",z)],oi.prototype,"preConnect",null),ee([Qi,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],oi.prototype,"publishDataChannel",null),ee([Qi,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],oi.prototype,"unpublish",null),ee([Qi,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],oi.prototype,"unpublishDataChannel",null),ee([Qi,O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",z)],oi.prototype,"unpublishLowStream",null),ee([Qi,O("design:type",Function),O("design:paramtypes",[Ii,Array]),O("design:returntype",z)],oi.prototype,"subscribeDataChannel",null),ee([Qi,O("design:type",Function),O("design:paramtypes",[Ii,String,Number,Number,Array]),O("design:returntype",z)],oi.prototype,"subscribe",null),ee([Qi,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],oi.prototype,"massSubscribe",null),ee([Qi,O("design:type",Function),O("design:paramtypes",[Ii,String,Boolean]),O("design:returntype",z)],oi.prototype,"unsubscribe",null),ee([Qi,O("design:type",Function),O("design:paramtypes",[Ii,Array]),O("design:returntype",z)],oi.prototype,"unsubscribeDataChannel",null),ee([Qi,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],oi.prototype,"massUnsubscribe",null),ee([Qi,O("design:type",Function),O("design:paramtypes",[Ii,String]),O("design:returntype",z)],oi.prototype,"muteRemote",null),ee([Qi,O("design:type",Function),O("design:paramtypes",[Ii,String]),O("design:returntype",z)],oi.prototype,"unmuteRemote",null),ee([Qi,O("design:type",Function),O("design:paramtypes",[Ii,String]),O("design:returntype",z)],oi.prototype,"hasRemoteMediaWithLock",null),ee([Qi,O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",z)],oi.prototype,"disconnectForReconnect",null),ee([Qi,O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",z)],oi.prototype,"updateBitrateLimit",null),ee([Qi,O("design:type",Function),O("design:paramtypes",[Ii,String,Number]),O("design:returntype",z)],oi.prototype,"remoteMediaSsrcChanged",null);let $O=new Float32Array(1);new Uint8Array($O.buffer);let Cv=new Float64Array(1),yi=new Uint8Array(Cv.buffer);function Yh(o){return{low:o|=0,high:o>>31,unsigned:o>=0}}let vT=[];function XO(){const o=vT.pop();return o?(o.offset=o.limit=0,o):{bytes:new Uint8Array(64),offset:0,limit:0}}function JO(o){vT.push(o)}function yT(o,n){if(o.offset+n>o.limit)throw new Error("Skip past limit");o.offset+=n}function QO(o){return o.offset>=o.limit}function ul(o,n){let r=o.bytes,s=o.offset,c=o.limit,d=s+n;if(d>r.length){let h=new Uint8Array(2*d);h.set(r),o.bytes=h}return o.offset=d,d>c&&(o.limit=d),s}function vm(o,n){let r=o.offset;if(r+n>o.limit)throw new Error("Read past limit");return o.offset+=n,r}function ZO(o,n){let r=vm(o,n),s=String.fromCharCode,c=o.bytes,d="\ufffd",h="";for(let p=0;p<n;p++){let m,_,g,v,b=c[p+r];128&b?192==(224&b)?p+1>=n?h+=d:(m=c[p+r+1],128!=(192&m)?h+=d:(v=(31&b)<<6|63&m,v<128?h+=d:(h+=s(v),p++))):224==(240&b)?p+2>=n?h+=d:(m=c[p+r+1],_=c[p+r+2],32896!=(49344&(m|_<<8))?h+=d:(v=(15&b)<<12|(63&m)<<6|63&_,v<2048||v>=55296&&v<=57343?h+=d:(h+=s(v),p+=2))):240==(248&b)?p+3>=n?h+=d:(m=c[p+r+1],_=c[p+r+2],g=c[p+r+3],8421504!=(12632256&(m|_<<8|g<<16))?h+=d:(v=(7&b)<<18|(63&m)<<12|(63&_)<<6|63&g,v<65536||v>1114111?h+=d:(v-=65536,h+=s(55296+(v>>10),56320+(1023&v)),p+=3))):h+=d:h+=s(b)}return h}function Js(o,n){let r=n.length,s=0;for(let h=0;h<r;h++){let p=n.charCodeAt(h);p>=55296&&p<=56319&&h+1<r&&(p=(p<<10)+n.charCodeAt(++h)-56613888),s+=p<128?1:p<2048?2:p<65536?3:4}St(o,s);let c=ul(o,s),d=o.bytes;for(let h=0;h<r;h++){let p=n.charCodeAt(h);p>=55296&&p<=56319&&h+1<r&&(p=(p<<10)+n.charCodeAt(++h)-56613888),p<128?d[c++]=p:(p<2048?d[c++]=p>>6&31|192:(p<65536?d[c++]=p>>12&15|224:(d[c++]=p>>18&7|240,d[c++]=p>>12&63|128),d[c++]=p>>6&63|128),d[c++]=63&p|128)}}function AL(o,n){let r=ul(o,n.limit),s=o.bytes,c=n.bytes;for(let d=0,h=n.limit;d<h;d++)s[d+r]=c[d]}function bT(o){return o.bytes[vm(o,1)]}function eN(o,n){let r=ul(o,1);o.bytes[r]=n}function Tv(o){let n=vm(o,8),r=o.bytes;return yi[0]=r[n++],yi[1]=r[n++],yi[2]=r[n++],yi[3]=r[n++],yi[4]=r[n++],yi[5]=r[n++],yi[6]=r[n++],yi[7]=r[n++],Cv[0]}function ST(o,n){let r=ul(o,8),s=o.bytes;Cv[0]=n,s[r++]=yi[0],s[r++]=yi[1],s[r++]=yi[2],s[r++]=yi[3],s[r++]=yi[4],s[r++]=yi[5],s[r++]=yi[6],s[r++]=yi[7]}function Qs(o){let n,r=0,s=0;do{n=bT(o),r<32&&(s|=(127&n)<<r),r+=7}while(128&n);return s}function St(o,n){for(n>>>=0;n>=128;)eN(o,127&n|128),n>>>=7;eN(o,n)}function qd(o,n){let r=n.low>>>0,s=(n.low>>>28|n.high<<4)>>>0,c=n.high>>>24,d=0===c?0===s?r<16384?r<128?1:2:r<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:c<128?9:10,h=ul(o,d),p=o.bytes;switch(d){case 10:p[h+9]=c>>>7&1;case 9:p[h+8]=9!==d?128|c:127&c;case 8:p[h+7]=8!==d?s>>>21|128:s>>>21&127;case 7:p[h+6]=7!==d?s>>>14|128:s>>>14&127;case 6:p[h+5]=6!==d?s>>>7|128:s>>>7&127;case 5:p[h+4]=5!==d?128|s:127&s;case 4:p[h+3]=4!==d?r>>>21|128:r>>>21&127;case 3:p[h+2]=3!==d?r>>>14|128:r>>>14&127;case 2:p[h+1]=2!==d?r>>>7|128:r>>>7&127;case 1:p[h]=1!==d?128|r:127&r}}function DL(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}const OL=new Map([["moderation",1],["supervise",2]]);class ym extends Yt{get connectionState(){return this._connectionState}set connectionState(n){if(this._connectionState===n)return;const r=this._connectionState;this._connectionState=n,this.emit(Jn.CONNECTION_STATE_CHANGE,r,n)}get inspectType(){return this._inspectType}set inspectType(n){var r;this._inspectMode=_d(r=n.map(s=>OL.get(s)||0)).call(r,(s,c)=>s+c),this._inspectType=n}get quality(){return this._quality}set quality(n){this._quality=n>1?1:n<.1?.1:n,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(n){super(),S(this,"name","AgoraRTCVideoContentInspect"),S(this,"_connectionState",Uo.CONNECTING),S(this,"_innerConnectionState",void 0),S(this,"sequence",0),S(this,"inspectStartTime",void 0),S(this,"workerManagerConnection",void 0),S(this,"workerConnection",void 0),S(this,"workerMessageLengthLimit",void 0),S(this,"inspectIntervalMinimum",void 0),S(this,"qualityRatio",void 0),S(this,"_connectInfo",void 0),S(this,"_cancelTokenSource",Tr.CancelToken.source()),S(this,"_retryConfig",void 0),S(this,"wmSequence",0),S(this,"inspectInterval",void 0),S(this,"inspectTimer",null),S(this,"ossFilePrefix",void 0),S(this,"extraInfo",void 0),S(this,"_inspectType",void 0),S(this,"_inspectMode",void 0),S(this,"_quality",1),S(this,"qualityTimer",null),S(this,"_inspectId",void 0),S(this,"_needWorkUrlOnly",!1),S(this,"inspectImage",()=>{if(this.connectionState!==Uo.CONNECTED)throw new G(M.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Uo.CONNECTED?this.requestToInspectImage():w.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=It(5,"inspect-"),this.workerMessageLengthLimit=B("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=B("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=B("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=n.interval,this.ossFilePrefix=n.ossFilePrefix,this.extraInfo=n.extraInfo,this.inspectType=n.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new $c("worker-manager-"+this._inspectId,bn),this.on(Jn.STATE_CHANGE,(r,s)=>{this._innerConnectionState=r,w.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Vo[r]," ").concat(s||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new $c("worker-"+this._inspectId,bn),this.handleWorkerEvents()}init(n,r){var s=this;return x(function*(){s.emit(Jn.STATE_CHANGE,Vo.CONNECT_AP),s._connectInfo=n;const c=s._cancelTokenSource.token;return s._retryConfig=r,new z((d,h)=>{s.on(Jn.CONNECTION_STATE_CHANGE,(p,m)=>{m===Uo.CONNECTED&&d()}),s.requestAP(n,c,r).then(p=>{s.connectWorkerManager(p)}).catch(p=>{h(p)})})})()}requestAP(n,r,s){var c=this;return x(function*(){const d=B("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),h=yield function(m,_,g,v){let{appId:b,areaCode:C,cname:N,sid:P,token:D,uid:k}=_;Vd++;const V="image_moderation_api",U={service_name:V,json_body:JSON.stringify({appId:b,areaCode:C,cname:N,command:"allocateEdge",requestId:Vd,seq:Vd,sid:P,token:D,ts:Date.now(),uid:k+""})};let Y,oe,K=m[0];return Ws(x(function*(){Y=Date.now();const X=yield Ss(K,{data:U,cancelToken:g,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(oe=Date.now()-Y,0!==X.code){const ye=new G(M.UNEXPECTED_RESPONSE,"image inspect ap error, code"+X.code,{retry:!0,responseTime:oe});throw w.error(ye.toString()),ye}const $=JSON.parse(X.json_body);if(200!==$.code){const ye=new G(M.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat($.code,", reason: ").concat($.reason),{code:$.code,responseTime:oe});throw w.error(ye.toString()),ye}if(!$.servers||!Array.isArray($.servers)||0===$.servers.length){const ye=new G(M.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:$.code,responseTime:oe});throw w.error(ye.toString()),ye}const J=B("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ve=B("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:$.servers.map(ye=>{let{address:Ye,wss:ut}=ye;if(Ye&&ut)return"wss://".concat(Ye.replace(/\./g,"-"),".").concat(J,":").concat(ve||ut)}).filter(ye=>!!ye),workerToken:$.workerToken,vid:$.vid,responseTime:oe}}),(X,$)=>(Se.apworkerEvent(P,{success:!0,sc:200,serviceName:V,responseDetail:JSON.stringify(X.addressList),firstSuccess:0===$,responseTime:oe,serverIp:m[$%m.length]}),!1),(X,$)=>(Se.apworkerEvent(P,{success:!1,sc:X.data&&X.data.code||200,serviceName:V,responseTime:oe,serverIp:m[$%m.length]}),!!(X.code!==M.OPERATION_ABORTED&&X.code!==M.UNEXPECTED_RESPONSE||X.data&&X.data.retry)&&(K=m[($+1)%m.length],!0)),v)}(d,n,r,s);c.emit(Jn.STATE_CHANGE,Vo.AP_CONNECTED);const{addressList:p}=h;return c.wmSequence++,p})()}connectWorkerManager(n){var r=arguments,s=this;return x(function*(){s._needWorkUrlOnly=r.length>1&&void 0!==r[1]&&r[1],s.emit(Jn.STATE_CHANGE,Vo.CONNECT_WORKER_MANAGER),yield s.workerManagerConnection.init(n,1e4)})()}connectWorker(n){var r=this;return x(function*(){yield r.workerConnection.init([n])})()}handleWorkerManagerEvents(){var n=this;this.workerManagerConnection.on(Me.CONNECTED,x(function*(){n.emit(Jn.STATE_CHANGE,Vo.WORKER_MANAGER_CONNECTED,n.workerManagerConnection.url),n.workerManagerConnection.sendMessage({appId:n._connectInfo.appId,cname:n._connectInfo.cname,uid:n._connectInfo.uid+"",sdkVersion:"4.19.1",sid:n._connectInfo.sid,seq:n.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(Me.CLOSED,()=>{this._innerConnectionState<Vo.GET_WORKER_MANAGER_RESPONSE&&w.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Me.FAILED,()=>{this._innerConnectionState<Vo.GET_WORKER_MANAGER_RESPONSE&&w.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Me.RECONNECTING,()=>{this._innerConnectionState<Vo.GET_WORKER_MANAGER_RESPONSE&&w.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Me.ON_MESSAGE,function(){var r=x(function*(s){n.emit(Jn.STATE_CHANGE,Vo.GET_WORKER_MANAGER_RESPONSE);const c=n.workerManagerConnection.url;n.workerManagerConnection.close();const d=JSON.parse(s.data);if(200!==d.code)throw w.error("[".concat(n._inspectId,"] Unexpected code ").concat(d.code," from worker manager")),new G(M.UNEXPECTED_RESPONSE,"response code of worker is unexpected",d);if(!(d.serverResponse&&d.serverResponse.portWss&&c))throw w.error("[".concat(n._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(d))),new G(M.UNEXPECTED_RESPONSE,"response content of worker is unexpected",d);{const h=B("VIDEO_INSPECT_WORKER_PORT")||d.serverResponse.portWss,p=c.replace(/:\d+\/?$/,":".concat(h));n.emit(Jn.STATE_CHANGE,Vo.CONNECT_WORKER,p),n._needWorkUrlOnly?n.emit(Jn.REQUEST_NEW_WORKER_URL,p):yield n.connectWorker(p)}});return function(s){return r.apply(this,arguments)}}()),this.workerManagerConnection.on(Me.WILL_RECONNECT,(r,s,c)=>{c(r)}),this.workerManagerConnection.on(Me.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}handleWorkerEvents(){var n=this;this.workerConnection.on(Me.CONNECTED,x(function*(){n.emit(Jn.STATE_CHANGE,Vo.WORKER_CONNECTED,n.workerConnection.url),n.connectionState=Uo.CONNECTED})),this.workerConnection.on(Me.ON_MESSAGE,function(){var r=x(function*(s){if(s.data instanceof ArrayBuffer){const d=function qO(o){return function(r){let s={};e:for(;!QO(r);){let c=Qs(r);switch(c>>>3){case 0:break e;case 1:s.code=Qs(r);break;case 2:s.msg=ZO(r,Qs(r));break;case 3:{let d=ET(r);s.data=RL(r),r.limit=d;break}default:YO(r,7&c)}}return s}({bytes:n=o,offset:0,limit:n.length});var n}(new Uint8Array(s.data));if(B("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&w.debug("[".concat(n._inspectId,"] Response message for worker of inspect content "),JSON.stringify(d)),200===d.code){if(Array.isArray(n.inspectType)&&1===n.inspectType.length&&"supervise"===n.inspectType[0])return void n.emit(Jn.INSPECT_RESULT,void 0,void 0);if(d.data&&d.data.scorePorn&&d.data.scoreSexy&&d.data.scoreNeutral){var c;const h={porn:d.data.scorePorn,sexy:d.data.scoreSexy,neutral:d.data.scoreNeutral},p=_d(c=Object.keys(h)).call(c,(_,g)=>h[_]>h[g]?_:g,"porn"),m=Object.keys(h).find(_=>_===p);n.emit(Jn.INSPECT_RESULT,m)}else n.emit(Jn.INSPECT_RESULT,void 0,new G(M.UNEXPECTED_RESPONSE,d.code+"","There is an unexpected data on message"))}else n.emit(Jn.INSPECT_RESULT,void 0,new G(M.UNEXPECTED_RESPONSE,d.code+"",d.msg))}else w.error("[".concat(n._inspectId,"] Unexpected message type from worker")),n.emit(Jn.INSPECT_RESULT,void 0,new G(M.UNEXPECTED_RESPONSE,"invalid worker message type"))});return function(s){return r.apply(this,arguments)}}()),this.workerConnection.on(Me.CLOSED,()=>{this.connectionState=Uo.CLOSED}),this.workerConnection.on(Me.FAILED,()=>{this.connectionState=Uo.CLOSED}),this.workerConnection.on(Me.RECONNECTING,()=>{this.connectionState=this.connectionState===Uo.CONNECTED?Uo.RECONNECTING:Uo.CONNECTING}),this.workerConnection.on(Me.WILL_RECONNECT,(r,s,c)=>{"recover"===r&&c(r),c("tryNext")}),this.workerConnection.on(Me.REQUEST_NEW_URLS,(r,s)=>{this.workerManagerConnection.close(),this.once(Jn.REQUEST_NEW_WORKER_URL,c=>{r([c])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(c=>{this.connectWorkerManager(c,!0)}).catch(c=>{s(c)})})}static intToLong(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}requestToInspectImage(){var n=this;return x(function*(){n.sequence++;const r=hr(n,Jn.CLIENT_LOCAL_VIDEO_TRACK),s={appId:n._connectInfo.appId,cname:n._connectInfo.cname,cid:n._connectInfo.cid,sid:n._connectInfo.sid,uid:n._connectInfo.uid,vid:n._connectInfo.vid};if(r){if(!r.isPlaying)return void n.emit(Jn.INSPECT_RESULT,void 0,new G(M.INVALID_OPERATION,"Only the track being played can be inspected"));const c=yield n.generateRequestData(r,s);n.workerConnection.sendMessage(c,!0,!0)}else n.emit(Jn.INSPECT_RESULT,void 0,new G(M.INVALID_OPERATION,"Only the track being published can be inspected"))})()}generateRequestData(n,r){var s=this;return x(function*(){let{appId:c,cname:d,cid:h,vid:p,sid:m,uid:_}=r;const g=Date.now(),v=yield n.getCurrentFrameImage("image/jpeg",s.quality),b=yield wC(v,c,d),C=s.sequence+"-"+h+"-"+_+"-"+g+"-"+It(12,""),N={appId:c,cid:h,cname:d,deviceId:"",elapse:ym.intToLong(Number(g-s.inspectStartTime)),fileSize:b.byteLength,jpgEncryption:2,height:v.height,width:v.width,jpg:b,networkType:6,osType:7,requestId:C,sdkVersion:"4.19.1",sequence:s.sequence,sid:m,timestamp:ym.intToLong(g),uid:_,vid:p,service:s._inspectMode,callbackData:s.extraInfo,ossFilePrefix:s.ossFilePrefix};void 0===s.extraInfo&&delete N.callbackData,void 0===s.ossFilePrefix&&delete N.ossFilePrefix;const P=function IL(o){let n=XO();return function(r,s){let c=r.appId;void 0!==c&&(St(s,10),Js(s,c));let d=r.cid;void 0!==d&&(St(s,16),St(s,d));let h=r.cname;void 0!==h&&(St(s,26),Js(s,h));let p=r.deviceId;void 0!==p&&(St(s,34),Js(s,p));let m=r.elapse;void 0!==m&&(St(s,40),qd(s,m));let _=r.fileSize;void 0!==_&&(St(s,48),qd(s,Yh(_)));let g=r.height;void 0!==g&&(St(s,56),qd(s,Yh(g)));let v=r.jpg;void 0!==v&&(St(s,66),St(s,v.length),function(bt,ne){let ae=ul(bt,ne.length);bt.bytes.set(ne,ae)}(s,v));let b=r.networkType;void 0!==b&&(St(s,72),qd(s,Yh(b)));let C=r.osType;void 0!==C&&(St(s,80),qd(s,Yh(C)));let N=r.requestId;void 0!==N&&(St(s,90),Js(s,N));let P=r.sdkVersion;void 0!==P&&(St(s,98),Js(s,P));let D=r.sequence;void 0!==D&&(St(s,104),qd(s,Yh(D)));let k=r.sid;void 0!==k&&(St(s,114),Js(s,k));let V=r.timestamp;void 0!==V&&(St(s,120),qd(s,V));let U=r.uid;void 0!==U&&(St(s,128),St(s,U));let Y=r.vid;void 0!==Y&&(St(s,136),St(s,Y));let oe=r.width;void 0!==oe&&(St(s,144),qd(s,Yh(oe)));let K=r.service;void 0!==K&&(St(s,152),St(s,K));let X=r.callbackData;void 0!==X&&(St(s,162),Js(s,X));let $=r.jpgEncryption;void 0!==$&&(St(s,168),St(s,$));let J=r.requestType;void 0!==J&&(St(s,176),St(s,J));let ve=r.scorePorn;void 0!==ve&&(St(s,185),ST(s,ve));let ye=r.scoreSexy;void 0!==ye&&(St(s,193),ST(s,ye));let Ye=r.scoreNeutral;void 0!==Ye&&(St(s,201),ST(s,Ye));let ut=r.scene;void 0!==ut&&(St(s,208),St(s,ut));let yt=r.ossFilePrefix;void 0!==yt&&(St(s,218),Js(s,yt));let lt=r.serviceVendor;if(void 0!==lt)for(let bt of lt){St(s,226);let ne=XO();cV(bt,ne),St(s,ne.limit),AL(s,ne),JO(ne)}}(o,n),function(r){let s=r.bytes,c=r.limit;return s.length===c?s:s.subarray(0,c)}(n)}(N);if(P.byteLength<s.workerMessageLengthLimit){if(B("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const D=function(k){for(var V=1;V<arguments.length;V++){var U=null!=arguments[V]?arguments[V]:{};V%2?DL(Object(U),!0).forEach(function(Y){S(k,Y,U[Y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(U)):DL(Object(U)).forEach(function(Y){Object.defineProperty(k,Y,Object.getOwnPropertyDescriptor(U,Y))})}return k}({},N);delete D.jpg,w.debug("[".concat(s._inspectId,"] Request message for worker of inspect content "),JSON.stringify(D))}return P}return s.quality=s.quality*s.qualityRatio,yield s.generateRequestData(n,{appId:c,cname:d,cid:h,vid:p,sid:m,uid:_})})()}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Tr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Uo.CLOSED,this.emit(Jn.STATE_CHANGE,Vo.CLOSED)}}function tN(o,n){switch(n){case 0:for(;128&fr(o););break;case 2:CT(o,Jh(o));break;case 5:CT(o,4);break;case 1:CT(o,8);break;default:throw new Error("Unimplemented type: "+n)}}function $h(o){return{low:o|=0,high:o>>31,unsigned:o>=0}}let uV=[];function CT(o,n){if(o.offset+n>o.limit)throw new Error("Skip past limit");o.offset+=n}function hV(o){return o.offset>=o.limit}function TT(o,n){let r=o.bytes,s=o.offset,c=o.limit,d=s+n;if(d>r.length){let h=new Uint8Array(2*d);h.set(r),o.bytes=h}return o.offset=d,d>c&&(o.limit=d),s}function nN(o,n){let r=o.offset;if(r+n>o.limit)throw new Error("Read past limit");return o.offset+=n,r}function wv(o,n){let r=TT(o,n.length);o.bytes.set(n,r)}function sr(o,n){let r=nN(o,n),s=String.fromCharCode,c=o.bytes,d="\ufffd",h="";for(let p=0;p<n;p++){let m,_,g,v,b=c[p+r];128&b?192==(224&b)?p+1>=n?h+=d:(m=c[p+r+1],128!=(192&m)?h+=d:(v=(31&b)<<6|63&m,v<128?h+=d:(h+=s(v),p++))):224==(240&b)?p+2>=n?h+=d:(m=c[p+r+1],_=c[p+r+2],32896!=(49344&(m|_<<8))?h+=d:(v=(15&b)<<12|(63&m)<<6|63&_,v<2048||v>=55296&&v<=57343?h+=d:(h+=s(v),p+=2))):240==(248&b)?p+3>=n?h+=d:(m=c[p+r+1],_=c[p+r+2],g=c[p+r+3],8421504!=(12632256&(m|_<<8|g<<16))?h+=d:(v=(7&b)<<18|(63&m)<<12|(63&_)<<6|63&g,v<65536||v>1114111?h+=d:(v-=65536,h+=s(55296+(v>>10),56320+(1023&v)),p+=3))):h+=d:h+=s(b)}return h}function Xh(o,n){let r=n.length,s=0;for(let h=0;h<r;h++){let p=n.charCodeAt(h);p>=55296&&p<=56319&&h+1<r&&(p=(p<<10)+n.charCodeAt(++h)-56613888),s+=p<128?1:p<2048?2:p<65536?3:4}pn(o,s);let c=TT(o,s),d=o.bytes;for(let h=0;h<r;h++){let p=n.charCodeAt(h);p>=55296&&p<=56319&&h+1<r&&(p=(p<<10)+n.charCodeAt(++h)-56613888),p<128?d[c++]=p:(p<2048?d[c++]=p>>6&31|192:(p<65536?d[c++]=p>>12&15|224:(d[c++]=p>>18&7|240,d[c++]=p>>12&63|128),d[c++]=p>>6&63|128),d[c++]=63&p|128)}}function fr(o){return o.bytes[nN(o,1)]}function wT(o,n){let r=TT(o,1);o.bytes[r]=n}function Jh(o){let n,r=0,s=0;do{n=fr(o),r<32&&(s|=(127&n)<<r),r+=7}while(128&n);return s}function pn(o,n){for(n>>>=0;n>=128;)wT(o,127&n|128),n>>>=7;wT(o,n)}function NL(o,n){let r,s=0,c=0,d=0;return r=fr(o),s=127&r,128&r&&(r=fr(o),s|=(127&r)<<7,128&r&&(r=fr(o),s|=(127&r)<<14,128&r&&(r=fr(o),s|=(127&r)<<21,128&r&&(r=fr(o),c=127&r,128&r&&(r=fr(o),c|=(127&r)<<7,128&r&&(r=fr(o),c|=(127&r)<<14,128&r&&(r=fr(o),c|=(127&r)<<21,128&r&&(r=fr(o),d=127&r,128&r&&(r=fr(o),d|=(127&r)<<7))))))))),{low:s|c<<28,high:c>>>4|d<<24,unsigned:n}}function Go(o,n){let r=n.low>>>0,s=(n.low>>>28|n.high<<4)>>>0,c=n.high>>>24,d=0===c?0===s?r<16384?r<128?1:2:r<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:c<128?9:10,h=TT(o,d),p=o.bytes;switch(d){case 10:p[h+9]=c>>>7&1;case 9:p[h+8]=9!==d?128|c:127&c;case 8:p[h+7]=8!==d?s>>>21|128:s>>>21&127;case 7:p[h+6]=7!==d?s>>>14|128:s>>>14&127;case 6:p[h+5]=6!==d?s>>>7|128:s>>>7&127;case 5:p[h+4]=5!==d?128|s:127&s;case 4:p[h+3]=4!==d?r>>>21|128:r>>>21&127;case 3:p[h+2]=3!==d?r>>>14|128:r>>>14&127;case 2:p[h+1]=2!==d?r>>>7|128:r>>>7&127;case 1:p[h]=1!==d?128|r:127&r}}const bm={},hl={},Sm=4294967296,Qh=Sm*Sm,Iv=Qh/2,IT=Xr(0,!0),iN=Xr(0),pV=ze(0,-2147483648,!1),pl=ze(-1,2147483647,!1),RT=ze(-1,-1,!0);function Xr(o,n){let r,s,c;return n?(c=0<=(o>>>=0)&&o<256)&&(s=hl[o],s)?s:(r=ze(o,0,!0),c&&(hl[o]=r),r):(c=-128<=(o|=0)&&o<128)&&(s=bm[o],s)?s:(r=ze(o,o<0?-1:0,!1),c&&(bm[o]=r),r)}function ze(o,n,r){return{low:0|o,high:0|n,unsigned:!!r}}function fV(o,n){if(isNaN(o))return n?IT:iN;if(n){if(o<0)return IT;if(o>=Qh)return RT}else{if(o<=-Iv)return pV;if(o+1>=Iv)return pl}return o<0?n?IT:iN:ze(o%Sm|0,o/Sm|0,n)}function PL(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}class rN extends Yt{get connectionState(){return this._connectionState}set connectionState(n){if(this._connectionState===n)return;const r=this._connectionState;this._connectionState=n,this.emit(uo.CONNECTION_STATE_CHANGE,n,r)}get quality(){return this._quality}set quality(n){this._quality=n>1?1:n<.1?.1:n,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(n){var r;super(),S(this,"name","AgoraRTCImageModeration"),S(this,"_connectionState",Kr.CONNECTING),S(this,"_sequence",0),S(this,"_moderationStartTime",void 0),S(this,"_workerConnection",void 0),S(this,"_workerMessageLengthLimit",void 0),S(this,"_qualityRatio",void 0),S(this,"_connectInfo",void 0),S(this,"_cancelTokenSource",Tr.CancelToken.source()),S(this,"_retryConfig",void 0),S(this,"_moderationInterval",void 0),S(this,"_moderationTimer",null),S(this,"_moderationMode",1),S(this,"_quality",1),S(this,"_qualityTimer",null),S(this,"_ticket",void 0),S(this,"_moderationIntervalMinimum",void 0),S(this,"_uploadFailedNum",0),S(this,"_uploadNum",0),S(this,"_uploadTimer",null),S(this,"_moderationId",void 0),S(this,"inspectImage",()=>{if(this.connectionState!==Kr.CONNECTED)throw new G(M.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Kr.CONNECTED?this.requestToInspectImage():w.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=It(5,"image-moderation-"),this._workerMessageLengthLimit=B("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=B("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(r=n.interval)&&void 0!==r?r:1e3,this._qualityRatio=B("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new $c("worker-"+this._moderationId,bn),this.on(uo.STATE_CHANGE,(s,c)=>{w.debug("[".concat(this._moderationId,"] Moderation operation :").concat(ho[s]," ").concat(c||""))}),this.handleWorkerEvents()}init(n,r){var s=this;return x(function*(){s.emit(uo.STATE_CHANGE,ho.CONNECT_AP),s._connectInfo=n;const c=s._cancelTokenSource.token;return s._retryConfig=r,new z((d,h)=>{s.on(uo.CONNECTION_STATE_CHANGE,(p,m)=>{p===Kr.CONNECTED&&d()}),s.requestAP(n,c,r).then(p=>{s.connectWorker(p)}).catch(p=>{h(p)})})})()}updateConfig(n){var r;this._moderationInterval=null!==(r=n.interval)&&void 0!==r?r:1e3,w.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(n))),this.connectionState===Kr.CONNECTED&&this.inspectImage()}requestAP(n,r,s){var c=this;return x(function*(){const d=B("WEBCS_DOMAIN").map(_=>"https://".concat(_,"/api/v1")),h=yield function(_,g,v,b){let{appId:C,areaCode:N,cname:P,sid:D,token:k,uid:V}=g;Vd++;const U="moderation_plugin",Y={service_name:U,json_body:JSON.stringify({appId:C,areaCode:N,cname:P,command:"allocateEdge",requestId:Vd,seq:Vd,sid:D,appToken:k,ts:Date.now(),uid:V+""})};let oe,K,X=_[0];return Ws(x(function*(){oe=Date.now();const $=yield Ss(X,{data:Y,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(K=Date.now()-oe,0!==$.code){const ye=new G(M.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+$.code,{retry:!0,responseTime:K});throw w.error(ye.toString()),ye}const J=JSON.parse($.json_body);if(200!==J.code){const ye=new G(M.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(J.code,", reason: ").concat(J.reason),{code:J.code,responseTime:K});throw w.error(ye.toString()),ye}if(!J.servers||!Array.isArray(J.servers)||0===J.servers.length){const ye=new G(M.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:J.code,responseTime:K});throw w.error(ye.toString()),ye}if(!J.servers.some(ye=>!!ye.wss)){const ye=new G(M.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:J.code,responseTime:K});throw w.error(ye.toString()),ye}const ve=B("IMAGE_MODERATION_WORKER_HOST");return{addressList:J.servers.map(ye=>{let{address:Ye,wss:ut}=ye;if(Ye&&ut)return"wss://".concat(Ye.replace(/\./g,"-"),".").concat(ve,":").concat(ut,"/moderation")}).filter(ye=>!!ye),workerToken:J.workerToken,vid:J.vid,ticket:J.appTicket,responseTime:K}}),($,J)=>(Se.apworkerEvent(D,{success:!0,sc:200,serviceName:U,responseDetail:JSON.stringify($.addressList),firstSuccess:0===J,responseTime:K,serverIp:_[J%_.length]}),!1),($,J)=>(Se.apworkerEvent(D,{success:!1,sc:$.data&&$.data.code||200,serviceName:U,responseTime:K,serverIp:_[J%_.length]}),!!($.code!==M.OPERATION_ABORTED&&$.code!==M.UNEXPECTED_RESPONSE||$.data&&$.data.retry)&&(X=_[(J+1)%_.length],!0)),b)}(d,n,r,s);c.emit(uo.STATE_CHANGE,ho.AP_CONNECTED);const{addressList:p,ticket:m}=h;return c._ticket=m,p})()}connectWorker(n){var r=this;return x(function*(){r.emit(uo.STATE_CHANGE,ho.CONNECT_WORKER),yield r._workerConnection.init(n,1e4)})()}handleWorkerEvents(){var n=this;this._workerConnection.on(Me.CONNECTED,x(function*(){n.emit(uo.STATE_CHANGE,ho.WORKER_CONNECTED,n._workerConnection.url),n.connectionState=Kr.CONNECTED})),this._workerConnection.on(Me.CLOSED,()=>{this.connectionState=Kr.CLOSED}),this._workerConnection.on(Me.FAILED,()=>{this.connectionState=Kr.CLOSED}),this._workerConnection.on(Me.RECONNECTING,()=>{this.connectionState=this.connectionState===Kr.CONNECTED?Kr.RECONNECTING:Kr.CONNECTING}),this._workerConnection.on(Me.ON_MESSAGE,function(){var r=x(function*(s){if(s.data instanceof ArrayBuffer){const c=function dV(o){return function(r){let s={};e:for(;!hV(r);){let c=Jh(r);switch(c>>>3){case 0:break e;case 1:s.code=Jh(r);break;case 2:s.msg=sr(r,Jh(r));break;case 3:s.requestId=sr(r,Jh(r));break;case 4:s.timestamp=NL(r,!1);break;default:tN(r,7&c)}}return s}({bytes:n=o,offset:0,limit:n.length});var n}(new Uint8Array(s.data));B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&w.debug("[".concat(n._moderationId,"] Response message for worker of image moderation "),JSON.stringify(c)),n._uploadNum++,void 0===c.code||0===c.code||(n._uploadFailedNum++,w.error("[".concat(n._moderationId,"] Error response from worke, code is ").concat(c.code,", msg is ").concat(c.msg)),n._uploadTimer||(n._uploadTimer=window.setTimeout(()=>{Se.reportApiInvoke(n._connectInfo.sid||null,{name:Vn.IMAGE_MODERATION_UPLOAD,options:[n._uploadFailedNum,n._uploadNum,c.code],tag:dn.TRACER}).onError(new G(M.IMAGE_MODERATION_UPLOAD_FAILED,c.msg)),n._uploadTimer=null},B("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else w.error("[".concat(n._moderationId,"] Unexpected message type from worker"))});return function(s){return r.apply(this,arguments)}}()),this._workerConnection.on(Me.WILL_RECONNECT,(r,s,c)=>{"recover"===r&&c(r),c("tryNext")}),this._workerConnection.on(Me.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}static intToLong(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}requestToInspectImage(){var n=this;return x(function*(){const r=hr(n,uo.CLIENT_LOCAL_VIDEO_TRACK),s={appId:n._connectInfo.appId,cname:n._connectInfo.cname,cid:n._connectInfo.cid,sid:n._connectInfo.sid,uid:n._connectInfo.uid,vid:n._connectInfo.vid};if(r){if(!r.isPlaying)return void(B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&w.debug("Only the track being played can be inspected"));n._sequence++;const c=yield n.generateRequestData(r,s);n._workerConnection.sendMessage(c,!0,!0)}else B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&w.debug("Only the track being published can be inspected")})()}generateRequestData(n,r){var s=this;return x(function*(){let{appId:c,cname:d,cid:h,vid:p,sid:m,uid:_}=r;const g=Date.now(),v=yield n.getCurrentFrameImage("image/jpeg",s.quality),b=yield wC(v,c,d),C=s._sequence+"-"+h+"-"+_+"-"+g+"-"+It(12,""),N={appId:c,cid:h,cname:d,deviceId:"",elapse:rN.intToLong(Number(g-s._moderationStartTime)),fileSize:v.buffer.byteLength,height:v.height,width:v.width,jpg:b,networkType:6,osType:7,requestId:C,sdkVersion:"4.19.1",sequence:s._sequence,sid:m,timestamp:fV(g),uid:_,vid:p,service:s._moderationMode,ticket:s._ticket},P=function lV(o){let n=function(){const r=uV.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(r,s){let c=r.appId;void 0!==c&&(pn(s,10),Xh(s,c));let d=r.cid;void 0!==d&&(pn(s,16),pn(s,d));let h=r.cname;void 0!==h&&(pn(s,26),Xh(s,h));let p=r.deviceId;void 0!==p&&(pn(s,34),Xh(s,p));let m=r.elapse;void 0!==m&&(pn(s,40),Go(s,m));let _=r.fileSize;void 0!==_&&(pn(s,48),Go(s,$h(_)));let g=r.height;void 0!==g&&(pn(s,56),Go(s,$h(g)));let v=r.jpg;void 0!==v&&(pn(s,66),pn(s,v.length),wv(s,v));let b=r.networkType;void 0!==b&&(pn(s,72),Go(s,$h(b)));let C=r.osType;void 0!==C&&(pn(s,80),Go(s,$h(C)));let N=r.requestId;void 0!==N&&(pn(s,90),Xh(s,N));let P=r.sdkVersion;void 0!==P&&(pn(s,98),Xh(s,P));let D=r.sequence;void 0!==D&&(pn(s,104),Go(s,$h(D)));let k=r.sid;void 0!==k&&(pn(s,114),Xh(s,k));let V=r.timestamp;void 0!==V&&(pn(s,120),Go(s,V));let U=r.uid;void 0!==U&&(pn(s,128),pn(s,U));let Y=r.vid;void 0!==Y&&(pn(s,136),pn(s,Y));let oe=r.width;void 0!==oe&&(pn(s,144),Go(s,$h(oe)));let K=r.service;void 0!==K&&(pn(s,152),pn(s,K));let X=r.callbackData;void 0!==X&&(pn(s,162),pn(s,X.length),wv(s,X));let $=r.ticket;void 0!==$&&(pn(s,170),Xh(s,$))}(o,n),function(r){let s=r.bytes,c=r.limit;return s.length===c?s:s.subarray(0,c)}(n)}(N);if(P.byteLength<s._workerMessageLengthLimit){if(B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const D=function(k){for(var V=1;V<arguments.length;V++){var U=null!=arguments[V]?arguments[V]:{};V%2?PL(Object(U),!0).forEach(function(Y){S(k,Y,U[Y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(U)):PL(Object(U)).forEach(function(Y){Object.defineProperty(k,Y,Object.getOwnPropertyDescriptor(U,Y))})}return k}({},N);delete D.jpg,w.debug("[".concat(s._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(D))}return P}return s.quality=s.quality*s._qualityRatio,yield s.generateRequestData(n,{appId:c,cname:d,cid:h,vid:p,sid:m,uid:_})})()}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Tr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Kr.CLOSED,this.emit(uo.STATE_CHANGE,ho.CLOSED)}}function ML(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function AT(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?ML(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):ML(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}class ar extends mD{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var n,r;return null!==(n=null===(r=this.peerConnection.getReceivers()[0])||void 0===r||null===(r=r.transport)||void 0===r?void 0:r.state)&&void 0!==n?n:null}constructor(n,r,s){super(n,r),S(this,"direction",void 0),S(this,"store",void 0),S(this,"peerConnection",void 0),S(this,"transportEventReceiver",void 0),S(this,"statsFilter",void 0),S(this,"localCandidateCount",0),S(this,"allCandidatesReceived",!1),S(this,"mutex",new Wn("P2PConnection-mutex")),S(this,"dataChannel",void 0),S(this,"onLocalCandidate",void 0),this.store=r,this.peerConnection=new RTCPeerConnection(ar.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.direction=s??Kc.SEND_ONLY,this.dataChannel=this.peerConnection.createDataChannel("agora-p2p-signal",{ordered:!0}),this.statsFilter=pv(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,jt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}establish(n){var r=this;return x(function*(){try{if(n){yield r.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=yield r.peerConnection.createAnswer();if(yield r.peerConnection.setLocalDescription(s),!s.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");return s.sdp}{const s=yield r.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");return yield r.peerConnection.setLocalDescription(s),s.sdp}}catch(s){throw new Q(M.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}})()}connect(n){var r=this;return x(function*(){try{yield r.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}})()}addRemoteCandidate(n){var r=this;return x(function*(){try{yield r.peerConnection.addIceCandidate(n)}catch(s){throw new Q(M.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}})()}send(n){var r=this;return x(function*(){try{const s=[];n.forEach(h=>{const p=r.peerConnection.addTransceiver(h._mediaStreamTrack,{direction:"sendonly"});s.push(p)}),jt()&&!0===B("SIMULCAST")&&(yield r.applySimulcastForFirefox(s,n)),yield r.applySimulcastEncodings(s,n),yield r.applySendEncodings(s,n);const c=yield r.peerConnection.createOffer();if(yield r.peerConnection.setLocalDescription(c),!c.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");const d=s.map(h=>{const p=r.getLocalSSRC(h.mid,c.sdp);if(!p)throw new Error("Cannot get ssrc when trying to send PeerConnection.");return{mid:h.mid,localSSRC:[{ssrcId:p}]}});return{sdp:c.sdp,trackMessage:d}}catch(s){throw s instanceof Q?s:new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}})()}stopSending(n,r){var s=this;return x(function*(){const c=r?void 0:yield s.mutex.lock("From P2PConnection.stopSending");try{const d=s.peerConnection.getTransceivers().filter(p=>-1!==n.indexOf(p.mid));if(d.length!==n.length)throw new Error("Transceivers' length (".concat(d.length,") doesn't match mids' length (").concat(n.length,") when trying to call P2PConnection.stopSending."));d.map(p=>{var m;p.direction="inactive",null===(m=p.stop)||void 0===m||m.call(p),s.peerConnection.removeTrack(p.sender)});const h=yield s.peerConnection.createOffer();if(yield s.peerConnection.setLocalDescription(h),!h.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");return h.sdp}catch(d){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(d.toString()))}finally{c&&c()}})()}receive(n,r,s){var c=this;return x(function*(){try{yield c.peerConnection.setRemoteDescription({type:"offer",sdp:r});const d=yield c.peerConnection.createAnswer();if(!d.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");yield c.peerConnection.setLocalDescription(d),w.debug("[".concat(c.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP."));const h=c.getRemoteMid(s,r);if(void 0===h)throw new Error("Cannot get transceiver mid when trying to receive track.");const p=c.peerConnection.getTransceivers().find(m=>m.mid===h);if(!p||null===p.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,mid:p.mid,sdp:d.sdp}}catch(d){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}})()}setDescription(n,r){var s=this;return x(function*(){try{if("remote"===n){yield s.peerConnection.setRemoteDescription({type:"offer",sdp:r});const c=yield s.peerConnection.createAnswer();if(!c.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return yield s.peerConnection.setLocalDescription(c),w.debug("[".concat(s.store.clientId,"] [P2PConnection] exchanging SDP, type is ").concat(n)),c.sdp}yield s.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(c){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.setDescription failed; ".concat(c.toString()))}})()}stopReceiving(n,r){var s=this;return x(function*(){try{const c=s.peerConnection.getTransceivers().filter(h=>-1!==n.indexOf(h.mid));if(c.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(h=>{var p;h.direction="inactive",null===(p=h.stop)||void 0===p||p.call(h)}),yield s.peerConnection.setRemoteDescription({type:"offer",sdp:r});const d=yield s.peerConnection.createAnswer();if(yield s.peerConnection.setLocalDescription(d),!d.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return d.sdp}catch(c){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(c.toString()))}})()}restartICE(){var n=this;return x(function*(){try{const r=yield n.peerConnection.createOffer({iceRestart:!0});if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");return n.store.descriptionStart(),yield n.peerConnection.setLocalDescription(r),r.sdp}catch(r){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}})()}close(){var n;this.peerConnection.close(),null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}updateEncoderConfig(n,r){return x(function*(){})()}updateSendParameters(n,r){var s=this;return x(function*(){const c=s.peerConnection.getTransceivers().filter(d=>d.mid===n);1===c.length&&(s.isVP8Simulcast(r)?jt()||(yield s.applySimulcastEncodings(c,[r])):yield s.applySendEncodings(c,[r]))})()}setStatsRemoteVideoIsReady(n,r){this.statsFilter.setVideoIsReady2(n,r)}replaceTrack(n,r){var s=this;return x(function*(){const c=s.peerConnection.getTransceivers().find(d=>d.mid===r);c&&(yield c.sender.replaceTrack(n._mediaStreamTrack))})()}getSelectedCandidatePair(){var n=this;return x(function*(){const r=n.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:c,remote:d}=s.getSelectedCandidatePair();return{local:AT(AT({},Is),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port}),remote:AT(AT({},Is),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})}}return n.statsFilter.getSelectedCandidatePair()})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;null===(n=this.onICEConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=n=>{var r;n.candidate&&(null===(r=this.onLocalCandidate)||void 0===r||r.call(this,n.candidate)),n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},B("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const r={iceServers:[]};return n.iceServers?r.iceServers=n.iceServers:n.turnServer&&"off"!==n.turnServer.mode&&(ih(n.turnServer.servers)?r.iceServers=n.turnServer.servers:(r.iceServers&&r.iceServers.push(...ar.turnServerConfigToIceServers(n.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&n.turnServer.serversFromGateway&&r.iceServers.push(...ar.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),B("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(r.iceTransportPolicy="relay")}))),B("ENABLE_ENCODED_TRANSFORM")&&Lt().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(n){const r=[];return n.forEach(s=>{s.tcpport&&(r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(KE(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}),r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=udp")}),r.push({username:s.username,credential:s.password,credentialType:"password",urls:"stun:".concat(s.turnServerURL,":").concat(s.tcpport)}))}),r}tryBindTransportEvents(n){const r=n.transport;if(r){this.transportEventReceiver=n,r.onstatechange=()=>{var c;null!=r&&r.state&&(null===(c=this.onDTLSTransportStateChange)||void 0===c||c.call(this,r.state))},r.onerror=c=>{var d;null===(d=this.onDTLSTransportError)||void 0===d||d.call(this,"error"in c?c.error:c)};const s=r.iceTransport;s&&(s.onstatechange=()=>{const c=r?.iceTransport.state;var d;c&&(null===(d=this.onICETransportStateChange)||void 0===d||d.call(this,c))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:c,remote:d}=s.getSelectedCandidatePair();w.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(n,r){var s=this;return x(function*(){var c;if(r||(r=s.peerConnection.getSenders().find(v=>v.track===n._mediaStreamTrack)),!r)return w.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(s.isVP8Simulcast(n))return w.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Lt().supportSetRtpSenderParameters)return w.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(n._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(n._encoderConfig){var p;const{bitrateMax:v,frameRate:b,scaleResolutionDownBy:C}=n._encoderConfig;v&&(h.maxBitrate=1e3*v),Re(p=n._hints).call(p,Vt.LOW_STREAM)&&(b&&(h.maxFramerate=Bo(b)),C&&C>=1&&(h.scaleResolutionDownBy=C))}if(B("DSCP_TYPE")&&cs()){var m;const v=B("DSCP_TYPE");Re(m=["very-low","low","medium","high"]).call(m,v)&&(h.networkPriority=v)}const _=r.getParameters(),g=null===(c=_.encodings)||void 0===c?void 0:c[0];jt()&&!g&&(d.encodings=[h]),g&&Object.assign(g,h),Object.assign(_,d),w.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),yield r.setParameters(_)})()}applySendEncodings(n,r){var s=this;return x(function*(){try{if(!Lt().supportSetRtpSenderParameters||n.length!==r.length)return;for(let c=0;c<n.length;c++){const d=n[c],h=r[c];h instanceof We&&!s.isVP8Simulcast(h)&&(yield s.updateRtpSenderEncodings(h,d.sender))}}catch{w.debug("[".concat(s.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(n,r,s){const c=hn.parse(n);return r.forEach((d,h)=>{const p=s[h],m=c.mediaDescriptions.find(_=>_.attributes.mid===p);m&&(Ts(m,d),Wh(m,d,this.store.codec))}),hn.print(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,r,s)=>{var c;null===(c=this.onFirstVideoDecoded)||void 0===c||c.call(this,n,r,s)},this.statsFilter.onSelectedLocalCandidateChanged=(n,r)=>{var s;null===(s=this.onSelectedLocalCandidateChanged)||void 0===s||s.call(this,n,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,r)=>{var s;null===(s=this.onSelectedRemoteCandidateChanged)||void 0===s||s.call(this,n,r)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var r;null===(r=this.onFirstVideoDecodedTimeout)||void 0===r||r.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(n,r){var s=this;return x(function*(){if(n.length===r.length)for(let _=0;_<n.length;_++){var c,d,h,p,m;const g=n[_],v=r[_];if(v instanceof We&&!Re(c=v._hints).call(c,Vt.LOW_STREAM)&&null!==(d=v._encoderConfig)&&void 0!==d&&d.bitrateMax&&(null===(h=v._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(p=v._scalabilityMode)&&void 0!==p&&p.numSpatialLayers&&(null===(m=v._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===s.store.codec){const b={},C={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{rid:"m",active:!0,maxBitrate:C.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:C.high}];const N=g.sender.getParameters();yield g.sender.setParameters(Object.assign(N,b))}}})()}applySimulcastEncodings(n,r){var s=this;return x(function*(){if(!jt()&&n.length===r.length)for(let c=0;c<n.length;c++){const d=r[c];if(d instanceof We&&s.isVP8Simulcast(d)){const h=n[c],p={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=h.sender.getParameters();yield h.sender.setParameters(Object.assign(_,p))}}})()}isVP8Simulcast(n){var r,s,c,d,h;return!!(n instanceof We&&B("SIMULCAST")&&"vp8"===this.store.codec&&!Re(r=n._hints).call(r,Vt.LOW_STREAM)&&null!==(s=n._encoderConfig)&&void 0!==s&&s.bitrateMax&&(null===(c=n._encoderConfig)||void 0===c?void 0:c.bitrateMax)>200&&null!==(d=n._scalabilityMode)&&void 0!==d&&d.numSpatialLayers&&(null===(h=n._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,r,s,c){if(B("SDP_LOGGING"))return w.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(r," SDP during P2PConnection.").concat(c,"\n"),n),"offer"===r?d=>{this.logSDPExchange(d,"answer","local"===s?"remote":"local",c)}:void 0}getLocalSSRC(n,r){var s,c,d;if(r=null!==(s=r)&&void 0!==s?s:null===(c=this.currentLocalDescription)||void 0===c?void 0:c.sdp)return(null===(d=hn.parse(r).mediaDescriptions.find(p=>p.attributes.mid===n))||void 0===d?void 0:d.attributes.ssrcs)?.[0].ssrcId}getRemoteMid(n,r){var s,c,d;if(r=null!==(s=r)&&void 0!==s?s:null===(c=this.currentRemoteDescription)||void 0===c?void 0:c.sdp)return null===(d=hn.parse(r).mediaDescriptions.find(h=>h.attributes.ssrcs.some(p=>p.ssrcId===n)))||void 0===d?void 0:d.attributes.mid}getRemoteSSRC(n,r){var s=this;return x(function*(){var c,d,h;if(r=null!==(c=r)&&void 0!==c?c:null===(d=s.currentRemoteDescription)||void 0===d?void 0:d.sdp)return(null===(h=hn.parse(r).mediaDescriptions.find(m=>m.attributes.mid===n))||void 0===h?void 0:h.attributes.ssrcs)?.[0].ssrcId})()}}function As(o,n,r){const s=o[n];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return r.value=x(function*(){const c=this.mutex,d=yield c.lock("From P2PConnection.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield s.apply(this,p)}finally{d()}}),r}var Wo;function kL(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function Yd(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?kL(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):kL(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}ee([As,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",z)],ar.prototype,"establish",null),ee([As,O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",z)],ar.prototype,"connect",null),ee([As,O("design:type",Function),O("design:paramtypes",[RTCIceCandidate]),O("design:returntype",z)],ar.prototype,"addRemoteCandidate",null),ee([As,O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],ar.prototype,"send",null),ee([As,O("design:type",Function),O("design:paramtypes",[String,String,Number]),O("design:returntype",z)],ar.prototype,"receive",null),ee([As,O("design:type",Function),O("design:paramtypes",[String,String]),O("design:returntype",z)],ar.prototype,"setDescription",null),ee([As,O("design:type",Function),O("design:paramtypes",[Array,String]),O("design:returntype",z)],ar.prototype,"stopReceiving",null),ee([As,O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",z)],ar.prototype,"restartICE",null),ee([As,O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],ar.prototype,"close",null),ee([As,O("design:type",Function),O("design:paramtypes",[String,Li]),O("design:returntype",z)],ar.prototype,"updateEncoderConfig",null),ee([As,O("design:type",Function),O("design:paramtypes",[String,Li]),O("design:returntype",z)],ar.prototype,"updateSendParameters",null),ee([As,O("design:type",Function),O("design:paramtypes",[Li,String]),O("design:returntype",z)],ar.prototype,"replaceTrack",null),function(o){o.SEND_ONLY="SEND_ONLY",o.RECEIVE_ONLY="RECEIVE_ONLY"}(Wo||(Wo={}));class fn extends Yt{get state(){return this._state}set state(n){const r=this._state;this._state=n,this.emit(Ae.StateChange,r,this._state)}constructor(n,r){var s;super(),s=this,S(this,"store",void 0),S(this,"statsUploader",void 0),S(this,"sendConnection",void 0),S(this,"recvConnection",void 0),S(this,"localTrackMap",new Map),S(this,"remoteUserMap",new Map),S(this,"localDataChannels",[]),S(this,"pendingLocalTracks",[]),S(this,"pendingRemoteTracks",[]),S(this,"statsCollector",void 0),S(this,"dtlsFailedCount",0),S(this,"sendMutex",new Wn("P2PChannel2-send-mutex")),S(this,"recvMutex",new Wn("P2PChannel2-recv-mutex")),S(this,"_state",at.Disconnected),S(this,"_restartStates",["disconnected","failed"]),S(this,"_restartTimer",void 0),S(this,"handleMuteLocalTrack",function(){var c=x(function*(d,h,p){const m=yield s.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!s.sendConnection||s.state!==at.Connected)return void p(new Q(M.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const v=s.filterTobeMutedTracks(d);if(0===v.length)return void h();const b=v.find(U=>"videoLowTrack"===U[0]);b&&b[1].track._originMediaStreamTrack.stop();let C=!1;var _,g;C="video"===d.trackMediaType?!(null===(_=s.localTrackMap.get(te.LocalAudioTrack))||void 0===_||!_.track._muted):void 0===(null===(g=s.localTrackMap.get(te.LocalVideoTrack))||void 0===g?void 0:g.id);const N=v.filter(U=>{let[Y,oe]=U;return(Y!==te.LocalAudioTrack||C)&&void 0!==oe.id}).map(U=>{let[,Y]=U;return Y});let P;N.length>0&&(P=yield s.sendConnection.stopSending(N.map(U=>U.id)),N.forEach(U=>{U.id=void 0,U.ssrcs=void 0}));const D=s.createMuteMessage(v),k="video"===d.trackMediaType?fs.MUTE_LOCAL_VIDEO:fs.MUTE_LOCAL_AUDIO,V=yield Qt(s,Ae.RequestP2PMuteLocal,{action:k,sdp:P,message:D,isMuteAll:C});V&&(yield s.sendConnection.setDescription("local",V)),(P||"audio"===d.trackMediaType)&&(yield Mt(s,Ae.RequestMuteLocal,D)),h()}catch(v){p(v)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),S(this,"handleUnmuteLocalTrack",function(){var c=x(function*(d,h,p){const m=yield s.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!s.sendConnection||s.state!==at.Connected)return void p(new Q(M.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const _=s.filterTobeUnmutedTracks(d);if(0===_.length)return void h();const g=s.createUnmuteMessage(_),v="video"===d.trackMediaType?fs.UNMUTE_LOCAL_VIDEO:fs.UNMUTE_LOCAL_AUDIO;yield Mt(s,Ae.RequestP2PMuteLocal,{action:v,message:g}),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),S(this,"handleUpdateVideoEncoder",function(){var c=x(function*(d,h,p){const m=yield s.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const _=s.localTrackMap.get(te.LocalVideoTrack);if(!s.sendConnection||!_||_.track!==d||s.state!==at.Connected)return void h();const{id:g,track:v}=_;g&&(yield s.sendConnection.updateSendParameters(g,v),yield s.sendConnection.updateEncoderConfig(g,v),s.emit(Ae.UpdateVideoEncoder,v)),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),S(this,"handleSetOptimizationMode",function(){var c=x(function*(d,h,p){const m=yield s.sendMutex.lock("Locking from P2PChannel2.handleSetOptimizationMode");try{const _=s.localTrackMap.get(te.LocalVideoTrack);if(!s.sendConnection||!_||_.track!==d||s.state!==at.Connected)return;const{id:g,track:v}=_;g&&(yield s.sendConnection.updateSendParameters(g,v)),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),S(this,"handleReplaceTrack",function(){var c=x(function*(d,h,p,m){let _;w.debug("[".concat(s.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(d.getTrackId(),"]")),"boolean"==typeof m&&m||(_=yield s.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var g;const b=Array.from(s.localTrackMap.entries()).find(C=>{let[,{track:N}]=C;return d===N});if(!s.sendConnection||!b||void 0===b[1].id||s.state!==at.Connected)return void h();if(yield null===(g=s.sendConnection)||void 0===g?void 0:g.replaceTrack(d,b[1].id),b[0]===te.LocalVideoTrack&&Lt().supportDualStreamEncoding){const C=s.localTrackMap.get(te.LocalVideoLowTrack);if(C){const N=d._mediaStreamTrack.clone();C.track._originMediaStreamTrack.stop(),C.track._mediaStreamTrack=N,C.track._originMediaStreamTrack=N,yield new z((P,D)=>{s.handleReplaceTrack(C.track,P,D,!0)})}}h()}catch(b){p(b)}finally{var v;null===(v=_)||void 0===v||v()}});return function(d,h,p,m){return c.apply(this,arguments)}}()),S(this,"handleGetLocalVideoStats",c=>{c(this.statsCollector.getLocalVideoTrackStats())}),S(this,"handleGetLocalAudioStats",c=>{c(this.statsCollector.getLocalAudioTrackStats())}),S(this,"handleGetRemoteVideoStats",c=>this.statsCollector.getRemoteVideoTrackStats(c.uid)[c.uid]),S(this,"handleGetRemoteAudioStats",c=>this.statsCollector.getRemoteAudioTrackStats(c.uid)[c.uid]),this.store=n,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new KO,this.bindStatsUploaderEvents()}startP2PConnection(n,r){return x(function*(){throw new Q(M.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")})()}connect(n,r,s,c,d,h){return x(function*(){throw new Q(M.NOT_SUPPORTED,"p2p mode does not support connect.")})()}startP2P(n,r){var s=this;return x(function*(){if(s.state=at.New,s.sendConnection&&(w.warning("[".concat(s.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),s.sendConnection.close(),s.unbindConnectionEvents(s.sendConnection)),s.recvConnection&&(w.warning("[".concat(s.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),s.recvConnection.close(),s.unbindConnectionEvents(s.recvConnection)),s.sendConnection=new ar(n,s.store),s.bindConnectionEvents(s.sendConnection),s.recvConnection=new ar(n,s.store,Kc.RECEIVE_ONLY),s.bindConnectionEvents(s.recvConnection),r){s.store.peerConnectionStart(),yield s.recvConnection.establish(r);const c=yield s.sendConnection.establish(r);return s.statsUploader.startUploadTransportStats(!0),s.statsUploader.startUploadExtensionUsageStats(),s.state=at.Connected,c}return yield s.recvConnection.establish(r),s.sendConnection.establish(r)})()}p2pConnect(n){var r=this;return x(function*(){if(!r.sendConnection||!r.recvConnection)throw new Q(M.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.startP2PConnection .");r.store.peerConnectionStart(),yield r.recvConnection.connect(n),yield r.sendConnection.connect(n),r.statsUploader.startUploadTransportStats(),r.statsUploader.startUploadExtensionUsageStats(),r.state=at.Connected})()}addRemoteCandidate(n){var r=this;return x(function*(){if(!r.sendConnection||!r.recvConnection)throw new Q(M.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");yield r.recvConnection.addRemoteCandidate(n),yield r.sendConnection.addRemoteCandidate(n)})()}publish(n,r,s){var c=this;return x(function*(){if(!c.sendConnection||c.state!==at.Connected){c.throwIfTrackTypeNotMatch(n);const p=n.filter(m=>-1===c.pendingLocalTracks.indexOf(m));return void(c.pendingLocalTracks=c.pendingLocalTracks.concat(p))}c.store.pubId=c.store.pubId+1,vi.markPublishStart(c.store.clientId,c.store.pubId);const d=c.filterTobePublishedTracks(n,r,s);if(0===d.length)return void(yield c.tryToUnmuteAudio(n));d.forEach(p=>{let{track:m,type:_}=p;const g=Date.now();c.store.publish(m.getTrackId(),_===te.LocalAudioTrack?"audio":"video",g)}),c.bindLocalTrackEvents(d);const h=c.createGatewayPublishMessage(d);return c.assignLocalTracks(d),d.forEach(p=>{let{track:m,type:_}=p;const g=Date.now();c.store.publish(m.getTrackId(),_===te.LocalAudioTrack?"audio":"video",void 0,g)}),h})()}dopublish(n){var r=this;return x(function*(){if(!r.sendConnection||r.state!==at.Connected)return;const s=r.localTrackMap.get(n);if(s){const{sdp:c,trackMessage:d}=yield r.sendConnection.send([s.track]),{mid:h,localSSRC:p}=d[0];s.id=h,s.ssrcs=p,r.statsCollector.addLocalStats(n),r.statsUploader.startUploadUplinkStats();const m=yield Qt(r,Ae.RequestP2PPublish,{kind:n===te.LocalAudioTrack?ge.AUDIO:ge.VIDEO,sdp:c,ssrcId:p[0].ssrcId});yield r.sendConnection.setDescription("local",m);const _=r.createUnmuteMessage([[n,s]]);yield Mt(r,Ae.RequestUnmuteLocal,_)}})()}setDescription(n,r){var s=this;return x(function*(){let c,d;"local"===n?(c=yield s.sendMutex.lock("From P2PChannel.restartICE"),d=s.sendConnection):(c=yield s.recvMutex.lock("From P2PChannel.restartICE"),d=s.recvConnection);try{return d&&s.state===at.Connected?yield d.setDescription(n,r):void 0}finally{c()}})()}publishLowStream(n){return Yr(function*(){throw new Q(M.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}republish(){var n=this;return x(function*(){n.pendingLocalTracks.length>0&&(w.debug("[".concat(n.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield Qt(n,Ae.RequestRePublish,n.pendingLocalTracks),n.emit(Ae.MediaReconnectEnd,n.store.uid),n.pendingLocalTracks=[])})()}unpublish(n){var r=this;return x(function*(){if(!r.sendConnection||r.state!==at.Connected)return void(0===n.length?r.pendingLocalTracks.length=0:r.pendingLocalTracks=r.pendingLocalTracks.filter(_=>!Re(n).call(n,_)));const s=r.filterTobeUnpublishedTracks(n);if(0===s.length)return;r.unbindLocalTrackEvents(s.map(_=>{let[g,{track:v}]=_;return{type:g,track:v}}));const c=s.filter(_=>{let[,{id:g}]=_;return void 0!==g});if(!r.sendConnection||r.state!==at.Connected)return void n.forEach(_=>{const g=r.pendingLocalTracks.indexOf(_);-1!==g&&r.pendingLocalTracks.splice(g,1)});const d=s.find(_=>"videoLowTrack"===_[0]);let h;d&&d[1].track.close();const p=r.createGatewayUnpublishMessage(s);c.length>0&&(h=yield r.sendConnection.stopSending(c.map(_=>{let[,{id:g}]=_;return g}))),r.withdrawLocalTracks(s),r.unbindLocalTrackEvents(s.map(_=>{let[g,{track:v}]=_;return{type:g,track:v}})),s.forEach(_=>{let[g]=_;r.statsCollector.removeLocalStats(g)}),0===r.localTrackMap.size&&r.statsUploader.stopUploadUplinkStats();const m=r.createMuteMessage(s);return yield z.all(m.map(function(){var _=x(function*(g){yield Mt(r,Ae.RequestMuteLocal,[g])});return function(g){return _.apply(this,arguments)}}())),{sdp:h,unpubMsg:p}})()}unpublishLowStream(){return x(function*(){throw new Q(M.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")})()}doUnpublish(n){var r=this;return x(function*(){if(!r.sendConnection||r.state!==at.Connected)return;const s=[];if(n!==ge.AUDIO){const c=r.localTrackMap.get(te.LocalVideoTrack);void 0!==c?.id&&s.push([te.LocalVideoTrack,c]);const d=r.localTrackMap.get(te.LocalVideoLowTrack);void 0!==d?.id&&s.push([te.LocalVideoLowTrack,d]),r.statsCollector.removeLocalStats(te.LocalVideoTrack),r.statsCollector.removeLocalStats(te.LocalVideoLowTrack)}if(n!==ge.VIDEO){const c=r.localTrackMap.get(te.LocalAudioTrack);void 0!==c?.id&&s.push([te.LocalAudioTrack,c]),r.statsCollector.removeLocalStats(te.LocalAudioTrack)}if(s.length>0){const c=yield r.sendConnection.stopSending(s.map(p=>{let[,m]=p;return m.id}));s.forEach(p=>{let[,m]=p;m.id=void 0,m.ssrcs=void 0});const d=yield Qt(r,Ae.RequestP2PUnPublish,{sdp:c,kind:n});yield r.sendConnection.setDescription("local",d);const h=r.createMuteMessage(s);yield z.all(h.map(function(){var p=x(function*(m){yield Mt(r,Ae.RequestMuteLocal,[m])});return function(m){return p.apply(this,arguments)}}()))}})()}subscribe(n,r,s,c){var d=this;return x(function*(){var h;if(!d.recvConnection||d.state!==at.Connected)throw new Q(M.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(h=d.remoteUserMap.get(n))&&void 0!==h&&h.has(r))return;const{track:p,mid:m,sdp:_}=yield d.recvConnection.receive(r,s,c);r===ge.AUDIO?(n._audioSSRC=c,n._audioTrack?n._audioTrack._updateOriginMediaStreamTrack(p):(n._audioTrack=new go(p,n.uid,n._uintid,d.store),w.info("[".concat(d.store.clientId,"] [").concat(d.store.p2pId,"] create remote audio track: ").concat(n._audioTrack.getTrackId()))),d.bindRemoteTrackEvents(n,n._audioTrack)):(n._videoSSRC=c,n._videoTrack?n._videoTrack._updateOriginMediaStreamTrack(p):(n._videoTrack=new Ks(p,n.uid,n._uintid,d.store),w.info("[".concat(d.store.clientId,"] [").concat(d.store.p2pId,"] create remote video track: ").concat(n._videoTrack.getTrackId()))),d.bindRemoteTrackEvents(n,n._videoTrack));const g=d.remoteUserMap.get(n);g?g.set(r,m):d.remoteUserMap.set(n,new Map([[r,m]])),d.statsCollector.addRemoteStats(n.uid),d.statsUploader.startUploadDownlinkStats(),yield Mt(d,Ae.RequestP2PUnmuteRemote,r);const v=d.pendingRemoteTracks.findIndex(b=>{let{user:C,kind:N}=b;return C.uid===n.uid&&r===N});return-1!==v&&(d.pendingRemoteTracks.splice(v,1),d.emit(Ae.MediaReconnectEnd,n.uid)),_})()}unsubscribe(n,r,s,c){var d=this;return x(function*(){const h=d.pendingRemoteTracks.filter(_=>{let{user:g,kind:v}=_;return void 0!==s?g.uid===n.uid&&s===v:g.uid===n.uid});if(h.forEach(_=>{const g=d.pendingRemoteTracks.indexOf(_);d.pendingRemoteTracks.splice(g,1)}),d.recvConnection&&d.state===at.Connected||c||h.forEach(_=>{let{kind:g}=_;var v;if(g===ge.AUDIO)null===(v=n._audioTrack)||void 0===v||v._destroy(),n._audioTrack=void 0;else if(g===ge.VIDEO){var b;null===(b=n._videoTrack)||void 0===b||b._destroy(),n._videoTrack=void 0}}),!d.recvConnection||d.state!==at.Connected)return;const p=d.filterTobeUnSubscribedTracks(n,s);if(0===p.length)return void(s!==ge.VIDEO&&Mt(d,Ae.RequestP2PMuteRemote,ge.AUDIO));const m=yield d.recvConnection.stopReceiving(p.map(_=>{let[,{id:g}]=_;return g}),r);return d.withdrawRemoteTracks(p),0===d.remoteUserMap.size&&d.statsUploader.stopUploadDownlinkStats(),p.forEach(_=>{let[g,{kind:v}]=_;var b,C;if(v===ge.VIDEO&&g._videoSSRC&&(null===(b=d.recvConnection)||void 0===b||b.setStatsRemoteVideoIsReady(g._videoSSRC,!1)),v===ge.VIDEO)d.unbindRemoteTrackEvents(g._videoTrack),c||(null===(C=g._videoTrack)||void 0===C||C._destroy(),g._videoTrack=void 0);else if(v===ge.AUDIO){var N;d.unbindRemoteTrackEvents(g._audioTrack),!c&&(null===(N=g._audioTrack)||void 0===N||N._destroy(),g._audioTrack=void 0)}}),p.filter(_=>{let[,{kind:g}]=_;return g!==ge.AUDIO}).forEach(_=>{let[,{kind:g}]=_;Mt(d,Ae.RequestP2PMuteRemote,g)}),s!==ge.VIDEO&&Mt(d,Ae.RequestP2PMuteRemote,ge.AUDIO),m})()}getAllDataChannels(){return this.localDataChannels}massSubscribe(n){return x(function*(){throw new Q(M.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")})()}massSubscribeNoLock(n){return x(function*(){throw new Q(M.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")})()}massUnsubscribe(n){return x(function*(){throw new Q(M.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")})()}massUnsubscribeNoLock(n){return x(function*(){throw new Q(M.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")})()}muteRemote(n,r){var s=this;return x(function*(){if(!s.recvConnection)return;const c=s.remoteUserMap.get(n);if(!c)return void w.warning("[".concat(s.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(n.uid,"."));if(!c.get(r))return void w.warning("[".concat(s.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(n.uid," media type ").concat(r,"."));const d=r===ge.VIDEO?n._videoSSRC:n._audioSSRC;void 0!==d&&s.recvConnection.setStatsRemoteVideoIsReady(d,!1)})()}unmuteRemote(n,r){var s=this;return x(function*(){return s.unmuteRemoteNoLock(n,r)})()}unmuteRemoteNoLock(n,r){var s=this;return x(function*(){if(!s.recvConnection)return;const c=s.remoteUserMap.get(n);c?c.get(r)||w.warning("[".concat(s.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(n.uid," media type ").concat(r,".")):w.warning("[".concat(s.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(n.uid,"."))})()}getAllTracks(n){const r=this.localTrackMap.get(te.LocalAudioTrack);if(r?.track instanceof Dn){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(c=>{let[d]=c;return d!==te.LocalAudioTrack}).filter(c=>{let[d]=c;return!(n&&d===te.LocalVideoLowTrack)}).map(c=>{let[,{track:d}]=c;return d}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[c]=s;return!(n&&c===te.LocalVideoLowTrack)}).map(s=>{let[,{track:c}]=s;return c})}reportPublishEvent(n,r,s,c,d){if(n){const p=this.localTrackMap.get(te.LocalAudioTrack),m=this.localTrackMap.get(c?te.LocalVideoLowTrack:te.LocalVideoTrack);Se.publish(this.store.sessionId,{eventElapse:vi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:r,audioName:p?.track.getTrackLabel(),videoName:m?.track.getTrackLabel(),screenshare:-1!==m?.track._hints.indexOf(Vt.SCREEN_TRACK),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}else{var h;s||(s=[]);const p=s.find(_=>_ instanceof mt),m=c?null===(h=this.localTrackMap.get(te.LocalVideoTrack))||void 0===h?void 0:h.track:s.find(_=>_ instanceof We);Se.publish(this.store.sessionId,{eventElapse:vi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:r,audioName:p?.getTrackLabel(),videoName:m?.getTrackLabel(),screenshare:-1!==m?._hints.indexOf(Vt.SCREEN_TRACK),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}}reportSubscribeEvent(n,r,s,c){const d=c===ge.VIDEO?s._videoSSRC:s._audioSSRC;d&&Se.subscribe(this.store.sessionId,{succ:n,ec:r,video:c===ge.VIDEO,audio:c===ge.AUDIO,peerid:s.uid,subscribeRequestid:c===ge.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:vi.measureFromSubscribeStart(this.store.clientId,d)})}reset(){w.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Wn("P2PChannel2-send-mutex"),this.sendMutex=new Wn("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const n=this.localTrackMap.get(te.LocalAudioTrack);if(n?.track instanceof Dn){if(n.track.trackList.length>0){const r=n.track;n.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}n.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=at.Disconnected}getStats(n){var r,s;return n?null===(s=this.recvConnection)||void 0===s?void 0:s.getStats():null===(r=this.sendConnection)||void 0===r?void 0:r.getStats()}getRemoteVideoIsReady(n){var r;return(null===(r=this.recvConnection)||void 0===r?void 0:r.getRemoteVideoIsReady(n))||!1}getLocalAudioVolume(){const n=this.localTrackMap.get(te.LocalAudioTrack);if(n)return n.track.getVolumeLevel()}getLocalVideoSize(){const n=this.localTrackMap.get(te.LocalVideoTrack);if(n)return{width:n.track._videoWidth||0,height:n.track._videoHeight||0}}getEncoderConfig(n){const r=this.localTrackMap.get(n);return r&&r.track instanceof We||r&&r.track instanceof mt?r.track._encoderConfig:void 0}getLocalMedia(n){return this.localTrackMap.get(n)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(n,r){if(!n)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(n);return!!s&&(!r||s.has(r))}hasRemoteMediaWithLock(n,r){var s=this;return x(function*(){if(!n)return s.remoteUserMap.size>0;const c=s.remoteUserMap.get(n);return!!c&&(!r||c.has(r))})()}getRemoteMedia(n){var r;const s=Array.from(oo(r=this.remoteUserMap).call(r)).find(c=>c.uid===n);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let n=Array.from(this.remoteUserMap.entries()).map(s=>{let[c]=s;return{uid:c.uid,level:c.audioTrack?100*c.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(te.LocalAudioTrack);return r&&n.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),n=ie(n).call(n,(s,c)=>s.level-c.level),n}disconnectForReconnect(){var n=this;return x(function*(){n.sendConnection&&n.recvConnection&&(w.debug("[".concat(n.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),n.state=at.Reconnecting,B("KEEP_LAST_FRAME")&&0!==n.remoteUserMap.size&&Array.from(n.remoteUserMap.entries()).forEach(r=>{let[s]=r;var c;s._videoTrack&&s._videoTrack._player&&(null===(c=s._videoTrack._player.getVideoElement())||void 0===c||c.pause(),s._videoTrack._player.isKeepLastFrame=!0,s._videoTrack._originMediaStreamTrack.stop())}),n.sendConnection.close(),n.unbindConnectionEvents(n.sendConnection),n.sendConnection=void 0,n.recvConnection.close(),n.unbindConnectionEvents(n.recvConnection),n.recvConnection=void 0,0!==n.localTrackMap.size&&(Array.from(n.localTrackMap.entries()).forEach(r=>{var s;let[c,{track:d}]=r;switch(c){case te.LocalVideoTrack:Re(s=d._hints).call(s,Vt.LOW_STREAM)?d.close():n.pendingLocalTracks.push(d);break;case te.LocalAudioTrack:d instanceof Dn?n.pendingLocalTracks=n.pendingLocalTracks.concat(d.trackList):n.pendingLocalTracks.push(d)}}),n.emit(Ae.MediaReconnectStart,n.store.uid)),n.unbindLocalTrackEvents(),n.localTrackMap.clear(),0!==n.remoteUserMap.size&&Array.from(n.remoteUserMap.entries()).forEach(r=>{let[s,c]=r;Array.from(oo(c).call(c)).forEach(d=>{n.setPendingRemoteMedia(s,d)}),n.emit(Ae.MediaReconnectStart,s.uid)}),n.unbindAllRemoteTrackEvents(),n.remoteUserMap.clear(),n.statsUploader.stopUploadUplinkStats(),n.statsUploader.stopUploadDownlinkStats(),n.statsUploader.stopUploadTransportStats(),w.debug("[".concat(n.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))})()}hasPendingRemoteMedia(n,r){for(const s of this.pendingRemoteTracks){const{user:c,kind:d}=s;if((n instanceof Ii?n.uid:n)===c.uid&&r===d)return!0}return!1}setPendingRemoteMedia(n,r){this.hasPendingRemoteMedia(n,r)||this.pendingRemoteTracks.push({user:n,kind:r})}restartICE(n){var r=this;return x(function*(){let s;s=n.direction===Kc.SEND_ONLY?yield r.sendMutex.lock("From P2PChannel.restartICE"):yield r.recvMutex.lock("From P2PChannel.restartICE");try{const c=yield n.restartICE(),d=yield Qt(r,Ae.RequestP2PRestartICE,c);n.setDescription("local",d)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const n=this.sendConnection.getStats(),r=this.localTrackMap.get(te.LocalVideoTrack),s=this.localTrackMap.get(te.LocalAudioTrack),c=n.videoSend.find(N=>{var P;return N.ssrc===(null==r||null===(P=r.ssrcs)||void 0===P?void 0:P[0].ssrcId)}),d=n.audioSend.find(N=>{var P;return N.ssrc===(null==s||null===(P=s.ssrcs)||void 0===P?void 0:P[0].ssrcId)});if(!c||!d)return 1;const h=hr(this,Ae.NeedSignalRTT),p=c?c.rttMs:void 0,m=d?d.rttMs:void 0,_=p&&m?(p+m)/2:p||m,v=100*n.sendPacketLossRate*.7/50+.3*((_&&h?(_+h)/2:_||h)||0)/1500,b=v<.17?1:v<.36?2:v<.59?3:v<.1?4:5,C=r?.track;if(C&&C._encoderConfig&&-1===C._hints.indexOf(Vt.SCREEN_TRACK)){const N=C._encoderConfig.bitrateMax,P=n.bitrate.actualEncoded;if(N&&P){const D=(1e3*N-P)/(1e3*N);return Qk[D<.15?0:D<.3?1:D<.45?2:D<.6?3:4][b]}}return b}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const n=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[c]=s;const d=c._audioSSRC,h=c._videoSSRC,p=n.audioRecv.find(P=>P.ssrc===d),m=n.videoRecv.find(P=>P.ssrc===h);if(!p&&!m)return void(r+=1);const _=hr(this,Ae.NeedSignalRTT),g=n.rtt,v=(g&&_?(g+_)/2:g||_)||0,b=p?p.jitterMs:void 0,C=n.recvPacketLossRate;let N=.7*C*100/50+.3*v/1500;b&&(N=.6*C*100/50+.2*v/1500+.2*b/400),r+=N<.1?1:N<.17?2:N<.36?3:N<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}muteLocalTrack(n){var r=this;return x(function*(){return new z((s,c)=>{r.handleMuteLocalTrack(n,s,c)})})()}filterTobePublishedTracks(n,r,s){const c=[],d=Lt(),h=this.getAllTracks();n=rh(n=n.filter(_=>-1===h.indexOf(_)));let p=!1,m=!1;for(const _ of n){if(_ instanceof We&&(this.localTrackMap.has(te.LocalVideoTrack)||p?new Q(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(c.push({track:_,type:te.LocalVideoTrack}),p=!0),r)){const g=this.getLowVideoTrack(_,s);c.push({track:g,type:te.LocalVideoLowTrack})}if(_ instanceof mt){const g=this.localTrackMap.get(te.LocalAudioTrack);if(g){if(!(g.track instanceof Dn))throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");g.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(m){const v=c.find(b=>{let{type:C}=b;return C===te.LocalAudioTrack});if(!(v.track instanceof Dn))throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(_)}else{if(!d.webAudioMediaStreamDest||_ instanceof Dn||_._bypassWebAudio)c.push({track:_,type:te.LocalAudioTrack});else{const v=new Dn;v.addAudioTrack(_),c.push({track:v,type:te.LocalAudioTrack})}m=!0}}}return c}filterTobeUnpublishedTracks(n){const r=[],s=this.getAllTracks();n=rh(n=n.filter(c=>-1!==s.indexOf(c)));for(const c of n){if(c instanceof mt){const d=this.localTrackMap.get(te.LocalAudioTrack);if(!d)continue;d.track instanceof Dn?(d.track.removeAudioTrack(c),this.unbindLocalAudioTrackEvents(c),0===d.track.trackList.length&&(r.push([te.LocalAudioTrack,d]),d.track.close())):r.push([te.LocalAudioTrack,d])}if(c instanceof We){const d=this.localTrackMap.get(te.LocalVideoTrack);if(!d)continue;r.push([te.LocalVideoTrack,d]);const h=this.localTrackMap.get(te.LocalVideoLowTrack);h&&r.push([te.LocalVideoLowTrack,h])}}return r}bindLocalTrackEvents(n){n.forEach(r=>{let{track:s,type:c}=r;switch(c){case te.LocalVideoTrack:s.addListener(fe.GET_STATS,this.handleGetLocalVideoStats),s.addListener(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(fe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(fe.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),s.addListener(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case te.LocalAudioTrack:this.bindLocalAudioTrackEvents(s)}})}bindLocalAudioTrackEvents(n,r){n instanceof Dn?n.trackList.forEach(s=>{s.addListener(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(fe.GET_STATS,this.handleGetLocalAudioStats),s.addListener(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.addListener(fe.GET_STATS,this.handleGetLocalAudioStats),n.addListener(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||n.addListener(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(n){n||(n=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:c}]=r;return{track:c,type:s}})),n.forEach(r=>{let{track:s,type:c}=r;switch(c){case te.LocalVideoTrack:s.off(fe.GET_STATS,this.handleGetLocalVideoStats),s.off(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(fe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(fe.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),s.off(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case te.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s)}})}unbindLocalAudioTrackEvents(n){n instanceof Dn?n.trackList.forEach(r=>{r.off(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(fe.GET_STATS,this.handleGetLocalAudioStats),r.off(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.off(fe.GET_STATS,this.handleGetLocalAudioStats),n.off(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(n,r){r instanceof Ks&&r.addListener(fe.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(n))}),r instanceof go&&r.addListener(fe.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(n))})}unbindRemoteTrackEvents(n){n&&n.removeAllListeners(fe.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r,s]=n;s.has(ge.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(ge.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(n){return n.map(r=>{var s;let c,d,{track:h,type:p}=r;switch(p){case te.LocalAudioTrack:c=gt.Audio,d={dtx:h instanceof Zc&&h._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case te.LocalVideoTrack:c=Re(s=h._hints).call(s,Vt.SCREEN_TRACK)?gt.Screen:gt.High,d=Yd(Yd({},zC(h)),{},{codec:this.store.codec});break;case te.LocalVideoLowTrack:c=gt.Low,d=Yd(Yd({},zC(h)),{},{codec:this.store.codec})}return{kind:p===te.LocalAudioTrack?ge.AUDIO:ge.VIDEO,stream_type:c,attributes:d,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(n){return n.map(r=>{var s;let c,[d,{track:h,ssrcs:p,id:m}]=r;switch(d){case te.LocalVideoTrack:c=Re(s=h._hints).call(s,Vt.SCREEN_TRACK)?gt.Screen:gt.High;break;case te.LocalAudioTrack:c=gt.Audio;break;case te.LocalVideoLowTrack:c=gt.Low}return{stream_type:c,ssrcs:p,mid:m}})}assignLocalTracks(n){n.forEach(r=>{let{track:s,type:c}=r;this.localTrackMap.set(c,{track:s})})}withdrawLocalTracks(n){n.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(n){var r=this;n.onConnectionStateChange=function(){var s=x(function*(c){var d;if(w.info("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(c,")")),r.emit(Ae.PeerConnectionStateChange,c),"connected"!==c||r.store.keyMetrics.peerConnectionEnd||r.store.peerConnectionEnd(),Re(d=r._restartStates).call(d,c)||n.direction===Kc.SEND_ONLY){if(r._restartTimer)return;const h=()=>{("disconnected"===n.iceConnectionState||"checking"===n.iceConnectionState||"failed"===n.iceConnectionState)&&(w.debug("[".concat(r.store.clientId,"] [P2PChannel] start use restartICE")),"CONNECTED"===hr(r,Ae.QueryClientConnectionState)&&r.restartICE(n))};r._restartTimer=window.setTimeout(()=>{h(),r._restartTimer=void 0},800)}});return function(c){return s.apply(this,arguments)}}(),n.onICEConnectionStateChange=s=>{"connected"!==s||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(s,")")),Se.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:s,tag:dn.TRACER}).onSuccess(),this.emit(Ae.IceConnectionStateChange,s)},n.onICETransportStateChange=s=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(s,")"))},n.onDTLSTransportStateChange=s=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(s,")"))},n.onDTLSTransportError=s=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(s,")"))},n.onFirstAudioDecoded=s=>{var c;const d=Array.from(oo(c=this.remoteUserMap).call(c)).find(p=>p._audioSSRC===s);var h;d&&(this.store.subscribe(d.uid,"audio",void 0,void 0,void 0,Date.now()),null===(h=d.audioTrack)||void 0===h||h.emit(Qc.FIRST_FRAME_DECODED),Se.firstRemoteFrame(this.store.sessionId,Bn.FIRST_AUDIO_DECODE,zt.FIRST_AUDIO_DECODE,{peer:d._uintid,subscribeElapse:vi.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId}))},n.onFirstAudioReceived=s=>{var c;const d=Array.from(oo(c=this.remoteUserMap).call(c)).find(h=>h._audioSSRC===s);d&&Se.firstRemoteFrame(this.store.sessionId,Bn.FIRST_AUDIO_RECEIVED,zt.FIRST_AUDIO_RECEIVED,{peer:d._uintid,subscribeElapse:vi.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId})},n.onFirstVideoDecoded=(s,c,d)=>{this.reportVideoFirstFrameDecoded(s,c,d)},n.onFirstVideoReceived=s=>{var c;const d=Array.from(oo(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===s);d&&Se.firstRemoteFrame(this.store.sessionId,Bn.FIRST_VIDEO_RECEIVED,zt.FIRST_VIDEO_RECEIVED,{peer:d._uintid,subscribeElapse:vi.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId})},n.onSelectedLocalCandidateChanged=(s,c)=>{const d="relay"===s.candidateType;"unknown"!==c.candidateType&&d===("relay"===c.candidateType)||this.emit(Ae.ConnectionTypeChange,d),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ud(c))," -> ").concat(JSON.stringify(Ud(s)),")"))},n.onSelectedRemoteCandidateChanged=(s,c)=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ud(c))," -> ").concat(JSON.stringify(Ud(s)),")"))},n.onFirstVideoDecodedTimeout=s=>{this.reportVideoFirstFrameDecoded(s,void 0,void 0,!0)},n.onLocalCandidate=s=>{this.emit(Ae.LocalCandidate,s)}}unbindConnectionEvents(n){n.onConnectionStateChange=void 0,n.onICEConnectionStateChange=void 0,n.onICETransportStateChange=void 0,n.onDTLSTransportStateChange=void 0,n.onDTLSTransportError=void 0,n.onFirstAudioDecoded=void 0,n.onFirstAudioReceived=void 0,n.onFirstVideoDecoded=void 0,n.onFirstVideoReceived=void 0,n.onSelectedLocalCandidateChanged=void 0,n.onSelectedRemoteCandidateChanged=void 0,n.onFirstVideoDecodedTimeout=void 0,n.onLocalCandidate=void 0}filterTobeMutedTracks(n){const r=[];if(-1===this.getAllTracks().indexOf(n))return r;const s=this.localTrackMap.get(te.LocalAudioTrack);if(n instanceof mt&&s?.track instanceof Dn)return s.track.isActive||r.push([te.LocalAudioTrack,s]),r;const c=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return n===h});if(c&&(r.push(c),c[0]===te.LocalVideoTrack)){const d=this.localTrackMap.get(te.LocalVideoLowTrack);d&&r.push([te.LocalVideoLowTrack,d])}return r}filterTobeUnmutedTracks(n){const r=[],s=this.localTrackMap.get(te.LocalAudioTrack);if(n instanceof mt&&s?.track instanceof Dn)return s.track.isActive&&r.push([te.LocalAudioTrack,s]),r;const c=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return n===h});if(c)if(c[0]===te.LocalVideoTrack){r.push(c);const d=this.localTrackMap.get(te.LocalVideoLowTrack);d&&r.push([te.LocalVideoLowTrack,d])}else r.push(c);return r}createMuteMessage(n){return n.map(r=>{var s;let c,[d,{track:h,ssrcs:p,id:m}]=r;switch(d){case te.LocalAudioTrack:c=gt.Audio;break;case te.LocalVideoTrack:c=Re(s=h._hints).call(s,Vt.SCREEN_TRACK)?gt.Screen:gt.High;break;case te.LocalVideoLowTrack:c=gt.Low}return{stream_type:c,ssrcs:p,mid:m}})}createUnmuteMessage(n){return n.map(r=>{var s;let c,[d,{track:h,ssrcs:p,id:m}]=r;switch(d){case te.LocalAudioTrack:c=gt.Audio;break;case te.LocalVideoTrack:c=Re(s=h._hints).call(s,Vt.SCREEN_TRACK)?gt.Screen:gt.High;break;case te.LocalVideoLowTrack:c=gt.Low}return{stream_type:c,ssrcs:p,mid:m}})}filterTobeUnSubscribedTracks(n,r){const s=[],c=this.remoteUserMap.get(n);if(!c)return s;if(r){const d=c.get(r);if(!d)return s;s.push([n,{kind:r,id:d}])}else Array.from(c.entries()).forEach(d=>{let[h,p]=d;s.push([n,{kind:h,id:p}])});return s}createUnsubscribeMessage(n){const r=[];return n.forEach(s=>{let[c,{kind:d}]=s;switch(d){case ge.VIDEO:return void(c._videoSSRC&&r.push({stream_type:ge.VIDEO,ssrcId:c._videoSSRC}));case ge.AUDIO:return void(c._audioSSRC&&r.push({stream_type:ge.AUDIO,ssrcId:c._audioSSRC}))}}),r}withdrawRemoteTracks(n){n.forEach(r=>{let[s,{kind:c}]=r;const d=this.remoteUserMap.get(s);d&&(d.delete(c),0===Array.from(d.entries()).length&&this.remoteUserMap.delete(s))})}updateBitrateLimit(n){var r=this;return x(function*(){const s=r.localTrackMap.get(te.LocalVideoTrack),c=r.localTrackMap.get(te.LocalVideoLowTrack);s&&(yield s.track.setBitrateLimit(n.uplink)),c&&n.low_stream_uplink&&(yield c.track.setBitrateLimit({max_bitrate:n.low_stream_uplink.bitrate,min_bitrate:n.low_stream_uplink.bitrate||0}))})()}isP2PDisconnected(){return!this.sendConnection||!this.recvConnection||"connected"!==this.sendConnection.peerConnectionState&&"connected"!==this.recvConnection.peerConnectionState}tryToUnmuteAudio(n){var r=this;return x(function*(){for(let s=0;s<n.length;s++)if(n[s]instanceof mt){const c=r.filterTobeUnmutedTracks(n[s]);if(0===c.length)continue;const d=r.createUnmuteMessage(c);return void(yield Mt(r,Ae.RequestUnmuteLocal,d))}})()}bindStatsUploaderEvents(){this.statsUploader.requestStats=n=>this.getStats(n),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(n=>{let[,{ssrcs:r}]=n;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=n=>{var r;return!(null===(r=this.recvConnection)||void 0===r||!r.getRemoteVideoIsReady(n))},this.statsUploader.requestUpload=(n,r)=>this.emit(Ae.RequestUploadStats,n,r),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){var n=this;return x(function*(){n.dtlsFailedCount+=1,yield mi(jg(n.dtlsFailedCount,bn)),n.emit(Ae.RequestReconnect)})()}reconnectP2P(){return x(function*(){})()}canPublishLowStream(){return this.localTrackMap.has(te.LocalVideoTrack)||this.pendingLocalTracks.some(n=>n instanceof We)}throwIfTrackTypeNotMatch(n){if(n.filter(r=>r instanceof We).length>1)throw new Q(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n.filter(r=>r instanceof mt).length>1&&(n.some(r=>r instanceof mt&&r._bypassWebAudio)||!Lt().webAudioMediaStreamDest))throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of n){if(r instanceof We&&this.pendingLocalTracks.some(s=>s instanceof We))throw new Q(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof mt&&this.pendingLocalTracks.some(s=>s instanceof mt)&&(!Lt().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof mt&&s._bypassWebAudio)))throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(n,r){const s=!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Lt().supportDualStreamEncoding,c=Yd(Yd({},{width:160,height:120,framerate:15,bitrate:50}),r);let d;d=s?n._mediaStreamTrack.clone():fv(n,c);const h=It(8,"track-low-"),p=new We(d,Yd(Yd({},s&&{scaleResolutionDownBy:IO(c,n)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return p.on(Ch.TRANSCEIVER_UPDATED,m=>{n._updateRtpTransceiver(m,ac.LOW_STREAM)}),p._hints.push(Vt.LOW_STREAM),n.addListener(fe.NEED_CLOSE,()=>{p.close()}),p}globalLock(){var n=this;return x(function*(){return n.recvMutex.lock("From P2PChannel2.globalLock")})()}reportVideoFirstFrameDecoded(n,r,s,c){var d;const h=Array.from(oo(d=this.remoteUserMap).call(d)).find(p=>p._videoSSRC===n);if(h){c||this.store.subscribe(h.uid,"video",void 0,void 0,void 0,void 0,Date.now());const p=this.store.keyMetrics,m=p.subscribe.find(_=>_.userId===h.uid&&"video"===_.type);Se.firstRemoteVideoDecode(this.store.sessionId,Bn.FIRST_VIDEO_DECODE,zt.FIRST_VIDEO_DECODE,{peer:h._uintid,videowidth:r,videoheight:s,subscribeElapse:vi.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId,apEnd:p.requestAPEnd||0,apStart:p.requestAPStart||0,joinGwEnd:p.joinGatewayEnd||0,joinGwStart:p.joinGatewayStart||0,pcEnd:p.peerConnectionEnd||0,pcStart:p.peerConnectionStart||0,subscriberEnd:m?.subscribeEnd||0,subscriberStart:m?.subscribeStart||0,videoAddNotify:m?.streamAdded||0,state:c?1:0})}}remoteMediaSsrcChanged(n,r,s){var c=this;return x(function*(){if(!c.recvConnection)return!1;const d=c.remoteUserMap.get(n);if(!d)return!1;const h=d.get(r);if(!h)return!1;const p=yield c.recvConnection.getRemoteSSRC(h);return void 0!==p&&p!==s})()}resetConnection(n){w.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(n)),this.state===at.Connected?(w.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}publishDataChannel(n){return x(function*(){throw new Q(M.NOT_SUPPORTED)})()}unpublishDataChannel(n){return x(function*(){throw new Q(M.NOT_SUPPORTED)})()}subscribeDataChannel(n,r){return x(function*(){throw new Q(M.NOT_SUPPORTED)})()}unsubscribeDataChannel(n,r){return x(function*(){throw new Q(M.NOT_SUPPORTED)})()}hasPendingRemoteDataChannel(n,r){throw new Q(M.NOT_SUPPORTED)}setPendingRemoteDataChannel(n,r){throw new Q(M.NOT_SUPPORTED)}preConnect(n,r,s,c,d,h){return x(function*(){throw new Q(M.NOT_SUPPORTED)})()}getEstablishParams(){throw new Q(M.NOT_SUPPORTED)}reSubscribe(n){return x(function*(){throw new Q(M.NOT_SUPPORTED)})()}updateVideoStreamParameter(n,r){return x(function*(){throw new Q(M.NOT_SUPPORTED)})()}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(n=>{let[r,{track:s}]=n;r===te.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,ac.LOW_STREAM):s._updateRtpTransceiver(void 0)})}}function Ds(o){return function(n,r,s){const c=n[r];if("function"!=typeof c)throw new Error("Cannot use mutex on object property.");return s.value=x(function*(){for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];switch(o){case Wo.SEND_ONLY:{const m=yield this.sendMutex.lock("From P2PChannel2.".concat(r));try{return yield c.apply(this,h)}finally{m()}}case Wo.RECEIVE_ONLY:{const m=yield this.recvMutex.lock("From P2PChannel2.".concat(r));try{return yield c.apply(this,h)}finally{m()}}default:{const m=yield this.sendMutex.lock("From P2PChannel2.".concat(r)),_=yield this.recvMutex.lock("From P2PChannel2.".concat(r));try{return yield c.apply(this,h)}finally{m(),_()}}}}),s}}function xL(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function LL(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?xL(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):xL(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}ee([Ds(),O("design:type",Function),O("design:paramtypes",[Object,String]),O("design:returntype",z)],fn.prototype,"startP2P",null),ee([Ds(),O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",z)],fn.prototype,"p2pConnect",null),ee([Ds(Wo.SEND_ONLY),O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",z)],fn.prototype,"dopublish",null),ee([Ds(Wo.SEND_ONLY),O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],fn.prototype,"unpublish",null),ee([Ds(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",z)],fn.prototype,"unpublishLowStream",null),ee([Ds(Wo.SEND_ONLY),O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",z)],fn.prototype,"doUnpublish",null),ee([Ds(Wo.RECEIVE_ONLY),O("design:type",Function),O("design:paramtypes",[Ii,String,String,Number]),O("design:returntype",z)],fn.prototype,"subscribe",null),ee([Ds(Wo.RECEIVE_ONLY),O("design:type",Function),O("design:paramtypes",[Ii,String,String,Boolean]),O("design:returntype",z)],fn.prototype,"unsubscribe",null),ee([Ds(Wo.RECEIVE_ONLY),O("design:type",Function),O("design:paramtypes",[Ii,String]),O("design:returntype",z)],fn.prototype,"muteRemote",null),ee([Ds(Wo.RECEIVE_ONLY),O("design:type",Function),O("design:paramtypes",[Ii,String]),O("design:returntype",z)],fn.prototype,"unmuteRemote",null),ee([Ds(Wo.RECEIVE_ONLY),O("design:type",Function),O("design:paramtypes",[Ii,String]),O("design:returntype",z)],fn.prototype,"hasRemoteMediaWithLock",null),ee([Ds(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",z)],fn.prototype,"disconnectForReconnect",null),ee([Ds(Wo.RECEIVE_ONLY),O("design:type",Function),O("design:paramtypes",[Ii,String,Number]),O("design:returntype",z)],fn.prototype,"remoteMediaSsrcChanged",null);const mV=Date.now(),_V=20,oN=new Map,DT=new Map;function FL(o){return sN.apply(this,arguments)}function sN(){return sN=x(function*(o){const n=oN.get(o),r=Array.isArray(n)&&n[n.length-1],s=DT.get(o);if(!r)return void(s.isSyncing=!1);const c={uid:r.uid,payload:Fg(r.payload)};0===s.firstRecvTs&&(s.firstRecvTs=r.recvTs,s.firstSendTs=r.sendTs);const d=r.sendTs-s.firstSendTs,h=d-(Date.now()-s.firstRecvTs);h>0&&(s.firstRecvTs=Date.now()-d);let p=r.mediaDelay+h;p<=0?(n.pop(),UL(r.context,c),p=0):p=Math.min(p,_V),setTimeout(()=>n.length&&FL(o),p)}),sN.apply(this,arguments)}function UL(o,n){o.safeEmit(et.STREAM_MESSAGE,n.uid,n.payload),o.onStreamMessage&&o.onStreamMessage(n)}function VL(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function Rv(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?VL(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):VL(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}Wn.setLogger(w);class Ft extends Yt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var n;return(null===(n=this._config)||void 0===n?void 0:n.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(n){var r;let s;if(super(),r=this,S(this,"store",void 0),S(this,"_uid",void 0),S(this,"_channelName",void 0),S(this,"_uintUid",void 0),S(this,"_users",[]),S(this,"_config",void 0),S(this,"_clientId",void 0),S(this,"_appId",void 0),S(this,"_sessionId",null),S(this,"_key",void 0),S(this,"_joinInfo",void 0),S(this,"_gateway",void 0),S(this,"_statsCollector",void 0),S(this,"_configDistribute",void 0),S(this,"_leaveMutex",new Wn("client-leave")),S(this,"_publishMutex",new Wn("client-publish")),S(this,"_renewTokenMutex",new Wn("client-renewtoken")),S(this,"_subscribeMutex",new Wn("client-subscribe")),S(this,"_encryptionMode","none"),S(this,"_encryptionSecret",null),S(this,"_encryptionSalt",null),S(this,"_proxyServer",void 0),S(this,"_turnServer",{servers:[],mode:"auto"}),S(this,"_cloudProxyServerMode","disabled"),S(this,"_isDualStreamEnabled",!1),S(this,"_defaultStreamFallbackType",void 0),S(this,"_lowStreamParameter",void 0),S(this,"_streamFallbackTypeCacheMap",new Map),S(this,"_remoteStreamTypeCacheMap",new Map),S(this,"_axiosCancelSource",Tr.CancelToken.source()),S(this,"_audioVolumeIndicationInterval",void 0),S(this,"_networkQualityInterval",void 0),S(this,"_userOfflineTimeout",void 0),S(this,"_streamRemovedTimeout",void 0),S(this,"_injectStreamingClient",void 0),S(this,"_liveTranscodeStreamingClient",void 0),S(this,"_liveRawStreamingClient",void 0),S(this,"_channelMediaRelayClient",void 0),S(this,"_networkQualitySensitivity","normal"),S(this,"_p2pChannel",void 0),S(this,"_useLocalAccessPoint",!1),S(this,"_setLocalAPVersion",void 0),S(this,"_joinAndNotLeaveYet",!1),S(this,"_numberOfJoinCount",0),S(this,"_remoteDefaultVideoStreamType",void 0),S(this,"_inspect",void 0),S(this,"_moderation",void 0),S(this,"_license",void 0),S(this,"_pendingPublishedUsers",[]),S(this,"ntpAlignErrorCount",0),S(this,"remoteInboundOffset",0),S(this,"_handleLocalTrackEnable",(c,d,h)=>{this.publish(c,!1).then(d).catch(h)}),S(this,"_handleLocalTrackDisable",(c,d,h)=>{this.unpublish(c).then(d).catch(h)}),S(this,"_handleUserOnline",c=>{if(B("BLOCK_LOCAL_CLIENT")&&zc(c.uid,this.channelName))return void w.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof c.uid&&w.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const d=this._users.find(h=>h.uid===c.uid);if(d)d._trust_in_room_=!0;else{const h=new Ii(c.uid,c.uint_id||c.uid);this._users.push(h),w.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(et.USER_JOINED,h)}}),S(this,"_handleUserOffline",c=>{if(B("BLOCK_LOCAL_CLIENT")&&zc(c.uid,this.channelName))return;const d=this._users.find(h=>h.uid===c.uid);d&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),IS(this._users,d),this._remoteStreamTypeCacheMap.delete(d.uid),this._streamFallbackTypeCacheMap.delete(d.uid),w.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(et.USER_LEAVED,d,c.reason))}),S(this,"_handleAddAudioOrVideoStream",(c,d,h,p,m,_,g)=>{if(B("BLOCK_LOCAL_CLIENT")&&zc(d,this.channelName))return;const v=this._users.find(C=>C.uid===d);if(!v)return void w.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));w.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(v.uid,c,void 0,void 0,void 0,Date.now());const b="audio"===c?v.hasAudio:v.hasVideo;v._uintid||(v._uintid=m||d),"audio"===c?v._trust_audio_stream_added_state_=!0:v._trust_video_stream_added_state_=!0,"audio"===c?(v._audio_added_=!0,void 0!==h&&(v._audioSSRC=h),void 0!==p&&(v._cname=p),_&&(v._audioOrtc=_)):(v._video_added_=!0,void 0!==h&&(v._videoSSRC=h),void 0!==p&&(v._cname=p),void 0!==g&&(v._rtxSsrcId=g),_&&(v._videoOrtc=_)),("audio"===c?v.hasAudio:v.hasVideo)&&!b&&(w.info("[".concat(this._clientId,"] remote user ").concat(v.uid," published ").concat(c)),this.safeEmit(et.USER_PUBLISHED,v,c)),"video"===c?Se.onGatewayStream(this._sessionId,Bn.ON_ADD_VIDEO_STREAM,zt.ON_ADD_VIDEO_STREAM,{peer:m||d,ssrc:v._videoSSRC}):Se.onGatewayStream(this._sessionId,Bn.ON_ADD_AUDIO_STREAM,zt.ON_ADD_AUDIO_STREAM,{peer:m||d,ssrc:v._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(v,c,h).then(C=>{if(C&&(w.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(v.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof oi))return this._p2pChannel.unsubscribe(v,c,!0).then(()=>this._subscribe(v,c,!0).catch(N=>{w.error("[".concat(this._clientId,"] resubscribe error"),N.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(v,c)&&(w.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(v.uid," after reconnect.")),this._subscribe(v,c,!0).catch(C=>{w.error("[".concat(this._clientId,"] resubscribe error"),C.toString())}))}),S(this,"_handleRemoveStream",(c,d,h)=>{if(B("BLOCK_LOCAL_CLIENT")&&zc(c.uid,this.channelName))return;const p=this._users.find(_=>_.uid===c.uid);if(!p)return void w.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));w.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let m=()=>{};if(p.hasAudio&&p.hasVideo?m=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished audio track")),this.safeEmit(et.USER_UNPUBLISHED,p,"audio"),w.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished video track")),this.safeEmit(et.USER_UNPUBLISHED,p,"video")}:p.hasVideo?m=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished video track")),this.safeEmit(et.USER_UNPUBLISHED,p,"video")}:p.hasAudio&&(m=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished audio track")),this.safeEmit(et.USER_UNPUBLISHED,p,"audio")}),p._trust_audio_stream_added_state_=!0,p._trust_video_stream_added_state_=!0,p._audio_added_=!1,p._video_added_=!1,this._p2pChannel instanceof oi)this._p2pChannel.unsubscribe(p).then(_=>{if(_)return this._gateway.unsubscribe(_,p.uid)});else if(d&&h)if(c.sdp){const{sdp:_}=c;this._p2pChannel.unsubscribe(p,_).then(g=>{g&&d(g)}).catch(h)}else d&&d();p._audioSSRC=void 0,p._videoSSRC=void 0,p._audioOrtc=void 0,p._videoOrtc=void 0,p._rtxSsrcId=void 0,Se.onGatewayStream(this._sessionId,Bn.ON_REMOVE_STREAM,zt.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),m()}),S(this,"_handleSetStreamLocalEnable",(c,d,h)=>{if(B("BLOCK_LOCAL_CLIENT")&&zc(d,this.channelName))return;const p=this._users.find(g=>g.uid===d);if(!p)return void w.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));w.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(d));const m="audio"===c?p.hasAudio:p.hasVideo;if("audio"===c){p._trust_audio_enabled_state_=!0;const g=p._audio_enabled_;if(p._audio_enabled_=h,p._audio_enabled_===g)return;{const v=p._audio_enabled_?"enable-local-audio":"disable-local-audio";w.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(d,", msg: ").concat(v)),this.safeEmit(et.USER_INFO_UPDATED,d,v)}}else{p._trust_video_enabled_state_=!0;const g=p._video_enabled_;if(p._video_enabled_=h,p._video_enabled_===g)return;{const v=p._video_enabled_?"enable-local-video":"disable-local-video";w.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(v)),this.safeEmit(et.USER_INFO_UPDATED,d,v)}}const _="audio"===c?p.hasAudio:p.hasVideo;return m!==_?!m&&_?(w.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(c)),void this.safeEmit(et.USER_PUBLISHED,p,c)):("video"===c&&p._videoTrack&&p._videoTrack._destroy(),this._p2pChannel.muteRemote(p,c),w.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(c)),void this.safeEmit(et.USER_UNPUBLISHED,p,c)):void 0}),S(this,"_handleMuteStream",(c,d,h,p,m,_)=>{if(B("BLOCK_LOCAL_CLIENT")&&zc(c,this.channelName))return;w.debug("[".concat(this._clientId,"] receive mute message"),c,d,h);const g=this._users.find(C=>C.uid===c);if(!g)return void w.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const v="audio"===d?g.hasAudio:g.hasVideo;if("audio"===d){g._trust_audio_mute_state_=!0;const C=g._audio_muted_;if(g._audio_muted_=h,g._audio_muted_===C)return;{const N=g._audio_muted_?"mute-audio":"unmute-audio";w.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(N)),this.safeEmit(et.USER_INFO_UPDATED,c,N)}}else{g._trust_video_mute_state_=!0;const C=g._video_muted_;if(g._video_muted_=h,g._video_muted_===C)return;{const N=g._video_muted_?"mute-video":"unmute-video";w.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(N)),this.safeEmit(et.USER_INFO_UPDATED,c,N)}}const b="audio"===d?g.hasAudio:g.hasVideo;if(v!==b){if(!v&&b)return this.store.useP2P||("audio"===d?g._audioSSRC:g._videoSSRC)?(w.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(d)),void this.safeEmit(et.USER_PUBLISHED,g,d)):void w.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(d," unmute message  before add stream message, ").concat(d," SSRC doesn't exist yet."));"video"===d&&g._videoTrack&&g._videoTrack._destroy(),m&&_&&this._p2pChannel instanceof fn&&(p?this._p2pChannel.unsubscribe(g,p,d).then(C=>{m(C)}).catch(_):m()),this._p2pChannel.muteRemote(g,d),w.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(d)),this.safeEmit(et.USER_UNPUBLISHED,g,d)}}),S(this,"_handleP2PLost",function(){var c=x(function*(d){w.debug("[".concat(r._clientId,"] receive p2p lost"),d),parseInt(d.p2pid,10)===r.store.p2pId?yield r._p2pChannel.requestReconnect():w.warning("[".concat(r._clientId,"] P2PLost stream not found"),d)});return function(d){return c.apply(this,arguments)}}()),S(this,"_handleTokenWillExpire",()=>{w.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(et.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),S(this,"_handleBeforeUnload",c=>{"beforeunload"===c.type&&void 0!==c.returnValue&&""!==c.returnValue||(this.leave(),w.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),S(this,"_handleUpdateNetworkQuality",()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(et.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(et.NETWORK_QUALITY,c)}),S(this,"_handleP2PAddAudioOrVideoStream",(c,d)=>{const h=this._users.find(m=>m.uid===d);if(!h)return void w.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));w.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(h.uid,c,void 0,void 0,void 0,Date.now());const p="audio"===c?h.hasAudio:h.hasVideo;"audio"===c?h._trust_audio_stream_added_state_=!0:h._trust_video_stream_added_state_=!0,"audio"===c?h._audio_added_=!0:h._video_added_=!0,("audio"===c?h.hasAudio:h.hasVideo)&&!p&&(w.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published ").concat(c)),this.safeEmit(et.USER_PUBLISHED,h,c)),this._p2pChannel.hasPendingRemoteMedia(h,c)&&(w.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(h.uid," after reconnect.")),this._subscribe(h,c,!0).catch(m=>{w.error("[".concat(this._clientId,"] resubscribe error"),m.toString())}))}),this._config=n,this._clientId=It(5,"client-"),this.store=new iD(n.codec,n.audioCodec,n.mode,this._clientId),this.store.clientCreated(),n.proxyServer&&this.setProxyServer(n.proxyServer,!0),n.turnServer&&this.setTurnServer(n.turnServer,!0),w.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Lo," build: ").concat(rD,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),n.clientRoleOptions)try{yA(n.clientRoleOptions),s=Object.assign({},n.clientRoleOptions)}catch(c){w.warning("[".concat(this._clientId,"] ").concat(c.toString()))}this._statsCollector=new cm(this.store),this._statsCollector.onStatsException=(c,d,h)=>{w.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(d,", uid: ").concat(h)),this.safeEmit(et.EXCEPTION,{code:c,msg:d,uid:h})},this._statsCollector.onUploadPublishDuration=(c,d,h,p)=>{const m=this._users.find(_=>_.uid===c);m&&Se.peerPublishStatus(this._sessionId,{subscribeElapse:p,audioPublishDuration:d,videoPublishDuration:h,peer:m._uintid})},this.store.useDataChannel=Lt().supportDataChannel&&B("SIGNAL_CHANNEL"),this.store.useP2P=B("P2P"),this._gateway=new hL(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:n.websocketRetryConfig||bn,httpRetryConfig:n.httpRetryConfig||bn,forceWaitGatewayResponse:void 0===n.forceWaitGatewayResponse||n.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:n.role,clientRoleOptions:s}),this._configDistribute=new av,this.store.useP2P?(this._p2pChannel=new fn(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new oi(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}joinMeta(n,r,s,c,d){var h=arguments,p=this;return x(function*(){let m=!(h.length>5&&void 0!==h[5])||h[5],_=h.length>6&&void 0!==h[6]&&h[6];kt("JOIN_GATEWAY_USE_443PORT_ONLY",m),kt("JOIN_GATEWAY_USE_DUAL_DOMAIN",_);const g=p._gateway.signal.websocket;return g instanceof vh&&(g.use443PortOnly=m,g.tryDoubleDomain=_),(v=x(function*(b,C,N){pS.get(b)||pS.set(b,[]),ke.get(b)||ke.set(b,C),va.get(b)||va.set(b,0);const P=pS.get(b),D=ke.get(b);if(!P||!D)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(va.get(b)===D){const oe=Qu();P.push(oe),yield oe.promise}va.set(b,va.get(b)+1);for(var k=arguments.length,V=new Array(k>3?k-3:0),U=3;U<k;U++)V[U-3]=arguments[U];const Y=yield N(...V);return va.set(b,va.get(b)-1),va.get(b)===D-1&&P.length>0&&(P[0].resolve(),P.shift()),0===va.get(b)&&(pS.set(b,[]),ke.set(b,0),va.set(b,0)),Y}),function(b,C,N){return v.apply(this,arguments)})("client.join",B("JOIN_MAX_CONCURRENCY"),p.join.bind(p),n,r,s,c,d);var v})()}join(n,r,s,c,d){var h=this;return x(function*(){const p=++h._numberOfJoinCount;h.store.joinStart(),c&&(h.store.uid=c);const m="HTTPS"===(Cf||Cf||(Cf=(window.location.protocol.split(":")[0]||"").toUpperCase(),Cf)),_=nD()?window.isSecureContext:"Browser Not Support";(nD()||m)&&window.isSecureContext||w.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");const g=Vg();"DISCONNECTED"===h.connectionState&&(h.store.avoidJoinStart=Math.round(Date.now()),w.debug("[".concat(h._clientId,"] set avoidJoinStart to ").concat(h.store.avoidJoinStart)));const v=Se.reportApiInvoke(g,{name:Vn.JOIN,options:[n,r,s,c],states:{isHttps:m,isSecureContext:_},tag:dn.TRACER});Se.setAppId(n);try{if(!s&&null!==s)throw new G(M.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&fi(s,"token",1,2047),fi(n,"appid",1,2047),lE(r),c&&Rf(c),d&&fi(d,"optionalInfo",1,2047)}catch(D){throw v.onError(D),D}if(w.info("[".concat(h._clientId,"] start join channel ").concat(r,", join number: ").concat(p)),h._leaveMutex.isLocked&&(w.debug("[".concat(h._clientId,"] join: waiting leave operation")),(yield h._leaveMutex.lock())(),w.debug("[".concat(h._clientId,"] join: continue"))),h._joinAndNotLeaveYet=!0,"DISCONNECTED"!==h.connectionState){const D=new G(M.INVALID_OPERATION,"[".concat(h._clientId,"] Client already in connecting/connected state"));throw v.onError(D),D}h._sessionId||(h._sessionId=g,h.store.sessionId=h._sessionId),h._gateway.state="CONNECTING";const b=Rv({clientId:h._clientId,appId:n,sid:h._sessionId,cname:r,uid:"string"!=typeof c?c:null,turnServer:h._turnServer,proxyServer:h._proxyServer,token:s||n,cloudProxyServer:h._cloudProxyServerMode,optionalInfo:d,license:h._license,useLocalAccessPoint:h._useLocalAccessPoint},void 0!==h._remoteDefaultVideoStreamType&&{defaultVideoStream:h._remoteDefaultVideoStreamType});if(h._useLocalAccessPoint&&(b.setLocalAPVersion=h._setLocalAPVersion),"string"==typeof c&&(b.stringUid=c,h._uintUid?(b.uid=h._uintUid,h._uintUid=void 0):b.uid=0),"none"!==h._encryptionMode&&h._encryptionSecret){if(b.aesmode=h._encryptionMode,b.aespassword=yield EA(h._encryptionSecret),!h._joinAndNotLeaveYet)throw new G(M.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));h._encryptionSalt&&(b.aessalt=h._encryptionSalt)}h._startSession(h._sessionId,{channel:r,appId:n});const C=h._sessionId;setTimeout(()=>{"CONNECTING"===h.connectionState&&C===h._sessionId&&Se.joinChannelTimeout(h._sessionId,5)},5e3);try{var N;let D;const k=b.cloudProxyServer;if(Re(N=["proxy3","proxy4","proxy5"]).call(N,k)){const oe=B("PROXY_SERVER_TYPE3");b.proxyServer=Array.isArray(oe)?oe[0]:oe}if(Se.setProxyServer(b.proxyServer),w.setProxyServer(b.proxyServer),h.store.requestAPStart(),b.stringUid&&!b.uid){const oe=yield tT(b.stringUid,b,h._axiosCancelSource.token,h._config.httpRetryConfig||bn,h.store);w.debug("[".concat(h._clientId,"] getUserAccount Success ").concat(b.stringUid," => ").concat(oe)),b.uid=oe,D=yield eT(b,h._axiosCancelSource.token,h._config.httpRetryConfig||bn,!0,h.store)}else D=yield eT(b,h._axiosCancelSource.token,h._config.httpRetryConfig||bn,!0,h.store);if(!h._joinAndNotLeaveYet)throw new G(M.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));h.store.requestAPEnd(),setTimeout(()=>{h._configDistribute.startGetConfigDistribute(b,h._axiosCancelSource.token),h._configDistribute.on(uE.UPDATE_BITRATE_LIMIT,oe=>{h._p2pChannel.updateBitrateLimit(oe)})},0),h._key=s||n;const V=D.gatewayInfo;h._joinInfo=Rv(Rv({},b),{},{cid:V.cid,uid:b.uid?b.uid:V.uid,vid:V.vid,apResponse:V.res,uni_lbs_ip:V.uni_lbs_ip,gatewayAddrs:V.gatewayAddrs});const U=yield h._joinGateway();if(!h._joinAndNotLeaveYet)throw new G(M.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));v.onSuccess(U),h._appId=n,h._channelName=b.cname,h._uid=U,h.store.uid=U,setTimeout(()=>{h._networkQualityInterval&&window.clearInterval(h._networkQualityInterval),h._networkQualityInterval=window.setInterval(h._handleUpdateNetworkQuality,2e3),window.addEventListener(qi()?"beforeunload":"pagehide",h._handleBeforeUnload)},0);const Y=b.stringUid?"string uid: ".concat(b.stringUid,",uid: ").concat(b.uid):"uid: ".concat(h._uid);return w.info("[".concat(h._clientId,"] Joining channel success: channel: ").concat(r,",").concat(Y)),setTimeout(()=>{w.startUpload()},5e3),h.store.joinEnd(),P=h,Re(Wc).call(Wc,P)||Wc.push(P),U}catch(D){const k=Array.isArray(D)?D[0]:D;throw k&&k.code===M.OPERATION_ABORTED?w.warning("[".concat(h._clientId,"] join number: ").concat(p,", Joining channel failed, rollback"),k):w.error("[".concat(h._clientId,"] join number: ").concat(p,", Joining channel failed, rollback"),k),k.code!==M.OPERATION_ABORTED&&h._numberOfJoinCount===p&&(h._gateway.state="DISCONNECTED",h._reset()),v.onError(k),k}var P})()}_joinGateway(){if(!this._joinInfo||!this._key)throw new G(M.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!B("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(n=>n).catch(n=>{if(n.code===M.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,Xe.FALLBACK),n;if(n.code===M.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,Xe.FALLBACK),n;throw n}).then(n=>{if(n instanceof G){if(n.code===M.INIT_WEBSOCKET_TIMEOUT){if(w.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new G(M.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const r=B("PROXY_SERVER_TYPE3");if(Array.isArray(r))if(this._joinInfo.apUrl){const c=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),d=c.slice(c.length-2).join(".");r.forEach(h=>{this._joinInfo&&Re(h).call(h,d)&&(this._joinInfo.proxyServer=h)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=r[0])}else this._joinInfo.proxyServer=r[0];else this._joinInfo.proxyServer=r;const s=B("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return s&&s[1]&&"443"!==s[1]&&w.setProxyServer(this._joinInfo.proxyServer),"443"!==B("STATS_COLLECTOR_PORT").toString()&&Se.setProxyServer(this._joinInfo.proxyServer),Se.reportApiInvoke(this._sessionId,{name:Vn.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:dn.TRACER}).onSuccess(),this.safeEmit(et.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),B("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(c=>{"forceturn"in c&&(c.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(w.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new G(M.INVALID_OPERATION);return Se.reportApiInvoke(this._sessionId,{name:Vn.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:dn.TRACER}).onSuccess(),this._joinGateway()}return n}).then(n=>n)}leave(){var n=this;return x(function*(){w.info("[".concat(n._clientId,"] Leaving channel")),window.removeEventListener(qi()?"beforeunload":"pagehide",n._handleBeforeUnload),n._reset(),function(s){const c=Wc.indexOf(s);-1!==c&&Wc.splice(c,1)}(n);const r=yield n._leaveMutex.lock();if("DISCONNECTED"===n.connectionState)return w.info("[".concat(n._clientId,"] Leaving channel repeated, success")),void r();yield n._gateway.leave("CONNECTED"!==n.connectionState),w.info("[".concat(n._clientId,"] Leaving channel success")),n._joinAndNotLeaveYet=!1,n.store.resetJoinChannelServiceRecords(),r()})()}publish(n){var r=arguments,s=this;return x(function*(){let c=!(r.length>1&&void 0!==r[1])||r[1];if(!Array.isArray(n)){if(!(n instanceof Li))return s._publishDataChannel(n);n=[n]}if(0===n.length)throw new G(M.INVALID_PARAMS,"param list is empty");const d=n;if("audience"===s._gateway.role)throw new G(M.INVALID_OPERATION,"audience can not publish stream");for(const p of d){if(!(p instanceof Li))throw new G(M.INVALID_PARAMS,"parameter is not local track");if(!p._enabled&&c)throw new G(M.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(p.getTrackId()))}w.info("[".concat(s._clientId,"] Publishing tracks, id ").concat(d.map(p=>"".concat(p.getTrackId()," "))));const h=yield s._publishMutex.lock();yield s._configDistribute.awaitConfigDistributeComplete(),c&&d.forEach(p=>{const m=s._configDistribute.getBitrateLimit();p instanceof We&&m&&p.setBitrateLimit(m.uplink)});try{yield s._publishHighStream(d),w.info("[".concat(s._clientId,"] Publish success, id ").concat(d.map(p=>"".concat(p.getTrackId()," "))))}catch(p){throw w.error("[".concat(s._clientId,"] publish error"),p.toString()),p}finally{h()}})()}_publishDataChannel(n){var r=this;return x(function*(){wt(n.id,"id",0,65535,!0),jc(n.ordered,"ordered"),fi(n.metadata,"metadata",0,512),w.info("[".concat(r._clientId,"] Publishing datachannels, id ").concat(n.id));const s=yield r._publishMutex.lock();try{if(-1!==r._p2pChannel.getAllDataChannels().findIndex(d=>d.id===n.id))throw new G(M.INVALID_PARAMS,"Invalid id: ".concat(n.id,". If you want to republish the datachannel, unpublish first"));if(!r._joinInfo||void 0===r._uid)throw new G(M.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new G(M.INVALID_OPERATION,"can not publish datachannel in ".concat(r.connectionState," state"));if("auto"===r._turnServer.mode&&B("FORCE_TURN")&&!B("TURN_ENABLE_TCP")&&!B("TURN_ENABLE_UDP"))throw new G(M.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const c=new bO(n);yield r._p2pChannel.publishDataChannel([c]);try{const d={streamId:n.id,ordered:n.ordered,maxRetransmits:B("DATASTREAM_MAX_RETRANSMITS"),metadata:n.metadata,channelId:c._originDataChannelId};yield r._gateway.publishDataChannel(r._uid,d,!0)}catch(d){if(d.code!==M.DISCONNECT_P2P)throw d}return yield c._waitTillOpen(),w.info("[".concat(r._clientId,"] Publish dataChannels success, id ").concat(c.id)),c}catch(c){throw w.error("[".concat(r._clientId,"] publish datachannels error"),c.toString()),c}finally{s()}})()}unpublish(n){var r=this;return x(function*(){if(!r._joinInfo||void 0===r._uid)throw new G(M.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let s=[];if(n)if(Array.isArray(n))s=n;else{if(!(n instanceof Li))return r._unpublishDataChannel([n]);s=[n]}else r.store.useP2P||(yield r._unpublishDataChannel()),s=r._p2pChannel.getAllTracks(!0);w.info("[".concat(r._clientId,"] Unpublish tracks, tracks ").concat(s.map(d=>"".concat(d.getTrackId()," "))," "));const c=yield r._publishMutex.lock();try{if(r._p2pChannel instanceof fn){const d=yield r._p2pChannel.unpublish(s);if(d){const h=yield r._gateway.sendExtensionMessage(xt.UNPUBLISH,d);h&&(yield r._p2pChannel.setDescription("local",h))}}else{const d=yield r._p2pChannel.unpublish(s);d&&(yield r._gateway.unpublish(d,r._uid)),w.info("[".concat(r._clientId,"] Unpublish success,tracks ").concat(s.map(h=>"".concat(h.getTrackId()))))}}catch(d){throw w.error("[".concat(r._clientId,"] unpublish error"),d.toString()),d}finally{c&&c()}})()}_unpublishDataChannel(n){var r=this;return x(function*(){void 0!==n&&0!==n.length||(n=r._p2pChannel.getAllDataChannels()),w.info("[".concat(r._clientId,"] Unpublish datachannels, datachannels ").concat(n.map(c=>"".concat(c.id," "))," "));const s=yield r._publishMutex.lock();try{const c=yield r._p2pChannel.unpublishDataChannel(n);c&&(yield r._gateway.unpublishDataChannel(c)),w.info("[".concat(r._clientId,"] Unpublish dataChannel success,dataChannel ").concat(n.map(d=>"".concat(d.id))))}catch(c){throw w.error("[".concat(r._clientId,"] unpublish dataChannel error"),c.toString()),c}finally{s&&s()}})()}subscribe(n,r,s){var c=this;return x(function*(){return"datachannel"===r?c._subscribeDataChannel(n,s):c._subscribe(n,r)})()}_subscribeDataChannel(n,r){var s=this;return x(function*(){var c;if(wt(r,"channelId",0,65535,!0),!s._joinInfo)throw new G(M.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==s.connectionState&&"RECONNECTING"!==s.connectionState)throw new G(M.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(s.connectionState," state"));if(!s._users.find(m=>m===n))throw w.error("[".concat(s._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),new G(M.INVALID_REMOTE_USER,"user is not in the channel");if(!n.hasAudio&&!n.hasVideo&&0===n._dataChannels.length)throw w.error("[".concat(s._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),new G(M.INVALID_REMOTE_USER,"user is not published");const d=null===(c=n._dataChannels)||void 0===c?void 0:c.find(m=>m.id===r);if(!d)throw w.error("[".concat(s._clientId,"] can not subscribe ").concat(n.uid," with mediaType datachannel, remote datachannel is not published")),new G(M.REMOTE_USER_IS_NOT_PUBLISHED);const h=yield s._subscribeMutex.lock();w.info("[".concat(s._clientId,"] subscribe user ").concat(n.uid,", mediaType: datachannel"));try{const m=yield s._p2pChannel.subscribeDataChannel(n,[d]);if(m&&Re(m).call(m,d.id))try{var p;if(!d._originDataChannelId)throw w.error("[".concat(s._clientId,"] can not subscribe ").concat(n.uid," with mediaType datachannel, cannot get RTCDatachannel")),new G(M.REMOTE_USER_IS_NOT_PUBLISHED);const _={id:d.id,datachannelId:d._originDataChannelId,ordered:d.ordered,maxRetransmits:d.maxRetransmits,metadata:null!==(p=d.metadata)&&void 0!==p?p:""};yield s._gateway.subscribeDataChannel(n.uid,_,!0)}catch(_){if(_?.code!==M.WS_ABORT)throw yield s._p2pChannel.unsubscribeDataChannel(n,[d]),_;yield s._p2pChannel.unsubscribeDataChannel(n,[d]),s._p2pChannel.setPendingRemoteDataChannel(n,d.id)}return yield d._waitTillOpen(),w.info("[".concat(s._clientId,"] subscribe success user ").concat(n.uid,", mediaType: datachannel")),d}finally{h()}})()}_p2pSubscribe(n,r,s){var c=this;return x(function*(){if(Gn(r,"mediaType",["audio","video"]),!c._joinInfo)throw new G(M.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==c.connectionState&&"RECONNECTING"!==c.connectionState)throw new G(M.INVALID_OPERATION,"Can't subscribe stream in ".concat(c.connectionState," state"));if(!c._users.find(p=>p===n)){const p=new G(M.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(c._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),p}if(!n.hasAudio&&!n.hasVideo){const p=new G(M.INVALID_REMOTE_USER,"user is not published");throw w.error("[".concat(c._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),p}if(!s&&("audio"===r&&!n.hasAudio||"video"===r&&!n.hasVideo)){const p=new G(M.REMOTE_USER_IS_NOT_PUBLISHED);throw w.error("[".concat(c._clientId,"] can not subscribe ").concat(n.uid," with mediaType ").concat(r,", remote track is not published")),p}const d=yield c._subscribeMutex.lock();w.info("[".concat(c._clientId,"] subscribe user ").concat(n.uid,", mediaType: ").concat(r));const h="audio"===r?te.LocalAudioTrack:c._joinInfo.defaultVideoStream===fE.LOW_STREAM?te.LocalVideoLowTrack:te.LocalVideoTrack;try{(yield c._p2pChannel.hasRemoteMediaWithLock(n,r))?yield c._p2pChannel.unmuteRemote(n,r):(c.store.subscribe(n.uid,r,Date.now()),c._p2pChannel instanceof fn&&(yield c._gateway.sendExtensionMessage(xt.SUBSCRIBE,{trackType:h}))),w.info("[".concat(c._clientId,"] subscribe success user ").concat(n.uid,", mediaType: ").concat(r)),c._defaultStreamFallbackType&&c.setStreamFallbackOption(n.uid,c._defaultStreamFallbackType).catch(m=>{w.warning("[".concat(c._clientId,"] auto set fallback failed"),m)});const p="audio"===r?n._audioTrack:n._videoTrack;if(!p)throw new G(M.UNEXPECTED_ERROR,"can not find remote track in user object");return p}catch(p){throw w.error("[".concat(c._clientId,"] subscribe user ").concat(n.uid," error"),p),p}finally{d()}})()}_subscribe(n,r,s){var c=this;return x(function*(){if(c._p2pChannel instanceof fn)return c._p2pSubscribe(n,r);if(Gn(r,"mediaType",["audio","video"]),!c._joinInfo)throw new G(M.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==c.connectionState&&"RECONNECTING"!==c.connectionState)throw new G(M.INVALID_OPERATION,"Can't subscribe stream in ".concat(c.connectionState," state"));if(!c._users.find(g=>g===n)){const g=new G(M.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(c._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),g}if(!n.hasAudio&&!n.hasVideo){const g=new G(M.INVALID_REMOTE_USER,"user is not published");throw w.error("[".concat(c._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),g}if(!(s||("audio"!==r||n.hasAudio&&void 0!==n._audioSSRC)&&("video"!==r||n.hasVideo&&void 0!==n._videoSSRC))){const g=new G(M.REMOTE_USER_IS_NOT_PUBLISHED);throw w.error("[".concat(c._clientId,"] can not subscribe ").concat(n.uid," with mediaType ").concat(r,", remote track is not published")),g}let d="audio"===r?n._audioSSRC:n._videoSSRC,h="audio"===r?n._audioOrtc:n._videoOrtc,p="video"===r?n._rtxSsrcId:void 0,m={stream_type:"audio"===r?ge.AUDIO:ge.VIDEO,ssrcId:d};const _=yield c._subscribeMutex.lock();w.info("[".concat(c._clientId,"] subscribe user ").concat(n.uid,", mediaType: ").concat(r));try{if(yield c._p2pChannel.hasRemoteMediaWithLock(n,r))yield c._p2pChannel.unmuteRemote(n,r);else try{const v="audio"===r?n._audioSSRC:n._videoSSRC;void 0!==v&&v!==d&&(d=v,h="audio"===r?n._audioOrtc:n._videoOrtc,p="video"===r?n._rtxSsrcId:void 0,m={stream_type:"audio"===r?ge.AUDIO:ge.VIDEO,ssrcId:d}),vi.markSubscribeStart(c.store.clientId,d),c.store.subscribe(n.uid,r,Date.now()),yield c._p2pChannel.subscribe(n,r,d,p,h);try{yield c._gateway.subscribe(n.uid,m,!0)}catch(b){if(b?.code!==M.WS_ABORT)throw yield c._p2pChannel.unsubscribe(n,r),b;yield c._p2pChannel.unsubscribe(n,r,!0),c._p2pChannel.setPendingRemoteMedia(n,r)}c.store.subscribe(n.uid,r,void 0,Date.now()),c._p2pChannel.reportSubscribeEvent(!0,null,n,r)}catch(v){throw c._p2pChannel.reportSubscribeEvent(!1,v?.code,n,r),v}w.info("[".concat(c._clientId,"] subscribe success user ").concat(n.uid,", mediaType: ").concat(r)),c._defaultStreamFallbackType&&c.setStreamFallbackOption(n.uid,c._defaultStreamFallbackType).catch(v=>{w.warning("[".concat(c._clientId,"] auto set fallback failed"),v)});const g="audio"===r?n._audioTrack:n._videoTrack;if(!g)throw new G(M.UNEXPECTED_ERROR,"can not find remote track in user object");return g}catch(g){throw w.error("[".concat(c._clientId,"] subscribe user ").concat(n.uid," error"),g),g}finally{_()}})()}massSubscribe(n){var r=this;return x(function*(){if(nc(n,"subscribeList"),!r._joinInfo)throw new G(M.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new G(M.INVALID_OPERATION,"Can't subscribe stream in ".concat(r.connectionState," state"));const s=Date.now(),c=new Map,d=yield r._subscribeMutex.lock();w.info("[".concat(r._clientId,"]start massSubscribe user ").concat(n.map(_=>{let{user:g,mediaType:v}=_;return"user: ".concat(g?.uid,", mediaType: ").concat(v)}).join("; ")));const h=(n=[...n]).map(_=>{let{user:g,mediaType:v}=_;return{user:g,mediaType:v}}),p=yield r._p2pChannel.globalLock();try{var m;for(let g=n.length-1;g>=0;g--){const v=n[g],{user:b,mediaType:C}=v;if(Gn(C,"mediaType",["audio","video"]),!b){const D=new G(M.INVALID_PARAMS,"user property does not exist in subscribeList item");throw w.error("[".concat(r._clientId,"] user property does not exist in subscribeList item")),D}if(!r._users.find(D=>D===b)){const D=new G(M.INVALID_REMOTE_USER,"user is not in the channel");w.error("[".concat(r._clientId,"] can not massSubscribe ").concat(b.uid,", this user is not in the channel")),h[g].error=D,n.splice(g,1);continue}if("audio"===C&&(!b.hasAudio||void 0===b._audioSSRC)||"video"===C&&(!b.hasVideo||void 0===b._videoSSRC)){const D=new G(M.REMOTE_USER_IS_NOT_PUBLISHED);w.error("[".concat(r._clientId,"] can not subscribe ").concat(b.uid," with mediaType ").concat(C,", remote user is not published")),h[g].error=D,n.splice(g,1);continue}const N=Fn.Video|Fn.LwoVideo,P=c.get(b);if(P){if("video"===C?P&N:P&Fn.Audio){n.splice(g,1),w.warning("[".concat(r._clientId,"] repeat massSubscribe user:").concat(b.uid,", mediaType:").concat(C," twice"));continue}c.set(b,P|("video"===C?N:Fn.Audio))}else c.set(b,"video"===C?N:Fn.Audio)}for(let g=n.length-1;g>=0;g--){const v=n[g],{user:b,mediaType:C}=v,N=Fn.Video|Fn.LwoVideo;if(r._p2pChannel.hasRemoteMedia(b,C)){yield r._p2pChannel.unmuteRemoteNoLock(b,C);const P=c.get(b);c.set(b,"video"===C?P^N:P^Fn.Audio),n.splice(g,1)}}r.store.massSubscribe(n.map(g=>({userId:g.user.uid,type:g.mediaType})),s);const _=_d(m=Array.from(c.entries())).call(m,(g,v)=>{let[b,C]=v;if(0===C)return g;const N={stream_id:b.uid,stream_type:C};return C&Fn.Audio&&(N.audio_ssrc=b._audioSSRC),C&Fn.Video&&(N.video_ssrc=b._videoSSRC),g.push(N),g},[]);try{n.length>0&&(yield r._p2pChannel.massSubscribeNoLock(n.map(v=>{let{user:b,mediaType:C}=v;return{user:b,mediaType:C,ssrcId:C===ge.VIDEO?b._videoSSRC:b._audioSSRC,rtxSsrcId:C===ge.VIDEO?b._rtxSsrcId:void 0}})));const g=new Map;if(_.length>0&&((yield r._gateway.subscribeAll(_,!0))?.users||[]).forEach(b=>{let{stream_id:C,video_error_code:N,audio_error_code:P,error_code:D}=b;(N||P||D)&&g.set(C,{video_error_code:N,audio_error_code:P,error_code:D})}),Array.from(g.entries()).length>0){const v=Array.from(g.entries()).map(b=>{let C,[N,P]=b;return P.error_code||P.video_error_code&&P.audio_error_code?C=void 0:P.video_error_code?C=ge.VIDEO:P.audio_error_code&&(C=ge.AUDIO),{user:r.remoteUsers.find(D=>D.uid===N),mediaType:C}});yield r._p2pChannel.massUnsubscribeNoLock(v)}for(const v of h){const b=g.get(v.user.uid);if(b){const C=b.error_code||"audio"===v.mediaType&&b.audio_error_code||"video"===v.mediaType&&b.video_error_code;if(C){const N=Eh(C);w.error("user:".concat(v.user.uid," mediaType:").concat(v.mediaType," has massSubscribe error ").concat(N.desc)),v.error=new G(M.SUBSCRIBE_FAILED,"code ".concat(C,": ").concat(N.desc))}}v.error||(v.track="video"===v.mediaType?v.user.videoTrack:v.user.audioTrack)}return r.store.massSubscribe(h.filter(v=>!v.error).map(v=>({userId:v.user.uid,type:v.mediaType})),void 0,Date.now()),h.forEach(v=>{var b;Se.subscribe(r.store.sessionId,{succ:!!v.error,ec:(null===(b=v.error)||void 0===b?void 0:b.code)||null,video:v.mediaType===ge.VIDEO,audio:v.mediaType===ge.AUDIO,peerid:v.user.uid,subscribeRequestid:v.mediaType===ge.VIDEO?v.user._videoSSRC:v.user._audioSSRC,p2pid:r.store.p2pId,eventElapse:Math.floor(performance.now()-s)},!0)}),w.info("[".concat(r._clientId,"] massSubscribe success ").concat(n.map(v=>{let{user:b,mediaType:C}=v;return"user: ".concat(b?.uid,", mediaType: ").concat(C)}).join("; "))),h}catch(g){throw yield r._p2pChannel.massUnsubscribeNoLock(n),g}}finally{p(),d()}})()}unsubscribe(n,r,s){var c=this;return x(function*(){if(r||c.store.useP2P){if("datachannel"===r)return c._unsubscribeDataChannel(n,s)}else yield c._unsubscribeDataChannel(n,s);if(r&&Gn(r,"mediaType",["audio","video"]),!c._joinInfo)throw new G(M.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!c._users.find(h=>h===n)){const h=new G(M.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(c._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),h}w.info("[".concat(c._clientId,"] unsubscribe uid: ").concat(n.uid,", mediaType: ").concat(r));const d=yield c._subscribeMutex.lock();try{if(c._p2pChannel instanceof fn)yield c._gateway.sendExtensionMessage(xt.UNSUBSCRIBE,{mediaType:r});else{const h=yield c._p2pChannel.unsubscribe(n,r);h&&(yield c._gateway.unsubscribe(h,n.uid)),w.info("[".concat(c._clientId,"] unsubscribe success uid: ").concat(n.uid,", mediaType: ").concat(r))}}catch(h){if(h.code===M.DISCONNECT_P2P)return void w.warning("disconnecting p2p, abort unsubscribe request.");throw w.error("[".concat(c._clientId,"] unsubscribe user ").concat(n.uid," error"),h.toString()),h}finally{d()}})()}_unsubscribeDataChannel(n,r){var s=this;return x(function*(){if(r&&wt(r,"id",0,65535,!0),!s._joinInfo)throw new G(M.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!s._users.find(d=>d===n)){const d=new G(M.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(s._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),d}let c;if("number"==typeof r){const d=n._dataChannels.find(h=>h.id===r);d&&(c=[d])}else c=n._dataChannels;if(void 0===c){const d=new G(M.REMOTE_USER_IS_NOT_PUBLISHED);throw w.error("[".concat(s._clientId,"] can not unsubscribe ").concat(n.uid," with channelId ").concat(r,", remote datachannel is not published")),d}w.info("[".concat(s._clientId,"] unsubscribe uid: ").concat(n.uid,", mediaType: datachannel, ids: ").concat(c.map(d=>d.id)));try{const d=yield s._p2pChannel.unsubscribeDataChannel(n,c);d&&(yield s._gateway.unsubscribeDataChannel(d,n.uid)),w.info("[".concat(s._clientId,"] unsubscribe datachannel success uid: ").concat(n.uid,", mediaType: datachannel, ids: ").concat(d))}catch(d){if(d.code===M.DISCONNECT_P2P)return void w.warning("disconnecting p2p, abort unsubscribe request.");throw w.error("[".concat(s._clientId,"] unsubscribe user ").concat(n.uid," error"),d.toString()),d}})()}massUnsubscribe(n){var r=this;return x(function*(){if(nc(n,"unsubscribeList"),!r._joinInfo)throw new G(M.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");w.info("[".concat(r._clientId,"] start massUnsubscribe ").concat(n.map(c=>{let{user:d,mediaType:h}=c;return"user: ".concat(d?.uid,", mediaType: ").concat(h,";")}).join())),n=[...n];const s=new Map;for(let c=n.length-1;c>=0;c--){const{user:d,mediaType:h}=n[c];if(!d){const m=new G(M.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw w.error("[".concat(r._clientId,"] user property does not exist in unsubscribeList item")),m}if(Gn(h,"mediaType",["video","audio",void 0]),!r._users.find(m=>m===d)){w.warning("[".concat(r._clientId,"] can not unsubscribe ").concat(d.uid,", user is not in the channel")),n.splice(c,1);continue}const p=Fn.Video|Fn.LwoVideo;if(s.has(d)){const m=s.get(d);let _;switch(h){case"video":_=m&p;break;case"audio":_=m&Fn.Audio;break;default:_=m&(Fn.Audio|p)}if(_){w.warning("[".concat(r._clientId,"] repeat massUnsubscribe user:").concat(d.uid,",mediaType:").concat(h," twice.")),n.splice(c,1);continue}h?"audio"===h?s.set(d,m|Fn.Audio):"video"===h&&s.set(d,m|p):s.set(d,m|Fn.Audio|p)}else h?"audio"===h?s.set(d,Fn.Audio):"video"===h&&s.set(d,p):s.set(d,Fn.Audio|p)}try{const c=yield r._p2pChannel.massUnsubscribe(n);c&&(yield r._gateway.massUnsubscribe(c)),w.info("[".concat(r._clientId,"] massUnsubscribe success ").concat(n.map(d=>{let{user:h,mediaType:p}=d;return"user: ".concat(h?.uid,", mediaType: ").concat(p,";")}).join()))}catch(c){if(c.code===M.DISCONNECT_P2P)return void w.warning("[".concat(r._clientId,"] disconnecting p2p, abort unsubscribe request."));throw w.error("[".concat(r._clientId,"] massUnsubscribe error"),c.toString()),c}})()}setLowStreamParameter(n){var r=this;return x(function*(){(function(c){if(!c)throw new Q(M.INVALID_PARAMS);nn(c.width)||yS(c.width,"streamParameter.width"),nn(c.height)||yS(c.height,"streamParameter.height"),nn(c.framerate)||yS(c.framerate,"streamParameter.framerate"),nn(c.bitrate)||wt(c.bitrate,"streamParameter.bitrate")})(n),(!n.width&&n.height||n.width&&!n.height)&&w.warning("[".concat(r._clientId,"] The width and height parameters take effect only when both are set")),w.info("[".concat(r._clientId,"] set low stream parameter to"),JSON.stringify(n));const s=r._configDistribute.getLowStreamConfigDistribute();if(s&&s.bitrate&&n.bitrate&&s.bitrate<n.bitrate&&(n.bitrate=s.bitrate),r._lowStreamParameter=n,r._isDualStreamEnabled)return r._p2pChannel.updateVideoStreamParameter(n,te.LocalVideoLowTrack)})()}enableDualStream(){var n=this;return x(function*(){if(!Lt().supportDualStream)throw Se.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new G(M.NOT_SUPPORTED,"Your browser is not support dual stream");if(n._isDualStreamEnabled)throw new G(M.INVALID_OPERATION,"Dual stream is already enabled");if(n._p2pChannel.canPublishLowStream())try{yield n._publishLowStream()}catch(r){throw Se.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),r}n._isDualStreamEnabled=!0,Se.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),w.info("[".concat(n._clientId,"] enable dual stream"))})()}disableDualStream(){var n=this;return x(function*(){if(n._isDualStreamEnabled){if(!n._joinInfo)throw new G(M.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(n._p2pChannel.getLocalMedia(te.LocalVideoLowTrack))try{const r=yield n._p2pChannel.unpublishLowStream();r&&(yield n._gateway.unpublish(r,n._joinInfo.stringUid||n._joinInfo.uid))}catch(r){throw Se.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),r}n._isDualStreamEnabled=!1,Se.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),w.info("[".concat(n._clientId,"] disable dual stream"))}})()}setClientRole(n,r){var s=this;return x(function*(){if(Gn(n,"role",["audience","host"]),r&&yA(r),"rtc"===s.mode)throw w.warning("[".concat(s._clientId,"]rtc mode can not use setClientRole")),new G(M.INVALID_OPERATION,"rtc mode can not use setClientRole");if(r&&r.level&&"host"===n)throw new G(M.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===n&&s._p2pChannel.hasLocalMedia())throw new G(M.INVALID_OPERATION,"can not set client role to audience when publishing stream");yield s._gateway.setClientRole(n,r),s._config.role=n,w.info("[".concat(s._clientId,"] set client role to ").concat(n,", level: ").concat(r&&r.level))})()}getRemoteInboundOffset(){var n;const r=null===(n=this._p2pChannel.getStats())||void 0===n?void 0:n.audioSend[0];if(!r||!r.timestamp)return 0;const s=r.timestamp-Date.now();return Math.abs(s)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(n,r){if(fi(n,"proxyServer"),!r){if("DISCONNECTED"!==this.connectionState)throw new G(M.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new G(M.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=n,Se.setProxyServer(this._proxyServer),w.setProxyServer(this._proxyServer),w.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(n,r){if(Array.isArray(n)||(n=[n]),!r){if("DISCONNECTED"!==this.connectionState)throw new G(M.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new G(M.INVALID_OPERATION,"You have already set the proxy")}if(ih(n))return this._turnServer={servers:n,mode:"original-manual"},void w.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(n.map(s=>s.urls).join(","),"."));n.forEach(s=>TS(s)),this._turnServer={servers:n,mode:"manual"},w.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(n){if("DISCONNECTED"!==this.connectionState)throw new G(M.INVALID_OPERATION,"you should set license before join channel");if(fi(n,"license",32,32),!/^[A-Za-z\d]+$/.test(n))throw new G(M.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=n,w.info("[".concat(this._clientId,"] set license success"),n)}startProxyServer(n){if("DISCONNECTED"!==this.connectionState)throw new G(M.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new G(M.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let s;switch(void 0===n&&(n=3),n){case 1:case 2:throw new G(M.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new G(M.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,w.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new G(M.INVALID_OPERATION,"Stop proxy server after leave channel");Se.setProxyServer(),w.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",w.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(n){if(!n.accessPoints)throw new G(M.INVALID_PARAMS,"accessPoints is required.");nc(n.accessPoints.serverList,"accessPoints.serverList"),fi(n.accessPoints.domain,"accessPoints.domain");const r=(C,N)=>{wt(C,N,0,65535,!0)};let s=443;if(n.accessPoints.port&&(r(n.accessPoints.port,"accessPoints.port"),s=n.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new G(M.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");B("CLOSE_AFB_FOR_LOCAL_AP")&&(kt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),kt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const c=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,d=n.accessPoints.domain,h=n.accessPoints.serverList.map(C=>c.test(C)?"".concat(C.replace(/\./g,"-"),".").concat(d):C),p=h.map(C=>"".concat(C,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,kt("WEBCS_DOMAIN",p),kt("WEBCS_DOMAIN_BACKUP_LIST",p),kt("GATEWAY_DOMAINS",[d]),n.report&&n.report.hostname&&Array.isArray(n.report.hostname)&&n.report.hostname.length?(nc(n.report.hostname,"report.hostname"),kt("EVENT_REPORT_DOMAIN",n.report.hostname[0]),kt("EVENT_REPORT_BACKUP_DOMAIN",n.report.hostname[1]||n.report.hostname[0])):(kt("EVENT_REPORT_DOMAIN",h[0]),kt("EVENT_REPORT_BACKUP_DOMAIN",h[1]||h[0]));let m=6443;n.report&&n.report.port&&(r(n.report.port,"report.port"),m=n.report.port),kt("STATS_COLLECTOR_PORT",m),kt("ENABLE_EVENT_REPORT",!!n.report);let _="";n.log&&n.log.hostname&&Array.isArray(n.log.hostname)&&n.log.hostname.length?(nc(n.log.hostname,"log.hostname"),_=n.log.hostname[0]):_=h[0];let g=6444;n.log&&n.log.port&&(r(n.log.port,"log.port"),g=n.log.port),kt("LOG_UPLOAD_SERVER","".concat(_,":").concat(g));let v=[];n.cds&&n.cds.hostname&&Array.isArray(n.cds.hostname)&&n.cds.hostname.length?(nc(n.cds.hostname,"cds.hostname"),v=n.cds.hostname):v=h;let b=443;n.cds&&n.cds.port&&(r(n.cds.port,"cds.port"),b=n.cds.port),kt("CDS_AP",v.map(C=>"".concat(C,":").concat(b))),kt("ENABLE_CONFIG_DISTRIBUTE",!!n.cds),w.info("set local access point v2 success")}setLocalAccessPoints(n,r){if(nc(n,"serverList"),fi(r,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new G(M.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;n=n.map(c=>s.test(c)?"".concat(c.replace(/\./g,"-"),".").concat(r):c),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,kt("WEBCS_DOMAIN",n),kt("WEBCS_DOMAIN_BACKUP_LIST",n),kt("GATEWAY_DOMAINS",[r]),kt("EVENT_REPORT_DOMAIN",n[0]),kt("EVENT_REPORT_BACKUP_DOMAIN",n[1]||n[0]),kt("LOG_UPLOAD_SERVER","".concat(n[0],":6444")),w.info("[".concat(this._clientId,"] set local access point success"))}setRemoteDefaultVideoStreamType(n){var r=this;return x(function*(){if(Gn(n,"streamType",[0,1]),r._remoteDefaultVideoStreamType=n,r._joinInfo)try{yield r._gateway.setDefaultRemoteVideoStreamType(n),r._joinInfo.defaultVideoStream=r._remoteDefaultVideoStreamType}catch(s){throw w.error("[".concat(r._clientId,"] set default remote video stream type error"),s.toString()),s}else w.debug("[".concat(r._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(n))})()}setRemoteVideoStreamType(n,r){var s=this;return x(function*(){Gn(r,"streamType",[0,1]);try{yield s._gateway.setRemoteVideoStreamType(n,r),setTimeout(()=>{const c=s._users.find(d=>d.uid===n);c&&c.videoTrack&&c.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(c){throw w.error("[".concat(s._clientId,"] set remote video stream type error"),c.toString()),c}w.info("[".concat(s._clientId,"] set remote ").concat(n," video stream type to ").concat(r)),s._remoteStreamTypeCacheMap.set(n,r)})()}setStreamFallbackOption(n,r){var s=this;return x(function*(){Gn(r,"fallbackType",[0,1,2]);try{yield s._gateway.setStreamFallbackOption(n,r)}catch(c){throw w.error("[".concat(s._clientId,"] set stream fallback option"),c.toString()),c}w.info("[".concat(s._clientId,"] set remote ").concat(n," stream fallback type to ").concat(r)),s._streamFallbackTypeCacheMap.set(n,r)})()}setEncryptionConfig(n,r,s){Gn(n,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"]),fi(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(Re(c).call(c,n)){if(!s||!(s instanceof Uint8Array&&32===s.length))throw new G(M.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new G(M.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(r)||w.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=n,this._encryptionSecret=r,s&&(this._encryptionSalt=Ug(s))}renewToken(n){var r=this;return x(function*(){if(fi(n,"token",1,2047),!r._key||!r._joinInfo)throw new G(M.INVALID_OPERATION,"renewToken should not be called before user join");const s=r._key;r._key=n,r._joinInfo&&(r._joinInfo.token=n);const c=yield r._renewTokenMutex.lock();try{if(B("USE_NEW_TOKEN")){w.debug("[".concat(r._clientId,"] start renew token with ticket from unilbs"));const d=yield function iV(o,n,r){return ov.apply(this,arguments)}(r._joinInfo,r._axiosCancelSource.token,r._config.httpRetryConfig||bn);w.debug("[".concat(r._clientId,"] get ticket from unilbs success")),yield r._gateway.renewToken({token:n,ticket:d})}else w.debug("[".concat(r._clientId,"] start renew token without ticket")),yield r._gateway.renewToken({token:n});w.debug("[".concat(r._clientId,"] renewToken success"))}catch(d){throw r._key=s,r._joinInfo.token=s,w.error("[".concat(r._clientId,"] renewToken failed"),d.toString()),d}finally{c()}})()}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?w.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const n=this._p2pChannel.getAudioLevels();this.safeEmit(et.VOLUME_INDICATOR,n)},B("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const n=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return n.Duration=Math.round(r.duration/1e3),n}startLiveStreaming(n,r){var s=this;return x(function*(){if(!r){if("h264"!==s.codec)throw new G(M.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!s._p2pChannel.hasLocalMedia())throw new G(M.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(s._liveRawStreamingClient&&s._liveRawStreamingClient.hasUrl(n)||s._liveTranscodeStreamingClient&&s._liveTranscodeStreamingClient.hasUrl(n))throw new G(M.LIVE_STREAMING_TASK_CONFLICT);const c=r?zn.TRANSCODE:zn.RAW;return s._createLiveStreamingClient(c).startLiveStreamingTask(n,c)})()}setLiveTranscoding(n){return this._createLiveStreamingClient(zn.TRANSCODE).setTranscodingConfig(n)}stopLiveStreaming(n){var r=this;return x(function*(){const s=[r._liveRawStreamingClient,r._liveTranscodeStreamingClient].filter(c=>c&&c.hasUrl(n));if(!s.length)throw new G(M.INVALID_PARAMS,"can not find live streaming url to stop");yield z.all(s.map(c=>c&&c.stopLiveStreamingTask(n)))})()}addInjectStreamUrl(n,r){var s=this;return x(function*(){if(!s._joinInfo)throw new G(M.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const c=s._createLiveStreamingClient(zn.INJECT);c.setInjectStreamConfig(r,0),yield c.startLiveStreamingTask(n,zn.INJECT)})()}removeInjectStreamUrl(){var n=this;return x(function*(){var r;const s=n._createLiveStreamingClient(zn.INJECT),c=Array.from(wa(r=s.streamingTasks).call(r)).find(d=>d.mode===zn.INJECT);if(!n._joinInfo||!c)throw new G(M.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");yield s.stopLiveStreamingTask(c.url)})()}startChannelMediaRelay(n){var r=this;return x(function*(){_L(n),yield r._createChannelMediaRelayClient().startChannelMediaRelay(n)})()}updateChannelMediaRelay(n){var r=this;return x(function*(){_L(n),yield r._createChannelMediaRelayClient().updateChannelMediaRelay(n)})()}stopChannelMediaRelay(){var n=this;return x(function*(){yield n._createChannelMediaRelayClient().stopChannelMediaRelay(),n._statsCollector.onStatsChanged&&(n._statsCollector.onStatsChanged=void 0)})()}sendStreamMessage(n){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new G(M.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof n||n instanceof Uint8Array)&&(n={payload:n}),"string"==typeof n.payload){const s=new TextEncoder;n.payload=s.encode(n.payload)}if(new Blob([n.payload]).size>1024)throw new G(M.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(be.DATA_STREAM,{payload:Ug(n.payload),syncWithAudio:n.syncWithAudio,sendTs:Date.now()-mV},!r)}sendMetadata(n){if(!this._joinInfo)throw new G(M.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([n]).size>1024)throw new G(M.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(be.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Ug(n)})}sendCustomReportMessage(n){var r=this;return x(function*(){if(Array.isArray(n)||(n=[n]),n.forEach(sD),!r._joinInfo)throw new G(M.INVALID_OPERATION,"can not send custom report, not joined");yield Se.sendCustomReportMessage(r._joinInfo.sid,n)})()}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}pickSVCLayer(n,r){var s=this;return x(function*(){Gn(r.spatialLayer,"spatialLayer",[0,1,2,3]),Gn(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{yield s._gateway.pickSVCLayer(n,r)}catch(c){throw w.error("[".concat(s._clientId,"] pick SVC layer failed"),c.toString()),c}})()}setRTM2Flag(n){if(Gn(n,"flag",[0,1]),!this._joinInfo)throw new G(M.INVALID_OPERATION,"Can't setRtm2Flag, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new G(M.INVALID_OPERATION,"Can't setRtm2Flag in ".concat(this.connectionState," state"));return this._gateway.setRTM2Flag(n)}_reset(){if(w.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Tr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._pendingPublishedUsers=[],this._users.forEach(n=>{n._audioTrack&&n._audioTrack._destroy(),n._videoTrack&&n._videoTrack._destroy(),n._dataChannels&&(n._dataChannels.forEach(r=>r._close()),n._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Wn("client-publish"),this._subscribeMutex=new Wn("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(n,r){const s=n||Vg();w.debug(n?"[".concat(this._clientId,"] new Session ").concat(s):"[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(s)),this._sessionId=s,this.store.sessionId=s,r?Se.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:r.channel,appid:r.appId,mode:this.mode}):this._joinInfo?Se.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this.mode}):this._gateway.joinInfo&&Se.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this.mode}),this._joinInfo&&(this._joinInfo.sid=s),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=s)}_publishHighStream(n){var r=this;return x(function*(){if(!r._joinInfo||void 0===r._uid)throw new G(M.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new G(M.INVALID_OPERATION,"can not publish stream in ".concat(r.connectionState," state"));if("auto"===r._turnServer.mode&&B("FORCE_TURN")&&!B("TURN_ENABLE_TCP")&&!B("TURN_ENABLE_UDP"))throw new G(M.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");w.debug("[".concat(r._clientId,"] publish high stream"));try{if(r._p2pChannel instanceof fn){const c=yield r._p2pChannel.publish(n,r._isDualStreamEnabled,r._lowStreamParameter);if(c)try{yield r._gateway.sendExtensionMessage(xt.PUBLISH,c)}catch(d){throw r._p2pChannel.unpublish(n),d}}else{const c=yield r._p2pChannel.publish(n,r._isDualStreamEnabled,r._lowStreamParameter),d=(yield c.next()).value;if(d){var s;let h;try{h=yield r._gateway.publish(r._uid,d,!0)}catch(p){if(p.code!==M.DISCONNECT_P2P)throw c.throw(p),p}yield c.next((null===(s=h)||void 0===s?void 0:s.ortc)||[])}r._p2pChannel.reportPublishEvent(!0,null);for(const h of n)h instanceof We&&h._encoderConfig&&r._gateway.setVideoProfile(h._encoderConfig),!h.muted&&h.enabled||(yield r._p2pChannel.muteLocalTrack(h))}}catch(c){if(r._p2pChannel.reportPublishEvent(!1,c?.code,n),c?.code===M.WS_ABORT)return;throw c}})()}_publishLowStream(){var n=this;return x(function*(){if(!n._joinInfo||void 0===n._uid)throw new G(M.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==n.connectionState&&"RECONNECTING"!==n.connectionState)throw new G(M.INVALID_OPERATION,"can not publish stream in ".concat(n.connectionState," state"));w.debug("[".concat(n._clientId,"] publish low stream"));const r=n._configDistribute.getLowStreamConfigDistribute();r&&r.bitrate&&(n._lowStreamParameter||(n._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),n._lowStreamParameter&&n._lowStreamParameter.bitrate&&r.bitrate<n._lowStreamParameter.bitrate&&(n._lowStreamParameter.bitrate=r.bitrate));try{const c=yield n._p2pChannel.publishLowStream(n._lowStreamParameter),d=(yield c.next()).value;if(d){var s;let h;try{h=yield n._gateway.publish(n._uid,d,!0)}catch(p){if(p.code!==M.DISCONNECT_P2P)throw c.throw(p),p}c.next((null===(s=h)||void 0===s?void 0:s.ortc)||[]),n._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(c){if(n._p2pChannel.reportPublishEvent(!1,c?.code,void 0,!0),c?.code===M.WS_ABORT)return;throw c}})()}_createLiveStreamingClient(n){if(!this._joinInfo||!this._appId)return new G(M.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const r=()=>new rV(this._joinInfo,this._config.websocketRetryConfig||bn,this._config.httpRetryConfig||bn),s=c=>{c.onLiveStreamError=(d,h)=>{Se.reportApiInvoke(this._sessionId,{name:Vn.ON_LIVE_STREAM_ERROR,options:[d,h],tag:dn.TRACER}).onSuccess(),this.safeEmit(et.LIVE_STREAMING_ERROR,d,h)},c.onLiveStreamWarning=(d,h)=>{Se.reportApiInvoke(this._sessionId,{name:Vn.ON_LIVE_STREAM_WARNING,options:[d,h],tag:dn.TRACER}).onSuccess(),this.safeEmit(et.LIVE_STREAMING_WARNING,d,h)},c.on(_h.REQUEST_WORKER_MANAGER_LIST,(d,h,p)=>{if(!this._joinInfo)return p(new G(M.INVALID_OPERATION,"can not find join info to get worker manager"));Dr(d,this._joinInfo,this._axiosCancelSource.token,bn).then(h).catch(p)})};switch(n){case zn.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=r(),s(this._liveRawStreamingClient)),this._liveRawStreamingClient;case zn.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=r(),s(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case zn.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=r(),this._injectStreamingClient.on(_h.REQUEST_WORKER_MANAGER_LIST,(c,d,h)=>{if(!this._joinInfo)return h(new G(M.INVALID_OPERATION,"can not find join info to get worker manager"));Dr(c,this._joinInfo,this._axiosCancelSource.token,bn).then(d).catch(h)}),this._injectStreamingClient.onInjectStatusChange=(c,d,h)=>{this.safeEmit(et.INJECT_STREAM_STATUS,c,d,h)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new G(M.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:n,sendResolutionHeight:r}=this.getLocalVideoStats();this._channelMediaRelayClient=new sV(this._joinInfo,this._clientId,this._config.websocketRetryConfig||bn,this._config.httpRetryConfig||bn,{width:n,height:r}),this._channelMediaRelayClient.on("state",c=>{c===Xi.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(et.CHANNEL_MEDIA_RELAY_STATE,c)}),this._channelMediaRelayClient.on("event",c=>{this.safeEmit(et.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._statsCollector.onStatsChanged=(c,d)=>{var h;"resolution"===c&&(null===(h=this._channelMediaRelayClient)||void 0===h||h.setVideoProfile(d))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(n,r){const{added:s,deleted:c}=n,d=[];Array.isArray(s)&&s.length>0&&s.forEach(h=>{const{uid:p,stream_id:m,ordered:_,max_retrans_times:g,metadata:v}=h,b=this._users.find(C=>C._uintid===p);if(b){if(w.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(p)),Re(d).call(d,b)||d.push(b),b._uintid||(b._uintid=p),-1===b._dataChannels.findIndex(C=>C.id===h.stream_id)){const C={id:m,ordered:!!_,maxRetransmits:g,metadata:v},N=new rl(C);b._dataChannels.push(N),w.info("[".concat(this._clientId,"] remote user ").concat(b.uid," published datachannel")),r||this.safeEmit(et.USER_PUBLISHED,b,"datachannel",C)}this._p2pChannel.hasPendingRemoteDataChannel(b,h.stream_id)&&(w.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(b.uid," after reconnect.")),this._subscribeDataChannel(b,h.stream_id).catch(C=>{w.error("[".concat(this._clientId,"] resubscribe datachannel error"),C.toString())}))}else w.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))}),r&&(this.safeEmit(et.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(c)&&c.length>0&&c.forEach(h=>{const{uid:p}=h,_=this._users.find(v=>v._uintid===p);if(!_)return void w.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const g=_._dataChannels.find(v=>v.id===h.stream_id);g&&(w.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(p)),this._p2pChannel.unsubscribeDataChannel(_,[g]).then(v=>{if(v)return _._dataChannels=_._dataChannels.filter(b=>b!==g),this._gateway.unsubscribeDataChannel(v,_.uid)}),w.info("[".concat(this._clientId,"] remote user ").concat(p," unpublished datachannel ,id:").concat(g.id)),this.safeEmit(et.USER_UNPUBLISHED,_,"datachannel",g._config))})}_handleRemoveDataChannels(n){const r=this._users.find(s=>s.uid===n.uid);if(r){if(void 0!==r._dataChannels&&r._dataChannels.length>0){w.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(n.uid));const s=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(c=>{this.safeEmit(et.USER_UNPUBLISHED,r,"datachannel",c._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(c=>{if(c)return this._gateway.unsubscribeDataChannel(c,r.uid)}),s()}}else w.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){var n=this;this._gateway.on(on.DISCONNECT_P2P,x(function*(){yield n._p2pChannel.disconnectForReconnect()})),this._gateway.on(on.CONNECTION_STATE_CHANGE,(r,s,c)=>{var d;if(c===Xe.FALLBACK)return;const h=()=>{this.safeEmit(et.CONNECTION_STATE_CHANGE,r,s,c)};if(Se.reportApiInvoke(this._sessionId||(null===(d=this._gateway.joinInfo)||void 0===d?void 0:d.sid)||null,{name:Vn.CONNECTION_STATE_CHANGE,options:[r,s,c],tag:dn.TRACER}).onSuccess(JSON.stringify({cur:r,prev:s,reason:c})),w.info("[".concat(this._clientId,"] connection state change: ").concat(s," -> ").concat(r)),"DISCONNECTED"===r)return this._reset(),void h();if("RECONNECTING"===r)this._users.forEach(m=>{m._trust_in_room_=!1,m._trust_audio_enabled_state_=!1,m._trust_video_enabled_state_=!1,m._trust_audio_mute_state_=!1,m._trust_video_mute_state_=!1,m._trust_audio_stream_added_state_=!1,m._trust_video_stream_added_state_=!1,m._audioSSRC=void 0,m._videoSSRC=void 0,m._videoOrtc=void 0,m._audioOrtc=void 0,m._cname=void 0,m._rtxSsrcId=void 0}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===r){var p;this._streamFallbackTypeCacheMap.forEach((m,_)=>{this._gateway.setStreamFallbackOption(_,m).catch(g=>{w.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),g)})}),this._remoteStreamTypeCacheMap.forEach((m,_)=>{this._gateway.setRemoteVideoStreamType(_,m).catch(g=>{w.warning("[".concat(this._clientId,"] auto set remote stream type failed"),g)})}),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(p=this._joinInfo)||void 0===p?void 0:p.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{w.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(m=>{w.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(m))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter(m=>!m._trust_in_room_).forEach(m=>{w.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(m.uid)),this._handleUserOffline({uid:m.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach(m=>{m._trust_audio_mute_state_||(w.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(m.uid)),this._handleMuteStream(m.uid,ge.AUDIO,!1)),m._trust_video_mute_state_||(w.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(m.uid)),this._handleMuteStream(m.uid,ge.VIDEO,!1)),m._trust_audio_enabled_state_||(w.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(m.uid)),this._handleSetStreamLocalEnable("audio",m.uid,!0)),m._trust_video_enabled_state_||(w.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(m.uid)),this._handleSetStreamLocalEnable("video",m.uid,!0)),m._trust_video_stream_added_state_||(w.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(m.uid)),this._handleResetAddStream(m,"video")),m._trust_audio_stream_added_state_||(w.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(m.uid)),this._handleResetAddStream(m,"audio")),m._video_added_||m._audio_added_||(w.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(m.uid)),this._handleRemoveStream({uid:m.uid,uint_id:m._uintid}))}))},1e3))}h()}),this._gateway.on(on.REQUEST_NEW_GATEWAY_LIST,(r,s)=>{if(!this._joinInfo)return s(new G(M.UNEXPECTED_ERROR,"can not recover, no join info"));ev(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||bn,this.store).then(c=>{this._joinInfo&&(this._joinInfo.apResponse=c.gatewayInfo.res,this._joinInfo.gatewayAddrs=c.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=c.gatewayInfo.uni_lbs_ip);const d=[];c.gatewayInfo.gatewayAddrs.forEach(h=>{let{address:p}=h;const[m,_]=p.split(":");d.push(this._joinInfo&&this._joinInfo.proxyServer?{proxy:this._joinInfo.proxyServer,host:m,port:_}:{host:m,port:_})}),r(d)}).catch(s)}),this._gateway.on(on.NETWORK_QUALITY,r=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(et.NETWORK_QUALITY,r)}),this._gateway.on(on.STREAM_TYPE_CHANGE,(r,s)=>{this.safeEmit(et.STREAM_TYPE_CHANGED,r,s),Se.reportApiInvoke(this._sessionId,{name:Vn.STREAM_TYPE_CHANGE,options:[r,s],tag:dn.TRACER}).onSuccess(JSON.stringify({uid:r,streamType:s}))}),this._gateway.on(on.IS_P2P_DISCONNECTED,r=>{this._p2pChannel.isP2PDisconnected()?r(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?r(!1):r(!0)}),this._gateway.on(on.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(on.REQUEST_P2P_CONNECTION_PARAMS,function(){var r=x(function*(s,c,d){try{c(yield n._p2pChannel.startP2PConnection(s))}catch(h){d(h)}});return function(s,c,d){return r.apply(this,arguments)}}()),this._gateway.on(on.JOIN_RESPONSE,(r,s)=>{if(this.store.useP2P)return;const{dtlsParameters:c,iceParameters:d,candidates:h,rtpCapabilities:p,setup:m,cname:_}=sT(r.ortc,s);this._p2pChannel.connect(d,c,h,p,m,_)}),this._gateway.on(on.REQUEST_DC_CONNECTION_PARAMS,r=>{r(this._p2pChannel.getEstablishParams())}),this._gateway.on(on.RESET_SIGNAL,r=>{this._p2pChannel.resetConnection(r),this._handleGatewaySignalEvents()}),this._gateway.on(on.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(on.DATACHANNEL_PRECONNECT,function(){var r=x(function*(s,c,d,h){var p,m,_,g,v,b;yield n._p2pChannel.startP2PConnection({turnServer:null===(p=n._joinInfo)||void 0===p?void 0:p.turnServer},!0);const C=function(N,P){let D;return P&&P.ip&&"number"==typeof P.port?(D=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:P.ip,port:P.port.toString(),type:"host",extension:{}}],w.debug("Using remote candidate from AP ".concat(P.ip,":").concat(P.port)),P.ip6&&(D.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:P.ip6,port:P.port.toString(),type:"host",extension:{}}),w.debug("Using IPV6 remote candidate from AP ".concat(P.ip6,":").concat(P.port)))):D=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:N.ip,port:N.port.toString(),type:"host",extension:{}}],D}(s,c);return n._p2pChannel.preConnect({iceUfrag:"".concat(null===(m=n._joinInfo)||void 0===m?void 0:m.apResponse.cid,"_").concat(null===(_=n._joinInfo)||void 0===_?void 0:_.apResponse.cert),icePwd:"".concat(null===(g=n._joinInfo)||void 0===g?void 0:g.apResponse.cid,"_").concat(null===(v=n._joinInfo)||void 0===v?void 0:v.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(b=B("FINGERPRINT"))&&void 0!==b?b:s.fingerprint}]},C,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(d).catch(h)});return function(s,c,d,h){return r.apply(this,arguments)}}())}_handleGatewaySignalEvents(){var n=this;this._gateway.signal.on(me.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(me.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(me.ON_ADD_AUDIO_STREAM,r=>this._handleAddAudioOrVideoStream("audio",r.uid,r.ssrcId,r.cname,r.uint_id,r.ortc)),this._gateway.signal.on(me.ON_ADD_VIDEO_STREAM,r=>this._handleAddAudioOrVideoStream("video",r.uid,r.ssrcId,r.cname,r.uint_id,r.ortc,r.rtxSsrcId)),this._gateway.signal.on(me.ON_REMOTE_DATASTREAM_UPDATE,r=>{this._handleUpdateDataChannel(r)}),this._gateway.signal.on(me.ON_REMOTE_FULL_DATASTREAM_INFO,r=>{this._handleUpdateDataChannel({added:r.datastreams,deleted:[]},!0)}),this._gateway.signal.on(me.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(me.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(me.MUTE_AUDIO,r=>this._handleMuteStream(r.uid,ge.AUDIO,!0)),this._gateway.signal.on(me.UNMUTE_AUDIO,r=>this._handleMuteStream(r.uid,ge.AUDIO,!1)),this._gateway.signal.on(me.MUTE_VIDEO,r=>this._handleMuteStream(r.uid,ge.VIDEO,!0)),this._gateway.signal.on(me.UNMUTE_VIDEO,r=>this._handleMuteStream(r.uid,ge.VIDEO,!1)),this._gateway.signal.on(me.RECEIVE_METADATA,r=>{const s=Fg(r.metadata);this.safeEmit(et.RECEIVE_METADATA,r.uid,s)}),this._gateway.signal.on(me.ON_DATA_STREAM,function(){var r=x(function*(s){if(!s)return;let c=0;if(s.ordered||s.syncWithAudio){const d=n._p2pChannel.getStats(),h=n.remoteUsers.find(m=>m.uid===s.uid),p=d?.audioRecv.find(m=>m.ssrc===h?._audioSSRC);c=p?.jitterBufferMs}null==c&&(c=0),function gV(o){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(!o.syncWithAudio)return UL(r,{uid:o.uid,payload:Fg(o.payload)});const s="".concat(r.id,"-").concat(o.uid),c=oN.get(s)||[],d=c.findIndex(_=>o.sendTs>=_.sendTs),h=LL(LL({},o),{},{context:r,mediaDelay:n,recvTs:Date.now()});-1===d?c.push(h):c.splice(d,0,h),oN.set(s,c);let p=!1;var m;DT.has(s)?p=!(null===(m=DT.get(s))||void 0===m||!m.isSyncing):DT.set(s,{isSyncing:p,firstRecvTs:0,firstSendTs:0}),p||FL(s)}(s,c,{id:n._clientId,onStreamMessage:"function"==typeof n.onStreamMessage?n.onStreamMessage.bind(n):void 0,safeEmit:n.safeEmit.bind(n)})});return function(s){return r.apply(this,arguments)}}()),this._gateway.signal.on(me.ON_CRYPT_ERROR,()=>{pf(()=>{w.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(et.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(me.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(me.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{w.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Xe.TOKEN_EXPIRE),this.safeEmit(et.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(me.ON_STREAM_FALLBACK_UPDATE,r=>{w.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(r.stream_id,", attr: ").concat(r.stream_type)),this.safeEmit(et.STREAM_FALLBACK,r.stream_id,1===r.stream_type?"fallback":"recover")}),this._gateway.signal.on(me.ON_PUBLISH_STREAM,r=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:r.proxy})),w.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(r))))}),this._gateway.signal.on(me.ENABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!0)}),this._gateway.signal.on(me.DISABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!1)}),this._gateway.signal.on(le.REQUEST_TIMEOUT,(r,s)=>{if(this._joinInfo)switch(r){case be.PUBLISH:{if(!s)return;const h=s.ortc;if(h){var c,d;const p=h.some(g=>{let{stream_type:v}=g;return v===gt.Audio}),m=h.some(g=>{let{stream_type:v}=g;return v!==gt.Audio}),_=h.some(g=>{let{stream_type:v}=g;return v===gt.Screen||v===gt.ScreenLow});"offer"===s.state&&Se.publish(this._joinInfo.sid,{eventElapse:vi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:M.TIMEOUT,audio:p,video:m,p2pid:s.p2p_id,publishRequestid:this.store.pubId,screenshare:_,audioName:p?null===(c=h.find(g=>{let{stream_type:v}=g;return v===gt.Audio}))||void 0===c||null===(c=c.ssrcs[0])||void 0===c?void 0:c.ssrcId.toString():void 0,videoName:m?null===(d=h.find(g=>{let{stream_type:v}=g;return v!==gt.Audio}))||void 0===d||null===(d=d.ssrcs[0])||void 0===d?void 0:d.ssrcId.toString():void 0})}break}case be.SUBSCRIBE:s&&Se.subscribe(this._joinInfo.sid,{succ:!1,ec:M.TIMEOUT,audio:s.stream_type===ge.AUDIO,video:s.stream_type===ge.VIDEO,peerid:s.stream_id,subscribeRequestid:s.ssrcId,p2pid:this.store.p2pId,eventElapse:vi.measureFromSubscribeStart(this.store.clientId,s.ssrcId)})}}),this._gateway.signal.on(me.ON_P2P_OK,r=>{}),this._gateway.signal.on(me.ON_PUBLISHED_USER_LIST,r=>{if(null==r||!r.users)return;B("BLOCK_LOCAL_CLIENT")&&(r.users=r.users.filter(d=>!zc(d.string_id||d.stream_id,this.channelName)));const s=[],c=[];for(const d of r.users){let h=this._users.find(b=>b._uintid===d.stream_id);h?h._trust_in_room_=!0:(h=new Ii(d.string_id||d.stream_id,d.stream_id),this._users.push(h),0===this.getListeners(et.PUBLISHED_USER_LIST).length&&(w.debug("[".concat(this._clientId,"] user online"),d.stream_id),this.safeEmit(et.USER_JOINED,h)));const p=Fn.Audio&d.stream_type,m=(Fn.Video|Fn.LwoVideo)&d.stream_type,_=0!=(65280&d.stream_type),g=p&&h.hasAudio,v=m&&h.hasVideo;m&&(h._trust_video_stream_added_state_=!0,h._video_added_=!0,h._videoSSRC=d.video_ssrc,h._rtxSsrcId=d.video_rtx),p&&(h._trust_audio_stream_added_state_=!0,h._audio_added_=!0,h._audioSSRC=d.audio_ssrc),p&&!g&&0===this.getListeners(et.PUBLISHED_USER_LIST).length&&(w.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published audio")),this.safeEmit(et.USER_PUBLISHED,h,"audio")),m&&!v&&0===this.getListeners(et.PUBLISHED_USER_LIST).length&&(w.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published video")),this.safeEmit(et.USER_PUBLISHED,h,"video")),(p&&!g||m&&!v||_)&&s.push(h),m&&this._p2pChannel.hasPendingRemoteMedia(h,"video")&&c.push({user:h,mediaType:"video"}),p&&this._p2pChannel.hasPendingRemoteMedia(h,"audio")&&c.push({user:h,mediaType:"audio"})}c.length>0&&(w.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(c.map(d=>"user: ".concat(d.user.uid,", mediaType: ").concat(d.mediaType)).join("; ")," ")),this.massSubscribe(c).catch(d=>{w.error("[".concat(this._clientId,"] mass resubscribe error"),d.toString())})),this.getListeners(et.PUBLISHED_USER_LIST).length>0?B("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=s:(w.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(s.map(d=>d.uid).join(", "))),this.safeEmit(et.PUBLISHED_USER_LIST,s)):w.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(s.map(d=>d.uid).join(", ")))})}_handleP2PEvents(){var n=this;this._gateway.signal.on(me.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(xt.PUBLISH,function(){var r=x(function*(s,c){s.forEach(d=>d.kind===ge.VIDEO?(n._handleP2PAddAudioOrVideoStream("video",c),n._handleMuteStream(c,ge.VIDEO,!!d.isMuted)):(n._handleP2PAddAudioOrVideoStream("audio",c),n._handleMuteStream(c,ge.AUDIO,!!d.isMuted)))});return function(s,c){return r.apply(this,arguments)}}()),this._gateway.signal.on(le.P2P_START,function(){var r=x(function*(s,c){var d;n._p2pChannel instanceof fn&&c(yield n._p2pChannel.startP2P({turnServer:null===(d=n._joinInfo)||void 0===d?void 0:d.turnServer},s))});return function(s,c){return r.apply(this,arguments)}}()),this._gateway.signal.on(le.P2P_CONNECTION,function(){var r=x(function*(s){n._p2pChannel instanceof fn&&(yield n._p2pChannel.p2pConnect(s))});return function(s){return r.apply(this,arguments)}}()),this._gateway.signal.on(le.P2P_REMOTE_CANDIDATE_UPDATE,r=>{this._p2pChannel instanceof fn&&this._p2pChannel.addRemoteCandidate(JSON.parse(r))}),this._gateway.signal.on(xt.SUBSCRIBE,function(){var r=x(function*(s,c,d){if(n._p2pChannel instanceof fn){const{trackType:h}=JSON.parse(s);try{yield n._p2pChannel.dopublish(h),c()}catch(p){d(p)}}});return function(s,c,d){return r.apply(this,arguments)}}()),this._gateway.signal.on(xt.UNSUBSCRIBE,function(){var r=x(function*(s,c,d){if(n._p2pChannel instanceof fn){const{mediaType:h}=JSON.parse(s);try{yield n._p2pChannel.doUnpublish(h),c()}catch(p){d(p)}}});return function(s,c,d){return r.apply(this,arguments)}}()),this._gateway.signal.on(xt.EXCHANGE_SDP,function(){var r=x(function*(s,c,d){if(n._p2pChannel instanceof fn){const{type:h,sdp:p}=JSON.parse(s);try{c(yield n._p2pChannel.setDescription(h,p))}catch(m){d(m)}}});return function(s,c,d){return r.apply(this,arguments)}}()),this._gateway.signal.on(xt.UNPUBLISH,function(){var r=x(function*(s,c,d){if(n._p2pChannel instanceof fn){const{unpubMsg:h,uid:p}=s;if(1===h.length){const m=h[0].stream_type===gt.Audio?ge.AUDIO:ge.VIDEO;n._handleMuteStream(p,m,!0);const{sdp:_}=s;if(n._p2pChannel instanceof fn&&_){const g=n._users.find(v=>v.uid===p);if(!g)return w.warning("[".concat(n._clientId,"] can not find remote user, ignore mute event, uid: ").concat(p)),void c();n._p2pChannel.unsubscribe(g,_,m).then(v=>{v&&c(v)}).catch(d)}else c()}else n._handleRemoveStream(s,c,d)}});return function(s,c,d){return r.apply(this,arguments)}}()),this._gateway.signal.on(xt.CONTROL,function(){var r=x(function*(s,c,d){const{action:h,sdp:p,isMuteAll:m,uid:_}=s;switch(h){case fs.MUTE_LOCAL_VIDEO:n._handleMuteStream(_,ge.VIDEO,!0,p,c,d);break;case fs.MUTE_LOCAL_AUDIO:c(),n._handleMuteStream(_,ge.AUDIO,!0);break;case fs.UNMUTE_LOCAL_VIDEO:c(),n._handleP2PAddAudioOrVideoStream("video",_),n._handleMuteStream(_,ge.VIDEO,!1);break;case fs.UNMUTE_LOCAL_AUDIO:c(),n._handleP2PAddAudioOrVideoStream("audio",_),n._handleMuteStream(_,ge.AUDIO,!1)}m&&n._handleRemoveStream(s,c,d)});return function(s,c,d){return r.apply(this,arguments)}}()),this._gateway.signal.on(xt.DO_SUBSCRIBE,function(){var r=x(function*(s,c,d){if(n._p2pChannel instanceof fn){const{kind:h,sdp:p,ssrcId:m,uid:_}=s,g=n._users.find(v=>v.uid===_);if(!g)return w.error("[".concat(n._clientId,"] can not find target user!(on_add_stream)")),void c();try{c(yield n._p2pChannel.subscribe(g,h,p,m))}catch(v){d(v)}}});return function(s,c,d){return r.apply(this,arguments)}}()),this._gateway.signal.on(xt.DO_UNSUBSCRIBE,function(){var r=x(function*(s,c,d){if(n._p2pChannel instanceof fn){const{uid:h,kind:p,sdp:m}=s,_=n._users.find(g=>g.uid===h);if(!_)return w.error("[".concat(n._clientId,"] can not find target user!(on_add_stream)")),void c();try{c(yield n._p2pChannel.unsubscribe(_,m,p))}catch(g){d(g)}}});return function(s,c,d){return r.apply(this,arguments)}}()),this._gateway.signal.on(xt.RESTART_ICE,function(){var r=x(function*(s,c,d){if(n._p2pChannel instanceof fn)try{c(yield n._p2pChannel.setDescription("remote",s))}catch(h){d(h)}});return function(s,c,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(Ae.RequestP2PRestartICE,function(){var r=x(function*(s,c,d){try{c(yield n._gateway.sendExtensionMessage(xt.RESTART_ICE,s))}catch(h){d(h)}});return function(s,c,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(Ae.LocalCandidate,r=>{this._gateway.sendExtensionMessage(xt.CANDIDATE,JSON.stringify(r))}),this._p2pChannel.on(Ae.RequestP2PMuteLocal,function(){var r=x(function*(s,c,d){try{c(yield n._gateway.sendExtensionMessage(xt.CONTROL,s))}catch(h){d(h)}});return function(s,c,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(Ae.RequestP2PPublish,function(){var r=x(function*(s,c,d){try{c(yield n._gateway.sendExtensionMessage(xt.DO_SUBSCRIBE,s))}catch(h){d(h)}});return function(s,c,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(Ae.RequestP2PUnPublish,function(){var r=x(function*(s,c,d){try{c(yield n._gateway.sendExtensionMessage(xt.DO_UNSUBSCRIBE,s))}catch(h){d(h)}});return function(s,c,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(Ae.RequestP2PUnmuteRemote,function(){var r=x(function*(s,c,d){if(n._joinInfo)try{yield n._gateway.unmuteRemote(s,n._joinInfo.stringUid||n._joinInfo.uid),c()}catch(h){h.code===M.DISCONNECT_P2P?c():d(h)}else c()});return function(s,c,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(Ae.RequestP2PMuteRemote,function(){var r=x(function*(s,c,d){if(n._joinInfo)try{yield n._gateway.muteRemote(s,n._joinInfo.stringUid||n._joinInfo.uid),c()}catch(h){h.code===M.DISCONNECT_P2P?c():d(h)}else c()});return function(s,c,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(Ae.StateChange,(r,s)=>{s===at.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){var n=this;this._p2pChannel.on(Ae.RequestMuteLocal,function(){var r=x(function*(s,c,d){if(n._joinInfo)try{yield n._gateway.muteLocal(s,n._joinInfo.stringUid||n._joinInfo.uid),c()}catch(h){h.code===M.DISCONNECT_P2P?c():d(h)}else c()});return function(s,c,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(Ae.RequestUnmuteLocal,function(){var r=x(function*(s,c,d){if(n._joinInfo)try{yield n._gateway.unmuteLocal(s,n._joinInfo.stringUid||n._joinInfo.uid),c()}catch(h){h.code===M.DISCONNECT_P2P?c():d(h)}else c()});return function(s,c,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(Ae.RequestRePublish,(r,s,c)=>{this.publish(r,!1).then(s).catch(c)}),this._p2pChannel.on(Ae.RequestRePublishDataChannel,(r,s,c)=>{z.all(r.map(function(){var d=x(function*(h){yield n._p2pChannel.publishDataChannel([h]);const p={streamId:h.id,ordered:h.ordered,maxRetransmits:h.maxRetransmits,metadata:h.metadata,channelId:h._originDataChannelId};try{yield n._gateway.publishDataChannel(n._uid,p,!0)}catch(m){if(m.code!==M.DISCONNECT_P2P)throw m}});return function(h){return d.apply(this,arguments)}}())).then(s).catch(c)}),this._p2pChannel.on(Ae.RequestReSubscribe,function(){var r=x(function*(s,c,d){try{for(const{user:h,kind:p}of s)p===ge.VIDEO?yield n.subscribe(h,"video"):yield n.subscribe(h,"audio");c()}catch(h){d(h)}});return function(s,c,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(Ae.RequestUploadStats,(r,s)=>{this._gateway.uploadStats(r,s)}),this._p2pChannel.on(Ae.MediaReconnectStart,r=>{this.safeEmit(et.MEDIA_RECONNECT_START,r)}),this._p2pChannel.on(Ae.MediaReconnectEnd,r=>{this.safeEmit(et.MEDIA_RECONNECT_END,r)}),this._p2pChannel.on(Ae.NeedSignalRTT,r=>{r(this._gateway.getSignalRTT())}),this._p2pChannel.on(Ae.RequestRestartICE,function(){var r=x(function*(s){if(n._p2pChannel instanceof fn)return;const c=yield n._p2pChannel.restartICE(s),d=yield c.next();if(d.done)return;const h=d.value;let p;try{p=yield n._gateway.restartICE({iceParameters:h})}catch(_){return void c.throw(_)}const{iceParameters:m}=function(_){const g=_.iceParameters;return{iceParameters:{iceUfrag:g.iceUfrag,icePwd:g.icePwd}}}(p);yield c.next({remoteIceParameters:m})});return function(s){return r.apply(this,arguments)}}()),this._p2pChannel.on(Ae.RequestReconnect,x(function*(){n._gateway.reconnect()})),this._p2pChannel.on(Ae.RequestReconnectPC,x(function*(){var r;const{iceParameters:s,dtlsParameters:c,rtpCapabilities:d}=yield n._p2pChannel.startP2PConnection({turnServer:null===(r=n._joinInfo)||void 0===r?void 0:r.turnServer}),{gatewayEstablishParams:h,gatewayAddress:p}=yield n._gateway.reconnectPC({iceParameters:s,dtlsParameters:c,rtpCapabilities:d}),{dtlsParameters:m,iceParameters:_,candidates:g,rtpCapabilities:v,setup:b,cname:C}=sT(h,p);yield n._p2pChannel.connect(_,m,g,v,b,C),yield n._p2pChannel.republish(),yield n._p2pChannel.reSubscribe()})),this._p2pChannel.on(Ae.RequestUnpublishForReconnectPC,function(){var r=x(function*(s,c,d){n._joinInfo&&void 0!==n._uid?(yield n._gateway.unpublish(s,n._uid),c()):d()});return function(s,c,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(Ae.P2PLost,()=>{this.safeEmit(et.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Ae.UpdateVideoEncoder,r=>{r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig)}),this._p2pChannel.on(Ae.ConnectionTypeChange,r=>{this.safeEmit(et.IS_USING_CLOUD_PROXY,r)}),this._p2pChannel.on(Ae.RequestLowStreamParameter,r=>{r(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Ae.QueryClientConnectionState,r=>{r(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}enableContentInspect(n){var r=this;return x(function*(){if("CONNECTED"!==r.connectionState||!r._joinInfo)throw new G(M.INVALID_OPERATION,"[".concat(r._clientId,"] Client did not join channel"));if(r._inspect)throw new G(M.INVALID_OPERATION,"[".concat(r._clientId,"] Inspect content service already in connecting/connected state"));if(!n)throw new G(M.INVALID_PARAMS,"[".concat(r._clientId,"] inspectConfig is necessary"));if(!n.inspectType||!Array.isArray(n.inspectType))throw new G(M.INVALID_PARAMS,"[".concat(r._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const s=[...new Set(n.inspectType)];s.forEach(c=>{var d;if(!Re(d=["supervise","moderation"]).call(d,c))throw new G(M.INVALID_PARAMS,"[".concat(r._clientId,"] ").concat(c," is not a valid inspect type."))}),n.inspectType=s}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new G(M.INVALID_PARAMS,"[".concat(r._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const s=new ym(n);r._inspect=s,r.handleVideoInspectEvents(r._inspect),yield s.init({appId:r._joinInfo.appId,areaCode:"",cname:r._joinInfo.cname,sid:r._joinInfo.sid,token:r._joinInfo.token,uid:r._joinInfo.uid,cid:r._joinInfo.cid,vid:r._joinInfo.vid?Number(r._joinInfo.vid):0},bn)}catch(s){throw Array.isArray(s)?s[0]:s}})()}disableContentInspect(){var n=this;return x(function*(){if(!n._inspect)throw new G(M.INVALID_OPERATION,"[".concat(n._clientId,"] inspectVideoContent not started"));try{n._inspect.close(),n._inspect=void 0}catch(r){throw Array.isArray(r)?r[0]:r}})()}setImageModeration(n,r){var s=this;return x(function*(){if(jc(n,"enabled"),n){if(!r)throw new G(M.INVALID_PARAMS,"[".concat(s._clientId,"] config is necessary"));if(wt(r.interval,"interval",1e3,1/0),"CONNECTED"!==s.connectionState||!s._joinInfo)throw new G(M.INVALID_OPERATION,"[".concat(s._clientId,'] can not enable image moderation, not joined"'));try{if(s._moderation)return void s._moderation.updateConfig(r);const c=new rN(r);s._moderation=c,s.handleImageModerationEvents(s._moderation),yield c.init({appId:s._joinInfo.appId,areaCode:"",cname:s._joinInfo.cname,sid:s._joinInfo.sid,token:s._joinInfo.token,uid:s._joinInfo.uid,cid:s._joinInfo.cid,vid:s._joinInfo.vid?Number(s._joinInfo.vid):0},bn)}catch(c){throw Array.isArray(c)?c[0]:c}}else{if(!s._moderation)throw new G(M.INVALID_OPERATION,"[".concat(s._clientId,"] image moderation not started"));try{s._moderation.close(),s._moderation.removeAllListeners(),s._moderation=void 0}catch(c){throw Array.isArray(c)?c[0]:c}}})()}handleImageModerationEvents(n){n.on(uo.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(et.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,s),r===Kr.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new G(M.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");n.inspectImage()}}),n.on(uo.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>"video"===s.trackMediaType)[0])})}handleVideoInspectEvents(n){n.on(Jn.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(et.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,s),s===Uo.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit(et.CONTENT_INSPECT_ERROR,new G(M.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));n.inspectImage()}}),n.on(Jn.INSPECT_RESULT,(r,s)=>{var c;if(s?.code===M.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return w.debug("Stop inspect content because that has left channel"),null==this||null===(c=this._inspect)||void 0===c||c.close(),void(this._inspect=void 0);this.safeEmit(et.CONTENT_INSPECT_RESULT,r,s)}),n.on(Jn.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>"video"===s.trackMediaType)[0])})}getJoinChannelServiceRecords(){return w.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}setPublishAudioFilterEnabled(n){var r=this;return x(function*(){jc(n,"enabled"),kt("ENABLE_PUBLISH_AUDIO_FILTER",n),r._joinInfo&&(yield r._gateway.setPublishAudioFilterEnabled(n))})()}_handleResetAddStream(n,r){switch(r){case"audio":n._audio_added_=!1,n._trust_audio_stream_added_state_=!0;break;case"video":n._video_added_=!1,n._trust_video_stream_added_state_=!0}}}ee([Ie(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",z)],Ft.prototype,"leave",null),ee([Ie({argsMap:(o,n)=>{if(!Array.isArray(n)){if(!(n instanceof Li))return[n];n=[n]}return n.map(r=>r?Object(r).toString():"null")}}),O("design:type",Function),O("design:paramtypes",[Object,Boolean]),O("design:returntype",z)],Ft.prototype,"publish",null),ee([Ie({argsMap:(o,n)=>(n||(n=[]),n instanceof bO?[n.getChannelId()]:(Array.isArray(n)||(n=[n]),n.map(r=>r.getTrackId())))}),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",z)],Ft.prototype,"unpublish",null),ee([Ie({argsMap:(o,n,r,s)=>[n.uid,r,s]}),O("design:type",Function),O("design:paramtypes",[Ii,String,Number]),O("design:returntype",z)],Ft.prototype,"subscribe",null),ee([Ie({argsMap:(o,n)=>n.map(r=>{let{user:s,mediaType:c}=r;return[s?.uid,c]})}),O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],Ft.prototype,"massSubscribe",null),ee([Ie({argsMap:(o,n,r,s)=>[n.uid,r,s]}),O("design:type",Function),O("design:paramtypes",[Ii,String,Number]),O("design:returntype",z)],Ft.prototype,"unsubscribe",null),ee([Ie({argsMap:(o,n)=>n.map(r=>{let{user:s,mediaType:c}=r;return{uid:s?.uid,mediaType:c}})}),O("design:type",Function),O("design:paramtypes",[Array]),O("design:returntype",z)],Ft.prototype,"massUnsubscribe",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",z)],Ft.prototype,"setLowStreamParameter",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",z)],Ft.prototype,"enableDualStream",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",z)],Ft.prototype,"disableDualStream",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[String,Object]),O("design:returntype",z)],Ft.prototype,"setClientRole",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[String,Boolean]),O("design:returntype",void 0)],Ft.prototype,"setProxyServer",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[Object,Boolean]),O("design:returntype",void 0)],Ft.prototype,"setTurnServer",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",void 0)],Ft.prototype,"setLicense",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[Number]),O("design:returntype",void 0)],Ft.prototype,"startProxyServer",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],Ft.prototype,"stopProxyServer",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",void 0)],Ft.prototype,"setLocalAccessPointsV2",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[Array,String]),O("design:returntype",void 0)],Ft.prototype,"setLocalAccessPoints",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[Number]),O("design:returntype",z)],Ft.prototype,"setRemoteDefaultVideoStreamType",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[Object,Number]),O("design:returntype",z)],Ft.prototype,"setRemoteVideoStreamType",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[Object,Number]),O("design:returntype",z)],Ft.prototype,"setStreamFallbackOption",null),ee([Ie({argsMap:(o,n)=>[n]}),O("design:type",Function),O("design:paramtypes",[String,String,Uint8Array]),O("design:returntype",void 0)],Ft.prototype,"setEncryptionConfig",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",z)],Ft.prototype,"renewToken",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",void 0)],Ft.prototype,"enableAudioVolumeIndicator",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[String,Boolean]),O("design:returntype",z)],Ft.prototype,"startLiveStreaming",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",z)],Ft.prototype,"setLiveTranscoding",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[String]),O("design:returntype",z)],Ft.prototype,"stopLiveStreaming",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[String,Object]),O("design:returntype",z)],Ft.prototype,"addInjectStreamUrl",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",z)],Ft.prototype,"removeInjectStreamUrl",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[rT]),O("design:returntype",z)],Ft.prototype,"startChannelMediaRelay",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[rT]),O("design:returntype",z)],Ft.prototype,"updateChannelMediaRelay",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",z)],Ft.prototype,"stopChannelMediaRelay",null),ee([Ie({argsMap:(o,n)=>(Array.isArray(n)||(n=[n]),[JSON.stringify(n)])}),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",z)],Ft.prototype,"sendCustomReportMessage",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[Object,Object]),O("design:returntype",z)],Ft.prototype,"pickSVCLayer",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[Number]),O("design:returntype",z)],Ft.prototype,"setRTM2Flag",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[Object]),O("design:returntype",z)],Ft.prototype,"enableContentInspect",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",z)],Ft.prototype,"disableContentInspect",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[Boolean,Object]),O("design:returntype",z)],Ft.prototype,"setImageModeration",null),ee([Ie({reportResult:!0}),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",Array)],Ft.prototype,"getJoinChannelServiceRecords",null),ee([Ie(),O("design:type",Function),O("design:paramtypes",[Boolean]),O("design:returntype",z)],Ft.prototype,"setPublishAudioFilterEnabled",null);const EV=Ve().name;class Av{constructor(n,r){S(this,"id",0),S(this,"element",void 0),S(this,"peerPair",void 0),S(this,"context",void 0),S(this,"audioPlayerElement",void 0),S(this,"audioTrack",void 0),Av.count+=1,this.id=Av.count,this.element=n,this.context=r}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=n=>{const r=document.createElement("audio");r.srcObject=new MediaStream([n.track]),r.play(),this.audioPlayerElement=r}}switchSdp(){var n=this;return x(function*(){if(!n.peerPair)return;const r=function(){var c=x(function*(d,h){const p="offer"===h?yield d.createOffer():yield d.createAnswer();return yield d.setLocalDescription(p),"complete"===d.iceGatheringState?d.localDescription:new z(m=>{d.onicegatheringstatechange=()=>{"complete"===d.iceGatheringState&&m(d.localDescription)}})});return function(h,p){return c.apply(this,arguments)}}(),s=function(){var c=x(function*(d,h){return yield d.setRemoteDescription(h)});return function(h,p){return c.apply(this,arguments)}}();try{const c=yield r(n.peerPair[0],"offer");yield s(n.peerPair[1],c);const d=yield r(n.peerPair[1],"answer");yield s(n.peerPair[0],d)}catch(c){throw new G(M.LOCAL_AEC_ERROR,c.toString()).print()}})()}getTracksFromMediaElement(n){var r=this;return x(function*(){if(r.audioTrack)return r.audioTrack;let s;try{n instanceof HTMLVideoElement&&(n.captureStream?n.captureStream():n.mozCaptureStream()),s=r.context.createMediaStreamDestination(),r.context.createMediaElementSource(n).connect(s)}catch(d){throw new G(M.LOCAL_AEC_ERROR,d.toString()).print()}if(!s)throw new G(M.LOCAL_AEC_ERROR,"no dest node when local aec").print();const c=s.stream.getAudioTracks()[0];return r.audioTrack=c,c})()}getElement(){return this.element}startEchoCancellation(){var n=this;return x(function*(){n.context.resume(),n.peerPair&&n.close(),n.initPeers();const r=n.element,s=yield n.getTracksFromMediaElement(r);n.peerPair&&n.peerPair[0].addTrack(s),yield n.switchSdp()})()}close(){w.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(n=>{n.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}S(Av,"count",0);const vV=window.AudioContext||window.webkitAudioContext;class BL{constructor(){S(this,"units",[]),S(this,"context",void 0)}processExternalMediaAEC(n){if(!this._doesEnvironmentNeedAEC())return w.debug("the system does not need to process local aec"),-1;this.context||(this.context=new vV);let r=this.units.find(s=>s&&s.getElement()===n);return r||(r=new Av(n,this.context),this.units.push(r)),r.startEchoCancellation(),w.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return Ve().name!==_t.SAFARI}}ee([Ie({report:Se}),O("design:type",Function),O("design:paramtypes",[HTMLAudioElement]),O("design:returntype",Number)],BL.prototype,"processExternalMediaAEC",null);const yV=new BL;function jL(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),r.push.apply(r,s)}return r}function HL(o){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?jL(Object(r),!0).forEach(function(s){S(o,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):jL(Object(r)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(r,s))})}return o}const aN=window||document;function GL(o){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!aN)return;const r=si._cspEventHandlerPointer;if(r&&n)return void console.error(r,n);const s=c=>{if(!(c&&c.blockedURI&&(si.onSecurityPolicyViolation||si.getListeners(lo.SECURITY_POLICY_VIOLATION).length>0)))return;const d=c.blockedURI;B("CSP_DETECTED_HOSTNAME_LIST").some(h=>Re(d).call(d,h))&&(si.onSecurityPolicyViolation&&"function"==typeof si.onSecurityPolicyViolation&&si.onSecurityPolicyViolation(c),si.getListeners(lo.SECURITY_POLICY_VIOLATION).length>0&&si.safeEmit(lo.SECURITY_POLICY_VIOLATION,c))};r&&aN.removeEventListener("securitypolicyviolation",r),(n||o&&"function"==typeof o||si.getListeners(lo.SECURITY_POLICY_VIOLATION).length>0)&&aN.addEventListener("securitypolicyviolation",s),si._cspEventHandlerPointer=s}kt("PROCESS_ID","process-".concat(It(8,""),"-").concat(It(4,""),"-").concat(It(4,""),"-").concat(It(4,""),"-").concat(It(12,""))),function(){const o=Ve();Ci.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Ci.getStreamFromExtension=o.name===_t.CHROME&&Number(o.version)>34,Ci.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const n=new RTCPeerConnection;let r=!1;try{n.addTransceiver("audio"),r=!0}catch{}return n.close(),r}(),Ci.supportMinBitrate=o.name===_t.CHROME||o.name===_t.EDGE,Ci.supportSetRtpSenderParameters=function(){const n=Ve();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!cs()||!(!qi()&&!sf())||n.name===_t.FIREFOX&&Number(n.version)>=64)}(),o.name===_t.SAFARI&&(Ci.supportDualStream=Number(o.version)>=14),Ci.webAudioMediaStreamDest=function(){const n=Ve();return!(n.name===_t.SAFARI&&Number(n.version)<12)}(),Ci.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,Ci.supportWebGL=typeof WebGLRenderingContext<"u",Ci.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,cs()||(Ci.webAudioWithAEC=!0),Ci.supportShareAudio=function(){const n=Ve();return(n.os===ei.WIN_10||n.os===ei.WIN_81||n.os===ei.WIN_7||n.os===ei.LINUX||n.os===ei.MAC_OS)&&n.name===_t.CHROME&&Number(n.version)>=74}(),Ci.supportDataChannel=!!(gS(76)||function(n){const r=Ve();return!(r.name!==_t.FIREFOX||!r.osVersion)&&Number(r.version)>=68}()||function(n){const r=Ve();return!(r.name!==_t.SAFARI||!r.osVersion)&&Number(r.version)>=14}()),Ci.supportPCSetConfiguration=function(){const n=window.RTCPeerConnection;return!jt()&&!!n&&n.prototype.setConfiguration instanceof Function}(),Ci.supportWebRTCEncodedTransform=function(){const n=Ve();return"Chrome"===n.name&&Number(n.version)>=86}(),Ci.supportWebRTCInsertableStream=function(){const n=Ve();return(n.name===_t.CHROME||n.name===_t.EDGE)&&Number(n.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),ao(()=>{Ci.supportDualStreamEncoding=function(){const n=Ve();return!!B("DISABLE_WEBAUDIO")||"Safari"===n.name&&Number(n.version)>=14||!!("Chrome"===n.name&&/Windows/i.test(n.os||"")&&Number(n.version)>=100&&B("CHROME_DUAL_STREAM_USE_ENCODING"))}(),w.info("browser compatibility",JSON.stringify(Ci),JSON.stringify(o))})}(),function(){let o;try{o=window.localStorage.getItem("websdk_ng_global_parameter")}catch(n){return void w.error("Error loading sdk config",n.message)}if(o)try{const n=JSON.parse(window.atob(o)),r=Date.now();w.debug("Loading global parameters from cache",n),Object.keys(n).forEach(s=>{if(Object.prototype.hasOwnProperty.call(Yi,s)){const{value:c,expires:d}=n[s];if(d&&d<=r)return;bd[s]=c,Yi[s]=c}})}catch(n){w.error("Error loading mutableParamsCache: ".concat(o),n.message)}}(),Array.isArray(bd.AREAS)&&bd.AREAS.length>0&&XE(bd.AREAS,!0);const si=function(o){const n=new Yt,r=o,s={getListeners:n.getListeners.bind(n),on:(c,d)=>(c===lo.SECURITY_POLICY_VIOLATION&&GL(d,!0),n.on.bind(n)(c,d)),addListener:n.addListener.bind(n),once:n.once.bind(n),off:n.off.bind(n),removeAllListeners:n.removeAllListeners.bind(n),emit:n.emit.bind(n),safeEmit:n.safeEmit.bind(n)};return HL(HL({},r),s)}({__TRACK_LIST__:Id,VERSION:Lo,BUILD:rD,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:(o,n,r)=>{w.debug("setParameter key:".concat(o,", value:").concat(JSON.stringify(n))),kt(o,n,r)},getParameter:B,getSupportedCodec:function(){var o=x(function*(){let n={audio:[],video:[]};try{let r=new RTCPeerConnection;r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});const s=(yield r.createOffer()).sdp;if(!s)return n;r.close(),r=null,n=function(c){const d={video:[],audio:[]};return c.match(/ VP8/i)&&d.video.push("VP8"),c.match(/ VP9/i)&&d.video.push("VP9"),c.match(/ AV1/i)&&d.video.push("AV1"),c.match(/ H264/i)&&d.video.push("H264"),c.match(/ H265/i)&&d.video.push("H265"),c.match(/ opus/i)&&d.audio.push("OPUS"),c.match(/ PCMU/i)&&d.audio.push("PCMU"),c.match(/ PCMA/i)&&d.audio.push("PCMA"),c.match(/ G722/i)&&d.audio.push("G722"),d}(s)}catch(r){throw new G(M.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return n});return function(){return o.apply(this,arguments)}}(),checkSystemRequirements:function(){const o=Se.reportApiInvoke(null,{name:Vn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:dn.TRACER});let n=!1;try{const d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,p=window.WebSocket;n=!!(d&&h&&p)}catch(d){return w.error("check system requirement failed: ",d),!1}let r=!1;const s=Ve();s.name===_t.CHROME&&Number(s.version)>=58&&(!function hA(){return"WebKit"===as.engine.name}()||function wk(){const o=Ve();if(sf()){if(o.os===ei.MAC_OS)return!0;if(o.os===ei.IOS){const n=as.os.version&&as.os.version.split(".");if(n&&14===Number(n[0])&&n[1]&&Number(n[1])>=3||n&&Number(n[0])>14)return!0}}return!1}())&&(r=!0),s.name===_t.FIREFOX&&Number(s.version)>=56&&(r=!0),s.name===_t.OPERA&&Number(s.version)>=45&&(r=!0),s.name===_t.SAFARI&&Number(s.version)>=11&&(r=!0),(vS()||Ve().name===_t.QQ)&&(r=!0),w.debug("checkSystemRequirements, api:",n,"browser",r);const c=n&&r;return o.onSuccess(c),c},getDevices:function(o){return sn.enumerateDevices(!0,!0,o)},getMicrophones:function(o){return sn.getRecordingDevices(o)},getCameras:function(o){return sn.getCamerasDevices(o)},getElectronScreenSources:ID,getPlaybackDevices:function(o){return sn.getSpeakers(o)},createClient:function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=Se.reportApiInvoke(null,{name:Vn.CREATE_CLIENT,options:[o],tag:dn.TRACER});try{Gn((r=o).codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Gn(r.mode,"config.mode",["rtc","live"]),void 0!==r.audioCodec&&Gn(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==r.proxyServer&&fi(r.proxyServer,"config.proxyServer",1,1e4),void 0!==r.turnServer&&TS(r.turnServer),void 0!==r.httpRetryConfig&&CS(r.httpRetryConfig),void 0!==r.websocketRetryConfig&&CS(r.websocketRetryConfig)}catch(r){throw n.onError(r),r}var r;return void 0===o.audioCodec&&(o.audioCodec="opus"),n.onSuccess(),new Ft(Rv(Rv({forceWaitGatewayResponse:!0},o),{},{role:"rtc"===o.mode?"host":o.role||"audience"}))},createCameraVideoTrack:function(){var o=x(function*(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=Se.reportApiInvoke(null,{tag:dn.TRACER,name:Vn.CREATE_CAM_VIDEO_TRACK,options:[jf({},n)]}),s=vE(n),c=It(8,"track-cam-");let d=null;w.info("start create camera video track with config",JSON.stringify(n),"trackId",c);try{d=(yield fo({video:s},c)).getVideoTracks()[0]||null}catch(p){throw r.onError(p),p}if(!d){const p=new Q(M.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(p),p.throw(w)}n.optimizationMode&&wE(c,d,n,sc(n.encoderConfig));const h=new uc(d,n,s,n.scalabiltyMode?Nf(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,c);return r.onSuccess(h.getTrackId()),w.info("create camera video success, trackId:",c),h});return function(){return o.apply(this,arguments)}}(),createCustomVideoTrack:function(o){const n=Se.reportApiInvoke(null,{tag:dn.TRACER,name:Vn.CREATE_CUSTOM_VIDEO_TRACK,options:[o]}),r=new We(o.mediaStreamTrack,{width:o.width,height:o.height,frameRate:o.frameRate,bitrateMax:o.bitrateMax,bitrateMin:o.bitrateMin},o.scalabiltyMode?Nf(o.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},o.optimizationMode,It(8,"track-cus-"),[Vt.CUSTOM_TRACK]);return n.onSuccess(r.getTrackId()),w.info("create custom video track success with config",o,"trackId",r.getTrackId()),r},createScreenVideoTrack:function(){var o=x(function*(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const s=Se.reportApiInvoke(null,{tag:dn.TRACER,name:Vn.CREATE_SCREEN_VIDEO_TRACK,options:[jf({},n),r]});n.encoderConfig?"string"==typeof n.encoderConfig||n.encoderConfig.width&&n.encoderConfig.height||(n.encoderConfig.width={max:1920},n.encoderConfig.height={max:1080}):n.encoderConfig="1080p_2";const c=function(v){const b={};v.screenSourceType&&(b.mediaSource=v.screenSourceType),v.extensionId&&Lg()&&(b.extensionId=v.extensionId);const{displaySurface:C,selfBrowserSurface:N,surfaceSwitching:P,systemAudio:D}=v;(gS(107)||pA(107)||eh(93))&&(C&&(Gn(C,"displaySurface",["browser","window","monitor"]),b.displaySurface=C),N?(Gn(N,"selfBrowserSurface",["exclude","include"]),b.selfBrowserSurface=N):b.selfBrowserSurface="include",P&&(Gn(P,"surfaceSwitching",["exclude","include"]),b.surfaceSwitching=P)),(gS(105)||pA(105)||eh(91))&&D&&(Gn(D,"systemAudio",["exclude","include"]),b.systemAudio=D),v.electronScreenSourceId&&(b.sourceId=v.electronScreenSourceId);const k=v.encoderConfig?pE(v.encoderConfig):null;return b.mandatory={chromeMediaSource:"desktop",maxWidth:k?k.width:void 0,maxHeight:k?k.height:void 0},k&&(k.frameRate&&("number"==typeof k.frameRate?(b.mandatory.maxFrameRate=k.frameRate,b.mandatory.minFrameRate=k.frameRate):(b.mandatory.maxFrameRate=k.frameRate.max||k.frameRate.ideal||k.frameRate.exact||void 0,b.mandatory.minFrameRate=k.frameRate.min||k.frameRate.ideal||k.frameRate.exact||void 0),b.frameRate=k.frameRate),k.width&&(b.width=k.width),k.height&&(b.height=k.height)),b}(n),d=It(8,"track-scr-v-");let h=null,p=null;const m=Lt();if(!m.supportShareAudio&&"enable"===r){const v=new Q(M.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return s.onError(v),v.throw(w)}w.info("start create screen video track with config",n,"withAudio",r,"trackId",d);try{const v=yield fo({screen:c,screenAudio:"auto"===r?m.supportShareAudio:"enable"===r},d);h=v.getVideoTracks()[0]||null,p=v.getAudioTracks()[0]||null}catch(v){throw s.onError(v),v}if(!h){const v=new Q(M.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(v),v.throw(w)}if(!p&&"enable"===r){h&&h.stop();const v=new Q(M.SHARE_AUDIO_NOT_ALLOWED);return s.onError(v),v.throw(w)}n.optimizationMode||(n.optimizationMode="detail"),n.optimizationMode&&(wE(d,h,n,n.encoderConfig&&pE(n.encoderConfig)||void 0),n.encoderConfig&&"string"!=typeof n.encoderConfig&&(n.encoderConfig.bitrateMin=n.encoderConfig.bitrateMax));const _=new We(h,n.encoderConfig?pE(n.encoderConfig):{},n.scalabiltyMode?Nf(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,d,[Vt.SCREEN_TRACK]);if(!p)return s.onSuccess(_.getTrackId()),w.info("create screen video track success","video:",_.getTrackId()),_;const g=new mt(p,void 0,It(8,"track-scr-a-"),!1,!0);return s.onSuccess([_.getTrackId(),g.getTrackId()]),w.info("create screen video track success","video:",_.getTrackId(),"audio:",g.getTrackId()),[_,g]});return function(){return o.apply(this,arguments)}}(),createMicrophoneAndCameraTracks:function(){var o=x(function*(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=Se.reportApiInvoke(null,{tag:dn.TRACER,name:Vn.CREATE_MIC_AND_CAM_TRACKS,options:[n,r]}),c=vE(r),d=yE(n),h=It(8,"track-mic-"),p=It(8,"track-cam-");let m=null,_=null;w.info("start create camera video track(".concat(p,") and microphone audio track(").concat(h,") with config, audio: ").concat(JSON.stringify(n),", video: ").concat(JSON.stringify(r)));try{const b=yield fo({audio:d,video:c},"".concat(h,"-").concat(p));m=b.getAudioTracks()[0],_=b.getVideoTracks()[0]}catch(b){throw s.onError(b),b}if(!m||!_){const b=new Q(M.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(b),b.throw(w)}r.optimizationMode&&wE(p,_,r,sc(r.encoderConfig));const g=new Zc(m,n,d,h),v=new uc(_,r,c,r.scalabiltyMode?Nf(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,p);return s.onSuccess([g.getTrackId(),v.getTrackId()]),w.info("create camera video track(".concat(p,") and microphone audio track(").concat(h,") success")),[g,v]});return function(){return o.apply(this,arguments)}}(),createMicrophoneAudioTrack:function(){var o=x(function*(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=Se.reportApiInvoke(null,{tag:dn.TRACER,name:Vn.CREATE_MIC_AUDIO_TRACK,options:[n]}),s=yE(n),c=It(8,"track-mic-");let d=null;w.info("start create microphone audio track with config",JSON.stringify(n),"trackId",c);try{d=(yield fo({audio:s},c)).getAudioTracks()[0]||null}catch(p){throw r.onError(p),p}if(!d){const p=new Q(M.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(p),p.throw(w)}const h=new Zc(d,n,s,c);return r.onSuccess(h.getTrackId()),w.info("create microphone audio track success, trackId:",c),h});return function(){return o.apply(this,arguments)}}(),createCustomAudioTrack:function(o){const n=Se.reportApiInvoke(null,{tag:dn.TRACER,name:Vn.CREATE_CUSTOM_AUDIO_TRACK,options:[o]}),r=new mt(o.mediaStreamTrack,o.encoderConfig?bh(o.encoderConfig):{},It(8,"track-cus-"),!1,!0);return w.info("create custom audio track success with config",o,"trackId",r.getTrackId()),n.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:function(){var o=x(function*(n){var r;const{cacheOnlineFile:s,encoderConfig:c}=n;let{source:d}=n;const h={source:d instanceof AudioBuffer?"AudioBuffer":d instanceof File?null!==(r=File.name)&&void 0!==r?r:"File":d,cacheOnlineFile:s,encoderConfig:c},p=Se.reportApiInvoke(null,{tag:dn.TRACER,name:Vn.CREATE_BUFFER_AUDIO_TRACK,options:[h]});if(B("DISABLE_WEBAUDIO"))throw new Q(M.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const m=It(8,"track-buf-");w.info("start create buffer source audio track with config",JSON.stringify(h),"trackId",m);const _=d;if(!(d instanceof AudioBuffer))try{d=yield function Cx(o,n){return Bf.apply(this,arguments)}(d,s)}catch(b){return p.onError(b),b.throw(w)}const g=new Sx(d),v=new Ra(_,g,c?bh(c):{},m);return w.info("create buffer source audio track success, trackId:",m),p.onSuccess(v.getTrackId()),v});return function(r){return o.apply(this,arguments)}}(),setAppType:function(o){if(w.debug("setAppType: ".concat(o)),!(Number.isInteger(o)&&o>=0))throw w.debug("Invalid appType"),new G(M.INVALID_PARAMS,"invalid app type",o);kt("APP_TYPE",Math.floor(o))},setLogLevel:function(o){w.setLogLevel(o)},enableLogUpload:function(){B("USE_NEW_LOG")?kt("UPLOAD_LOG",!0):w.enableLogUpload()},disableLogUpload:function(){B("USE_NEW_LOG")?kt("UPLOAD_LOG",!1):w.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new rT},checkAudioTrackIsActive:function(){var o=x(function*(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const s=Se.reportApiInvoke(null,{tag:dn.TRACER,name:Vn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(n instanceof mt||n instanceof go)){const _=new G(M.INVALID_TRACK,"the parameter is not a audio track");return s.onError(_),_.throw()}r&&r<1e3&&(r=1e3);const c=n instanceof mt?n.getTrackLabel():"remote_track",d=n.getVolumeLevel();let h=d,p=d;const m=Date.now();return new z(_=>{const g=setInterval(()=>{const v=n.getVolumeLevel();h=v>h?v:h,p=v<p?v:p;const b=h-p>1e-4,C=Date.now()-m;if(b||C>r){clearInterval(g);const N=b,P={duration:C,deviceLabel:c,maxVolumeLevel:h,result:N};w.info("[track-".concat(n.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(P))),s.onSuccess(P),_(N)}},200)})});return function(r){return o.apply(this,arguments)}}(),checkVideoTrackIsActive:function(){var o=x(function*(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const s=Se.reportApiInvoke(null,{tag:dn.TRACER,name:Vn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(n instanceof We||n instanceof Ks)){const b=new G(M.INVALID_TRACK,"the parameter is not a video track");return s.onError(b),b.throw()}r&&r<1e3&&(r=1e3);const c=n instanceof We?n.getTrackLabel():"remote_track",d=n.getMediaStreamTrack(!0),h=document.createElement("video");h.style.width="1px",h.style.height="1px",h.setAttribute("muted",""),h.muted=!0,h.setAttribute("playsinline",""),h.controls=!1,(qi()||sf())&&(h.style.opacity="0.01",h.style.position="fixed",h.style.left="0",h.style.top="0",document.body.appendChild(h)),h.srcObject=new MediaStream([d]),h.play();const p=document.createElement("canvas");p.width=160,p.height=120;let m=0,_=0;try{const b=Date.now();m=yield function(C,N,P,D){let k,V=0,U=null;return new z((Y,oe)=>{setTimeout(()=>{k&&(k(),Y(V))},N),k=gC(()=>{!function K(){V>D&&k&&(k(),Y(V));const X=P.getContext("2d");if(!X){const ve=new G(M.UNEXPECTED_ERROR,"can not get canvas 2d context.");return w.error(ve.toString()),void oe(ve)}X.drawImage(C,0,0,160,120);const $=X.getImageData(0,0,P.width,P.height),J=Math.floor($.data.length/3);if(U){for(let ve=0;ve<J;ve+=3)if($.data[ve]!==U[ve])return V+=1,void(U=$.data);U=$.data}else U=$.data}()},30)})}(h,r,p,4),_=Date.now()-b}catch(b){throw s.onError(b),b}EV===_t.SAFARI&&(h.pause(),h.remove()),h.srcObject=null;const g=m>4,v={duration:_,changedPicNum:m,deviceLabel:c,result:g};return w.info("[track-".concat(n.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(v))),s.onSuccess(v),g});return function(r){return o.apply(this,arguments)}}(),setArea:XE,audioElementPlayCenter:Rr,processExternalMediaAEC:function(o){yV.processExternalMediaAEC(o)},registerExtensions:function(o){o.forEach(n=>{const r=n;r.__registered__=!0,r.logger.hookLog=w.extLog,r.reporter.hookApiInvoke=Se.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach(s=>{r.parameters[s]=B(s)})})},ChannelMediaRelayError:Td,ChannelMediaRelayEvent:zs,ChannelMediaRelayState:Xi,RemoteStreamFallbackType:Sh,RemoteStreamType:fE,ConnectionDisconnectedReason:Xe,AudienceLatencyLevelType:SS,AREAS:ot});return Object.defineProperties(si,{onAudioAutoplayFailed:{get:()=>Ut.onAudioAutoplayFailed,set:o=>{Ut.onAudioAutoplayFailed=o}},onAutoplayFailed:{get:()=>Ut.onAutoplayFailed,set:o=>{Ut.onAutoplayFailed=o}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>si._onSecurityPolicyViolation,set(o){si._onSecurityPolicyViolation=o,GL(o)}},__CLIENT_LIST__:{get:()=>B("SHOW_GLOBAL_CLIENT_LIST")?Wc:[]}}),sn.on(cc.CAMERA_DEVICE_CHANGED,o=>{w.info("camera device changed",JSON.stringify(o)),si.onCameraChanged&&si.onCameraChanged(o),si.safeEmit(lo.CAMERA_CHANGED,o)}),sn.on(cc.RECORDING_DEVICE_CHANGED,o=>{w.info("microphone device changed",JSON.stringify(o)),si.onMicrophoneChanged&&si.onMicrophoneChanged(o),si.safeEmit(lo.MICROPHONE_CHANGED,o)}),sn.on(cc.PLAYOUT_DEVICE_CHANGED,o=>{w.debug("playout device changed",JSON.stringify(o)),si.onPlaybackDeviceChanged&&si.onPlaybackDeviceChanged(o),si.safeEmit(lo.PLAYBACK_DEVICE_CHANGED,o)}),Rr.onAutoplayFailed=()=>{w.info("detect audio element autoplay failed"),Ut.onAudioAutoplayFailed&&Ut.onAudioAutoplayFailed()},it.on("autoplay-failed",()=>{w.info("detect webaudio autoplay failed"),Ut.onAudioAutoplayFailed&&Ut.onAudioAutoplayFailed(),si.safeEmit(lo.AUTOPLAY_FAILED)}),Rn.on(ic.NETWORK_STATE_CHANGE,(o,n)=>{w.info("[network-indicator] network state changed, ".concat(n," => ").concat(o))}),window&&(window.__ARTC__=si),si}()},156:bc=>{function Lm(x,Sc,Zi,Ko,qo,lr,ja){try{var ru=x[lr](ja),Yo=ru.value}catch(mn){return void Zi(mn)}ru.done?Sc(Yo):Promise.resolve(Yo).then(Ko,qo)}bc.exports=function Fm(x){return function(){var Sc=this,Zi=arguments;return new Promise(function(Ko,qo){var lr=x.apply(Sc,Zi);function ja(Yo){Lm(lr,Ko,qo,ja,ru,"next",Yo)}function ru(Yo){Lm(lr,Ko,qo,ja,ru,"throw",Yo)}ja(void 0)})}},bc.exports.__esModule=!0,bc.exports.default=bc.exports}},bc=>{bc(bc.s=149)}]);