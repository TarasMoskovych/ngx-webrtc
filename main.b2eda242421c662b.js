(self.webpackChunkngx_webrtc=self.webpackChunkngx_webrtc||[]).push([[792],{631:(Yl,CE,Im)=>{"use strict";function L(e,n){return Object.is(e,n)}let Sr=null,Ji=!1,Ht=1;const Pt=Symbol("SIGNAL");function gt(e){const n=Sr;return Sr=e,n}const pu={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function xn(e){if(Ji)throw new Error("");if(null===Sr)return;Sr.consumerOnSignalRead(e);const n=Sr.nextProducerIndex++;RE(Sr),n<Sr.producerNode.length&&Sr.producerNode[n]!==e&&Ho(Sr)&&IE(Sr.producerNode[n],Sr.producerIndexOfThis[n]),Sr.producerNode[n]!==e&&(Sr.producerNode[n]=e,Sr.producerIndexOfThis[n]=Ho(Sr)?sN(e,Sr,n):0),Sr.producerLastReadVersion[n]=e.version}function Rm(e){if((!Ho(e)||e.dirty)&&(e.dirty||e.lastCleanEpoch!==Ht)){if(!e.producerMustRecompute(e)&&!rp(e))return e.dirty=!1,void(e.lastCleanEpoch=Ht);e.producerRecomputeValue(e),e.dirty=!1,e.lastCleanEpoch=Ht}}function tr(e){if(void 0===e.liveConsumerNode)return;const n=Ji;Ji=!0;try{for(const t of e.liveConsumerNode)t.dirty||vT(t)}finally{Ji=n}}function oN(){return!1!==Sr?.consumerAllowSignalWrites}function vT(e){e.dirty=!0,tr(e),e.consumerMarkedDirty?.(e)}function Am(e){return e&&(e.nextProducerIndex=0),gt(e)}function TE(e,n){if(gt(n),e&&void 0!==e.producerNode&&void 0!==e.producerIndexOfThis&&void 0!==e.producerLastReadVersion){if(Ho(e))for(let t=e.nextProducerIndex;t<e.producerNode.length;t++)IE(e.producerNode[t],e.producerIndexOfThis[t]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}function rp(e){RE(e);for(let n=0;n<e.producerNode.length;n++){const t=e.producerNode[n],s=e.producerLastReadVersion[n];if(s!==t.version||(Rm(t),s!==t.version))return!0}return!1}function wE(e){if(RE(e),Ho(e))for(let n=0;n<e.producerNode.length;n++)IE(e.producerNode[n],e.producerIndexOfThis[n]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}function sN(e,n,t){if(aN(e),0===e.liveConsumerNode.length&&ip(e))for(let s=0;s<e.producerNode.length;s++)e.producerIndexOfThis[s]=sN(e.producerNode[s],e,s);return e.liveConsumerIndexOfThis.push(t),e.liveConsumerNode.push(n)-1}function IE(e,n){if(aN(e),1===e.liveConsumerNode.length&&ip(e))for(let s=0;s<e.producerNode.length;s++)IE(e.producerNode[s],e.producerIndexOfThis[s]);const t=e.liveConsumerNode.length-1;if(e.liveConsumerNode[n]=e.liveConsumerNode[t],e.liveConsumerIndexOfThis[n]=e.liveConsumerIndexOfThis[t],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,n<e.liveConsumerNode.length){const s=e.liveConsumerIndexOfThis[n],c=e.liveConsumerNode[n];RE(c),c.producerIndexOfThis[s]=n}}function Ho(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function RE(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}function aN(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}function ip(e){return void 0!==e.producerNode}function AE(e){const n=Object.create(Dm);n.computation=e;const t=()=>{if(Rm(n),xn(n),n.value===dr)throw n.error;return n.value};return t[Pt]=n,t}const op=Symbol("UNSET"),ET=Symbol("COMPUTING"),dr=Symbol("ERRORED"),Dm={...pu,value:op,dirty:!0,error:null,equal:L,producerMustRecompute:e=>e.value===op||e.value===ET,producerRecomputeValue(e){if(e.value===ET)throw new Error("Detected cycle in computations.");const n=e.value;e.value=ET;const t=Am(e);let s;try{s=e.computation()}catch(c){s=dr,e.error=c}finally{TE(e,t)}n!==op&&n!==dr&&s!==dr&&e.equal(n,s)?e.value=n:(e.value=s,e.version++)}};let cN=function ms(){throw new Error};function Om(){cN()}let fu=null;function Hc(e,n){oN()||Om(),e.equal(e.value,n)||(e.value=n,function uV(e){e.version++,function Ri(){Ht++}(),tr(e),fu?.()}(e))}const dV={...pu,equal:L,value:void 0};function vn(e){return"function"==typeof e}function ST(e){const t=e(s=>{Error.call(s),s.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const Xl=ST(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((s,c)=>`${c+1}) ${s.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function NE(e,n){if(e){const t=e.indexOf(n);0<=t&&e.splice(t,1)}}class Ur{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const u of t)u.remove(this);else t.remove(this);const{initialTeardown:s}=this;if(vn(s))try{s()}catch(u){n=u instanceof Xl?u.errors:[u]}const{_finalizers:c}=this;if(c){this._finalizers=null;for(const u of c)try{dN(u)}catch(p){n=n??[],p instanceof Xl?n=[...n,...p.errors]:n.push(p)}}if(n)throw new Xl(n)}}add(n){var t;if(n&&n!==this)if(this.closed)dN(n);else{if(n instanceof Ur){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(n)}}_hasParent(n){const{_parentage:t}=this;return t===n||Array.isArray(t)&&t.includes(n)}_addParent(n){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(n),t):t?[t,n]:n}_removeParent(n){const{_parentage:t}=this;t===n?this._parentage=null:Array.isArray(t)&&NE(t,n)}remove(n){const{_finalizers:t}=this;t&&NE(t,n),n instanceof Ur&&n._removeParent(this)}}Ur.EMPTY=(()=>{const e=new Ur;return e.closed=!0,e})();const Gc=Ur.EMPTY;function CT(e){return e instanceof Ur||e&&"closed"in e&&vn(e.remove)&&vn(e.add)&&vn(e.unsubscribe)}function dN(e){vn(e)?e():e.unsubscribe()}const ri={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Qi={setTimeout(e,n,...t){const{delegate:s}=Qi;return s?.setTimeout?s.setTimeout(e,n,...t):setTimeout(e,n,...t)},clearTimeout(e){const{delegate:n}=Qi;return(n?.clearTimeout||clearTimeout)(e)},delegate:void 0};function PE(e){Qi.setTimeout(()=>{const{onUnhandledError:n}=ri;if(!n)throw e;n(e)})}function Pm(){}const hV=rc("C",void 0,void 0);function rc(e,n,t){return{kind:e,value:n,error:t}}let Zl=null;function sp(e){if(ri.useDeprecatedSynchronousErrorHandling){const n=!Zl;if(n&&(Zl={errorThrown:!1,error:null}),e(),n){const{errorThrown:t,error:s}=Zl;if(Zl=null,t)throw s}}else e()}class ME extends Ur{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,CT(n)&&n.add(this)):this.destination=fN}static create(n,t,s){return new ap(n,t,s)}next(n){this.isStopped?Jl(function yo(e){return rc("N",e,void 0)}(n),this):this._next(n)}error(n){this.isStopped?Jl(function uN(e){return rc("E",void 0,e)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?Jl(hV,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const pN=Function.prototype.bind;function kE(e,n){return pN.call(e,n)}class gu{constructor(n){this.partialObserver=n}next(n){const{partialObserver:t}=this;if(t.next)try{t.next(n)}catch(s){LE(s)}}error(n){const{partialObserver:t}=this;if(t.error)try{t.error(n)}catch(s){LE(s)}else LE(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(t){LE(t)}}}class ap extends ME{constructor(n,t,s){let c;if(super(),vn(n)||!n)c={next:n??void 0,error:t??void 0,complete:s??void 0};else{let u;this&&ri.useDeprecatedNextContext?(u=Object.create(n),u.unsubscribe=()=>this.unsubscribe(),c={next:n.next&&kE(n.next,u),error:n.error&&kE(n.error,u),complete:n.complete&&kE(n.complete,u)}):c=n}this.destination=new gu(c)}}function LE(e){ri.useDeprecatedSynchronousErrorHandling?function hN(e){ri.useDeprecatedSynchronousErrorHandling&&Zl&&(Zl.errorThrown=!0,Zl.error=e)}(e):PE(e)}function Jl(e,n){const{onStoppedNotification:t}=ri;t&&Qi.setTimeout(()=>t(e,n))}const fN={closed:!0,next:Pm,error:function pV(e){throw e},complete:Pm},TT="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ql(e){return e}function mN(e){return 0===e.length?Ql:1===e.length?e[0]:function(t){return e.reduce((s,c)=>c(s),t)}}let nr=(()=>{class e{constructor(t){t&&(this._subscribe=t)}lift(t){const s=new e;return s.source=this,s.operator=t,s}subscribe(t,s,c){const u=function mV(e){return e&&e instanceof ME||function cp(e){return e&&vn(e.next)&&vn(e.error)&&vn(e.complete)}(e)&&CT(e)}(t)?t:new ap(t,s,c);return sp(()=>{const{operator:p,source:_}=this;u.add(p?p.call(u,_):_?this._subscribe(u):this._trySubscribe(u))}),u}_trySubscribe(t){try{return this._subscribe(t)}catch(s){t.error(s)}}forEach(t,s){return new(s=gN(s))((c,u)=>{const p=new ap({next:_=>{try{t(_)}catch(E){u(E),p.unsubscribe()}},error:u,complete:c});this.subscribe(p)})}_subscribe(t){var s;return null===(s=this.source)||void 0===s?void 0:s.subscribe(t)}[TT](){return this}pipe(...t){return mN(t)(this)}toPromise(t){return new(t=gN(t))((s,c)=>{let u;this.subscribe(p=>u=p,p=>c(p),()=>s(u))})}}return e.create=n=>new e(n),e})();function gN(e){var n;return null!==(n=e??ri.Promise)&&void 0!==n?n:Promise}const gV=ST(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Gt=(()=>{class e extends nr{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const s=new Go(this,this);return s.operator=t,s}_throwIfClosed(){if(this.closed)throw new gV}next(t){sp(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const s of this.currentObservers)s.next(t)}})}error(t){sp(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:s}=this;for(;s.length;)s.shift().error(t)}})}complete(){sp(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:s,isStopped:c,observers:u}=this;return s||c?Gc:(this.currentObservers=null,u.push(t),new Ur(()=>{this.currentObservers=null,NE(u,t)}))}_checkFinalizedStatuses(t){const{hasError:s,thrownError:c,isStopped:u}=this;s?t.error(c):u&&t.complete()}asObservable(){const t=new nr;return t.source=this,t}}return e.create=(n,t)=>new Go(n,t),e})();class Go extends Gt{constructor(n,t){super(),this.destination=n,this.source=t}next(n){var t,s;null===(s=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===s||s.call(t,n)}error(n){var t,s;null===(s=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===s||s.call(t,n)}complete(){var n,t;null===(t=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===t||t.call(n)}_subscribe(n){var t,s;return null!==(s=null===(t=this.source)||void 0===t?void 0:t.subscribe(n))&&void 0!==s?s:Gc}}class gs extends Gt{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const t=super._subscribe(n);return!t.closed&&n.next(this._value),t}getValue(){const{hasError:n,thrownError:t,_value:s}=this;if(n)throw t;return this._throwIfClosed(),s}next(n){super.next(this._value=n)}}function _N(e){return vn(e?.lift)}function Cr(e){return n=>{if(_N(n))return n.lift(function(t){try{return e(t,this)}catch(s){this.error(s)}});throw new TypeError("Unable to lift unknown Observable type")}}function Er(e,n,t,s,c){return new wT(e,n,t,s,c)}class wT extends ME{constructor(n,t,s,c,u,p){super(n),this.onFinalize=u,this.shouldUnsubscribe=p,this._next=t?function(_){try{t(_)}catch(E){n.error(E)}}:super._next,this._error=c?function(_){try{c(_)}catch(E){n.error(E)}finally{this.unsubscribe()}}:super._error,this._complete=s?function(){try{s()}catch(_){n.error(_)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function en(e,n){return Cr((t,s)=>{let c=0;t.subscribe(Er(s,u=>{s.next(e.call(n,u,c++))}))})}const IT="https://g.co/ng/security#xss";class ae extends Error{constructor(n,t){super(function lp(e,n){return`NG0${Math.abs(e)}${n?": "+n:""}`}(n,t)),this.code=n}}function Wc(e){return{toString:e}.toString()}function Wn(e){for(let n in e)if(e[n]===Wn)return n;throw Error("Could not find renamed property on target object.")}function bN(e,n){for(const t in n)n.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&(e[t]=n[t])}function fi(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(fi).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const n=e.toString();if(null==n)return""+n;const t=n.indexOf("\n");return-1===t?n:n.substring(0,t)}function AT(e,n){return null==e||""===e?null===n?"":n:null==n||""===n?e:e+" "+n}globalThis;const pp=Wn({__forward_ref__:Wn});function Fn(e){return e.__forward_ref__=Fn,e.toString=function(){return fi(this())},e}function ht(e){return En(e)?e():e}function En(e){return"function"==typeof e&&e.hasOwnProperty(pp)&&e.__forward_ref__===Fn}function Oe(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function qr(e){return{providers:e.providers||[],imports:e.imports||[]}}function UE(e){return TN(e,td)||TN(e,wN)}function TN(e,n){return e.hasOwnProperty(n)?e[n]:null}function VE(e){return e&&(e.hasOwnProperty(OT)||e.hasOwnProperty(SV))?e[OT]:null}const td=Wn({\u0275prov:Wn}),OT=Wn({\u0275inj:Wn}),wN=Wn({ngInjectableDef:Wn}),SV=Wn({ngInjectorDef:Wn});class Te{constructor(n,t){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Oe({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function Ai(e){return e&&!!e.\u0275providers}const Mm=Wn({\u0275cmp:Wn}),MT=Wn({\u0275dir:Wn}),kT=Wn({\u0275pipe:Wn}),km=Wn({\u0275mod:Wn}),ic=Wn({\u0275fac:Wn}),Lm=Wn({__NG_ELEMENT_ID__:Wn}),jE=Wn({__NG_ENV_ID__:Wn});function wt(e){return"string"==typeof e?e:null==e?"":String(e)}function fp(e,n){throw new ae(-201,!1)}var Yt=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(Yt||{});let xT;function AN(){return xT}function zo(e){const n=xT;return xT=e,n}function DN(e,n,t){const s=UE(e);return s&&"root"==s.providedIn?void 0===s.value?s.value=s.factory():s.value:t&Yt.Optional?null:void 0!==n?n:void fp()}const oc={},HE="__NG_DI_FLAG__",GE="ngTempTokenPath",wV=/\n/gm,ON="__source";let mp;function id(e){const n=mp;return mp=e,n}function RV(e,n=Yt.Default){if(void 0===mp)throw new ae(-203,!1);return null===mp?DN(e,void 0,n):mp.get(e,n&Yt.Optional?null:void 0,n)}function ye(e,n=Yt.Default){return(AN()||RV)(ht(e),n)}function me(e,n=Yt.Default){return ye(e,zE(n))}function zE(e){return typeof e>"u"||"number"==typeof e?e:(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function KE(e){const n=[];for(let t=0;t<e.length;t++){const s=ht(e[t]);if(Array.isArray(s)){if(0===s.length)throw new ae(900,!1);let c,u=Yt.Default;for(let p=0;p<s.length;p++){const _=s[p],E=zc(_);"number"==typeof E?-1===E?c=_.token:u|=E:c=_}n.push(ye(c,u))}else n.push(ye(s))}return n}function zc(e){return e[HE]}function Di(e,n){return e.hasOwnProperty(ic)?e[ic]:null}function gp(e,n){e.forEach(t=>Array.isArray(t)?gp(t,n):n(t))}function NN(e,n,t){n>=e.length?e.push(t):e.splice(n,0,t)}function Um(e,n){return n>=e.length-1?e.pop():e.splice(n,1)[0]}function vs(e,n,t){let s=vp(e,n);return s>=0?e[1|s]=t:(s=~s,function $E(e,n,t,s){let c=e.length;if(c==n)e.push(t,s);else if(1===c)e.push(s,e[0]),e[0]=t;else{for(c--,e.push(e[c-1],e[c]);c>n;)e[c]=e[c-2],c--;e[n]=t,e[n+1]=s}}(e,s,n,t)),s}function _p(e,n){const t=vp(e,n);if(t>=0)return e[1|t]}function vp(e,n){return function PN(e,n,t){let s=0,c=e.length>>t;for(;c!==s;){const u=s+(c-s>>1),p=e[u<<t];if(n===p)return u<<t;p>n?c=u:s=u+1}return~(c<<t)}(e,n,1)}const mi={},dn=[],sc=new Te(""),qo=new Te("",-1),jT=new Te("");class XE{get(n,t=oc){if(t===oc){const s=new Error(`NullInjectorError: No provider for ${fi(n)}!`);throw s.name="NullInjectorError",s}return t}}var ZE=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(ZE||{}),ca=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(ca||{}),Kc=function(e){return e[e.None=0]="None",e[e.SignalBased=1]="SignalBased",e[e.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",e}(Kc||{});function kV(e,n,t){let s=e.length;for(;;){const c=e.indexOf(n,t);if(-1===c)return c;if(0===c||e.charCodeAt(c-1)<=32){const u=n.length;if(c+u===s||e.charCodeAt(c+u)<=32)return c}t=c+1}}function HT(e,n,t){let s=0;for(;s<t.length;){const c=t[s];if("number"==typeof c){if(0!==c)break;s++;const u=t[s++],p=t[s++],_=t[s++];e.setAttribute(n,p,_,u)}else{const u=c,p=t[++s];GT(u)?e.setProperty(n,u,p):e.setAttribute(n,u,p),s++}}return s}function MN(e){return 3===e||4===e||6===e}function GT(e){return 64===e.charCodeAt(0)}function Vm(e,n){if(null!==n&&0!==n.length)if(null===e||0===e.length)e=n.slice();else{let t=-1;for(let s=0;s<n.length;s++){const c=n[s];"number"==typeof c?t=c:0===t||kN(e,t,c,null,-1===t||2===t?n[++s]:null)}}return e}function kN(e,n,t,s,c){let u=0,p=e.length;if(-1===n)p=-1;else for(;u<e.length;){const _=e[u++];if("number"==typeof _){if(_===n){p=-1;break}if(_>n){p=u-1;break}}}for(;u<e.length;){const _=e[u];if("number"==typeof _)break;if(_===t){if(null===s)return void(null!==c&&(e[u+1]=c));if(s===e[u+1])return void(e[u+2]=c)}u++,null!==s&&u++,null!==c&&u++}-1!==p&&(e.splice(p,0,n),u=p+1),e.splice(u++,0,t),null!==s&&e.splice(u++,0,s),null!==c&&e.splice(u++,0,c)}const JE="ng-template";function WT(e,n,t,s){let c=0;if(s){for(;c<n.length&&"string"==typeof n[c];c+=2)if("class"===n[c]&&-1!==kV(n[c+1].toLowerCase(),t,0))return!0}else if(zT(e))return!1;if(c=n.indexOf(1,c),c>-1){let u;for(;++c<n.length&&"string"==typeof(u=n[c]);)if(u.toLowerCase()===t)return!0}return!1}function zT(e){return 4===e.type&&e.value!==JE}function he(e,n,t){return n===(4!==e.type||t?e.value:JE)}function LV(e,n,t){let s=4;const c=e.attrs,u=null!==c?function xN(e){for(let n=0;n<e.length;n++)if(MN(e[n]))return n;return e.length}(c):0;let p=!1;for(let _=0;_<n.length;_++){const E=n[_];if("number"!=typeof E){if(!p)if(4&s){if(s=2|1&s,""!==E&&!he(e,E,t)||""===E&&1===n.length){if(la(s))return!1;p=!0}}else if(8&s){if(null===c||!WT(e,c,E,t)){if(la(s))return!1;p=!0}}else{const S=n[++_],w=xV(E,c,zT(e),t);if(-1===w){if(la(s))return!1;p=!0;continue}if(""!==S){let D;if(D=w>u?"":c[w+1].toLowerCase(),2&s&&S!==D){if(la(s))return!1;p=!0}}}}else{if(!p&&!la(s)&&!la(E))return!1;if(p&&la(E))continue;p=!1,s=E|1&s}}return la(s)||p}function la(e){return!(1&e)}function xV(e,n,t,s){if(null===n)return-1;let c=0;if(s||!t){let u=!1;for(;c<n.length;){const p=n[c];if(p===e)return c;if(3===p||6===p)u=!0;else{if(1===p||2===p){let _=n[++c];for(;"string"==typeof _;)_=n[++c];continue}if(4===p)break;if(0===p){c+=4;continue}}c+=u?1:2}return-1}return function UV(e,n){let t=e.indexOf(4);if(t>-1)for(t++;t<e.length;){const s=e[t];if("number"==typeof s)return-1;if(s===n)return t;t++}return-1}(n,e)}function LN(e,n,t=!1){for(let s=0;s<n.length;s++)if(LV(e,n[s],t))return!0;return!1}function VV(e,n){e:for(let t=0;t<n.length;t++){const s=n[t];if(e.length===s.length){for(let c=0;c<e.length;c++)if(e[c]!==s[c])continue e;return!0}}return!1}function Bm(e,n){return e?":not("+n.trim()+")":n}function Ep(e){let n=e[0],t=1,s=2,c="",u=!1;for(;t<e.length;){let p=e[t];if("string"==typeof p)if(2&s){const _=e[++t];c+="["+p+(_.length>0?'="'+_+'"':"")+"]"}else 8&s?c+="."+p:4&s&&(c+=" "+p);else""!==c&&!la(p)&&(n+=Bm(u,c),c=""),s=p,u=u||!la(s);t++}return""!==c&&(n+=Bm(u,c)),n}function eo(e){return Wc(()=>{const n=YT(e),t={...n,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===ZE.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||ca.Emulated,styles:e.styles||dn,_:null,schemas:e.schemas||null,tView:null,id:""};QE(t);const s=e.dependencies;return t.directiveDefs=jm(s,!1),t.pipeDefs=jm(s,!0),t.id=function $T(e){let n=0;const t=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const c of t)n=Math.imul(31,n)+c.charCodeAt(0)|0;return n+=2147483648,"c"+n}(t),t})}function HV(e){return Wt(e)||Vr(e)}function KT(e){return null!==e}function ii(e){return Wc(()=>({type:e.type,bootstrap:e.bootstrap||dn,declarations:e.declarations||dn,imports:e.imports||dn,exports:e.exports||dn,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function qT(e,n){if(null==e)return mi;const t={};for(const s in e)if(e.hasOwnProperty(s)){const c=e[s];let u,p,_=Kc.None;Array.isArray(c)?(_=c[0],u=c[1],p=c[2]??u):(u=c,p=c),n?(t[u]=_!==Kc.None?[s,_]:s,n[u]=p):t[u]=s}return t}function Ue(e){return Wc(()=>{const n=YT(e);return QE(n),n})}function Co(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function Wt(e){return e[Mm]||null}function Vr(e){return e[MT]||null}function Ar(e){return e[kT]||null}function to(e,n){const t=e[km]||null;if(!t&&!0===n)throw new Error(`Type ${fi(e)} does not have '\u0275mod' property.`);return t}function YT(e){const n={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:e.inputs||mi,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||dn,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:qT(e.inputs,n),outputs:qT(e.outputs),debugInfo:null}}function QE(e){e.features?.forEach(n=>n(e))}function jm(e,n){if(!e)return null;const t=n?Ar:HV;return()=>("function"==typeof e?e():e).map(s=>t(s)).filter(KT)}function vu(e){return{\u0275providers:e}}function GV(...e){return{\u0275providers:ey(0,e),\u0275fromNgModule:!0}}function ey(e,...n){const t=[],s=new Set;let c;const u=p=>{t.push(p)};return gp(n,p=>{const _=p;ty(_,u,[],s)&&(c||=[],c.push(_))}),void 0!==c&&Hm(c,u),t}function Hm(e,n){for(let t=0;t<e.length;t++){const{ngModule:s,providers:c}=e[t];XT(c,u=>{n(u,s)})}}function ty(e,n,t,s){if(!(e=ht(e)))return!1;let c=null,u=VE(e);const p=!u&&Wt(e);if(u||p){if(p&&!p.standalone)return!1;c=e}else{const E=e.ngModule;if(u=VE(E),!u)return!1;c=E}const _=s.has(c);if(p){if(_)return!1;if(s.add(c),p.dependencies){const E="function"==typeof p.dependencies?p.dependencies():p.dependencies;for(const S of E)ty(S,n,t,s)}}else{if(!u)return!1;{if(null!=u.imports&&!_){let S;s.add(c);try{gp(u.imports,w=>{ty(w,n,t,s)&&(S||=[],S.push(w))})}finally{}void 0!==S&&Hm(S,n)}if(!_){const S=Di(c)||(()=>new c);n({provide:c,useFactory:S,deps:dn},c),n({provide:jT,useValue:c,multi:!0},c),n({provide:sc,useValue:()=>ye(c),multi:!0},c)}const E=u.providers;if(null!=E&&!_){const S=e;XT(E,w=>{n(w,S)})}}}return c!==e&&void 0!==e.providers}function XT(e,n){for(let t of e)Ai(t)&&(t=t.\u0275providers),Array.isArray(t)?XT(t,n):n(t)}const WV=Wn({provide:String,useValue:Wn});function ZT(e){return null!==e&&"object"==typeof e&&WV in e}function Eu(e){return"function"==typeof e}const e0=new Te(""),ry={},zV={};let t0;function iy(){return void 0===t0&&(t0=new XE),t0}class Yo{}class yp extends Yo{get destroyed(){return this._destroyed}constructor(n,t,s,c){super(),this.parent=t,this.source=s,this.scopes=c,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,sy(n,p=>this.processProvider(p)),this.records.set(qo,sd(void 0,this)),c.has("environment")&&this.records.set(Yo,sd(void 0,this));const u=this.records.get(e0);null!=u&&"string"==typeof u.value&&this.scopes.add(u.value),this.injectorDefTypes=new Set(this.get(jT,dn,Yt.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;const n=gt(null);try{for(const s of this._ngOnDestroyHooks)s.ngOnDestroy();const t=this._onDestroyHooks;this._onDestroyHooks=[];for(const s of t)s()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),gt(n)}}onDestroy(n){return this.assertNotDestroyed(),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){this.assertNotDestroyed();const t=id(this),s=zo(void 0);try{return n()}finally{id(t),zo(s)}}get(n,t=oc,s=Yt.Default){if(this.assertNotDestroyed(),n.hasOwnProperty(jE))return n[jE](this);s=zE(s);const u=id(this),p=zo(void 0);try{if(!(s&Yt.SkipSelf)){let E=this.records.get(n);if(void 0===E){const S=function $V(e){return"function"==typeof e||"object"==typeof e&&e instanceof Te}(n)&&UE(n);E=S&&this.injectableDefInScope(S)?sd(n0(n),ry):null,this.records.set(n,E)}if(null!=E)return this.hydrate(n,E)}return(s&Yt.Self?iy():this.parent).get(n,t=s&Yt.Optional&&t===oc?null:t)}catch(_){if("NullInjectorError"===_.name){if((_[GE]=_[GE]||[]).unshift(fi(n)),u)throw _;return function AV(e,n,t,s){const c=e[GE];throw n[ON]&&c.unshift(n[ON]),e.message=function DV(e,n,t,s=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let c=fi(n);if(Array.isArray(n))c=n.map(fi).join(" -> ");else if("object"==typeof n){let u=[];for(let p in n)if(n.hasOwnProperty(p)){let _=n[p];u.push(p+":"+("string"==typeof _?JSON.stringify(_):fi(_)))}c=`{${u.join(", ")}}`}return`${t}${s?"("+s+")":""}[${c}]: ${e.replace(wV,"\n  ")}`}("\n"+e.message,c,t,s),e.ngTokenPath=c,e[GE]=null,e}(_,n,"R3InjectorError",this.source)}throw _}finally{zo(p),id(u)}}resolveInjectorInitializers(){const n=gt(null),t=id(this),s=zo(void 0);try{const u=this.get(sc,dn,Yt.Self);for(const p of u)p()}finally{id(t),zo(s),gt(n)}}toString(){const n=[],t=this.records;for(const s of t.keys())n.push(fi(s));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new ae(205,!1)}processProvider(n){let t=Eu(n=ht(n))?n:ht(n&&n.provide);const s=function oy(e){return ZT(e)?sd(void 0,e.useValue):sd(Gm(e),ry)}(n);if(!Eu(n)&&!0===n.multi){let c=this.records.get(t);c||(c=sd(void 0,ry,!0),c.factory=()=>KE(c.multi),this.records.set(t,c)),t=n,c.multi.push(n)}this.records.set(t,s)}hydrate(n,t){const s=gt(null);try{return t.value===ry&&(t.value=zV,t.value=t.factory()),"object"==typeof t.value&&t.value&&function YV(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}finally{gt(s)}}injectableDefInScope(n){if(!n.providedIn)return!1;const t=ht(n.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(n){const t=this._onDestroyHooks.indexOf(n);-1!==t&&this._onDestroyHooks.splice(t,1)}}function n0(e){const n=UE(e),t=null!==n?n.factory:Di(e);if(null!==t)return t;if(e instanceof Te)throw new ae(204,!1);if(e instanceof Function)return function KV(e){if(e.length>0)throw new ae(204,!1);const t=function bV(e){return e&&(e[td]||e[wN])||null}(e);return null!==t?()=>t.factory(e):()=>new e}(e);throw new ae(204,!1)}function Gm(e,n,t){let s;if(Eu(e)){const c=ht(e);return Di(c)||n0(c)}if(ZT(e))s=()=>ht(e.useValue);else if(function ny(e){return!(!e||!e.useFactory)}(e))s=()=>e.useFactory(...KE(e.deps||[]));else if(function JT(e){return!(!e||!e.useExisting)}(e))s=()=>ye(ht(e.useExisting));else{const c=ht(e&&(e.useClass||e.provide));if(!function qV(e){return!!e.deps}(e))return Di(c)||n0(c);s=()=>new c(...KE(e.deps))}return s}function sd(e,n,t=!1){return{factory:e,value:n,multi:t?[]:void 0}}function sy(e,n){for(const t of e)Array.isArray(t)?sy(t,n):t&&Ai(t)?sy(t.\u0275providers,n):n(t)}function qc(e,n){e instanceof yp&&e.assertNotDestroyed();const s=id(e),c=zo(void 0);try{return n()}finally{id(s),zo(c)}}function ay(){return void 0!==AN()||null!=function FT(){return mp}()}function r0(e){if(!ay())throw new ae(-203,!1)}const rr=0,we=1,Ye=2,oi=3,da=4,Fi=5,To=6,Yc=7,ir=8,si=9,ac=10,pt=11,Km=12,BN=13,Sp=14,ur=15,$c=16,yu=17,ua=18,bu=19,a0=20,ha=21,ad=22,Fs=23,He=25,ly=1,cc=7,Cp=9,Yr=10;var dy=function(e){return e[e.None=0]="None",e[e.HasTransplantedViews=2]="HasTransplantedViews",e}(dy||{});function _i(e){return Array.isArray(e)&&"object"==typeof e[ly]}function no(e){return Array.isArray(e)&&!0===e[ly]}function c0(e){return!!(4&e.flags)}function cd(e){return e.componentOffset>-1}function lc(e){return!(1&~e.flags)}function pa(e){return!!e.template}function $m(e){return!!(512&e[Ye])}class iB{constructor(n,t,s){this.previousValue=n,this.currentValue=t,this.firstChange=s}isFirstChange(){return this.firstChange}}function f0(e,n,t,s){null!==n?n.applyValueToInputSignal(n,s):e[t]=s}function $o(){return zN}function zN(e){return e.type.prototype.ngOnChanges&&(e.setInput=oB),KN}function KN(){const e=m0(this),n=e?.current;if(n){const t=e.previous;if(t===mi)e.previous=n;else for(let s in n)t[s]=n[s];e.current=null,this.ngOnChanges(n)}}function oB(e,n,t,s,c){const u=this.declaredInputs[s],p=m0(e)||function Zm(e,n){return e[Xm]=n}(e,{previous:mi,current:null}),_=p.current||(p.current={}),E=p.previous,S=E[u];_[u]=new iB(S&&S.currentValue,t,E===mi),f0(e,n,c,t)}$o.ngInherit=!0;const Xm="__ngSimpleChanges__";function m0(e){return e[Xm]||null}const dc=function(e,n,t){},qN="svg";function un(e){for(;Array.isArray(e);)e=e[rr];return e}function Su(e,n){return un(n[e])}function Ui(e,n){return un(n[e.index])}function Qm(e,n){return e.data[n]}function Cu(e,n){return e[n]}function Es(e,n){const t=n[e];return _i(t)?t:t[rr]}function Tp(e){return!(128&~e[Ye])}function Vi(e,n){return null==n?null:e[n]}function hy(e){e[yu]=0}function eg(e){1024&e[Ye]||(e[Ye]|=1024,Tp(e)&&tg(e))}function Tu(e){return!!(9216&e[Ye]||e[Fs]?.dirty)}function _0(e){e[ac].changeDetectionScheduler?.notify(8),64&e[Ye]&&(e[Ye]|=1024),Tu(e)&&tg(e)}function tg(e){e[ac].changeDetectionScheduler?.notify(0);let n=Xc(e);for(;null!==n&&!(8192&n[Ye])&&(n[Ye]|=8192,Tp(n));)n=Xc(n)}function py(e,n){if(!(256&~e[Ye]))throw new ae(911,!1);null===e[ha]&&(e[ha]=[]),e[ha].push(n)}function Xc(e){const n=e[oi];return no(n)?n[oi]:n}const _t={lFrame:oP(null),bindingsEnabled:!0,skipHydrationRootTNode:null};let YN=!1;function fa(){return _t.bindingsEnabled}function Us(){return null!==_t.skipHydrationRootTNode}function ue(){return _t.lFrame.lView}function Vt(){return _t.lFrame.tView}function Xo(e){return _t.lFrame.contextLView=e,e[ir]}function ro(e){return _t.lFrame.contextLView=null,e}function Un(){let e=JN();for(;null!==e&&64===e.type;)e=e.parent;return e}function JN(){return _t.lFrame.currentTNode}function ma(e,n){const t=_t.lFrame;t.currentTNode=e,t.isParent=n}function y0(){return _t.lFrame.isParent}function b0(){_t.lFrame.isParent=!1}function S0(){return YN}function eP(e){YN=e}function io(){const e=_t.lFrame;let n=e.bindingRootIndex;return-1===n&&(n=e.bindingRootIndex=e.tView.bindingStartIndex),n}function ga(){return _t.lFrame.bindingIndex++}function Jc(e){const n=_t.lFrame,t=n.bindingIndex;return n.bindingIndex=n.bindingIndex+e,t}function pB(e,n){const t=_t.lFrame;t.bindingIndex=t.bindingRootIndex=e,uc(n)}function uc(e){_t.lFrame.currentDirectiveIndex=e}function T0(){return _t.lFrame.currentQueryIndex}function gy(e){_t.lFrame.currentQueryIndex=e}function fB(e){const n=e[we];return 2===n.type?n.declTNode:1===n.type?e[Fi]:null}function iP(e,n,t){if(t&Yt.SkipSelf){let c=n,u=e;for(;!(c=c.parent,null!==c||t&Yt.Host||(c=fB(u),null===c||(u=u[Sp],10&c.type))););if(null===c)return!1;n=c,e=u}const s=_t.lFrame=_y();return s.currentTNode=n,s.lView=e,!0}function w0(e){const n=_y(),t=e[we];_t.lFrame=n,n.currentTNode=t.firstChild,n.lView=e,n.tView=t,n.contextLView=e,n.bindingIndex=t.bindingStartIndex,n.inI18n=!1}function _y(){const e=_t.lFrame,n=null===e?null:e.child;return null===n?oP(e):n}function oP(e){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=n),n}function sP(){const e=_t.lFrame;return _t.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const aP=sP;function I0(){const e=sP();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Bi(){return _t.lFrame.selectedIndex}function ld(e){_t.lFrame.selectedIndex=e}function or(){const e=_t.lFrame;return Qm(e.tView,e.selectedIndex)}function _a(){_t.lFrame.currentNamespace=qN}function va(){!function R0(){_t.lFrame.currentNamespace=null}()}let rg=!0;function Rp(){return rg}function hc(e){rg=e}function Ap(e,n){for(let t=n.directiveStart,s=n.directiveEnd;t<s;t++){const u=e.data[t].type.prototype,{ngAfterContentInit:p,ngAfterContentChecked:_,ngAfterViewInit:E,ngAfterViewChecked:S,ngOnDestroy:w}=u;p&&(e.contentHooks??=[]).push(-t,p),_&&((e.contentHooks??=[]).push(t,_),(e.contentCheckHooks??=[]).push(t,_)),E&&(e.viewHooks??=[]).push(-t,E),S&&((e.viewHooks??=[]).push(t,S),(e.viewCheckHooks??=[]).push(t,S)),null!=w&&(e.destroyHooks??=[]).push(t,w)}}function vy(e,n,t){lP(e,n,3,t)}function ig(e,n,t,s){(3&e[Ye])===t&&lP(e,n,t,s)}function Ey(e,n){let t=e[Ye];(3&t)===n&&(t&=16383,t+=1,e[Ye]=t)}function lP(e,n,t,s){const u=s??-1,p=n.length-1;let _=0;for(let E=void 0!==s?65535&e[yu]:0;E<p;E++)if("number"==typeof n[E+1]){if(_=n[E],null!=s&&_>=s)break}else n[E]<0&&(e[yu]+=65536),(_<u||-1==u)&&(dP(e,t,n,E),e[yu]=(4294901760&e[yu])+E+2),E++}function D0(e,n){dc(4,e,n);const t=gt(null);try{n.call(e)}finally{gt(t),dc(5,e,n)}}function dP(e,n,t,s){const c=t[s]<0,u=t[s+1],_=e[c?-t[s]:t[s]];c?e[Ye]>>14<e[yu]>>16&&(3&e[Ye])===n&&(e[Ye]+=16384,D0(_,u)):D0(_,u)}const Dp=-1;class og{constructor(n,t,s){this.factory=n,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=s}}const sg={};class Ru{constructor(n,t){this.injector=n,this.parentInjector=t}get(n,t,s){s=zE(s);const c=this.injector.get(n,sg,s);return c!==sg||t===sg?c:this.parentInjector.get(n,t,s)}}function ag(e){return e!==Dp}function cg(e){return 32767&e}function lg(e,n){let t=function pP(e){return e>>16}(e),s=n;for(;t>0;)s=s[Sp],t--;return s}let yy=!0;function by(e){const n=yy;return yy=e,n}const O0=255,fP=5;let mP=0;const Bs={};function Sy(e,n){const t=N0(e,n);if(-1!==t)return t;const s=n[we];s.firstCreatePass&&(e.injectorIndex=n.length,Au(s.data,e),Au(n,null),Au(s.blueprint,null));const c=dd(e,n),u=e.injectorIndex;if(ag(c)){const p=cg(c),_=lg(c,n),E=_[we].data;for(let S=0;S<8;S++)n[u+S]=_[p+S]|E[p+S]}return n[u+8]=c,u}function Au(e,n){e.push(0,0,0,0,0,0,0,0,n)}function N0(e,n){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===n[e.injectorIndex+8]?-1:e.injectorIndex}function dd(e,n){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let t=0,s=null,c=n;for(;null!==c;){if(s=M0(c),null===s)return Dp;if(t++,c=c[Sp],-1!==s.injectorIndex)return s.injectorIndex|t<<16}return Dp}function ud(e,n,t){!function bB(e,n,t){let s;"string"==typeof t?s=t.charCodeAt(0)||0:t.hasOwnProperty(Lm)&&(s=t[Lm]),null==s&&(s=t[Lm]=mP++);const c=s&O0;n.data[e+(c>>fP)]|=1<<c}(e,n,t)}function Cy(e,n,t){if(t&Yt.Optional||void 0!==e)return e;fp()}function dg(e,n,t,s){if(t&Yt.Optional&&void 0===s&&(s=null),!(t&(Yt.Self|Yt.Host))){const c=e[si],u=zo(void 0);try{return c?c.get(n,s,t&Yt.Optional):DN(n,s,t&Yt.Optional)}finally{zo(u)}}return Cy(s,0,t)}function _P(e,n,t,s=Yt.Default,c){if(null!==e){if(2048&n[Ye]&&!(s&Yt.Self)){const p=function TB(e,n,t,s,c){let u=e,p=n;for(;null!==u&&null!==p&&2048&p[Ye]&&!(512&p[Ye]);){const _=vP(u,p,t,s|Yt.Self,Bs);if(_!==Bs)return _;let E=u.parent;if(!E){const S=p[a0];if(S){const w=S.get(t,Bs,s);if(w!==Bs)return w}E=M0(p),p=p[Sp]}u=E}return c}(e,n,t,s,Bs);if(p!==Bs)return p}const u=vP(e,n,t,s,Bs);if(u!==Bs)return u}return dg(n,t,s,c)}function vP(e,n,t,s,c){const u=function CB(e){if("string"==typeof e)return e.charCodeAt(0)||0;const n=e.hasOwnProperty(Lm)?e[Lm]:void 0;return"number"==typeof n?n>=0?n&O0:yP:n}(t);if("function"==typeof u){if(!iP(n,e,s))return s&Yt.Host?Cy(c,0,s):dg(n,t,s,c);try{let p;if(p=u(s),null!=p||s&Yt.Optional)return p;fp()}finally{aP()}}else if("number"==typeof u){let p=null,_=N0(e,n),E=Dp,S=s&Yt.Host?n[ur][Fi]:null;for((-1===_||s&Yt.SkipSelf)&&(E=-1===_?dd(e,n):n[_+8],E!==Dp&&Ty(s,!1)?(p=n[we],_=cg(E),n=lg(E,n)):_=-1);-1!==_;){const w=n[we];if(EP(u,_,w.data)){const D=SB(_,n,t,p,s,S);if(D!==Bs)return D}E=n[_+8],E!==Dp&&Ty(s,n[we].data[_+8]===S)&&EP(u,_,n)?(p=w,_=cg(E),n=lg(E,n)):_=-1}}return c}function SB(e,n,t,s,c,u){const p=n[we],_=p.data[e+8],w=ug(_,p,t,null==s?cd(_)&&yy:s!=p&&!!(3&_.type),c&Yt.Host&&u===_);return null!==w?Du(n,p,w,_):Bs}function ug(e,n,t,s,c){const u=e.providerIndexes,p=n.data,_=1048575&u,E=e.directiveStart,w=u>>20,U=c?_+w:e.directiveEnd;for(let V=s?_:_+w;V<U;V++){const H=p[V];if(V<E&&t===H||V>=E&&H.type===t)return V}if(c){const V=p[E];if(V&&pa(V)&&V.type===t)return E}return null}function Du(e,n,t,s){let c=e[t];const u=n.data;if(function _B(e){return e instanceof og}(c)){const p=c;p.resolving&&function TV(e,n){throw n&&n.join(" > "),new ae(-200,e)}(function ln(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():wt(e)}(u[t]));const _=by(p.canSeeViewProviders);p.resolving=!0;const S=p.injectImpl?zo(p.injectImpl):null;iP(e,s,Yt.Default);try{c=e[t]=p.factory(void 0,u,e,s),n.firstCreatePass&&t>=s.directiveStart&&function cP(e,n,t){const{ngOnChanges:s,ngOnInit:c,ngDoCheck:u}=n.type.prototype;if(s){const p=zN(n);(t.preOrderHooks??=[]).push(e,p),(t.preOrderCheckHooks??=[]).push(e,p)}c&&(t.preOrderHooks??=[]).push(0-e,c),u&&((t.preOrderHooks??=[]).push(e,u),(t.preOrderCheckHooks??=[]).push(e,u))}(t,u[t],n)}finally{null!==S&&zo(S),by(_),p.resolving=!1,aP()}}return c}function EP(e,n,t){return!!(t[n+(e>>fP)]&1<<e)}function Ty(e,n){return!(e&Yt.Self||e&Yt.Host&&n)}class Tr{constructor(n,t){this._tNode=n,this._lView=t}get(n,t,s){return _P(this._tNode,this._lView,n,zE(s),t)}}function yP(){return new Tr(Un(),ue())}function yn(e){return Wc(()=>{const n=e.prototype.constructor,t=n[ic]||P0(n),s=Object.prototype;let c=Object.getPrototypeOf(e.prototype).constructor;for(;c&&c!==s;){const u=c[ic]||P0(c);if(u&&u!==t)return u;c=Object.getPrototypeOf(c)}return u=>new u})}function P0(e){return En(e)?()=>{const n=P0(ht(e));return n&&n()}:Di(e)}function M0(e){const n=e[we],t=n.type;return 2===t?n.declTNode:1===t?e[Fi]:null}function Ry(e,n=null,t=null,s){const c=Mp(e,n,t,s);return c.resolveInjectorInitializers(),c}function Mp(e,n=null,t=null,s,c=new Set){const u=[t||dn,GV(e)];return s=s||("object"==typeof e?void 0:fi(e)),new yp(u,n||iy(),s||null,c)}class Dr{static{this.THROW_IF_NOT_FOUND=oc}static{this.NULL=new XE}static create(n,t){if(Array.isArray(n))return Ry({name:""},t,n,"");{const s=n.name??"";return Ry({name:s},n.parent,n.providers,s)}}static{this.\u0275prov=Oe({token:Dr,providedIn:"any",factory:()=>ye(qo)})}static{this.__NG_ELEMENT_ID__=-1}}new Te("").__NG_ELEMENT_ID__=e=>{const n=Un();if(null===n)throw new ae(204,!1);if(2&n.type)return n.value;if(e&Yt.Optional)return null;throw new ae(204,!1)};function Ay(e){return e.ngOriginalError}const Ou=!0;let Nu=(()=>{class e{static{this.__NG_ELEMENT_ID__=j0}static{this.__NG_ENV_ID__=t=>t}}return e})();class B0 extends Nu{constructor(n){super(),this._lView=n}onDestroy(n){return py(this._lView,n),()=>function fy(e,n){if(null===e[ha])return;const t=e[ha].indexOf(n);-1!==t&&e[ha].splice(t,1)}(this._lView,n)}}function j0(){return new B0(ue())}let hd=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new gs(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);const t=this.taskId++;return this.pendingTasks.add(t),t}remove(t){this.pendingTasks.delete(t),0===this.pendingTasks.size&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static{this.\u0275prov=Oe({token:e,providedIn:"root",factory:()=>new e})}}return e})();const Dn=class NB extends Gt{constructor(n=!1){super(),this.destroyRef=void 0,this.pendingTasks=void 0,this.__isAsync=n,ay()&&(this.destroyRef=me(Nu,{optional:!0})??void 0,this.pendingTasks=me(hd,{optional:!0})??void 0)}emit(n){const t=gt(null);try{super.next(n)}finally{gt(t)}}subscribe(n,t,s){let c=n,u=t||(()=>null),p=s;if(n&&"object"==typeof n){const E=n;c=E.next?.bind(E),u=E.error?.bind(E),p=E.complete?.bind(E)}this.__isAsync&&(u=this.wrapInTimeout(u),c&&(c=this.wrapInTimeout(c)),p&&(p=this.wrapInTimeout(p)));const _=super.subscribe({next:c,error:u,complete:p});return n instanceof Ur&&n.add(_),_}wrapInTimeout(n){return t=>{const s=this.pendingTasks?.add();setTimeout(()=>{n(t),void 0!==s&&this.pendingTasks?.remove(s)})}}};function pc(...e){}function H0(e){let n,t;function s(){e=pc;try{void 0!==t&&"function"==typeof cancelAnimationFrame&&cancelAnimationFrame(t),void 0!==n&&clearTimeout(n)}catch{}}return n=setTimeout(()=>{e(),s()}),"function"==typeof requestAnimationFrame&&(t=requestAnimationFrame(()=>{e(),s()})),()=>s()}function wP(e){return queueMicrotask(()=>e()),()=>{e=pc}}const G0="isAngularZone",Dy=G0+"_ID";let PB=0;class ft{constructor(n){this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Dn(!1),this.onMicrotaskEmpty=new Dn(!1),this.onStable=new Dn(!1),this.onError=new Dn(!1);const{enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:s=!1,shouldCoalesceRunChangeDetection:c=!1,scheduleInRootZone:u=Ou}=n;if(typeof Zone>"u")throw new ae(908,!1);Zone.assertZonePatched();const p=this;p._nesting=0,p._outer=p._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(p._inner=p._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(p._inner=p._inner.fork(Zone.longStackTraceZoneSpec)),p.shouldCoalesceEventChangeDetection=!c&&s,p.shouldCoalesceRunChangeDetection=c,p.callbackScheduled=!1,p.scheduleInRootZone=u,function AP(e){const n=()=>{!function RP(e){function n(){H0(()=>{e.callbackScheduled=!1,kp(e),e.isCheckStableRunning=!0,Oy(e),e.isCheckStableRunning=!1})}e.isCheckStableRunning||e.callbackScheduled||(e.callbackScheduled=!0,e.scheduleInRootZone?Zone.root.run(()=>{n()}):e._outer.run(()=>{n()}),kp(e))}(e)},t=PB++;e._inner=e._inner.fork({name:"angular",properties:{[G0]:!0,[Dy]:t,[Dy+t]:!0},onInvokeTask:(s,c,u,p,_,E)=>{if(function Py(e){return Pu(e,"__ignore_ng_zone__")}(E))return s.invokeTask(u,p,_,E);try{return z0(e),s.invokeTask(u,p,_,E)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===p.type||e.shouldCoalesceRunChangeDetection)&&n(),Ny(e)}},onInvoke:(s,c,u,p,_,E,S)=>{try{return z0(e),s.invoke(u,p,_,E,S)}finally{e.shouldCoalesceRunChangeDetection&&!e.callbackScheduled&&!function DP(e){return Pu(e,"__scheduler_tick__")}(E)&&n(),Ny(e)}},onHasTask:(s,c,u,p)=>{s.hasTask(u,p),c===u&&("microTask"==p.change?(e._hasPendingMicrotasks=p.microTask,kp(e),Oy(e)):"macroTask"==p.change&&(e.hasPendingMacrotasks=p.macroTask))},onHandleError:(s,c,u,p)=>(s.handleError(u,p),e.runOutsideAngular(()=>e.onError.emit(p)),!1)})}(p)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get(G0)}static assertInAngularZone(){if(!ft.isInAngularZone())throw new ae(909,!1)}static assertNotInAngularZone(){if(ft.isInAngularZone())throw new ae(909,!1)}run(n,t,s){return this._inner.run(n,t,s)}runTask(n,t,s,c){const u=this._inner,p=u.scheduleEventTask("NgZoneEvent: "+c,n,W0,pc,pc);try{return u.runTask(p,t,s)}finally{u.cancelTask(p)}}runGuarded(n,t,s){return this._inner.runGuarded(n,t,s)}runOutsideAngular(n){return this._outer.run(n)}}const W0={};function Oy(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function kp(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&!0===e.callbackScheduled)}function z0(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function Ny(e){e._nesting--,Oy(e)}class Lp{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Dn,this.onMicrotaskEmpty=new Dn,this.onStable=new Dn,this.onError=new Dn}run(n,t,s){return n.apply(t,s)}runGuarded(n,t,s){return n.apply(t,s)}runOutsideAngular(n){return n()}runTask(n,t,s,c){return n.apply(t,s)}}function Pu(e,n){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0]?.data?.[n]}class Ea{constructor(){this._console=console}handleError(n){const t=this._findOriginalError(n);this._console.error("ERROR",n),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(n){let t=n&&Ay(n);for(;t&&Ay(t);)t=Ay(t);return t||null}}const MB=new Te("",{providedIn:"root",factory:()=>{const e=me(ft),n=me(Ea);return t=>e.runOutsideAngular(()=>n.handleError(t))}});function kB(){return xp(Un(),ue())}function xp(e,n){return new On(Ui(e,n))}let On=(()=>{class e{constructor(t){this.nativeElement=t}static{this.__NG_ELEMENT_ID__=kB}}return e})();function K0(e){return e instanceof On?e.nativeElement:e}function LB(){return this._results[Symbol.iterator]()}class ku{get changes(){return this._changes??=new Dn}constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;const t=ku.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=LB)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,t){return this._results.reduce(n,t)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,t){this.dirty=!1;const s=function Ko(e){return e.flat(Number.POSITIVE_INFINITY)}(n);(this._changesDetected=!function PV(e,n,t){if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++){let c=e[s],u=n[s];if(t&&(c=t(c),u=t(u)),u!==c)return!1}return!0}(this._results,s,t))&&(this._results=s,this.length=s.length,this.last=s[this.length-1],this.first=s[0])}notifyOnChanges(){void 0!==this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(n){this._onDirty=n}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){void 0!==this._changes&&(this._changes.complete(),this._changes.unsubscribe())}}function Up(e){return!(128&~e.flags)}const fg=new Map;let PP=0;function xu(e){fg.delete(e[bu])}const Vp="__ngContext__";function oo(e,n){_i(n)?(e[Vp]=n[bu],function ky(e){fg.set(e[bu],e)}(n)):e[Vp]=n}function VP(e){return Bp(e[Km])}function BP(e){return Bp(e[da])}function Bp(e){for(;null!==e&&!no(e);)e=e[da];return e}let mg;const Gp=new Te("",{providedIn:"root",factory:()=>zP}),zP="ng",KP=new Te(""),pd=new Te("",{providedIn:"platform",factory:()=>"unknown"}),nl=new Te(""),ew=new Te("",{providedIn:"root",factory:()=>function tl(){if(void 0!==mg)return mg;if(typeof document<"u")return document;throw new ae(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let qP=()=>null;function aw(e,n,t=!1){return qP(e,n,t)}const tM=new Te("",{providedIn:"root",factory:()=>!1});class cM{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${IT})`}}function rl(e){return e instanceof cM?e.changingThisBreaksApplicationSecurity:e}const mM=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var Yp=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}(Yp||{});function Tw(e){const n=function Tg(){const e=ue();return e&&e[ac].sanitizer}();return n?n.sanitize(Yp.URL,e)||"":function le(e,n){const t=function hM(e){return e instanceof cM&&e.getTypeName()||null}(e);if(null!=t&&t!==n){if("ResourceURL"===t&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${t} (see ${IT})`)}return t===n}(e,"URL")?rl(e):function $y(e){return(e=String(e)).match(mM)?e:"unsafe:"+e}(wt(e))}function Jo(e){return e instanceof Function?e():e}function ys(e){return"browser"===(e??me(Dr)).get(pd)}var fd=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(fd||{});let sb;function ab(e,n){return sb(e,n)}function $p(e,n,t,s,c){if(null!=s){let u,p=!1;no(s)?u=s:_i(s)&&(p=!0,s=s[rr]);const _=un(s);0===e&&null!==t?null==c?VM(n,t,_):Hu(n,t,_,c||null,!0):1===e&&null!==t?Hu(n,t,_,c||null,!0):2===e?function Og(e,n,t){e.removeChild(null,n,t)}(n,_,p):3===e&&n.destroyNode(_),null!=u&&function Rj(e,n,t,s,c){const u=t[cc];u!==un(t)&&$p(n,e,s,u,c);for(let _=Yr;_<t.length;_++){const E=t[_];db(E[we],E,e,n,s,u)}}(n,e,u,t,c)}}function Ig(e,n,t){return e.createElement(n,t)}function Mw(e,n){n[ac].changeDetectionScheduler?.notify(9),db(e,n,n[pt],2,null,null)}function lb(e,n){const t=e[Cp],s=n[oi];(_i(s)||n[ur]!==s[oi][ur])&&(e[Ye]|=dy.HasTransplantedViews),null===t?e[Cp]=[n]:t.push(n)}function kw(e,n){const t=e[Cp],s=t.indexOf(n);t.splice(s,1)}function Rg(e,n){if(e.length<=Yr)return;const t=Yr+n,s=e[t];if(s){const c=s[$c];null!==c&&c!==e&&kw(c,s),n>0&&(e[t-1][da]=s[da]);const u=Um(e,Yr+n);!function Cj(e,n){Mw(e,n),n[rr]=null,n[Fi]=null}(s[we],s);const p=u[ua];null!==p&&p.detachView(u[we]),s[oi]=null,s[da]=null,s[Ye]&=-129}return s}function Ag(e,n){if(!(256&n[Ye])){const t=n[pt];t.destroyNode&&db(e,n,t,3,null,null),function wj(e){let n=e[Km];if(!n)return Lw(e[we],e);for(;n;){let t=null;if(_i(n))t=n[Km];else{const s=n[Yr];s&&(t=s)}if(!t){for(;n&&!n[da]&&n!==e;)_i(n)&&Lw(n[we],n),n=n[oi];null===n&&(n=e),_i(n)&&Lw(n[we],n),t=n&&n[da]}n=t}}(n)}}function Lw(e,n){if(256&n[Ye])return;const t=gt(null);try{n[Ye]&=-129,n[Ye]|=256,n[Fs]&&wE(n[Fs]),function UM(e,n){let t;if(null!=e&&null!=(t=e.destroyHooks))for(let s=0;s<t.length;s+=2){const c=n[t[s]];if(!(c instanceof og)){const u=t[s+1];if(Array.isArray(u))for(let p=0;p<u.length;p+=2){const _=c[u[p]],E=u[p+1];dc(4,_,E);try{E.call(_)}finally{dc(5,_,E)}}else{dc(4,c,u);try{u.call(c)}finally{dc(5,c,u)}}}}}(e,n),function FM(e,n){const t=e.cleanup,s=n[Yc];if(null!==t)for(let u=0;u<t.length-1;u+=2)if("string"==typeof t[u]){const p=t[u+3];p>=0?s[p]():s[-p].unsubscribe(),u+=2}else t[u].call(s[t[u+1]]);null!==s&&(n[Yc]=null);const c=n[ha];if(null!==c){n[ha]=null;for(let u=0;u<c.length;u++)(0,c[u])()}}(e,n),1===n[we].type&&n[pt].destroy();const s=n[$c];if(null!==s&&no(n[oi])){s!==n[oi]&&kw(s,n);const c=n[ua];null!==c&&c.detachView(e)}xu(n)}finally{gt(t)}}function mc(e,n,t){return function xw(e,n,t){let s=n;for(;null!==s&&168&s.type;)s=(n=s).parent;if(null===s)return t[rr];{const{componentOffset:c}=s;if(c>-1){const{encapsulation:u}=e.data[s.directiveStart+c];if(u===ca.None||u===ca.Emulated)return null}return Ui(s,t)}}(e,n.parent,t)}function Hu(e,n,t,s,c){e.insertBefore(n,t,s,c)}function VM(e,n,t){e.appendChild(n,t)}function BM(e,n,t,s,c){null!==s?Hu(e,n,t,s,c):VM(e,n,t)}function Fw(e,n){return e.parentNode(n)}function HM(e,n,t){return WM(e,n,t)}let Dg,WM=function GM(e,n,t){return 40&e.type?Ui(e,t):null};function md(e,n,t,s){const c=mc(e,s,n),u=n[pt],_=HM(s.parent||n[Fi],s,n);if(null!=c)if(Array.isArray(t))for(let E=0;E<t.length;E++)BM(u,c,t[E],_,!1);else BM(u,c,t,_,!1);void 0!==Dg&&Dg(u,s,n,t,c)}function ol(e,n){if(null!==n){const t=n.type;if(3&t)return Ui(n,e);if(4&t)return Uw(-1,e[n.index]);if(8&t){const s=n.child;if(null!==s)return ol(e,s);{const c=e[n.index];return no(c)?Uw(-1,c):un(c)}}if(128&t)return ol(e,n.next);if(32&t)return ab(n,e)()||un(e[n.index]);{const s=KM(e,n);return null!==s?Array.isArray(s)?s[0]:ol(Xc(e[ur]),s):ol(e,n.next)}}return null}function KM(e,n){return null!==n?e[ur][Fi].projection[n.projection]:null}function Uw(e,n){const t=Yr+e+1;if(t<n.length){const s=n[t],c=s[we].firstChild;if(null!==c)return ol(s,c)}return n[cc]}function Vw(e,n,t,s,c,u,p){for(;null!=t;){if(128===t.type){t=t.next;continue}const _=s[t.index],E=t.type;if(p&&0===n&&(_&&oo(un(_),s),t.flags|=2),32&~t.flags)if(8&E)Vw(e,n,t.child,s,c,u,!1),$p(n,e,c,_,u);else if(32&E){const S=ab(t,s);let w;for(;w=S();)$p(n,e,c,w,u);$p(n,e,c,_,u)}else 16&E?YM(e,n,s,t,c,u):$p(n,e,c,_,u);t=p?t.projectionNext:t.next}}function db(e,n,t,s,c,u){Vw(t,s,e.firstChild,n,c,u,!1)}function YM(e,n,t,s,c,u){const p=t[ur],E=p[Fi].projection[s.projection];if(Array.isArray(E))for(let S=0;S<E.length;S++)$p(n,e,c,E[S],u);else{let S=E;const w=p[oi];Up(s)&&(S.flags|=128),Vw(e,n,S,w,c,u,!0)}}function jw(e,n,t){""===t?e.removeAttribute(n,"class"):e.setAttribute(n,"class",t)}function XM(e,n,t){const{mergedAttrs:s,classes:c,styles:u}=t;null!==s&&HT(e,n,s),null!==c&&jw(e,n,c),null!==u&&function $M(e,n,t){e.setAttribute(n,"style",t)}(e,n,u)}const St={};function Ze(e=1){ZM(Vt(),ue(),Bi()+e,!1)}function ZM(e,n,t,s){if(!s)if(3&~n[Ye]){const u=e.preOrderHooks;null!==u&&ig(n,u,0,t)}else{const u=e.preOrderCheckHooks;null!==u&&vy(n,u,t)}ld(t)}function oe(e,n=Yt.Default){const t=ue();return null===t?ye(e,n):_P(Un(),t,ht(e),n)}function QM(e,n,t,s,c,u){const p=gt(null);try{let _=null;c&Kc.SignalBased&&(_=n[s][Pt]),null!==_&&void 0!==_.transformFn&&(u=_.transformFn(u)),c&Kc.HasDecoratorInputTransform&&(u=e.inputTransforms[s].call(n,u)),null!==e.setInput?e.setInput(n,_,u,t,s):f0(n,_,s,u)}finally{gt(p)}}function ub(e,n,t,s,c,u,p,_,E,S,w){const D=n.blueprint.slice();return D[rr]=c,D[Ye]=204|s,(null!==S||e&&2048&e[Ye])&&(D[Ye]|=2048),hy(D),D[oi]=D[Sp]=e,D[ir]=t,D[ac]=p||e&&e[ac],D[pt]=_||e&&e[pt],D[si]=E||e&&e[si]||null,D[Fi]=u,D[bu]=function FB(){return PP++}(),D[To]=w,D[a0]=S,D[ur]=2==n.type?e[ur]:D,D}function Gu(e,n,t,s,c){let u=e.data[n];if(null===u)u=function Hw(e,n,t,s,c){const u=JN(),p=y0(),E=e.data[n]=function Kw(e,n,t,s,c,u){let p=n?n.injectorIndex:-1,_=0;return Us()&&(_|=128),{type:t,index:s,insertBeforeIndex:null,injectorIndex:p,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:_,providerIndexes:0,value:c,attrs:u,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,p?u:u&&u.parent,t,n,s,c);return null===e.firstChild&&(e.firstChild=E),null!==u&&(p?null==u.child&&null!==E.parent&&(u.child=E):null===u.next&&(u.next=E,E.prev=u)),E}(e,n,t,s,c),function hB(){return _t.lFrame.inI18n}()&&(u.flags|=32);else if(64&u.type){u.type=t,u.value=s,u.attrs=c;const p=function Vs(){const e=_t.lFrame,n=e.currentTNode;return e.isParent?n:n.parent}();u.injectorIndex=null===p?-1:p.injectorIndex}return ma(u,!0),u}function Xp(e,n,t,s){if(0===t)return-1;const c=n.length;for(let u=0;u<t;u++)n.push(s),e.blueprint.push(s),e.data.push(null);return c}function Gw(e,n,t,s,c){const u=Bi(),p=2&s;try{ld(-1),p&&n.length>He&&ZM(e,n,He,!1),dc(p?2:0,c),t(s,c)}finally{ld(u),dc(p?3:1,c)}}function Ww(e,n,t){if(c0(n)){const s=gt(null);try{const u=n.directiveEnd;for(let p=n.directiveStart;p<u;p++){const _=e.data[p];_.contentQueries&&_.contentQueries(1,t[p],p)}}finally{gt(s)}}}function hb(e,n,t){fa()&&(function Mj(e,n,t,s){const c=t.directiveStart,u=t.directiveEnd;cd(t)&&function Mg(e,n,t){const s=Ui(n,e),c=ek(t);let p=16;t.signals?p=4096:t.onPush&&(p=64);const _=kg(e,ub(e,c,null,p,s,n,null,e[ac].rendererFactory.createRenderer(s,t),null,null,null));e[n.index]=_}(n,t,e.data[c+t.componentOffset]),e.firstCreatePass||Sy(t,n),oo(s,n);const p=t.initialInputs;for(let _=c;_<u;_++){const E=e.data[_],S=Du(n,e,_,t);oo(S,n),null!==p&&sk(0,_-c,S,E,0,p),pa(E)&&(Es(t.index,n)[ir]=Du(n,e,_,t))}}(e,n,t,Ui(t,n)),!(64&~t.flags)&&ok(e,n,t))}function pb(e,n,t=Ui){const s=n.localNames;if(null!==s){let c=n.index+1;for(let u=0;u<s.length;u+=2){const p=s[u+1],_=-1===p?t(n,e):e[p];e[c++]=_}}}function ek(e){const n=e.tView;return null===n||n.incompleteFirstPass?e.tView=zw(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):n}function zw(e,n,t,s,c,u,p,_,E,S,w){const D=He+s,U=D+c,V=function Dj(e,n){const t=[];for(let s=0;s<n;s++)t.push(s<e?null:St);return t}(D,U),H="function"==typeof S?S():S;return V[we]={type:e,blueprint:V,template:t,queries:null,viewQuery:_,declTNode:n,data:V.slice().fill(null,D),bindingStartIndex:D,expandoStartIndex:U,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof u?u():u,pipeRegistry:"function"==typeof p?p():p,firstChild:null,schemas:E,consts:H,incompleteFirstPass:!1,ssrId:w}}let tk=()=>null;function Ng(e,n,t,s,c){for(let u in n){if(!n.hasOwnProperty(u))continue;const p=n[u];if(void 0===p)continue;s??={};let _,E=Kc.None;Array.isArray(p)?(_=p[0],E=p[1]):_=p;let S=u;if(null!==c){if(!c.hasOwnProperty(u))continue;S=c[u]}0===e?fb(s,t,S,_,E):fb(s,t,S,_)}return s}function fb(e,n,t,s,c){let u;e.hasOwnProperty(t)?(u=e[t]).push(n,s):u=e[t]=[n,s],void 0!==c&&u.push(c)}function Ei(e,n,t,s,c,u,p,_){const E=Ui(n,t);let w,S=n.inputs;!_&&null!=S&&(w=S[s])?(bb(e,t,w,s,c),cd(n)&&function Pg(e,n){const t=Es(n,e);16&t[Ye]||(t[Ye]|=64)}(t,n.index)):3&n.type&&(s=function mb(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(s),c=null!=p?p(c,n.value||"",s):c,u.setProperty(E,s,c))}function Io(e,n,t,s){if(fa()){const c=null===s?null:{"":-1},u=function Lj(e,n){const t=e.directiveRegistry;let s=null,c=null;if(t)for(let u=0;u<t.length;u++){const p=t[u];if(LN(n,p.selectors,!1))if(s||(s=[]),pa(p))if(null!==p.findHostDirectiveDefs){const _=[];c=c||new Map,p.findHostDirectiveDefs(p,_,c),s.unshift(..._,p),Yw(e,n,_.length)}else s.unshift(p),Yw(e,n,0);else c=c||new Map,p.findHostDirectiveDefs?.(p,s,c),s.push(p)}return null===s?null:[s,c]}(e,t);let p,_;null===u?p=_=null:[p,_]=u,null!==p&&qw(e,n,t,p,c,_),c&&function xj(e,n,t){if(n){const s=e.localNames=[];for(let c=0;c<n.length;c+=2){const u=t[n[c+1]];if(null==u)throw new ae(-301,!1);s.push(n[c],u)}}}(t,s,c)}t.mergedAttrs=Vm(t.mergedAttrs,t.attrs)}function qw(e,n,t,s,c,u){for(let S=0;S<s.length;S++)ud(Sy(t,n),e,s[S].type);!function Uj(e,n,t){e.flags|=1,e.directiveStart=n,e.directiveEnd=n+t,e.providerIndexes=n}(t,e.data.length,s.length);for(let S=0;S<s.length;S++){const w=s[S];w.providersResolver&&w.providersResolver(w)}let p=!1,_=!1,E=Xp(e,n,s.length,null);for(let S=0;S<s.length;S++){const w=s[S];t.mergedAttrs=Vm(t.mergedAttrs,w.hostAttrs),Vj(e,t,n,E,w),Fj(E,w,c),null!==w.contentQueries&&(t.flags|=4),(null!==w.hostBindings||null!==w.hostAttrs||0!==w.hostVars)&&(t.flags|=64);const D=w.type.prototype;!p&&(D.ngOnChanges||D.ngOnInit||D.ngDoCheck)&&((e.preOrderHooks??=[]).push(t.index),p=!0),!_&&(D.ngOnChanges||D.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(t.index),_=!0),E++}!function ba(e,n,t){const c=n.directiveEnd,u=e.data,p=n.attrs,_=[];let E=null,S=null;for(let w=n.directiveStart;w<c;w++){const D=u[w],U=t?t.get(D):null,H=U?U.outputs:null;E=Ng(0,D.inputs,w,E,U?U.inputs:null),S=Ng(1,D.outputs,w,S,H);const z=null===E||null===p||zT(n)?null:Bj(E,w,p);_.push(z)}null!==E&&(E.hasOwnProperty("class")&&(n.flags|=8),E.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=_,n.inputs=E,n.outputs=S}(e,t,u)}function ok(e,n,t){const s=t.directiveStart,c=t.directiveEnd,u=t.index,p=function rP(){return _t.lFrame.currentDirectiveIndex}();try{ld(u);for(let _=s;_<c;_++){const E=e.data[_],S=n[_];uc(_),(null!==E.hostBindings||0!==E.hostVars||null!==E.hostAttrs)&&kj(E,S)}}finally{ld(-1),uc(p)}}function kj(e,n){null!==e.hostBindings&&e.hostBindings(1,n)}function Yw(e,n,t){n.componentOffset=t,(e.components??=[]).push(n.index)}function Fj(e,n,t){if(t){if(n.exportAs)for(let s=0;s<n.exportAs.length;s++)t[n.exportAs[s]]=e;pa(n)&&(t[""]=e)}}function Vj(e,n,t,s,c){e.data[s]=c;const u=c.factory||(c.factory=Di(c.type)),p=new og(u,pa(c),oe);e.blueprint[s]=p,t[s]=p,function gb(e,n,t,s,c){const u=c.hostBindings;if(u){let p=e.hostBindingOpCodes;null===p&&(p=e.hostBindingOpCodes=[]);const _=~n.index;(function _b(e){let n=e.length;for(;n>0;){const t=e[--n];if("number"==typeof t&&t<0)return t}return 0})(p)!=_&&p.push(_),p.push(t,s,u)}}(e,n,s,Xp(e,t,c.hostVars,St),c)}function Sa(e,n,t,s,c,u){const p=Ui(e,n);!function sl(e,n,t,s,c,u,p){if(null==u)e.removeAttribute(n,c,t);else{const _=null==p?wt(u):p(u,s||"",c);e.setAttribute(n,c,_,t)}}(n[pt],p,u,e.value,t,s,c)}function sk(e,n,t,s,c,u){const p=u[n];if(null!==p)for(let _=0;_<p.length;)QM(s,t,p[_++],p[_++],p[_++],p[_++])}function Bj(e,n,t){let s=null,c=0;for(;c<t.length;){const u=t[c];if(0!==u)if(5!==u){if("number"==typeof u)break;if(e.hasOwnProperty(u)){null===s&&(s=[]);const p=e[u];for(let _=0;_<p.length;_+=3)if(p[_]===n){s.push(u,p[_+1],p[_+2],t[c+1]);break}}c+=2}else c+=2;else c+=4}return s}function vb(e,n,t,s){return[e,!0,0,n,null,s,null,t,null,null]}function ak(e,n){const t=e.contentQueries;if(null!==t){const s=gt(null);try{for(let c=0;c<t.length;c+=2){const p=t[c+1];if(-1!==p){const _=e.data[p];gy(t[c]),_.contentQueries(2,n[p],p)}}}finally{gt(s)}}}function kg(e,n){return e[Km]?e[BN][da]=n:e[Km]=n,e[BN]=n,n}function $w(e,n,t){gy(0);const s=gt(null);try{n(e,t)}finally{gt(s)}}function Eb(e){return e[Yc]??=[]}function Xw(e){return e.cleanup??=[]}function yb(e,n){const t=e[si],s=t?t.get(Ea,null):null;s&&s.handleError(n)}function bb(e,n,t,s,c){for(let u=0;u<t.length;){const p=t[u++],_=t[u++],E=t[u++];QM(e.data[p],n[p],s,_,E,c)}}function ck(e,n){const t=Es(n,e),s=t[we];!function Jw(e,n){for(let t=n.length;t<e.blueprint.length;t++)n.push(e.blueprint[t])}(s,t);const c=t[rr];null!==c&&null===t[To]&&(t[To]=aw(c,t[si])),Zp(s,t,t[ir])}function Zp(e,n,t){w0(n);try{const s=e.viewQuery;null!==s&&$w(1,s,t);const c=e.template;null!==c&&Gw(e,n,c,1,t),e.firstCreatePass&&(e.firstCreatePass=!1),n[ua]?.finishViewCreation(e),e.staticContentQueries&&ak(e,n),e.staticViewQueries&&$w(2,e.viewQuery,t);const u=e.components;null!==u&&function Hj(e,n){for(let t=0;t<n.length;t++)ck(e,n[t])}(n,u)}catch(s){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),s}finally{n[Ye]&=-5,I0()}}function ce(e,n,t,s){const c=gt(null);try{const u=n.tView,E=ub(e,u,t,4096&e[Ye]?4096:16,null,n,null,null,s?.injector??null,s?.embeddedViewInjector??null,s?.dehydratedView??null);E[$c]=e[n.index];const w=e[ua];return null!==w&&(E[ua]=w.createEmbeddedView(u)),Zp(u,E,t),E}finally{gt(c)}}function Mt(e,n){const t=Yr+n;if(t<e.length)return e[t]}function gd(e,n){return!n||null===n.firstChild||Up(e)}function Wu(e,n,t,s=!0){const c=n[we];if(function xM(e,n,t,s){const c=Yr+s,u=t.length;s>0&&(t[c-1][da]=n),s<u-Yr?(n[da]=t[c],NN(t,Yr+s,n)):(t.push(n),n[da]=null),n[oi]=t;const p=n[$c];null!==p&&t!==p&&lb(p,n);const _=n[ua];null!==_&&_.insertView(e),_0(n),n[Ye]|=128}(c,n,e,t),s){const p=Uw(t,e),_=n[pt],E=Fw(_,e[cc]);null!==E&&function Tj(e,n,t,s,c,u){s[rr]=c,s[Fi]=n,db(e,s,t,1,c,u)}(c,e[Fi],_,n,E,p)}const u=n[To];null!==u&&null!==u.firstChild&&(u.firstChild=null)}function Lg(e,n){const t=Rg(e,n);return void 0!==t&&Ag(t[we],t),t}function Jp(e,n,t,s,c=!1){for(;null!==t;){if(128===t.type){t=c?t.projectionNext:t.next;continue}const u=n[t.index];null!==u&&s.push(un(u)),no(u)&&Qw(u,s);const p=t.type;if(8&p)Jp(e,n,t.child,s);else if(32&p){const _=ab(t,n);let E;for(;E=_();)s.push(E)}else if(16&p){const _=KM(n,t);if(Array.isArray(_))s.push(..._);else{const E=Xc(n[ur]);Jp(E[we],E,_,s,!0)}}t=c?t.projectionNext:t.next}return s}function Qw(e,n){for(let t=Yr;t<e.length;t++){const s=e[t],c=s[we].firstChild;null!==c&&Jp(s[we],s,c,n)}e[cc]!==e[rr]&&n.push(e[cc])}let lk=[];const uk={...pu,consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{tg(e.lView)},consumerOnSignalRead(){this.lView[Fs]=this}},hk={...pu,consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{let n=Xc(e.lView);for(;n&&!tI(n[we]);)n=Xc(n);n&&eg(n)},consumerOnSignalRead(){this.lView[Fs]=this}};function tI(e){return 2!==e.type}const pk=100;function xg(e,n=!0,t=0){const s=e[ac],c=s.rendererFactory;c.begin?.();try{!function Wj(e,n){const t=S0();try{eP(!0),zu(e,n);let s=0;for(;Tu(e);){if(s===pk)throw new ae(103,!1);s++,zu(e,1)}}finally{eP(t)}}(e,t)}catch(p){throw n&&yb(e,p),p}finally{c.end?.(),s.inlineEffectRunner?.flush()}}function mk(e,n,t,s){const c=n[Ye];if(!(256&~c))return;n[ac].inlineEffectRunner?.flush(),w0(n);let _=!0,E=null,S=null;tI(e)?(S=function Sb(e){return e[Fs]??function dk(e){const n=lk.pop()??Object.create(uk);return n.lView=e,n}(e)}(n),E=Am(S)):null===function nc(){return Sr}()?(_=!1,S=function Gj(e){const n=e[Fs]??Object.create(hk);return n.lView=e,n}(n),E=Am(S)):n[Fs]&&(wE(n[Fs]),n[Fs]=null);try{hy(n),function tP(e){return _t.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==t&&Gw(e,n,t,2,s);const w=!(3&~c);if(w){const V=e.preOrderCheckHooks;null!==V&&vy(n,V,null)}else{const V=e.preOrderHooks;null!==V&&ig(n,V,0,null),Ey(n,0)}if(function zj(e){for(let n=VP(e);null!==n;n=BP(n)){if(!(n[Ye]&dy.HasTransplantedViews))continue;const t=n[Cp];for(let s=0;s<t.length;s++)eg(t[s])}}(n),nI(n,0),null!==e.contentQueries&&ak(e,n),w){const V=e.contentCheckHooks;null!==V&&vy(n,V)}else{const V=e.contentHooks;null!==V&&ig(n,V,1),Ey(n,1)}!function Aj(e,n){const t=e.hostBindingOpCodes;if(null!==t)try{for(let s=0;s<t.length;s++){const c=t[s];if(c<0)ld(~c);else{const u=c,p=t[++s],_=t[++s];pB(p,u),_(2,n[u])}}}finally{ld(-1)}}(e,n);const D=e.components;null!==D&&vk(n,D,0);const U=e.viewQuery;if(null!==U&&$w(2,U,s),w){const V=e.viewCheckHooks;null!==V&&vy(n,V)}else{const V=e.viewHooks;null!==V&&ig(n,V,2),Ey(n,2)}if(!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),n[ad]){for(const V of n[ad])V();n[ad]=null}n[Ye]&=-73}catch(w){throw tg(n),w}finally{null!==S&&(TE(S,E),_&&function eI(e){e.lView[Fs]!==e&&(e.lView=null,lk.push(e))}(S)),I0()}}function nI(e,n){for(let t=VP(e);null!==t;t=BP(t))for(let s=Yr;s<t.length;s++)_k(t[s],n)}function gk(e,n,t){_k(Es(n,e),t)}function _k(e,n){Tp(e)&&zu(e,n)}function zu(e,n){const s=e[we],c=e[Ye],u=e[Fs];let p=!!(0===n&&16&c);if(p||=!!(64&c&&0===n),p||=!!(1024&c),p||=!(!u?.dirty||!rp(u)),p||=!1,u&&(u.dirty=!1),e[Ye]&=-9217,p)mk(s,e,s.template,e[ir]);else if(8192&c){nI(e,1);const _=s.components;null!==_&&vk(e,_,1)}}function vk(e,n,t){for(let s=0;s<n.length;s++)gk(e,n[s],t)}function Qp(e,n){const t=S0()?64:1088;for(e[ac].changeDetectionScheduler?.notify(n);e;){e[Ye]|=t;const s=Xc(e);if($m(e)&&!s)return e;e=s}return null}class Fg{get rootNodes(){const n=this._lView,t=n[we];return Jp(t,n,t.firstChild,[])}constructor(n,t,s=!0){this._lView=n,this._cdRefInjectingView=t,this.notifyErrorHandler=s,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[ir]}set context(n){this._lView[ir]=n}get destroyed(){return!(256&~this._lView[Ye])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[oi];if(no(n)){const t=n[8],s=t?t.indexOf(this):-1;s>-1&&(Rg(n,s),Um(t,s))}this._attachedToViewContainer=!1}Ag(this._lView[we],this._lView)}onDestroy(n){py(this._lView,n)}markForCheck(){Qp(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[Ye]&=-129}reattach(){_0(this._lView),this._lView[Ye]|=128}detectChanges(){this._lView[Ye]|=1024,xg(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new ae(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;const n=$m(this._lView),t=this._lView[$c];null!==t&&!n&&kw(t,this._lView),Mw(this._lView[we],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new ae(902,!1);this._appRef=n;const t=$m(this._lView),s=this._lView[$c];null!==s&&!t&&lb(s,this._lView),_0(this._lView)}}let al=(()=>{class e{static{this.__NG_ELEMENT_ID__=qj}}return e})();const Kj=al,Ek=class extends Kj{constructor(n,t,s){super(),this._declarationLView=n,this._declarationTContainer=t,this.elementRef=s}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,t){return this.createEmbeddedViewImpl(n,t)}createEmbeddedViewImpl(n,t,s){const c=ce(this._declarationLView,this._declarationTContainer,n,{embeddedViewInjector:t,dehydratedView:s});return new Fg(c)}};function qj(){return Ug(Un(),ue())}function Ug(e,n){return 4&e.type?new Ek(n,e,xp(e,n)):null}let Bk=()=>null;function Ta(e,n){return Bk(e,n)}class tf{}const Ju=new Te("",{providedIn:"root",factory:()=>!1}),kb=new Te(""),nf=new Te("");class _I{}class vI{}class Wk{resolveComponentFactory(n){throw function Gk(e){const n=Error(`No component factory found for ${fi(e)}.`);return n.ngComponent=e,n}(n)}}class rf{static{this.NULL=new Wk}}class Lb{}let _c=(()=>{class e{constructor(){this.destroyNode=null}static{this.__NG_ELEMENT_ID__=()=>function m3(){const e=ue(),t=Es(Un().index,e);return(_i(t)?t:e)[pt]}()}}return e})(),zk=(()=>{class e{static{this.\u0275prov=Oe({token:e,providedIn:"root",factory:()=>null})}}return e})();function Fb(e,n,t){let s=t?e.styles:null,c=t?e.classes:null,u=0;if(null!==n)for(let p=0;p<n.length;p++){const _=n[p];"number"==typeof _?u=_:1==u?c=AT(c,_):2==u&&(s=AT(s,_+": "+n[++p]+";"))}t?e.styles=s:e.stylesWithoutHost=s,t?e.classes=c:e.classesWithoutHost=c}class CI extends rf{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const t=Wt(n);return new sf(t,this.ngModule)}}function qk(e,n){const t=[];for(const s in e){if(!e.hasOwnProperty(s))continue;const c=e[s];if(void 0===c)continue;const u=Array.isArray(c),p=u?c[0]:c;t.push(n?{propName:p,templateName:s,isSignal:!!((u?c[1]:Kc.None)&Kc.SignalBased)}:{propName:p,templateName:s})}return t}class sf extends vI{get inputs(){const n=this.componentDef,t=n.inputTransforms,s=qk(n.inputs,!0);if(null!==t)for(const c of s)t.hasOwnProperty(c.propName)&&(c.transform=t[c.propName]);return s}get outputs(){return qk(this.componentDef.outputs,!1)}constructor(n,t){super(),this.componentDef=n,this.ngModule=t,this.componentType=n.type,this.selector=function BV(e){return e.map(Ep).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!t}create(n,t,s,c){const u=gt(null);try{let p=(c=c||this.ngModule)instanceof Yo?c:c?.injector;p&&null!==this.componentDef.getStandaloneInjector&&(p=this.componentDef.getStandaloneInjector(p)||p);const _=p?new Ru(n,p):n,E=_.get(Lb,null);if(null===E)throw new ae(407,!1);const D={rendererFactory:E,sanitizer:_.get(zk,null),inlineEffectRunner:null,changeDetectionScheduler:_.get(tf,null)},U=E.createRenderer(null,this.componentDef),V=this.componentDef.selectors[0][0]||"div",H=s?function Oj(e,n,t,s){const u=s.get(tM,!1)||t===ca.ShadowDom,p=e.selectRootElement(n,u);return function Nj(e){tk(e)}(p),p}(U,s,this.componentDef.encapsulation,_):Ig(U,V,function Yk(e){const n=e.toLowerCase();return"svg"===n?qN:"math"===n?"math":null}(V));let z=512;this.componentDef.signals?z|=4096:this.componentDef.onPush||(z|=16);let Q=null;null!==H&&(Q=aw(H,_,!0));const ie=zw(0,null,null,1,0,null,null,null,null,null,null),ne=ub(null,ie,null,z,null,null,D,U,_,null,Q);w0(ne);let ke,Ge,jt=null;try{const cn=this.componentDef;let An,Ii=null;cn.findHostDirectiveDefs?(An=[],Ii=new Map,cn.findHostDirectiveDefs(cn,An,Ii),An.push(cn)):An=[cn];const uu=function Qg(e,n){const t=e[we],s=He;return e[s]=n,Gu(t,s,2,"#host",null)}(ne,H);jt=function $k(e,n,t,s,c,u,p){const _=c[we];!function Xk(e,n,t,s){for(const c of e)n.mergedAttrs=Vm(n.mergedAttrs,c.hostAttrs);null!==n.mergedAttrs&&(Fb(n,n.mergedAttrs,!0),null!==t&&XM(s,t,n))}(s,e,n,p);let E=null;null!==n&&(E=aw(n,c[si]));const S=u.rendererFactory.createRenderer(n,t);let w=16;t.signals?w=4096:t.onPush&&(w=64);const D=ub(c,ek(t),null,w,c[e.index],e,u,S,null,null,E);return _.firstCreatePass&&Yw(_,e,s.length-1),kg(c,D),c[e.index]=D}(uu,H,cn,An,ne,D,U),Ge=Qm(ie,He),H&&function Jk(e,n,t,s){if(s)HT(e,t,["ng-version","18.2.10"]);else{const{attrs:c,classes:u}=function jV(e){const n=[],t=[];let s=1,c=2;for(;s<e.length;){let u=e[s];if("string"==typeof u)2===c?""!==u&&n.push(u,e[++s]):8===c&&t.push(u);else{if(!la(c))break;c=u}s++}return{attrs:n,classes:t}}(n.selectors[0]);c&&HT(e,t,c),u&&u.length>0&&jw(e,t,u.join(" "))}}(U,cn,H,s),void 0!==t&&function y3(e,n,t){const s=e.projection=[];for(let c=0;c<n.length;c++){const u=t[c];s.push(null!=u?Array.from(u):null)}}(Ge,this.ngContentSelectors,t),ke=function Zk(e,n,t,s,c,u){const p=Un(),_=c[we],E=Ui(p,c);qw(_,c,p,t,null,s);for(let w=0;w<t.length;w++)oo(Du(c,_,p.directiveStart+w,p),c);ok(_,c,p),E&&oo(E,c);const S=Du(c,_,p.directiveStart+p.componentOffset,p);if(e[ir]=c[ir]=S,null!==u)for(const w of u)w(S,n);return Ww(_,p,c),S}(jt,cn,An,Ii,ne,[b3]),Zp(ie,ne,null)}catch(cn){throw null!==jt&&xu(jt),xu(ne),cn}finally{I0()}return new E3(this.componentType,ke,xp(Ge,ne),ne,Ge)}finally{gt(u)}}}class E3 extends _I{constructor(n,t,s,c,u){super(),this.location=s,this._rootLView=c,this._tNode=u,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new Fg(c,void 0,!1),this.componentType=n}setInput(n,t){const s=this._tNode.inputs;let c;if(null!==s&&(c=s[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),t))return;const u=this._rootLView;bb(u[we],u,c,n,t),this.previousInputValues.set(n,t),Qp(Es(this._tNode.index,u),1)}}get injector(){return new Tr(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}function b3(){const e=Un();Ap(ue()[we],e)}let js=(()=>{class e{static{this.__NG_ELEMENT_ID__=vd}}return e})();function vd(){return e1(Un(),ue())}const Ub=js,TI=class extends Ub{constructor(n,t,s){super(),this._lContainer=n,this._hostTNode=t,this._hostLView=s}get element(){return xp(this._hostTNode,this._hostLView)}get injector(){return new Tr(this._hostTNode,this._hostLView)}get parentInjector(){const n=dd(this._hostTNode,this._hostLView);if(ag(n)){const t=lg(n,this._hostLView),s=cg(n);return new Tr(t[we].data[s+8],t)}return new Tr(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const t=Qk(this._lContainer);return null!==t&&t[n]||null}get length(){return this._lContainer.length-Yr}createEmbeddedView(n,t,s){let c,u;"number"==typeof s?c=s:null!=s&&(c=s.index,u=s.injector);const p=Ta(this._lContainer,n.ssrId),_=n.createEmbeddedViewImpl(t||{},u,p);return this.insertImpl(_,c,gd(this._hostTNode,p)),_}createComponent(n,t,s,c,u){const p=n&&!function zm(e){return"function"==typeof e}(n);let _;if(p)_=t;else{const H=t||{};_=H.index,s=H.injector,c=H.projectableNodes,u=H.environmentInjector||H.ngModuleRef}const E=p?n:new sf(Wt(n)),S=s||this.parentInjector;if(!u&&null==E.ngModule){const z=(p?S:this.parentInjector).get(Yo,null);z&&(u=z)}const w=Wt(E.componentType??{}),D=Ta(this._lContainer,w?.id??null),V=E.create(S,c,D?.firstChild??null,u);return this.insertImpl(V.hostView,_,gd(this._hostTNode,D)),V}insert(n,t){return this.insertImpl(n,t,!0)}insertImpl(n,t,s){const c=n._lView;if(function lB(e){return no(e[oi])}(c)){const _=this.indexOf(n);if(-1!==_)this.detach(_);else{const E=c[oi],S=new TI(E,E[Fi],E[oi]);S.detach(S.indexOf(n))}}const u=this._adjustIndex(t),p=this._lContainer;return Wu(p,c,u,s),n.attachToViewContainerRef(),NN(wI(p),u,n),n}move(n,t){return this.insert(n,t)}indexOf(n){const t=Qk(this._lContainer);return null!==t?t.indexOf(n):-1}remove(n){const t=this._adjustIndex(n,-1),s=Rg(this._lContainer,t);s&&(Um(wI(this._lContainer),t),Ag(s[we],s))}detach(n){const t=this._adjustIndex(n,-1),s=Rg(this._lContainer,t);return s&&null!=Um(wI(this._lContainer),t)?new Fg(s):null}_adjustIndex(n,t=0){return n??this.length+t}};function Qk(e){return e[8]}function wI(e){return e[8]||(e[8]=[])}function e1(e,n){let t;const s=n[e.index];return no(s)?t=s:(t=vb(s,n,null,e),n[e.index]=t,kg(n,t)),II(t,n,e,s),new TI(t,e,n)}let II=function AI(e,n,t,s){if(e[cc])return;let c;c=8&t.type?un(s):function S3(e,n){const t=e[pt],s=t.createComment(""),c=Ui(n,e);return Hu(t,Fw(t,c),s,function jM(e,n){return e.nextSibling(n)}(t,c),!1),s}(n,t),e[cc]=c},Vb=()=>!1;class DI{constructor(n){this.queryList=n,this.matches=null}clone(){return new DI(this.queryList)}setDirty(){this.queryList.setDirty()}}class OI{constructor(n=[]){this.queries=n}createEmbeddedView(n){const t=n.queries;if(null!==t){const s=null!==n.contentQueries?n.contentQueries[0]:t.length,c=[];for(let u=0;u<s;u++){const p=t.getByIndex(u);c.push(this.queries[p.indexInDeclarationView].clone())}return new OI(c)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}finishViewCreation(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let t=0;t<this.queries.length;t++)null!==xI(n,t).matches&&this.queries[t].setDirty()}}class n1{constructor(n,t,s=null){this.flags=t,this.read=s,this.predicate="string"==typeof n?function R3(e){return e.split(",").map(n=>n.trim())}(n):n}}class NI{constructor(n=[]){this.queries=n}elementStart(n,t){for(let s=0;s<this.queries.length;s++)this.queries[s].elementStart(n,t)}elementEnd(n){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(n)}embeddedTView(n){let t=null;for(let s=0;s<this.length;s++){const c=null!==t?t.length:0,u=this.getByIndex(s).embeddedTView(n,c);u&&(u.indexInDeclarationView=s,null!==t?t.push(u):t=[u])}return null!==t?new NI(t):null}template(n,t){for(let s=0;s<this.queries.length;s++)this.queries[s].template(n,t)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class PI{constructor(n,t=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(n,t){this.isApplyingToNode(t)&&this.matchTNode(n,t)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,t){this.elementStart(n,t)}embeddedTView(n,t){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,t),new PI(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1&~this.metadata.flags){const t=this._declarationNodeIndex;let s=n.parent;for(;null!==s&&8&s.type&&s.index!==t;)s=s.parent;return t===(null!==s?s.index:-1)}return this._appliesToNextNode}matchTNode(n,t){const s=this.metadata.predicate;if(Array.isArray(s))for(let c=0;c<s.length;c++){const u=s[c];this.matchTNodeWithReadOption(n,t,w3(t,u)),this.matchTNodeWithReadOption(n,t,ug(t,n,u,!1,!1))}else s===al?4&t.type&&this.matchTNodeWithReadOption(n,t,-1):this.matchTNodeWithReadOption(n,t,ug(t,n,s,!1,!1))}matchTNodeWithReadOption(n,t,s){if(null!==s){const c=this.metadata.read;if(null!==c)if(c===On||c===js||c===al&&4&t.type)this.addMatch(t.index,-2);else{const u=ug(t,n,c,!1,!1);null!==u&&this.addMatch(t.index,u)}else this.addMatch(t.index,s)}}addMatch(n,t){null===this.matches?this.matches=[n,t]:this.matches.push(n,t)}}function w3(e,n){const t=e.localNames;if(null!==t)for(let s=0;s<t.length;s+=2)if(t[s]===n)return t[s+1];return null}function r1(e,n,t,s){return-1===t?function I3(e,n){return 11&e.type?xp(e,n):4&e.type?Ug(e,n):null}(n,e):-2===t?function o1(e,n,t){return t===On?xp(n,e):t===al?Ug(n,e):t===js?e1(n,e):void 0}(e,n,s):Du(e,e[we],t,n)}function s1(e,n,t,s){const c=n[ua].queries[s];if(null===c.matches){const u=e.data,p=t.matches,_=[];for(let E=0;null!==p&&E<p.length;E+=2){const S=p[E];_.push(S<0?null:r1(n,u[S],p[E+1],t.metadata.read))}c.matches=_}return c.matches}function MI(e,n,t,s){const c=e.queries.getByIndex(t),u=c.matches;if(null!==u){const p=s1(e,n,c,t);for(let _=0;_<u.length;_+=2){const E=u[_];if(E>0)s.push(p[_/2]);else{const S=u[_+1],w=n[-E];for(let D=Yr;D<w.length;D++){const U=w[D];U[$c]===U[oi]&&MI(U[we],U,S,s)}if(null!==w[Cp]){const D=w[Cp];for(let U=0;U<D.length;U++){const V=D[U];MI(V[we],V,S,s)}}}}}return s}function e_(e,n){return e[ua].queries[n].queryList}function a1(e,n,t){const s=new ku(!(4&~t));return function Pj(e,n,t,s){const c=Eb(n);c.push(t),e.firstCreatePass&&Xw(e).push(s,c.length-1)}(e,n,s,s.destroy),(n[ua]??=new OI).queries.push(new DI(s))-1}function kI(e,n,t,s){const c=Vt();if(c.firstCreatePass){const u=Un();LI(c,new n1(n,t,s),u.index),function A3(e,n){const t=e.contentQueries||(e.contentQueries=[]);n!==(t.length?t[t.length-1]:-1)&&t.push(e.queries.length-1,n)}(c,e),!(2&~t)&&(c.staticContentQueries=!0)}return a1(c,ue(),t)}function LI(e,n,t){null===e.queries&&(e.queries=new NI),e.queries.track(new PI(n,t))}function xI(e,n){return e.queries.getByIndex(n)}function l1(e,n){const t=e[we],s=xI(t,n);return s.crossesNgTemplate?MI(t,e,n,[]):s1(t,e,s,n)}const t_=new Set;function ji(e){t_.has(e)||(t_.add(e),performance?.mark?.("mark_feature_usage",{detail:{feature:e}}))}function Ed(e,n){ji("NgSignals");const t=function lN(e){const n=Object.create(dV);n.value=e;const t=()=>(xn(n),n.value);return t[Pt]=n,t}(e),s=t[Pt];return n?.equal&&(s.equal=n.equal),t.set=c=>Hc(s,c),t.update=c=>function DE(e,n){oN()||Om(),Hc(e,n(e.value))}(s,c),t.asReadonly=FI.bind(t),t}function FI(){const e=this[Pt];if(void 0===e.readonlyFn){const n=()=>this();n[Pt]=e,e.readonlyFn=n}return e.readonlyFn}function Bb(e,n){let t;const s=AE(()=>{t._dirtyCounter();const c=function O3(e,n){const t=e._lView,s=e._queryIndex;if(void 0===t||void 0===s||4&t[Ye])return n?void 0:dn;const c=e_(t,s),u=l1(t,s);return c.reset(u,K0),n?c.first:c._changesDetected||void 0===e._flatValue?e._flatValue=c.toArray():e._flatValue}(t,e);if(n&&void 0===c)throw new ae(-951,!1);return c});return t=s[Pt],t._dirtyCounter=Ed(0),t._flatValue=void 0,s}function jb(e,n){return function UI(){return Bb(!0,!1)}()}const BI=(jb.required=function N3(e,n){return function Qu(){return Bb(!0,!0)}()},jb);function tn(e){let n=function f1(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),t=!0;const s=[e];for(;n;){let c;if(pa(e))c=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new ae(903,!1);c=n.\u0275dir}if(c){if(t){s.push(c);const p=e;p.inputs=yd(e.inputs),p.inputTransforms=yd(e.inputTransforms),p.declaredInputs=yd(e.declaredInputs),p.outputs=yd(e.outputs);const _=c.hostBindings;_&&B3(e,_);const E=c.viewQuery,S=c.contentQueries;if(E&&zI(e,E),S&&g1(e,S),m1(e,c),bN(e.outputs,c.outputs),pa(c)&&c.data.animation){const w=e.data;w.animation=(w.animation||[]).concat(c.data.animation)}}const u=c.features;if(u)for(let p=0;p<u.length;p++){const _=u[p];_&&_.ngInherit&&_(e),_===tn&&(t=!1)}}n=Object.getPrototypeOf(n)}!function Hb(e){let n=0,t=null;for(let s=e.length-1;s>=0;s--){const c=e[s];c.hostVars=n+=c.hostVars,c.hostAttrs=Vm(c.hostAttrs,t=Vm(t,c.hostAttrs))}}(s)}function m1(e,n){for(const t in n.inputs){if(!n.inputs.hasOwnProperty(t)||e.inputs.hasOwnProperty(t))continue;const s=n.inputs[t];if(void 0!==s&&(e.inputs[t]=s,e.declaredInputs[t]=n.declaredInputs[t],null!==n.inputTransforms)){const c=Array.isArray(s)?s[0]:s;if(!n.inputTransforms.hasOwnProperty(c))continue;e.inputTransforms??={},e.inputTransforms[c]=n.inputTransforms[c]}}}function yd(e){return e===mi?{}:e===dn?[]:e}function zI(e,n){const t=e.viewQuery;e.viewQuery=t?(s,c)=>{n(s,c),t(s,c)}:n}function g1(e,n){const t=e.contentQueries;e.contentQueries=t?(s,c,u)=>{n(s,c,u),t(s,c,u)}:n}function B3(e,n){const t=e.hostBindings;e.hostBindings=t?(s,c)=>{n(s,c),t(s,c)}:n}function a_(e){const n=e.inputConfig,t={};for(const s in n)if(n.hasOwnProperty(s)){const c=n[s];Array.isArray(c)&&c[3]&&(t[s]=c[3])}e.inputTransforms=t}class eh{}class v1{}class $I extends eh{constructor(n,t,s,c=!0){super(),this.ngModuleType=n,this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new CI(this);const u=to(n);this._bootstrapComponents=Jo(u.bootstrap),this._r3Injector=Mp(n,t,[{provide:eh,useValue:this},{provide:rf,useValue:this.componentFactoryResolver},...s],fi(n),new Set(["environment"])),c&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class Gb extends v1{constructor(n){super(),this.moduleType=n}create(n){return new $I(this.moduleType,n,[])}}class y1 extends eh{constructor(n){super(),this.componentFactoryResolver=new CI(this),this.instance=null;const t=new yp([...n.providers,{provide:eh,useValue:this},{provide:rf,useValue:this.componentFactoryResolver}],n.parent||iy(),n.debugName,new Set(["environment"]));this.injector=t,n.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}}function XI(e,n,t=null){return new y1({providers:e,parent:n,debugName:t,runEnvironmentInitializers:!0}).injector}function Ra(e,n,t){return e[n]=t}function $r(e,n,t){return!Object.is(e[n],t)&&(e[n]=t,!0)}function Sd(e,n,t,s){const c=$r(e,n,t);return $r(e,n+1,s)||c}function l_(e,n,t,s,c,u,p,_,E,S){const w=t+He,D=n.firstCreatePass?function K3(e,n,t,s,c,u,p,_,E){const S=n.consts,w=Gu(n,e,4,p||null,_||null);Io(n,t,w,Vi(S,E)),Ap(n,w);const D=w.tView=zw(2,w,s,c,u,n.directiveRegistry,n.pipeRegistry,null,n.schemas,S,null);return null!==n.queries&&(n.queries.template(n,w),D.queries=n.queries.embeddedTView(w)),w}(w,n,e,s,c,u,p,_,E):n.data[w];ma(D,!1);const U=JI(n,e,D,t);Rp()&&md(n,e,U,D),oo(U,e);const V=vb(U,e,U,D);return e[w]=V,kg(e,V),function RI(e,n,t){return Vb(e,n,t)}(V,D,e),lc(D)&&hb(n,e,D),null!=E&&pb(e,D,S),D}function br(e,n,t,s,c,u,p,_){const E=ue(),S=Vt();return l_(E,S,e,n,t,s,c,Vi(S.consts,u),p,_),br}let JI=function QI(e,n,t,s){return hc(!0),n[pt].createComment("")};var pf=function(e){return e[e.EarlyRead=0]="EarlyRead",e[e.Write=1]="Write",e[e.MixedReadWrite=2]="MixedReadWrite",e[e.Read=3]="Read",e}(pf||{});let d_=(()=>{class e{constructor(){this.impl=null}execute(){this.impl?.execute()}static{this.\u0275prov=Oe({token:e,providedIn:"root",factory:()=>new e})}}return e})();class ff{constructor(){this.ngZone=me(ft),this.scheduler=me(tf),this.errorHandler=me(Ea,{optional:!0}),this.sequences=new Set,this.deferredRegistrations=new Set,this.executing=!1}static{this.PHASES=[pf.EarlyRead,pf.Write,pf.MixedReadWrite,pf.Read]}execute(){this.executing=!0;for(const n of ff.PHASES)for(const t of this.sequences)if(!t.erroredOrDestroyed&&t.hooks[n])try{t.pipelinedValue=this.ngZone.runOutsideAngular(()=>t.hooks[n](t.pipelinedValue))}catch(s){t.erroredOrDestroyed=!0,this.errorHandler?.handleError(s)}this.executing=!1;for(const n of this.sequences)n.afterRun(),n.once&&(this.sequences.delete(n),n.destroy());for(const n of this.deferredRegistrations)this.sequences.add(n);this.deferredRegistrations.size>0&&this.scheduler.notify(7),this.deferredRegistrations.clear()}register(n){this.executing?this.deferredRegistrations.add(n):(this.sequences.add(n),this.scheduler.notify(6))}unregister(n){this.executing&&this.sequences.has(n)?(n.erroredOrDestroyed=!0,n.pipelinedValue=void 0,n.once=!0):(this.sequences.delete(n),this.deferredRegistrations.delete(n))}static{this.\u0275prov=Oe({token:ff,providedIn:"root",factory:()=>new ff})}}class R1{constructor(n,t,s,c){this.impl=n,this.hooks=t,this.once=s,this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.unregisterOnDestroy=c?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.()}}function rh(e,n){!n?.injector&&r0();const t=n?.injector??me(Dr);return ys(t)?(ji("NgAfterRender"),A1(e,t,n,!1)):D1}function mf(e,n){!n?.injector&&r0();const t=n?.injector??me(Dr);return ys(t)?(ji("NgAfterNextRender"),A1(e,t,n,!0)):D1}function A1(e,n,t,s){const c=n.get(d_);c.impl??=n.get(ff);const u=t?.phase??pf.MixedReadWrite,p=!0!==t?.manualCleanup?n.get(Nu):null,_=new R1(c.impl,function X3(e,n){if(e instanceof Function){const t=[void 0,void 0,void 0,void 0];return t[n]=e,t}return[e.earlyRead,e.write,e.mixedReadWrite,e.read]}(e,u),s,p);return c.impl.register(_),_}const D1={destroy(){}};function Jr(e,n,t,s){const c=ue();return $r(c,ga(),n)&&(Vt(),Sa(or(),c,e,n,t,s)),Jr}function E_(e,n){return e<<17|n<<2}function hl(e){return e>>17&32767}function y_(e){return 2|e}function ns(e){return(131068&e)>>2}function Cf(e,n){return-131069&e|n<<2}function b_(e){return 1|e}function Oi(e,n,t,s){const c=e[t+1],u=null===n;let p=s?hl(c):ns(c),_=!1;for(;0!==p&&(!1===_||u);){const S=e[p+1];d4(e[p],n)&&(_=!0,e[p+1]=s?b_(S):y_(S)),p=s?hl(S):ns(S)}_&&(e[t+1]=s?y_(c):b_(c))}function d4(e,n){return null===e||null==n||(Array.isArray(e)?e[1]:e)===n||!(!Array.isArray(e)||"string"!=typeof n)&&vp(e,n)>=0}const Or={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function S_(e){return e.substring(Or.key,Or.keyEnd)}function hr(e,n){const t=Or.textEnd;return t===n?-1:(n=Or.keyEnd=function ot(e,n,t){for(;n<t&&e.charCodeAt(n)>32;)n++;return n}(e,Or.key=n,t),Dd(e,n,t))}function Dd(e,n,t){for(;n<t&&e.charCodeAt(n)<=32;)n++;return n}function $e(e,n,t){const s=ue();return $r(s,ga(),n)&&Ei(Vt(),or(),s,e,n,s[pt],t,!1),$e}function lS(e,n,t,s,c){const p=c?"class":"style";bb(e,t,n.inputs[p],p,s)}function nt(e,n){return function Ws(e,n,t,s){const c=ue(),u=Vt(),p=Jc(2);u.firstUpdatePass&&pR(u,e,p,s),n!==St&&$r(c,p,n)&&$t(u,u.data[Bi()],c,c[pt],e,c[p+1]=function k(e,n){return null==e||""===e||("string"==typeof n?e+=n:"object"==typeof e&&(e=fi(rl(e)))),e}(n,t),s,p)}(e,n,null,!0),nt}function dS(e){!function zs(e,n,t,s){const c=Vt(),u=Jc(2);c.firstUpdatePass&&pR(c,null,u,s);const p=ue();if(t!==St&&$r(p,u,t)){const _=c.data[Bi()];if(Y(_,s)&&!hR(c,u)){let E=s?_.classesWithoutHost:_.stylesWithoutHost;null!==E&&(t=AT(E,t||"")),lS(c,_,p,t,s)}else!function w_(e,n,t,s,c,u,p,_){c===St&&(c=dn);let E=0,S=0,w=0<c.length?c[0]:null,D=0<u.length?u[0]:null;for(;null!==w||null!==D;){const U=E<c.length?c[E+1]:void 0,V=S<u.length?u[S+1]:void 0;let z,H=null;w===D?(E+=2,S+=2,U!==V&&(H=D,z=V)):null===D||null!==w&&w<D?(E+=2,H=w):(S+=2,H=D,z=V),null!==H&&$t(e,n,t,s,H,z,p,_),w=E<c.length?c[E]:null,D=S<u.length?u[S]:null}}(c,_,p,p[pt],p[u+1],p[u+1]=function mR(e,n,t){if(null==t||""===t)return dn;const s=[],c=rl(t);if(Array.isArray(c))for(let u=0;u<c.length;u++)e(s,c[u],!0);else if("object"==typeof c)for(const u in c)c.hasOwnProperty(u)&&e(s,u,c[u]);else"string"==typeof c&&n(s,c);return s}(e,n,t),s,u)}}(hS,Da,e,!0)}function Da(e,n){for(let t=function Ec(e){return function Hs(e){Or.key=0,Or.keyEnd=0,Or.value=0,Or.valueEnd=0,Or.textEnd=e.length}(e),hr(e,Dd(e,0,Or.textEnd))}(n);t>=0;t=hr(n,t))vs(e,S_(n),!0)}function hR(e,n){return n>=e.expandoStartIndex}function pR(e,n,t,s){const c=e.data;if(null===c[t+1]){const u=c[Bi()],p=hR(e,t);Y(u,s)&&null===n&&!p&&(n=!1),n=function Tf(e,n,t,s){const c=function C0(e){const n=_t.lFrame.currentDirectiveIndex;return-1===n?null:e[n]}(e);let u=s?n.residualClasses:n.residualStyles;if(null===c)0===(s?n.classBindings:n.styleBindings)&&(t=wf(t=uS(null,e,n,t,s),n.attrs,s),u=null);else{const p=n.directiveStylingLast;if(-1===p||e[p]!==c)if(t=uS(c,e,n,t,s),null===u){let E=function fR(e,n,t){const s=t?n.classBindings:n.styleBindings;if(0!==ns(s))return e[hl(s)]}(e,n,s);void 0!==E&&Array.isArray(E)&&(E=uS(null,e,n,E[1],s),E=wf(E,n.attrs,s),function tL(e,n,t,s){e[hl(t?n.classBindings:n.styleBindings)]=s}(e,n,s,E))}else u=function Ks(e,n,t){let s;const c=n.directiveEnd;for(let u=1+n.directiveStylingLast;u<c;u++)s=wf(s,e[u].hostAttrs,t);return wf(s,n.attrs,t)}(e,n,s)}return void 0!==u&&(s?n.residualClasses=u:n.residualStyles=u),t}(c,u,n,s),function l4(e,n,t,s,c,u){let p=u?n.classBindings:n.styleBindings,_=hl(p),E=ns(p);e[s]=t;let w,S=!1;if(Array.isArray(t)?(w=t[1],(null===w||vp(t,w)>0)&&(S=!0)):w=t,c)if(0!==E){const U=hl(e[_+1]);e[s+1]=E_(U,_),0!==U&&(e[U+1]=Cf(e[U+1],s)),e[_+1]=function X1(e,n){return 131071&e|n<<17}(e[_+1],s)}else e[s+1]=E_(_,0),0!==_&&(e[_+1]=Cf(e[_+1],s)),_=s;else e[s+1]=E_(E,0),0===_?_=s:e[E+1]=Cf(e[E+1],s),E=s;S&&(e[s+1]=y_(e[s+1])),Oi(e,w,s,!0),Oi(e,w,s,!1),function ai(e,n,t,s,c){const u=c?e.residualClasses:e.residualStyles;null!=u&&"string"==typeof n&&vp(u,n)>=0&&(t[s+1]=b_(t[s+1]))}(n,w,e,s,u),p=E_(_,E),u?n.classBindings=p:n.styleBindings=p}(c,u,n,t,p,s)}}function uS(e,n,t,s,c){let u=null;const p=t.directiveEnd;let _=t.directiveStylingLast;for(-1===_?_=t.directiveStart:_++;_<p&&(u=n[_],s=wf(s,u.hostAttrs,c),u!==e);)_++;return null!==e&&(t.directiveStylingLast=_),s}function wf(e,n,t){const s=t?1:2;let c=-1;if(null!==n)for(let u=0;u<n.length;u++){const p=n[u];"number"==typeof p?c=p:c===s&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),vs(e,p,!!t||n[++u]))}return void 0===e?null:e}function hS(e,n,t){const s=String(n);""!==s&&!s.includes(" ")&&vs(e,s,t)}function $t(e,n,t,s,c,u,p,_){if(!(3&n.type))return;const E=e.data,S=E[_+1],w=function sS(e){return!(1&~e)}(S)?gR(E,n,t,c,ns(S),p):void 0;Ee(w)||(Ee(u)||function uR(e){return!(2&~e)}(S)&&(u=gR(E,null,t,c,_,p)),function Bw(e,n,t,s,c){if(n)c?e.addClass(t,s):e.removeClass(t,s);else{let u=-1===s.indexOf("-")?void 0:fd.DashCase;null==c?e.removeStyle(t,s,u):("string"==typeof c&&c.endsWith("!important")&&(c=c.slice(0,-10),u|=fd.Important),e.setStyle(t,s,c,u))}}(s,p,Su(Bi(),t),c,u))}function gR(e,n,t,s,c,u){const p=null===n;let _;for(;c>0;){const E=e[c],S=Array.isArray(E),w=S?E[1]:E,D=null===w;let U=t[c+1];U===St&&(U=D?dn:void 0);let V=D?_p(U,s):w===s?U:void 0;if(S&&!Ee(V)&&(V=_p(E,s)),Ee(V)&&(_=V,p))return _;const H=e[c+1];c=p?hl(H):ns(H)}if(null!==n){let E=u?n.residualClasses:n.residualStyles;null!=E&&(_=_p(E,s))}return _}function Ee(e){return void 0!==e}function Y(e,n){return!!(e.flags&(n?8:16))}class rL{destroy(n){}updateValue(n,t){}swap(n,t){const s=Math.min(n,t),c=Math.max(n,t),u=this.detach(c);if(c-s>1){const p=this.detach(s);this.attach(s,u),this.attach(c,p)}else this.attach(s,u)}move(n,t){this.attach(t,this.detach(n))}}function R_(e,n,t,s,c){return e===t&&Object.is(n,s)?1:Object.is(c(e,n),c(t,s))?-1:0}function nn(e,n,t,s){return!(void 0===n||!n.has(s)||(e.attach(t,n.get(s)),n.delete(s),0))}function If(e,n,t,s,c){if(nn(e,n,s,t(s,c)))e.updateValue(s,c);else{const u=e.create(s,c);e.attach(s,u)}}function yR(e,n,t,s){const c=new Set;for(let u=n;u<=t;u++)c.add(s(u,e.at(u)));return c}class Yn{constructor(){this.kvMap=new Map,this._vMap=void 0}has(n){return this.kvMap.has(n)}delete(n){if(!this.has(n))return!1;const t=this.kvMap.get(n);return void 0!==this._vMap&&this._vMap.has(t)?(this.kvMap.set(n,this._vMap.get(t)),this._vMap.delete(t)):this.kvMap.delete(n),!0}get(n){return this.kvMap.get(n)}set(n,t){if(this.kvMap.has(n)){let s=this.kvMap.get(n);void 0===this._vMap&&(this._vMap=new Map);const c=this._vMap;for(;c.has(s);)s=c.get(s);c.set(s,t)}else this.kvMap.set(n,t)}forEach(n){for(let[t,s]of this.kvMap)if(n(s,t),void 0!==this._vMap){const c=this._vMap;for(;c.has(s);)s=c.get(s),n(s,t)}}}function st(e,n){ji("NgControlFlow");const t=ue(),s=ga(),c=t[s]!==St?t[s]:-1,u=-1!==c?gl(t,He+c):void 0;if($r(t,s,e)){const _=gt(null);try{if(void 0!==u&&Lg(u,0),-1!==e){const E=He+e,S=gl(t,E),w=Ao(t[we],E),D=Ta(S,w.tView.ssrId);Wu(S,ce(t,w,n,{dehydratedView:D}),0,gd(w,D))}}finally{gt(_)}}else if(void 0!==u){const _=Mt(u,0);void 0!==_&&(_[ir]=n)}}class iL{constructor(n,t,s){this.lContainer=n,this.$implicit=t,this.$index=s}get $count(){return this.lContainer.length-Yr}}function Rt(e,n){return n}class pS{constructor(n,t,s){this.hasEmptyBlock=n,this.trackByFn=t,this.liveCollection=s}}class Hr extends rL{constructor(n,t,s){super(),this.lContainer=n,this.hostLView=t,this.templateTNode=s,this.operationsCounter=void 0,this.needsIndexUpdate=!1}get length(){return this.lContainer.length-Yr}at(n){return this.getLView(n)[ir].$implicit}attach(n,t){const s=t[To];this.needsIndexUpdate||=n!==this.length,Wu(this.lContainer,t,n,gd(this.templateTNode,s))}detach(n){return this.needsIndexUpdate||=n!==this.length-1,function Gr(e,n){return Rg(e,n)}(this.lContainer,n)}create(n,t){const s=Ta(this.lContainer,this.templateTNode.tView.ssrId),c=ce(this.hostLView,this.templateTNode,new iL(this.lContainer,t,n),{dehydratedView:s});return this.operationsCounter?.recordCreate(),c}destroy(n){Ag(n[we],n),this.operationsCounter?.recordDestroy()}updateValue(n,t){this.getLView(n)[ir].$implicit=t}reset(){this.needsIndexUpdate=!1,this.operationsCounter?.reset()}updateIndexes(){if(this.needsIndexUpdate)for(let n=0;n<this.length;n++)this.getLView(n)[ir].$index=n}getLView(n){return function Bt(e,n){return Mt(e,n)}(this.lContainer,n)}}function gl(e,n){return e[n]}function Ao(e,n){return Qm(e,n)}function Se(e,n,t,s){const c=ue(),u=Vt(),p=He+e,_=c[pt],E=u.firstCreatePass?function A_(e,n,t,s,c,u){const p=n.consts,E=Gu(n,e,2,s,Vi(p,c));return Io(n,t,E,Vi(p,u)),null!==E.attrs&&Fb(E,E.attrs,!1),null!==E.mergedAttrs&&Fb(E,E.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,E),E}(p,u,c,n,t,s):u.data[p],S=D_(u,c,E,_,n,e);c[p]=S;const w=lc(E);return ma(E,!0),XM(_,S,E),!function Cd(e){return!(32&~e.flags)}(E)&&Rp()&&md(u,c,S,E),0===function $N(){return _t.lFrame.elementDepthCount}()&&oo(S,c),function v0(){_t.lFrame.elementDepthCount++}(),w&&(hb(u,c,E),Ww(u,E,c)),null!==s&&pb(c,E),Se}function Be(){let e=Un();y0()?b0():(e=e.parent,ma(e,!1));const n=e;(function wu(e){return _t.skipHydrationRootTNode===e})(n)&&function E0(){_t.skipHydrationRootTNode=null}(),function dB(){_t.lFrame.elementDepthCount--}();const t=Vt();return t.firstCreatePass&&(Ap(t,e),c0(e)&&t.queries.elementEnd(e)),null!=n.classesWithoutHost&&function EB(e){return!!(8&e.flags)}(n)&&lS(t,n,ue(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function hP(e){return!!(16&e.flags)}(n)&&lS(t,n,ue(),n.stylesWithoutHost,!1),Be}function At(e,n,t,s){return Se(e,n,t,s),Be(),At}let D_=(e,n,t,s,c,u)=>(hc(!0),Ig(s,c,function A0(){return _t.lFrame.currentNamespace}()));function Sc(){return ue()}function O_(e,n,t){const s=ue();return $r(s,ga(),n)&&Ei(Vt(),or(),s,e,n,s[pt],t,!0),O_}const Nn="en-US";let P_=Nn,bL=(e,n,t)=>{};function Mn(e,n,t,s){const c=ue(),u=Vt(),p=Un();return function FR(e,n,t,s,c,u,p){const _=lc(s),S=e.firstCreatePass&&Xw(e),w=n[ir],D=Eb(n);let U=!0;if(3&s.type||p){const z=Ui(s,n),Q=p?p(z):z,ie=D.length,ne=p?Ge=>p(un(Ge[s.index])):s.index;let ke=null;if(!p&&_&&(ke=function M4(e,n,t,s){const c=e.cleanup;if(null!=c)for(let u=0;u<c.length-1;u+=2){const p=c[u];if(p===t&&c[u+1]===s){const _=n[Yc],E=c[u+2];return _.length>E?_[E]:null}"string"==typeof p&&(u+=2)}return null}(e,n,c,s.index)),null!==ke)(ke.__ngLastListenerFn__||ke).__ngNextListenerFn__=u,ke.__ngLastListenerFn__=u,U=!1;else{u=SL(s,n,w,u),bL(z,c,u);const Ge=t.listen(Q,c,u);D.push(u,Ge),S&&S.push(c,ne,ie,ie+1)}}else u=SL(s,n,w,u);const V=s.outputs;let H;if(U&&null!==V&&(H=V[c])){const z=H.length;if(z)for(let Q=0;Q<z;Q+=2){const jt=n[H[Q]][H[Q+1]].subscribe(u),cn=D.length;D.push(u,jt),S&&S.push(c,s.index,cn,-(cn+1))}}}(u,c,c[pt],p,e,n,s),Mn}function UR(e,n,t,s){const c=gt(null);try{return dc(6,n,t),!1!==t(s)}catch(u){return yb(e,u),!1}finally{dc(7,n,t),gt(c)}}function SL(e,n,t,s){return function c(u){if(u===Function)return s;Qp(e.componentOffset>-1?Es(e.index,n):n,5);let _=UR(n,t,s,u),E=c.__ngNextListenerFn__;for(;E;)_=UR(n,t,E,u)&&_,E=E.__ngNextListenerFn__;return _}}function Sn(e=1){return function mB(e){return(_t.lFrame.contextLView=function wp(e,n){for(;e>0;)n=n[Sp],e--;return n}(e,_t.lFrame.contextLView))[ir]}(e)}function k4(e,n){let t=null;const s=function FV(e){const n=e.attrs;if(null!=n){const t=n.indexOf(5);if(!(1&t))return n[t+1]}return null}(e);for(let c=0;c<n.length;c++){const u=n[c];if("*"!==u){if(null===s?LN(e,u,!0):VV(s,u))return c}else t=c}return t}function Of(e){const n=ue()[ur][Fi];if(!n.projection){const s=n.projection=function YE(e,n){const t=[];for(let s=0;s<e;s++)t.push(n);return t}(e?e.length:1,null),c=s.slice();let u=n.child;for(;null!==u;){if(128!==u.type){const p=e?k4(u,e):0;null!==p&&(c[p]?c[p].projectionNext=u:s[p]=u,c[p]=u)}u=u.next}}}function co(e,n=0,t,s,c,u){const p=ue(),_=Vt(),E=s?e+1:null;null!==E&&l_(p,_,E,s,c,u,null,t);const S=Gu(_,He+e,16,null,t||null);null===S.projection&&(S.projection=n),b0();const D=!p[To]||Us();null===p[ur][Fi].projection[S.projection]&&null!==E?function L4(e,n,t){const s=He+t,c=n.data[s],u=e[s],p=Ta(u,c.tView.ssrId);Wu(u,ce(e,c,void 0,{dehydratedView:p}),0,gd(c,p))}(p,_,E):D&&32&~S.flags&&function Ij(e,n,t){YM(n[pt],0,n,t,mc(e,t,n),HM(t.parent||n[Fi],t,n))}(_,p,S)}function _h(e,n,t,s){kI(e,n,t,s)}function pe(e,n,t){!function c1(e,n,t){const s=Vt();return s.firstCreatePass&&(LI(s,new n1(e,n,t),-1),!(2&~n)&&(s.staticViewQueries=!0)),a1(s,ue(),n)}(e,n,t)}function ci(e){const n=ue(),t=Vt(),s=T0();gy(s+1);const c=xI(t,s);if(e.dirty&&function cB(e){return!(4&~e[Ye])}(n)===!(2&~c.metadata.flags)){if(null===c.matches)e.reset([]);else{const u=l1(n,s);e.reset(u,K0),e.notifyOnChanges()}return!0}return!1}function kn(){return e_(ue(),T0())}function x_(e,n,t,s,c){!function af(e,n){const t=e[Pt];t._lView=ue(),t._queryIndex=n,t._queryList=e_(t._lView,n),t._queryList.onDirty(()=>t._dirtyCounter.update(s=>s+1))}(n,kI(e,t,s,c))}function Ie(e){return Cu(function QN(){return _t.lFrame.contextLView}(),He+e)}function fn(e,n=""){const t=ue(),s=Vt(),c=e+He,u=s.firstCreatePass?Gu(s,c,1,n,null):s.data[c],p=Cc(s,t,u,n,e);t[c]=p,Rp()&&md(s,t,p,u),ma(u,!1)}let Cc=(e,n,t,s,c)=>(hc(!0),function cb(e,n){return e.createText(n)}(n[pt],s));function at(e){return mr("",e,""),at}function mr(e,n,t){const s=ue(),c=function ch(e,n,t,s){return $r(e,ga(),t)?n+wt(t)+s:St}(s,e,n,t);return c!==St&&function gc(e,n,t){const s=Su(n,e);!function LM(e,n,t){e.setValue(n,t)}(e[pt],s,t)}(s,Bi(),c),mr}function is(e,n,t,s,c){if(e=ht(e),Array.isArray(e))for(let u=0;u<e.length;u++)is(e[u],n,t,s,c);else{const u=Vt(),p=ue(),_=Un();let E=Eu(e)?e:ht(e.provide);const S=Gm(e),w=1048575&_.providerIndexes,D=_.directiveStart,U=_.providerIndexes>>20;if(Eu(e)||!e.multi){const V=new og(S,c,oe),H=Ys(E,n,c?w:w+U,D);-1===H?(ud(Sy(_,p),u,E),_r(u,e,n.length),n.push(E),_.directiveStart++,_.directiveEnd++,c&&(_.providerIndexes+=1048576),t.push(V),p.push(V)):(t[H]=V,p[H]=V)}else{const V=Ys(E,n,w+U,D),H=Ys(E,n,w,w+U),Q=H>=0&&t[H];if(c&&!Q||!c&&!(V>=0&&t[V])){ud(Sy(_,p),u,E);const ie=function Bn(e,n,t,s,c){const u=new og(e,t,oe);return u.multi=[],u.index=n,u.componentProviders=0,zR(u,c,s&&!t),u}(c?Pa:ws,t.length,c,s,S);!c&&Q&&(t[H].providerFactory=ie),_r(u,e,n.length,0),n.push(E),_.directiveStart++,_.directiveEnd++,c&&(_.providerIndexes+=1048576),t.push(ie),p.push(ie)}else _r(u,e,V>-1?V:H,zR(t[c?H:V],S,!c&&s));!c&&s&&Q&&t[H].componentProviders++}}}function _r(e,n,t,s){const c=Eu(n),u=function QT(e){return!!e.useClass}(n);if(c||u){const E=(u?ht(n.useClass):n).prototype.ngOnDestroy;if(E){const S=e.destroyHooks||(e.destroyHooks=[]);if(!c&&n.multi){const w=S.indexOf(t);-1===w?S.push(t,[s,E]):S[w+1].push(s,E)}else S.push(t,E)}}}function zR(e,n,t){return t&&e.componentProviders++,e.multi.push(n)-1}function Ys(e,n,t,s){for(let c=t;c<s;c++)if(n[c]===e)return c;return-1}function ws(e,n,t,s){return Md(this.multi,[])}function Pa(e,n,t,s){const c=this.multi;let u;if(this.providerFactory){const p=this.providerFactory.componentProviders,_=Du(t,t[we],this.providerFactory.index,s);u=_.slice(0,p),Md(c,u);for(let E=p;E<_.length;E++)u.push(_[E])}else u=[],Md(c,u);return u}function Md(e,n){for(let t=0;t<e.length;t++)n.push((0,e[t])());return n}function mn(e,n=[]){return t=>{t.providersResolver=(s,c)=>function qs(e,n,t){const s=Vt();if(s.firstCreatePass){const c=pa(e);is(t,s.data,s.blueprint,c,!0),is(n,s.data,s.blueprint,c,!1)}}(s,c?c(e):e,n)}}let kd=(()=>{class e{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){const s=ey(0,t.type),c=s.length>0?XI([s],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,c)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}static{this.\u0275prov=Oe({token:e,providedIn:"environment",factory:()=>new e(ye(Yo))})}}return e})();function ho(e){ji("NgStandalone"),e.getStandaloneInjector=n=>n.get(kd).getOrCreateStandaloneInjector(e)}function kL(e,n,t,s,c,u,p){return function vh(e,n,t,s,c,u,p,_,E){const S=n+t;return function Qo(e,n,t,s,c,u){const p=Sd(e,n,t,s);return Sd(e,n+2,c,u)||p}(e,S,c,u,p,_)?Ra(e,S+4,E?s.call(E,c,u,p,_):s(c,u,p,_)):H_(e,S+4)}(ue(),io(),e,n,t,s,c,u,p)}function H_(e,n){const t=e[n];return t===St?void 0:t}function Pi(e,n){const t=Vt();let s;const c=e+He;t.firstCreatePass?(s=function FL(e,n){if(n)for(let t=n.length-1;t>=0;t--){const s=n[t];if(e===s.name)return s}}(n,t.pipeRegistry),t.data[c]=s,s.onDestroy&&(t.destroyHooks??=[]).push(c,s.onDestroy)):s=t.data[c];const u=s.factory||(s.factory=Di(s.type)),_=zo(oe);try{const E=by(!1),S=u();return by(E),function li(e,n,t,s){t>=e.data.length&&(e.data[t]=null,e.blueprint[t]=null),n[t]=s}(t,ue(),c,S),S}finally{zo(_)}}function W_(e,n,t){const s=e+He,c=ue(),u=Cu(c,s);return function z_(e,n){return e[we].data[n].pure}(c,s)?function jn(e,n,t,s,c,u){const p=n+t;return $r(e,p,c)?Ra(e,p+1,u?s.call(u,c):s(c)):H_(e,p+1)}(c,io(),n,u.transform,t,u):u.transform(t)}function UL(e,n){return Ug(e,n)}let MS=(()=>{class e{log(t){console.log(t)}warn(t){console.warn(t)}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"platform"})}}return e})();const dA=new Te("");function Z_(e){return!!e&&"function"==typeof e.then}function pA(e){return!!e&&"function"==typeof e.subscribe}const _5=new Te("");let nx=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,s)=>{this.resolve=t,this.reject=s}),this.appInits=me(_5,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const t=[];for(const c of this.appInits){const u=c();if(Z_(u))t.push(u);else if(pA(u)){const p=new Promise((_,E)=>{u.subscribe({complete:_,error:E})});t.push(p)}}const s=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{s()}).catch(c=>{this.reject(c)}),0===t.length&&s(),this.initialized=!0}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const FS=new Te("");let bi=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=me(MB),this.afterRenderManager=me(d_),this.zonelessEnabled=me(Ju),this.dirtyFlags=0,this.deferredDirtyFlags=0,this.externalTestViews=new Set,this.beforeRender=new Gt,this.afterTick=new Gt,this.componentTypes=[],this.components=[],this.isStable=me(hd).hasPendingTasks.pipe(en(t=>!t)),this._injector=me(Yo)}get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}whenStable(){let t;return new Promise(s=>{t=this.isStable.subscribe({next:c=>{c&&s()}})}).finally(()=>{t.unsubscribe()})}get injector(){return this._injector}bootstrap(t,s){const c=t instanceof vI;if(!this._injector.get(nx).done)throw!c&&function od(e){const n=Wt(e)||Vr(e)||Ar(e);return null!==n&&n.standalone}(t),new ae(405,!1);let p;p=c?t:this._injector.get(rf).resolveComponentFactory(t),this.componentTypes.push(p.componentType);const _=function J_(e){return e.isBoundToModule}(p)?void 0:this._injector.get(eh),S=p.create(Dr.NULL,[],s||p.selector,_),w=S.location.nativeElement,D=S.injector.get(dA,null);return D?.registerApplication(w),S.onDestroy(()=>{this.detachView(S.hostView),Sh(this.components,S),D?.unregisterApplication(w)}),this._loadComponent(S),S}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){if(this._runningTick)throw new ae(101,!1);const t=gt(null);try{this._runningTick=!0,this.synchronize()}catch(s){this.internalErrorHandler(s)}finally{this._runningTick=!1,gt(t),this.afterTick.next()}}synchronize(){let t=null;this._injector.destroyed||(t=this._injector.get(Lb,null,{optional:!0})),this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0;let s=0;for(;0!==this.dirtyFlags&&s++<10;)this.synchronizeOnce(t)}synchronizeOnce(t){if(this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0,7&this.dirtyFlags){const s=!!(1&this.dirtyFlags);this.dirtyFlags&=-8,this.dirtyFlags|=8,this.beforeRender.next(s);for(let{_lView:c,notifyErrorHandler:u}of this._views)v5(c,u,s,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),7&this.dirtyFlags)return}else t?.begin?.(),t?.end?.();8&this.dirtyFlags&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){this.allViews.some(({_lView:t})=>Tu(t))?this.dirtyFlags|=2:this.dirtyFlags&=-8}attachView(t){const s=t;this._views.push(s),s.attachToAppRef(this)}detachView(t){const s=t;Sh(this._views,s),s.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const s=this._injector.get(FS,[]);[...this._bootstrapListeners,...s].forEach(c=>c(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>Sh(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new ae(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function Sh(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}function v5(e,n,t,s){(t||Tu(e))&&xg(e,n,t&&!s?0:1)}class gA{constructor(n,t){this.ngModuleFactory=n,this.componentFactories=t}}let sx=(()=>{class e{compileModuleSync(t){return new Gb(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const s=this.compileModuleSync(t),u=Jo(to(t).declarations).reduce((p,_)=>{const E=Wt(_);return E&&p.push(new sf(E)),p},[]);return new gA(s,u)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),cx=(()=>{class e{constructor(){this.zone=me(ft),this.changeDetectionScheduler=me(tf),this.applicationRef=me(bi)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function Vf({ngZoneFactory:e,ignoreChangesOutsideZone:n,scheduleInRootZone:t}){return e??=()=>new ft({...Q_(),scheduleInRootZone:t}),[{provide:ft,useFactory:e},{provide:sc,multi:!0,useFactory:()=>{const s=me(cx,{optional:!0});return()=>s.initialize()}},{provide:sc,multi:!0,useFactory:()=>{const s=me(EA);return()=>{s.initialize()}}},!0===n?{provide:kb,useValue:!0}:[],{provide:nf,useValue:t??Ou}]}function Q_(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}let EA=(()=>{class e{constructor(){this.subscription=new Ur,this.initialized=!1,this.zone=me(ft),this.pendingTasks=me(hd)}initialize(){if(this.initialized)return;this.initialized=!0;let t=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(t=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{ft.assertNotInAngularZone(),queueMicrotask(()=>{null!==t&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(t),t=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{ft.assertInAngularZone(),t??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Rc=(()=>{class e{constructor(){this.appRef=me(bi),this.taskService=me(hd),this.ngZone=me(ft),this.zonelessEnabled=me(Ju),this.disableScheduling=me(kb,{optional:!0})??!1,this.zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run,this.schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}],this.subscriptions=new Ur,this.angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(Dy):null,this.scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(me(nf,{optional:!0})??!1),this.cancelScheduledCallback=null,this.useMicrotaskScheduler=!1,this.runningTick=!1,this.pendingRenderTaskId=null,this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof Lp||!this.zoneIsDefined)}notify(t){if(!this.zonelessEnabled&&5===t)return;switch(t){case 0:this.appRef.dirtyFlags|=2;break;case 3:case 2:case 4:case 5:case 1:this.appRef.dirtyFlags|=4;break;case 7:this.appRef.deferredDirtyFlags|=8;break;default:this.appRef.dirtyFlags|=8}if(!this.shouldScheduleTick())return;const s=this.useMicrotaskScheduler?wP:H0;this.pendingRenderTaskId=this.taskService.add(),this.cancelScheduledCallback=this.scheduleInRootZone?Zone.root.run(()=>s(()=>this.tick())):this.ngZone.runOutsideAngular(()=>s(()=>this.tick()))}shouldScheduleTick(){return!(this.disableScheduling||null!==this.pendingRenderTaskId||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(Dy+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;!this.zonelessEnabled&&7&this.appRef.dirtyFlags&&(this.appRef.dirtyFlags|=1);const t=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(s){throw this.taskService.remove(t),s}finally{this.cleanup()}this.useMicrotaskScheduler=!0,wP(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(t)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,null!==this.pendingRenderTaskId){const t=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(t)}}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const Oo=new Te("",{providedIn:"root",factory:()=>me(Oo,Yt.Optional|Yt.SkipSelf)||function ux(){return typeof $localize<"u"&&$localize.locale||Nn}()}),jS=new Te("");function nv(e){return!e.moduleRef}let Hn=null;let Js=(()=>{class e{static{this.__NG_ELEMENT_ID__=ge}}return e})();function ge(e){return function zt(e,n,t){if(cd(e)&&!t){const s=Es(e.index,n);return new Fg(s,s)}return 175&e.type?new Fg(n[ur],n):null}(Un(),ue(),!(16&~e))}function Lx(e){try{const{rootComponent:n,appProviders:t,platformProviders:s}=e,c=function CA(e=[]){if(Hn)return Hn;const n=function Ir(e=[],n){return Dr.create({name:n,providers:[{provide:e0,useValue:"platform"},{provide:jS,useValue:new Set([()=>Hn=null])},...e]})}(e);return Hn=n,function rx(){!function Fr(e){cN=e}(()=>{throw new ae(600,!1)})}(),function gx(e){e.get(KP,null)?.forEach(t=>t())}(n),n}(s),u=[Vf({}),{provide:tf,useExisting:Rc},...t||[]];return function px(e){const n=nv(e)?e.r3Injector:e.moduleRef.injector,t=n.get(ft);return t.run(()=>{nv(e)?e.r3Injector.resolveInjectorInitializers():e.moduleRef.resolveInjectorInitializers();const s=n.get(Ea,null);let c;if(t.runOutsideAngular(()=>{c=t.onError.subscribe({next:u=>{s.handleError(u)}})}),nv(e)){const u=()=>n.destroy(),p=e.platformInjector.get(jS);p.add(u),n.onDestroy(()=>{c.unsubscribe(),p.delete(u)})}else{const u=()=>e.moduleRef.destroy(),p=e.platformInjector.get(jS);p.add(u),e.moduleRef.onDestroy(()=>{Sh(e.allPlatformModules,e.moduleRef),c.unsubscribe(),p.delete(u)})}return function ox(e,n,t){try{const s=t();return Z_(s)?s.catch(c=>{throw n.runOutsideAngular(()=>e.handleError(c)),c}):s}catch(s){throw n.runOutsideAngular(()=>e.handleError(s)),s}}(s,t,()=>{const u=n.get(nx);return u.runInitializers(),u.donePromise.then(()=>{if(function wR(e){"string"==typeof e&&(P_=e.toLowerCase().replace(/_/g,"-"))}(n.get(Oo,Nn)||Nn),nv(e)){const _=n.get(bi);return void 0!==e.rootComponent&&_.bootstrap(e.rootComponent),_}return function fx(e,n){const t=e.injector.get(bi);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(s=>t.bootstrap(s));else{if(!e.instance.ngDoBootstrap)throw new ae(-403,!1);e.instance.ngDoBootstrap(t)}n.push(e)}(e.moduleRef,e.allPlatformModules),e.moduleRef})})})}({r3Injector:new y1({providers:u,parent:c,debugName:"",runEnvironmentInitializers:!1}).injector,platformInjector:c,rootComponent:n})}catch(n){return Promise.reject(n)}}function zi(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}function jd(e,n){ji("NgSignals");const t=AE(e);return n?.equal&&(t[Pt].equal=n.equal),t}function Qs(e){const n=gt(null);try{return e()}finally{gt(n)}}let ZA=null;function Dl(){return ZA}class n2{}const Ve=new Te("");let XS=(()=>{class e{historyGo(t){throw new Error("")}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:()=>me(o2),providedIn:"platform"})}}return e})(),o2=(()=>{class e extends XS{constructor(){super(),this._doc=me(Ve),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Dl().getBaseHref(this._doc)}onPopState(t){const s=Dl().getGlobalEventTarget(this._doc,"window");return s.addEventListener("popstate",t,!1),()=>s.removeEventListener("popstate",t)}onHashChange(t){const s=Dl().getGlobalEventTarget(this._doc,"window");return s.addEventListener("hashchange",t,!1),()=>s.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,s,c){this._history.pushState(t,s,c)}replaceState(t,s,c){this._history.replaceState(t,s,c)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:()=>new e,providedIn:"platform"})}}return e})();function JA(e,n){if(0==e.length)return n;if(0==n.length)return e;let t=0;return e.endsWith("/")&&t++,n.startsWith("/")&&t++,2==t?e+n.substring(1):1==t?e+n:e+"/"+n}function QA(e){const n=e.match(/#|\?|$/),t=n&&n.index||e.length;return e.slice(0,t-("/"===e[t-1]?1:0))+e.slice(t)}function Hd(e){return e&&"?"!==e[0]?"?"+e:e}let fo=(()=>{class e{historyGo(t){throw new Error("")}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:()=>me(a2),providedIn:"root"})}}return e})();const s2=new Te("");let a2=(()=>{class e extends fo{constructor(t,s){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=s??this._platformLocation.getBaseHrefFromDOM()??me(Ve).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return JA(this._baseHref,t)}path(t=!1){const s=this._platformLocation.pathname+Hd(this._platformLocation.search),c=this._platformLocation.hash;return c&&t?`${s}${c}`:s}pushState(t,s,c,u){const p=this.prepareExternalUrl(c+Hd(u));this._platformLocation.pushState(t,s,p)}replaceState(t,s,c,u){const p=this.prepareExternalUrl(c+Hd(u));this._platformLocation.replaceState(t,s,p)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static{this.\u0275fac=function(s){return new(s||e)(ye(XS),ye(s2,8))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Ah=(()=>{class e{constructor(t){this._subject=new Dn,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const s=this._locationStrategy.getBaseHref();this._basePath=function d2(e){if(new RegExp("^(https?:)?//").test(e)){const[,t]=e.split(/\/\/[^\/]+/);return t}return e}(QA(ui(s))),this._locationStrategy.onPopState(c=>{this._subject.emit({url:this.path(!0),pop:!0,state:c.state,type:c.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,s=""){return this.path()==this.normalize(t+Hd(s))}normalize(t){return e.stripTrailingSlash(function l2(e,n){if(!e||!n.startsWith(e))return n;const t=n.substring(e.length);return""===t||["/",";","?","#"].includes(t[0])?t:n}(this._basePath,ui(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,s="",c=null){this._locationStrategy.pushState(c,"",t,s),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Hd(s)),c)}replaceState(t,s="",c=null){this._locationStrategy.replaceState(c,"",t,s),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Hd(s)),c)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(s=>{this._notifyUrlChangeListeners(s.url,s.state)}),()=>{const s=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(s,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",s){this._urlChangeListeners.forEach(c=>c(t,s))}subscribe(t,s,c){return this._subject.subscribe({next:t,error:s,complete:c})}static{this.normalizeQueryParams=Hd}static{this.joinWithSlash=JA}static{this.stripTrailingSlash=QA}static{this.\u0275fac=function(s){return new(s||e)(ye(fo))}}static{this.\u0275prov=Oe({token:e,factory:()=>function c2(){return new Ah(ye(fo))}(),providedIn:"root"})}}return e})();function ui(e){return e.replace(/\/index.html$/,"")}const Cv=/\s+/,mD=[];let Tv=(()=>{class e{constructor(t,s){this._ngEl=t,this._renderer=s,this.initialClasses=mD,this.stateMap=new Map}set klass(t){this.initialClasses=null!=t?t.trim().split(Cv):mD}set ngClass(t){this.rawClass="string"==typeof t?t.trim().split(Cv):t}ngDoCheck(){for(const s of this.initialClasses)this._updateState(s,!0);const t=this.rawClass;if(Array.isArray(t)||t instanceof Set)for(const s of t)this._updateState(s,!0);else if(null!=t)for(const s of Object.keys(t))this._updateState(s,!!t[s]);this._applyStateDiff()}_updateState(t,s){const c=this.stateMap.get(t);void 0!==c?(c.enabled!==s&&(c.changed=!0,c.enabled=s),c.touched=!0):this.stateMap.set(t,{enabled:s,changed:!0,touched:!0})}_applyStateDiff(){for(const t of this.stateMap){const s=t[0],c=t[1];c.changed?(this._toggleClass(s,c.enabled),c.changed=!1):c.touched||(c.enabled&&this._toggleClass(s,!1),this.stateMap.delete(s)),c.touched=!1}}_toggleClass(t,s){(t=t.trim()).length>0&&t.split(Cv).forEach(c=>{s?this._renderer.addClass(this._ngEl.nativeElement,c):this._renderer.removeClass(this._ngEl.nativeElement,c)})}static{this.\u0275fac=function(s){return new(s||e)(oe(On),oe(_c))}}static{this.\u0275dir=Ue({type:e,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"},standalone:!0})}}return e})(),dC=(()=>{class e{constructor(t,s){this._viewContainer=t,this._context=new vD,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=s}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){w2("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){w2("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,s){return!0}static{this.\u0275fac=function(s){return new(s||e)(oe(js),oe(al))}}static{this.\u0275dir=Ue({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}}return e})();class vD{constructor(){this.$implicit=null,this.ngIf=null}}function w2(e,n){if(n&&!n.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${fi(n)}'.`)}let bD=(()=>{class e{constructor(t){this._viewContainerRef=t,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(t){if(this._shouldRecreateView(t)){const s=this._viewContainerRef;if(this._viewRef&&s.remove(s.indexOf(this._viewRef)),!this.ngTemplateOutlet)return void(this._viewRef=null);const c=this._createContextForwardProxy();this._viewRef=s.createEmbeddedView(this.ngTemplateOutlet,c,{injector:this.ngTemplateOutletInjector??void 0})}}_shouldRecreateView(t){return!!t.ngTemplateOutlet||!!t.ngTemplateOutletInjector}_createContextForwardProxy(){return new Proxy({},{set:(t,s,c)=>!!this.ngTemplateOutletContext&&Reflect.set(this.ngTemplateOutletContext,s,c),get:(t,s,c)=>{if(this.ngTemplateOutletContext)return Reflect.get(this.ngTemplateOutletContext,s,c)}})}static{this.\u0275fac=function(s){return new(s||e)(oe(js))}}static{this.\u0275dir=Ue({type:e,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[$o]})}}return e})();class uH{createSubscription(n,t){return Qs(()=>n.subscribe({next:t,error:s=>{throw s}}))}dispose(n){Qs(()=>n.unsubscribe())}}class SD{createSubscription(n,t){return n.then(t,s=>{throw s})}dispose(n){}}const D2=new SD,hH=new uH;let CD=(()=>{class e{constructor(t){this._latestValue=null,this.markForCheckOnValueUpdate=!0,this._subscription=null,this._obj=null,this._strategy=null,this._ref=t}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(t){if(!this._obj){if(t)try{this.markForCheckOnValueUpdate=!1,this._subscribe(t)}finally{this.markForCheckOnValueUpdate=!0}return this._latestValue}return t!==this._obj?(this._dispose(),this.transform(t)):this._latestValue}_subscribe(t){this._obj=t,this._strategy=this._selectStrategy(t),this._subscription=this._strategy.createSubscription(t,s=>this._updateLatestValue(t,s))}_selectStrategy(t){if(Z_(t))return D2;if(pA(t))return hH;throw function Fa(e,n){return new ae(2100,!1)}()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(t,s){t===this._obj&&(this._latestValue=s,this.markForCheckOnValueUpdate&&this._ref?.markForCheck())}static{this.\u0275fac=function(s){return new(s||e)(oe(Js,16))}}static{this.\u0275pipe=Co({name:"async",type:e,pure:!1,standalone:!0})}}return e})(),OD=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=ii({type:e})}static{this.\u0275inj=qr({})}}return e})();const Ml="browser";function hC(e){return"server"===e}class iF extends n2{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class $d extends iF{static makeCurrent(){!function t2(e){ZA??=e}(new $d)}onAndCancel(n,t,s){return n.addEventListener(t,s),()=>{n.removeEventListener(t,s)}}dispatchEvent(n,t){n.dispatchEvent(t)}remove(n){n.remove()}createElement(n,t){return(t=t||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,t){return"window"===t?window:"document"===t?n:"body"===t?n.body:null}getBaseHref(n){const t=function UH(){return Ov=Ov||document.querySelector("base"),Ov?Ov.getAttribute("href"):null}();return null==t?null:function Uh(e){return new URL(e,document.baseURI).pathname}(t)}resetBaseElement(){Ov=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return function C2(e,n){n=encodeURIComponent(n);for(const t of e.split(";")){const s=t.indexOf("="),[c,u]=-1==s?[t,""]:[t.slice(0,s),t.slice(s+1)];if(c.trim()===n)return decodeURIComponent(u)}return null}(document.cookie,n)}}let Ov=null,HD=(()=>{class e{build(){return new XMLHttpRequest}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac})}}return e})();const Nv=new Te("");let CC=(()=>{class e{constructor(t,s){this._zone=s,this._eventNameToPlugin=new Map,t.forEach(c=>{c.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,s,c){return this._findPluginFor(s).addEventListener(t,s,c)}getZone(){return this._zone}_findPluginFor(t){let s=this._eventNameToPlugin.get(t);if(s)return s;if(s=this._plugins.find(u=>u.supports(t)),!s)throw new ae(5101,!1);return this._eventNameToPlugin.set(t,s),s}static{this.\u0275fac=function(s){return new(s||e)(ye(Nv),ye(ft))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac})}}return e})();class Pv{constructor(n){this._doc=n}}const GD="ng-app-id";let TC=(()=>{class e{constructor(t,s,c,u={}){this.doc=t,this.appId=s,this.nonce=c,this.platformId=u,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=hC(u),this.resetHostNodes()}addStyles(t){for(const s of t)1===this.changeUsageCount(s,1)&&this.onStyleAdded(s)}removeStyles(t){for(const s of t)this.changeUsageCount(s,-1)<=0&&this.onStyleRemoved(s)}ngOnDestroy(){const t=this.styleNodesInDOM;t&&(t.forEach(s=>s.remove()),t.clear());for(const s of this.getAllStyles())this.onStyleRemoved(s);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const s of this.getAllStyles())this.addStyleToHost(t,s)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(const s of this.hostNodes)this.addStyleToHost(s,t)}onStyleRemoved(t){const s=this.styleRef;s.get(t)?.elements?.forEach(c=>c.remove()),s.delete(t)}collectServerRenderedStyles(){const t=this.doc.head?.querySelectorAll(`style[${GD}="${this.appId}"]`);if(t?.length){const s=new Map;return t.forEach(c=>{null!=c.textContent&&s.set(c.textContent,c)}),s}return null}changeUsageCount(t,s){const c=this.styleRef;if(c.has(t)){const u=c.get(t);return u.usage+=s,u.usage}return c.set(t,{usage:s,elements:[]}),s}getStyleElement(t,s){const c=this.styleNodesInDOM,u=c?.get(s);if(u?.parentNode===t)return c.delete(s),u.removeAttribute(GD),u;{const p=this.doc.createElement("style");return this.nonce&&p.setAttribute("nonce",this.nonce),p.textContent=s,this.platformIsServer&&p.setAttribute(GD,this.appId),t.appendChild(p),p}}addStyleToHost(t,s){const c=this.getStyleElement(t,s),u=this.styleRef,p=u.get(s)?.elements;p?p.push(c):u.set(s,{elements:[c],usage:1})}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}static{this.\u0275fac=function(s){return new(s||e)(ye(Ve),ye(Gp),ye(ew,8),ye(pd))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac})}}return e})();const wC={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},Mv=/%COMP%/g,sF=new Te("",{providedIn:"root",factory:()=>!0});function kv(e,n){return n.map(t=>t.replace(Mv,e))}let IC=(()=>{class e{constructor(t,s,c,u,p,_,E,S=null){this.eventManager=t,this.sharedStylesHost=s,this.appId=c,this.removeStylesOnCompDestroy=u,this.doc=p,this.platformId=_,this.ngZone=E,this.nonce=S,this.rendererByCompId=new Map,this.platformIsServer=hC(_),this.defaultRenderer=new qD(t,p,E,this.platformIsServer)}createRenderer(t,s){if(!t||!s)return this.defaultRenderer;this.platformIsServer&&s.encapsulation===ca.ShadowDom&&(s={...s,encapsulation:ca.Emulated});const c=this.getOrCreateRenderer(t,s);return c instanceof lF?c.applyToHost(t):c instanceof Lv&&c.applyStyles(),c}getOrCreateRenderer(t,s){const c=this.rendererByCompId;let u=c.get(s.id);if(!u){const p=this.doc,_=this.ngZone,E=this.eventManager,S=this.sharedStylesHost,w=this.removeStylesOnCompDestroy,D=this.platformIsServer;switch(s.encapsulation){case ca.Emulated:u=new lF(E,S,s,this.appId,w,p,_,D);break;case ca.ShadowDom:return new BH(E,S,t,s,p,_,this.nonce,D);default:u=new Lv(E,S,s,w,p,_,D)}c.set(s.id,u)}return u}ngOnDestroy(){this.rendererByCompId.clear()}static{this.\u0275fac=function(s){return new(s||e)(ye(CC),ye(TC),ye(Gp),ye(sF),ye(Ve),ye(pd),ye(ft),ye(ew))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac})}}return e})();class qD{constructor(n,t,s,c){this.eventManager=n,this.doc=t,this.ngZone=s,this.platformIsServer=c,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(n,t){return t?this.doc.createElementNS(wC[t]||t,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,t){(Bh(n)?n.content:n).appendChild(t)}insertBefore(n,t,s){n&&(Bh(n)?n.content:n).insertBefore(t,s)}removeChild(n,t){t.remove()}selectRootElement(n,t){let s="string"==typeof n?this.doc.querySelector(n):n;if(!s)throw new ae(-5104,!1);return t||(s.textContent=""),s}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,t,s,c){if(c){t=c+":"+t;const u=wC[c];u?n.setAttributeNS(u,t,s):n.setAttribute(t,s)}else n.setAttribute(t,s)}removeAttribute(n,t,s){if(s){const c=wC[s];c?n.removeAttributeNS(c,t):n.removeAttribute(`${s}:${t}`)}else n.removeAttribute(t)}addClass(n,t){n.classList.add(t)}removeClass(n,t){n.classList.remove(t)}setStyle(n,t,s,c){c&(fd.DashCase|fd.Important)?n.style.setProperty(t,s,c&fd.Important?"important":""):n.style[t]=s}removeStyle(n,t,s){s&fd.DashCase?n.style.removeProperty(t):n.style[t]=""}setProperty(n,t,s){null!=n&&(n[t]=s)}setValue(n,t){n.nodeValue=t}listen(n,t,s){if("string"==typeof n&&!(n=Dl().getGlobalEventTarget(this.doc,n)))throw new Error(`Unsupported event target ${n} for event ${t}`);return this.eventManager.addEventListener(n,t,this.decoratePreventDefault(s))}decoratePreventDefault(n){return t=>{if("__ngUnwrap__"===t)return n;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>n(t)):n(t))&&t.preventDefault()}}}function Bh(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class BH extends qD{constructor(n,t,s,c,u,p,_,E){super(n,u,p,E),this.sharedStylesHost=t,this.hostEl=s,this.shadowRoot=s.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const S=kv(c.id,c.styles);for(const w of S){const D=document.createElement("style");_&&D.setAttribute("nonce",_),D.textContent=w,this.shadowRoot.appendChild(D)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,t){return super.appendChild(this.nodeOrShadowRoot(n),t)}insertBefore(n,t,s){return super.insertBefore(this.nodeOrShadowRoot(n),t,s)}removeChild(n,t){return super.removeChild(null,t)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class Lv extends qD{constructor(n,t,s,c,u,p,_,E){super(n,u,p,_),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=c,this.styles=E?kv(E,s.styles):s.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class lF extends Lv{constructor(n,t,s,c,u,p,_,E){const S=c+"-"+s.id;super(n,t,s,u,p,_,E,S),this.contentAttr=function aF(e){return"_ngcontent-%COMP%".replace(Mv,e)}(S),this.hostAttr=function cF(e){return"_nghost-%COMP%".replace(Mv,e)}(S)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,t){const s=super.createElement(n,t);return super.setAttribute(s,this.contentAttr,""),s}}const YD=["alt","control","meta","shift"],dF={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},uF={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};function em(e){return{appProviders:[...XD,...e?.providers??[]],platformProviders:pF}}const pF=[{provide:pd,useValue:Ml},{provide:KP,useValue:function HH(){$d.makeCurrent()},multi:!0},{provide:Ve,useFactory:function hF(){return function WP(e){mg=e}(document),document},deps:[]}],XD=[{provide:e0,useValue:"root"},{provide:Ea,useFactory:function Zd(){return new Ea},deps:[]},{provide:Nv,useClass:(()=>{class e extends Pv{constructor(t){super(t)}supports(t){return!0}addEventListener(t,s,c){return t.addEventListener(s,c,!1),()=>this.removeEventListener(t,s,c)}removeEventListener(t,s,c){return t.removeEventListener(s,c)}static{this.\u0275fac=function(s){return new(s||e)(ye(Ve))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac})}}return e})(),multi:!0,deps:[Ve,ft,pd]},{provide:Nv,useClass:(()=>{class e extends Pv{constructor(t){super(t)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,s,c){const u=e.parseEventName(s),p=e.eventCallback(u.fullKey,c,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Dl().onAndCancel(t,u.domEventName,p))}static parseEventName(t){const s=t.toLowerCase().split("."),c=s.shift();if(0===s.length||"keydown"!==c&&"keyup"!==c)return null;const u=e._normalizeKey(s.pop());let p="",_=s.indexOf("code");if(_>-1&&(s.splice(_,1),p="code."),YD.forEach(S=>{const w=s.indexOf(S);w>-1&&(s.splice(w,1),p+=S+".")}),p+=u,0!=s.length||0===u.length)return null;const E={};return E.domEventName=c,E.fullKey=p,E}static matchEventFullKeyCode(t,s){let c=dF[t.key]||t.key,u="";return s.indexOf("code.")>-1&&(c=t.code,u="code."),!(null==c||!c)&&(c=c.toLowerCase()," "===c?c="space":"."===c&&(c="dot"),YD.forEach(p=>{p!==c&&(0,uF[p])(t)&&(u+=p+".")}),u+=c,u===s)}static eventCallback(t,s,c){return u=>{e.matchEventFullKeyCode(u,t)&&c.runGuarded(()=>s(u))}}static _normalizeKey(t){return"esc"===t?"escape":t}static{this.\u0275fac=function(s){return new(s||e)(ye(Ve))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac})}}return e})(),multi:!0,deps:[Ve]},IC,TC,CC,{provide:Lb,useExisting:IC},{provide:class B2{},useClass:HD,deps:[]},[]];let zH=(()=>{class e{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static{this.\u0275fac=function(s){return new(s||e)(ye(Ve))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function Ll(e){return this instanceof Ll?(this.v=e,this):new Ll(e)}function Os(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function PC(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],s=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(u){t[u]=e[u]&&function(p){return new Promise(function(_,E){!function c(u,p,_,E){Promise.resolve(E).then(function(S){u({value:S,done:_})},p)}(_,E,(p=e[u](p)).done,p.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const nO=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function hi(e){return vn(e?.then)}function jh(e){return vn(e[TT])}function LC(e){return Symbol.asyncIterator&&vn(e?.[Symbol.asyncIterator])}function rO(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const nm=function Uv(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function xC(e){return vn(e?.[nm])}function Vv(e){return function fe(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,s=t.apply(e,n||[]),u=[];return c=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),_("next"),_("throw"),_("return",function p(V){return function(H){return Promise.resolve(H).then(V,D)}}),c[Symbol.asyncIterator]=function(){return this},c;function _(V,H){s[V]&&(c[V]=function(z){return new Promise(function(Q,ie){u.push([V,z,Q,ie])>1||E(V,z)})},H&&(c[V]=H(c[V])))}function E(V,H){try{!function S(V){V.value instanceof Ll?Promise.resolve(V.value.v).then(w,D):U(u[0][2],V)}(s[V](H))}catch(z){U(u[0][3],z)}}function w(V){E("next",V)}function D(V){E("throw",V)}function U(V,H){V(H),u.shift(),u.length&&E(u[0][0],u[0][1])}}(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:s,done:c}=yield Ll(t.read());if(c)return yield Ll(void 0);yield yield Ll(s)}}finally{t.releaseLock()}})}function LF(e){return vn(e?.getReader)}function go(e){if(e instanceof nr)return e;if(null!=e){if(jh(e))return function xl(e){return new nr(n=>{const t=e[TT]();if(vn(t.subscribe))return t.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(nO(e))return function Bv(e){return new nr(n=>{for(let t=0;t<e.length&&!n.closed;t++)n.next(e[t]);n.complete()})}(e);if(hi(e))return function jv(e){return new nr(n=>{e.then(t=>{n.closed||(n.next(t),n.complete())},t=>n.error(t)).then(null,PE)})}(e);if(LC(e))return FC(e);if(xC(e))return function Hv(e){return new nr(n=>{for(const t of e)if(n.next(t),n.closed)return;n.complete()})}(e);if(LF(e))return function UC(e){return FC(Vv(e))}(e)}throw rO(e)}function FC(e){return new nr(n=>{(function iO(e,n){var t,s,c,u;return function QD(e,n,t,s){return new(t||(t=Promise))(function(u,p){function _(w){try{S(s.next(w))}catch(D){p(D)}}function E(w){try{S(s.throw(w))}catch(D){p(D)}}function S(w){w.done?u(w.value):function c(u){return u instanceof t?u:new t(function(p){p(u)})}(w.value).then(_,E)}S((s=s.apply(e,n||[])).next())})}(this,void 0,void 0,function*(){try{for(t=Os(e);!(s=yield t.next()).done;)if(n.next(s.value),n.closed)return}catch(p){c={error:p}}finally{try{s&&!s.done&&(u=t.return)&&(yield u.call(t))}finally{if(c)throw c.error}}n.complete()})})(e,n).catch(t=>n.error(t))})}function Pc(e,n,t,s=0,c=!1){const u=n.schedule(function(){t(),c?e.add(this.schedule(null,s)):this.unsubscribe()},s);if(e.add(u),!c)return u}function oO(e,n=0){return Cr((t,s)=>{t.subscribe(Er(s,c=>Pc(s,e,()=>s.next(c),n),()=>Pc(s,e,()=>s.complete(),n),c=>Pc(s,e,()=>s.error(c),n)))})}function sO(e,n=0){return Cr((t,s)=>{s.add(e.schedule(()=>t.subscribe(s),n))})}function Ba(e,n){if(!e)throw new Error("Iterable cannot be null");return new nr(t=>{Pc(t,n,()=>{const s=e[Symbol.asyncIterator]();Pc(t,n,()=>{s.next().then(c=>{c.done?t.complete():t.next(c.value)})},0,!0)})})}function ki(e,n){return n?function UF(e,n){if(null!=e){if(jh(e))return function aO(e,n){return go(e).pipe(sO(n),oO(n))}(e,n);if(nO(e))return function Gv(e,n){return new nr(t=>{let s=0;return n.schedule(function(){s===e.length?t.complete():(t.next(e[s++]),t.closed||this.schedule())})})}(e,n);if(hi(e))return function xF(e,n){return go(e).pipe(sO(n),oO(n))}(e,n);if(LC(e))return Ba(e,n);if(xC(e))return function us(e,n){return new nr(t=>{let s;return Pc(t,n,()=>{s=e[nm](),Pc(t,n,()=>{let c,u;try{({value:c,done:u}=s.next())}catch(p){return void t.error(p)}u?t.complete():t.next(c)},0,!0)}),()=>vn(s?.return)&&s.return()})}(e,n);if(LF(e))return function FF(e,n){return Ba(Vv(e),n)}(e,n)}throw rO(e)}(e,n):go(e)}function cO(e){return e&&vn(e.schedule)}function VC(e){return e[e.length-1]}function BC(e){return vn(VC(e))?e.pop():void 0}function rm(e){return cO(VC(e))?e.pop():void 0}function Et(...e){return ki(e,rm(e))}const Wv=ST(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:VF}=Array,{getPrototypeOf:BF,prototype:m6,keys:g6}=Object;function jF(e){if(1===e.length){const n=e[0];if(VF(n))return{args:n,keys:null};if(function _6(e){return e&&"object"==typeof e&&BF(e)===m6}(n)){const t=g6(n);return{args:t.map(s=>n[s]),keys:t}}}return{args:e,keys:null}}const{isArray:v6}=Array;function dO(e){return en(n=>function zv(e,n){return v6(n)?e(...n):e(n)}(e,n))}function Si(e,n){return e.reduce((t,s,c)=>(t[s]=n[c],t),{})}function Fl(...e){const n=rm(e),t=BC(e),{args:s,keys:c}=jF(e);if(0===s.length)return ki([],n);const u=new nr(function im(e,n,t=Ql){return s=>{HF(n,()=>{const{length:c}=e,u=new Array(c);let p=c,_=c;for(let E=0;E<c;E++)HF(n,()=>{const S=ki(e[E],n);let w=!1;S.subscribe(Er(s,D=>{u[E]=D,w||(w=!0,_--),_||s.next(t(u.slice()))},()=>{--p||s.complete()}))},s)},s)}}(s,n,c?p=>Si(c,p):Ql));return t?u.pipe(dO(t)):u}function HF(e,n,t){e?Pc(t,e,n):n()}function _o(e,n,t=1/0){return vn(n)?_o((s,c)=>en((u,p)=>n(s,u,c,p))(go(e(s,c))),t):("number"==typeof n&&(t=n),Cr((s,c)=>function uO(e,n,t,s,c,u,p,_){const E=[];let S=0,w=0,D=!1;const U=()=>{D&&!E.length&&!S&&n.complete()},V=z=>S<s?H(z):E.push(z),H=z=>{u&&n.next(z),S++;let Q=!1;go(t(z,w++)).subscribe(Er(n,ie=>{c?.(ie),u?V(ie):n.next(ie)},()=>{Q=!0},void 0,()=>{if(Q)try{for(S--;E.length&&S<s;){const ie=E.shift();p?Pc(n,p,()=>H(ie)):H(ie)}U()}catch(ie){n.error(ie)}}))};return e.subscribe(Er(n,V,()=>{D=!0,U()})),()=>{_?.()}}(s,c,e,t)))}function ja(e=1/0){return _o(Ql,e)}function Ha(...e){return function E6(){return ja(1)}()(ki(e,rm(e)))}function GF(e){return new nr(n=>{go(e()).subscribe(n)})}function jC(e,n){const t=vn(e)?e:()=>e,s=c=>c.error(t());return new nr(n?c=>n.schedule(s,0,c):s)}const xr=new nr(e=>e.complete());function HC(){return Cr((e,n)=>{let t=null;e._refCount++;const s=Er(n,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(t=null);const c=e._connection,u=t;t=null,c&&(!u||c===u)&&c.unsubscribe(),n.unsubscribe()});e.subscribe(s),s.closed||(t=e.connect())})}class Ga extends nr{constructor(n,t){super(),this.source=n,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,_N(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new Ur;const t=this.getSubject();n.add(this.source.subscribe(Er(t,void 0,()=>{this._teardown(),t.complete()},s=>{this._teardown(),t.error(s)},()=>this._teardown()))),n.closed&&(this._connection=null,n=Ur.EMPTY)}return n}refCount(){return HC()(this)}}function Ul(e,n){return Cr((t,s)=>{let c=null,u=0,p=!1;const _=()=>p&&!c&&s.complete();t.subscribe(Er(s,E=>{c?.unsubscribe();let S=0;const w=u++;go(e(E,w)).subscribe(c=Er(s,D=>s.next(n?n(E,D,w,S++):D),()=>{c=null,_()}))},()=>{p=!0,_()}))})}function Wa(e){return e<=0?()=>xr:Cr((n,t)=>{let s=0;n.subscribe(Er(t,c=>{++s<=e&&(t.next(c),e<=s&&t.complete())}))})}function WF(...e){const n=rm(e);return Cr((t,s)=>{(n?Ha(e,t,n):Ha(e,t)).subscribe(s)})}function Ns(e,n){return Cr((t,s)=>{let c=0;t.subscribe(Er(s,u=>e.call(n,u,c++)&&s.next(u)))})}function Hh(e){return Cr((n,t)=>{let s=!1;n.subscribe(Er(t,c=>{s=!0,t.next(c)},()=>{s||t.next(e),t.complete()}))})}function zF(e=b6){return Cr((n,t)=>{let s=!1;n.subscribe(Er(t,c=>{s=!0,t.next(c)},()=>s?t.complete():t.error(e())))})}function b6(){return new Wv}function Gh(e,n){const t=arguments.length>=2;return s=>s.pipe(e?Ns((c,u)=>e(c,u,s)):Ql,Wa(1),t?Hh(n):zF(()=>new Wv))}function GC(e,n){return vn(n)?_o(e,n,1):_o(e,1)}function pi(e,n,t){const s=vn(e)||n||t?{next:e,error:n,complete:t}:e;return s?Cr((c,u)=>{var p;null===(p=s.subscribe)||void 0===p||p.call(s);let _=!0;c.subscribe(Er(u,E=>{var S;null===(S=s.next)||void 0===S||S.call(s,E),u.next(E)},()=>{var E;_=!1,null===(E=s.complete)||void 0===E||E.call(s),u.complete()},E=>{var S;_=!1,null===(S=s.error)||void 0===S||S.call(s,E),u.error(E)},()=>{var E,S;_&&(null===(E=s.unsubscribe)||void 0===E||E.call(s)),null===(S=s.finalize)||void 0===S||S.call(s)}))}):Ql}function Qd(e){return Cr((n,t)=>{let u,s=null,c=!1;s=n.subscribe(Er(t,void 0,void 0,p=>{u=go(e(p,Qd(e)(n))),s?(s.unsubscribe(),s=null,u.subscribe(t)):c=!0})),c&&(s.unsubscribe(),s=null,u.subscribe(t))})}function hO(e){return e<=0?()=>xr:Cr((n,t)=>{let s=[];n.subscribe(Er(t,c=>{s.push(c),e<s.length&&s.shift()},()=>{for(const c of s)t.next(c);t.complete()},void 0,()=>{s=null}))})}function oa(e){return Cr((n,t)=>{try{n.subscribe(t)}finally{t.add(e)}})}function Ci(e){return Cr((n,t)=>{go(e).subscribe(Er(t,()=>t.complete(),Pm)),!t.closed&&n.subscribe(t)})}const yt="primary",Vl=Symbol("RouteTitle");class zh{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t[0]:t}return null}getAll(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function Kh(e){return new zh(e)}function eu(e,n,t){const s=t.path.split("/");if(s.length>e.length||"full"===t.pathMatch&&(n.hasChildren()||s.length<e.length))return null;const c={};for(let u=0;u<s.length;u++){const p=s[u],_=e[u];if(":"===p[0])c[p.substring(1)]=_;else if(p!==_.path)return null}return{consumed:e.slice(0,s.length),posParams:c}}function Yi(e,n){const t=e?Bo(e):void 0,s=n?Bo(n):void 0;if(!t||!s||t.length!=s.length)return!1;let c;for(let u=0;u<t.length;u++)if(c=t[u],!hs(e[c],n[c]))return!1;return!0}function Bo(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function hs(e,n){if(Array.isArray(e)&&Array.isArray(n)){if(e.length!==n.length)return!1;const t=[...e].sort(),s=[...n].sort();return t.every((c,u)=>s[u]===c)}return e===n}function wn(e){return e.length>0?e[e.length-1]:null}function sa(e){return function AC(e){return!!e&&(e instanceof nr||vn(e.lift)&&vn(e.subscribe))}(e)?e:Z_(e)?ki(Promise.resolve(e)):Et(e)}const pO={exact:function WC(e,n,t){if(!Yh(e.segments,n.segments)||!zC(e.segments,n.segments,t)||e.numberOfChildren!==n.numberOfChildren)return!1;for(const s in n.children)if(!e.children[s]||!WC(e.children[s],n.children[s],t))return!1;return!0},subset:za},fO={exact:function KF(e,n){return Yi(e,n)},subset:function om(e,n){return Object.keys(n).length<=Object.keys(e).length&&Object.keys(n).every(t=>hs(e[t],n[t]))},ignored:()=>!0};function qh(e,n,t){return pO[t.paths](e.root,n.root,t.matrixParams)&&fO[t.queryParams](e.queryParams,n.queryParams)&&!("exact"===t.fragment&&e.fragment!==n.fragment)}function za(e,n,t){return sm(e,n,n.segments,t)}function sm(e,n,t,s){if(e.segments.length>t.length){const c=e.segments.slice(0,t.length);return!(!Yh(c,t)||n.hasChildren()||!zC(c,t,s))}if(e.segments.length===t.length){if(!Yh(e.segments,t)||!zC(e.segments,t,s))return!1;for(const c in n.children)if(!e.children[c]||!za(e.children[c],n.children[c],s))return!1;return!0}{const c=t.slice(0,e.segments.length),u=t.slice(e.segments.length);return!!(Yh(e.segments,c)&&zC(e.segments,c,s)&&e.children[yt])&&sm(e.children[yt],n,u,s)}}function zC(e,n,t){return n.every((s,c)=>fO[t](e[c].parameters,s.parameters))}class Ka{constructor(n=new Kn([],{}),t={},s=null){this.root=n,this.queryParams=t,this.fragment=s}get queryParamMap(){return this._queryParamMap??=Kh(this.queryParams),this._queryParamMap}toString(){return qC.serialize(this)}}class Kn{constructor(n,t){this.segments=n,this.children=t,this.parent=null,Object.values(t).forEach(s=>s.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Kv(this)}}class am{constructor(n,t){this.path=n,this.parameters=t}get parameterMap(){return this._parameterMap??=Kh(this.parameters),this._parameterMap}toString(){return XF(this)}}function Yh(e,n){return e.length===n.length&&e.every((t,s)=>t.path===n[s].path)}let Mc=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:()=>new KC,providedIn:"root"})}}return e})();class KC{parse(n){const t=new ZC(n);return new Ka(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(n){const t=`/${Bl(n.root,!0)}`,s=function R6(e){const n=Object.entries(e).map(([t,s])=>Array.isArray(s)?s.map(c=>`${qv(t)}=${qv(c)}`).join("&"):`${qv(t)}=${qv(s)}`).filter(t=>t);return n.length?`?${n.join("&")}`:""}(n.queryParams);return`${t}${s}${"string"==typeof n.fragment?`#${function YF(e){return encodeURI(e)}(n.fragment)}`:""}`}}const qC=new KC;function Kv(e){return e.segments.map(n=>XF(n)).join("/")}function Bl(e,n){if(!e.hasChildren())return Kv(e);if(n){const t=e.children[yt]?Bl(e.children[yt],!1):"",s=[];return Object.entries(e.children).forEach(([c,u])=>{c!==yt&&s.push(`${c}:${Bl(u,!1)}`)}),s.length>0?`${t}(${s.join("//")})`:t}{const t=function I6(e,n){let t=[];return Object.entries(e.children).forEach(([s,c])=>{s===yt&&(t=t.concat(n(c,s)))}),Object.entries(e.children).forEach(([s,c])=>{s!==yt&&(t=t.concat(n(c,s)))}),t}(e,(s,c)=>c===yt?[Bl(e.children[yt],!1)]:[`${c}:${Bl(s,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[yt]?`${Kv(e)}/${t[0]}`:`${Kv(e)}/(${t.join("//")})`}}function cm(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function qv(e){return cm(e).replace(/%3B/gi,";")}function mO(e){return cm(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function YC(e){return decodeURIComponent(e)}function $F(e){return YC(e.replace(/\+/g,"%20"))}function XF(e){return`${mO(e.path)}${function $C(e){return Object.entries(e).map(([n,t])=>`;${mO(n)}=${mO(t)}`).join("")}(e.parameters)}`}const A6=/^[^\/()?;#]+/;function gO(e){const n=e.match(A6);return n?n[0]:""}const D6=/^[^\/()?;=#]+/,_O=/^[^=?&#]+/,XC=/^[^&#]+/;class ZC{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Kn([],{}):new Kn([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let s={};return this.peekStartsWith("(")&&(s=this.parseParens(!1)),(n.length>0||Object.keys(t).length>0)&&(s[yt]=new Kn(n,t)),s}parseSegment(){const n=gO(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new ae(4009,!1);return this.capture(n),new am(YC(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const t=function Yv(e){const n=e.match(D6);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let s="";if(this.consumeOptional("=")){const c=gO(this.remaining);c&&(s=c,this.capture(s))}n[YC(t)]=YC(s)}parseQueryParam(n){const t=function O6(e){const n=e.match(_O);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let s="";if(this.consumeOptional("=")){const p=function N6(e){const n=e.match(XC);return n?n[0]:""}(this.remaining);p&&(s=p,this.capture(s))}const c=$F(t),u=$F(s);if(n.hasOwnProperty(c)){let p=n[c];Array.isArray(p)||(p=[p],n[c]=p),p.push(u)}else n[c]=u}parseParens(n){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const s=gO(this.remaining),c=this.remaining[s.length];if("/"!==c&&")"!==c&&";"!==c)throw new ae(4010,!1);let u;s.indexOf(":")>-1?(u=s.slice(0,s.indexOf(":")),this.capture(u),this.capture(":")):n&&(u=yt);const p=this.parseChildren();t[u]=1===Object.keys(p).length?p[yt]:new Kn([],p),this.consumeOptional("//")}return t}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new ae(4011,!1)}}function ZF(e){return e.segments.length>0?new Kn([],{[yt]:e}):e}function JF(e){const n={};for(const[s,c]of Object.entries(e.children)){const u=JF(c);if(s===yt&&0===u.segments.length&&u.hasChildren())for(const[p,_]of Object.entries(u.children))n[p]=_;else(u.segments.length>0||u.hasChildren())&&(n[s]=u)}return function P6(e){if(1===e.numberOfChildren&&e.children[yt]){const n=e.children[yt];return new Kn(e.segments.concat(n.segments),n.children)}return e}(new Kn(e.segments,n))}function $h(e){return e instanceof Ka}function vO(e){let n;const c=ZF(function t(u){const p={};for(const E of u.children){const S=t(E);p[E.outlet]=S}const _=new Kn(u.url,p);return u===e&&(n=_),_}(e.root));return n??c}function QF(e,n,t,s){let c=e;for(;c.parent;)c=c.parent;if(0===n.length)return EO(c,c,c,t,s);const u=function tU(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new Ps(!0,0,e);let n=0,t=!1;const s=e.reduce((c,u,p)=>{if("object"==typeof u&&null!=u){if(u.outlets){const _={};return Object.entries(u.outlets).forEach(([E,S])=>{_[E]="string"==typeof S?S.split("/"):S}),[...c,{outlets:_}]}if(u.segmentPath)return[...c,u.segmentPath]}return"string"!=typeof u?[...c,u]:0===p?(u.split("/").forEach((_,E)=>{0==E&&"."===_||(0==E&&""===_?t=!0:".."===_?n++:""!=_&&c.push(_))}),c):[...c,u]},[]);return new Ps(t,n,s)}(n);if(u.toRoot())return EO(c,c,new Kn([],{}),t,s);const p=function M6(e,n,t){if(e.isAbsolute)return new Xv(n,!0,0);if(!t)return new Xv(n,!1,NaN);if(null===t.parent)return new Xv(t,!0,0);const s=Xh(e.commands[0])?0:1;return function nU(e,n,t){let s=e,c=n,u=t;for(;u>c;){if(u-=c,s=s.parent,!s)throw new ae(4005,!1);c=s.segments.length}return new Xv(s,!1,c-u)}(t,t.segments.length-1+s,e.numberOfDoubleDots)}(u,c,e),_=p.processChildren?Ms(p.segmentGroup,p.index,u.commands):Zv(p.segmentGroup,p.index,u.commands);return EO(c,p.segmentGroup,_,t,s)}function Xh(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function qa(e){return"object"==typeof e&&null!=e&&e.outlets}function EO(e,n,t,s,c){let p,u={};s&&Object.entries(s).forEach(([E,S])=>{u[E]=Array.isArray(S)?S.map(w=>`${w}`):`${S}`}),p=e===n?t:eU(e,n,t);const _=ZF(JF(p));return new Ka(_,u,c)}function eU(e,n,t){const s={};return Object.entries(e.children).forEach(([c,u])=>{s[c]=u===n?t:eU(u,n,t)}),new Kn(e.segments,s)}class Ps{constructor(n,t,s){if(this.isAbsolute=n,this.numberOfDoubleDots=t,this.commands=s,n&&s.length>0&&Xh(s[0]))throw new ae(4003,!1);const c=s.find(qa);if(c&&c!==wn(s))throw new ae(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Xv{constructor(n,t,s){this.segmentGroup=n,this.processChildren=t,this.index=s}}function Zv(e,n,t){if(e??=new Kn([],{}),0===e.segments.length&&e.hasChildren())return Ms(e,n,t);const s=function yO(e,n,t){let s=0,c=n;const u={match:!1,pathIndex:0,commandIndex:0};for(;c<e.segments.length;){if(s>=t.length)return u;const p=e.segments[c],_=t[s];if(qa(_))break;const E=`${_}`,S=s<t.length-1?t[s+1]:null;if(c>0&&void 0===E)break;if(E&&S&&"object"==typeof S&&void 0===S.outlets){if(!eT(E,S,p))return u;s+=2}else{if(!eT(E,{},p))return u;s++}c++}return{match:!0,pathIndex:c,commandIndex:s}}(e,n,t),c=t.slice(s.commandIndex);if(s.match&&s.pathIndex<e.segments.length){const u=new Kn(e.segments.slice(0,s.pathIndex),{});return u.children[yt]=new Kn(e.segments.slice(s.pathIndex),e.children),Ms(u,0,c)}return s.match&&0===c.length?new Kn(e.segments,{}):s.match&&!e.hasChildren()?Jv(e,n,t):s.match?Ms(e,0,c):Jv(e,n,t)}function Ms(e,n,t){if(0===t.length)return new Kn(e.segments,{});{const s=function JC(e){return qa(e[0])?e[0].outlets:{[yt]:e}}(t),c={};if(Object.keys(s).some(u=>u!==yt)&&e.children[yt]&&1===e.numberOfChildren&&0===e.children[yt].segments.length){const u=Ms(e.children[yt],n,t);return new Kn(e.segments,u.children)}return Object.entries(s).forEach(([u,p])=>{"string"==typeof p&&(p=[p]),null!==p&&(c[u]=Zv(e.children[u],n,p))}),Object.entries(e.children).forEach(([u,p])=>{void 0===s[u]&&(c[u]=p)}),new Kn(e.segments,c)}}function Jv(e,n,t){const s=e.segments.slice(0,n);let c=0;for(;c<t.length;){const u=t[c];if(qa(u)){const E=QC(u.outlets);return new Kn(s,E)}if(0===c&&Xh(t[0])){s.push(new am(e.segments[n].path,Qv(t[0]))),c++;continue}const p=qa(u)?u.outlets[yt]:`${u}`,_=c<t.length-1?t[c+1]:null;p&&_&&Xh(_)?(s.push(new am(p,Qv(_))),c+=2):(s.push(new am(p,{})),c++)}return new Kn(s,{})}function QC(e){const n={};return Object.entries(e).forEach(([t,s])=>{"string"==typeof s&&(s=[s]),null!==s&&(n[t]=Jv(new Kn([],{}),0,s))}),n}function Qv(e){const n={};return Object.entries(e).forEach(([t,s])=>n[t]=`${s}`),n}function eT(e,n,t){return e==t.path&&Yi(n,t.parameters)}const Qn="imperative";var Jt=function(e){return e[e.NavigationStart=0]="NavigationStart",e[e.NavigationEnd=1]="NavigationEnd",e[e.NavigationCancel=2]="NavigationCancel",e[e.NavigationError=3]="NavigationError",e[e.RoutesRecognized=4]="RoutesRecognized",e[e.ResolveStart=5]="ResolveStart",e[e.ResolveEnd=6]="ResolveEnd",e[e.GuardsCheckStart=7]="GuardsCheckStart",e[e.GuardsCheckEnd=8]="GuardsCheckEnd",e[e.RouteConfigLoadStart=9]="RouteConfigLoadStart",e[e.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",e[e.ChildActivationStart=11]="ChildActivationStart",e[e.ChildActivationEnd=12]="ChildActivationEnd",e[e.ActivationStart=13]="ActivationStart",e[e.ActivationEnd=14]="ActivationEnd",e[e.Scroll=15]="Scroll",e[e.NavigationSkipped=16]="NavigationSkipped",e}(Jt||{});class kc{constructor(n,t){this.id=n,this.url=t}}class jl extends kc{constructor(n,t,s="imperative",c=null){super(n,t),this.type=Jt.NavigationStart,this.navigationTrigger=s,this.restoredState=c}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class tu extends kc{constructor(n,t,s){super(n,t),this.urlAfterRedirects=s,this.type=Jt.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}var ps=function(e){return e[e.Redirect=0]="Redirect",e[e.SupersededByNewNavigation=1]="SupersededByNewNavigation",e[e.NoDataFromResolver=2]="NoDataFromResolver",e[e.GuardRejected=3]="GuardRejected",e}(ps||{}),tT=function(e){return e[e.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",e[e.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",e}(tT||{});class nu extends kc{constructor(n,t,s,c){super(n,t),this.reason=s,this.code=c,this.type=Jt.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Zh extends kc{constructor(n,t,s,c){super(n,t),this.reason=s,this.code=c,this.type=Jt.NavigationSkipped}}class eE extends kc{constructor(n,t,s,c){super(n,t),this.error=s,this.target=c,this.type=Jt.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class bO extends kc{constructor(n,t,s,c){super(n,t),this.urlAfterRedirects=s,this.state=c,this.type=Jt.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class k6 extends kc{constructor(n,t,s,c){super(n,t),this.urlAfterRedirects=s,this.state=c,this.type=Jt.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class rU extends kc{constructor(n,t,s,c,u){super(n,t),this.urlAfterRedirects=s,this.state=c,this.shouldActivate=u,this.type=Jt.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class L6 extends kc{constructor(n,t,s,c){super(n,t),this.urlAfterRedirects=s,this.state=c,this.type=Jt.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Hl extends kc{constructor(n,t,s,c){super(n,t),this.urlAfterRedirects=s,this.state=c,this.type=Jt.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class x6{constructor(n){this.route=n,this.type=Jt.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class iU{constructor(n){this.route=n,this.type=Jt.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class F6{constructor(n){this.snapshot=n,this.type=Jt.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class U6{constructor(n){this.snapshot=n,this.type=Jt.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class tE{constructor(n){this.snapshot=n,this.type=Jt.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class SO{constructor(n){this.snapshot=n,this.type=Jt.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class CO{}class nE{constructor(n,t){this.url=n,this.navigationBehaviorOptions=t}}function Lc(e){return e.outlet||yt}function iE(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let n=e.parent;n;n=n.parent){const t=n.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class B6{get injector(){return iE(this.route?.snapshot)??this.rootInjector}set injector(n){}constructor(n){this.rootInjector=n,this.outlet=null,this.route=null,this.children=new lm(this.rootInjector),this.attachRef=null}}let lm=(()=>{class e{constructor(t){this.rootInjector=t,this.contexts=new Map}onChildOutletCreated(t,s){const c=this.getOrCreateContext(t);c.outlet=s,this.contexts.set(t,c)}onChildOutletDestroyed(t){const s=this.getContext(t);s&&(s.outlet=null,s.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let s=this.getContext(t);return s||(s=new B6(this.rootInjector),this.contexts.set(t,s)),s}getContext(t){return this.contexts.get(t)||null}static{this.\u0275fac=function(s){return new(s||e)(ye(Yo))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();class aU{constructor(n){this._root=n}get root(){return this._root.value}parent(n){const t=this.pathFromRoot(n);return t.length>1?t[t.length-2]:null}children(n){const t=TO(n,this._root);return t?t.children.map(s=>s.value):[]}firstChild(n){const t=TO(n,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(n){const t=wO(n,this._root);return t.length<2?[]:t[t.length-2].children.map(c=>c.value).filter(c=>c!==n)}pathFromRoot(n){return wO(n,this._root).map(t=>t.value)}}function TO(e,n){if(e===n.value)return n;for(const t of n.children){const s=TO(e,t);if(s)return s}return null}function wO(e,n){if(e===n.value)return[n];for(const t of n.children){const s=wO(e,t);if(s.length)return s.unshift(n),s}return[]}class Ya{constructor(n,t){this.value=n,this.children=t}toString(){return`TreeNode(${this.value})`}}function dm(e){const n={};return e&&e.children.forEach(t=>n[t.value.outlet]=t),n}class IO extends aU{constructor(n,t){super(n),this.snapshot=t,RO(this,n)}toString(){return this.snapshot.toString()}}function um(e){const n=function j6(e){const u=new nT([],{},{},"",{},yt,e,null,{});return new cU("",new Ya(u,[]))}(e),t=new gs([new am("",{})]),s=new gs({}),c=new gs({}),u=new gs({}),p=new gs(""),_=new ru(t,s,u,p,c,yt,e,n.root);return _.snapshot=n.root,new IO(new Ya(_,[]),n)}class ru{constructor(n,t,s,c,u,p,_,E){this.urlSubject=n,this.paramsSubject=t,this.queryParamsSubject=s,this.fragmentSubject=c,this.dataSubject=u,this.outlet=p,this.component=_,this._futureSnapshot=E,this.title=this.dataSubject?.pipe(en(S=>S[Vl]))??Et(void 0),this.url=n,this.params=t,this.queryParams=s,this.fragment=c,this.data=u}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(en(n=>Kh(n))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(en(n=>Kh(n))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Ti(e,n,t="emptyOnly"){let s;const{routeConfig:c}=e;return s=null===n||"always"!==t&&""!==c?.path&&(n.component||n.routeConfig?.loadComponent)?{params:{...e.params},data:{...e.data},resolve:{...e.data,...e._resolvedData??{}}}:{params:{...n.params,...e.params},data:{...n.data,...e.data},resolve:{...e.data,...n.data,...c?.data,...e._resolvedData}},c&&dU(c)&&(s.resolve[Vl]=c.title),s}class nT{get title(){return this.data?.[Vl]}constructor(n,t,s,c,u,p,_,E,S){this.url=n,this.params=t,this.queryParams=s,this.fragment=c,this.data=u,this.outlet=p,this.component=_,this.routeConfig=E,this._resolve=S}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Kh(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Kh(this.queryParams),this._queryParamMap}toString(){return`Route(url:'${this.url.map(s=>s.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class cU extends aU{constructor(n,t){super(t),this.url=n,RO(this,t)}toString(){return lU(this._root)}}function RO(e,n){n.value._routerState=e,n.children.forEach(t=>RO(e,t))}function lU(e){const n=e.children.length>0?` { ${e.children.map(lU).join(", ")} } `:"";return`${e.value}${n}`}function AO(e){if(e.snapshot){const n=e.snapshot,t=e._futureSnapshot;e.snapshot=t,Yi(n.queryParams,t.queryParams)||e.queryParamsSubject.next(t.queryParams),n.fragment!==t.fragment&&e.fragmentSubject.next(t.fragment),Yi(n.params,t.params)||e.paramsSubject.next(t.params),function w6(e,n){if(e.length!==n.length)return!1;for(let t=0;t<e.length;++t)if(!Yi(e[t],n[t]))return!1;return!0}(n.url,t.url)||e.urlSubject.next(t.url),Yi(n.data,t.data)||e.dataSubject.next(t.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function DO(e,n){const t=Yi(e.params,n.params)&&function qF(e,n){return Yh(e,n)&&e.every((t,s)=>Yi(t.parameters,n[s].parameters))}(e.url,n.url);return t&&!(!e.parent!=!n.parent)&&(!e.parent||DO(e.parent,n.parent))}function dU(e){return"string"==typeof e.title||null===e.title}let rT=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=yt,this.activateEvents=new Dn,this.deactivateEvents=new Dn,this.attachEvents=new Dn,this.detachEvents=new Dn,this.parentContexts=me(lm),this.location=me(js),this.changeDetector=me(Js),this.inputBinder=me(hm,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(t){if(t.name){const{firstChange:s,previousValue:c}=t.name;if(s)return;this.isTrackedInParentContexts(c)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(c)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new ae(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new ae(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new ae(4012,!1);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,s){this.activated=t,this._activatedRoute=s,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,s){if(this.isActivated)throw new ae(4013,!1);this._activatedRoute=t;const c=this.location,p=t.snapshot.component,_=this.parentContexts.getOrCreateContext(this.name).children,E=new OO(t,_,c.injector);this.activated=c.createComponent(p,{index:c.length,injector:E,environmentInjector:s}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275dir=Ue({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[$o]})}}return e})();class OO{__ngOutletInjector(n){return new OO(this.route,this.childContexts,n)}constructor(n,t,s){this.route=n,this.childContexts=t,this.parent=s}get(n,t){return n===ru?this.route:n===lm?this.childContexts:this.parent.get(n,t)}}const hm=new Te("");function fm(e,n,t){if(t&&e.shouldReuseRoute(n.value,t.value.snapshot)){const s=t.value;s._futureSnapshot=n.value;const c=function uU(e,n,t){return n.children.map(s=>{for(const c of t.children)if(e.shouldReuseRoute(s.value,c.value.snapshot))return fm(e,s,c);return fm(e,s)})}(e,n,t);return new Ya(s,c)}{if(e.shouldAttach(n.value)){const u=e.retrieve(n.value);if(null!==u){const p=u.route;return p.value._futureSnapshot=n.value,p.children=n.children.map(_=>fm(e,_)),p}}const s=function H6(e){return new ru(new gs(e.url),new gs(e.params),new gs(e.queryParams),new gs(e.fragment),new gs(e.data),e.outlet,e.component,e)}(n.value),c=n.children.map(u=>fm(e,u));return new Ya(s,c)}}class oE{constructor(n,t){this.redirectTo=n,this.navigationBehaviorOptions=t}}const NO="ngNavigationCancelingError";function Gl(e,n){const{redirectTo:t,navigationBehaviorOptions:s}=$h(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,c=iT(!1,ps.Redirect);return c.url=t,c.navigationBehaviorOptions=s,c}function iT(e,n){const t=new Error(`NavigationCancelingError: ${e||""}`);return t[NO]=!0,t.cancellationCode=n,t}function $a(e){return!!e&&e[NO]}class fU{constructor(n,t,s,c,u){this.routeReuseStrategy=n,this.futureState=t,this.currState=s,this.forwardEvent=c,this.inputBindingEnabled=u}activate(n){const t=this.futureState._root,s=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,s,n),AO(this.futureState.root),this.activateChildRoutes(t,s,n)}deactivateChildRoutes(n,t,s){const c=dm(t);n.children.forEach(u=>{const p=u.value.outlet;this.deactivateRoutes(u,c[p],s),delete c[p]}),Object.values(c).forEach(u=>{this.deactivateRouteAndItsChildren(u,s)})}deactivateRoutes(n,t,s){const c=n.value,u=t?t.value:null;if(c===u)if(c.component){const p=s.getContext(c.outlet);p&&this.deactivateChildRoutes(n,t,p.children)}else this.deactivateChildRoutes(n,t,s);else u&&this.deactivateRouteAndItsChildren(t,s)}deactivateRouteAndItsChildren(n,t){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,t):this.deactivateRouteAndOutlet(n,t)}detachAndStoreRouteSubtree(n,t){const s=t.getContext(n.value.outlet),c=s&&n.value.component?s.children:t,u=dm(n);for(const p of Object.values(u))this.deactivateRouteAndItsChildren(p,c);if(s&&s.outlet){const p=s.outlet.detach(),_=s.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:p,route:n,contexts:_})}}deactivateRouteAndOutlet(n,t){const s=t.getContext(n.value.outlet),c=s&&n.value.component?s.children:t,u=dm(n);for(const p of Object.values(u))this.deactivateRouteAndItsChildren(p,c);s&&(s.outlet&&(s.outlet.deactivate(),s.children.onOutletDeactivated()),s.attachRef=null,s.route=null)}activateChildRoutes(n,t,s){const c=dm(t);n.children.forEach(u=>{this.activateRoutes(u,c[u.value.outlet],s),this.forwardEvent(new SO(u.value.snapshot))}),n.children.length&&this.forwardEvent(new U6(n.value.snapshot))}activateRoutes(n,t,s){const c=n.value,u=t?t.value:null;if(AO(c),c===u)if(c.component){const p=s.getOrCreateContext(c.outlet);this.activateChildRoutes(n,t,p.children)}else this.activateChildRoutes(n,t,s);else if(c.component){const p=s.getOrCreateContext(c.outlet);if(this.routeReuseStrategy.shouldAttach(c.snapshot)){const _=this.routeReuseStrategy.retrieve(c.snapshot);this.routeReuseStrategy.store(c.snapshot,null),p.children.onOutletReAttached(_.contexts),p.attachRef=_.componentRef,p.route=_.route.value,p.outlet&&p.outlet.attach(_.componentRef,_.route.value),AO(_.route.value),this.activateChildRoutes(n,null,p.children)}else p.attachRef=null,p.route=c,p.outlet&&p.outlet.activateWith(c,p.injector),this.activateChildRoutes(n,null,p.children)}else this.activateChildRoutes(n,null,s)}}class oT{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class mm{constructor(n,t){this.component=n,this.route=t}}function xc(e,n,t){const s=e._root;return gm(s,n?n._root:null,t,[s.value])}function ks(e,n){const t=Symbol(),s=n.get(e,t);return s===t?"function"!=typeof e||function CN(e){return null!==UE(e)}(e)?n.get(e):e:s}function gm(e,n,t,s,c={canDeactivateChecks:[],canActivateChecks:[]}){const u=dm(n);return e.children.forEach(p=>{(function G6(e,n,t,s,c={canDeactivateChecks:[],canActivateChecks:[]}){const u=e.value,p=n?n.value:null,_=t?t.getContext(e.value.outlet):null;if(p&&u.routeConfig===p.routeConfig){const E=function mU(e,n,t){if("function"==typeof t)return t(e,n);switch(t){case"pathParamsChange":return!Yh(e.url,n.url);case"pathParamsOrQueryParamsChange":return!Yh(e.url,n.url)||!Yi(e.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!DO(e,n)||!Yi(e.queryParams,n.queryParams);default:return!DO(e,n)}}(p,u,u.routeConfig.runGuardsAndResolvers);E?c.canActivateChecks.push(new oT(s)):(u.data=p.data,u._resolvedData=p._resolvedData),gm(e,n,u.component?_?_.children:null:t,s,c),E&&_&&_.outlet&&_.outlet.isActivated&&c.canDeactivateChecks.push(new mm(_.outlet.component,p))}else p&&sE(n,_,c),c.canActivateChecks.push(new oT(s)),gm(e,null,u.component?_?_.children:null:t,s,c)})(p,u[p.value.outlet],t,s.concat([p.value]),c),delete u[p.value.outlet]}),Object.entries(u).forEach(([p,_])=>sE(_,t.getContext(p),c)),c}function sE(e,n,t){const s=dm(e),c=e.value;Object.entries(s).forEach(([u,p])=>{sE(p,c.component?n?n.children.getContext(u):null:n,t)}),t.canDeactivateChecks.push(new mm(c.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,c))}function aE(e){return"function"==typeof e}function l(e){return e instanceof Wv||"EmptyError"===e?.name}const d=Symbol("INITIAL_VALUE");function h(){return Ul(e=>Fl(e.map(n=>n.pipe(Wa(1),WF(d)))).pipe(en(n=>{for(const t of n)if(!0!==t){if(t===d)return d;if(!1===t||f(t))return t}return!0}),Ns(n=>n!==d),Wa(1)))}function f(e){return $h(e)||e instanceof oE}function O(e){return function fV(...e){return mN(e)}(pi(n=>{if("boolean"!=typeof n)throw Gl(0,n)}),en(n=>!0===n))}class x{constructor(n){this.segmentGroup=n||null}}class j extends Error{constructor(n){super(),this.urlTree=n}}function W(e){return jC(new x(e))}class X{constructor(n,t){this.urlSerializer=n,this.urlTree=t}lineralizeSegments(n,t){let s=[],c=t.root;for(;;){if(s=s.concat(c.segments),0===c.numberOfChildren)return Et(s);if(c.numberOfChildren>1||!c.children[yt])return jC(new ae(4e3,!1));c=c.children[yt]}}applyRedirectCommands(n,t,s,c,u){if("string"!=typeof t){const _=t,{queryParams:E,fragment:S,routeConfig:w,url:D,outlet:U,params:V,data:H,title:z}=c,Q=qc(u,()=>_({params:V,data:H,queryParams:E,fragment:S,routeConfig:w,url:D,outlet:U,title:z}));if(Q instanceof Ka)throw new j(Q);t=Q}const p=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),n,s);if("/"===t[0])throw new j(p);return p}applyRedirectCreateUrlTree(n,t,s,c){const u=this.createSegmentGroup(n,t.root,s,c);return new Ka(u,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(n,t){const s={};return Object.entries(n).forEach(([c,u])=>{if("string"==typeof u&&":"===u[0]){const _=u.substring(1);s[c]=t[_]}else s[c]=u}),s}createSegmentGroup(n,t,s,c){const u=this.createSegments(n,t.segments,s,c);let p={};return Object.entries(t.children).forEach(([_,E])=>{p[_]=this.createSegmentGroup(n,E,s,c)}),new Kn(u,p)}createSegments(n,t,s,c){return t.map(u=>":"===u.path[0]?this.findPosParam(n,u,c):this.findOrReturn(u,s))}findPosParam(n,t,s){const c=s[t.path.substring(1)];if(!c)throw new ae(4001,!1);return c}findOrReturn(n,t){let s=0;for(const c of t){if(c.path===n.path)return t.splice(s),c;s++}return n}}const Ce={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Re(e,n,t,s,c){const u=ut(e,n,t);return u.matched?(s=function rE(e,n){return e.providers&&!e._injector&&(e._injector=XI(e.providers,n,`Route: ${e.path}`)),e._injector??n}(n,s),function M(e,n,t,s){const c=n.canMatch;return c&&0!==c.length?Et(c.map(p=>{const _=ks(p,e);return sa(function a(e){return e&&aE(e.canMatch)}(_)?_.canMatch(n,t):qc(e,()=>_(n,t)))})).pipe(h(),O()):Et(!0)}(s,n,t).pipe(en(p=>!0===p?u:{...Ce}))):Et(u)}function ut(e,n,t){if("**"===n.path)return function Nt(e){return{matched:!0,parameters:e.length>0?wn(e).parameters:{},consumedSegments:e,remainingSegments:[],positionalParamSegments:{}}}(t);if(""===n.path)return"full"===n.pathMatch&&(e.hasChildren()||t.length>0)?{...Ce}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const c=(n.matcher||eu)(t,e,n);if(!c)return{...Ce};const u={};Object.entries(c.posParams??{}).forEach(([_,E])=>{u[_]=E.path});const p=c.consumed.length>0?{...u,...c.consumed[c.consumed.length-1].parameters}:u;return{matched:!0,consumedSegments:c.consumed,remainingSegments:t.slice(c.consumed.length),parameters:p,positionalParamSegments:c.posParams??{}}}function _n(e,n,t,s){return t.length>0&&function Z(e,n,t){return t.some(s=>ve(e,n,s)&&Lc(s)!==yt)}(e,t,s)?{segmentGroup:new Kn(n,aa(s,new Kn(t,e.children))),slicedSegments:[]}:0===t.length&&function se(e,n,t){return t.some(s=>ve(e,n,s))}(e,t,s)?{segmentGroup:new Kn(e.segments,Zt(e,t,s,e.children)),slicedSegments:t}:{segmentGroup:new Kn(e.segments,e.children),slicedSegments:t}}function Zt(e,n,t,s){const c={};for(const u of t)if(ve(e,n,u)&&!s[Lc(u)]){const p=new Kn([],{});c[Lc(u)]=p}return{...s,...c}}function aa(e,n){const t={};t[yt]=n;for(const s of e)if(""===s.path&&Lc(s)!==yt){const c=new Kn([],{});t[Lc(s)]=c}return t}function ve(e,n,t){return(!(e.hasChildren()||n.length>0)||"full"!==t.pathMatch)&&""===t.path}class vt{}class F{constructor(n,t,s,c,u,p,_){this.injector=n,this.configLoader=t,this.rootComponentType=s,this.config=c,this.urlTree=u,this.paramsInheritanceStrategy=p,this.urlSerializer=_,this.applyRedirects=new X(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(n){return new ae(4002,`'${n.segmentGroup}'`)}recognize(){const n=_n(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(n).pipe(en(({children:t,rootSnapshot:s})=>{const c=new Ya(s,t),u=new cU("",c),p=function $v(e,n,t=null,s=null){return QF(vO(e),n,t,s)}(s,[],this.urlTree.queryParams,this.urlTree.fragment);return p.queryParams=this.urlTree.queryParams,u.url=this.urlSerializer.serialize(p),{state:u,tree:p}}))}match(n){const t=new nT([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Object.freeze({}),yt,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,n,yt,t).pipe(en(s=>({children:s,rootSnapshot:t})),Qd(s=>{if(s instanceof j)return this.urlTree=s.urlTree,this.match(s.urlTree.root);throw s instanceof x?this.noMatchError(s):s}))}processSegmentGroup(n,t,s,c,u){return 0===s.segments.length&&s.hasChildren()?this.processChildren(n,t,s,u):this.processSegment(n,t,s,s.segments,c,!0,u).pipe(en(p=>p instanceof Ya?[p]:[]))}processChildren(n,t,s,c){const u=[];for(const p of Object.keys(s.children))"primary"===p?u.unshift(p):u.push(p);return ki(u).pipe(GC(p=>{const _=s.children[p],E=function jz(e,n){const t=e.filter(s=>Lc(s)===n);return t.push(...e.filter(s=>Lc(s)!==n)),t}(t,p);return this.processSegmentGroup(n,E,_,p,c)}),function C6(e,n){return Cr(function S6(e,n,t,s,c){return(u,p)=>{let _=t,E=n,S=0;u.subscribe(Er(p,w=>{const D=S++;E=_?e(E,w,D):(_=!0,w),s&&p.next(E)},c&&(()=>{_&&p.next(E),p.complete()})))}}(e,n,arguments.length>=2,!0))}((p,_)=>(p.push(..._),p)),Hh(null),function T6(e,n){const t=arguments.length>=2;return s=>s.pipe(e?Ns((c,u)=>e(c,u,s)):Ql,hO(1),t?Hh(n):zF(()=>new Wv))}(),_o(p=>{if(null===p)return W(s);const _=Le(p);return function G(e){e.sort((n,t)=>n.value.outlet===yt?-1:t.value.outlet===yt?1:n.value.outlet.localeCompare(t.value.outlet))}(_),Et(_)}))}processSegment(n,t,s,c,u,p,_){return ki(t).pipe(GC(E=>this.processSegmentAgainstRoute(E._injector??n,t,E,s,c,u,p,_).pipe(Qd(S=>{if(S instanceof x)return Et(null);throw S}))),Gh(E=>!!E),Qd(E=>{if(l(E))return function xe(e,n,t){return 0===n.length&&!e.children[t]}(s,c,u)?Et(new vt):W(s);throw E}))}processSegmentAgainstRoute(n,t,s,c,u,p,_,E){return Lc(s)===p||p!==yt&&ve(c,u,s)?void 0===s.redirectTo?this.matchSegmentAgainstRoute(n,c,s,u,p,E):this.allowRedirects&&_?this.expandSegmentAgainstRouteUsingRedirect(n,c,t,s,u,p,E):W(c):W(c)}expandSegmentAgainstRouteUsingRedirect(n,t,s,c,u,p,_){const{matched:E,parameters:S,consumedSegments:w,positionalParamSegments:D,remainingSegments:U}=ut(t,c,u);if(!E)return W(t);"string"==typeof c.redirectTo&&"/"===c.redirectTo[0]&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const V=new nT(u,S,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,lr(c),Lc(c),c.component??c._loadedComponent??null,c,Xi(c)),H=Ti(V,_,this.paramsInheritanceStrategy);V.params=Object.freeze(H.params),V.data=Object.freeze(H.data);const z=this.applyRedirects.applyRedirectCommands(w,c.redirectTo,D,V,n);return this.applyRedirects.lineralizeSegments(c,z).pipe(_o(Q=>this.processSegment(n,s,t,Q.concat(U),p,!1,_)))}matchSegmentAgainstRoute(n,t,s,c,u,p){const _=Re(t,s,c,n);return"**"===s.path&&(t.children={}),_.pipe(Ul(E=>E.matched?this.getChildConfig(n=s._injector??n,s,c).pipe(Ul(({routes:S})=>{const w=s._loadedInjector??n,{parameters:D,consumedSegments:U,remainingSegments:V}=E,H=new nT(U,D,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,lr(s),Lc(s),s.component??s._loadedComponent??null,s,Xi(s)),z=Ti(H,p,this.paramsInheritanceStrategy);H.params=Object.freeze(z.params),H.data=Object.freeze(z.data);const{segmentGroup:Q,slicedSegments:ie}=_n(t,U,V,S);if(0===ie.length&&Q.hasChildren())return this.processChildren(w,S,Q,H).pipe(en(ke=>new Ya(H,ke)));if(0===S.length&&0===ie.length)return Et(new Ya(H,[]));const ne=Lc(s)===u;return this.processSegment(w,S,Q,ie,ne?yt:u,!0,H).pipe(en(ke=>new Ya(H,ke instanceof Ya?[ke]:[])))})):W(t)))}getChildConfig(n,t,s){return t.children?Et({routes:t.children,injector:n}):t.loadChildren?void 0!==t._loadedRoutes?Et({routes:t._loadedRoutes,injector:t._loadedInjector}):function A(e,n,t,s){const c=n.canLoad;return void 0===c||0===c.length?Et(!0):Et(c.map(p=>{const _=ks(p,e);return sa(function er(e){return e&&aE(e.canLoad)}(_)?_.canLoad(n,t):qc(e,()=>_(n,t)))})).pipe(h(),O())}(n,t,s).pipe(_o(c=>c?this.configLoader.loadChildren(n,t).pipe(pi(u=>{t._loadedRoutes=u.routes,t._loadedInjector=u.injector})):function J(){return jC(iT(!1,ps.GuardRejected))}())):Et({routes:[],injector:n})}}function re(e){const n=e.value.routeConfig;return n&&""===n.path}function Le(e){const n=[],t=new Set;for(const s of e){if(!re(s)){n.push(s);continue}const c=n.find(u=>s.value.routeConfig===u.value.routeConfig);void 0!==c?(c.children.push(...s.children),t.add(c)):n.push(s)}for(const s of t){const c=Le(s.children);n.push(new Ya(s.value,c))}return n.filter(s=>!t.has(s))}function lr(e){return e.data||{}}function Xi(e){return e.resolve||{}}function cE(e){const n=e.children.map(t=>cE(t)).flat();return[e,...n]}function In(e){return Ul(n=>{const t=e(n);return t?ki(t).pipe(en(()=>n)):Et(n)})}let qn=(()=>{class e{buildTitle(t){let s,c=t.root;for(;void 0!==c;)s=this.getResolvedTitleForRoute(c)??s,c=c.children.find(u=>u.outlet===yt);return s}getResolvedTitleForRoute(t){return t.data[Vl]}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:()=>me(Qt),providedIn:"root"})}}return e})(),Qt=(()=>{class e extends qn{constructor(t){super(),this.title=t}updateTitle(t){const s=this.buildTitle(t);void 0!==s&&this.title.setTitle(s)}static{this.\u0275fac=function(s){return new(s||e)(ye(zH))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const wi=new Te("",{providedIn:"root",factory:()=>({})});let Xa=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275cmp=eo({type:e,selectors:[["ng-component"]],standalone:!0,features:[ho],decls:1,vars:0,template:function(s,c){1&s&&At(0,"router-outlet")},dependencies:[rT],encapsulation:2})}}return e})();function Rn(e){const n=e.children&&e.children.map(Rn),t=n?{...e,children:n}:{...e};return!t.component&&!t.loadComponent&&(n||t.loadChildren)&&t.outlet&&t.outlet!==yt&&(t.component=Xa),t}const lt=new Te("");let Zi=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=me(sx)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return Et(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const s=sa(t.loadComponent()).pipe(en(PO),pi(u=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=u}),oa(()=>{this.componentLoaders.delete(t)})),c=new Ga(s,()=>new Gt).pipe(HC());return this.componentLoaders.set(t,c),c}loadChildren(t,s){if(this.childrenLoaders.get(s))return this.childrenLoaders.get(s);if(s._loadedRoutes)return Et({routes:s._loadedRoutes,injector:s._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(s);const u=function ou(e,n,t,s){return sa(e.loadChildren()).pipe(en(PO),_o(c=>c instanceof v1||Array.isArray(c)?Et(c):ki(n.compileModuleAsync(c))),en(c=>{s&&s(e);let u,p,_=!1;return Array.isArray(c)?(p=c,!0):(u=c.create(t).injector,p=u.get(lt,[],{optional:!0,self:!0}).flat()),{routes:p.map(Rn),injector:u}}))}(s,this.compiler,t,this.onLoadEndListener).pipe(oa(()=>{this.childrenLoaders.delete(s)})),p=new Ga(u,()=>new Gt).pipe(HC());return this.childrenLoaders.set(s,p),p}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function PO(e){return function Za(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let W6=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:()=>me(Yq),providedIn:"root"})}}return e})(),Yq=(()=>{class e{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,s){return t}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const Gz=new Te(""),zz=new Te("");let _U=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Gt,this.transitionAbortSubject=new Gt,this.configLoader=me(Zi),this.environmentInjector=me(Yo),this.urlSerializer=me(Mc),this.rootContexts=me(lm),this.location=me(Ah),this.inputBindingEnabled=null!==me(hm,{optional:!0}),this.titleStrategy=me(qn),this.options=me(wi,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=me(W6),this.createViewTransition=me(Gz,{optional:!0}),this.navigationErrorHandler=me(zz,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Et(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=c=>this.events.next(new iU(c)),this.configLoader.onLoadStartListener=c=>this.events.next(new x6(c))}complete(){this.transitions?.complete()}handleNavigationRequest(t){const s=++this.navigationId;this.transitions?.next({...this.transitions.value,...t,id:s})}setupNavigations(t,s,c){return this.transitions=new gs({id:0,currentUrlTree:s,currentRawUrl:s,extractedUrl:this.urlHandlingStrategy.extract(s),urlAfterRedirects:this.urlHandlingStrategy.extract(s),rawUrl:s,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:Qn,restoredState:null,currentSnapshot:c.snapshot,targetSnapshot:null,currentRouterState:c,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Ns(u=>0!==u.id),en(u=>({...u,extractedUrl:this.urlHandlingStrategy.extract(u.rawUrl)})),Ul(u=>{let p=!1,_=!1;return Et(u).pipe(Ul(E=>{if(this.navigationId>u.id)return this.cancelNavigationTransition(u,"",ps.SupersededByNewNavigation),xr;this.currentTransition=u,this.currentNavigation={id:E.id,initialUrl:E.rawUrl,extractedUrl:E.extractedUrl,targetBrowserUrl:"string"==typeof E.extras.browserUrl?this.urlSerializer.parse(E.extras.browserUrl):E.extras.browserUrl,trigger:E.source,extras:E.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null};const S=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl();if(!S&&"reload"!==(E.extras.onSameUrlNavigation??t.onSameUrlNavigation)){const D="";return this.events.next(new Zh(E.id,this.urlSerializer.serialize(E.rawUrl),D,tT.IgnoredSameUrlNavigation)),E.resolve(!1),xr}if(this.urlHandlingStrategy.shouldProcessUrl(E.rawUrl))return Et(E).pipe(Ul(D=>{const U=this.transitions?.getValue();return this.events.next(new jl(D.id,this.urlSerializer.serialize(D.extractedUrl),D.source,D.restoredState)),U!==this.transitions?.getValue()?xr:Promise.resolve(D)}),function Wl(e,n,t,s,c,u){return _o(p=>function de(e,n,t,s,c,u,p="emptyOnly"){return new F(e,n,t,s,c,p,u).recognize()}(e,n,t,s,p.extractedUrl,c,u).pipe(en(({state:_,tree:E})=>({...p,targetSnapshot:_,urlAfterRedirects:E}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),pi(D=>{u.targetSnapshot=D.targetSnapshot,u.urlAfterRedirects=D.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:D.urlAfterRedirects};const U=new bO(D.id,this.urlSerializer.serialize(D.extractedUrl),this.urlSerializer.serialize(D.urlAfterRedirects),D.targetSnapshot);this.events.next(U)}));if(S&&this.urlHandlingStrategy.shouldProcessUrl(E.currentRawUrl)){const{id:D,extractedUrl:U,source:V,restoredState:H,extras:z}=E,Q=new jl(D,this.urlSerializer.serialize(U),V,H);this.events.next(Q);const ie=um(this.rootComponentType).snapshot;return this.currentTransition=u={...E,targetSnapshot:ie,urlAfterRedirects:U,extras:{...z,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.finalUrl=U,Et(u)}{const D="";return this.events.next(new Zh(E.id,this.urlSerializer.serialize(E.extractedUrl),D,tT.IgnoredByUrlHandlingStrategy)),E.resolve(!1),xr}}),pi(E=>{const S=new k6(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot);this.events.next(S)}),en(E=>(this.currentTransition=u={...E,guards:xc(E.targetSnapshot,E.currentSnapshot,this.rootContexts)},u)),function m(e,n){return _o(t=>{const{targetSnapshot:s,currentSnapshot:c,guards:{canActivateChecks:u,canDeactivateChecks:p}}=t;return 0===p.length&&0===u.length?Et({...t,guardsResult:!0}):function g(e,n,t,s){return ki(e).pipe(_o(c=>function R(e,n,t,s,c){const u=n&&n.routeConfig?n.routeConfig.canDeactivate:null;return u&&0!==u.length?Et(u.map(_=>{const E=iE(n)??c,S=ks(_,E);return sa(function o(e){return e&&aE(e.canDeactivate)}(S)?S.canDeactivate(e,n,t,s):qc(E,()=>S(e,n,t,s))).pipe(Gh())})).pipe(h()):Et(!0)}(c.component,c.route,t,n,s)),Gh(c=>!0!==c,!0))}(p,s,c,e).pipe(_o(_=>_&&function gU(e){return"boolean"==typeof e}(_)?function v(e,n,t,s){return ki(n).pipe(GC(c=>Ha(function b(e,n){return null!==e&&n&&n(new F6(e)),Et(!0)}(c.route.parent,s),function y(e,n){return null!==e&&n&&n(new tE(e)),Et(!0)}(c.route,s),function P(e,n,t){const s=n[n.length-1],u=n.slice(0,n.length-1).reverse().map(p=>function Ot(e){const n=e.routeConfig?e.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:e,guards:n}:null}(p)).filter(p=>null!==p).map(p=>GF(()=>Et(p.guards.map(E=>{const S=iE(p.node)??t,w=ks(E,S);return sa(function i(e){return e&&aE(e.canActivateChild)}(w)?w.canActivateChild(s,e):qc(S,()=>w(s,e))).pipe(Gh())})).pipe(h())));return Et(u).pipe(h())}(e,c.path,t),function C(e,n,t){const s=n.routeConfig?n.routeConfig.canActivate:null;if(!s||0===s.length)return Et(!0);const c=s.map(u=>GF(()=>{const p=iE(n)??t,_=ks(u,p);return sa(function r(e){return e&&aE(e.canActivate)}(_)?_.canActivate(n,e):qc(p,()=>_(n,e))).pipe(Gh())}));return Et(c).pipe(h())}(e,c.route,t))),Gh(c=>!0!==c,!0))}(s,u,e,n):Et(_)),en(_=>({...t,guardsResult:_})))})}(this.environmentInjector,E=>this.events.next(E)),pi(E=>{if(u.guardsResult=E.guardsResult,E.guardsResult&&"boolean"!=typeof E.guardsResult)throw Gl(0,E.guardsResult);const S=new rU(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot,!!E.guardsResult);this.events.next(S)}),Ns(E=>!!E.guardsResult||(this.cancelNavigationTransition(E,"",ps.GuardRejected),!1)),In(E=>{if(E.guards.canActivateChecks.length)return Et(E).pipe(pi(S=>{const w=new L6(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot);this.events.next(w)}),Ul(S=>{let w=!1;return Et(S).pipe(function sT(e,n){return _o(t=>{const{targetSnapshot:s,guards:{canActivateChecks:c}}=t;if(!c.length)return Et(t);const u=new Set(c.map(E=>E.route)),p=new Set;for(const E of u)if(!p.has(E))for(const S of cE(E))p.add(S);let _=0;return ki(p).pipe(GC(E=>u.has(E)?function Ls(e,n,t,s){const c=e.routeConfig,u=e._resolve;return void 0!==c?.title&&!dU(c)&&(u[Vl]=c.title),function iu(e,n,t,s){const c=Bo(e);if(0===c.length)return Et({});const u={};return ki(c).pipe(_o(p=>function _m(e,n,t,s){const c=iE(n)??s,u=ks(e,c);return sa(u.resolve?u.resolve(n,t):qc(c,()=>u(n,t)))}(e[p],n,t,s).pipe(Gh(),pi(_=>{if(_ instanceof oE)throw Gl(new KC,_);u[p]=_}))),hO(1),function Wh(e){return en(()=>e)}(u),Qd(p=>l(p)?xr:jC(p)))}(u,e,n,s).pipe(en(p=>(e._resolvedData=p,e.data=Ti(e,e.parent,t).resolve,null)))}(E,s,e,n):(E.data=Ti(E,E.parent,e).resolve,Et(void 0))),pi(()=>_++),hO(1),_o(E=>_===p.size?Et(t):xr))})}(this.paramsInheritanceStrategy,this.environmentInjector),pi({next:()=>w=!0,complete:()=>{w||this.cancelNavigationTransition(S,"",ps.NoDataFromResolver)}}))}),pi(S=>{const w=new Hl(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot);this.events.next(w)}))}),In(E=>{const S=w=>{const D=[];w.routeConfig?.loadComponent&&!w.routeConfig._loadedComponent&&D.push(this.configLoader.loadComponent(w.routeConfig).pipe(pi(U=>{w.component=U}),en(()=>{})));for(const U of w.children)D.push(...S(U));return D};return Fl(S(E.targetSnapshot.root)).pipe(Hh(null),Wa(1))}),In(()=>this.afterPreactivation()),Ul(()=>{const{currentSnapshot:E,targetSnapshot:S}=u,w=this.createViewTransition?.(this.environmentInjector,E.root,S.root);return w?ki(w).pipe(en(()=>u)):Et(u)}),en(E=>{const S=function pm(e,n,t){const s=fm(e,n._root,t?t._root:void 0);return new IO(s,n)}(t.routeReuseStrategy,E.targetSnapshot,E.currentRouterState);return this.currentTransition=u={...E,targetRouterState:S},this.currentNavigation.targetRouterState=S,u}),pi(()=>{this.events.next(new CO)}),((e,n,t,s)=>en(c=>(new fU(n,c.targetRouterState,c.currentRouterState,t,s).activate(e),c)))(this.rootContexts,t.routeReuseStrategy,E=>this.events.next(E),this.inputBindingEnabled),Wa(1),pi({next:E=>{p=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new tu(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects))),this.titleStrategy?.updateTitle(E.targetRouterState.snapshot),E.resolve(!0)},complete:()=>{p=!0}}),Ci(this.transitionAbortSubject.pipe(pi(E=>{throw E}))),oa(()=>{!p&&!_&&this.cancelNavigationTransition(u,"",ps.SupersededByNewNavigation),this.currentTransition?.id===u.id&&(this.currentNavigation=null,this.currentTransition=null)}),Qd(E=>{if(_=!0,$a(E))this.events.next(new nu(u.id,this.urlSerializer.serialize(u.extractedUrl),E.message,E.cancellationCode)),function hU(e){return $a(e)&&$h(e.url)}(E)?this.events.next(new nE(E.url,E.navigationBehaviorOptions)):u.resolve(!1);else{const S=new eE(u.id,this.urlSerializer.serialize(u.extractedUrl),E,u.targetSnapshot??void 0);try{const w=qc(this.environmentInjector,()=>this.navigationErrorHandler?.(S));if(w instanceof oE){const{message:D,cancellationCode:U}=Gl(0,w);this.events.next(new nu(u.id,this.urlSerializer.serialize(u.extractedUrl),D,U)),this.events.next(new nE(w.redirectTo,w.navigationBehaviorOptions))}else{this.events.next(S);const D=t.errorHandler(E);u.resolve(!!D)}}catch(w){this.options.resolveNavigationPromiseOnError?u.resolve(!1):u.reject(w)}}return xr}))}))}cancelNavigationTransition(t,s,c){const u=new nu(t.id,this.urlSerializer.serialize(t.extractedUrl),s,c);this.events.next(u),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){const t=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),s=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return t.toString()!==s?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function Zq(e){return e!==Qn}let Jq=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:()=>me(eY),providedIn:"root"})}}return e})();class Qq{shouldDetach(n){return!1}store(n,t){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,t){return n.routeConfig===t.routeConfig}}let eY=(()=>{class e extends Qq{static{this.\u0275fac=(()=>{let t;return function(c){return(t||(t=yn(e)))(c||e)}})()}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Kz=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:()=>me(tY),providedIn:"root"})}}return e})(),tY=(()=>{class e extends Kz{constructor(){super(...arguments),this.location=me(Ah),this.urlSerializer=me(Mc),this.options=me(wi,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=me(W6),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Ka,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=um(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(s=>{"popstate"===s.type&&t(s.url,s.state)})}handleRouterEvent(t,s){if(t instanceof jl)this.stateMemento=this.createStateMemento();else if(t instanceof Zh)this.rawUrlTree=s.initialUrl;else if(t instanceof bO){if("eager"===this.urlUpdateStrategy&&!s.extras.skipLocationChange){const c=this.urlHandlingStrategy.merge(s.finalUrl,s.initialUrl);this.setBrowserUrl(s.targetBrowserUrl??c,s)}}else t instanceof CO?(this.currentUrlTree=s.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(s.finalUrl,s.initialUrl),this.routerState=s.targetRouterState,"deferred"===this.urlUpdateStrategy&&!s.extras.skipLocationChange&&this.setBrowserUrl(s.targetBrowserUrl??this.rawUrlTree,s)):t instanceof nu&&(t.code===ps.GuardRejected||t.code===ps.NoDataFromResolver)?this.restoreHistory(s):t instanceof eE?this.restoreHistory(s,!0):t instanceof tu&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,s){const c=t instanceof Ka?this.urlSerializer.serialize(t):t;if(this.location.isCurrentPathEqualTo(c)||s.extras.replaceUrl){const p={...s.extras.state,...this.generateNgRouterState(s.id,this.browserPageId)};this.location.replaceState(c,"",p)}else{const u={...s.extras.state,...this.generateNgRouterState(s.id,this.browserPageId+1)};this.location.go(c,"",u)}}restoreHistory(t,s=!1){if("computed"===this.canceledNavigationResolution){const u=this.currentPageId-this.browserPageId;0!==u?this.location.historyGo(u):this.currentUrlTree===t.finalUrl&&0===u&&(this.resetState(t),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(s&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,s){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:s}:{navigationId:t}}static{this.\u0275fac=(()=>{let t;return function(c){return(t||(t=yn(e)))(c||e)}})()}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var MO=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(MO||{});function nY(e){throw e}const rY={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},iY={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let su=(()=>{class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.console=me(MS),this.stateManager=me(Kz),this.options=me(wi,{optional:!0})||{},this.pendingTasks=me(hd),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=me(_U),this.urlSerializer=me(Mc),this.location=me(Ah),this.urlHandlingStrategy=me(W6),this._events=new Gt,this.errorHandler=this.options.errorHandler||nY,this.navigated=!1,this.routeReuseStrategy=me(Jq),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=me(lt,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!me(hm,{optional:!0}),this.eventsSubscription=new Ur,this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const t=this.navigationTransitions.events.subscribe(s=>{try{const c=this.navigationTransitions.currentTransition,u=this.navigationTransitions.currentNavigation;if(null!==c&&null!==u)if(this.stateManager.handleRouterEvent(s,u),s instanceof nu&&s.code!==ps.Redirect&&s.code!==ps.SupersededByNewNavigation)this.navigated=!0;else if(s instanceof tu)this.navigated=!0;else if(s instanceof nE){const p=s.navigationBehaviorOptions,_=this.urlHandlingStrategy.merge(s.url,c.currentRawUrl),E={browserUrl:c.extras.browserUrl,info:c.extras.info,skipLocationChange:c.extras.skipLocationChange,replaceUrl:c.extras.replaceUrl||"eager"===this.urlUpdateStrategy||Zq(c.source),...p};this.scheduleNavigation(_,Qn,null,E,{resolve:c.resolve,reject:c.reject,promise:c.promise})}(function sY(e){return!(e instanceof CO||e instanceof nE)})(s)&&this._events.next(s)}catch(c){this.navigationTransitions.transitionAbortSubject.next(c)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Qn,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,s)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(t,"popstate",s)},0)})}navigateToSyncWithBrowser(t,s,c){const u={replaceUrl:!0},p=c?.navigationId?c:null;if(c){const E={...c};delete E.navigationId,delete E.\u0275routerPageId,0!==Object.keys(E).length&&(u.state=E)}const _=this.parseUrl(t);this.scheduleNavigation(_,s,p,u)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(Rn),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,s={}){const{relativeTo:c,queryParams:u,fragment:p,queryParamsHandling:_,preserveFragment:E}=s,S=E?this.currentUrlTree.fragment:p;let D,w=null;switch(_??this.options.defaultQueryParamsHandling){case"merge":w={...this.currentUrlTree.queryParams,...u};break;case"preserve":w=this.currentUrlTree.queryParams;break;default:w=u||null}null!==w&&(w=this.removeEmptyProps(w));try{D=vO(c?c.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof t[0]||"/"!==t[0][0])&&(t=[]),D=this.currentUrlTree.root}return QF(D,t,w,S??null)}navigateByUrl(t,s={skipLocationChange:!1}){const c=$h(t)?t:this.parseUrl(t),u=this.urlHandlingStrategy.merge(c,this.rawUrlTree);return this.scheduleNavigation(u,Qn,null,s)}navigate(t,s={skipLocationChange:!1}){return function oY(e){for(let n=0;n<e.length;n++)if(null==e[n])throw new ae(4008,!1)}(t),this.navigateByUrl(this.createUrlTree(t,s),s)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.urlSerializer.parse("/")}}isActive(t,s){let c;if(c=!0===s?{...rY}:!1===s?{...iY}:s,$h(t))return qh(this.currentUrlTree,t,c);const u=this.parseUrl(t);return qh(this.currentUrlTree,u,c)}removeEmptyProps(t){return Object.entries(t).reduce((s,[c,u])=>(null!=u&&(s[c]=u),s),{})}scheduleNavigation(t,s,c,u,p){if(this.disposed)return Promise.resolve(!1);let _,E,S;p?(_=p.resolve,E=p.reject,S=p.promise):S=new Promise((D,U)=>{_=D,E=U});const w=this.pendingTasks.add();return function qz(e,n){e.events.pipe(Ns(t=>t instanceof tu||t instanceof nu||t instanceof eE||t instanceof Zh),en(t=>t instanceof tu||t instanceof Zh?MO.COMPLETE:t instanceof nu&&(t.code===ps.Redirect||t.code===ps.SupersededByNewNavigation)?MO.REDIRECTING:MO.FAILED),Ns(t=>t!==MO.REDIRECTING),Wa(1)).subscribe(()=>{n()})}(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(w))}),this.navigationTransitions.handleNavigationRequest({source:s,restoredState:c,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:u,resolve:_,reject:E,promise:S,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),S.catch(D=>Promise.reject(D))}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const K6=new Te("");function $z(e){return e.routerState.root}function Xz(){const e=me(Dr);return n=>{const t=e.get(bi);if(n!==t.components[0])return;const s=e.get(su),c=e.get(Zz);1===e.get(q6)&&s.initialNavigation(),e.get(Jz,null,Yt.Optional)?.setUpPreloading(),e.get(K6,null,Yt.Optional)?.init(),s.resetRootComponentType(t.componentTypes[0]),c.closed||(c.next(),c.complete(),c.unsubscribe())}}const Zz=new Te("",{factory:()=>new Gt}),q6=new Te("",{providedIn:"root",factory:()=>1}),Jz=new Te("");let gY=(()=>{class e{constructor(){this.appVersion="17.1.0"}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275cmp=eo({type:e,selectors:[["app-root"]],hostVars:1,hostBindings:function(s,c){2&s&&Jr("app-version",c.appVersion)},standalone:!0,features:[ho],decls:1,vars:0,template:function(s,c){1&s&&At(0,"router-outlet")},dependencies:[rT],changeDetection:0})}}return e})();var Tt=function(e){return e[e.State=0]="State",e[e.Transition=1]="Transition",e[e.Sequence=2]="Sequence",e[e.Group=3]="Group",e[e.Animate=4]="Animate",e[e.Keyframes=5]="Keyframes",e[e.Style=6]="Style",e[e.Trigger=7]="Trigger",e[e.Reference=8]="Reference",e[e.AnimateChild=9]="AnimateChild",e[e.AnimateRef=10]="AnimateRef",e[e.Query=11]="Query",e[e.Stagger=12]="Stagger",e}(Tt||{});const Jh="*";function Y6(e,n){return{type:Tt.Trigger,name:e,definitions:n,options:{}}}function kO(e,n=null){return{type:Tt.Animate,styles:n,timings:e}}function cu(e){return{type:Tt.Style,styles:e,offset:null}}function $6(e,n,t){return{type:Tt.State,name:e,styles:n,options:t}}function LO(e,n,t=null){return{type:Tt.Transition,expr:e,animation:n,options:t}}class xO{constructor(n=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=n+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(n=>n()),this._onDoneFns=[])}onStart(n){this._originalOnStartFns.push(n),this._onStartFns.push(n)}onDone(n){this._originalOnDoneFns.push(n),this._onDoneFns.push(n)}onDestroy(n){this._onDestroyFns.push(n)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(n=>n()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(n=>n()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(n){this._position=this.totalTime?n*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(n){const t="start"==n?this._onStartFns:this._onDoneFns;t.forEach(s=>s()),t.length=0}}class e9{constructor(n){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=n;let t=0,s=0,c=0;const u=this.players.length;0==u?queueMicrotask(()=>this._onFinish()):this.players.forEach(p=>{p.onDone(()=>{++t==u&&this._onFinish()}),p.onDestroy(()=>{++s==u&&this._onDestroy()}),p.onStart(()=>{++c==u&&this._onStart()})}),this.totalTime=this.players.reduce((p,_)=>Math.max(p,_.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(n=>n()),this._onDoneFns=[])}init(){this.players.forEach(n=>n.init())}onStart(n){this._onStartFns.push(n)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(n=>n()),this._onStartFns=[])}onDone(n){this._onDoneFns.push(n)}onDestroy(n){this._onDestroyFns.push(n)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(n=>n.play())}pause(){this.players.forEach(n=>n.pause())}restart(){this.players.forEach(n=>n.restart())}finish(){this._onFinish(),this.players.forEach(n=>n.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(n=>n.destroy()),this._onDestroyFns.forEach(n=>n()),this._onDestroyFns=[])}reset(){this.players.forEach(n=>n.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(n){const t=n*this.totalTime;this.players.forEach(s=>{const c=s.totalTime?Math.min(1,t/s.totalTime):1;s.setPosition(c)})}getPosition(){const n=this.players.reduce((t,s)=>null===t||s.totalTime>t.totalTime?s:t,null);return null!=n?n.getPosition():0}beforeDestroy(){this.players.forEach(n=>{n.beforeDestroy&&n.beforeDestroy()})}triggerCallback(n){const t="start"==n?this._onStartFns:this._onDoneFns;t.forEach(s=>s()),t.length=0}}function t9(e){return new ae(3e3,!1)}function vm(e){switch(e.length){case 0:return new xO;case 1:return e[0];default:return new e9(e)}}function n9(e,n,t=new Map,s=new Map){const c=[],u=[];let p=-1,_=null;if(n.forEach(E=>{const S=E.get("offset"),w=S==p,D=w&&_||new Map;E.forEach((U,V)=>{let H=V,z=U;if("offset"!==V)switch(H=e.normalizePropertyName(H,c),z){case"!":z=t.get(V);break;case Jh:z=s.get(V);break;default:z=e.normalizeStyleValue(V,H,z,c)}D.set(H,z)}),w||u.push(D),_=D,p=S}),c.length)throw function WY(){return new ae(3502,!1)}();return u}function Z6(e,n,t,s){switch(n){case"start":e.onStart(()=>s(t&&J6(t,"start",e)));break;case"done":e.onDone(()=>s(t&&J6(t,"done",e)));break;case"destroy":e.onDestroy(()=>s(t&&J6(t,"destroy",e)))}}function J6(e,n,t){const u=Q6(e.element,e.triggerName,e.fromState,e.toState,n||e.phaseName,t.totalTime??e.totalTime,!!t.disabled),p=e._data;return null!=p&&(u._data=p),u}function Q6(e,n,t,s,c="",u=0,p){return{element:e,triggerName:n,fromState:t,toState:s,phaseName:c,totalTime:u,disabled:!!p}}function Ja(e,n,t){let s=e.get(n);return s||e.set(n,s=t),s}function r9(e){const n=e.indexOf(":");return[e.substring(1,n),e.slice(n+1)]}const n$=typeof document>"u"?null:document.documentElement;function e8(e){const n=e.parentNode||e.host||null;return n===n$?null:n}let lE=null,i9=!1;function o9(e,n){for(;n;){if(n===e)return!0;n=e8(n)}return!1}function s9(e,n,t){if(t)return Array.from(e.querySelectorAll(n));const s=e.querySelector(n);return s?[s]:[]}let t8=(()=>{class e{validateStyleProperty(t){return function i$(e){lE||(lE=function o$(){return typeof document<"u"?document.body:null}()||{},i9=!!lE.style&&"WebkitAppearance"in lE.style);let n=!0;return lE.style&&!function r$(e){return"ebkit"==e.substring(1,6)}(e)&&(n=e in lE.style,!n&&i9&&(n="Webkit"+e.charAt(0).toUpperCase()+e.slice(1)in lE.style)),n}(t)}containsElement(t,s){return o9(t,s)}getParentElement(t){return e8(t)}query(t,s,c){return s9(t,s,c)}computeStyle(t,s,c){return c||""}animate(t,s,c,u,p,_=[],E){return new xO(c,u)}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac})}}return e})();class n8{static{this.NOOP=new t8}}class r8{}const a$=1e3,i8="ng-enter",vU="ng-leave",EU="ng-trigger",yU=".ng-trigger",c9="ng-animating",o8=".ng-animating";function Qh(e){if("number"==typeof e)return e;const n=e.match(/^(-?[\.\d]+)(m?s)/);return!n||n.length<2?0:s8(parseFloat(n[1]),n[2])}function s8(e,n){return"s"===n?e*a$:e}function bU(e,n,t){return e.hasOwnProperty("duration")?e:function l$(e,n,t){let c,u=0,p="";if("string"==typeof e){const _=e.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===_)return n.push(t9()),{duration:0,delay:0,easing:""};c=s8(parseFloat(_[1]),_[2]);const E=_[3];null!=E&&(u=s8(parseFloat(E),_[4]));const S=_[5];S&&(p=S)}else c=e;if(!t){let _=!1,E=n.length;c<0&&(n.push(function SY(){return new ae(3100,!1)}()),_=!0),u<0&&(n.push(function CY(){return new ae(3101,!1)}()),_=!0),_&&n.splice(E,0,t9())}return{duration:c,delay:u,easing:p}}(e,n,t)}function lu(e,n,t){n.forEach((s,c)=>{const u=c8(c);t&&!t.has(c)&&t.set(c,e.style[u]),e.style[u]=s})}function dE(e,n){n.forEach((t,s)=>{const c=c8(s);e.style[c]=""})}function FO(e){return Array.isArray(e)?1==e.length?e[0]:function _Y(e,n=null){return{type:Tt.Sequence,steps:e,options:n}}(e):e}const a8=new RegExp("{{\\s*(.+?)\\s*}}","g");function d9(e){let n=[];if("string"==typeof e){let t;for(;t=a8.exec(e);)n.push(t[1]);a8.lastIndex=0}return n}function UO(e,n,t){const s=`${e}`,c=s.replace(a8,(u,p)=>{let _=n[p];return null==_&&(t.push(function wY(){return new ae(3003,!1)}()),_=""),_.toString()});return c==s?e:c}const h$=/-+([a-z0-9])/g;function c8(e){return e.replace(h$,(...n)=>n[1].toUpperCase())}function Qa(e,n,t){switch(n.type){case Tt.Trigger:return e.visitTrigger(n,t);case Tt.State:return e.visitState(n,t);case Tt.Transition:return e.visitTransition(n,t);case Tt.Sequence:return e.visitSequence(n,t);case Tt.Group:return e.visitGroup(n,t);case Tt.Animate:return e.visitAnimate(n,t);case Tt.Keyframes:return e.visitKeyframes(n,t);case Tt.Style:return e.visitStyle(n,t);case Tt.Reference:return e.visitReference(n,t);case Tt.AnimateChild:return e.visitAnimateChild(n,t);case Tt.AnimateRef:return e.visitAnimateRef(n,t);case Tt.Query:return e.visitQuery(n,t);case Tt.Stagger:return e.visitStagger(n,t);default:throw function IY(){return new ae(3004,!1)}()}}function l8(e,n){return window.getComputedStyle(e)[n]}const m$=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class u9 extends r8{normalizePropertyName(n,t){return c8(n)}normalizeStyleValue(n,t,s,c){let u="";const p=s.toString().trim();if(m$.has(t)&&0!==s&&"0"!==s)if("number"==typeof s)u="px";else{const _=s.match(/^[+-]?[\d\.]+([a-z]*)$/);_&&0==_[1].length&&c.push(function RY(){return new ae(3005,!1)}())}return p+u}}const SU="*";const CU=new Set(["true","1"]),TU=new Set(["false","0"]);function h9(e,n){const t=CU.has(e)||TU.has(e),s=CU.has(n)||TU.has(n);return(c,u)=>{let p=e==SU||e==c,_=n==SU||n==u;return!p&&t&&"boolean"==typeof c&&(p=c?CU.has(e):TU.has(e)),!_&&s&&"boolean"==typeof u&&(_=u?CU.has(n):TU.has(n)),p&&_}}const E$=new RegExp("s*:selfs*,?","g");function d8(e,n,t,s){return new y$(e).build(n,t,s)}class y${constructor(n){this._driver=n}build(n,t,s){const c=new C$(t);return this._resetContextStyleTimingState(c),Qa(this,FO(n),c)}_resetContextStyleTimingState(n){n.currentQuerySelector="",n.collectedStyles=new Map,n.collectedStyles.set("",new Map),n.currentTime=0}visitTrigger(n,t){let s=t.queryCount=0,c=t.depCount=0;const u=[],p=[];return"@"==n.name.charAt(0)&&t.errors.push(function AY(){return new ae(3006,!1)}()),n.definitions.forEach(_=>{if(this._resetContextStyleTimingState(t),_.type==Tt.State){const E=_,S=E.name;S.toString().split(/\s*,\s*/).forEach(w=>{E.name=w,u.push(this.visitState(E,t))}),E.name=S}else if(_.type==Tt.Transition){const E=this.visitTransition(_,t);s+=E.queryCount,c+=E.depCount,p.push(E)}else t.errors.push(function DY(){return new ae(3007,!1)}())}),{type:Tt.Trigger,name:n.name,states:u,transitions:p,queryCount:s,depCount:c,options:null}}visitState(n,t){const s=this.visitStyle(n.styles,t),c=n.options&&n.options.params||null;if(s.containsDynamicStyles){const u=new Set,p=c||{};s.styles.forEach(_=>{_ instanceof Map&&_.forEach(E=>{d9(E).forEach(S=>{p.hasOwnProperty(S)||u.add(S)})})}),u.size&&t.errors.push(function OY(){return new ae(3008,!1)}(0,u.values()))}return{type:Tt.State,name:n.name,style:s,options:c?{params:c}:null}}visitTransition(n,t){t.queryCount=0,t.depCount=0;const s=Qa(this,FO(n.animation),t),c=function g$(e,n){const t=[];return"string"==typeof e?e.split(/\s*,\s*/).forEach(s=>function _$(e,n,t){if(":"==e[0]){const E=function v$(e,n){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,s)=>parseFloat(s)>parseFloat(t);case":decrement":return(t,s)=>parseFloat(s)<parseFloat(t);default:return n.push(function BY(){return new ae(3016,!1)}()),"* => *"}}(e,t);if("function"==typeof E)return void n.push(E);e=E}const s=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==s||s.length<4)return t.push(function VY(){return new ae(3015,!1)}()),n;const c=s[1],u=s[2],p=s[3];n.push(h9(c,p)),"<"==u[0]&&(c!=SU||p!=SU)&&n.push(h9(p,c))}(s,t,n)):t.push(e),t}(n.expr,t.errors);return{type:Tt.Transition,matchers:c,animation:s,queryCount:t.queryCount,depCount:t.depCount,options:uE(n.options)}}visitSequence(n,t){return{type:Tt.Sequence,steps:n.steps.map(s=>Qa(this,s,t)),options:uE(n.options)}}visitGroup(n,t){const s=t.currentTime;let c=0;const u=n.steps.map(p=>{t.currentTime=s;const _=Qa(this,p,t);return c=Math.max(c,t.currentTime),_});return t.currentTime=c,{type:Tt.Group,steps:u,options:uE(n.options)}}visitAnimate(n,t){const s=function w$(e,n){if(e.hasOwnProperty("duration"))return e;if("number"==typeof e)return u8(bU(e,n).duration,0,"");const t=e;if(t.split(/\s+/).some(u=>"{"==u.charAt(0)&&"{"==u.charAt(1))){const u=u8(0,0,"");return u.dynamic=!0,u.strValue=t,u}const c=bU(t,n);return u8(c.duration,c.delay,c.easing)}(n.timings,t.errors);t.currentAnimateTimings=s;let c,u=n.styles?n.styles:cu({});if(u.type==Tt.Keyframes)c=this.visitKeyframes(u,t);else{let p=n.styles,_=!1;if(!p){_=!0;const S={};s.easing&&(S.easing=s.easing),p=cu(S)}t.currentTime+=s.duration+s.delay;const E=this.visitStyle(p,t);E.isEmptyStep=_,c=E}return t.currentAnimateTimings=null,{type:Tt.Animate,timings:s,style:c,options:null}}visitStyle(n,t){const s=this._makeStyleAst(n,t);return this._validateStyleAst(s,t),s}_makeStyleAst(n,t){const s=[],c=Array.isArray(n.styles)?n.styles:[n.styles];for(let _ of c)"string"==typeof _?_===Jh?s.push(_):t.errors.push(new ae(3002,!1)):s.push(new Map(Object.entries(_)));let u=!1,p=null;return s.forEach(_=>{if(_ instanceof Map&&(_.has("easing")&&(p=_.get("easing"),_.delete("easing")),!u))for(let E of _.values())if(E.toString().indexOf("{{")>=0){u=!0;break}}),{type:Tt.Style,styles:s,easing:p,offset:n.offset,containsDynamicStyles:u,options:null}}_validateStyleAst(n,t){const s=t.currentAnimateTimings;let c=t.currentTime,u=t.currentTime;s&&u>0&&(u-=s.duration+s.delay),n.styles.forEach(p=>{"string"!=typeof p&&p.forEach((_,E)=>{const S=t.collectedStyles.get(t.currentQuerySelector),w=S.get(E);let D=!0;w&&(u!=c&&u>=w.startTime&&c<=w.endTime&&(t.errors.push(function PY(){return new ae(3010,!1)}()),D=!1),u=w.startTime),D&&S.set(E,{startTime:u,endTime:c}),t.options&&function u$(e,n,t){const s=n.params||{},c=d9(e);c.length&&c.forEach(u=>{s.hasOwnProperty(u)||t.push(function TY(){return new ae(3001,!1)}())})}(_,t.options,t.errors)})})}visitKeyframes(n,t){const s={type:Tt.Keyframes,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(function MY(){return new ae(3011,!1)}()),s;let u=0;const p=[];let _=!1,E=!1,S=0;const w=n.steps.map(ie=>{const ne=this._makeStyleAst(ie,t);let ke=null!=ne.offset?ne.offset:function T$(e){if("string"==typeof e)return null;let n=null;if(Array.isArray(e))e.forEach(t=>{if(t instanceof Map&&t.has("offset")){const s=t;n=parseFloat(s.get("offset")),s.delete("offset")}});else if(e instanceof Map&&e.has("offset")){const t=e;n=parseFloat(t.get("offset")),t.delete("offset")}return n}(ne.styles),Ge=0;return null!=ke&&(u++,Ge=ne.offset=ke),E=E||Ge<0||Ge>1,_=_||Ge<S,S=Ge,p.push(Ge),ne});E&&t.errors.push(function kY(){return new ae(3012,!1)}()),_&&t.errors.push(function LY(){return new ae(3200,!1)}());const D=n.steps.length;let U=0;u>0&&u<D?t.errors.push(function xY(){return new ae(3202,!1)}()):0==u&&(U=1/(D-1));const V=D-1,H=t.currentTime,z=t.currentAnimateTimings,Q=z.duration;return w.forEach((ie,ne)=>{const ke=U>0?ne==V?1:U*ne:p[ne],Ge=ke*Q;t.currentTime=H+z.delay+Ge,z.duration=Ge,this._validateStyleAst(ie,t),ie.offset=ke,s.styles.push(ie)}),s}visitReference(n,t){return{type:Tt.Reference,animation:Qa(this,FO(n.animation),t),options:uE(n.options)}}visitAnimateChild(n,t){return t.depCount++,{type:Tt.AnimateChild,options:uE(n.options)}}visitAnimateRef(n,t){return{type:Tt.AnimateRef,animation:this.visitReference(n.animation,t),options:uE(n.options)}}visitQuery(n,t){const s=t.currentQuerySelector,c=n.options||{};t.queryCount++,t.currentQuery=n;const[u,p]=function b$(e){const n=!!e.split(/\s*,\s*/).find(t=>":self"==t);return n&&(e=e.replace(E$,"")),e=e.replace(/@\*/g,yU).replace(/@\w+/g,t=>yU+"-"+t.slice(1)).replace(/:animating/g,o8),[e,n]}(n.selector);t.currentQuerySelector=s.length?s+" "+u:u,Ja(t.collectedStyles,t.currentQuerySelector,new Map);const _=Qa(this,FO(n.animation),t);return t.currentQuery=null,t.currentQuerySelector=s,{type:Tt.Query,selector:u,limit:c.limit||0,optional:!!c.optional,includeSelf:p,animation:_,originalSelector:n.selector,options:uE(n.options)}}visitStagger(n,t){t.currentQuery||t.errors.push(function FY(){return new ae(3013,!1)}());const s="full"===n.timings?{duration:0,delay:0,easing:"full"}:bU(n.timings,t.errors,!0);return{type:Tt.Stagger,animation:Qa(this,FO(n.animation),t),timings:s,options:null}}}class C${constructor(n){this.errors=n,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function uE(e){return e?(e={...e}).params&&(e.params=function S$(e){return e?{...e}:null}(e.params)):e={},e}function u8(e,n,t){return{duration:e,delay:n,easing:t}}function h8(e,n,t,s,c,u,p=null,_=!1){return{type:1,element:e,keyframes:n,preStyleProps:t,postStyleProps:s,duration:c,delay:u,totalTime:c+u,easing:p,subTimeline:_}}class wU{constructor(){this._map=new Map}get(n){return this._map.get(n)||[]}append(n,t){let s=this._map.get(n);s||this._map.set(n,s=[]),s.push(...t)}has(n){return this._map.has(n)}clear(){this._map.clear()}}const A$=new RegExp(":enter","g"),O$=new RegExp(":leave","g");function p8(e,n,t,s,c,u=new Map,p=new Map,_,E,S=[]){return(new N$).buildKeyframes(e,n,t,s,c,u,p,_,E,S)}class N${buildKeyframes(n,t,s,c,u,p,_,E,S,w=[]){S=S||new wU;const D=new f8(n,t,S,c,u,w,[]);D.options=E;const U=E.delay?Qh(E.delay):0;D.currentTimeline.delayNextStep(U),D.currentTimeline.setStyles([p],null,D.errors,E),Qa(this,s,D);const V=D.timelines.filter(H=>H.containsAnimation());if(V.length&&_.size){let H;for(let z=V.length-1;z>=0;z--){const Q=V[z];if(Q.element===t){H=Q;break}}H&&!H.allowOnlyTimelineStyles()&&H.setStyles([_],null,D.errors,E)}return V.length?V.map(H=>H.buildKeyframes()):[h8(t,[],[],[],0,U,"",!1)]}visitTrigger(n,t){}visitState(n,t){}visitTransition(n,t){}visitAnimateChild(n,t){const s=t.subInstructions.get(t.element);if(s){const c=t.createSubContext(n.options),u=t.currentTimeline.currentTime,p=this._visitSubInstructions(s,c,c.options);u!=p&&t.transformIntoNewTimeline(p)}t.previousNode=n}visitAnimateRef(n,t){const s=t.createSubContext(n.options);s.transformIntoNewTimeline(),this._applyAnimationRefDelays([n.options,n.animation.options],t,s),this.visitReference(n.animation,s),t.transformIntoNewTimeline(s.currentTimeline.currentTime),t.previousNode=n}_applyAnimationRefDelays(n,t,s){for(const c of n){const u=c?.delay;if(u){const p="number"==typeof u?u:Qh(UO(u,c?.params??{},t.errors));s.delayNextStep(p)}}}_visitSubInstructions(n,t,s){let u=t.currentTimeline.currentTime;const p=null!=s.duration?Qh(s.duration):null,_=null!=s.delay?Qh(s.delay):null;return 0!==p&&n.forEach(E=>{const S=t.appendInstructionToTimeline(E,p,_);u=Math.max(u,S.duration+S.delay)}),u}visitReference(n,t){t.updateOptions(n.options,!0),Qa(this,n.animation,t),t.previousNode=n}visitSequence(n,t){const s=t.subContextCount;let c=t;const u=n.options;if(u&&(u.params||u.delay)&&(c=t.createSubContext(u),c.transformIntoNewTimeline(),null!=u.delay)){c.previousNode.type==Tt.Style&&(c.currentTimeline.snapshotCurrentStyles(),c.previousNode=IU);const p=Qh(u.delay);c.delayNextStep(p)}n.steps.length&&(n.steps.forEach(p=>Qa(this,p,c)),c.currentTimeline.applyStylesToKeyframe(),c.subContextCount>s&&c.transformIntoNewTimeline()),t.previousNode=n}visitGroup(n,t){const s=[];let c=t.currentTimeline.currentTime;const u=n.options&&n.options.delay?Qh(n.options.delay):0;n.steps.forEach(p=>{const _=t.createSubContext(n.options);u&&_.delayNextStep(u),Qa(this,p,_),c=Math.max(c,_.currentTimeline.currentTime),s.push(_.currentTimeline)}),s.forEach(p=>t.currentTimeline.mergeTimelineCollectedStyles(p)),t.transformIntoNewTimeline(c),t.previousNode=n}_visitTiming(n,t){if(n.dynamic){const s=n.strValue;return bU(t.params?UO(s,t.params,t.errors):s,t.errors)}return{duration:n.duration,delay:n.delay,easing:n.easing}}visitAnimate(n,t){const s=t.currentAnimateTimings=this._visitTiming(n.timings,t),c=t.currentTimeline;s.delay&&(t.incrementTime(s.delay),c.snapshotCurrentStyles());const u=n.style;u.type==Tt.Keyframes?this.visitKeyframes(u,t):(t.incrementTime(s.duration),this.visitStyle(u,t),c.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=n}visitStyle(n,t){const s=t.currentTimeline,c=t.currentAnimateTimings;!c&&s.hasCurrentStyleProperties()&&s.forwardFrame();const u=c&&c.easing||n.easing;n.isEmptyStep?s.applyEmptyStep(u):s.setStyles(n.styles,u,t.errors,t.options),t.previousNode=n}visitKeyframes(n,t){const s=t.currentAnimateTimings,c=t.currentTimeline.duration,u=s.duration,_=t.createSubContext().currentTimeline;_.easing=s.easing,n.styles.forEach(E=>{_.forwardTime((E.offset||0)*u),_.setStyles(E.styles,E.easing,t.errors,t.options),_.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(_),t.transformIntoNewTimeline(c+u),t.previousNode=n}visitQuery(n,t){const s=t.currentTimeline.currentTime,c=n.options||{},u=c.delay?Qh(c.delay):0;u&&(t.previousNode.type===Tt.Style||0==s&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=IU);let p=s;const _=t.invokeQuery(n.selector,n.originalSelector,n.limit,n.includeSelf,!!c.optional,t.errors);t.currentQueryTotal=_.length;let E=null;_.forEach((S,w)=>{t.currentQueryIndex=w;const D=t.createSubContext(n.options,S);u&&D.delayNextStep(u),S===t.element&&(E=D.currentTimeline),Qa(this,n.animation,D),D.currentTimeline.applyStylesToKeyframe(),p=Math.max(p,D.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(p),E&&(t.currentTimeline.mergeTimelineCollectedStyles(E),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=n}visitStagger(n,t){const s=t.parentContext,c=t.currentTimeline,u=n.timings,p=Math.abs(u.duration),_=p*(t.currentQueryTotal-1);let E=p*t.currentQueryIndex;switch(u.duration<0?"reverse":u.easing){case"reverse":E=_-E;break;case"full":E=s.currentStaggerTime}const w=t.currentTimeline;E&&w.delayNextStep(E);const D=w.currentTime;Qa(this,n.animation,t),t.previousNode=n,s.currentStaggerTime=c.currentTime-D+(c.startTime-s.currentTimeline.startTime)}}const IU={};class f8{constructor(n,t,s,c,u,p,_,E){this._driver=n,this.element=t,this.subInstructions=s,this._enterClassName=c,this._leaveClassName=u,this.errors=p,this.timelines=_,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=IU,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=E||new RU(this._driver,t,0),_.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(n,t){if(!n)return;const s=n;let c=this.options;null!=s.duration&&(c.duration=Qh(s.duration)),null!=s.delay&&(c.delay=Qh(s.delay));const u=s.params;if(u){let p=c.params;p||(p=this.options.params={}),Object.keys(u).forEach(_=>{(!t||!p.hasOwnProperty(_))&&(p[_]=UO(u[_],p,this.errors))})}}_copyOptions(){const n={};if(this.options){const t=this.options.params;if(t){const s=n.params={};Object.keys(t).forEach(c=>{s[c]=t[c]})}}return n}createSubContext(n=null,t,s){const c=t||this.element,u=new f8(this._driver,c,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(c,s||0));return u.previousNode=this.previousNode,u.currentAnimateTimings=this.currentAnimateTimings,u.options=this._copyOptions(),u.updateOptions(n),u.currentQueryIndex=this.currentQueryIndex,u.currentQueryTotal=this.currentQueryTotal,u.parentContext=this,this.subContextCount++,u}transformIntoNewTimeline(n){return this.previousNode=IU,this.currentTimeline=this.currentTimeline.fork(this.element,n),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(n,t,s){const c={duration:t??n.duration,delay:this.currentTimeline.currentTime+(s??0)+n.delay,easing:""},u=new P$(this._driver,n.element,n.keyframes,n.preStyleProps,n.postStyleProps,c,n.stretchStartingKeyframe);return this.timelines.push(u),c}incrementTime(n){this.currentTimeline.forwardTime(this.currentTimeline.duration+n)}delayNextStep(n){n>0&&this.currentTimeline.delayNextStep(n)}invokeQuery(n,t,s,c,u,p){let _=[];if(c&&_.push(this.element),n.length>0){n=(n=n.replace(A$,"."+this._enterClassName)).replace(O$,"."+this._leaveClassName);let S=this._driver.query(this.element,n,1!=s);0!==s&&(S=s<0?S.slice(S.length+s,S.length):S.slice(0,s)),_.push(...S)}return!u&&0==_.length&&p.push(function UY(){return new ae(3014,!1)}()),_}}class RU{constructor(n,t,s,c){this._driver=n,this.element=t,this.startTime=s,this._elementTimelineStylesLookup=c,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(n){const t=1===this._keyframes.size&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+n),t&&this.snapshotCurrentStyles()):this.startTime+=n}fork(n,t){return this.applyStylesToKeyframe(),new RU(this._driver,n,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(n){this.applyStylesToKeyframe(),this.duration=n,this._loadKeyframe()}_updateStyle(n,t){this._localTimelineStyles.set(n,t),this._globalTimelineStyles.set(n,t),this._styleSummary.set(n,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(n){n&&this._previousKeyframe.set("easing",n);for(let[t,s]of this._globalTimelineStyles)this._backFill.set(t,s||Jh),this._currentKeyframe.set(t,Jh);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(n,t,s,c){t&&this._previousKeyframe.set("easing",t);const u=c&&c.params||{},p=function M$(e,n){const t=new Map;let s;return e.forEach(c=>{if("*"===c){s??=n.keys();for(let u of s)t.set(u,Jh)}else for(let[u,p]of c)t.set(u,p)}),t}(n,this._globalTimelineStyles);for(let[_,E]of p){const S=UO(E,u,s);this._pendingStyles.set(_,S),this._localTimelineStyles.has(_)||this._backFill.set(_,this._globalTimelineStyles.get(_)??Jh),this._updateStyle(_,S)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((n,t)=>{this._currentKeyframe.set(t,n)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((n,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,n)}))}snapshotCurrentStyles(){for(let[n,t]of this._localTimelineStyles)this._pendingStyles.set(n,t),this._updateStyle(n,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const n=[];for(let t in this._currentKeyframe)n.push(t);return n}mergeTimelineCollectedStyles(n){n._styleSummary.forEach((t,s)=>{const c=this._styleSummary.get(s);(!c||t.time>c.time)&&this._updateStyle(s,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();const n=new Set,t=new Set,s=1===this._keyframes.size&&0===this.duration;let c=[];this._keyframes.forEach((_,E)=>{const S=new Map([...this._backFill,..._]);S.forEach((w,D)=>{"!"===w?n.add(D):w===Jh&&t.add(D)}),s||S.set("offset",E/this.duration),c.push(S)});const u=[...n.values()],p=[...t.values()];if(s){const _=c[0],E=new Map(_);_.set("offset",0),E.set("offset",1),c=[_,E]}return h8(this.element,c,u,p,this.duration,this.startTime,this.easing,!1)}}class P$ extends RU{constructor(n,t,s,c,u,p,_=!1){super(n,t,p.delay),this.keyframes=s,this.preStyleProps=c,this.postStyleProps=u,this._stretchStartingKeyframe=_,this.timings={duration:p.duration,delay:p.delay,easing:p.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let n=this.keyframes,{delay:t,duration:s,easing:c}=this.timings;if(this._stretchStartingKeyframe&&t){const u=[],p=s+t,_=t/p,E=new Map(n[0]);E.set("offset",0),u.push(E);const S=new Map(n[0]);S.set("offset",m9(_)),u.push(S);const w=n.length-1;for(let D=1;D<=w;D++){let U=new Map(n[D]);const V=U.get("offset");U.set("offset",m9((t+V*s)/p)),u.push(U)}s=p,t=0,c="",n=u}return h8(this.element,n,this.preStyleProps,this.postStyleProps,s,t,c,!0)}}function m9(e,n=3){const t=Math.pow(10,n-1);return Math.round(e*t)/t}function g9(e,n,t,s,c,u,p,_,E,S,w,D,U){return{type:0,element:e,triggerName:n,isRemovalTransition:c,fromState:t,fromStyles:u,toState:s,toStyles:p,timelines:_,queriedElements:E,preStyleProps:S,postStyleProps:w,totalTime:D,errors:U}}const m8={};class _9{constructor(n,t,s){this._triggerName=n,this.ast=t,this._stateStyles=s}match(n,t,s,c){return function k$(e,n,t,s,c){return e.some(u=>u(n,t,s,c))}(this.ast.matchers,n,t,s,c)}buildStyles(n,t,s){let c=this._stateStyles.get("*");return void 0!==n&&(c=this._stateStyles.get(n?.toString())||c),c?c.buildStyles(t,s):new Map}build(n,t,s,c,u,p,_,E,S,w){const D=[],U=this.ast.options&&this.ast.options.params||m8,H=this.buildStyles(s,_&&_.params||m8,D),z=E&&E.params||m8,Q=this.buildStyles(c,z,D),ie=new Set,ne=new Map,ke=new Map,Ge="void"===c,jt={params:v9(z,U),delay:this.ast.options?.delay},cn=w?[]:p8(n,t,this.ast.animation,u,p,H,Q,jt,S,D);let An=0;return cn.forEach(Ii=>{An=Math.max(Ii.duration+Ii.delay,An)}),D.length?g9(t,this._triggerName,s,c,Ge,H,Q,[],[],ne,ke,An,D):(cn.forEach(Ii=>{const uu=Ii.element,gT=Ja(ne,uu,new Set);Ii.preStyleProps.forEach(bE=>gT.add(bE));const Bq=Ja(ke,uu,new Set);Ii.postStyleProps.forEach(bE=>Bq.add(bE)),uu!==t&&ie.add(uu)}),g9(t,this._triggerName,s,c,Ge,H,Q,cn,[...ie.values()],ne,ke,An))}}function v9(e,n){const t={...n};return Object.entries(e).forEach(([s,c])=>{null!=c&&(t[s]=c)}),t}class L${constructor(n,t,s){this.styles=n,this.defaultParams=t,this.normalizer=s}buildStyles(n,t){const s=new Map,c=v9(n,this.defaultParams);return this.styles.styles.forEach(u=>{"string"!=typeof u&&u.forEach((p,_)=>{p&&(p=UO(p,c,t));const E=this.normalizer.normalizePropertyName(_,t);p=this.normalizer.normalizeStyleValue(_,E,p,t),s.set(_,p)})}),s}}class F${constructor(n,t,s){this.name=n,this.ast=t,this._normalizer=s,this.transitionFactories=[],this.states=new Map,t.states.forEach(c=>{this.states.set(c.name,new L$(c.style,c.options&&c.options.params||{},s))}),E9(this.states,"true","1"),E9(this.states,"false","0"),t.transitions.forEach(c=>{this.transitionFactories.push(new _9(n,c,this.states))}),this.fallbackTransition=function U$(e,n){return new _9(e,{type:Tt.Transition,animation:{type:Tt.Sequence,steps:[],options:null},matchers:[(p,_)=>!0],options:null,queryCount:0,depCount:0},n)}(n,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(n,t,s,c){return this.transitionFactories.find(p=>p.match(n,t,s,c))||null}matchStyles(n,t,s){return this.fallbackTransition.buildStyles(n,t,s)}}function E9(e,n,t){e.has(n)?e.has(t)||e.set(t,e.get(n)):e.has(t)&&e.set(n,e.get(t))}const V$=new wU;class B${constructor(n,t,s){this.bodyNode=n,this._driver=t,this._normalizer=s,this._animations=new Map,this._playersById=new Map,this.players=[]}register(n,t){const s=[],u=d8(this._driver,t,s,[]);if(s.length)throw function zY(){return new ae(3503,!1)}();this._animations.set(n,u)}_buildPlayer(n,t,s){const c=n.element,u=n9(this._normalizer,n.keyframes,t,s);return this._driver.animate(c,u,n.duration,n.delay,n.easing,[],!0)}create(n,t,s={}){const c=[],u=this._animations.get(n);let p;const _=new Map;if(u?(p=p8(this._driver,t,u,i8,vU,new Map,new Map,s,V$,c),p.forEach(w=>{const D=Ja(_,w.element,new Map);w.postStyleProps.forEach(U=>D.set(U,null))})):(c.push(function KY(){return new ae(3300,!1)}()),p=[]),c.length)throw function qY(){return new ae(3504,!1)}();_.forEach((w,D)=>{w.forEach((U,V)=>{w.set(V,this._driver.computeStyle(D,V,Jh))})});const S=vm(p.map(w=>{const D=_.get(w.element);return this._buildPlayer(w,new Map,D)}));return this._playersById.set(n,S),S.onDestroy(()=>this.destroy(n)),this.players.push(S),S}destroy(n){const t=this._getPlayer(n);t.destroy(),this._playersById.delete(n);const s=this.players.indexOf(t);s>=0&&this.players.splice(s,1)}_getPlayer(n){const t=this._playersById.get(n);if(!t)throw function YY(){return new ae(3301,!1)}();return t}listen(n,t,s,c){const u=Q6(t,"","","");return Z6(this._getPlayer(n),s,u,c),()=>{}}command(n,t,s,c){if("register"==s)return void this.register(n,c[0]);if("create"==s)return void this.create(n,t,c[0]||{});const u=this._getPlayer(n);switch(s){case"play":u.play();break;case"pause":u.pause();break;case"reset":u.reset();break;case"restart":u.restart();break;case"finish":u.finish();break;case"init":u.init();break;case"setPosition":u.setPosition(parseFloat(c[0]));break;case"destroy":this.destroy(n)}}}const y9="ng-animate-queued",g8="ng-animate-disabled",z$=[],b9={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},K$={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},zl="__ng_removed";class _8{get params(){return this.options.params}constructor(n,t=""){this.namespaceId=t;const s=n&&n.hasOwnProperty("value");if(this.value=function X$(e){return e??null}(s?n.value:n),s){const{value:u,...p}=n;this.options=p}else this.options={};this.options.params||(this.options.params={})}absorbOptions(n){const t=n.params;if(t){const s=this.options.params;Object.keys(t).forEach(c=>{null==s[c]&&(s[c]=t[c])})}}}const VO="void",v8=new _8(VO);class q${constructor(n,t,s){this.id=n,this.hostElement=t,this._engine=s,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+n,Fc(t,this._hostClassName)}listen(n,t,s,c){if(!this._triggers.has(t))throw function $Y(){return new ae(3302,!1)}();if(null==s||0==s.length)throw function XY(){return new ae(3303,!1)}();if(!function Z$(e){return"start"==e||"done"==e}(s))throw function ZY(){return new ae(3400,!1)}();const u=Ja(this._elementListeners,n,[]),p={name:t,phase:s,callback:c};u.push(p);const _=Ja(this._engine.statesByElement,n,new Map);return _.has(t)||(Fc(n,EU),Fc(n,EU+"-"+t),_.set(t,v8)),()=>{this._engine.afterFlush(()=>{const E=u.indexOf(p);E>=0&&u.splice(E,1),this._triggers.has(t)||_.delete(t)})}}register(n,t){return!this._triggers.has(n)&&(this._triggers.set(n,t),!0)}_getTrigger(n){const t=this._triggers.get(n);if(!t)throw function JY(){return new ae(3401,!1)}();return t}trigger(n,t,s,c=!0){const u=this._getTrigger(t),p=new E8(this.id,t,n);let _=this._engine.statesByElement.get(n);_||(Fc(n,EU),Fc(n,EU+"-"+t),this._engine.statesByElement.set(n,_=new Map));let E=_.get(t);const S=new _8(s,this.id);if(!(s&&s.hasOwnProperty("value"))&&E&&S.absorbOptions(E.options),_.set(t,S),E||(E=v8),S.value!==VO&&E.value===S.value){if(!function eX(e,n){const t=Object.keys(e),s=Object.keys(n);if(t.length!=s.length)return!1;for(let c=0;c<t.length;c++){const u=t[c];if(!n.hasOwnProperty(u)||e[u]!==n[u])return!1}return!0}(E.params,S.params)){const z=[],Q=u.matchStyles(E.value,E.params,z),ie=u.matchStyles(S.value,S.params,z);z.length?this._engine.reportError(z):this._engine.afterFlush(()=>{dE(n,Q),lu(n,ie)})}return}const U=Ja(this._engine.playersByElement,n,[]);U.forEach(z=>{z.namespaceId==this.id&&z.triggerName==t&&z.queued&&z.destroy()});let V=u.matchTransition(E.value,S.value,n,S.params),H=!1;if(!V){if(!c)return;V=u.fallbackTransition,H=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:n,triggerName:t,transition:V,fromState:E,toState:S,player:p,isFallbackTransition:H}),H||(Fc(n,y9),p.onStart(()=>{aT(n,y9)})),p.onDone(()=>{let z=this.players.indexOf(p);z>=0&&this.players.splice(z,1);const Q=this._engine.playersByElement.get(n);if(Q){let ie=Q.indexOf(p);ie>=0&&Q.splice(ie,1)}}),this.players.push(p),U.push(p),p}deregister(n){this._triggers.delete(n),this._engine.statesByElement.forEach(t=>t.delete(n)),this._elementListeners.forEach((t,s)=>{this._elementListeners.set(s,t.filter(c=>c.name!=n))})}clearElementCache(n){this._engine.statesByElement.delete(n),this._elementListeners.delete(n);const t=this._engine.playersByElement.get(n);t&&(t.forEach(s=>s.destroy()),this._engine.playersByElement.delete(n))}_signalRemovalForInnerTriggers(n,t){const s=this._engine.driver.query(n,yU,!0);s.forEach(c=>{if(c[zl])return;const u=this._engine.fetchNamespacesByElement(c);u.size?u.forEach(p=>p.triggerLeaveAnimation(c,t,!1,!0)):this.clearElementCache(c)}),this._engine.afterFlushAnimationsDone(()=>s.forEach(c=>this.clearElementCache(c)))}triggerLeaveAnimation(n,t,s,c){const u=this._engine.statesByElement.get(n),p=new Map;if(u){const _=[];if(u.forEach((E,S)=>{if(p.set(S,E.value),this._triggers.has(S)){const w=this.trigger(n,S,VO,c);w&&_.push(w)}}),_.length)return this._engine.markElementAsRemoved(this.id,n,!0,t,p),s&&vm(_).onDone(()=>this._engine.processLeaveNode(n)),!0}return!1}prepareLeaveAnimationListeners(n){const t=this._elementListeners.get(n),s=this._engine.statesByElement.get(n);if(t&&s){const c=new Set;t.forEach(u=>{const p=u.name;if(c.has(p))return;c.add(p);const E=this._triggers.get(p).fallbackTransition,S=s.get(p)||v8,w=new _8(VO),D=new E8(this.id,p,n);this._engine.totalQueuedPlayers++,this._queue.push({element:n,triggerName:p,transition:E,fromState:S,toState:w,player:D,isFallbackTransition:!0})})}}removeNode(n,t){const s=this._engine;if(n.childElementCount&&this._signalRemovalForInnerTriggers(n,t),this.triggerLeaveAnimation(n,t,!0))return;let c=!1;if(s.totalAnimations){const u=s.players.length?s.playersByQueriedElement.get(n):[];if(u&&u.length)c=!0;else{let p=n;for(;p=p.parentNode;)if(s.statesByElement.get(p)){c=!0;break}}}if(this.prepareLeaveAnimationListeners(n),c)s.markElementAsRemoved(this.id,n,!1,t);else{const u=n[zl];(!u||u===b9)&&(s.afterFlush(()=>this.clearElementCache(n)),s.destroyInnerAnimations(n),s._onRemovalComplete(n,t))}}insertNode(n,t){Fc(n,this._hostClassName)}drainQueuedTransitions(n){const t=[];return this._queue.forEach(s=>{const c=s.player;if(c.destroyed)return;const u=s.element,p=this._elementListeners.get(u);p&&p.forEach(_=>{if(_.name==s.triggerName){const E=Q6(u,s.triggerName,s.fromState.value,s.toState.value);E._data=n,Z6(s.player,_.phase,E,_.callback)}}),c.markedForDestroy?this._engine.afterFlush(()=>{c.destroy()}):t.push(s)}),this._queue=[],t.sort((s,c)=>{const u=s.transition.ast.depCount,p=c.transition.ast.depCount;return 0==u||0==p?u-p:this._engine.driver.containsElement(s.element,c.element)?1:-1})}destroy(n){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,n)}}class Y${_onRemovalComplete(n,t){this.onRemovalComplete(n,t)}constructor(n,t,s){this.bodyNode=n,this.driver=t,this._normalizer=s,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(c,u)=>{}}get queuedPlayers(){const n=[];return this._namespaceList.forEach(t=>{t.players.forEach(s=>{s.queued&&n.push(s)})}),n}createNamespace(n,t){const s=new q$(n,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(s,t):(this.newHostElements.set(t,s),this.collectEnterElement(t)),this._namespaceLookup[n]=s}_balanceNamespaceList(n,t){const s=this._namespaceList,c=this.namespacesByHostElement;if(s.length-1>=0){let p=!1,_=this.driver.getParentElement(t);for(;_;){const E=c.get(_);if(E){const S=s.indexOf(E);s.splice(S+1,0,n),p=!0;break}_=this.driver.getParentElement(_)}p||s.unshift(n)}else s.push(n);return c.set(t,n),n}register(n,t){let s=this._namespaceLookup[n];return s||(s=this.createNamespace(n,t)),s}registerTrigger(n,t,s){let c=this._namespaceLookup[n];c&&c.register(t,s)&&this.totalAnimations++}destroy(n,t){n&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{const s=this._fetchNamespace(n);this.namespacesByHostElement.delete(s.hostElement);const c=this._namespaceList.indexOf(s);c>=0&&this._namespaceList.splice(c,1),s.destroy(t),delete this._namespaceLookup[n]}))}_fetchNamespace(n){return this._namespaceLookup[n]}fetchNamespacesByElement(n){const t=new Set,s=this.statesByElement.get(n);if(s)for(let c of s.values())if(c.namespaceId){const u=this._fetchNamespace(c.namespaceId);u&&t.add(u)}return t}trigger(n,t,s,c){if(AU(t)){const u=this._fetchNamespace(n);if(u)return u.trigger(t,s,c),!0}return!1}insertNode(n,t,s,c){if(!AU(t))return;const u=t[zl];if(u&&u.setForRemoval){u.setForRemoval=!1,u.setForMove=!0;const p=this.collectedLeaveElements.indexOf(t);p>=0&&this.collectedLeaveElements.splice(p,1)}if(n){const p=this._fetchNamespace(n);p&&p.insertNode(t,s)}c&&this.collectEnterElement(t)}collectEnterElement(n){this.collectedEnterElements.push(n)}markElementAsDisabled(n,t){t?this.disabledNodes.has(n)||(this.disabledNodes.add(n),Fc(n,g8)):this.disabledNodes.has(n)&&(this.disabledNodes.delete(n),aT(n,g8))}removeNode(n,t,s){if(AU(t)){const c=n?this._fetchNamespace(n):null;c?c.removeNode(t,s):this.markElementAsRemoved(n,t,!1,s);const u=this.namespacesByHostElement.get(t);u&&u.id!==n&&u.removeNode(t,s)}else this._onRemovalComplete(t,s)}markElementAsRemoved(n,t,s,c,u){this.collectedLeaveElements.push(t),t[zl]={namespaceId:n,setForRemoval:c,hasAnimation:s,removedBeforeQueried:!1,previousTriggersValues:u}}listen(n,t,s,c,u){return AU(t)?this._fetchNamespace(n).listen(t,s,c,u):()=>{}}_buildInstruction(n,t,s,c,u){return n.transition.build(this.driver,n.element,n.fromState.value,n.toState.value,s,c,n.fromState.options,n.toState.options,t,u)}destroyInnerAnimations(n){let t=this.driver.query(n,yU,!0);t.forEach(s=>this.destroyActiveAnimationsForElement(s)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(n,o8,!0),t.forEach(s=>this.finishActiveQueriedAnimationOnElement(s)))}destroyActiveAnimationsForElement(n){const t=this.playersByElement.get(n);t&&t.forEach(s=>{s.queued?s.markedForDestroy=!0:s.destroy()})}finishActiveQueriedAnimationOnElement(n){const t=this.playersByQueriedElement.get(n);t&&t.forEach(s=>s.finish())}whenRenderingDone(){return new Promise(n=>{if(this.players.length)return vm(this.players).onDone(()=>n());n()})}processLeaveNode(n){const t=n[zl];if(t&&t.setForRemoval){if(n[zl]=b9,t.namespaceId){this.destroyInnerAnimations(n);const s=this._fetchNamespace(t.namespaceId);s&&s.clearElementCache(n)}this._onRemovalComplete(n,t.setForRemoval)}n.classList?.contains(g8)&&this.markElementAsDisabled(n,!1),this.driver.query(n,".ng-animate-disabled",!0).forEach(s=>{this.markElementAsDisabled(s,!1)})}flush(n=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((s,c)=>this._balanceNamespaceList(s,c)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let s=0;s<this.collectedEnterElements.length;s++)Fc(this.collectedEnterElements[s],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const s=[];try{t=this._flushAnimations(s,n)}finally{for(let c=0;c<s.length;c++)s[c]()}}else for(let s=0;s<this.collectedLeaveElements.length;s++)this.processLeaveNode(this.collectedLeaveElements[s]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(s=>s()),this._flushFns=[],this._whenQuietFns.length){const s=this._whenQuietFns;this._whenQuietFns=[],t.length?vm(t).onDone(()=>{s.forEach(c=>c())}):s.forEach(c=>c())}}reportError(n){throw function QY(){return new ae(3402,!1)}()}_flushAnimations(n,t){const s=new wU,c=[],u=new Map,p=[],_=new Map,E=new Map,S=new Map,w=new Set;this.disabledNodes.forEach(We=>{w.add(We);const dt=this.driver.query(We,".ng-animate-queued",!0);for(let bt=0;bt<dt.length;bt++)w.add(dt[bt])});const D=this.bodyNode,U=Array.from(this.statesByElement.keys()),V=T9(U,this.collectedEnterElements),H=new Map;let z=0;V.forEach((We,dt)=>{const bt=i8+z++;H.set(dt,bt),We.forEach(Ln=>Fc(Ln,bt))});const Q=[],ie=new Set,ne=new Set;for(let We=0;We<this.collectedLeaveElements.length;We++){const dt=this.collectedLeaveElements[We],bt=dt[zl];bt&&bt.setForRemoval&&(Q.push(dt),ie.add(dt),bt.hasAnimation?this.driver.query(dt,".ng-star-inserted",!0).forEach(Ln=>ie.add(Ln)):ne.add(dt))}const ke=new Map,Ge=T9(U,Array.from(ie));Ge.forEach((We,dt)=>{const bt=vU+z++;ke.set(dt,bt),We.forEach(Ln=>Fc(Ln,bt))}),n.push(()=>{V.forEach((We,dt)=>{const bt=H.get(dt);We.forEach(Ln=>aT(Ln,bt))}),Ge.forEach((We,dt)=>{const bt=ke.get(dt);We.forEach(Ln=>aT(Ln,bt))}),Q.forEach(We=>{this.processLeaveNode(We)})});const jt=[],cn=[];for(let We=this._namespaceList.length-1;We>=0;We--)this._namespaceList[We].drainQueuedTransitions(t).forEach(bt=>{const Ln=bt.player,Eo=bt.element;if(jt.push(Ln),this.collectedEnterElements.length){const fs=Eo[zl];if(fs&&fs.setForMove){if(fs.previousTriggersValues&&fs.previousTriggersValues.has(bt.triggerName)){const SE=fs.previousTriggersValues.get(bt.triggerName),Bc=this.statesByElement.get(bt.element);if(Bc&&Bc.has(bt.triggerName)){const cV=Bc.get(bt.triggerName);cV.value=SE,Bc.set(bt.triggerName,cV)}}return void Ln.destroy()}}const hu=!D||!this.driver.containsElement(D,Eo),tc=ke.get(Eo),wm=H.get(Eo),ni=this._buildInstruction(bt,s,wm,tc,hu);if(ni.errors&&ni.errors.length)return void cn.push(ni);if(hu)return Ln.onStart(()=>dE(Eo,ni.fromStyles)),Ln.onDestroy(()=>lu(Eo,ni.toStyles)),void c.push(Ln);if(bt.isFallbackTransition)return Ln.onStart(()=>dE(Eo,ni.fromStyles)),Ln.onDestroy(()=>lu(Eo,ni.toStyles)),void c.push(Ln);const Gq=[];ni.timelines.forEach(fs=>{fs.stretchStartingKeyframe=!0,this.disabledNodes.has(fs.element)||Gq.push(fs)}),ni.timelines=Gq,s.append(Eo,ni.timelines),p.push({instruction:ni,player:Ln,element:Eo}),ni.queriedElements.forEach(fs=>Ja(_,fs,[]).push(Ln)),ni.preStyleProps.forEach((fs,SE)=>{if(fs.size){let Bc=E.get(SE);Bc||E.set(SE,Bc=new Set),fs.forEach((cV,NG)=>Bc.add(NG))}}),ni.postStyleProps.forEach((fs,SE)=>{let Bc=S.get(SE);Bc||S.set(SE,Bc=new Set),fs.forEach((cV,NG)=>Bc.add(NG))})});if(cn.length){const We=[];cn.forEach(dt=>{We.push(function e$(){return new ae(3505,!1)}())}),jt.forEach(dt=>dt.destroy()),this.reportError(We)}const An=new Map,Ii=new Map;p.forEach(We=>{const dt=We.element;s.has(dt)&&(Ii.set(dt,dt),this._beforeAnimationBuild(We.player.namespaceId,We.instruction,An))}),c.forEach(We=>{const dt=We.element;this._getPreviousPlayers(dt,!1,We.namespaceId,We.triggerName,null).forEach(Ln=>{Ja(An,dt,[]).push(Ln),Ln.destroy()})});const uu=Q.filter(We=>I9(We,E,S)),gT=new Map;C9(gT,this.driver,ne,S,Jh).forEach(We=>{I9(We,E,S)&&uu.push(We)});const bE=new Map;V.forEach((We,dt)=>{C9(bE,this.driver,new Set(We),E,"!")}),uu.forEach(We=>{const dt=gT.get(We),bt=bE.get(We);gT.set(We,new Map([...dt?.entries()??[],...bt?.entries()??[]]))});const OG=[],jq=[],Hq={};p.forEach(We=>{const{element:dt,player:bt,instruction:Ln}=We;if(s.has(dt)){if(w.has(dt))return bt.onDestroy(()=>lu(dt,Ln.toStyles)),bt.disabled=!0,bt.overrideTotalTime(Ln.totalTime),void c.push(bt);let Eo=Hq;if(Ii.size>1){let tc=dt;const wm=[];for(;tc=tc.parentNode;){const ni=Ii.get(tc);if(ni){Eo=ni;break}wm.push(tc)}wm.forEach(ni=>Ii.set(ni,Eo))}const hu=this._buildAnimation(bt.namespaceId,Ln,An,u,bE,gT);if(bt.setRealPlayer(hu),Eo===Hq)OG.push(bt);else{const tc=this.playersByElement.get(Eo);tc&&tc.length&&(bt.parentPlayer=vm(tc)),c.push(bt)}}else dE(dt,Ln.fromStyles),bt.onDestroy(()=>lu(dt,Ln.toStyles)),jq.push(bt),w.has(dt)&&c.push(bt)}),jq.forEach(We=>{const dt=u.get(We.element);if(dt&&dt.length){const bt=vm(dt);We.setRealPlayer(bt)}}),c.forEach(We=>{We.parentPlayer?We.syncPlayerEvents(We.parentPlayer):We.destroy()});for(let We=0;We<Q.length;We++){const dt=Q[We],bt=dt[zl];if(aT(dt,vU),bt&&bt.hasAnimation)continue;let Ln=[];if(_.size){let hu=_.get(dt);hu&&hu.length&&Ln.push(...hu);let tc=this.driver.query(dt,o8,!0);for(let wm=0;wm<tc.length;wm++){let ni=_.get(tc[wm]);ni&&ni.length&&Ln.push(...ni)}}const Eo=Ln.filter(hu=>!hu.destroyed);Eo.length?J$(this,dt,Eo):this.processLeaveNode(dt)}return Q.length=0,OG.forEach(We=>{this.players.push(We),We.onDone(()=>{We.destroy();const dt=this.players.indexOf(We);this.players.splice(dt,1)}),We.play()}),OG}afterFlush(n){this._flushFns.push(n)}afterFlushAnimationsDone(n){this._whenQuietFns.push(n)}_getPreviousPlayers(n,t,s,c,u){let p=[];if(t){const _=this.playersByQueriedElement.get(n);_&&(p=_)}else{const _=this.playersByElement.get(n);if(_){const E=!u||u==VO;_.forEach(S=>{S.queued||!E&&S.triggerName!=c||p.push(S)})}}return(s||c)&&(p=p.filter(_=>!(s&&s!=_.namespaceId||c&&c!=_.triggerName))),p}_beforeAnimationBuild(n,t,s){const u=t.element,p=t.isRemovalTransition?void 0:n,_=t.isRemovalTransition?void 0:t.triggerName;for(const E of t.timelines){const S=E.element,w=S!==u,D=Ja(s,S,[]);this._getPreviousPlayers(S,w,p,_,t.toState).forEach(V=>{const H=V.getRealPlayer();H.beforeDestroy&&H.beforeDestroy(),V.destroy(),D.push(V)})}dE(u,t.fromStyles)}_buildAnimation(n,t,s,c,u,p){const _=t.triggerName,E=t.element,S=[],w=new Set,D=new Set,U=t.timelines.map(H=>{const z=H.element;w.add(z);const Q=z[zl];if(Q&&Q.removedBeforeQueried)return new xO(H.duration,H.delay);const ie=z!==E,ne=function Q$(e){const n=[];return w9(e,n),n}((s.get(z)||z$).map(An=>An.getRealPlayer())).filter(An=>!!An.element&&An.element===z),ke=u.get(z),Ge=p.get(z),jt=n9(this._normalizer,H.keyframes,ke,Ge),cn=this._buildPlayer(H,jt,ne);if(H.subTimeline&&c&&D.add(z),ie){const An=new E8(n,_,z);An.setRealPlayer(cn),S.push(An)}return cn});S.forEach(H=>{Ja(this.playersByQueriedElement,H.element,[]).push(H),H.onDone(()=>function $$(e,n,t){let s=e.get(n);if(s){if(s.length){const c=s.indexOf(t);s.splice(c,1)}0==s.length&&e.delete(n)}return s}(this.playersByQueriedElement,H.element,H))}),w.forEach(H=>Fc(H,c9));const V=vm(U);return V.onDestroy(()=>{w.forEach(H=>aT(H,c9)),lu(E,t.toStyles)}),D.forEach(H=>{Ja(c,H,[]).push(V)}),V}_buildPlayer(n,t,s){return t.length>0?this.driver.animate(n.element,t,n.duration,n.delay,n.easing,s):new xO(n.duration,n.delay)}}class E8{constructor(n,t,s){this.namespaceId=n,this.triggerName=t,this.element=s,this._player=new xO,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(n){this._containsRealPlayer||(this._player=n,this._queuedCallbacks.forEach((t,s)=>{t.forEach(c=>Z6(n,s,void 0,c))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(n.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(n){this.totalTime=n}syncPlayerEvents(n){const t=this._player;t.triggerCallback&&n.onStart(()=>t.triggerCallback("start")),n.onDone(()=>this.finish()),n.onDestroy(()=>this.destroy())}_queueEvent(n,t){Ja(this._queuedCallbacks,n,[]).push(t)}onDone(n){this.queued&&this._queueEvent("done",n),this._player.onDone(n)}onStart(n){this.queued&&this._queueEvent("start",n),this._player.onStart(n)}onDestroy(n){this.queued&&this._queueEvent("destroy",n),this._player.onDestroy(n)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(n){this.queued||this._player.setPosition(n)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(n){const t=this._player;t.triggerCallback&&t.triggerCallback(n)}}function AU(e){return e&&1===e.nodeType}function S9(e,n){const t=e.style.display;return e.style.display=n??"none",t}function C9(e,n,t,s,c){const u=[];t.forEach(E=>u.push(S9(E)));const p=[];s.forEach((E,S)=>{const w=new Map;E.forEach(D=>{const U=n.computeStyle(S,D,c);w.set(D,U),(!U||0==U.length)&&(S[zl]=K$,p.push(S))}),e.set(S,w)});let _=0;return t.forEach(E=>S9(E,u[_++])),p}function T9(e,n){const t=new Map;if(e.forEach(_=>t.set(_,[])),0==n.length)return t;const c=new Set(n),u=new Map;function p(_){if(!_)return 1;let E=u.get(_);if(E)return E;const S=_.parentNode;return E=t.has(S)?S:c.has(S)?1:p(S),u.set(_,E),E}return n.forEach(_=>{const E=p(_);1!==E&&t.get(E).push(_)}),t}function Fc(e,n){e.classList?.add(n)}function aT(e,n){e.classList?.remove(n)}function J$(e,n,t){vm(t).onDone(()=>e.processLeaveNode(n))}function w9(e,n){for(let t=0;t<e.length;t++){const s=e[t];s instanceof e9?w9(s.players,n):n.push(s)}}function I9(e,n,t){const s=t.get(e);if(!s)return!1;let c=n.get(e);return c?s.forEach(u=>c.add(u)):n.set(e,s),t.delete(e),!0}class BO{constructor(n,t,s){this._driver=t,this._normalizer=s,this._triggerCache={},this.onRemovalComplete=(c,u)=>{},this._transitionEngine=new Y$(n.body,t,s),this._timelineEngine=new B$(n.body,t,s),this._transitionEngine.onRemovalComplete=(c,u)=>this.onRemovalComplete(c,u)}registerTrigger(n,t,s,c,u){const p=n+"-"+c;let _=this._triggerCache[p];if(!_){const E=[],w=d8(this._driver,u,E,[]);if(E.length)throw function GY(){return new ae(3404,!1)}();_=function x$(e,n,t){return new F$(e,n,t)}(c,w,this._normalizer),this._triggerCache[p]=_}this._transitionEngine.registerTrigger(t,c,_)}register(n,t){this._transitionEngine.register(n,t)}destroy(n,t){this._transitionEngine.destroy(n,t)}onInsert(n,t,s,c){this._transitionEngine.insertNode(n,t,s,c)}onRemove(n,t,s){this._transitionEngine.removeNode(n,t,s)}disableAnimations(n,t){this._transitionEngine.markElementAsDisabled(n,t)}process(n,t,s,c){if("@"==s.charAt(0)){const[u,p]=r9(s);this._timelineEngine.command(u,t,p,c)}else this._transitionEngine.trigger(n,t,s,c)}listen(n,t,s,c,u){if("@"==s.charAt(0)){const[p,_]=r9(s);return this._timelineEngine.listen(p,t,_,u)}return this._transitionEngine.listen(n,t,s,c,u)}flush(n=-1){this._transitionEngine.flush(n)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(n){this._transitionEngine.afterFlushAnimationsDone(n)}}class jO{static{this.initialStylesByElement=new WeakMap}constructor(n,t,s){this._element=n,this._startStyles=t,this._endStyles=s,this._state=0;let c=jO.initialStylesByElement.get(n);c||jO.initialStylesByElement.set(n,c=new Map),this._initialStyles=c}start(){this._state<1&&(this._startStyles&&lu(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(lu(this._element,this._initialStyles),this._endStyles&&(lu(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(jO.initialStylesByElement.delete(this._element),this._startStyles&&(dE(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(dE(this._element,this._endStyles),this._endStyles=null),lu(this._element,this._initialStyles),this._state=3)}}function y8(e){let n=null;return e.forEach((t,s)=>{(function nX(e){return"display"===e||"position"===e})(s)&&(n=n||new Map,n.set(s,t))}),n}class R9{constructor(n,t,s,c){this.element=n,this.keyframes=t,this.options=s,this._specialStyles=c,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=s.duration,this._delay=s.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(n=>n()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const n=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,n,this.options),this._finalKeyframe=n.length?n[n.length-1]:new Map;const t=()=>this._onFinish();this.domPlayer.addEventListener("finish",t),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",t)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(n){const t=[];return n.forEach(s=>{t.push(Object.fromEntries(s))}),t}_triggerWebAnimation(n,t,s){return n.animate(this._convertKeyframesToObject(t),s)}onStart(n){this._originalOnStartFns.push(n),this._onStartFns.push(n)}onDone(n){this._originalOnDoneFns.push(n),this._onDoneFns.push(n)}onDestroy(n){this._onDestroyFns.push(n)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(n=>n()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(n=>n()),this._onDestroyFns=[])}setPosition(n){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=n*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const n=new Map;this.hasStarted()&&this._finalKeyframe.forEach((s,c)=>{"offset"!==c&&n.set(c,this._finished?s:l8(this.element,c))}),this.currentSnapshot=n}triggerCallback(n){const t="start"===n?this._onStartFns:this._onDoneFns;t.forEach(s=>s()),t.length=0}}class A9{validateStyleProperty(n){return!0}validateAnimatableStyleProperty(n){return!0}containsElement(n,t){return o9(n,t)}getParentElement(n){return e8(n)}query(n,t,s){return s9(n,t,s)}computeStyle(n,t,s){return l8(n,t)}animate(n,t,s,c,u,p=[]){const E={duration:s,delay:c,fill:0==c?"both":"forwards"};u&&(E.easing=u);const S=new Map,w=p.filter(V=>V instanceof R9);(function p$(e,n){return 0===e||0===n})(s,c)&&w.forEach(V=>{V.currentSnapshot.forEach((H,z)=>S.set(z,H))});let D=function d$(e){return e.length?e[0]instanceof Map?e:e.map(n=>new Map(Object.entries(n))):[]}(t).map(V=>new Map(V));D=function f$(e,n,t){if(t.size&&n.length){let s=n[0],c=[];if(t.forEach((u,p)=>{s.has(p)||c.push(p),s.set(p,u)}),c.length)for(let u=1;u<n.length;u++){let p=n[u];c.forEach(_=>p.set(_,l8(e,_)))}}return n}(n,D,S);const U=function tX(e,n){let t=null,s=null;return Array.isArray(n)&&n.length?(t=y8(n[0]),n.length>1&&(s=y8(n[n.length-1]))):n instanceof Map&&(t=y8(n)),t||s?new jO(e,t,s):null}(n,D);return new R9(n,D,E,U)}}const D9="@.disabled";class O9{constructor(n,t,s,c){this.namespaceId=n,this.delegate=t,this.engine=s,this._onDestroy=c,this.\u0275type=0}get data(){return this.delegate.data}destroyNode(n){this.delegate.destroyNode?.(n)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(n,t){return this.delegate.createElement(n,t)}createComment(n){return this.delegate.createComment(n)}createText(n){return this.delegate.createText(n)}appendChild(n,t){this.delegate.appendChild(n,t),this.engine.onInsert(this.namespaceId,t,n,!1)}insertBefore(n,t,s,c=!0){this.delegate.insertBefore(n,t,s),this.engine.onInsert(this.namespaceId,t,n,c)}removeChild(n,t,s){this.parentNode(t)&&this.engine.onRemove(this.namespaceId,t,this.delegate)}selectRootElement(n,t){return this.delegate.selectRootElement(n,t)}parentNode(n){return this.delegate.parentNode(n)}nextSibling(n){return this.delegate.nextSibling(n)}setAttribute(n,t,s,c){this.delegate.setAttribute(n,t,s,c)}removeAttribute(n,t,s){this.delegate.removeAttribute(n,t,s)}addClass(n,t){this.delegate.addClass(n,t)}removeClass(n,t){this.delegate.removeClass(n,t)}setStyle(n,t,s,c){this.delegate.setStyle(n,t,s,c)}removeStyle(n,t,s){this.delegate.removeStyle(n,t,s)}setProperty(n,t,s){"@"==t.charAt(0)&&t==D9?this.disableAnimations(n,!!s):this.delegate.setProperty(n,t,s)}setValue(n,t){this.delegate.setValue(n,t)}listen(n,t,s){return this.delegate.listen(n,t,s)}disableAnimations(n,t){this.engine.disableAnimations(n,t)}}class rX extends O9{constructor(n,t,s,c,u){super(t,s,c,u),this.factory=n,this.namespaceId=t}setProperty(n,t,s){"@"==t.charAt(0)?"."==t.charAt(1)&&t==D9?this.disableAnimations(n,s=void 0===s||!!s):this.engine.process(this.namespaceId,n,t.slice(1),s):this.delegate.setProperty(n,t,s)}listen(n,t,s){if("@"==t.charAt(0)){const c=function iX(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(n);let u=t.slice(1),p="";return"@"!=u.charAt(0)&&([u,p]=function oX(e){const n=e.indexOf(".");return[e.substring(0,n),e.slice(n+1)]}(u)),this.engine.listen(this.namespaceId,c,u,p,_=>{this.factory.scheduleListenerCallback(_._data||-1,s,_)})}return this.delegate.listen(n,t,s)}}class sX{constructor(n,t,s){this.delegate=n,this.engine=t,this._zone=s,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,t.onRemovalComplete=(c,u)=>{u?.removeChild(null,c)}}createRenderer(n,t){const c=this.delegate.createRenderer(n,t);if(!n||!t?.data?.animation){const S=this._rendererCache;let w=S.get(c);return w||(w=new O9("",c,this.engine,()=>S.delete(c)),S.set(c,w)),w}const u=t.id,p=t.id+"-"+this._currentId;this._currentId++,this.engine.register(p,n);const _=S=>{Array.isArray(S)?S.forEach(_):this.engine.registerTrigger(u,p,n,S.name,S)};return t.data.animation.forEach(_),new rX(this,p,c,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(n,t,s){if(n>=0&&n<this._microtaskId)return void this._zone.run(()=>t(s));const c=this._animationCallbacksBuffer;0==c.length&&queueMicrotask(()=>{this._zone.run(()=>{c.forEach(u=>{const[p,_]=u;p(_)}),this._animationCallbacksBuffer=[]})}),c.push([t,s])}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}const dX=[{provide:n8,useFactory:()=>new A9},{provide:nl,useValue:"BrowserAnimations"},...[{provide:r8,useFactory:function cX(){return new u9}},{provide:BO,useClass:(()=>{class e extends BO{constructor(t,s,c){super(t,s,c)}ngOnDestroy(){this.flush()}static{this.\u0275fac=function(s){return new(s||e)(ye(Ve),ye(n8),ye(r8))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac})}}return e})()},{provide:Lb,useFactory:function lX(e,n,t){return new sX(e,n,t)},deps:[IC,BO,ft]}]];var pX=Im(372),fX=Im.n(pX);function Li(e){return"function"==typeof e}function P9(e){const t=e(s=>{Error.call(s),s.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const b8=P9(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((s,c)=>`${c+1}) ${s.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function OU(e,n){if(e){const t=e.indexOf(n);0<=t&&e.splice(t,1)}}class Kl{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const u of t)u.remove(this);else t.remove(this);const{initialTeardown:s}=this;if(Li(s))try{s()}catch(u){n=u instanceof b8?u.errors:[u]}const{_finalizers:c}=this;if(c){this._finalizers=null;for(const u of c)try{L9(u)}catch(p){n=n??[],p instanceof b8?n=[...n,...p.errors]:n.push(p)}}if(n)throw new b8(n)}}add(n){var t;if(n&&n!==this)if(this.closed)L9(n);else{if(n instanceof Kl){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(n)}}_hasParent(n){const{_parentage:t}=this;return t===n||Array.isArray(t)&&t.includes(n)}_addParent(n){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(n),t):t?[t,n]:n}_removeParent(n){const{_parentage:t}=this;t===n?this._parentage=null:Array.isArray(t)&&OU(t,n)}remove(n){const{_finalizers:t}=this;t&&OU(t,n),n instanceof Kl&&n._removeParent(this)}}Kl.EMPTY=(()=>{const e=new Kl;return e.closed=!0,e})();const M9=Kl.EMPTY;function k9(e){return e instanceof Kl||e&&"closed"in e&&Li(e.remove)&&Li(e.add)&&Li(e.unsubscribe)}function L9(e){Li(e)?e():e.unsubscribe()}const hE={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},NU={setTimeout(e,n,...t){const{delegate:s}=NU;return s?.setTimeout?s.setTimeout(e,n,...t):setTimeout(e,n,...t)},clearTimeout(e){const{delegate:n}=NU;return(n?.clearTimeout||clearTimeout)(e)},delegate:void 0};function x9(e){NU.setTimeout(()=>{const{onUnhandledError:n}=hE;if(!n)throw e;n(e)})}function S8(){}const mX=C8("C",void 0,void 0);function C8(e,n,t){return{kind:e,value:n,error:t}}let pE=null;function PU(e){if(hE.useDeprecatedSynchronousErrorHandling){const n=!pE;if(n&&(pE={errorThrown:!1,error:null}),e(),n){const{errorThrown:t,error:s}=pE;if(pE=null,t)throw s}}else e()}class T8 extends Kl{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,k9(n)&&n.add(this)):this.destination=SX}static create(n,t,s){return new I8(n,t,s)}next(n){this.isStopped?R8(function _X(e){return C8("N",e,void 0)}(n),this):this._next(n)}error(n){this.isStopped?R8(function gX(e){return C8("E",void 0,e)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?R8(mX,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const EX=Function.prototype.bind;function w8(e,n){return EX.call(e,n)}class yX{constructor(n){this.partialObserver=n}next(n){const{partialObserver:t}=this;if(t.next)try{t.next(n)}catch(s){MU(s)}}error(n){const{partialObserver:t}=this;if(t.error)try{t.error(n)}catch(s){MU(s)}else MU(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(t){MU(t)}}}class I8 extends T8{constructor(n,t,s){let c;if(super(),Li(n)||!n)c={next:n??void 0,error:t??void 0,complete:s??void 0};else{let u;this&&hE.useDeprecatedNextContext?(u=Object.create(n),u.unsubscribe=()=>this.unsubscribe(),c={next:n.next&&w8(n.next,u),error:n.error&&w8(n.error,u),complete:n.complete&&w8(n.complete,u)}):c=n}this.destination=new yX(c)}}function MU(e){hE.useDeprecatedSynchronousErrorHandling?function vX(e){hE.useDeprecatedSynchronousErrorHandling&&pE&&(pE.errorThrown=!0,pE.error=e)}(e):x9(e)}function R8(e,n){const{onStoppedNotification:t}=hE;t&&NU.setTimeout(()=>t(e,n))}const SX={closed:!0,next:S8,error:function bX(e){throw e},complete:S8},A8="function"==typeof Symbol&&Symbol.observable||"@@observable";function D8(e){return e}let ec=(()=>{class e{constructor(t){t&&(this._subscribe=t)}lift(t){const s=new e;return s.source=this,s.operator=t,s}subscribe(t,s,c){const u=function TX(e){return e&&e instanceof T8||function CX(e){return e&&Li(e.next)&&Li(e.error)&&Li(e.complete)}(e)&&k9(e)}(t)?t:new I8(t,s,c);return PU(()=>{const{operator:p,source:_}=this;u.add(p?p.call(u,_):_?this._subscribe(u):this._trySubscribe(u))}),u}_trySubscribe(t){try{return this._subscribe(t)}catch(s){t.error(s)}}forEach(t,s){return new(s=U9(s))((c,u)=>{const p=new I8({next:_=>{try{t(_)}catch(E){u(E),p.unsubscribe()}},error:u,complete:c});this.subscribe(p)})}_subscribe(t){var s;return null===(s=this.source)||void 0===s?void 0:s.subscribe(t)}[A8](){return this}pipe(...t){return function F9(e){return 0===e.length?D8:1===e.length?e[0]:function(t){return e.reduce((s,c)=>c(s),t)}}(t)(this)}toPromise(t){return new(t=U9(t))((s,c)=>{let u;this.subscribe(p=>u=p,p=>c(p),()=>s(u))})}}return e.create=n=>new e(n),e})();function U9(e){var n;return null!==(n=e??hE.Promise)&&void 0!==n?n:Promise}const wX=P9(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let HO=(()=>{class e extends ec{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const s=new V9(this,this);return s.operator=t,s}_throwIfClosed(){if(this.closed)throw new wX}next(t){PU(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const s of this.currentObservers)s.next(t)}})}error(t){PU(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:s}=this;for(;s.length;)s.shift().error(t)}})}complete(){PU(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:s,isStopped:c,observers:u}=this;return s||c?M9:(this.currentObservers=null,u.push(t),new Kl(()=>{this.currentObservers=null,OU(u,t)}))}_checkFinalizedStatuses(t){const{hasError:s,thrownError:c,isStopped:u}=this;s?t.error(c):u&&t.complete()}asObservable(){const t=new ec;return t.source=this,t}}return e.create=(n,t)=>new V9(n,t),e})();class V9 extends HO{constructor(n,t){super(),this.destination=n,this.source=t}next(n){var t,s;null===(s=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===s||s.call(t,n)}error(n){var t,s;null===(s=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===s||s.call(t,n)}complete(){var n,t;null===(t=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===t||t.call(n)}_subscribe(n){var t,s;return null!==(s=null===(t=this.source)||void 0===t?void 0:t.subscribe(n))&&void 0!==s?s:M9}}class B9 extends HO{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const t=super._subscribe(n);return!t.closed&&n.next(this._value),t}getValue(){const{hasError:n,thrownError:t,_value:s}=this;if(n)throw t;return this._throwIfClosed(),s}next(n){super.next(this._value=n)}}class IX extends Kl{constructor(n,t){super()}schedule(n,t=0){return this}}const kU={setInterval(e,n,...t){const{delegate:s}=kU;return s?.setInterval?s.setInterval(e,n,...t):setInterval(e,n,...t)},clearInterval(e){const{delegate:n}=kU;return(n?.clearInterval||clearInterval)(e)},delegate:void 0},j9={now:()=>(j9.delegate||Date).now(),delegate:void 0};class GO{constructor(n,t=GO.now){this.schedulerActionCtor=n,this.now=t}schedule(n,t=0,s){return new this.schedulerActionCtor(this,n).schedule(s,t)}}GO.now=j9.now;const O8=new class AX extends GO{constructor(n,t=GO.now){super(n,t),this.actions=[],this._active=!1}flush(n){const{actions:t}=this;if(this._active)return void t.push(n);let s;this._active=!0;do{if(s=n.execute(n.state,n.delay))break}while(n=t.shift());if(this._active=!1,s){for(;n=t.shift();)n.unsubscribe();throw s}}}(class RX extends IX{constructor(n,t){super(n,t),this.scheduler=n,this.work=t,this.pending=!1}schedule(n,t=0){var s;if(this.closed)return this;this.state=n;const c=this.id,u=this.scheduler;return null!=c&&(this.id=this.recycleAsyncId(u,c,t)),this.pending=!0,this.delay=t,this.id=null!==(s=this.id)&&void 0!==s?s:this.requestAsyncId(u,this.id,t),this}requestAsyncId(n,t,s=0){return kU.setInterval(n.flush.bind(n,this),s)}recycleAsyncId(n,t,s=0){if(null!=s&&this.delay===s&&!1===this.pending)return t;null!=t&&kU.clearInterval(t)}execute(n,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const s=this._execute(n,t);if(s)return s;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,t){let c,s=!1;try{this.work(n)}catch(u){s=!0,c=u||new Error("Scheduled action threw falsy error")}if(s)return this.unsubscribe(),c}unsubscribe(){if(!this.closed){const{id:n,scheduler:t}=this,{actions:s}=t;this.work=this.state=this.scheduler=null,this.pending=!1,OU(s,this),null!=n&&(this.id=this.recycleAsyncId(t,n,null)),this.delay=null,super.unsubscribe()}}}),DX=O8;function H9(e){return e&&Li(e.schedule)}function N8(e=0,n,t=DX){let s=-1;return null!=n&&(H9(n)?t=n:s=n),new ec(c=>{let u=function OX(e){return e instanceof Date&&!isNaN(e)}(e)?+e-t.now():e;u<0&&(u=0);let p=0;return t.schedule(function(){c.closed||(c.next(p++),0<=s?this.schedule(void 0,s):c.complete())},u)})}function P8(e=0,n=O8){return e<0&&(e=0),N8(e,e,n)}const G9=new ec(e=>e.complete());function Em(e){return n=>{if(function PX(e){return Li(e?.lift)}(n))return n.lift(function(t){try{return e(t,this)}catch(s){this.error(s)}});throw new TypeError("Unable to lift unknown Observable type")}}function ep(e,n,t,s,c){return new MX(e,n,t,s,c)}class MX extends T8{constructor(n,t,s,c,u,p){super(n),this.onFinalize=u,this.shouldUnsubscribe=p,this._next=t?function(_){try{t(_)}catch(E){n.error(E)}}:super._next,this._error=c?function(_){try{c(_)}catch(E){n.error(E)}finally{this.unsubscribe()}}:super._error,this._complete=s?function(){try{s()}catch(_){n.error(_)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function du(e){return e<=0?()=>G9:Em((n,t)=>{let s=0;n.subscribe(ep(t,c=>{++s<=e&&(t.next(c),e<=s&&t.complete())}))})}const W9={connected:!1,loading:!0,statusText:"Initializing",started:null,ended:!1,error:!1},kX={mode:"rtc",codec:"h264"};let z9=(()=>{class e{constructor(t){this.config=t,this.agoraRTC=fX(),this.streamState=new B9(W9),this.remoteStreamVideoToggle=new B9(!0),this.callEnd=new HO,this.localContainerId="local-video",this.remoteCalls=[],this.remoteStreamVideoToggle$=this.remoteStreamVideoToggle.asObservable(),this.streamState$=this.streamState.asObservable(),this.agoraRTC.checkSystemRequirements()||this.handleError(new Error("Web RTC is not supported in this browser"))}init(t,s,c,u=!1){return this.uid=t,this.agoraRTC.setLogLevel(u?0:4),this.client=this.agoraRTC.createClient(kX),this.assignClientHandlers(),this.initLocalStream().then(()=>{this.client.join(this.config.AppID,s,c||null,this.uid).then(()=>{this.localTracks.videoTrack.play(this.localContainerId),this.client.publish(Object.values(this.localTracks)),this.streamState.next({...this.streamState.value,connected:!0,statusText:"Waiting others to join"})}).catch(p=>this.handleError(p))}),this.callEnd.asObservable()}deinit(){this.streamState.next(W9)}endCall(){this.client.leave().then(()=>{this.stopLocalStream(),this.streamState.next({...this.streamState.value,started:null,loading:!0,statusText:"",ended:!0}),this.remoteCalls=[],P8(500).pipe(du(1)).subscribe(()=>this.callEnd.next())})}toggleVideo(t){this.localTracks&&this.localTracks.videoTrack.setMuted(t)}toggleAudio(t){this.localTracks&&this.localTracks.audioTrack.setMuted(t)}toggleFullScreen(t){t?document.exitFullscreen():document.documentElement.requestFullscreen()}isVideoEnabled(){return!!this.localTracks&&!this.localTracks.videoTrack.muted}isAudioEnabled(){return!!this.localTracks&&!this.localTracks.audioTrack.muted}assignClientHandlers(){this.client.on("user-joined",t=>{this.streamState.next({...this.streamState.value,started:Date.now(),loading:!1}),this.remoteCalls.length||this.remoteCalls.push(this.getRemoteId(t))}),this.client.on("user-published",(t,s)=>{const c=this.getRemoteId(t);this.client.subscribe(t,s).then(u=>{this.remoteCalls.includes(c)&&u.play(c)})}),this.client.on("user-info-updated",(t,s)=>{"mute-video"===s&&this.remoteStreamVideoToggle.next(!1),"unmute-video"===s&&this.remoteStreamVideoToggle.next(!0)}),this.client.on("user-left",()=>{this.endCall()})}initLocalStream(){return Promise.all([this.agoraRTC.createCameraVideoTrack(),this.agoraRTC.createMicrophoneAudioTrack()]).then(([t,s])=>{this.localTracks={audioTrack:s,videoTrack:t}}).catch(t=>{this.handleError(t)})}getRemoteId(t){return`remote_call-${t.uid}`}handleError(t){throw this.streamState.next({...this.streamState.value,statusText:t.message,error:!0}),this.stopLocalStream(),P8(5e3).pipe(du(1)).subscribe(()=>this.callEnd.next()),new Error(t.message)}stopLocalStream(){this.localTracks&&Object.values(this.localTracks).forEach(t=>{t.stop(),t.close()})}static{this.\u0275fac=function(s){return new(s||e)(ye("AgoraConfig"))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac})}}return e})();let q9=(()=>{class e{constructor(t,s){this._renderer=t,this._elementRef=s,this.onChange=c=>{},this.onTouched=()=>{}}setProperty(t,s){this._renderer.setProperty(this._elementRef.nativeElement,t,s)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static{this.\u0275fac=function(s){return new(s||e)(oe(_c),oe(On))}}static{this.\u0275dir=Ue({type:e})}}return e})(),fE=(()=>{class e extends q9{static{this.\u0275fac=(()=>{let t;return function(c){return(t||(t=yn(e)))(c||e)}})()}static{this.\u0275dir=Ue({type:e,features:[tn]})}}return e})();const ql=new Te(""),UX={provide:ql,useExisting:Fn(()=>LU),multi:!0},BX=new Te("");let LU=(()=>{class e extends q9{constructor(t,s,c){super(t,s),this._compositionMode=c,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function VX(){const e=Dl()?Dl().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(t){this.setProperty("value",t??"")}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static{this.\u0275fac=function(s){return new(s||e)(oe(_c),oe(On),oe(BX,8))}}static{this.\u0275dir=Ue({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(s,c){1&s&&Mn("input",function(p){return c._handleInput(p.target.value)})("blur",function(){return c.onTouched()})("compositionstart",function(){return c._compositionStart()})("compositionend",function(p){return c._compositionEnd(p.target.value)})},features:[mn([UX]),tn]})}}return e})();function ym(e){return null==e||("string"==typeof e||Array.isArray(e))&&0===e.length}function $9(e){return null!=e&&"number"==typeof e.length}const vo=new Te(""),bm=new Te(""),jX=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class X9{static min(n){return function Z9(e){return n=>{if(ym(n.value)||ym(e))return null;const t=parseFloat(n.value);return!isNaN(t)&&t<e?{min:{min:e,actual:n.value}}:null}}(n)}static max(n){return function J9(e){return n=>{if(ym(n.value)||ym(e))return null;const t=parseFloat(n.value);return!isNaN(t)&&t>e?{max:{max:e,actual:n.value}}:null}}(n)}static required(n){return function Q9(e){return ym(e.value)?{required:!0}:null}(n)}static requiredTrue(n){return function e7(e){return!0===e.value?null:{required:!0}}(n)}static email(n){return function t7(e){return ym(e.value)||jX.test(e.value)?null:{email:!0}}(n)}static minLength(n){return function n7(e){return n=>ym(n.value)||!$9(n.value)?null:n.value.length<e?{minlength:{requiredLength:e,actualLength:n.value.length}}:null}(n)}static maxLength(n){return function r7(e){return n=>$9(n.value)&&n.value.length>e?{maxlength:{requiredLength:e,actualLength:n.value.length}}:null}(n)}static pattern(n){return function i7(e){if(!e)return xU;let n,t;return"string"==typeof e?(t="","^"!==e.charAt(0)&&(t+="^"),t+=e,"$"!==e.charAt(e.length-1)&&(t+="$"),n=new RegExp(t)):(t=e.toString(),n=e),s=>{if(ym(s.value))return null;const c=s.value;return n.test(c)?null:{pattern:{requiredPattern:t,actualValue:c}}}}(n)}static nullValidator(n){return null}static compose(n){return d7(n)}static composeAsync(n){return u7(n)}}function xU(e){return null}function o7(e){return null!=e}function s7(e){return Z_(e)?ki(e):e}function a7(e){let n={};return e.forEach(t=>{n=null!=t?{...n,...t}:n}),0===Object.keys(n).length?null:n}function c7(e,n){return n.map(t=>t(e))}function l7(e){return e.map(n=>function HX(e){return!e.validate}(n)?n:t=>n.validate(t))}function d7(e){if(!e)return null;const n=e.filter(o7);return 0==n.length?null:function(t){return a7(c7(t,n))}}function M8(e){return null!=e?d7(l7(e)):null}function u7(e){if(!e)return null;const n=e.filter(o7);return 0==n.length?null:function(t){return function xX(...e){const n=BC(e),{args:t,keys:s}=jF(e),c=new nr(u=>{const{length:p}=t;if(!p)return void u.complete();const _=new Array(p);let E=p,S=p;for(let w=0;w<p;w++){let D=!1;go(t[w]).subscribe(Er(u,U=>{D||(D=!0,S--),_[w]=U},()=>E--,void 0,()=>{(!E||!D)&&(S||u.next(s?Si(s,_):_),u.complete())}))}});return n?c.pipe(dO(n)):c}(c7(t,n).map(s7)).pipe(en(a7))}}function k8(e){return null!=e?u7(l7(e)):null}function h7(e,n){return null===e?[n]:Array.isArray(e)?[...e,n]:[e,n]}function p7(e){return e._rawValidators}function f7(e){return e._rawAsyncValidators}function L8(e){return e?Array.isArray(e)?e:[e]:[]}function FU(e,n){return Array.isArray(e)?e.includes(n):e===n}function m7(e,n){const t=L8(n);return L8(e).forEach(c=>{FU(t,c)||t.push(c)}),t}function g7(e,n){return L8(n).filter(t=>!FU(e,t))}class _7{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=M8(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=k8(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,t){return!!this.control&&this.control.hasError(n,t)}getError(n,t){return this.control?this.control.getError(n,t):null}}class xs extends _7{get formDirective(){return null}get path(){return null}}class tp extends _7{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class v7{constructor(n){this._cd=n}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}}let E7=(()=>{class e extends v7{constructor(t){super(t)}static{this.\u0275fac=function(s){return new(s||e)(oe(tp,2))}}static{this.\u0275dir=Ue({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(s,c){2&s&&nt("ng-untouched",c.isUntouched)("ng-touched",c.isTouched)("ng-pristine",c.isPristine)("ng-dirty",c.isDirty)("ng-valid",c.isValid)("ng-invalid",c.isInvalid)("ng-pending",c.isPending)},features:[tn]})}}return e})(),y7=(()=>{class e extends v7{constructor(t){super(t)}static{this.\u0275fac=function(s){return new(s||e)(oe(xs,10))}}static{this.\u0275dir=Ue({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(s,c){2&s&&nt("ng-untouched",c.isUntouched)("ng-touched",c.isTouched)("ng-pristine",c.isPristine)("ng-dirty",c.isDirty)("ng-valid",c.isValid)("ng-invalid",c.isInvalid)("ng-pending",c.isPending)("ng-submitted",c.isSubmitted)},features:[tn]})}}return e})();const WO="VALID",VU="INVALID",cT="PENDING",zO="DISABLED";class lT{}class S7 extends lT{constructor(n,t){super(),this.value=n,this.source=t}}class U8 extends lT{constructor(n,t){super(),this.pristine=n,this.source=t}}class V8 extends lT{constructor(n,t){super(),this.touched=n,this.source=t}}class BU extends lT{constructor(n,t){super(),this.status=n,this.source=t}}class qX extends lT{constructor(n){super(),this.source=n}}class YX extends lT{constructor(n){super(),this.source=n}}function B8(e){return(jU(e)?e.validators:e)||null}function j8(e,n){return(jU(n)?n.asyncValidators:e)||null}function jU(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}function C7(e,n,t){const s=e.controls;if(!(n?Object.keys(s):s).length)throw new ae(1e3,"");if(!s[t])throw new ae(1001,"")}function T7(e,n,t){e._forEachChild((s,c)=>{if(void 0===t[c])throw new ae(1002,"")})}class HU{constructor(n,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=jd(()=>this.statusReactive()),this.statusReactive=Ed(void 0),this._pristine=jd(()=>this.pristineReactive()),this.pristineReactive=Ed(!0),this._touched=jd(()=>this.touchedReactive()),this.touchedReactive=Ed(!1),this._events=new Gt,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(n),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get status(){return Qs(this.statusReactive)}set status(n){Qs(()=>this.statusReactive.set(n))}get valid(){return this.status===WO}get invalid(){return this.status===VU}get pending(){return this.status==cT}get disabled(){return this.status===zO}get enabled(){return this.status!==zO}get pristine(){return Qs(this.pristineReactive)}set pristine(n){Qs(()=>this.pristineReactive.set(n))}get dirty(){return!this.pristine}get touched(){return Qs(this.touchedReactive)}set touched(n){Qs(()=>this.touchedReactive.set(n))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(m7(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(m7(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(g7(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(g7(n,this._rawAsyncValidators))}hasValidator(n){return FU(this._rawValidators,n)}hasAsyncValidator(n){return FU(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){const t=!1===this.touched;this.touched=!0;const s=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsTouched({...n,sourceControl:s}),t&&!1!==n.emitEvent&&this._events.next(new V8(!0,s))}markAllAsTouched(n={}){this.markAsTouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(n))}markAsUntouched(n={}){const t=!0===this.touched;this.touched=!1,this._pendingTouched=!1;const s=n.sourceControl??this;this._forEachChild(c=>{c.markAsUntouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:s})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,s),t&&!1!==n.emitEvent&&this._events.next(new V8(!1,s))}markAsDirty(n={}){const t=!0===this.pristine;this.pristine=!1;const s=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsDirty({...n,sourceControl:s}),t&&!1!==n.emitEvent&&this._events.next(new U8(!1,s))}markAsPristine(n={}){const t=!1===this.pristine;this.pristine=!0,this._pendingDirty=!1;const s=n.sourceControl??this;this._forEachChild(c=>{c.markAsPristine({onlySelf:!0,emitEvent:n.emitEvent})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n,s),t&&!1!==n.emitEvent&&this._events.next(new U8(!0,s))}markAsPending(n={}){this.status=cT;const t=n.sourceControl??this;!1!==n.emitEvent&&(this._events.next(new BU(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.markAsPending({...n,sourceControl:t})}disable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=zO,this.errors=null,this._forEachChild(c=>{c.disable({...n,onlySelf:!0})}),this._updateValue();const s=n.sourceControl??this;!1!==n.emitEvent&&(this._events.next(new S7(this.value,s)),this._events.next(new BU(this.status,s)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...n,skipPristineCheck:t},this),this._onDisabledChange.forEach(c=>c(!0))}enable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=WO,this._forEachChild(s=>{s.enable({...n,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors({...n,skipPristineCheck:t},this),this._onDisabledChange.forEach(s=>s(!1))}_updateAncestors(n,t){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){const s=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===WO||this.status===cT)&&this._runAsyncValidator(s,n.emitEvent)}const t=n.sourceControl??this;!1!==n.emitEvent&&(this._events.next(new S7(this.value,t)),this._events.next(new BU(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity({...n,sourceControl:t})}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?zO:WO}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n,t){if(this.asyncValidator){this.status=cT,this._hasOwnPendingAsyncValidator={emitEvent:!1!==t};const s=s7(this.asyncValidator(this));this._asyncValidationSubscription=s.subscribe(c=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(c,{emitEvent:t,shouldHaveEmitted:n})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();const n=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,n}return!1}setErrors(n,t={}){this.errors=n,this._updateControlsErrors(!1!==t.emitEvent,this,t.shouldHaveEmitted)}get(n){let t=n;return null==t||(Array.isArray(t)||(t=t.split(".")),0===t.length)?null:t.reduce((s,c)=>s&&s._find(c),this)}getError(n,t){const s=t?this.get(t):this;return s&&s.errors?s.errors[n]:null}hasError(n,t){return!!this.getError(n,t)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n,t,s){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),(n||s)&&this._events.next(new BU(this.status,t)),this._parent&&this._parent._updateControlsErrors(n,t,s)}_initObservables(){this.valueChanges=new Dn,this.statusChanges=new Dn}_calculateStatus(){return this._allControlsDisabled()?zO:this.errors?VU:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(cT)?cT:this._anyControlsHaveStatus(VU)?VU:WO}_anyControlsHaveStatus(n){return this._anyControls(t=>t.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n,t){const s=!this._anyControlsDirty(),c=this.pristine!==s;this.pristine=s,this._parent&&!n.onlySelf&&this._parent._updatePristine(n,t),c&&this._events.next(new U8(this.pristine,t))}_updateTouched(n={},t){this.touched=this._anyControlsTouched(),this._events.next(new V8(this.touched,t)),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,t)}_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){jU(n)&&null!=n.updateOn&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){return!n&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=function $X(e){return Array.isArray(e)?M8(e):e||null}(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=function XX(e){return Array.isArray(e)?k8(e):e||null}(this._rawAsyncValidators)}}class KO extends HU{constructor(n,t,s){super(B8(t),j8(s,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(n,t){return this.controls[n]?this.controls[n]:(this.controls[n]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(n,t,s={}){this.registerControl(n,t),this.updateValueAndValidity({emitEvent:s.emitEvent}),this._onCollectionChange()}removeControl(n,t={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(n,t,s={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],t&&this.registerControl(n,t),this.updateValueAndValidity({emitEvent:s.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,t={}){T7(this,0,n),Object.keys(n).forEach(s=>{C7(this,!0,s),this.controls[s].setValue(n[s],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){null!=n&&(Object.keys(n).forEach(s=>{const c=this.controls[s];c&&c.patchValue(n[s],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n={},t={}){this._forEachChild((s,c)=>{s.reset(n?n[c]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(n,t,s)=>(n[s]=t.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(t,s)=>!!s._syncPendingControls()||t);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(t=>{const s=this.controls[t];s&&n(s,t)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(const[t,s]of Object.entries(this.controls))if(this.contains(t)&&n(s))return!0;return!1}_reduceValue(){return this._reduceChildren({},(t,s,c)=>((s.enabled||this.disabled)&&(t[c]=s.value),t))}_reduceChildren(n,t){let s=n;return this._forEachChild((c,u)=>{s=t(s,c,u)}),s}_allControlsDisabled(){for(const n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}}class w7 extends KO{}const dT=new Te("CallSetDisabledState",{providedIn:"root",factory:()=>GU}),GU="always";function qO(e,n,t=GU){H8(e,n),n.valueAccessor.writeValue(e.value),(e.disabled||"always"===t)&&n.valueAccessor.setDisabledState?.(e.disabled),function JX(e,n){n.valueAccessor.registerOnChange(t=>{e._pendingValue=t,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&I7(e,n)})}(e,n),function eZ(e,n){const t=(s,c)=>{n.valueAccessor.writeValue(s),c&&n.viewToModelUpdate(s)};e.registerOnChange(t),n._registerOnDestroy(()=>{e._unregisterOnChange(t)})}(e,n),function QX(e,n){n.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&I7(e,n),"submit"!==e.updateOn&&e.markAsTouched()})}(e,n),function ZX(e,n){if(n.valueAccessor.setDisabledState){const t=s=>{n.valueAccessor.setDisabledState(s)};e.registerOnDisabledChange(t),n._registerOnDestroy(()=>{e._unregisterOnDisabledChange(t)})}}(e,n)}function zU(e,n,t=!0){const s=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(s),n.valueAccessor.registerOnTouched(s)),qU(e,n),e&&(n._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function KU(e,n){e.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(n)})}function H8(e,n){const t=p7(e);null!==n.validator?e.setValidators(h7(t,n.validator)):"function"==typeof t&&e.setValidators([t]);const s=f7(e);null!==n.asyncValidator?e.setAsyncValidators(h7(s,n.asyncValidator)):"function"==typeof s&&e.setAsyncValidators([s]);const c=()=>e.updateValueAndValidity();KU(n._rawValidators,c),KU(n._rawAsyncValidators,c)}function qU(e,n){let t=!1;if(null!==e){if(null!==n.validator){const c=p7(e);if(Array.isArray(c)&&c.length>0){const u=c.filter(p=>p!==n.validator);u.length!==c.length&&(t=!0,e.setValidators(u))}}if(null!==n.asyncValidator){const c=f7(e);if(Array.isArray(c)&&c.length>0){const u=c.filter(p=>p!==n.asyncValidator);u.length!==c.length&&(t=!0,e.setAsyncValidators(u))}}}const s=()=>{};return KU(n._rawValidators,s),KU(n._rawAsyncValidators,s),t}function I7(e,n){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function R7(e,n){H8(e,n)}function A7(e,n){e._syncPendingControls(),n.forEach(t=>{const s=t.control;"submit"===s.updateOn&&s._pendingChange&&(t.viewToModelUpdate(s._pendingValue),s._pendingChange=!1)})}const oZ={provide:xs,useExisting:Fn(()=>YU)},YO=Promise.resolve();let YU=(()=>{class e extends xs{get submitted(){return Qs(this.submittedReactive)}constructor(t,s,c){super(),this.callSetDisabledState=c,this._submitted=jd(()=>this.submittedReactive()),this.submittedReactive=Ed(!1),this._directives=new Set,this.ngSubmit=new Dn,this.form=new KO({},M8(t),k8(s))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){YO.then(()=>{const s=this._findContainer(t.path);t.control=s.registerControl(t.name,t.control),qO(t.control,t,this.callSetDisabledState),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){YO.then(()=>{const s=this._findContainer(t.path);s&&s.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){YO.then(()=>{const s=this._findContainer(t.path),c=new KO({});R7(c,t),s.registerControl(t.name,c),c.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){YO.then(()=>{const s=this._findContainer(t.path);s&&s.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,s){YO.then(()=>{this.form.get(t.path).setValue(s)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submittedReactive.set(!0),A7(this.form,this._directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}static{this.\u0275fac=function(s){return new(s||e)(oe(vo,10),oe(bm,10),oe(dT,8))}}static{this.\u0275dir=Ue({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(s,c){1&s&&Mn("submit",function(p){return c.onSubmit(p)})("reset",function(){return c.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[mn([oZ]),tn]})}}return e})();function D7(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}function O7(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const $O=class extends HU{constructor(n=null,t,s){super(B8(t),j8(s,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(n),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),jU(t)&&(t.nonNullable||t.initialValueIsDefault)&&(this.defaultValue=O7(n)?n.value:n)}setValue(n,t={}){this.value=this._pendingValue=n,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(s=>s(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(n,t={}){this.setValue(n,t)}reset(n=this.defaultValue,t={}){this._applyFormState(n),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){D7(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){D7(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(n){O7(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}};Promise.resolve();let L7=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275dir=Ue({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}}return e})();const K8=new Te(""),fZ={provide:xs,useExisting:Fn(()=>XO)};let XO=(()=>{class e extends xs{get submitted(){return Qs(this._submittedReactive)}set submitted(t){this._submittedReactive.set(t)}constructor(t,s,c){super(),this.callSetDisabledState=c,this._submitted=jd(()=>this._submittedReactive()),this._submittedReactive=Ed(!1),this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Dn,this._setValidators(t),this._setAsyncValidators(s)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(qU(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){const s=this.form.get(t.path);return qO(s,t,this.callSetDisabledState),s.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),s}getControl(t){return this.form.get(t.path)}removeControl(t){zU(t.control||null,t,!1),function iZ(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,s){this.form.get(t.path).setValue(s)}onSubmit(t){return this._submittedReactive.set(!0),A7(this.form,this.directives),this.ngSubmit.emit(t),this.form._events.next(new qX(this.control)),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this._submittedReactive.set(!1),this.form._events.next(new YX(this.form))}_updateDomValue(){this.directives.forEach(t=>{const s=t.control,c=this.form.get(t.path);s!==c&&(zU(s||null,t),(e=>e instanceof $O)(c)&&(qO(c,t,this.callSetDisabledState),t.control=c))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){const s=this.form.get(t.path);R7(s,t),s.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){const s=this.form.get(t.path);s&&function tZ(e,n){return qU(e,n)}(s,t)&&s.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){H8(this.form,this),this._oldForm&&qU(this._oldForm,this)}_checkFormPresent(){}static{this.\u0275fac=function(s){return new(s||e)(oe(vo,10),oe(bm,10),oe(dT,8))}}static{this.\u0275dir=Ue({type:e,selectors:[["","formGroup",""]],hostBindings:function(s,c){1&s&&Mn("submit",function(p){return c.onSubmit(p)})("reset",function(){return c.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[mn([fZ]),tn,$o]})}}return e})();const _Z={provide:tp,useExisting:Fn(()=>$8)};let $8=(()=>{class e extends tp{set isDisabled(t){}static{this._ngModelWarningSentOnce=!1}constructor(t,s,c,u,p){super(),this._ngModelWarningConfig=p,this._added=!1,this.name=null,this.update=new Dn,this._ngModelWarningSent=!1,this._parent=t,this._setValidators(s),this._setAsyncValidators(c),this.valueAccessor=function z8(e,n){if(!n)return null;let t,s,c;return Array.isArray(n),n.forEach(u=>{u.constructor===LU?t=u:function rZ(e){return Object.getPrototypeOf(e.constructor)===fE}(u)?s=u:c=u}),c||s||t||null}(0,u)}ngOnChanges(t){this._added||this._setUpControl(),function W8(e,n){if(!e.hasOwnProperty("model"))return!1;const t=e.model;return!!t.isFirstChange()||!Object.is(n,t.currentValue)}(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return function WU(e,n){return[...n.path,e]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}static{this.\u0275fac=function(s){return new(s||e)(oe(xs,13),oe(vo,10),oe(bm,10),oe(ql,10),oe(K8,8))}}static{this.\u0275dir=Ue({type:e,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[mn([_Z]),tn,$o]})}}return e})(),PZ=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=ii({type:e})}static{this.\u0275inj=qr({})}}return e})();class Z7 extends HU{constructor(n,t,s){super(B8(t),j8(s,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(n){return this.controls[this._adjustIndex(n)]}push(n,t={}){this.controls.push(n),this._registerControl(n),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(n,t,s={}){this.controls.splice(n,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:s.emitEvent})}removeAt(n,t={}){let s=this._adjustIndex(n);s<0&&(s=0),this.controls[s]&&this.controls[s]._registerOnCollectionChange(()=>{}),this.controls.splice(s,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(n,t,s={}){let c=this._adjustIndex(n);c<0&&(c=0),this.controls[c]&&this.controls[c]._registerOnCollectionChange(()=>{}),this.controls.splice(c,1),t&&(this.controls.splice(c,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:s.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,t={}){T7(this,0,n),n.forEach((s,c)=>{C7(this,!1,c),this.at(c).setValue(s,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){null!=n&&(n.forEach((s,c)=>{this.at(c)&&this.at(c).patchValue(s,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n=[],t={}){this._forEachChild((s,c)=>{s.reset(n[c],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(n=>n.getRawValue())}clear(n={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_adjustIndex(n){return n<0?n+this.length:n}_syncPendingControls(){let n=this.controls.reduce((t,s)=>!!s._syncPendingControls()||t,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){this.controls.forEach((t,s)=>{n(t,s)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(t=>t.enabled&&n(t))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_allControlsDisabled(){for(const n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}_find(n){return this.at(n)??null}}function J7(e){return!!e&&(void 0!==e.asyncValidators||void 0!==e.validators||void 0!==e.updateOn)}let eG,MZ=(()=>{class e{constructor(){this.useNonNullable=!1}get nonNullable(){const t=new e;return t.useNonNullable=!0,t}group(t,s=null){const c=this._reduceControls(t);let u={};return J7(s)?u=s:null!==s&&(u.validators=s.validator,u.asyncValidators=s.asyncValidator),new KO(c,u)}record(t,s=null){const c=this._reduceControls(t);return new w7(c,s)}control(t,s,c){let u={};return this.useNonNullable?(J7(s)?u=s:(u.validators=s,u.asyncValidators=c),new $O(t,{...u,nonNullable:!0})):new $O(t,s,c)}array(t,s,c){const u=t.map(p=>this._createControl(p));return new Z7(u,s,c)}_reduceControls(t){const s={};return Object.keys(t).forEach(c=>{s[c]=this._createControl(t[c])}),s}_createControl(t){return t instanceof $O||t instanceof HU?t:Array.isArray(t)?this.control(t[0],t.length>1?t[1]:null,t.length>2?t[2]:null):this.control(t)}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),kZ=(()=>{class e extends MZ{group(t,s=null){return super.group(t,s)}control(t,s,c){return super.control(t,s,c)}array(t,s,c){return super.array(t,s,c)}static{this.\u0275fac=(()=>{let t;return function(c){return(t||(t=yn(e)))(c||e)}})()}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),LZ=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:K8,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:dT,useValue:t.callSetDisabledState??GU}]}}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=ii({type:e})}static{this.\u0275inj=qr({imports:[PZ]})}}return e})();try{eG=typeof Intl<"u"&&Intl.v8BreakIterator}catch{eG=!1}let uT,jo=(()=>{class e{constructor(t){this._platformId=t,this.isBrowser=this._platformId?function gH(e){return e===Ml}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!eG)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}static{this.\u0275fac=function(s){return new(s||e)(ye(pd))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const Q7=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function eK(){if(uT)return uT;if("object"!=typeof document||!document)return uT=new Set(Q7),uT;let e=document.createElement("input");return uT=new Set(Q7.filter(n=>(e.setAttribute("type",n),e.type===n))),uT}let ZO,gE,tG;function hT(e){return function xZ(){if(null==ZO&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>ZO=!0}))}finally{ZO=ZO||!1}return ZO}()?e:!!e.capture}function FZ(){if(null==gE){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return gE=!1,gE;if("scrollBehavior"in document.documentElement.style)gE=!0;else{const e=Element.prototype.scrollTo;gE=!!e&&!/\{\s*\[native code\]\s*\}/.test(e.toString())}}return gE}function np(e){return e.composedPath?e.composedPath()[0]:e.target}function nG(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}class oJ extends Ur{constructor(n,t){super()}schedule(n,t=0){return this}}const XU={setInterval(e,n,...t){const{delegate:s}=XU;return s?.setInterval?s.setInterval(e,n,...t):setInterval(e,n,...t)},clearInterval(e){const{delegate:n}=XU;return(n?.clearInterval||clearInterval)(e)},delegate:void 0};class rG extends oJ{constructor(n,t){super(n,t),this.scheduler=n,this.work=t,this.pending=!1}schedule(n,t=0){var s;if(this.closed)return this;this.state=n;const c=this.id,u=this.scheduler;return null!=c&&(this.id=this.recycleAsyncId(u,c,t)),this.pending=!0,this.delay=t,this.id=null!==(s=this.id)&&void 0!==s?s:this.requestAsyncId(u,this.id,t),this}requestAsyncId(n,t,s=0){return XU.setInterval(n.flush.bind(n,this),s)}recycleAsyncId(n,t,s=0){if(null!=s&&this.delay===s&&!1===this.pending)return t;null!=t&&XU.clearInterval(t)}execute(n,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const s=this._execute(n,t);if(s)return s;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,t){let c,s=!1;try{this.work(n)}catch(u){s=!0,c=u||new Error("Scheduled action threw falsy error")}if(s)return this.unsubscribe(),c}unsubscribe(){if(!this.closed){const{id:n,scheduler:t}=this,{actions:s}=t;this.work=this.state=this.scheduler=null,this.pending=!1,NE(s,this),null!=n&&(this.id=this.recycleAsyncId(t,n,null)),this.delay=null,super.unsubscribe()}}}const iG={now:()=>(iG.delegate||Date).now(),delegate:void 0};class QO{constructor(n,t=QO.now){this.schedulerActionCtor=n,this.now=t}schedule(n,t=0,s){return new this.schedulerActionCtor(this,n).schedule(s,t)}}QO.now=iG.now;class oG extends QO{constructor(n,t=QO.now){super(n,t),this.actions=[],this._active=!1}flush(n){const{actions:t}=this;if(this._active)return void t.push(n);let s;this._active=!0;do{if(s=n.execute(n.state,n.delay))break}while(n=t.shift());if(this._active=!1,s){for(;n=t.shift();)n.unsubscribe();throw s}}}const sG=new oG(rG),sJ=sG;function rK(e){return Ns((n,t)=>e<=t)}function cJ(e,n){return e===n}let lJ=(()=>{class e{create(t){return typeof MutationObserver>"u"?null:new MutationObserver(t)}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),oK=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=ii({type:e})}static{this.\u0275inj=qr({providers:[lJ]})}}return e})();function pT(e){return null!=e&&"false"!=`${e}`}function sK(e,n=0){return function dJ(e){return!isNaN(parseFloat(e))&&!isNaN(Number(e))}(e)?Number(e):2===arguments.length?n:0}function ZU(e){return Array.isArray(e)?e:[e]}function xi(e){return null==e?"":"string"==typeof e?e:`${e}px`}function Sm(e){return e instanceof On?e.nativeElement:e}const aK=new Set;let _E,uJ=(()=>{class e{constructor(t,s){this._platform=t,this._nonce=s,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):pJ}matchMedia(t){return(this._platform.WEBKIT||this._platform.BLINK)&&function hJ(e,n){if(!aK.has(e))try{_E||(_E=document.createElement("style"),n&&_E.setAttribute("nonce",n),_E.setAttribute("type","text/css"),document.head.appendChild(_E)),_E.sheet&&(_E.sheet.insertRule(`@media ${e} {body{ }}`,0),aK.add(e))}catch(t){console.error(t)}}(t,this._nonce),this._matchMedia(t)}static{this.\u0275fac=function(s){return new(s||e)(ye(jo),ye(ew,8))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function pJ(e){return{matches:"all"===e||""===e,media:e,addListener:()=>{},removeListener:()=>{}}}let fJ=(()=>{class e{constructor(t,s){this._mediaMatcher=t,this._zone=s,this._queries=new Map,this._destroySubject=new Gt}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(t){return cK(ZU(t)).some(c=>this._registerQuery(c).mql.matches)}observe(t){let u=Fl(cK(ZU(t)).map(p=>this._registerQuery(p).observable));return u=Ha(u.pipe(Wa(1)),u.pipe(rK(1),function nK(e,n=sG){return Cr((t,s)=>{let c=null,u=null,p=null;const _=()=>{if(c){c.unsubscribe(),c=null;const S=u;u=null,s.next(S)}};function E(){const S=p+e,w=n.now();if(w<S)return c=this.schedule(void 0,S-w),void s.add(c);_()}t.subscribe(Er(s,S=>{u=S,p=n.now(),c||(c=n.schedule(E,e),s.add(c))},()=>{_(),s.complete()},void 0,()=>{u=c=null}))})}(0))),u.pipe(en(p=>{const _={matches:!1,breakpoints:{}};return p.forEach(({matches:E,query:S})=>{_.matches=_.matches||E,_.breakpoints[S]=E}),_}))}_registerQuery(t){if(this._queries.has(t))return this._queries.get(t);const s=this._mediaMatcher.matchMedia(t),u={observable:new nr(p=>{const _=E=>this._zone.run(()=>p.next(E));return s.addListener(_),()=>{s.removeListener(_)}}).pipe(WF(s),en(({matches:p})=>({query:t,matches:p})),Ci(this._destroySubject)),mql:s};return this._queries.set(t,u),u}static{this.\u0275fac=function(s){return new(s||e)(ye(uJ),ye(ft))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function cK(e){return e.map(n=>n.split(",")).reduce((n,t)=>n.concat(t)).map(n=>n.trim())}function JU(e,n){return e.getAttribute(n)?.match(/\S+/g)??[]}const dK="cdk-describedby-message",QU="cdk-describedby-host";let aG=0,_J=(()=>{class e{constructor(t,s){this._platform=s,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+aG++,this._document=t,this._id=me(Gp)+"-"+aG++}describe(t,s,c){if(!this._canBeDescribed(t,s))return;const u=cG(s,c);"string"!=typeof s?(uK(s,this._id),this._messageRegistry.set(u,{messageElement:s,referenceCount:0})):this._messageRegistry.has(u)||this._createMessageElement(s,c),this._isElementDescribedByMessage(t,u)||this._addMessageReference(t,u)}removeDescription(t,s,c){if(!s||!this._isElementNode(t))return;const u=cG(s,c);if(this._isElementDescribedByMessage(t,u)&&this._removeMessageReference(t,u),"string"==typeof s){const p=this._messageRegistry.get(u);p&&0===p.referenceCount&&this._deleteMessageElement(u)}0===this._messagesContainer?.childNodes.length&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){const t=this._document.querySelectorAll(`[${QU}="${this._id}"]`);for(let s=0;s<t.length;s++)this._removeCdkDescribedByReferenceIds(t[s]),t[s].removeAttribute(QU);this._messagesContainer?.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(t,s){const c=this._document.createElement("div");uK(c,this._id),c.textContent=t,s&&c.setAttribute("role",s),this._createMessagesContainer(),this._messagesContainer.appendChild(c),this._messageRegistry.set(cG(t,s),{messageElement:c,referenceCount:0})}_deleteMessageElement(t){this._messageRegistry.get(t)?.messageElement?.remove(),this._messageRegistry.delete(t)}_createMessagesContainer(){if(this._messagesContainer)return;const t="cdk-describedby-message-container",s=this._document.querySelectorAll(`.${t}[platform="server"]`);for(let u=0;u<s.length;u++)s[u].remove();const c=this._document.createElement("div");c.style.visibility="hidden",c.classList.add(t),c.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&c.setAttribute("platform","server"),this._document.body.appendChild(c),this._messagesContainer=c}_removeCdkDescribedByReferenceIds(t){const s=JU(t,"aria-describedby").filter(c=>0!=c.indexOf(dK));t.setAttribute("aria-describedby",s.join(" "))}_addMessageReference(t,s){const c=this._messageRegistry.get(s);(function mJ(e,n,t){const s=JU(e,n);t=t.trim(),!s.some(c=>c.trim()===t)&&(s.push(t),e.setAttribute(n,s.join(" ")))})(t,"aria-describedby",c.messageElement.id),t.setAttribute(QU,this._id),c.referenceCount++}_removeMessageReference(t,s){const c=this._messageRegistry.get(s);c.referenceCount--,function gJ(e,n,t){const s=JU(e,n);t=t.trim();const c=s.filter(u=>u!==t);c.length?e.setAttribute(n,c.join(" ")):e.removeAttribute(n)}(t,"aria-describedby",c.messageElement.id),t.removeAttribute(QU)}_isElementDescribedByMessage(t,s){const c=JU(t,"aria-describedby"),u=this._messageRegistry.get(s),p=u&&u.messageElement.id;return!!p&&-1!=c.indexOf(p)}_canBeDescribed(t,s){if(!this._isElementNode(t))return!1;if(s&&"object"==typeof s)return!0;const c=null==s?"":`${s}`.trim(),u=t.getAttribute("aria-label");return!(!c||u&&u.trim()===c)}_isElementNode(t){return t.nodeType===this._document.ELEMENT_NODE}static{this.\u0275fac=function(s){return new(s||e)(ye(Ve),ye(jo))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function cG(e,n){return"string"==typeof e?`${n||""}/${e}`:e}function uK(e,n){e.id||(e.id=`${dK}-${n}-${aG++}`)}function gK(e){return 0===e.buttons||0===e.detail}function _K(e){const n=e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0];return!(!n||-1!==n.identifier||null!=n.radiusX&&1!==n.radiusX||null!=n.radiusY&&1!==n.radiusY)}const DJ=new Te("cdk-input-modality-detector-options"),OJ={ignoreKeys:[18,17,224,91,16]},fT=hT({passive:!0,capture:!0});let NJ=(()=>{class e{get mostRecentModality(){return this._modality.value}constructor(t,s,c,u){this._platform=t,this._mostRecentTarget=null,this._modality=new gs(null),this._lastTouchMs=0,this._onKeydown=p=>{this._options?.ignoreKeys?.some(_=>_===p.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=np(p))},this._onMousedown=p=>{Date.now()-this._lastTouchMs<650||(this._modality.next(gK(p)?"keyboard":"mouse"),this._mostRecentTarget=np(p))},this._onTouchstart=p=>{_K(p)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=np(p))},this._options={...OJ,...u},this.modalityDetected=this._modality.pipe(rK(1)),this.modalityChanged=this.modalityDetected.pipe(function aJ(e,n=Ql){return e=e??cJ,Cr((t,s)=>{let c,u=!0;t.subscribe(Er(s,p=>{const _=n(p);(u||!e(c,_))&&(u=!1,c=_,s.next(p))}))})}()),t.isBrowser&&s.runOutsideAngular(()=>{c.addEventListener("keydown",this._onKeydown,fT),c.addEventListener("mousedown",this._onMousedown,fT),c.addEventListener("touchstart",this._onTouchstart,fT)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,fT),document.removeEventListener("mousedown",this._onMousedown,fT),document.removeEventListener("touchstart",this._onTouchstart,fT))}static{this.\u0275fac=function(s){return new(s||e)(ye(jo),ye(ft),ye(Ve),ye(DJ,8))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var eV=function(e){return e[e.IMMEDIATE=0]="IMMEDIATE",e[e.EVENTUAL=1]="EVENTUAL",e}(eV||{});const MJ=new Te("cdk-focus-monitor-default-options"),tV=hT({passive:!0,capture:!0});let lG=(()=>{class e{constructor(t,s,c,u,p){this._ngZone=t,this._platform=s,this._inputModalityDetector=c,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new Gt,this._rootNodeFocusAndBlurListener=_=>{for(let S=np(_);S;S=S.parentElement)"focus"===_.type?this._onFocus(_,S):this._onBlur(_,S)},this._document=u,this._detectionMode=p?.detectionMode||eV.IMMEDIATE}monitor(t,s=!1){const c=Sm(t);if(!this._platform.isBrowser||1!==c.nodeType)return Et();const u=function VZ(e){if(function UZ(){if(null==tG){const e=typeof document<"u"?document.head:null;tG=!(!e||!e.createShadowRoot&&!e.attachShadow)}return tG}()){const n=e.getRootNode?e.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&n instanceof ShadowRoot)return n}return null}(c)||this._getDocument(),p=this._elementInfo.get(c);if(p)return s&&(p.checkChildren=!0),p.subject;const _={checkChildren:s,subject:new Gt,rootNode:u};return this._elementInfo.set(c,_),this._registerGlobalListeners(_),_.subject}stopMonitoring(t){const s=Sm(t),c=this._elementInfo.get(s);c&&(c.subject.complete(),this._setClasses(s),this._elementInfo.delete(s),this._removeGlobalListeners(c))}focusVia(t,s,c){const u=Sm(t);u===this._getDocument().activeElement?this._getClosestElementsInfo(u).forEach(([_,E])=>this._originChanged(_,s,E)):(this._setOrigin(s),"function"==typeof u.focus&&u.focus(c))}ngOnDestroy(){this._elementInfo.forEach((t,s)=>this.stopMonitoring(s))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(t){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(t)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:t&&this._isLastInteractionFromInputLabel(t)?"mouse":"program"}_shouldBeAttributedToTouch(t){return this._detectionMode===eV.EVENTUAL||!!t?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(t,s){t.classList.toggle("cdk-focused",!!s),t.classList.toggle("cdk-touch-focused","touch"===s),t.classList.toggle("cdk-keyboard-focused","keyboard"===s),t.classList.toggle("cdk-mouse-focused","mouse"===s),t.classList.toggle("cdk-program-focused","program"===s)}_setOrigin(t,s=!1){this._ngZone.runOutsideAngular(()=>{this._origin=t,this._originFromTouchInteraction="touch"===t&&s,this._detectionMode===eV.IMMEDIATE&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(t,s){const c=this._elementInfo.get(s),u=np(t);!c||!c.checkChildren&&s!==u||this._originChanged(s,this._getFocusOrigin(u),c)}_onBlur(t,s){const c=this._elementInfo.get(s);!c||c.checkChildren&&t.relatedTarget instanceof Node&&s.contains(t.relatedTarget)||(this._setClasses(s),this._emitOrigin(c,null))}_emitOrigin(t,s){t.subject.observers.length&&this._ngZone.run(()=>t.subject.next(s))}_registerGlobalListeners(t){if(!this._platform.isBrowser)return;const s=t.rootNode,c=this._rootNodeFocusListenerCount.get(s)||0;c||this._ngZone.runOutsideAngular(()=>{s.addEventListener("focus",this._rootNodeFocusAndBlurListener,tV),s.addEventListener("blur",this._rootNodeFocusAndBlurListener,tV)}),this._rootNodeFocusListenerCount.set(s,c+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Ci(this._stopInputModalityDetector)).subscribe(u=>{this._setOrigin(u,!0)}))}_removeGlobalListeners(t){const s=t.rootNode;if(this._rootNodeFocusListenerCount.has(s)){const c=this._rootNodeFocusListenerCount.get(s);c>1?this._rootNodeFocusListenerCount.set(s,c-1):(s.removeEventListener("focus",this._rootNodeFocusAndBlurListener,tV),s.removeEventListener("blur",this._rootNodeFocusAndBlurListener,tV),this._rootNodeFocusListenerCount.delete(s))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(t,s,c){this._setClasses(t,s),this._emitOrigin(c,s),this._lastFocusOrigin=s}_getClosestElementsInfo(t){const s=[];return this._elementInfo.forEach((c,u)=>{(u===t||c.checkChildren&&u.contains(t))&&s.push([u,c])}),s}_isLastInteractionFromInputLabel(t){const{_mostRecentTarget:s,mostRecentModality:c}=this._inputModalityDetector;if("mouse"!==c||!s||s===t||"INPUT"!==t.nodeName&&"TEXTAREA"!==t.nodeName||t.disabled)return!1;const u=t.labels;if(u)for(let p=0;p<u.length;p++)if(u[p].contains(s))return!0;return!1}static{this.\u0275fac=function(s){return new(s||e)(ye(ft),ye(jo),ye(NJ),ye(Ve,8),ye(MJ,8))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var vE=function(e){return e[e.NONE=0]="NONE",e[e.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",e[e.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",e}(vE||{});const EK="cdk-high-contrast-black-on-white",yK="cdk-high-contrast-white-on-black",dG="cdk-high-contrast-active";let bK=(()=>{class e{constructor(t,s){this._platform=t,this._document=s,this._breakpointSubscription=me(fJ).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return vE.NONE;const t=this._document.createElement("div");t.style.backgroundColor="rgb(1,2,3)",t.style.position="absolute",this._document.body.appendChild(t);const s=this._document.defaultView||window,c=s&&s.getComputedStyle?s.getComputedStyle(t):null,u=(c&&c.backgroundColor||"").replace(/ /g,"");switch(t.remove(),u){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return vE.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return vE.BLACK_ON_WHITE}return vE.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const t=this._document.body.classList;t.remove(dG,EK,yK),this._hasCheckedHighContrastMode=!0;const s=this.getHighContrastMode();s===vE.BLACK_ON_WHITE?t.add(dG,EK):s===vE.WHITE_ON_BLACK&&t.add(dG,yK)}}static{this.\u0275fac=function(s){return new(s||e)(ye(jo),ye(Ve))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),kJ=(()=>{class e{constructor(t){t._applyBodyHighContrastModeCssClasses()}static{this.\u0275fac=function(s){return new(s||e)(ye(bK))}}static{this.\u0275mod=ii({type:e})}static{this.\u0275inj=qr({imports:[oK]})}}return e})();const LJ=new Te("cdk-dir-doc",{providedIn:"root",factory:function xJ(){return me(Ve)}}),FJ=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let uG=(()=>{class e{constructor(t){this.value="ltr",this.change=new Dn,t&&(this.value=function UJ(e){const n=e?.toLowerCase()||"";return"auto"===n&&typeof navigator<"u"&&navigator?.language?FJ.test(navigator.language)?"rtl":"ltr":"rtl"===n?"rtl":"ltr"}((t.body?t.body.dir:null)||(t.documentElement?t.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}static{this.\u0275fac=function(s){return new(s||e)(ye(LJ,8))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),eN=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=ii({type:e})}static{this.\u0275inj=qr({})}}return e})();const VJ=["mat-internal-form-field",""],BJ=["*"],HJ=new Te("mat-sanity-checks",{providedIn:"root",factory:function jJ(){return!0}});let Uc=(()=>{class e{constructor(t,s,c){this._sanityChecks=s,this._document=c,this._hasDoneGlobalChecks=!1,t._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(t){return!nG()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[t])}static{this.\u0275fac=function(s){return new(s||e)(ye(bK),ye(HJ,8),ye(Ve))}}static{this.\u0275mod=ii({type:e})}static{this.\u0275inj=qr({imports:[eN,eN]})}}return e})();class TK{constructor(n,t,s,c,u){this._defaultMatcher=n,this.ngControl=t,this._parentFormGroup=s,this._parentForm=c,this._stateChanges=u,this.errorState=!1}updateErrorState(){const n=this.errorState,t=this._parentFormGroup||this._parentForm,s=this.matcher||this._defaultMatcher,c=this.ngControl?this.ngControl.control:null,u=s?.isErrorState(c,t)??!1;u!==n&&(this.errorState=u,this._stateChanges.next())}}let YJ=(()=>{class e{isErrorState(t,s){return!!(t&&t.invalid&&(t.touched||s&&s.submitted))}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var Vc=function(e){return e[e.FADING_IN=0]="FADING_IN",e[e.VISIBLE=1]="VISIBLE",e[e.FADING_OUT=2]="FADING_OUT",e[e.HIDDEN=3]="HIDDEN",e}(Vc||{});class $J{constructor(n,t,s,c=!1){this._renderer=n,this.element=t,this.config=s,this._animationForciblyDisabledThroughCss=c,this.state=Vc.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}}const wK=hT({passive:!0,capture:!0});class XJ{constructor(){this._events=new Map,this._delegateEventHandler=n=>{const t=np(n);t&&this._events.get(n.type)?.forEach((s,c)=>{(c===t||c.contains(t))&&s.forEach(u=>u.handleEvent(n))})}}addHandler(n,t,s,c){const u=this._events.get(t);if(u){const p=u.get(s);p?p.add(c):u.set(s,new Set([c]))}else this._events.set(t,new Map([[s,new Set([c])]])),n.runOutsideAngular(()=>{document.addEventListener(t,this._delegateEventHandler,wK)})}removeHandler(n,t,s){const c=this._events.get(n);if(!c)return;const u=c.get(t);u&&(u.delete(s),0===u.size&&c.delete(t),0===c.size&&(this._events.delete(n),document.removeEventListener(n,this._delegateEventHandler,wK)))}}const IK={enterDuration:225,exitDuration:150},RK=hT({passive:!0,capture:!0}),AK=["mousedown","touchstart"],DK=["mouseup","mouseleave","touchend","touchcancel"];class nV{static{this._eventManager=new XJ}constructor(n,t,s,c){this._target=n,this._ngZone=t,this._platform=c,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,c.isBrowser&&(this._containerElement=Sm(s))}fadeInRipple(n,t,s={}){const c=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),u={...IK,...s.animation};s.centered&&(n=c.left+c.width/2,t=c.top+c.height/2);const p=s.radius||function JJ(e,n,t){const s=Math.max(Math.abs(e-t.left),Math.abs(e-t.right)),c=Math.max(Math.abs(n-t.top),Math.abs(n-t.bottom));return Math.sqrt(s*s+c*c)}(n,t,c),_=n-c.left,E=t-c.top,S=u.enterDuration,w=document.createElement("div");w.classList.add("mat-ripple-element"),w.style.left=_-p+"px",w.style.top=E-p+"px",w.style.height=2*p+"px",w.style.width=2*p+"px",null!=s.color&&(w.style.backgroundColor=s.color),w.style.transitionDuration=`${S}ms`,this._containerElement.appendChild(w);const D=window.getComputedStyle(w),V=D.transitionDuration,H="none"===D.transitionProperty||"0s"===V||"0s, 0s"===V||0===c.width&&0===c.height,z=new $J(this,w,s,H);w.style.transform="scale3d(1, 1, 1)",z.state=Vc.FADING_IN,s.persistent||(this._mostRecentTransientRipple=z);let Q=null;return!H&&(S||u.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const ie=()=>{Q&&(Q.fallbackTimer=null),clearTimeout(ke),this._finishRippleTransition(z)},ne=()=>this._destroyRipple(z),ke=setTimeout(ne,S+100);w.addEventListener("transitionend",ie),w.addEventListener("transitioncancel",ne),Q={onTransitionEnd:ie,onTransitionCancel:ne,fallbackTimer:ke}}),this._activeRipples.set(z,Q),(H||!S)&&this._finishRippleTransition(z),z}fadeOutRipple(n){if(n.state===Vc.FADING_OUT||n.state===Vc.HIDDEN)return;const t=n.element,s={...IK,...n.config.animation};t.style.transitionDuration=`${s.exitDuration}ms`,t.style.opacity="0",n.state=Vc.FADING_OUT,(n._animationForciblyDisabledThroughCss||!s.exitDuration)&&this._finishRippleTransition(n)}fadeOutAll(){this._getActiveRipples().forEach(n=>n.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(n=>{n.config.persistent||n.fadeOut()})}setupTriggerEvents(n){const t=Sm(n);!this._platform.isBrowser||!t||t===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=t,AK.forEach(s=>{nV._eventManager.addHandler(this._ngZone,s,t,this)}))}handleEvent(n){"mousedown"===n.type?this._onMousedown(n):"touchstart"===n.type?this._onTouchStart(n):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{DK.forEach(t=>{this._triggerElement.addEventListener(t,this,RK)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(n){n.state===Vc.FADING_IN?this._startFadeOutTransition(n):n.state===Vc.FADING_OUT&&this._destroyRipple(n)}_startFadeOutTransition(n){const t=n===this._mostRecentTransientRipple,{persistent:s}=n.config;n.state=Vc.VISIBLE,!s&&(!t||!this._isPointerDown)&&n.fadeOut()}_destroyRipple(n){const t=this._activeRipples.get(n)??null;this._activeRipples.delete(n),this._activeRipples.size||(this._containerRect=null),n===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),n.state=Vc.HIDDEN,null!==t&&(n.element.removeEventListener("transitionend",t.onTransitionEnd),n.element.removeEventListener("transitioncancel",t.onTransitionCancel),null!==t.fallbackTimer&&clearTimeout(t.fallbackTimer)),n.element.remove()}_onMousedown(n){const t=gK(n),s=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!t&&!s&&(this._isPointerDown=!0,this.fadeInRipple(n.clientX,n.clientY,this._target.rippleConfig))}_onTouchStart(n){if(!this._target.rippleDisabled&&!_K(n)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const t=n.changedTouches;if(t)for(let s=0;s<t.length;s++)this.fadeInRipple(t[s].clientX,t[s].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(n=>{!n.config.persistent&&(n.state===Vc.VISIBLE||n.config.terminateOnPointerUp&&n.state===Vc.FADING_IN)&&n.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const n=this._triggerElement;n&&(AK.forEach(t=>nV._eventManager.removeHandler(t,n,this)),this._pointerUpEventsRegistered&&(DK.forEach(t=>n.removeEventListener(t,this,RK)),this._pointerUpEventsRegistered=!1))}}const OK=new Te("mat-ripple-global-options");let NK=(()=>{class e{get disabled(){return this._disabled}set disabled(t){t&&this.fadeOutAllNonPersistent(),this._disabled=t,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(t){this._trigger=t,this._setupTriggerEventsIfEnabled()}constructor(t,s,c,u,p){this._elementRef=t,this._animationMode=p,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=u||{},this._rippleRenderer=new nV(this,s,t,c)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:{...this._globalOptions.animation,..."NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{},...this.animation},terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(t,s=0,c){return"number"==typeof t?this._rippleRenderer.fadeInRipple(t,s,{...this.rippleConfig,...c}):this._rippleRenderer.fadeInRipple(0,0,{...this.rippleConfig,...t})}static{this.\u0275fac=function(s){return new(s||e)(oe(On),oe(ft),oe(jo),oe(OK,8),oe(nl,8))}}static{this.\u0275dir=Ue({type:e,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(s,c){2&s&&nt("mat-ripple-unbounded",c.unbounded)},inputs:{color:[0,"matRippleColor","color"],unbounded:[0,"matRippleUnbounded","unbounded"],centered:[0,"matRippleCentered","centered"],radius:[0,"matRippleRadius","radius"],animation:[0,"matRippleAnimation","animation"],disabled:[0,"matRippleDisabled","disabled"],trigger:[0,"matRippleTrigger","trigger"]},exportAs:["matRipple"],standalone:!0})}}return e})(),QJ=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=ii({type:e})}static{this.\u0275inj=qr({imports:[Uc,Uc]})}}return e})();const PK={capture:!0},MK=["focus","mousedown","mouseenter","touchstart"],hG="mat-ripple-loader-uninitialized",pG="mat-ripple-loader-class-name",kK="mat-ripple-loader-centered",rV="mat-ripple-loader-disabled";let eQ=(()=>{class e{constructor(){this._document=me(Ve,{optional:!0}),this._animationMode=me(nl,{optional:!0}),this._globalRippleOptions=me(OK,{optional:!0}),this._platform=me(jo),this._ngZone=me(ft),this._hosts=new Map,this._onInteraction=t=>{const s=np(t);if(s instanceof HTMLElement){const c=s.closest(`[${hG}="${this._globalRippleOptions?.namespace??""}"]`);c&&this._createRipple(c)}},this._ngZone.runOutsideAngular(()=>{for(const t of MK)this._document?.addEventListener(t,this._onInteraction,PK)})}ngOnDestroy(){const t=this._hosts.keys();for(const s of t)this.destroyRipple(s);for(const s of MK)this._document?.removeEventListener(s,this._onInteraction,PK)}configureRipple(t,s){t.setAttribute(hG,this._globalRippleOptions?.namespace??""),(s.className||!t.hasAttribute(pG))&&t.setAttribute(pG,s.className||""),s.centered&&t.setAttribute(kK,""),s.disabled&&t.setAttribute(rV,"")}getRipple(t){return this._hosts.get(t)||this._createRipple(t)}setDisabled(t,s){const c=this._hosts.get(t);c?c.disabled=s:s?t.setAttribute(rV,""):t.removeAttribute(rV)}_createRipple(t){if(!this._document)return;const s=this._hosts.get(t);if(s)return s;t.querySelector(".mat-ripple")?.remove();const c=this._document.createElement("span");c.classList.add("mat-ripple",t.getAttribute(pG)),t.append(c);const u=new NK(new On(c),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return u._isInitialized=!0,u.trigger=t,u.centered=t.hasAttribute(kK),u.disabled=t.hasAttribute(rV),this.attachRipple(t,u),u}attachRipple(t,s){t.removeAttribute(hG),this._hosts.set(t,s)}destroyRipple(t){const s=this._hosts.get(t);s&&(s.ngOnDestroy(),this._hosts.delete(t))}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),tQ=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275cmp=eo({type:e,selectors:[["div","mat-internal-form-field",""]],hostAttrs:[1,"mdc-form-field","mat-internal-form-field"],hostVars:2,hostBindings:function(s,c){2&s&&nt("mdc-form-field--align-end","before"===c.labelPosition)},inputs:{labelPosition:"labelPosition"},standalone:!0,features:[ho],attrs:VJ,ngContentSelectors:BJ,decls:1,vars:0,template:function(s,c){1&s&&(Of(),co(0))},styles:[".mat-internal-form-field{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;display:inline-flex;align-items:center;vertical-align:middle}.mat-internal-form-field>label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0;order:0}[dir=rtl] .mat-internal-form-field>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px}.mdc-form-field--align-end>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px;order:-1}[dir=rtl] .mdc-form-field--align-end .mdc-form-field--align-end label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0}"],encapsulation:2,changeDetection:0})}}return e})();const nQ=["mat-button",""],rQ=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],iQ=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"],oQ=new Te("MAT_BUTTON_CONFIG"),sQ=[{attribute:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{attribute:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{attribute:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{attribute:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{attribute:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab-base","mat-mdc-fab"]},{attribute:"mat-mini-fab",mdcClasses:["mdc-fab","mat-mdc-fab-base","mdc-fab--mini","mat-mdc-mini-fab"]},{attribute:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}];let aQ=(()=>{class e{get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(t){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,t)}get disableRipple(){return this._disableRipple}set disableRipple(t){this._disableRipple=t,this._updateRippleDisabled()}get disabled(){return this._disabled}set disabled(t){this._disabled=t,this._updateRippleDisabled()}constructor(t,s,c,u){this._elementRef=t,this._platform=s,this._ngZone=c,this._animationMode=u,this._focusMonitor=me(lG),this._rippleLoader=me(eQ),this._isFab=!1,this._disableRipple=!1,this._disabled=!1;const p=me(oQ,{optional:!0}),_=t.nativeElement,E=_.classList;this.disabledInteractive=p?.disabledInteractive??!1,this.color=p?.color??null,this._rippleLoader?.configureRipple(_,{className:"mat-mdc-button-ripple"});for(const{attribute:S,mdcClasses:w}of sQ)_.hasAttribute(S)&&E.add(...w)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(t="program",s){t?this._focusMonitor.focusVia(this._elementRef.nativeElement,t,s):this._elementRef.nativeElement.focus(s)}_getAriaDisabled(){return null!=this.ariaDisabled?this.ariaDisabled:!(!this.disabled||!this.disabledInteractive)||null}_getDisabledAttribute(){return!(this.disabledInteractive||!this.disabled)||null}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}static{this.\u0275fac=function(s){!function JM(){throw new Error("invalid")}()}}static{this.\u0275dir=Ue({type:e,inputs:{color:"color",disableRipple:[2,"disableRipple","disableRipple",zi],disabled:[2,"disabled","disabled",zi],ariaDisabled:[2,"aria-disabled","ariaDisabled",zi],disabledInteractive:[2,"disabledInteractive","disabledInteractive",zi]},features:[a_]})}}return e})(),cQ=(()=>{class e extends aQ{constructor(t,s,c,u){super(t,s,c,u)}static{this.\u0275fac=function(s){return new(s||e)(oe(On),oe(jo),oe(ft),oe(nl,8))}}static{this.\u0275cmp=eo({type:e,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:14,hostBindings:function(s,c){2&s&&(Jr("disabled",c._getDisabledAttribute())("aria-disabled",c._getAriaDisabled()),dS(c.color?"mat-"+c.color:""),nt("mat-mdc-button-disabled",c.disabled)("mat-mdc-button-disabled-interactive",c.disabledInteractive)("_mat-animation-noopable","NoopAnimations"===c._animationMode)("mat-unthemed",!c.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[tn,ho],attrs:nQ,ngContentSelectors:iQ,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(s,c){1&s&&(Of(rQ),At(0,"span",0),co(1),Se(2,"span",1),co(3,1),Be(),co(4,2),At(5,"span",2)(6,"span",3)),2&s&&nt("mdc-button__ripple",!c._isFab)("mdc-fab__ripple",c._isFab)},styles:['.mat-mdc-button-base{text-decoration:none}.mdc-button{-webkit-user-select:none;user-select:none;position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0);padding:0 8px}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__label{position:relative}.mat-mdc-button{padding:0 var(--mat-text-button-horizontal-padding, 8px);height:var(--mdc-text-button-container-height);font-family:var(--mdc-text-button-label-text-font, var(--mat-app-label-large-font));font-size:var(--mdc-text-button-label-text-size, var(--mat-app-label-large-size));letter-spacing:var(--mdc-text-button-label-text-tracking, var(--mat-app-label-large-tracking));text-transform:var(--mdc-text-button-label-text-transform);font-weight:var(--mdc-text-button-label-text-weight, var(--mat-app-label-large-weight))}.mat-mdc-button:has(.material-icons,mat-icon,[matButtonIcon]){padding:0 var(--mat-text-button-with-icon-horizontal-padding, 8px)}.mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}[dir=rtl] .mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}.mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-text-button-ripple-color)}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-state-layer-color, var(--mat-app-primary))}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-disabled-state-layer-color, var(--mat-app-on-surface-variant))}.mat-mdc-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-hover-state-layer-opacity, var(--mat-app-hover-state-layer-opacity))}.mat-mdc-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-focus-state-layer-opacity, var(--mat-app-focus-state-layer-opacity))}.mat-mdc-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-pressed-state-layer-opacity, var(--mat-app-pressed-state-layer-opacity))}.mat-mdc-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-text-button-touch-target-display)}.mat-mdc-button,.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape, var(--mat-app-corner-full))}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color, var(--mat-app-primary))}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-unelevated-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 var(--mat-filled-button-horizontal-padding, 16px);height:var(--mdc-filled-button-container-height);font-family:var(--mdc-filled-button-label-text-font, var(--mat-app-label-large-font));font-size:var(--mdc-filled-button-label-text-size, var(--mat-app-label-large-size));letter-spacing:var(--mdc-filled-button-label-text-tracking, var(--mat-app-label-large-tracking));text-transform:var(--mdc-filled-button-label-text-transform);font-weight:var(--mdc-filled-button-label-text-weight, var(--mat-app-label-large-weight))}.mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-filled-button-ripple-color)}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-state-layer-color, var(--mat-app-on-primary))}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-disabled-state-layer-color, var(--mat-app-on-surface-variant))}.mat-mdc-unelevated-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-hover-state-layer-opacity, var(--mat-app-hover-state-layer-opacity))}.mat-mdc-unelevated-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-focus-state-layer-opacity, var(--mat-app-focus-state-layer-opacity))}.mat-mdc-unelevated-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-pressed-state-layer-opacity, var(--mat-app-pressed-state-layer-opacity))}.mat-mdc-unelevated-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-filled-button-touch-target-display)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color, var(--mat-app-on-primary));background-color:var(--mdc-filled-button-container-color, var(--mat-app-primary))}.mat-mdc-unelevated-button,.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape, var(--mat-app-corner-full))}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-filled-button-disabled-label-text-color);background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 var(--mat-protected-button-horizontal-padding, 16px);box-shadow:var(--mdc-protected-button-container-elevation-shadow, var(--mat-app-level1));height:var(--mdc-protected-button-container-height);font-family:var(--mdc-protected-button-label-text-font, var(--mat-app-label-large-font));font-size:var(--mdc-protected-button-label-text-size, var(--mat-app-label-large-size));letter-spacing:var(--mdc-protected-button-label-text-tracking, var(--mat-app-label-large-tracking));text-transform:var(--mdc-protected-button-label-text-transform);font-weight:var(--mdc-protected-button-label-text-weight, var(--mat-app-label-large-weight))}.mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}.mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-protected-button-ripple-color)}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-state-layer-color, var(--mat-app-primary))}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-disabled-state-layer-color, var(--mat-app-on-surface-variant))}.mat-mdc-raised-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-hover-state-layer-opacity, var(--mat-app-hover-state-layer-opacity))}.mat-mdc-raised-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-focus-state-layer-opacity, var(--mat-app-focus-state-layer-opacity))}.mat-mdc-raised-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-pressed-state-layer-opacity, var(--mat-app-pressed-state-layer-opacity))}.mat-mdc-raised-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-protected-button-touch-target-display)}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color, var(--mat-app-primary));background-color:var(--mdc-protected-button-container-color, var(--mat-app-surface))}.mat-mdc-raised-button,.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape, var(--mat-app-corner-full))}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation-shadow, var(--mat-app-level2))}.mat-mdc-raised-button:focus{box-shadow:var(--mdc-protected-button-focus-container-elevation-shadow, var(--mat-app-level1))}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mdc-protected-button-pressed-container-elevation-shadow, var(--mat-app-level1))}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-protected-button-disabled-label-text-color);background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation-shadow, var(--mat-app-level0))}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 var(--mat-outlined-button-horizontal-padding, 15px);height:var(--mdc-outlined-button-container-height);font-family:var(--mdc-outlined-button-label-text-font, var(--mat-app-label-large-font));font-size:var(--mdc-outlined-button-label-text-size, var(--mat-app-label-large-size));letter-spacing:var(--mdc-outlined-button-label-text-tracking, var(--mat-app-label-large-tracking));text-transform:var(--mdc-outlined-button-label-text-transform);font-weight:var(--mdc-outlined-button-label-text-weight, var(--mat-app-label-large-weight));border-radius:var(--mdc-outlined-button-container-shape, var(--mat-app-corner-full));border-width:var(--mdc-outlined-button-outline-width)}.mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-outlined-button-ripple-color)}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-state-layer-color, var(--mat-app-primary))}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-disabled-state-layer-color, var(--mat-app-on-surface-variant))}.mat-mdc-outlined-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-hover-state-layer-opacity, var(--mat-app-hover-state-layer-opacity))}.mat-mdc-outlined-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-focus-state-layer-opacity, var(--mat-app-focus-state-layer-opacity))}.mat-mdc-outlined-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-pressed-state-layer-opacity, var(--mat-app-pressed-state-layer-opacity))}.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-outlined-button-touch-target-display)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color, var(--mat-app-primary));border-color:var(--mdc-outlined-button-outline-color, var(--mat-app-outline))}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-outlined-button-disabled-label-text-color);border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button .mdc-button__ripple{border-width:var(--mdc-outlined-button-outline-width);border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-button .mat-icon,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-unelevated-button .mat-icon,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-raised-button .mat-icon,.mat-mdc-outlined-button .mdc-button__label,.mat-mdc-outlined-button .mat-icon{z-index:1;position:relative}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px)*-1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0})}}return e})(),dQ=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=ii({type:e})}static{this.\u0275inj=qr({imports:[Uc,QJ,Uc]})}}return e})();const LK=hT({passive:!0});let uQ=(()=>{class e{constructor(t,s){this._platform=t,this._ngZone=s,this._monitoredElements=new Map}monitor(t){if(!this._platform.isBrowser)return xr;const s=Sm(t),c=this._monitoredElements.get(s);if(c)return c.subject;const u=new Gt,p="cdk-text-field-autofilled",_=E=>{"cdk-text-field-autofill-start"!==E.animationName||s.classList.contains(p)?"cdk-text-field-autofill-end"===E.animationName&&s.classList.contains(p)&&(s.classList.remove(p),this._ngZone.run(()=>u.next({target:E.target,isAutofilled:!1}))):(s.classList.add(p),this._ngZone.run(()=>u.next({target:E.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{s.addEventListener("animationstart",_,LK),s.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(s,{subject:u,unlisten:()=>{s.removeEventListener("animationstart",_,LK)}}),u}stopMonitoring(t){const s=Sm(t),c=this._monitoredElements.get(s);c&&(c.unlisten(),c.subject.complete(),s.classList.remove("cdk-text-field-autofill-monitored"),s.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(s))}ngOnDestroy(){this._monitoredElements.forEach((t,s)=>this.stopMonitoring(s))}static{this.\u0275fac=function(s){return new(s||e)(ye(jo),ye(ft))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),hQ=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=ii({type:e})}static{this.\u0275inj=qr({})}}return e})();function xK(...e){const n=rm(e),t=function lO(e,n){return"number"==typeof VC(e)?e.pop():n}(e,1/0),s=e;return s.length?1===s.length?go(s[0]):ja(t)(ki(s,n)):xr}class pQ extends Gt{constructor(n=1/0,t=1/0,s=iG){super(),this._bufferSize=n,this._windowTime=t,this._timestampProvider=s,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,n),this._windowTime=Math.max(1,t)}next(n){const{isStopped:t,_buffer:s,_infiniteTimeWindow:c,_timestampProvider:u,_windowTime:p}=this;t||(s.push(n),!c&&s.push(u.now()+p)),this._trimBuffer(),super.next(n)}_subscribe(n){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(n),{_infiniteTimeWindow:s,_buffer:c}=this,u=c.slice();for(let p=0;p<u.length&&!n.closed;p+=s?1:2)n.next(u[p]);return this._checkFinalizedStatuses(n),t}_trimBuffer(){const{_bufferSize:n,_timestampProvider:t,_buffer:s,_infiniteTimeWindow:c}=this,u=(c?1:2)*n;if(n<1/0&&u<s.length&&s.splice(0,s.length-u),!c){const p=t.now();let _=0;for(let E=1;E<s.length&&s[E]<=p;E+=2)_=E;_&&s.splice(0,_+1)}}}function fG(e,n,...t){if(!0===n)return void e();if(!1===n)return;const s=new ap({next:()=>{s.unsubscribe(),e()}});return go(n(...t)).subscribe(s)}class gQ{constructor(n){this._box=n,this._destroyed=new Gt,this._resizeSubject=new Gt,this._elementObservables=new Map,typeof ResizeObserver<"u"&&(this._resizeObserver=new ResizeObserver(t=>this._resizeSubject.next(t)))}observe(n){return this._elementObservables.has(n)||this._elementObservables.set(n,new nr(t=>{const s=this._resizeSubject.subscribe(t);return this._resizeObserver?.observe(n,{box:this._box}),()=>{this._resizeObserver?.unobserve(n),s.unsubscribe(),this._elementObservables.delete(n)}}).pipe(Ns(t=>t.some(s=>s.target===n)),function mQ(e,n,t){let s,c=!1;return e&&"object"==typeof e?({bufferSize:s=1/0,windowTime:n=1/0,refCount:c=!1,scheduler:t}=e):s=e??1/0,function fQ(e={}){const{connector:n=()=>new Gt,resetOnError:t=!0,resetOnComplete:s=!0,resetOnRefCountZero:c=!0}=e;return u=>{let p,_,E,S=0,w=!1,D=!1;const U=()=>{_?.unsubscribe(),_=void 0},V=()=>{U(),p=E=void 0,w=D=!1},H=()=>{const z=p;V(),z?.unsubscribe()};return Cr((z,Q)=>{S++,!D&&!w&&U();const ie=E=E??n();Q.add(()=>{S--,0===S&&!D&&!w&&(_=fG(H,c))}),ie.subscribe(Q),!p&&S>0&&(p=new ap({next:ne=>ie.next(ne),error:ne=>{D=!0,U(),_=fG(V,t,ne),ie.error(ne)},complete:()=>{w=!0,U(),_=fG(V,s),ie.complete()}}),go(z).subscribe(p))})(u)}}({connector:()=>new pQ(s,n,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:c})}({bufferSize:1,refCount:!0}),Ci(this._destroyed))),this._elementObservables.get(n)}destroy(){this._destroyed.next(),this._destroyed.complete(),this._resizeSubject.complete(),this._elementObservables.clear()}}let _Q=(()=>{class e{constructor(){this._observers=new Map,this._ngZone=me(ft)}ngOnDestroy(){for(const[,t]of this._observers)t.destroy();this._observers.clear()}observe(t,s){const c=s?.box||"content-box";return this._observers.has(c)||this._observers.set(c,new gQ(c)),this._observers.get(c).observe(t)}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const vQ=["notch"],EQ=["matFormFieldNotchedOutline",""],yQ=["*"],bQ=["textField"],SQ=["iconPrefixContainer"],CQ=["textPrefixContainer"],TQ=["iconSuffixContainer"],wQ=["textSuffixContainer"],IQ=["*",[["mat-label"]],[["","matPrefix",""],["","matIconPrefix",""]],[["","matTextPrefix",""]],[["","matTextSuffix",""]],[["","matSuffix",""],["","matIconSuffix",""]],[["mat-error"],["","matError",""]],[["mat-hint",3,"align","end"]],[["mat-hint","align","end"]]],RQ=["*","mat-label","[matPrefix], [matIconPrefix]","[matTextPrefix]","[matTextSuffix]","[matSuffix], [matIconSuffix]","mat-error, [matError]","mat-hint:not([align='end'])","mat-hint[align='end']"];function AQ(e,n){1&e&&At(0,"span",21)}function DQ(e,n){if(1&e&&(Se(0,"label",20),co(1,1),br(2,AQ,1,0,"span",21),Be()),2&e){const t=Sn(2);$e("floating",t._shouldLabelFloat())("monitorResize",t._hasOutline())("id",t._labelId),Jr("for",t._control.disableAutomaticLabeling?null:t._control.id),Ze(2),st(!t.hideRequiredMarker&&t._control.required?2:-1)}}function OQ(e,n){1&e&&br(0,DQ,3,5,"label",20),2&e&&st(Sn()._hasFloatingLabel()?0:-1)}function NQ(e,n){1&e&&At(0,"div",7)}function PQ(e,n){}function MQ(e,n){1&e&&br(0,PQ,0,0,"ng-template",13),2&e&&(Sn(2),$e("ngTemplateOutlet",Ie(1)))}function kQ(e,n){if(1&e&&(Se(0,"div",9),br(1,MQ,1,1,null,13),Be()),2&e){const t=Sn();$e("matFormFieldNotchedOutlineOpen",t._shouldLabelFloat()),Ze(),st(t._forceDisplayInfixLabel()?-1:1)}}function LQ(e,n){1&e&&(Se(0,"div",10,2),co(2,2),Be())}function xQ(e,n){1&e&&(Se(0,"div",11,3),co(2,3),Be())}function FQ(e,n){}function UQ(e,n){1&e&&br(0,FQ,0,0,"ng-template",13),2&e&&(Sn(),$e("ngTemplateOutlet",Ie(1)))}function VQ(e,n){1&e&&(Se(0,"div",14,4),co(2,4),Be())}function BQ(e,n){1&e&&(Se(0,"div",15,5),co(2,5),Be())}function jQ(e,n){1&e&&At(0,"div",16)}function HQ(e,n){1&e&&(Se(0,"div",18),co(1,6),Be()),2&e&&$e("@transitionMessages",Sn()._subscriptAnimationState)}function GQ(e,n){if(1&e&&(Se(0,"mat-hint",22),fn(1),Be()),2&e){const t=Sn(2);$e("id",t._hintLabelId),Ze(),at(t.hintLabel)}}function WQ(e,n){if(1&e&&(Se(0,"div",19),br(1,GQ,2,2,"mat-hint",22),co(2,7),At(3,"div",23),co(4,8),Be()),2&e){const t=Sn();$e("@transitionMessages",t._subscriptAnimationState),Ze(),st(t.hintLabel?1:-1)}}let mG=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275dir=Ue({type:e,selectors:[["mat-label"]],standalone:!0})}}return e})();const zQ=new Te("MatError");let KQ=0,FK=(()=>{class e{constructor(){this.align="start",this.id="mat-mdc-hint-"+KQ++}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275dir=Ue({type:e,selectors:[["mat-hint"]],hostAttrs:[1,"mat-mdc-form-field-hint","mat-mdc-form-field-bottom-align"],hostVars:4,hostBindings:function(s,c){2&s&&(O_("id",c.id),Jr("align",null),nt("mat-mdc-form-field-hint-end","end"===c.align))},inputs:{align:"align",id:"id"},standalone:!0})}}return e})();const qQ=new Te("MatPrefix"),YQ=new Te("MatSuffix"),UK=new Te("FloatingLabelParent");let VK=(()=>{class e{get floating(){return this._floating}set floating(t){this._floating=t,this.monitorResize&&this._handleResize()}get monitorResize(){return this._monitorResize}set monitorResize(t){this._monitorResize=t,this._monitorResize?this._subscribeToResize():this._resizeSubscription.unsubscribe()}constructor(t){this._elementRef=t,this._floating=!1,this._monitorResize=!1,this._resizeObserver=me(_Q),this._ngZone=me(ft),this._parent=me(UK),this._resizeSubscription=new Ur}ngOnDestroy(){this._resizeSubscription.unsubscribe()}getWidth(){return function $Q(e){if(null!==e.offsetParent)return e.scrollWidth;const t=e.cloneNode(!0);t.style.setProperty("position","absolute"),t.style.setProperty("transform","translate(-9999px, -9999px)"),document.documentElement.appendChild(t);const s=t.scrollWidth;return t.remove(),s}(this._elementRef.nativeElement)}get element(){return this._elementRef.nativeElement}_handleResize(){setTimeout(()=>this._parent._handleLabelResized())}_subscribeToResize(){this._resizeSubscription.unsubscribe(),this._ngZone.runOutsideAngular(()=>{this._resizeSubscription=this._resizeObserver.observe(this._elementRef.nativeElement,{box:"border-box"}).subscribe(()=>this._handleResize())})}static{this.\u0275fac=function(s){return new(s||e)(oe(On))}}static{this.\u0275dir=Ue({type:e,selectors:[["label","matFormFieldFloatingLabel",""]],hostAttrs:[1,"mdc-floating-label","mat-mdc-floating-label"],hostVars:2,hostBindings:function(s,c){2&s&&nt("mdc-floating-label--float-above",c.floating)},inputs:{floating:"floating",monitorResize:"monitorResize"},standalone:!0})}}return e})();const BK="mdc-line-ripple--active",iV="mdc-line-ripple--deactivating";let jK=(()=>{class e{constructor(t,s){this._elementRef=t,this._handleTransitionEnd=c=>{const u=this._elementRef.nativeElement.classList,p=u.contains(iV);"opacity"===c.propertyName&&p&&u.remove(BK,iV)},s.runOutsideAngular(()=>{t.nativeElement.addEventListener("transitionend",this._handleTransitionEnd)})}activate(){const t=this._elementRef.nativeElement.classList;t.remove(iV),t.add(BK)}deactivate(){this._elementRef.nativeElement.classList.add(iV)}ngOnDestroy(){this._elementRef.nativeElement.removeEventListener("transitionend",this._handleTransitionEnd)}static{this.\u0275fac=function(s){return new(s||e)(oe(On),oe(ft))}}static{this.\u0275dir=Ue({type:e,selectors:[["div","matFormFieldLineRipple",""]],hostAttrs:[1,"mdc-line-ripple"],standalone:!0})}}return e})(),HK=(()=>{class e{constructor(t,s){this._elementRef=t,this._ngZone=s,this.open=!1}ngAfterViewInit(){const t=this._elementRef.nativeElement.querySelector(".mdc-floating-label");t?(this._elementRef.nativeElement.classList.add("mdc-notched-outline--upgraded"),"function"==typeof requestAnimationFrame&&(t.style.transitionDuration="0s",this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>t.style.transitionDuration="")}))):this._elementRef.nativeElement.classList.add("mdc-notched-outline--no-label")}_setNotchWidth(t){this._notch.nativeElement.style.width=this.open&&t?`calc(${t}px * var(--mat-mdc-form-field-floating-label-scale, 0.75) + 9px)`:""}static{this.\u0275fac=function(s){return new(s||e)(oe(On),oe(ft))}}static{this.\u0275cmp=eo({type:e,selectors:[["div","matFormFieldNotchedOutline",""]],viewQuery:function(s,c){if(1&s&&pe(vQ,5),2&s){let u;ci(u=kn())&&(c._notch=u.first)}},hostAttrs:[1,"mdc-notched-outline"],hostVars:2,hostBindings:function(s,c){2&s&&nt("mdc-notched-outline--notched",c.open)},inputs:{open:[0,"matFormFieldNotchedOutlineOpen","open"]},standalone:!0,features:[ho],attrs:EQ,ngContentSelectors:yQ,decls:5,vars:0,consts:[["notch",""],[1,"mat-mdc-notch-piece","mdc-notched-outline__leading"],[1,"mat-mdc-notch-piece","mdc-notched-outline__notch"],[1,"mat-mdc-notch-piece","mdc-notched-outline__trailing"]],template:function(s,c){1&s&&(Of(),At(0,"div",1),Se(1,"div",2,0),co(3),Be(),At(4,"div",3))},encapsulation:2,changeDetection:0})}}return e})();const XQ={transitionMessages:Y6("transitionMessages",[$6("enter",cu({opacity:1,transform:"translateY(0%)"})),LO("void => enter",[cu({opacity:0,transform:"translateY(-5px)"}),kO("300ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])};let GK=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275dir=Ue({type:e})}}return e})();const WK=new Te("MatFormField"),ZQ=new Te("MAT_FORM_FIELD_DEFAULT_OPTIONS");let zK=0,eee=(()=>{class e{get hideRequiredMarker(){return this._hideRequiredMarker}set hideRequiredMarker(t){this._hideRequiredMarker=pT(t)}get floatLabel(){return this._floatLabel||this._defaults?.floatLabel||"auto"}set floatLabel(t){t!==this._floatLabel&&(this._floatLabel=t,this._changeDetectorRef.markForCheck())}get appearance(){return this._appearance}set appearance(t){const s=this._appearance;this._appearance=t||this._defaults?.appearance||"fill","outline"===this._appearance&&this._appearance!==s&&(this._needsOutlineLabelOffsetUpdate=!0)}get subscriptSizing(){return this._subscriptSizing||this._defaults?.subscriptSizing||"fixed"}set subscriptSizing(t){this._subscriptSizing=t||this._defaults?.subscriptSizing||"fixed"}get hintLabel(){return this._hintLabel}set hintLabel(t){this._hintLabel=t,this._processHints()}get _control(){return this._explicitFormFieldControl||this._formFieldControl}set _control(t){this._explicitFormFieldControl=t}constructor(t,s,c,u,p,_,E,S){this._elementRef=t,this._changeDetectorRef=s,this._dir=u,this._platform=p,this._defaults=_,this._animationMode=E,this._labelChild=BI(mG),this._hideRequiredMarker=!1,this.color="primary",this._appearance="fill",this._subscriptSizing=null,this._hintLabel="",this._hasIconPrefix=!1,this._hasTextPrefix=!1,this._hasIconSuffix=!1,this._hasTextSuffix=!1,this._labelId="mat-mdc-form-field-label-"+zK++,this._hintLabelId="mat-mdc-hint-"+zK++,this._subscriptAnimationState="",this._destroyed=new Gt,this._isFocused=null,this._needsOutlineLabelOffsetUpdate=!1,this._previousControl=null,this._injector=me(Dr),this.getLabelId=jd(()=>this._hasFloatingLabel()?this._labelId:null),this._hasFloatingLabel=jd(()=>!!this._labelChild()),_&&(_.appearance&&(this.appearance=_.appearance),this._hideRequiredMarker=!!_?.hideRequiredMarker,_.color&&(this.color=_.color))}ngAfterViewInit(){this._updateFocusState(),this._subscriptAnimationState="enter",this._changeDetectorRef.detectChanges()}ngAfterContentInit(){this._assertFormFieldControl(),this._initializeSubscript(),this._initializePrefixAndSuffix(),this._initializeOutlineLabelOffsetSubscriptions()}ngAfterContentChecked(){this._assertFormFieldControl(),this._control!==this._previousControl&&(this._initializeControl(this._previousControl),this._previousControl=this._control)}ngOnDestroy(){this._stateChanges?.unsubscribe(),this._valueChanges?.unsubscribe(),this._destroyed.next(),this._destroyed.complete()}getConnectedOverlayOrigin(){return this._textField||this._elementRef}_animateAndLockLabel(){this._hasFloatingLabel()&&(this.floatLabel="always")}_initializeControl(t){const s=this._control,c="mat-mdc-form-field-type-";t&&this._elementRef.nativeElement.classList.remove(c+t.controlType),s.controlType&&this._elementRef.nativeElement.classList.add(c+s.controlType),this._stateChanges?.unsubscribe(),this._stateChanges=s.stateChanges.subscribe(()=>{this._updateFocusState(),this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._valueChanges?.unsubscribe(),s.ngControl&&s.ngControl.valueChanges&&(this._valueChanges=s.ngControl.valueChanges.pipe(Ci(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck()))}_checkPrefixAndSuffixTypes(){this._hasIconPrefix=!!this._prefixChildren.find(t=>!t._isText),this._hasTextPrefix=!!this._prefixChildren.find(t=>t._isText),this._hasIconSuffix=!!this._suffixChildren.find(t=>!t._isText),this._hasTextSuffix=!!this._suffixChildren.find(t=>t._isText)}_initializePrefixAndSuffix(){this._checkPrefixAndSuffixTypes(),xK(this._prefixChildren.changes,this._suffixChildren.changes).subscribe(()=>{this._checkPrefixAndSuffixTypes(),this._changeDetectorRef.markForCheck()})}_initializeSubscript(){this._hintChildren.changes.subscribe(()=>{this._processHints(),this._changeDetectorRef.markForCheck()}),this._errorChildren.changes.subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._validateHints(),this._syncDescribedByIds()}_assertFormFieldControl(){}_updateFocusState(){this._control.focused&&!this._isFocused?(this._isFocused=!0,this._lineRipple?.activate()):!this._control.focused&&(this._isFocused||null===this._isFocused)&&(this._isFocused=!1,this._lineRipple?.deactivate()),this._textField?.nativeElement.classList.toggle("mdc-text-field--focused",this._control.focused)}_initializeOutlineLabelOffsetSubscriptions(){this._prefixChildren.changes.subscribe(()=>this._needsOutlineLabelOffsetUpdate=!0),rh(()=>{this._needsOutlineLabelOffsetUpdate&&(this._needsOutlineLabelOffsetUpdate=!1,this._updateOutlineLabelOffset())},{injector:this._injector}),this._dir.change.pipe(Ci(this._destroyed)).subscribe(()=>this._needsOutlineLabelOffsetUpdate=!0)}_shouldAlwaysFloat(){return"always"===this.floatLabel}_hasOutline(){return"outline"===this.appearance}_forceDisplayInfixLabel(){return!this._platform.isBrowser&&this._prefixChildren.length&&!this._shouldLabelFloat()}_shouldLabelFloat(){return!!this._hasFloatingLabel()&&(this._control.shouldLabelFloat||this._shouldAlwaysFloat())}_shouldForward(t){const s=this._control?this._control.ngControl:null;return s&&s[t]}_getDisplayedMessages(){return this._errorChildren&&this._errorChildren.length>0&&this._control.errorState?"error":"hint"}_handleLabelResized(){this._refreshOutlineNotchWidth()}_refreshOutlineNotchWidth(){this._hasOutline()&&this._floatingLabel&&this._shouldLabelFloat()?this._notchedOutline?._setNotchWidth(this._floatingLabel.getWidth()):this._notchedOutline?._setNotchWidth(0)}_processHints(){this._validateHints(),this._syncDescribedByIds()}_validateHints(){}_syncDescribedByIds(){if(this._control){let t=[];if(this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&t.push(...this._control.userAriaDescribedBy.split(" ")),"hint"===this._getDisplayedMessages()){const s=this._hintChildren?this._hintChildren.find(u=>"start"===u.align):null,c=this._hintChildren?this._hintChildren.find(u=>"end"===u.align):null;s?t.push(s.id):this._hintLabel&&t.push(this._hintLabelId),c&&t.push(c.id)}else this._errorChildren&&t.push(...this._errorChildren.map(s=>s.id));this._control.setDescribedByIds(t)}}_updateOutlineLabelOffset(){if(!this._hasOutline()||!this._floatingLabel)return;const t=this._floatingLabel.element;if(!this._iconPrefixContainer&&!this._textPrefixContainer)return void(t.style.transform="");if(!this._isAttachedToDom())return void(this._needsOutlineLabelOffsetUpdate=!0);const s=this._iconPrefixContainer?.nativeElement,c=this._textPrefixContainer?.nativeElement,u=this._iconSuffixContainer?.nativeElement,p=this._textSuffixContainer?.nativeElement,_=s?.getBoundingClientRect().width??0,E=c?.getBoundingClientRect().width??0,S=u?.getBoundingClientRect().width??0,w=p?.getBoundingClientRect().width??0;t.style.transform=`var(\n        --mat-mdc-form-field-label-transform,\n        translateY(-50%) translateX(calc(${"rtl"===this._dir.value?"-1":"1"} * (${_+E}px + var(--mat-mdc-form-field-label-offset-x, 0px))))\n    )`,this._elementRef.nativeElement.style.setProperty("--mat-form-field-notch-max-width",`calc(100% - ${_+E+S+w}px)`)}_isAttachedToDom(){const t=this._elementRef.nativeElement;if(t.getRootNode){const s=t.getRootNode();return s&&s!==t}return document.documentElement.contains(t)}static{this.\u0275fac=function(s){return new(s||e)(oe(On),oe(Js),oe(ft),oe(uG),oe(jo),oe(ZQ,8),oe(nl,8),oe(Ve))}}static{this.\u0275cmp=eo({type:e,selectors:[["mat-form-field"]],contentQueries:function(s,c,u){if(1&s&&(x_(u,c._labelChild,mG,5),_h(u,GK,5),_h(u,qQ,5),_h(u,YQ,5),_h(u,zQ,5),_h(u,FK,5)),2&s){let p;(function Ts(e=1){gy(T0()+e)})(),ci(p=kn())&&(c._formFieldControl=p.first),ci(p=kn())&&(c._prefixChildren=p),ci(p=kn())&&(c._suffixChildren=p),ci(p=kn())&&(c._errorChildren=p),ci(p=kn())&&(c._hintChildren=p)}},viewQuery:function(s,c){if(1&s&&(pe(bQ,5),pe(SQ,5),pe(CQ,5),pe(TQ,5),pe(wQ,5),pe(VK,5),pe(HK,5),pe(jK,5)),2&s){let u;ci(u=kn())&&(c._textField=u.first),ci(u=kn())&&(c._iconPrefixContainer=u.first),ci(u=kn())&&(c._textPrefixContainer=u.first),ci(u=kn())&&(c._iconSuffixContainer=u.first),ci(u=kn())&&(c._textSuffixContainer=u.first),ci(u=kn())&&(c._floatingLabel=u.first),ci(u=kn())&&(c._notchedOutline=u.first),ci(u=kn())&&(c._lineRipple=u.first)}},hostAttrs:[1,"mat-mdc-form-field"],hostVars:42,hostBindings:function(s,c){2&s&&nt("mat-mdc-form-field-label-always-float",c._shouldAlwaysFloat())("mat-mdc-form-field-has-icon-prefix",c._hasIconPrefix)("mat-mdc-form-field-has-icon-suffix",c._hasIconSuffix)("mat-form-field-invalid",c._control.errorState)("mat-form-field-disabled",c._control.disabled)("mat-form-field-autofilled",c._control.autofilled)("mat-form-field-no-animations","NoopAnimations"===c._animationMode)("mat-form-field-appearance-fill","fill"==c.appearance)("mat-form-field-appearance-outline","outline"==c.appearance)("mat-form-field-hide-placeholder",c._hasFloatingLabel()&&!c._shouldLabelFloat())("mat-focused",c._control.focused)("mat-primary","accent"!==c.color&&"warn"!==c.color)("mat-accent","accent"===c.color)("mat-warn","warn"===c.color)("ng-untouched",c._shouldForward("untouched"))("ng-touched",c._shouldForward("touched"))("ng-pristine",c._shouldForward("pristine"))("ng-dirty",c._shouldForward("dirty"))("ng-valid",c._shouldForward("valid"))("ng-invalid",c._shouldForward("invalid"))("ng-pending",c._shouldForward("pending"))},inputs:{hideRequiredMarker:"hideRequiredMarker",color:"color",floatLabel:"floatLabel",appearance:"appearance",subscriptSizing:"subscriptSizing",hintLabel:"hintLabel"},exportAs:["matFormField"],standalone:!0,features:[mn([{provide:WK,useExisting:e},{provide:UK,useExisting:e}]),ho],ngContentSelectors:RQ,decls:18,vars:21,consts:[["labelTemplate",""],["textField",""],["iconPrefixContainer",""],["textPrefixContainer",""],["textSuffixContainer",""],["iconSuffixContainer",""],[1,"mat-mdc-text-field-wrapper","mdc-text-field",3,"click"],[1,"mat-mdc-form-field-focus-overlay"],[1,"mat-mdc-form-field-flex"],["matFormFieldNotchedOutline","",3,"matFormFieldNotchedOutlineOpen"],[1,"mat-mdc-form-field-icon-prefix"],[1,"mat-mdc-form-field-text-prefix"],[1,"mat-mdc-form-field-infix"],[3,"ngTemplateOutlet"],[1,"mat-mdc-form-field-text-suffix"],[1,"mat-mdc-form-field-icon-suffix"],["matFormFieldLineRipple",""],[1,"mat-mdc-form-field-subscript-wrapper","mat-mdc-form-field-bottom-align"],[1,"mat-mdc-form-field-error-wrapper"],[1,"mat-mdc-form-field-hint-wrapper"],["matFormFieldFloatingLabel","",3,"floating","monitorResize","id"],["aria-hidden","true",1,"mat-mdc-form-field-required-marker","mdc-floating-label--required"],[3,"id"],[1,"mat-mdc-form-field-hint-spacer"]],template:function(s,c){if(1&s){const u=Sc();Of(IQ),br(0,OQ,1,1,"ng-template",null,0,UL),Se(2,"div",6,1),Mn("click",function(_){return Xo(u),ro(c._control.onContainerClick(_))}),br(4,NQ,1,0,"div",7),Se(5,"div",8),br(6,kQ,2,2,"div",9)(7,LQ,3,0,"div",10)(8,xQ,3,0,"div",11),Se(9,"div",12),br(10,UQ,1,1,null,13),co(11),Be(),br(12,VQ,3,0,"div",14)(13,BQ,3,0,"div",15),Be(),br(14,jQ,1,0,"div",16),Be(),Se(15,"div",17),br(16,HQ,2,1,"div",18)(17,WQ,5,2,"div",19),Be()}if(2&s){let u;Ze(2),nt("mdc-text-field--filled",!c._hasOutline())("mdc-text-field--outlined",c._hasOutline())("mdc-text-field--no-label",!c._hasFloatingLabel())("mdc-text-field--disabled",c._control.disabled)("mdc-text-field--invalid",c._control.errorState),Ze(2),st(c._hasOutline()||c._control.disabled?-1:4),Ze(2),st(c._hasOutline()?6:-1),Ze(),st(c._hasIconPrefix?7:-1),Ze(),st(c._hasTextPrefix?8:-1),Ze(2),st(!c._hasOutline()||c._forceDisplayInfixLabel()?10:-1),Ze(2),st(c._hasTextSuffix?12:-1),Ze(),st(c._hasIconSuffix?13:-1),Ze(),st(c._hasOutline()?-1:14),Ze(),nt("mat-mdc-form-field-subscript-dynamic-size","dynamic"===c.subscriptSizing),Ze(),st("error"===(u=c._getDisplayedMessages())?16:"hint"===u?17:-1)}},dependencies:[VK,HK,bD,jK,FK],styles:['.mdc-text-field{display:inline-flex;align-items:baseline;padding:0 16px;position:relative;box-sizing:border-box;overflow:hidden;will-change:opacity,transform,color;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:0;border-bottom-left-radius:0}.mdc-text-field__input{width:100%;min-width:0;border:none;border-radius:0;background:none;padding:0;-moz-appearance:none;-webkit-appearance:none;height:28px}.mdc-text-field__input::-webkit-calendar-picker-indicator{display:none}.mdc-text-field__input::-ms-clear{display:none}.mdc-text-field__input:focus{outline:none}.mdc-text-field__input:invalid{box-shadow:none}.mdc-text-field__input::placeholder{opacity:0}.mdc-text-field__input::-moz-placeholder{opacity:0}.mdc-text-field__input::-webkit-input-placeholder{opacity:0}.mdc-text-field__input:-ms-input-placeholder{opacity:0}.mdc-text-field--no-label .mdc-text-field__input::placeholder,.mdc-text-field--focused .mdc-text-field__input::placeholder{opacity:1}.mdc-text-field--no-label .mdc-text-field__input::-moz-placeholder,.mdc-text-field--focused .mdc-text-field__input::-moz-placeholder{opacity:1}.mdc-text-field--no-label .mdc-text-field__input::-webkit-input-placeholder,.mdc-text-field--focused .mdc-text-field__input::-webkit-input-placeholder{opacity:1}.mdc-text-field--no-label .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mdc-text-field__input:-ms-input-placeholder{opacity:1}.mdc-text-field--outlined .mdc-text-field__input,.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{height:100%}.mdc-text-field--outlined .mdc-text-field__input{display:flex;border:none !important;background-color:rgba(0,0,0,0)}.mdc-text-field--disabled .mdc-text-field__input{pointer-events:auto}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-filled-text-field-input-text-color, var(--mat-app-on-surface));caret-color:var(--mdc-filled-text-field-caret-color, var(--mat-app-primary))}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color, var(--mat-app-on-surface-variant))}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input::-moz-placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color, var(--mat-app-on-surface-variant))}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input::-webkit-input-placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color, var(--mat-app-on-surface-variant))}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color, var(--mat-app-on-surface-variant))}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-error-caret-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-filled-text-field-disabled-input-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-outlined-text-field-input-text-color, var(--mat-app-on-surface));caret-color:var(--mdc-outlined-text-field-caret-color, var(--mat-app-primary))}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color, var(--mat-app-on-surface-variant))}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input::-moz-placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color, var(--mat-app-on-surface-variant))}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input::-webkit-input-placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color, var(--mat-app-on-surface-variant))}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color, var(--mat-app-on-surface-variant))}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-error-caret-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-outlined-text-field-disabled-input-text-color)}.mdc-text-field--disabled .cdk-high-contrast-active .mdc-text-field__input{background-color:Window}.mdc-text-field--filled{height:56px;border-bottom-right-radius:0;border-bottom-left-radius:0;border-top-left-radius:var(--mdc-filled-text-field-container-shape, var(--mat-app-corner-extra-small-top));border-top-right-radius:var(--mdc-filled-text-field-container-shape, var(--mat-app-corner-extra-small-top))}.mdc-text-field--filled:not(.mdc-text-field--disabled){background-color:var(--mdc-filled-text-field-container-color, var(--mat-app-surface-variant))}.mdc-text-field--filled.mdc-text-field--disabled{background-color:var(--mdc-filled-text-field-disabled-container-color)}.mdc-text-field--outlined{height:56px;overflow:visible;padding-right:max(16px,var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small)));padding-left:max(16px,var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small)) + 4px)}[dir=rtl] .mdc-text-field--outlined{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small)) + 4px);padding-left:max(16px,var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small)))}.mdc-floating-label{position:absolute;left:0;transform-origin:left top;line-height:1.15rem;text-align:left;text-overflow:ellipsis;white-space:nowrap;cursor:text;overflow:hidden;will-change:transform}[dir=rtl] .mdc-floating-label{right:0;left:auto;transform-origin:right top;text-align:right}.mdc-text-field .mdc-floating-label{top:50%;transform:translateY(-50%);pointer-events:none}.mdc-notched-outline .mdc-floating-label{display:inline-block;position:relative;max-width:100%}.mdc-text-field--outlined .mdc-floating-label{left:4px;right:auto}[dir=rtl] .mdc-text-field--outlined .mdc-floating-label{left:auto;right:4px}.mdc-text-field--filled .mdc-floating-label{left:16px;right:auto}[dir=rtl] .mdc-text-field--filled .mdc-floating-label{left:auto;right:16px}.mdc-text-field--disabled .mdc-floating-label{cursor:default}.cdk-high-contrast-active .mdc-text-field--disabled .mdc-floating-label{z-index:1}.mdc-text-field--filled.mdc-text-field--no-label .mdc-floating-label{display:none}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label{color:var(--mdc-filled-text-field-label-text-color, var(--mat-app-on-surface-variant))}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label{color:var(--mdc-filled-text-field-focus-label-text-color, var(--mat-app-primary))}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label{color:var(--mdc-filled-text-field-hover-label-text-color, var(--mat-app-on-surface-variant))}.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label{color:var(--mdc-filled-text-field-disabled-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--invalid .mdc-floating-label{color:var(--mdc-filled-text-field-error-label-text-color, var(--mat-app-error))}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--invalid.mdc-text-field--focused .mdc-floating-label{color:var(--mdc-filled-text-field-error-focus-label-text-color, var(--mat-app-error))}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--invalid:not(.mdc-text-field--disabled):hover .mdc-floating-label{color:var(--mdc-filled-text-field-error-hover-label-text-color, var(--mat-app-on-error-container))}.mdc-text-field--filled .mdc-floating-label{font-family:var(--mdc-filled-text-field-label-text-font, var(--mat-app-body-large-font));font-size:var(--mdc-filled-text-field-label-text-size, var(--mat-app-body-large-size));font-weight:var(--mdc-filled-text-field-label-text-weight, var(--mat-app-body-large-weight));letter-spacing:var(--mdc-filled-text-field-label-text-tracking, var(--mat-app-body-large-tracking))}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label{color:var(--mdc-outlined-text-field-label-text-color, var(--mat-app-on-surface-variant))}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label{color:var(--mdc-outlined-text-field-focus-label-text-color, var(--mat-app-primary))}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label{color:var(--mdc-outlined-text-field-hover-label-text-color, var(--mat-app-on-surface))}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label{color:var(--mdc-outlined-text-field-disabled-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid .mdc-floating-label{color:var(--mdc-outlined-text-field-error-label-text-color, var(--mat-app-error))}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid.mdc-text-field--focused .mdc-floating-label{color:var(--mdc-outlined-text-field-error-focus-label-text-color, var(--mat-app-error))}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid:not(.mdc-text-field--disabled):hover .mdc-floating-label{color:var(--mdc-outlined-text-field-error-hover-label-text-color, var(--mat-app-on-error-container))}.mdc-text-field--outlined .mdc-floating-label{font-family:var(--mdc-outlined-text-field-label-text-font, var(--mat-app-body-large-font));font-size:var(--mdc-outlined-text-field-label-text-size, var(--mat-app-body-large-size));font-weight:var(--mdc-outlined-text-field-label-text-weight, var(--mat-app-body-large-weight));letter-spacing:var(--mdc-outlined-text-field-label-text-tracking, var(--mat-app-body-large-tracking))}.mdc-floating-label--float-above{cursor:auto;transform:translateY(-106%) scale(0.75)}.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) scale(1);font-size:.75rem}.mdc-notched-outline .mdc-floating-label--float-above{text-overflow:clip}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:133.3333333333%}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) scale(0.75)}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after{margin-left:1px;margin-right:0;content:"*"}[dir=rtl] .mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after{margin-left:0;margin-right:1px}.mdc-notched-outline{display:flex;position:absolute;top:0;right:0;left:0;box-sizing:border-box;width:100%;max-width:100%;height:100%;text-align:left;pointer-events:none}[dir=rtl] .mdc-notched-outline{text-align:right}.mdc-text-field--outlined .mdc-notched-outline{z-index:1}.mat-mdc-notch-piece{box-sizing:border-box;height:100%;pointer-events:none;border-top:1px solid;border-bottom:1px solid}.mdc-text-field--focused .mat-mdc-notch-piece{border-width:2px}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-outline-color, var(--mat-app-outline));border-width:var(--mdc-outlined-text-field-outline-width)}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-hover-outline-color, var(--mat-app-on-surface))}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-focus-outline-color, var(--mat-app-primary))}.mdc-text-field--outlined.mdc-text-field--disabled .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-disabled-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-error-outline-color, var(--mat-app-error))}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid:not(.mdc-text-field--focused):hover .mdc-notched-outline .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-error-hover-outline-color, var(--mat-app-on-error-container))}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid.mdc-text-field--focused .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-error-focus-outline-color, var(--mat-app-error))}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mat-mdc-notch-piece{border-width:var(--mdc-outlined-text-field-focus-outline-width)}.mdc-notched-outline__leading{border-left:1px solid;border-right:none;border-top-right-radius:0;border-bottom-right-radius:0;border-top-left-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small));border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small))}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px,var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small)))}[dir=rtl] .mdc-notched-outline__leading{border-left:none;border-right:1px solid;border-bottom-left-radius:0;border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small));border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small))}.mdc-notched-outline__trailing{flex-grow:1;border-left:none;border-right:1px solid;border-top-left-radius:0;border-bottom-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small));border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small))}[dir=rtl] .mdc-notched-outline__trailing{border-left:1px solid;border-right:none;border-top-right-radius:0;border-bottom-right-radius:0;border-top-left-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small));border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small))}.mdc-notched-outline__notch{flex:0 0 auto;width:auto}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:min(var(--mat-form-field-notch-max-width, 100%),100% - max(12px,var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small)))*2)}.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:1px}.mdc-text-field--focused.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:2px}.mdc-notched-outline--notched .mdc-notched-outline__notch{padding-left:0;padding-right:8px;border-top:none;--mat-form-field-notch-max-width: 100%}[dir=rtl] .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-left:8px;padding-right:0}.mdc-notched-outline--no-label .mdc-notched-outline__notch{display:none}.mdc-line-ripple::before,.mdc-line-ripple::after{position:absolute;bottom:0;left:0;width:100%;border-bottom-style:solid;content:""}.mdc-line-ripple::before{z-index:1;border-bottom-width:var(--mdc-filled-text-field-active-indicator-height)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-active-indicator-color, var(--mat-app-on-surface-variant))}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-hover-active-indicator-color, var(--mat-app-on-surface))}.mdc-text-field--filled.mdc-text-field--disabled .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-disabled-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--invalid .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-active-indicator-color, var(--mat-app-error))}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--invalid:not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-hover-active-indicator-color, var(--mat-app-on-error-container))}.mdc-line-ripple::after{transform:scaleX(0);opacity:0;z-index:2}.mdc-text-field--filled .mdc-line-ripple::after{border-bottom-width:var(--mdc-filled-text-field-focus-active-indicator-height)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-focus-active-indicator-color, var(--mat-app-primary))}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-error-focus-active-indicator-color, var(--mat-app-error))}.mdc-line-ripple--active::after{transform:scaleX(1);opacity:1}.mdc-line-ripple--deactivating::after{opacity:0}.mdc-text-field--disabled{pointer-events:none}.mat-mdc-form-field-textarea-control{vertical-align:middle;resize:vertical;box-sizing:border-box;height:auto;margin:0;padding:0;border:none;overflow:auto}.mat-mdc-form-field-input-control.mat-mdc-form-field-input-control{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:inherit;letter-spacing:inherit;text-decoration:inherit;text-transform:inherit;border:none}.mat-mdc-form-field .mat-mdc-floating-label.mdc-floating-label{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;line-height:normal;pointer-events:all;will-change:auto}.mat-mdc-form-field:not(.mat-form-field-disabled) .mat-mdc-floating-label.mdc-floating-label{cursor:inherit}.mdc-text-field--no-label:not(.mdc-text-field--textarea) .mat-mdc-form-field-input-control.mdc-text-field__input,.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control{height:auto}.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control.mdc-text-field__input[type=color]{height:23px}.mat-mdc-text-field-wrapper{height:auto;flex:auto;will-change:auto}.mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-left:0;--mat-mdc-form-field-label-offset-x: -16px}.mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-right:0}[dir=rtl] .mat-mdc-text-field-wrapper{padding-left:16px;padding-right:16px}[dir=rtl] .mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-left:0}[dir=rtl] .mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-right:0}.mat-form-field-disabled .mdc-text-field__input::placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-moz-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-webkit-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input:-ms-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-mdc-form-field-label-always-float .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms;opacity:1}.mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-floating-label{left:auto;right:auto}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-text-field__input{display:inline-block}.mat-mdc-form-field .mat-mdc-text-field-wrapper.mdc-text-field .mdc-notched-outline__notch{padding-top:0}.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field .mdc-notched-outline__notch{border-left:1px solid rgba(0,0,0,0)}[dir=rtl] .mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field .mdc-notched-outline__notch{border-left:none;border-right:1px solid rgba(0,0,0,0)}.mat-mdc-form-field-infix{min-height:var(--mat-form-field-container-height);padding-top:var(--mat-form-field-filled-with-label-container-padding-top);padding-bottom:var(--mat-form-field-filled-with-label-container-padding-bottom)}.mdc-text-field--outlined .mat-mdc-form-field-infix,.mdc-text-field--no-label .mat-mdc-form-field-infix{padding-top:var(--mat-form-field-container-vertical-padding);padding-bottom:var(--mat-form-field-container-vertical-padding)}.mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-floating-label{top:calc(var(--mat-form-field-container-height)/2)}.mdc-text-field--filled .mat-mdc-floating-label{display:var(--mat-form-field-filled-label-display, block)}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{--mat-mdc-form-field-label-transform: translateY(calc(calc(6.75px + var(--mat-form-field-container-height) / 2) * -1)) scale(var(--mat-mdc-form-field-floating-label-scale, 0.75));transform:var(--mat-mdc-form-field-label-transform)}.mat-mdc-form-field-subscript-wrapper{box-sizing:border-box;width:100%;position:relative}.mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-error-wrapper{position:absolute;top:0;left:0;right:0;padding:0 16px}.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-error-wrapper{position:static}.mat-mdc-form-field-bottom-align::before{content:"";display:inline-block;height:16px}.mat-mdc-form-field-bottom-align.mat-mdc-form-field-subscript-dynamic-size::before{content:unset}.mat-mdc-form-field-hint-end{order:1}.mat-mdc-form-field-hint-wrapper{display:flex}.mat-mdc-form-field-hint-spacer{flex:1 0 1em}.mat-mdc-form-field-error{display:block;color:var(--mat-form-field-error-text-color, var(--mat-app-error))}.mat-mdc-form-field-subscript-wrapper,.mat-mdc-form-field-bottom-align::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-subscript-text-font, var(--mat-app-body-small-font));line-height:var(--mat-form-field-subscript-text-line-height, var(--mat-app-body-small-line-height));font-size:var(--mat-form-field-subscript-text-size, var(--mat-app-body-small-size));letter-spacing:var(--mat-form-field-subscript-text-tracking, var(--mat-app-body-small-tracking));font-weight:var(--mat-form-field-subscript-text-weight, var(--mat-app-body-small-weight))}.mat-mdc-form-field-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;opacity:0;pointer-events:none;background-color:var(--mat-form-field-state-layer-color, var(--mat-app-on-surface))}.mat-mdc-text-field-wrapper:hover .mat-mdc-form-field-focus-overlay{opacity:var(--mat-form-field-hover-state-layer-opacity, var(--mat-app-hover-state-layer-opacity))}.mat-mdc-form-field.mat-focused .mat-mdc-form-field-focus-overlay{opacity:var(--mat-form-field-focus-state-layer-opacity)}select.mat-mdc-form-field-input-control{-moz-appearance:none;-webkit-appearance:none;background-color:rgba(0,0,0,0);display:inline-flex;box-sizing:border-box}select.mat-mdc-form-field-input-control:not(:disabled){cursor:pointer}select.mat-mdc-form-field-input-control:not(.mat-mdc-native-select-inline) option{color:var(--mat-form-field-select-option-text-color)}select.mat-mdc-form-field-input-control:not(.mat-mdc-native-select-inline) option:disabled{color:var(--mat-form-field-select-disabled-option-text-color)}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{content:"";width:0;height:0;border-left:5px solid rgba(0,0,0,0);border-right:5px solid rgba(0,0,0,0);border-top:5px solid;position:absolute;right:0;top:50%;margin-top:-2.5px;pointer-events:none;color:var(--mat-form-field-enabled-select-arrow-color, var(--mat-app-on-surface-variant))}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{right:auto;left:0}.mat-mdc-form-field-type-mat-native-select.mat-focused .mat-mdc-form-field-infix::after{color:var(--mat-form-field-focus-select-arrow-color, var(--mat-app-primary))}.mat-mdc-form-field-type-mat-native-select.mat-form-field-disabled .mat-mdc-form-field-infix::after{color:var(--mat-form-field-disabled-select-arrow-color)}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:15px}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:0;padding-left:15px}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-mdc-text-field-wrapper{outline:solid 1px}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-form-field-disabled .mat-mdc-text-field-wrapper{outline-color:GrayText}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-focused .mat-mdc-text-field-wrapper{outline:dashed 3px}.cdk-high-contrast-active .mat-mdc-form-field.mat-focused .mdc-notched-outline{border:dashed 3px}.mat-mdc-form-field-input-control[type=date],.mat-mdc-form-field-input-control[type=datetime],.mat-mdc-form-field-input-control[type=datetime-local],.mat-mdc-form-field-input-control[type=month],.mat-mdc-form-field-input-control[type=week],.mat-mdc-form-field-input-control[type=time]{line-height:1}.mat-mdc-form-field-input-control::-webkit-datetime-edit{line-height:1;padding:0;margin-bottom:-2px}.mat-mdc-form-field{--mat-mdc-form-field-floating-label-scale: 0.75;display:inline-flex;flex-direction:column;min-width:0;text-align:left;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-container-text-font, var(--mat-app-body-large-font));line-height:var(--mat-form-field-container-text-line-height, var(--mat-app-body-large-line-height));font-size:var(--mat-form-field-container-text-size, var(--mat-app-body-large-size));letter-spacing:var(--mat-form-field-container-text-tracking, var(--mat-app-body-large-tracking));font-weight:var(--mat-form-field-container-text-weight, var(--mat-app-body-large-weight))}[dir=rtl] .mat-mdc-form-field{text-align:right}.mat-mdc-form-field .mdc-text-field--outlined .mdc-floating-label--float-above{font-size:calc(var(--mat-form-field-outlined-label-text-populated-size)*var(--mat-mdc-form-field-floating-label-scale))}.mat-mdc-form-field .mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:var(--mat-form-field-outlined-label-text-populated-size)}.mat-mdc-form-field-flex{display:inline-flex;align-items:baseline;box-sizing:border-box;width:100%}.mat-mdc-text-field-wrapper{width:100%;z-index:0}.mat-mdc-form-field-icon-prefix,.mat-mdc-form-field-icon-suffix{align-self:center;line-height:0;pointer-events:auto;position:relative;z-index:1}.mat-mdc-form-field-icon-prefix>.mat-icon,.mat-mdc-form-field-icon-suffix>.mat-icon{padding:0 12px;box-sizing:content-box}.mat-mdc-form-field-icon-prefix{color:var(--mat-form-field-leading-icon-color, var(--mat-app-on-surface-variant))}.mat-form-field-disabled .mat-mdc-form-field-icon-prefix{color:var(--mat-form-field-disabled-leading-icon-color)}.mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-trailing-icon-color, var(--mat-app-on-surface-variant))}.mat-form-field-disabled .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-disabled-trailing-icon-color)}.mat-form-field-invalid .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-trailing-icon-color, var(--mat-app-error))}.mat-form-field-invalid:not(.mat-focused):not(.mat-form-field-disabled) .mat-mdc-text-field-wrapper:hover .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-hover-trailing-icon-color, var(--mat-app-on-error-container))}.mat-form-field-invalid.mat-focused .mat-mdc-text-field-wrapper .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-focus-trailing-icon-color, var(--mat-app-error))}.mat-mdc-form-field-icon-prefix,[dir=rtl] .mat-mdc-form-field-icon-suffix{padding:0 4px 0 0}.mat-mdc-form-field-icon-suffix,[dir=rtl] .mat-mdc-form-field-icon-prefix{padding:0 0 0 4px}.mat-mdc-form-field-subscript-wrapper .mat-icon,.mat-mdc-form-field label .mat-icon{width:1em;height:1em;font-size:inherit}.mat-mdc-form-field-infix{flex:auto;min-width:0;width:180px;position:relative;box-sizing:border-box}.mat-mdc-form-field-infix:has(textarea[cols]){width:auto}.mat-mdc-form-field .mdc-notched-outline__notch{margin-left:-1px;-webkit-clip-path:inset(-9em -999em -9em 1px);clip-path:inset(-9em -999em -9em 1px)}[dir=rtl] .mat-mdc-form-field .mdc-notched-outline__notch{margin-left:0;margin-right:-1px;-webkit-clip-path:inset(-9em 1px -9em -999em);clip-path:inset(-9em 1px -9em -999em)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-floating-label{transition:transform 150ms cubic-bezier(0.4, 0, 0.2, 1),color 150ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input{transition:opacity 150ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition:opacity 67ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::-moz-placeholder{transition:opacity 67ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::-webkit-input-placeholder{transition:opacity 67ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition:opacity 67ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--no-label .mdc-text-field__input::placeholder,.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--focused .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms}.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--no-label .mdc-text-field__input::-moz-placeholder,.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--focused .mdc-text-field__input::-moz-placeholder{transition-delay:40ms;transition-duration:110ms}.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--no-label .mdc-text-field__input::-webkit-input-placeholder,.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--focused .mdc-text-field__input::-webkit-input-placeholder{transition-delay:40ms;transition-duration:110ms}.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--no-label .mdc-text-field__input:-ms-input-placeholder,.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--focused .mdc-text-field__input:-ms-input-placeholder{transition-delay:40ms;transition-duration:110ms}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled:not(.mdc-ripple-upgraded):focus .mdc-text-field__ripple::before{transition-duration:75ms}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-line-ripple::after{transition:transform 180ms cubic-bezier(0.4, 0, 0.2, 1),opacity 180ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-notched-outline .mdc-floating-label{max-width:calc(100% + 1px)}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:calc(133.3333333333% + 1px)}'],encapsulation:2,data:{animation:[XQ.transitionMessages]},changeDetection:0})}}return e})(),YK=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=ii({type:e})}static{this.\u0275inj=qr({imports:[Uc,OD,oK,Uc]})}}return e})();const tee=new Te("MAT_INPUT_VALUE_ACCESSOR"),nee=["button","checkbox","file","hidden","image","radio","range","reset","submit"];let ree=0,iee=(()=>{class e{get disabled(){return this._disabled}set disabled(t){this._disabled=pT(t),this.focused&&(this.focused=!1,this.stateChanges.next())}get id(){return this._id}set id(t){this._id=t||this._uid}get required(){return this._required??this.ngControl?.control?.hasValidator(X9.required)??!1}set required(t){this._required=pT(t)}get type(){return this._type}set type(t){this._type=t||"text",this._validateType(),!this._isTextarea&&eK().has(this._type)&&(this._elementRef.nativeElement.type=this._type),this._ensureWheelDefaultBehavior()}get errorStateMatcher(){return this._errorStateTracker.matcher}set errorStateMatcher(t){this._errorStateTracker.matcher=t}get value(){return this._inputValueAccessor.value}set value(t){t!==this.value&&(this._inputValueAccessor.value=t,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(t){this._readonly=pT(t)}get errorState(){return this._errorStateTracker.errorState}set errorState(t){this._errorStateTracker.errorState=t}constructor(t,s,c,u,p,_,E,S,w,D){this._elementRef=t,this._platform=s,this.ngControl=c,this._autofillMonitor=S,this._ngZone=w,this._formField=D,this._uid="mat-input-"+ree++,this._webkitBlinkWheelListenerAttached=!1,this.focused=!1,this.stateChanges=new Gt,this.controlType="mat-input",this.autofilled=!1,this._disabled=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(H=>eK().has(H)),this._iOSKeyupListener=H=>{const z=H.target;!z.value&&0===z.selectionStart&&0===z.selectionEnd&&(z.setSelectionRange(1,1),z.setSelectionRange(0,0))},this._webkitBlinkWheelListener=()=>{};const U=this._elementRef.nativeElement,V=U.nodeName.toLowerCase();this._inputValueAccessor=E||U,this._previousNativeValue=this.value,this.id=this.id,s.IOS&&w.runOutsideAngular(()=>{t.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._errorStateTracker=new TK(_,c,p,u,this.stateChanges),this._isServer=!this._platform.isBrowser,this._isNativeSelect="select"===V,this._isTextarea="textarea"===V,this._isInFormField=!!D,this._isNativeSelect&&(this.controlType=U.multiple?"mat-native-select-multiple":"mat-native-select")}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(t=>{this.autofilled=t.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener),this._webkitBlinkWheelListenerAttached&&this._elementRef.nativeElement.removeEventListener("wheel",this._webkitBlinkWheelListener)}ngDoCheck(){this.ngControl&&(this.updateErrorState(),null!==this.ngControl.disabled&&this.ngControl.disabled!==this.disabled&&(this.disabled=this.ngControl.disabled,this.stateChanges.next())),this._dirtyCheckNativeValue(),this._dirtyCheckPlaceholder()}focus(t){this._elementRef.nativeElement.focus(t)}updateErrorState(){this._errorStateTracker.updateErrorState()}_focusChanged(t){t!==this.focused&&(this.focused=t,this.stateChanges.next())}_onInput(){}_dirtyCheckNativeValue(){const t=this._elementRef.nativeElement.value;this._previousNativeValue!==t&&(this._previousNativeValue=t,this.stateChanges.next())}_dirtyCheckPlaceholder(){const t=this._getPlaceholder();if(t!==this._previousPlaceholder){const s=this._elementRef.nativeElement;this._previousPlaceholder=t,t?s.setAttribute("placeholder",t):s.removeAttribute("placeholder")}}_getPlaceholder(){return this.placeholder||null}_validateType(){nee.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){let t=this._elementRef.nativeElement.validity;return t&&t.badInput}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}get shouldLabelFloat(){if(this._isNativeSelect){const t=this._elementRef.nativeElement,s=t.options[0];return this.focused||t.multiple||!this.empty||!!(t.selectedIndex>-1&&s&&s.label)}return this.focused||!this.empty}setDescribedByIds(t){t.length?this._elementRef.nativeElement.setAttribute("aria-describedby",t.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}_isInlineSelect(){const t=this._elementRef.nativeElement;return this._isNativeSelect&&(t.multiple||t.size>1)}_ensureWheelDefaultBehavior(){!this._webkitBlinkWheelListenerAttached&&"number"===this._type&&(this._platform.BLINK||this._platform.WEBKIT)&&(this._ngZone.runOutsideAngular(()=>{this._elementRef.nativeElement.addEventListener("wheel",this._webkitBlinkWheelListener)}),this._webkitBlinkWheelListenerAttached=!0),this._webkitBlinkWheelListenerAttached&&"number"!==this._type&&(this._elementRef.nativeElement.removeEventListener("wheel",this._webkitBlinkWheelListener),this._webkitBlinkWheelListenerAttached=!0)}static{this.\u0275fac=function(s){return new(s||e)(oe(On),oe(jo),oe(tp,10),oe(YU,8),oe(XO,8),oe(YJ),oe(tee,10),oe(uQ),oe(ft),oe(WK,8))}}static{this.\u0275dir=Ue({type:e,selectors:[["input","matInput",""],["textarea","matInput",""],["select","matNativeControl",""],["input","matNativeControl",""],["textarea","matNativeControl",""]],hostAttrs:[1,"mat-mdc-input-element"],hostVars:18,hostBindings:function(s,c){1&s&&Mn("focus",function(){return c._focusChanged(!0)})("blur",function(){return c._focusChanged(!1)})("input",function(){return c._onInput()}),2&s&&(O_("id",c.id)("disabled",c.disabled)("required",c.required),Jr("name",c.name||null)("readonly",c.readonly&&!c._isNativeSelect||null)("aria-invalid",c.empty&&c.required?null:c.errorState)("aria-required",c.required)("id",c.id),nt("mat-input-server",c._isServer)("mat-mdc-form-field-textarea-control",c._isInFormField&&c._isTextarea)("mat-mdc-form-field-input-control",c._isInFormField)("mdc-text-field__input",c._isInFormField)("mat-mdc-native-select-inline",c._isInlineSelect()))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:[0,"aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["matInput"],standalone:!0,features:[mn([{provide:GK,useExisting:e}]),$o]})}}return e})(),oee=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=ii({type:e})}static{this.\u0275inj=qr({imports:[Uc,YK,YK,hQ,Uc]})}}return e})();const see=["switch"],aee=["*"];function cee(e,n){1&e&&(Se(0,"span",10),_a(),Se(1,"svg",12),At(2,"path",13),Be(),Se(3,"svg",14),At(4,"path",15),Be()())}const lee=new Te("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1,hideIcon:!1,disabledInteractive:!1})}),dee={provide:ql,useExisting:Fn(()=>gG),multi:!0};class $K{constructor(n,t){this.source=n,this.checked=t}}let uee=0,gG=(()=>{class e{_createChangeEvent(t){return new $K(this,t)}get buttonId(){return`${this.id||this._uniqueId}-button`}focus(){this._switchElement.nativeElement.focus()}get checked(){return this._checked}set checked(t){this._checked=t,this._changeDetectorRef.markForCheck()}get inputId(){return`${this.id||this._uniqueId}-input`}constructor(t,s,c,u,p,_){this._elementRef=t,this._focusMonitor=s,this._changeDetectorRef=c,this.defaults=p,this._onChange=E=>{},this._onTouched=()=>{},this._validatorOnChange=()=>{},this._checked=!1,this.name=null,this.labelPosition="after",this.ariaLabel=null,this.ariaLabelledby=null,this.disabled=!1,this.disableRipple=!1,this.tabIndex=0,this.change=new Dn,this.toggleChange=new Dn,this.tabIndex=parseInt(u)||0,this.color=p.color||"accent",this._noopAnimations="NoopAnimations"===_,this.id=this._uniqueId="mat-mdc-slide-toggle-"+ ++uee,this.hideIcon=p.hideIcon??!1,this.disabledInteractive=p.disabledInteractive??!1,this._labelId=this._uniqueId+"-label"}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{"keyboard"===t||"program"===t?(this._focused=!0,this._changeDetectorRef.markForCheck()):t||Promise.resolve().then(()=>{this._focused=!1,this._onTouched(),this._changeDetectorRef.markForCheck()})})}ngOnChanges(t){t.required&&this._validatorOnChange()}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}writeValue(t){this.checked=!!t}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}validate(t){return this.required&&!0!==t.value?{required:!0}:null}registerOnValidatorChange(t){this._validatorOnChange=t}setDisabledState(t){this.disabled=t,this._changeDetectorRef.markForCheck()}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(this._createChangeEvent(this.checked))}_handleClick(){this.disabled||(this.toggleChange.emit(),this.defaults.disableToggleValue||(this.checked=!this.checked,this._onChange(this.checked),this.change.emit(new $K(this,this.checked))))}_getAriaLabelledBy(){return this.ariaLabelledby?this.ariaLabelledby:this.ariaLabel?null:this._labelId}static{this.\u0275fac=function(s){return new(s||e)(oe(On),oe(lG),oe(Js),function Pp(e){return function gP(e,n){if("class"===n)return e.classes;if("style"===n)return e.styles;const t=e.attrs;if(t){const s=t.length;let c=0;for(;c<s;){const u=t[c];if(MN(u))break;if(0===u)c+=2;else if("number"==typeof u)for(c++;c<s&&"string"==typeof t[c];)c++;else{if(u===n)return t[c+1];c+=2}}}return null}(Un(),e)}("tabindex"),oe(lee),oe(nl,8))}}static{this.\u0275cmp=eo({type:e,selectors:[["mat-slide-toggle"]],viewQuery:function(s,c){if(1&s&&pe(see,5),2&s){let u;ci(u=kn())&&(c._switchElement=u.first)}},hostAttrs:[1,"mat-mdc-slide-toggle"],hostVars:13,hostBindings:function(s,c){2&s&&(O_("id",c.id),Jr("tabindex",null)("aria-label",null)("name",null)("aria-labelledby",null),dS(c.color?"mat-"+c.color:""),nt("mat-mdc-slide-toggle-focused",c._focused)("mat-mdc-slide-toggle-checked",c.checked)("_mat-animation-noopable",c._noopAnimations))},inputs:{name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[0,"aria-describedby","ariaDescribedby"],required:[2,"required","required",zi],color:"color",disabled:[2,"disabled","disabled",zi],disableRipple:[2,"disableRipple","disableRipple",zi],tabIndex:[2,"tabIndex","tabIndex",t=>null==t?0:function Xx(e,n=NaN){return isNaN(parseFloat(e))||isNaN(Number(e))?n:Number(e)}(t)],checked:[2,"checked","checked",zi],hideIcon:[2,"hideIcon","hideIcon",zi],disabledInteractive:[2,"disabledInteractive","disabledInteractive",zi]},outputs:{change:"change",toggleChange:"toggleChange"},exportAs:["matSlideToggle"],standalone:!0,features:[mn([dee,{provide:vo,useExisting:e,multi:!0}]),a_,$o,ho],ngContentSelectors:aee,decls:13,vars:27,consts:[["switch",""],["mat-internal-form-field","",3,"labelPosition"],["role","switch","type","button",1,"mdc-switch",3,"click","tabIndex","disabled"],[1,"mdc-switch__track"],[1,"mdc-switch__handle-track"],[1,"mdc-switch__handle"],[1,"mdc-switch__shadow"],[1,"mdc-elevation-overlay"],[1,"mdc-switch__ripple"],["mat-ripple","",1,"mat-mdc-slide-toggle-ripple","mat-mdc-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],[1,"mdc-switch__icons"],[1,"mdc-label",3,"click","for"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--on"],["d","M19.69,5.23L8.96,15.96l-4.23-4.23L2.96,13.5l6,6L21.46,7L19.69,5.23z"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--off"],["d","M20 13H4v-2h16v2z"]],template:function(s,c){if(1&s){const u=Sc();Of(),Se(0,"div",1)(1,"button",2,0),Mn("click",function(){return Xo(u),ro(c._handleClick())}),At(3,"span",3),Se(4,"span",4)(5,"span",5)(6,"span",6),At(7,"span",7),Be(),Se(8,"span",8),At(9,"span",9),Be(),br(10,cee,5,0,"span",10),Be()()(),Se(11,"label",11),Mn("click",function(_){return Xo(u),ro(_.stopPropagation())}),co(12),Be()()}if(2&s){const u=Ie(2);$e("labelPosition",c.labelPosition),Ze(),nt("mdc-switch--selected",c.checked)("mdc-switch--unselected",!c.checked)("mdc-switch--checked",c.checked)("mdc-switch--disabled",c.disabled)("mat-mdc-slide-toggle-disabled-interactive",c.disabledInteractive),$e("tabIndex",c.disabled&&!c.disabledInteractive?-1:c.tabIndex)("disabled",c.disabled&&!c.disabledInteractive),Jr("id",c.buttonId)("name",c.name)("aria-label",c.ariaLabel)("aria-labelledby",c._getAriaLabelledBy())("aria-describedby",c.ariaDescribedby)("aria-required",c.required||null)("aria-checked",c.checked)("aria-disabled",c.disabled&&c.disabledInteractive?"true":null),Ze(8),$e("matRippleTrigger",u)("matRippleDisabled",c.disableRipple||c.disabled)("matRippleCentered",!0),Ze(),st(c.hideIcon?-1:10),Ze(),$e("for",c.buttonId),Jr("id",c._labelId)}},dependencies:[NK,tQ],styles:['.mdc-switch{align-items:center;background:none;border:none;cursor:pointer;display:inline-flex;flex-shrink:0;margin:0;outline:none;overflow:visible;padding:0;position:relative;width:var(--mdc-switch-track-width)}.mdc-switch.mdc-switch--disabled{cursor:default;pointer-events:none}.mdc-switch.mat-mdc-slide-toggle-disabled-interactive{pointer-events:auto}.mdc-switch__track{overflow:hidden;position:relative;width:100%;height:var(--mdc-switch-track-height);border-radius:var(--mdc-switch-track-shape, var(--mat-app-corner-full))}.mdc-switch--disabled.mdc-switch .mdc-switch__track{opacity:var(--mdc-switch-disabled-track-opacity)}.mdc-switch__track::before,.mdc-switch__track::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";height:100%;left:0;position:absolute;width:100%;border-width:var(--mat-switch-track-outline-width);border-color:var(--mat-switch-track-outline-color, var(--mat-app-outline))}.cdk-high-contrast-active .mdc-switch__track::before,.cdk-high-contrast-active .mdc-switch__track::after{border-color:currentColor}.mdc-switch--selected .mdc-switch__track::before,.mdc-switch--selected .mdc-switch__track::after{border-width:var(--mat-switch-selected-track-outline-width);border-color:var(--mat-switch-selected-track-outline-color)}.mdc-switch--disabled .mdc-switch__track::before,.mdc-switch--disabled .mdc-switch__track::after{border-width:var(--mat-switch-disabled-unselected-track-outline-width);border-color:var(--mat-switch-disabled-unselected-track-outline-color, var(--mat-app-on-surface))}.mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0);background:var(--mdc-switch-unselected-track-color, var(--mat-app-surface-variant))}.mdc-switch--selected .mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch--selected .mdc-switch__track::before{transform:translateX(-100%)}.mdc-switch--selected .mdc-switch__track::before{opacity:var(--mat-switch-hidden-track-opacity);transition:var(--mat-switch-hidden-track-transition)}.mdc-switch--unselected .mdc-switch__track::before{opacity:var(--mat-switch-visible-track-opacity);transition:var(--mat-switch-visible-track-transition)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-hover-track-color, var(--mat-app-surface-variant))}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-focus-track-color, var(--mat-app-surface-variant))}.mdc-switch:enabled:active .mdc-switch__track::before{background:var(--mdc-switch-unselected-pressed-track-color, var(--mat-app-surface-variant))}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:hover:not(:focus):not(:active) .mdc-switch__track::before,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:focus:not(:active) .mdc-switch__track::before,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:active .mdc-switch__track::before,.mdc-switch.mdc-switch--disabled .mdc-switch__track::before{background:var(--mdc-switch-disabled-unselected-track-color, var(--mat-app-surface-variant))}.mdc-switch__track::after{transform:translateX(-100%);background:var(--mdc-switch-selected-track-color, var(--mat-app-primary))}[dir=rtl] .mdc-switch__track::after{transform:translateX(100%)}.mdc-switch--selected .mdc-switch__track::after{transform:translateX(0)}.mdc-switch--selected .mdc-switch__track::after{opacity:var(--mat-switch-visible-track-opacity);transition:var(--mat-switch-visible-track-transition)}.mdc-switch--unselected .mdc-switch__track::after{opacity:var(--mat-switch-hidden-track-opacity);transition:var(--mat-switch-hidden-track-transition)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-hover-track-color, var(--mat-app-primary))}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-focus-track-color, var(--mat-app-primary))}.mdc-switch:enabled:active .mdc-switch__track::after{background:var(--mdc-switch-selected-pressed-track-color, var(--mat-app-primary))}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:hover:not(:focus):not(:active) .mdc-switch__track::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:focus:not(:active) .mdc-switch__track::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:active .mdc-switch__track::after,.mdc-switch.mdc-switch--disabled .mdc-switch__track::after{background:var(--mdc-switch-disabled-selected-track-color, var(--mat-app-on-surface))}.mdc-switch__handle-track{height:100%;pointer-events:none;position:absolute;top:0;transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);left:0;right:auto;transform:translateX(0);width:calc(100% - var(--mdc-switch-handle-width))}[dir=rtl] .mdc-switch__handle-track{left:auto;right:0}.mdc-switch--selected .mdc-switch__handle-track{transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__handle-track{transform:translateX(-100%)}.mdc-switch__handle{display:flex;pointer-events:auto;position:absolute;top:50%;transform:translateY(-50%);left:0;right:auto;transition:width 75ms cubic-bezier(0.4, 0, 0.2, 1),height 75ms cubic-bezier(0.4, 0, 0.2, 1),margin 75ms cubic-bezier(0.4, 0, 0.2, 1);width:var(--mdc-switch-handle-width);height:var(--mdc-switch-handle-height);border-radius:var(--mdc-switch-handle-shape, var(--mat-app-corner-full))}[dir=rtl] .mdc-switch__handle{left:auto;right:0}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle{width:var(--mat-switch-unselected-handle-size);height:var(--mat-switch-unselected-handle-size);margin:var(--mat-switch-unselected-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-unselected-with-icon-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle{width:var(--mat-switch-selected-handle-size);height:var(--mat-switch-selected-handle-size);margin:var(--mat-switch-selected-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-selected-with-icon-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch__handle:has(.mdc-switch__icons){width:var(--mat-switch-with-icon-handle-size);height:var(--mat-switch-with-icon-handle-size)}.mat-mdc-slide-toggle .mdc-switch:active:not(.mdc-switch--disabled) .mdc-switch__handle{width:var(--mat-switch-pressed-handle-size);height:var(--mat-switch-pressed-handle-size)}.mat-mdc-slide-toggle .mdc-switch--selected:active:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-selected-pressed-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--unselected:active:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-unselected-pressed-handle-horizontal-margin)}.mdc-switch--disabled.mdc-switch--selected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-selected-handle-opacity)}.mdc-switch--disabled.mdc-switch--unselected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-unselected-handle-opacity)}.mdc-switch__handle::before,.mdc-switch__handle::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";width:100%;height:100%;left:0;position:absolute;top:0;transition:background-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1),border-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);z-index:-1}.cdk-high-contrast-active .mdc-switch__handle::before,.cdk-high-contrast-active .mdc-switch__handle::after{border-color:currentColor}.mdc-switch--selected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-selected-handle-color, var(--mat-app-on-primary))}.mdc-switch--selected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-hover-handle-color, var(--mat-app-primary-container))}.mdc-switch--selected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-focus-handle-color, var(--mat-app-primary-container))}.mdc-switch--selected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-selected-pressed-handle-color, var(--mat-app-primary-container))}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled.mdc-switch--selected:hover:not(:focus):not(:active) .mdc-switch__handle::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled.mdc-switch--selected:focus:not(:active) .mdc-switch__handle::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled.mdc-switch--selected:active .mdc-switch__handle::after,.mdc-switch--selected.mdc-switch--disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-selected-handle-color, var(--mat-app-surface))}.mdc-switch--unselected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-unselected-handle-color, var(--mat-app-outline))}.mdc-switch--unselected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-hover-handle-color, var(--mat-app-on-surface-variant))}.mdc-switch--unselected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-focus-handle-color, var(--mat-app-on-surface-variant))}.mdc-switch--unselected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-unselected-pressed-handle-color, var(--mat-app-on-surface-variant))}.mdc-switch--unselected.mdc-switch--disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-unselected-handle-color, var(--mat-app-on-surface))}.mdc-switch__handle::before{background:var(--mdc-switch-handle-surface-color)}.mdc-switch__shadow{border-radius:inherit;bottom:0;left:0;position:absolute;right:0;top:0}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation-shadow)}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:hover:not(:focus):not(:active) .mdc-switch__shadow,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:focus:not(:active) .mdc-switch__shadow,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:active .mdc-switch__shadow,.mdc-switch.mdc-switch--disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation-shadow)}.mdc-switch__ripple{left:50%;position:absolute;top:50%;transform:translate(-50%, -50%);z-index:-1;width:var(--mdc-switch-state-layer-size);height:var(--mdc-switch-state-layer-size)}.mdc-switch__ripple::after{content:"";opacity:0}.mdc-switch--disabled .mdc-switch__ripple::after{display:none}.mat-mdc-slide-toggle-disabled-interactive .mdc-switch__ripple::after{display:block}.mdc-switch:hover .mdc-switch__ripple::after{opacity:.04;transition:75ms opacity cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mdc-switch .mdc-switch__ripple::after{opacity:.12}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:enabled:focus .mdc-switch__ripple::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:enabled:active .mdc-switch__ripple::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:enabled:hover:not(:focus) .mdc-switch__ripple::after,.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background:var(--mdc-switch-unselected-hover-state-layer-color, var(--mat-app-on-surface))}.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::after{background:var(--mdc-switch-unselected-focus-state-layer-color, var(--mat-app-on-surface))}.mdc-switch--unselected:enabled:active .mdc-switch__ripple::after{background:var(--mdc-switch-unselected-pressed-state-layer-color, var(--mat-app-on-surface));opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity, var(--mat-app-pressed-state-layer-opacity));transition:opacity 75ms linear}.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background:var(--mdc-switch-selected-hover-state-layer-color, var(--mat-app-primary))}.mdc-switch--selected:enabled:focus .mdc-switch__ripple::after{background:var(--mdc-switch-selected-focus-state-layer-color, var(--mat-app-primary))}.mdc-switch--selected:enabled:active .mdc-switch__ripple::after{background:var(--mdc-switch-selected-pressed-state-layer-color, var(--mat-app-primary));opacity:var(--mdc-switch-selected-pressed-state-layer-opacity, var(--mat-app-pressed-state-layer-opacity));transition:opacity 75ms linear}.mdc-switch__icons{position:relative;height:100%;width:100%;z-index:1}.mdc-switch--disabled.mdc-switch--unselected .mdc-switch__icons{opacity:var(--mdc-switch-disabled-unselected-icon-opacity)}.mdc-switch--disabled.mdc-switch--selected .mdc-switch__icons{opacity:var(--mdc-switch-disabled-selected-icon-opacity)}.mdc-switch__icon{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0;opacity:0;transition:opacity 30ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-switch--unselected .mdc-switch__icon{width:var(--mdc-switch-unselected-icon-size);height:var(--mdc-switch-unselected-icon-size);fill:var(--mdc-switch-unselected-icon-color, var(--mat-app-surface-variant))}.mdc-switch--unselected.mdc-switch--disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-unselected-icon-color, var(--mat-app-surface-variant))}.mdc-switch--selected .mdc-switch__icon{width:var(--mdc-switch-selected-icon-size);height:var(--mdc-switch-selected-icon-size);fill:var(--mdc-switch-selected-icon-color, var(--mat-app-on-primary-container))}.mdc-switch--selected.mdc-switch--disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-selected-icon-color, var(--mat-app-on-surface))}.mdc-switch--selected .mdc-switch__icon--on,.mdc-switch--unselected .mdc-switch__icon--off{opacity:1;transition:opacity 45ms 30ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle{-webkit-user-select:none;user-select:none;display:inline-block;-webkit-tap-highlight-color:rgba(0,0,0,0);outline:0}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple,.mat-mdc-slide-toggle .mdc-switch__ripple::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:50%;pointer-events:none}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple:not(:empty),.mat-mdc-slide-toggle .mdc-switch__ripple::after:not(:empty){transform:translateZ(0)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mat-mdc-focus-indicator::before{content:""}.mat-mdc-slide-toggle .mat-internal-form-field{color:var(--mat-switch-label-text-color, var(--mat-app-on-surface));font-family:var(--mat-switch-label-text-font, var(--mat-app-body-medium-font));line-height:var(--mat-switch-label-text-line-height, var(--mat-app-body-medium-line-height));font-size:var(--mat-switch-label-text-size, var(--mat-app-body-medium-size));letter-spacing:var(--mat-switch-label-text-tracking, var(--mat-app-body-medium-tracking));font-weight:var(--mat-switch-label-text-weight, var(--mat-app-body-medium-weight))}.mat-mdc-slide-toggle .mat-ripple-element{opacity:.12}.mat-mdc-slide-toggle .mat-mdc-focus-indicator::before{border-radius:50%}.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle-track,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__icon,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::after,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::after{transition:none}.mat-mdc-slide-toggle .mdc-switch:enabled+.mdc-label{cursor:pointer}.mat-mdc-slide-toggle .mdc-switch--disabled+label{color:var(--mdc-switch-disabled-label-text-color)}'],encapsulation:2,changeDetection:0})}}return e})(),fee=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=ii({type:e})}static{this.\u0275inj=qr({imports:[gG,Uc,Uc]})}}return e})();const mee=["addListener","removeListener"],gee=["addEventListener","removeEventListener"],_ee=["on","off"];function _G(e,n,t,s){if(vn(t)&&(s=t,t=void 0),s)return _G(e,n,t).pipe(dO(s));const[c,u]=function yee(e){return vn(e.addEventListener)&&vn(e.removeEventListener)}(e)?gee.map(p=>_=>e[p](n,_,t)):function vee(e){return vn(e.addListener)&&vn(e.removeListener)}(e)?mee.map(XK(e,n)):function Eee(e){return vn(e.on)&&vn(e.off)}(e)?_ee.map(XK(e,n)):[];if(!c&&nO(e))return _o(p=>_G(p,n,t))(go(e));if(!c)throw new TypeError("Invalid event target");return new nr(p=>{const _=(...E)=>p.next(1<E.length?E:E[0]);return c(_),()=>u(_)})}function XK(e,n){return t=>s=>e[t](n,s)}const nN={schedule(e){let n=requestAnimationFrame,t=cancelAnimationFrame;const{delegate:s}=nN;s&&(n=s.requestAnimationFrame,t=s.cancelAnimationFrame);const c=n(u=>{t=void 0,e(u)});return new Ur(()=>t?.(c))},requestAnimationFrame(...e){const{delegate:n}=nN;return(n?.requestAnimationFrame||requestAnimationFrame)(...e)},cancelAnimationFrame(...e){const{delegate:n}=nN;return(n?.cancelAnimationFrame||cancelAnimationFrame)(...e)},delegate:void 0};new class See extends oG{flush(n){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:s}=this;let c;n=n||s.shift();do{if(c=n.execute(n.state,n.delay))break}while((n=s[0])&&n.id===t&&s.shift());if(this._active=!1,c){for(;(n=s[0])&&n.id===t&&s.shift();)n.unsubscribe();throw c}}}(class bee extends rG{constructor(n,t){super(n,t),this.scheduler=n,this.work=t}requestAsyncId(n,t,s=0){return null!==s&&s>0?super.requestAsyncId(n,t,s):(n.actions.push(this),n._scheduled||(n._scheduled=nN.requestAnimationFrame(()=>n.flush(void 0))))}recycleAsyncId(n,t,s=0){var c;if(null!=s?s>0:this.delay>0)return super.recycleAsyncId(n,t,s);const{actions:u}=n;null!=t&&(null===(c=u[u.length-1])||void 0===c?void 0:c.id)!==t&&(nN.cancelAnimationFrame(t),n._scheduled=void 0)}});let vG,Tee=1;const oV={};function ZK(e){return e in oV&&(delete oV[e],!0)}const wee={setImmediate(e){const n=Tee++;return oV[n]=!0,vG||(vG=Promise.resolve()),vG.then(()=>ZK(n)&&e()),n},clearImmediate(e){ZK(e)}},{setImmediate:Iee,clearImmediate:Ree}=wee,sV={setImmediate(...e){const{delegate:n}=sV;return(n?.setImmediate||Iee)(...e)},clearImmediate(e){const{delegate:n}=sV;return(n?.clearImmediate||Ree)(e)},delegate:void 0};new class Dee extends oG{flush(n){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:s}=this;let c;n=n||s.shift();do{if(c=n.execute(n.state,n.delay))break}while((n=s[0])&&n.id===t&&s.shift());if(this._active=!1,c){for(;(n=s[0])&&n.id===t&&s.shift();)n.unsubscribe();throw c}}}(class Aee extends rG{constructor(n,t){super(n,t),this.scheduler=n,this.work=t}requestAsyncId(n,t,s=0){return null!==s&&s>0?super.requestAsyncId(n,t,s):(n.actions.push(this),n._scheduled||(n._scheduled=sV.setImmediate(n.flush.bind(n,void 0))))}recycleAsyncId(n,t,s=0){var c;if(null!=s?s>0:this.delay>0)return super.recycleAsyncId(n,t,s);const{actions:u}=n;null!=t&&(null===(c=u[u.length-1])||void 0===c?void 0:c.id)!==t&&(sV.clearImmediate(t),n._scheduled===t&&(n._scheduled=void 0))}});function JK(e,n=sG){return function Nee(e){return Cr((n,t)=>{let s=!1,c=null,u=null,p=!1;const _=()=>{if(u?.unsubscribe(),u=null,s){s=!1;const S=c;c=null,t.next(S)}p&&t.complete()},E=()=>{u=null,p&&t.complete()};n.subscribe(Er(t,S=>{s=!0,c=S,u||go(e(S)).subscribe(u=Er(t,_,E))},()=>{p=!0,(!s||!u||u.closed)&&t.complete()}))})}(()=>function Mee(e=0,n,t=sJ){let s=-1;return null!=n&&(cO(n)?t=n:s=n),new nr(c=>{let u=function Pee(e){return e instanceof Date&&!isNaN(e)}(e)?+e-t.now():e;u<0&&(u=0);let p=0;return t.schedule(function(){c.closed||(c.next(p++),0<=s?this.schedule(void 0,s):c.complete())},u)})}(e,n))}let QK=(()=>{class e{constructor(t,s,c){this._ngZone=t,this._platform=s,this._scrolled=new Gt,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=c}register(t){this.scrollContainers.has(t)||this.scrollContainers.set(t,t.elementScrolled().subscribe(()=>this._scrolled.next(t)))}deregister(t){const s=this.scrollContainers.get(t);s&&(s.unsubscribe(),this.scrollContainers.delete(t))}scrolled(t=20){return this._platform.isBrowser?new nr(s=>{this._globalSubscription||this._addGlobalListener();const c=t>0?this._scrolled.pipe(JK(t)).subscribe(s):this._scrolled.subscribe(s);return this._scrolledCount++,()=>{c.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):Et()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((t,s)=>this.deregister(s)),this._scrolled.complete()}ancestorScrolled(t,s){const c=this.getAncestorScrollContainers(t);return this.scrolled(s).pipe(Ns(u=>!u||c.indexOf(u)>-1))}getAncestorScrollContainers(t){const s=[];return this.scrollContainers.forEach((c,u)=>{this._scrollableContainsElement(u,t)&&s.push(u)}),s}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(t,s){let c=Sm(s),u=t.getElementRef().nativeElement;do{if(c==u)return!0}while(c=c.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>_G(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}static{this.\u0275fac=function(s){return new(s||e)(ye(ft),ye(jo),ye(Ve,8))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),eq=(()=>{class e{constructor(t,s,c){this._platform=t,this._change=new Gt,this._changeListener=u=>{this._change.next(u)},this._document=c,s.runOutsideAngular(()=>{if(t.isBrowser){const u=this._getWindow();u.addEventListener("resize",this._changeListener),u.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const t=this._getWindow();t.removeEventListener("resize",this._changeListener),t.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const t={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),t}getViewportRect(){const t=this.getViewportScrollPosition(),{width:s,height:c}=this.getViewportSize();return{top:t.top,left:t.left,bottom:t.top+c,right:t.left+s,height:c,width:s}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const t=this._document,s=this._getWindow(),c=t.documentElement,u=c.getBoundingClientRect();return{top:-u.top||t.body.scrollTop||s.scrollY||c.scrollTop||0,left:-u.left||t.body.scrollLeft||s.scrollX||c.scrollLeft||0}}change(t=20){return t>0?this._change.pipe(JK(t)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const t=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:t.innerWidth,height:t.innerHeight}:{width:0,height:0}}static{this.\u0275fac=function(s){return new(s||e)(ye(jo),ye(ft),ye(Ve,8))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),EG=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=ii({type:e})}static{this.\u0275inj=qr({})}}return e})(),tq=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=ii({type:e})}static{this.\u0275inj=qr({imports:[eN,EG,eN,EG]})}}return e})();class yG{attach(n){return this._attachedHost=n,n.attach(this)}detach(){let n=this._attachedHost;null!=n&&(this._attachedHost=null,n.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(n){this._attachedHost=n}}class nq extends yG{constructor(n,t,s,c,u){super(),this.component=n,this.viewContainerRef=t,this.injector=s,this.componentFactoryResolver=c,this.projectableNodes=u}}class xee extends yG{constructor(n,t,s,c){super(),this.templateRef=n,this.viewContainerRef=t,this.context=s,this.injector=c}get origin(){return this.templateRef.elementRef}attach(n,t=this.context){return this.context=t,super.attach(n)}detach(){return this.context=void 0,super.detach()}}class Fee extends yG{constructor(n){super(),this.element=n instanceof On?n.nativeElement:n}}class Uee{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(n){return n instanceof nq?(this._attachedPortal=n,this.attachComponentPortal(n)):n instanceof xee?(this._attachedPortal=n,this.attachTemplatePortal(n)):this.attachDomPortal&&n instanceof Fee?(this._attachedPortal=n,this.attachDomPortal(n)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(n){this._disposeFn=n}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class Vee extends Uee{constructor(n,t,s,c,u){super(),this.outletElement=n,this._componentFactoryResolver=t,this._appRef=s,this._defaultInjector=c,this.attachDomPortal=p=>{const _=p.element,E=this._document.createComment("dom-portal");_.parentNode.insertBefore(E,_),this.outletElement.appendChild(_),this._attachedPortal=p,super.setDisposeFn(()=>{E.parentNode&&E.parentNode.replaceChild(_,E)})},this._document=u}attachComponentPortal(n){const s=(n.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(n.component);let c;return n.viewContainerRef?(c=n.viewContainerRef.createComponent(s,n.viewContainerRef.length,n.injector||n.viewContainerRef.injector,n.projectableNodes||void 0),this.setDisposeFn(()=>c.destroy())):(c=s.create(n.injector||this._defaultInjector||Dr.NULL),this._appRef.attachView(c.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(c.hostView),c.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(c)),this._attachedPortal=n,c}attachTemplatePortal(n){let t=n.viewContainerRef,s=t.createEmbeddedView(n.templateRef,n.context,{injector:n.injector});return s.rootNodes.forEach(c=>this.outletElement.appendChild(c)),s.detectChanges(),this.setDisposeFn(()=>{let c=t.indexOf(s);-1!==c&&t.remove(c)}),this._attachedPortal=n,s}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(n){return n.hostView.rootNodes[0]}}let Bee=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=ii({type:e})}static{this.\u0275inj=qr({})}}return e})();const rq=FZ();class jee{constructor(n,t){this._viewportRuler=n,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=t}attach(){}enable(){if(this._canBeEnabled()){const n=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=n.style.left||"",this._previousHTMLStyles.top=n.style.top||"",n.style.left=xi(-this._previousScrollPosition.left),n.style.top=xi(-this._previousScrollPosition.top),n.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const n=this._document.documentElement,s=n.style,c=this._document.body.style,u=s.scrollBehavior||"",p=c.scrollBehavior||"";this._isEnabled=!1,s.left=this._previousHTMLStyles.left,s.top=this._previousHTMLStyles.top,n.classList.remove("cdk-global-scrollblock"),rq&&(s.scrollBehavior=c.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),rq&&(s.scrollBehavior=u,c.scrollBehavior=p)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const t=this._document.body,s=this._viewportRuler.getViewportSize();return t.scrollHeight>s.height||t.scrollWidth>s.width}}class Hee{constructor(n,t,s,c){this._scrollDispatcher=n,this._ngZone=t,this._viewportRuler=s,this._config=c,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(n){this._overlayRef=n}enable(){if(this._scrollSubscription)return;const n=this._scrollDispatcher.scrolled(0).pipe(Ns(t=>!t||!this._overlayRef.overlayElement.contains(t.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=n.subscribe(()=>{const t=this._viewportRuler.getViewportScrollPosition().top;Math.abs(t-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=n.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class iq{enable(){}disable(){}attach(){}}function bG(e,n){return n.some(t=>e.bottom<t.top||e.top>t.bottom||e.right<t.left||e.left>t.right)}function oq(e,n){return n.some(t=>e.top<t.top||e.bottom>t.bottom||e.left<t.left||e.right>t.right)}class Gee{constructor(n,t,s,c){this._scrollDispatcher=n,this._viewportRuler=t,this._ngZone=s,this._config=c,this._scrollSubscription=null}attach(n){this._overlayRef=n}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const t=this._overlayRef.overlayElement.getBoundingClientRect(),{width:s,height:c}=this._viewportRuler.getViewportSize();bG(t,[{width:s,height:c,bottom:c,right:s,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let Wee=(()=>{class e{constructor(t,s,c,u){this._scrollDispatcher=t,this._viewportRuler=s,this._ngZone=c,this.noop=()=>new iq,this.close=p=>new Hee(this._scrollDispatcher,this._ngZone,this._viewportRuler,p),this.block=()=>new jee(this._viewportRuler,this._document),this.reposition=p=>new Gee(this._scrollDispatcher,this._viewportRuler,this._ngZone,p),this._document=u}static{this.\u0275fac=function(s){return new(s||e)(ye(QK),ye(eq),ye(ft),ye(Ve))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();class zee{constructor(n){if(this.scrollStrategy=new iq,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,n){const t=Object.keys(n);for(const s of t)void 0!==n[s]&&(this[s]=n[s])}}}class Kee{constructor(n,t){this.connectionPair=n,this.scrollableViewProperties=t}}let sq=(()=>{class e{constructor(t){this._attachedOverlays=[],this._document=t}ngOnDestroy(){this.detach()}add(t){this.remove(t),this._attachedOverlays.push(t)}remove(t){const s=this._attachedOverlays.indexOf(t);s>-1&&this._attachedOverlays.splice(s,1),0===this._attachedOverlays.length&&this.detach()}static{this.\u0275fac=function(s){return new(s||e)(ye(Ve))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),qee=(()=>{class e extends sq{constructor(t,s){super(t),this._ngZone=s,this._keydownListener=c=>{const u=this._attachedOverlays;for(let p=u.length-1;p>-1;p--)if(u[p]._keydownEvents.observers.length>0){const _=u[p]._keydownEvents;this._ngZone?this._ngZone.run(()=>_.next(c)):_.next(c);break}}}add(t){super.add(t),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}static{this.\u0275fac=function(s){return new(s||e)(ye(Ve),ye(ft,8))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Yee=(()=>{class e extends sq{constructor(t,s,c){super(t),this._platform=s,this._ngZone=c,this._cursorStyleIsSet=!1,this._pointerDownListener=u=>{this._pointerDownEventTarget=np(u)},this._clickListener=u=>{const p=np(u),_="click"===u.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:p;this._pointerDownEventTarget=null;const E=this._attachedOverlays.slice();for(let S=E.length-1;S>-1;S--){const w=E[S];if(w._outsidePointerEvents.observers.length<1||!w.hasAttached())continue;if(aq(w.overlayElement,p)||aq(w.overlayElement,_))break;const D=w._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>D.next(u)):D.next(u)}}}add(t){if(super.add(t),!this._isAttached){const s=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(s)):this._addEventListeners(s),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=s.style.cursor,s.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const t=this._document.body;t.removeEventListener("pointerdown",this._pointerDownListener,!0),t.removeEventListener("click",this._clickListener,!0),t.removeEventListener("auxclick",this._clickListener,!0),t.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(t.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(t){t.addEventListener("pointerdown",this._pointerDownListener,!0),t.addEventListener("click",this._clickListener,!0),t.addEventListener("auxclick",this._clickListener,!0),t.addEventListener("contextmenu",this._clickListener,!0)}static{this.\u0275fac=function(s){return new(s||e)(ye(Ve),ye(jo),ye(ft,8))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function aq(e,n){const t=typeof ShadowRoot<"u"&&ShadowRoot;let s=n;for(;s;){if(s===e)return!0;s=t&&s instanceof ShadowRoot?s.host:s.parentNode}return!1}let cq=(()=>{class e{constructor(t,s){this._platform=s,this._document=t}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const t="cdk-overlay-container";if(this._platform.isBrowser||nG()){const c=this._document.querySelectorAll(`.${t}[platform="server"], .${t}[platform="test"]`);for(let u=0;u<c.length;u++)c[u].remove()}const s=this._document.createElement("div");s.classList.add(t),nG()?s.setAttribute("platform","test"):this._platform.isBrowser||s.setAttribute("platform","server"),this._document.body.appendChild(s),this._containerElement=s}static{this.\u0275fac=function(s){return new(s||e)(ye(Ve),ye(jo))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();class $ee{constructor(n,t,s,c,u,p,_,E,S,w=!1,D){this._portalOutlet=n,this._host=t,this._pane=s,this._config=c,this._ngZone=u,this._keyboardDispatcher=p,this._document=_,this._location=E,this._outsideClickDispatcher=S,this._animationsDisabled=w,this._injector=D,this._backdropElement=null,this._backdropClick=new Gt,this._attachments=new Gt,this._detachments=new Gt,this._locationChanges=Ur.EMPTY,this._backdropClickHandler=U=>this._backdropClick.next(U),this._backdropTransitionendHandler=U=>{this._disposeBackdrop(U.target)},this._keydownEvents=new Gt,this._outsidePointerEvents=new Gt,this._renders=new Gt,c.scrollStrategy&&(this._scrollStrategy=c.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=c.positionStrategy,this._afterRenderRef=Qs(()=>rh(()=>{this._renders.next()},{injector:this._injector}))}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(n){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const t=this._portalOutlet.attach(n);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._afterNextRenderRef?.destroy(),this._afterNextRenderRef=mf(()=>{this.hasAttached()&&this.updatePosition()},{injector:this._injector}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof t?.onDestroy&&t.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),t}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const n=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenEmpty(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),n}dispose(){const n=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._afterNextRenderRef?.destroy(),this._previousHostParent=this._pane=this._host=null,n&&this._detachments.next(),this._detachments.complete(),this._afterRenderRef.destroy(),this._renders.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(n){n!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=n,this.hasAttached()&&(n.attach(this),this.updatePosition()))}updateSize(n){this._config={...this._config,...n},this._updateElementSize()}setDirection(n){this._config={...this._config,direction:n},this._updateElementDirection()}addPanelClass(n){this._pane&&this._toggleClasses(this._pane,n,!0)}removePanelClass(n){this._pane&&this._toggleClasses(this._pane,n,!1)}getDirection(){const n=this._config.direction;return n?"string"==typeof n?n:n.value:"ltr"}updateScrollStrategy(n){n!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=n,this.hasAttached()&&(n.attach(this),n.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const n=this._pane.style;n.width=xi(this._config.width),n.height=xi(this._config.height),n.minWidth=xi(this._config.minWidth),n.minHeight=xi(this._config.minHeight),n.maxWidth=xi(this._config.maxWidth),n.maxHeight=xi(this._config.maxHeight)}_togglePointerEvents(n){this._pane.style.pointerEvents=n?"":"none"}_attachBackdrop(){const n="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(n)})}):this._backdropElement.classList.add(n)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const n=this._backdropElement;if(n){if(this._animationsDisabled)return void this._disposeBackdrop(n);n.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{n.addEventListener("transitionend",this._backdropTransitionendHandler)}),n.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(n)},500))}}_toggleClasses(n,t,s){const c=ZU(t||[]).filter(u=>!!u);c.length&&(s?n.classList.add(...c):n.classList.remove(...c))}_detachContentWhenEmpty(){this._ngZone.runOutsideAngular(()=>{const n=this._renders.pipe(Ci(xK(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),n.unsubscribe())})})}_disposeScrollStrategy(){const n=this._scrollStrategy;n&&(n.disable(),n.detach&&n.detach())}_disposeBackdrop(n){n&&(n.removeEventListener("click",this._backdropClickHandler),n.removeEventListener("transitionend",this._backdropTransitionendHandler),n.remove(),this._backdropElement===n&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const lq="cdk-overlay-connected-position-bounding-box",Xee=/([A-Za-z%]+)$/;class Zee{get positions(){return this._preferredPositions}constructor(n,t,s,c,u){this._viewportRuler=t,this._document=s,this._platform=c,this._overlayContainer=u,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new Gt,this._resizeSubscription=Ur.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(n)}attach(n){this._validatePositions(),n.hostElement.classList.add(lq),this._overlayRef=n,this._boundingBox=n.hostElement,this._pane=n.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const n=this._originRect,t=this._overlayRect,s=this._viewportRect,c=this._containerRect,u=[];let p;for(let _ of this._preferredPositions){let E=this._getOriginPoint(n,c,_),S=this._getOverlayPoint(E,t,_),w=this._getOverlayFit(S,t,s,_);if(w.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(_,E);this._canFitWithFlexibleDimensions(w,S,s)?u.push({position:_,origin:E,overlayRect:t,boundingBoxRect:this._calculateBoundingBoxRect(E,_)}):(!p||p.overlayFit.visibleArea<w.visibleArea)&&(p={overlayFit:w,overlayPoint:S,originPoint:E,position:_,overlayRect:t})}if(u.length){let _=null,E=-1;for(const S of u){const w=S.boundingBoxRect.width*S.boundingBoxRect.height*(S.position.weight||1);w>E&&(E=w,_=S)}return this._isPushed=!1,void this._applyPosition(_.position,_.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(p.position,p.originPoint);this._applyPosition(p.position,p.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&EE(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(lq),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const n=this._lastPosition;if(n){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._getOriginPoint(this._originRect,this._containerRect,n);this._applyPosition(n,t)}else this.apply()}withScrollableContainers(n){return this._scrollables=n,this}withPositions(n){return this._preferredPositions=n,-1===n.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(n){return this._viewportMargin=n,this}withFlexibleDimensions(n=!0){return this._hasFlexibleDimensions=n,this}withGrowAfterOpen(n=!0){return this._growAfterOpen=n,this}withPush(n=!0){return this._canPush=n,this}withLockedPosition(n=!0){return this._positionLocked=n,this}setOrigin(n){return this._origin=n,this}withDefaultOffsetX(n){return this._offsetX=n,this}withDefaultOffsetY(n){return this._offsetY=n,this}withTransformOriginOn(n){return this._transformOriginSelector=n,this}_getOriginPoint(n,t,s){let c,u;if("center"==s.originX)c=n.left+n.width/2;else{const p=this._isRtl()?n.right:n.left,_=this._isRtl()?n.left:n.right;c="start"==s.originX?p:_}return t.left<0&&(c-=t.left),u="center"==s.originY?n.top+n.height/2:"top"==s.originY?n.top:n.bottom,t.top<0&&(u-=t.top),{x:c,y:u}}_getOverlayPoint(n,t,s){let c,u;return c="center"==s.overlayX?-t.width/2:"start"===s.overlayX?this._isRtl()?-t.width:0:this._isRtl()?0:-t.width,u="center"==s.overlayY?-t.height/2:"top"==s.overlayY?0:-t.height,{x:n.x+c,y:n.y+u}}_getOverlayFit(n,t,s,c){const u=uq(t);let{x:p,y:_}=n,E=this._getOffset(c,"x"),S=this._getOffset(c,"y");E&&(p+=E),S&&(_+=S);let U=0-_,V=_+u.height-s.height,H=this._subtractOverflows(u.width,0-p,p+u.width-s.width),z=this._subtractOverflows(u.height,U,V),Q=H*z;return{visibleArea:Q,isCompletelyWithinViewport:u.width*u.height===Q,fitsInViewportVertically:z===u.height,fitsInViewportHorizontally:H==u.width}}_canFitWithFlexibleDimensions(n,t,s){if(this._hasFlexibleDimensions){const c=s.bottom-t.y,u=s.right-t.x,p=dq(this._overlayRef.getConfig().minHeight),_=dq(this._overlayRef.getConfig().minWidth);return(n.fitsInViewportVertically||null!=p&&p<=c)&&(n.fitsInViewportHorizontally||null!=_&&_<=u)}return!1}_pushOverlayOnScreen(n,t,s){if(this._previousPushAmount&&this._positionLocked)return{x:n.x+this._previousPushAmount.x,y:n.y+this._previousPushAmount.y};const c=uq(t),u=this._viewportRect,p=Math.max(n.x+c.width-u.width,0),_=Math.max(n.y+c.height-u.height,0),E=Math.max(u.top-s.top-n.y,0),S=Math.max(u.left-s.left-n.x,0);let w=0,D=0;return w=c.width<=u.width?S||-p:n.x<this._viewportMargin?u.left-s.left-n.x:0,D=c.height<=u.height?E||-_:n.y<this._viewportMargin?u.top-s.top-n.y:0,this._previousPushAmount={x:w,y:D},{x:n.x+w,y:n.y+D}}_applyPosition(n,t){if(this._setTransformOrigin(n),this._setOverlayElementStyles(t,n),this._setBoundingBoxStyles(t,n),n.panelClass&&this._addPanelClasses(n.panelClass),this._positionChanges.observers.length){const s=this._getScrollVisibility();if(n!==this._lastPosition||!this._lastScrollVisibility||!function Jee(e,n){return e===n||e.isOriginClipped===n.isOriginClipped&&e.isOriginOutsideView===n.isOriginOutsideView&&e.isOverlayClipped===n.isOverlayClipped&&e.isOverlayOutsideView===n.isOverlayOutsideView}(this._lastScrollVisibility,s)){const c=new Kee(n,s);this._positionChanges.next(c)}this._lastScrollVisibility=s}this._lastPosition=n,this._isInitialRender=!1}_setTransformOrigin(n){if(!this._transformOriginSelector)return;const t=this._boundingBox.querySelectorAll(this._transformOriginSelector);let s,c=n.overlayY;s="center"===n.overlayX?"center":this._isRtl()?"start"===n.overlayX?"right":"left":"start"===n.overlayX?"left":"right";for(let u=0;u<t.length;u++)t[u].style.transformOrigin=`${s} ${c}`}_calculateBoundingBoxRect(n,t){const s=this._viewportRect,c=this._isRtl();let u,p,_,w,D,U;if("top"===t.overlayY)p=n.y,u=s.height-p+this._viewportMargin;else if("bottom"===t.overlayY)_=s.height-n.y+2*this._viewportMargin,u=s.height-_+this._viewportMargin;else{const V=Math.min(s.bottom-n.y+s.top,n.y),H=this._lastBoundingBoxSize.height;u=2*V,p=n.y-V,u>H&&!this._isInitialRender&&!this._growAfterOpen&&(p=n.y-H/2)}if("end"===t.overlayX&&!c||"start"===t.overlayX&&c)U=s.width-n.x+2*this._viewportMargin,w=n.x-this._viewportMargin;else if("start"===t.overlayX&&!c||"end"===t.overlayX&&c)D=n.x,w=s.right-n.x;else{const V=Math.min(s.right-n.x+s.left,n.x),H=this._lastBoundingBoxSize.width;w=2*V,D=n.x-V,w>H&&!this._isInitialRender&&!this._growAfterOpen&&(D=n.x-H/2)}return{top:p,left:D,bottom:_,right:U,width:w,height:u}}_setBoundingBoxStyles(n,t){const s=this._calculateBoundingBoxRect(n,t);!this._isInitialRender&&!this._growAfterOpen&&(s.height=Math.min(s.height,this._lastBoundingBoxSize.height),s.width=Math.min(s.width,this._lastBoundingBoxSize.width));const c={};if(this._hasExactPosition())c.top=c.left="0",c.bottom=c.right=c.maxHeight=c.maxWidth="",c.width=c.height="100%";else{const u=this._overlayRef.getConfig().maxHeight,p=this._overlayRef.getConfig().maxWidth;c.height=xi(s.height),c.top=xi(s.top),c.bottom=xi(s.bottom),c.width=xi(s.width),c.left=xi(s.left),c.right=xi(s.right),c.alignItems="center"===t.overlayX?"center":"end"===t.overlayX?"flex-end":"flex-start",c.justifyContent="center"===t.overlayY?"center":"bottom"===t.overlayY?"flex-end":"flex-start",u&&(c.maxHeight=xi(u)),p&&(c.maxWidth=xi(p))}this._lastBoundingBoxSize=s,EE(this._boundingBox.style,c)}_resetBoundingBoxStyles(){EE(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){EE(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(n,t){const s={},c=this._hasExactPosition(),u=this._hasFlexibleDimensions,p=this._overlayRef.getConfig();if(c){const w=this._viewportRuler.getViewportScrollPosition();EE(s,this._getExactOverlayY(t,n,w)),EE(s,this._getExactOverlayX(t,n,w))}else s.position="static";let _="",E=this._getOffset(t,"x"),S=this._getOffset(t,"y");E&&(_+=`translateX(${E}px) `),S&&(_+=`translateY(${S}px)`),s.transform=_.trim(),p.maxHeight&&(c?s.maxHeight=xi(p.maxHeight):u&&(s.maxHeight="")),p.maxWidth&&(c?s.maxWidth=xi(p.maxWidth):u&&(s.maxWidth="")),EE(this._pane.style,s)}_getExactOverlayY(n,t,s){let c={top:"",bottom:""},u=this._getOverlayPoint(t,this._overlayRect,n);return this._isPushed&&(u=this._pushOverlayOnScreen(u,this._overlayRect,s)),"bottom"===n.overlayY?c.bottom=this._document.documentElement.clientHeight-(u.y+this._overlayRect.height)+"px":c.top=xi(u.y),c}_getExactOverlayX(n,t,s){let p,c={left:"",right:""},u=this._getOverlayPoint(t,this._overlayRect,n);return this._isPushed&&(u=this._pushOverlayOnScreen(u,this._overlayRect,s)),p=this._isRtl()?"end"===n.overlayX?"left":"right":"end"===n.overlayX?"right":"left","right"===p?c.right=this._document.documentElement.clientWidth-(u.x+this._overlayRect.width)+"px":c.left=xi(u.x),c}_getScrollVisibility(){const n=this._getOriginRect(),t=this._pane.getBoundingClientRect(),s=this._scrollables.map(c=>c.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:oq(n,s),isOriginOutsideView:bG(n,s),isOverlayClipped:oq(t,s),isOverlayOutsideView:bG(t,s)}}_subtractOverflows(n,...t){return t.reduce((s,c)=>s-Math.max(c,0),n)}_getNarrowedViewportRect(){const n=this._document.documentElement.clientWidth,t=this._document.documentElement.clientHeight,s=this._viewportRuler.getViewportScrollPosition();return{top:s.top+this._viewportMargin,left:s.left+this._viewportMargin,right:s.left+n-this._viewportMargin,bottom:s.top+t-this._viewportMargin,width:n-2*this._viewportMargin,height:t-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(n,t){return"x"===t?null==n.offsetX?this._offsetX:n.offsetX:null==n.offsetY?this._offsetY:n.offsetY}_validatePositions(){}_addPanelClasses(n){this._pane&&ZU(n).forEach(t=>{""!==t&&-1===this._appliedPanelClasses.indexOf(t)&&(this._appliedPanelClasses.push(t),this._pane.classList.add(t))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(n=>{this._pane.classList.remove(n)}),this._appliedPanelClasses=[])}_getOriginRect(){const n=this._origin;if(n instanceof On)return n.nativeElement.getBoundingClientRect();if(n instanceof Element)return n.getBoundingClientRect();const t=n.width||0,s=n.height||0;return{top:n.y,bottom:n.y+s,left:n.x,right:n.x+t,height:s,width:t}}}function EE(e,n){for(let t in n)n.hasOwnProperty(t)&&(e[t]=n[t]);return e}function dq(e){if("number"!=typeof e&&null!=e){const[n,t]=e.split(Xee);return t&&"px"!==t?null:parseFloat(n)}return e||null}function uq(e){return{top:Math.floor(e.top),right:Math.floor(e.right),bottom:Math.floor(e.bottom),left:Math.floor(e.left),width:Math.floor(e.width),height:Math.floor(e.height)}}const hq="cdk-global-overlay-wrapper";class Qee{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(n){const t=n.getConfig();this._overlayRef=n,this._width&&!t.width&&n.updateSize({width:this._width}),this._height&&!t.height&&n.updateSize({height:this._height}),n.hostElement.classList.add(hq),this._isDisposed=!1}top(n=""){return this._bottomOffset="",this._topOffset=n,this._alignItems="flex-start",this}left(n=""){return this._xOffset=n,this._xPosition="left",this}bottom(n=""){return this._topOffset="",this._bottomOffset=n,this._alignItems="flex-end",this}right(n=""){return this._xOffset=n,this._xPosition="right",this}start(n=""){return this._xOffset=n,this._xPosition="start",this}end(n=""){return this._xOffset=n,this._xPosition="end",this}width(n=""){return this._overlayRef?this._overlayRef.updateSize({width:n}):this._width=n,this}height(n=""){return this._overlayRef?this._overlayRef.updateSize({height:n}):this._height=n,this}centerHorizontally(n=""){return this.left(n),this._xPosition="center",this}centerVertically(n=""){return this.top(n),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const n=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement.style,s=this._overlayRef.getConfig(),{width:c,height:u,maxWidth:p,maxHeight:_}=s,E=!("100%"!==c&&"100vw"!==c||p&&"100%"!==p&&"100vw"!==p),S=!("100%"!==u&&"100vh"!==u||_&&"100%"!==_&&"100vh"!==_),w=this._xPosition,D=this._xOffset,U="rtl"===this._overlayRef.getConfig().direction;let V="",H="",z="";E?z="flex-start":"center"===w?(z="center",U?H=D:V=D):U?"left"===w||"end"===w?(z="flex-end",V=D):("right"===w||"start"===w)&&(z="flex-start",H=D):"left"===w||"start"===w?(z="flex-start",V=D):("right"===w||"end"===w)&&(z="flex-end",H=D),n.position=this._cssPosition,n.marginLeft=E?"0":V,n.marginTop=S?"0":this._topOffset,n.marginBottom=this._bottomOffset,n.marginRight=E?"0":H,t.justifyContent=z,t.alignItems=S?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const n=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement,s=t.style;t.classList.remove(hq),s.justifyContent=s.alignItems=n.marginTop=n.marginBottom=n.marginLeft=n.marginRight=n.position="",this._overlayRef=null,this._isDisposed=!0}}let ete=(()=>{class e{constructor(t,s,c,u){this._viewportRuler=t,this._document=s,this._platform=c,this._overlayContainer=u}global(){return new Qee}flexibleConnectedTo(t){return new Zee(t,this._viewportRuler,this._document,this._platform,this._overlayContainer)}static{this.\u0275fac=function(s){return new(s||e)(ye(eq),ye(Ve),ye(jo),ye(cq))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),tte=0,mT=(()=>{class e{constructor(t,s,c,u,p,_,E,S,w,D,U,V){this.scrollStrategies=t,this._overlayContainer=s,this._componentFactoryResolver=c,this._positionBuilder=u,this._keyboardDispatcher=p,this._injector=_,this._ngZone=E,this._document=S,this._directionality=w,this._location=D,this._outsideClickDispatcher=U,this._animationsModuleType=V}create(t){const s=this._createHostElement(),c=this._createPaneElement(s),u=this._createPortalOutlet(c),p=new zee(t);return p.direction=p.direction||this._directionality.value,new $ee(u,s,c,p,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType,this._injector.get(Yo))}position(){return this._positionBuilder}_createPaneElement(t){const s=this._document.createElement("div");return s.id="cdk-overlay-"+tte++,s.classList.add("cdk-overlay-pane"),t.appendChild(s),s}_createHostElement(){const t=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(t),t}_createPortalOutlet(t){return this._appRef||(this._appRef=this._injector.get(bi)),new Vee(t,this._componentFactoryResolver,this._appRef,this._injector,this._document)}static{this.\u0275fac=function(s){return new(s||e)(ye(Wee),ye(cq),ye(rf),ye(ete),ye(qee),ye(Dr),ye(ft),ye(Ve),ye(uG),ye(Ah),ye(Yee),ye(nl,8))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const ite={provide:new Te("cdk-connected-overlay-scroll-strategy",{providedIn:"root",factory:()=>{const e=me(mT);return()=>e.scrollStrategies.reposition()}}),deps:[mT],useFactory:function rte(e){return()=>e.scrollStrategies.reposition()}};let ote=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=ii({type:e})}static{this.\u0275inj=qr({providers:[mT,ite],imports:[eN,Bee,tq,tq]})}}return e})();const ste=["tooltip"],fq=new Te("mat-tooltip-scroll-strategy",{providedIn:"root",factory:()=>{const e=me(mT);return()=>e.scrollStrategies.reposition({scrollThrottle:20})}}),cte={provide:fq,deps:[mT],useFactory:function ate(e){return()=>e.scrollStrategies.reposition({scrollThrottle:20})}},dte=new Te("mat-tooltip-default-options",{providedIn:"root",factory:function lte(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}}),mq="tooltip-panel",gq=hT({passive:!0});let mte=(()=>{class e{get position(){return this._position}set position(t){t!==this._position&&(this._position=t,this._overlayRef&&(this._updatePosition(this._overlayRef),this._tooltipInstance?.show(0),this._overlayRef.updatePosition()))}get positionAtOrigin(){return this._positionAtOrigin}set positionAtOrigin(t){this._positionAtOrigin=pT(t),this._detach(),this._overlayRef=null}get disabled(){return this._disabled}set disabled(t){const s=pT(t);this._disabled!==s&&(this._disabled=s,s?this.hide(0):this._setupPointerEnterEventsIfNeeded(),this._syncAriaDescription(this.message))}get showDelay(){return this._showDelay}set showDelay(t){this._showDelay=sK(t)}get hideDelay(){return this._hideDelay}set hideDelay(t){this._hideDelay=sK(t),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(t){const s=this._message;this._message=null!=t?String(t).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage()),this._syncAriaDescription(s)}get tooltipClass(){return this._tooltipClass}set tooltipClass(t){this._tooltipClass=t,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}constructor(t,s,c,u,p,_,E,S,w,D,U,V){this._overlay=t,this._elementRef=s,this._scrollDispatcher=c,this._viewContainerRef=u,this._ngZone=p,this._platform=_,this._ariaDescriber=E,this._focusMonitor=S,this._dir=D,this._defaultOptions=U,this._position="below",this._positionAtOrigin=!1,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._tooltipComponent=gte,this._viewportMargin=8,this._cssClassPrefix="mat-mdc",this.touchGestures="auto",this._message="",this._passiveListeners=[],this._touchstartTimeout=null,this._destroyed=new Gt,this._injector=me(Dr),this._scrollStrategy=w,this._document=V,U&&(this._showDelay=U.showDelay,this._hideDelay=U.hideDelay,U.position&&(this.position=U.position),U.positionAtOrigin&&(this.positionAtOrigin=U.positionAtOrigin),U.touchGestures&&(this.touchGestures=U.touchGestures),U.tooltipClass&&(this.tooltipClass=U.tooltipClass)),D.change.pipe(Ci(this._destroyed)).subscribe(()=>{this._overlayRef&&this._updatePosition(this._overlayRef)}),this._viewportMargin=8}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(Ci(this._destroyed)).subscribe(t=>{t?"keyboard"===t&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const t=this._elementRef.nativeElement;this._touchstartTimeout&&clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([s,c])=>{t.removeEventListener(s,c,gq)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),this._ariaDescriber.removeDescription(t,this.message,"tooltip"),this._focusMonitor.stopMonitoring(t)}show(t=this.showDelay,s){if(this.disabled||!this.message||this._isTooltipVisible())return void this._tooltipInstance?._cancelPendingAnimations();const c=this._createOverlay(s);this._detach(),this._portal=this._portal||new nq(this._tooltipComponent,this._viewContainerRef);const u=this._tooltipInstance=c.attach(this._portal).instance;u._triggerElement=this._elementRef.nativeElement,u._mouseLeaveHideDelay=this._hideDelay,u.afterHidden().pipe(Ci(this._destroyed)).subscribe(()=>this._detach()),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),u.show(t)}hide(t=this.hideDelay){const s=this._tooltipInstance;s&&(s.isVisible()?s.hide(t):(s._cancelPendingAnimations(),this._detach()))}toggle(t){this._isTooltipVisible()?this.hide():this.show(void 0,t)}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(t){if(this._overlayRef){const u=this._overlayRef.getConfig().positionStrategy;if((!this.positionAtOrigin||!t)&&u._origin instanceof On)return this._overlayRef;this._detach()}const s=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),c=this._overlay.position().flexibleConnectedTo(this.positionAtOrigin&&t||this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(s);return c.positionChanges.pipe(Ci(this._destroyed)).subscribe(u=>{this._updateCurrentPositionClass(u.connectionPair),this._tooltipInstance&&u.scrollableViewProperties.isOverlayClipped&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({direction:this._dir,positionStrategy:c,panelClass:`${this._cssClassPrefix}-${mq}`,scrollStrategy:this._scrollStrategy()}),this._updatePosition(this._overlayRef),this._overlayRef.detachments().pipe(Ci(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.outsidePointerEvents().pipe(Ci(this._destroyed)).subscribe(()=>this._tooltipInstance?._handleBodyInteraction()),this._overlayRef.keydownEvents().pipe(Ci(this._destroyed)).subscribe(u=>{this._isTooltipVisible()&&27===u.keyCode&&!function tK(e,...n){return n.length?n.some(t=>e[t]):e.altKey||e.shiftKey||e.ctrlKey||e.metaKey}(u)&&(u.preventDefault(),u.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._defaultOptions?.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}_updatePosition(t){const s=t.getConfig().positionStrategy,c=this._getOrigin(),u=this._getOverlayPosition();s.withPositions([this._addOffset({...c.main,...u.main}),this._addOffset({...c.fallback,...u.fallback})])}_addOffset(t){const c=!this._dir||"ltr"==this._dir.value;return"top"===t.originY?t.offsetY=-8:"bottom"===t.originY?t.offsetY=8:"start"===t.originX?t.offsetX=c?-8:8:"end"===t.originX&&(t.offsetX=c?8:-8),t}_getOrigin(){const t=!this._dir||"ltr"==this._dir.value,s=this.position;let c;"above"==s||"below"==s?c={originX:"center",originY:"above"==s?"top":"bottom"}:"before"==s||"left"==s&&t||"right"==s&&!t?c={originX:"start",originY:"center"}:("after"==s||"right"==s&&t||"left"==s&&!t)&&(c={originX:"end",originY:"center"});const{x:u,y:p}=this._invertPosition(c.originX,c.originY);return{main:c,fallback:{originX:u,originY:p}}}_getOverlayPosition(){const t=!this._dir||"ltr"==this._dir.value,s=this.position;let c;"above"==s?c={overlayX:"center",overlayY:"bottom"}:"below"==s?c={overlayX:"center",overlayY:"top"}:"before"==s||"left"==s&&t||"right"==s&&!t?c={overlayX:"end",overlayY:"center"}:("after"==s||"right"==s&&t||"left"==s&&!t)&&(c={overlayX:"start",overlayY:"center"});const{x:u,y:p}=this._invertPosition(c.overlayX,c.overlayY);return{main:c,fallback:{overlayX:u,overlayY:p}}}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),mf(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()},{injector:this._injector}))}_setTooltipClass(t){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=t,this._tooltipInstance._markForCheck())}_invertPosition(t,s){return"above"===this.position||"below"===this.position?"top"===s?s="bottom":"bottom"===s&&(s="top"):"end"===t?t="start":"start"===t&&(t="end"),{x:t,y:s}}_updateCurrentPositionClass(t){const{overlayY:s,originX:c,originY:u}=t;let p;if(p="center"===s?this._dir&&"rtl"===this._dir.value?"end"===c?"left":"right":"start"===c?"left":"right":"bottom"===s&&"top"===u?"above":"below",p!==this._currentPosition){const _=this._overlayRef;if(_){const E=`${this._cssClassPrefix}-${mq}-`;_.removePanelClass(E+this._currentPosition),_.addPanelClass(E+p)}this._currentPosition=p}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||(this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",t=>{let s;this._setupPointerExitEventsIfNeeded(),void 0!==t.x&&void 0!==t.y&&(s=t),this.show(void 0,s)}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",t=>{const s=t.targetTouches?.[0],c=s?{x:s.clientX,y:s.clientY}:void 0;this._setupPointerExitEventsIfNeeded(),this._touchstartTimeout&&clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>{this._touchstartTimeout=null,this.show(void 0,c)},this._defaultOptions.touchLongPressShowDelay??500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const t=[];if(this._platformSupportsMouseEvents())t.push(["mouseleave",s=>{const c=s.relatedTarget;(!c||!this._overlayRef?.overlayElement.contains(c))&&this.hide()}],["wheel",s=>this._wheelListener(s)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const s=()=>{this._touchstartTimeout&&clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};t.push(["touchend",s],["touchcancel",s])}this._addListeners(t),this._passiveListeners.push(...t)}_addListeners(t){t.forEach(([s,c])=>{this._elementRef.nativeElement.addEventListener(s,c,gq)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(t){if(this._isTooltipVisible()){const s=this._document.elementFromPoint(t.clientX,t.clientY),c=this._elementRef.nativeElement;s!==c&&!c.contains(s)&&this.hide()}}_disableNativeGesturesIfNecessary(){const t=this.touchGestures;if("off"!==t){const s=this._elementRef.nativeElement,c=s.style;("on"===t||"INPUT"!==s.nodeName&&"TEXTAREA"!==s.nodeName)&&(c.userSelect=c.msUserSelect=c.webkitUserSelect=c.MozUserSelect="none"),("on"===t||!s.draggable)&&(c.webkitUserDrag="none"),c.touchAction="none",c.webkitTapHighlightColor="transparent"}}_syncAriaDescription(t){this._ariaDescriptionPending||(this._ariaDescriptionPending=!0,this._ariaDescriber.removeDescription(this._elementRef.nativeElement,t,"tooltip"),this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriptionPending=!1,this.message&&!this.disabled&&this._ariaDescriber.describe(this._elementRef.nativeElement,this.message,"tooltip")})}))}static{this.\u0275fac=function(s){return new(s||e)(oe(mT),oe(On),oe(QK),oe(js),oe(ft),oe(jo),oe(_J),oe(lG),oe(fq),oe(uG),oe(dte,8),oe(Ve))}}static{this.\u0275dir=Ue({type:e,selectors:[["","matTooltip",""]],hostAttrs:[1,"mat-mdc-tooltip-trigger"],hostVars:2,hostBindings:function(s,c){2&s&&nt("mat-mdc-tooltip-disabled",c.disabled)},inputs:{position:[0,"matTooltipPosition","position"],positionAtOrigin:[0,"matTooltipPositionAtOrigin","positionAtOrigin"],disabled:[0,"matTooltipDisabled","disabled"],showDelay:[0,"matTooltipShowDelay","showDelay"],hideDelay:[0,"matTooltipHideDelay","hideDelay"],touchGestures:[0,"matTooltipTouchGestures","touchGestures"],message:[0,"matTooltip","message"],tooltipClass:[0,"matTooltipClass","tooltipClass"]},exportAs:["matTooltip"],standalone:!0})}}return e})(),gte=(()=>{class e{constructor(t,s,c){this._changeDetectorRef=t,this._elementRef=s,this._isMultiline=!1,this._closeOnInteraction=!1,this._isVisible=!1,this._onHide=new Gt,this._showAnimation="mat-mdc-tooltip-show",this._hideAnimation="mat-mdc-tooltip-hide",this._animationsDisabled="NoopAnimations"===c}show(t){null!=this._hideTimeoutId&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=setTimeout(()=>{this._toggleVisibility(!0),this._showTimeoutId=void 0},t)}hide(t){null!=this._showTimeoutId&&clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0},t)}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){this._cancelPendingAnimations(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:t}){(!t||!this._triggerElement.contains(t))&&(this.isVisible()?this.hide(this._mouseLeaveHideDelay):this._finalizeAnimation(!1))}_onShow(){this._isMultiline=this._isTooltipMultiline(),this._markForCheck()}_isTooltipMultiline(){const t=this._elementRef.nativeElement.getBoundingClientRect();return t.height>24&&t.width>=200}_handleAnimationEnd({animationName:t}){(t===this._showAnimation||t===this._hideAnimation)&&this._finalizeAnimation(t===this._showAnimation)}_cancelPendingAnimations(){null!=this._showTimeoutId&&clearTimeout(this._showTimeoutId),null!=this._hideTimeoutId&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=this._hideTimeoutId=void 0}_finalizeAnimation(t){t?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next()}_toggleVisibility(t){const s=this._tooltip.nativeElement,c=this._showAnimation,u=this._hideAnimation;if(s.classList.remove(t?u:c),s.classList.add(t?c:u),this._isVisible!==t&&(this._isVisible=t,this._changeDetectorRef.markForCheck()),t&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const p=getComputedStyle(s);("0s"===p.getPropertyValue("animation-duration")||"none"===p.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}t&&this._onShow(),this._animationsDisabled&&(s.classList.add("_mat-animation-noopable"),this._finalizeAnimation(t))}static{this.\u0275fac=function(s){return new(s||e)(oe(Js),oe(On),oe(nl,8))}}static{this.\u0275cmp=eo({type:e,selectors:[["mat-tooltip-component"]],viewQuery:function(s,c){if(1&s&&pe(ste,7),2&s){let u;ci(u=kn())&&(c._tooltip=u.first)}},hostAttrs:["aria-hidden","true"],hostBindings:function(s,c){1&s&&Mn("mouseleave",function(p){return c._handleMouseLeave(p)})},standalone:!0,features:[ho],decls:4,vars:4,consts:[["tooltip",""],[1,"mdc-tooltip","mat-mdc-tooltip",3,"animationend","ngClass"],[1,"mat-mdc-tooltip-surface","mdc-tooltip__surface"]],template:function(s,c){if(1&s){const u=Sc();Se(0,"div",1,0),Mn("animationend",function(_){return Xo(u),ro(c._handleAnimationEnd(_))}),Se(2,"div",2),fn(3),Be()()}2&s&&(nt("mdc-tooltip--multiline",c._isMultiline),$e("ngClass",c.tooltipClass),Ze(3),at(c.message))},dependencies:[Tv],styles:['.mat-mdc-tooltip{position:relative;transform:scale(0);display:inline-flex}.mat-mdc-tooltip::before{content:"";top:0;right:0;bottom:0;left:0;z-index:-1;position:absolute}.mat-mdc-tooltip-panel-below .mat-mdc-tooltip::before{top:-8px}.mat-mdc-tooltip-panel-above .mat-mdc-tooltip::before{bottom:-8px}.mat-mdc-tooltip-panel-right .mat-mdc-tooltip::before{left:-8px}.mat-mdc-tooltip-panel-left .mat-mdc-tooltip::before{right:-8px}.mat-mdc-tooltip._mat-animation-noopable{animation:none;transform:scale(1)}.mat-mdc-tooltip-surface{word-break:normal;overflow-wrap:anywhere;padding:4px 8px;min-width:40px;max-width:200px;min-height:24px;max-height:40vh;box-sizing:border-box;overflow:hidden;text-align:center;will-change:transform,opacity;background-color:var(--mdc-plain-tooltip-container-color, var(--mat-app-inverse-surface));color:var(--mdc-plain-tooltip-supporting-text-color, var(--mat-app-inverse-on-surface));border-radius:var(--mdc-plain-tooltip-container-shape, var(--mat-app-corner-extra-small));font-family:var(--mdc-plain-tooltip-supporting-text-font, var(--mat-app-body-small-font));font-size:var(--mdc-plain-tooltip-supporting-text-size, var(--mat-app-body-small-size));font-weight:var(--mdc-plain-tooltip-supporting-text-weight, var(--mat-app-body-small-weight));line-height:var(--mdc-plain-tooltip-supporting-text-line-height, var(--mat-app-body-small-line-height));letter-spacing:var(--mdc-plain-tooltip-supporting-text-tracking, var(--mat-app-body-small-tracking))}.mat-mdc-tooltip-surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}.mdc-tooltip--multiline .mat-mdc-tooltip-surface{text-align:left}[dir=rtl] .mdc-tooltip--multiline .mat-mdc-tooltip-surface{text-align:right}.mat-mdc-tooltip-panel.mat-mdc-tooltip-panel-non-interactive{pointer-events:none}@keyframes mat-mdc-tooltip-show{0%{opacity:0;transform:scale(0.8)}100%{opacity:1;transform:scale(1)}}@keyframes mat-mdc-tooltip-hide{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0.8)}}.mat-mdc-tooltip-show{animation:mat-mdc-tooltip-show 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-mdc-tooltip-hide{animation:mat-mdc-tooltip-hide 75ms cubic-bezier(0.4, 0, 1, 1) forwards}'],encapsulation:2,changeDetection:0})}}return e})(),_te=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=ii({type:e})}static{this.\u0275inj=qr({providers:[cte],imports:[kJ,OD,ote,Uc,Uc,EG]})}}return e})();function _q(e){return H9(function SG(e){return e[e.length-1]}(e))?e.pop():void 0}function Cm(e){return this instanceof Cm?(this.v=e,this):new Cm(e)}function bq(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function IG(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],s=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(u){t[u]=e[u]&&function(p){return new Promise(function(_,E){!function c(u,p,_,E){Promise.resolve(E).then(function(S){u({value:S,done:_})},p)}(_,E,(p=e[u](p)).done,p.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Sq=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function Cq(e){return Li(e?.then)}function Tq(e){return Li(e[A8])}function wq(e){return Symbol.asyncIterator&&Li(e?.[Symbol.asyncIterator])}function Iq(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Rq=function Wte(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Aq(e){return Li(e?.[Rq])}function Dq(e){return function yq(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,s=t.apply(e,n||[]),u=[];return c=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),_("next"),_("throw"),_("return",function p(V){return function(H){return Promise.resolve(H).then(V,D)}}),c[Symbol.asyncIterator]=function(){return this},c;function _(V,H){s[V]&&(c[V]=function(z){return new Promise(function(Q,ie){u.push([V,z,Q,ie])>1||E(V,z)})},H&&(c[V]=H(c[V])))}function E(V,H){try{!function S(V){V.value instanceof Cm?Promise.resolve(V.value.v).then(w,D):U(u[0][2],V)}(s[V](H))}catch(z){U(u[0][3],z)}}function w(V){E("next",V)}function D(V){E("throw",V)}function U(V,H){V(H),u.shift(),u.length&&E(u[0][0],u[0][1])}}(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:s,done:c}=yield Cm(t.read());if(c)return yield Cm(void 0);yield yield Cm(s)}}finally{t.releaseLock()}})}function Oq(e){return Li(e?.getReader)}function yE(e){if(e instanceof ec)return e;if(null!=e){if(Tq(e))return function zte(e){return new ec(n=>{const t=e[A8]();if(Li(t.subscribe))return t.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Sq(e))return function Kte(e){return new ec(n=>{for(let t=0;t<e.length&&!n.closed;t++)n.next(e[t]);n.complete()})}(e);if(Cq(e))return function qte(e){return new ec(n=>{e.then(t=>{n.closed||(n.next(t),n.complete())},t=>n.error(t)).then(null,x9)})}(e);if(wq(e))return Nq(e);if(Aq(e))return function Yte(e){return new ec(n=>{for(const t of e)if(n.next(t),n.closed)return;n.complete()})}(e);if(Oq(e))return function $te(e){return Nq(Dq(e))}(e)}throw Iq(e)}function Nq(e){return new ec(n=>{(function Xte(e,n){var t,s,c,u;return function vq(e,n,t,s){return new(t||(t=Promise))(function(u,p){function _(w){try{S(s.next(w))}catch(D){p(D)}}function E(w){try{S(s.throw(w))}catch(D){p(D)}}function S(w){w.done?u(w.value):function c(u){return u instanceof t?u:new t(function(p){p(u)})}(w.value).then(_,E)}S((s=s.apply(e,n||[])).next())})}(this,void 0,void 0,function*(){try{for(t=bq(e);!(s=yield t.next()).done;)if(n.next(s.value),n.closed)return}catch(p){c={error:p}}finally{try{s&&!s.done&&(u=t.return)&&(yield u.call(t))}finally{if(c)throw c.error}}n.complete()})})(e,n).catch(t=>n.error(t))})}function Tm(e,n,t,s=0,c=!1){const u=n.schedule(function(){t(),c?e.add(this.schedule(null,s)):this.unsubscribe()},s);if(e.add(u),!c)return u}function Pq(e,n=0){return Em((t,s)=>{t.subscribe(ep(s,c=>Tm(s,e,()=>s.next(c),n),()=>Tm(s,e,()=>s.complete(),n),c=>Tm(s,e,()=>s.error(c),n)))})}function Mq(e,n=0){return Em((t,s)=>{s.add(e.schedule(()=>t.subscribe(s),n))})}function kq(e,n){if(!e)throw new Error("Iterable cannot be null");return new ec(t=>{Tm(t,n,()=>{const s=e[Symbol.asyncIterator]();Tm(t,n,()=>{s.next().then(c=>{c.done?t.complete():t.next(c.value)})},0,!0)})})}function Lq(e,n){return n?function nne(e,n){if(null!=e){if(Tq(e))return function Zte(e,n){return yE(e).pipe(Mq(n),Pq(n))}(e,n);if(Sq(e))return function Qte(e,n){return new ec(t=>{let s=0;return n.schedule(function(){s===e.length?t.complete():(t.next(e[s++]),t.closed||this.schedule())})})}(e,n);if(Cq(e))return function Jte(e,n){return yE(e).pipe(Mq(n),Pq(n))}(e,n);if(wq(e))return kq(e,n);if(Aq(e))return function ene(e,n){return new ec(t=>{let s;return Tm(t,n,()=>{s=e[Rq](),Tm(t,n,()=>{let c,u;try{({value:c,done:u}=s.next())}catch(p){return void t.error(p)}u?t.complete():t.next(c)},0,!0)}),()=>Li(s?.return)&&s.return()})}(e,n);if(Oq(e))return function tne(e,n){return kq(Dq(e),n)}(e,n)}throw Iq(e)}(e,n):yE(e)}const aV_HIDDEN={opacity:0,"margin-top":"100%"},aV_SHOWN={opacity:1,"margin-top":0},xq=Y6("fade",[LO(":enter",[cu(aV_HIDDEN),kO("250ms ease-in-out",cu(aV_SHOWN))]),LO(":leave",[cu(aV_SHOWN),kO("250ms ease-in-out",cu(aV_HIDDEN))])]);class Fq{constructor(n){this.cdr=n,this.afterClosed=new HO,this.shown=!0}closeDialog(n){this.onAfterClosed(n)}onAfterClosed(n){this.shown=!1,this.cdr.markForCheck(),this.afterClosed.next(n)}}function sne(e,n){1&e&&fn(0),2&e&&mr(" Calling to ",Sn(2).data.user.name," ")}function ane(e,n){1&e&&fn(0),2&e&&mr(" ",Sn(2).data.user.name," is calling ")}function cne(e,n){if(1&e){const t=Sc();Se(0,"button",9),Mn("click",function(){return Xo(t),ro(Sn(2).onAcceptCall())}),Be()}}function lne(e,n){if(1&e){const t=Sc();Se(0,"div",1)(1,"div",2)(2,"div",3),At(3,"img",4),Be(),Se(4,"p",5),br(5,sne,1,1)(6,ane,1,1),Be()(),Se(7,"div",6),br(8,cne,1,0,"button",7),Se(9,"span")(10,"button",8),Mn("click",function(){return Xo(t),ro(Sn().onDeclineCall())}),Be()()()()}if(2&e){const t=Sn();nt("video-call--full-screen",t.fullScreen),$e("@fade",void 0),Ze(3),$e("src",t.data.user.photoURL,Tw),Ze(2),st(t.data.outcome?5:6),Ze(3),st(t.data.outcome?-1:8)}}let dne=(()=>{class e extends Fq{constructor(t){super(t),this.fullScreen=!1}ngOnInit(){this.play(`assets/${this.data.outcome?"outcome":"income"}.mp3`)}ngOnDestroy(){this.stop()}onAcceptCall(){this.fullScreen=!0,this.cdr.markForCheck(),this.afterClosed.next(this.data)}onDeclineCall(){this.play("assets/cancel.mp3"),setTimeout(()=>this.closeDialog(null),200)}play(t,s=!0){this.audio&&this.stop(),this.audio=new Audio(t),this.audio.loop=s,this.audio.load(),this.audio.play()}stop(){this.audio.pause(),this.audio.remove()}static{this.\u0275fac=function(s){return new(s||e)(oe(Js))}}static{this.\u0275cmp=eo({type:e,selectors:[["ngx-video-call"]],inputs:{data:"data"},standalone:!0,features:[tn,ho],decls:1,vars:1,consts:[["class","video-call",3,"video-call--full-screen",4,"ngIf"],[1,"video-call"],[1,"video-call-user"],[1,"video-call-user__block","video-call-user__block--animated"],["alt","",1,"video-call-user__img",3,"src"],[1,"video-call-user__title"],[1,"video-call__actions"],["aria-label","Accept",1,"video-call__button","video-call__button--accept"],["aria-label","Decline",1,"video-call__button","video-call__button--decline",3,"click"],["aria-label","Accept",1,"video-call__button","video-call__button--accept",3,"click"]],template:function(s,c){1&s&&br(0,lne,11,6,"div",0),2&s&&$e("ngIf",c.shown&&c.data)},dependencies:[dC],styles:['[_nghost-%COMP%]{display:block;height:100vh;position:relative}.video-call[_ngcontent-%COMP%]{background-image:linear-gradient(#3f51b5,#313a42);background-size:cover;border-radius:10px;box-shadow:0 5px 10px #0000001a;display:flex;flex-direction:column;height:100%;justify-content:flex-end;left:50%;max-height:400px;max-width:400px;position:absolute;top:50%;transform:translate(-50%,-50%);width:100%;z-index:5;transition:.3s}.video-call--full-screen[_ngcontent-%COMP%]{background-image:linear-gradient(#22292f);border-radius:0;max-height:100%;max-width:100%}.video-call-user[_ngcontent-%COMP%]{left:50%;position:absolute;text-align:center;top:50%;transform:translate(-50%,-55%);z-index:1}.video-call-user__block[_ngcontent-%COMP%]{background:#fff;border-radius:50%;border:solid 5px #fff;height:180px;margin:0 auto;transform:scale(1);width:180px}.video-call-user__block--animated[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_play 2s ease infinite;backface-visibility:hidden}.video-call-user__img[_ngcontent-%COMP%]{border-radius:50%;height:100%;left:0;object-fit:cover;position:absolute;top:0;width:100%}.video-call-user__title[_ngcontent-%COMP%]{color:#fff;font-size:1.2em;font-weight:700;margin:15px 0 0}.video-call__actions[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:10px 0}.video-call__button[_ngcontent-%COMP%]{border-radius:50%;box-shadow:0 0 #3f51b500,0 .05em .1em #0003;border:0;cursor:pointer;display:block;font-size:40px;height:1em;margin:0 5px;position:relative;transform:translateZ(0) scale(1);width:1em;transition:.3s}.video-call__button[_ngcontent-%COMP%]:before, .video-call__button[_ngcontent-%COMP%]:after{content:"";position:absolute}.video-call__button[_ngcontent-%COMP%]:before{background-color:#ffffff1a;border-radius:50%;height:1em;left:0;opacity:1;top:0;transform:translateZ(0) scale(0);width:1em}.video-call__button[_ngcontent-%COMP%]:after{background-position:50% 50%;background-repeat:no-repeat;background-size:cover;background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTYuNiAxMC44YzEuNCAyLjggMy44IDUuMSA2LjYgNi42bDIuMi0yLjJjLjMtLjMuNy0uNCAxLS4yIDEuMS40IDIuMy42IDMuNi42LjUgMCAxIC40IDEgMVYyMGMwIC41LS41IDEtMSAxLTkuNCAwLTE3LTcuNi0xNy0xNyAwLS42LjQtMSAxLTFoMy41Yy41IDAgMSAuNCAxIDEgMCAxLjIuMiAyLjUuNiAzLjYuMS40IDAgLjctLjIgMWwtMi4zIDIuMnoiIGZpbGw9IiNmZmZmZmYiLz48L3N2Zz4=);height:.5em;left:.25em;top:.25em;transform:translateZ(0);width:.5em;transition:.3s}.video-call__button--accept[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_phone-outer 3s infinite;background-color:#3f51b5}.video-call__button--accept[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_phone-inner 3s infinite}.video-call__button--accept[_ngcontent-%COMP%]:after{animation:_ngcontent-%COMP%_phone-icon 3s infinite}.video-call__button--decline[_ngcontent-%COMP%]{background-color:#d73b3d}.video-call__button--decline[_ngcontent-%COMP%]:hover{background-color:#ce2a2c}.video-call__button--decline[_ngcontent-%COMP%]:after{top:.28em;transform:translateZ(0) rotate(135deg)}@keyframes _ngcontent-%COMP%_play{0%{transform:scale(1)}15%{box-shadow:0 0 0 5px #9b9da466}25%{box-shadow:0 0 0 10px #9b9da466,0 0 0 20px #9b9da433}25%{box-shadow:0 0 0 15px #9b9da466,0 0 0 30px #9b9da433}}@keyframes _ngcontent-%COMP%_phone-outer{0%{box-shadow:0 0 #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}33.3333%{box-shadow:0 0 #3f51b51a,0 .05em .1em #00000080;transform:translateZ(0) scale(1.1)}66.6666%{box-shadow:0 0 0 .5em #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}to{box-shadow:0 0 #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}}@keyframes _ngcontent-%COMP%_phone-inner{0%{opacity:1;transform:translateZ(0) scale(0)}33.3333%{opacity:1;transform:translateZ(0) scale(.9)}66.6666%{opacity:0;transform:translateZ(0) scale(0)}to{opacity:0;transform:translateZ(0) scale(0)}}@keyframes _ngcontent-%COMP%_phone-icon{0%{transform:translateZ(0)}2%{transform:translate3d(.01em,0,0)}4%{transform:translate3d(-.01em,0,0)}6%{transform:translate3d(.01em,0,0)}8%{transform:translate3d(-.01em,0,0)}10%{transform:translate3d(.01em,0,0)}12%{transform:translate3d(-.01em,0,0)}14%{transform:translate3d(.01em,0,0)}16%{transform:translate3d(-.01em,0,0)}18%{transform:translate3d(.01em,0,0)}20%{transform:translate3d(-.01em,0,0)}22%{transform:translate3d(.01em,0,0)}24%{transform:translate3d(-.01em,0,0)}26%{transform:translate3d(.01em,0,0)}28%{transform:translate3d(-.01em,0,0)}30%{transform:translate3d(.01em,0,0)}32%{transform:translate3d(-.01em,0,0)}34%{transform:translate3d(.01em,0,0)}36%{transform:translate3d(-.01em,0,0)}38%{transform:translate3d(.01em,0,0)}40%{transform:translate3d(-.01em,0,0)}42%{transform:translate3d(.01em,0,0)}44%{transform:translate3d(-.01em,0,0)}46%{transform:translateZ(0)}}'],data:{animation:[xq]},changeDetection:0})}}return e})();function une(e,n){if(1&e){const t=Sc();Se(0,"div",1)(1,"button",2),Mn("click",function(){return Xo(t),ro(Sn().onToggleFullScreen())}),Se(2,"div",3),_a(),Se(3,"svg",4)(4,"g",25)(5,"g",6)(6,"g",7)(7,"g",11),At(8,"path",26)(9,"path",27)(10,"path",28)(11,"path",29),Be()()()(),Se(12,"g",30)(13,"g",6)(14,"g",31)(15,"g",7),At(16,"path",32)(17,"path",33)(18,"path",34)(19,"path",35),Be()()()()()(),va(),Se(20,"p"),fn(21),Be()()()}if(2&e){const t=Sn();Ze(),nt("controls__button--active",t.fullScreenEnabled),Ze(3),nt("controls__icon--shown",!t.fullScreenEnabled),Ze(8),nt("controls__icon--shown",t.fullScreenEnabled),Ze(9),at(t.fullScreenEnabled?"Exit fullscreen":"Fullscreen")}}function hne(e,n){if(1&e){const t=Sc();Se(0,"div",1)(1,"button",36),Mn("click",function(){return Xo(t),ro(Sn().onToggleSmallScreen())}),Se(2,"div",3),_a(),Se(3,"svg",4)(4,"g",37),At(5,"path",38),Be(),Se(6,"defs")(7,"filter",39),At(8,"feFlood",40)(9,"feColorMatrix",41)(10,"feOffset",42)(11,"feGaussianBlur",43)(12,"feComposite",44)(13,"feColorMatrix",45)(14,"feBlend",46)(15,"feBlend",47),Be()()()(),va(),Se(16,"p"),fn(17,"Minimize"),Be()()()}if(2&e){const t=Sn();Ze(),nt("controls__button--active",t.smallScreenEnabled)}}let pne=(()=>{class e{constructor(){this.cameraEnabled=!0,this.microphoneEnabled=!0,this.fullScreenEnabled=!1,this.smallScreenEnabled=!1,this.displaySmallScreen=!1,this.toggleCamera=new Dn,this.toggleMicrophone=new Dn,this.toggleFullScreen=new Dn,this.toggleSmallScreen=new Dn,this.endCall=new Dn}onToggleCamera(){this.toggleCamera.emit(this.cameraEnabled)}onToggleMicrophone(){this.toggleMicrophone.emit(this.microphoneEnabled)}onToggleFullScreen(){this.toggleFullScreen.emit(this.fullScreenEnabled)}onToggleSmallScreen(){this.toggleSmallScreen.emit(this.smallScreenEnabled)}onEndCall(){this.endCall.emit()}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275cmp=eo({type:e,selectors:[["ngx-controls"]],inputs:{cameraEnabled:"cameraEnabled",microphoneEnabled:"microphoneEnabled",fullScreenEnabled:"fullScreenEnabled",smallScreenEnabled:"smallScreenEnabled",displaySmallScreen:"displaySmallScreen"},outputs:{toggleCamera:"toggleCamera",toggleMicrophone:"toggleMicrophone",toggleFullScreen:"toggleFullScreen",toggleSmallScreen:"toggleSmallScreen",endCall:"endCall"},standalone:!0,features:[ho],decls:43,vars:16,consts:[[1,"controls"],[1,"controls__item"],[1,"controls__button",3,"click"],[1,"controls__icon-wrapper"],["viewBox","0 0 64 64","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","video-camera",1,"controls__icon"],["id","Group"],["id","Group_2"],["id","Vector","d","M63.4134 16.2294C63.0454 15.9814 62.5787 15.928 62.1707 16.096L50.6668 20.6986V20C50.6668 16.3226 47.6748 13.3334 44.0001 13.3334H6.66663C2.992 13.3334 0 16.3226 0 20V44C0 47.6774 2.992 50.6666 6.66663 50.6666H44C47.6746 50.6666 50.6666 47.6772 50.6666 44V43.3014L62.1706 47.904C62.5812 48.072 63.048 48.0186 63.4132 47.7706C63.7786 47.5226 63.9999 47.1093 63.9999 46.6666V17.3334C64 16.8906 63.7786 16.4774 63.4134 16.2294Z","fill","white"],["id","no-camera",1,"controls__icon"],["id","Vector","d","M44.0002 13.3325H6.66735C2.99276 13.3325 0.000793457 16.3218 0.000793457 19.999V43.9988C0.000793457 47.6761 2.99276 50.6654 6.66735 50.6654H7.67797L44.9176 13.4257C44.6162 13.3832 44.315 13.3325 44.0002 13.3325Z","fill","white"],["id","Group_3"],["id","Group_4"],["id","Vector_2","d","M63.4134 16.2285C63.0454 15.9805 62.5788 15.9271 62.1708 16.0951L50.6669 20.6977V19.9991C50.6669 18.6417 50.2535 17.3831 49.5549 16.3297L63.608 2.2766C64.128 1.75661 64.128 0.911242 63.608 0.391247C63.088 -0.128748 62.2426 -0.128748 61.7226 0.391247L0.389996 61.724C-0.129999 62.244 -0.129999 63.0894 0.389996 63.6094C0.651369 63.868 0.992615 63.9988 1.33399 63.9988C1.67536 63.9988 2.01661 63.8681 2.27798 63.6094L15.2192 50.6655H44.0003C47.6749 50.6655 50.6669 47.6762 50.6669 43.9989V43.3003L62.1708 47.9029C62.5814 48.0709 63.0481 48.0175 63.4134 47.7695C63.7788 47.5215 64 47.1082 64 46.6655V17.3325C64 16.8898 63.7788 16.4765 63.4134 16.2285Z","fill","white"],["id","microphone",1,"controls__icon"],["id","Vector"],["fill-rule","evenodd","clip-rule","evenodd","d","M44.3474 12.1407L44.3468 17.2309V33.8672C44.3468 40.6024 38.9004 46.0823 32.206 46.0823C27.8366 46.0787 23.8059 43.7286 21.6503 39.9279L20.4131 36.8161C20.1824 35.875 20.0659 34.9098 20.0659 33.941V12.1407C20.0659 5.43551 25.5014 0 32.2066 0C38.9118 0 44.3474 5.43551 44.3474 12.1407Z","fill","white"],["fill-rule","evenodd","clip-rule","evenodd","d","M15.0971 33.7512C15.0947 36.1345 15.5932 38.4912 16.5596 40.6697L18.1223 43.4553C22.3699 49.6259 30.1387 52.3143 37.292 50.089C44.4453 47.8638 49.318 41.2426 49.3156 33.7518C49.3156 32.9026 50.0039 32.2143 50.8532 32.2143C51.7018 32.2143 52.3907 32.9026 52.3907 33.7518C52.4051 44.4499 44.0585 53.2951 33.3778 53.9017V60.9246H39.8098C40.6584 60.9246 41.3473 61.6135 41.3473 62.4622C41.3473 63.3114 40.6584 63.9997 39.8098 63.9997H24.6029C23.7537 63.9997 23.0654 63.3114 23.0654 62.4622C23.0654 61.6135 23.7537 60.9246 24.6029 60.9246H30.3033V53.847C25.6228 53.4212 21.2413 51.3623 17.926 48.0313C17.1926 47.298 16.5163 46.51 15.9031 45.6739L14.2418 42.9874C12.7757 40.1297 12.0148 36.9633 12.022 33.7512C12.022 32.902 12.7103 32.2137 13.5595 32.2137C14.4088 32.2137 15.0971 32.902 15.0971 33.7512Z","fill","white"],["id","no-microphone",1,"controls__icon"],["id","Vector","d","M52.9733 4.25592L44.3474 12.8813V12.1407C44.3474 5.43551 38.9118 0 32.2066 0C25.5014 0 20.0659 5.43551 20.0659 12.1407V33.941C20.0659 34.9098 20.1824 35.875 20.4131 36.8161L16.5596 40.6697C15.5932 38.4912 15.0947 36.1345 15.0971 33.7512C15.0971 32.902 14.4088 32.2137 13.5595 32.2137C12.7103 32.2137 12.022 32.902 12.022 33.7512C12.0148 36.9633 12.7757 40.1297 14.2418 42.9874L8.81411 48.4151C8.4117 48.8007 8.24954 49.3731 8.39008 49.9124C8.53002 50.4518 8.95105 50.8728 9.4898 51.0133C10.0291 51.1539 10.6021 50.9917 10.9877 50.5899L15.9031 45.6739C16.5163 46.51 17.1926 47.298 17.926 48.0313C21.2413 51.3623 25.6228 53.4212 30.3033 53.847V60.9246H24.6029C23.7537 60.9246 23.0654 61.6135 23.0654 62.4622C23.0654 63.3114 23.7537 63.9997 24.6029 63.9997H39.8098C40.6584 63.9997 41.3473 63.3114 41.3473 62.4622C41.3473 61.6135 40.6584 60.9246 39.8098 60.9246H33.3778V53.9017C44.0585 53.2951 52.4051 44.4499 52.3907 33.7518C52.3907 32.9026 51.7018 32.2143 50.8532 32.2143C50.0039 32.2143 49.3156 32.9026 49.3156 33.7518C49.318 41.2426 44.4453 47.8638 37.292 50.089C30.1387 52.3143 22.3699 49.6259 18.1224 43.4553L21.6503 39.9279C23.8059 43.7286 27.8366 46.0787 32.206 46.0823C38.9004 46.0823 44.3468 40.6024 44.3468 33.8672V17.2309L55.1475 6.43072C55.7481 5.83071 55.7481 4.85713 55.1475 4.25652C54.5469 3.65591 53.5733 3.65591 52.9733 4.25652V4.25592Z","fill","white"],[1,"controls__button","controls__button--danger",3,"click"],["id","phone"],["id","Vector","d","M51.7097 13.2478C51.2458 12.7839 50.4959 12.7839 50.032 13.2478L1.38351 61.8963C0.919568 62.3602 0.919568 63.1101 1.38351 63.574C1.61488 63.8054 1.91864 63.9217 2.2224 63.9217C2.52615 63.9217 2.82991 63.8054 3.06129 63.574L51.7097 14.9256C52.1737 14.4628 52.1737 13.7117 51.7097 13.2478Z","fill","white"],["id","Vector_2","d","M16.9605 42.9635L26.1159 33.8081L21.3365 29.0287C18.91 26.6022 18.6869 24.3679 20.5878 21.5629C20.8535 21.1951 22.5444 19.6941 23.992 18.4839C24.9151 17.9333 25.5487 17.1181 25.8264 16.1155C26.1954 14.783 25.9225 13.2156 25.0516 11.6885C24.8463 11.3373 19.9625 3.06229 15.4583 0.680892C14.6171 0.235937 13.6714 0.0010004 12.721 0.0010004C11.1571 0.0010004 9.68576 0.610886 8.58109 1.71556L5.57082 4.72702C-3.21082 13.5098 -1.58525 24.419 10.2719 36.2749L16.9605 42.9635Z","fill","white"],["id","Vector_3","d","M63.313 48.5357C60.9304 44.0328 52.6566 39.1478 52.2923 38.9342C51.2304 38.329 50.1209 38.0099 49.0839 38.0099C47.5402 38.0099 46.2753 38.717 45.51 40.0033C44.2986 41.452 42.7964 43.1429 42.4345 43.4051C39.6129 45.3154 37.4071 45.1007 34.9652 42.6588L31.148 38.8416L21.9926 47.997L27.7189 53.7233C34.5356 60.5412 41.0367 63.9976 47.0371 63.9976C47.0383 63.9976 47.0383 63.9976 47.0383 63.9976C51.4534 63.9976 55.5672 62.1217 59.2669 58.4232L62.2771 55.413C64.1068 53.5845 64.5233 50.821 63.313 48.5357Z","fill","white"],["id","fullscreen",1,"controls__icon"],["id","Vector","d","M57.8018 53.4382L44.3964 40.0328L40.0328 44.3964L53.4382 57.8018H43.0205V64H64V43.0205H57.8018V53.4382Z","fill","white"],["id","Vector_2","d","M44.3964 23.9803L57.8018 10.5618V20.9795H64V0H43.0205V6.1982H53.4382L40.0328 19.6036L44.3964 23.9803Z","fill","white"],["id","Vector_3","d","M19.6036 40.0328L6.1982 53.4382V43.0205H0V64H20.9795V57.8018H10.5618L23.9803 44.3964L19.6036 40.0328Z","fill","white"],["id","Vector_4","d","M20.9795 6.1982V0H0V20.9795H6.1982V10.5618L19.6036 23.9803L23.9803 19.6036L10.5618 6.1982H20.9795Z","fill","white"],["id","exit-full-screen",1,"controls__icon"],["id","fullscreen_x5F_exit"],["id","Vector","d","M49.172 54.828L58.344 64L64 58.344L54.828 49.172L64 40H40V64L49.172 54.828Z","fill","white"],["id","Vector_2","d","M0 24H24V0L14.828 9.172L5.75 0.086L0.094 5.742L9.172 14.828L0 24Z","fill","white"],["id","Vector_3","d","M0 58.344L5.656 64L14.828 54.828L24 64V40H0L9.172 49.172L0 58.344Z","fill","white"],["id","Vector_4","d","M40 24H64L54.828 14.828L63.922 5.742L58.266 0.086L49.172 9.172L40 0V24Z","fill","white"],[1,"controls__button","controls__button--rotate",3,"click"],["filter","url(#filter0_d_0_4)"],["d","M-4.81762e-07 34.7678V57.0215C-4.81762e-07 60.8696 3.13284 64 6.98275 64H57.016C60.8672 64 64 60.8696 64 57.0215V7.05508C64 3.20697 60.8672 0.0757321 57.016 0.0757321H34.6959C35.8972 1.3077 36.6961 2.93443 36.871 4.74067H57.0168C58.2942 4.74067 59.3335 5.77899 59.3335 7.05508V57.0216C59.3335 58.2969 58.2942 59.3352 57.0168 59.3352H6.98342C5.7062 59.3352 4.66761 58.2969 4.66761 57.0216V36.9389C2.90982 36.7703 1.27948 36.0149 -4.81762e-07 34.7678ZM10.7807 30.6654H26.0384L1.34093 5.97437C-0.02533 4.60686 -0.02533 2.39174 1.34093 1.02583C2.70813 -0.341677 4.92462 -0.341677 6.29089 1.02423L30.9883 25.7159V10.4614C30.9883 8.52907 32.5556 6.96139 34.4888 6.96139C35.4553 6.96139 36.3305 7.35214 36.9642 7.98612C37.5976 8.62116 37.9897 9.49543 37.9897 10.4613V34.1643C37.9897 36.0966 36.4228 37.6635 34.4896 37.6635H10.7807C8.84705 37.6635 7.28056 36.0974 7.28056 34.1643C7.28056 32.2312 8.84705 30.6654 10.7807 30.6654Z","fill","white"],["id","filter0_d_0_4","x","-4","y","0","width","72","height","72","filterUnits","userSpaceOnUse","color-interpolation-filters","sRGB"],["flood-opacity","0","result","BackgroundImageFix"],["in","SourceAlpha","type","matrix","values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0","result","hardAlpha"],["dy","4"],["stdDeviation","2"],["in2","hardAlpha","operator","out"],["type","matrix","values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"],["mode","normal","in2","BackgroundImageFix","result","effect1_dropShadow_0_4"],["mode","normal","in","SourceGraphic","in2","effect1_dropShadow_0_4","result","shape"]],template:function(s,c){1&s&&(Se(0,"div",0)(1,"div",1)(2,"button",2),Mn("click",function(){return c.onToggleCamera()}),Se(3,"div",3),_a(),Se(4,"svg",4)(5,"g",5)(6,"g",6)(7,"g",7),At(8,"path",8),Be()()(),Se(9,"g",9)(10,"g",6)(11,"g",7),At(12,"path",10),Be()(),Se(13,"g",11)(14,"g",12),At(15,"path",13),Be()()()()(),va(),Se(16,"p"),fn(17,"Camera"),Be()()(),Se(18,"div",1)(19,"button",2),Mn("click",function(){return c.onToggleMicrophone()}),Se(20,"div",3),_a(),Se(21,"svg",4)(22,"g",14)(23,"g",15),At(24,"path",16)(25,"path",17),Be()(),Se(26,"g",18),At(27,"path",19),Be()()(),va(),Se(28,"p"),fn(29,"Mic"),Be()()(),br(30,une,22,7,"div",1)(31,hne,18,2,"div",1),Se(32,"div",1)(33,"button",20),Mn("click",function(){return c.onEndCall()}),Se(34,"div",3),_a(),Se(35,"svg",4)(36,"g",21)(37,"g",6),At(38,"path",22)(39,"path",23)(40,"path",24),Be()()()(),va(),Se(41,"p"),fn(42,"End"),Be()()()()),2&s&&(nt("controls--small",c.smallScreenEnabled),Ze(2),nt("controls__button--active",c.cameraEnabled),Ze(3),nt("controls__icon--shown",c.cameraEnabled),Ze(4),nt("controls__icon--shown",!c.cameraEnabled),Ze(10),nt("controls__button--active",c.microphoneEnabled),Ze(3),nt("controls__icon--shown",c.microphoneEnabled),Ze(4),nt("controls__icon--shown",!c.microphoneEnabled),Ze(4),st(c.smallScreenEnabled?-1:30),Ze(),st(c.displaySmallScreen?31:-1))},styles:["[_nghost-%COMP%]{transition:.3s}.controls[_ngcontent-%COMP%]{background:#0000004d;bottom:0;display:flex;justify-content:center;padding:15px 0;position:absolute;left:0;width:100%}.controls--small[_ngcontent-%COMP%]{border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding:5px 0}.controls--small[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{height:32px;width:32px}.controls--small[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:16px;width:16px}.controls--small[_ngcontent-%COMP%]   .controls__item[_ngcontent-%COMP%]{margin:0}.controls--small[_ngcontent-%COMP%]   .controls__button[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:none}.controls__item[_ngcontent-%COMP%]{margin:0 5px;text-align:center}.controls__button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer}.controls__button[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#101316}.controls__button--active[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#0b73c9}.controls__button--active[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#158ef2}.controls__button--active.controls__button--rotate[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{transform:translate(-50%,-50%) rotate(-180deg)}.controls__button--danger[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#d73b3d}.controls__button--danger[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#e06567}.controls__button[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;margin:8px 0 0}.controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#313a42;border-radius:50%;box-shadow:0 3px 8px #00000080;margin:auto;position:relative;height:60px;width:60px;transition:.3s}.controls__icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%) rotate(0);height:32px;width:32px;transition:.3s}.controls__icon[_ngcontent-%COMP%]{opacity:0;transition:.3s}.controls__icon--shown[_ngcontent-%COMP%]{opacity:1}"],changeDetection:0})}}return e})();const fne=(e,n,t,s)=>({"spinner--connected":e,"spinner--ended":n,"spinner--small":t,"spinner--error":s});function mne(e,n){if(1&e&&(Se(0,"div",7),fn(1),Be()),2&e){const t=Sn();Ze(),at(t.text)}}let gne=(()=>{class e{constructor(){this.error=!1,this.connected=!0,this.ended=!1,this.small=!1}get color(){return this.ended?"#aaa":this.error?"#d73b3d":this.connected?"#37D425":"#1195E6"}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275cmp=eo({type:e,selectors:[["ngx-spinner"]],inputs:{text:"text",error:"error",connected:"connected",ended:"ended",small:"small"},standalone:!0,features:[ho],decls:8,vars:9,consts:[[1,"spinner",3,"ngClass"],[1,"spinner__wrapper"],[1,"spinner__icon"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 32 32","fill","none"],["d","M5.25 5.5C3.45507 5.5 2 6.95508 2 8.75V19.25C2 21.0449 3.45507 22.5 5.25 22.5H14.75C16.5449 22.5 18 21.0449 18 19.25V8.75C18 6.95507 16.5449 5.5 14.75 5.5H5.25Z"],["d","M23.1232 20.6431L19.5 17.0935V10.9989L23.1121 7.3706C23.8988 6.58044 25.248 7.13753 25.248 8.25251V19.7502C25.248 20.8577 23.9143 21.4181 23.1232 20.6431Z"],[1,"spinner__cirle"],[1,"spinner__text"]],template:function(s,c){1&s&&(Se(0,"div",0)(1,"div",1)(2,"div",2),_a(),Se(3,"svg",3),At(4,"path",4)(5,"path",5),Be()(),va(),At(6,"div",6),br(7,mne,2,1,"div",7),Be()()),2&s&&($e("ngClass",kL(4,fne,c.connected,c.ended,c.small,c.error)),Ze(4),Jr("fill",c.color),Ze(),Jr("fill",c.color),Ze(2),st(c.small?-1:7))},dependencies:[Tv],styles:[".spinner[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;position:relative;transition:.3s}.spinner--connected[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:#37d425}.spinner--ended[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:transparent}.spinner--error[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:#d73b3d}.spinner--small[_ngcontent-%COMP%]{border-radius:10px;height:200px}.spinner--small[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-width:4px;height:80px;width:80px}.spinner--small[_ngcontent-%COMP%]   .spinner__icon[_ngcontent-%COMP%]{top:26px;transform:translate(-35%)}.spinner--small[_ngcontent-%COMP%]   .spinner__icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:32px;width:32px}.spinner__wrapper[_ngcontent-%COMP%]{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%)}.spinner__cirle[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 2s linear infinite;border:5px solid #1195E6;border-radius:50%;border-top-color:transparent;height:160px;margin:auto;width:160px;transition:.3s}.spinner__icon[_ngcontent-%COMP%]{left:50%;position:absolute;top:52px;transform:translate(-40%);transition:.3s}.spinner__icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:64px;width:64px;transition:.3s}.spinner__text[_ngcontent-%COMP%]{color:#fff;font-size:1.3em;margin-top:25px;text-align:center}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"],changeDetection:0})}}return e})();function AG(e,n){return Em((t,s)=>{let c=0;t.subscribe(ep(s,u=>{s.next(e.call(n,u,c++))}))})}let _ne=(()=>{class e{constructor(){this.started=Date.now()}ngOnInit(){this.time$=N8(0,1e3).pipe(AG(()=>this.format(Date.now()-this.started)))}format(t){const s=Math.floor(t/1e3%60).toString().padStart(2,"0"),c=Math.floor(t/6e4%60).toString().padStart(2,"0");return[Math.floor(t/36e5%24).toString().padStart(2,"0"),c,s].join(":")}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275cmp=eo({type:e,selectors:[["ngx-timer"]],inputs:{started:"started"},standalone:!0,features:[ho],decls:4,vars:3,consts:[[1,"timer"]],template:function(s,c){1&s&&(Se(0,"div",0)(1,"span"),fn(2),Pi(3,"async"),Be()()),2&s&&(Ze(2),at(W_(3,1,c.time$)))},dependencies:[CD],styles:[".timer[_ngcontent-%COMP%]{color:#fff;position:relative;text-align:center;z-index:1}.timer[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#0000004d;border-radius:5px;padding:5px 10px}"],changeDetection:0})}}return e})(),vne=(()=>{class e{onEnter(){this.subscription.unsubscribe(),this.setStyle(1)}onLeave(){this.hide()}constructor(t,s){this.renderer=t,this.el=s,this.subscription=new Kl,this.delay=5e3}ngOnInit(){this.hide()}hide(){this.subscription.unsubscribe(),this.subscription=P8(this.delay).pipe(du(1)).subscribe(()=>this.setStyle(0))}setStyle(t){this.renderer.setStyle(this.el.nativeElement,"opacity",t)}static{this.\u0275fac=function(s){return new(s||e)(oe(_c),oe(On))}}static{this.\u0275dir=Ue({type:e,selectors:[["","ngxToggle",""]],hostBindings:function(s,c){1&s&&Mn("mouseenter",function(){return c.onEnter()})("mouseleave",function(){return c.onLeave()})},standalone:!0})}}return e})();function Ene(e,n){if(1&e&&At(0,"ngx-spinner",15),2&e){const t=Sn().ngIf,s=Sn(2);$e("error",t.error)("text",t.statusText)("connected",t.connected)("ended",t.ended)("small",s.smallScreenEnabled)}}function yne(e,n){1&e&&At(0,"ngx-timer",16),2&e&&$e("started",Sn().ngIf.started)}function bne(e,n){if(1&e&&(At(0,"div",17),Pi(1,"async")),2&e){const t=n.$implicit;nt("hidden",!1===W_(1,3,Sn(3).remoteStreamVideoToggle$)),$e("id",t)}}function Sne(e,n){if(1&e){const t=Sc();Se(0,"ngx-controls",18),Mn("toggleCamera",function(c){return Xo(t),ro(Sn(3).onToggleCamera(c))})("toggleMicrophone",function(c){return Xo(t),ro(Sn(3).onToggleMicrophone(c))})("toggleFullScreen",function(c){return Xo(t),ro(Sn(3).onToggleFullScreen(c))})("toggleSmallScreen",function(c){return Xo(t),ro(Sn(3).onToggleSmallScreen(c))})("endCall",function(){return Xo(t),ro(Sn(3).onEndCall())}),Be()}if(2&e){const t=Sn(3);$e("cameraEnabled",t.cameraEnabled)("microphoneEnabled",t.microphoneEnabled)("fullScreenEnabled",t.fullScreenEnabled)("smallScreenEnabled",t.smallScreenEnabled)("displaySmallScreen",t.displaySmallScreen)}}function Cne(e,n){if(1&e&&(Se(0,"div",2),br(1,Ene,1,5,"ngx-spinner",3)(2,yne,1,1,"ngx-timer",4),At(3,"div",5),function bR(e,n,t,s,c,u,p,_,E,S,w,D,U){ji("NgControlFlow");const V=ue(),H=Vt(),z=void 0!==E,Q=ue(),ie=_?p.bind(Q[ur][ir]):p,ne=new pS(z,ie);Q[He+e]=ne,l_(V,H,e+1,n,t,s,c,Vi(H.consts,u)),z&&l_(V,H,e+2,E,S,w,D,Vi(H.consts,U))}(4,bne,2,5,"div",6,Rt),Se(6,"div",7),_a(),Se(7,"svg",8)(8,"g",9),At(9,"path",10)(10,"path",11),Be(),Se(11,"defs")(12,"clipPath",12),At(13,"rect",13),Be()()()(),br(14,Sne,1,5,"ngx-controls",14),Be()),2&e){const t=n.ngIf,s=Sn(2);Ze(),$e("ngIf",t.loading),Ze(),$e("ngIf",t.started),Ze(),nt("hidden",!s.cameraEnabled||s.smallScreenEnabled),$e("id",s.localContainerId),Ze(),function so(e){const n=gt(null),t=Bi();try{const s=ue(),c=s[we],u=s[t],p=t+1,_=gl(s,p);if(void 0===u.liveCollection){const S=Ao(c,p);u.liveCollection=new Hr(_,s,S)}else u.liveCollection.reset();const E=u.liveCollection;if(function ER(e,n,t){let s,c,u=0,p=e.length-1;if(Array.isArray(n)){let E=n.length-1;for(;u<=p&&u<=E;){const S=e.at(u),w=n[u],D=R_(u,S,u,w,t);if(0!==D){D<0&&e.updateValue(u,w),u++;continue}const U=e.at(p),V=n[E],H=R_(p,U,E,V,t);if(0!==H){H<0&&e.updateValue(p,V),p--,E--;continue}const z=t(u,S),Q=t(p,U),ie=t(u,w);if(Object.is(ie,Q)){const ne=t(E,V);Object.is(ne,z)?(e.swap(u,p),e.updateValue(p,V),E--,p--):e.move(p,u),e.updateValue(u,w),u++}else if(s??=new Yn,c??=yR(e,u,p,t),nn(e,s,u,ie))e.updateValue(u,w),u++,p++;else if(c.has(ie))s.set(z,e.detach(u)),p--;else{const ne=e.create(u,n[u]);e.attach(u,ne),u++,p++}}for(;u<=E;)If(e,s,t,u,n[u]),u++}else if(null!=n){const E=n[Symbol.iterator]();let S=E.next();for(;!S.done&&u<=p;){const w=e.at(u),D=S.value,U=R_(u,w,u,D,t);if(0!==U)U<0&&e.updateValue(u,D),u++,S=E.next();else{s??=new Yn,c??=yR(e,u,p,t);const V=t(u,D);if(nn(e,s,u,V))e.updateValue(u,D),u++,p++,S=E.next();else if(c.has(V)){const H=t(u,w);s.set(H,e.detach(u)),p--}else e.attach(u,e.create(u,D)),u++,p++,S=E.next()}}for(;!S.done;)If(e,s,t,e.length,S.value),S=E.next()}for(;u<=p;)e.destroy(e.detach(p--));s?.forEach(E=>{e.destroy(E)})}(E,e,u.trackByFn),E.updateIndexes(),u.hasEmptyBlock){const S=ga(),w=0===E.length;if($r(s,S,w)){const D=t+2,U=gl(s,D);if(w){const V=Ao(c,D),H=Ta(U,V.tView.ssrId);Wu(U,ce(s,V,void 0,{dehydratedView:H}),0,gd(V,H))}else Lg(U,0)}}}finally{gt(n)}}(s.remoteCalls),Ze(10),$e("ngIf",t.connected&&!t.ended)}}function Tne(e,n){if(1&e&&(Se(0,"div"),br(1,Cne,15,6,"div",1),Pi(2,"async"),Be()),2&e){const t=Sn();$e("@fade",void 0)("@.disabled",!t.animate),Ze(),$e("ngIf",W_(2,3,t.streamState$))}}let Uq=(()=>{class e extends Fq{constructor(t,s){super(s),this.webRtcService=t,this.animate=!0,this.displaySmallScreen=!1,this.debug=!1,this.callEnd=new Dn,this.smallScreenEnabled=!1,this.active=!1,this.streamState$=this.webRtcService.streamState$,this.remoteStreamVideoToggle$=this.webRtcService.remoteStreamVideoToggle$}ngOnInit(){this.webRtcService.init(this.uid,this.channel,this.token,this.debug).pipe(du(1)).subscribe(()=>{this.active=this.smallScreenEnabled,this.callEnd.emit(),this.closeDialog(!0)})}ngOnDestroy(){this.webRtcService.deinit()}get localContainerId(){return this.webRtcService.localContainerId}get remoteCalls(){return this.webRtcService.remoteCalls}get cameraEnabled(){return this.webRtcService.isVideoEnabled()}get microphoneEnabled(){return this.webRtcService.isAudioEnabled()}get fullScreenEnabled(){return!!document.fullscreenElement}onToggleCamera(t){this.webRtcService.toggleVideo(t)}onToggleMicrophone(t){this.webRtcService.toggleAudio(t)}onToggleFullScreen(t){this.webRtcService.toggleFullScreen(t)}onToggleSmallScreen(t){this.smallScreenEnabled=!t,this.active=!0}onEndCall(){this.webRtcService.endCall()}static{this.\u0275fac=function(s){return new(s||e)(oe(z9),oe(Js))}}static{this.\u0275cmp=eo({type:e,selectors:[["ngx-webrtc"]],hostVars:4,hostBindings:function(s,c){2&s&&nt("small-screen",c.smallScreenEnabled)("active",c.active)},inputs:{uid:"uid",token:"token",channel:"channel",animate:"animate",displaySmallScreen:"displaySmallScreen",debug:"debug"},outputs:{callEnd:"callEnd"},standalone:!0,features:[tn,ho],decls:1,vars:1,consts:[[4,"ngIf"],["class","container",4,"ngIf"],[1,"container"],[3,"error","text","connected","ended","small",4,"ngIf"],[3,"started",4,"ngIf"],[1,"container__local",3,"id"],[1,"container__remote",3,"id","hidden"],[1,"container__user-icon"],["viewBox","0 0 64 64","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","user","clip-path","url(#clip0)"],["id","Vector","d","M31.5439 30.829C35.7793 30.829 39.4468 29.3099 42.4434 26.3129C45.4399 23.3163 46.959 19.6498 46.959 15.414C46.959 11.1796 45.4399 7.51267 42.4429 4.51512C39.4458 1.51904 35.7788 0 31.5439 0C27.3081 0 23.6416 1.51904 20.645 4.51561C17.6484 7.51218 16.1289 11.1792 16.1289 15.414C16.1289 19.6498 17.6484 23.3168 20.6455 26.3134C23.6426 29.3095 27.3096 30.829 31.5439 30.829V30.829Z","fill","#0B73C9"],["id","Vector_2","d","M58.5161 49.2127C58.4297 47.9656 58.2549 46.6053 57.9976 45.1688C57.7378 43.7215 57.4033 42.3533 57.0029 41.1029C56.5894 39.8104 56.0269 38.534 55.3315 37.3109C54.6099 36.0414 53.7622 34.9359 52.811 34.0262C51.8164 33.0746 50.5986 32.3094 49.1904 31.7513C47.7871 31.1962 46.2319 30.9149 44.5684 30.9149C43.915 30.9149 43.2832 31.183 42.063 31.9774C41.312 32.4672 40.4336 33.0336 39.4531 33.66C38.6147 34.1942 37.479 34.6947 36.0762 35.1478C34.7075 35.5907 33.3179 35.8153 31.9463 35.8153C30.5747 35.8153 29.1855 35.5907 27.8154 35.1478C26.4141 34.6952 25.2783 34.1947 24.4409 33.6605C23.4697 33.0399 22.5908 32.4735 21.8286 31.9769C20.6099 31.1825 19.9775 30.9144 19.3242 30.9144C17.6602 30.9144 16.1055 31.1962 14.7026 31.7518C13.2954 32.309 12.0771 33.0741 11.0815 34.0267C10.1309 34.9369 9.28271 36.0419 8.56201 37.3109C7.86719 38.534 7.30469 39.8099 6.89062 41.1034C6.49072 42.3538 6.15625 43.7215 5.89648 45.1688C5.63916 46.6033 5.46436 47.9642 5.37793 49.2142C5.29297 50.4388 5.25 51.7098 5.25 52.9934C5.25 56.3343 6.31201 59.0388 8.40625 61.0335C10.4746 63.0017 13.2114 64.0002 16.5396 64.0002H47.356C50.6841 64.0002 53.4199 63.0022 55.4888 61.0335C57.5835 59.0403 58.6455 56.3352 58.6455 52.993C58.645 51.7034 58.6016 50.4314 58.5161 49.2127V49.2127Z","fill","#0B73C9"],["id","clip0"],["width","64","height","64","fill","#0B73C9"],["ngxToggle","",3,"cameraEnabled","microphoneEnabled","fullScreenEnabled","smallScreenEnabled","displaySmallScreen","toggleCamera","toggleMicrophone","toggleFullScreen","toggleSmallScreen","endCall",4,"ngIf"],[3,"error","text","connected","ended","small"],[3,"started"],[1,"container__remote",3,"id"],["ngxToggle","",3,"toggleCamera","toggleMicrophone","toggleFullScreen","toggleSmallScreen","endCall","cameraEnabled","microphoneEnabled","fullScreenEnabled","smallScreenEnabled","displaySmallScreen"]],template:function(s,c){1&s&&br(0,Tne,3,5,"div",0),2&s&&$e("ngIf",c.shown)},dependencies:[CD,dC,pne,gne,_ne,vne],styles:["ngx-timer[_ngcontent-%COMP%]{display:block;padding-top:25px}[_nghost-%COMP%]{bottom:0;max-width:100%;right:0;width:100%;transition:.3s}.active[_nghost-%COMP%]{position:fixed}.small-screen[_nghost-%COMP%]{max-width:210px}.small-screen[_nghost-%COMP%]   ngx-timer[_ngcontent-%COMP%]{padding-top:10px}.small-screen[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{border-radius:10px;box-shadow:#00000059 0 5px 15px;height:200px;max-width:200px;margin-right:10px;margin-bottom:10px}.small-screen[_nghost-%COMP%]   .container__remote[_ngcontent-%COMP%]{border-radius:10px;height:200px;width:200px}.small-screen[_nghost-%COMP%]   .container__remote[_ngcontent-%COMP%]    >div{border-radius:10px}.small-screen[_nghost-%COMP%]   .container__user-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:32px;width:32px}.container[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;max-width:100%;margin-left:auto;overflow:hidden;position:relative;transition:.3s}.container__local[_ngcontent-%COMP%]{border-radius:5px;height:20vh;opacity:1;overflow:hidden;position:absolute;right:1rem;top:1rem;width:20vw;z-index:1;transition:.3s}.container__local.hidden[_ngcontent-%COMP%]{opacity:0;visibility:hidden}.container__local[_ngcontent-%COMP%]:not(:empty){box-shadow:0 3px 8px #00000080}.container__remote[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;left:0;position:absolute;top:0;width:100vw;transition:.3s}.container__remote[_ngcontent-%COMP%]    >div{transition:.3s}.container__remote.hidden[_ngcontent-%COMP%]{display:none}.container__remote.hidden[_ngcontent-%COMP%] + .container__user-icon[_ngcontent-%COMP%]{display:block}.container__remote[_ngcontent-%COMP%]:empty{display:none}.container__user-icon[_ngcontent-%COMP%]{background:#0000004d;border-radius:50%;box-shadow:0 3px 8px #00000080;display:none;left:50%;padding:20px;position:absolute;top:50%;transform:translate(-50%,-50%)}.container__user-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:64px;width:64px}@media screen and (max-width: 769px){ngx-controls[_ngcontent-%COMP%]{opacity:1!important}}"],data:{animation:[xq]},changeDetection:0})}}return e})();function DG(e,n,t=1/0){return Li(n)?DG((s,c)=>AG((u,p)=>n(s,u,c,p))(yE(e(s,c))),t):("number"==typeof n&&(t=n),Em((s,c)=>function wne(e,n,t,s,c,u,p,_){const E=[];let S=0,w=0,D=!1;const U=()=>{D&&!E.length&&!S&&n.complete()},V=z=>S<s?H(z):E.push(z),H=z=>{u&&n.next(z),S++;let Q=!1;yE(t(z,w++)).subscribe(ep(n,ie=>{c?.(ie),u?V(ie):n.next(ie)},()=>{Q=!0},void 0,()=>{if(Q)try{for(S--;E.length&&S<s;){const ie=E.shift();p?Tm(n,p,()=>H(ie)):H(ie)}U()}catch(ie){n.error(ie)}}))};return e.subscribe(ep(n,V,()=>{D=!0,U()})),()=>{_?.()}}(s,c,e,t)))}function Vq(e,n){return n?t=>function Ane(...e){return function Rne(){return function Ine(e=1/0){return DG(D8,e)}(1)}()(Lq(e,_q(e)))}(n.pipe(du(1),function Dne(){return Em((e,n)=>{e.subscribe(ep(n,S8))})}()),t.pipe(Vq(e))):DG((t,s)=>yE(e(t,s)).pipe(du(1),function One(e){return AG(()=>e)}(t)))}let Pne=(()=>{class e{constructor(t,s,c,u){this.document=t,this.componentFactoryResolver=s,this.appRef=c,this.injector=u,this.wrapperSelector="ngx-webrtc-wrapper"}open(t,s={}){return this.appendComponent(t,s)}appendComponent(t,s){const c=this.componentFactoryResolver.resolveComponentFactory(t).create(this.injector),{instance:u}=c;Object.keys(s).forEach(_=>u[_]=s[_]),this.appRef.attachView(c.hostView);const p=c.hostView.rootNodes[0];return this.getContainer().append(p),u.afterClosed.pipe(du(1),function Nne(e,n=O8){const t=N8(e,n);return Vq(()=>t)}(250)).subscribe(()=>{this.appRef.detachView(c.hostView),c.destroy()}),u}getContainer(){let t=this.document.querySelector(`.${this.wrapperSelector}`);return t||(t=this.document.createElement("div"),t.setAttribute("class",this.wrapperSelector),t.setAttribute("style","position: fixed; top: 0; width: 100%; z-index: 1;"),this.document.body.appendChild(t)),t}static{this.\u0275fac=function(s){return new(s||e)(ye(Ve),ye(rf),ye(bi),ye(Dr))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Mne=(()=>{class e{constructor(t){this.dialog=t}open(t){const s=new HO,c=this.dialog.open(dne,{data:t});return c.afterClosed.asObservable().pipe(function ine(e,n){return Em((t,s)=>{let c=null,u=0,p=!1;const _=()=>p&&!c&&s.complete();t.subscribe(ep(s,E=>{c?.unsubscribe();let S=0;const w=u++;yE(e(E,w)).subscribe(c=ep(s,D=>s.next(n?n(E,D,w,S++):D),()=>{c=null,_()}))},()=>{p=!0,_()}))})}(u=>u?.channel?this.dialog.open(Uq,{uid:u.uid,token:u.token,channel:u.channel,debug:!!u.debug,displaySmallScreen:!0}).afterClosed.asObservable():function rne(...e){return Lq(e,_q(e))}(!1)),du(1),function one(e,n,t){const s=Li(e)||n||t?{next:e,error:n,complete:t}:e;return s?Em((c,u)=>{var p;null===(p=s.subscribe)||void 0===p||p.call(s);let _=!0;c.subscribe(ep(u,E=>{var S;null===(S=s.next)||void 0===S||S.call(s,E),u.next(E)},()=>{var E;_=!1,null===(E=s.complete)||void 0===E||E.call(s),u.complete()},E=>{var S;_=!1,null===(S=s.error)||void 0===S||S.call(s,E),u.error(E)},()=>{var E,S;_&&(null===(E=s.unsubscribe)||void 0===E||E.call(s)),null===(S=s.finalize)||void 0===S||S.call(s)}))}):D8}(()=>s.next(!0))).subscribe(),{acceptCall:c.onAcceptCall.bind(c),close:c.closeDialog.bind(c),afterConfirmation:()=>c.afterClosed.asObservable().pipe(du(1)),afterCallEnd:()=>s.asObservable().pipe(du(1))}}static{this.\u0275fac=function(s){return new(s||e)(ye(Pne))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();(function ia(e,n){return Lx({rootComponent:e,...em(n)})})(gY,{providers:[function uY(e,...n){return vu([{provide:lt,multi:!0,useValue:e},[],{provide:ru,useFactory:$z,deps:[su]},{provide:FS,multi:!0,useFactory:Xz},n.map(t=>t.\u0275providers)])}([{path:"",component:(()=>{class e{constructor(t,s,c,u,p){this.formBuilder=t,this.router=s,this.localStorage=c,this.videoCallDialogService=u,this.cdr=p,this.sessionKey="ngx-webrtc:channelId",this.outcome=!1}get channelId(){return this.localStorage.getItem(this.sessionKey)||"test-channel-ngx-webrtc"}get tooltipText(){return this.outcome?"Outcome":"Income"}ngOnInit(){this.form=this.formBuilder.group({channelId:[this.channelId,X9.required]})}onSubmit(){this.saveChannel(),this.router.navigate(["conference"],{queryParams:{...this.form.value}})}onModalOpen(){this.saveChannel(),this.dialog=this.videoCallDialogService.open({uid:String(Math.floor(100*Math.random())),channel:this.channelId,outcome:this.outcome,user:{name:"Test User",photoURL:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTvDtoEwuV9E2kHqNDi6MnBzXlefn8TfyrwgQ&usqp=CAU"},debug:!0});const t=setTimeout(()=>this.dialog?.close(),7e3);this.dialog.afterConfirmation().pipe(Ns(s=>!!s),pi(()=>clearTimeout(t))).subscribe(),this.dialog.afterCallEnd().subscribe(()=>{clearTimeout(t),this.dialog=null,this.cdr.markForCheck()})}saveChannel(){const{channelId:t}=this.form.value;this.localStorage.setItem(this.sessionKey,t)}static{this.\u0275fac=function(s){return new(s||e)(oe(kZ),oe(su),oe(Storage),oe(Mne),oe(Js))}}static{this.\u0275cmp=eo({type:e,selectors:[["app-home"]],standalone:!0,features:[ho],decls:25,vars:8,consts:[[1,"home"],[1,"home__welcome"],[1,"home__form",3,"ngSubmit","formGroup"],[1,"home__wrapper","home__wrapper--center"],["src","assets/user.svg","alt","User",1,"user"],[1,"home__title"],["appearance","outline",1,"home__wrapper"],["matInput","","placeholder","Channel id","formControlName","channelId"],[1,"home__wrapper","home__wrapper--center","home__wrapper--buttons"],["mat-flat-button","","color","primary",1,"home__btn",3,"disabled"],["mat-raised-button","","type","button",1,"home__btn",3,"click","disabled"],[3,"change","click","checked","disabled","matTooltip"],[1,"home__footer"],["href","https://www.npmjs.com/package/ngx-webrtc-lib","target","_blank"],["viewBox","0 0 27.23 27.23"],["width","27.23","height","27.23","rx","2"],["fill","#fff","points","5.8 21.75 13.66 21.75 13.67 9.98 17.59 9.98 17.58 21.76 21.51 21.76 21.52 6.06 5.82 6.04 5.8 21.75"],["href","https://github.com/TarasMoskovych/ngx-webrtc","target","_blank"],["aria-hidden","true","role","img","viewBox","0 0 16 16","width","50","height","50",1,""],["fill-rule","evenodd","d","M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"]],template:function(s,c){1&s&&(Se(0,"div",0)(1,"div",1)(2,"form",2),Mn("ngSubmit",function(){return!c.dialog&&c.onSubmit()}),Se(3,"div",3),At(4,"img",4),Be(),Se(5,"h1",5),fn(6," Welcome "),Be(),Se(7,"mat-form-field",6)(8,"mat-label"),fn(9,"Channel Id"),Be(),At(10,"input",7),Be(),Se(11,"div",8)(12,"button",9),fn(13,"Start / Join call"),Be(),Se(14,"button",10),Mn("click",function(){return!c.dialog&&c.onModalOpen()}),fn(15,"Open Call Dialog "),Se(16,"mat-slide-toggle",11),Mn("change",function(p){return c.outcome=p.checked})("click",function(p){return p.stopPropagation()}),Be()()()(),Se(17,"div",12)(18,"a",13),_a(),Se(19,"svg",14),At(20,"rect",15)(21,"polygon",16),Be()(),va(),Se(22,"a",17),_a(),Se(23,"svg",18),At(24,"path",19),Be()()()()()),2&s&&(Ze(2),$e("formGroup",c.form),Ze(5),nt("mat-focused",c.form.valid),Ze(5),$e("disabled",c.form.invalid||!!c.dialog),Ze(2),$e("disabled",c.form.invalid||!!c.dialog),Ze(2),$e("checked",c.outcome)("disabled",!!c.dialog)("matTooltip",c.tooltipText))},dependencies:[dQ,cQ,oee,iee,eee,mG,fee,gG,_te,mte,LZ,L7,LU,E7,y7,XO,$8],styles:[".home[_ngcontent-%COMP%]{align-items:center;background-color:#f2f2f2;display:flex;flex-wrap:wrap;justify-content:center;min-height:100vh;width:100%}.home__welcome[_ngcontent-%COMP%]{background:#fff;border-radius:10px;box-shadow:0 5px 10px #0000001a;overflow:hidden;padding:10px 35px;width:390px}.home__welcome[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]{height:150px}.home__title[_ngcontent-%COMP%]{color:#333;display:block;font-size:30px;font-weight:500;margin:10px 0 60px;text-align:center}.home__wrapper[_ngcontent-%COMP%]{width:100%}.home__wrapper--center[_ngcontent-%COMP%]{text-align:center}.home__wrapper--buttons[_ngcontent-%COMP%]{align-items:center;display:flex}.home__btn[_ngcontent-%COMP%]{letter-spacing:normal}.home__btn[_ngcontent-%COMP%]:first-of-type{margin-right:5px}.home__btn[_ngcontent-%COMP%]:last-of-type{margin-left:5px}.home__footer[_ngcontent-%COMP%]{margin-top:30px;text-align:center}.home__footer[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{fill:#333;cursor:pointer;height:24px;margin:0 5px;width:24px;transition:.3s}.home__footer[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]:hover{fill:#aaa}"],changeDetection:0})}}return e})()},{path:"conference",component:(()=>{class e{constructor(t,s){this.route=t,this.router=s,this.uid=String(Math.floor(100*Math.random()))}ngOnInit(){this.channel=this.route.snapshot.queryParams.channelId||"test-channel"}onCallEnd(){this.router.navigateByUrl("/")}static{this.\u0275fac=function(s){return new(s||e)(oe(ru),oe(su))}}static{this.\u0275cmp=eo({type:e,selectors:[["app-conference"]],standalone:!0,features:[ho],decls:1,vars:4,consts:[[3,"callEnd","animate","channel","debug","uid"]],template:function(s,c){1&s&&(Se(0,"ngx-webrtc",0),Mn("callEnd",function(){return c.onCallEnd()}),Be()),2&s&&$e("animate",!1)("channel",c.channel)("debug",!0)("uid",c.uid)},dependencies:[Uq],changeDetection:0})}}return e})()},{path:"**",redirectTo:""}]),function hX(){return ji("NgEagerAnimations"),[...dX]}(),function LX(e){return vu([z9,{provide:"AgoraConfig",useValue:e}])}({AppID:"67f11adf2f054480b431c8447ff85d91"}),{provide:Storage,useValue:window.localStorage}]}).catch(e=>console.error(e))},372:function(Yl,CE,Im){var L=Im(293).default;Yl.exports=function(){"use strict";var Ji=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ht(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Pt=function(r){try{return!!r()}catch{return!0}},gt=!Pt(function(){var r=function(){}.bind();return"function"!=typeof r||r.hasOwnProperty("prototype")}),nc=gt,$l=Function.prototype,jc=$l.call,pu=nc&&$l.bind.bind(jc,jc),xn=nc?pu:function(r){return function(){return jc.apply(r,arguments)}},Ri=xn({}.isPrototypeOf),Rm=function(r){return r&&r.Math==Math&&r},tr=Rm("object"==typeof globalThis&&globalThis)||Rm("object"==typeof window&&window)||Rm("object"==typeof self&&self)||Rm("object"==typeof Ji&&Ji)||function(){return this}()||Ji||Function("return this")(),vT=Function.prototype,Am=vT.apply,TE=vT.call,rp="object"==typeof Reflect&&Reflect.apply||(gt?TE.bind(Am):function(){return TE.apply(Am,arguments)}),wE=xn,sN=wE({}.toString),IE=wE("".slice),Ho=function(r){return IE(sN(r),8,-1)},RE=Ho,aN=xn,ip=function(r){if("Function"===RE(r))return aN(r)},AE="object"==typeof document&&document.all,op={all:AE,IS_HTMLDDA:void 0===AE&&void 0!==AE},ET=op.all,dr=op.IS_HTMLDDA?function(r){return"function"==typeof r||r===ET}:function(r){return"function"==typeof r},Dm={},ms=!Pt(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),Om=Function.prototype.call,Fr=gt?Om.bind(Om):function(){return Om.apply(Om,arguments)},fu={},lN={}.propertyIsEnumerable,lV=Object.getOwnPropertyDescriptor,PG=lV&&!lN.call({1:2},1);fu.f=PG?function(r){var i=lV(this,r);return!!i&&i.enumerable}:lN;var Hc,DE,mu=function(r,i){return{enumerable:!(1&r),configurable:!(2&r),writable:!(4&r),value:i}},dV=Pt,uV=Ho,yT=Object,bT=xn("".split),OE=dV(function(){return!yT("z").propertyIsEnumerable(0)})?function(r){return"String"==uV(r)?bT(r,""):yT(r)}:yT,Nm=function(r){return null==r},vn=Nm,ST=TypeError,Xl=function(r){if(vn(r))throw ST("Can't call method on "+r);return r},NE=OE,Ur=Xl,Gc=function(r){return NE(Ur(r))},CT=dr,dN=op.all,ri=op.IS_HTMLDDA?function(r){return"object"==typeof r?null!==r:CT(r)||r===dN}:function(r){return"object"==typeof r?null!==r:CT(r)},Qi={},PE=Qi,Pm=tr,hV=dr,uN=function(r){return hV(r)?r:void 0},yo=function(r,i){return arguments.length<2?uN(PE[r])||uN(Pm[r]):PE[r]&&PE[r][i]||Pm[r]&&Pm[r][i]},rc=typeof navigator<"u"&&String(navigator.userAgent)||"",sp=rc,hN=tr.process,ME=tr.Deno,pN=hN&&hN.versions||ME&&ME.version,kE=pN&&pN.v8;kE&&(DE=(Hc=kE.split("."))[0]>0&&Hc[0]<4?1:+(Hc[0]+Hc[1])),!DE&&sp&&(!(Hc=sp.match(/Edge\/(\d+)/))||Hc[1]>=74)&&(Hc=sp.match(/Chrome\/(\d+)/))&&(DE=+Hc[1]);var gu=DE,ap=gu,pV=tr.String,Jl=!!Object.getOwnPropertySymbols&&!Pt(function(){var r=Symbol();return!pV(r)||!(Object(r)instanceof Symbol)||!Symbol.sham&&ap&&ap<41}),fN=Jl&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,TT=yo,Ql=dr,fV=Ri,mN=Object,nr=fN?function(r){return"symbol"==typeof r}:function(r){var i=TT("Symbol");return Ql(i)&&fV(i.prototype,mN(r))},gN=String,cp=function(r){try{return gN(r)}catch{return"Object"}},mV=dr,gV=cp,Gt=TypeError,Go=function(r){if(mV(r))return r;throw Gt(gV(r)+" is not a function")},gs=Go,_N=Nm,Cr=function(r,i){var o=r[i];return _N(o)?void 0:gs(o)},Er=Fr,wT=dr,en=ri,MG=TypeError,IT={exports:{}},ae=tr,lp=Object.defineProperty,RT="__core-js_shared__",vN=tr[RT]||function(r,i){try{lp(ae,r,{value:i,configurable:!0,writable:!0})}catch{ae[r]=i}return i}(RT,{}),_V=vN;(IT.exports=function(r,i){return _V[r]||(_V[r]=void 0!==i?i:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var _u=IT.exports,Wc=Xl,dp=Object,bo=function(r){return dp(Wc(r))},up=bo,EN=xn({}.hasOwnProperty),Rr=Object.hasOwn||function(r,i){return EN(up(r),i)},hp=xn,kG=0,yr=Math.random(),LG=hp(1..toString),yN=function(r){return"Symbol("+(void 0===r?"":r)+")_"+LG(++kG+yr,36)},bN=Rr,fi=yN,AT=Jl,xG=fN,pp=tr.Symbol,Fn=_u("wks"),ht=xG?pp.for||pp:pp&&pp.withoutSetter||fi,En=function(r){return bN(Fn,r)||(Fn[r]=AT&&bN(pp,r)?pp[r]:ht("Symbol."+r)),Fn[r]},_s=Fr,vV=ri,SN=nr,FG=Cr,UG=TypeError,VG=En("toPrimitive"),BG=function(r,i){if(!vV(r)||SN(r))return r;var o,a=FG(r,VG);if(a){if(void 0===i&&(i="default"),o=_s(a,r,i),!vV(o)||SN(o))return o;throw UG("Can't convert object to primitive value")}return void 0===i&&(i="number"),function(r,i){var o,a;if("string"===i&&wT(o=r.toString)&&!en(a=Er(o,r))||wT(o=r.valueOf)&&!en(a=Er(o,r))||"string"!==i&&wT(o=r.toString)&&!en(a=Er(o,r)))return a;throw MG("Can't convert object to primitive value")}(r,i)},jG=nr,FE=function(r){var i=BG(r,"string");return jG(i)?i:i+""},EV=ri,DT=tr.document,HG=EV(DT)&&EV(DT.createElement),So=function(r){return HG?DT.createElement(r):{}},it=So,yV=!ms&&!Pt(function(){return 7!=Object.defineProperty(it("div"),"a",{get:function(){return 7}}).a}),WG=Fr,zG=fu,KG=mu,Oe=Gc,qG=FE,qr=Rr,UE=yV,CN=Object.getOwnPropertyDescriptor;Dm.f=ms?CN:function(r,i){if(r=Oe(r),i=qG(i),UE)try{return CN(r,i)}catch{}if(qr(r,i))return KG(!WG(zG.f,r,i),r[i])};var TN=Pt,bV=dr,VE=/#|\.prototype\./,td=function(r,i){var o=wN[OT(r)];return o==Te||o!=SV&&(bV(i)?TN(i):!!i)},OT=td.normalize=function(r){return String(r).replace(VE,".").toLowerCase()},wN=td.data={},SV=td.NATIVE="N",Te=td.POLYFILL="P",BE=td,NT=Go,IN=gt,PT=ip(ip.bind),nd=function(r,i){return NT(r),void 0===i?r:IN?PT(r,i):function(){return r.apply(i,arguments)}},Wo={},CV=ms&&Pt(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),YG=ri,$G=String,XG=TypeError,Ai=function(r){if(YG(r))return r;throw XG($G(r)+" is not an object")},MT=yV,km=Ai,ic=FE,Lm=TypeError,jE=Object.defineProperty,wt=Object.getOwnPropertyDescriptor,ln="enumerable",RN="configurable",LT="writable";Wo.f=ms?CV?function(r,i,o){if(km(r),i=ic(i),km(o),"function"==typeof r&&"prototype"===i&&"value"in o&&LT in o&&!o[LT]){var a=wt(r,i);a&&a[LT]&&(r[i]=o.value,o={configurable:RN in o?o[RN]:a[RN],enumerable:ln in o?o[ln]:a[ln],writable:!1})}return jE(r,i,o)}:jE:function(r,i,o){if(km(r),i=ic(i),km(o),MT)try{return jE(r,i,o)}catch{}if("get"in o||"set"in o)throw Lm("Accessors not supported");return"value"in o&&(r[i]=o.value),r};var TV=Wo,ZG=mu,rd=ms?function(r,i,o){return TV.f(r,i,ZG(1,o))}:function(r,i,o){return r[i]=o,r},fp=tr,Yt=rp,xT=ip,AN=dr,zo=Dm.f,DN=BE,xm=Qi,JG=nd,oc=rd,HE=Rr,GE=function(r){var i=function(o,a,l){if(this instanceof i){switch(arguments.length){case 0:return new r;case 1:return new r(o);case 2:return new r(o,a)}return new r(o,a,l)}return Yt(r,this,arguments)};return i.prototype=r.prototype,i},xt=function(r,i){var o,a,l,d,h,f,m,g,v,y=r.target,b=r.global,C=r.stat,P=r.proto,R=b?fp:C?fp[y]:(fp[y]||{}).prototype,A=b?xm:xm[y]||oc(xm,y,{})[y],O=A.prototype;for(d in i)a=!(o=DN(b?d:y+(C?".":"#")+d,r.forced))&&R&&HE(R,d),f=A[d],a&&(m=r.dontCallGetSet?(v=zo(R,d))&&v.value:R[d]),h=a&&m?m:i[d],a&&typeof f==typeof h||(g=r.bind&&a?JG(h,fp):r.wrap&&a?GE(h):P&&AN(h)?xT(h):h,(r.sham||h&&h.sham||f&&f.sham)&&oc(g,"sham",!0),oc(A,d,g),P&&(HE(xm,l=y+"Prototype")||oc(xm,l,{}),oc(xm[l],d,h),r.real&&O&&(o||!O[d])&&oc(O,d,h)))},wV=Math.ceil,IV=Math.floor,mp=Math.trunc||function(r){var i=+r;return(i>0?IV:wV)(i)},FT=function(r){var i=+r;return i!=i||0===i?0:mp(i)},id=FT,RV=Math.max,ye=Math.min,WE=function(r,i){var o=id(r);return o<0?RV(o+i,0):ye(o,i)},me=FT,zE=Math.min,KE=function(r){return r>0?zE(me(r),9007199254740991):0},Fm=KE,zc=function(r){return Fm(r.length)},AV=Gc,DV=WE,OV=zc,qE=function(r){return function(i,o,a){var l,d=AV(i),h=OV(d),f=DV(a,h);if(r&&o!=o){for(;h>f;)if((l=d[f++])!=l)return!0}else for(;h>f;f++)if((r||f in d)&&d[f]===o)return r||f||0;return!r&&-1}},UT={includes:qE(!0),indexOf:qE(!1)},VT=UT.includes;xt({target:"Array",proto:!0,forced:Pt(function(){return!Array(1).includes()})},{includes:function(r){return VT(this,r,arguments.length>1?arguments[1]:void 0)}});var NV=Qi,Di=function(r){return NV[r+"Prototype"]},PV=Di("Array").includes,Ko=ri,gp=Ho,NN=En("match"),Um=function(r){var i;return Ko(r)&&(void 0!==(i=r[NN])?!!i:"RegExp"==gp(r))},YE=Um,BT=TypeError,MV={};MV[En("toStringTag")]="z";var $E="[object z]"===String(MV),QG=$E,vs=dr,_p=Ho,vp=En("toStringTag"),eW=Object,PN="Arguments"==_p(function(){return arguments}()),mi=QG?_p:function(r){var i,o,a;return void 0===r?"Undefined":null===r?"Null":"string"==typeof(o=function(l,d){try{return l[d]}catch{}}(i=eW(r),vp))?o:PN?_p(i):"Object"==(a=_p(i))&&vs(i.callee)?"Arguments":a},dn=mi,sc=String,qo=function(r){if("Symbol"===dn(r))throw TypeError("Cannot convert a Symbol value to a string");return sc(r)},jT=En("match"),XE=xt,ca=Xl,Kc=qo,HT=xn("".indexOf);XE({target:"String",proto:!0,forced:!function(r){var i=/./;try{"/./"[r](i)}catch{try{return i[jT]=!1,"/./"[r](i)}catch{}}return!1}("includes")},{includes:function(r){return!!~HT(Kc(ca(this)),Kc(function(r){if(YE(r))throw BT("The method doesn't accept regular expressions");return r}(r)),arguments.length>1?arguments[1]:void 0)}});var MN=Di("String").includes,GT=Ri,Vm=PV,kN=MN,JE=Array.prototype,WT=String.prototype,he=Ht(function(r){var i=r.includes;return r===JE||GT(JE,r)&&i===JE.includes?Vm:"string"==typeof r||r===WT||GT(WT,r)&&i===WT.includes?kN:i}),LV=Go,la=bo,xV=OE,LN=zc,FV=TypeError,xN=function(r){return function(i,o,a,l){LV(o);var d=la(i),h=xV(d),f=LN(d),m=r?f-1:0,g=r?-1:1;if(a<2)for(;;){if(m in h){l=h[m],m+=g;break}if(m+=g,r?m<0:f<=m)throw FV("Reduce of empty array with no initial value")}for(;r?m>=0:f>m;m+=g)m in h&&(l=o(l,h[m],m,d));return l}},UV={left:xN(!1),right:xN(!0)},VV=Pt,Bm=function(r,i){var o=[][r];return!!o&&VV(function(){o.call(null,i||function(){return 1},1)})},Ep=typeof process<"u"&&"process"==Ho(process),BV=UV.left;xt({target:"Array",proto:!0,forced:!Ep&&gu>79&&gu<83||!Bm("reduce")},{reduce:function(r){var i=arguments.length;return BV(this,r,i,i>1?arguments[1]:void 0)}});var jV=Di("Array").reduce,eo=Ri,HV=jV,KT=Array.prototype,qT=function(r){var i=r.reduce;return r===KT||eo(KT,r)&&i===KT.reduce?HV:i},Ue=Ht(qT);let Co=!0,Wt=!0;function Vr(r,i,o){const a=r.match(i);return a&&a.length>=o&&parseInt(a[o],10)}function Ar(r,i,o){if(!r.RTCPeerConnection)return;const a=r.RTCPeerConnection.prototype,l=a.addEventListener;a.addEventListener=function(h,f){if(h!==i)return l.apply(this,arguments);const m=g=>{const v=o(g);v&&(f.handleEvent?f.handleEvent(v):f(v))};return this._eventMap=this._eventMap||{},this._eventMap[i]||(this._eventMap[i]=new Map),this._eventMap[i].set(f,m),l.apply(this,[h,m])};const d=a.removeEventListener;a.removeEventListener=function(h,f){if(h!==i||!this._eventMap||!this._eventMap[i])return d.apply(this,arguments);if(!this._eventMap[i].has(f))return d.apply(this,arguments);const m=this._eventMap[i].get(f);return this._eventMap[i].delete(f),0===this._eventMap[i].size&&delete this._eventMap[i],0===Object.keys(this._eventMap).length&&delete this._eventMap,d.apply(this,[h,m])},Object.defineProperty(a,"on"+i,{get(){return this["_on"+i]},set(h){this["_on"+i]&&(this.removeEventListener(i,this["_on"+i]),delete this["_on"+i]),h&&this.addEventListener(i,this["_on"+i]=h)},enumerable:!0,configurable:!0})}function od(r){return"boolean"!=typeof r?new Error("Argument type: "+typeof r+". Please use a boolean."):(Co=r,r?"adapter.js logging disabled":"adapter.js logging enabled")}function to(r){return"boolean"!=typeof r?new Error("Argument type: "+typeof r+". Please use a boolean."):(Wt=!r,"adapter.js deprecation warnings "+(r?"disabled":"enabled"))}function YT(){if("object"==typeof window){if(Co)return;typeof console<"u"&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function QE(r,i){Wt&&console.warn(r+" is deprecated, please use "+i+" instead.")}function jm(r){return"[object Object]"===Object.prototype.toString.call(r)}function FN(r){var i;return jm(r)?Ue(i=Object.keys(r)).call(i,function(o,a){const l=jm(r[a]),d=l?FN(r[a]):r[a],h=l&&!Object.keys(d).length;return void 0===d||h?o:Object.assign(o,{[a]:d})},{}):r}function $T(r,i,o){i&&!o.has(i.id)&&(o.set(i.id,i),Object.keys(i).forEach(a=>{a.endsWith("Id")?$T(r,r.get(i[a]),o):a.endsWith("Ids")&&i[a].forEach(l=>{$T(r,r.get(l),o)})}))}function vu(r,i,o){const a=o?"outbound-rtp":"inbound-rtp",l=new Map;if(null===i)return l;const d=[];return r.forEach(h=>{"track"===h.type&&h.trackIdentifier===i.id&&d.push(h)}),d.forEach(h=>{r.forEach(f=>{f.type===a&&f.trackId===h.id&&$T(r,f,l)})}),l}var GV=yN,ey=_u("keys"),Hm=function(r){return ey[r]||(ey[r]=GV(r))},ty=!Pt(function(){function r(){}return r.prototype.constructor=null,Object.getPrototypeOf(new r)!==r.prototype}),tW=Rr,XT=dr,WV=bo,ZT=ty,JT=Hm("IE_PROTO"),ny=Object,Eu=ny.prototype,QT=ZT?ny.getPrototypeOf:function(r){var i=WV(r);if(tW(i,JT))return i[JT];var o=i.constructor;return XT(o)&&i instanceof o?o.prototype:i instanceof ny?Eu:null},e0=xn,ry=Go,zV=dr,t0=String,iy=TypeError,yp=Ai,KV=Object.setPrototypeOf||("__proto__"in{}?function(){var r,i=!1,o={};try{(r=function(r,i,o){try{return e0(ry(Object.getOwnPropertyDescriptor(r,i)[o]))}catch{}}(Object.prototype,"__proto__","set"))(o,[]),i=o instanceof Array}catch{}return function(a,l){return yp(a),function(r){if("object"==typeof r||zV(r))return r;throw iy("Can't set "+t0(r)+" as a prototype")}(l),i?r(a,l):a.__proto__=l,a}}():void 0),oy={},Gm={},sd=Rr,qV=Gc,YV=UT.indexOf,$V=Gm,sy=xn([].push),qc=function(r,i){var o,a=qV(r),l=0,d=[];for(o in a)!sd($V,o)&&sd(a,o)&&sy(d,o);for(;i.length>l;)sd(a,o=i[l++])&&(~YV(d,o)||sy(d,o));return d},ay=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],r0=qc,bp=ay.concat("length","prototype");oy.f=Object.getOwnPropertyNames||function(r){return r0(r,bp)};var Wm={};Wm.f=Object.getOwnPropertySymbols;var XV=yo,gi=oy,UN=Wm,ZV=Ai,zm=xn([].concat),JV=XV("Reflect","ownKeys")||function(r){var i=gi.f(ZV(r)),o=UN.f;return o?zm(i,o(r)):i},VN=Rr,QV=JV,eB=Dm,tB=Wo,o0={},s0=qc,cy=ay,rr=Object.keys||function(r){return s0(r,cy)},oi=Wo,da=Ai,Fi=Gc,To=rr;o0.f=ms&&!CV?Object.defineProperties:function(r,i){da(r);for(var o,a=Fi(i),l=To(i),d=l.length,h=0;d>h;)oi.f(r,o=l[h++],a[o]);return r};var Yc,ir=yo("document","documentElement"),si=Ai,ac=o0,pt=ay,Km=Gm,BN=ir,Sp=So,ur="prototype",$c="script",yu=Hm("IE_PROTO"),ua=function(){},bu=function(r){return"<script>"+r+"</"+$c+">"},a0=function(r){r.write(bu("")),r.close();var i=r.parentWindow.Object;return r=null,i},ha=function(){try{Yc=new ActiveXObject("htmlfile")}catch{}var r,i;ha=typeof document<"u"?document.domain&&Yc?a0(Yc):((i=Sp("iframe")).style.display="none",BN.appendChild(i),i.src=String("javascript:"),(r=i.contentWindow.document).open(),r.write(bu("document.F=Object")),r.close(),r.F):a0(Yc);for(var a=pt.length;a--;)delete ha[ur][pt[a]];return ha()};Km[yu]=!0;var ad=Object.create||function(r,i){var o;return null!==r?(ua[ur]=si(r),o=new ua,ua[ur]=null,o[yu]=r):o=ha(),void 0===i?o:ac.f(o,i)},Fs=ri,He=rd,ly=Error,qm=xn("".replace),cc=String(ly("zxcasd").stack),Ym=/\n\s*at [^:]*:[^\n]*/,Cp=Ym.test(cc),Yr=mu,dy=!Pt(function(){var r=Error("a");return!("stack"in r)||(Object.defineProperty(r,"stack",Yr(1,7)),7!==r.stack)}),_i=rd,c0=dy,cd=Error.captureStackTrace,lc={},pa=lc,$m=En("iterator"),jN=Array.prototype,HN=function(r){return void 0!==r&&(pa.Array===r||jN[$m]===r)},l0=mi,d0=Cr,nB=Nm,u0=lc,nW=En("iterator"),h0=function(r){if(!nB(r))return d0(r,nW)||d0(r,"@@iterator")||u0[l0(r)]},rW=Fr,iW=Go,oW=Ai,sW=cp,aW=h0,cW=TypeError,GN=function(r,i){var o=arguments.length<2?aW(r):i;if(iW(o))return oW(rW(o,r));throw cW(sW(r)+" is not iterable")},lW=Fr,rB=Ai,dW=Cr,p0=function(r,i,o){var a,l;rB(r);try{if(!(a=dW(r,"return"))){if("throw"===i)throw o;return o}a=lW(a,r)}catch(d){l=!0,a=d}if("throw"===i)throw o;if(l)throw a;return rB(a),o},WN=nd,uW=Fr,hW=Ai,pW=cp,fW=HN,iB=zc,f0=Ri,$o=GN,zN=h0,KN=p0,oB=TypeError,Xm=function(r,i){this.stopped=r,this.result=i},m0=Xm.prototype,Zm=function(r,i,o){var a,l,d,h,f,m,g,y=!(!o||!o.AS_ENTRIES),b=!(!o||!o.IS_RECORD),C=!(!o||!o.IS_ITERATOR),P=!(!o||!o.INTERRUPTED),R=WN(i,o&&o.that),A=function(M){return a&&KN(a,"normal",M),new Xm(!0,M)},O=function(M){return y?(hW(M),P?R(M[0],M[1],A):R(M[0],M[1])):P?R(M,A):R(M)};if(b)a=r.iterator;else if(C)a=r;else{if(!(l=zN(r)))throw oB(pW(r)+" is not iterable");if(fW(l)){for(d=0,h=iB(r);h>d;d++)if((f=O(r[d]))&&f0(m0,f))return f;return new Xm(!1)}a=$o(r,l)}for(m=b?r.next:a.next;!(g=uW(m,a)).done;){try{f=O(g.value)}catch(M){KN(a,"throw",M)}if("object"==typeof f&&f&&f0(m0,f))return f}return new Xm(!1)},g0=qo,sB=xt,dc=Ri,qN=QT,Jm=KV,uy=ad,Su=rd,Ui=mu,Qm=function(r,i,o,a){c0&&(cd?cd(r,i):_i(r,"stack",function(r,i){if(Cp&&"string"==typeof r&&!ly.prepareStackTrace)for(;i--;)r=qm(r,Ym,"");return r}(o,a)))},Cu=Zm,cB=En("toStringTag"),Tp=Error,lB=[].push,Vi=function(r,i){var o,a=dc(hy,this);Jm?o=Jm(Tp(),a?qN(this):hy):(o=a?this:uy(hy),Su(o,cB,"Error")),void 0!==i&&Su(o,"message",function(r,i){return void 0===r?arguments.length<2?"":i:g0(r)}(i)),Qm(o,Vi,o.stack,1),arguments.length>2&&function(r,i){Fs(i)&&"cause"in i&&He(r,"cause",i.cause)}(o,arguments[2]);var l=[];return Cu(r,lB,{that:l}),Su(o,"errors",l),o};Jm?Jm(Vi,Tp):function(r,i,o){for(var a=QV(i),l=tB.f,d=eB.f,h=0;h<a.length;h++){var f=a[h];VN(r,f)||o&&VN(o,f)||l(r,f,d(i,f))}}(Vi,Tp,{name:!0});var hy=Vi.prototype=uy(Tp.prototype,{constructor:Ui(1,Vi),message:Ui(1,""),name:Ui(1,"AggregateError")});sB({global:!0,constructor:!0,arity:2},{AggregateError:Vi});var eg,wp,Tu,tg=tr.WeakMap,py=dr(tg)&&/native code/.test(String(tg)),Xc=ri,_t=rd,Ip=Rr,YN=Hm,mW=Gm,$N="Object already initialized",v0=tr.TypeError;if(py||vN.state){var fa=vN.state||(vN.state=new(0,tr.WeakMap));fa.get=fa.get,fa.has=fa.has,fa.set=fa.set,eg=function(r,i){if(fa.has(r))throw v0($N);return i.facade=r,fa.set(r,i),i},wp=function(r){return fa.get(r)||{}},Tu=function(r){return fa.has(r)}}else{var Us=YN("state");mW[Us]=!0,eg=function(r,i){if(Ip(r,Us))throw v0($N);return i.facade=r,_t(r,Us,i),i},wp=function(r){return Ip(r,Us)?r[Us]:{}},Tu=function(r){return Ip(r,Us)}}var wu,XN,ZN,Iu={set:eg,get:wp,has:Tu,enforce:function(r){return Tu(r)?wp(r):eg(r,{})},getterFor:function(r){return function(i){var o;if(!Xc(i)||(o=wp(i)).type!==r)throw v0("Incompatible receiver, "+r+" required");return o}}},E0=ms,Vt=Function.prototype,Xo=E0&&Object.getOwnPropertyDescriptor,ro=Rr(Vt,"name"),Un={EXISTS:ro,PROPER:ro&&"something"===function(){}.name,CONFIGURABLE:ro&&(!E0||E0&&Xo(Vt,"name").configurable)},JN=rd,Vs=function(r,i,o,a){return a&&a.enumerable?r[i]=o:JN(r,i,o),r},ma=Pt,y0=dr,b0=ri,QN=ad,uB=QT,gW=Vs,my=En("iterator"),S0=!1;[].keys&&("next"in(ZN=[].keys())?(XN=uB(uB(ZN)))!==Object.prototype&&(wu=XN):S0=!0);var eP=!b0(wu)||ma(function(){var r={};return wu[my].call(r)!==r});y0((wu=eP?{}:QN(wu))[my])||gW(wu,my,function(){return this});var io={IteratorPrototype:wu,BUGGY_SAFARI_ITERATORS:S0},Zc=mi,ga=$E,Jc=Wo.f,hB=rd,nP=Rr,pB=$E?{}.toString:function(){return"[object "+Zc(this)+"]"},rP=En("toStringTag"),uc=function(r,i,o,a){if(r){var l=o?r:r.prototype;nP(l,rP)||Jc(l,rP,{configurable:!0,value:i}),a&&!ga&&hB(l,"toString",pB)}},C0=io.IteratorPrototype,T0=ad,gy=mu,fB=uc,iP=lc,w0=function(){return this},_y=function(r,i,o,a){var l=i+" Iterator";return r.prototype=T0(C0,{next:gy(+!a,o)}),fB(r,l,!1,!0),iP[l]=w0,r},oP=xt,sP=Fr,I0=_y,mB=QT,Bi=uc,ld=Vs,or=lc,gB=Un.PROPER,va=io.BUGGY_SAFARI_ITERATORS,R0=En("iterator"),rg="values",Rp="entries",hc=function(){return this},cP=function(r,i,o,a,l,d,h){I0(o,i,a);var f,m,g,v=function(O){if(O===l&&R)return R;if(!va&&O in C)return C[O];switch(O){case"keys":case rg:case Rp:return function(){return new o(this,O)}}return function(){return new o(this)}},y=i+" Iterator",b=!1,C=r.prototype,P=C[R0]||C["@@iterator"]||l&&C[l],R=!va&&P||v(l),A="Array"==i&&C.entries||P;if(A&&(f=mB(A.call(new r)))!==Object.prototype&&f.next&&(Bi(f,y,!0,!0),or[y]=hc),gB&&l==rg&&P&&P.name!==rg&&(b=!0,R=function(){return sP(P,this)}),l)if(m={values:v(rg),keys:d?R:v("keys"),entries:v(Rp)},h)for(g in m)(va||b||!(g in C))&&ld(C,g,m[g]);else oP({target:i,proto:!0,forced:va||b},m);return h&&C[R0]!==R&&ld(C,R0,R,{name:l}),or[i]=R,m},Ap=function(r,i){return{value:r,done:i}},vy=Gc,ig=lc,lP=cP,D0=Ap,dP="Array Iterator",Dp=Iu.set,og=Iu.getterFor(dP);lP(Array,"Array",function(r,i){Dp(this,{type:dP,target:vy(r),index:0,kind:i})},function(){var r=og(this),i=r.target,o=r.kind,a=r.index++;return!i||a>=i.length?(r.target=void 0,D0(void 0,!0)):D0("keys"==o?a:"values"==o?i[a]:[a,i[a]],!1)},"values"),ig.Arguments=ig.Array;var _B=Wo,Op=function(r,i,o){return _B.f(r,i,o)},uP=yo,vB=Op,EB=ms,hP=En("species"),_W=Ri,vW=TypeError,sg=function(r,i){if(_W(i,r))return r;throw vW("Incorrect invocation")},Ru=dr,ag=vN,cg=xn(Function.toString);Ru(ag.inspectSource)||(ag.inspectSource=function(r){return cg(r)});var pP=ag.inspectSource,lg=xn,yB=Pt,yy=dr,by=mi,EW=pP,O0=function(){},fP=[],mP=yo("Reflect","construct"),Bs=/^\s*(?:class|function)\b/,bB=lg(Bs.exec),Sy=!Bs.exec(O0),Au=function(r){if(!yy(r))return!1;try{return mP(O0,fP,r),!0}catch{return!1}},N0=function(r){if(!yy(r))return!1;switch(by(r)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Sy||!!bB(Bs,EW(r))}catch{return!0}};N0.sham=!0;var dd,ud,gP,Cy,dg=!mP||yB(function(){var r;return Au(Au.call)||!Au(Object)||!Au(function(){r=!0})||r})?N0:Au,_P=dg,vP=cp,SB=TypeError,ug=Ai,CB=Nm,EP=En("species"),Ty=function(r,i){var o,a=ug(r).constructor;return void 0===a||CB(o=ug(a)[EP])?i:function(r){if(_P(r))return r;throw SB(vP(r)+" is not a constructor")}(o)},Qc=xn([].slice),Np=TypeError,Tr=function(r,i){if(r<i)throw Np("Not enough arguments");return r},yP=/(?:ipad|iphone|ipod).*applewebkit/i.test(rc),yn=tr,P0=rp,TB=nd,M0=dr,Pp=Rr,bP=Pt,k0=ir,L0=Qc,hg=So,SP=Tr,wB=yP,IB=Ep,x0=yn.setImmediate,wy=yn.clearImmediate,RB=yn.process,Iy=yn.Dispatch,AB=yn.Function,CP=yn.MessageChannel,yW=yn.String,Ry=0,Mp={},Dr="onreadystatechange";bP(function(){dd=yn.location});var TP=function(r){if(Pp(Mp,r)){var i=Mp[r];delete Mp[r],i()}},F0=function(r){return function(){TP(r)}},DB=function(r){TP(r.data)},U0=function(r){yn.postMessage(yW(r),dd.protocol+"//"+dd.host)};x0&&wy||(x0=function(r){SP(arguments.length,1);var i=M0(r)?r:AB(r),o=L0(arguments,1);return Mp[++Ry]=function(){P0(i,void 0,o)},ud(Ry),Ry},wy=function(r){delete Mp[r]},IB?ud=function(r){RB.nextTick(F0(r))}:Iy&&Iy.now?ud=function(r){Iy.now(F0(r))}:CP&&!wB?(Cy=(gP=new CP).port2,gP.port1.onmessage=DB,ud=TB(Cy.postMessage,Cy)):yn.addEventListener&&M0(yn.postMessage)&&!yn.importScripts&&dd&&"file:"!==dd.protocol&&!bP(U0)?(ud=U0,yn.addEventListener("message",DB,!1)):ud=Dr in hg("script")?function(r){k0.appendChild(hg("script"))[Dr]=function(){k0.removeChild(this),TP(r)}}:function(r){setTimeout(F0(r),0)});var V0={set:x0,clear:wy},Ay=function(){this.head=null,this.tail=null};Ay.prototype={add:function(r){var i={item:r,next:null},o=this.tail;o?o.next=i:this.head=i,this.tail=i},get:function(){var r=this.head;if(r)return null===(this.head=r.next)&&(this.tail=null),r.item}};var Ou,Nu,B0,j0,hd,OB=Ay,NB=/ipad|iphone|ipod/i.test(rc)&&typeof Pebble<"u",Dn=/web0s(?!.*chrome)/i.test(rc),pc=tr,H0=nd,IP=V0.set,G0=OB,Dy=yP,PB=NB,ft=Dn,W0=Ep,Oy=pc.MutationObserver||pc.WebKitMutationObserver,RP=pc.document,AP=pc.process,kp=pc.Promise,z0=(0,Dm.f)(pc,"queueMicrotask"),Ny=z0&&z0.value;if(!Ny){var Lp=new G0,Py=function(){var r,i;for(W0&&(r=AP.domain)&&r.exit();i=Lp.get();)try{i()}catch(o){throw Lp.head&&Ou(),o}r&&r.enter()};Dy||W0||ft||!Oy||!RP?!PB&&kp&&kp.resolve?((j0=kp.resolve(void 0)).constructor=kp,hd=H0(j0.then,j0),Ou=function(){hd(Py)}):W0?Ou=function(){AP.nextTick(Py)}:(IP=H0(IP,pc),Ou=function(){IP(Py)}):(Nu=!0,B0=RP.createTextNode(""),new Oy(Py).observe(B0,{characterData:!0}),Ou=function(){B0.data=Nu=!Nu}),Ny=function(r){Lp.head||Ou(),Lp.add(r)}}var DP=Ny,Pu=function(r){try{return{error:!1,value:r()}}catch(i){return{error:!0,value:i}}},Mu=tr.Promise,Ea="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,MB=!Ea&&!Ep&&"object"==typeof window&&"object"==typeof document,OP=tr,My=Mu,bW=dr,SW=BE,CW=pP,kB=MB,xp=Ea,On=gu,K0=My&&My.prototype,LB=En("species"),ku=!1,Fp=bW(OP.PromiseRejectionEvent),Lu={CONSTRUCTOR:SW("Promise",function(){var r=CW(My),i=r!==String(My);if(!i&&66===On||!K0.catch||!K0.finally)return!0;if(!On||On<51||!/native code/.test(r)){var o=new My(function(l){l(1)}),a=function(l){l(function(){},function(){})};if((o.constructor={})[LB]=a,!(ku=o.then(function(){})instanceof a))return!0}return!i&&(kB||xp)&&!Fp}),REJECTION_EVENT:Fp,SUBCLASSING:ku},ya={},Up=Go,pg=TypeError,NP=function(r){var i,o;this.promise=new r(function(a,l){if(void 0!==i||void 0!==o)throw pg("Bad Promise constructor");i=a,o=l}),this.resolve=Up(i),this.reject=Up(o)};ya.f=function(r){return new NP(r)};var fg,PP,FB=xt,ky=Ep,el=tr,xu=Fr,UB=Vs,Zo=uc,MP=Go,Vp=dr,wW=ri,IW=sg,oo=Ty,Fu=V0.set,Ly=DP,VB=Pu,LP=OB,xP=Iu,xy=Mu,Y0=ya,Fy="Promise",UP=Lu.CONSTRUCTOR,BB=Lu.REJECTION_EVENT,$0=xP.getterFor(Fy),VP=xP.set,Bp=xy,jp=xy&&xy.prototype,X0=el.TypeError,Uy=el.document,Vy=el.process,By=Y0.f,jB=By,HB=!!(Uy&&Uy.createEvent&&el.dispatchEvent),jP="unhandledrejection",HP=function(r){var i;return!(!wW(r)||!Vp(i=r.then))&&i},Z0=function(r,i){var o,a,l,d=i.value,h=1==i.state,f=h?r.ok:r.fail,m=r.resolve,g=r.reject,v=r.domain;try{f?(h||(2===i.rejection&&RW(i),i.rejection=1),!0===f?o=d:(v&&v.enter(),o=f(d),v&&(v.exit(),l=!0)),o===r.promise?g(X0("Promise-chain cycle")):(a=HP(o))?xu(a,o,m,g):m(o)):g(d)}catch(y){v&&!l&&v.exit(),g(y)}},GB=function(r,i){r.notified||(r.notified=!0,Ly(function(){for(var o,a=r.reactions;o=a.get();)Z0(o,r);r.notified=!1,i&&!r.rejection&&WB(r)}))},J0=function(r,i,o){var a,l;HB?((a=Uy.createEvent("Event")).promise=i,a.reason=o,a.initEvent(r,!1,!0),el.dispatchEvent(a)):a={promise:i,reason:o},!BB&&(l=el["on"+r])?l(a):r===jP&&function(r,i){try{1==arguments.length?console.error(r):console.error(r,i)}catch{}}("Unhandled promise rejection",o)},WB=function(r){xu(Fu,el,function(){var i,o=r.facade,a=r.value;if(GP(r)&&(i=VB(function(){ky?Vy.emit("unhandledRejection",a,o):J0(jP,o,a)}),r.rejection=ky||GP(r)?2:1,i.error))throw i.value})},GP=function(r){return 1!==r.rejection&&!r.parent},RW=function(r){xu(Fu,el,function(){var i=r.facade;ky?Vy.emit("rejectionHandled",i):J0("rejectionhandled",i,r.value)})},Hp=function(r,i,o){return function(a){r(i,a,o)}},Uu=function(r,i,o){r.done||(r.done=!0,o&&(r=o),r.value=i,r.state=2,GB(r,!0))},mg=function(r,i,o){if(!r.done){r.done=!0,o&&(r=o);try{if(r.facade===i)throw X0("Promise can't be resolved itself");var a=HP(i);a?Ly(function(){var l={done:!1};try{xu(a,i,Hp(mg,l,r),Hp(Uu,l,r))}catch(d){Uu(l,d,r)}}):(r.value=i,r.state=1,GB(r,!1))}catch(l){Uu({done:!1},l,r)}}};UP&&(jp=(Bp=function(r){IW(this,jp),MP(r),xu(fg,this);var i=$0(this);try{r(Hp(mg,i),Hp(Uu,i))}catch(o){Uu(i,o)}}).prototype,(fg=function(r){VP(this,{type:Fy,done:!1,notified:!1,parent:!1,reactions:new LP,rejection:!1,state:0,value:void 0})}).prototype=UB(jp,"then",function(r,i){var o=$0(this),a=By(oo(this,Bp));return o.parent=!0,a.ok=!Vp(r)||r,a.fail=Vp(i)&&i,a.domain=ky?Vy.domain:void 0,0==o.state?o.reactions.add(a):Ly(function(){Z0(a,o)}),a.promise}),PP=function(){var r=new fg,i=$0(r);this.promise=r,this.resolve=Hp(mg,i),this.reject=Hp(Uu,i)},Y0.f=By=function(r){return r===Bp||void 0===r?new PP(r):jB(r)}),FB({global:!0,constructor:!0,wrap:!0,forced:UP},{Promise:Bp}),Zo(Bp,Fy,!1,!0),function(r){var i=uP(r);EB&&i&&!i[hP]&&vB(i,hP,{configurable:!0,get:function(){return this}})}(Fy);var WP=En("iterator"),tl=!1;try{var Gp=0,zP={next:function(){return{done:!!Gp++}},return:function(){tl=!0}};zP[WP]=function(){return this},Array.from(zP,function(){throw 2})}catch{}var KP=Mu,Q0=Lu.CONSTRUCTOR||!function(r,i){if(!i&&!tl)return!1;var o=!1;try{var a={};a[WP]=function(){return{next:function(){return{done:o=!0}}}},r(a)}catch{}return o}(function(r){KP.all(r).then(void 0,function(){})}),nl=Fr,ew=Go,zB=ya,KB=Pu,AW=Zm;xt({target:"Promise",stat:!0,forced:Q0},{all:function(r){var i=this,o=zB.f(i),a=o.resolve,l=o.reject,d=KB(function(){var h=ew(i.resolve),f=[],m=0,g=1;AW(r,function(v){var y=m++,b=!1;g++,nl(h,i,v).then(function(C){b||(b=!0,f[y]=C,--g||a(f))},l)}),--g||a(f)});return d.error&&l(d.value),o.promise}}),xt({target:"Promise",proto:!0,forced:Lu.CONSTRUCTOR,real:!0},{catch:function(r){return this.then(void 0,r)}});var qB=Fr,tw=Go,nw=ya,Wp=Pu,Hy=Zm;xt({target:"Promise",stat:!0,forced:Q0},{race:function(r){var i=this,o=nw.f(i),a=o.reject,l=Wp(function(){var d=tw(i.resolve);Hy(r,function(h){qB(d,i,h).then(o.resolve,a)})});return l.error&&a(l.value),o.promise}});var rw=Fr,gg=ya;xt({target:"Promise",stat:!0,forced:Lu.CONSTRUCTOR},{reject:function(r){var i=gg.f(this);return rw(i.reject,void 0,r),i.promise}});var Gy=Ai,zp=ri,iw=ya,_g=function(r,i){if(Gy(r),zp(i)&&i.constructor===r)return i;var o=iw.f(r);return(0,o.resolve)(i),o.promise},vg=xt,ow=Mu,OW=Lu.CONSTRUCTOR,sw=_g,Eg=yo("Promise"),YB=!OW;vg({target:"Promise",stat:!0,forced:!0},{resolve:function(r){return sw(YB&&this===Eg?ow:this,r)}});var qP=Fr,$B=Go,XB=ya,aw=Pu,YP=Zm;xt({target:"Promise",stat:!0,forced:Q0},{allSettled:function(r){var i=this,o=XB.f(i),a=o.resolve,l=o.reject,d=aw(function(){var h=$B(i.resolve),f=[],m=0,g=1;YP(r,function(v){var y=m++,b=!1;g++,qP(h,i,v).then(function(C){b||(b=!0,f[y]={status:"fulfilled",value:C},--g||a(f))},function(C){b||(b=!0,f[y]={status:"rejected",reason:C},--g||a(f))})}),--g||a(f)});return d.error&&l(d.value),o.promise}});var ZB=Fr,JB=Go,yg=yo,$P=ya,cw=Pu,QB=Zm,ej="No one promise resolved";xt({target:"Promise",stat:!0,forced:Q0},{any:function(r){var i=this,o=yg("AggregateError"),a=$P.f(i),l=a.resolve,d=a.reject,h=cw(function(){var f=JB(i.resolve),m=[],g=0,v=1,y=!1;QB(r,function(b){var C=g++,P=!1;v++,ZB(f,i,b).then(function(R){P||y||(y=!0,l(R))},function(R){P||y||(P=!0,m[C]=R,--v||d(new o(m,ej)))})}),--v||d(new o(m,ej))});return h.error&&d(h.value),a.promise}});var Wy=yo,lw=dr,XP=Ty,ZP=_g,JP=Mu&&Mu.prototype;xt({target:"Promise",proto:!0,real:!0,forced:!!Mu&&Pt(function(){JP.finally.call({then:function(){}},function(){})})},{finally:function(r){var i=XP(this,Wy("Promise")),o=lw(r);return this.then(o?function(a){return ZP(i,r()).then(function(){return a})}:r,o?function(a){return ZP(i,r()).then(function(){throw a})}:r)}});var bg=xn,QP=FT,Bu=qo,eM=Xl,zy=bg("".charAt),dw=bg("".charCodeAt),tM=bg("".slice),uw=function(r){return function(i,o){var a,l,d=Bu(eM(i)),h=QP(o),f=d.length;return h<0||h>=f?r?"":void 0:(a=dw(d,h))<55296||a>56319||h+1===f||(l=dw(d,h+1))<56320||l>57343?r?zy(d,h):a:r?tM(d,h,h+2):l-56320+(a-55296<<10)+65536}},Sg={codeAt:uw(!1),charAt:uw(!0)},nM=Sg.charAt,Ky=qo,Kp=cP,rM=Ap,iM="String Iterator",PW=Iu.set,Yy=Iu.getterFor(iM);Kp(String,"String",function(r){PW(this,{type:iM,string:Ky(r),index:0})},function(){var r,i=Yy(this),o=i.string,a=i.index;return a>=o.length?rM(void 0,!0):(r=nM(o,a),i.index+=r.length,rM(r,!1))});var hw=Qi.Promise,sM=tr,aM=mi,cM=rd,lM=lc,dM=En("toStringTag");for(var pw in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var uM=sM[pw],fw=uM&&uM.prototype;fw&&aM(fw)!==dM&&cM(fw,dM,pw),lM[pw]=lM.Array}var rl=hw,le=Ht(rl);const hM=YT;function nj(r,i){const o=r&&r.navigator;if(!o.mediaDevices)return;const a=function(h){if("object"!=typeof h||h.mandatory||h.optional)return h;const f={};return Object.keys(h).forEach(m=>{if("require"===m||"advanced"===m||"mediaSource"===m)return;const g="object"==typeof h[m]?h[m]:{ideal:h[m]};void 0!==g.exact&&"number"==typeof g.exact&&(g.min=g.max=g.exact);const v=function(y,b){return y?y+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==g.ideal){f.optional=f.optional||[];let y={};"number"==typeof g.ideal?(y[v("min",m)]=g.ideal,f.optional.push(y),y={},y[v("max",m)]=g.ideal,f.optional.push(y)):(y[v("",m)]=g.ideal,f.optional.push(y))}void 0!==g.exact&&"number"!=typeof g.exact?(f.mandatory=f.mandatory||{},f.mandatory[v("",m)]=g.exact):["min","max"].forEach(y=>{void 0!==g[y]&&(f.mandatory=f.mandatory||{},f.mandatory[v(y,m)]=g[y])})}),h.advanced&&(f.optional=(f.optional||[]).concat(h.advanced)),f},l=function(h,f){if(i.version>=61)return f(h);if((h=JSON.parse(JSON.stringify(h)))&&"object"==typeof h.audio){const m=function(g,v,y){v in g&&!(y in g)&&(g[y]=g[v],delete g[v])};m((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),m(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=a(h.audio)}if(h&&"object"==typeof h.video){let m=h.video.facingMode;m=m&&("object"==typeof m?m:{ideal:m});const g=i.version<66;if(m&&("user"===m.exact||"environment"===m.exact||"user"===m.ideal||"environment"===m.ideal)&&(!o.mediaDevices.getSupportedConstraints||!o.mediaDevices.getSupportedConstraints().facingMode||g)){let v;if(delete h.video.facingMode,"environment"===m.exact||"environment"===m.ideal?v=["back","rear"]:"user"!==m.exact&&"user"!==m.ideal||(v=["front"]),v)return o.mediaDevices.enumerateDevices().then(y=>{let b=(y=y.filter(C=>"videoinput"===C.kind)).find(C=>v.some(P=>{var R;return he(R=C.label.toLowerCase()).call(R,P)}));return!b&&y.length&&he(v).call(v,"back")&&(b=y[y.length-1]),b&&(h.video.deviceId=m.exact?{exact:b.deviceId}:{ideal:b.deviceId}),h.video=a(h.video),hM("chrome: "+JSON.stringify(h)),f(h)})}h.video=a(h.video)}return hM("chrome: "+JSON.stringify(h)),f(h)},d=function(h){return i.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(o.getUserMedia=function(h,f,m){l(h,g=>{o.webkitGetUserMedia(g,f,v=>{m&&m(d(v))})})}.bind(o),o.mediaDevices.getUserMedia){const h=o.mediaDevices.getUserMedia.bind(o.mediaDevices);o.mediaDevices.getUserMedia=function(f){return l(f,m=>h(m).then(g=>{if(m.audio&&!g.getAudioTracks().length||m.video&&!g.getVideoTracks().length)throw g.getTracks().forEach(v=>{v.stop()}),new DOMException("","NotFoundError");return g},g=>le.reject(d(g))))}}}function rj(r){r.MediaStream=r.MediaStream||r.webkitMediaStream}function ij(r){if("object"==typeof r&&r.RTCPeerConnection&&!("ontrack"in r.RTCPeerConnection.prototype)){Object.defineProperty(r.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(o){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=o)},enumerable:!0,configurable:!0});const i=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=o=>{o.stream.addEventListener("addtrack",a=>{let l;l=r.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.track.id):{track:a.track};const d=new Event("track");d.track=a.track,d.receiver=l,d.transceiver={receiver:l},d.streams=[o.stream],this.dispatchEvent(d)}),o.stream.getTracks().forEach(a=>{let l;l=r.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.id):{track:a};const d=new Event("track");d.track=a,d.receiver=l,d.transceiver={receiver:l},d.streams=[o.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),i.apply(this,arguments)}}else Ar(r,"track",i=>(i.transceiver||Object.defineProperty(i,"transceiver",{value:{receiver:i.receiver}}),i))}function oj(r){if("object"==typeof r&&r.RTCPeerConnection&&!("getSenders"in r.RTCPeerConnection.prototype)&&"createDTMFSender"in r.RTCPeerConnection.prototype){const i=function(l,d){return{track:d,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===d.kind?l.createDTMFSender(d):null),this._dtmf},_pc:l}};if(!r.RTCPeerConnection.prototype.getSenders){r.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const l=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(h,f){let m=l.apply(this,arguments);return m||(m=i(this,h),this._senders.push(m)),m};const d=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);const f=this._senders.indexOf(h);-1!==f&&this._senders.splice(f,1)}}const o=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(l){this._senders=this._senders||[],o.apply(this,[l]),l.getTracks().forEach(d=>{this._senders.push(i(this,d))})};const a=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(l){this._senders=this._senders||[],a.apply(this,[l]),l.getTracks().forEach(d=>{const h=this._senders.find(f=>f.track===d);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if("object"==typeof r&&r.RTCPeerConnection&&"getSenders"in r.RTCPeerConnection.prototype&&"createDTMFSender"in r.RTCPeerConnection.prototype&&r.RTCRtpSender&&!("dtmf"in r.RTCRtpSender.prototype)){const i=r.RTCPeerConnection.prototype.getSenders;r.RTCPeerConnection.prototype.getSenders=function(){const o=i.apply(this,[]);return o.forEach(a=>a._pc=this),o},Object.defineProperty(r.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}}function sj(r){if(!r.RTCPeerConnection)return;const i=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){const[o,a,l]=arguments;if(arguments.length>0&&"function"==typeof o)return i.apply(this,arguments);if(0===i.length&&(0===arguments.length||"function"!=typeof o))return i.apply(this,[]);const d=function(f){const m={};return f.result().forEach(g=>{const v={id:g.id,timestamp:g.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[g.type]||g.type};g.names().forEach(y=>{v[y]=g.stat(y)}),m[v.id]=v}),m},h=function(f){return new Map(Object.keys(f).map(m=>[m,f[m]]))};return arguments.length>=2?i.apply(this,[function(m){a(h(d(m)))},o]):new le((f,m)=>{i.apply(this,[function(g){f(h(d(g)))},m])}).then(a,l)}}function mw(r){if(!("object"==typeof r&&r.RTCPeerConnection&&r.RTCRtpSender&&r.RTCRtpReceiver))return;if(!("getStats"in r.RTCRtpSender.prototype)){const o=r.RTCPeerConnection.prototype.getSenders;o&&(r.RTCPeerConnection.prototype.getSenders=function(){const l=o.apply(this,[]);return l.forEach(d=>d._pc=this),l});const a=r.RTCPeerConnection.prototype.addTrack;a&&(r.RTCPeerConnection.prototype.addTrack=function(){const l=a.apply(this,arguments);return l._pc=this,l}),r.RTCRtpSender.prototype.getStats=function(){const l=this;return this._pc.getStats().then(d=>vu(d,l.track,!0))}}if(!("getStats"in r.RTCRtpReceiver.prototype)){const o=r.RTCPeerConnection.prototype.getReceivers;o&&(r.RTCPeerConnection.prototype.getReceivers=function(){const a=o.apply(this,[]);return a.forEach(l=>l._pc=this),a}),Ar(r,"track",a=>(a.receiver._pc=a.srcElement,a)),r.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(l=>vu(l,a.track,!1))}}if(!("getStats"in r.RTCRtpSender.prototype)||!("getStats"in r.RTCRtpReceiver.prototype))return;const i=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof r.MediaStreamTrack){const o=arguments[0];let a,l,d;return this.getSenders().forEach(h=>{h.track===o&&(a?d=!0:a=h)}),this.getReceivers().forEach(h=>(h.track===o&&(l?d=!0:l=h),h.track===o)),d||a&&l?le.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():l?l.getStats():le.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}function pM(r){r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};const i=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return i.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const f=i.apply(this,arguments);return this._shimmedLocalStreams[h.id]?-1===this._shimmedLocalStreams[h.id].indexOf(f)&&this._shimmedLocalStreams[h.id].push(f):this._shimmedLocalStreams[h.id]=[h,f],f};const o=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(m=>{if(this.getSenders().find(v=>v.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();o.apply(this,arguments);const f=this.getSenders().filter(m=>-1===h.indexOf(m));this._shimmedLocalStreams[d.id]=[d].concat(f)};const a=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],a.apply(this,arguments)};const l=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const f=this._shimmedLocalStreams[h].indexOf(d);-1!==f&&this._shimmedLocalStreams[h].splice(f,1),1===this._shimmedLocalStreams[h].length&&delete this._shimmedLocalStreams[h]}),l.apply(this,arguments)}}function fM(r,i){if(!r.RTCPeerConnection)return;if(r.RTCPeerConnection.prototype.addTrack&&i.version>=65)return pM(r);const o=r.RTCPeerConnection.prototype.getLocalStreams;r.RTCPeerConnection.prototype.getLocalStreams=function(){const m=o.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(g=>this._reverseStreams[g.id])};const a=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(g=>{if(this.getSenders().find(y=>y.track===g))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const g=new r.MediaStream(m.getTracks());this._streams[m.id]=g,this._reverseStreams[g.id]=m,m=g}a.apply(this,[m])};const l=r.RTCPeerConnection.prototype.removeStream;function d(m,g){let v=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(y=>{const b=m._reverseStreams[y];v=v.replace(new RegExp(m._streams[b.id].id,"g"),b.id)}),new RTCSessionDescription({type:g.type,sdp:v})}r.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},r.RTCPeerConnection.prototype.addTrack=function(m,g){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const v=[].slice.call(arguments,1);if(1!==v.length||!v[0].getTracks().find(C=>C===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(C=>C.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const b=this._streams[g.id];if(b)b.addTrack(m),le.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const C=new r.MediaStream([m]);this._streams[g.id]=C,this._reverseStreams[C.id]=g,this.addStream(C)}return this.getSenders().find(C=>C.track===m)},["createOffer","createAnswer"].forEach(function(m){const g=r.RTCPeerConnection.prototype[m],v={[m](){const y=arguments;return arguments.length&&"function"==typeof arguments[0]?g.apply(this,[b=>{const C=d(this,b);y[0].apply(null,[C])},b=>{y[1]&&y[1].apply(null,b)},arguments[2]]):g.apply(this,arguments).then(b=>d(this,b))}};r.RTCPeerConnection.prototype[m]=v[m]});const h=r.RTCPeerConnection.prototype.setLocalDescription;r.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(m,g){let v=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(y=>{const b=m._reverseStreams[y],C=m._streams[b.id];v=v.replace(new RegExp(b.id,"g"),C.id)}),new RTCSessionDescription({type:g.type,sdp:v})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const f=Object.getOwnPropertyDescriptor(r.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(r.RTCPeerConnection.prototype,"localDescription",{get(){const m=f.get.apply(this);return""===m.type?m:d(this,m)}}),r.RTCPeerConnection.prototype.removeTrack=function(m){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(m._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let g;this._streams=this._streams||{},Object.keys(this._streams).forEach(v=>{this._streams[v].getTracks().find(y=>m.track===y)&&(g=this._streams[v])}),g&&(1===g.getTracks().length?this.removeStream(this._reverseStreams[g.id]):g.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function gw(r,i){!r.RTCPeerConnection&&r.webkitRTCPeerConnection&&(r.RTCPeerConnection=r.webkitRTCPeerConnection),r.RTCPeerConnection&&i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const a=r.RTCPeerConnection.prototype[o],l={[o](){return arguments[0]=new("addIceCandidate"===o?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};r.RTCPeerConnection.prototype[o]=l[o]})}function mM(r,i){Ar(r,"negotiationneeded",o=>{const a=o.target;if(!(i.version<72||a.getConfiguration&&"plan-b"===a.getConfiguration().sdpSemantics)||"stable"===a.signalingState)return o})}var $y=Object.freeze({__proto__:null,fixNegotiationNeeded:mM,shimAddTrackRemoveTrack:fM,shimAddTrackRemoveTrackWithNative:pM,shimGetDisplayMedia:function(r,i){r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||r.navigator.mediaDevices&&("function"==typeof i?r.navigator.mediaDevices.getDisplayMedia=function(o){return i(o).then(a=>{const l=o.video&&o.video.width,d=o.video&&o.video.height;return o.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:o.video&&o.video.frameRate||3}},l&&(o.video.mandatory.maxWidth=l),d&&(o.video.mandatory.maxHeight=d),r.navigator.mediaDevices.getUserMedia(o)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:oj,shimGetStats:sj,shimGetUserMedia:nj,shimMediaStream:rj,shimOnTrack:ij,shimPeerConnection:gw,shimSenderReceiverGetStats:mw});function fc(r,i){const o=r&&r.navigator,a=r&&r.MediaStreamTrack;if(o.getUserMedia=function(l,d,h){QE("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),o.mediaDevices.getUserMedia(l).then(d,h)},!(i.version>55&&"autoGainControl"in o.mediaDevices.getSupportedConstraints())){const l=function(h,f,m){f in h&&!(m in h)&&(h[m]=h[f],delete h[f])},d=o.mediaDevices.getUserMedia.bind(o.mediaDevices);if(o.mediaDevices.getUserMedia=function(h){return"object"==typeof h&&"object"==typeof h.audio&&(h=JSON.parse(JSON.stringify(h)),l(h.audio,"autoGainControl","mozAutoGainControl"),l(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},a&&a.prototype.getSettings){const h=a.prototype.getSettings;a.prototype.getSettings=function(){const f=h.apply(this,arguments);return l(f,"mozAutoGainControl","autoGainControl"),l(f,"mozNoiseSuppression","noiseSuppression"),f}}if(a&&a.prototype.applyConstraints){const h=a.prototype.applyConstraints;a.prototype.applyConstraints=function(f){return"audio"===this.kind&&"object"==typeof f&&(f=JSON.parse(JSON.stringify(f)),l(f,"autoGainControl","mozAutoGainControl"),l(f,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[f])}}}}function qp(r){"object"==typeof r&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Xy(r,i){if("object"!=typeof r||!r.RTCPeerConnection&&!r.mozRTCPeerConnection)return;!r.RTCPeerConnection&&r.mozRTCPeerConnection&&(r.RTCPeerConnection=r.mozRTCPeerConnection),i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(l){const d=r.RTCPeerConnection.prototype[l],h={[l](){return arguments[0]=new("addIceCandidate"===l?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};r.RTCPeerConnection.prototype[l]=h[l]});const o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){const[l,d,h]=arguments;return a.apply(this,[l||null]).then(f=>{if(i.version<53&&!d)try{f.forEach(m=>{m.type=o[m.type]||m.type})}catch(m){if("TypeError"!==m.name)throw m;f.forEach((g,v)=>{f.set(v,Object.assign({},g,{type:o[g.type]||g.type}))})}return f}).then(d,h)}}function _w(r){if("object"!=typeof r||!r.RTCPeerConnection||!r.RTCRtpSender||r.RTCRtpSender&&"getStats"in r.RTCRtpSender.prototype)return;const i=r.RTCPeerConnection.prototype.getSenders;i&&(r.RTCPeerConnection.prototype.getSenders=function(){const a=i.apply(this,[]);return a.forEach(l=>l._pc=this),a});const o=r.RTCPeerConnection.prototype.addTrack;o&&(r.RTCPeerConnection.prototype.addTrack=function(){const a=o.apply(this,arguments);return a._pc=this,a}),r.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):le.resolve(new Map)}}function vw(r){if("object"!=typeof r||!r.RTCPeerConnection||!r.RTCRtpSender||r.RTCRtpSender&&"getStats"in r.RTCRtpReceiver.prototype)return;const i=r.RTCPeerConnection.prototype.getReceivers;i&&(r.RTCPeerConnection.prototype.getReceivers=function(){const o=i.apply(this,[]);return o.forEach(a=>a._pc=this),o}),Ar(r,"track",o=>(o.receiver._pc=o.srcElement,o)),r.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function aj(r){r.RTCPeerConnection&&!("removeStream"in r.RTCPeerConnection.prototype)&&(r.RTCPeerConnection.prototype.removeStream=function(i){QE("removeStream","removeTrack"),this.getSenders().forEach(o=>{var a;o.track&&he(a=i.getTracks()).call(a,o.track)&&this.removeTrack(o)})})}function cj(r){r.DataChannel&&!r.RTCDataChannel&&(r.RTCDataChannel=r.DataChannel)}function lj(r){if("object"!=typeof r||!r.RTCPeerConnection)return;const i=r.RTCPeerConnection.prototype.addTransceiver;i&&(r.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let o=arguments[1]&&arguments[1].sendEncodings;void 0===o&&(o=[]),o=[...o];const a=o.length>0;a&&o.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const l=i.apply(this,arguments);if(a){const{sender:d}=l,h=d.getParameters();(!("encodings"in h)||1===h.encodings.length&&0===Object.keys(h.encodings[0]).length)&&(h.encodings=o,d.sendEncodings=o,this.setParametersPromises.push(d.setParameters(h).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return l})}function Zy(r){if("object"!=typeof r||!r.RTCRtpSender)return;const i=r.RTCRtpSender.prototype.getParameters;i&&(r.RTCRtpSender.prototype.getParameters=function(){const o=i.apply(this,arguments);return"encodings"in o||(o.encodings=[].concat(this.sendEncodings||[{}])),o})}function Jy(r){if("object"!=typeof r||!r.RTCPeerConnection)return;const i=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?le.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}function dj(r){if("object"!=typeof r||!r.RTCPeerConnection)return;const i=r.RTCPeerConnection.prototype.createAnswer;r.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?le.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}var uj=Object.freeze({__proto__:null,shimAddTransceiver:lj,shimCreateAnswer:dj,shimCreateOffer:Jy,shimGetDisplayMedia:function(r,i){r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||r.navigator.mediaDevices&&(r.navigator.mediaDevices.getDisplayMedia=function(o){if(!o||!o.video){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,le.reject(a)}return!0===o.video?o.video={mediaSource:i}:o.video.mediaSource=i,r.navigator.mediaDevices.getUserMedia(o)})},shimGetParameters:Zy,shimGetUserMedia:fc,shimOnTrack:qp,shimPeerConnection:Xy,shimRTCDataChannel:cj,shimReceiverGetStats:vw,shimRemoveStream:aj,shimSenderGetStats:_w});function Ew(r){if("object"==typeof r&&r.RTCPeerConnection){if("getLocalStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in r.RTCPeerConnection.prototype)){const i=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addStream=function(o){var a;this._localStreams||(this._localStreams=[]),he(a=this._localStreams).call(a,o)||this._localStreams.push(o),o.getAudioTracks().forEach(l=>i.call(this,l,o)),o.getVideoTracks().forEach(l=>i.call(this,l,o))},r.RTCPeerConnection.prototype.addTrack=function(o){for(var a=arguments.length,l=new Array(a>1?a-1:0),d=1;d<a;d++)l[d-1]=arguments[d];return l&&l.forEach(h=>{var f;this._localStreams?he(f=this._localStreams).call(f,h)||this._localStreams.push(h):this._localStreams=[h]}),i.apply(this,arguments)}}"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(i){this._localStreams||(this._localStreams=[]);const o=this._localStreams.indexOf(i);if(-1===o)return;this._localStreams.splice(o,1);const a=i.getTracks();this.getSenders().forEach(l=>{he(a).call(a,l.track)&&this.removeTrack(l)})})}}function gM(r){if("object"==typeof r&&r.RTCPeerConnection&&("getRemoteStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in r.RTCPeerConnection.prototype))){Object.defineProperty(r.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(o){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=o),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(l=>{var d;if(this._remoteStreams||(this._remoteStreams=[]),he(d=this._remoteStreams).call(d,l))return;this._remoteStreams.push(l);const h=new Event("addstream");h.stream=l,this.dispatchEvent(h)})})}});const i=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){const o=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(l=>{if(o._remoteStreams||(o._remoteStreams=[]),o._remoteStreams.indexOf(l)>=0)return;o._remoteStreams.push(l);const d=new Event("addstream");d.stream=l,o.dispatchEvent(d)})}),i.apply(o,arguments)}}}function _M(r){if("object"!=typeof r||!r.RTCPeerConnection)return;const i=r.RTCPeerConnection.prototype,o=i.createOffer,a=i.createAnswer,l=i.setLocalDescription,d=i.setRemoteDescription,h=i.addIceCandidate;i.createOffer=function(m,g){const y=o.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return g?(y.then(m,g),le.resolve()):y},i.createAnswer=function(m,g){const y=a.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return g?(y.then(m,g),le.resolve()):y};let f=function(m,g,v){const y=l.apply(this,[m]);return v?(y.then(g,v),le.resolve()):y};i.setLocalDescription=f,f=function(m,g,v){const y=d.apply(this,[m]);return v?(y.then(g,v),le.resolve()):y},i.setRemoteDescription=f,f=function(m,g,v){const y=h.apply(this,[m]);return v?(y.then(g,v),le.resolve()):y},i.addIceCandidate=f}function vM(r){const i=r&&r.navigator;if(i.mediaDevices&&i.mediaDevices.getUserMedia){const o=i.mediaDevices,a=o.getUserMedia.bind(o);i.mediaDevices.getUserMedia=l=>a(EM(l))}!i.getUserMedia&&i.mediaDevices&&i.mediaDevices.getUserMedia&&(i.getUserMedia=function(o,a,l){i.mediaDevices.getUserMedia(o).then(a,l)}.bind(i))}function EM(r){return r&&void 0!==r.video?Object.assign({},r,{video:FN(r.video)}):r}function yM(r){if(!r.RTCPeerConnection)return;const i=r.RTCPeerConnection;r.RTCPeerConnection=function(o,a){if(o&&o.iceServers){const l=[];for(let d=0;d<o.iceServers.length;d++){let h=o.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(QE("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,l.push(h)):l.push(o.iceServers[d])}o.iceServers=l}return new i(o,a)},r.RTCPeerConnection.prototype=i.prototype,"generateCertificate"in i&&Object.defineProperty(r.RTCPeerConnection,"generateCertificate",{get:()=>i.generateCertificate})}function yw(r){"object"==typeof r&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function bw(r){const i=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(o){if(o){void 0!==o.offerToReceiveAudio&&(o.offerToReceiveAudio=!!o.offerToReceiveAudio);const a=this.getTransceivers().find(d=>"audio"===d.receiver.track.kind);!1===o.offerToReceiveAudio&&a?"sendrecv"===a.direction?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":"recvonly"===a.direction&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):!0!==o.offerToReceiveAudio||a||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==o.offerToReceiveVideo&&(o.offerToReceiveVideo=!!o.offerToReceiveVideo);const l=this.getTransceivers().find(d=>"video"===d.receiver.track.kind);!1===o.offerToReceiveVideo&&l?"sendrecv"===l.direction?l.setDirection?l.setDirection("sendonly"):l.direction="sendonly":"recvonly"===l.direction&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive"):!0!==o.offerToReceiveVideo||l||this.addTransceiver("video",{direction:"recvonly"})}return i.apply(this,arguments)}}function bM(r){"object"!=typeof r||r.AudioContext||(r.AudioContext=r.webkitAudioContext)}var r,SM=Object.freeze({__proto__:null,shimAudioContext:bM,shimCallbacksAPI:_M,shimConstraints:EM,shimCreateOfferLegacy:bw,shimGetUserMedia:vM,shimLocalStreamsAPI:Ew,shimRTCIceServerUrls:yM,shimRemoteStreamsAPI:gM,shimTrackEventTransceiver:yw}),Sw="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",Qy=Xl,hj=qo,Cg=Sw,CM=xn("".replace),Yp=RegExp("^["+Cg+"]+"),pj=RegExp("(^|[^"+Cg+"])["+Cg+"]+$"),Cw=function(r){return function(i){var o=hj(Qy(i));return 1&r&&(o=CM(o,Yp,"")),2&r&&(o=CM(o,pj,"$1")),o}},Tw={start:Cw(1),end:Cw(2),trim:Cw(3)},TM=Un.PROPER,wM=Sw,mj=Tw.trim;xt({target:"String",proto:!0,forced:(r="trim",Pt(function(){return!!wM[r]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[r]()||TM&&wM[r].name!==r}))},{trim:function(){return mj(this)}});var gj=Di("String").trim,IM=Ri,MW=gj,RM=String.prototype,vi=Ht(function(r){var i=r.trim;return"string"==typeof r||r===RM||IM(RM,r)&&i===RM.trim?MW:i}),AM={exports:{}};!function(r){const i={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};i.localCName=i.generateIdentifier(),i.splitLines=function(o){return o.trim().split("\n").map(a=>a.trim())},i.splitSections=function(o){return o.split("\nm=").map((a,l)=>(l>0?"m="+a:a).trim()+"\r\n")},i.getDescription=function(o){const a=i.splitSections(o);return a&&a[0]},i.getMediaSections=function(o){const a=i.splitSections(o);return a.shift(),a},i.matchPrefix=function(o,a){return i.splitLines(o).filter(l=>0===l.indexOf(a))},i.parseCandidate=function(o){let a;a=0===o.indexOf("a=candidate:")?o.substring(12).split(" "):o.substring(10).split(" ");const l={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let d=8;d<a.length;d+=2)switch(a[d]){case"raddr":l.relatedAddress=a[d+1];break;case"rport":l.relatedPort=parseInt(a[d+1],10);break;case"tcptype":l.tcpType=a[d+1];break;case"ufrag":l.ufrag=a[d+1],l.usernameFragment=a[d+1];break;default:void 0===l[a[d]]&&(l[a[d]]=a[d+1])}return l},i.writeCandidate=function(o){const a=[];a.push(o.foundation);const l=o.component;a.push("rtp"===l?1:"rtcp"===l?2:l),a.push(o.protocol.toUpperCase()),a.push(o.priority),a.push(o.address||o.ip),a.push(o.port);const d=o.type;return a.push("typ"),a.push(d),"host"!==d&&o.relatedAddress&&o.relatedPort&&(a.push("raddr"),a.push(o.relatedAddress),a.push("rport"),a.push(o.relatedPort)),o.tcpType&&"tcp"===o.protocol.toLowerCase()&&(a.push("tcptype"),a.push(o.tcpType)),(o.usernameFragment||o.ufrag)&&(a.push("ufrag"),a.push(o.usernameFragment||o.ufrag)),"candidate:"+a.join(" ")},i.parseIceOptions=function(o){return o.substring(14).split(" ")},i.parseRtpMap=function(o){let a=o.substring(9).split(" ");const l={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),l.name=a[0],l.clockRate=parseInt(a[1],10),l.channels=3===a.length?parseInt(a[2],10):1,l.numChannels=l.channels,l},i.writeRtpMap=function(o){let a=o.payloadType;void 0!==o.preferredPayloadType&&(a=o.preferredPayloadType);const l=o.channels||o.numChannels||1;return"a=rtpmap:"+a+" "+o.name+"/"+o.clockRate+(1!==l?"/"+l:"")+"\r\n"},i.parseExtmap=function(o){const a=o.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},i.writeExtmap=function(o){return"a=extmap:"+(o.id||o.preferredId)+(o.direction&&"sendrecv"!==o.direction?"/"+o.direction:"")+" "+o.uri+(o.attributes?" "+o.attributes:"")+"\r\n"},i.parseFmtp=function(o){const a={};let l;const d=o.substring(o.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)l=d[h].trim().split("="),a[l[0].trim()]=l[1];return a},i.writeFmtp=function(o){let a="",l=o.payloadType;if(void 0!==o.preferredPayloadType&&(l=o.preferredPayloadType),o.parameters&&Object.keys(o.parameters).length){const d=[];Object.keys(o.parameters).forEach(h=>{d.push(void 0!==o.parameters[h]?h+"="+o.parameters[h]:h)}),a+="a=fmtp:"+l+" "+d.join(";")+"\r\n"}return a},i.parseRtcpFb=function(o){const a=o.substring(o.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},i.writeRtcpFb=function(o){let a="",l=o.payloadType;return void 0!==o.preferredPayloadType&&(l=o.preferredPayloadType),o.rtcpFeedback&&o.rtcpFeedback.length&&o.rtcpFeedback.forEach(d=>{a+="a=rtcp-fb:"+l+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+"\r\n"}),a},i.parseSsrcMedia=function(o){const a=o.indexOf(" "),l={ssrc:parseInt(o.substring(7,a),10)},d=o.indexOf(":",a);return d>-1?(l.attribute=o.substring(a+1,d),l.value=o.substring(d+1)):l.attribute=o.substring(a+1),l},i.parseSsrcGroup=function(o){const a=o.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(l=>parseInt(l,10))}},i.getMid=function(o){const a=i.matchPrefix(o,"a=mid:")[0];if(a)return a.substring(6)},i.parseFingerprint=function(o){const a=o.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},i.getDtlsParameters=function(o,a){return{role:"auto",fingerprints:i.matchPrefix(o+a,"a=fingerprint:").map(i.parseFingerprint)}},i.writeDtlsParameters=function(o,a){let l="a=setup:"+a+"\r\n";return o.fingerprints.forEach(d=>{l+="a=fingerprint:"+d.algorithm+" "+d.value+"\r\n"}),l},i.parseCryptoLine=function(o){const a=o.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},i.writeCryptoLine=function(o){return"a=crypto:"+o.tag+" "+o.cryptoSuite+" "+("object"==typeof o.keyParams?i.writeCryptoKeyParams(o.keyParams):o.keyParams)+(o.sessionParams?" "+o.sessionParams.join(" "):"")+"\r\n"},i.parseCryptoKeyParams=function(o){if(0!==o.indexOf("inline:"))return null;const a=o.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},i.writeCryptoKeyParams=function(o){return o.keyMethod+":"+o.keySalt+(o.lifeTime?"|"+o.lifeTime:"")+(o.mkiValue&&o.mkiLength?"|"+o.mkiValue+":"+o.mkiLength:"")},i.getCryptoParameters=function(o,a){return i.matchPrefix(o+a,"a=crypto:").map(i.parseCryptoLine)},i.getIceParameters=function(o,a){const l=i.matchPrefix(o+a,"a=ice-ufrag:")[0],d=i.matchPrefix(o+a,"a=ice-pwd:")[0];return l&&d?{usernameFragment:l.substring(12),password:d.substring(10)}:null},i.writeIceParameters=function(o){let a="a=ice-ufrag:"+o.usernameFragment+"\r\na=ice-pwd:"+o.password+"\r\n";return o.iceLite&&(a+="a=ice-lite\r\n"),a},i.parseRtpParameters=function(o){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},l=i.splitLines(o)[0].split(" ");a.profile=l[2];for(let h=3;h<l.length;h++){const f=l[h],m=i.matchPrefix(o,"a=rtpmap:"+f+" ")[0];if(m){const g=i.parseRtpMap(m),v=i.matchPrefix(o,"a=fmtp:"+f+" ");switch(g.parameters=v.length?i.parseFmtp(v[0]):{},g.rtcpFeedback=i.matchPrefix(o,"a=rtcp-fb:"+f+" ").map(i.parseRtcpFb),a.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(g.name.toUpperCase())}}}i.matchPrefix(o,"a=extmap:").forEach(h=>{a.headerExtensions.push(i.parseExtmap(h))});const d=i.matchPrefix(o,"a=rtcp-fb:* ").map(i.parseRtcpFb);return a.codecs.forEach(h=>{d.forEach(f=>{h.rtcpFeedback.find(m=>m.type===f.type&&m.parameter===f.parameter)||h.rtcpFeedback.push(f)})}),a},i.writeRtpDescription=function(o,a){let l="";l+="m="+o+" ",l+=a.codecs.length>0?"9":"0",l+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",l+=a.codecs.map(h=>void 0!==h.preferredPayloadType?h.preferredPayloadType:h.payloadType).join(" ")+"\r\n",l+="c=IN IP4 0.0.0.0\r\n",l+="a=rtcp:9 IN IP4 0.0.0.0\r\n",a.codecs.forEach(h=>{l+=i.writeRtpMap(h),l+=i.writeFmtp(h),l+=i.writeRtcpFb(h)});let d=0;return a.codecs.forEach(h=>{h.maxptime>d&&(d=h.maxptime)}),d>0&&(l+="a=maxptime:"+d+"\r\n"),a.headerExtensions&&a.headerExtensions.forEach(h=>{l+=i.writeExtmap(h)}),l},i.parseRtpEncodingParameters=function(o){const a=[],l=i.parseRtpParameters(o),d=-1!==l.fecMechanisms.indexOf("RED"),h=-1!==l.fecMechanisms.indexOf("ULPFEC"),f=i.matchPrefix(o,"a=ssrc:").map(b=>i.parseSsrcMedia(b)).filter(b=>"cname"===b.attribute),m=f.length>0&&f[0].ssrc;let g;const v=i.matchPrefix(o,"a=ssrc-group:FID").map(b=>b.substring(17).split(" ").map(C=>parseInt(C,10)));v.length>0&&v[0].length>1&&v[0][0]===m&&(g=v[0][1]),l.codecs.forEach(b=>{if("RTX"===b.name.toUpperCase()&&b.parameters.apt){let C={ssrc:m,codecPayloadType:parseInt(b.parameters.apt,10)};m&&g&&(C.rtx={ssrc:g}),a.push(C),d&&(C=JSON.parse(JSON.stringify(C)),C.fec={ssrc:m,mechanism:h?"red+ulpfec":"red"},a.push(C))}}),0===a.length&&m&&a.push({ssrc:m});let y=i.matchPrefix(o,"b=");return y.length&&(y=0===y[0].indexOf("b=TIAS:")?parseInt(y[0].substring(7),10):0===y[0].indexOf("b=AS:")?1e3*parseInt(y[0].substring(5),10)*.95-16e3:void 0,a.forEach(b=>{b.maxBitrate=y})),a},i.parseRtcpParameters=function(o){const a={},l=i.matchPrefix(o,"a=ssrc:").map(f=>i.parseSsrcMedia(f)).filter(f=>"cname"===f.attribute)[0];l&&(a.cname=l.value,a.ssrc=l.ssrc);const d=i.matchPrefix(o,"a=rtcp-rsize");a.reducedSize=d.length>0,a.compound=0===d.length;const h=i.matchPrefix(o,"a=rtcp-mux");return a.mux=h.length>0,a},i.writeRtcpParameters=function(o){let a="";return o.reducedSize&&(a+="a=rtcp-rsize\r\n"),o.mux&&(a+="a=rtcp-mux\r\n"),void 0!==o.ssrc&&o.cname&&(a+="a=ssrc:"+o.ssrc+" cname:"+o.cname+"\r\n"),a},i.parseMsid=function(o){let a;const l=i.matchPrefix(o,"a=msid:");if(1===l.length)return a=l[0].substring(7).split(" "),{stream:a[0],track:a[1]};const d=i.matchPrefix(o,"a=ssrc:").map(h=>i.parseSsrcMedia(h)).filter(h=>"msid"===h.attribute);return d.length>0?(a=d[0].value.split(" "),{stream:a[0],track:a[1]}):void 0},i.parseSctpDescription=function(o){const a=i.parseMLine(o),l=i.matchPrefix(o,"a=max-message-size:");let d;l.length>0&&(d=parseInt(l[0].substring(19),10)),isNaN(d)&&(d=65536);const h=i.matchPrefix(o,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:a.fmt,maxMessageSize:d};const f=i.matchPrefix(o,"a=sctpmap:");if(f.length>0){const m=f[0].substring(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:d}}},i.writeSctpDescription=function(o,a){let l=[];return l="DTLS/SCTP"!==o.protocol?["m="+o.kind+" 9 "+o.protocol+" "+a.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+a.port+"\r\n"]:["m="+o.kind+" 9 "+o.protocol+" "+a.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+a.port+" "+a.protocol+" 65535\r\n"],void 0!==a.maxMessageSize&&l.push("a=max-message-size:"+a.maxMessageSize+"\r\n"),l.join("")},i.generateSessionId=function(){return Math.random().toString().substr(2,22)},i.writeSessionBoilerplate=function(o,a,l){let d;const h=void 0!==a?a:2;return d=o||i.generateSessionId(),"v=0\r\no="+(l||"thisisadapterortc")+" "+d+" "+h+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},i.getDirection=function(o,a){const l=i.splitLines(o);for(let d=0;d<l.length;d++)switch(l[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return l[d].substring(2)}return a?i.getDirection(a):"sendrecv"},i.getKind=function(o){return i.splitLines(o)[0].split(" ")[0].substring(2)},i.isRejected=function(o){return"0"===o.split(" ",2)[1]},i.parseMLine=function(o){const a=i.splitLines(o)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},i.parseOLine=function(o){const a=i.matchPrefix(o,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},i.isValidSDP=function(o){if("string"!=typeof o||0===o.length)return!1;const a=i.splitLines(o);for(let l=0;l<a.length;l++)if(a[l].length<2||"="!==a[l].charAt(1))return!1;return!0},r.exports=i}(AM);var DM=AM.exports,ju=Ht(DM),_j=function Sr(r,i){return i.forEach(function(o){o&&"string"!=typeof o&&!Array.isArray(o)&&Object.keys(o).forEach(function(a){if("default"!==a&&!(a in r)){var l=Object.getOwnPropertyDescriptor(o,a);Object.defineProperty(r,a,l.get?l:{enumerable:!0,get:function(){return o[a]}})}})}),Object.freeze(r)}({__proto__:null,default:ju},[DM]);function eb(r){if(!r.RTCIceCandidate||r.RTCIceCandidate&&"foundation"in r.RTCIceCandidate.prototype)return;const i=r.RTCIceCandidate;r.RTCIceCandidate=function(o){if("object"==typeof o&&o.candidate&&0===o.candidate.indexOf("a=")&&((o=JSON.parse(JSON.stringify(o))).candidate=o.candidate.substr(2)),o.candidate&&o.candidate.length){const a=new i(o),l=ju.parseCandidate(o.candidate),d=Object.assign(a,l);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new i(o)},r.RTCIceCandidate.prototype=i.prototype,Ar(r,"icecandidate",o=>(o.candidate&&Object.defineProperty(o,"candidate",{value:new r.RTCIceCandidate(o.candidate),writable:"false"}),o))}function ww(r){!r.RTCIceCandidate||r.RTCIceCandidate&&"relayProtocol"in r.RTCIceCandidate.prototype||Ar(r,"icecandidate",i=>{if(i.candidate){const o=ju.parseCandidate(i.candidate.candidate);"relay"===o.type&&(i.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[o.priority>>24])}return i})}function tb(r,i){if(!r.RTCPeerConnection)return;"sctp"in r.RTCPeerConnection.prototype||Object.defineProperty(r.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const h=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===i.browser&&i.version>=76){const{sdpSemantics:f}=this.getConfiguration();"plan-b"===f&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(f){if(!f||!f.sdp)return!1;const m=ju.splitSections(f.sdp);return m.shift(),m.some(g=>{const v=ju.parseMLine(g);return v&&"application"===v.kind&&-1!==v.protocol.indexOf("SCTP")})}(arguments[0])){const f=function(f){const m=f.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===m||m.length<2)return-1;const g=parseInt(m[1],10);return g!=g?-1:g}(arguments[0]),m=function(f){let m=65536;return"firefox"===i.browser&&(m=i.version<57?-1===f?16384:2147483637:i.version<60?57===i.version?65535:65536:2147483637),m}(f),g=function(f,m){let g=65536;"firefox"===i.browser&&57===i.version&&(g=65535);const v=ju.matchPrefix(f.sdp,"a=max-message-size:");return v.length>0?g=parseInt(v[0].substr(19),10):"firefox"===i.browser&&-1!==m&&(g=2147483637),g}(arguments[0],f);let v;v=0===m&&0===g?Number.POSITIVE_INFINITY:0===m||0===g?Math.max(m,g):Math.min(m,g);const y={};Object.defineProperty(y,"maxMessageSize",{get:()=>v}),this._sctp=y}return h.apply(this,arguments)}}function nb(r){if(!r.RTCPeerConnection||!("createDataChannel"in r.RTCPeerConnection.prototype))return;function i(a,l){const d=a.send;a.send=function(){const h=arguments[0];if("open"===a.readyState&&l.sctp&&(h.length||h.size||h.byteLength)>l.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+l.sctp.maxMessageSize+" bytes)");return d.apply(a,arguments)}}const o=r.RTCPeerConnection.prototype.createDataChannel;r.RTCPeerConnection.prototype.createDataChannel=function(){const a=o.apply(this,arguments);return i(a,this),a},Ar(r,"datachannel",a=>(i(a.channel,a.target),a))}function Iw(r){if(!r.RTCPeerConnection||"connectionState"in r.RTCPeerConnection.prototype)return;const i=r.RTCPeerConnection.prototype;Object.defineProperty(i,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(i,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(o){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),o&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=o)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(o=>{const a=i[o];i[o]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=l=>{const d=l.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const h=new Event("connectionstatechange",l);d.dispatchEvent(h)}return l},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function wg(r,i){if(!r.RTCPeerConnection||"chrome"===i.browser&&i.version>=71||"safari"===i.browser&&i.version>=605)return;const o=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&-1!==a.sdp.indexOf("\na=extmap-allow-mixed")){const l=a.sdp.split("\n").filter(d=>"a=extmap-allow-mixed"!==vi(d).call(d)).join("\n");r.RTCSessionDescription&&a instanceof r.RTCSessionDescription?arguments[0]=new r.RTCSessionDescription({type:a.type,sdp:l}):a.sdp=l}return o.apply(this,arguments)}}function Rw(r,i){if(!r.RTCPeerConnection||!r.RTCPeerConnection.prototype)return;const o=r.RTCPeerConnection.prototype.addIceCandidate;o&&0!==o.length&&(r.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===i.browser&&i.version<78||"firefox"===i.browser&&i.version<68||"safari"===i.browser)&&arguments[0]&&""===arguments[0].candidate?le.resolve():o.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),le.resolve())})}function Aw(r,i){if(!r.RTCPeerConnection||!r.RTCPeerConnection.prototype)return;const o=r.RTCPeerConnection.prototype.setLocalDescription;o&&0!==o.length&&(r.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if("object"!=typeof a||a.type&&a.sdp)return o.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||"offer"!==a.type&&"answer"!==a.type?o.apply(this,[a]):("offer"===a.type?this.createOffer:this.createAnswer).apply(this).then(l=>o.apply(this,[l]))})}var Dw=Object.freeze({__proto__:null,removeExtmapAllowMixed:wg,shimAddIceCandidateNullOrEmpty:Rw,shimConnectionState:Iw,shimMaxMessageSize:tb,shimParameterlessSetLocalDescription:Aw,shimRTCIceCandidate:eb,shimRTCIceCandidateRelayProtocol:ww,shimSendThrowTypeError:nb});!function(){let{window:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const o=YT,a=function(d){const h={browser:null,version:null};if(void 0===d||!d.navigator)return h.browser="Not a browser.",h;const{navigator:f}=d;if(f.mozGetUserMedia)h.browser="firefox",h.version=Vr(f.userAgent,/Firefox\/(\d+)\./,1);else if(f.webkitGetUserMedia||!1===d.isSecureContext&&d.webkitRTCPeerConnection)h.browser="chrome",h.version=Vr(f.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!f.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=Vr(f.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return h}(r),l={browserDetails:a,commonShim:Dw,extractVersion:Vr,disableLog:od,disableWarnings:to,sdp:_j};switch(a.browser){case"chrome":if(!$y||!gw||!i.shimChrome)return o("Chrome shim is not included in this adapter release."),l;if(null===a.version)return o("Chrome shim can not determine version, not shimming."),l;o("adapter.js shimming chrome."),l.browserShim=$y,Rw(r,a),Aw(r),nj(r,a),rj(r),gw(r,a),ij(r),fM(r,a),oj(r),sj(r),mw(r),mM(r,a),eb(r),ww(r),Iw(r),tb(r,a),nb(r),wg(r,a);break;case"firefox":if(!uj||!Xy||!i.shimFirefox)return o("Firefox shim is not included in this adapter release."),l;o("adapter.js shimming firefox."),l.browserShim=uj,Rw(r,a),Aw(r),fc(r,a),Xy(r,a),qp(r),aj(r),_w(r),vw(r),cj(r),lj(r),Zy(r),Jy(r),dj(r),eb(r),Iw(r),tb(r,a),nb(r);break;case"safari":if(!SM||!i.shimSafari)return o("Safari shim is not included in this adapter release."),l;o("adapter.js shimming safari."),l.browserShim=SM,Rw(r,a),Aw(r),yM(r),bw(r),_M(r),Ew(r),gM(r),yw(r),vM(r),bM(r),eb(r),ww(r),tb(r,a),nb(r),wg(r,a);break;default:o("Unsupported browser!")}}({window:typeof window>"u"?void 0:window});var kW=Di("Array").keys,LW=mi,xW=Rr,FW=Ri,UW=kW,Ow=Array.prototype,rb={DOMTokenList:!0,NodeList:!0},wo=Ht(function(r){var i=r.keys;return r===Ow||FW(Ow,r)&&i===Ow.keys||xW(rb,LW(r))?UW:i}),Nw=cp,OM=TypeError,vj=FE,Ej=Wo,NM=mu,il=function(r,i,o){var a=vj(i);a in r?Ej.f(r,a,NM(0,o)):r[a]=o},Jo=WE,ys=zc,PM=il,VW=Array,yj=Math.max,MM=function(r,i,o){for(var a=ys(r),l=Jo(i,a),d=Jo(void 0===o?a:o,a),h=VW(yj(d-l,0)),f=0;l<d;l++,f++)PM(h,f,r[l]);return h.length=f,h},bj=MM,kM=Math.floor,ob=function(r,i){var o=r.length,a=kM(o/2);return o<8?BW(r,i):fd(r,ob(bj(r,0,a),i),ob(bj(r,a),i),i)},BW=function(r,i){for(var o,a,l=r.length,d=1;d<l;){for(a=d,o=r[d];a&&i(r[a-1],o)>0;)r[a]=r[--a];a!==d++&&(r[a]=o)}return r},fd=function(r,i,o,a){for(var l=i.length,d=o.length,h=0,f=0;h<l||f<d;)r[h+f]=h<l&&f<d?a(i[h],o[f])<=0?i[h++]:o[f++]:h<l?i[h++]:o[f++];return r},sb=ob,ab=rc.match(/firefox\/(\d+)/i),Sj=!!ab&&+ab[1],$p=/MSIE|Trident/.test(rc),cb=rc.match(/AppleWebKit\/(\d+)\./),Pw=xt,Ig=xn,Cj=Go,Tj=bo,Mw=zc,wj=function(r,i){if(!delete r[i])throw OM("Cannot delete property "+Nw(i)+" of "+Nw(r))},xM=qo,lb=Pt,kw=sb,Rg=Bm,Ag=Sj,Lw=$p,FM=gu,UM=!!cb&&+cb[1],mc=[],xw=Ig(mc.sort),Hu=Ig(mc.push),VM=lb(function(){mc.sort(void 0)}),BM=lb(function(){mc.sort(null)}),Fw=Rg("sort"),jM=!lb(function(){if(FM)return FM<70;if(!(Ag&&Ag>3)){if(Lw)return!0;if(UM)return UM<603;var r,i,o,a,l="";for(r=65;r<76;r++){switch(i=String.fromCharCode(r),r){case 66:case 69:case 70:case 72:o=3;break;case 68:case 71:o=4;break;default:o=2}for(a=0;a<47;a++)mc.push({k:i+a,v:o})}for(mc.sort(function(d,h){return h.v-d.v}),a=0;a<mc.length;a++)i=mc[a].k.charAt(0),l.charAt(l.length-1)!==i&&(l+=i);return"DGBEFHACIJK"!==l}});Pw({target:"Array",proto:!0,forced:VM||!BM||!Fw||!jM},{sort:function(r){void 0!==r&&Cj(r);var i=Tj(this);if(jM)return void 0===r?xw(i):xw(i,r);var o,a,l=[],d=Mw(i);for(a=0;a<d;a++)a in i&&Hu(l,i[a]);for(kw(l,function(h){return function(f,m){return void 0===m?-1:void 0===f?1:void 0!==h?+h(f,m)||0:xM(f)>xM(m)?1:-1}}(r)),o=Mw(l),a=0;a<o;)i[a]=l[a++];for(;a<d;)wj(i,a++);return i}});var HM=Di("Array").sort,GM=Ri,WM=HM,Dg=Array.prototype,md=Ht(function(r){var i=r.sort;return r===Dg||GM(Dg,r)&&i===Dg.sort?WM:i}),ol={exports:{}};!function(r,i){!function(o,a){var l="function",d="undefined",h="object",f="string",m="major",g="model",v="name",y="type",b="vendor",C="version",P="architecture",R="console",A="mobile",O="tablet",M="smarttv",x="wearable",j="embedded",W="Amazon",q="Apple",J="BlackBerry",X="Browser",Ce="Chrome",Re="Firefox",ut="Google",Zt="Microsoft",aa="Motorola",Z="Opera",se="Samsung",xe="Sony",vt="Xiaomi",de="Zebra",I="Facebook",F="Chromium OS",G="Mac OS",re=function(In){for(var qn={},Qt=0;Qt<In.length;Qt++)qn[In[Qt].toUpperCase()]=In[Qt];return qn},Le=function(In,qn){return typeof In===f&&-1!==Ut(qn).indexOf(Ut(In))},Ut=function(In){return In.toLowerCase()},lr=function(In,qn){if(typeof In===f)return In=In.replace(/^\s\s*/,""),typeof qn===d?In:In.substring(0,350)},Xi=function(In,qn){for(var Qt,wi,Xa,Rn,lt,Zi,ou=0;ou<qn.length&&!lt;){var Za=qn[ou],PO=qn[ou+1];for(Qt=wi=0;Qt<Za.length&&!lt&&Za[Qt];)if(lt=Za[Qt++].exec(In))for(Xa=0;Xa<PO.length;Xa++)Zi=lt[++wi],typeof(Rn=PO[Xa])===h&&Rn.length>0?2===Rn.length?this[Rn[0]]=typeof Rn[1]==l?Rn[1].call(this,Zi):Rn[1]:3===Rn.length?this[Rn[0]]=typeof Rn[1]!==l||Rn[1].exec&&Rn[1].test?Zi?Zi.replace(Rn[1],Rn[2]):a:Zi?Rn[1].call(this,Zi,Rn[2]):a:4===Rn.length&&(this[Rn[0]]=Zi?Rn[3].call(this,Zi.replace(Rn[1],Rn[2])):a):this[Rn]=Zi||a;ou+=2}},Wl=function(In,qn){for(var Qt in qn)if(typeof qn[Qt]===h&&qn[Qt].length>0){for(var wi=0;wi<qn[Qt].length;wi++)if(Le(qn[Qt][wi],In))return"?"===Qt?a:Qt}else if(Le(qn[Qt],In))return"?"===Qt?a:Qt;return In},sT={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},cE={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[C,[v,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[C,[v,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[v,C],[/opios[\/ ]+([\w\.]+)/i],[C,[v,Z+" Mini"]],[/\bopr\/([\w\.]+)/i],[C,[v,Z]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[v,C],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[C,[v,"UC"+X]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[C,[v,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[C,[v,"WeChat"]],[/konqueror\/([\w\.]+)/i],[C,[v,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[C,[v,"IE"]],[/yabrowser\/([\w\.]+)/i],[C,[v,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[v,/(.+)/,"$1 Secure "+X],C],[/\bfocus\/([\w\.]+)/i],[C,[v,Re+" Focus"]],[/\bopt\/([\w\.]+)/i],[C,[v,Z+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[C,[v,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[C,[v,"Dolphin"]],[/coast\/([\w\.]+)/i],[C,[v,Z+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[C,[v,"MIUI "+X]],[/fxios\/([-\w\.]+)/i],[C,[v,Re]],[/\bqihu|(qi?ho?o?|360)browser/i],[[v,"360 "+X]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[v,/(.+)/,"$1 "+X],C],[/(comodo_dragon)\/([\w\.]+)/i],[[v,/_/g," "],C],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[v,C],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[v],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[v,I],C],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[v,C],[/\bgsa\/([\w\.]+) .*safari\//i],[C,[v,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[C,[v,Ce+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[v,Ce+" WebView"],C],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[C,[v,"Android "+X]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[v,C],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[C,[v,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[C,v],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[v,[C,Wl,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[v,C],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[v,"Netscape"],C],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[C,[v,Re+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[v,C],[/(cobalt)\/([\w\.]+)/i],[v,[C,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[P,"amd64"]],[/(ia32(?=;))/i],[[P,Ut]],[/((?:i[346]|x)86)[;\)]/i],[[P,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[P,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[P,"armhf"]],[/windows (ce|mobile); ppc;/i],[[P,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[P,/ower/,"",Ut]],[/(sun4\w)[;\)]/i],[[P,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[P,Ut]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[g,[b,se],[y,O]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[g,[b,se],[y,A]],[/\((ip(?:hone|od)[\w ]*);/i],[g,[b,q],[y,A]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[g,[b,q],[y,O]],[/(macintosh);/i],[g,[b,q]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[g,[b,"Sharp"],[y,A]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[g,[b,"Huawei"],[y,O]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[g,[b,"Huawei"],[y,A]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[g,/_/g," "],[b,vt],[y,A]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[g,/_/g," "],[b,vt],[y,O]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[g,[b,"OPPO"],[y,A]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[g,[b,"Vivo"],[y,A]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[g,[b,"Realme"],[y,A]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[g,[b,aa],[y,A]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[g,[b,aa],[y,O]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[g,[b,"LG"],[y,O]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[g,[b,"LG"],[y,A]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[g,[b,"Lenovo"],[y,O]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[g,/_/g," "],[b,"Nokia"],[y,A]],[/(pixel c)\b/i],[g,[b,ut],[y,O]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[g,[b,ut],[y,A]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[g,[b,xe],[y,A]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[g,"Xperia Tablet"],[b,xe],[y,O]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[g,[b,"OnePlus"],[y,A]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[g,[b,W],[y,O]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[g,/(.+)/g,"Fire Phone $1"],[b,W],[y,A]],[/(playbook);[-\w\),; ]+(rim)/i],[g,b,[y,O]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[g,[b,J],[y,A]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[g,[b,"ASUS"],[y,O]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[g,[b,"ASUS"],[y,A]],[/(nexus 9)/i],[g,[b,"HTC"],[y,O]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[b,[g,/_/g," "],[y,A]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[g,[b,"Acer"],[y,O]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[g,[b,"Meizu"],[y,A]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[b,g,[y,A]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[b,g,[y,O]],[/(surface duo)/i],[g,[b,Zt],[y,O]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[g,[b,"Fairphone"],[y,A]],[/(u304aa)/i],[g,[b,"AT&T"],[y,A]],[/\bsie-(\w*)/i],[g,[b,"Siemens"],[y,A]],[/\b(rct\w+) b/i],[g,[b,"RCA"],[y,O]],[/\b(venue[\d ]{2,7}) b/i],[g,[b,"Dell"],[y,O]],[/\b(q(?:mv|ta)\w+) b/i],[g,[b,"Verizon"],[y,O]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[g,[b,"Barnes & Noble"],[y,O]],[/\b(tm\d{3}\w+) b/i],[g,[b,"NuVision"],[y,O]],[/\b(k88) b/i],[g,[b,"ZTE"],[y,O]],[/\b(nx\d{3}j) b/i],[g,[b,"ZTE"],[y,A]],[/\b(gen\d{3}) b.+49h/i],[g,[b,"Swiss"],[y,A]],[/\b(zur\d{3}) b/i],[g,[b,"Swiss"],[y,O]],[/\b((zeki)?tb.*\b) b/i],[g,[b,"Zeki"],[y,O]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[b,"Dragon Touch"],g,[y,O]],[/\b(ns-?\w{0,9}) b/i],[g,[b,"Insignia"],[y,O]],[/\b((nxa|next)-?\w{0,9}) b/i],[g,[b,"NextBook"],[y,O]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[b,"Voice"],g,[y,A]],[/\b(lvtel\-)?(v1[12]) b/i],[[b,"LvTel"],g,[y,A]],[/\b(ph-1) /i],[g,[b,"Essential"],[y,A]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[g,[b,"Envizen"],[y,O]],[/\b(trio[-\w\. ]+) b/i],[g,[b,"MachSpeed"],[y,O]],[/\btu_(1491) b/i],[g,[b,"Rotor"],[y,O]],[/(shield[\w ]+) b/i],[g,[b,"Nvidia"],[y,O]],[/(sprint) (\w+)/i],[b,g,[y,A]],[/(kin\.[onetw]{3})/i],[[g,/\./g," "],[b,Zt],[y,A]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[g,[b,de],[y,O]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[g,[b,de],[y,A]],[/smart-tv.+(samsung)/i],[b,[y,M]],[/hbbtv.+maple;(\d+)/i],[[g,/^/,"SmartTV"],[b,se],[y,M]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[b,"LG"],[y,M]],[/(apple) ?tv/i],[b,[g,q+" TV"],[y,M]],[/crkey/i],[[g,Ce+"cast"],[b,ut],[y,M]],[/droid.+aft(\w)( bui|\))/i],[g,[b,W],[y,M]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[g,[b,"Sharp"],[y,M]],[/(bravia[\w ]+)( bui|\))/i],[g,[b,xe],[y,M]],[/(mitv-\w{5}) bui/i],[g,[b,vt],[y,M]],[/Hbbtv.*(technisat) (.*);/i],[b,g,[y,M]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[b,lr],[g,lr],[y,M]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[y,M]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[b,g,[y,R]],[/droid.+; (shield) bui/i],[g,[b,"Nvidia"],[y,R]],[/(playstation [345portablevi]+)/i],[g,[b,xe],[y,R]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[g,[b,Zt],[y,R]],[/((pebble))app/i],[b,g,[y,x]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[g,[b,q],[y,x]],[/droid.+; (glass) \d/i],[g,[b,ut],[y,x]],[/droid.+; (wt63?0{2,3})\)/i],[g,[b,de],[y,x]],[/(quest( 2| pro)?)/i],[g,[b,I],[y,x]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[b,[y,j]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[g,[y,A]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[g,[y,O]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[y,O]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[y,A]],[/(android[-\w\. ]{0,9});.+buil/i],[g,[b,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[C,[v,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[C,[v,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[v,C],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[C,v]],os:[[/microsoft (windows) (vista|xp)/i],[v,C],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[v,[C,Wl,sT]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[v,"Windows"],[C,Wl,sT]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[C,/_/g,"."],[v,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[v,G],[C,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[C,v],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[v,C],[/\(bb(10);/i],[C,[v,J]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[C,[v,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[C,[v,Re+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[C,[v,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[C,[v,"watchOS"]],[/crkey\/([\d\.]+)/i],[C,[v,Ce+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[v,F],C],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[v,C],[/(sunos) ?([\w\.\d]*)/i],[[v,"Solaris"],C],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[v,C]]},Ls=function(In,qn){if(typeof In===h&&(qn=In,In=a),!(this instanceof Ls))return new Ls(In,qn).getResult();var Qt=typeof o!==d&&o.navigator?o.navigator:a,wi=In||(Qt&&Qt.userAgent?Qt.userAgent:""),Xa=Qt&&Qt.userAgentData?Qt.userAgentData:a,Rn=qn?function(lt,Zi){var ou={};for(var Za in lt)ou[Za]=Zi[Za]&&Zi[Za].length%2==0?Zi[Za].concat(lt[Za]):lt[Za];return ou}(cE,qn):cE;return this.getBrowser=function(){var Zi,lt={};return lt[v]=a,lt[C]=a,Xi.call(lt,wi,Rn.browser),lt[m]=typeof(Zi=lt[C])===f?Zi.replace(/[^\d\.]/g,"").split(".")[0]:a,Qt&&Qt.brave&&typeof Qt.brave.isBrave==l&&(lt[v]="Brave"),lt},this.getCPU=function(){var lt={};return lt[P]=a,Xi.call(lt,wi,Rn.cpu),lt},this.getDevice=function(){var lt={};return lt[b]=a,lt[g]=a,lt[y]=a,Xi.call(lt,wi,Rn.device),!lt[y]&&Xa&&Xa.mobile&&(lt[y]=A),"Macintosh"==lt[g]&&Qt&&typeof Qt.standalone!==d&&Qt.maxTouchPoints&&Qt.maxTouchPoints>2&&(lt[g]="iPad",lt[y]=O),lt},this.getEngine=function(){var lt={};return lt[v]=a,lt[C]=a,Xi.call(lt,wi,Rn.engine),lt},this.getOS=function(){var lt={};return lt[v]=a,lt[C]=a,Xi.call(lt,wi,Rn.os),!lt[v]&&Xa&&"Unknown"!=Xa.platform&&(lt[v]=Xa.platform.replace(/chrome os/i,F).replace(/macos/i,G)),lt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return wi},this.setUA=function(lt){return wi=typeof lt===f&&lt.length>350?lr(lt,350):lt,this},this.setUA(wi),this};Ls.VERSION="0.7.34",Ls.BROWSER=re([v,C,m]),Ls.CPU=re([P]),Ls.DEVICE=re([g,b,y,R,A,M,O,x,j]),Ls.ENGINE=Ls.OS=re([v,C]),r.exports&&(i=r.exports=Ls),i.UAParser=Ls;var iu=typeof o!==d&&(o.jQuery||o.Zepto);if(iu&&!iu.ua){var _m=new Ls;iu.ua=_m.getResult(),iu.ua.get=function(){return _m.getUA()},iu.ua.set=function(In){_m.setUA(In);var qn=_m.getResult();for(var Qt in qn)iu.ua[Qt]=qn[Qt]}}}("object"==typeof window?window:Ji)}(ol,ol.exports);var KM=Ht(ol.exports),Uw=mi,Og=Rr,qM=Nm,Vw=lc,db=En("iterator"),Ij=Object,Rj=Ht(function(r){if(qM(r))return!1;var i=Ij(r);return void 0!==i[db]||"@@iterator"in i||Og(Vw,Uw(i))});xt({global:!0,forced:tr.globalThis!==tr},{globalThis:tr});var $M=Ht(tr),jw=V0.clear;xt({global:!0,bind:!0,enumerable:!0,forced:tr.clearImmediate!==jw},{clearImmediate:jw});var XM="function"==typeof Bun&&Bun&&"string"==typeof Bun.version,St=tr,Ze=rp,ZM=dr,oe=XM,QM=Qc,Aj=Tr,ub=St.Function,Gu=/MSIE .\./.test(rc)||oe&&function(){var r=St.Bun.version.split(".");return r.length<3||0==r[0]&&(r[1]<3||3==r[1]&&0==r[2])}(),Hw=xt,Xp=tr,Gw=V0.set,hb=Xp.setImmediate?function(r,i){var o=i?2:1;return Gu?function(a,l){var d=Aj(arguments.length,1)>o,h=ZM(a)?a:ub(a),f=d?QM(arguments,o):[],m=d?function(){Ze(h,this,f)}:h;return i?r(m,l):r(m)}:r}(Gw,!1):Gw;Hw({global:!0,bind:!0,enumerable:!0,forced:Xp.setImmediate!==hb},{setImmediate:hb});var pb=Ht(Qi.setImmediate),zw=DP,Dj=Go,Oj=Tr,Nj=Ep,tk=tr.process;xt({global:!0,enumerable:!0,dontCallGetSet:!0},{queueMicrotask:function(r){Oj(arguments.length,1),Dj(r);var i=Nj&&tk.domain;zw(i?i.bind(r):r)}});var nk=Ht(Qi.queueMicrotask);function rk(r,i){return function(){return r.apply(i,arguments)}}const{toString:Pj}=Object.prototype,{getPrototypeOf:Kw}=Object,Ng=(fb=Object.create(null),r=>{const i=Pj.call(r);return fb[i]||(fb[i]=i.slice(8,-1).toLowerCase())});var fb;const ba=r=>(r=r.toLowerCase(),i=>Ng(i)===r),mb=r=>i=>typeof i===r,{isArray:Ei}=Array,Pg=mb("undefined"),ik=ba("ArrayBuffer"),jW=mb("string"),Io=mb("function"),qw=mb("number"),gb=r=>null!==r&&"object"==typeof r,_b=r=>{if("object"!==Ng(r))return!1;const i=Kw(r);return!(null!==i&&i!==Object.prototype&&null!==Object.getPrototypeOf(i)||Symbol.toStringTag in r||Rj(r))},Mj=ba("Date"),ok=ba("File"),kj=ba("Blob"),Lj=ba("FileList"),Yw=ba("URLSearchParams"),[xj,Fj,Uj,Vj]=["ReadableStream","Request","Response","Headers"].map(ba);function Mg(r,i){let o,a,{allOwnKeys:l=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=r)if("object"!=typeof r&&(r=[r]),Ei(r))for(o=0,a=r.length;o<a;o++)i.call(null,r[o],o,r);else{const d=l?Object.getOwnPropertyNames(r):Object.keys(r),h=d.length;let f;for(o=0;o<h;o++)f=d[o],i.call(null,r[f],f,r)}}function Sa(r,i){i=i.toLowerCase();const o=Object.keys(r);let a,l=o.length;for(;l-- >0;)if(a=o[l],i===a.toLowerCase())return a;return null}const sl=void 0!==$M?$M:typeof self<"u"?self:typeof window<"u"?window:global,sk=r=>!Pg(r)&&r!==sl,Bj=(vb=typeof Uint8Array<"u"&&Kw(Uint8Array),r=>vb&&r instanceof vb);var vb;const ak=ba("HTMLFormElement"),kg=(r=>{let{hasOwnProperty:i}=r;return(o,a)=>i.call(o,a)})(Object.prototype),$w=ba("RegExp"),jj=(r,i)=>{const o=Object.getOwnPropertyDescriptors(r),a={};Mg(o,(l,d)=>{let h;!1!==(h=i(l,d,r))&&(a[d]=h||l)}),Object.defineProperties(r,a)},Eb="abcdefghijklmnopqrstuvwxyz",Xw="0123456789",Zw={DIGIT:Xw,ALPHA:Eb,ALPHA_DIGIT:Eb+Eb.toUpperCase()+Xw},yb=ba("AsyncFunction"),bb=(gc="function"==typeof pb,ck=Io(sl.postMessage),gc?pb:ck?(Jw="axios@".concat(Math.random()),Zp=[],sl.addEventListener("message",r=>{let{source:i,data:o}=r;i===sl&&o===Jw&&Zp.length&&Zp.shift()()},!1),r=>{Zp.push(r),sl.postMessage(Jw,"*")}):r=>setTimeout(r));var gc,ck,Jw,Zp;const Hj=void 0!==nk?nk.bind(sl):typeof process<"u"&&process.nextTick||bb;var ce={isArray:Ei,isArrayBuffer:ik,isBuffer:function(r){return null!==r&&!Pg(r)&&null!==r.constructor&&!Pg(r.constructor)&&Io(r.constructor.isBuffer)&&r.constructor.isBuffer(r)},isFormData:r=>{let i;return r&&("function"==typeof FormData&&r instanceof FormData||Io(r.append)&&("formdata"===(i=Ng(r))||"object"===i&&Io(r.toString)&&"[object FormData]"===r.toString()))},isArrayBufferView:function(r){let i;return i=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(r):r&&r.buffer&&ik(r.buffer),i},isString:jW,isNumber:qw,isBoolean:r=>!0===r||!1===r,isObject:gb,isPlainObject:_b,isReadableStream:xj,isRequest:Fj,isResponse:Uj,isHeaders:Vj,isUndefined:Pg,isDate:Mj,isFile:ok,isBlob:kj,isRegExp:$w,isFunction:Io,isStream:r=>gb(r)&&Io(r.pipe),isURLSearchParams:Yw,isTypedArray:Bj,isFileList:Lj,forEach:Mg,merge:function r(){const{caseless:i}=sk(this)&&this||{},o={},a=(l,d)=>{const h=i&&Sa(o,d)||d;o[h]=_b(o[h])&&_b(l)?r(o[h],l):_b(l)?r({},l):Ei(l)?l.slice():l};for(let l=0,d=arguments.length;l<d;l++)arguments[l]&&Mg(arguments[l],a);return o},extend:function(r,i,o){let{allOwnKeys:a}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Mg(i,(l,d)=>{r[d]=o&&Io(l)?rk(l,o):l},{allOwnKeys:a}),r},trim:r=>vi(r)?vi(r).call(r):r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:r=>(65279===r.charCodeAt(0)&&(r=r.slice(1)),r),inherits:(r,i,o,a)=>{r.prototype=Object.create(i.prototype,a),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:i.prototype}),o&&Object.assign(r.prototype,o)},toFlatObject:(r,i,o,a)=>{let l,d,h;const f={};if(i=i||{},null==r)return i;do{for(l=Object.getOwnPropertyNames(r),d=l.length;d-- >0;)h=l[d],a&&!a(h,r,i)||f[h]||(i[h]=r[h],f[h]=!0);r=!1!==o&&Kw(r)}while(r&&(!o||o(r,i))&&r!==Object.prototype);return i},kindOf:Ng,kindOfTest:ba,endsWith:(r,i,o)=>{r=String(r),(void 0===o||o>r.length)&&(o=r.length);const a=r.indexOf(i,o-=i.length);return-1!==a&&a===o},toArray:r=>{if(!r)return null;if(Ei(r))return r;let i=r.length;if(!qw(i))return null;const o=new Array(i);for(;i-- >0;)o[i]=r[i];return o},forEachEntry:(r,i)=>{const o=(r&&r[Symbol.iterator]).call(r);let a;for(;(a=o.next())&&!a.done;){const l=a.value;i.call(r,l[0],l[1])}},matchAll:(r,i)=>{let o;const a=[];for(;null!==(o=r.exec(i));)a.push(o);return a},isHTMLForm:ak,hasOwnProperty:kg,hasOwnProp:kg,reduceDescriptors:jj,freezeMethods:r=>{jj(r,(i,o)=>{if(Io(r)&&-1!==["arguments","caller","callee"].indexOf(o))return!1;Io(r[o])&&(i.enumerable=!1,"writable"in i?i.writable=!1:i.set||(i.set=()=>{throw Error("Can not rewrite read-only method '"+o+"'")}))})},toObjectSet:(r,i)=>{const o={},a=l=>{l.forEach(d=>{o[d]=!0})};return Ei(r)?a(r):a(String(r).split(i)),o},toCamelCase:r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,o,a){return o.toUpperCase()+a}),noop:()=>{},toFiniteNumber:(r,i)=>null!=r&&Number.isFinite(r=+r)?r:i,findKey:Sa,global:sl,isContextDefined:sk,ALPHABET:Zw,generateString:function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Zw.ALPHA_DIGIT,o="";const{length:a}=i;for(;r--;)o+=i[Math.random()*a|0];return o},isSpecCompliantForm:function(r){return!!(r&&Io(r.append)&&"FormData"===r[Symbol.toStringTag]&&r[Symbol.iterator])},toJSONObject:r=>{const i=new Array(10),o=(a,l)=>{if(gb(a)){if(i.indexOf(a)>=0)return;if(!("toJSON"in a)){i[l]=a;const d=Ei(a)?[]:{};return Mg(a,(h,f)=>{const m=o(h,l+1);!Pg(m)&&(d[f]=m)}),i[l]=void 0,d}}return a};return o(r,0)},isAsyncFn:yb,isThenable:r=>r&&(gb(r)||Io(r))&&Io(r.then)&&Io(r.catch),setImmediate:bb,asap:Hj};function Mt(r,i,o,a,l){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=r,this.name="AxiosError",i&&(this.code=i),o&&(this.config=o),a&&(this.request=a),l&&(this.response=l,this.status=l.status?l.status:null)}ce.inherits(Mt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ce.toJSONObject(this.config),code:this.code,status:this.status}}});const gd=Mt.prototype,Wu={};function Lg(r){return ce.isPlainObject(r)||ce.isArray(r)}function Jp(r){return ce.endsWith(r,"[]")?r.slice(0,-2):r}function Qw(r,i,o){return r?r.concat(i).map(function(a,l){return a=Jp(a),!o&&l?"["+a+"]":a}).join(o?".":""):i}["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{Wu[r]={value:r}}),Object.defineProperties(Mt,Wu),Object.defineProperty(gd,"isAxiosError",{value:!0}),Mt.from=(r,i,o,a,l,d)=>{const h=Object.create(gd);return ce.toFlatObject(r,h,function(f){return f!==Error.prototype},f=>"isAxiosError"!==f),Mt.call(h,r.message,i,o,a,l),h.cause=r,h.name=r.name,d&&Object.assign(h,d),h};const lk=ce.toFlatObject(ce,{},null,function(r){return/^is[A-Z]/.test(r)});function Sb(r,i,o){if(!ce.isObject(r))throw new TypeError("target must be an object");i=i||new FormData;const a=(o=ce.toFlatObject(o,{metaTokens:!0,dots:!1,indexes:!1},!1,function(b,C){return!ce.isUndefined(C[b])})).metaTokens,l=o.visitor||g,d=o.dots,h=o.indexes,f=(o.Blob||typeof Blob<"u"&&Blob)&&ce.isSpecCompliantForm(i);if(!ce.isFunction(l))throw new TypeError("visitor must be a function");function m(b){if(null===b)return"";if(ce.isDate(b))return b.toISOString();if(!f&&ce.isBlob(b))throw new Mt("Blob is not supported. Use a Buffer instead.");return ce.isArrayBuffer(b)||ce.isTypedArray(b)?f&&"function"==typeof Blob?new Blob([b]):Buffer.from(b):b}function g(b,C,P){let R=b;if(b&&!P&&"object"==typeof b)if(ce.endsWith(C,"{}"))C=a?C:C.slice(0,-2),b=JSON.stringify(b);else if(ce.isArray(b)&&ce.isArray(A=b)&&!A.some(Lg)||(ce.isFileList(b)||ce.endsWith(C,"[]"))&&(R=ce.toArray(b)))return C=Jp(C),R.forEach(function(A,O){!ce.isUndefined(A)&&null!==A&&i.append(!0===h?Qw([C],O,d):null===h?C:C+"[]",m(A))}),!1;var A;return!!Lg(b)||(i.append(Qw(P,C,d),m(b)),!1)}const v=[],y=Object.assign(lk,{defaultVisitor:g,convertValue:m,isVisitable:Lg});if(!ce.isObject(r))throw new TypeError("data must be an object");return function b(C,P){if(!ce.isUndefined(C)){if(-1!==v.indexOf(C))throw Error("Circular reference detected in "+P.join("."));v.push(C),ce.forEach(C,function(R,A){!0===(!(ce.isUndefined(R)||null===R)&&l.call(i,R,ce.isString(A)?vi(A).call(A):A,P,y))&&b(R,P?P.concat(A):[A])}),v.pop()}}(r),i}function dk(r){const i={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(o){return i[o]})}function eI(r,i){this._pairs=[],r&&Sb(r,this,i)}const uk=eI.prototype;function Gj(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function hk(r,i,o){if(!i)return r;const a=o&&o.encode||Gj,l=o&&o.serialize;let d;if(d=l?l(i,o):ce.isURLSearchParams(i)?i.toString():new eI(i,o).toString(a),d){const h=r.indexOf("#");-1!==h&&(r=r.slice(0,h)),r+=(-1===r.indexOf("?")?"?":"&")+d}return r}uk.append=function(r,i){this._pairs.push([r,i])},uk.toString=function(r){const i=r?function(o){return r.call(this,o,dk)}:dk;return this._pairs.map(function(o){return i(o[0])+"="+i(o[1])},"").join("&")};var tI=class{constructor(){this.handlers=[]}use(r,i,o){return this.handlers.push({fulfilled:r,rejected:i,synchronous:!!o&&o.synchronous,runWhen:o?o.runWhen:null}),this.handlers.length-1}eject(r){this.handlers[r]&&(this.handlers[r]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(r){ce.forEach(this.handlers,function(i){null!==i&&r(i)})}},pk={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},xg={exports:{}},mk=Wo.f;xt({target:"Object",stat:!0,forced:Object.defineProperty!==mk,sham:!ms},{defineProperty:mk});var nI=Qi.Object,zj=xg.exports=function(r,i,o){return nI.defineProperty(r,i,o)};nI.defineProperty.sham&&(zj.sham=!0);var gk=Ht(xg.exports),_k=Ho,zu=Array.isArray||function(r){return"Array"==_k(r)},vk=TypeError,Qp=zu,Fg=dg,al=ri,Kj=En("species"),Ek=Array,Ug=function(r,i){return new(function(r){var i;return Qp(r)&&(Fg(i=r.constructor)&&(i===Ek||Qp(i.prototype))||al(i)&&null===(i=i[Kj]))&&(i=void 0),void 0===i?Ek:i}(r))(0===i?0:i)},rI=Pt,Yj=gu,HW=En("species"),$j=function(r){return Yj>=51||!rI(function(){var i=[];return(i.constructor={})[HW]=function(){return{foo:1}},1!==i[r](Boolean).foo})},Xj=xt,Zj=Pt,GW=zu,Jj=ri,WW=bo,Qj=zc,yk=function(r){if(r>9007199254740991)throw vk("Maximum allowed index exceeded");return r},bk=il,iI=Ug,Vg=$j,oI=gu,Bg=En("isConcatSpreadable"),Sk=oI>=51||!Zj(function(){var r=[];return r[Bg]=!1,r.concat()[0]!==r}),jg=function(r){if(!Jj(r))return!1;var i=r[Bg];return void 0!==i?!!i:GW(r)};Xj({target:"Array",proto:!0,arity:1,forced:!Sk||!Vg("concat")},{concat:function(r){var i,o,a,l,d,h=WW(this),f=iI(h,0),m=0;for(i=-1,a=arguments.length;i<a;i++)if(jg(d=-1===i?h:arguments[i]))for(l=Qj(d),yk(m+l),o=0;o<l;o++,m++)o in d&&bk(f,m,d[o]);else yk(m+1),bk(f,m++,d);return f.length=m,f}});var sI={},e3=Ho,Hg=Gc,aI=oy.f,Ck=MM,cI="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];sI.f=function(r){return cI&&"Window"==e3(r)?function(i){try{return aI(i)}catch{return Ck(cI)}}(r):aI(Hg(r))};var Ku={};Ku.f=En;var Tk=Qi,n3=Rr,Gg=Ku,r3=Wo.f,Br=function(r){var i=Tk.Symbol||(Tk.Symbol={});n3(i,r)||r3(i,r,{value:Gg.f(r)})},i3=Fr,Cb=yo,wk=En,Ik=Vs,lI=function(){var r=Cb("Symbol"),i=r&&r.prototype,o=i&&i.valueOf,a=wk("toPrimitive");i&&!i[a]&&Ik(i,a,function(l){return i3(o,this)},{arity:1})},o3=nd,Rk=OE,dI=bo,Tb=zc,s3=Ug,Ak=xn([].push),_d=function(r){var i=1==r,o=2==r,a=3==r,l=4==r,d=6==r,h=7==r,f=5==r||d;return function(m,g,v,y){for(var b,C,P=dI(m),R=Rk(P),A=o3(g,v),O=Tb(R),M=0,x=y||s3,j=i?x(m,O):o||h?x(m,0):void 0;O>M;M++)if((f||M in R)&&(C=A(b=R[M],M,P),r))if(i)j[M]=C;else if(C)switch(r){case 3:return!0;case 5:return b;case 6:return M;case 2:Ak(j,b)}else switch(r){case 4:return!1;case 7:Ak(j,b)}return d?-1:a||l?l:j}},Dk={forEach:_d(0),map:_d(1),filter:_d(2),some:_d(3),every:_d(4),find:_d(5),findIndex:_d(6),filterReject:_d(7)},wb=xt,uI=tr,Wg=Fr,zg=xn,qu=ms,Yu=Jl,a3=Pt,jr=Rr,Ib=Ri,Ok=Ai,Rb=Gc,Ab=FE,hI=qo,pI=mu,ef=ad,Nk=rr,Pk=oy,fI=sI,Mk=Wm,Db=Dm,kk=Wo,c3=o0,Lk=fu,xk=Vs,l3=Op,mI=_u,Ob=Gm,Fk=yN,d3=En,u3=Ku,$u=Br,Kg=lI,gI=uc,Nb=Iu,Pb=Dk.forEach,yi=Hm("hidden"),qg="Symbol",Yg="prototype",h3=Nb.set,Uk=Nb.getterFor(qg),Ca=Object[Yg],Xu=uI.Symbol,$g=Xu&&Xu[Yg],p3=uI.TypeError,Mb=uI.QObject,Xg=Db.f,Zu=kk.f,Vk=fI.f,Bk=Lk.f,jk=zg([].push),cl=mI("symbols"),Ta=mI("op-symbols"),tf=mI("wks"),Ju=!Mb||!Mb[Yg]||!Mb[Yg].findChild,Hk=qu&&a3(function(){return 7!=ef(Zu({},"a",{get:function(){return Zu(this,"a",{value:7}).a}})).a})?function(r,i,o){var a=Xg(Ca,i);a&&delete Ca[i],Zu(r,i,o),a&&r!==Ca&&Zu(Ca,i,a)}:Zu,kb=function(r,i){var o=cl[r]=ef($g);return h3(o,{type:qg,tag:r,description:i}),qu||(o.description=i),o},nf=function(r,i,o){r===Ca&&nf(Ta,i,o),Ok(r);var a=Ab(i);return Ok(o),jr(cl,a)?(o.enumerable?(jr(r,yi)&&r[yi][a]&&(r[yi][a]=!1),o=ef(o,{enumerable:pI(0,!1)})):(jr(r,yi)||Zu(r,yi,pI(1,{})),r[yi][a]=!0),Hk(r,a,o)):Zu(r,a,o)},_I=function(r,i){Ok(r);var o=Rb(i),a=Nk(o).concat(f3(o));return Pb(a,function(l){qu&&!Wg(vI,o,l)||nf(r,l,o[l])}),r},vI=function(r){var i=Ab(r),o=Wg(Bk,this,i);return!(this===Ca&&jr(cl,i)&&!jr(Ta,i))&&(!(o||!jr(this,i)||!jr(cl,i)||jr(this,yi)&&this[yi][i])||o)},Gk=function(r,i){var o=Rb(r),a=Ab(i);if(o!==Ca||!jr(cl,a)||jr(Ta,a)){var l=Xg(o,a);return!l||!jr(cl,a)||jr(o,yi)&&o[yi][a]||(l.enumerable=!0),l}},EI=function(r){var i=Vk(Rb(r)),o=[];return Pb(i,function(a){jr(cl,a)||jr(Ob,a)||jk(o,a)}),o},f3=function(r){var i=r===Ca,o=Vk(i?Ta:Rb(r)),a=[];return Pb(o,function(l){!jr(cl,l)||i&&!jr(Ca,l)||jk(a,cl[l])}),a};Yu||(Xu=function(){if(Ib($g,this))throw p3("Symbol is not a constructor");var r=arguments.length&&void 0!==arguments[0]?hI(arguments[0]):void 0,i=Fk(r),o=function(a){this===Ca&&Wg(o,Ta,a),jr(this,yi)&&jr(this[yi],i)&&(this[yi][i]=!1),Hk(this,i,pI(1,a))};return qu&&Ju&&Hk(Ca,i,{configurable:!0,set:o}),kb(i,r)},xk($g=Xu[Yg],"toString",function(){return Uk(this).tag}),xk(Xu,"withoutSetter",function(r){return kb(Fk(r),r)}),Lk.f=vI,kk.f=nf,c3.f=_I,Db.f=Gk,Pk.f=fI.f=EI,Mk.f=f3,u3.f=function(r){return kb(d3(r),r)},qu&&l3($g,"description",{configurable:!0,get:function(){return Uk(this).description}})),wb({global:!0,constructor:!0,wrap:!0,forced:!Yu,sham:!Yu},{Symbol:Xu}),Pb(Nk(tf),function(r){$u(r)}),wb({target:qg,stat:!0,forced:!Yu},{useSetter:function(){Ju=!0},useSimple:function(){Ju=!1}}),wb({target:"Object",stat:!0,forced:!Yu,sham:!qu},{create:function(r,i){return void 0===i?ef(r):_I(ef(r),i)},defineProperty:nf,defineProperties:_I,getOwnPropertyDescriptor:Gk}),wb({target:"Object",stat:!0,forced:!Yu},{getOwnPropertyNames:EI}),Kg(),gI(Xu,qg),Ob[yi]=!0;var Wk=Jl&&!!Symbol.for&&!!Symbol.keyFor,rf=xt,Lb=yo,_c=Rr,m3=qo,zk=_u,yI=Wk,vc=zk("string-to-symbol-registry"),xb=zk("symbol-to-string-registry");rf({target:"Symbol",stat:!0,forced:!yI},{for:function(r){var i=m3(r);if(_c(vc,i))return vc[i];var o=Lb("Symbol")(i);return vc[i]=o,xb[o]=i,o}});var Kk=xt,Zg=Rr,g3=nr,_3=cp,bI=Wk,SI=_u("symbol-to-string-registry");Kk({target:"Symbol",stat:!0,forced:!bI},{keyFor:function(r){if(!g3(r))throw TypeError(_3(r)+" is not a symbol");if(Zg(SI,r))return SI[r]}});var ll=zu,Jg=dr,v3=Ho,Fb=qo,CI=xn([].push),qk=xt,Yk=yo,sf=rp,E3=Fr,Qg=xn,$k=Pt,Xk=dr,Zk=nr,Jk=Qc,b3=Jl,js=String,vd=Yk("JSON","stringify"),Ub=Qg(/./.exec),TI=Qg("".charAt),Qk=Qg("".charCodeAt),wI=Qg("".replace),e1=Qg(1..toString),S3=/[\uD800-\uDFFF]/g,II=/^[\uD800-\uDBFF]$/,Vb=/^[\uDC00-\uDFFF]$/,RI=!b3||$k(function(){var r=Yk("Symbol")();return"[null]"!=vd([r])||"{}"!=vd({a:r})||"{}"!=vd(Object(r))}),AI=$k(function(){return'"\\udf06\\ud834"'!==vd("\udf06\ud834")||'"\\udead"'!==vd("\udead")}),C3=function(r,i){var o=Jk(arguments),a=function(r){if(Jg(r))return r;if(ll(r)){for(var i=r.length,o=[],a=0;a<i;a++){var l=r[a];"string"==typeof l?CI(o,l):"number"!=typeof l&&"Number"!=v3(l)&&"String"!=v3(l)||CI(o,Fb(l))}var d=o.length,h=!0;return function(f,m){if(h)return h=!1,m;if(ll(this))return m;for(var g=0;g<d;g++)if(o[g]===f)return m}}}(i);if(Xk(a)||void 0!==r&&!Zk(r))return o[1]=function(l,d){if(Xk(a)&&(d=E3(a,this,js(l),d)),!Zk(d))return d},sf(vd,null,o)},T3=function(r,i,o){var a=TI(o,i-1),l=TI(o,i+1);return Ub(II,r)&&!Ub(Vb,l)||Ub(Vb,r)&&!Ub(II,a)?"\\u"+e1(Qk(r,0),16):r};vd&&qk({target:"JSON",stat:!0,arity:3,forced:RI||AI},{stringify:function(r,i,o){var a=Jk(arguments),l=sf(RI?C3:vd,null,a);return AI&&"string"==typeof l?wI(l,S3,T3):l}});var t1=Wm,DI=bo;xt({target:"Object",stat:!0,forced:!Jl||Pt(function(){t1.f(1)})},{getOwnPropertySymbols:function(r){var i=t1.f;return i?i(DI(r)):[]}}),Br("asyncIterator"),Br("hasInstance"),Br("isConcatSpreadable"),Br("iterator"),Br("match"),Br("matchAll"),Br("replace"),Br("search"),Br("species"),Br("split");var OI=lI;Br("toPrimitive"),OI();var n1=yo,NI=uc;Br("toStringTag"),NI(n1("Symbol"),"Symbol"),Br("unscopables"),uc(tr.JSON,"JSON",!0);var PI=Qi.Symbol,I3=Wo.f,r1=En("metadata"),o1=Function.prototype;void 0===o1[r1]&&I3(o1,r1,{value:null}),Br("dispose"),Br("metadata");var s1=PI;Br("asyncDispose");var MI=xn,e_=yo("Symbol"),a1=e_.keyFor,c1=MI(e_.prototype.valueOf),kI=e_.isRegisteredSymbol||function(r){try{return void 0!==a1(c1(r))}catch{return!1}};xt({target:"Symbol",stat:!0},{isRegisteredSymbol:kI});for(var R3=_u,LI=yo,A3=xn,xI=nr,l1=En,t_=LI("Symbol"),ji=t_.isWellKnownSymbol,n_=LI("Object","getOwnPropertyNames"),zW=A3(t_.prototype.valueOf),D3=R3("wks"),Ed=0,FI=n_(t_),d1=FI.length;Ed<d1;Ed++)try{var Bb=FI[Ed];xI(t_[Bb])&&l1(Bb)}catch{}var UI=function(r){if(ji&&ji(r))return!0;try{for(var i=zW(r),o=0,a=n_(D3),l=a.length;o<l;o++)if(D3[a[o]]==i)return!0}catch{}return!1};xt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:UI}),Br("matcher"),Br("observable"),xt({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:kI}),xt({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:UI}),Br("metadataKey"),Br("patternMatch"),Br("replaceAll");var Qu=Ht(s1),VI=Ht(Ku.f("iterator"));function af(r){return(af="function"==typeof Qu&&"symbol"==typeof VI?function(i){return typeof i}:function(i){return i&&"function"==typeof Qu&&i.constructor===Qu&&i!==Qu.prototype?"symbol":typeof i})(r)}var O3=Ht(Ku.f("toPrimitive"));function N(r,i,o){return(i=function KW(r){var i=function(o){if("object"!==af(o)||null===o)return o;var l=o[O3];if(void 0!==l){var d=l.call(o,"string");if("object"!==af(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(r);return"symbol"===af(i)?i:String(i)}(i))in r?gk(r,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[i]=o,r}var qW=Pt,YW=En("iterator"),jb=!qW(function(){var r=new URL("b?a=1&b=2&c=3","http://a"),i=r.searchParams,o=new URLSearchParams("a=1&a=2"),a="";return r.pathname="c%20d",i.forEach(function(l,d){i.delete("b"),a+=d+l}),o.delete("a",2),!r.toJSON||!o.has("a",1)||o.has("a",2)||!i.size&&!0||!i.sort||"http://a/c%20d?a=1&c=3"!==r.href||"3"!==i.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!i[YW]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://\u0442\u0435\u0441\u0442").host||"#%D0%B1"!==new URL("http://a#\u0431").hash||"a1c3"!==a||"x"!==new URL("http://x",void 0).host}),N3=Vs,BI=xt,r_=tr,i_=Fr,wa=xn,o_=ms,P3=jb,M3=Vs,$W=Op,ZW=uc,JW=_y,u1=Iu,k3=sg,jI=dr,cf=Rr,s_=nd,L3=mi,QW=Ai,HI=ri,Ro=qo,ez=ad,h1=mu,GI=GN,x3=h0,dl=Tr,p1=sb,F3=En("iterator"),lf="URLSearchParams",U3=lf+"Iterator",WI=u1.set,Ia=u1.getterFor(lf),V3=u1.getterFor(U3),f1=Object.getOwnPropertyDescriptor,tn=function(r){if(!o_)return r_[r];var i=f1(r_,r);return i&&i.value},m1=tn("fetch"),Hb=tn("Request"),yd=tn("Headers"),zI=Hb&&Hb.prototype,g1=yd&&yd.prototype,B3=r_.RegExp,j3=r_.TypeError,_1=r_.decodeURIComponent,H3=r_.encodeURIComponent,G3=wa("".charAt),KI=wa([].join),bd=wa([].push),qI=wa("".replace),tz=wa([].shift),YI=wa([].splice),a_=wa("".split),eh=wa("".slice),v1=/\+/g,E1=Array(4),nz=function(r){return E1[r-1]||(E1[r-1]=B3("((?:%[\\da-f]{2}){"+r+"})","gi"))},$I=function(r){try{return _1(r)}catch{return r}},Gb=function(r){var i=qI(r,v1," "),o=4;try{return _1(i)}catch{for(;o;)i=qI(i,nz(o--),$I);return i}},W3=/[!'()~]|%20/g,y1={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},XI=function(r){return y1[r]},b1=function(r){return qI(H3(r),W3,XI)},S1=JW(function(r,i){WI(this,{type:U3,iterator:GI(Ia(r).entries),kind:i})},"Iterator",function(){var r=V3(this),i=r.kind,o=r.iterator.next(),a=o.value;return o.done||(o.value="keys"===i?a.key:"values"===i?a.value:[a.key,a.value]),o},!0),c_=function(r){this.entries=[],this.url=null,void 0!==r&&(HI(r)?this.parseObject(r):this.parseQuery("string"==typeof r?"?"===G3(r,0)?eh(r,1):r:Ro(r)))};c_.prototype={type:lf,bindURL:function(r){this.url=r,this.update()},parseObject:function(r){var i,o,a,l,d,h,f,m=x3(r);if(m)for(o=(i=GI(r,m)).next;!(a=i_(o,i)).done;){if(d=(l=GI(QW(a.value))).next,(h=i_(d,l)).done||(f=i_(d,l)).done||!i_(d,l).done)throw j3("Expected sequence with length 2");bd(this.entries,{key:Ro(h.value),value:Ro(f.value)})}else for(var g in r)cf(r,g)&&bd(this.entries,{key:g,value:Ro(r[g])})},parseQuery:function(r){if(r)for(var i,o,a=a_(r,"&"),l=0;l<a.length;)(i=a[l++]).length&&(o=a_(i,"="),bd(this.entries,{key:Gb(tz(o)),value:Gb(KI(o,"="))}))},serialize:function(){for(var r,i=this.entries,o=[],a=0;a<i.length;)r=i[a++],bd(o,b1(r.key)+"="+b1(r.value));return KI(o,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Wb=function(){k3(this,df);var r=WI(this,new c_(arguments.length>0?arguments[0]:void 0));o_||(this.size=r.entries.length)},df=Wb.prototype;if(function(r,i,o){for(var a in i)o&&o.unsafe&&r[a]?r[a]=i[a]:N3(r,a,i[a],o)}(df,{append:function(r,i){var o=Ia(this);dl(arguments.length,2),bd(o.entries,{key:Ro(r),value:Ro(i)}),o_||this.length++,o.updateURL()},delete:function(r){for(var i=Ia(this),o=dl(arguments.length,1),a=i.entries,l=Ro(r),d=o<2?void 0:arguments[1],h=void 0===d?d:Ro(d),f=0;f<a.length;){var m=a[f];if(m.key!==l||void 0!==h&&m.value!==h)f++;else if(YI(a,f,1),void 0!==h)break}o_||(this.size=a.length),i.updateURL()},get:function(r){var i=Ia(this).entries;dl(arguments.length,1);for(var o=Ro(r),a=0;a<i.length;a++)if(i[a].key===o)return i[a].value;return null},getAll:function(r){var i=Ia(this).entries;dl(arguments.length,1);for(var o=Ro(r),a=[],l=0;l<i.length;l++)i[l].key===o&&bd(a,i[l].value);return a},has:function(r){for(var i=Ia(this).entries,o=dl(arguments.length,1),a=Ro(r),l=o<2?void 0:arguments[1],d=void 0===l?l:Ro(l),h=0;h<i.length;){var f=i[h++];if(f.key===a&&(void 0===d||f.value===d))return!0}return!1},set:function(r,i){var o=Ia(this);dl(arguments.length,1);for(var a,l=o.entries,d=!1,h=Ro(r),f=Ro(i),m=0;m<l.length;m++)(a=l[m]).key===h&&(d?YI(l,m--,1):(d=!0,a.value=f));d||bd(l,{key:h,value:f}),o_||(this.size=l.length),o.updateURL()},sort:function(){var r=Ia(this);p1(r.entries,function(i,o){return i.key>o.key?1:-1}),r.updateURL()},forEach:function(r){for(var i,o=Ia(this).entries,a=s_(r,arguments.length>1?arguments[1]:void 0),l=0;l<o.length;)a((i=o[l++]).value,i.key,this)},keys:function(){return new S1(this,"keys")},values:function(){return new S1(this,"values")},entries:function(){return new S1(this,"entries")}},{enumerable:!0}),M3(df,F3,df.entries,{name:"entries"}),M3(df,"toString",function(){return Ia(this).serialize()},{enumerable:!0}),o_&&$W(df,"size",{get:function(){return Ia(this).entries.length},configurable:!0,enumerable:!0}),ZW(Wb,lf),BI({global:!0,constructor:!0,forced:!P3},{URLSearchParams:Wb}),!P3&&jI(yd)){var ZI=wa(g1.has),z3=wa(g1.set),Ra=function(r){if(HI(r)){var i,o=r.body;if(L3(o)===lf)return i=r.headers?new yd(r.headers):new yd,ZI(i,"content-type")||z3(i,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),ez(r,{body:h1(0,Ro(o)),headers:h1(0,i)})}return r};if(jI(m1)&&BI({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(r){return m1(r,arguments.length>1?Ra(arguments[1]):{})}}),jI(Hb)){var th=function(r){return k3(this,zI),new Hb(r,arguments.length>1?Ra(arguments[1]):{})};zI.constructor=th,th.prototype=zI,BI({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:th})}}var $r={URLSearchParams:Wb,getState:Ia},Sd=Ht(Qi.URLSearchParams),zb={isBrowser:!0,classes:{URLSearchParams:void 0!==Sd?Sd:eI,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const Qo=typeof window<"u"&&typeof document<"u",Cd="object"==typeof navigator&&navigator||void 0,K3=Qo&&(!Cd||["ReactNative","NativeScript","NS"].indexOf(Cd.product)<0),l_=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,br=Qo&&window.location.href||"http://localhost";function JI(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function QI(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?JI(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):JI(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}var es=QI(QI({},Object.freeze({__proto__:null,hasBrowserEnv:Qo,hasStandardBrowserEnv:K3,hasStandardBrowserWebWorkerEnv:l_,navigator:Cd,origin:br})),zb),q3=Ai,Xr=Fr,C1=Rr,Y3=Ri,Zr=function(){var r=q3(this),i="";return r.hasIndices&&(i+="d"),r.global&&(i+="g"),r.ignoreCase&&(i+="i"),r.multiline&&(i+="m"),r.dotAll&&(i+="s"),r.unicode&&(i+="u"),r.unicodeSets&&(i+="v"),r.sticky&&(i+="y"),i},uf=RegExp.prototype,nh=function(r){var i=r.flags;return void 0!==i||"flags"in uf||C1(r,"flags")||!Y3(uf,r)?i:Xr(Zr,r)},Kb=Sg.charAt,hf=Fr,qb=Ai,T1=dr,w1=Ho,I1=/./.exec,Yb=TypeError,eR=xt,tR=Fr,$3=ip,pf=_y,d_=Ap,ff=Xl,R1=KE,rh=qo,mf=Ai,X3=Nm,A1=Ho,D1=Um,u_=nh,ih=Cr,Z3=Pt,bs=Ty,$b=Iu,O1=En("matchAll"),nR="RegExp String",N1=nR+" Iterator",rz=$b.set,e4=$b.getterFor(N1),Xb=TypeError,h_=$3("".indexOf),gf=$3("".matchAll),Td=!!gf&&!Z3(function(){gf("a",/./)}),P1=pf(function(r,i,o,a){rz(this,{type:N1,regexp:r,string:i,global:o,unicode:a,done:!1})},nR,function(){var r=e4(this);if(r.done)return d_(void 0,!0);var i=r.regexp,o=r.string,a=function(r,i){var o=r.exec;if(T1(o)){var a=hf(o,r,i);return null!==a&&qb(a),a}if("RegExp"===w1(r))return hf(I1,r,i);throw Yb("RegExp#exec called on incompatible receiver")}(i,o);return null===a?(r.done=!0,d_(void 0,!0)):r.global?(""===rh(a[0])&&(i.lastIndex=function(r,i,o){return i+(o?Kb(r,i).length:1)}(o,R1(i.lastIndex),r.unicode)),d_(a,!1)):(r.done=!0,d_(a,!1))}),rR=function(r){var i,o,a,l=mf(this),d=rh(r),h=bs(l,RegExp),f=rh(u_(l));return i=new h(h===RegExp?l.source:l,f),o=!!~h_(f,"g"),a=!!~h_(f,"u"),i.lastIndex=R1(l.lastIndex),new P1(i,d,o,a)};eR({target:"String",proto:!0,forced:Td},{matchAll:function(r){var i,o,a,l,d=ff(this);if(X3(r)){if(Td)return gf(d,r)}else{if(D1(r)&&(i=rh(ff(u_(r))),!~h_(i,"g")))throw Xb("`.matchAll` does not allow non-global regexes");if(Td)return gf(d,r);if(void 0===(a=ih(r,O1))&&"RegExp"==A1(r)&&(a=rR),a)return tR(a,r,d)}return o=rh(d),l=new RegExp(r,"g"),tR(rR,l,o)}});var _f=Di("String").matchAll,iR=Ri,oR=_f,Zb=String.prototype,k1=Ht(function(r){var i=r.matchAll;return"string"==typeof r||r===Zb||iR(Zb,r)&&i===Zb.matchAll?oR:i});function L1(r){function i(o,a,l,d){let h=o[d++];if("__proto__"===h)return!0;const f=Number.isFinite(+h),m=d>=o.length;return h=!h&&ce.isArray(l)?l.length:h,m?(l[h]=ce.hasOwnProp(l,h)?[l[h],a]:a,!f):(l[h]&&ce.isObject(l[h])||(l[h]=[]),i(o,a,l[h],d)&&ce.isArray(l[h])&&(l[h]=function(g){const v={},y=Object.keys(g);let b;const C=y.length;let P;for(b=0;b<C;b++)P=y[b],v[P]=g[P];return v}(l[h])),!f)}if(ce.isFormData(r)&&ce.isFunction(r.entries)){const o={};return ce.forEachEntry(r,(a,l)=>{var d;i((d=a,k1(ce).call(ce,/\w+|\[(\w*)]/g,d).map(h=>"[]"===h[0]?"":h[1]||h[0])),l,o,0)}),o}return null}const sR={transitional:pk,adapter:["xhr","http","fetch"],transformRequest:[function(r,i){const o=i.getContentType()||"",a=o.indexOf("application/json")>-1,l=ce.isObject(r);if(l&&ce.isHTMLForm(r)&&(r=new FormData(r)),ce.isFormData(r))return a?JSON.stringify(L1(r)):r;if(ce.isArrayBuffer(r)||ce.isBuffer(r)||ce.isStream(r)||ce.isFile(r)||ce.isBlob(r)||ce.isReadableStream(r))return r;if(ce.isArrayBufferView(r))return r.buffer;if(ce.isURLSearchParams(r))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),r.toString();let d;if(l){if(o.indexOf("application/x-www-form-urlencoded")>-1)return(h=r,f=this.formSerializer,Sb(h,new es.classes.URLSearchParams,Object.assign({visitor:function(m,g,v,y){return es.isNode&&ce.isBuffer(m)?(this.append(g,m.toString("base64")),!1):y.defaultVisitor.apply(this,arguments)}},f))).toString();if((d=ce.isFileList(r))||o.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return Sb(d?{"files[]":r}:r,h&&new h,this.formSerializer)}}var h,f;return l||a?(i.setContentType("application/json",!1),function(h){if(ce.isString(h))try{return(0,JSON.parse)(h),vi(ce).call(ce,h)}catch(g){if("SyntaxError"!==g.name)throw g}return(0,JSON.stringify)(h)}(r)):r}],transformResponse:[function(r){const i=this.transitional||sR.transitional,o=i&&i.forcedJSONParsing,a="json"===this.responseType;if(ce.isResponse(r)||ce.isReadableStream(r))return r;if(r&&ce.isString(r)&&(o&&!this.responseType||a)){const l=!(i&&i.silentJSONParsing)&&a;try{return JSON.parse(r)}catch(d){if(l)throw"SyntaxError"===d.name?Mt.from(d,Mt.ERR_BAD_RESPONSE,this,null,this.response):d}}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:es.classes.FormData,Blob:es.classes.Blob},validateStatus:function(r){return r>=200&&r<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ce.forEach(["delete","get","head","post","put","patch"],r=>{sR.headers[r]={}});var wd=sR;const x1=ce.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),F1=Symbol("internals");function p_(r){var i;return r&&vi(i=String(r)).call(i).toLowerCase()}function Jb(r){return!1===r||null==r?r:ce.isArray(r)?r.map(Jb):String(r)}function Qb(r,i,o,a,l){return ce.isFunction(a)?a.call(this,i,o):(l&&(i=o),ce.isString(i)?ce.isString(a)?-1!==i.indexOf(a):ce.isRegExp(a)?a.test(i):void 0:void 0)}class f_{constructor(i){i&&this.set(i)}set(i,o,a){const l=this;function d(m,g,v){const y=p_(g);if(!y)throw new Error("header name must be a non-empty string");const b=ce.findKey(l,y);(!b||void 0===l[b]||!0===v||void 0===v&&!1!==l[b])&&(l[b||g]=Jb(m))}const h=(m,g)=>ce.forEach(m,(v,y)=>d(v,y,g));if(ce.isPlainObject(i)||i instanceof this.constructor)h(i,o);else if(ce.isString(i)&&(i=vi(i).call(i))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(vi(f=i).call(f)))h((m=>{const g={};let v,y,b;return m&&m.split("\n").forEach(function(C){var P,R;b=C.indexOf(":"),v=vi(P=C.substring(0,b)).call(P).toLowerCase(),y=vi(R=C.substring(b+1)).call(R),!v||g[v]&&x1[v]||("set-cookie"===v?g[v]?g[v].push(y):g[v]=[y]:g[v]=g[v]?g[v]+", "+y:y)}),g})(i),o);else if(ce.isHeaders(i))for(const[m,g]of i.entries())d(g,m,a);else null!=i&&d(o,i,a);var f;return this}get(i,o){if(i=p_(i)){const a=ce.findKey(this,i);if(a){const l=this[a];if(!o)return l;if(!0===o)return function(d){const h=Object.create(null),f=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let m;for(;m=f.exec(d);)h[m[1]]=m[2];return h}(l);if(ce.isFunction(o))return o.call(this,l,a);if(ce.isRegExp(o))return o.exec(l);throw new TypeError("parser must be boolean|regexp|function")}}}has(i,o){if(i=p_(i)){const a=ce.findKey(this,i);return!(!a||void 0===this[a]||o&&!Qb(0,this[a],a,o))}return!1}delete(i,o){const a=this;let l=!1;function d(h){if(h=p_(h)){const f=ce.findKey(a,h);!f||o&&!Qb(0,a[f],f,o)||(delete a[f],l=!0)}}return ce.isArray(i)?i.forEach(d):d(i),l}clear(i){const o=Object.keys(this);let a=o.length,l=!1;for(;a--;){const d=o[a];i&&!Qb(0,this[d],d,i,!0)||(delete this[d],l=!0)}return l}normalize(i){const o=this,a={};return ce.forEach(this,(l,d)=>{var h;const f=ce.findKey(a,d);if(f)return o[f]=Jb(l),void delete o[d];const m=i?vi(g=d).call(g).toLowerCase().replace(/([a-z\d])(\w*)/g,(v,y,b)=>y.toUpperCase()+b):vi(h=String(d)).call(h);var g;m!==d&&delete o[d],o[m]=Jb(l),a[m]=!0}),this}concat(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return this.constructor.concat(this,...o)}toJSON(i){const o=Object.create(null);return ce.forEach(this,(a,l)=>{null!=a&&!1!==a&&(o[l]=i&&ce.isArray(a)?a.join(", "):a)}),o}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(i=>{let[o,a]=i;return o+": "+a}).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(i){return i instanceof this?i:new this(i)}static concat(i){const o=new this(i);for(var a=arguments.length,l=new Array(a>1?a-1:0),d=1;d<a;d++)l[d-1]=arguments[d];return l.forEach(h=>o.set(h)),o}static accessor(i){const o=(this[F1]=this[F1]={accessors:{}}).accessors,a=this.prototype;function l(d){const h=p_(d);o[h]||(function(f,m){const g=ce.toCamelCase(" "+m);["get","set","has"].forEach(v=>{Object.defineProperty(f,v+g,{value:function(y,b,C){return this[v].call(this,m,y,b,C)},configurable:!0})})}(a,d),o[h]=!0)}return ce.isArray(i)?i.forEach(l):l(i),this}}f_.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ce.reduceDescriptors(f_.prototype,(r,i)=>{let{value:o}=r,a=i[0].toUpperCase()+i.slice(1);return{get:()=>o,set(l){this[a]=l}}}),ce.freezeMethods(f_);var Aa=f_;function U1(r,i){const o=this||wd,a=i||o,l=Aa.from(a.headers);let d=a.data;return ce.forEach(r,function(h){d=h.call(o,d,l.normalize(),i?i.status:void 0)}),l.normalize(),d}function V1(r){return!(!r||!r.__CANCEL__)}function Id(r,i,o){Mt.call(this,r??"canceled",Mt.ERR_CANCELED,i,o),this.name="CanceledError"}function eS(r,i,o){const a=o.config.validateStatus;o.status&&a&&!a(o.status)?i(new Mt("Request failed with status code "+o.status,[Mt.ERR_BAD_REQUEST,Mt.ERR_BAD_RESPONSE][Math.floor(o.status/100)-4],o.config,o.request,o)):r(o)}ce.inherits(Id,Mt,{__CANCEL__:!0});const tS=function(r,i){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,a=0;const l=function(d,h){d=d||10;const f=new Array(d),m=new Array(d);let g,v=0,y=0;return h=void 0!==h?h:1e3,function(b){const C=Date.now(),P=m[y];g||(g=C),f[v]=b,m[v]=C;let R=y,A=0;for(;R!==v;)A+=f[R++],R%=d;if(v=(v+1)%d,v===y&&(y=(y+1)%d),C-g<h)return;const O=P&&C-P;return O?Math.round(1e3*A/O):void 0}}(50,250);return function(d,h){let f,m,g=0,v=1e3/h;const y=function(b){g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),f=null,m&&(clearTimeout(m),m=null),d.apply(null,b)};return[function(){const b=Date.now(),C=b-g;for(var P=arguments.length,R=new Array(P),A=0;A<P;A++)R[A]=arguments[A];C>=v?y(R,b):(f=R,m||(m=setTimeout(()=>{m=null,y(f)},v-C)))},()=>f&&y(f)]}(d=>{const h=d.loaded,f=d.lengthComputable?d.total:void 0,m=h-a,g=l(m);a=h,r({loaded:h,total:f,progress:f?h/f:void 0,bytes:m,rate:g||void 0,estimated:g&&f&&h<=f?(f-h)/g:void 0,event:d,lengthComputable:null!=f,[i?"download":"upload"]:!0})},o)},B1=(r,i)=>{const o=null!=r;return[a=>i[0]({lengthComputable:o,total:r,loaded:a}),i[1]]},j1=r=>function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return ce.asap(()=>r(...o))};var t4=es.hasStandardBrowserEnv?function(){const r=es.navigator&&/(msie|trident)/i.test(es.navigator.userAgent),i=document.createElement("a");let o;function a(l){let d=l;return r&&(i.setAttribute("href",d),d=i.href),i.setAttribute("href",d),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:"/"===i.pathname.charAt(0)?i.pathname:"/"+i.pathname}}return o=a(window.location.href),function(l){const d=ce.isString(l)?a(l):l;return d.protocol===o.protocol&&d.host===o.host}}():function(){return!0},n4=es.hasStandardBrowserEnv?{write(r,i,o,a,l,d){const h=[r+"="+encodeURIComponent(i)];ce.isNumber(o)&&h.push("expires="+new Date(o).toGMTString()),ce.isString(a)&&h.push("path="+a),ce.isString(l)&&h.push("domain="+l),!0===d&&h.push("secure"),document.cookie=h.join("; ")},read(r){const i=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function H1(r,i){return r&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)?(o=r,(a=i)?o.replace(/\/?\/$/,"")+"/"+a.replace(/^\/+/,""):o):i;var o,a}function G1(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}const W1=r=>r instanceof Aa?function(i){for(var o=1;o<arguments.length;o++){var a=null!=arguments[o]?arguments[o]:{};o%2?G1(Object(a),!0).forEach(function(l){N(i,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):G1(Object(a)).forEach(function(l){Object.defineProperty(i,l,Object.getOwnPropertyDescriptor(a,l))})}return i}({},r):r;function oh(r,i){i=i||{};const o={};function a(g,v,y){return ce.isPlainObject(g)&&ce.isPlainObject(v)?ce.merge.call({caseless:y},g,v):ce.isPlainObject(v)?ce.merge({},v):ce.isArray(v)?v.slice():v}function l(g,v,y){return ce.isUndefined(v)?ce.isUndefined(g)?void 0:a(void 0,g,y):a(g,v,y)}function d(g,v){if(!ce.isUndefined(v))return a(void 0,v)}function h(g,v){return ce.isUndefined(v)?ce.isUndefined(g)?void 0:a(void 0,g):a(void 0,v)}function f(g,v,y){return y in i?a(g,v):y in r?a(void 0,g):void 0}const m={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:f,headers:(g,v)=>l(W1(g),W1(v),!0)};return ce.forEach(Object.keys(Object.assign({},r,i)),function(g){const v=m[g]||l,y=v(r[g],i[g],g);ce.isUndefined(y)&&v!==f||(o[g]=y)}),o}var z1=r=>{const i=oh({},r);let o,{data:a,withXSRFToken:l,xsrfHeaderName:d,xsrfCookieName:h,headers:f,auth:m}=i;if(i.headers=f=Aa.from(f),i.url=hk(H1(i.baseURL,i.url),r.params,r.paramsSerializer),m&&f.set("Authorization","Basic "+btoa((m.username||"")+":"+(m.password?unescape(encodeURIComponent(m.password)):""))),ce.isFormData(a))if(es.hasStandardBrowserEnv||es.hasStandardBrowserWebWorkerEnv)f.setContentType(void 0);else if(!1!==(o=f.getContentType())){const[g,...v]=o?o.split(";").map(y=>vi(y).call(y)).filter(Boolean):[];f.setContentType([g||"multipart/form-data",...v].join("; "))}if(es.hasStandardBrowserEnv&&(l&&ce.isFunction(l)&&(l=l(i)),l||!1!==l&&t4(i.url))){const g=d&&h&&n4.read(h);g&&f.set(d,g)}return i},r4=typeof XMLHttpRequest<"u"&&function(r){return new le(function(i,o){const a=z1(r);let l=a.data;const d=Aa.from(a.headers).normalize();let h,f,m,g,v,{responseType:y,onUploadProgress:b,onDownloadProgress:C}=a;function P(){g&&g(),v&&v(),a.cancelToken&&a.cancelToken.unsubscribe(h),a.signal&&a.signal.removeEventListener("abort",h)}let R=new XMLHttpRequest;function A(){if(!R)return;const M=Aa.from("getAllResponseHeaders"in R&&R.getAllResponseHeaders());eS(function(x){i(x),P()},function(x){o(x),P()},{data:y&&"text"!==y&&"json"!==y?R.response:R.responseText,status:R.status,statusText:R.statusText,headers:M,config:r,request:R}),R=null}R.open(a.method.toUpperCase(),a.url,!0),R.timeout=a.timeout,"onloadend"in R?R.onloadend=A:R.onreadystatechange=function(){R&&4===R.readyState&&(0!==R.status||R.responseURL&&0===R.responseURL.indexOf("file:"))&&setTimeout(A)},R.onabort=function(){R&&(o(new Mt("Request aborted",Mt.ECONNABORTED,r,R)),R=null)},R.onerror=function(){o(new Mt("Network Error",Mt.ERR_NETWORK,r,R)),R=null},R.ontimeout=function(){let M=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";a.timeoutErrorMessage&&(M=a.timeoutErrorMessage),o(new Mt(M,(a.transitional||pk).clarifyTimeoutError?Mt.ETIMEDOUT:Mt.ECONNABORTED,r,R)),R=null},void 0===l&&d.setContentType(null),"setRequestHeader"in R&&ce.forEach(d.toJSON(),function(M,x){R.setRequestHeader(x,M)}),ce.isUndefined(a.withCredentials)||(R.withCredentials=!!a.withCredentials),y&&"json"!==y&&(R.responseType=a.responseType),C&&([m,v]=tS(C,!0),R.addEventListener("progress",m)),b&&R.upload&&([f,g]=tS(b),R.upload.addEventListener("progress",f),R.upload.addEventListener("loadend",g)),(a.cancelToken||a.signal)&&(h=M=>{R&&(o(!M||M.type?new Id(null,r,R):M),R.abort(),R=null)},a.cancelToken&&a.cancelToken.subscribe(h),a.signal&&(a.signal.aborted?h():a.signal.addEventListener("abort",h)));const O=function(M){const x=/^([-+\w]{1,25})(:?\/\/|:)/.exec(M);return x&&x[1]||""}(a.url);O&&-1===es.protocols.indexOf(O)?o(new Mt("Unsupported protocol "+O+":",Mt.ERR_BAD_REQUEST,r)):R.send(l||null)})},i4=(r,i)=>{const{length:o}=r=r?r.filter(Boolean):[];if(i||o){let a,l=new AbortController;const d=function(g){if(!a){a=!0,f();const v=g instanceof Error?g:this.reason;l.abort(v instanceof Mt?v:new Id(v instanceof Error?v.message:v))}};let h=i&&setTimeout(()=>{h=null,d(new Mt("timeout ".concat(i," of ms exceeded"),Mt.ETIMEDOUT))},i);const f=()=>{r&&(h&&clearTimeout(h),h=null,r.forEach(g=>{g.unsubscribe?g.unsubscribe(d):g.removeEventListener("abort",d)}),r=null)};r.forEach(g=>g.addEventListener("abort",d));const{signal:m}=l;return m.unsubscribe=()=>ce.asap(f),m}},o4=rl,s4=ya;xt({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var r=s4.f(this);return{promise:r.promise,resolve:r.resolve,reject:r.reject}}});var a4=ya,c4=Pu;xt({target:"Promise",stat:!0,forced:!0},{try:function(r){var i=a4.f(this),o=c4(r);return(o.error?i.reject:i.resolve)(o.value),i.promise}});var nS=Ht(o4),aR=Ku.f("asyncIterator"),Rd=Ht(aR);function m_(r,i){this.v=r,this.k=i}function g_(r){var i,o;function a(d,h){try{var f=r[d](h),m=f.value,g=m instanceof m_;nS.resolve(g?m.v:m).then(function(v){if(g){var y="return"===d?"return":"next";if(!m.k||v.done)return a(y,v);v=r[y](v).value}l(f.done?"return":"normal",v)},function(v){a("throw",v)})}catch(v){l("throw",v)}}function l(d,h){switch(d){case"return":i.resolve({value:h,done:!0});break;case"throw":i.reject(h);break;default:i.resolve({value:h,done:!1})}(i=i.next)?a(i.key,i.arg):o=null}this._invoke=function(d,h){return new nS(function(f,m){var g={key:d,arg:h,resolve:f,reject:m,next:null};o?o=o.next=g:(i=o=g,a(d,h))})},"function"!=typeof r.return&&(this.return=void 0)}function ts(r){return function(){return new g_(r.apply(this,arguments))}}function tt(r){return new m_(r,0)}function __(r){var i={},o=!1;function a(l,d){return o=!0,{done:!1,value:new m_(d=new nS(function(h){h(r[l](d))}),1)}}return i[void 0!==Qu&&VI||"@@iterator"]=function(){return this},i.next=function(l){return o?(o=!1,l):a("next",l)},"function"==typeof r.throw&&(i.throw=function(l){if(o)throw o=!1,l;return a("throw",l)}),"function"==typeof r.return&&(i.return=function(l){return o?(o=!1,l):a("return",l)}),i}g_.prototype["function"==typeof Qu&&Rd||"@@asyncIterator"]=function(){return this},g_.prototype.next=function(r){return this._invoke("next",r)},g_.prototype.throw=function(r){return this._invoke("throw",r)},g_.prototype.return=function(r){return this._invoke("return",r)};var rS=Ht(aR);function sh(r){var i,o,a,l=2;for(typeof Symbol<"u"&&(o=rS,a=Symbol.iterator);l--;){if(o&&null!=(i=r[o]))return i.call(r);if(a&&null!=(i=r[a]))return new vf(i.call(r));o="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function vf(r){function i(o){if(Object(o)!==o)return le.reject(new TypeError(o+" is not an object."));var a=o.done;return le.resolve(o.value).then(function(l){return{value:l,done:a}})}return(vf=function(o){this.s=o,this.n=o.next}).prototype={s:null,n:null,next:function(){return i(this.n.apply(this.s,arguments))},return:function(o){var a=this.s.return;return void 0===a?le.resolve({value:o,done:!0}):i(a.apply(this.s,arguments))},throw:function(o){var a=this.s.return;return void 0===a?le.reject(o):i(a.apply(this.s,arguments))}},new vf(r)}const Ef=function*(r,i){let o=r.byteLength;if(!i||o<i)return void(yield r);let a,l=0;for(;l<o;)a=l+i,yield r.slice(l,a),l=a},K1=function(){var r=ts(function*(i,o){var a,l=!1,d=!1;try{for(var h,f=sh(yf(i));l=!(h=yield tt(f.next())).done;l=!1){const m=h.value;yield*__(sh(Ef(m,o)))}}catch(m){d=!0,a=m}finally{try{l&&null!=f.return&&(yield tt(f.return()))}finally{if(d)throw a}}});return function(i,o){return r.apply(this,arguments)}}(),yf=function(){var r=ts(function*(i){if(i[rS])return void(yield*__(sh(i)));const o=i.getReader();try{for(;;){const{done:a,value:l}=yield tt(o.read());if(a)break;yield l}}finally{yield tt(o.cancel())}});return function(i){return r.apply(this,arguments)}}(),Jr=(r,i,o,a)=>{const l=K1(r,i);let d,h=0,f=m=>{d||(d=!0,a&&a(m))};return new ReadableStream({pull:m=>L(function*(){try{const{done:g,value:v}=yield l.next();if(g)return f(),void m.close();if(o){let b=h+=v.byteLength;o(b)}m.enqueue(new Uint8Array(v))}catch(g){throw f(g),g}})(),cancel:m=>(f(m),l.return())},{highWaterMark:2})};function ah(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function ch(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?ah(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):ah(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}const ul="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,lh=ul&&"function"==typeof ReadableStream,bf=ul&&("function"==typeof TextEncoder?(dh=new TextEncoder,r=>dh.encode(r)):function(){var r=L(function*(i){return new Uint8Array(yield new Response(i).arrayBuffer())});return function(i){return r.apply(this,arguments)}}());var dh;const uh=function(r){try{for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return!!r(...o)}catch{return!1}},Sf=lh&&uh(()=>{let r=!1;const i=new Request(es.origin,{body:new ReadableStream,method:"POST",get duplex(){return r=!0,"half"}}).headers.has("Content-Type");return r&&!i}),Ad=lh&&uh(()=>ce.isReadableStream(new Response("").body)),v_={stream:Ad&&(r=>r.body)};var cR;ul&&(cR=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(r=>{!v_[r]&&(v_[r]=ce.isFunction(cR[r])?i=>i[r]():(i,o)=>{throw new Mt("Response type '".concat(r,"' is not supported"),Mt.ERR_NOT_SUPPORT,o)})}));const q1=function(){var r=L(function*(i,o){return ce.toFiniteNumber(i.getContentLength())??(l=L(function*(d){return null==d?0:ce.isBlob(d)?d.size:ce.isSpecCompliantForm(d)?(yield new Request(es.origin,{method:"POST",body:d}).arrayBuffer()).byteLength:ce.isArrayBufferView(d)||ce.isArrayBuffer(d)?d.byteLength:(ce.isURLSearchParams(d)&&(d+=""),ce.isString(d)?(yield bf(d)).byteLength:void 0)}),function(d){return l.apply(this,arguments)})(o);var l});return function(o,a){return r.apply(this,arguments)}}();var Y1=ul&&function(){var r=L(function*(i){let{url:o,method:a,data:l,signal:d,cancelToken:h,timeout:f,onDownloadProgress:m,onUploadProgress:g,responseType:v,headers:y,withCredentials:b="same-origin",fetchOptions:C}=z1(i);v=v?(v+"").toLowerCase():"text";let P,R=i4([d,h&&h.toAbortSignal()],f);const A=R&&R.unsubscribe&&(()=>{R.unsubscribe()});let O;try{if(g&&Sf&&"get"!==a&&"head"!==a&&0!==(O=yield q1(y,l))){let q,te=new Request(o,{method:"POST",body:l,duplex:"half"});if(ce.isFormData(l)&&(q=te.headers.get("content-type"))&&y.setContentType(q),te.body){const[J,X]=B1(O,tS(j1(g)));l=Jr(te.body,65536,J,X)}}ce.isString(b)||(b=b?"include":"omit");const M="credentials"in Request.prototype;P=new Request(o,ch(ch({},C),{},{signal:R,method:a.toUpperCase(),headers:y.normalize().toJSON(),body:l,duplex:"half",credentials:M?b:void 0}));let x=yield fetch(P);const j=Ad&&("stream"===v||"response"===v);if(Ad&&(m||j&&A)){const q={};["status","statusText","headers"].forEach(Ce=>{q[Ce]=x[Ce]});const te=ce.toFiniteNumber(x.headers.get("content-length")),[J,X]=m&&B1(te,tS(j1(m),!0))||[];x=new Response(Jr(x.body,65536,J,()=>{X&&X(),A&&A()}),q)}v=v||"text";let W=yield v_[ce.findKey(v_,v)||"text"](x,i);return!j&&A&&A(),yield new le((q,te)=>{eS(q,te,{data:W,headers:Aa.from(x.headers),status:x.status,statusText:x.statusText,config:i,request:P})})}catch(M){throw A&&A(),M&&"TypeError"===M.name&&/fetch/i.test(M.message)?Object.assign(new Mt("Network Error",Mt.ERR_NETWORK,i,P),{cause:M.cause||M}):Mt.from(M,M&&M.code,i,P)}});return function(i){return r.apply(this,arguments)}}();const iS={http:null,xhr:r4,fetch:Y1};ce.forEach(iS,(r,i)=>{if(r){try{Object.defineProperty(r,"name",{value:i})}catch{}Object.defineProperty(r,"adapterName",{value:i})}});const lR=r=>"- ".concat(r),$1=r=>ce.isFunction(r)||null===r||!1===r;var dR_getAdapter=r=>{r=ce.isArray(r)?r:[r];const{length:i}=r;let o,a;const l={};for(let d=0;d<i;d++){let h;if(o=r[d],a=o,!$1(o)&&(a=iS[(h=String(o)).toLowerCase()],void 0===a))throw new Mt("Unknown adapter '".concat(h,"'"));if(a)break;l[h||"#"+d]=a}if(!a){const d=Object.entries(l).map(h=>{let[f,m]=h;return"adapter ".concat(f," ")+(!1===m?"is not supported by the environment":"is not available in the build")});throw new Mt("There is no suitable adapter to dispatch the request "+(i?d.length>1?"since :\n"+d.map(lR).join("\n"):" "+lR(d[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return a};function oS(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Id(null,r)}function E_(r){return oS(r),r.headers=Aa.from(r.headers),r.data=U1.call(r,r.transformRequest),-1!==["post","put","patch"].indexOf(r.method)&&r.headers.setContentType("application/x-www-form-urlencoded",!1),dR_getAdapter(r.adapter||wd.adapter)(r).then(function(i){return oS(r),i.data=U1.call(r,r.transformResponse,i),i.headers=Aa.from(i.headers),i},function(i){return V1(i)||(oS(r),i&&i.response&&(i.response.data=U1.call(r,r.transformResponse,i.response),i.response.headers=Aa.from(i.response.headers))),le.reject(i)})}const uR={};["object","boolean","number","function","string","symbol"].forEach((r,i)=>{uR[r]=function(o){return typeof o===r||"a"+(i<1?"n ":" ")+r}});const X1={};uR.transitional=function(r,i,o){function a(l,d){return"[Axios v1.7.7] Transitional option '"+l+"'"+d+(o?". "+o:"")}return(l,d,h)=>{if(!1===r)throw new Mt(a(d," has been removed"+(i?" in "+i:"")),Mt.ERR_DEPRECATED);return i&&!X1[d]&&(X1[d]=!0,console.warn(a(d," has been deprecated since v"+i+" and will be removed in the near future"))),!r||r(l,d,h)}};var y_={assertOptions:function(r,i,o){if("object"!=typeof r)throw new Mt("options must be an object",Mt.ERR_BAD_OPTION_VALUE);const a=Object.keys(r);let l=a.length;for(;l-- >0;){const d=a[l],h=i[d];if(h){const f=r[d],m=void 0===f||h(f,d,r);if(!0!==m)throw new Mt("option "+d+" must be "+m,Mt.ERR_BAD_OPTION_VALUE)}else if(!0!==o)throw new Mt("Unknown option "+d,Mt.ERR_BAD_OPTION)}},validators:uR};const ns=y_.validators;let Cf=class{constructor(r){this.defaults=r,this.interceptors={request:new tI,response:new tI}}request(r,i){var o=this;return L(function*(){try{return yield o._request(r,i)}catch(a){if(a instanceof Error){let l;Error.captureStackTrace?Error.captureStackTrace(l={}):l=new Error;const d=l.stack?l.stack.replace(/^.+\n/,""):"";try{a.stack?d&&!String(a.stack).endsWith(d.replace(/^.+\n.+\n/,""))&&(a.stack+="\n"+d):a.stack=d}catch{}}throw a}})()}_request(r,i){"string"==typeof r?(i=i||{}).url=r:i=r||{},i=oh(this.defaults,i);const{transitional:o,paramsSerializer:a,headers:l}=i;void 0!==o&&y_.assertOptions(o,{silentJSONParsing:ns.transitional(ns.boolean),forcedJSONParsing:ns.transitional(ns.boolean),clarifyTimeoutError:ns.transitional(ns.boolean)},!1),null!=a&&(ce.isFunction(a)?i.paramsSerializer={serialize:a}:y_.assertOptions(a,{encode:ns.function,serialize:ns.function},!0)),i.method=(i.method||this.defaults.method||"get").toLowerCase();let d=l&&ce.merge(l.common,l[i.method]);l&&ce.forEach(["delete","get","head","post","put","patch","common"],C=>{delete l[C]}),i.headers=Aa.concat(d,l);const h=[];let f=!0;this.interceptors.request.forEach(function(C){"function"==typeof C.runWhen&&!1===C.runWhen(i)||(f=f&&C.synchronous,h.unshift(C.fulfilled,C.rejected))});const m=[];let g;this.interceptors.response.forEach(function(C){m.push(C.fulfilled,C.rejected)});let v,y=0;if(!f){const C=[E_.bind(this),void 0];for(C.unshift.apply(C,h),C.push.apply(C,m),v=C.length,g=le.resolve(i);y<v;)g=g.then(C[y++],C[y++]);return g}v=h.length;let b=i;for(y=0;y<v;){const C=h[y++],P=h[y++];try{b=C(b)}catch(R){P.call(this,R);break}}try{g=E_.call(this,b)}catch(C){return le.reject(C)}for(y=0,v=m.length;y<v;)g=g.then(m[y++],m[y++]);return g}getUri(r){return hk(H1((r=oh(this.defaults,r)).baseURL,r.url),r.params,r.paramsSerializer)}};ce.forEach(["delete","get","head","options"],function(r){Cf.prototype[r]=function(i,o){return this.request(oh(o||{},{method:r,url:i,data:(o||{}).data}))}}),ce.forEach(["post","put","patch"],function(r){function i(o){return function(a,l,d){return this.request(oh(d||{},{method:r,headers:o?{"Content-Type":"multipart/form-data"}:{},url:a,data:l}))}}Cf.prototype[r]=i(),Cf.prototype[r+"Form"]=i(!0)});var sS=Cf;class b_{constructor(i){if("function"!=typeof i)throw new TypeError("executor must be a function.");let o;this.promise=new le(function(l){o=l});const a=this;this.promise.then(l=>{if(!a._listeners)return;let d=a._listeners.length;for(;d-- >0;)a._listeners[d](l);a._listeners=null}),this.promise.then=l=>{let d;const h=new le(f=>{a.subscribe(f),d=f}).then(l);return h.cancel=function(){a.unsubscribe(d)},h},i(function(l,d,h){a.reason||(a.reason=new Id(l,d,h),o(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(i){this.reason?i(this.reason):this._listeners?this._listeners.push(i):this._listeners=[i]}unsubscribe(i){if(!this._listeners)return;const o=this._listeners.indexOf(i);-1!==o&&this._listeners.splice(o,1)}toAbortSignal(){const i=new AbortController,o=a=>{i.abort(a)};return this.subscribe(o),i.signal.unsubscribe=()=>this.unsubscribe(o),i.signal}static source(){let i;return{token:new b_(function(o){i=o}),cancel:i}}}var iz=b_;const Z1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Z1).forEach(r=>{let[i,o]=r;Z1[o]=i});var l4=Z1;const ai=function r(i){const o=new sS(i),a=rk(sS.prototype.request,o);return ce.extend(a,sS.prototype,o,{allOwnKeys:!0}),ce.extend(a,o,null,{allOwnKeys:!0}),a.create=function(l){return r(oh(i,l))},a}(wd);ai.Axios=sS,ai.CanceledError=Id,ai.CancelToken=iz,ai.isCancel=V1,ai.VERSION="1.7.7",ai.toFormData=Sb,ai.AxiosError=Mt,ai.Cancel=ai.CanceledError,ai.all=function(r){return le.all(r)},ai.spread=function(r){return function(i){return r.apply(null,i)}},ai.isAxiosError=function(r){return ce.isObject(r)&&!0===r.isAxiosError},ai.mergeConfig=oh,ai.AxiosHeaders=Aa,ai.formToJSON=r=>L1(ce.isHTMLForm(r)?new FormData(r):r),ai.getAdapter=dR_getAdapter,ai.HttpStatusCode=l4,ai.default=ai;var Oi=ai;const d4=()=>{};function Or(){const r={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:d4};return r.promise=new le((i,o)=>{r.resolve=a=>{r.isFinished||(r.isResolved=!0,r.isFinished=!0,i(a),r.value=a)},r.reject=a=>{r.isFinished||(r.isRejected=!0,r.isFinished=!0,o(a))}}),r}const S_=new Map,aS=new Map,Ec=new Map;let hr=function(r){return r.WIN_10="Windows 10",r.WIN_81="Windows 8.1",r.WIN_8="Windows 8",r.WIN_7="Windows 7",r.WIN_VISTA="Windows Vista",r.WIN_SERVER_2003="Windows Server 2003",r.WIN_XP="Windows XP",r.WIN_2000="Windows 2000",r.ANDROID="Android",r.HARMONY_OS="HarmonyOS",r.OPEN_BSD="Open BSD",r.SUN_OS="Sun OS",r.LINUX="Linux",r.IOS="iOS",r.MAC_OS="Mac OS",r.CHROMIUM_OS="Chromium OS",r.QNX="QNX",r.UNIX="UNIX",r.BEOS="BeOS",r.OS_2="OS/2",r.SEARCH_BOT="Search Bot",r}({}),It=function(r){return r.CHROME="Chrome",r.SAFARI="Safari",r.EDGE="Edge",r.FIREFOX="Firefox",r.OPERA="OPR",r.QQ="QQBrowser",r.WECHAT="MicroMessenger",r}({});const cS=new KM;let Hs=cS.getResult(),Dd=null;function ot(r){if(!Dd){r&&cS.setUA(r),Hs=cS.getResult();const i=function(f){if("Blink"===f.engine.name&&"WeChat"!==f.browser.name)return It.CHROME;switch(f.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return It.CHROME;case"Safari":case"Mobile Safari":return It.SAFARI;case"Edge":return It.EDGE;case"Firefox":return It.FIREFOX;case"QQ":case"QQBrowser":return It.QQ;case"Opera":return It.OPERA;case"WeChat":return It.WECHAT;default:return f.browser.name||""}}(Hs),o=J1(Hs),a="Windows"===(f=Hs).os.name?f.os.version?f.os.name+" "+f.os.version:f.os.name:f.os.name||"",l=Hs.os.version,d=J1(Hs,!1),h=Hs.device.type;if(!(i&&o&&a&&l))return{name:i,version:o,os:a,osVersion:l,browserVersion:d,deviceType:h};Dd={name:i,version:o,os:a,osVersion:l,browserVersion:d,deviceType:h}}var f;return Dd}function J1(r){let i;return i="Blink"===r.engine.name?r.engine.version||"":r.browser.version||"",arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?i:i.split(".")[0]}function C_(){return ot().os}function Q1(){const r=ot();return"".concat(r.os," ").concat(r.osVersion)}function T_(){const r=ot();return!!("WebKit"===Hs.engine.name&&r.os===hr.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&r.name!==It.SAFARI||nt()&&r.name!==It.SAFARI)}function hh(){return ot().name===It.CHROME}function $e(){return ot().name===It.SAFARI}function lS(){return ot().name===It.EDGE}function hn(){return ot().name===It.FIREFOX}function nt(){return ot().os===hr.IOS}function Gs(r){const i=ot();return!(i.name!==It.CHROME||!i.osVersion)&&Number(i.version)>=r}function eL(r){const i=ot();return!(i.name!==It.CHROME||!i.osVersion)&&Number(i.version)<r}function dS(r){const i=ot();return!(i.name!==It.EDGE||!i.osVersion)&&Number(i.version)>=r}function Da(r){const i=ot();return!(i.name!==It.SAFARI||!i.osVersion)&&Number(i.version)>=r}function Ws(r,i,o){const a=ot();if(a.os!==hr.IOS||!a.osVersion)return!1;const l=a.osVersion.split(".");return o?i&&Number(l[0])===r&&Number(l[1])<i||Number(l[0])<r:i?Number(l[0])===r&&Number(l[1])<=i||Number(l[0])<r:Number(l[0])<=r}function zs(r,i,o){const a=ot();if(a.name!==It.SAFARI||!a.osVersion||!a.browserVersion)return!1;const l=a.browserVersion.split(".");return o?i&&Number(l[0])===r&&Number(l[1])<i||Number(l[0])<r:i?Number(l[0])===r&&Number(l[1])<=i||Number(l[0])<r:Number(l[0])<=r}function hR(r){const i=ot();return!(i.name!==It.OPERA||!i.osVersion)&&Number(i.version)>=r}function pR(){const r=ot();if(r.os!==hr.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return Number(i[0])<14||14===Number(i[0])&&Number(i[1])<=6}function Tf(){const r=ot();if(r.os!==hr.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return 15===Number(i[0])}function fR(){const r=ot();if(r.os!==hr.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return 16===Number(i[0])}function tL(){const r=ot();if(r.os!==hr.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return 15===Number(i[0])&&Number(i[1])>=1}function Ks(){return $e()&&navigator.maxTouchPoints>0}function uS(){return ot().name===It.WECHAT}function wf(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function mR(){const r=C_();return function(){const{deviceType:i}=ot();return"mobile"===i||"tablet"===i}()||r===hr.ANDROID||r===hr.IOS||r===hr.HARMONY_OS}function pl(){const r=ot();return r.name!==It.EDGE&&r.name!==It.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function hS(){return C_()===hr.ANDROID}function w_(){const r=ot();return hS()&&(r.name===It.CHROME||r.name===It.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function $t(r,i,o){return(i="symbol"==typeof(l=function(d){if("object"!=typeof d||!d)return d;var f=d[Symbol.toPrimitive];if(void 0!==f){var m=f.call(d,"string");if("object"!=typeof m)return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(i))?l:l+"")in r?Object.defineProperty(r,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[i]=o,r;var l}function gR(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function Ee(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?gR(Object(o),!0).forEach(function(a){$t(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):gR(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}let k=function(r){return r.UNEXPECTED_ERROR="UNEXPECTED_ERROR",r.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",r.TIMEOUT="TIMEOUT",r.INVALID_PARAMS="INVALID_PARAMS",r.NOT_READABLE="NOT_READABLE",r.NOT_SUPPORTED="NOT_SUPPORTED",r.INVALID_OPERATION="INVALID_OPERATION",r.OPERATION_ABORTED="OPERATION_ABORTED",r.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",r.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",r.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",r.DATACHANNEL_FAILED="DATACHANNEL_FAILED",r.NETWORK_ERROR="NETWORK_ERROR",r.NETWORK_TIMEOUT="NETWORK_TIMEOUT",r.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",r.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",r.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",r.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",r.ELECTRON_IS_NULL="ELECTRON_IS_NULL",r.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",r.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",r.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",r.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",r.PERMISSION_DENIED="PERMISSION_DENIED",r.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",r.TRACK_IS_DISABLED="TRACK_IS_DISABLED",r.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",r.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",r.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",r.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",r.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",r.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",r.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",r.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",r.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",r.UID_CONFLICT="UID_CONFLICT",r.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",r.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",r.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",r.INVALID_TRACK="INVALID_TRACK",r.SENDER_NOT_FOUND="SENDER_NOT_FOUND",r.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",r.SET_ANSWER_FAILED="SET_ANSWER_FAILED",r.ICE_FAILED="ICE_FAILED",r.PC_CLOSED="PC_CLOSED",r.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",r.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",r.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",r.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",r.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",r.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",r.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",r.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",r.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",r.INVALID_REMOTE_USER="INVALID_REMOTE_USER",r.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",r.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",r.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",r.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",r.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",r.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",r.WS_ABORT="WS_ABORT",r.WS_DISCONNECT="WS_DISCONNECT",r.WS_ERR="WS_ERR",r.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",r.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",r.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",r.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",r.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",r.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",r.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",r.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",r.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",r.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",r.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",r.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",r.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",r.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",r.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",r.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",r.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",r.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",r.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",r.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",r.INVALID_PLUGIN="INVALID_PLUGIN",r.DISCONNECT_P2P="DISCONNECT_P2P",r.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",r.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",r.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",r.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",r.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",r.PROHIBITED_OPERATION="PROHIBITED_OPERATION",r.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",r.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",r}({}),Y=class extends Error{constructor(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2?arguments[2]:void 0;super(i),$t(this,"code",void 0),$t(this,"message",void 0),$t(this,"data",void 0),$t(this,"name","AgoraRTCException"),this.code=r,this.message="AgoraRTCError ".concat(this.code,": ").concat(i),this.data=o}toString(){return this.data?"".concat(this.message,"\ndata: ").concat(JSON.stringify(this.data)):this.message}print(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",i=arguments.length>1?arguments[1]:void 0;return"error"===r&&(i||console).error(this.toString()),"warning"===r&&(i||console).warn(this.toString()),this}throw(r){throw this.print("error",r),this}};function fl(r,i){if("boolean"!=typeof r)throw new Y(k.INVALID_PARAMS,"Invalid ".concat(i,": The value is of the boolean type."))}function pr(r,i,o){if(!he(o).call(o,r))throw new Y(k.INVALID_PARAMS,"".concat(i," can only be set as ").concat(JSON.stringify(o)))}function Ft(r,i){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(r<o||r>a||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&("number"!=typeof(l=r)||l%1!=0))throw new Y(k.INVALID_PARAMS,"invalid ".concat(i,": the value range is [").concat(o,", ").concat(a,"]. integer only"));var l}function _R(r,i){if("number"!=typeof r){if(!(r.min||r.max||r.ideal||r.exact))throw new Y(k.INVALID_PARAMS,"".concat(i," is not a valid ConstrainLong"));void 0!==r.min&&Ft(r.min,"".concat(i,".min"),0,1/0),void 0!==r.max&&Ft(r.max,"".concat(i,".max"),1,1/0),void 0!==r.exact&&Ft(r.exact,"".concat(i,".exact"),1,1/0),void 0!==r.ideal&&Ft(r.ideal,"".concat(i,".ideal"),1,1/0)}else Ft(r,i,1,1/0)}function Nr(r,i){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==r)throw new Y(k.INVALID_PARAMS,"".concat(i||"param"," cannot be empty"));if(!nL(r,o,a,l))throw new Y(k.INVALID_PARAMS,"Invalid ".concat(i||"string param",": Length of the string: [").concat(o,",").concat(a,"].").concat(l?" ASCII characters only.":""))}function ml(r,i){if(!Array.isArray(r))throw new Y(k.INVALID_PARAMS,"".concat(i," should be an array"))}function pn(r){return null==r}function nL(r){return"string"==typeof r&&r.length<=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:255)&&r.length>=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)&&(!(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])||function(l){if("string"!=typeof l)return!1;for(let d=0;d<l.length;d+=1){const h=l.charCodeAt(d);if(h<0||h>255)return!1}return!0}(r))}var I_=function(r){return r.COVERED="COVERED",r.POSITION="POSITION",r.SIZE="SIZE",r.STYLE="STYLE",r}(I_||{}),vR=function(r){return r.UNMOUNTED="UNMOUNTED",r.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",r}(vR||{});const rL=new class{constructor(){$t(this,"_clientSize",null),$t(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),$t(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),$t(this,"getStyle",r=>window.getComputedStyle(r,null)),$t(this,"checkCssVisibleProperty",r=>{var i;let o=!0;const a=this.getStyle(r),{display:l,visibility:d,opacity:h,filter:f}=a;return("none"===l||he(i=["hidden","collapse"]).call(i,d)||Number(h)<.1)&&(o=!1),!!o&&(f&&f.split(" ").filter(m=>{var g;const v=m.split("(")[0];return he(g=["brightness","blur","opacity"]).call(g,v)}).map(m=>{const[g,v]=m.split(/\(|\)/);return[g,Number(v.match(/^[0-9\.]+/))]}).forEach(m=>{const[g,v]=m;switch(g){case"brightness":(v<.1||v>3)&&(o=!1);break;case"blur":v>3&&(o=!1);break;case"opacity":v<.1&&(o=!1)}}),o)}),$t(this,"checkPropertyUpToAllParentNodes",(r,i)=>{let o=!0,a=!0;let d=r;for(;d&&a;)i(d)||(o=!1,a=!1),d=d.parentElement,d||(a=!1);return o}),$t(this,"checkActualCssVisibleIncludeInherit",r=>this.checkPropertyUpToAllParentNodes(r,this.checkCssVisibleProperty)),$t(this,"getSizeAboutClient",r=>{const{width:i,height:o,left:a,right:l,top:d,bottom:h}=r.getBoundingClientRect(),f=this.getClientWidth(),m=this.getClientHeight();return{width:i,height:o,left:a,right:l,top:d,bottom:h,clientWidth:f,clientHeight:m,clientMin:Math.min(f,m)}}),$t(this,"checkActualSize",()=>{const{width:r,height:i,clientMin:o}=this._clientSize;return this.checkSizeIsVisible(r,i,o)}),$t(this,"elementFromPoint",(r,i)=>document.elementFromPoint?document.elementFromPoint(r,i):null),$t(this,"checkCoverForAPoint",(r,i,o)=>{const a=this.elementFromPoint(r,i);return null!==a&&a!==o}),$t(this,"getPointPositionList",()=>{const{width:r,height:i,left:o,top:a}=this._clientSize,l=r/6,d=i/6,h=[],f=10**6;for(let m=0;m<5;m++)for(let g=0;g<5;g++)h.push({x:(o*f+(0===m?.1:4===m?(l*m*f-1e5)/f:l*m)*f)/f,y:(a*f+(0===g?.1:4===g?(d*g*f-1e5)/f:d*g)*f)/f});return[...h]}),$t(this,"checkElementCover",r=>this.getPointPositionList().map(i=>this.checkCoverForAPoint(i.x,i.y,r)).filter(i=>!!i).length>6),$t(this,"checkSizeIsVisible",(r,i,o)=>(r>50||o/r<=10)&&(i>50||o/i<=10)),$t(this,"checkSizeOfPartInClient",()=>{const{left:r,right:i,top:o,bottom:a,clientHeight:l,clientWidth:d,clientMin:h}=this._clientSize;let f,m,g,v;if(r<0)f=0;else{if(!(r<d))return!1;f=r}if(i<0)return!1;if(m=i<d?i:d,o<0)g=0;else{if(!(o<l))return!1;g=o}return!(a<0)&&(v=a<l?a:l,this.checkSizeIsVisible(m-f,v-g,h))}),$t(this,"returnHiddenResult",r=>(this._clientSize=null,{visible:!1,reason:r})),$t(this,"checkOneElementVisible",r=>{if(r instanceof HTMLElement){if(this.checkElementIsMountedOnDom(r)){if(this.checkActualCssVisibleIncludeInherit(r)){if(this._clientSize=this.getSizeAboutClient(r),this.checkElementCover(r))return this.returnHiddenResult(I_.COVERED);{const i=this.checkActualSize(),o=this.checkSizeOfPartInClient();return i&&!o?this.returnHiddenResult(I_.POSITION):i?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(I_.SIZE)}}return this.returnHiddenResult(I_.STYLE)}return this.returnHiddenResult(vR.UNMOUNTED)}return this.returnHiddenResult(vR.INVALID_HTML_ELEMENT)}),$t(this,"checkElementIsMountedOnDom",r=>this.checkPropertyUpToAllParentNodes(r,i=>"HTML"!==i.nodeName.toUpperCase()?null!==i.parentElement:!!document.documentElement))}};function R_(r){return(new TextEncoder).encode(r)}const u4=function(r,i){const o=new Uint8Array(r.byteLength+i.byteLength);return o.set(new Uint8Array(r),0),o.set(new Uint8Array(i),r.byteLength),o},ER=function(){var r=L(function*(i){return function(o){let l="";return new Uint8Array(o).forEach(d=>{l+=d.toString(16).padStart(2,"0")}),l}(yield crypto.subtle.digest("SHA-256",R_(i)))});return function(o){return r.apply(this,arguments)}}();class nn{constructor(){$t(this,"_events",{}),$t(this,"addListener",this.on)}getListeners(i){return this._events[i]?this._events[i].map(o=>o.listener):[]}on(i,o){this._events[i]||(this._events[i]=[]);const a=this._events[i];-1===this._indexOfListener(a,o)&&a.push({listener:o,once:!1})}once(i,o){this._events[i]||(this._events[i]=[]);const a=this._events[i];-1===this._indexOfListener(a,o)&&a.push({listener:o,once:!0})}off(i,o){if(!this._events[i])return;const a=this._events[i],l=this._indexOfListener(a,o);-1!==l&&a.splice(l,1),0===this._events[i].length&&delete this._events[i]}removeAllListeners(i){i?delete this._events[i]:this._events={}}emit(i){this._events[i]||(this._events[i]=[]);const o=this._events[i].map(h=>h);for(var a=arguments.length,l=new Array(a>1?a-1:0),d=1;d<a;d++)l[d-1]=arguments[d];for(let h=0;h<o.length;h+=1){const f=o[h];f.once&&this.off(i,f.listener),f.listener.apply(this,l||[])}}safeEmit(i){for(var o=arguments.length,a=new Array(o>1?o-1:0),l=1;l<o;l++)a[l-1]=arguments[l];[...this._events[i]||[]].forEach(d=>{d.once&&this.off(i,d.listener);try{d.listener.apply(this,a)}catch(h){console.error("safeEmit event:".concat(i," error ").concat(h?.toString()))}})}_indexOfListener(i,o){let a=i.length;for(;a--;)if(i[a].listener===o)return a;return-1}}let If=null;function yR(){if(If)return If;if(window.electron)return If=window.electron;if(!window.require)return null;try{return If=window.require("electron"),If}catch{return null}}let Yn=function(r){return r.CREATE_CLIENT="createClient",r.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",r.SET_AREA="setArea",r.PRELOAD="PRELOAD",r.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",r.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",r.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",r.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",r.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",r.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",r.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",r.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",r.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",r.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",r.START_PROXY_SERVER="Client.startProxyServer",r.STOP_PROXY_SERVER="Client.stopProxyServer",r.SET_PROXY_SERVER="Client.setProxyServer",r.SET_TURN_SERVER="Client.setTurnServer",r.SET_CLIENT_ROLE="Client.setClientRole",r.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",r.ENABLE_DUAL_STREAM="Client.enableDualStream",r.DISABLE_DUAL_STREAM="Client.disableDualStream",r.JOIN="Client.join",r.LEAVE="Client.leave",r.PUBLISH="Client.publish",r.UNPUBLISH="Client.unpublish",r.SUBSCRIBE="Client.subscribe",r.MASS_SUBSCRIBE="Client.massSubscribe",r.MASS_UNSUBSCRIBE="Client.massUnsubscribe",r.UNSUBSCRIBE="Client.unsubscribe",r.RENEW_TOKEN="Client.renewToken",r.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",r.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",r.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",r.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",r.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",r.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",r.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",r.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",r.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",r.START_LIVE_STREAMING="Client.startLiveStreaming",r.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",r.STOP_LIVE_STREAMING="Client.stopLiveStreaming",r.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",r.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",r.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",r.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",r.SET_CONFIG_DISTRIBUTE="_configDistribute",r.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",r.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",r.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",r.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",r.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",r.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",r.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",r.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",r.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",r.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",r.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",r.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",r.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",r.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",r.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",r.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",r.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",r.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",r.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",r.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",r.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",r.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",r.STREAM_TYPE_CHANGE="streamTypeChange",r.CONNECTION_STATE_CHANGE="connectionStateChange",r.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",r.IMAGE_MODERATION_UPLOAD="imageModerationUpload",r}({}),st=function(r){return r.TRACER="tracer",r}({});function iL(r){return Ft(r.timeout,"config.timeout",0,1e5),Ft(r.timeoutFactor,"config.timeoutFactor",0,100,!1),Ft(r.maxRetryCount,"config.maxRetryConfig",0,1/0),Ft(r.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let h4=function(r){return r[r.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",r[r.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",r[r.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",r}({}),Rt=function(r){return r.LEAVE="LEAVE",r.NETWORK_ERROR="NETWORK_ERROR",r.SERVER_ERROR="SERVER_ERROR",r.UID_BANNED="UID_BANNED",r.FALLBACK="FALLBACK",r.IP_BANNED="IP_BANNED",r.CHANNEL_BANNED="CHANNEL_BANNED",r.LICENSE_MISSING="LICENSE_MISSING",r.LICENSE_EXPIRED="LICENSE_EXPIRED",r.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",r.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",r.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",r.LICENSE_ILLEGAL="LICENSE_ILLEGAL",r.TOKEN_EXPIRE="TOKEN_EXPIRE",r}({});function pS(r){if(!Array.isArray(r)||r.length<1)return!1;try{r.forEach(i=>{if(!i.urls)throw Error()})}catch{return!1}return!0}function bR(r){return Nr(r.turnServerURL,"turnServerURL"),Nr(r.username,"username"),Nr(r.password,"password"),r.udpport&&Ft(r.udpport,"udpport",1,99999,!0),r.forceturn&&fl(r.forceturn,"forceturn"),r.security&&fl(r.security,"security"),r.tcpport&&Ft(r.tcpport,"tcpport",1,99999,!0),!0}function p4(r){return void 0!==r.level&&pr(r.level,"level",[1,2,3]),void 0!==r.delay&&Ft(r.delay,"delay",0,3e3,!0),!0}let Je=function(r){return r.CONNECTION_STATE_CHANGE="connection-state-change",r.MEDIA_RECONNECT_START="media-reconnect-start",r.MEDIA_RECONNECT_END="media-reconnect-end",r.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",r.USER_JOINED="user-joined",r.USER_LEAVED="user-left",r.USER_PUBLISHED="user-published",r.USER_UNPUBLISHED="user-unpublished",r.USER_INFO_UPDATED="user-info-updated",r.CLIENT_BANNED="client-banned",r.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",r.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",r.VOLUME_INDICATOR="volume-indicator",r.CRYPT_ERROR="crypt-error",r.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",r.NETWORK_QUALITY="network-quality",r.STREAM_TYPE_CHANGED="stream-type-changed",r.STREAM_FALLBACK="stream-fallback",r.RECEIVE_METADATA="receive-metadata",r.STREAM_MESSAGE="stream-message",r.LIVE_STREAMING_ERROR="live-streaming-error",r.LIVE_STREAMING_WARNING="live-streaming-warning",r.EXCEPTION="exception",r.ERROR="error",r.P2P_LOST="p2p_lost",r.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",r.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",r.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",r.PUBLISHED_USER_LIST="published-user-list",r.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",r.CONTENT_INSPECT_ERROR="content-inspect-error",r.CONTENT_INSPECT_RESULT="content-inspect-result",r.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",r}({}),Hr=function(r){return r.NETWORK_ERROR="NETWORK_ERROR",r.SERVER_ERROR="SERVER_ERROR",r.MULTI_IP="MULTI_IP",r.TIMEOUT="TIMEOUT",r.OFFLINE="OFFLINE",r.LEAVE="LEAVE",r.P2P_FAILED="P2P_FAILED",r.FALLBACK="FALLBACK",r}({}),so=function(r){return r.ONLINE="ONLINE",r.OFFLINE="OFFLINE",r}({}),gl=function(r){return r.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",r.ONLINE="ONLINE",r.OFFLINE="OFFLINE",r}({});function Gr(r,i){for(var o=arguments.length,a=new Array(o>2?o-2:0),l=2;l<o;l++)a[l-2]=arguments[l];return 0===r.getListeners(i).length?le.reject(new Y(k.UNEXPECTED_ERROR,"can not emit promise")):new le((d,h)=>{r.emit(i,...a,d,h)})}function Bt(r,i){if(0===r.getListeners(i).length)return le.resolve();for(var o=arguments.length,a=new Array(o>2?o-2:0),l=2;l<o;l++)a[l-2]=arguments[l];return Gr(r,i,...a)}function Ao(r,i){if(0===r.getListeners(i).length)return null;for(var o=arguments.length,a=new Array(o>2?o-2:0),l=2;l<o;l++)a[l-2]=arguments[l];return A_(r,i,...a)}function A_(r,i){let o=null,a=null;for(var l=arguments.length,d=new Array(l>2?l-2:0),h=2;h<l;h++)d[h-2]=arguments[h];if(r.emit(i,...d,f=>{o=f},f=>{a=f}),null!==a)throw a;if(null===o)throw new Y(k.UNEXPECTED_ERROR,"handler is not sync");return o}const Se=new class extends nn{set networkState(r){this.emit(gl.NETWORK_STATE_CHANGE,r,this._networkState),r===so.ONLINE?this.emit(gl.ONLINE):r===so.OFFLINE&&(this.onlineWaiter=new le(i=>{this.once(gl.ONLINE,()=>{this.onlineWaiter=void 0,i(so.ONLINE)})}),this.emit(gl.OFFLINE)),this._networkState=r}get networkState(){return this._networkState}get isOnline(){return this._networkState===so.ONLINE}constructor(){super(),$t(this,"_moduleName","network-indicator"),$t(this,"_networkState",so.ONLINE),$t(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=so.ONLINE}),window.addEventListener("offline",()=>{this.networkState=so.OFFLINE})}};function Be(r,i){const o=r.indexOf(i);-1!==o&&r.splice(o,1)}function At(r){const i=[];return r.forEach(o=>{-1===i.indexOf(o)&&i.push(o)}),i}function D_(r){void 0!==le?le.resolve().then(r):setTimeout(r,0)}function Vn(r){return JSON.parse(JSON.stringify(r))}function ph(r){try{return Vn(r)}catch{return r}}const oL={};function yc(r,i){oL[i]||(oL[i]=!0,r())}function _l(r){const i=window.atob(r),o=new Uint8Array(new ArrayBuffer(i.length));for(let a=0;a<i.length;a+=1)o[a]=i.charCodeAt(a);return o}function vl(r){let i="";for(let o=0;o<r.length;o+=1)i+=String.fromCharCode(r[o]);return window.btoa(i)}function SR(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,o=(new TextEncoder).encode(r);if(o.length>i)o=o.slice(0,i);else if(o.length<i){const a=new Uint8Array(i);a.set(o),o=a}return o}function sL(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];const a=Ue(i).call(i,(h,f)=>h+f.length,0),l=new Uint8Array(new ArrayBuffer(a));let d=0;return i.forEach(h=>{l.set(h,d),d+=h.length}),l}function bc(r){return window.TextEncoder?(new TextEncoder).encode(r).length:r.length}function Sc(r){let i=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&r.realFormData&&(r=r.realFormData),r.forEach(o=>{i+="string"==typeof o?bc(o):o.size}),i+138}function O_(r){const i=new Y(k.TIMEOUT,"timeout");return new le((o,a)=>{window.setTimeout(()=>a(i),r)})}function wr(r){return new le(i=>{window.setTimeout(i,r)})}function Ct(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,i=arguments.length>1?arguments[1]:void 0;const o=Math.random().toString(16).substr(2,r).toLowerCase();return o.length===r?"".concat(i).concat(o):"".concat(i).concat(o)+Ct(r-o.length,"")}function Rf(){return Ct(32,"").toUpperCase()}const fS=()=>{},fh=new class{constructor(){$t(this,"fnMap",new Map)}throttleByKey(r,i,o,a){for(var l=arguments.length,d=new Array(l>4?l-4:0),h=4;h<l;h++)d[h-4]=arguments[h];if(this.fnMap.has(i)){const f=this.fnMap.get(i);if(f.threshold!==o){f.fn(...f.args),clearTimeout(f.timer);const m=window.setTimeout(()=>{const g=this.fnMap.get(i);g&&g.fn(...g.args),this.fnMap.delete(i)},o);this.fnMap.set(i,{fn:r,threshold:o,timer:m,args:d,skipFn:a})}else f.skipFn&&f.skipFn(...f.args),this.fnMap.set(i,Ee(Ee({},f),{},{fn:r,args:d,skipFn:a}))}else{const f=window.setTimeout(()=>{const m=this.fnMap.get(i);m&&m.fn(...m.args),this.fnMap.delete(i)},o);this.fnMap.set(i,{fn:r,threshold:o,timer:f,args:d,skipFn:a})}}},f4=fh.throttleByKey.bind(fh);function ao(r){return"object"==typeof r&&null!==r&&!(r instanceof RegExp)}function aL(r,i){if(!ao(r)||!ao(i)||Array.isArray(r)&&!Array.isArray(i)||!Array.isArray(r)&&Array.isArray(i))return i;if(Array.isArray(i)&&Array.isArray(r)){const o=[...r];for(let a=0;a<i.length;a++)o[a]=aL(r[a],i[a]);return o}{const o=Ee({},r);for(const a in i)Object.prototype.hasOwnProperty.call(i,a)&&(o[a]=Object.prototype.hasOwnProperty.call(r,a)?aL(r[a],i[a]):i[a]);return o}}function CR(r,i){let o=[0];if(i&&(o=new Array(i).fill(0)),0===r)return o;let a=0;for(;r>0&&(o[a]=255&r,r>>=8,a++,!i||a!==i););return o}function mS(r){return"number"==typeof r?r:r.exact||r.ideal||r.max||r.min||0}function m4(r){const i="0123456789abcdef";function o(x){let j,W="";for(j=0;j<=3;j++)W+=i.charAt(x>>8*j+4&15)+i.charAt(x>>8*j&15);return W}function a(x,j){const W=(65535&x)+(65535&j);return(x>>16)+(j>>16)+(W>>16)<<16|65535&W}function l(x,j,W,q,te,J){return a((X=a(a(j,x),a(q,J)))<<(Ce=te)|X>>>32-Ce,W);var X,Ce}function d(x,j,W,q,te,J,X){return l(j&W|~j&q,x,j,te,J,X)}function h(x,j,W,q,te,J,X){return l(j&q|W&~q,x,j,te,J,X)}function f(x,j,W,q,te,J,X){return l(j^W^q,x,j,te,J,X)}function m(x,j,W,q,te,J,X){return l(W^(j|~q),x,j,te,J,X)}const g=function(x){let j;const W=1+(x.length+8>>6),q=new Array(16*W);for(j=0;j<16*W;j++)q[j]=0;for(j=0;j<x.length;j++)q[j>>2]|=x.charCodeAt(j)<<j%4*8;return q[j>>2]|=128<<j%4*8,q[16*W-2]=8*x.length,q}(r);let v,y,b,C,P,R=1732584193,A=-271733879,O=-1732584194,M=271733878;for(v=0;v<g.length;v+=16)y=R,b=A,C=O,P=M,R=d(R,A,O,M,g[v+0],7,-680876936),M=d(M,R,A,O,g[v+1],12,-389564586),O=d(O,M,R,A,g[v+2],17,606105819),A=d(A,O,M,R,g[v+3],22,-1044525330),R=d(R,A,O,M,g[v+4],7,-176418897),M=d(M,R,A,O,g[v+5],12,1200080426),O=d(O,M,R,A,g[v+6],17,-1473231341),A=d(A,O,M,R,g[v+7],22,-45705983),R=d(R,A,O,M,g[v+8],7,1770035416),M=d(M,R,A,O,g[v+9],12,-1958414417),O=d(O,M,R,A,g[v+10],17,-42063),A=d(A,O,M,R,g[v+11],22,-1990404162),R=d(R,A,O,M,g[v+12],7,1804603682),M=d(M,R,A,O,g[v+13],12,-40341101),O=d(O,M,R,A,g[v+14],17,-1502002290),A=d(A,O,M,R,g[v+15],22,1236535329),R=h(R,A,O,M,g[v+1],5,-165796510),M=h(M,R,A,O,g[v+6],9,-1069501632),O=h(O,M,R,A,g[v+11],14,643717713),A=h(A,O,M,R,g[v+0],20,-373897302),R=h(R,A,O,M,g[v+5],5,-701558691),M=h(M,R,A,O,g[v+10],9,38016083),O=h(O,M,R,A,g[v+15],14,-660478335),A=h(A,O,M,R,g[v+4],20,-405537848),R=h(R,A,O,M,g[v+9],5,568446438),M=h(M,R,A,O,g[v+14],9,-1019803690),O=h(O,M,R,A,g[v+3],14,-187363961),A=h(A,O,M,R,g[v+8],20,1163531501),R=h(R,A,O,M,g[v+13],5,-1444681467),M=h(M,R,A,O,g[v+2],9,-51403784),O=h(O,M,R,A,g[v+7],14,1735328473),A=h(A,O,M,R,g[v+12],20,-1926607734),R=f(R,A,O,M,g[v+5],4,-378558),M=f(M,R,A,O,g[v+8],11,-2022574463),O=f(O,M,R,A,g[v+11],16,1839030562),A=f(A,O,M,R,g[v+14],23,-35309556),R=f(R,A,O,M,g[v+1],4,-1530992060),M=f(M,R,A,O,g[v+4],11,1272893353),O=f(O,M,R,A,g[v+7],16,-155497632),A=f(A,O,M,R,g[v+10],23,-1094730640),R=f(R,A,O,M,g[v+13],4,681279174),M=f(M,R,A,O,g[v+0],11,-358537222),O=f(O,M,R,A,g[v+3],16,-722521979),A=f(A,O,M,R,g[v+6],23,76029189),R=f(R,A,O,M,g[v+9],4,-640364487),M=f(M,R,A,O,g[v+12],11,-421815835),O=f(O,M,R,A,g[v+15],16,530742520),A=f(A,O,M,R,g[v+2],23,-995338651),R=m(R,A,O,M,g[v+0],6,-198630844),M=m(M,R,A,O,g[v+7],10,1126891415),O=m(O,M,R,A,g[v+14],15,-1416354905),A=m(A,O,M,R,g[v+5],21,-57434055),R=m(R,A,O,M,g[v+12],6,1700485571),M=m(M,R,A,O,g[v+3],10,-1894986606),O=m(O,M,R,A,g[v+10],15,-1051523),A=m(A,O,M,R,g[v+1],21,-2054922799),R=m(R,A,O,M,g[v+8],6,1873313359),M=m(M,R,A,O,g[v+15],10,-30611744),O=m(O,M,R,A,g[v+6],15,-1560198380),A=m(A,O,M,R,g[v+13],21,1309151649),R=m(R,A,O,M,g[v+4],6,-145523070),M=m(M,R,A,O,g[v+11],10,-1120210379),O=m(O,M,R,A,g[v+2],15,718787259),A=m(A,O,M,R,g[v+9],21,-343485551),R=a(R,y),A=a(A,b),O=a(O,C),M=a(M,P);return o(R)+o(A)+o(O)+o(M)}let fr=1,cL=console,Qr=class{static setLogger(r){cL=r}constructor(r,i){$t(this,"id",void 0),$t(this,"lockingPromise",le.resolve()),$t(this,"locks",0),$t(this,"name",""),$t(this,"lockId",void 0),this.lockId=fr++,r&&(this.name=r),i&&(this.id=i),this.logger("created")}logger(r,i){const o=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),a="created"===r?"is ".concat(r,"."):"is ".concat(r,", current queue ").concat(this.locks,". ").concat(i??"");cL.debug("".concat(o," ").concat(a))}setId(r){this.id=r}get isLocked(){return this.locks>0}lock(r){let i;this.locks+=1,this.logger("locked",r);const o=new le(l=>{i=()=>{this.locks-=1,this.logger("unlocked",r),l()}}),a=this.lockingPromise.then(()=>i);return this.lockingPromise=this.lockingPromise.then(()=>o),a}};function Af(r,i){return function(o,a,l){const d=l.value;if("function"!=typeof d)throw new Error("Cannot use mutex on object property.");return l.value=L(function*(){const h=this[i];if(!h)throw new Error("mutex property key ".concat(i," doesn't exist on ").concat(r));const f=yield h.lock("From ".concat(r,".").concat(a));try{for(var m=arguments.length,g=new Array(m),v=0;v<m;v++)g[v]=arguments[v];return yield d.apply(this,g)}finally{f()}}),l}}const Nn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function TR(r,i){const o=Math.floor(i.timeout*Math.pow(i.timeoutFactor,r));return Math.min(i.maxRetryTimeout,o)}function rs(r,i,o,a){const l=Object.assign({},Nn,a);let d=l.timeout;const h=function(){var g=L(function*(){var v;yield(v=d,new le(y=>{window.setTimeout(y,v)})),d*=l.timeoutFactor,d=Math.min(l.maxRetryTimeout,d)});return function(){return g.apply(this,arguments)}}();let f=!1;const m=new le(function(){var g=L(function*(v,y){i=i||(()=>!1),o=o||(()=>!0);for(let b=0;b<l.maxRetryCount;b+=1){if(f)return y(new Y(k.OPERATION_ABORTED));try{const C=yield r();if(!i(C,b)||b+1===l.maxRetryCount)return v(C);yield h()}catch(C){if(!o(C,b)||b+1===l.maxRetryCount)return y(C);yield h()}}});return function(v,y){return g.apply(this,arguments)}}());return m.cancel=()=>f=!0,m}class N_{constructor(i){$t(this,"input",[]),$t(this,"size",void 0),this.size=i}add(i){this.input.push(i),this.input.length>this.size&&this.input.splice(0,1)}mean(){var i;return 0===this.input.length?0:Ue(i=this.input).call(i,(o,a)=>o+a)/this.input.length}}let Hi,P_=0,wR=0;function IR(r,i,o,a){return new le((l,d)=>{i.responseType=i.responseType||"json",i.data&&!o?(i.data=JSON.stringify(i.data),P_+=bc(i.data)):o&&(i.data.size?P_+=i.data.size:i.data instanceof FormData?P_+=Sc(i.data):P_+=bc(JSON.stringify(i.data))),i.headers=i.headers||{},i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json",i.method="POST",i.url=r,Oi.request(i).then(h=>{"string"==typeof h.data?wR+=bc(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?wR+=h.data.byteLength:wR+=bc(JSON.stringify(h.data)),a&&l({data:h.data,headers:h.headers}),l(h.data)}).catch(h=>{Oi.isCancel(h)?d(new Y(k.OPERATION_ABORTED,"cancel token canceled")):d("ECONNABORTED"===h.code?new Y(k.NETWORK_TIMEOUT,h.message):h.response?new Y(k.NETWORK_RESPONSE_ERROR,h.response.status):new Y(k.NETWORK_ERROR,h.message))})})}function M_(r,i){return mh.apply(this,arguments)}function mh(){return mh=L(function*(r,i){const o=new Blob([i.data],{type:"buffer"});return yield IR(r,Ee(Ee({},i),{},{data:o,headers:{"Content-Type":"application/octet-stream"}}),!0)}),mh.apply(this,arguments)}const lL=()=>void 0!==window.isSecureContext,Ss=function(r){if(r.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return r;const i=r.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(i&&i[1]&&i[2]){const a=i[2];return"".concat(i[1],".").concat(a)}return"4.0.0.999"}("4.22.2"),gS=function(){try{return!0===JSON.parse("true")}catch{return!0}}();let Oa=function(r){return r.Default="default",r.Auto="auto",r.Relay="relay",r.SdRtn="sd-rtn",r}({});const Wr=function(){const r="us".concat("erna","me"),i="pa".concat("sswo","rd"),o=["t","s","t"];o.splice(1,0,"e");const a=o.join(""),l=[];for(let f=0;f<6;f++)l.push("1");const d=l.join(""),h={};return h[r]=a,h[i]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Wr;const RR={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},AR="v4.22.2-0-g4caa29bb(10/28/2024, 2:37:34 PM)",Pn=Ee(Ee({PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:RR,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0,DISABLE_SCREEN_SHARE_REMB:!1},{ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_DATASTREAM_2:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,ENABLE_PREALLOC_PC:!1,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_PRE_SUB:!1,ENABLE_AUT_FEEDBACK:!1}),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"]});function kt(r,i,o){var a,l,d;he(a=Object.keys(Pn)).call(a,r)&&(!o&&he(l=Object.keys(Od)).call(l,r)||(Pn[r]=i,"ENABLE_VIDEO_SEI"===r&&!0===i&&(Pn.ENABLE_ENCODED_TRANSFORM=!0),"USE_NEW_NETWORK_CONFIG"===r&&i&&(Pn.USE_NEW_NETWORK_CONFIG=d=!!i,d&&(Pn.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Pn.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Pn.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Pn.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Pn.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Pn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Pn.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),"ENABLE_PRE_SUB"===r&&i&&(Pn.ENABLE_INSTANT_VIDEO=!0,Pn.ENABLE_PREALLOC_PC=!0),"ENABLE_SVC"===r&&i&&(Pn.ENABLE_AUT_CC=!0)))}function B(r){return Pn[r]}gS||(Pn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Pn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Pn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Pn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Pn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Pn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Pn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Pn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Pn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Pn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Pn.AREAS=["NORTH_AMERICA","OVERSEA"]);const Od={};var Ke=function(r){return r.SET_SESSION_ID="SET_SESSION_ID",r.SET_P2P_ID="SET_P2P_id",r.SET_DC_ID="SET_DC_id",r.SET_UID="SET_UID",r.SET_INT_UID="SET_INT_UID",r.SET_PUB_ID="SET_PUB_ID",r.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",r.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",r.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",r.AVOID_JOIN_START="AVOID_JOIN_START",r.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",r.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",r.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",r.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",r.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",r.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",r.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",r.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",r.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",r.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",r.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",r.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",r.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",r.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",r.RESET_KEY_METRICS="RESET_KEY_METRICS",r.SET_USE_P2P="SET_USE_P2P",r.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",r}(Ke||{});class g4{constructor(i,o,a,l){$t(this,"state",void 0),this.state={codec:i,audioCodec:o,mode:a,clientId:l,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Oa.Default}}dispatch(i){this.state=function(o,a){switch(a.type){case Ke.SET_SESSION_ID:return Ee(Ee({},o),{},{sessionId:a.sessionId});case Ke.SET_P2P_ID:return Ee(Ee({},o),{},{p2pId:a.p2pId});case Ke.SET_UID:return Ee(Ee({},o),{},{uid:a.uid});case Ke.SET_INT_UID:return Ee(Ee({},o),{},{intUid:a.intUid});case Ke.SET_PUB_ID:return Ee(Ee({},o),{},{pubId:a.pubId});case Ke.KEY_METRIC_CLIENT_CREATED:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{clientCreated:a.metric})});case Ke.KEY_METRIC_JOIN_START:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{joinStart:a.metric})});case Ke.AVOID_JOIN_START:return Ee(Ee({},o),{},{avoidJoinStart:a.avoidJoinStart});case Ke.KEY_METRIC_JOIN_END:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{joinEnd:a.metric})});case Ke.KEY_METRIC_REQUEST_AP_START:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{requestAPStart:a.metric})});case Ke.KEY_METRIC_REQUEST_AP_END:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{requestAPEnd:a.metric})});case Ke.KEY_METRIC_JOIN_GATEWAY_START:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{joinGatewayStart:a.metric})});case Ke.KEY_METRIC_JOIN_GATEWAY_END:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{joinGatewayEnd:a.metric})});case Ke.KEY_METRIC_PEER_CONNECTION_START:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{peerConnectionStart:a.metric})});case Ke.KEY_METRIC_PEER_CONNECTION_END:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{peerConnectionEnd:a.metric})});case Ke.KEY_METRIC_DESCRIPTION_START:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{descriptionStart:a.metric})});case Ke.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{signalChannelOpen:a.metric})});case Ke.KEY_METRIC_ICE_CONNECTION_END:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{iceConnectionEnd:a.metric})});case Ke.KEY_METRIC_PUBLISH:{const l=o.keyMetrics.publish,d=l.findIndex(h=>h.trackId===a.metric.trackId);return-1!==d?(l[d]=Ee(Ee({},l[d]),a.metric),Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{publish:[...l]})})):Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{publish:[...o.keyMetrics.publish,a.metric]})})}case Ke.KEY_METRIC_SUBSCRIBE:{const l=o.keyMetrics.subscribe,d=l.findIndex(h=>h.userId===a.metric.userId&&h.type===a.metric.type);return-1!==d?(l[d]=Ee(Ee({},l[d]),a.metric),Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{subscribe:[...l]})})):Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{subscribe:[...o.keyMetrics.subscribe,a.metric]})})}case Ke.SET_CLOUD_PROXY_SERVER_MODE:return o.cloudProxyServerMode=a.mode,o;case Ke.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof a.index?o.joinChannelServiceRecords=[...o.joinChannelServiceRecords,a.record]:(o.joinChannelServiceRecords[a.index]=Ee(Ee({},o.joinChannelServiceRecords[a.index]),a.record),o.joinChannelServiceRecords=[...o.joinChannelServiceRecords]),o;case Ke.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return o.joinChannelServiceRecords=[],o;case Ke.RESET_KEY_METRICS:return o.keyMetrics={publish:[],subscribe:[]},o;case Ke.SET_USE_P2P:return Ee(Ee({},o),{},{useP2P:a.val});case Ke.SET_TRANSPORT_TYPE:return Ee(Ee({},o),{},{p2pTransport:a.val});default:return o}}(this.state,i)}set sessionId(i){this.dispatch({type:Ke.SET_SESSION_ID,sessionId:i})}get sessionId(){return this.state.sessionId}set codec(i){this.state.codec=i}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(i){this.dispatch({type:Ke.SET_P2P_ID,p2pId:i})}get p2pId(){return this.state.p2pId}set dcId(i){this.dispatch({type:Ke.SET_DC_ID,dcId:i})}get dcId(){return this.state.dcId}set uid(i){this.dispatch({type:Ke.SET_UID,uid:i})}get uid(){return this.state.uid}set intUid(i){this.dispatch({type:Ke.SET_INT_UID,intUid:i})}get intUid(){return this.state.intUid}set pubId(i){this.dispatch({type:Ke.SET_PUB_ID,pubId:i})}get pubId(){return this.state.pubId}set cloudProxyServerMode(i){this.dispatch({type:Ke.SET_CLOUD_PROXY_SERVER_MODE,mode:i})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(i){this.dispatch({type:Ke.SET_USE_P2P,val:i})}get useP2P(){return this.state.useP2P}set p2pTransport(i){this.dispatch({type:Ke.SET_TRANSPORT_TYPE,val:i})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:Ke.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Ke.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Ke.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Ke.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Ke.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Ke.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Ke.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Ke.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Ke.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Ke.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Ke.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Ke.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(i,o,a,l){this.dispatch({type:Ke.KEY_METRIC_PUBLISH,metric:Ee(Ee({trackId:i,type:o},a&&{publishStart:a}),l&&{publishEnd:l})})}subscribe(i,o,a,l,d,h,f){this.dispatch({type:Ke.KEY_METRIC_SUBSCRIBE,metric:Ee(Ee(Ee(Ee(Ee({userId:i,type:o},a&&{subscribeStart:a}),l&&{subscribeEnd:l}),d&&{firstFrame:d}),h&&{streamAdded:h}),f&&{firstDecoded:f})})}massSubscribe(i,o,a,l){i.forEach(d=>{this.dispatch({type:Ke.KEY_METRIC_SUBSCRIBE,metric:Ee(Ee(Ee({userId:d.userId,type:d.type},o&&{subscribeStart:o}),a&&{subscribeEnd:a}),l&&{firstFrame:l})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(i,o){"gateway"===i.service&&Array.isArray(i.urls)&&(i.urls=i.urls.map(a=>a.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return"number"!=typeof o?(this.dispatch({type:Ke.RECORD_JOIN_CHANNEL_SERVICE,record:Ee(Ee({},i),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(o<0||o>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Ke.RECORD_JOIN_CHANNEL_SERVICE,record:i,index:o}),o)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Ke.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Ke.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(i){this.dispatch({type:Ke.AVOID_JOIN_START,avoidJoinStart:i})}}let DR=function(r){return r.h264="h264",r.h265="h265",r.vp8="vp8",r.vp9="vp9",r.av1="av1",r}({});!function(r){r.opus="opus",r.pcma="pcma",r.pcmu="pcmu",r.g722="g722"}({});let _S=0;function bn(r,i,o){return(i="symbol"==typeof(l=function(d){if("object"!=typeof d||!d)return d;var f=d[Symbol.toPrimitive];if(void 0!==f){var m=f.call(d,"string");if("object"!=typeof m)return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(i))?l:l+"")in r?Object.defineProperty(r,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[i]=o,r;var l}function dL(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function je(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?dL(Object(o),!0).forEach(function(a){bn(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):dL(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}const Df=new class extends nn{constructor(){super(...arguments),bn(this,"currentUploadLogID",0)}reportLogUploadError(r){const{errorRange:i}=r;i[i.length-1]&&i[i.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=i[i.length-1],this.emit("REPORT_LOG_UPLOAD",r))}};class E4{constructor(i){bn(this,"logger",void 0),bn(this,"prefixLists",[]),this.logger=i}debug(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];this.logger.debug(...this.prefixLists,...o)}info(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];this.logger.info(...this.prefixLists,...o)}warning(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];this.logger.warning(...this.prefixLists,...o)}error(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];this.logger.error(...this.prefixLists,...o)}prefix(i){return this.prefixLists.push(i),this}popPrefix(){return this.prefixLists.pop(),this}}function OR(){const r=new Date;return r.toTimeString().split(" ")[0]+":"+r.getMilliseconds()}function uL(){const r=new Date,i=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return i?i?.[0]+":"+r.getUTCMilliseconds():r.toTimeString().split(" ")[0]+":"+r.getMilliseconds()}const Cs={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},NR=Date.now(),k_=r=>{for(const i in Cs)if(Object.prototype.hasOwnProperty.call(Cs,i)&&Cs[i]===r)return i;return"DEFAULT"},T=new class{constructor(){bn(this,"proxyServerURL",void 0),bn(this,"logLevel",Cs.DEBUG),bn(this,"uploadState","collecting"),bn(this,"uploadLogWaitingList",[]),bn(this,"uploadLogUploadingList",[]),bn(this,"uploadErrorCount",0),bn(this,"currentLogID",0),bn(this,"url",void 0),bn(this,"extLog",(r,i)=>{this.appendLogToWaitingList(r,...i)})}debug(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];const a=[Cs.DEBUG].concat(i);this.log.apply(this,a)}info(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];const a=[Cs.INFO].concat(i);this.log.apply(this,a)}warning(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];const a=[Cs.WARNING].concat(i);this.log.apply(this,a)}warn(){this.warning(...arguments)}error(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];const a=[Cs.ERROR].concat(i);this.log.apply(this,a)}upload(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];const a=[Cs.DEBUG].concat(i);this.uploadLog.apply(this,a)}setLogLevel(r){r=Math.min(Math.max(0,r),4),this.logLevel=r}enableLogUpload(){kt("UPLOAD_LOG",!0)}disableLogUpload(){kt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(r){this.proxyServerURL=r}prefix(r){return new E4(this).prefix(r)}log(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];if(Date.now()-NR<100)return void setTimeout(()=>{this.log(...i)},Date.now()-NR);const a=Math.max(0,Math.min(4,i[0]));if(i[0]=OR()+" Agora-SDK [".concat(k_(a),"]:"),this.appendLogToWaitingList(a,...i),a<this.logLevel)return;const l=OR()+" %cAgora-SDK [".concat(k_(a),"]:");let d=[];if(!B("USE_NEW_LOG"))switch(a){case Cs.DEBUG:d=[l,"color: #64B5F6;"].concat(i.slice(1)),console.log.apply(console,d);break;case Cs.INFO:d=[l,"color: #1E88E5; font-weight: bold;"].concat(i.slice(1)),console.log.apply(console,d);break;case Cs.WARNING:d=[l,"color: #FB8C00; font-weight: bold;"].concat(i.slice(1)),console.warn.apply(console,d);break;case Cs.ERROR:d=[l,"color: #B00020; font-weight: bold;"].concat(i.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];if(Date.now()-NR<100)return void setTimeout(()=>{this.uploadLog(...i)},Date.now()-NR);const a=Math.max(0,Math.min(4,i[0]));i[0]=OR()+" Agora-SDK [".concat(k_(a),"]:"),this.appendLogToWaitingList(a,...i)}appendLogToWaitingList(r){if(!B("UPLOAD_LOG"))return;for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];Array.isArray(o[0])?o[0][0]=uL()+" Agora-SDK [".concat(k_(r),"]:"):o[0]=uL()+" Agora-SDK [".concat(k_(r),"]:");let l="";o.forEach(d=>{"object"==typeof d&&(d=JSON.stringify(d)),l+="".concat(d," ")}),this.uploadLogWaitingList.push({payload_str:l,log_level:r,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}uploadLogs(){var r=this;return L(function*(){const i=r.uploadLogUploadingList,o={sdk_version:Ss,process_id:B("PROCESS_ID"),payload:JSON.stringify(i)};return rs(L(function*(){const a=yield Oi.post(r.url||(r.proxyServerURL?"https://".concat(r.proxyServerURL,"/ls/?h=").concat(B("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(B("LOG_UPLOAD_SERVER"),"/upload/v1")),o,{responseType:"text"});if("OK"!==a.data){const l=new Error("unexpected upload log response");throw l.response=a,l}}),()=>(r.uploadLogUploadingList=[],!1),a=>{const l={status:-1,message:a.message,errorRange:i.map(d=>d.log_item_id)};return a.response?(l.status=a.response.status,l.data=a.response.data,l.headers=a.response.headers):a.request&&(l.status=a.request.status),Df.reportLogUploadError(l),!0},{timeout:B("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:B("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})})()}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,B("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),B("UPLOAD_LOG_INTERVAL"))}).catch(r=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),B("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),B("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var hL;function y4(r){return Nr(r.reportId,"params.reportId",0,100,!1),Nr(r.category,"params.category",0,100,!1),Nr(r.event,"params.event",0,100,!1),Nr(r.label,"params.label",0,100,!1),Ft(r.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(hL={}).FREE="free",hL.UPLOADING="uploading",function(r){r[r.MISC=0]="MISC",r[r.INTERNAL_EVENT=1]="INTERNAL_EVENT",r[r.PUBLIC_EVENT=2]="PUBLIC_EVENT",r[r.WEB_EVENT=3]="WEB_EVENT",r[r.INTERNAL_API=4]="INTERNAL_API",r[r.WEB_API=5]="WEB_API",r[r.PUBLIC_API=6]="PUBLIC_API"}({});const L_={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Pr=function(r){return r.PUBLISH="publish",r.SUBSCRIBE="subscribe",r.WS_COMPRESSOR_INIT="ws_compressor_init",r.SESSION_INIT="session_init",r.JOIN_CHOOSE_SERVER="join_choose_server",r.REQ_USER_ACCOUNT="req_user_account",r.JOIN_GATEWAY="join_gateway",r.REJOIN_GATEWAY="rejoin_gateway",r.STREAM_SWITCH="stream_switch",r.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",r.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",r.FIRST_VIDEO_RECEIVED="first_video_received",r.FIRST_AUDIO_RECEIVED="first_audio_received",r.FIRST_VIDEO_DECODE="first_video_decode",r.FIRST_AUDIO_DECODE="first_audio_decode",r.ON_ADD_AUDIO_STREAM="on_add_audio_stream",r.ON_ADD_VIDEO_STREAM="on_add_video_stream",r.ON_UPDATE_STREAM="on_update_stream",r.ON_REMOVE_STREAM="on_remove_stream",r.USER_ANALYTICS="req_user_analytics",r.PC_STATS="pc_stats",r.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",r}({}),sn=function(r){return r.SESSION="io.agora.pb.Wrtc.Session",r.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",r.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",r.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",r.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",r.PUBLISH="io.agora.pb.Wrtc.Publish",r.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",r.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",r.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",r.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",r.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",r.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",r.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",r.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",r.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",r.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",r.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",r.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",r.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",r.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",r.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",r.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",r.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",r.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",r.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",r.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",r.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",r.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",r.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",r.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",r.PC_STATS="io.agora.pb.Wrtc.PCStats",r.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",r}({});!function(r){r[r.WORKER_EVENT=156]="WORKER_EVENT",r[r.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}({});let pL=function(r){return r[r.SESSION=26]="SESSION",r[r.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",r[r.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",r[r.JOIN_GATEWAY=28]="JOIN_GATEWAY",r[r.PUBLISH=30]="PUBLISH",r[r.SUBSCRIBE=29]="SUBSCRIBE",r[r.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",r[r.STREAM_SWITCH=32]="STREAM_SWITCH",r[r.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",r[r.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",r[r.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",r[r.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",r[r.API_INVOKE=41]="API_INVOKE",r[r.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",r[r.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",r[r.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",r[r.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",r[r.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",r[r.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",r[r.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",r[r.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",r[r.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",r[r.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",r[r.WORKER_EVENT=156]="WORKER_EVENT",r[r.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",r[r.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",r[r.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",r[r.USER_ANALYTICS=1e4]="USER_ANALYTICS",r[r.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",r}({});function Ae(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(i,o,a){const l=a.value;if("function"==typeof l){const d=r.className||i.__className__||("AgoraRTCClient"===i.constructor.name?"Client":i.constructor.name);a.value=function(){for(var h,f=arguments.length,m=new Array(f),g=0;g<f;g++)m[g]=arguments[g];let v=m;if(r.argsMap)try{v=r.argsMap(this,...m)}catch(b){T.warning(b),v=[]}try{JSON.stringify(v)}catch{T.warning("arguments for method ".concat(d,".").concat(String(o)," not serializable for apiInvoke.")),v=[]}const y=(r.report||be).reportApiInvoke(this._sessionId||null,{id:this._clientId||(null===(h=this.store)||void 0===h?void 0:h.clientId)||this._ID,name:"".concat(d,".").concat(String(o)),options:v,tag:st.TRACER,reportResult:r.reportResult},r.throttleTime);try{const b=l.apply(this,m);return b instanceof le?b.then(C=>(y.onSuccess(r.reportResult&&C),C)).catch(C=>{throw y.onError(C),C}):(y.onSuccess(r.reportResult&&b),b)}catch(b){throw y.onError(b),b}}}return a}}const be=new class{constructor(){var r=this;bn(this,"baseInfoMap",new Map),bn(this,"proxyServer",void 0),bn(this,"eventUploadTimer",void 0),bn(this,"setSessionIdTimer",void 0),bn(this,"url",void 0),bn(this,"sids",new Set),bn(this,"backupUrl",void 0),bn(this,"_appId",void 0),bn(this,"keyEventUploadPendingItems",[]),bn(this,"normalEventUploadPendingItems",[]),bn(this,"apiInvokeUploadPendingItems",[]),bn(this,"apiInvokeCount",0),bn(this,"apiInvokeLoggedCount",0),bn(this,"ltsList",[]),bn(this,"lastSendNormalEventTime",Date.now()),bn(this,"customReportCounterTimer",void 0),bn(this,"customReportCount",0),bn(this,"extApiInvoke",function(){var i=L(function*(o){for(const a of o){const l=je(je({},a),{},{sid:null,invokeId:++r.apiInvokeCount,tag:st.TRACER});r.sendApiInvoke(l)}});return function(o){return i.apply(this,arguments)}}()),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),B("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),B("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(r){return this.baseInfoMap.get(r)}setAppId(r){this._appId=r}reportApiInvoke(r,i,o){i.timeout=i.timeout||6e4,i.reportResult=void 0===i.reportResult||i.reportResult;const a=Date.now();this.apiInvokeCount+=1;const l=this.apiInvokeCount,d=!!B("SHOW_REPORT_INVOKER_LOG"),h=!!B("SHOW_REPORT_USER_INVOKER_LOG"),f=d||h&&i.id;f&&(this.apiInvokeLoggedCount+=1);const m=this.apiInvokeLoggedCount;function g(C,P){if(f){let R="[apiInvoke-".concat(m,"]");i.id&&(R+="[".concat(i.id,"]")),i.name&&(R+="[".concat(i.name,"]")),T.info("".concat(R," ").concat(C),"start"===C?i.options:P||"")}}const v=()=>({tag:i.tag,invokeId:l,sid:r,name:i.name,apiInvokeTime:a,options:i.options,states:i.states||null});g("start");let y=!1;wr(i.timeout).then(()=>{y||(this.sendApiInvoke(je(je({},v()),{},{error:k.API_INVOKE_TIMEOUT,success:!1})),g("timeout"))});const b=new Y(k.UNEXPECTED_ERROR,"".concat(i.name,": this api invoke is end"));return{onSuccess:C=>{const P=()=>{if(y)throw b;return y=!0,this.sendApiInvoke(je(je({},v()),{},{success:!0},i.reportResult&&{result:C})),g("onSuccess"),C};return o?f4(P,i.name+"Success",o,()=>y=!0):P()},onError:C=>{const P=()=>{if(y)throw C;y=!0,this.sendApiInvoke(je(je({},v()),{},{success:!1,error:C})),g("onFailure",C.toString())};return o?f4(P,i.name+"Error",o,()=>y=!0):P()}}}sessionInit(r,i){if(this.baseInfoMap.has(r))return;const o=Date.now(),a=this.createBaseInfo(r,o);a.cname=i.cname;const l=Object.assign({},{willUploadConsoleLog:B("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:gS?"global":"oversea",areas:B("AREAS")&&B("AREAS").join(",")},i.extend),{stringUid:d,channelProfile:h,channelMode:f,isABTestSuccess:m,lsid:g,clientRole:v}=i,y=Date.now(),b=je(je({},a),{},{eventType:Pr.SESSION_INIT,appid:i.appid,browser:navigator.userAgent,buildFormat:i.buildFormat,build:AR,lts:y,elapse:y-o,extend:JSON.stringify(l),mode:i.mode,process:B("PROCESS_ID"),appType:B("APP_TYPE"),success:!0,version:Ss,stringUid:d,channelProfile:h,channelMode:f,isABTestSuccess:m,lsid:g,clientType:he(C=window.navigator.userAgent).call(C,"AgoraWebView")?42:20,clientRole:v,serviceId:B("PROCESS_ID"),extensionID:B("PLUGIN_INFO").join(",")||""});var C;this.send({type:sn.SESSION,data:b},!0)}joinChooseServer(r,i){const o=this.baseInfoMap.get(r);if(!o)return;const a=o.info,l=Date.now(),d=je(je({},a),{},{eventType:Pr.JOIN_CHOOSE_SERVER,lts:l,eventElapse:i.elapse||l-i.lts,chooseServerAddr:i.csAddr,errorCode:i.ec,elapse:l-o.startTime,success:i.succ,chooseServerAddrList:JSON.stringify(i.serverList),uid:i.uid?parseInt(i.uid):null,cid:i.cid?parseInt(i.cid):null,chooseServerIp:i.csIp||"",opid:i.opid,unilbsServerIds:i.unilbsServerIds,extend:i.extend||void 0,isHttp3:i.isHttp3,corssRegionTagReq:i.corssRegionTagReq||void 0,corssRegionTagRes:i.corssRegionTagRes||void 0});this.send({type:sn.JOIN_CHOOSE_SERVER,data:d},!0)}reqUserAccount(r,i){const o=this.baseInfoMap.get(r);if(!o)return;const a=o.info,l=Date.now(),d=je(je({},a),{},{eventType:Pr.REQ_USER_ACCOUNT,lts:l,success:i.success,serverAddress:i.serverAddr,stringUid:i.stringUid,uid:i.uid,errorCode:i.errorCode,elapse:i.elapse||l-o.startTime,eventElapse:l-i.lts,extend:JSON.stringify(i.extend)});this.send({type:sn.REQ_USER_ACCOUNT,data:d},!0)}joinGateway(r,i){const o=this.baseInfoMap.get(r);if(!o)return;const a=o.info;i.vid&&(a.vid=i.vid),a.uid=i.uid,a.cid=i.cid;const l=Date.now(),{firstSuccess:d,avoidJoinStartTime:h}=i,f=l-(d&&h?h:o.startTime),m=je(je({},a),{},{eventType:Pr.JOIN_GATEWAY,lts:l,gatewayAddr:i.addr,success:i.succ,errorCode:i.ec,errorMsg:i.errorMsg||"",elapse:f,eventElapse:l-i.lts,firstSuccess:d,signalChannel:i.signalChannel,preload:i.preload?1:0});i.succ&&(o.lastJoinSuccessTime=l),this.send({type:sn.JOIN_GATEWAY,data:m},!0)}joinChannelTimeout(r,i){const o=this.baseInfoMap.get(r);if(!o)return;const a=Date.now(),l=je(je({},o.info),{},{lts:a,timeout:i,elapse:a-o.startTime});this.send({type:sn.JOIN_CHANNEL_TIMEOUT,data:l},!0)}publish(r,i){const o=this.baseInfoMap.get(r);if(!o)return;const a=o.info,l=Date.now(),d=je(je({},a),{},{eventType:Pr.PUBLISH,lts:l,eventElapse:i.eventElapse,elapse:l-o.startTime,success:i.succ,errorCode:i.ec,videoName:i.videoName,audioName:i.audioName,screenName:i.screenName,screenshare:i.screenshare,audio:i.audio,video:i.video,p2pid:i.p2pid,publishRequestid:i.publishRequestid});this.send({type:sn.PUBLISH,data:d},!0)}subscribe(r,i,o){const a=this.baseInfoMap.get(r);if(!a)return;const l=a.info,d=Date.now(),h=je(je({},l),{},{eventType:Pr.SUBSCRIBE,lts:d,eventElapse:i.eventElapse,elapse:d-a.startTime,success:i.succ,errorCode:i.ec,video:i.video,audio:i.audio,subscribeRequestid:i.subscribeRequestid,p2pid:i.p2pid,preSsrc:i.preSsrc?1:0},o&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof i.peerid?h.peerSuid=i.peerid:h.peer=i.peerid,this.send({type:sn.SUBSCRIBE,data:h},!0)}wsCompressorInit(r){var i;const o=[...wo(i=this.baseInfoMap).call(i)],l=this.baseInfoMap.get(o.length?o[0]:"UnableToGetSid");if(!l)return;const d=l.info,h=Date.now(),f=je(je({},d),{},{eventType:Pr.WS_COMPRESSOR_INIT,lts:h,eventElapse:r.eventElapse,elapse:h-l.startTime,status:r.status?1:2});this.send({type:sn.WS_COMPRESSOR_INIT,data:f},!0)}firstRemoteVideoDecode(r,i,o,a){const l=this.baseInfoMap.get(r);if(!l)return;const d=l.info,h=Date.now(),f=je(je(je({},d),a),{},{elapse:h-l.startTime,eventType:i,lts:h,firstDecodeFrame:Math.max((a.firstFrame||h)-l.startTime,0),apEnd:Math.max(a.apEnd-l.startTime,0),apStart:Math.max(a.apStart-l.startTime,0),joinGwEnd:Math.max(a.joinGwEnd-l.startTime,0),joinGwStart:Math.max(a.joinGwStart-l.startTime,0),pcEnd:Math.max(a.pcEnd-l.startTime,0),pcStart:Math.max(a.pcStart-l.startTime,0),subscriberEnd:Math.max(a.subscriberEnd-l.startTime,0),subscriberStart:Math.max(a.subscriberStart-l.startTime,0),videoAddNotify:Math.max(a.videoAddNotify-l.startTime,0)});this.send({type:o,data:f},!0)}firstRemoteFrame(r,i,o,a){const l=this.baseInfoMap.get(r);if(!l)return;const d=l.info,h=Date.now(),f=je(je(je({},d),a),{},{elapse:h-l.startTime,eventType:i,lts:h});this.send({type:o,data:f},!0)}pcStats(r,i){const o=this.baseInfoMap.get(r);if(!o)return;const a=o.info,l=Date.now(),d=je(je(je({},a),i),{},{vid:void 0===a.vid?0:Number(a.vid),elapse:l-o.startTime,eventType:Pr.PC_STATS,lts:l,preallocation:i.preallocation?1:0});this.send({type:sn.PC_STATS,data:d},!0)}updateRemoteRTPCapabilities(r,i){if(r){const o=this.baseInfoMap.get(r);if(!o)return;const a=o.info,l=Date.now(),d=je(je(je({},a),i),{},{vid:void 0===a.vid?0:Number(a.vid),eventType:Pr.UPDATE_REMOTE_RTPCAPABILITIES,lts:l});this.send({type:sn.UPDATE_REMOTE_RTPCAPABILITIES,data:d},!0)}}onGatewayStream(r,i,o,a){const l=this.baseInfoMap.get(r);if(!l)return;const d=l.info,h=Date.now(),f=je(je(je({},d),a),{},{eventType:i,lts:h});this.send({type:o,data:f},!0)}streamSwitch(r,i){const o=this.baseInfoMap.get(r);if(!o)return;const a=o.info,l=Date.now(),d=je(je({},a),{},{eventType:Pr.STREAM_SWITCH,lts:l,isDual:i.isdual,elapse:l-o.startTime,success:i.succ});this.send({type:sn.STREAM_SWITCH,data:d},!0)}requestProxyAppCenter(r,i){const o=this.baseInfoMap.get(r);if(!o)return;const a=o.info,l=Date.now(),d=je(je({},a),{},{eventType:Pr.REQUEST_PROXY_APPCENTER,lts:l,eventElapse:l-i.lts,elapse:l-o.startTime,APAddr:i.APAddr,workerManagerList:i.workerManagerList,response:i.response,errorCode:i.ec,success:i.succ});this.send({type:sn.REQUEST_PROXY_APPCENTER,data:d},!0)}requestProxyWorkerManager(r,i){const o=this.baseInfoMap.get(r);if(!o)return;const a=o.info,l=Date.now(),d=je(je({},a),{},{eventType:Pr.REQUEST_PROXY_WORKER_MANAGER,lts:l,eventElapse:l-i.lts,elapse:l-o.startTime,workerManagerAddr:i.workerManagerAddr,response:i.response,errorCode:i.ec,success:i.succ});this.send({type:sn.REQUEST_PROXY_WORKER_MANAGER,data:d},!0)}setProxyServer(r){this.proxyServer=r,T.debug(r?"reportProxyServerurl: ".concat(r):"disable reportProxyServerurl: ".concat(r))}peerPublishStatus(r,i){const o=this.baseInfoMap.get(r);if(!o)return;const a=o.info,l=Date.now(),d=je(je({},a),{},{subscribeElapse:i.subscribeElapse,peer:i.peer,peerPublishDuration:Math.max(i.audioPublishDuration,i.videoPublishDuration),audiotag:i.audioPublishDuration>0?1:-1,videotag:i.videoPublishDuration>0?1:-1,lts:l,elapse:l-o.startTime,joinChannelSuccessElapse:l-(o.lastJoinSuccessTime||l),peerPublishDurationVideo:i.videoPublishDuration,peerPublishDurationAudio:i.audioPublishDuration});this.send({type:sn.PEER_PUBLISH_STATUS,data:d},!0)}workerEvent(r,i){const o=this.baseInfoMap.get(r);if(!o)return;const a=o.info,l=Date.now();(function(d,h){const m=d[h];if(!m||"string"!=typeof m)return[d];d[h]="";const g=bc(JSON.stringify(d));let v=0;const y=[];let b=0;for(let C=0;C<m.length;C++)b+=m.charCodeAt(C)<=127?1:3,b<=1300-g||(y[y.length]=Ee(Ee({},d),{},{[h]:m.substring(v,C)}),v=C,b=m.charCodeAt(C)<=127?1:3);return v!==m.length-1&&(y[y.length]=Ee(Ee({},d),{},{[h]:m.substring(v)})),y})(je(je(je({},a),i),{},{elapse:l-o.startTime,lts:l,productType:"WebRTC"}),"payload").forEach(d=>this.send({type:sn.WORKER_EVENT,data:d},!0))}apworkerEvent(r,i){const o=this.baseInfoMap.get(r);if(!o)return;const a=o.info,l=Date.now(),d=je(je(je({},a),i),{},{elapse:l-o.startTime,lts:l});this.send({type:sn.AP_WORKER_EVENT,data:d},!0)}joinWebProxyAP(r,i){const o=this.baseInfoMap.get(r);if(!o)return;const a=o.info,l=Date.now(),d=je(je(je({},a),i),{},{elapse:l-o.startTime,lts:l,extend:i.extend||void 0});this.send({type:sn.JOIN_WEB_PROXY_AP,data:d},!0)}WebSocketQuit(r,i){const o=this.baseInfoMap.get(r);if(!o)return;const a=o.info,l=Date.now(),d=je(je(je({},a),i),{},{elapse:l-o.startTime,lts:l});this.send({type:sn.WEBSOCKET_QUIT,data:d},!0)}sendCustomReportMessage(r,i){var o=this;return L(function*(){if(o.customReportCount+=i.length,o.customReportCount>B("CUSTOM_REPORT_LIMIT"))throw new Y(k.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);o.customReportCounterTimer||(o.customReportCounterTimer=window.setInterval(()=>{o.customReportCount=0},5e3));const a=Date.now(),l=i.map(d=>({type:sn.USER_ANALYTICS,data:je(je({sid:r},d),{},{lts:a})}));try{B("NEW_REPORT_SERVER")?yield o.postDataToStatsCollector2(l):yield o.postDataToStatsCollector(l)}catch(d){throw T.error("send custom report message failed",d.toString()),new Y(k.CUSTOM_REPORT_SEND_FAILED,d.message)}})()}sendApiInvoke(r){const i=B("NOT_REPORT_EVENT");if(r.tag&&he(i)&&he(i).call(i,r.tag))return!1;if(null===r.sid)return this.apiInvokeUploadPendingItems.push(r),!1;const o=this.baseInfoMap.get(r.sid);if(!o)return this.apiInvokeUploadPendingItems.push(r),!1;const{cname:a,uid:l,cid:d}=o.info;let h;if(r.lts=r.lts||Date.now(),r.error)if(r.error instanceof Y){const{code:m,message:g}=r.error;h=m||g||r.error.toString()}else h=r.error.toString();const f={invokeId:r.invokeId,sid:r.sid,cname:a,cid:d,uid:l,lts:r.lts,success:r.success,elapse:r.lts-o.startTime,execElapse:r.lts-r.apiInvokeTime,apiName:r.name,options:r.options?JSON.stringify(r.options):void 0,execStates:r.states?JSON.stringify(r.states):void 0,execResult:r.result?JSON.stringify(r.result):void 0,errorCode:r.error?h:void 0,errorMsg:r.error?JSON.stringify(r.error):void 0};return this.send({type:sn.API_INVOKE,data:f},!1),!0}addSid(r){this.sids.add(r)}removeSid(r){this.sids.delete(r)}appendSessionId(){const r=this.apiInvokeUploadPendingItems;if(0===r.length)return;const i=Array.from(this.sids).find(o=>null!==o);i&&r.forEach(o=>{o&&(o.sid=i,this.sendApiInvoke(Object.assign({},o)))}),r.length=0}send(r,i){if(i)return this.keyEventUploadPendingItems.push(r),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(r),this.normalEventUploadPendingItems.length>B("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(r,i){const o=[],a=[];for(;r.length;){const d=r.shift();o.length<20?o.push(d):a.push(d)}r.push(...a);for(const d of[...o]){var l;-1!==this.ltsList.indexOf(d.data.lts)?(d.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(d.data.lts)):(this.ltsList.push(d.data.lts),md(l=this.ltsList).call(l,(h,f)=>h-f))}return i||(this.lastSendNormalEventTime=Date.now()),B("ENABLE_EVENT_REPORT")&&o.length&&(B("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(o):this.postDataToStatsCollector(o)).catch((d=>h=>{B("EVENT_REPORT_RETRY")&&(i?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(d):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(d),this.normalEventUploadPendingItems.length>B("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-B("NORMAL_EVENT_QUEUE_CAPACITY")),T.warning("report: drop normal events"))))})(o)),r}postDataToStatsCollector2(r){var i=this;return L(function*(){Se.networkState===so.OFFLINE&&(yield le.race([Se.onlineWaiter,wr(2*Nn.maxRetryTimeout)]));const o=d=>{let h=new Uint8Array;return d.forEach(f=>{const m=R_(JSON.stringify(f.data)),g=new ArrayBuffer(5),v=(b=>{let C=0;return Object.entries(sn).forEach(P=>{let[R,A]=P;A===b.type&&(C=pL[R])}),C})(f),y=new DataView(g);y.setUint16(0,m.byteLength,!0),y.setUint8(2,255&v),y.setUint8(3,v>>>8&255),y.setUint8(4,v>>>16&255),h=u4(h,new Uint8Array(g)),h=u4(h,m)}),h},a="event";let l=i.proxyServer?"https://".concat(i.proxyServer,"/rs/?h=").concat(B("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(a):"https://".concat(B("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(a);for(let d=0;d<2;d+=1){1===d&&(l=i.proxyServer?"https://".concat(i.proxyServer,"/rs/?h=").concat(B("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(a):"https://".concat(B("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(a));try{yield IR(l,{timeout:1e4,data:o(r),headers:je(je({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},i._appId&&{appid:i._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(h){if(1===d)throw h;continue}return}})()}postDataToStatsCollector(r){var i=arguments,o=this;return L(function*(){let a=i.length>1&&void 0!==i[1]&&i[1];const l={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:r.map(f=>JSON.stringify(f)),vid:(f=>{const m=f&&f.data.sid&&o.baseInfoMap.get(f.data.sid);return m&&m.info.vid&&+m.info.vid||0})(r[0])};Se.networkState===so.OFFLINE&&(yield le.race([Se.onlineWaiter,wr(2*Nn.maxRetryTimeout)]));const d=a?"/events/proto-raws":"/events/messages";let h=o.url||(o.proxyServer?"https://".concat(o.proxyServer,"/rs/?h=").concat(B("EVENT_REPORT_DOMAIN"),"&p=").concat(B("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(B("EVENT_REPORT_DOMAIN"),":").concat(B("STATS_COLLECTOR_PORT")).concat(d));for(let f=0;f<2;f+=1){1===f&&(h=o.backupUrl||(o.proxyServer?"https://".concat(o.proxyServer,"/rs/?h=").concat(B("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(B("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(B("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(B("STATS_COLLECTOR_PORT")).concat(d)));try{a?yield M_(h,{timeout:1e4,data:l}):yield IR(h,{timeout:1e4,data:l})}catch(m){if(1===f)throw m;continue}return}})()}createBaseInfo(r,i){const o=Object.assign({},L_);return o.sid=r,this.baseInfoMap.set(r,{info:o,startTime:i}),o}reportResourceTiming(r,i){const o=performance.getEntriesByName(r),a=o[o.length-1];a&&this.reportApiInvoke(i,{name:"Client.resourceTiming",options:a,tag:st.TRACER}).onSuccess()}};Df.on("REPORT_LOG_UPLOAD",r=>{r.networkState=Se.networkState,be.reportApiInvoke(null,{name:"logUploadError",options:r,tag:st.TRACER}).onSuccess("logUploadError")});class K extends Y{constructor(i){super(i,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),bn(this,"name","AgoraRTCException")}print(){return super.print(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",T)}throw(){super.throw(T)}}const PR=["CHINA","GLOBAL"],fL=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Nd=[];function Pd(r,i){return!!i&&Nd.some(o=>o.uid===r&&o.channelName===i)}var b4=Dk.forEach,mL=Bm("forEach")?[].forEach:function(r){return b4(this,r,arguments.length>1?arguments[1]:void 0)};xt({target:"Array",proto:!0,forced:[].forEach!=mL},{forEach:mL});var S4=Di("Array").forEach,MR=mi,C4=Rr,gL=Ri,T4=S4,kR=Array.prototype,w4={DOMTokenList:!0,NodeList:!0},R4=Ht(function(r){var i=r.forEach;return r===kR||gL(kR,r)&&i===kR.forEach||C4(w4,MR(r))?T4:i}),A4=bo,_L=rr;xt({target:"Object",stat:!0,forced:Pt(function(){_L(1)})},{keys:function(r){return _L(A4(r))}});var vL=Ht(Qi.Object.keys),EL=Ht(qT),yL=xt,D4=zu,O4=xn([].reverse),LR=[1,2];yL({target:"Array",proto:!0,forced:String(LR)===String(LR.reverse())},{reverse:function(){return D4(this)&&(this.length=this.length),O4(this)}});var N4=Di("Array").reverse,P4=Ri,bL=N4,vS=Array.prototype,xR=function(r){var i=r.reverse;return r===vS||P4(vS,r)&&i===vS.reverse?bL:i},M4=Ht(xR),FR=xt,UR=zu,SL=dg,sz=ri,Sn=WE,k4=zc,Of=Gc,co=il,L4=En,CL=Qc,VR=$j("slice"),TL=L4("species"),ES=Array,wL=Math.max;FR({target:"Array",proto:!0,forced:!VR},{slice:function(r,i){var o,a,l,d=Of(this),h=k4(d),f=Sn(r,h),m=Sn(void 0===i?h:i,h);if(UR(d)&&((SL(o=d.constructor)&&(o===ES||UR(o.prototype))||sz(o)&&null===(o=o[TL]))&&(o=void 0),o===ES||void 0===o))return CL(d,f,m);for(a=new(void 0===o?ES:o)(wL(m-f,0)),l=0;f<m;f++,l++)f in d&&co(a,l,d[f]);return a.length=l,a}});var IL=Di("Array").slice,RL=Ri,AL=IL,yS=Array.prototype,_h=Ht(function(r){var i=r.slice;return r===yS||RL(yS,r)&&i===yS.slice?AL:i});function pe(r,i,o,a,l){var d,h,f,m={};return R4(d=vL(a)).call(d,function(g){m[g]=a[g]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=EL(h=M4(f=_h(o).call(o)).call(f)).call(h,function(g,v){return v(r,i,g)||g},m),l&&void 0!==m.initializer&&(m.value=m.initializer?m.initializer.call(l):void 0,m.initializer=void 0),void 0===m.initializer&&(gk(r,i,m),m=null),m}let ci=function(r){return r.L1T1="L1T1",r.L1T2="L1T2",r.L1T3="L1T3",r.L1T3_KEY="L1T3_KEY",r.L2T1_KEY="L2T1_KEY",r.L2T2_KEY="L2T2_KEY",r.L2T3_KEY="L2T3_KEY",r.L3T1_KEY="L3T1_KEY",r.L3T2_KEY="L3T2_KEY",r.L3T3_KEY="L3T3_KEY",r}({}),kn=function(r){return r.CERTIFICATE="certificate",r.CODEC="codec",r.CANDIDATE_PAIR="candidate-pair",r.LOCAL_CANDIDATE="local-candidate",r.REMOTE_CANDIDATE="remote-candidate",r.INBOUND="inbound-rtp",r.TRACK="track",r.OUTBOUND="outbound-rtp",r.PC="peer-connection",r.REMOTE_INBOUND="remote-inbound-rtp",r.REMOTE_OUTBOUND="remote-outbound-rtp",r.TRANSPORT="transport",r.CSRC="csrc",r.DATA_CHANNEL="data-channel",r.STREAM="stream",r.SENDER="sender",r.RECEIVER="receiver",r}({}),x_=function(r){return r[r.ACCESS_POINT=101]="ACCESS_POINT",r[r.UNILBS=201]="UNILBS",r[r.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",r}({}),BR=function(r){return r[r.IIIEGAL_APPID=1]="IIIEGAL_APPID",r[r.IIIEGAL_UID=2]="IIIEGAL_UID",r[r.INTERNAL_ERROR=3]="INTERNAL_ERROR",r}({}),Ts=function(r){return r[r.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",r[r.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",r[r.INTERNAL_ERROR=8]="INTERNAL_ERROR",r[r.NO_AUTHORIZED=9]="NO_AUTHORIZED",r[r.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",r[r.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",r[r.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",r[r.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",r[r.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",r[r.USER_OVERLOAD=16]="USER_OVERLOAD",r[r.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",r[r.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",r}({}),li=function(r){return r[r.NO_FLAG_SET=100]="NO_FLAG_SET",r[r.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",r[r.INVALID_FALG_SET=102]="INVALID_FALG_SET",r[r.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",r[r.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",r[r.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",r[r.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",r[r.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",r[r.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",r[r.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",r[r.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",r[r.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",r[r.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",r[r.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",r[r.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",r[r.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",r[r.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",r[r.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",r[r.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",r}({}),Ie=function(r){return r[r.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",r[r.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",r[r.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",r[r.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",r[r.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",r[r.K_TICKET_INVALID=7]="K_TICKET_INVALID",r[r.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",r[r.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",r[r.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",r[r.K_UID_BANNED=14]="K_UID_BANNED",r[r.K_IP_BANNED=15]="K_IP_BANNED",r[r.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",r[r.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",r[r.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",r[r.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",r[r.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",r[r.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",r[r.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",r[r.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",r[r.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",r[r.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",r[r.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",r[r.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",r[r.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",r[r.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",r[r.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",r[r.ERR_INVALID_UID=117]="ERR_INVALID_UID",r[r.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",r[r.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",r[r.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",r[r.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",r[r.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",r[r.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",r[r.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",r[r.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",r[r.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",r[r.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",r[r.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",r[r.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",r[r.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",r[r.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",r[r.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",r[r.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",r[r.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",r[r.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",r[r.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",r[r.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",r[r.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",r[r.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",r[r.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",r[r.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",r[r.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",r[r.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",r[r.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",r[r.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",r[r.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",r[r.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",r[r.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",r[r.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",r[r.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",r[r.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",r[r.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",r[r.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",r[r.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",r}({}),qt=function(r){return r.CONNECTING="connecting",r.CONNECTED="connected",r.RECONNECTING="reconnecting",r.CLOSED="closed",r}({}),Me=function(r){return r.WS_CONNECTED="ws_connected",r.WS_RECONNECTING="ws_reconnecting",r.WS_CLOSED="ws_closed",r.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",r.ON_BINARY_DATA="on_binary_data",r.REQUEST_RECOVER="request_recover",r.REQUEST_JOIN_INFO="request_join_info",r.REQUEST_REJOIN_INFO="req_rejoin_info",r.IS_P2P_DISCONNECTED="is_p2p_dis",r.DISCONNECT_P2P="dis_p2p",r.ABORT_P2P_EXECUTION="abort_p2p_execution",r.NEED_RENEW_SESSION="need-sid",r.REPORT_JOIN_GATEWAY="report_join_gateway",r.REQUEST_TIMEOUT="request_timeout",r.REQUEST_SUCCESS="request_success",r.JOIN_RESPONSE="join_response",r.PRE_CONNECT_PC="pre_connect_pc",r.P2P_CONNECTION="p2p_connection",r.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",r.P2P_SUBSCRIBE="p2p_subscribe",r.P2P_UNSUBSCRIBE="p2p_unsubscribe",r.P2P_EXCHANGE_SDP="p2p_exchange_sdp",r.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",r.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",r.RECOVER_NOTIFICATION="recover_notification",r}({}),Pe=function(r){return r.PING="ping",r.PING_BACK="ping_back",r.JOIN="join_v3",r.REJOIN="rejoin_v3",r.LEAVE="leave",r.SET_CLIENT_ROLE="set_client_role",r.PUBLISH="publish",r.PUBLISH_DATASTREAM="publish_datastream",r.UNPUBLISH="unpublish",r.UNPUBLISH_DATASTREAM="unpublish_datastream",r.SUBSCRIBE="subscribe",r.PRE_SUBSCRIBE="pre_subscribe",r.SUBSCRIBE_DATASTREAM="subscribe_datastream",r.SUBSCRIBE_STREAMS="subscribe_streams",r.UNSUBSCRIBE="unsubscribe",r.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",r.UNSUBSCRIBE_STREAMS="unsubscribe_streams",r.SUBSCRIBE_CHANGE="subscribe_change",r.TRAFFIC_STATS="traffic_stats",r.RENEW_TOKEN="renew_token",r.SWITCH_VIDEO_STREAM="switch_video_stream",r.DEFAULT_VIDEO_STREAM="default_video_stream",r.SET_FALLBACK_OPTION="set_fallback_option",r.GATEWAY_INFO="gateway_info",r.CONTROL="control",r.SEND_METADATA="send_metadata",r.DATA_STREAM="data_stream",r.PICK_SVC_LAYER="pick_svc_layer",r.RESTART_ICE="restart_ice",r.CONNECT_PC="connect_pc",r.SET_VIDEO_PROFILE="set_video_profile",r.SET_PARAMETER="set_parameter",r.SET_RTM2_FLAG="set_rtm2_flag",r}({}),F_=function(r){return r.WRTC_STATS="wrtc_stats",r.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",r.DENOISER_STATS="denoiser_stats",r.EXTENSION_USAGE_STATS="extension_usage_stats",r}({}),qe=function(r){return r.ON_USER_ONLINE="on_user_online",r.ON_USER_OFFLINE="on_user_offline",r.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",r.ON_PUBLISH_STREAM="on_publish_stream",r.ON_UPLINK_STATS="on_uplink_stats",r.ON_P2P_LOST="on_p2p_lost",r.ON_REMOVE_STREAM="on_remove_stream",r.ON_ADD_AUDIO_STREAM="on_add_audio_stream",r.ON_ADD_VIDEO_STREAM="on_add_video_stream",r.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",r.ON_USER_BANNED="on_user_banned",r.ON_USER_LICENSE_BANNED="on_user_license_banned",r.ON_NOTIFICATION="on_notification",r.ON_CRYPT_ERROR="on_crypt_error",r.MUTE_AUDIO="mute_audio",r.MUTE_VIDEO="mute_video",r.UNMUTE_AUDIO="unmute_audio",r.UNMUTE_VIDEO="unmute_video",r.ON_P2P_OK="on_p2p_ok",r.RECEIVE_METADATA="receive_metadata",r.ON_DATA_STREAM="on_data_stream",r.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",r.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",r.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",r.ENABLE_LOCAL_VIDEO="enable_local_video",r.DISABLE_LOCAL_VIDEO="disable_local_video",r.ENABLE_LOCAL_AUDIO="enable_local_audio",r.DISABLE_LOCAL_AUDIO="disable_local_audio",r.ON_PUBLISHED_USER_LIST="on_published_user_list",r}({}),Ni=function(r){return r.SEND_ONLY="SEND_ONLY",r.RECEIVE_ONLY="RECEIVE_ONLY",r}({}),Fe=function(r){return r.CONNECTED="websocket:connected",r.RECONNECTING="websocket:reconnecting",r.WILL_RECONNECT="websocket:will_reconnect",r.CLOSED="websocket:closed",r.FAILED="websocket:failed",r.ON_MESSAGE="websocket:on_message",r.REQUEST_NEW_URLS="websocket:request_new_urls",r.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",r}({});function bS(r){if("string"!=typeof r||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(r))throw T.error("Invalid Channel Name ".concat(r)),new K(k.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function SS(r){if(!("number"==typeof(i=r)&&Math.floor(i)===i&&0<=i&&i<=4294967295||nL(r,1,255)))throw new K(k.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var i;"string"==typeof r&&T.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Na=function(r){return r.TRANSCODE="mix_streaming",r.RAW="raw_streaming",r}({});const OL={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},CS={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function TS(r,i){Nr(r.url,"".concat(i,".url"),1,1e3,!1),pn(r.x)||Ft(r.x,"".concat(i,".x"),0,1e4),pn(r.y)||Ft(r.y,"".concat(i,".y"),0,1e4),pn(r.width)||Ft(r.width,"".concat(i,".width"),0,1e4),pn(r.height)||Ft(r.height,"".concat(i,".height"),0,1e4),pn(r.zOrder)||Ft(r.zOrder,"".concat(i,".zOrder"),0,255),pn(r.alpha)||Ft(r.alpha,"".concat(i,".alpha"),0,1,!1)}const NL={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let El=function(r){return r.WARNING="@live_uap-warning",r.ERROR="@line_uap-error",r.PUBLISH_STREAM_STATUS="@live_uap-publish-status",r.WORKER_STATUS="@live_uap-worker-status",r.REQUEST_NEW_ADDRESS="@live_uap-request-address",r}({}),wS=function(r){return r.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",r}({}),$n=function(r){return r[r.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",r[r.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",r[r.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",r[r.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",r[r.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",r[r.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",r[r.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",r[r.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",r[r.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",r[r.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",r[r.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",r[r.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",r[r.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",r[r.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",r[r.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",r[r.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",r[r.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",r[r.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",r[r.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",r[r.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",r[r.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",r}({});function jR(r){if(!r.channelName)throw new K(k.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof r.uid)throw new K(k.INVALID_PARAMS,"invalid uid in info, uid must be a number");return r.token&&Nr(r.token,"info.token",1,2047),SS(r.uid),bS(r.channelName),!0}let fn=function(r){return r[r.SetSdkProfile=0]="SetSdkProfile",r[r.SetSourceChannel=1]="SetSourceChannel",r[r.SetSourceUserId=2]="SetSourceUserId",r[r.SetDestChannel=3]="SetDestChannel",r[r.StartPacketTransfer=4]="StartPacketTransfer",r[r.StopPacketTransfer=5]="StopPacketTransfer",r[r.UpdateDestChannel=6]="UpdateDestChannel",r[r.Reconnect=7]="Reconnect",r[r.SetVideoProfile=8]="SetVideoProfile",r}({}),Cc=function(r){return r.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",r.NETWORK_CONNECTED="NETWORK_CONNECTED",r.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",r.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",r.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",r.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",r.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",r.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",r.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",r.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",r}({}),lo=function(r){return r.RELAY_STATE_IDLE="RELAY_STATE_IDLE",r.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",r.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",r.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",r}({}),Nf=function(r){return r.RELAY_OK="RELAY_OK",r.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",r.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",r.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",r}({}),at=function(r){return r.High="high",r.Low="low",r.Audio="audio",r.Screen="screen",r.ScreenLow="screen_low",r}({}),mr=function(r){return r.DISCONNECT="disconnect",r.CONNECTION_STATE_CHANGE="connection-state-change",r.NETWORK_QUALITY="network-quality",r.STREAM_TYPE_CHANGE="stream-type-change",r.IS_P2P_DISCONNECTED="is-p2p-dis",r.DISCONNECT_P2P="dis-p2p",r.REQUEST_NEW_GATEWAY_LIST="req-gate-url",r.NEED_RENEW_SESSION="need-sid",r.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",r.JOIN_RESPONSE="join-response",r.RESET_CONNECTION_EVENTS="reset-connection-events",r.PRE_CONNECT_PC="pre-connect_pc",r}({}),U_=function(r){return r.P2P_DISCONNECTED="P2P_DISCONNECTED",r.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",r.TIMEOUT="TIMEOUT",r.UNKNOWN_REASON="UNKNOWN_REASON",r}({}),gr=function(r){return r[r.Nothing=0]="Nothing",r[r.Audio=1]="Audio",r[r.LwoVideo=2]="LwoVideo",r[r.Video=4]="Video",r[r.Data=8]="Data",r[r.DataStream0=256]="DataStream0",r[r.DataStream1=512]="DataStream1",r[r.DataStream2=1024]="DataStream2",r[r.DataStream3=2048]="DataStream3",r[r.DataStream4=4096]="DataStream4",r[r.DataStream5=8192]="DataStream5",r[r.DataStream6=16384]="DataStream6",r[r.DataStream7=32768]="DataStream7",r}({}),mt=function(r){return r.CHINA="CHINA",r.ASIA="ASIA",r.NORTH_AMERICA="NORTH_AMERICA",r.EUROPE="EUROPE",r.JAPAN="JAPAN",r.INDIA="INDIA",r.KOREA="KOREA",r.HKMC="HKMC",r.US="US",r.OCEANIA="OCEANIA",r.SOUTH_AMERICA="SOUTH_AMERICA",r.AFRICA="AFRICA",r.OVERSEA="OVERSEA",r.GLOBAL="GLOBAL",r.EXTENSIONS="EXTENSIONS",r}({});const HR=[mt.AFRICA,mt.ASIA,mt.CHINA,mt.EUROPE,mt.GLOBAL,mt.INDIA,mt.JAPAN,mt.NORTH_AMERICA,mt.OCEANIA,mt.OVERSEA,mt.SOUTH_AMERICA];let zr=function(r){return r.CHINA="CN",r.ASIA="AS",r.NORTH_AMERICA="NA",r.EUROPE="EU",r.JAPAN="JP",r.INDIA="IN",r.KOREA="KR",r.HKMC="HK",r.US="US",r.OCEANIA="OC",r.SOUTH_AMERICA="SA",r.AFRICA="AF",r.OVERSEA="OVERSEA",r.GLOBAL="GLOBAL",r.EXTENSIONS="GLOBAL",r}({});const V_={CHINA:{},ASIA:{CODE:zr.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:zr.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:zr.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:zr.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:zr.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:zr.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:zr.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:zr.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:zr.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:zr.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:zr.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:zr.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:zr.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};gS&&(V_.CHINA={CODE:zr.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let IS=function(r){return r.UPDATE_BITRATE_LIMIT="update_bitrate_limit",r}({});class GR extends nn{constructor(i,o){super(),N(this,"onICEConnectionStateChange",void 0),N(this,"onConnectionStateChange",void 0),N(this,"onDTLSTransportStateChange",void 0),N(this,"onDTLSTransportError",void 0),N(this,"onICETransportStateChange",void 0),N(this,"onFirstAudioReceived",void 0),N(this,"onFirstVideoReceived",void 0),N(this,"onFirstAudioDecoded",void 0),N(this,"onFirstVideoDecoded",void 0),N(this,"onFirstVideoDecodedTimeout",void 0),N(this,"onSelectedLocalCandidateChanged",void 0),N(this,"onSelectedRemoteCandidateChanged",void 0),N(this,"getLocalVideoStats",void 0)}}class WR extends GR{constructor(i,o){super(i,o),N(this,"establishPromise",void 0)}}let _e=function(r){return r.VIDEO="video",r.AUDIO="audio",r}({}),uo=function(r){return r[r.UDP=0]="UDP",r[r.TCP=1]="TCP",r[r.RELAY=2]="RELAY",r}({}),Tc=function(r){return r[r.FIRST_CONNECTION=0]="FIRST_CONNECTION",r[r.TCP_RESTART=1]="TCP_RESTART",r[r.RELAY_RESTART=2]="RELAY_RESTART",r[r.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",r[r.OLD_RESTART=11]="OLD_RESTART",r[r.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",r}({}),ee=function(r){return r.LocalVideoTrack="videoTrack",r.LocalAudioTrack="audioTrack",r.LocalVideoLowTrack="videoLowTrack",r}({}),Dt=function(r){return r.New="new",r.Connected="connected",r.Reconnecting="reconnecting",r.Disconnected="disconnected",r}({}),De=function(r){return r.StateChange="stateChange",r.IceConnectionStateChange="iceConnectionStateChange",r.RequestMuteLocal="requestMuteLocal",r.RequestUnmuteLocal="requestUnmuteLocal",r.RequestRePublish="requestRePublish",r.RequestRePublishDataChannel="requestRePublishDataChannel",r.RequestReSubscribe="requestReSubscribe",r.RequestUploadStats="requestUploadStats",r.RequestUpload="requestUpload",r.MediaReconnectStart="MediaReconnectStart",r.MediaReconnectEnd="MediaReconnectEnd",r.NeedSignalRTT="NeedSignalRTT",r.RequestRestartICE="RequestRestartIce",r.PeerConnectionStateChange="PeerConnectionStateChange",r.RequestReconnect="RequestReconnect",r.RequestReconnectPC="RequestReconnectPC",r.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",r.P2PLost="P2PLost",r.UpdateVideoEncoder="UpdateVideoEncoder",r.ConnectionTypeChange="ConnectionTypeChange",r.RequestLowStreamParameter="RequestLowStreamParameter",r.QueryClientConnectionState="QueryClientConnectionState",r.LocalCandidate="LocalCandidate",r.RequestP2PMuteLocal="requestP2PMuteLocal",r.RequestP2PUnPublish="RequestP2PUnPublish",r.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",r.RequestP2PMuteRemote="RequestP2PMuteRemote",r.RequestP2PRestartICE="RequestP2PRestartICE",r}({}),qs=function(r){return r.CONNECTING="CONNECTING",r.RECONNECTING="RECONNECTING",r.CONNECTED="CONNECTED",r.CLOSED="CLOSED",r}({}),is=function(r){return r[r.CONNECT_AP=0]="CONNECT_AP",r[r.AP_CONNECTED=1]="AP_CONNECTED",r[r.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",r[r.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",r[r.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",r[r.CONNECT_WORKER=5]="CONNECT_WORKER",r[r.WORKER_CONNECTED=6]="WORKER_CONNECTED",r[r.CLOSED=7]="CLOSED",r}({}),_r=function(r){return r.CONNECTION_STATE_CHANGE="connection-state-change",r.STATE_CHANGE="state-change",r.INSPECT_RESULT="inspect-result",r.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",r.REQUEST_NEW_WORKER_URL="request-new-worker-url",r}({}),zR=function(r){return r.CONNECTED="transmitter:connected",r.RECONNECTING="transmitter:reconnecting",r.WILL_RECONNECT="transmitter:will_reconnect",r.CLOSED="transmitter:closed",r.FAILED="transmitter:failed",r.ON_MESSAGE="transmitter:on_message",r.REQUEST_NEW_URLS="transmitter:request_new_urls",r.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",r.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",r.FAILBACK="transmitter:failback",r.PRE_CONNECT_PC="transmitter:pre_connect_pc",r}({}),Ys=function(r){return r.CAMERA_CHANGED="camera-changed",r.MICROPHONE_CHANGED="microphone-changed",r.PLAYBACK_DEVICE_CHANGED="playback-device-changed",r.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",r.AUTOPLAY_FAILED="autoplay-failed",r.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",r.SECURITY_POLICY_VIOLATION="security-policy-violation",r}({}),ws=function(r){return r.CONNECTING="CONNECTING",r.RECONNECTING="RECONNECTING",r.CONNECTED="CONNECTED",r.CLOSED="CLOSED",r}({}),Pa=function(r){return r.CONNECTION_STATE_CHANGE="connection-state-change",r.STATE_CHANGE="state-change",r.INSPECT_RESULT="inspect-result",r.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",r.REQUEST_NEW_WORKER_URL="request-new-worker-url",r}({}),Md=function(r){return r[r.CONNECT_AP=0]="CONNECT_AP",r[r.AP_CONNECTED=1]="AP_CONNECTED",r[r.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",r[r.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",r[r.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",r[r.CONNECT_WORKER=5]="CONNECT_WORKER",r[r.WORKER_CONNECTED=6]="WORKER_CONNECTED",r[r.CLOSED=7]="CLOSED",r}({}),Bn=function(r){return r.CALL="call",r.CANDIDATE="candidate",r.PUBLISH="publish",r.UNPUBLISH="unpublish",r.CONTROL="control",r.RESTART_ICE="restart_ice",r.ACK="ack",r.RESPONSE="response",r.JOIN="join",r.CHECK="check",r}({}),mn=function(r){return r.ABORT="abort",r}({}),kd=function(r){return r.MUTE_LOCAL_AUDIO="mute_local_audio",r.MUTE_LOCAL_VIDEO="mute_local_video",r.UNMUTE_LOCAL_AUDIO="unmute_local_audio",r.UNMUTE_LOCAL_VIDEO="unmute_local_video",r}({}),ho=function(r){return r.P2P_TOKEN_TIMEOUT="p2p_token_timeout",r.P2P_TOKEN_CHANGED="p2p_token_changed",r}({});const x4={[x_.ACCESS_POINT]:{[li.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[li.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[li.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[li.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[li.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[li.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[li.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[li.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[li.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[li.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[li.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[li.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[li.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[li.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[li.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[li.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[li.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[li.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[x_.UNILBS]:{[Ts.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Ts.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Ts.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Ts.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Ts.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Ts.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Ts.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Ts.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Ts.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Ts.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Ts.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Ts.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[x_.STRING_UID_ALLOCATOR]:{[BR.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[BR.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[BR.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Pf(r){const i=x4[Math.floor(r/1e4)];if(!i)return{desc:"unknown error",retry:!1};const o=i[r%1e4];if(!o){if(Math.floor(r/1e4)===x_.ACCESS_POINT){const a=r%1e4;if("1"===a.toString()[0])return{desc:r.toString(),retry:!1};if("2"===a.toString()[0])return{desc:r.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return o}const RS={[Ie.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ie.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ie.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ie.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ie.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ie.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ie.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ie.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ie.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ie.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ie.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ie.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ie.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ie.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ie.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ie.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ie.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ie.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ie.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ie.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ie.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ie.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ie.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ie.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ie.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ie.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ie.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ie.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ie.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ie.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ie.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ie.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ie.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ie.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ie.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ie.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ie.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ie.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ie.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ie.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ie.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ie.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ie.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ie.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ie.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ie.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ie.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ie.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ie.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ie.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ie.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ie.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ie.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ie.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ie.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ie.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ie.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ie.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ie.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ie.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ie.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ie.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ie.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Mf(r){return RS[r]||{desc:"UNKNOWN_ERROR_".concat(r),action:"failed"}}function B_(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function PL(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?B_(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):B_(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}function ML(r){return r.every(i=>i.readyState===WebSocket.CLOSED||i.readyState===WebSocket.CLOSING)}function KR(r,i){if("string"==typeof r)return r;const{proxy:o,host:a,port:l}=r;if(i){const d=B("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===d?"wss://".concat(a,"/ws/?p=").concat(Number(l)+150):"wss://".concat(a,":").concat(d,"/ws/?p=").concat(Number(l)+150)}return o?"wss://".concat(o,"/ws/?h=").concat(a,"&p=").concat(l):"wss://".concat(a,":").concat(l)}const F4=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,U4=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,V4=/wss:\/\/(.+):([0-9]+)\/?/,B4=/wss:\/\/(.[^\/]+)\/?/;let kL=0;class j4{constructor(i,o){N(this,"id",0),N(this,"store",void 0),N(this,"recordIndex",void 0),N(this,"websockets",[]),N(this,"try443PortDuration",2e3),N(this,"forceCloseWSDuration",5e3),N(this,"try443PortTimeout",null),N(this,"forceCloseTimeout",null),N(this,"isTry443PortFailed",!1),N(this,"isNormalPortFailed",!1),N(this,"useDoubleDomain",!1),N(this,"useProxy",!1),N(this,"startTime",Date.now()),this.id=++kL,this.try443PortDuration=B("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=i||5e3,this.store=o}closeAllWebsockets(){this.websockets.forEach(i=>{i.onopen=null,i.onclose=null,i.onmessage=null,i.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var i;const o=Date.now()-this.startTime;for(var a=arguments.length,l=new Array(a),d=0;d<a;d++)l[d]=arguments[d];T.debug("[choose-best-ws ".concat(null===(i=this.store)||void 0===i?void 0:i.clientId," ").concat(this.id,"] ").concat(o,"ms:"),...l)}createWebSocket(i,o,a){this.logger("createWebSocket:",i,{isTry443Port:o,hasTimeoutDetection:a});const l=B("GATEWAY_DOMAINS"),d=Date.now(),h=[],f=l.find(v=>{var y;return he(y=i.host).call(y,v)});f||(this.useDoubleDomain=!1);const m=[];if(this.useDoubleDomain)l.forEach(v=>{m.push(KR(PL(PL({},i),{},{host:i.host.replace(f,v)}),o))});else{const v=PL({},i);if(o&&f){const y=l.find(b=>b!==f);y&&(v.host=v.host.replace(f,y))}m.push(KR(v,o))}try{m.forEach(v=>{const y=new WebSocket(v);y.binaryType="arraybuffer",h.push(y),this.logger("ws is connecting:",y.url)})}catch(v){if(this.logger("ws create failed"),h.forEach(y=>y.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(i,o,a);if(!o&&443!==Number(i.port))return this.createWebSocket(i,!0,a);throw new K(k.WS_ERR,"init websocket failed! Error: ".concat(v.toString()))}const g=Or();return this.store&&this.store.recordJoinChannelService({urls:h.map(v=>v.url),service:"gateway"},this.recordIndex),h.forEach(v=>{v.onopen=()=>{this.logger("onopen: ws ".concat(v.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach(y=>{y!==v&&(y.onopen=null,y.onclose=null,y.onmessage=null,y.close(),this.logger("close backup websocket: ".concat(y.url)))}),this.websockets.length=0,g.resolve(v)},v.onclose=y=>{this.logger("onclose: ws ".concat(v.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(v.readyState)),o?this.isTry443PortFailed=ML(h):this.isNormalPortFailed=ML(h),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(o&&this.isTry443PortFailed||!o&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(y.reason)),g.reject({code:y.code,reason:U_.A_ROUND_WS_FAILED}))},v.onmessage=y=>this.logger("".concat(v.url," onmessage: ").concat(y.data))}),this.websockets.push(...h),a||(()=>{const v=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",g.isResolved),this.websockets.forEach(y=>y.readyState!==WebSocket.OPEN&&y.close())};if(o||this.useProxy)return this.logger("add 5s timeout at ".concat(o?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(v,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",g.isResolved),g.isResolved)return v();ot().os===hr.MAC_OS&&hn()&&v(),this.createWebSocket(i,!0,!0).then(y=>g.resolve(y)).catch(y=>{this.isNormalPortFailed&&g.reject(y),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(v,this.forceCloseWSDuration)},this.try443PortDuration)})(),g.promise}chooseBestWebsocket(i,o,a,l){return this.useDoubleDomain=!!o,"string"==typeof i&&(i=function(d){let h,f,m;return[,h,f,m]=d.match(F4)||[],h||([,f,m]=d.match(U4)||[]),f&&m||([,f,m]=d.match(V4)||[]),f&&m||([,f]=d.match(B4)||[]),f||T.warning("un-destructible url: ",d),{proxy:h,host:f,port:m||"443"}}(i)),this.recordIndex=l,this.useProxy=!!i.proxy,a&&this.useProxy&&(T.warn("cannot use 443 only when use proxy"),a=!1),this.createWebSocket(i,!!a,!1).finally(()=>this.clearTimeout())}}function LL(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}class xL extends nn{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(i){var o;he(o=["tryNext","recover"]).call(o,i)&&this.resetReconnectCount(i),this._reconnectMode=i}get state(){return this._state}set state(i){i!==this._state&&(this._state=i,"reconnecting"===this._state?this.emit(Fe.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(Fe.CONNECTED):"closed"===this._state?this.emit(Fe.CLOSED):"failed"===this._state&&this.emit(Fe.FAILED))}resetReconnectCount(i){T.debug("websocket reset reconnect count, reason: "+i),this.reconnectCount=0}constructor(i,o){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),N(this,"connectionID",0),N(this,"currentURLIndex",0),N(this,"urls",[]),N(this,"_reconnectMode","tryNext"),N(this,"reconnectReason",void 0),N(this,"_initMutex",void 0),N(this,"name",void 0),N(this,"_state","closed"),N(this,"reconnectInterrupter",void 0),N(this,"websocket",void 0),N(this,"retryConfig",void 0),N(this,"reconnectCount",0),N(this,"forceCloseTimeout",5e3),N(this,"onlineReconnectListener",void 0),N(this,"useCompress",void 0),N(this,"tryDoubleDomain",!1),N(this,"use443PortOnly",!1),N(this,"wsInflateLength",0),N(this,"wsDeflateLength",0),N(this,"closeEstablishingWs",()=>{}),N(this,"store",void 0),N(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=i,this.retryConfig=function(y){for(var b=1;b<arguments.length;b++){var C=null!=arguments[b]?arguments[b]:{};b%2?LL(Object(C),!0).forEach(function(P){N(y,P,C[P])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(C)):LL(Object(C)).forEach(function(P){Object.defineProperty(y,P,Object.getOwnPropertyDescriptor(C,P))})}return y}({},o),this.useCompress=a,this.tryDoubleDomain=l,this.use443PortOnly=d,this._initMutex=new Qr("websocket",h?h.clientId:void 0);const{timeout:f,timeoutFactor:m}=o,g=Math.max(300,Math.floor(3*f/5)),v=Math.max(1.2,Math.floor(8*m)/10);so.ONLINE&&(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=v),Se.on(gl.NETWORK_STATE_CHANGE,(y,b)=>{y!==b&&(this.resetReconnectCount("network state change: ".concat(b," -> ").concat(y)),y===so.ONLINE?(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=v):(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=m))})}getConnection(){return this.websocket||void 0}init(i){var o=arguments,a=this;return L(function*(){let l=o.length>1&&void 0!==o[1]?o[1]:5e3;const d=yield a._initMutex.lock();a.forceCloseTimeout=l,a.urls=i,a.state="connecting";try{const h=Or(),f=a.urls[a.currentURLIndex];B("ENABLE_PREALLOC_PC")&&a.emit(zR.PRE_CONNECT_PC),a.createWebSocketConnection(f).then(h.resolve).catch(h.reject),a.once(Fe.CLOSED,()=>{h.reject(new Y(k.WS_DISCONNECT))}),a.once(Fe.CONNECTED,h.resolve),yield h.promise}catch{}finally{d()}})()}close(i,o){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const a=this.websocket;o?setTimeout(()=>a.close(),500):a.close(),this.websocket=void 0}this.state=i?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(i,o){if(!this.websocket)return void T.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==i&&(this.reconnectMode=i),T.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(o)]},this.joinGatewayRecordIndex);const a=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),a&&a.bind(this.websocket)({code:9999,reason:o})}sendMessage(i){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Y(k.WS_ABORT,"websocket is not ready");try{o||(i=JSON.stringify(i)),this.websocket.send(i)}catch(a){throw new Y(k.WS_ERR,"send websocket message error"+a.toString())}}setWsInflateData(i){this.wsDeflateLength=this.wsDeflateLength+i.originLength,this.wsInflateLength=this.wsInflateLength+i.compressedLength}getWsInflateData(){const i=this.wsInflateLength,o=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:i,wsDeflateLength:o}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}createWebSocketConnection(i){var o=this;return L(function*(){var a;const l=Or();o.connectionID+=1,o.joinGatewayRecordIndex=void 0;const d=y=>{var b;null===(b=o.store)||void 0===b||b.signalChannelOpen(),T.debug("[".concat(o.name,"] websocket opened:"),y),o.reconnectMode="retry",o.state="connected",o.resetReconnectCount("opened"),l.resolve()},h=function(){var y=L(function*(b){var C;if(T.debug("[".concat(o.name,"] websocket close ").concat(null===(C=o.websocket)||void 0===C?void 0:C.url,", code: ").concat(b.code,", reason: ").concat(b.reason,", current mode: ").concat(o.reconnectMode)),o.reconnectCount>=o.retryConfig.maxRetryCount)l.reject(new Y(k.WS_DISCONNECT,"websocket close: ".concat(b.code))),o.close();else{"connected"===o.state&&(o.reconnectReason=b.reason,o.state="reconnecting");const P=Ao(o,Fe.WILL_RECONNECT,o.reconnectMode,b.reason)||o.reconnectMode,R=yield o.reconnectWithAction(P);if("closed"===o.state)return void T.debug("[".concat(o.connectionID,"] ws is closed, no need to reconnect"));if(!R)return l.reject(new Y(k.WS_DISCONNECT,"websocket reconnect failed: ".concat(b.code))),o.close(!0);l.resolve()}});return function(C){return y.apply(this,arguments)}}(),f=y=>{o.emit(Fe.ON_MESSAGE,y)},m=y=>{T.warn("[".concat(o.connectionID,"] ws open error ").concat(y))};o.websocket&&(o.websocket.onclose=null,o.websocket.close()),B("GATEWAY_WSS_ADDRESS")&&o.name.startsWith("gateway")&&(i=B("GATEWAY_WSS_ADDRESS")),T.debug("[".concat(o.name,"] start connect, url:"),i);const g=null===(a=o.store)||void 0===a?void 0:a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var v;const y=yield o.chooseBestWebsocketConnection(i);o.websocket=y,d&&d(o.websocket.url),o.websocket.onclose=h,o.websocket.onmessage=f,o.websocket.onerror=m,null===(v=o.store)||void 0===v||v.recordJoinChannelService({endTs:Date.now(),status:"success"},g),o.joinGatewayRecordIndex=g}catch(y){const b="closed"===o.state,C=y instanceof Y,P=C&&y.code===k.WS_ABORT,R=C&&y.code===k.WS_ERR,A=C?y.message:y&&(y.reason||y.toString());T.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(A)),o.store&&o.store.recordJoinChannelService({endTs:Date.now(),status:P?"aborted":"error",errors:[y]},g),b||R?(l.reject(b?new Y(k.WS_DISCONNECT,"websocket is closed: ".concat(A)):new Y(k.WS_ERR,"init websocket failed: ".concat(A))),R&&T.error("[".concat(o.name,"] init websocket failed: ").concat(A))):h&&h(y)}return l.promise})()}reconnectWithAction(i){var o=arguments,a=this;return L(function*(){let l=!(o.length>1&&void 0!==o[1])||o[1];if(a.reconnectCount>=a.retryConfig.maxRetryCount||0===a.urls.length||"closed"===a.state)return!1;T.warning("[choose-best-ws] action: =>",i),a.onlineReconnectListener||Se.isOnline||!Se.onlineWaiter||(a.onlineReconnectListener=Se.onlineWaiter.then(()=>{a.onlineReconnectListener=void 0}));let d=!0;if(a.reconnectInterrupter=()=>d=!1,l){const m=TR(a.reconnectCount,a.retryConfig);T.debug("[".concat(a.name,"] wait ").concat(m,"ms to reconnect websocket, mode: ").concat(i)),yield le.race([wr(m),a.onlineReconnectListener||new le(()=>{})])}if("closed"===a._state||!d)return!1;a.reconnectCount+=1;const h=function(){var m=L(function*(g,v){a.emit(Fe.RECONNECT_CREATE_CONNECTION,v),yield a.createWebSocketConnection(g)});return function(v,y){return m.apply(this,arguments)}}();try{if("retry"===i)yield h(a.urls[a.currentURLIndex],i);else if("tryNext"===i){if(a.currentURLIndex+=1,a.currentURLIndex>=a.urls.length)return a.reconnectWithAction("recover",!1);T.debug("[".concat(a.name,"] websocket url length: ").concat(a.urls.length," current index: ").concat(a.currentURLIndex)),yield h(a.urls[a.currentURLIndex],i)}else"recover"===i&&(T.debug("[".concat(a.name,"] request new urls")),a.resetReconnectCount("recover mode"),a.urls=yield Gr(a,Fe.REQUEST_NEW_URLS),a.currentURLIndex=0,yield h(a.urls[a.currentURLIndex],i))}catch(m){var f;T.error("[".concat(a.name,"] reconnect failed ").concat(m&&m.toString()));const g=null==m||null===(f=m.data)||void 0===f?void 0:f.desc;return Array.isArray(g)&&he(g).call(g,"dynamic key expired")?(a.emit(Fe.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):a.reconnectWithAction(i,l)}return!0})()}}class qR extends xL{constructor(i,o){super(i,o,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(i,o){var a=this;return L(function*(){const l=Or(),d=new j4(a.forceCloseTimeout,a.store);a.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),d.closeAllWebsockets(),l.reject(new Y(k.WS_ABORT,"choose best websocket aborted"))};const h=B("GATEWAY_DOMAINS");return T.debug("[choose-best-ws] currentDomain: ",i,", domains: ",h,"total: ".concat(a.urls.length),"current: ".concat(a.currentURLIndex+1)),d.chooseBestWebsocket(i,a.tryDoubleDomain,a.use443PortOnly,o).then(l.resolve).catch(l.reject),l.promise.finally(()=>{a.closeEstablishingWs=void 0})})()}}class j_ extends xL{constructor(i,o){super(i,o,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(i,o){var a=this;return L(function*(){return new le((l,d)=>{let h=!1;const f=[];a.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),f.forEach(R=>{R.onclose=null,R.onopen=null,R.onmessage=null,R.close()}),d(new Y(k.WS_ABORT,"choose best websocket aborted"))};const m=B("GATEWAY_DOMAINS");let g;const v=i.indexOf("?h="),y=m.find(R=>-1!==v?he(i).call(i,R,v):he(i).call(i,R));T.debug("[choose-best-ws] currentDomain: ",y,", domains: ",m);let b=!a.tryDoubleDomain||!y;if(!b&&y){var C;const R=Date.now();try{m.forEach(A=>{const O=-1===v?i.replace(y,A):i.substr(0,v)+i.substr(v).replace(y,A),M=new WebSocket(O);M.binaryType="arraybuffer",f.push(M),T.debug("[choose-best-ws] ws is connecting:",M.url)})}catch{for(T.debug("[choose-best-ws] ws create failed, fallback to single url"),f.forEach(O=>O.close());f.length;)f.pop();b=!0}null===(C=a.store)||void 0===C||C.recordJoinChannelService({urls:f.map(A=>A.url),service:"gateway"},o),f.forEach(A=>{A.onopen=()=>{if(h)return;const O=Date.now()-R;T.debug("[choose-best-ws] ws open cost ".concat(O,"ms")),f.filter(M=>M!==A).forEach(M=>{T.debug("[choose-best-ws]close backup websocket: ".concat(M.url)),M.close()}),h=!0,l(A)},A.onclose=O=>{g=O,!h&&(f.find(M=>!(M.readyState===WebSocket.CLOSED||M.readyState===WebSocket.CLOSING))||(T.debug("[choose-best-ws] all websocket is closed"),h=!0,d(g)))},A.onmessage=O=>{T.debug("[choose-best-ws]".concat(A.url," onmessage: ").concat(O.data))}}),wr(a.forceCloseTimeout).then(()=>{f.forEach(A=>{A.readyState!==WebSocket.OPEN&&A.close()})})}if(b){var P;let R;T.debug("[choose-best-ws] use single url: ",i),null===(P=a.store)||void 0===P||P.recordJoinChannelService({urls:[i],service:"gateway"},o);try{R=new WebSocket(i),f.push(R),R.binaryType="arraybuffer"}catch(A){const O=new Y(k.WS_ERR,"init websocket failed! Error: ".concat(A.toString()));return T.error("[".concat(a.name,"]").concat(O)),void d(O)}R.onopen=()=>{l(R)},R.onclose=A=>{d(A)},R.onmessage=A=>{T.debug("[choose-best-ws]".concat(R.url," onmessage: ").concat(A.data))},wr(a.forceCloseTimeout).then(()=>{R&&R.readyState!==WebSocket.OPEN&&R.close()})}}).then(l=>(a.closeEstablishingWs=void 0,l)).catch(l=>{throw a.closeEstablishingWs=void 0,l})})()}}class H_ extends nn{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===qt.CONNECTED?this.emit(Me.WS_CONNECTED):i===qt.RECONNECTING?this.emit(Me.WS_RECONNECTING,this._websocketReconnectReason):i===qt.CLOSED&&this.emit(Me.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(i,o){super(),N(this,"_disconnectedReason",void 0),N(this,"_websocketReconnectReason",void 0),N(this,"_connectionState",qt.CLOSED),N(this,"reconnectToken",void 0),N(this,"websocket",void 0),N(this,"openConnectionTime",void 0),N(this,"clientId",void 0),N(this,"lastMsgTime",Date.now()),N(this,"uploadCache",[]),N(this,"uploadCacheInterval",void 0),N(this,"rttRolling",new N_(5)),N(this,"pingpongTimer",void 0),N(this,"wsInflateDataTimer",void 0),N(this,"pingpongTimeoutCount",0),N(this,"joinResponse",void 0),N(this,"multiIpOption",void 0),N(this,"initError",void 0),N(this,"spec",void 0),N(this,"store",void 0),N(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(Me.ON_BINARY_DATA,a.data);const l=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(l,"_id")){const d="res-@".concat(l._id);this.emit(d,l._result,l._message)}else if(Object.prototype.hasOwnProperty.call(l,"_type")){if(this.emit(l._type,l._message),l._type===qe.ON_NOTIFICATION&&this.handleNotification(l._message),l._type===qe.ON_USER_BANNED)switch(l._message.error_code){case 14:this.close(Rt.UID_BANNED);break;case 15:this.close(Rt.IP_BANNED);break;case 16:this.close(Rt.CHANNEL_BANNED)}if(l._type===qe.ON_USER_LICENSE_BANNED)switch(l._message.error_code){case Ie.ERR_LICENSE_MISSING:this.close(Rt.LICENSE_MISSING);break;case Ie.ERR_LICENSE_EXPIRED:this.close(Rt.LICENSE_EXPIRED);break;case Ie.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Rt.LICENSE_MINUTES_EXCEEDED);break;case Ie.ERR_LICENSE_PERIOD_INVALID:this.close(Rt.LICENSE_PERIOD_INVALID);break;case Ie.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Rt.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ie.ERR_LICENSE_ILLEGAL:this.close(Rt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=i.clientId,this.spec=i,this.store=o,this.websocket=new qR("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),o),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===qt.CONNECTED&&this.reconnect("retry",Hr.OFFLINE)})}request(i,o,a,l){var d=this;return L(function*(){const h=Ct(6,""),f={_id:h,_type:i,_message:o},m=d.websocket.connectionID,g=()=>new le((R,A)=>{if(d.connectionState===qt.CONNECTED)return R();const O=()=>{d.off(Me.WS_CLOSED,M),R()},M=()=>{d.off(Me.WS_CONNECTED,O),A(new K(k.WS_ABORT))};d.once(Me.WS_CONNECTED,O),d.once(Me.WS_CLOSED,M),i!==Pe.PUBLISH&&i!==Pe.PUBLISH_DATASTREAM&&i!==Pe.SUBSCRIBE&&i!==Pe.SUBSCRIBE_DATASTREAM&&i!==Pe.UNSUBSCRIBE&&i!==Pe.UNSUBSCRIBE_DATASTREAM&&i!==Pe.UNPUBLISH&&i!==Pe.UNPUBLISH_DATASTREAM&&i!==Pe.CONTROL&&i!==Pe.RESTART_ICE||d.once(Me.DISCONNECT_P2P,()=>{A(new K(k.DISCONNECT_P2P))}),i!==Pe.PUBLISH&&i!==Pe.RESTART_ICE||d.once(Me.ABORT_P2P_EXECUTION,()=>{A(new K(k.DISCONNECT_P2P))})});if(d.connectionState!==qt.CONNECTING&&d.connectionState!==qt.RECONNECTING||i===Pe.JOIN||i===Pe.REJOIN||(yield g()),d.websocket.sendMessage(f,!0),l)return;const v=new le((R,A)=>{let O=!1;const M=(j,W)=>{O=!0,R({isSuccess:"success"===j,message:W||{}}),d.off(Me.WS_CLOSED,x),d.off(Me.WS_RECONNECTING,x),d.emit(Me.REQUEST_SUCCESS,i,o)};d.once("res-@".concat(h),M);const x=()=>{A(new K(k.WS_ABORT,"type: ".concat(i))),d.off(Me.WS_CLOSED,x),d.off(Me.WS_RECONNECTING,x),d.off("res-@".concat(h),M)};d.once(Me.WS_CLOSED,x),d.once(Me.WS_RECONNECTING,x),wr(B("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||O||(T.warning("[".concat(d.clientId,"] ws request timeout, type: ").concat(i)),d.emit(Me.REQUEST_TIMEOUT,i,o))})});let y=null;try{y=yield v}catch(R){if(d.connectionState===qt.CLOSED||i===Pe.LEAVE)throw new K(k.WS_ABORT);return!d.spec.forceWaitGatewayResponse||a?R.throw():i===Pe.JOIN||i===Pe.REJOIN?null:(yield g(),yield d.request(i,o))}if(y.isSuccess)return y.message;const b=Number(y.message.error_code||y.message.code),C=Mf(b),P=new K(k.UNEXPECTED_RESPONSE,"".concat(C.desc,": ").concat(y.message.error_str),{code:b,data:y.message,desc:C.desc});return"success"===C.action?y.message:(T.warning("[".concat(d.clientId,"] [").concat(d.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(b,", message: ").concat(C.desc,", action: ").concat(C.action)),b===Ie.ERR_TOO_MANY_BROADCASTERS?((i===Pe.JOIN||i===Pe.REJOIN)&&(d.initError=P,d.close()),P.throw()):"failed"===C.action?P.throw():"quit"===C.action?(d.initError=P,d.close(),P.throw()):(b===Ie.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=y.message.option,T.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",Hr.MULTI_IP)):d.reconnect(C.action,Hr.SERVER_ERROR),i===Pe.JOIN||i===Pe.REJOIN?null:yield d.request(i,o)))})()}waitMessage(i,o){return new le(a=>{const l=d=>{(!o||o(d))&&(this.off(i,l),a(d))};this.on(i,l)})}uploadWRTCStats(i){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const o={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:i};this.upload(F_.WRTC_STATS,o)}upload(i,o){const a={_type:i,_message:o};try{this.websocket.sendMessage(a)}catch{const d=B("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==qt.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},B("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,o){this.websocket.sendMessage({_type:i,_message:o})}init(i,o){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new le((a,l)=>{this.once(Me.WS_CONNECTED,()=>a(this.joinResponse)),this.once(Me.WS_CLOSED,()=>l(this.initError||new K(k.WS_ABORT))),this.connectionState=qt.CONNECTING,this.websocket.init(i).catch(l),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=i||Rt.LEAVE,this.connectionState=qt.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}join(){var i=this;return L(function*(){if(!i.joinResponse){i.emit(Me.ABORT_P2P_EXECUTION);const o=yield Gr(i,Me.REQUEST_JOIN_INFO),a=yield i.request(Pe.JOIN,o);if(!a)return i.emit(Me.REPORT_JOIN_GATEWAY,U_.TIMEOUT,i.url||""),!1;i.joinResponse=a,i.emit(Me.JOIN_RESPONSE,i.joinResponse),i.reconnectToken=i.joinResponse.rejoin_token}return i.connectionState=qt.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),!0})()}rejoin(){var i=this;return L(function*(){if(!i.reconnectToken)throw new K(k.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const o=A_(i,Me.REQUEST_REJOIN_INFO);o.token=i.reconnectToken;const a=yield i.request(Pe.REJOIN,o);return!!a&&(i.connectionState=qt.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),a.peers&&a.peers.forEach(l=>{i.emit(qe.ON_USER_ONLINE,{uid:l.uid}),l.audio&&i.emit(qe.ON_ADD_AUDIO_STREAM,{uid:l.uid,uint_id:l.uint_id,audio:!0,ssrcId:l.audio_ssrc}),l.video&&i.emit(qe.ON_ADD_VIDEO_STREAM,{uid:l.uid,uint_id:l.uint_id,video:!0,ssrcId:l.video_ssrc}),i.emit(l.audio_mute?qe.MUTE_AUDIO:qe.UNMUTE_AUDIO,{uid:l.uid}),i.emit(l.video_mute?qe.MUTE_VIDEO:qe.UNMUTE_VIDEO,{uid:l.uid}),i.emit(l.audio_enable_local?qe.ENABLE_LOCAL_AUDIO:qe.DISABLE_LOCAL_AUDIO,{uid:l.uid}),i.emit(l.video_enable_local?qe.ENABLE_LOCAL_VIDEO:qe.DISABLE_LOCAL_VIDEO,{uid:l.uid}),l.audio||l.video||i.emit(qe.ON_REMOVE_STREAM,{uid:l.uid,uint_id:l.uint_id})}),!0)})()}reconnect(i,o){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,o)}handleNotification(i){T.debug("[".concat(this.clientId,"] receive notification: "),i);const o=Mf(i.code);if(28===i.code&&"detail"in i&&(T.info("[".concat(this.clientId,"] receive recover notification: "),i.detail),this.emit(Me.RECOVER_NOTIFICATION,i.detail)),"success"!==o.action){if("failed"!==o.action)return"quit"===o.action?("ERR_REPEAT_JOIN_CHANNEL"===o.desc&&this.close(Rt.UID_BANNED),void this.close()):void this.reconnect(o.action,Hr.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),o.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=B("PING_PONG_TIME_OUT"),o=Date.now();this.pingpongTimeoutCount>=i&&(T.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(o-this.lastMsgTime,"ms")),o-this.lastMsgTime>B("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Hr.TIMEOUT):this.request(Pe.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-o;this.rttRolling.add(a),B("REPORT_STATS")&&this.send(Pe.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWsInflateData(){const{wsInflateLength:i,wsDeflateLength:o}=this.websocket.getWsInflateData();0!==i&&0!==o&&this.upload(F_.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:o,ws_inflate_length:i})}handleWebsocketEvents(){this.websocket.on(Fe.RECONNECT_CREATE_CONNECTION,i=>{this.emit(Me.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(Fe.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Fe.CLOSED,()=>{this.connectionState=qt.CLOSED}),this.websocket.on(Fe.FAILED,()=>{this._disconnectedReason=Rt.NETWORK_ERROR,this.connectionState=qt.CLOSED}),this.websocket.on(Fe.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState=this.connectionState===qt.CONNECTED?qt.RECONNECTING:qt.CONNECTING}),this.websocket.on(Fe.WILL_RECONNECT,(i,o,a)=>{const l=A_(this,Me.IS_P2P_DISCONNECTED),d=l||"retry"!==i;l&&"retry"===i&&(T.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),i="tryNext",o=U_.P2P_DISCONNECTED),d&&(T.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(i)),this.emit(Me.REPORT_JOIN_GATEWAY,o||U_.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Me.DISCONNECT_P2P)),a(i)}),this.websocket.on(Fe.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(i=>{T.warning("[".concat(this.clientId,"] rejoin failed ").concat(i)),this.reconnect("tryNext",Hr.SERVER_ERROR)}):this.join().catch(i=>{if(this.emit(Me.REPORT_JOIN_GATEWAY,i,this.url||""),i instanceof K){if(i.code===k.UNEXPECTED_RESPONSE&&i.data.code===Ie.ERR_NO_AUTHORIZED)return this.initError=new K(k.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),T.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Hr.SERVER_ERROR);T.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Hr.SERVER_ERROR):(this.initError=i,this.close())}})}),this.websocket.on(Fe.REQUEST_NEW_URLS,(i,o)=>{Gr(this,Me.REQUEST_RECOVER,this.multiIpOption).then(i).catch(o)}),this.websocket.on(Fe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(qe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(zR.PRE_CONNECT_PC,()=>{this.emit(Me.PRE_CONNECT_PC)})}}let jn=function(r){return r[r.CHOOSE_SERVER=11]="CHOOSE_SERVER",r[r.CLOUD_PROXY=18]="CLOUD_PROXY",r[r.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",r[r.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",r}({});function YR(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function G_(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?YR(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):YR(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}function vh(r){return r.match(/^[\.\:\d]+$/)?"".concat(r.replace(/[^\d]/g,"-"),".").concat(B("TURN_DOMAIN")):(T.debug("Cannot recognized as ip address: ".concat(r,", use as host")),r)}function AS(r,i){r.addresses||(r.addresses=[]);const o=function(f,m){if(B("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return f.map(y=>{let{ip:b,port:C}=y;return{address:"".concat(b,":").concat(C)}});const g=B("GATEWAY_DOMAINS");let v=g[1]&&he(m).call(m,g[1])?1:0;return f.map(y=>{let{domain_prefix:b,port:C,ip:P}=y;if(b)return{address:"".concat(b,".").concat(g[v++%g.length],":").concat(C)};const R=/^[\.\:\d]+$/.test(P),A=R?"".concat(P.replace(/[^\d]/g,"-"),".").concat(g[v++%g.length],":").concat(C):"".concat(P,":").concat(C);return R||T.debug("Cannot recognized as ip address: ".concat(P,", use as host")),{ip:P,port:C,address:A}})}(r.addresses,i),a=Array.isArray(r.detail)&&r.detail[18];if(a&&"string"==typeof a){const f=a.split(";");for(let m=0;m<f.length;m++){var l;const g=vi(l=f[m]).call(l);o[m]&&g&&(o[m].ip6=g)}}const d=r.detail&&r.detail.candidate;let h;if(d){const[f,m]=d.split(":");f&&m&&(h={port:Number(m),ip:f,address:"".concat(f,":").concat(m)})}return{gatewayAddrs:o,apGatewayAddress:h,uid:r.uid,cid:r.cid,cert:r.cert,vid:r.detail&&r.detail[8],uni_lbs_ip:r.detail&&r.detail[1],res:r,csIp:r.detail&&r.detail[502]}}function Pi(r){return"number"==typeof r?r:r.exact||r.ideal||r.max||r.min||0}function FL(r){const i=r._encoderConfig;if(!i)return{};const o={resolution:i.width&&i.height?"".concat(Pi(i.width),"x").concat(Pi(i.height)):void 0,maxVideoBW:i.bitrateMax,minVideoBW:i.bitrateMin};return"number"==typeof i.frameRate?(o.maxFrameRate=i.frameRate,o.minFrameRate=i.frameRate):i.frameRate&&(o.maxFrameRate=i.frameRate.max||i.frameRate.ideal||i.frameRate.exact||i.frameRate.min,o.minFrameRate=i.frameRate.min||i.frameRate.ideal||i.frameRate.exact||i.frameRate.max),o}function H4(r){return r>=0&&r<.17?1:r>=.17&&r<.36?2:r>=.36&&r<.59?3:r>=.59&&r<=1?4:r>1?5:0}function DS(r,i){let o,a,l;switch(i){case jn.CHOOSE_SERVER:a=4096,l="choose server";break;case jn.CLOUD_PROXY:a=1048576,l="proxy";break;case jn.CLOUD_PROXY_5:a=4194304,l="proxy5";break;case jn.CLOUD_PROXY_FALLBACK:a=4194310,l="proxy fallback";break;default:throw new K(k.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:r.detail&&r.detail[502],retry:!1})}if(r.response_body.forEach(d=>{d.buffer&&d.buffer.flag===a&&(o={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map(h=>G_(G_({},h),{},{ticket:d.buffer.cert})),server_ts:r.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:G_(G_({},d.buffer.detail),r.detail),flag:d.buffer.flag,opid:r.opid,cert:d.buffer.cert})}),!o)throw new K(k.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(l," from multi unilbs response"),{csIp:r.detail&&r.detail[502]});return o}function W_(r,i){return $R.apply(this,arguments)}function $R(){return $R=L(function*(r,i){return yield le.all(r.addresses.map(function(){var o=L(function*(a){return{address:vh(a.ip),tcpport:a.port,udpport:a.port,username:i&&B("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?i.toString():Wr.username,password:i&&B("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?yield ER(i.toString()):Wr.password}});return function(a){return o.apply(this,arguments)}}()))}),$R.apply(this,arguments)}function XR(r,i){const o=i.getMediaStreamTrack(!0).getSettings(),a=i.videoHeight||o.height,l=i.videoWidth||o.width;return a&&l?Math.max(Math.min(a,l)/Math.min(Pi(r.height),Pi(r.width)),1):(T.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Ld(r){let{candidateType:i,relayProtocol:o,type:a,address:l,port:d,protocol:h}=r;const f={candidateType:i,relayProtocol:o,protocol:h};if("local-candidate"!==a){const m=l.split(".");m.length>=4&&(m[1]="*",m[2]="*"),f.address=m.join("."),f.port=d}return f}var $s,z_=Ht(xR),UL=Di("Array").values,G4=mi,W4=Rr,Do=Ri,kf=UL,ZR=Array.prototype,z4={DOMTokenList:!0,NodeList:!0},xd=Ht(function(r){var i=r.values;return r===ZR||Do(ZR,r)&&i===ZR.values||W4(z4,G4(r))?kf:i}),Lf=ms,JR=Fr,q4=Pt,OS=rr,Y4=Wm,$4=fu,X4=bo,QR=OE,Eh=Object.assign,VL=Object.defineProperty,NS=xn([].concat),eA=!Eh||q4(function(){if(Lf&&1!==Eh({b:1},Eh(VL({},"a",{enumerable:!0,get:function(){VL(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var r={},i={},o=Symbol(),a="abcdefghijklmnopqrst";return r[o]=7,a.split("").forEach(function(l){i[l]=l}),7!=Eh({},r)[o]||OS(Eh({},i)).join("")!=a})?function(r,i){for(var o=X4(r),a=arguments.length,l=1,d=Y4.f,h=$4.f;a>l;)for(var f,m=QR(arguments[l++]),g=d?NS(OS(m),d(m)):OS(m),v=g.length,y=0;v>y;)f=g[y++],Lf&&!JR(h,m,f)||(o[f]=m[f]);return o}:Eh,cz=Ai,BL=p0,Z4=nd,jL=Fr,xf=bo,J4=function(r,i,o,a){try{return a?i(cz(o)[0],o[1]):i(o)}catch(l){BL(r,"throw",l)}},HL=HN,tA=dg,lz=zc,GL=il,Q4=GN,e5=h0,nA=Array,Fd=xn,rA=2147483647,WL=/[^\0-\u007E]/,iA=/[.\u3002\uFF0E\uFF61]/g,zL="Overflow: input needs wider integers to process",KL=RangeError,qL=Fd(iA.exec),Ff=Math.floor,PS=String.fromCharCode,oA=Fd("".charCodeAt),sA=Fd([].join),yl=Fd([].push),t5=Fd("".replace),n5=Fd("".split),dz=Fd("".toLowerCase),aA=function(r){return r+22+75*(r<26)},uz=function(r,i,o){var a=0;for(r=o?Ff(r/700):r>>1,r+=Ff(r/i);r>455;)r=Ff(r/35),a+=36;return Ff(a+36*r/(r+38))},hz=function(r){var o,a,i=[],l=(r=function(O){for(var M=[],x=0,j=O.length;x<j;){var W=oA(O,x++);if(W>=55296&&W<=56319&&x<j){var q=oA(O,x++);56320==(64512&q)?yl(M,((1023&W)<<10)+(1023&q)+65536):(yl(M,W),x--)}else yl(M,W)}return M}(r)).length,d=128,h=0,f=72;for(o=0;o<r.length;o++)(a=r[o])<128&&yl(i,PS(a));var m=i.length,g=m;for(m&&yl(i,"-");g<l;){var v=rA;for(o=0;o<r.length;o++)(a=r[o])>=d&&a<v&&(v=a);var y=g+1;if(v-d>Ff((rA-h)/y))throw KL(zL);for(h+=(v-d)*y,d=v,o=0;o<r.length;o++){if((a=r[o])<d&&++h>rA)throw KL(zL);if(a==d){for(var b=h,C=36;;){var P=C<=f?1:C>=f+26?26:C-f;if(b<P)break;var R=b-P,A=36-P;yl(i,PS(aA(P+R%A))),b=Ff(R/A),C+=36}yl(i,PS(aA(b))),f=uz(h,y,g==m),h=0,g++}}h++,d++}return sA(i,"")},pz=xt,YL=ms,fz=jb,$L=tr,r5=nd,Ma=xn,wc=Vs,ka=Op,mz=sg,MS=Rr,cA=eA,Ic=function(r){var i=xf(r),o=tA(this),a=arguments.length,l=a>1?arguments[1]:void 0,d=void 0!==l;d&&(l=Z4(l,a>2?arguments[2]:void 0));var h,f,m,g,v,y,b=e5(i),C=0;if(!b||this===nA&&HL(b))for(h=lz(i),f=o?new this(h):nA(h);h>C;C++)y=d?l(i[C],C):i[C],GL(f,C,y);else for(v=(g=Q4(i,b)).next,f=o?new this:[];!(m=jL(v,g)).done;C++)y=d?J4(g,l,[m.value,C],!0):m.value,GL(f,C,y);return f.length=C,f},os=MM,o5=Sg.codeAt,bl=qo,a5=uc,c5=Tr,XL=$r,JL=Iu.set,kS=Iu.getterFor("URL"),l5=XL.URLSearchParams,d5=XL.getState,K_=$L.URL,lA=$L.TypeError,LS=$L.parseInt,u5=Math.floor,QL=Math.pow,Xs=Ma("".charAt),La=Ma(/./.exec),q_=Ma([].join),h5=Ma(1..toString),p5=Ma([].pop),yh=Ma([].push),Y_=Ma("".replace),f5=Ma([].shift),m5=Ma("".split),Uf=Ma("".slice),xS=Ma("".toLowerCase),ex=Ma([].unshift),tx="Invalid scheme",bh="Invalid host",dA="Invalid port",$_=/[a-z]/i,uA=/[\d+-.a-z]/i,X_=/\d/,g5=/^0x/i,hA=/^[0-7]+$/,Z_=/^\d+$/,pA=/^[\da-f]+$/i,_5=/[\0\t\n\r #%/:<>?@[\\\]^|]/,nx=/[\0\t\n\r #/:<>?@[\\\]^|]/,FS=/^[\u0000-\u0020]+/,gz=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,rx=/[\t\n\r]/g,J_=function(r){var i,o,a,l;if("number"==typeof r){for(i=[],o=0;o<4;o++)ex(i,r%256),r=u5(r/256);return q_(i,".")}if("object"==typeof r){for(i="",a=function(d){for(var h=null,f=1,m=null,g=0,v=0;v<8;v++)0!==d[v]?(g>f&&(h=m,f=g),m=null,g=0):(null===m&&(m=v),++g);return g>f&&(h=m,f=g),h}(r),o=0;o<8;o++)l&&0===r[o]||(l&&(l=!1),a===o?(i+=o?":":"::",l=!0):(i+=h5(r[o],16),o<7&&(i+=":")));return"["+i+"]"}return r},fA={},ix=cA({},fA,{" ":1,'"':1,"<":1,">":1,"`":1}),ox=cA({},ix,{"#":1,"?":1,"{":1,"}":1}),US=cA({},ox,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),bi=function(r,i){var o=o5(r,0);return o>32&&o<127&&!MS(i,r)?r:encodeURIComponent(r)},Sh={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Ud=function(r,i){var o;return 2==r.length&&La($_,Xs(r,0))&&(":"==(o=Xs(r,1))||!i&&"|"==o)},mA=function(r){var i;return r.length>1&&Ud(Uf(r,0,2))&&(2==r.length||"/"===(i=Xs(r,2))||"\\"===i||"?"===i||"#"===i)},v5=function(r){return"."===r||"%2e"===xS(r)},gA={},sx={},_A={},E5={},ax={},VS={},cx={},lx={},Vf={},vA={},Q_={},EA={},BS={},ev={},yA={},dx={},Rc={},Sl={},ux={},Oo={},Cl={},hx=function(r,i,o){var a,l,d,h=bl(r);if(i){if(l=this.parse(h))throw lA(l);this.searchParams=null}else{if(void 0!==o&&(a=new hx(o,!0)),l=this.parse(h,null,a))throw lA(l);(d=d5(new l5)).bindURL(this),this.searchParams=d}};hx.prototype={type:"URL",parse:function(r,i,o){var a,l,d,h,f,m=this,g=i||gA,v=0,y="",b=!1,C=!1,P=!1;for(r=bl(r),i||(m.scheme="",m.username="",m.password="",m.host=null,m.port=null,m.path=[],m.query=null,m.fragment=null,m.cannotBeABaseURL=!1,r=Y_(r,FS,""),r=Y_(r,gz,"$1")),r=Y_(r,rx,""),a=Ic(r);v<=a.length;){switch(l=a[v],g){case gA:if(!l||!La($_,l)){if(i)return tx;g=_A;continue}y+=xS(l),g=sx;break;case sx:if(l&&(La(uA,l)||"+"==l||"-"==l||"."==l))y+=xS(l);else{if(":"!=l){if(i)return tx;y="",g=_A,v=0;continue}if(i&&(m.isSpecial()!=MS(Sh,y)||"file"==y&&(m.includesCredentials()||null!==m.port)||"file"==m.scheme&&!m.host))return;if(m.scheme=y,i)return void(m.isSpecial()&&Sh[m.scheme]==m.port&&(m.port=null));y="","file"==m.scheme?g=ev:m.isSpecial()&&o&&o.scheme==m.scheme?g=E5:m.isSpecial()?g=lx:"/"==a[v+1]?(g=ax,v++):(m.cannotBeABaseURL=!0,yh(m.path,""),g=ux)}break;case _A:if(!o||o.cannotBeABaseURL&&"#"!=l)return tx;if(o.cannotBeABaseURL&&"#"==l){m.scheme=o.scheme,m.path=os(o.path),m.query=o.query,m.fragment="",m.cannotBeABaseURL=!0,g=Cl;break}g="file"==o.scheme?ev:VS;continue;case E5:if("/"!=l||"/"!=a[v+1]){g=VS;continue}g=Vf,v++;break;case ax:if("/"==l){g=vA;break}g=Sl;continue;case VS:if(m.scheme=o.scheme,l==$s)m.username=o.username,m.password=o.password,m.host=o.host,m.port=o.port,m.path=os(o.path),m.query=o.query;else if("/"==l||"\\"==l&&m.isSpecial())g=cx;else if("?"==l)m.username=o.username,m.password=o.password,m.host=o.host,m.port=o.port,m.path=os(o.path),m.query="",g=Oo;else{if("#"!=l){m.username=o.username,m.password=o.password,m.host=o.host,m.port=o.port,m.path=os(o.path),m.path.length--,g=Sl;continue}m.username=o.username,m.password=o.password,m.host=o.host,m.port=o.port,m.path=os(o.path),m.query=o.query,m.fragment="",g=Cl}break;case cx:if(!m.isSpecial()||"/"!=l&&"\\"!=l){if("/"!=l){m.username=o.username,m.password=o.password,m.host=o.host,m.port=o.port,g=Sl;continue}g=vA}else g=Vf;break;case lx:if(g=Vf,"/"!=l||"/"!=Xs(y,v+1))continue;v++;break;case Vf:if("/"!=l&&"\\"!=l){g=vA;continue}break;case vA:if("@"==l){b&&(y="%40"+y),b=!0,d=Ic(y);for(var R=0;R<d.length;R++){var A=d[R];if(":"!=A||P){var O=bi(A,US);P?m.password+=O:m.username+=O}else P=!0}y=""}else if(l==$s||"/"==l||"?"==l||"#"==l||"\\"==l&&m.isSpecial()){if(b&&""==y)return"Invalid authority";v-=Ic(y).length+1,y="",g=Q_}else y+=l;break;case Q_:case EA:if(i&&"file"==m.scheme){g=dx;continue}if(":"!=l||C){if(l==$s||"/"==l||"?"==l||"#"==l||"\\"==l&&m.isSpecial()){if(m.isSpecial()&&""==y)return bh;if(i&&""==y&&(m.includesCredentials()||null!==m.port))return;if(h=m.parseHost(y))return h;if(y="",g=Rc,i)return;continue}"["==l?C=!0:"]"==l&&(C=!1),y+=l}else{if(""==y)return bh;if(h=m.parseHost(y))return h;if(y="",g=BS,i==EA)return}break;case BS:if(!La(X_,l)){if(l==$s||"/"==l||"?"==l||"#"==l||"\\"==l&&m.isSpecial()||i){if(""!=y){var M=LS(y,10);if(M>65535)return dA;m.port=m.isSpecial()&&M===Sh[m.scheme]?null:M,y=""}if(i)return;g=Rc;continue}return dA}y+=l;break;case ev:if(m.scheme="file","/"==l||"\\"==l)g=yA;else{if(!o||"file"!=o.scheme){g=Sl;continue}if(l==$s)m.host=o.host,m.path=os(o.path),m.query=o.query;else if("?"==l)m.host=o.host,m.path=os(o.path),m.query="",g=Oo;else{if("#"!=l){mA(q_(os(a,v),""))||(m.host=o.host,m.path=os(o.path),m.shortenPath()),g=Sl;continue}m.host=o.host,m.path=os(o.path),m.query=o.query,m.fragment="",g=Cl}}break;case yA:if("/"==l||"\\"==l){g=dx;break}o&&"file"==o.scheme&&!mA(q_(os(a,v),""))&&(Ud(o.path[0],!0)?yh(m.path,o.path[0]):m.host=o.host),g=Sl;continue;case dx:if(l==$s||"/"==l||"\\"==l||"?"==l||"#"==l){if(!i&&Ud(y))g=Sl;else if(""==y){if(m.host="",i)return;g=Rc}else{if(h=m.parseHost(y))return h;if("localhost"==m.host&&(m.host=""),i)return;y="",g=Rc}continue}y+=l;break;case Rc:if(m.isSpecial()){if(g=Sl,"/"!=l&&"\\"!=l)continue}else if(i||"?"!=l)if(i||"#"!=l){if(l!=$s&&(g=Sl,"/"!=l))continue}else m.fragment="",g=Cl;else m.query="",g=Oo;break;case Sl:if(l==$s||"/"==l||"\\"==l&&m.isSpecial()||!i&&("?"==l||"#"==l)){if(".."===(f=xS(f=y))||"%2e."===f||".%2e"===f||"%2e%2e"===f?(m.shortenPath(),"/"==l||"\\"==l&&m.isSpecial()||yh(m.path,"")):v5(y)?"/"==l||"\\"==l&&m.isSpecial()||yh(m.path,""):("file"==m.scheme&&!m.path.length&&Ud(y)&&(m.host&&(m.host=""),y=Xs(y,0)+":"),yh(m.path,y)),y="","file"==m.scheme&&(l==$s||"?"==l||"#"==l))for(;m.path.length>1&&""===m.path[0];)f5(m.path);"?"==l?(m.query="",g=Oo):"#"==l&&(m.fragment="",g=Cl)}else y+=bi(l,ox);break;case ux:"?"==l?(m.query="",g=Oo):"#"==l?(m.fragment="",g=Cl):l!=$s&&(m.path[0]+=bi(l,fA));break;case Oo:i||"#"!=l?l!=$s&&("'"==l&&m.isSpecial()?m.query+="%27":m.query+="#"==l?"%23":bi(l,fA)):(m.fragment="",g=Cl);break;case Cl:l!=$s&&(m.fragment+=bi(l,ix))}v++}},parseHost:function(r){var i,o,a;if("["==Xs(r,0)){if("]"!=Xs(r,r.length-1)||!(i=function(l){var d,h,f,m,g,v,y,b=[0,0,0,0,0,0,0,0],C=0,P=null,R=0,A=function(){return Xs(l,R)};if(":"==A()){if(":"!=Xs(l,1))return;R+=2,P=++C}for(;A();){if(8==C)return;if(":"!=A()){for(d=h=0;h<4&&La(pA,A());)d=16*d+LS(A(),16),R++,h++;if("."==A()){if(0==h||(R-=h,C>6))return;for(f=0;A();){if(m=null,f>0){if(!("."==A()&&f<4))return;R++}if(!La(X_,A()))return;for(;La(X_,A());){if(g=LS(A(),10),null===m)m=g;else{if(0==m)return;m=10*m+g}if(m>255)return;R++}b[C]=256*b[C]+m,2!=++f&&4!=f||C++}if(4!=f)return;break}if(":"==A()){if(R++,!A())return}else if(A())return;b[C++]=d}else{if(null!==P)return;R++,P=++C}}if(null!==P)for(v=C-P,C=7;0!=C&&v>0;)y=b[C],b[C--]=b[P+v-1],b[P+--v]=y;else if(8!=C)return;return b}(Uf(r,1,-1))))return bh;this.host=i}else if(this.isSpecial()){if(r=function(r){var i,o,a=[],l=n5(t5(dz(r),iA,"."),".");for(i=0;i<l.length;i++)yl(a,qL(WL,o=l[i])?"xn--"+hz(o):o);return sA(a,".")}(r),La(_5,r)||null===(i=function(l){var d,h,f,m,g,v,y,b=m5(l,".");if(b.length&&""==b[b.length-1]&&b.length--,(d=b.length)>4)return l;for(h=[],f=0;f<d;f++){if(""==(m=b[f]))return l;if(g=10,m.length>1&&"0"==Xs(m,0)&&(g=La(g5,m)?16:8,m=Uf(m,8==g?1:2)),""===m)v=0;else{if(!La(10==g?Z_:8==g?hA:pA,m))return l;v=LS(m,g)}yh(h,v)}for(f=0;f<d;f++)if(v=h[f],f==d-1){if(v>=QL(256,5-d))return null}else if(v>255)return null;for(y=p5(h),f=0;f<h.length;f++)y+=h[f]*QL(256,3-f);return y}(r)))return bh;this.host=i}else{if(La(nx,r))return bh;for(i="",o=Ic(r),a=0;a<o.length;a++)i+=bi(o[a],fA);this.host=i}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return MS(Sh,this.scheme)},shortenPath:function(){var r=this.path,i=r.length;!i||"file"==this.scheme&&1==i&&Ud(r[0],!0)||r.length--},serialize:function(){var r=this,i=r.scheme,o=r.username,a=r.password,l=r.host,d=r.port,h=r.path,f=r.query,m=r.fragment,g=i+":";return null!==l?(g+="//",r.includesCredentials()&&(g+=o+(a?":"+a:"")+"@"),g+=J_(l),null!==d&&(g+=":"+d)):"file"==i&&(g+="//"),g+=r.cannotBeABaseURL?h[0]:h.length?"/"+q_(h,"/"):"",null!==f&&(g+="?"+f),null!==m&&(g+="#"+m),g},setHref:function(r){var i=this.parse(r);if(i)throw lA(i);this.searchParams.update()},getOrigin:function(){var r=this.scheme,i=this.port;if("blob"==r)try{return new tv(r.path[0]).origin}catch{return"null"}return"file"!=r&&this.isSpecial()?r+"://"+J_(this.host)+(null!==i?":"+i:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(r){this.parse(bl(r)+":",gA)},getUsername:function(){return this.username},setUsername:function(r){var i=Ic(bl(r));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var o=0;o<i.length;o++)this.username+=bi(i[o],US)}},getPassword:function(){return this.password},setPassword:function(r){var i=Ic(bl(r));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var o=0;o<i.length;o++)this.password+=bi(i[o],US)}},getHost:function(){var r=this.host,i=this.port;return null===r?"":null===i?J_(r):J_(r)+":"+i},setHost:function(r){this.cannotBeABaseURL||this.parse(r,Q_)},getHostname:function(){var r=this.host;return null===r?"":J_(r)},setHostname:function(r){this.cannotBeABaseURL||this.parse(r,EA)},getPort:function(){var r=this.port;return null===r?"":bl(r)},setPort:function(r){this.cannotHaveUsernamePasswordPort()||(""==(r=bl(r))?this.port=null:this.parse(r,BS))},getPathname:function(){var r=this.path;return this.cannotBeABaseURL?r[0]:r.length?"/"+q_(r,"/"):""},setPathname:function(r){this.cannotBeABaseURL||(this.path=[],this.parse(r,Rc))},getSearch:function(){var r=this.query;return r?"?"+r:""},setSearch:function(r){""==(r=bl(r))?this.query=null:("?"==Xs(r,0)&&(r=Uf(r,1)),this.query="",this.parse(r,Oo)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var r=this.fragment;return r?"#"+r:""},setHash:function(r){""!=(r=bl(r))?("#"==Xs(r,0)&&(r=Uf(r,1)),this.fragment="",this.parse(r,Cl)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var tv=function(r){var i=mz(this,No),o=c5(arguments.length,1)>1?arguments[1]:void 0,a=JL(i,new hx(r,!1,o));YL||(i.href=a.serialize(),i.origin=a.getOrigin(),i.protocol=a.getProtocol(),i.username=a.getUsername(),i.password=a.getPassword(),i.host=a.getHost(),i.hostname=a.getHostname(),i.port=a.getPort(),i.pathname=a.getPathname(),i.search=a.getSearch(),i.searchParams=a.getSearchParams(),i.hash=a.getHash())},No=tv.prototype,Zs=function(r,i){return{get:function(){return kS(this)[r]()},set:i&&function(o){return kS(this)[i](o)},configurable:!0,enumerable:!0}};if(YL&&(ka(No,"href",Zs("serialize","setHref")),ka(No,"origin",Zs("getOrigin")),ka(No,"protocol",Zs("getProtocol","setProtocol")),ka(No,"username",Zs("getUsername","setUsername")),ka(No,"password",Zs("getPassword","setPassword")),ka(No,"host",Zs("getHost","setHost")),ka(No,"hostname",Zs("getHostname","setHostname")),ka(No,"port",Zs("getPort","setPort")),ka(No,"pathname",Zs("getPathname","setPathname")),ka(No,"search",Zs("getSearch","setSearch")),ka(No,"searchParams",Zs("getSearchParams")),ka(No,"hash",Zs("getHash","setHash"))),wc(No,"toJSON",function(){return kS(this).serialize()},{enumerable:!0}),wc(No,"toString",function(){return kS(this).serialize()},{enumerable:!0}),K_){var bA=K_.createObjectURL,y5=K_.revokeObjectURL;bA&&wc(tv,"createObjectURL",r5(bA,K_)),y5&&wc(tv,"revokeObjectURL",r5(y5,K_))}a5(tv,"URL"),pz({global:!0,constructor:!0,forced:!fz,sham:!YL},{URL:tv});var b5=xt,S5=Pt,jS=Tr,nv=qo,px=jb,fx=yo("URL");b5({target:"URL",stat:!0,forced:!(px&&S5(function(){fx.canParse()}))},{canParse:function(r){var i=jS(arguments.length,1),o=nv(r),a=i<2||void 0===arguments[1]?void 0:nv(arguments[1]);try{return!!new fx(o,a)}catch{return!1}}});var SA=Ht(Qi.URL);const Hn={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function ct(){return Hn}function mx(){return"setSinkId"in HTMLAudioElement.prototype&&(!B("RESTRICTION_SET_PLAYBACK_DEVICE")||(hh()||lS())&&!mR())}function C5(){return!Hn.supportUnifiedPlan||B("CHROME_FORCE_PLAN_B")&&pl()}let Ir=function(r){return r.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",r.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",r.IOS_INTERRUPTION_START="ios-interruption-start",r.IOS_INTERRUPTION_END="ios-interruption-end",r.STATE_CHANGE="state-change",r}({});function Bf(r,i,o){return{sampleRate:r,stereo:i,bitrate:o}}function Xe(r,i,o,a,l){return{width:r,height:i,frameRate:o,bitrateMin:a,bitrateMax:l}}function xa(r,i,o,a,l){return{width:{max:r},height:{max:i},frameRate:o,bitrateMin:a,bitrateMax:l}}function CA(r,i){return{numSpatialLayers:r,numTemporalLayers:i}}const gx={"90p":Xe(160,90),"90p_1":Xe(160,90),"120p":Xe(160,120,15,30,65),"120p_1":Xe(160,120,15,30,65),"120p_3":Xe(120,120,15,30,50),"120p_4":Xe(212,120),"180p":Xe(320,180,15,30,140),"180p_1":Xe(320,180,15,30,140),"180p_3":Xe(180,180,15,30,100),"180p_4":Xe(240,180,15,30,120),"240p":Xe(320,240,15,40,200),"240p_1":Xe(320,240,15,40,200),"240p_3":Xe(240,240,15,40,140),"240p_4":Xe(424,240,15,40,220),"360p":Xe(640,360,15,80,400),"360p_1":Xe(640,360,15,80,400),"360p_3":Xe(360,360,15,80,260),"360p_4":Xe(640,360,30,80,600),"360p_6":Xe(360,360,30,80,400),"360p_7":Xe(480,360,15,80,320),"360p_8":Xe(480,360,30,80,490),"360p_9":Xe(640,360,15,80,800),"360p_10":Xe(640,360,24,80,800),"360p_11":Xe(640,360,24,80,1e3),"480p":Xe(640,480,15,100,500),"480p_1":Xe(640,480,15,100,500),"480p_2":Xe(640,480,30,100,1e3),"480p_3":Xe(480,480,15,100,400),"480p_4":Xe(640,480,30,100,750),"480p_6":Xe(480,480,30,100,600),"480p_8":Xe(848,480,15,100,610),"480p_9":Xe(848,480,30,100,930),"480p_10":Xe(640,480,10,100,400),"720p":Xe(1280,720,15,120,1130),"720p_auto":Xe(1280,720,30,900,3e3),"720p_1":Xe(1280,720,15,120,1130),"720p_2":Xe(1280,720,30,120,2e3),"720p_3":Xe(1280,720,30,120,1710),"720p_5":Xe(960,720,15,120,910),"720p_6":Xe(960,720,30,120,1380),"1080p":Xe(1920,1080,15,120,2080),"1080p_1":Xe(1920,1080,15,120,2080),"1080p_2":Xe(1920,1080,30,120,3e3),"1080p_3":Xe(1920,1080,30,120,3150),"1080p_5":Xe(1920,1080,60,120,4780),"1440p":Xe(2560,1440,30,120,4850),"1440p_1":Xe(2560,1440,30,120,4850),"1440p_2":Xe(2560,1440,60,120,7350),"4k":Xe(3840,2160,30,120,8910),"4k_1":Xe(3840,2160,30,120,8910),"4k_3":Xe(3840,2160,60,120,13500)},_z={"480p":xa(640,480,5),"480p_1":xa(640,480,5),"480p_2":xa(640,480,30),"480p_3":xa(640,480,15),"720p":xa(1280,720,5),"720p_auto":Xe(1280,720,30,900,3e3),"720p_1":xa(1280,720,5),"720p_2":xa(1280,720,30),"720p_3":xa(1280,720,15),"1080p":xa(1920,1080,5),"1080p_1":xa(1920,1080,5),"1080p_2":xa(1920,1080,30),"1080p_3":xa(1920,1080,15)},vz={"1SL1TL":CA(1,1),"3SL3TL":CA(3,3),"2SL3TL":CA(2,3)};function Tl(r){return r||(r="480p_1"),"string"==typeof r?Object.assign({},gx[r]):r}function _x(r){return"string"==typeof r?Object.assign({},_z[r]):r}function TA(r){return"string"==typeof r?Object.assign({},vz[r]):r}const Ez={speech_low_quality:Bf(16e3,!1),speech_standard:Bf(32e3,!1,18),music_standard:Bf(48e3,!1),standard_stereo:Bf(48e3,!0,56),high_quality:Bf(48e3,!1,128),high_quality_stereo:Bf(48e3,!0,192)};function wA(r){return"string"==typeof r?Object.assign({},Ez[r]):r}const Ch=[];function Js(r){return pr(r,"mediaSource",["screen","window","application"]),!0}let ge=function(r){return r.NEED_RENEGOTIATE="@need_renegotiate",r.NEED_REPLACE_TRACK="@need_replace_track",r.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",r.NEED_CLOSE="@need_close",r.NEED_ENABLE_TRACK="@need_enable_track",r.NEED_DISABLE_TRACK="@need_disable_track",r.NEED_SESSION_ID="@need_sid",r.SET_OPTIMIZATION_MODE="@set_optimization_mode",r.GET_STATS="@get_stats",r.GET_RTC_STATS="@get_rtc_stats",r.GET_LOW_VIDEO_TRACK="@get_low_video_track",r.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",r.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",r.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",r.NEED_MUTE_TRACK="@need_mute_track",r.NEED_UNMUTE_TRACK="@need_unmute_track",r}({}),zt=function(r){return r.SCREEN_TRACK="screen_track",r.CUSTOM_TRACK="custome_track",r.LOW_STREAM="low_stream",r.SCREEN_LOW_TRACK="screen_low_track",r}({}),rv=function(r){return r[r.HIGH_STREAM=0]="HIGH_STREAM",r[r.LOW_STREAM=1]="LOW_STREAM",r}({}),yz=function(r){return r[r.HIGH_STREAM=0]="HIGH_STREAM",r[r.LOW_STREAM=1]="LOW_STREAM",r[r.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",r[r.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",r[r.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",r[r.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",r[r.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",r[r.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",r}({}),bz=function(r){return r[r.DISABLE=0]="DISABLE",r[r.LOW_STREAM=1]="LOW_STREAM",r[r.AUDIO_ONLY=2]="AUDIO_ONLY",r[r.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",r[r.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",r[r.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",r[r.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",r[r.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",r[r.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",r}({}),jf=function(r){return r.TRANSCEIVER_UPDATED="transceiver-updated",r.SEI_TO_SEND="sei-to-send",r.SEI_RECEIVED="sei-received",r.TRACK_UPDATED="track-updated",r}({}),iv=function(r){return r.SOURCE_STATE_CHANGE="source-state-change",r.TRACK_ENDED="track-ended",r.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",r.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",r.CLOSED="closed",r}({}),Th=function(r){return r.FIRST_FRAME_DECODED="first-frame-decoded",r.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",r.VIDEO_STATE_CHANGED="video-state-changed",r}({}),wl=function(r){return r.AUDIO="audio",r.VIDEO="video",r.DATA="data",r}({}),ss=function(r){return r.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",r.RECEIVE_TRACK_BUFFER="receive_track_buffer",r.ON_AUDIO_BUFFER="on_audio_buffer",r.UPDATE_SOURCE="update_source",r}({});const IA={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},HS={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Vd={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},vx={uplinkNetworkQuality:0,downlinkNetworkQuality:0},GS={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let di=function(r){return r.ON_TRACK="on_track",r.ON_NODE="on_node",r}({}),as=function(r){return r.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",r.REQUEST_CONSTRAINTS="request_constraints",r}({}),wh=function(r){return r.IDLE="IDLE",r.INITING="INITING",r.INITEND="INITEND",r}({}),Il=function(r){return r.STATE_CHANGE="state_change",r.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",r.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",r.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",r}({}),Kr=function(r){return r.NONE="none",r.INIT="init",r.CANPLAY="canplay",r.PLAYING="playing",r.PAUSED="paused",r.SUSPEND="suspend",r.STALLED="stalled",r.WAITING="waiting",r.ERROR="error",r.DESTROYED="destroyed",r.ABORT="abort",r.ENDED="ended",r.EMPTIED="emptied",r.LOADEDDATA="loadeddata",r}({}),Rl=function(r){return r[r.VideoStateStopped=0]="VideoStateStopped",r[r.VideoStateStarting=1]="VideoStateStarting",r[r.VideoStateDecoding=2]="VideoStateDecoding",r[r.VideoStateFrozen=3]="VideoStateFrozen",r}({});const Ex={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let RA=function(r){return r.OPEN="open",r.MESSAGE="message",r.CLOSE="close",r.CLOSING="closing",r.ERROR="error",r}({});function Qe(r,i,o,a,l){var d,h,f={};return Object.keys(a).forEach(function(m){f[m]=a[m]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=Ue(d=z_(h=o.slice()).call(h)).call(d,function(m,g){return g(r,i,m)||m},f),l&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(l):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(r,i,f),f=null),f}function $(r,i,o){return(i="symbol"==typeof(l=function(d){if("object"!=typeof d||!d)return d;var f=d[Symbol.toPrimitive];if(void 0!==f){var m=f.call(d,"string");if("object"!=typeof m)return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(i))?l:l+"")in r?Object.defineProperty(r,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[i]=o,r;var l}function yx(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function rn(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?yx(Object(o),!0).forEach(function(a){$(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):yx(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}class bx extends nn{set _mediaStreamTrack(i){i!==this.mediaStreamTrack&&(this.safeEmit(jf.TRACK_UPDATED,i),this.mediaStreamTrack=i)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(i,o){super(),$(this,"trackMediaType",void 0),$(this,"_ID",void 0),$(this,"_rtpTransceiver",void 0),$(this,"_lowRtpTransceiver",void 0),$(this,"_hints",[]),$(this,"_isClosed",!1),$(this,"_originMediaStreamTrack",void 0),$(this,"mediaStreamTrack",void 0),$(this,"_external",{}),this._ID=o||Ct(8,"track-"),this._originMediaStreamTrack=i,this.mediaStreamTrack=i,he(Ch).call(Ch,this)||Ch.push(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(i){return i||yc(()=>{var o;be.reportApiInvoke(null,{name:Yn.GET_MEDIA_STREAM_TRACK,options:[],tag:st.TRACER}).onSuccess((null===(o=this._mediaStreamTrack)||void 0===o?void 0:o.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(i){return i===rv.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(i){const o=Ch.indexOf(i);-1!==o&&Ch.splice(o,1)}(this),this.emit(iv.CLOSED),this.removeAllListeners(jf.SEI_RECEIVED)}_updateRtpTransceiver(i,o){if(o===rv.LOW_STREAM){if(this._lowRtpTransceiver===i)return;this._lowRtpTransceiver=i}else{if(this._rtpTransceiver===i)return;this._rtpTransceiver=i}this.emit(jf.TRANSCEIVER_UPDATED,i,o)}}class Ih extends bx{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(i,o){super(i,o),$(this,"_enabled",!0),$(this,"_muted",!1),$(this,"_isExternalTrack",!1),$(this,"_isClosed",!1),$(this,"_enabledMutex",void 0),$(this,"processor",void 0),$(this,"_processorContext",void 0),$(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Qr("".concat(this.getTrackId())),i.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var i,o;return null!==(i=null===(o=this._originMediaStreamTrack)||void 0===o?void 0:o.label)&&void 0!==i?i:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,T.debug("[".concat(this.getTrackId(),"] close")),this.emit(ge.NEED_CLOSE),super.close())}_updateOriginMediaStreamTrack(i,o){var a=arguments,l=this;return L(function*(){l._isExternalTrack=a.length>2&&void 0!==a[2]&&a[2],i!==l._originMediaStreamTrack&&(l._originMediaStreamTrack&&(l._originMediaStreamTrack.removeEventListener("ended",l._handleTrackEnded),o&&l._originMediaStreamTrack.stop()),i.addEventListener("ended",l._handleTrackEnded),l._originMediaStreamTrack=i,l._muted&&(l._originMediaStreamTrack.enabled=!1),l._mediaStreamTrack=l._originMediaStreamTrack,l._updatePlayerSource(),yield Bt(l,ge.NEED_REPLACE_TRACK,l),l.processor&&l._processorContext&&l.processor.updateInput({track:l._originMediaStreamTrack,context:l._processorContext}))})()}_getDefaultPlayerConfig(){return{}}onTrackEnded(){T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(iv.TRACK_ENDED)}stateCheck(i,o){if(T.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(i,": ").concat(o,"]")),fl(o,i),this._enabled&&this._muted&&"enabled"===i&&!1===o)throw new Y(k.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",T);if(!this._enabled&&!this._muted&&"muted"===i&&!0===o)throw new Y(k.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",T)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():le.resolve([])}}const AA=window.AudioContext||window.webkitAudioContext;let Po=null;const Lt=new class extends nn{constructor(){var r;super(...arguments),r=this,$(this,"prevState",void 0),$(this,"curState",void 0),$(this,"currentTime",void 0),$(this,"currentTimeStuckAt",void 0),$(this,"interruptDetectorTrack",void 0),$(this,"onLocalAudioTrackMute",()=>{T.info("ios15-interruption-start"),this.emit(Ir.IOS_15_16_INTERRUPTION_START)}),$(this,"onLocalAudioTrackUnmute",L(function*(){T.info("ios15-interruption-end"),"running"!==r.curState||r.duringInterruption?T.info("ios15-interruption-end-canceled"):(Po&&(yield Po.suspend()),r.emit(Ir.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(r){T.debug("webaudio bindInterruptDetectorTrack ".concat(r.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=r,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(r){T.debug("webaudio unbindInterruptDetectorTrack ".concat(r.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===r&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Hf(){if(!Po){if(function(){if(!AA)return void T.error("your browser is not support web audio");T.info("create audio context");const r=rn({},B("WEBAUDIO_INIT_OPTIONS"));var i;T.debug("audio context init option:",JSON.stringify(r)),Po=new AA(r),Lt.curState=Po.state,Po.onstatechange=()=>{Lt.prevState=Lt.curState,Lt.curState=Po?Po.state:void 0;const{prevState:i,curState:o}=Lt,a="running"===o,l="interrupted"===o,d="running"===i,h="suspended"===i,f="interrupted"===i,m=ot().osVersion;(nt()||Ks())&&d&&l&&(T.info("ios".concat(m,"-interruption-start")),Lt.emit(Ir.IOS_INTERRUPTION_START)),(nt()||Ks())&&(h||f)&&a&&(T.info("ios".concat(m,"-interruption-end")),Lt.emit(Ir.IOS_INTERRUPTION_END)),i!==o&&Lt.emit(Ir.STATE_CHANGE,o,i)},setInterval(()=>{var i;const o=null===(i=Po)||void 0===i?void 0:i.currentTime;Lt.currentTime!==o?(Lt.currentTimeStuckAt&&(T.debug("AudioContext current time resume at ".concat(o)),Lt.currentTimeStuckAt=void 0),Lt.currentTime=o):(o!==Lt.currentTimeStuckAt&&(be.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:o},tag:st.TRACER}).onSuccess(),T.warning("AudioContext current time stuck at ".concat(o))),Lt.currentTimeStuckAt=o)},5e3),(i=L(function*(o){const a=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let l,d=!1,h=!1,f=!1;function m(A){"running"===o.state?g(!1):nt()||Ks()?"suspended"===o.state&&(g(!0),A&&o.resume().then(v,v)):"closed"!==o.state&&(g(!0),A&&o.resume().then(v,v))}function g(A){if(d!==A){d=A;for(let O=0,M=a;O<M.length;O+=1){const x=M[O];A?window.addEventListener(x,y,{capture:!0,passive:!0}):window.removeEventListener(x,y,{capture:!0,passive:!0})}}}function v(){m(!1)}function y(){m(!0)}function b(A){if(!f)if(l.paused)if(A){let O;C(!1),f=!0;try{O=l.play(),O?O.then(P,P):(l.addEventListener("playing",P),l.addEventListener("abort",P),l.addEventListener("error",P))}catch{P()}}else C(!0);else C(!1)}function C(A){if(h!==A){h=A;for(let O=0,M=a;O<M.length;O++){const x=M[O];A?window.addEventListener(x,R,{capture:!0,passive:!0}):window.removeEventListener(x,R,{capture:!0,passive:!0})}}}function P(){l.removeEventListener("playing",P),l.removeEventListener("abort",P),l.removeEventListener("error",P),f=!1,b(!1)}function R(){b(!0)}if(nt()){const A=o.createMediaStreamDestination(),O=document.createElement("div");O.innerHTML="<audio x-webkit-airplay='deny'></audio>",l=O.children.item(0),l.controls=!1,l.disableRemotePlayback=!0,l.preload="auto",l.srcObject=A.stream,b(!0)}Lt.on(Ir.STATE_CHANGE,function(){m(!0)}),m(!1)}),function(o){return i.apply(this,arguments)})(Po)}(),!Po)throw new Y(k.NOT_SUPPORTED,"can not create audio context");return Po}return Po}function Bd(r){if(function(){if(null!==ov)return ov;const a=Hf(),l=a.createBufferSource(),d=a.createGain(),h=a.createGain();l.connect(d),l.connect(h),l.disconnect(d);let f=!1;try{l.disconnect(d)}catch{f=!0}return l.disconnect(),ov=f,f}())return;const i=r.connect,o=r.disconnect;r.connect=(a,l,d)=>{var h;return r._inputNodes||(r._inputNodes=[]),he(h=r._inputNodes).call(h,a)||(a instanceof AudioNode?(r._inputNodes.push(a),i.call(r,a,l,d)):i.call(r,a,l)),r},r.disconnect=(a,l,d)=>{o.call(r),a?Be(r._inputNodes,a):r._inputNodes=[];for(const h of r._inputNodes)i.call(r,h)}}let ov=null;function Sx(r,i){let o=!1;const a=1/i;if(B("DISABLE_WEBAUDIO")){const l=window.setInterval(()=>{o?window.clearInterval(l):r(performance.now()/1e3)},1e3*a)}else{const l=Hf();let d=l.createGain();d.gain.value=0,d.connect(l.destination);const h=()=>{if(o)return void(d=null);const f=l.createOscillator();f.onended=h,f.connect(d),f.start(0),f.stop(l.currentTime+a),r(l.currentTime)};h()}return()=>{o=!0}}class DA{constructor(){$(this,"context",void 0),$(this,"analyserNode",void 0),$(this,"sourceNode",void 0),this.context=Hf(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(i){if(i!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=i,i?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||nt()||Ks()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode))return 0;const i=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(i);else{const a=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(a);for(let l=0;l<i.length;++l)i[l]=a[l]/128-1}const o=Ue(i).call(i,(a,l)=>a+l*l,0)/i.length;return Math.max(10*Math.log10(o)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var i,o;null===(i=this.sourceNode)||void 0===i||i.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(o=this.sourceNode)||void 0===o||o.connect(this.analyserNode)}catch{T.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class sv extends nn{get processSourceNode(){return this.sourceNode}set processedNode(i){var o;if(!this.isDestroyed&&this._processedNode!==i){try{var a;null===(a=this.sourceNode)||void 0===a||a.disconnect(this.outputNode)}catch{}null===(o=this._processedNode)||void 0===o||o.disconnect(),this._processedNode=i,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),$(this,"outputNode",void 0),$(this,"outputTrack",void 0),$(this,"isPlayed",!1),$(this,"sourceNode",void 0),$(this,"context",void 0),$(this,"audioBufferNode",void 0),$(this,"destNode",void 0),$(this,"audioOutputLevel",0),$(this,"volumeLevelAnalyser",void 0),$(this,"_processedNode",void 0),$(this,"playNode",void 0),$(this,"isDestroyed",!1),$(this,"onNoAudioInput",void 0),$(this,"isNoAudioInput",!1),$(this,"_noAudioInputCount",0),this.context=Hf(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Bd(this.outputNode),this.volumeLevelAnalyser=new DA}startGetAudioBuffer(i){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(i),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=o=>{this.emit(ss.ON_AUDIO_BUFFER,function(a){for(let l=0;l<a.outputBuffer.numberOfChannels;l+=1){const d=a.outputBuffer.getChannelData(l);for(let h=0;h<d.length;h+=1)d[h]=0}return a.inputBuffer}(o))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!ct().webAudioMediaStreamDest)throw new Y(k.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(i){"running"!==this.context.state&&D_(()=>{Lt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=i||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}checkHasAudioInput(){var i=arguments,o=this;return L(function*(){let a=i.length>0&&void 0!==i[0]?i[0]:0;if(a>5)return o.isNoAudioInput=!0,o.onNoAudioInput&&o.onNoAudioInput(),!1;nt()||Ks()?"suspended"===o.context.state&&o.context.resume():"running"!==o.context.state&&o.context.resume();const l=o.volumeLevelAnalyser.getAnalyserNode();let d;l.getFloatTimeDomainData?(d=new Float32Array(l.fftSize),l.getFloatTimeDomainData(d)):(d=new Uint8Array(l.fftSize),l.getByteTimeDomainData(d));let h=!1;for(let f=0;f<d.length;f++)0!==d[f]&&(h=!0);return h?(o.isNoAudioInput=!1,!0):(yield wr(200),(yield o.checkHasAudioInput(a?a+1:1))&&h)})()}getAudioVolume(){return this.outputNode.gain.value}setVolume(i){this.outputNode.gain.setValueAtTime(i,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var i,o;null===(i=this.processedNode)||void 0===i||i.disconnect(),null===(o=this.sourceNode)||void 0===o||o.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var i;this.processedNode?null===(i=this.processedNode)||void 0===i||i.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class Cx extends sv{get isFreeze(){return!1}constructor(i,o,a){var l,d;if(super(),l=this,$(this,"sourceNode",void 0),$(this,"track",void 0),$(this,"clonedTrack",void 0),$(this,"audioElement",void 0),$(this,"isCurrentTrackCloned",!1),$(this,"isRemoteTrack",!1),$(this,"originVolumeLevelAnalyser",void 0),$(this,"rebuildWebAudio",L(function*(){if(T.debug("ready to rebuild web audio, state:",l.context.state),l.isNoAudioInput&&(yield l.checkHasAudioInput()),!l.isNoAudioInput||l.isDestroyed)return document.body.removeEventListener("click",l.rebuildWebAudio,!0),void T.debug("rebuild web audio success, current volume status",l.getAccurateVolumeLevel());l.context.resume().then(()=>T.info("resume success")),T.debug("rebuild web audio because of ios 12 bugs"),l.disconnect();const m=l.track;l.track=l.track.clone(),l.isCurrentTrackCloned?m.stop():l.isCurrentTrackCloned=!0;const g=new MediaStream([l.track]);l.sourceNode=l.context.createMediaStreamSource(g),Bd(l.sourceNode),l.volumeLevelAnalyser.rebuildAnalyser();const v=l.outputNode.gain.value;l.outputNode=l.context.createGain(),l.outputNode.gain.setValueAtTime(v,l.context.currentTime),Bd(l.outputNode),l.emit(ss.UPDATE_SOURCE),l.connect(),l.audioElement.srcObject=g,l.isPlayed&&l.play(l.playNode),l.checkHasAudioInput()})),"audio"!==i.kind)throw new Y(k.UNEXPECTED_ERROR);this.track=i;const h=new MediaStream([this.track]);if(this.isRemoteTrack=!!o,this.sourceNode=this.context.createMediaStreamSource(h),Bd(this.sourceNode),a){const m=a.clone();m.enabled=!0,this.clonedTrack=m,T.debug("create an unmuted track ".concat(m.id," from the original track ").concat(a.id," to get the volume"));const g=this.context.createMediaStreamSource(new MediaStream([m]));Bd(g),this.originVolumeLevelAnalyser=new DA,this.originVolumeLevelAnalyser.updateSource(g)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=h;const f=ot();o&&f.os===hr.IOS&&Number(null===(d=f.osVersion)||void 0===d?void 0:d.split(".")[0])<15&&(Lt.on(Ir.STATE_CHANGE,()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(i){this.sourceNode.disconnect(),this.track=i,this.isCurrentTrackCloned=!1;const o=new MediaStream([i]);this.sourceNode=this.context.createMediaStreamSource(o),Bd(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(ss.UPDATE_SOURCE),this.audioElement.srcObject=o}destroy(){var i;this.audioElement.srcObject=null,this.audioElement.remove(),Lt.off("state-change",this.rebuildWebAudio),null===(i=this.originVolumeLevelAnalyser)||void 0===i||i.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(i){return this.context.createMediaStreamSource(new MediaStream([i]))}updateOriginTrack(i){const o=i.clone();o.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=o),T.debug("create an unmuted track ".concat(o.id," from the original track ").concat(i.id," to get the volume"));const a=this.context.createMediaStreamSource(new MediaStream([o]));Bd(a),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(a)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}function Tx(r,i,o){return wx.apply(this,arguments)}function wx(){return wx=L(function*(r,i,o){const a=(d,h)=>d?"number"!=typeof d?d.max||d.exact||d.ideal||d.min||h:d:h,l={audio:!!o&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxHeight:a(i.height,1080),maxWidth:a(i.width,1920)}}};return i.frameRate&&"number"!=typeof i.frameRate?(l.video.mandatory.maxFrameRate=i.frameRate.max,l.video.mandatory.minFrameRate=i.frameRate.min):"number"==typeof i.frameRate&&(l.video.mandatory.maxFrameRate=i.frameRate),yield navigator.mediaDevices.getUserMedia(l)}),wx.apply(this,arguments)}function Ix(){return Ix=L(function*(r,i){const o=yield T5(r.mediaSource),{sourceId:a,audio:l}=yield function(d){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new le((f,m)=>{const g=document.createElement("div");g.innerText="share screen",g.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const v=document.createElement("div");v.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const y=document.createElement("div");y.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",y.setAttribute("style","height: 12%;");const b=document.createElement("div");b.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const C=document.createElement("div");C.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const P=document.createElement("button");P.innerHTML="cancel",P.setAttribute("style","width: 85px;"),P.onclick=()=>{document.body.removeChild(O);const M=new Error("NotAllowedError");M.name="NotAllowedError",m(M)};let R=h;const A=document.createElement("div");if(h){const M=document.createElement("input");M.setAttribute("type","checkbox");const x=document.createElement("span");M.setAttribute("style","margin-right: 6px;"),x.innerText="Share audio",M.checked=R,M.onchange=()=>{R=M.checked},A.appendChild(M),A.appendChild(x)}C.appendChild(A),C.appendChild(P),v.appendChild(y),v.appendChild(b),v.appendChild(C);const O=document.createElement("div");O.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),O.appendChild(g),O.appendChild(v),document.body.appendChild(O),d.map(M=>{if(M.id){const x=document.createElement("div");x.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let j=M.thumbnail;try{const{width:W}=j.getSize();W>1920&&(j=j.resize({width:1920}))}catch(W){throw W&&W.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),W}x.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+j.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+M.name.replace(/[\u00A0-\u9999<>\&]/g,function(W){return"&#"+W.charCodeAt(0)+";"})+"</span>",x.onclick=()=>{document.body.removeChild(O),f({sourceId:M.id,audio:R})},b.appendChild(x)}})})}(o,i);return yield Tx(a,r,l)}),Ix.apply(this,arguments)}function T5(r){return Rx.apply(this,arguments)}function Rx(){return Rx=L(function*(r){let i=["window","screen"];"application"!==r&&"window"!==r||(i=["window"]),"screen"===r&&(i=["screen"]);const o=yR();if(!o)throw console.error("failed to fetch electron, please mount it to window"),new Y(k.ELECTRON_IS_NULL);let a=null;try{var l;a=(null===(l=o.desktopCapturer)||void 0===l?void 0:l.getSources({types:i}))||o.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:i})}catch{a=null}a&&a.then||(a=new le((d,h)=>{o.desktopCapturer.getSources({types:i},(f,m)=>{f?h(f):d(m)})}));try{return yield a}catch(d){throw new Y(k.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}),Rx.apply(this,arguments)}const ei=new Qr("safari");let Gf=!1,av=!1;function Gi(r,i){return WS.apply(this,arguments)}function WS(){return WS=L(function*(r,i){let o=0,a=null;for(;o<2;)try{a=yield Cz(r,i,o>0);break}catch(l){if(l instanceof Y)throw T.error("[".concat(i,"] ").concat(l.toString())),l;const d=NA(l.name||l.code||l,l.message);if(d.code===k.MEDIA_OPTION_INVALID){T.debug("[".concat(i,"] detect media option invalid, retry")),o+=1,yield wr(500);continue}throw T.error("[".concat(i,"] ").concat(d.toString())),d}if(!a)throw new Y(k.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return a}),WS.apply(this,arguments)}function Cz(r,i,o){return OA.apply(this,arguments)}function OA(){return OA=L(function*(r,i,o){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Y(k.NOT_SUPPORTED,"can not find getUserMedia");o&&(r.video&&(delete r.video.width,delete r.video.height),r.screen&&(delete r.screen.width,delete r.screen.height));const a=ct(),l=new MediaStream;if(r.audioSource&&l.addTrack(r.audioSource),r.videoSource&&l.addTrack(r.videoSource),!r.audio&&!r.video&&!r.screen)return T.debug("Using Video Source/ Audio Source"),l;if(r.screen)if(yR())cv(l,r.screen.sourceId?yield Tx(r.screen.sourceId,r.screen,!!r.screenAudio):yield function Sz(r,i){return Ix.apply(this,arguments)}(r.screen,!!r.screenAudio));else if(hh()&&r.screen.extensionId&&r.screen.mandatory){if(!a.getStreamFromExtension)throw new Y(k.NOT_SUPPORTED,"This browser does not support screen sharing");T.debug("[".concat(i,'] Screen access on chrome stable, looking for extension"'));const b=yield(h=r.screen.extensionId,f=i,new le((C,P)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},R=>{if(!R||!R.streamId)return T.error("[".concat(f,"] No response from Chrome Plugin. Plugin not installed properly"),R),void P(new Y(k.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));C(R.streamId)})}catch(R){T.error("[".concat(f,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),R.toString()),P(new Y(k.CHROME_PLUGIN_NOT_INSTALL))}}));r.screen.mandatory.chromeMediaSourceId=b,cv(l,yield navigator.mediaDevices.getUserMedia({video:{mandatory:r.screen.mandatory}}))}else if(a.getDisplayMedia){var d;r.screen.mediaSource&&Js(r.screen.mediaSource);const b={width:r.screen.width,height:r.screen.height,frameRate:r.screen.frameRate,displaySurface:null!==(d=r.screen.displaySurface)&&void 0!==d?d:"screen"===r.screen.mediaSource?"monitor":r.screen.mediaSource},{selfBrowserSurface:C,surfaceSwitching:P,systemAudio:R}=r.screen,A={selfBrowserSurface:C,surfaceSwitching:P,systemAudio:R};!C&&delete A.selfBrowserSurface,!P&&delete A.surfaceSwitching,!R&&delete A.systemAudio,T.debug("[".concat(i,"] getDisplayMedia:"),JSON.stringify({video:b,audio:r.screenAudio,controls:A})),cv(l,yield navigator.mediaDevices.getDisplayMedia(rn({video:b,audio:r.screenAudio},A)))}else{if(!hn())throw T.error("[".concat(i,"] This browser does not support screenSharing")),new Y(k.NOT_SUPPORTED,"This browser does not support screen sharing");{r.screen.mediaSource&&Js(r.screen.mediaSource);const b={video:{mediaSource:r.screen.mediaSource,width:r.screen.width,height:r.screen.height,frameRate:r.screen.frameRate}};T.debug("[".concat(i,"] getUserMedia: ").concat(JSON.stringify(b))),cv(l,yield navigator.mediaDevices.getUserMedia(b))}}var h,f;if(!r.video&&!r.audio)return l;let m={video:r.video,audio:r.audio},g=B("MEDIA_DEVICE_CONSTRAINTS");if(g)try{"string"==typeof g&&(g=JSON.parse(g)),m=aL(m,g)}catch{}T.debug("[".concat(i,"] GetUserMedia"),JSON.stringify(m)),ot();let v,y=null;($e()||nt()||T_())&&(y=yield ei.lock());try{v=yield navigator.mediaDevices.getUserMedia(m)}catch(b){throw y&&y(),b}return m.audio&&(Gf=!0),m.video&&(av=!0),cv(l,v),y&&y(),l}),OA.apply(this,arguments)}function NA(r,i){switch(r){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Y(k.MEDIA_OPTION_INVALID,"".concat(r,": ").concat(i));case"NotFoundError":case"DevicesNotFoundError":return new Y(k.DEVICE_NOT_FOUND,"".concat(r,": ").concat(i));case"NotSupportedError":return new Y(k.NOT_SUPPORTED,"".concat(r,": ").concat(i));case"NotReadableError":return new Y(k.NOT_READABLE,"".concat(r,": ").concat(i));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Y(k.PERMISSION_DENIED,"".concat(r,": ").concat(i));case"ConstraintNotSatisfiedError":return new Y(k.CONSTRAINT_NOT_SATISFIED,"".concat(r,": ").concat(i));default:return T.error("getUserMedia unexpected error",r),new Y(k.UNEXPECTED_ERROR,"".concat(r,": ").concat(i))}}function cv(r,i){const o=r.getVideoTracks()[0],a=r.getAudioTracks()[0],l=i.getVideoTracks()[0],d=i.getAudioTracks()[0];d&&(a&&r.removeTrack(a),r.addTrack(d)),l&&(o&&r.removeTrack(o),r.addTrack(l))}const po=new class extends nn{get state(){return this._state}set state(r){r!==this._state&&(this.emit(Il.STATE_CHANGE,r),this._state=r)}constructor(){super(),$(this,"_state",wh.IDLE),$(this,"isAccessMicrophonePermission",!1),$(this,"isAccessCameraPermission",!1),$(this,"lastAccessMicrophonePermission",!1),$(this,"lastAccessCameraPermission",!1),$(this,"checkdeviceMatched",!1),$(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(B("ENUMERATE_DEVICES_INTERVAL")||(hS()||C_()===hr.HARMONY_OS)&&pl())&&this.updateDevicesInfo()},B("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(r=>T.error(r.toString()))}enumerateDevices(r,i){var o=arguments,a=this;return L(function*(){let l=o.length>2&&void 0!==o[2]&&o[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Y(k.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const d=yield navigator.mediaDevices.enumerateDevices(),h=a.checkMediaDeviceInfoIsOk(d);let f=!a.isAccessMicrophonePermission&&r,m=!a.isAccessCameraPermission&&i;h.audio&&(f=!1),h.video&&(m=!1);let g=null,v=null,y=null;if(!l&&(f||m)){if(ei.isLocked&&(T.debug("[device manager] wait GUM lock"),(yield ei.lock())(),T.debug("[device manager] GUM unlock")),Gf&&(f=!1,a.isAccessMicrophonePermission=!0),av&&(m=!1,a.isAccessCameraPermission=!0),T.debug("[device manager] check media device permissions",r,i,f,m),f&&m){try{y=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(b){const C=NA(b.name||b.code||b,b.message);if(C.code===k.PERMISSION_DENIED)throw C;T.warning("getUserMedia failed in getDevices",C)}a.isAccessCameraPermission=!0,a.isAccessMicrophonePermission=!0}else if(f){try{g=yield navigator.mediaDevices.getUserMedia({audio:r})}catch(b){const C=NA(b.name||b.code||b,b.message);if(C.code===k.PERMISSION_DENIED)throw C;T.warning("getUserMedia failed in getDevices",C)}a.isAccessMicrophonePermission=!0}else if(m){try{v=yield navigator.mediaDevices.getUserMedia({video:i})}catch(b){const C=NA(b.name||b.code||b,b.message);if(C.code===k.PERMISSION_DENIED)throw C;T.warning("getUserMedia failed in getDevices",C)}a.isAccessCameraPermission=!0}T.debug("[device manager] mic permission",r,"cam permission",i)}try{const b=yield navigator.mediaDevices.enumerateDevices();return g&&g.getTracks().forEach(C=>C.stop()),v&&v.getTracks().forEach(C=>C.stop()),y&&y.getTracks().forEach(C=>C.stop()),g=null,v=null,y=null,b}catch(b){return g&&g.getTracks().forEach(C=>C.stop()),v&&v.getTracks().forEach(C=>C.stop()),y&&y.getTracks().forEach(C=>C.stop()),g=null,v=null,y=null,new Y(k.ENUMERATE_DEVICES_FAILED,b.toString()).throw()}})()}getRecordingDevices(){var r=arguments,i=this;return L(function*(){let o=r.length>0&&void 0!==r[0]&&r[0];return(yield i.enumerateDevices(!0,!1,o)).filter(a=>"audioinput"===a.kind)})()}getCamerasDevices(){var r=arguments,i=this;return L(function*(){let o=r.length>0&&void 0!==r[0]&&r[0];return(yield i.enumerateDevices(!1,!0,o)).filter(a=>"videoinput"===a.kind)})()}getSpeakers(){var r=arguments,i=this;return L(function*(){let o=r.length>0&&void 0!==r[0]&&r[0];return(yield i.enumerateDevices(!0,!1,o)).filter(a=>"audiooutput"===a.kind)})()}searchDeviceIdByName(r){let i=null;return this.deviceInfoMap.forEach(o=>{o.device.label===r&&(i=o.device.deviceId)}),i}getDeviceById(r){var i=this;return L(function*(){const o=(yield i.enumerateDevices(!0,!0,!0)).find(a=>a.deviceId===r);if(!o)throw new Y(k.DEVICE_NOT_FOUND,"deviceId: ".concat(r));return o})()}init(){var r=this;return L(function*(){r.state=wh.INITING;try{yield r.updateDevicesInfo(),r.state=wh.INITEND}catch(i){throw T.warning("Device Detection functionality cannot start properly.",i.toString()),r.state=wh.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new Y(k.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),i}})()}updateDevicesInfo(){var r=this;return L(function*(){const i=yield r.enumerateDevices(!0,!0,!0),o=Date.now(),a=[];if(i[0]&&i[0].label&&!1===r.checkdeviceMatched){r.checkdeviceMatched=!0;const d=i.find(f=>"audioinput"===f.kind&&"default"===f.deviceId),h=i.find(f=>"audiooutput"===f.kind&&"default"===f.deviceId);T.debug(d&&h?h.groupId===d.groupId?"[device-check] default input ".concat(d.label," and output ").concat(h.label," is the same group"):"[device-check] default input ".concat(d.label," and output ").concat(h.label," is not the same group"):"[device-check] default input or output not found")}const l=r.checkMediaDeviceInfoIsOk(i);if(i.forEach(d=>{if(!d.deviceId)return;const h=r.deviceInfoMap.get("".concat(d.kind,"_").concat(d.deviceId));if("ACTIVE"!==(h?h.state:"INACTIVE")){const f={initAt:o,updateAt:o,device:d,state:"ACTIVE"};r.deviceInfoMap.set("".concat(d.kind,"_").concat(d.deviceId),f),a.push(f)}h&&(h.updateAt=o)}),r.deviceInfoMap.forEach((d,h)=>{"ACTIVE"===d.state&&d.updateAt!==o&&(d.state="INACTIVE",a.push(d))}),r.state!==wh.INITEND)return l.audio&&(r.lastAccessMicrophonePermission=!0,r.isAccessMicrophonePermission=!0),void(l.video&&(r.lastAccessCameraPermission=!0,r.isAccessCameraPermission=!0));a.forEach(d=>{switch(d.device.kind){case"audioinput":r.lastAccessMicrophonePermission&&r.isAccessMicrophonePermission&&r.emit(Il.RECORDING_DEVICE_CHANGED,d);break;case"videoinput":r.lastAccessCameraPermission&&r.isAccessCameraPermission&&r.emit(Il.CAMERA_DEVICE_CHANGED,d);break;case"audiooutput":r.lastAccessMicrophonePermission&&r.isAccessMicrophonePermission&&r.emit(Il.PLAYOUT_DEVICE_CHANGED,d)}}),l.audio&&(r.lastAccessMicrophonePermission=!0,r.isAccessMicrophonePermission=!0),l.video&&(r.lastAccessCameraPermission=!0,r.isAccessCameraPermission=!0)})()}checkMediaDeviceInfoIsOk(r){const i=r.filter(l=>"audioinput"===l.kind),o=r.filter(l=>"videoinput"===l.kind),a={audio:!1,video:!1};for(const l of i)if(l.label&&l.deviceId){a.audio=!0;break}for(const l of o)if(l.label&&l.deviceId){a.video=!0;break}return a}};let PA=!1;const Mo=new class extends nn{constructor(){super(...arguments),$(this,"onAutoplayFailed",void 0),$(this,"onAudioAutoplayFailed",void 0)}};function MA(){if(ot(),!PA){const r=i=>{i.preventDefault(),PA=!1,w_()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};PA=!0,w_()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),T.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Mo.onAutoplayFailed?Mo.onAutoplayFailed():T.warning(Mo.onAudioAutoplayFailed?"AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .":"We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),Mo.emit("autoplay-failed")}}function kA(r,i,o,a){if(!r)return;const l=be.getBaseInfoBySessionId(r);if(!l)return;const d=l.info,h=Date.now(),f=rn(rn({},d),{},{vid:void 0===d.vid?0:Number(d.vid),lts:h,elapse:h-l.startTime,cbRegistered:Mo.onAutoplayFailed||Mo.onAudioAutoplayFailed?1:-1,errorMsg:o,mediaType:i,trackId:a,extend:void 0});be.send({type:sn.AUTOPLAY_FAILED,data:f},!0)}const Ax=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Wi=new class{constructor(){$(this,"onAutoplayFailed",void 0),$(this,"elementMap",new Map),$(this,"elementStateMap",new Map),$(this,"elementsNeedToResume",[]),$(this,"sinkIdMap",new Map),$(this,"autoResumeAfterInterruption",r=>{Array.from(this.elementMap.entries()).forEach(i=>{let[o,a]=i;const l=this.elementStateMap.get(o),d=a.srcObject.getAudioTracks()[0],h=d&&d.readyState;if(T.debug("resume after interrupted, ele: ".concat(l," audio: ").concat(h," ").concat(r)),"live"===h){if(r)return a.pause(),void a.play();if("running"===Lt.curState)return Tf()?(a.pause(),void a.play()):void(l&&"paused"===l&&a.play())}})}),$(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(r=>{let[i,o]=r;const a=o.srcObject.getAudioTracks()[0];a&&"live"===a.readyState&&(T.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),o.pause(),o.play())})}),this.autoResumeAudioElement(),Lt.on(Ir.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Lt.on(Ir.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Lt.on(Ir.STATE_CHANGE,()=>{nt()&&"suspended"===Lt.prevState&&"running"===Lt.curState&&this.autoResumeAfterInterruption()})}setSinkID(r,i){var o=this;return L(function*(){const a=o.elementMap.get(r);if(o.sinkIdMap.set(r,i),a)try{yield a.setSinkId(i)}catch(l){throw new Y(k.PERMISSION_DENIED,"can not set sink id: "+l.toString())}})()}play(r,i,o,a){if(this.elementMap.has(i))return;const l=document.createElement("audio");l.autoplay=!0,l.srcObject=new MediaStream([r]),this.bindAudioElementEvents(i,l),this.elementMap.set(i,l),this.elementStateMap.set(i,Kr.INIT),this.setVolume(i,o);const d=this.sinkIdMap.get(i);if(d)try{l.setSinkId(d).catch(f=>{T.warning("[".concat(i,"] set sink id failed"),f.toString())})}catch(f){T.warning("[".concat(i,"] set sink id failed"),f.toString())}const h=l.play();h&&h.then&&h.catch(f=>{a&&kA(a,"audio",f.message,i),T.warning("audio element play warning",f.toString()),this.elementMap.has(i)&&"NotAllowedError"===f.name&&(T.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(l),D_(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),MA()}))})}updateTrack(r,i){const o=this.elementMap.get(r);o&&(o.srcObject=new MediaStream([i]))}isPlaying(r){return this.elementMap.has(r)&&"playing"===this.elementStateMap.get(r)}setVolume(r,i){const o=this.elementMap.get(r);o&&(i=Math.max(0,Math.min(100,i)),o.volume=i/100)}stop(r){const i=this.elementMap.get(r);if(this.sinkIdMap.delete(r),!i)return;const o=this.elementsNeedToResume.indexOf(i);this.elementsNeedToResume.splice(o,1),i.srcObject=null,i.remove(),this.elementMap.delete(r),this.elementStateMap.delete(r)}bindAudioElementEvents(r,i){Ax.forEach(o=>{i.addEventListener(o,a=>{const l=this.elementStateMap.get(r),d="pause"===a.type?"paused":a.type;if(T.debug("[".concat(r,"] audio-element-status change ").concat(l," => ").concat(d)),"error"===a.type){const h=i?.error;h&&T.error("[".concat(r,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(r,d)})})}getPlayerState(r){return this.elementStateMap.get(r)||"uninit"}autoResumeAudioElement(){const r=()=>{this.elementsNeedToResume.forEach(i=>{i.play().then(o=>{T.debug("Auto resume audio element success")}).catch(o=>{T.warning("Auto resume audio element failed!",o)})}),this.elementsNeedToResume=[]};new le(i=>{document.body?i():window.addEventListener("load",()=>i())}).then(()=>{w_()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0))})}};function Gn(){return function(r,i,o){const a=o.value;return"function"==typeof a&&(o.value=function(){this._isClosed&&new Y(k.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",T);for(var l=arguments.length,d=new Array(l),h=0;h<l;h++)d[h]=arguments[h];const f=a.apply(this,d);return f instanceof le?new le((m,g)=>{f.then(m).catch(g)}):f}),o}}class LA extends nn{constructor(i){super(),$(this,"name","VideoProcessorDestination"),$(this,"ID","0"),$(this,"_source",void 0),$(this,"videoContext",void 0),$(this,"inputTrack",void 0),this.videoContext=i}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Y(k.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Y(k.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(i){if(i.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");i.track&&i.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=i.track,this.emit(di.ON_TRACK,i.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(di.ON_TRACK,void 0)}}class Dx extends nn{set chained(i){this._chained=i}get chained(){return this._chained}constructor(i,o){super(),$(this,"constraintsMap",new Map),$(this,"statsRegistry",[]),$(this,"usageRegistry",[]),$(this,"trackId",void 0),$(this,"direction",void 0),$(this,"_chained",!1),this.trackId=i,this.direction=o}getConstraints(){var i=this;return L(function*(){return yield Gr(i,as.REQUEST_CONSTRAINTS)})()}requestApplyConstraints(i,o){var a=this;return L(function*(){var l;return T.info("processor ".concat(o.name," requestApplyConstraints for ").concat(a.trackId)),i&&a.constraintsMap.set(o,i),Bt(a,as.REQUEST_UPDATE_CONSTRAINTS,Array.from(xd(l=a.constraintsMap).call(l)))})()}requestRevertConstraints(i){var o=this;return L(function*(){var a;if(o.constraintsMap.has(i))return T.info("processor ".concat(i.name," requestRevertConstraints for ").concat(o.trackId)),o.constraintsMap.delete(i),Bt(o,as.REQUEST_UPDATE_CONSTRAINTS,Array.from(xd(a=o.constraintsMap).call(a)))})()}registerStats(i,o,a){this.statsRegistry.find(l=>l.processorID===i.ID&&l.processorName===i.name&&l.type===o)||this.statsRegistry.push({processorName:i.name,processorID:i.ID,type:o,cb:a})}unregisterStats(i,o){const a=this.statsRegistry.findIndex(l=>l.processorID===i.ID&&l.processorName===i.name&&l.type===o);-1!==a&&this.statsRegistry.splice(a,1)}gatherStats(){const i=[];for(const{processorID:o,processorName:a,type:l,cb:d}of this.statsRegistry)try{const h=d();i.push({processorID:o,processorName:a,type:l,stats:h})}catch(h){T.error(new Y(k.UNEXPECTED_ERROR,h.message))}return i}registerUsage(i,o){this.usageRegistry.find(a=>a.processorID===i.ID&&a.processorName===i.name)||this.usageRegistry.push({processorID:i.ID,processorName:i.name,cb:o})}unregisterUsage(i){const o=this.usageRegistry.findIndex(a=>a.processorID===i.ID&&a.processorName===i.name);-1!==o&&this.usageRegistry.splice(o,1)}gatherUsage(){var i=this;return L(function*(){const o=[];if(!i.chained)return[];for(const{cb:a}of i.usageRegistry)try{let l=a();l instanceof le&&(l=yield l),o.push(rn(rn({},l),{},{direction:i.direction}))}catch(l){T.error("gather extension usage error",l)}return o})()}getDirection(){return this.direction}}class xA extends nn{constructor(i){super(),$(this,"name","AudioProcessorDestination"),$(this,"ID","0"),$(this,"inputTrack",void 0),$(this,"inputNode",void 0),$(this,"audioProcessorContext",void 0),$(this,"_source",void 0),this.audioProcessorContext=i}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Y(k.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Y(k.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(di.ON_TRACK,void 0),this.emit(di.ON_NODE,void 0)}updateInput(i){if(i.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");i.track&&this.inputTrack!==i.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=i.track,this.emit(di.ON_TRACK,this.inputTrack)),i.node&&this.inputNode!==i.node&&(this.audioProcessorContext.chained=!0,this.inputNode=i.node,this.emit(di.ON_NODE,this.inputNode))}}class lv extends nn{set chained(i){this._chained=i}get chained(){return this._chained}constructor(i,o,a){super(),$(this,"constraintsMap",new Map),$(this,"statsRegistry",[]),$(this,"audioContext",void 0),$(this,"trackId",void 0),$(this,"direction",void 0),$(this,"usageRegistry",[]),$(this,"_chained",!1),this.audioContext=i,this.trackId=o,this.direction=a}getConstraints(){var i=this;return L(function*(){return Gr(i,as.REQUEST_CONSTRAINTS)})()}getAudioContext(){return this.audioContext}requestApplyConstraints(i,o){var a=this;return L(function*(){var l;return T.info("processor ".concat(o.name," requestApplyConstraints for ").concat(a.trackId)),i&&a.constraintsMap.set(o,i),Bt(a,as.REQUEST_UPDATE_CONSTRAINTS,Array.from(xd(l=a.constraintsMap).call(l)))})()}requestRevertConstraints(i){var o=this;return L(function*(){var a;if(o.constraintsMap.has(i))return o.constraintsMap.delete(i),Bt(o,as.REQUEST_UPDATE_CONSTRAINTS,Array.from(xd(a=o.constraintsMap).call(a)))})()}registerStats(i,o,a){this.statsRegistry.find(l=>l.processorID===i.ID&&l.processorName===i.name&&l.type===o)||this.statsRegistry.push({processorName:i.name,processorID:i.ID,type:o,cb:a})}unregisterStats(i,o){const a=this.statsRegistry.findIndex(l=>l.processorID===i.ID&&l.processorName===i.name&&l.type===o);-1!==a&&this.statsRegistry.splice(a,1)}gatherStats(){const i=[];for(const{processorID:o,processorName:a,type:l,cb:d}of this.statsRegistry)try{const h=d();i.push({processorID:o,processorName:a,type:l,stats:h})}catch(h){T.error(new Y(k.UNEXPECTED_ERROR,h.message))}return i}registerUsage(i,o){this.usageRegistry.find(a=>a.processorID===i.ID&&a.processorName===i.name)||this.usageRegistry.push({processorID:i.ID,processorName:i.name,cb:o})}unregisterUsage(i){const o=this.usageRegistry.findIndex(a=>a.processorID===i.ID&&a.processorName===i.name);-1!==o&&this.usageRegistry.splice(o,1)}gatherUsage(){var i=this;return L(function*(){const o=[];if(!i.chained)return[];for(const{cb:a}of i.usageRegistry)try{let l=a();l instanceof le&&(l=yield l),o.push(rn(rn({},l),{},{direction:i.direction}))}catch(l){T.error("gather extension usage error",l)}return o})()}getDirection(){return this.direction}}class Rh extends nn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),$(this,"context",void 0),$(this,"processSourceNode",void 0),$(this,"outputTrack",void 0),$(this,"processedNode",void 0),$(this,"clonedTrack",void 0),$(this,"outputNode",void 0),this.outputNode=new zS}setVolume(){}createOutputTrack(){throw new Y(k.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class zS{disconnect(){}connect(){}}function FA(r){return new le((i,o)=>{let a=!1;const l=document.createElement("video");l.setAttribute("autoplay",""),l.setAttribute("muted",""),l.muted=!0,l.autoplay=!0,l.setAttribute("playsinline",""),l.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(l);const d=nt()?"canplay":"playing";l.addEventListener(d,()=>{const h=l.videoWidth,f=l.videoHeight;!h&&hn()||(a=!0,l.srcObject=null,l.remove(),i([h,f]))}),l.srcObject=new MediaStream([r]),l.play().catch(fS),setTimeout(()=>{a||(l.srcObject=null,l.remove(),i([l.videoWidth,l.videoHeight]))},4e3)})}function dv(r){const i={};r.facingMode&&(i.facingMode=r.facingMode),r.cameraId&&(i.deviceId={exact:r.cameraId});const o=Tl(r.encoderConfig);return null!=o.width&&(i.width=o.width),null!=o.height&&(i.height=o.height),!wf()&&o.frameRate&&(i.frameRate=o.frameRate),lS()&&"object"==typeof i.frameRate&&(i.frameRate.max=60),hn()&&(i.frameRate={ideal:30,max:30}),i}function w5(r){const i={};return wf()||(void 0!==r.AGC&&(i.autoGainControl=r.AGC),void 0!==r.AEC&&(i.echoCancellation=r.AEC),void 0!==r.ANS&&(i.noiseSuppression=r.ANS,hh()&&r.ANS&&(i.googHighpassFilter=r.ANS))),i}function I5(r){const i=w5(r);if(r.encoderConfig){const o=wA(r.encoderConfig);i.channelCount=o.stereo?2:1,i.sampleRate=o.sampleRate,i.sampleSize=o.sampleSize}return r.microphoneId&&(i.deviceId={exact:r.microphoneId}),hS()&&(i.sampleRate=void 0),i}const Ox=function(){var r=L(function*(i,o,a){return yield(l=L(function*(d,h,f){const m=function(y){const b=[];for(let C=0;C<y.length;C+=2)b.push(parseInt(y.slice(C,C+2),16));return Uint8Array.from(b)}(m4(""+h+f)).slice(0,16),g=m.slice(0,12),v=yield window.crypto.subtle.importKey("raw",m,"AES-GCM",!0,["encrypt"]);return new Uint8Array(yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:g},v,d))}),function(d,h,f){return l.apply(this,arguments)})(i.buffer,o,a);var l});return function(o,a,l){return r.apply(this,arguments)}}(),UA=r=>{const i=document.createElement("canvas");return i.width=2,i.height=2,new le((o,a)=>{i.toBlob(function(){var l=L(function*(d){if(i.remove(),d){const h=yield R5(d);o({buffer:h,width:i.width,height:i.height})}else a(new Y(k.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(d){return l.apply(this,arguments)}}(),r,1)})},R5=function(){var r=L(function*(i){const o=yield i.arrayBuffer();return new Uint8Array(o)});return function(o){return r.apply(this,arguments)}}();var VA,BA,A5,uv,D5,O5,N5,Nx,P5,M5,Px,Mx,k5,jA,kx,L5,Lx,HA,an,xx,Fx,Ux,Vx,GA,WA,Al,Bx,jx,Hx,Gx,zA,KA,Wx,qA,YA,x5,zx,Wf,KS,Mr;let Cn=(VA=Ae({argsMap:(r,i)=>[r.getTrackId(),i],throttleTime:300}),BA=Ae({argsMap:(r,i)=>[r.getTrackId(),i]}),A5=Gn(),uv=Af("LocalAudioTrack","_enabledMutex"),D5=Ae({argsMap:(r,i)=>[r.getTrackId(),i]}),O5=Gn(),N5=Af("LocalAudioTrack","_enabledMutex"),Nx=Ae({argsMap:(r,i)=>[r.getTrackId(),i]}),P5=Gn(),M5=Gn(),Px=Gn(),Mx=Ae({argsMap:r=>[r.getTrackId()]}),k5=Gn(),jA=Ae({argsMap:r=>[r.getTrackId()]}),kx=Gn(),L5=Ae({argsMap:r=>[r.getTrackId()]}),Lx=Ae({argsMap:(r,i)=>[r.getTrackId(),i.name]}),HA=Ae({argsMap:r=>[r.getTrackId()]}),Qe((an=class extends Ih{get _source(){return this.initWebAudio()}set _source(r){this._trackSource=r}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Wi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(r,i,o,a){super(r,o),$(this,"trackMediaType",wl.AUDIO),$(this,"_encoderConfig",void 0),$(this,"_trackSource",void 0),$(this,"_enabled",!0),$(this,"_volume",100),$(this,"_useAudioElement",!0),$(this,"_bypassWebAudio",!1),$(this,"processor",void 0),$(this,"_processorContext",void 0),$(this,"_processorDestination",void 0),$(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=i,this._getOriginVolumeLevel=!!a,this._trackSource=new Rh,B("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),B("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),$e()&&!Po?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(r){Ft(r,"volume",0,1e3),this._volume=r,this._source.setVolume(r/100),this._useAudioElement&&Wi.setVolume(this.getTrackId(),r);try{if(this._bypassWebAudio)return void T.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const i=this._source.createOutputTrack();this._mediaStreamTrack!==i&&(this._mediaStreamTrack=i,Bt(this,ge.NEED_REPLACE_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(o=>{T.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),o)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}setPlaybackDevice(r){var i=this;return L(function*(){if(!i._useAudioElement||!mx())throw new Y(k.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield Wi.setSinkID(i.getTrackId(),r)})()}setEnabled(r,i,o){var a=this;return L(function*(){return a._setEnabled(r,i,o)})()}_setEnabled(r,i,o){var a=this;return L(function*(){if(!o){if(r===a._enabled)return;a.stateCheck("enabled",r)}if(T.info("[".concat(a.getTrackId(),"] start setEnabled"),r),r){a._originMediaStreamTrack.enabled=!0;try{o||(a._enabled=!0),yield Bt(a,ge.NEED_ENABLE_TRACK,a),T.info("[".concat(a.getTrackId(),"] setEnabled to ").concat(r," success"))}catch(l){throw o||(a._enabled=!1),T.error("[".concat(a.getTrackId(),"] setEnabled to true error"),l.toString()),l}}else{a._originMediaStreamTrack.enabled=!1,o||(a._enabled=!1);try{yield Bt(a,ge.NEED_DISABLE_TRACK,a)}catch(l){throw o||(a._enabled=!0),T.error("[".concat(a.getTrackId(),"] setEnabled to false error"),l.toString()),l}}})()}setMuted(r){var i=this;return L(function*(){r!==i._muted&&(i.stateCheck("muted",r),i._muted=r,i._originMediaStreamTrack.enabled=!r,T.debug("[".concat(i.getTrackId(),"] start set muted: ").concat(r)),r?yield Bt(i,ge.NEED_MUTE_TRACK,i):yield Bt(i,ge.NEED_UNMUTE_TRACK,i))})()}getStats(){return yc(()=>{T.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Ao(this,ge.GET_STATS)||rn({},IA)}setAudioFrameCallback(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!r)return this._source.removeAllListeners(ss.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(i),this._source.removeAllListeners(ss.ON_AUDIO_BUFFER),this._source.on(ss.ON_AUDIO_BUFFER,o=>r(o))}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Wi.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Wi.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),r&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Wi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}_updateOriginMediaStreamTrack(r,i){var o=this;return L(function*(){o._originMediaStreamTrack!==r&&(o._originMediaStreamTrack&&(o._originMediaStreamTrack.removeEventListener("ended",o._handleTrackEnded),i&&o._originMediaStreamTrack.stop()),r.addEventListener("ended",o._handleTrackEnded),o._originMediaStreamTrack=r,o._muted&&(o._originMediaStreamTrack.enabled=!1),o.processor&&o._processorContext&&o.processor.updateInput({track:r,context:o._processorContext}),o._mediaStreamTrack!==o._source.outputTrack?(o._mediaStreamTrack=o._originMediaStreamTrack,o._updatePlayerSource(),yield Bt(o,ge.NEED_REPLACE_TRACK,o)):o._source.updateTrack(o._originMediaStreamTrack),o._getOriginVolumeLevel&&o._source.updateOriginTrack(r))})()}renewMediaStreamTrack(r){return le.resolve(void 0)}pipe(r){if(this._bypassWebAudio)throw new Y(k.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===r)return r;if(r._source)throw new Y(k.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),r}unpipe(){var r;if(!this.processor)return;const i=this.processor;null===(r=this._source.processSourceNode)||void 0===r||r.disconnect(),this.processor._source=!1,this.processor=void 0,i.reset()}bindProcessorDestinationEvents(r){var i=this;r.on(di.ON_TRACK,function(){var o=L(function*(a){a?a!==i._mediaStreamTrack&&(i._mediaStreamTrack=a,i._updatePlayerSource(!1),i._source.processedNode=i._source.createMediaStreamSourceNode(a),yield Bt(i,ge.NEED_REPLACE_TRACK,i)):i._mediaStreamTrack!==i._originMediaStreamTrack&&(i._mediaStreamTrack=i._originMediaStreamTrack,i._updatePlayerSource(),yield Bt(i,ge.NEED_REPLACE_TRACK,i))});return function(a){return o.apply(this,arguments)}}()),r.on(di.ON_NODE,o=>{this._source.processedNode=o})}unbindProcessorDestinationEvents(r){r.removeAllListeners(di.ON_TRACK),r.removeAllListeners(di.ON_NODE)}bindProcessorContextEvents(r){var i=this;r.on(as.REQUEST_CONSTRAINTS,function(){var o=L(function*(a){a(i._originMediaStreamTrack.getSettings())});return function(a){return o.apply(this,arguments)}}())}unbindProcessorContextEvents(r){r.removeAllListeners(as.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Rh&&(this._trackSource=new Cx(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const r=new lv(this._source.context,this.getTrackId(),"local"),i=new xA(r);return this._processorContext=r,this._processorDestination=i,this.bindProcessorContextEvents(r),this.bindProcessorDestinationEvents(i),this._source.on(ss.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:r})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Wi.stop(this.getTrackId()),this._source.play()),Bt(this,ge.NEED_REPLACE_MIXING_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(o=>{T.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),o)})),{processorContext:r,processorDestination:i}}}).prototype,"setVolume",[VA],Object.getOwnPropertyDescriptor(an.prototype,"setVolume"),an.prototype),Qe(an.prototype,"setPlaybackDevice",[BA,A5],Object.getOwnPropertyDescriptor(an.prototype,"setPlaybackDevice"),an.prototype),Qe(an.prototype,"setEnabled",[uv,D5,O5],Object.getOwnPropertyDescriptor(an.prototype,"setEnabled"),an.prototype),Qe(an.prototype,"setMuted",[N5,Nx,P5],Object.getOwnPropertyDescriptor(an.prototype,"setMuted"),an.prototype),Qe(an.prototype,"getStats",[M5],Object.getOwnPropertyDescriptor(an.prototype,"getStats"),an.prototype),Qe(an.prototype,"setAudioFrameCallback",[Px],Object.getOwnPropertyDescriptor(an.prototype,"setAudioFrameCallback"),an.prototype),Qe(an.prototype,"play",[Mx,k5],Object.getOwnPropertyDescriptor(an.prototype,"play"),an.prototype),Qe(an.prototype,"stop",[jA,kx],Object.getOwnPropertyDescriptor(an.prototype,"stop"),an.prototype),Qe(an.prototype,"close",[L5],Object.getOwnPropertyDescriptor(an.prototype,"close"),an.prototype),Qe(an.prototype,"pipe",[Lx],Object.getOwnPropertyDescriptor(an.prototype,"pipe"),an.prototype),Qe(an.prototype,"unpipe",[HA],Object.getOwnPropertyDescriptor(an.prototype,"unpipe"),an.prototype),an),qS=(xx=Ae({argsMap:(r,i)=>[r.getTrackId(),i]}),Fx=Gn(),Ux=Af("MicrophoneAudioTrack","_enabledMutex"),Vx=Ae({argsMap:(r,i,o)=>[r.getTrackId(),i,o]}),GA=Gn(),WA=Ae({argsMap:r=>[r.getTrackId()]}),Qe((Al=class extends Cn{get __className__(){return"MicrophoneAudioTrack"}constructor(r,i,o,a){super(r,i.encoderConfig?wA(i.encoderConfig):{},a,B("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),$(this,"_config",void 0),$(this,"_deviceName","default"),$(this,"_constraints",void 0),$(this,"_originalConstraints",void 0),$(this,"_enabled",!0),this._config=i,this._constraints=o,this._originalConstraints=o,this._deviceName=r.label,"boolean"==typeof i.bypassWebAudio&&(this._bypassWebAudio=i.bypassWebAudio),(Tf()||fR())&&Lt.bindInterruptDetectorTrack(this)}setDevice(r){var i=this;return L(function*(){if(T.info("[".concat(i.getTrackId(),"] start set device to ").concat(r)),i._enabled)try{const o=yield po.getDeviceById(r),a={};a.audio=rn({},i._constraints),a.audio.deviceId={exact:r},i._originMediaStreamTrack.stop();let l=null;try{l=yield Gi(a,i.getTrackId())}catch(d){throw T.error("[".concat(i.getTrackId(),"] setDevice failed"),d.toString()),l=yield Gi({audio:i._constraints},i.getTrackId()),yield i._updateOriginMediaStreamTrack(l.getAudioTracks()[0],!1),d}yield i._updateOriginMediaStreamTrack(l.getAudioTracks()[0],!1),i._deviceName=o.label,i._config.microphoneId=r,i._constraints.deviceId={exact:r}}catch(o){throw T.error("[".concat(i.getTrackId(),"] setDevice error"),o.toString()),o}else try{const o=yield po.getDeviceById(r);i._deviceName=o.label,i._config.microphoneId=r,i._constraints.deviceId={exact:r}}catch(o){throw T.error("[".concat(i.getTrackId(),"] setDevice error"),o.toString()),o}T.info("[".concat(i.getTrackId(),"] set device to ").concat(r," success"))})()}setEnabled(r,i,o){var a=()=>super._setEnabled,l=this;return L(function*(){if(i)return T.debug("[".concat(l.getTrackId(),"] setEnabled false (do not close microphone)")),yield a().call(l,r);if(!o){if(r===l._enabled)return;l.stateCheck("enabled",r)}if(T.info("[".concat(l.getTrackId(),"] start setEnabled"),r),B("AUTO_RESET_AUDIO_ROUTE")&&(nt()||Ks())){const m=navigator.audioSession;m&&(r||(m.type="playback"),m.type="auto")}if(!r){var d;l._originMediaStreamTrack.onended=null,l._originMediaStreamTrack.stop(),null===(d=l._source.clonedTrack)||void 0===d||d.stop(),o||(l._enabled=!1);try{yield Bt(l,ge.NEED_DISABLE_TRACK,l)}catch(m){throw T.error("[".concat(l.getTrackId(),"] setEnabled false failed"),m.toString()),m}return}const h=rn({},l._constraints),f=po.searchDeviceIdByName(l._deviceName);f&&!h.deviceId&&(h.deviceId=f);try{o||(l._enabled=!0);const m=yield Gi({audio:l._constraints},l.getTrackId());yield l._updateOriginMediaStreamTrack(m.getAudioTracks()[0],!1),yield Bt(l,ge.NEED_ENABLE_TRACK,l)}catch(m){throw o||(l._enabled=!1),T.error("[".concat(l.getTrackId(),"] setEnabled true failed"),m.toString()),m}T.info("[".concat(l.getTrackId(),"] setEnabled success"))})()}close(){super.close(),(Tf()||fR())&&Lt.unbindInterruptDetectorTrack(this)}onTrackEnded(){var r=this;if((nt()||Ks())&&this._enabled&&!this._isClosed&&Lt.duringInterruption){const i=function(){var o=L(function*(){Lt.off(Ir.IOS_INTERRUPTION_END,i),r._enabled&&!r._isClosed&&(T.debug("[".concat(r.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),yield r.setEnabled(!1),yield r.setEnabled(!0))});return function(){return o.apply(this,arguments)}}();Lt.on(Ir.IOS_INTERRUPTION_END,i)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(iv.TRACK_ENDED)}renewMediaStreamTrack(r){var i=this;return L(function*(){const o=r||i._constraints,a=po.searchDeviceIdByName(i._deviceName);if(a&&!o.deviceId&&(o.deviceId=a),i._constraints=o,i._enabled){i._originMediaStreamTrack.stop();const l=yield Gi({audio:i._constraints},i.getTrackId());yield i._updateOriginMediaStreamTrack(l.getAudioTracks()[0],!0)}})()}bindProcessorContextEvents(r){var i=this;super.bindProcessorContextEvents(r),r.on(as.REQUEST_UPDATE_CONSTRAINTS,function(){var o=L(function*(a,l,d){try{const h=Object.assign({},i._originalConstraints,...a);yield i.renewMediaStreamTrack(h),l()}catch(h){d(h)}});return function(a,l,d){return o.apply(this,arguments)}}())}unbindProcessorContextEvents(r){super.unbindProcessorContextEvents(r),r.removeAllListeners(as.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[xx,Fx],Object.getOwnPropertyDescriptor(Al.prototype,"setDevice"),Al.prototype),Qe(Al.prototype,"setEnabled",[Ux,Vx,GA],Object.getOwnPropertyDescriptor(Al.prototype,"setEnabled"),Al.prototype),Qe(Al.prototype,"close",[WA],Object.getOwnPropertyDescriptor(Al.prototype,"close"),Al.prototype),Al),YS=(Bx=Ae({argsMap:(r,i)=>[r.getTrackId(),i,r.duration]}),jx=Gn(),Hx=Ae({argsMap:r=>[r.getTrackId()]}),Gx=Gn(),zA=Ae({argsMap:r=>[r.getTrackId()]}),KA=Gn(),Wx=Ae({argsMap:r=>[r.getTrackId()]}),qA=Gn(),YA=Ae({argsMap:r=>[r.getTrackId()]}),x5=Gn(),zx=Ae({argsMap:r=>[r.getTrackId()]}),Wf=Ae({argsMap:r=>[r.getTrackId()]}),KS=Gn(),Qe((Mr=class extends Cn{get __className__(){return"BufferSourceAudioTrack"}constructor(r,i,o,a){super(i.createOutputTrack(),o,a),$(this,"source",void 0),$(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=r,this._bufferSource=i,this._bufferSource.on(ss.AUDIO_SOURCE_STATE_CHANGE,l=>{this.safeEmit(iv.SOURCE_STATE_CHANGE,l)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(r){r&&this._bufferSource.updateOptions(r),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(r){this._bufferSource.seekAudioBuffer(r)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(r){Ft(r,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(r)}}).prototype,"startProcessAudioBuffer",[Bx,jx],Object.getOwnPropertyDescriptor(Mr.prototype,"startProcessAudioBuffer"),Mr.prototype),Qe(Mr.prototype,"pauseProcessAudioBuffer",[Hx,Gx],Object.getOwnPropertyDescriptor(Mr.prototype,"pauseProcessAudioBuffer"),Mr.prototype),Qe(Mr.prototype,"seekAudioBuffer",[zA,KA],Object.getOwnPropertyDescriptor(Mr.prototype,"seekAudioBuffer"),Mr.prototype),Qe(Mr.prototype,"resumeProcessAudioBuffer",[Wx,qA],Object.getOwnPropertyDescriptor(Mr.prototype,"resumeProcessAudioBuffer"),Mr.prototype),Qe(Mr.prototype,"stopProcessAudioBuffer",[YA,x5],Object.getOwnPropertyDescriptor(Mr.prototype,"stopProcessAudioBuffer"),Mr.prototype),Qe(Mr.prototype,"close",[zx],Object.getOwnPropertyDescriptor(Mr.prototype,"close"),Mr.prototype),Qe(Mr.prototype,"setAudioBufferPlaybackSpeed",[Wf,KS],Object.getOwnPropertyDescriptor(Mr.prototype,"setAudioBufferPlaybackSpeed"),Mr.prototype),Mr);class sr extends Cn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const i of this.trackList)if(i._enabled&&!i._isClosed&&!i.muted)return!0;return!1}constructor(){const i=Hf().createMediaStreamDestination();super(i.stream.getAudioTracks()[0],void 0,Ct(8,"track-mix-")),$(this,"trackList",void 0),$(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=i,this.trackList=[]}hasAudioTrack(i){return-1!==this.trackList.indexOf(i)}addAudioTrack(i){-1===this.trackList.indexOf(i)?(T.debug("add ".concat(i.getTrackId()," to mixing track")),i._source.outputNode.connect(this.destNode),this.trackList.push(i),this.updateEncoderConfig()):T.debug("track ".concat(i.getTrackId()," is already added"))}removeAudioTrack(i){if(-1!==this.trackList.indexOf(i)){T.debug("remove ".concat(i.getTrackId()," from mixing track"));try{i._source.outputNode.disconnect(this.destNode)}catch{}Be(this.trackList,i),this.updateEncoderConfig()}}updateEncoderConfig(){const i={};this.trackList.forEach(o=>{o._encoderConfig&&((o._encoderConfig.bitrate||0)>(i.bitrate||0)&&(i.bitrate=o._encoderConfig.bitrate),(o._encoderConfig.sampleRate||0)>(i.sampleRate||0)&&(i.sampleRate=o._encoderConfig.sampleRate),(o._encoderConfig.sampleSize||0)>(i.sampleSize||0)&&(i.sampleSize=o._encoderConfig.sampleSize),o._encoderConfig.stereo&&(i.stereo=!0))}),this._encoderConfig=i}_updateRtpTransceiver(i){this._rtpTransceiver!==i&&(this._rtpTransceiver=i,this.trackList.forEach(o=>{o instanceof sr?o.emit(jf.TRANSCEIVER_UPDATED,i):o._updateRtpTransceiver(i)}))}}class F5 extends sv{set currentState(i){i!==this._currentState&&(this._currentState=i,this.safeEmit(ss.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(i){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),$(this,"audioBuffer",void 0),$(this,"sourceNode",void 0),$(this,"startPlayTime",0),$(this,"startPlayOffset",0),$(this,"pausePlayTime",0),$(this,"options",void 0),$(this,"currentLoopCount",0),$(this,"currentPlaybackSpeed",100),$(this,"_currentState","stopped"),this.audioBuffer=i,this.options=o,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:(this.playbackSpeed/100*(this.context.currentTime-this.startPlayTime)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(i){"stopped"===this.currentState?(this.options=i,this.startPlayOffset=this.options.startPlayTime||0):T.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(i){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=i,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=i))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(i){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=i/100),this.currentPlaybackSpeed=i}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const i=this.context.createBufferSource();return i.buffer=this.audioBuffer,i.loop=!!this.options.loop,i.connect(this.outputNode),i.playbackRate.value=this.currentPlaybackSpeed/100,i}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const $A=new Map;class $S{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const o=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/(this.renderStats.curTs-this.renderStats.lastTs);return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,o}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(i){i!==this._videoElementStatus&&(T.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(i)),this._videoElementStatus=i)}get videoState(){return this._videoState}set videoState(i){var o;i!==this._videoState&&(this._videoState=i,null===(o=this.onVideoStateChanged)||void 0===o||o.call(this,this.videoState))}constructor(i){$(this,"trackId",void 0),$(this,"config",void 0),$(this,"onFirstVideoFrameDecoded",void 0),$(this,"onVideoStateChanged",void 0),$(this,"freezeTimeCounterList",[]),$(this,"renderFreezeAccTime",0),$(this,"isKeepLastFrame",!1),$(this,"timeUpdatedCount",0),$(this,"freezeTime",0),$(this,"playbackTime",0),$(this,"lastTimeUpdatedTime",0),$(this,"autoplayFailed",!1),$(this,"videoTrack",void 0),$(this,"videoElement",void 0),$(this,"cacheVideoElement",void 0),$(this,"renderStats",void 0),$(this,"_videoState",Rl.VideoStateStopped),$(this,"videoElementCheckInterval",void 0),$(this,"videoElementFreezeTimeout",void 0),$(this,"_videoElementStatus",Kr.NONE),$(this,"isGettingVideoDimensions",!1),$(this,"startGetVideoDimensions",()=>{const o=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return T.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(o,500)};!this.isGettingVideoDimensions&&o()}),$(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===Lt.curState&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Q1())),tL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),$(this,"handleVideoEvents",o=>{switch(o.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Kr.PLAYING;break;case"loadeddata":if(this.videoState=Rl.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Kr.CANPLAY;break;case"stalled":this.videoElementStatus=Kr.STALLED;break;case"suspend":this.videoElementStatus=Kr.SUSPEND;break;case"pause":this.videoElementStatus=Kr.PAUSED,nt()||Ks()||$e()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Kr.WAITING;break;case"abort":this.videoElementStatus=Kr.ABORT;break;case"ended":this.videoElementStatus=Kr.ENDED;break;case"emptied":this.videoElementStatus=Kr.EMPTIED;break;case"error":{const a=this.videoElement.error;a&&(this.videoElementStatus=Kr.ERROR,T.error("[".concat(this.trackId,"] media error: ").concat(a.message," (").concat(a.code,")")));break}case"timeupdate":{const a=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=a);const l=a-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=a,cs.lastVisibleTime<cs.lastHiddenTime||d<cs.lastHiddenTime||d<cs.lastVisibleTime)return;for(l>B("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=l),this.playbackTime+=l;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),$(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Q1())),tL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=i.trackId,this.config=i,this.videoElement=i.element instanceof HTMLVideoElement?i.element:document.createElement("video"),Lt.on(Ir.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Lt.on(Ir.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var i;return null!==(i=this.videoElement.parentElement)&&void 0!==i?i:void 0}updateConfig(i){this.config=i,this.trackId=i.trackId,i.element!==this.videoElement&&(this.destroy(),this.videoElement=i.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(i){this.videoTrack!==i&&(this.videoTrack=i,this.initVideoElement())}play(i){const o=this.videoElement.play();o&&o.catch&&o.catch(l=>{i&&kA(i,"video",l.message,this.trackId),"NotAllowedError"===l.name?(T.warning("detected video element autoplay failed",l),this.autoplayFailed=!0,this.handleAutoPlayFailed()):T.warning("[".concat(this.trackId,"] play warning: "),l)});const a=ot();if(("Safari"===a.name&&15===Number(a.version)||Tf())&&o&&o.then){const l=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};o.then(l).catch(l)}}getCurrentFrame(){const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const o=i.getContext("2d");if(!o)return T.error("create canvas context failed!"),new ImageData(2,2);o.drawImage(this.videoElement,0,0,i.width,i.height);const a=o.getImageData(0,0,i.width,i.height);return i.remove(),a}getCurrentFrameToUint8Array(i){var o=arguments,a=this;return L(function*(){let l=o.length>1&&void 0!==o[1]?o[1]:1;const d=document.createElement("canvas");d.width=a.videoElement.videoWidth,d.height=a.videoElement.videoHeight;const h=d.getContext("2d");return h?(h.drawImage(a.videoElement,0,0,d.width,d.height),new le((f,m)=>{d.toBlob(function(){var g=L(function*(v){if(d.remove(),v){const y=yield R5(v);f({buffer:y,width:d.width,height:d.height})}else m(new Y(k.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(v){return g.apply(this,arguments)}}(),i,l<0?.1:l>1?1:l)})):yield UA(i)})()}destroy(){this.renderStats=void 0,Lt.off(Ir.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Lt.off(Ir.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Rl.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Kr.INIT,!this.videoElementCheckInterval&&(U5.forEach(d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{var d;(d=this.videoElement)!==document.body&&document.body.contains(d)||(this.videoElementStatus=Kr.DESTROYED)},1e3),B("ENABLE_VIDEO_FRAME_CALLBACK"))){var i,o;let d;const h=()=>{"visible"===document.visibilityState&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(f,B("VIDEO_FREEZE_DURATION")))},f=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Rl.VideoStateDecoding&&("visible"===document.visibilityState?this.videoState=Rl.VideoStateFrozen:document.addEventListener("visibilitychange",h))},m=(g,v)=>{if(this.videoElementStatus===Kr.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=v.mediaTime):this.renderStats={lastTs:v.mediaTime,curTs:v.mediaTime,lastRenderNum:0,renderNum:0},d){const C=v.presentationTime-d.presentationTime;this.videoState===Rl.VideoStateStarting&&(this.videoState=Rl.VideoStateDecoding),this.videoState===Rl.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(f,B("VIDEO_FREEZE_DURATION"))),C<B("VIDEO_FREEZE_DURATION")&&this.videoState===Rl.VideoStateFrozen&&(this.videoState=Rl.VideoStateDecoding),C>B("VIDEO_FREEZE_DURATION")&&cs.lastVisibleTime>=cs.lastHiddenTime&&d.timestamp>cs.lastVisibleTime&&d.timestamp>cs.lastHiddenTime&&(this.renderFreezeAccTime+=C)}d=rn(rn({},v),{},{timestamp:g})}var y,b;B("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(y=(b=this.videoElement).requestVideoFrameCallback)||void 0===y||y.call(b,m))};null===(i=(o=this.videoElement).requestVideoFrameCallback)||void 0===i||i.call(o,m)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),hS()&&!B("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const a=ot();"Safari"===a.name&&15===Number(a.version)||Tf()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.videoElement.style.objectFit=this.config.fit?this.config.fit:"cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,hn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,hn()&&this.videoElement.load());const l=this.videoElement.play();void 0!==l&&l.catch(d=>{T.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())})}resetVideoElement(){U5.forEach(i=>{this.videoElement&&this.videoElement.removeEventListener(i,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Kr.NONE}handleAutoPlayFailed(){const i=o=>{o.preventDefault(),this.videoElement.play().then(()=>{T.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(a=>{T.error(a)}),this.autoplayFailed=!1,w_()?document.body.removeEventListener("click",i,!0):(document.body.removeEventListener("touchstart",i,!0),document.body.removeEventListener("mousedown",i,!0))};w_()?document.body.addEventListener("click",i,!0):(document.body.addEventListener("touchstart",i,!0),document.body.addEventListener("mousedown",i,!0)),MA()}}const U5=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Kx extends $S{constructor(i){super(i),$(this,"container",void 0),$(this,"slot",void 0),this.slot=i.element,this.updateConfig(i)}updateConfig(i){this.config=i,this.trackId=i.trackId;const o=i.element;o!==this.slot&&(this.destroy(),this.slot=o),this.createElements()}updateVideoTrack(i){this.videoTrack!==i&&(this.videoTrack=i,this.createElements())}play(i){var o;null!==(o=this.container)&&void 0!==o&&o.contains(this.videoElement)&&super.play(i)}getCurrentFrame(){var i;return null!==(i=this.container)&&void 0!==i&&i.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}getCurrentFrameToUint8Array(i){var o=arguments,a=()=>super.getCurrentFrameToUint8Array,l=this;return L(function*(){var d;let h=o.length>1&&void 0!==o[1]?o[1]:1;return null!==(d=l.container)&&void 0!==d&&d.contains(l.videoElement)?yield a().call(l,i,h):yield UA(i)})()}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",B("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var i;!this.container||null!==(i=this.container)&&void 0!==i&&i.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var i;if(null!==(i=this.container)&&void 0!==i&&i.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var i;null!==(i=this.container)&&void 0!==i&&i.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var qx,V5,Yx,B5,j5,H5,$x,zi,Xx,G5,W5,z5,K5,q5,Zx,Y5,$5,X5,Z5,jd,Qs,Jx,Qx,e2,et,XA,J5,Q5,eH,ZA,Dl,t2,n2,Is;let Ve=(qx=Ae({argsMap:(r,i,o)=>[r.getTrackId(),"string"==typeof i?i:i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",o]}),V5=Gn(),Yx=Ae({argsMap:r=>[r.getTrackId()]}),B5=Af("LocalVideoTrack","_enabledMutex"),j5=Ae({argsMap:(r,i)=>[r.getTrackId(),i]}),H5=Gn(),$x=Af("LocalVideoTrack","_enabledMutex"),zi=Ae({argsMap:(r,i)=>[r.getTrackId(),i]}),Xx=Gn(),G5=Ae({argsMap:(r,i)=>[r.getTrackId(),i]}),W5=Gn(),z5=Gn(),K5=Ae({argsMap:(r,i,o)=>[r.getTrackId(),i,o]}),q5=Gn(),Zx=Gn(),Y5=Gn(),$5=Gn(),X5=Gn(),Z5=Gn(),jd=Gn(),Qs=Ae({argsMap:(r,i)=>[r.getTrackId(),i.name]}),Jx=Ae({argsMap:r=>[r.getTrackId()]}),Qx=Ae({argsMap:r=>[r.getTrackId()]}),e2=Ae({argsMap:(r,i,o)=>[r.getTrackId(),i.label,o]}),et=class Wq extends Ih{get videoHeight(){if($e()){const{height:i}=this._mediaStreamTrack.getSettings();return this._videoHeight=i,this._videoHeight}return this._videoHeight}get videoWidth(){if($e()){const{width:i}=this._mediaStreamTrack.getSettings();return this._videoWidth=i,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Kr.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(i){this._processorContext=i}get __className__(){return"LocalVideoTrack"}constructor(i,o,a,l,d,h){if(super(i,d),$(this,"trackMediaType",wl.VIDEO),$(this,"_player",void 0),$(this,"isUseScaleResolutionDownBy",!1),$(this,"_videoVisibleTimer",null),$(this,"_previousVideoVisibleStatus",void 0),$(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),$(this,"_encoderConfig",void 0),$(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),$(this,"_optimizationMode",void 0),$(this,"_videoHeight",void 0),$(this,"_videoWidth",void 0),$(this,"_forceBitrateLimit",void 0),$(this,"_enabled",!0),$(this,"_processorDestination",void 0),$(this,"_processorContext",void 0),$e()){const{width:f,height:m}=i.getSettings();this._videoWidth=f,this._videoHeight=m}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=o,this._scalabilityMode=a,this._optimizationMode=l,this._hints=h||[],-1===this._hints.indexOf(zt.SCREEN_TRACK))this.updateBitrateFromProfile();else if(function(f){const v=ot();return!(v.name!==f||!v.osVersion)&&115===Number(v.version)}(It.CHROME)&&-1!==C_().indexOf("Windows")){const f=function(m){if("VideoFrame"in window&&"TransformStream"in window&&ct().supportWebRTCInsertableStream){const v=new MediaStreamTrackProcessor(m),y=new MediaStreamTrackGenerator({kind:"video"});let b,C,P=Date.now();const R=()=>{A&&(clearInterval(A),A=void 0),b&&(b.close(),b=void 0),m.stop(),C=void 0,y.removeEventListener("ended",R)};let A=window.setInterval(()=>{if(C&&b&&Date.now()-P>1e3)try{"live"===y.readyState?C.enqueue(b.clone()):R()}catch{R()}},1e3);const O=new TransformStream({transform:(M,x)=>{"live"===y.readyState?(C=x,P=Date.now(),void 0===b?(b=M,x.enqueue(M.clone())):(x.enqueue(b),b=M)):M.close()}});return y.addEventListener("ended",R),v.readable.pipeThrough(O).pipeTo(y.writable),y}}(i);f&&(T.info("local screen video track begin to inject frame"),this._mediaStreamTrack=f)}o&&-1!==this._hints.indexOf(zt.CUSTOM_TRACK)&&this.setEncoderConfiguration(o),this._processorContext=new Dx(this.getTrackId(),"local"),this._processorDestination=new LA(this.processorContext),this.bindProcessorDestinationEvents()}play(i){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof i){const l=document.getElementById(i);l?i=l:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(i,'" element, use document.body')),i=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(o));const a=rn(rn(rn({},this._getDefaultPlayerConfig()),o),{},{trackId:this.getTrackId(),element:i});this._player?this._player.updateConfig(a):(this._player=i instanceof HTMLVideoElement?new $S(a):new Kx(a),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const l=this.getVideoElementVisibleStatus();this.safeEmit(iv.VIDEO_ELEMENT_VISIBLE_STATUS,l)}catch{}},B("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}setEnabled(i,o){var a=this;return L(function*(){if(!o){if(i===a._enabled)return;a.stateCheck("enabled",i)}if(T.info("[".concat(a.getTrackId(),"] start setEnabled"),i),!i){a._originMediaStreamTrack.enabled=!1;try{yield Bt(a,ge.NEED_DISABLE_TRACK,a)}catch(l){throw T.error("[".concat(a.getTrackId(),"] setEnabled to false error"),l.toString()),l}return o||(a._enabled=!1),void T.info("[".concat(a.getTrackId(),"] setEnabled to false success"))}a._originMediaStreamTrack.enabled=!0;try{yield Bt(a,ge.NEED_ENABLE_TRACK,a)}catch(l){throw T.error("[".concat(a.getTrackId(),"] setEnabled to true error"),l.toString()),l}T.info("[".concat(a.getTrackId(),"] setEnabled to true success")),o||(a._enabled=!0)})()}setMuted(i){var o=this;return L(function*(){i!==o._muted&&(o.stateCheck("muted",i),o._muted=i,o._originMediaStreamTrack.enabled=!i,T.debug("[".concat(o.getTrackId(),"] start set muted: ").concat(i)),i?yield Bt(o,ge.NEED_MUTE_TRACK,o):yield Bt(o,ge.NEED_UNMUTE_TRACK,o))})()}setEncoderConfiguration(i,o){var a=this;return L(function*(){if(!a._enabled)throw new Y(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(i=Tl(i),a._forceBitrateLimit&&(i.bitrateMax=a._forceBitrateLimit.max_bitrate?a._forceBitrateLimit.max_bitrate:i.bitrateMax,i.bitrateMin=a._forceBitrateLimit.min_bitrate?a._forceBitrateLimit.min_bitrate:i.bitrateMin),i.width||i.height||i.frameRate){const l=dv({encoderConfig:i});($e()||nt()||Ks())&&(l.deviceId=void 0),T.debug("[".concat(a.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(i),JSON.stringify(l));try{yield a._originMediaStreamTrack.applyConstraints(l),a.updateMediaStreamTrackResolution()}catch(d){const h=new Y(k.UNEXPECTED_ERROR,d.toString());throw T.error("[".concat(a.getTrackId(),"] applyConstraints error"),h.toString()),h}}a._encoderConfig=i,-1===a._hints.indexOf(zt.SCREEN_TRACK)&&a.updateBitrateFromProfile();try{yield Bt(a,ge.NEED_UPDATE_VIDEO_ENCODER,a)}catch(l){return l.throw(T)}})()}getStats(){return yc(()=>{T.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Ao(this,ge.GET_STATS)||rn({},HS)}setBeautyEffect(i){return L(function*(){T.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")})()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}getCurrentFrameImage(i){var o=arguments,a=this;return L(function*(){return a._player?a._player.getCurrentFrameToUint8Array(i,o.length>1&&void 0!==o[1]?o[1]:1):yield UA(i)})()}setBitrateLimit(i){var o=this;return L(function*(){if(T.debug("[".concat(o.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(i))),i){o._forceBitrateLimit=i,o._encoderConfig&&(o._encoderConfig.bitrateMax=o._encoderConfig.bitrateMax&&o._encoderConfig.bitrateMax<i.max_bitrate?o._encoderConfig.bitrateMax:i.max_bitrate,o._encoderConfig.bitrateMin=i.min_bitrate);try{yield Bt(o,ge.NEED_UPDATE_VIDEO_ENCODER,o)}catch(a){return a.throw(T)}}})()}setOptimizationMode(i){var o=this;return L(function*(){if("motion"!==i&&"detail"!==i&&"balanced"!==i)return void T.error(k.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const a=o._optimizationMode;try{o._optimizationMode=i,yield Bt(o,ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,o)}catch(l){throw o._optimizationMode=a,T.error("[".concat(o.getTrackId(),"] set optimization mode failed"),l.toString()),l}T.info("[".concat(o.getTrackId(),"] set optimization mode success (").concat(i,")"))})()}setScalabiltyMode(i){if(1===i.numSpatialLayers&&1!==i.numTemporalLayers)return T.error(k.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=i,T.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(i,")"))}updateMediaStreamTrackResolution(){FA(this._originMediaStreamTrack).then(i=>{let[o,a]=i;this._videoHeight=a,this._videoWidth=o}).catch(fS)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}setSenderConfiguration(i){var o=this;return L(function*(){if(!o._enabled)throw new Y(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");T.debug("[".concat(o.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(i)),i=Tl(i),o._forceBitrateLimit&&(i.bitrateMax=o._forceBitrateLimit.max_bitrate?o._forceBitrateLimit.max_bitrate:i.bitrateMax,i.bitrateMin=o._forceBitrateLimit.min_bitrate?o._forceBitrateLimit.min_bitrate:i.bitrateMin),o._encoderConfig=i,-1===o._hints.indexOf(zt.SCREEN_TRACK)&&o.updateBitrateFromProfile();try{yield Bt(o,ge.NEED_UPDATE_VIDEO_ENCODER,o)}catch(a){return a.throw(T)}})()}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:i,height:o,frameRate:a}=this.getMediaStreamTrackSettings();if(!i||!o||!a)return;const{bitrateMax:l,bitrateMin:d}=this._encoderConfig;if(null==d||null==l){const{max:h,min:f}=function(m,g,v,y,b){const C=B("BITRATE_ADAPTER_TYPE");if("DEFAULT_BITRATE"===C)return{min:y,max:b};if(void 0===b){var P;const A=Math.floor(200*Math.pow(v/15,.6)*Math.pow(m*g/640/360,.75));b="STANDARD_BITRATE"===C?4*A:2*A,y=null!==(P=y)&&void 0!==P?P:A}else{var R;y=null!==(R=y)&&void 0!==R?R:Math.floor(b/10)}return{min:y,max:b}}(i,o,a,d,l);this._encoderConfig.bitrateMin=f,this._encoderConfig.bitrateMax=h,T.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(i,", h: ").concat(o,", fps: ").concat(a,"] => [brMax: ").concat(h,", brMin: ").concat(f,"]"))}}getVideoElementVisibleStatus(){try{var i,o;const a=null==this||null===(i=this._player)||void 0===i?void 0:i.getContainerElement(),l={track:this,element:null==this||null===(o=this._player)||void 0===o?void 0:o.getVideoElement(),slot:a?.parentElement},{element:d,slot:h}=l;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const f=rL.checkOneElementVisible(d),m=Object.assign({},f);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;be.reportApiInvoke(null,{tag:st.TRACER,name:Yn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(m.visible?"Video is visible":"Invisible because of ".concat(m.reason))}return m}return}catch(a){throw new Y(k.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}renewMediaStreamTrack(i){return L(function*(){})()}pipe(i){if(this.processor===i)return i;if(i._source)throw new Y(k.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),i}unpipe(){if(!this.processor)return;const i=this.processor;this.processor._source=void 0,this.processor=void 0,i.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(i){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this._encoderConfig;i&&(a=rn(rn({},a),Tl(i))),a=ph(a);const l=Ct(8,"track-video-cloned-"),d=new Wq(o?this._mediaStreamTrack.clone():this._mediaStreamTrack,a,ph(this._scalabilityMode),this._optimizationMode,l,ph(this._hints));return i&&a&&d.setEncoderConfiguration(a),T.debug("clone video track from ".concat(this.getTrackId()," to ").concat(l,", clone ").concat(o)),d}replaceTrack(i,o){var a=this;return L(function*(){if(!(i instanceof MediaStreamTrack))throw new Y(k.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==i.kind)throw new Y(k.INVALID_PARAMS,"track should be a video MediaStreamTrack");yield a._updateOriginMediaStreamTrack(i,o,!0),a.updateMediaStreamTrackResolution()})()}sendSeiData(i){if(yc(()=>{be.reportApiInvoke(null,{name:Yn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:st.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!B("ENABLE_VIDEO_SEI")||!B("ENABLE_ENCODED_TRANSFORM"))return void T.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(i instanceof Uint8Array==0)return new Y(k.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const o=this.getRTCRtpTransceiver();if(!o)return void T.warning("Video track is not published, SEI can not be send");const a=o.sender.getParameters();if(0===a.codecs.length)return;const l=a.codecs[0].mimeType.toLocaleLowerCase();"video/h264"===l?this.safeEmit("sei-to-send",i):T.warning("SEI is not supported by ".concat(l))}bindProcessorDestinationEvents(){var i=this;this.processorDestination.on(di.ON_TRACK,function(){var o=L(function*(a){a?a!==i._mediaStreamTrack&&(i._mediaStreamTrack=a,i._updatePlayerSource(),yield Bt(i,ge.NEED_REPLACE_TRACK,i)):i._mediaStreamTrack!==i._originMediaStreamTrack&&(i._mediaStreamTrack=i._originMediaStreamTrack,i._updatePlayerSource(),yield Bt(i,ge.NEED_REPLACE_TRACK,i))});return function(a){return o.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(di.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(as.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(as.REQUEST_CONSTRAINTS)}},Qe(et.prototype,"play",[qx,V5],Object.getOwnPropertyDescriptor(et.prototype,"play"),et.prototype),Qe(et.prototype,"stop",[Yx],Object.getOwnPropertyDescriptor(et.prototype,"stop"),et.prototype),Qe(et.prototype,"setEnabled",[B5,j5,H5],Object.getOwnPropertyDescriptor(et.prototype,"setEnabled"),et.prototype),Qe(et.prototype,"setMuted",[$x,zi,Xx],Object.getOwnPropertyDescriptor(et.prototype,"setMuted"),et.prototype),Qe(et.prototype,"setEncoderConfiguration",[G5,W5],Object.getOwnPropertyDescriptor(et.prototype,"setEncoderConfiguration"),et.prototype),Qe(et.prototype,"getStats",[z5],Object.getOwnPropertyDescriptor(et.prototype,"getStats"),et.prototype),Qe(et.prototype,"setBeautyEffect",[K5,q5],Object.getOwnPropertyDescriptor(et.prototype,"setBeautyEffect"),et.prototype),Qe(et.prototype,"getCurrentFrameData",[Zx],Object.getOwnPropertyDescriptor(et.prototype,"getCurrentFrameData"),et.prototype),Qe(et.prototype,"getCurrentFrameImage",[Y5],Object.getOwnPropertyDescriptor(et.prototype,"getCurrentFrameImage"),et.prototype),Qe(et.prototype,"setBitrateLimit",[$5],Object.getOwnPropertyDescriptor(et.prototype,"setBitrateLimit"),et.prototype),Qe(et.prototype,"setOptimizationMode",[X5],Object.getOwnPropertyDescriptor(et.prototype,"setOptimizationMode"),et.prototype),Qe(et.prototype,"setScalabiltyMode",[Z5],Object.getOwnPropertyDescriptor(et.prototype,"setScalabiltyMode"),et.prototype),Qe(et.prototype,"updateMediaStreamTrackResolution",[jd],Object.getOwnPropertyDescriptor(et.prototype,"updateMediaStreamTrackResolution"),et.prototype),Qe(et.prototype,"pipe",[Qs],Object.getOwnPropertyDescriptor(et.prototype,"pipe"),et.prototype),Qe(et.prototype,"unpipe",[Jx],Object.getOwnPropertyDescriptor(et.prototype,"unpipe"),et.prototype),Qe(et.prototype,"close",[Qx],Object.getOwnPropertyDescriptor(et.prototype,"close"),et.prototype),Qe(et.prototype,"replaceTrack",[e2],Object.getOwnPropertyDescriptor(et.prototype,"replaceTrack"),et.prototype),et),XS=(XA=Ae({argsMap:(r,i)=>[r.getTrackId(),i]}),J5=Gn(),Q5=Af("CameraVideoTrack","_enabledMutex"),eH=Ae({argsMap:(r,i)=>[r.getTrackId(),i]}),ZA=Gn(),Dl=Ae({argsMap:(r,i)=>[r.getTrackId(),i]}),t2=Gn(),n2=Ae({argsMap:r=>[r.getTrackId()]}),Is=class zq extends Ve{get __className__(){return"CameraVideoTrack"}constructor(i,o,a,l,d,h){var f;super(i,Tl(o.encoderConfig),l,d,h),f=this,$(this,"_config",void 0),$(this,"_originalConstraints",void 0),$(this,"_constraints",void 0),$(this,"_enabled",!0),$(this,"_deviceName","default"),$(this,"tryResumeVideoForIOS15_16WeChat",L(function*(){(Tf()||fR())&&!function(){const m=ot();if(m.os!==hr.IOS||!m.osVersion)return!1;const g=m.osVersion.split(".");return 15===Number(g[0])&&Number(g[1])>=2}()&&uS()&&f._enabled&&!f._isClosed&&(T.debug("[".concat(f.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),yield f.renewMediaStreamTrack())})),this._config=o,this._originalConstraints=a,this._constraints=a,this._deviceName=i.label,this._encoderConfig=Tl(this._config.encoderConfig),Lt.on(Ir.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Lt.on(Ir.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}setDevice(i){var o=this;return L(function*(){return"string"==typeof i?o._setDeviceById(i):i.deviceId?o._setDeviceById(i.deviceId):i.facingMode?o._setDeviceByFacingModel(i.facingMode):void 0})()}_setDeviceById(i){var o=this;return L(function*(){if(T.info("[".concat(o.getTrackId(),"] set device to ").concat(i)),o._enabled)try{const a=yield po.getDeviceById(i),l={};l.video=rn({},o._constraints),l.video.deviceId={exact:i},l.video.facingMode=void 0,o._originMediaStreamTrack.stop();let d=null;try{d=yield Gi(l,o.getTrackId())}catch(h){throw T.error("[".concat(o.getTrackId(),"] setDevice failed"),h.toString()),d=yield Gi({video:o._constraints},o.getTrackId()),yield o._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),h}yield o._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),o.updateMediaStreamTrackResolution(),o._deviceName=a.label,o._config.cameraId=i,o._constraints.deviceId={exact:i}}catch(a){throw T.error("[".concat(o.getTrackId(),"] setDevice error"),a.toString()),a}else try{const a=yield po.getDeviceById(i);o._deviceName=a.label,o._config.cameraId=i,o._constraints.deviceId={exact:i}}catch(a){throw T.error("[".concat(o.getTrackId(),"] setDevice error"),a.toString()),a}T.info("[".concat(o.getTrackId(),"] setDevice success"))})()}_setDeviceByFacingModel(i){var o=this;return L(function*(){T.info("[".concat(o.getTrackId(),"] set facingMode ").concat(i));const a={video:rn(rn({},o._constraints),{},{deviceId:void 0,facingMode:{exact:i}})};if(o._enabled){o._originMediaStreamTrack.stop();let l=null;try{l=yield Gi(a,o.getTrackId())}catch(d){throw T.error("[".concat(o.getTrackId(),"] setDeviceByFacingModel failed"),d.toString()),l=yield Gi({video:o._constraints},o.getTrackId()),yield o._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1),d}yield o._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1),o.updateMediaStreamTrackResolution()}o._deviceName="",o._config.facingMode=i,o._config.cameraId=void 0,o._constraints=rn({},a.video),T.info("[".concat(o.getTrackId(),"] setDeviceByFacingModel success"))})()}setEnabled(i,o){var a=this;return L(function*(){if(!o){if(i===a._enabled)return;a.stateCheck("enabled",i)}if(T.info("[".concat(a.getTrackId(),"] start setEnabled"),i),i){try{if(a.isExternalTrack)a._originMediaStreamTrack.enabled=!0;else{const l=yield Gi({video:a._constraints},a.getTrackId());yield a._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1)}yield Bt(a,ge.NEED_ENABLE_TRACK,a)}catch(l){throw T.error("[".concat(a.getTrackId(),"] setEnabled true error"),l.toString()),l}a.updateMediaStreamTrackResolution(),T.info("[".concat(a.getTrackId(),"] setEnabled to true success")),o||(a._enabled=!0)}else{a.isExternalTrack?a._originMediaStreamTrack.enabled=!1:(a._originMediaStreamTrack.onended=null,a._originMediaStreamTrack.stop()),o||(a._enabled=!1);try{yield Bt(a,ge.NEED_DISABLE_TRACK,a)}catch(l){throw T.error("[".concat(a.getTrackId(),"] setEnabled to false error"),l.toString()),l}T.info("[".concat(a.getTrackId(),"] setEnabled to false success"))}})()}setEncoderConfiguration(i,o){var a=this;return L(function*(){if(!a._enabled)throw new Y(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");i=Tl(i),a._forceBitrateLimit&&(i.bitrateMax=a._forceBitrateLimit.max_bitrate||i.bitrateMax,i.bitrateMin=a._forceBitrateLimit.min_bitrate||i.bitrateMin);const l=Vn(a._config);l.encoderConfig=i;const d=dv(l);($e()||nt()||Ks())&&(d.deviceId=void 0),T.debug("[".concat(a.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(i),JSON.stringify(d));try{yield a._originMediaStreamTrack.applyConstraints(d),a.updateMediaStreamTrackResolution()}catch(h){const f=new Y(k.UNEXPECTED_ERROR,h.toString());throw T.error("[".concat(a.getTrackId(),"] applyConstraints error"),f.toString()),f}a._config=l,a._constraints=d,a._originalConstraints=d,a._encoderConfig=i,-1===a._hints.indexOf(zt.SCREEN_TRACK)&&a.updateBitrateFromProfile();try{yield Bt(a,ge.NEED_UPDATE_VIDEO_ENCODER,a)}catch(h){return h.throw(T)}})()}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){var i=this;if((nt()||Ks())&&this._enabled&&!this._isClosed&&Lt.duringInterruption){const o=function(){var a=L(function*(){Lt.off(Ir.IOS_INTERRUPTION_END,o),i._enabled&&!i._isClosed&&(T.debug("[".concat(i.getTrackId(),"] try capture camera media device for interrupted iOS device.")),yield i.setEnabled(!1),yield i.setEnabled(!0))});return function(){return a.apply(this,arguments)}}();Lt.on(Ir.IOS_INTERRUPTION_END,o)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(iv.TRACK_ENDED)}renewMediaStreamTrack(i){var o=this;return L(function*(){const a=i||o._constraints,l=po.searchDeviceIdByName(o._deviceName);if(l&&!a.deviceId&&(a.deviceId={exact:l}),o._enabled){const d=yield Gi({video:a},o.getTrackId());o._constraints=a,yield o._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!0),o.updateMediaStreamTrackResolution()}})()}close(){super.close(),Lt.off(Ir.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Lt.off(Ir.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(i){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this._encoderConfig;i&&(a=rn(rn({},a),Tl(i))),a=ph(a);const l=Ct(8,"track-cam-cloned-"),d=new zq(o?this._mediaStreamTrack.clone():this._mediaStreamTrack,ph(rn(rn({},this._config),{},{encoderConfig:a})),ph(this._constraints),ph(this._scalabilityMode),this._optimizationMode,l);return i&&a&&d.setEncoderConfiguration(a),T.debug("clone track from ".concat(this.getTrackId()," to ").concat(l,", clone ").concat(o)),d}bindProcessorContextEvents(){var i=this;this.processorContext.on(as.REQUEST_UPDATE_CONSTRAINTS,function(){var o=L(function*(a,l,d){try{const h=Object.assign({},i._originalConstraints,...a);yield i.renewMediaStreamTrack(h),l()}catch(h){d(h)}});return function(a,l,d){return o.apply(this,arguments)}}()),this.processorContext.on(as.REQUEST_CONSTRAINTS,function(){var o=L(function*(a){a(i._originMediaStreamTrack.getSettings())});return function(a){return o.apply(this,arguments)}}())}},Qe(Is.prototype,"setDevice",[XA,J5],Object.getOwnPropertyDescriptor(Is.prototype,"setDevice"),Is.prototype),Qe(Is.prototype,"setEnabled",[Q5,eH,ZA],Object.getOwnPropertyDescriptor(Is.prototype,"setEnabled"),Is.prototype),Qe(Is.prototype,"setEncoderConfiguration",[Dl,t2],Object.getOwnPropertyDescriptor(Is.prototype,"setEncoderConfiguration"),Is.prototype),Qe(Is.prototype,"close",[n2],Object.getOwnPropertyDescriptor(Is.prototype,"close"),Is.prototype),Is);function r2(r,i,o,a){o.optimizationMode&&(a&&a.width&&a.height?(o.encoderConfig=rn(rn({},a),{},{bitrateMin:a.bitrateMin,bitrateMax:a.bitrateMax}),"motion"!==o.optimizationMode&&"detail"!==o.optimizationMode||(i.contentHint=o.optimizationMode,i.contentHint===o.optimizationMode?T.debug("[".concat(r,"] set content hint to"),o.optimizationMode):T.debug("[".concat(r,"] set content hint failed")))):T.warning("[".concat(r,"] can not apply optimization mode bitrate config, no encoderConfig")))}var o2,JA,QA,Hd,fo,s2,a2,tH,Ah,c2,l2,ui;class d2 extends bx{getUserId(){return this._userId}constructor(i,o,a,l){super(i,"track-".concat(i.kind,"-").concat(o,"-").concat(l.clientId,"_").concat(Ct(5,""))),$(this,"_userId",void 0),$(this,"_uintId",void 0),$(this,"_isDestroyed",!1),$(this,"store",void 0),$(this,"processor",void 0),$(this,"processorContext",void 0),this._userId=o,this._uintId=a,this.store=l}_updateOriginMediaStreamTrack(i){this._originMediaStreamTrack=i,this._mediaStreamTrack=i,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,T.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Dh=(o2=Ae({argsMap:(r,i,o)=>[r.getTrackId(),"string"==typeof i?i:i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",o]}),JA=Ae({argsMap:r=>[r.getTrackId()]}),QA=Ae({argsMap:(r,i)=>[r.getTrackId(),i.name]}),Hd=Ae({argsMap:r=>[r.getTrackId()]}),Qe((fo=class extends d2{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Kr.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(r,i,o,a){super(r,i,o,a),$(this,"_videoVisibleTimer",null),$(this,"_previousVideoVisibleStatus",void 0),$(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),$(this,"trackMediaType",wl.VIDEO),$(this,"_videoWidth",void 0),$(this,"_videoHeight",void 0),$(this,"_player",void 0),$(this,"processorDestination",void 0),$(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new Dx(this.getTrackId(),"remote"),this.processorDestination=new LA(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return yc(()=>{T.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Ao(this,ge.GET_STATS)||rn({},GS)}play(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof r){const a=document.getElementById(r);a?r=a:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const o=rn(rn({fit:"cover"},i),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(o):(this._player=r instanceof HTMLVideoElement?new $S(o):new Kx(o),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Th.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=a=>{this.safeEmit(Th.VIDEO_STATE_CHANGED,a)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const a=this.getVideoElementVisibleStatus();this.safeEmit(Th.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}},B("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){FA(this._originMediaStreamTrack).then(r=>{let[i,o]=r;this._videoHeight=o,this._videoWidth=i}).catch(fS)}_updatePlayerSource(){T.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var r,i;const o=null==this||null===(r=this._player)||void 0===r?void 0:r.getContainerElement(),a={track:this,element:null==this||null===(i=this._player)||void 0===i?void 0:i.getVideoElement(),slot:o?.parentElement},{element:l,slot:d}=a;if(this.isPlaying&&l instanceof HTMLVideoElement&&d instanceof HTMLElement){const h=rL.checkOneElementVisible(l),f=Object.assign({},h);if(f.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=f.visible;be.reportApiInvoke(null,{tag:st.TRACER,name:Yn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(f.visible?"Video is visible":"Invisible because of ".concat(f.reason))}return f}return}catch(o){throw new Y(k.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}pipe(r){if(this.processor===r)return r;if(r._source)throw new Y(k.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){var r=this;this.processorDestination.on(di.ON_TRACK,function(){var i=L(function*(o){o?o!==r._mediaStreamTrack&&(r._mediaStreamTrack=o,r._updatePlayerSource()):r._mediaStreamTrack!==r._originMediaStreamTrack&&(r._mediaStreamTrack=r._originMediaStreamTrack,r._updatePlayerSource())});return function(o){return i.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(di.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(r){this.emit(jf.SEI_RECEIVED,r)}}).prototype,"play",[o2],Object.getOwnPropertyDescriptor(fo.prototype,"play"),fo.prototype),Qe(fo.prototype,"stop",[JA],Object.getOwnPropertyDescriptor(fo.prototype,"stop"),fo.prototype),Qe(fo.prototype,"pipe",[QA],Object.getOwnPropertyDescriptor(fo.prototype,"pipe"),fo.prototype),Qe(fo.prototype,"unpipe",[Hd],Object.getOwnPropertyDescriptor(fo.prototype,"unpipe"),fo.prototype),fo),Ol=(s2=Ae({argsMap:(r,i)=>[r.getTrackId(),i],throttleTime:300}),a2=Ae({argsMap:(r,i)=>[r.getTrackId(),i]}),tH=Ae({argsMap:r=>[r.getTrackId()]}),Ah=Ae({argsMap:r=>[r.getTrackId()]}),c2=Ae({argsMap:(r,i)=>[r.getTrackId(),i.name]}),l2=Ae({argsMap:r=>[r.getTrackId()]}),Qe((ui=class extends d2{get isPlaying(){return this._useAudioElement?Wi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(r,i,o,a){super(r,i,o,a),$(this,"trackMediaType",wl.AUDIO),$(this,"_source",void 0),$(this,"_useAudioElement",!0),$(this,"_volume",100),$(this,"processorContext",void 0),$(this,"processorDestination",void 0),$(this,"_played",!1),$(this,"_bypassWebAudio",!1),B("DISABLE_WEBAUDIO")?(this._source=new Rh,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new Cx(r,!0),B("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(ss.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Th.FIRST_FRAME_DECODED)}),this.processorContext=new lv(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new xA(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(ss.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!r)return this._source.removeAllListeners(ss.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(i),this._source.removeAllListeners(ss.ON_AUDIO_BUFFER),this._source.on(ss.ON_AUDIO_BUFFER,o=>r(o))}setVolume(r){this._volume=r,this._useAudioElement?Wi.setVolume(this.getTrackId(),r):this._source.setVolume(r/100)}setPlaybackDevice(r){var i=this;return L(function*(){if(!i._useAudioElement||!mx())throw new Y(k.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield Wi.setSinkID(i.getTrackId(),r)})()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return yc(()=>{T.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Ao(this,ge.GET_STATS)||rn({},Vd)}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] use audio element to play")),Wi.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Wi.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),r&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Wi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(r){if(this._bypassWebAudio)throw new Y(k.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===r)return r;if(r._source)throw new Y(k.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),r}unpipe(){var r;if(this._bypassWebAudio)throw new Y(k.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const i=this.processor;null===(r=this._source.processSourceNode)||void 0===r||r.disconnect(),this.processor._source=!1,this.processor=void 0,i.reset()}bindProcessorDestinationEvents(){var r=this;this.processorDestination.on(di.ON_TRACK,function(){var i=L(function*(o){o?o!==r._mediaStreamTrack&&(r._mediaStreamTrack=o,r._updatePlayerSource(!1),r._source.processedNode=r._source.createMediaStreamSourceNode(o)):r._mediaStreamTrack!==r._originMediaStreamTrack&&(r._mediaStreamTrack=r._originMediaStreamTrack,r._updatePlayerSource())});return function(o){return i.apply(this,arguments)}}()),this.processorDestination.on(di.ON_NODE,i=>{this._source.processedNode=i;const o=!i;this._useAudioElement!==o&&(this._played?(this.stop(),this._useAudioElement=o,this.play()):this._useAudioElement=o)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(di.ON_TRACK),this.processorDestination.removeAllListeners(di.ON_NODE)}}).prototype,"setVolume",[s2],Object.getOwnPropertyDescriptor(ui.prototype,"setVolume"),ui.prototype),Qe(ui.prototype,"setPlaybackDevice",[a2],Object.getOwnPropertyDescriptor(ui.prototype,"setPlaybackDevice"),ui.prototype),Qe(ui.prototype,"play",[tH],Object.getOwnPropertyDescriptor(ui.prototype,"play"),ui.prototype),Qe(ui.prototype,"stop",[Ah],Object.getOwnPropertyDescriptor(ui.prototype,"stop"),ui.prototype),Qe(ui.prototype,"pipe",[c2],Object.getOwnPropertyDescriptor(ui.prototype,"pipe"),ui.prototype),Qe(ui.prototype,"unpipe",[l2],Object.getOwnPropertyDescriptor(ui.prototype,"unpipe"),ui.prototype),ui);const cs=new class extends nn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),$(this,"_lastHiddenTime",0),$(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),T.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class mo extends nn{constructor(i,o){super(),$(this,"trackMediaType",wl.DATA),$(this,"_version",1),$(this,"_type",3),$(this,"_config",void 0),$(this,"_originDataChannel",void 0),$(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),$(this,"_dataStreamPacketHandler",{serialize:a=>a,deserialize:a=>a}),$(this,"_datachannelEventMap",new Map),this._config=i,o&&(this._originDataChannel=o,this._bandDataChannelEvents(o)),this._initPacketHeader()}useDataStream(i){this._dataStreamPacketHandler=i}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return B("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var i,o;return null!==(i=null===(o=this._originDataChannel)||void 0===o?void 0:o.readyState)&&void 0!==i?i:"connecting"}get _originDataChannelId(){var i,o;return null!==(i=null===(o=this._originDataChannel)||void 0===o?void 0:o.id)&&void 0!==i?i:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}_waitTillOpen(){var i=this;return L(function*(){return new le((o,a)=>{if(i._originDataChannel){"open"===i._originDataChannel.readyState&&o();const l=setTimeout(()=>{var d;a(new Y(k.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(d=i._originDataChannel)||void 0===d?void 0:d.id)))},1e4);i._originDataChannel.onopen=()=>{clearTimeout(l),i._originDataChannel&&i._bandDataChannelEvents(i._originDataChannel),o()},i._originDataChannel.onerror=()=>{throw clearTimeout(l),new Y(k.DATACHANNEL_CONNECTION_TIMEOUT)}}else a(new Y(k.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})})()}_updateOriginDataChannel(i){this._originDataChannel=i,this._bandDataChannelEvents(i)}_initPacketHeader(){const i=new DataView(this._dataStreamPacketHeader);i.setUint16(0,this._version),i.setUint8(2,this._type),i.setUint8(3,this._config.id)}_bandDataChannelEvents(i){this._unbindDataChannelEvents(i),[RA.OPEN,RA.CLOSE,RA.ERROR].forEach(o=>{const a=()=>{this.emit(o)};this._datachannelEventMap.set(o,a),i.addEventListener(o,a)})}_unbindDataChannelEvents(i){Array.from(this._datachannelEventMap.entries()).forEach(o=>{let[a,l]=o;i.removeEventListener(a,l)}),this._datachannelEventMap.clear()}}class ar extends mo{constructor(i){super(i),$(this,"_messageListener",void 0),this._messageListener=o=>{if(o.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const a=o.data.slice(0,this._dataStreamPacketHeader.byteLength),l=new DataView(a).getUint8(3);if(l!==this.id)return void(B("SHOW_DATASTREAM2_LOG")&&T.debug("invalid datachannel id: ".concat(l," !== ").concat(this.id)));let d=o.data.slice(this._dataStreamPacketHeader.byteLength);d=this._dataStreamPacketHandler.deserialize(d),this.emit(RA.MESSAGE,d)}}_updateOriginDataChannel(i){super._updateOriginDataChannel(i),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Rs extends mo{send(i){if(this._originDataChannel){let o=i;o=this._dataStreamPacketHandler.serialize(i);const a=new Uint8Array(this._dataStreamPacketHeader.byteLength+o.byteLength);a.set(new Uint8Array(this._dataStreamPacketHeader),0),a.set(new Uint8Array(o),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(a.buffer)}}}function kr(){const r=new Blob([atob("ZnVuY3Rpb24gZShlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLGE9W10sbz0wO2Zvcig7YS5sZW5ndGg8bjspbyszPG4mJjA9PT1yW29dJiYwPT09cltvKzFdJiYzPT09cltvKzJdJiYoMD09PXJbbyszXXx8MT09PXJbbyszXXx8Mj09PXJbbyszXXx8Mz09PXJbbyszXSk/KGEucHVzaChyW29dLHJbbysxXSxyW28rM10pLG8rPTQpOihhLnB1c2gocltvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYSl9ZnVuY3Rpb24gdChlLHQpe2NvbnN0IG49ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmxlbmd0aDtsZXQgbj1bXSxyPTA7Zm9yKDtyPHQ7KXIrMjx0JiYwPT09ZVtyXSYmMD09PWVbcisxXSYmKDA9PT1lW3IrMl18fDE9PT1lW3IrMl18fDI9PT1lW3IrMl18fDM9PT1lW3IrMl0pPyhuLnB1c2goZVtyXSxlW3IrMV0sMyxlW3IrMl0pLHIrPTMpOihuLnB1c2goZVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KHQpLHI9bi5sZW5ndGgsYT1NYXRoLmZsb29yKHIvMjU1KSxvPXIlMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNithKzErcitlLmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8YTspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1vLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkoZSksNitpK3IpLHMuYnVmZmVyfW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+LTEmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKHNlbGYub25ydGN0cmFuc2Zvcm09bj0+e2NvbnN0IHI9bi50cmFuc2Zvcm1lcjtsZXQgYT1bXTtyLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9ZT0+e2UuZGF0YS5zZWkmJmEucHVzaChlLmRhdGEuc2VpKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IG89ci5yZWFkYWJsZS5nZXRSZWFkZXIoKSxzPXIud3JpdGFibGUuZ2V0V3JpdGVyKCk7InJ4Ij09PXIub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1mdW5jdGlvbih0KXtjb25zdCBuPW5ldyBEYXRhVmlldyh0LmRhdGEpO2xldCByPTA7Zm9yKDtyKzQ8dC5kYXRhLmJ5dGVMZW5ndGg7KXtpZigwPT09bi5nZXRVaW50OChyKzApJiYwPT09bi5nZXRVaW50OChyKzEpJiYwPT09bi5nZXRVaW50OChyKzIpJiYxPT09bi5nZXRVaW50OChyKzMpJiY2PT09bi5nZXRVaW50OChyKzQpKXtsZXQgYT1yKzYsbz0wLHM9MDtmb3IoOzI1NT09PShzPW4uZ2V0VWludDgoYSsrKSk7KW8rPTI1NTtvKz1zO2NvbnN0IGk9ZSh0LmRhdGEsYSxvKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaSl9cisrfXJldHVybiBudWxsfShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1hLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>SA.revokeObjectURL(r),0),new Worker(SA.createObjectURL(r))}const ZS=new Map,JS=new Map;function nH(r,i,o){let a=new Uint8Array(r,i,o),l=[],d=0;for(;l.length<o;)d+3<o&&0===a[d]&&0===a[d+1]&&3===a[d+2]&&(0===a[d+3]||1===a[d+3]||2===a[d+3]||3===a[d+3])?(l.push(a[d],a[d+1],a[d+3]),d+=4):(l.push(a[d]),d++);return new Uint8Array(l)}const QS=new Map;function eD(){return eD=L(function*(r,i){if(!ct().supportWebRTCEncodedTransform)return void T.warning("browser not support video encoded transform");if(QS.has(r)||!r.track)return;const o={track:r.track};if(hh()){if(!r.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let l=null;try{l=r.createEncodedStreams()}catch(f){return void T.error("create video-encoded-streams error",f&&f.message)}let d=[];i.on("sei-to-send",f=>{d.push(f)});const h=new TransformStream({transform(f,m){o.controller||(o.controller=m),r.track&&r.track.id!==o.track.id&&(T.debug("video track changed: ".concat(o.track.id," => ").concat(r.track.id)),o.track.removeEventListener("ended",a),o.track=r.track,o.track.addEventListener("ended",a));const g=d.shift();g&&(f.data=function(v,y){const b=function(M){const x=M.length;let j=[],W=0;for(;W<x;)W+2<x&&0===M[W]&&0===M[W+1]&&(0===M[W+2]||1===M[W+2]||2===M[W+2]||3===M[W+2])?(j.push(M[W],M[W+1],3,M[W+2]),W+=3):(j.push(M[W]),W++);return new Uint8Array(j)}(y),C=b.length,P=Math.floor(C/255),R=C%255,A=new Uint8Array(6+P+1+C+v.byteLength);A[0]=0,A[1]=0,A[2]=0,A[3]=1,A[4]=6,A[5]=101;let O=0;for(;O<P;)A[6+O]=255,O++;return A[6+O]=R,O++,A.set(b,6+O),A.set(new Uint8Array(v),6+O+C),A.buffer}(f.data,g)),m.enqueue(f)}});l.readable.pipeThrough(h).pipeTo(l.writable)}else{if(!$e())return;{if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const l=kr(),d=new MessageChannel;yield new le(f=>l.onmessage=m=>{"registered"===m.data&&f(void 0)});const h=new RTCRtpScriptTransform(l,{name:"tx",port:d.port2},[d.port2]);r.transform=h,yield new le(f=>l.onmessage=m=>{"started"===m.data&&f(void 0)}),i.on("sei-to-send",f=>{d.port1.postMessage({sei:f})}),d.port1.onmessage=f=>{var m;f.data.transformed&&r.track&&(null===(m=r.track)||void 0===m?void 0:m.id)!==o.track.id&&(T.debug("video track changed: ".concat(o.track.id," => ").concat(r.track.id)),o.track.removeEventListener("ended",a),o.track=r.track,o.track.addEventListener("ended",a))},o.worker=l}}function a(){if(r.track){if(this.id!==r.track.id)return;r.track.removeEventListener("ended",a)}const l=QS.get(r);if(l){QS.delete(r);try{var d,h;null===(d=l.controller)||void 0===d||d.terminate(),null===(h=l.worker)||void 0===h||h.terminate()}catch(f){T.warning(f&&f.message)}}}QS.set(r,o),r.track.addEventListener("ended",a)}),eD.apply(this,arguments)}const eC=new Map;!function(){const r=ot();Hn.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Hn.getStreamFromExtension=r.name===It.CHROME&&Number(r.version)>34,Hn.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const i=new RTCPeerConnection;let o=!1;try{i.addTransceiver("audio"),o=!0}catch{}return i.close(),o}(),Hn.supportMinBitrate=r.name===It.CHROME||r.name===It.EDGE,Hn.supportSetRtpSenderParameters=function(){const i=ot();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!pl()||!(!$e()&&!T_())||i.name===It.FIREFOX&&Number(i.version)>=64)}(),r.name===It.SAFARI&&(Hn.supportDualStream=Number(r.version)>=14),Hn.webAudioMediaStreamDest=function(){const i=ot();return!(i.name===It.SAFARI&&Number(i.version)<12)}(),Hn.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,Hn.supportWebGL=typeof WebGLRenderingContext<"u",Hn.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,pl()||(Hn.webAudioWithAEC=!0),Hn.supportShareAudio=function(){const i=ot();return(i.os===hr.WIN_10||i.os===hr.WIN_81||i.os===hr.WIN_7||i.os===hr.LINUX||i.os===hr.MAC_OS||i.os===hr.CHROMIUM_OS)&&i.name===It.CHROME&&Number(i.version)>=74}(),Hn.supportDataChannel=!!(Gs(76)||function(){const o=ot();return!(o.name!==It.FIREFOX||!o.osVersion)&&Number(o.version)>=68}()||Da(14)),Hn.supportPCSetConfiguration=function(){const i=window.RTCPeerConnection;return!hn()&&!!i&&i.prototype.setConfiguration instanceof Function}(),Hn.supportWebRTCEncodedTransform=function(){const i=ot();return"Chrome"===i.name&&Number(i.version)>=86||"Safari"===i.name&&Number(i.version)>=15}(),Hn.supportWebRTCInsertableStream=function(){const i=ot();return(i.name===It.CHROME||i.name===It.EDGE)&&Number(i.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Hn.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Hn.supportWebCrypto=typeof window<"u"&&void 0!==window.crypto&&void 0!==window.crypto.subtle,D_(()=>{Hn.supportDualStreamEncoding=function(){const i=ot();return!!B("DISABLE_WEBAUDIO")||"Safari"===i.name&&Number(i.version)>=14||!!("Chrome"===i.name&&/Windows/i.test(i.os||"")&&Number(i.version)>=100&&B("CHROME_DUAL_STREAM_USE_ENCODING"))}(),T.debug("browser ua: ",navigator.userAgent),T.info("browser info: ",r),T.info("browser compatibility: ",Hn)})}();class zf extends nn{constructor(i,o){super(),N(this,"signal",void 0),N(this,"token",void 0),N(this,"tokenTimeout",void 0),N(this,"tokenInterval",void 0),N(this,"_sequence",0),N(this,"userMap",new Map),N(this,"encoder",new TextEncoder),this.signal=i,this.token=o;const a=()=>{this.signal.connectionState===qt.CONNECTED&&this.check(),this.tokenInterval=0===this.userMap.size?window.setTimeout(a,1e3):window.setTimeout(a,3*B("P2P_TOKEN_INTERVAL"))};a()}send(i,o,a,l,d){var h=this;return L(function*(){var f,m,g;if(0===h.userMap.size)return;const v=Array.from(xd(f=h.userMap).call(f))[0].token;"string"!=typeof o&&(o=JSON.stringify(o)),l=null!==(m=l)&&void 0!==m?m:Ct(6,""),d=null!==(g=d)&&void 0!==g?g:h._sequence++;const y={_id:l,_type:i,_seq:d,_message:o,token:"".concat(h.token,"_").concat(v)};B("SHOW_P2P_LOG")&&T.debug("send message",y,"noNeedResponse : ".concat(a)),h.splitMessage(JSON.stringify(y)).forEach(C=>{h.signal.request(Pe.DATA_STREAM,{payload:vl(h.encoder.encode(C))})});const b=new le((C,P)=>{const R=window.setTimeout(()=>{h.off("res-@".concat(l,"_ack"),A),h.off("res-@".concat(l),M),h.off(mn.ABORT,O),T.debug("[external-signal] request timeout, type: ".concat(i,", requestId: ").concat(l)),P(new Y(0===h.userMap.size?k.INVALID_REMOTE_USER:k.TIMEOUT))},B("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),A=()=>{R&&window.clearTimeout(R),h.off(mn.ABORT,O),a&&C()},O=()=>{R&&window.clearTimeout(R),h.off("res-@".concat(l,"_ack"),A),h.off("res-@".concat(l),M),P(new Y(k.EXTERNAL_SIGNAL_ABORT,"type: ".concat(i,", requestId: ").concat(l)))};h.once(mn.ABORT,O),h.once("res-@".concat(l,"_ack"),A);const M=(j,W)=>{x=!0,R&&window.clearTimeout(R),h.off("res-@".concat(l,"_ack"),A),h.off(mn.ABORT,O),"success"===j?C(W):P(new Y(k.P2P_MESSAGE_FAILED,"request ".concat(i," failed, requestId: ").concat(l)))};let x=!1;a||(h.once("res-@".concat(l),M),wr(B("SIGNAL_REQUEST_TIMEOUT")).then(()=>{x||T.warning("external_signal request timeout, type: ".concat(i,", requestId: ").concat(l,", ").concat(y))}))});try{return yield b}catch(C){if(C.code===k.TIMEOUT)return yield h.send(i,o,a,l,d);throw C}})()}onMessage(i){var o;const{_uid:a}=i;let l,d=this.userMap.get(a);if(d)l=d.splitMessageMap;else{if(this.userMap.size>0||!("_type"in i)||i._type!==Bn.CHECK)return;const{token:g}=i;l=new Map,d={uid:a,isStart:!0,token:g,splitMessageMap:l,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(a,d),this.signal.emit(qe.ON_USER_ONLINE,{uid:a}),this.handleUserOnline()}if("id"in i&&"total"in i){var h;const{id:g,total:v}=i,y=null!==(h=l.get(g))&&void 0!==h?h:[];if(y.push(i),l.has(g)||l.set(g,y),y.length!==v)return;{const b=md(y).call(y,(C,P)=>C.index-P.index).map(C=>C.payload).join("");l.delete(g),(i=JSON.parse(b))._uid=a}}const{_type:f,token:m}=i;if(he(o=[Bn.ACK,Bn.CHECK]).call(o,f))return f===Bn.CHECK&&this.handleCheckToken(d,m),void this.receiveMessage(i);m==="".concat(d.token,"_").concat(this.token)?this.handleReceivedMessage(i):T.debug('Receive unexpected message", '.concat(m,", cur_token: ").concat(d.token,"_").concat(this.token),i)}check(){const i={_id:Ct(6,""),token:this.token,_type:Bn.CHECK};B("SHOW_P2P_LOG")&&T.debug("send message",i),this.signal.request(Pe.DATA_STREAM,{payload:vl(this.encoder.encode(JSON.stringify(i)))})}ack(i){const o={_id:i,_type:Bn.ACK,token:this.token};B("SHOW_P2P_LOG")&&T.debug("send message",o),this.signal.request(Pe.DATA_STREAM,{payload:vl(this.encoder.encode(JSON.stringify(o)))})}response(i,o,a){this.send(Bn.RESPONSE,JSON.stringify({success:!a,message:o}),!0,i)}handleReceivedMessage(i){const o=()=>{this.userMap.forEach(g=>{const{receivedMessagesMap:v,nextExpectedSequenceNumber:y}=g;for(;v.has(y);){const b=v.get(y);v.delete(y),this.receiveMessage(b),g.nextExpectedSequenceNumber++}})};if(!i)return void o();const{_uid:a,_seq:l}=i,d=this.userMap.get(a),{receivedMessagesMap:h,isStart:f,nextExpectedSequenceNumber:m}=d;if(l<m)return this.ack(i._id),void T.debug("[external-signal] receive old message, seq: ".concat(l,", ").concat(i._message));h.set(l,i),f&&l===m&&(this.receiveMessage(i),h.delete(m),d.nextExpectedSequenceNumber++,o())}receiveMessage(i){const{_id:o,_type:a,_message:l,_uid:d}=i;if(B("SHOW_P2P_LOG")&&T.debug("receive message",i),o){let h;switch(i._type!==Bn.ACK&&(l&&(h=JSON.parse(l)),this.ack(i._id)),i._type){case Bn.CANDIDATE:case Bn.CONTROL:this.signal.emit(a,h,d);break;case Bn.PUBLISH:case Bn.UNPUBLISH:case Bn.RESTART_ICE:case Bn.CALL:h.uid=d,Gr(this.signal,a,h).then(f=>{this.response(i._id,f)}).catch(()=>{this.response(i._id,void 0,!0)});break;case Bn.ACK:this.getListeners("res-@".concat(o,"_ack")).length>0&&this.emit("res-@".concat(o,"_ack"));break;case Bn.RESPONSE:{const{success:f,message:m}=h;this.emit("res-@".concat(o),f?"success":"failed",m);break}}}}splitMessage(i){if(i.length<zf.MAX_MESSAGE_SIZE)return[i];const o=[],{remoteToken:a}=JSON.parse(i),l=Ct(6,"");let d=0,h=800;const f=Math.ceil(i.length/h);for(;i.length>0;){d++;const m={id:l,index:d,total:f,payload:i.slice(0,h),token:"".concat(this.token,"_").concat(a)};JSON.stringify(m).length>zf.MAX_MESSAGE_SIZE?h-=50:(o.push(m),i=i.slice(h))}return o.map(m=>JSON.stringify(m))}handleCheckToken(i,o){return i.token!==o?(T.debug("token changed, from ".concat(i.token," to ").concat(o)),this.reset(i.uid,o),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{T.debug("token timeout, ".concat(o)),this.reset(i.uid)},B("MAX_P2P_TIMEOUT")),!0)}handleUserOnline(){var i=this;return L(function*(){const o=yield Gr(i.signal,Bn.CALL,void 0),a=yield i.send(Bn.CALL,o);i.signal.emit(Me.P2P_CONNECTION,a,!0)})()}reset(i,o){var a=this;return L(function*(){const l=a.userMap.get(i);l&&(a.emit(mn.ABORT),a.signal.emit(qe.ON_USER_OFFLINE,{uid:l.uid,reason:ho.P2P_TOKEN_CHANGED}),a._sequence=0,a.userMap.clear(),o||(T.debug("change local token from ".concat(o," to ").concat(o)),a.token=Ct(6,"")))})()}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(mn.ABORT)}}N(zf,"MAX_SIZE",1),N(zf,"MAX_MESSAGE_SIZE",1024);class hv extends nn{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===qt.CONNECTED?this.emit(Me.WS_CONNECTED):i===qt.RECONNECTING?this.emit(Me.WS_RECONNECTING,this._websocketReconnectReason):i===qt.CLOSED&&this.emit(Me.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(i,o){super(),N(this,"_disconnectedReason",void 0),N(this,"_websocketReconnectReason",void 0),N(this,"_connectionState",qt.CLOSED),N(this,"reconnectToken",void 0),N(this,"p2pToken",void 0),N(this,"websocket",void 0),N(this,"openConnectionTime",void 0),N(this,"clientId",void 0),N(this,"lastMsgTime",Date.now()),N(this,"uploadCache",[]),N(this,"uploadCacheInterval",void 0),N(this,"rttRolling",new N_(5)),N(this,"pingpongTimer",void 0),N(this,"pingpongTimeoutCount",0),N(this,"joinResponse",void 0),N(this,"multiIpOption",void 0),N(this,"initError",void 0),N(this,"spec",void 0),N(this,"store",void 0),N(this,"_external_signal",void 0),N(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(Me.ON_BINARY_DATA,a.data);const l=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(l,"_id")){const d="res-@".concat(l._id);this.emit(d,l._result,l._message)}else if(Object.prototype.hasOwnProperty.call(l,"_type")){switch(l._type){case qe.ON_DATA_STREAM:return void this.handleDataStream(l._message);case qe.MUTE_AUDIO:case qe.MUTE_VIDEO:case qe.ON_P2P_LOST:case qe.ON_USER_ONLINE:return;case qe.ON_USER_OFFLINE:const{uid:d}=l._message;return T.debug("[".concat(this.clientId,"] user-offline uid: ").concat(d)),void this._external_signal.reset(d)}if(this.emit(l._type,l._message),l._type===qe.ON_NOTIFICATION&&this.handleNotification(l._message),l._type===qe.ON_USER_BANNED)switch(l._message.error_code){case 14:this.close(Rt.UID_BANNED);break;case 15:this.close(Rt.IP_BANNED);break;case 16:this.close(Rt.CHANNEL_BANNED)}if(l._type===qe.ON_USER_LICENSE_BANNED)switch(l._message.error_code){case Ie.ERR_LICENSE_MISSING:this.close(Rt.LICENSE_MISSING);break;case Ie.ERR_LICENSE_EXPIRED:this.close(Rt.LICENSE_EXPIRED);break;case Ie.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Rt.LICENSE_MINUTES_EXCEEDED);break;case Ie.ERR_LICENSE_PERIOD_INVALID:this.close(Rt.LICENSE_PERIOD_INVALID);break;case Ie.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Rt.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ie.ERR_LICENSE_ILLEGAL:this.close(Rt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=i.clientId,this.spec=i,this.store=o,this.websocket=new qR("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),o),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===qt.CONNECTED&&this.reconnect("retry",Hr.OFFLINE)}),this.p2pToken=Ct(6,""),this._external_signal=new zf(this,this.p2pToken)}request(i,o,a,l){var d=this;return L(function*(){const h=Ct(6,""),f={_id:h,_type:i,_message:o},m=d.websocket.connectionID,g=()=>new le((R,A)=>{if(d.connectionState===qt.CONNECTED)return R();const O=()=>{d.off(Me.WS_CLOSED,M),R()},M=()=>{d.off(Me.WS_CONNECTED,O),A(new Y(k.WS_ABORT))};d.once(Me.WS_CONNECTED,O),d.once(Me.WS_CLOSED,M)});if(d.connectionState!==qt.CONNECTING&&d.connectionState!==qt.RECONNECTING||i===Pe.JOIN||i===Pe.REJOIN||(yield g()),d.websocket.sendMessage(f,!0),l)return;const v=new le((R,A)=>{let O=!1;const M=(j,W)=>{O=!0,R({isSuccess:"success"===j,message:W||{}}),d.off(Me.WS_CLOSED,x),d.off(Me.WS_RECONNECTING,x),d.emit(Me.REQUEST_SUCCESS,i,o)};d.once("res-@".concat(h),M);const x=()=>{A(new Y(k.WS_ABORT,"type: ".concat(i))),d.off(Me.WS_CLOSED,x),d.off(Me.WS_RECONNECTING,x),d.off("res-@".concat(h),M)};d.once(Me.WS_CLOSED,x),d.once(Me.WS_RECONNECTING,x),wr(B("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||O||(T.warning("[".concat(d.clientId,"] ws request timeout, type: ").concat(i)),d.emit(Me.REQUEST_TIMEOUT,i,o))})});let y=null;try{y=yield v}catch(R){if(d.connectionState===qt.CLOSED||i===Pe.LEAVE)throw new Y(k.WS_ABORT);return!d.spec.forceWaitGatewayResponse||a?R.throw():i===Pe.JOIN||i===Pe.REJOIN?null:(yield g(),yield d.request(i,o))}if(y.isSuccess)return y.message;const b=Number(y.message.error_code||y.message.code),C=Mf(b),P=new Y(k.UNEXPECTED_RESPONSE,"".concat(C.desc,": ").concat(y.message.error_str),{code:b,data:y.message,desc:C.desc});return"success"===C.action?y.message:(T.warning("[".concat(d.clientId,"] [").concat(d.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(b,", message: ").concat(C.desc,", action: ").concat(C.action)),b===Ie.ERR_TOO_MANY_BROADCASTERS?((i===Pe.JOIN||i===Pe.REJOIN)&&(d.initError=P,d.close()),P.throw()):"failed"===C.action?P.throw():"quit"===C.action?(d.initError=P,d.close(),P.throw()):(b===Ie.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=y.message.option,T.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",Hr.MULTI_IP)):d.reconnect(C.action,Hr.SERVER_ERROR),i===Pe.JOIN||i===Pe.REJOIN?null:yield d.request(i,o)))})()}waitMessage(i,o){return new le(a=>{const l=d=>{(!o||o(d))&&(this.off(i,l),a(d))};this.on(i,l)})}uploadWRTCStats(i){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const o={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:i};this.upload(F_.WRTC_STATS,o)}upload(i,o){const a={_type:i,_message:o};try{this.websocket.sendMessage(a)}catch{const d=B("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==qt.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},B("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,o){this.websocket.sendMessage({_type:i,_message:o})}sendExtensionMessage(i,o,a){var l=this;return L(function*(){return yield l._external_signal.send(i,o,a)})()}init(i){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new le((o,a)=>{this.once(Me.WS_CONNECTED,()=>o(this.joinResponse)),this.once(Me.WS_CLOSED,()=>a(this.initError||new Y(k.WS_ABORT))),this.connectionState=qt.CONNECTING,this.websocket.init(i).catch(a)})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=i||Rt.LEAVE,this.connectionState=qt.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Ct(6,""),this._external_signal.clear(),this._external_signal=new zf(this,this.p2pToken)}join(){var i=this;return L(function*(){if(!i.joinResponse){i.emit(Me.ABORT_P2P_EXECUTION);const o=yield Gr(i,Me.REQUEST_JOIN_INFO),a=yield i.request(Pe.JOIN,o);if(!a)return i.emit(Me.REPORT_JOIN_GATEWAY,k.TIMEOUT,i.url||""),!1;i.joinResponse=a,i.emit(Me.JOIN_RESPONSE,i.joinResponse),i.reconnectToken=i.joinResponse.rejoin_token}return i.connectionState=qt.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),!0})()}reconnect(i,o){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,o)}handleDataStream(i){try{var o;const a=_l(i.payload),l=(new TextDecoder).decode(a),d=JSON.parse(l);"total"in d&&"id"in d||he(o=Object.values(Bn)).call(o,d._type)?(d._uid=i.uid,this._external_signal.onMessage(d)):this.emit(qe.ON_DATA_STREAM,i)}catch{this.emit(qe.ON_DATA_STREAM,i)}}handleNotification(i){T.debug("[".concat(this.clientId,"] receive notification: "),i);const o=Mf(i.code);if("success"!==o.action){if("failed"!==o.action)return"quit"===o.action?("ERR_REPEAT_JOIN_CHANNEL"===o.desc&&this.close(Rt.UID_BANNED),void this.close()):void this.reconnect(o.action,Hr.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),o.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=B("PING_PONG_TIME_OUT"),o=Date.now();this.pingpongTimeoutCount>=i&&(T.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(o-this.lastMsgTime,"ms")),o-this.lastMsgTime>B("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Hr.TIMEOUT):this.request(Pe.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-o;this.rttRolling.add(a),B("REPORT_STATS")&&this.send(Pe.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWebsocketEvents(){this.websocket.on(Fe.RECONNECT_CREATE_CONNECTION,i=>{this.emit(Me.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(Fe.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Fe.CLOSED,()=>{this.connectionState=qt.CLOSED}),this.websocket.on(Fe.FAILED,()=>{this._disconnectedReason=Rt.NETWORK_ERROR,this.connectionState=qt.CLOSED}),this.websocket.on(Fe.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState=this.connectionState===qt.CONNECTED?qt.RECONNECTING:qt.CONNECTING}),this.websocket.on(Fe.WILL_RECONNECT,(i,o,a)=>{"retry"!==i?(T.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(i)),this.reconnectToken=void 0):T.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),a(i)}),this.websocket.on(Fe.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(i=>{if(this.emit(Me.REPORT_JOIN_GATEWAY,i,this.url||""),i instanceof Y&&i.code===k.UNEXPECTED_RESPONSE&&i.data.code===Ie.ERR_NO_AUTHORIZED)return T.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Hr.SERVER_ERROR);T.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Hr.SERVER_ERROR):(this.initError=i,this.close())})}),this.websocket.on(Fe.REQUEST_NEW_URLS,(i,o)=>{Gr(this,Me.REQUEST_RECOVER,this.multiIpOption).then(i).catch(o)}),this.websocket.on(Fe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(qe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var pv={exports:{}};!function(r){r.exports=(()=>{var o={8:(d,h,f)=>{f.r(h),f.d(h,{Parser:()=>Re,Printer:()=>aa,parse:()=>xe,print:()=>vt});const m="\n",g="".concat("\r").concat(m),v=" ";let y;function b(de){return de>="0"&&de<="9"}function C(de){return de>="!"&&de<="~"}function P(de){return C(de)||de>="\x80"&&de<="\xff"}function R(de){return"!"===de||de>="#"&&de<="'"||de>="*"&&de<="+"||de>="-"&&de<="."||de>="0"&&de<="9"||de>="A"&&de<="Z"||de>="^"&&de<="~"}function A(de){return de>="1"&&de<="9"}function O(de){return de>="A"&&de<="Z"||de>="a"&&de<="z"}function M(de){return"d"===de||"h"===de||"m"===de||"s"===de}function x(de){return de>"\x01"&&de<"\t"||de>"\v"&&de<"\f"||de>"\x0e"&&de<"\xff"}function j(de){return O(de)||b(de)||"+"===de||"/"===de}function W(de){return b(de)||O(de)||"+"===de||"/"===de||"-"===de||"_"===de}function q(de){return O(de)||b(de)||"+"===de||"/"===de}function te(de,I){var F=Object.keys(de);if(Object.getOwnPropertySymbols){var G=Object.getOwnPropertySymbols(de);I&&(G=G.filter(function(re){return Object.getOwnPropertyDescriptor(de,re).enumerable})),F.push.apply(F,G)}return F}function J(de){for(var I=1;I<arguments.length;I++){var F=null!=arguments[I]?arguments[I]:{};I%2?te(Object(F),!0).forEach(function(G){X(de,G,F[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(de,Object.getOwnPropertyDescriptors(F)):te(Object(F)).forEach(function(G){Object.defineProperty(de,G,Object.getOwnPropertyDescriptor(F,G))})}return de}function X(de,I,F){return I in de?Object.defineProperty(de,I,{value:F,enumerable:!0,configurable:!0,writable:!0}):de[I]=F,de}var de;(de=y||(y={})).VERSION="v",de.ORIGIN="o",de.SESSION_NAME="s",de.INFORMATION="i",de.URI="u",de.EMAIL="e",de.PHONE="p",de.CONNECTION="c",de.BANDWIDTH="b",de.TIME="t",de.REPEAT="r",de.ZONE_ADJUSTMENTS="z",de.KEY="k",de.ATTRIBUTE="a",de.MEDIA="m";class Ce{consumeText(I,F){let G=F;for(;G<I.length;){const re=I[G];if("\0"===re||"\r"===re||re===m)break;G+=1}if(G-F==0)throw new Error("Invalid text, at ".concat(I));return G}consumeUnicastAddress(I,F,G){return this.consumeTill(I,F,v)}consumeOneOrMore(I,F,G){let re=F;for(;G(I[re]);)re++;if(re-F==0)throw new Error("Invalid rule at ".concat(F,"."));return re}consumeSpace(I,F){if(I[F]===v)return F+1;throw new Error("Invalid space at ".concat(F,"."))}consumeIP4Address(I,F){let G=F;for(let re=0;re<4;re++)if(G=this.consumeDecimalUChar(I,G),3!==re){if("."!==I[G])throw new Error("Invalid IP4 address.");G++}return G}consumeDecimalUChar(I,F){let G=F;for(let Le=0;Le<3&&b(I[G]);Le++,G++);if(G-F==0)throw new Error("Invalid decimal uchar.");const re=parseInt(I.slice(F,G));if(re>=0&&re<=255)return G;throw new Error("Invalid decimal uchar")}consumeIP6Address(I,F){let G=this.consumeHexpart(I,F);return":"===I[G]&&(G+=1,G=this.consumeIP4Address(I,G)),G}consumeHexpart(I,F){let G=F;if(":"===I[G]&&":"===I[G+1]){G+=2;try{G=this.consumeHexseq(I,G)}catch{}return G}if(G=this.consumeHexseq(I,G),":"===I[G]&&":"===I[G+1]){G+=2;try{G=this.consumeHexseq(I,G)}catch{}return G}return G}consumeHexseq(I,F){let G=F;for(;G=this.consumeHex4(I,G),":"===I[G]&&":"!==I[G+1];)G+=1;return G}consumeHex4(I,F){let G=0;for(;G<4;G++)if(!((re=I[F+G])>="0"&&re<="9"||re>="a"&&re<="f"||re>="A"&&re<="F")){if(0===G)throw new Error("Invalid hex 4");break}var re;return F+G}consumeFQDN(I,F){let G=F;for(;b(I[G])||O(I[G])||"-"===I[G]||"."===I[G];)G+=1;if(G-F<4)throw new Error("Invalid FQDN");return G}consumeExtnAddr(I,F){return this.consumeOneOrMore(I,F,P)}consumeMulticastAddress(I,F,G){switch(G){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(I,F);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(I,F);default:try{return this.consumeFQDN(I,F)}catch{return this.consumeExtnAddr(I,F)}}}consumeIP6MulticastAddress(I,F){const G=this.consumeHexpart(I,F);return"/"===I[G]?this.consumeInteger(I,G+1):G}consumeIP4MulticastAddress(I,F){let G=F+3;const re=I.slice(F,G),Le=parseInt(re);if(Le<224||Le>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Ut=0;Ut<3;Ut++){if("."!==I[G])throw new Error("Invalid IP4 multicast address.");G+=1,G=this.consumeDecimalUChar(I,G)}return"/"===I[G]&&(G+=1),G=this.consumeTTL(I,G),"/"===I[G]&&(G=this.consumeInteger(I,G)),G}consumeInteger(I,F){if(!A(I[F]))throw new Error("Invalid integer.");for(F+=1;b(I[F]);)F+=1;return F}consumeTTL(I,F){if("0"===I[F])return F+1;if(!A(I[F]))throw new Error("Invalid TTL.");F+=1;for(let G=0;G<2&&b(I[F]);G++)F+=1;return F}consumeToken(I,F){return this.consumeOneOrMore(I,F,R)}consumeTime(I,F){let G=F;if("0"===I[G])return G+1;for(A(I[G])&&(G+=1);b(I[G]);)G++;if(G-F<10)throw new Error("Invalid time");return G}consumeAddress(I,F){return this.consumeTill(I,F,v)}consumeTypedTime(I,F){let G=F;return G=this.consumeOneOrMore(I,G,b),M(I[G])?G+1:G}consumeRepeatInterval(I,F){if(!A(I[F]))throw new Error("Invalid repeat interval");for(F+=1;b(I[F]);)F+=1;return M(I[F])&&(F+=1),F}consumePort(I,F){return this.consumeOneOrMore(I,F,b)}consume(I,F,G){for(let re=0;re<G.length;re++){if(F+re>=I.length)throw new Error("consume exceeding value length");if(I[F+re]!==G[re])throw new Error("consume ".concat(G," failed at ").concat(re))}return F+G.length}consumeTill(I,F,G){let re=F;for(;re<I.length&&("string"!=typeof G||I[re]!==G)&&("function"!=typeof G||!G(I[re]));)re++;return re}}class Re extends Ce{constructor(){super(),X(this,"records",[]),X(this,"currentLine",0)}parse(I){const F=this.probeEOL(I);this.records=I.split(F).filter(qn=>!!vi(qn).call(qn)).map(this.parseLine),this.currentLine=0;const G=this.parseVersion(),re=this.parseOrigin(),Le=this.parseSessionName(),Ut=this.parseInformation(),lr=this.parseUri(),Xi=this.parseEmail(),Wl=this.parsePhone(),sT=this.parseConnection(),cE=this.parseBandWidth(),Ls=this.parseTimeFields(),iu=this.parseKey(),_m=this.parseSessionAttribute(),In=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:G,origin:re,sessionName:Le,information:Ut,uri:lr,emails:Xi,phones:Wl,connection:sT,bandwidths:cE,timeFields:Ls,key:iu,attributes:_m,mediaDescriptions:In}}getCurrentRecord(){const I=this.records[this.currentLine];if(!I)throw new Error("Record doesn't exit.");return I}probeEOL(I){for(let F=0;F<I.length;F++)if(I[F]===m)return"\r"===I[F-1]?g:m;throw new Error("Invalid newline character.")}parseLine(I,F){if(I.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const G=I[0];if("="!==I[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:G,value:I.slice(2),line:F,cur:0}}parseSessionAttribute(){const I=new Nt;for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==y.ATTRIBUTE)break;const G={attField:this.extractOneOrMore(F,re=>R(re)&&":"!==re),_cur:0};":"===F.value[F.cur]&&(F.cur+=1,G.attValue=this.extractOneOrMore(F,x)),I.parse(G),this.currentLine++}return I.digest()}parseMediaAttributes(I){const F=new _n(I);for(;this.currentLine<this.records.length;){const G=this.getCurrentRecord();if(G.type!==y.ATTRIBUTE)break;const re={attField:this.extractOneOrMore(G,Le=>R(Le)&&":"!==Le),_cur:0};":"===G.value[G.cur]&&(G.cur+=1,re.attValue=this.extractOneOrMore(G,x)),F.parse(re),this.currentLine++}return F.digest()}parseKey(){const I=this.getCurrentRecord();if(I.type===y.KEY){if("prompt"===I.value||"clear:"===I.value||"base64:"===I.value||"uri:"===I.value)return I.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const I=this.getCurrentRecord();if(I.type===y.ZONE_ADJUSTMENTS){const F=[];for(;;)try{const G=this.extract(I,this.consumeTime);this.consumeSpaceForRecord(I);let re=!1;"-"===I.value[I.cur]&&(re=!0,I.cur+=1);const Le=this.extract(I,this.consumeTypedTime);F.push({time:G,typedTime:Le,back:re})}catch{break}if(0===F.length)throw new Error("Invalid zone adjustments");return this.currentLine++,F}return[]}parseRepeat(){const I=[];for(;;){const F=this.getCurrentRecord();if(F.type!==y.REPEAT)break;{const G=this.extract(F,this.consumeRepeatInterval),re=this.parseTypedTime(F);I.push({repeatInterval:G,typedTimes:re}),this.currentLine++}}return I}parseTypedTime(I){const F=[];for(;;)try{this.consumeSpaceForRecord(I),F.push(this.extract(I,this.consumeTypedTime))}catch{break}if(0===F.length)throw new Error("Invalid typed time.");return F}parseTime(){const I=this.getCurrentRecord(),F=this.extract(I,this.consumeTime);this.consumeSpaceForRecord(I);const G=this.extract(I,this.consumeTime);return this.currentLine++,{startTime:F,stopTime:G}}parseBandWidth(){const I=[];for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==y.BANDWIDTH)break;{const G=this.extractOneOrMore(F,R);if(":"!==F.value[F.cur])throw new Error("Invalid bandwidth field.");F.cur++;const re=this.extractOneOrMore(F,b);I.push({bwtype:G,bandwidth:re}),this.currentLine++}}return I}parseVersion(){const I=this.getCurrentRecord();if(I.type!==y.VERSION)throw new Error("first sdp record must be version");const F=I.value.slice(0,this.consumeOneOrMore(I.value,0,b));if(F.length!==I.value.length)throw new Error('invalid proto version, "v='.concat(I.value,'"'));return this.currentLine++,F}parseOrigin(){const I=this.getCurrentRecord();if(I.type!==y.ORIGIN)throw new Error("second line of sdp must be origin");const F=this.extractOneOrMore(I,P);this.consumeSpaceForRecord(I);const G=this.extractOneOrMore(I,b);this.consumeSpaceForRecord(I);const re=this.extractOneOrMore(I,b);this.consumeSpaceForRecord(I);const Le=this.extractOneOrMore(I,R);this.consumeSpaceForRecord(I);const Ut=this.extractOneOrMore(I,R);this.consumeSpaceForRecord(I);const lr=this.extract(I,this.consumeUnicastAddress);return this.currentLine++,{username:F,sessId:G,sessVersion:re,nettype:Le,addrtype:Ut,unicastAddress:lr}}parseSessionName(){const I=this.getCurrentRecord();if(I.type===y.SESSION_NAME){const F=this.extract(I,this.consumeText);return this.currentLine++,F}}parseInformation(){const I=this.getCurrentRecord();if(I.type!==y.INFORMATION)return;const F=this.extract(I,this.consumeText);return this.currentLine++,F}parseUri(){const I=this.getCurrentRecord();if(I.type===y.URI)return this.currentLine++,I.value}parseEmail(){const I=[];for(;;){const F=this.getCurrentRecord();if(F.type!==y.EMAIL)break;I.push(F.value),this.currentLine++}return I}parsePhone(){const I=[];for(;;){const F=this.getCurrentRecord();if(F.type!==y.PHONE)break;I.push(F.value),this.currentLine++}return I}parseConnection(){const I=this.getCurrentRecord();if(I.type===y.CONNECTION){const F=this.extractOneOrMore(I,R);this.consumeSpaceForRecord(I);const G=this.extractOneOrMore(I,R);this.consumeSpaceForRecord(I);const re=this.extract(I,this.consumeAddress);return this.currentLine++,{nettype:F,addrtype:G,address:re}}}parseMedia(){const I=this.getCurrentRecord(),F=this.extract(I,this.consumeToken);this.consumeSpaceForRecord(I);let G=this.extract(I,this.consumePort);"/"===I.value[I.cur]&&(I.cur+=1,G+=this.extract(I,this.consumeInteger)),this.consumeSpaceForRecord(I);const re=[];for(re.push(this.extract(I,this.consumeToken));"/"===I.value[I.cur];)I.cur+=1,re.push(this.extract(I,this.consumeToken));if(0===re.length)throw new Error("Invalid proto");const Le=this.parseFmt(I);return this.currentLine++,{mediaType:F,port:G,protos:re,fmts:Le}}parseTimeFields(){const I=[];for(;this.getCurrentRecord().type===y.TIME;){const F=this.parseTime(),G=this.parseRepeat(),re=this.parseZone();I.push({time:F,repeats:G,zones:re})}return I}parseMediaDescription(){const I=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.MEDIA;){const F=this.parseMedia(),G=this.parseInformation(),re=this.parseConnections(),Le=this.parseBandWidth(),Ut=this.parseKey(),lr=this.parseMediaAttributes(F);I.push({media:F,information:G,connections:re,bandwidths:Le,key:Ut,attributes:lr})}return I}parseConnections(){const I=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.CONNECTION;)I.push(this.parseConnection());return I}parseFmt(I){const F=[];for(;;)try{this.consumeSpaceForRecord(I),F.push(this.extract(I,this.consumeToken))}catch{break}if(0===F.length)throw new Error("Invalid fmts");return F}extract(I,F){for(var G=arguments.length,re=new Array(G>2?G-2:0),Le=2;Le<G;Le++)re[Le-2]=arguments[Le];const Ut=F.call(this,I.value,I.cur,...re),lr=I.value.slice(I.cur,Ut);return I.cur=Ut,lr}extractOneOrMore(I,F){const G=this.consumeOneOrMore(I.value,I.cur,F),re=I.value.slice(I.cur,G);return I.cur=G,re}consumeSpaceForRecord(I){if(I.value[I.cur]!==v)throw new Error("Invalid space at ".concat(I.cur,"."));I.cur+=1}}class ut extends Ce{constructor(){super(...arguments),X(this,"attributes",void 0),X(this,"digested",!1)}extractOneOrMore(I,F,G){const re=this.consumeOneOrMore(I.attValue,I._cur,F),Le=I.attValue.slice(I._cur,re),[Ut,lr]=G||[];if("number"==typeof Ut&&Le.length<Ut)throw new Error("error in length, should be more or equal than ".concat(Ut," characters."));if("number"==typeof lr&&Le.length>lr)throw new Error("error in length, should be less or equal than ".concat(lr," characters."));return I._cur=re,Le}consumeAttributeSpace(I){if(I.attValue[I._cur]!==v)throw new Error("Invalid space at ".concat(I._cur,"."));I._cur+=1}extract(I,F){if(!I.attValue)throw new Error("Nothing to extract from attValue.");for(var G=arguments.length,re=new Array(G>2?G-2:0),Le=2;Le<G;Le++)re[Le-2]=arguments[Le];const Ut=F.call(this,I.attValue,I._cur,...re),lr=I.attValue.slice(I._cur,Ut);return I._cur=Ut,lr}atEnd(I){if(!I.attValue)throw new Error;return I._cur>=I.attValue.length}peekChar(I){if(!I.attValue)throw new Error;return I.attValue[I._cur]}peek(I,F){if(!I.attValue)throw new Error;for(let G=0;G<F.length;G++)if(F[G]!==I.attValue[I._cur+G])return!1;return!0}parseIceUfrag(I){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(I,j,[4,256])}parseIcePwd(I){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(I,j,[22,256])}parseIceOptions(I){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const F=[];for(;!this.atEnd(I);){F.push(this.extractOneOrMore(I,j));try{this.consumeAttributeSpace(I)}catch(G){if(this.atEnd(I))break;throw G}}this.attributes.iceOptions=F}parseFingerprint(I){const F=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);const G=this.extract(I,this.consumeTill);this.attributes.fingerprints.push({hashFunction:F,fingerprint:G})}parseExtmap(I){const F=this.extractOneOrMore(I,b);let G;"/"===this.peekChar(I)&&(this.extract(I,this.consume,"/"),G=this.extract(I,this.consumeToken)),this.consumeAttributeSpace(I);const re=this.extract(I,this.consumeTill,v),Le=J(J({entry:parseInt(F,10)},G&&{direction:G}),{},{extensionName:re});this.peekChar(I)===v&&(this.consumeAttributeSpace(I),Le.extensionAttributes=this.extract(I,this.consumeTill)),this.attributes.extmaps.push(Le)}parseSetup(I){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const F=this.extract(I,this.consumeTill);if("active"!==F&&"passive"!==F&&"actpass"!==F&&"holdconn"!==F)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=F}}class Nt extends ut{constructor(){super(...arguments),X(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(I){if(this.digested)throw new Error("already digested");try{switch(I.attField){case"group":this.parseGroup(I);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(I);break;case"ice-pwd":this.parseIcePwd(I);break;case"ice-options":this.parseIceOptions(I);break;case"fingerprint":this.parseFingerprint(I);break;case"setup":this.parseSetup(I);break;case"tls-id":this.parseTlsId(I);break;case"identity":this.parseIdentity(I);break;case"extmap":this.parseExtmap(I);break;case"msid-semantic":this.parseMsidSemantic(I);break;default:I.ignored=!0,this.attributes.unrecognized.push(I)}}catch(F){throw console.error("parsing session attribute ".concat(I.attField,' error, "a=').concat(I.attField,":").concat(I.attValue,'"')),F}if(!I.ignored&&I.attValue&&!this.atEnd(I))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(I){const F=this.extract(I,this.consumeToken),G=[];for(;!this.atEnd(I)&&this.peekChar(I)===v;)this.consumeAttributeSpace(I),G.push(this.extract(I,this.consumeToken));this.attributes.groups.push({semantic:F,identificationTag:G})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(I){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(I,W)}parseIdentity(I){const F=this.extractOneOrMore(I,q),G=[];for(;!this.atEnd(I)&&this.peekChar(I)===v;){this.consumeAttributeSpace(I);const re=this.extract(I,this.consumeToken);this.extract(I,this.consume,"=");const Le=this.extractOneOrMore(I,Ut=>Ut!==v&&x(Ut));G.push({name:re,value:Le})}this.attributes.identities.push({assertionValue:F,extensions:G})}parseMsidSemantic(I){this.peekChar(I)===v&&this.consumeAttributeSpace(I);const F={semantic:this.extract(I,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(I)}catch{break}if("*"===this.peekChar(I)){this.extract(I,this.consume,"*"),F.applyForAll=!0;break}{const G=this.extract(I,this.consumeTill,v);F.identifierList.push(G)}}this.attributes.msidSemantic=F}}class _n extends ut{constructor(I){super(),X(this,"attributes",void 0),-1!==I.protos.indexOf("RTP")||I.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(I){if(this.digested)throw new Error("already digested");try{switch(I.attField){case"extmap":this.parseExtmap(I);break;case"setup":this.parseSetup(I);break;case"ice-ufrag":this.parseIceUfrag(I);break;case"ice-pwd":this.parseIcePwd(I);break;case"ice-options":this.parseIceOptions(I);break;case"candidate":this.parseCandidate(I);break;case"remote-candidate":this.parseRemoteCandidate(I);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(I);break;case"rtpmap":this.parseRtpmap(I);break;case"ptime":this.parsePtime(I);break;case"maxptime":this.parseMaxPtime(I);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(I);break;case"ssrc":this.parseSSRC(I);break;case"fmtp":this.parseFmtp(I);break;case"rtcp-fb":this.parseRtcpFb(I);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(I);break;case"mid":this.parseMid(I);break;case"msid":this.parseMsid(I);break;case"imageattr":this.parseImageAttr(I);break;case"rid":this.parseRid(I);break;case"simulcast":this.parseSimulcast(I);break;case"sctp-port":this.parseSctpPort(I);break;case"max-message-size":this.parseMaxMessageSize(I);break;case"ssrc-group":this.parseSSRCGroup(I);break;default:I.ignored=!0,this.attributes.unrecognized.push(I)}}catch(F){throw console.error("parsing media attribute ".concat(I.attField,' error, "a=').concat(I.attField,":").concat(I.attValue,'"')),F}if(!I.ignored&&I.attValue&&!this.atEnd(I))throw new Error("attribute parsing error")}parseCandidate(I){const F=this.extractOneOrMore(I,j,[1,32]);this.consumeAttributeSpace(I);const G=this.extractOneOrMore(I,b,[1,5]);this.consumeAttributeSpace(I);const re=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);const Le=this.extractOneOrMore(I,b,[1,10]);this.consumeAttributeSpace(I);const Ut=this.extract(I,this.consumeAddress);this.consumeAttributeSpace(I);const lr=this.extract(I,this.consumePort);this.consumeAttributeSpace(I),this.extract(I,this.consume,"typ"),this.consumeAttributeSpace(I);const Xi={foundation:F,componentId:G,transport:re,priority:Le,connectionAddress:Ut,port:lr,type:this.extract(I,this.consumeToken),extension:{}};for(this.peek(I," raddr")&&(this.extract(I,this.consume," raddr"),this.consumeAttributeSpace(I),Xi.relAddr=this.extract(I,this.consumeAddress)),this.peek(I," rport")&&(this.extract(I,this.consume," rport"),this.consumeAttributeSpace(I),Xi.relPort=this.extract(I,this.consumePort));this.peekChar(I)===v;){this.consumeAttributeSpace(I);const Wl=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I),Xi.extension[Wl]=this.extractOneOrMore(I,C)}this.attributes.candidates.push(Xi)}parseRemoteCandidate(I){const F=[];for(;;){const G=this.extractOneOrMore(I,b,[1,5]);this.consumeAttributeSpace(I);const re=this.extract(I,this.consumeAddress);this.consumeAttributeSpace(I);const Le=this.extract(I,this.consumePort);F.push({componentId:G,connectionAddress:re,port:Le});try{this.consumeAttributeSpace(I)}catch{break}}this.attributes.remoteCandidatesList.push(F)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(I){const F=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);const G=this.extract(I,this.consumeTill,"/");this.extract(I,this.consume,"/");const re={encodingName:G,clockRate:this.extractOneOrMore(I,b)};this.atEnd(I)||"/"!==this.peekChar(I)||(this.extract(I,this.consume,"/"),re.encodingParameters=parseInt(this.extract(I,this.consumeTill),10));const Le=this.attributes.payloads.find(Ut=>Ut.payloadType===parseInt(F,10));Le?Le.rtpMap=re:this.attributes.payloads.push({payloadType:parseInt(F,10),rtpMap:re,rtcpFeedbacks:[]})}parsePtime(I){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(I,this.consumeTill)}parseMaxPtime(I){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(I,this.consumeTill)}parseDirection(I){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=I.attField}parseSSRC(I){const F=this.extractOneOrMore(I,b);this.consumeAttributeSpace(I);const G=this.extract(I,this.consumeTill,":");let re;":"===this.peekChar(I)&&(this.extract(I,this.consume,":"),re=this.extract(I,this.consumeTill));const Le=this.attributes.ssrcs.find(Ut=>Ut.ssrcId===parseInt(F,10));Le?Le.attributes[G]=re:this.attributes.ssrcs.push({ssrcId:parseInt(F,10),attributes:{[G]:re}})}parseFmtp(I){const F=this.extract(I,this.consumeTill,v);this.consumeAttributeSpace(I);const G=this.extract(I,this.consumeTill),re={};G.split(";").forEach(Ut=>{let[lr,Xi]=Ut.split("=");lr=vi(lr).call(lr);const Wl="string"==typeof Xi?vi(Xi).call(Xi):null;"string"==typeof lr&&lr.length>0&&(re[lr]=Wl)});const Le=this.attributes.payloads.find(Ut=>Ut.payloadType===parseInt(F,10));Le?Le.fmtp={parameters:re}:this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[],fmtp:{parameters:re}})}parseFmtParameters(I){const F={},G=this.extract(I,this.consumeTill,"=");I._cur++;const re=this.extract(I,this.consumeTill,";");for(F[G]=re;";"===I.attValue[I._cur];){const Le=this.extract(I,this.consumeTill,"=");I._cur++;const Ut=this.extract(I,this.consumeTill,";");F[Le]=Ut}return F}parseRtcpFb(I){let F="";F="*"===this.peekChar(I)?this.extract(I,this.consume,"*"):this.extract(I,this.consumeTill,v),this.consumeAttributeSpace(I);const G=this.extract(I,this.consumeTill,v);let re;if("trr-int"===G)re={type:G,interval:this.extract(I,this.consumeTill)};else{const Le={type:G};this.peekChar(I)===v&&(this.consumeAttributeSpace(I),Le.parameter=this.extract(I,this.consumeToken),this.peekChar(I)===v&&(Le.additional=this.extract(I,this.consumeTill))),re=Le}if("*"===F)this.attributes.rtcpFeedbackWildcards.push(re);else{const Le=this.attributes.payloads.find(Ut=>Ut.payloadType===parseInt(F,10));Le?Le.rtcpFeedbacks.push(re):this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[re]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(I){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const F={port:this.extract(I,this.consumePort)};this.peekChar(I)===v&&(this.consumeAttributeSpace(I),F.netType=this.extractOneOrMore(I,R),this.consumeAttributeSpace(I),F.addressType=this.extractOneOrMore(I,R),this.consumeAttributeSpace(I),F.address=this.extract(I,this.consumeAddress)),this.attributes.rtcp=F}parseMsid(I){const F={id:this.extractOneOrMore(I,R,[1,64])};this.peekChar(I)===v&&(this.consumeAttributeSpace(I),F.appdata=this.extractOneOrMore(I,R,[1,64])),this.attributes.msids.push(F)}parseImageAttr(I){this.attributes.imageattr.push(I.attValue)}parseRid(I){const F=this.extractOneOrMore(I,re=>O(re)||b(re)||"_"===re||"-"===re);this.consumeAttributeSpace(I);const G={id:F,direction:this.extract(I,this.consumeToken),params:[]};if(this.peekChar(I)===v){if(this.consumeAttributeSpace(I),this.peek(I,"pt=")){this.extract(I,this.consume,"pt=");const re=[];for(;;){const Le=this.extract(I,this.consumeToken);re.push(Le);try{this.extract(I,this.consume,",")}catch{break}}G.payloads=re,this.peekChar(I)===v&&this.extract(I,this.consume,v)}for(;;){const re=this.extract(I,this.consumeToken);switch(re){case"depend":{const Le={type:re,rids:this.extract(I,this.consume,"=").split(",")};G.params.push(Le);break}default:{const Le={type:re};"="===this.peekChar(I)&&(this.extract(I,this.consume,"="),Le.val=this.extract(I,this.consumeTill,";")),G.params.push(Le)}}try{this.extract(I,this.consume,";")}catch{break}}}this.attributes.rids.push(G)}parseSimulcast(I){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=I.attValue,this.extract(I,this.consumeTill)}parseSctpPort(I){this.attributes.sctpPort=this.extractOneOrMore(I,b,[1,5])}parseMaxMessageSize(I){this.attributes.maxMessageSize=this.extractOneOrMore(I,b,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(I){this.attributes.mid=this.extract(I,this.consumeToken)}parseSSRCGroup(I){const F=this.extract(I,this.consumeToken),G=[];for(;;)try{this.consumeAttributeSpace(I);const re=this.extract(I,this.consumeInteger);G.push(parseInt(re,10))}catch{break}this.attributes.ssrcGroups.push({semantic:F,ssrcIds:G})}}function Zt(de,I,F){return I in de?Object.defineProperty(de,I,{value:F,enumerable:!0,configurable:!0,writable:!0}):de[I]=F,de}class aa{constructor(){Zt(this,"eol",g)}print(I,F){let G="";return F&&(this.eol=F),G+=this.printVersion(I.version),G+=this.printOrigin(I.origin),G+=this.printSessionName(I.sessionName),G+=this.printInformation(I.information),G+=this.printUri(I.uri),G+=this.printEmail(I.emails),G+=this.printPhone(I.phones),G+=this.printConnection(I.connection),G+=this.printBandwidth(I.bandwidths),G+=this.printTimeFields(I.timeFields),G+=this.printKey(I.key),G+=this.printSessionAttributes(I.attributes),G+=this.printMediaDescription(I.mediaDescriptions),G}printVersion(I){return"v=".concat(I).concat(this.eol)}printOrigin(I){return"o=".concat(I.username," ").concat(I.sessId," ").concat(I.sessVersion," ").concat(I.nettype," ").concat(I.addrtype," ").concat(I.unicastAddress).concat(this.eol)}printSessionName(I){return I?"s=".concat(I).concat(this.eol):""}printInformation(I){return I?"i=".concat(I).concat(this.eol):""}printUri(I){return I?"u=".concat(I).concat(this.eol):""}printEmail(I){let F="";for(const G of I)F+="e=".concat(G).concat(this.eol);return F}printPhone(I){let F="";for(const G of I)F+="e=".concat(G).concat(this.eol);return F}printConnection(I){return I?"c=".concat(I.nettype," ").concat(I.addrtype," ").concat(I.address).concat(this.eol):""}printBandwidth(I){let F="";for(const G of I)F+="b=".concat(G.bwtype,":").concat(G.bandwidth).concat(this.eol);return F}printTimeFields(I){let F="";for(const G of I){F+="t=".concat(G.time.startTime," ").concat(G.time.startTime).concat(this.eol);for(const re of G.repeats)F+="r=".concat(re.repeatInterval," ").concat(re.typedTimes.join(" ")).concat(this.eol);G.zoneAdjustments&&(F+="z=",F+="z=".concat(G.zoneAdjustments.map(re=>"".concat(re.time," ").concat(re.back?"-":""," ").concat(re.typedTime)).join(" ")).concat(this.eol),F+=this.eol)}return F}printKey(I){return I?"k=".concat(I).concat(this.eol):""}printAttributes(I){let F="";for(const G of I)F+="a=".concat(G.attField).concat(G.attValue?":".concat(G.attValue):"").concat(this.eol);return F}printMediaDescription(I){let F="";for(const G of I)F+=this.printMedia(G.media),F+=this.printInformation(G.information),F+=this.printConnections(G.connections),F+=this.printBandwidth(G.bandwidths),F+=this.printKey(G.key),F+=this.printMediaAttributes(G);return F}printConnections(I){let F="";for(const G of I)F+=this.printConnection(G);return F}printMedia(I){return"m=".concat(I.mediaType," ").concat(I.port," ").concat(I.protos.join("/")," ").concat(I.fmts.join(" ")).concat(this.eol)}printSessionAttributes(I){return new se(this.eol).print(I)}printMediaAttributes(I){return new ve(this.eol).print(I)}}class Z{constructor(I){Zt(this,"eol",void 0),this.eol=I}printIceUfrag(I){return void 0===I?"":"a=ice-ufrag:".concat(I).concat(this.eol)}printIcePwd(I){return void 0===I?"":"a=ice-pwd:".concat(I).concat(this.eol)}printIceOptions(I){return void 0===I?"":"a=ice-options:".concat(I.join(v)).concat(this.eol)}printFingerprints(I){return I.length>0?I.map(F=>"a=fingerprint:".concat(F.hashFunction).concat(v).concat(F.fingerprint)).join(this.eol)+this.eol:""}printExtmap(I){return I.map(F=>"a=extmap:".concat(F.entry).concat(F.direction?"/".concat(F.direction):"").concat(v).concat(F.extensionName).concat(F.extensionAttributes?"".concat(v).concat(F.extensionAttributes):"").concat(this.eol)).join("")}printSetup(I){return void 0===I?"":"a=setup:".concat(I).concat(this.eol)}printUnrecognized(I){return I.map(F=>"a=".concat(F.attField).concat(F.attValue?":".concat(F.attValue):"").concat(this.eol)).join("")}}class se extends Z{print(I){let F="";return F+=this.printGroups(I.groups),F+=this.printMsidSemantic(I.msidSemantic),F+=this.printIceLite(I.iceLite),F+=this.printIceUfrag(I.iceUfrag),F+=this.printIcePwd(I.icePwd),F+=this.printIceOptions(I.iceOptions),F+=this.printFingerprints(I.fingerprints),F+=this.printSetup(I.setup),F+=this.printTlsId(I.tlsId),F+=this.printIdentity(I.identities),F+=this.printExtmap(I.extmaps),F+=this.printUnrecognized(I.unrecognized),F}printGroups(I){let F="";return I.length>0&&(F+=I.map(G=>"a=group:".concat(G.semantic).concat(G.identificationTag.map(re=>"".concat(v).concat(re)).join("")).concat(this.eol)).join("")),F}printIceLite(I){return void 0===I?"":"a=ice-lite"+this.eol}printTlsId(I){return I?"a=tls-id:".concat(I).concat(this.eol):""}printIdentity(I){return 0===I.length?"":I.map(F=>"a=identity:".concat(F.assertionValue).concat(F.extensions.map(G=>"".concat(v).concat(G.name).concat(G.value?"=".concat(G.value):"")))).join(this.eol)+this.eol}printMsidSemantic(I){if(!I)return"";let F="a=msid-semantic:".concat(I.semantic);return I.applyForAll?F+="".concat(v,"*"):I.identifierList.length>0&&(F+=I.identifierList.map(G=>"".concat(v).concat(G))),F+this.eol}}class ve extends Z{print(I){const F=I.attributes;let G="";return G+=this.printRTCP(F.rtcp),G+=this.printIceUfrag(F.iceUfrag),G+=this.printIcePwd(F.icePwd),G+=this.printIceOptions(F.iceOptions),G+=this.printCandidates(F.candidates),G+=this.printRemoteCandidatesList(F.remoteCandidatesList),G+=this.printEndOfCandidates(F.endOfCandidates),G+=this.printFingerprints(F.fingerprints),G+=this.printSetup(F.setup),G+=this.printMid(F.mid),G+=this.printExtmap(F.extmaps),G+=this.printRTPRelated(F),G+=this.printPtime(F.ptime),G+=this.printMaxPtime(F.maxPtime),G+=this.printDirection(F.direction),G+=this.printSSRCGroups(F.ssrcGroups),G+=this.printSSRC(F.ssrcs),G+=this.printRTCPMux(F.rtcpMux),G+=this.printRTCPMuxOnly(F.rtcpMuxOnly),G+=this.printRTCPRsize(F.rtcpRsize),G+=this.printMSId(F.msids),G+=this.printImageattr(F.imageattr),G+=this.printRid(F.rids),G+=this.printSimulcast(F.simulcast),G+=this.printSCTPPort(F.sctpPort),G+=this.printMaxMessageSize(F.maxMessageSize),G+=this.printUnrecognized(F.unrecognized),G}printCandidates(I){return I.map(F=>"a=candidate:".concat(F.foundation).concat(v).concat(F.componentId).concat(v).concat(F.transport).concat(v).concat(F.priority).concat(v).concat(F.connectionAddress).concat(v).concat(F.port).concat(v,"typ").concat(v).concat(F.type).concat(F.relAddr?"".concat(v,"raddr").concat(v).concat(F.relAddr):"").concat(F.relPort?"".concat(v,"rport").concat(v).concat(F.relPort):"").concat(Object.keys(F.extension).map(G=>"".concat(v).concat(G).concat(v).concat(F.extension[G])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(I){return I.map(F=>"a=remote-candidates:".concat(F.join(v)).concat(this.eol)).join("")}printEndOfCandidates(I){return void 0===I?"":"a=end-of-candidates"+this.eol}printRTPRelated(I){if(!I.payloads)return"";const F=I.payloads;let G="";G+=I.rtcpFeedbackWildcards.map(re=>this.printRTCPFeedback("*",re)).join("");for(const re of F)G+=this.printRtpMap(re.payloadType,re.rtpMap),G+=this.printFmtp(re.payloadType,re.fmtp),G+=re.rtcpFeedbacks.map(Le=>this.printRTCPFeedback(re.payloadType,Le)).join("");return G}printFmtp(I,F){if(!F)return"";const G=Object.keys(F.parameters);return 1===G.length&&null===F.parameters[G[0]]?"a=fmtp:".concat(I).concat(v).concat(G[0]).concat(this.eol):"a=fmtp:".concat(I).concat(v).concat(Object.keys(F.parameters).map(re=>"".concat(re,"=").concat(F.parameters[re])).join(";")).concat(this.eol)}printRtpMap(I,F){return F?"a=rtpmap:".concat(I).concat(v).concat(F.encodingName,"/").concat(F.clockRate).concat(F.encodingParameters?"/".concat(F.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(I,F){let G="a=rtcp-fb:".concat(I).concat(v),re=F;return"trr-int"===re.type?G+="ttr-int".concat(v).concat(re.interval):(G+="".concat(re.type),re.parameter&&(G+="".concat(v).concat(re.parameter),re.additional&&(G+="".concat(v).concat(re.additional)))),G+this.eol}printPtime(I){return void 0===I?"":"a=ptime:".concat(I).concat(this.eol)}printMaxPtime(I){return void 0===I?"":"a=maxptime:".concat(I).concat(this.eol)}printDirection(I){return void 0===I?"":"a=".concat(I).concat(this.eol)}printSSRC(I){return I.map(F=>Object.keys(F.attributes).map(G=>"a=ssrc:".concat(F.ssrcId.toString(10)).concat(v).concat(G).concat(F.attributes[G]?":".concat(F.attributes[G]):"").concat(this.eol)).join("")).join("")}printRTCPMux(I){return void 0===I?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(I){return void 0===I?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(I){return void 0===I?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(I){if(void 0===I)return"";let F="a=rtcp:".concat(I.port);return I.netType&&(F+="".concat(v).concat(I.netType)),I.addressType&&(F+="".concat(v).concat(I.addressType)),I.address&&(F+="".concat(v).concat(I.address)),F+this.eol}printMSId(I){return I.map(F=>"a=msid:".concat(F.id).concat(F.appdata?"".concat(v).concat(F.appdata):"").concat(this.eol)).join("")}printImageattr(I){return I.map(F=>"a=imageattr:".concat(F).concat(this.eol)).join("")}printRid(I){return I.map(F=>{let G="a=rid:".concat(F.id).concat(v).concat(F.direction);return F.payloads&&(G+="".concat(v,"pt=").concat(F.payloads.join(","))),F.params.length>0&&(G+="".concat(v).concat(F.params.map(re=>"depend"===re.type?"depend=".concat(re.rids.join(",")):"".concat(re.type,"=").concat(re.val)).join(";"))),G+this.eol}).join("")}printSimulcast(I){return void 0===I?"":"a=simulcast:".concat(I).concat(this.eol)}printSCTPPort(I){return void 0===I?"":"a=sctp-port:".concat(I).concat(this.eol)}printMaxMessageSize(I){return void 0===I?"":"a=max-message-size:".concat(I).concat(this.eol)}printMid(I){return void 0===I?"":"a=mid:".concat(I).concat(this.eol)}printSSRCGroups(I){return I.map(F=>"a=ssrc-group:".concat(F.semantic).concat(F.ssrcIds.map(G=>"".concat(v).concat(G.toString(10))).join("")).concat(this.eol)).join("")}}function xe(de){return(new Re).parse(de)}function vt(de,I){return(new aa).print(de,I)}}},a={};function l(d){if(a[d])return a[d].exports;var h=a[d]={exports:{}};return o[d](h,h.exports,l),h.exports}return l.d=(d,h)=>{for(var f in h)l.o(h,f)&&!l.o(d,f)&&Object.defineProperty(d,f,{enumerable:!0,get:h[f]})},l.o=(d,h)=>Object.prototype.hasOwnProperty.call(d,h),l.r=d=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})},l(8)})()}(pv);var vr=pv.exports;function ls(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B("SVC_MODE");if(B("ENABLE_SVC"))return r in ci?r:ci.L1T3}const tC={[_e.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[_e.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function tD(r,i,o){i.forEach(a=>{var l;const d=tC[r].find(f=>{var m;let{key:g}=f;return he(m=a.extensionName).call(m,g)});if(!d)return;const h=o.find(f=>{let{extensionName:m}=f;return he(m).call(m,d.key)});h&&he(l=h.extensionName).call(l,"gdpr_forbidden")&&(a.extensionName=h.extensionName)})}function fv(r,i){i.forEach(o=>{var a;const l=tC[r].find(d=>{var h;let{key:f}=d;return he(h=o.extensionName).call(h,f)});he(a=o.extensionName).call(a,"gdpr_forbidden")&&l&&(o.extensionName=l.extensionName)})}function iH(r){return"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===r||he(r).call(r,"abs-send-time")}function nC(r){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===r||he(r).call(r,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function u2(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function nD(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?u2(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):u2(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}function mv(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;const{filterRTX:l,filterVideoFec:d,filterAudioFec:h,filterAudioCodec:f,filterVideoCodec:m}=i,{useXR:g}=o;let v=[],y=[],b=[],C=[],P=!1,R=!1;if(vr.parse(r).mediaDescriptions.forEach(O=>{a&&a!==O.attributes.direction||("video"!==O.media.mediaType||P||(y=O.attributes.payloads,C=O.attributes.extmaps,P=!0),"audio"!==O.media.mediaType||R||(v=O.attributes.payloads,b=O.attributes.extmaps,R=!0))}),!C||0===y.length)throw new Error("Cannot get video capabilities from SDP.");if(!b||0===v.length)throw new Error("Cannot get audio capabilities from SDP.");if(y.forEach(O=>{var M;null!==(M=O.rtpMap)&&void 0!==M&&M.clockRate&&(O.rtpMap.clockRate=parseInt(O.rtpMap.clockRate)),g&&O.rtcpFeedbacks.push({type:"rrtr"})}),v.forEach(O=>{var M;null!==(M=O.rtpMap)&&void 0!==M&&M.clockRate&&(O.rtpMap.clockRate=parseInt(O.rtpMap.clockRate)),g&&O.rtcpFeedbacks.push({type:"rrtr"})}),l&&(v=v.filter(O=>{var M;return"rtx"!==(null===(M=O.rtpMap)||void 0===M?void 0:M.encodingName.toLowerCase())}),y=y.filter(O=>{var M;return"rtx"!==(null===(M=O.rtpMap)||void 0===M?void 0:M.encodingName.toLowerCase())})),d&&(y=y.filter(O=>{var M;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(M=O.rtpMap)||void 0===M?void 0:M.encodingName)||"")})),h&&(v=v.filter(O=>{var M;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(M=O.rtpMap)||void 0===M?void 0:M.encodingName)||"")})),f&&f?.length>0&&(v=v.filter(O=>{var M;return he(f).call(f,(null===(M=O.rtpMap)||void 0===M?void 0:M.encodingName.toLowerCase())||"")})),m&&m?.length>0){const O=y.filter(M=>{var x;return he(m).call(m,(null===(x=M.rtpMap)||void 0===x?void 0:x.encodingName.toLowerCase())||"")});y=O.concat(l?[]:oD(O,y))}const A=B("UNSUPPORTED_VIDEO_CODEC");return A&&A.length>0&&(y=y.filter(O=>!(O.rtpMap&&he(A).call(A,O.rtpMap.encodingName.toLowerCase())))),{audioCodecs:v,videoCodecs:y,audioExtensions:b,videoExtensions:C}}function Gd(r){const i=vr.parse(r);let o,a;for(const l of i.mediaDescriptions){if(!o){const d=l.attributes.iceUfrag,h=l.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");o={iceUfrag:d,icePwd:h}}if(!a){const d=l.attributes.fingerprints;d.length>0&&(a={fingerprints:d})}}if(!a&&i.attributes.fingerprints.length>0&&(a={fingerprints:i.attributes.fingerprints}),!a||!o)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:o,dtlsParameters:a}}function oH(r,i){const o=[],a=r.attributes.ssrcGroups.filter(h=>"FID"===h.semantic),l=r.attributes.ssrcGroups.find(h=>"SIM"===h.semantic),d=r.attributes.ssrcs;if(l)l.ssrcIds.forEach(h=>{var f;const m=null===(f=a.find(g=>g.ssrcIds[0]===h))||void 0===f?void 0:f.ssrcIds[1];o.push({ssrcId:h,rtx:i?m:void 0})});else if(a.length>0)o.push({ssrcId:a[0].ssrcIds[0],rtx:i?a[0].ssrcIds[1]:void 0});else{if(0===d.length)throw new Error("No ssrcs found on local media description.");o.push({ssrcId:d[0].ssrcId})}return o}function As(r,i,o){const{cname:a}=r;let l=[];i&&(l=rC(i)),0===l.length&&(l=r.iceParameters.candidates.map(v=>({foundation:v.foundation,componentId:"1",transport:v.protocol,priority:v.priority.toString(),connectionAddress:v.ip,port:v.port.toString(),type:v.type,extension:{}})),T.debug("Using candidates from gateway."));const d={fingerprints:r.dtlsParameters.fingerprints.map(v=>({hashFunction:v.algorithm,fingerprint:v.fingerprint}))},h={iceUfrag:r.iceParameters.iceUfrag,icePwd:r.iceParameters.icePwd};let f;switch(r.dtlsParameters.role){case"server":f="passive";break;case"client":f="active";break;case"auto":f="actpass"}const m=ea(r.rtpCapabilities),g=[];return Array.isArray(o)&&o.length>0&&o.forEach(v=>{g.push({kind:_e.VIDEO,ssrcId:v.v,rtx:v.v_rtx,mslabel:"".concat(v.v,"_").concat(v.a)},{kind:_e.AUDIO,ssrcId:v.a,mslabel:"".concat(v.v,"_").concat(v.a)})}),{dtlsParameters:d,iceParameters:h,candidates:l,rtpCapabilities:m,setup:f,cname:a,preSSRCs:g}}function rC(r){let i=[];return r.ip&&"number"==typeof r.port&&(i=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:r.ip,port:r.port.toString(),type:"host",extension:{}}],T.debug("Using remote candidate from AP ".concat(r.ip,":").concat(r.port)),r.ip6&&(i.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:r.ip6,port:r.port.toString(),type:"host",extension:{}}),T.debug("Using IPV6 remote candidate from AP ".concat(r.ip6,":").concat(r.port)))),i}function Oh(r,i,o){const a=[],l=[];return r.forEach(d=>{let{ssrcId:h,rtx:f}=d;const m=Ct(8,"track-"),g={ssrcId:h,attributes:nD({label:m,mslabel:o=o||Ct(10,""),msid:"".concat(o," ").concat(m)},i&&{cname:i})};if(a.push(g),void 0!==f){const v={ssrcId:f,attributes:nD({label:m,mslabel:o,msid:"".concat(o," ").concat(m)},i&&{cname:i})};a.push(v),l.push({semantic:"FID",ssrcIds:[h,f]})}}),r.length>1&&l.push({semantic:"SIM",ssrcIds:r.map(d=>{let{ssrcId:h}=d;return h})}),{ssrcs:a,ssrcGroups:l}}function Kf(r,i){i instanceof Cn&&r.attributes.payloads.forEach(o=>{var a;const l=null===(a=o.rtpMap)||void 0===a?void 0:a.encodingName.toLowerCase();if(!l||-1===["opus","pcmu","pcma","g722"].indexOf(l))return;o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters.minptime="10",o.fmtp.parameters.useinbandfec="1";const d=i._encoderConfig;d&&"pcmu"!==l&&"pcma"!==l&&"g722"!==l&&(d.bitrate&&!hn()&&(o.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(o.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),o.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(o.fmtp.parameters.stereo="1",o.fmtp.parameters["sprop-stereo"]="1"))})}function rD(r){const i=r.attributes.unrecognized.findIndex(o=>"x-google-flag"===o.attField&&"conference"===o.attValue);-1!==i&&r.attributes.unrecognized.splice(i,1)}function iD(r,i){var o;if(!(i instanceof Ve&&i._encoderConfig&&-1===i._hints.indexOf(zt.SCREEN_TRACK)))return;const a=i._encoderConfig;ct().supportMinBitrate&&a.bitrateMin&&r.attributes.payloads.forEach(l=>{var d,h;he(d=["h264","h265","vp8","vp9","av1"]).call(d,(null===(h=l.rtpMap)||void 0===h?void 0:h.encodingName.toLowerCase())||"")&&(l.fmtp||(l.fmtp={parameters:{}}),l.fmtp.parameters["x-google-min-bitrate"]="".concat(a.bitrateMin))}),ct().supportMinBitrate&&!he(o=i._hints).call(o,zt.LOW_STREAM)&&a.bitrateMax&&r.attributes.payloads.forEach(l=>{var d,h;he(d=["h264","h265","vp8","vp9","av1"]).call(d,(null===(h=l.rtpMap)||void 0===h?void 0:h.encodingName.toLowerCase())||"")&&(l.fmtp||(l.fmtp={parameters:{}}),l.fmtp.parameters["x-google-start-bitrate"]="".concat(B("X_GOOGLE_START_BITRATE")||Math.floor(a.bitrateMax)))})}function gv(r){if("video"!==r.media.mediaType)return;const i=ot();if(i.name!==It.SAFARI&&i.os!==hr.IOS)return;const o=r.attributes.extmaps.findIndex(a=>/video-orientation/g.test(a.extensionName));-1!==o&&r.attributes.extmaps.splice(o,1)}function iC(r,i,o){if(!i)return;let a,l;if("video"===r.media.mediaType?(a=o.videoExtensions,l=o.videoCodecs):(a=o.audioExtensions,l=o.audioCodecs),!0===i.twcc){const d=a.find(h=>nC(h.extensionName));if(d){const h=d.extensionName;r.attributes.extmaps.find(m=>nC(m.extensionName))||r.attributes.extmaps.push({entry:d.entry,extensionName:h}),(m=l,g=r.attributes.payloads,g.filter(v=>!!m.find(y=>y.payloadType===v.payloadType&&!!y.rtcpFeedbacks.find(b=>"transport-cc"===b.type)))).forEach(m=>{m.rtcpFeedbacks.find(g=>"transport-cc"===g.type)||m.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(!1===i.twcc){const d=r.attributes.extmaps.findIndex(h=>nC(h.extensionName));-1!==d&&r.attributes.extmaps.splice(d,1),r.attributes.payloads.forEach(h=>{const f=h.rtcpFeedbacks.findIndex(m=>"transport-cc"===m.type);-1!==f&&h.rtcpFeedbacks.splice(f,1)})}var m,g;if(!0===i.remb){const d=a.find(h=>iH(h.extensionName));if(d){const h=d.extensionName;r.attributes.extmaps.find(m=>m.extensionName===h)||r.attributes.extmaps.push({entry:d.entry,extensionName:h}),function(m,g){return g.filter(v=>!!m.find(y=>y.payloadType===v.payloadType&&!!y.rtcpFeedbacks.find(b=>"goog-remb"===b.type)))}(l,r.attributes.payloads).forEach(m=>{m.rtcpFeedbacks.find(g=>"goog-remb"===g.type)||m.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(!1===i.remb){const d=r.attributes.extmaps.findIndex(h=>iH(h.extensionName));-1!==d&&r.attributes.extmaps.splice(d,1),r.attributes.payloads.forEach(h=>{const f=h.rtcpFeedbacks.findIndex(m=>"goog-remb"===m.type);-1!==f&&h.rtcpFeedbacks.splice(f,1)})}}function Ac(r,i,o){if(hn()||"video"!==r.media.mediaType||!(i instanceof Ve)||"vp9"!==o&&"vp8"!==o||"vp8"===o&&!B("SIMULCAST")||"vp9"===o&&B("ENABLE_SVC")||void 0===i._scalabilityMode||i._scalabilityMode.numSpatialLayers<=1)return;const a="vp8"===o?2:i._scalabilityMode.numSpatialLayers,l=r.attributes.ssrcs[0],d=r.attributes.ssrcGroups.find(f=>"FID"===f.semantic&&f.ssrcIds[0]===l.ssrcId),h={semantic:"SIM",ssrcIds:[l.ssrcId]};for(let f=1;f<a;f++)r.attributes.ssrcs.push({ssrcId:l.ssrcId+f,attributes:Vn(l.attributes)}),h.ssrcIds.push(l.ssrcId+f),d&&(r.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+f,attributes:Vn(l.attributes)}),r.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[l.ssrcId+f,d.ssrcIds[1]+f]}));r.attributes.ssrcGroups.unshift(h)}function Tn(){return gn.apply(this,arguments)}function gn(){return gn=L(function*(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=new RTCPeerConnection;o.addTransceiver("video",{direction:"sendonly"}),o.addTransceiver("audio",{direction:"sendonly"}),o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"});const a=(yield o.createOffer()).sdp,{send:l,recv:d,sendrecv:h}=function(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=arguments.length>2?arguments[2]:void 0;const v=mv(g,f,m,"sendonly"),y=mv(g,f,m,"recvonly"),b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ko(v,y,"videoExtensions",b,C,P),ko(v,y,"videoCodecs",b,C,P),ko(v,y,"audioExtensions",b,C,P),ko(v,y,"audioCodecs",b,C,P),B("RAISE_H264_BASELINE_PRIORITY")){const R=[],A=[];P.videoCodecs.forEach((O,M)=>{var x;if("h264"===(null===(x=O.rtpMap)||void 0===x?void 0:x.encodingName.toLocaleLowerCase())){var j,W;const q=P.videoCodecs[M+1],te=q&&f2(O,q),J=null===(j=O.fmtp)||void 0===j?void 0:j.parameters["profile-level-id"],X=null===(W=O.fmtp)||void 0===W?void 0:W.parameters["packetization-mode"];!J||J!==B("FIRST_H264_PROFILE_LEVEL_ID")||B("FIRST_PACKETIZATION_MODE")&&X!==B("FIRST_PACKETIZATION_MODE")?A.push(te?[O,q]:[O]):R.push(te?[O,q]:[O])}}),R.length>0&&A.length>0&&(T.debug("raising H264 baseline profile priority"),P.videoCodecs.forEach((O,M)=>{var x;if("h264"===(null===(x=O.rtpMap)||void 0===x?void 0:x.encodingName.toLocaleLowerCase())){const j=f2(O,P.videoCodecs[M+1]),W=R.shift()||A.shift()||[];W.length>0&&(j?P.videoCodecs.splice(M,2,...W):P.videoCodecs.splice(M,1,...W))}}),C.videoCodecs=C.videoCodecs.filter(O=>{var M,x;return!("h264"===(null===(M=O.rtpMap)||void 0===M?void 0:M.encodingName.toLocaleLowerCase())&&(null===(x=O.fmtp)||void 0===x?void 0:x.parameters["profile-level-id"])!==B("FIRST_H264_PROFILE_LEVEL_ID"))}),B("FILTER_SEND_H264_BASELINE")&&(b.videoCodecs=b.videoCodecs.filter(O=>{var M,x;return!("h264"===(null===(M=O.rtpMap)||void 0===M?void 0:M.encodingName.toLocaleLowerCase())&&(null===(x=O.fmtp)||void 0===x?void 0:x.parameters["profile-level-id"])!==B("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:b,recv:C,sendrecv:P}}(r,i,a);try{o.close()}catch{}return{send:l,recv:d,sendrecv:h}}),gn.apply(this,arguments)}function h2(){const r={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},i=mv(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"recvonly"),o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ko(r,i,"videoExtensions",o,a,l),ko(r,i,"videoCodecs",o,a,l),ko(r,i,"audioExtensions",o,a,l),ko(r,i,"audioCodecs",o,a,l),B("RAISE_H264_BASELINE_PRIORITY")){const d=l.videoCodecs.findIndex(h=>h.rtpMap&&"h264"===h.rtpMap.encodingName.toLocaleLowerCase()&&h.fmtp&&"42001f"===h.fmtp.parameters["profile-level-id"]);if(-1!==d){const h=l.videoCodecs.findIndex(f=>f.rtpMap&&"h264"===f.rtpMap.encodingName.toLocaleLowerCase());if(h<d){T.debug("raising H264 baseline profile priority");const f=l.videoCodecs[d];l.videoCodecs.splice(d,1),l.videoCodecs.splice(h,0,f)}-1!==h&&(a.videoCodecs=a.videoCodecs.filter(f=>!(f.rtpMap&&"h264"===f.rtpMap.encodingName.toLocaleLowerCase()&&f.fmtp&&"42001f"!==f.fmtp.parameters["profile-level-id"])))}}return{send:o,recv:a,sendrecv:l}}function ko(r,i,o,a,l,d){if("videoExtensions"===o||"audioExtensions"===o){const h=[];return r[o].forEach(f=>{i[o].some((m,g)=>{if(f.entry===m.entry&&f.extensionName===m.extensionName)return h.push(g),!0})?d[o].push(f):a[o].push(f)}),void i[o].forEach((f,m)=>{-1===h.indexOf(m)&&l[o].push(f)})}if("videoCodecs"===o||"audioCodecs"===o){const h=[];return r[o].forEach(f=>{i[o].some((m,g)=>{if(f.payloadType===m.payloadType&&JSON.stringify(f)===JSON.stringify(m))return h.push(g),!0})?d[o].push(f):a[o].push(f)}),void i[o].forEach((f,m)=>{-1===h.indexOf(m)&&l[o].push(f)})}}function ea(r){const{send:i,recv:o,sendrecv:a}=r;if(!a){if(!i||!o)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:i,recv:o}}let l,d;return i?(l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},l.audioCodecs=[...i.audioCodecs,...a.audioCodecs],l.videoCodecs=[...i.videoCodecs,...a.videoCodecs],l.audioExtensions=[...i.audioExtensions,...a.audioExtensions],l.videoExtensions=[...i.videoExtensions,...a.videoExtensions]):l=a,o?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...o.audioCodecs,...a.audioCodecs],d.videoCodecs=[...o.videoCodecs,...a.videoCodecs],d.audioExtensions=[...o.audioExtensions,...a.audioExtensions],d.videoExtensions=[...o.videoExtensions,...a.videoExtensions]):d=a,{send:l,recv:d}}function Nl(r){"audio"===r.media.mediaType&&r.attributes.payloads.filter(i=>{var o;return"opus"===(null===(o=i.rtpMap)||void 0===o?void 0:o.encodingName.toLowerCase())}).forEach(i=>{i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"})}function Lo(r,i,o,a){let l=[];if(r===_e.VIDEO){if(B("H264_PROFILE_LEVEL_ID")&&"h264"===a&&(l=i.videoCodecs.filter(d=>{var h;return he(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,a)&&d&&d.fmtp&&d.fmtp.parameters["profile-level-id"]===B("H264_PROFILE_LEVEL_ID")})),!Array.isArray(l)||0===l.length){let d=[];const h=[],f=[],m=[];if(o.videoCodecs.forEach(g=>{const v=g.rtpMap&&g.rtpMap.encodingName.toLowerCase()||"";he(v).call(v,a)?d.push(g):he(v).call(v,"vp9")?h.push(g):he(v).call(v,"vp8")?f.push(g):he(v).call(v,"h264")&&m.push(g)}),0===d.length){let g="";0!==h.length?(d=h,g="vp9"):0!==f.length?(d=f,g="vp8"):0!==m.length&&(d=m,g="h264"),T.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(g))}0!==d.length&&(l=i.videoCodecs.filter(g=>d.some(v=>v.payloadType===g.payloadType)))}if(0===l.length&&(T.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(i.videoCodecs[0].rtpMap&&i.videoCodecs[0].rtpMap.encodingName)),l=i.videoCodecs),B("USE_PUB_RTX")||B("USE_SUB_RTX")){const d=oD(l,i.videoCodecs);l=[...l,...d]}}else l=i.audioCodecs.filter(d=>{var h;return he(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,a)}),0===l.length&&(T.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),l=i.audioCodecs.filter(d=>{var h;return he(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return l}function oD(r,i){const o=r.map(a=>a.payloadType.toString());return i.filter(a=>a.rtpMap&&"rtx"===a.rtpMap.encodingName&&a.fmtp&&a.fmtp.parameters.apt&&he(o).call(o,a.fmtp&&a.fmtp.parameters.apt))}function Lr(r,i,o){return sD.apply(this,arguments)}function sD(){return sD=L(function*(r,i,o){const a=i.toString(),l=p2(a,"offer","remote","exchangeSDP");yield r.setRemoteDescription({type:"offer",sdp:a});const d=yield r.createAnswer();if(!d.sdp)throw new Error("cannot get answer sdp");let h=d.sdp;h=cr(h,o||{}),l?.(h||""),yield r.setLocalDescription({type:"answer",sdp:h})}),sD.apply(this,arguments)}function cr(r,i,o){const a=vr.parse(r),{useXR:l}=i;return a.mediaDescriptions.forEach(d=>{var h;d.attributes.mid&&(Array.isArray(o)&&!he(o).call(o,d.attributes.mid)||("audio"===d.media.mediaType&&Nl(d),l&&he(h=["audio","video"]).call(h,d.media.mediaType)&&d.attributes.payloads.forEach(f=>{-1===f.rtcpFeedbacks.findIndex(m=>"rrtr"===m.type)&&f.rtcpFeedbacks.push({type:"rrtr"})})))}),vr.print(a)}function p2(r,i,o,a){if(B("SDP_LOGGING"))return T.upload("exchanging ".concat(o," ").concat(i," SDP during P2PConnection.").concat(a,"\n"),r),"offer"===i?l=>{p2(l,"answer","local"===o?"remote":"local",a)}:void 0}function _v(r){const i=B("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(i)&&i.length>0)&&i.some(o=>he(r).call(r,o))}function f2(r,i){try{var o;return(null===(o=r.fmtp)||void 0===o?void 0:o.parameters.apt)===i.payloadType.toString()}catch{return!1}}function Ds(r,i){return typeof B(r)===i?B(r):void 0}function m2(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function Pl(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?m2(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):m2(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}const vv=new Map;class oC extends nn{get state(){return this._state}set state(i){if(i===this._state)return;const o=this._state;this._state=i,"DISCONNECTED"===i&&this._disconnectedReason?this.emit(mr.CONNECTION_STATE_CHANGE,i,o,this._disconnectedReason):this.emit(mr.CONNECTION_STATE_CHANGE,i,o)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(i){T.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(i)),this._joinGatewayStartTime=i}constructor(i,o){super(),N(this,"store",void 0),N(this,"joinInfo",void 0),N(this,"key",void 0),N(this,"ntpOffset",0),N(this,"signal",void 0),N(this,"role",void 0),N(this,"inChannelInfo",{joinAt:null,duration:0}),N(this,"spec",void 0),N(this,"_state","DISCONNECTED"),N(this,"_statsCollector",void 0),N(this,"_disconnectedReason",void 0),N(this,"isSignalRecover",!1),N(this,"hasChangeBGPAddress",!1),N(this,"trafficStatsInterval",void 0),N(this,"networkQualityInterval",void 0),N(this,"_joinGatewayStartTime",0),N(this,"_signalTimeout",!1),N(this,"_clientRoleOptions",void 0),N(this,"_isProactiveJoin",!1),this.store=i,this.spec=o,this.signal=this.store.useP2P?new hv(Pl(Pl({},o),{},{retryConfig:o.websocketRetryConfig}),i):new H_(Pl(Pl({},o),{},{retryConfig:o.websocketRetryConfig}),i),this._statsCollector=o.statsCollector,this.role=o.role||"audience",this._clientRoleOptions=o.clientRoleOptions,this.handleSignalEvents()}join(i,o,a){var l=this;return L(function*(){l.store.joinGatewayStart(),"disabled"!==i.cloudProxyServer&&(l.hasChangeBGPAddress=!0);const d=Date.now();let h=vv.get(i.cname);if(h||(h=new Map,vv.set(i.cname,h)),l._isProactiveJoin=!0,h.has(i.uid)){const v=new K(k.UID_CONFLICT);throw be.joinGateway(i.sid,{lts:d,succ:!1,ec:v.code,addr:null,uid:i.uid,cid:i.cid,firstSuccess:l._isProactiveJoin,avoidJoinStartTime:l.store.avoidJoinStart,isProxy:!!i.proxyServer,signalChannel:"0",preload:i.preload}),l._isProactiveJoin=!1,v}h.set(i.uid,!0),l.joinInfo=i,l.key=o;let f=0;l.joinGatewayStartTime=d;const m=i.proxyServer;try{T.debug("[".concat(l.store.clientId,"] use websocket join uid ").concat(f));const v=i.gatewayAddrs.map(y=>{let{address:b}=y;const[C,P]=b.split(":"),R={host:C,port:P};return i.proxyServer&&(R.proxy=i.proxyServer),R});f=(yield l.signal.init(v,a)).uid,T.debug("[".concat(l.store.clientId,"] websocket join uid ").concat(f," cost ").concat(Date.now()-l.joinGatewayStartTime))}catch(v){var g;throw T.error("[".concat(l.store.clientId,"] User join failed"),v.toString()),be.joinGateway(i.sid,{lts:d,succ:!1,ec:(null===(g=v.data)||void 0===g?void 0:g.desc)||v.code,errorMsg:v.message,addr:l.signal.url,uid:i.uid,cid:i.cid,firstSuccess:l._isProactiveJoin,avoidJoinStartTime:l.store.avoidJoinStart,isProxy:!!m,signalChannel:"0",preload:i.preload}),l._isProactiveJoin=!1,h.delete(i.uid),l.signal.close(),v}return l.state="CONNECTED",l.inChannelInfo.joinAt=Date.now(),T.debug("[".concat(l.store.clientId,"] Connected to gateway server")),l.trafficStatsInterval=window.setInterval(()=>{l.updateTrafficStats().catch(v=>{T.warning("[".concat(l.store.clientId,"] get traffic stats error"),v.toString())})},3e3),l.networkQualityInterval=window.setInterval(()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?l.emit(mr.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):l.emit(mr.NETWORK_QUALITY,l._signalTimeout?{downlinkNetworkQuality:5,uplinkNetworkQuality:5}:"CONNECTED"===l.state&&l._statsCollector.trafficStats?{uplinkNetworkQuality:H4(l._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:H4(l._statsCollector.trafficStats.B_dnq)}:{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),l.store.joinGatewayEnd(),f})()}leave(){var i=arguments,o=this;return L(function*(){let a=i.length>0&&void 0!==i[0]&&i[0],l=i.length>1?i[1]:void 0;if("DISCONNECTED"!==o.state){l!==Rt.FALLBACK&&(o.state="DISCONNECTING");try{a||o.signal.connectionState!==qt.CONNECTED||(yield(d=o.signal.request(Pe.LEAVE,void 0,!0),le.race([d,O_(3e3)])))}catch(d){T.warning("[".concat(o.store.clientId,"] leave request failed, ignore"),d)}o.signal.close(l),l!==Rt.FALLBACK&&(o.state="DISCONNECTED"),o.reset()}var d})()}publish(i,o,a){var l=this;return L(function*(){if("CONNECTED"!==l.state&&"RECONNECTING"!==l.state)throw new K(k.INVALID_OPERATION,"can not publish when connection state is ".concat(l.state));const d={state:"offer",p2p_id:l.store.p2pId,ortc:o,mode:l.spec.mode,extend:B("PUB_EXTEND"),twcc:!!B("PUBLISH_TWCC"),rtx:!!B("USE_PUB_RTX")};try{return(yield l.signal.request(Pe.PUBLISH,d,!0))._message}catch(h){if(a&&h.data&&h.data.code===Ie.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(l.store.clientId,"] receive publish error code, retry"),h.toString()),yield l.tryUnpubBeforeRepub(i,o),l.publish(i,o,!1);throw h}})()}publishDataChannel(i,o,a){var l=this;return L(function*(){var d;if("CONNECTED"!==l.state&&"RECONNECTING"!==l.state)throw new K(k.INVALID_OPERATION,"can not publish when connection state is ".concat(l.state));const h={stream_id:o.streamId,ordered:o.ordered?1:0,max_retrans_times:null!==(d=o.maxRetransmits)&&void 0!==d?d:10,channel_id:o.channelId,metadata:o.metadata};try{yield l.signal.request(Pe.PUBLISH_DATASTREAM,h,!0)}catch(f){if(a&&f.data&&f.data.code===Ie.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(l.store.clientId,"] receive publish datachannels error code, retry"),f.toString()),yield l.tryUnpubDataChannelBeforeRepub(i,o),l.publishDataChannel(i,o,!1);throw f}})()}unpublish(i,o){var a=this;return L(function*(){try{if("CONNECTED"!==a.state&&"RECONNECTING"!==a.state)throw new K(k.INVALID_OPERATION,"can not publish when connection state is ".concat(a.state));yield a.signal.request(Pe.UNPUBLISH,{stream_id:o,ortc:i},!0)}catch(l){T.warning("[".concat(a.store.clientId,"] unpublish warning: "),l)}})()}unpublishDataChannel(i){var o=this;return L(function*(){try{if("CONNECTED"!==o.state&&"RECONNECTING"!==o.state)throw new K(k.INVALID_OPERATION,"can not publish when connection state is ".concat(o.state));yield le.all(i.map(a=>o.signal.request(Pe.UNPUBLISH_DATASTREAM,{channel_id:a},!0)))}catch(a){T.warning("unpublish datachannels warning: ",a)}})()}presubscribe(i,o,a){var l=this;return L(function*(){if("CONNECTED"!==l.state&&"RECONNECTING"!==l.state)throw new K(k.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(l.state));const d={stream_id:i,stream_type:o,mode:l.spec.mode,codec:l.spec.codec,p2p_id:l.store.p2pId,twcc:!!B("SUBSCRIBE_TWCC"),rtx:!!B("USE_SUB_RTX")||void 0,extend:B("SUB_EXTEND"),svc:Array.isArray(B("SVC"))&&0!==B("SVC").length?B("SVC"):void 0};try{return yield l.signal.request(Pe.PRE_SUBSCRIBE,d,!0)}catch(h){if(a&&h.data&&h.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(l.store.clientId,"] pre-subscribe error, retry"),h.toString()),l.presubscribe(i,o,!1);throw h}})()}subscribe(i,o,a){var l=this;return L(function*(){if("CONNECTED"!==l.state&&"RECONNECTING"!==l.state)throw new K(k.INVALID_OPERATION,"can not subscribe when connection state is ".concat(l.state));const d={stream_id:i,stream_type:o.stream_type,mode:l.spec.mode,codec:l.spec.codec,p2p_id:l.store.p2pId,twcc:!!B("SUBSCRIBE_TWCC"),rtx:!!B("USE_SUB_RTX"),extend:B("SUB_EXTEND"),ssrcId:o.ssrcId,svc:Array.isArray(B("SVC"))&&0!==B("SVC").length?B("SVC"):void 0};try{return(yield l.signal.request(Pe.SUBSCRIBE,d,!0))._message}catch(h){if(a&&h.data&&h.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(l.store.clientId,"] receiver subscribe error code, retry"),h.toString()),yield l.tryUnsubBeforeResub(i,o),yield l.subscribe(i,o,!1);throw h}})()}subscribeDataChannel(i,o,a){var l=this;return L(function*(){if("CONNECTED"!==l.state&&"RECONNECTING"!==l.state)throw new K(k.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(l.state));const d={uid:i,stream_id:o.id,channel_id:o.datachannelId};try{return void(yield l.signal.request(Pe.SUBSCRIBE_DATASTREAM,d,!0))}catch(h){if(a&&h.data&&h.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(l.store.clientId,"] receiver subscribe datachannel error code, retry"),h.toString()),yield l.tryUnsubDataChannelBeforeResub(i,o),yield l.subscribeDataChannel(i,o,!1);throw h}})()}subscribeAll(i,o){var a=this;return L(function*(){if("CONNECTED"!==a.state&&"RECONNECTING"!==a.state)throw new K(k.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(a.state));const l={p2p_id:a.store.p2pId,users:i,dtx:!1,rtx:!!B("USE_SUB_RTX"),twcc:!!B("SUBSCRIBE_TWCC"),svc:Array.isArray(B("SVC"))&&0!==B("SVC").length?B("SVC"):void 0};try{return yield a.signal.request(Pe.SUBSCRIBE_STREAMS,l,!0)}catch(d){if(o&&d.data&&d.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(a.store.clientId,"] receiver massSubscribe error code, retry"),d.toString()),yield a.tryMassUnsubBeforeResub(i),yield a.subscribeAll(i,!1);throw d}})()}setVideoProfile(i){var o=this;return L(function*(){const a=function(l){if(!(l.bitrateMax&&l.bitrateMin&&l.frameRate&&l.height&&l.width))return;let d=l.frameRate,h=l.width,f=l.height,m=!0;return"number"!=typeof d&&(d=d.exact||d.ideal||d.max||d.min||0,d||(m=!1)),"number"!=typeof h&&(h=h.exact||h.ideal||h.max||h.min||0,h||(m=!1)),"number"!=typeof f&&(f=f.exact||f.ideal||f.max||f.min||0,d||(m=!1)),m?{stream_type:0,width:h,height:f,fps:d,start_bps:1e3*l.bitrateMax,min_bps:1e3*l.bitrateMin,target_bps:1e3*l.bitrateMax}:void 0}(i);if(a)return o.signal.request(Pe.SET_VIDEO_PROFILE,a);T.debug("[".concat(o.store.clientId,"] encoder config is not complete, do not report to gateway"))})()}unsubscribe(i,o){var a=this;return L(function*(){try{yield a.signal.request(Pe.UNSUBSCRIBE,{p2p_id:a.store.p2pId,ortc:i,stream_id:o},!0)}catch(l){T.warning("[".concat(a.store.clientId,"] unsubscribe warning: "),l)}})()}unsubscribeDataChannel(i,o){var a=this;return L(function*(){try{if("CONNECTED"!==a.state&&"RECONNECTING"!==a.state)throw new K(k.INVALID_OPERATION,"can not publish when connection state is ".concat(a.state));yield le.all(i.map(l=>a.signal.request(Pe.UNSUBSCRIBE_DATASTREAM,{stream_id:l,uid:o},!0)))}catch(l){T.warning("unsubscribeDataChannel warning: ",l)}})()}massUnsubscribe(i){var o=this;return L(function*(){try{yield o.signal.request(Pe.UNSUBSCRIBE_STREAMS,i,!0)}catch(a){T.warning("[".concat(o.store.clientId,"] massUnsubscribeAll warning: "),a)}})()}reconnectPC(i){var o=this;return L(function*(){const{iceParameters:a,dtlsParameters:l,rtpCapabilities:d}=i;return{gatewayEstablishParams:yield o.signal.request(Pe.CONNECT_PC,{p2p_id:o.store.p2pId,stream_id:o.store.uid,ortc:{iceParameters:a,dtlsParameters:l,rtpCapabilities:d}},!0),gatewayAddress:o.getCurrentGatewayAddress()}})()}getGatewayInfo(){return this.signal.request(Pe.GATEWAY_INFO)}renewToken(i){var o=this;return L(function*(){yield o.signal.request(Pe.RENEW_TOKEN,i),o.key=i.token})()}setClientRole(i,o){var a=this;return L(function*(){if(o&&(a._clientRoleOptions=Object.assign({},o)),"CONNECTED"!==a.state)return void(a.role=i);let l,d=0;"audience"===i?a._clientRoleOptions&&a._clientRoleOptions.delay?(l=a._clientRoleOptions.delay,d=1):d=a._clientRoleOptions&&a._clientRoleOptions.level?a._clientRoleOptions.level:2:d=0,yield a.signal.request(Pe.SET_CLIENT_ROLE,{role:i,level:d,delay:l,client_ts:Date.now()}),a.role=i})()}setRemoteVideoStreamType(i,o){var a=this;return L(function*(){yield a.signal.request(Pe.SWITCH_VIDEO_STREAM,{stream_id:i,stream_type:o})})()}setDefaultRemoteVideoStreamType(i){var o=this;return L(function*(){yield o.signal.request(Pe.DEFAULT_VIDEO_STREAM,{stream_type:i})})()}setStreamFallbackOption(i,o){var a=this;return L(function*(){yield a.signal.request(Pe.SET_FALLBACK_OPTION,{stream_id:i,fallback_type:o})})()}pickSVCLayer(i,o){var a=this;return L(function*(){yield a.signal.request(Pe.PICK_SVC_LAYER,{stream_id:i,spatial_layer:o.spatialLayer,temporal_layer:o.temporalLayer})})()}setRTM2Flag(i){var o=this;return L(function*(){yield o.signal.request(Pe.SET_RTM2_FLAG,{rtm2_flag:i})})()}sendExtensionMessage(i,o,a){var l=this;return L(function*(){if(l.signal instanceof hv)return l.signal.sendExtensionMessage(i,o,a)})()}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Pl({},this.inChannelInfo)}getGatewayVersion(){var i=this;return L(function*(){return(yield i.signal.request(Pe.GATEWAY_INFO)).version})()}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const i=vv.get(this.joinInfo.cname);i&&i.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const i=function(o){let a;return a=o.startsWith("dc")?o.match(/(dc\:\/\/)?([^:]+):(\d+)/):o.match(/(wss\:\/\/)?([^:]+):(\d+)/),a?{username:Wr.username,password:Wr.password,turnServerURL:a[2],tcpport:parseInt(a[3])+30,udpport:parseInt(a[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],i&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(Pl(Pl({},Wr),{},{turnServerURL:i.turnServerURL,tcpport:i.tcpport,udpport:i.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}updateTrafficStats(){var i=this;return L(function*(){if("CONNECTED"!==i.state)return;const o=yield i.signal.request(Pe.TRAFFIC_STATS,void 0,!0);o.timestamp=Date.now(),null!=o.ntp_offset&&(i.ntpOffset=o.ntp_offset),o.peer_delay.forEach(a=>{const l=i._statsCollector.trafficStats&&i._statsCollector.trafficStats.peer_delay.find(d=>d.peer_uid===a.peer_uid);l&&l.B_st!==a.B_st&&D_(()=>{i.emit(mr.STREAM_TYPE_CHANGE,a.peer_uid,a.B_st)})}),i._statsCollector.updateTrafficStats(o)})()}getJoinMessage(i){if(!this.joinInfo||!this.key)throw new K(k.UNEXPECTED_ERROR,"can not generate join message, no join info");const o=Object.assign({},this.joinInfo.apResponse);let a=B("REPORT_APP_SCENARIO");if("string"!=typeof a)try{a=JSON.stringify(a)}catch{a=void 0}a&&a.length>128&&(a=void 0);const l=!(hn()||eL(87)||C5())&&"boolean"==typeof B("ENABLE_PRE_SUB")&&B("ENABLE_PRE_SUB"),d=!C5()&&Ds("ENABLE_PREALLOC_PC","boolean"),h=Pl({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Ss,browser:navigator.userAgent,process_id:B("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:o,extend:B("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:a,attributes:{userAttributes:{enablePublishedUserList:B("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:B("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:"number"==typeof B("SUBSCRIBE_AUDIO_FILTER_TOPN")?B("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:"boolean"==typeof B("ENABLE_PUBLISH_AUDIO_FILTER")?B("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:"boolean"==typeof B("ENABLE_USER_LICENSE_CHECK")?B("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:!0===B("USE_PUB_RTX")||!0===B("USE_SUB_RTX")||void 0,disableFEC:B("DISABLE_FEC"),enableNTPReport:!!B("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!B("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!B("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Ds("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!B("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:"number"==typeof this.joinInfo.rtmFlag?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!B("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Ds("USE_XR","boolean"),enableLossbasedBwe:Ds("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!B("ENABLE_AUT_CC")||void 0,enableCCFallback:Ds("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:d,preSubNum:l?Ds("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Ds("PUBLISH_TWCC","boolean"),enableSubTWCC:Ds("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Ds("USE_PUB_RTX","boolean"),enableSubRTX:Ds("USE_SUB_RTX","boolean"),enableSubSVC:B("ENABLE_SVC")?B("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(B("SVC"))&&0!==B("SVC").length?B("SVC"):void 0}},join_ts:this.joinGatewayStartTime},i);return this.joinInfo.stringUid&&(h.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(h.aes_mode=this.joinInfo.aesmode,B("ENCRYPT_AES")?(h.aes_secret=this.joinInfo.aespassword,h.aes_encrypt=!0):h.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(h.aes_salt=this.joinInfo.aessalt)),o.addresses[this.signal.websocket.currentURLIndex]&&(h.ap_response.ticket=o.addresses[this.signal.websocket.currentURLIndex].ticket,delete o.addresses),void 0!==this.joinInfo.defaultVideoStream&&(h.default_video_stream=this.joinInfo.defaultVideoStream),h}getRejoinMessage(){if(!this.joinInfo)throw new K(k.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){var i=this;this.signal.on(Me.WS_RECONNECT_CREATE_CONNECTION,o=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Me.WS_RECONNECTING,o=>{this.joinInfo&&be.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:o||Hr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",be.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:"live"===this.spec.mode?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:"audience"===this.role?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Me.WS_CLOSED,o=>{let a;switch(o){case Rt.LEAVE:a=Hr.LEAVE;break;case Rt.UID_BANNED:case Rt.IP_BANNED:case Rt.CHANNEL_BANNED:case Rt.SERVER_ERROR:a=Hr.SERVER_ERROR;break;case Rt.FALLBACK:a=Hr.FALLBACK;break;case Rt.LICENSE_MISSING:case Rt.LICENSE_EXPIRED:case Rt.LICENSE_MINUTES_EXCEEDED:case Rt.LICENSE_PERIOD_INVALID:case Rt.LICENSE_MULTIPLE_SDK_SERVICE:case Rt.LICENSE_ILLEGAL:case Rt.TOKEN_EXPIRE:a=o;break;default:a=Hr.NETWORK_ERROR}T.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(a||"undefined -> "+Hr.NETWORK_ERROR)),this.joinInfo&&be.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:o===Rt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:a}),this._disconnectedReason=o,o!==Rt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Me.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&("audience"===this.role&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(T.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),be.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion)){const o=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!o)return void T.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(o));kt("EVENT_REPORT_DOMAIN",o[1]),kt("EVENT_REPORT_BACKUP_DOMAIN",o[1]),kt("LOG_UPLOAD_SERVER","".concat(o[1],":6444"))}}),this.signal.on(qe.ON_UPLINK_STATS,o=>{this._statsCollector.updateUplinkStats(o)}),this.signal.on(Me.REQUEST_RECOVER,(o,a,l)=>{if(!this.joinInfo)return l(new K(k.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));o&&(this.joinInfo.multiIP=o,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Gr(this,mr.REQUEST_NEW_GATEWAY_LIST).then(a).catch(l)}),this.signal.on(Me.REQUEST_JOIN_INFO,function(){var o=L(function*(a){var l;if(i.updateTurnConfigFromSignal(),i.store.useP2P)return void a(i.getJoinMessage({ortc:{}}));const{iceParameters:d,dtlsParameters:h,rtpCapabilities:f}=yield Gr(i,mr.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:null===(l=i.joinInfo)||void 0===l?void 0:l.turnServer});a(i.getJoinMessage({ortc:{iceParameters:d,dtlsParameters:h,rtpCapabilities:f,version:"2"}}))});return function(a){return o.apply(this,arguments)}}()),this.signal.on(Me.REQUEST_REJOIN_INFO,o=>{o(this.getRejoinMessage())}),this.signal.on(Me.REPORT_JOIN_GATEWAY,(o,a)=>{if(!this.joinInfo)return;let l,d="";var h;o instanceof K?(l=(null===(h=o.data)||void 0===h?void 0:h.desc)||o.code,d=o.message):l=o,be.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:l,errorMsg:d,addr:a,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1}),this.signal.on(Me.IS_P2P_DISCONNECTED,o=>{o(A_(this,mr.IS_P2P_DISCONNECTED))}),this.signal.on(Me.DISCONNECT_P2P,()=>{this.emit(mr.DISCONNECT_P2P)}),this.signal.on(Me.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Me.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Me.JOIN_RESPONSE,o=>{const a=this.getCurrentGatewayAddress();this.emit(mr.JOIN_RESPONSE,o,a)}),this.signal.on(Me.PRE_CONNECT_PC,L(function*(){if(i.joinInfo){i.updateTurnConfigFromSignal();const o=i.getCurrentGatewayAddress(),a=B("FINGERPRINT")||i.joinInfo.apResponse.addresses[i.signal.currentURLIndex].fingerprint;if(o&&a){const l=rC(o);i.emit(mr.PRE_CONNECT_PC,{candidates:l,fingerprint:a})}}})),this.signal.on(Me.RECOVER_NOTIFICATION,o=>{this.joinInfo&&"string"==typeof B("AP_REQUEST_DETAIL")&&(this.joinInfo.apRequestDetail="".concat(B("AP_REQUEST_DETAIL"),";").concat(o))})}tryUnsubBeforeResub(i,o){var a=this;return L(function*(){try{yield a.signal.request(Pe.UNSUBSCRIBE,{p2p_id:a.store.p2pId,stream_id:i,ortc:[o]},!0)}catch(l){throw T.warning("[".concat(a.store.clientId,"] tryUnsubBeforeResub warning"),l),l}})()}tryUnsubDataChannelBeforeResub(i,o){var a=this;return L(function*(){try{yield a.signal.request(Pe.UNSUBSCRIBE,{stream_id:o.id},!0)}catch(l){throw T.warning("unsubscribe datachannel warning",l),l}})()}tryUnpubBeforeRepub(i,o){var a=this;return L(function*(){try{yield a.signal.request(Pe.UNPUBLISH,{stream_id:i,ortc:o},!0)}catch(l){throw T.warning("[".concat(a.store.clientId,"] tryUnpubBeforeRepub warning: "),l),l}})()}tryUnpubDataChannelBeforeRepub(i,o){var a=this;return L(function*(){try{yield a.signal.request(Pe.UNPUBLISH_DATASTREAM,{channnel_id:o.channelId},!0)}catch(l){throw T.warning("unpublish datastream warning: ",l),l}})()}tryMassUnsubBeforeResub(i){var o=this;return L(function*(){const a={users:i.map(l=>({stream_id:l.stream_id,stream_type:l.stream_type}))};try{yield o.signal.request(Pe.UNSUBSCRIBE_STREAMS,a,!0)}catch(l){throw T.warning("[".concat(o.store.clientId,"] tryMassUnsubBeforeResub warning"),l),l}})()}muteLocal(i,o){var a=this;return L(function*(){const l={action:i.find(d=>d.stream_type===at.Audio)?"mute_local_audio":"mute_local_video",p2p_id:a.store.p2pId,ortc:i,stream_id:o};try{yield a.signal.request(Pe.CONTROL,l,!0,!0)}catch(d){throw T.warning("[".concat(a.store.clientId,"] gateway muteLocal warning: "),d),d}})()}unmuteLocal(i,o){var a=this;return L(function*(){const l={action:i.find(d=>d.stream_type===at.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:a.store.p2pId,ortc:i,stream_id:o};try{yield a.signal.request(Pe.CONTROL,l,!0,!0)}catch(d){throw T.warning("[".concat(a.store.clientId,"] gateway unmuteLocal warning: "),d),d}})()}muteRemote(i,o){var a=this;return L(function*(){const l={action:i===_e.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:a.store.p2pId,stream_id:o};try{yield a.signal.request(Pe.CONTROL,l,!0,!0)}catch(d){throw T.warning("[".concat(a.store.clientId,"] gateway muteRemote warning: "),d),d}})()}unmuteRemote(i,o){var a=this;return L(function*(){const l={action:i===_e.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:a.store.p2pId,stream_id:o};try{yield a.signal.request(Pe.CONTROL,l,!0,!0)}catch(d){throw T.warning("[".concat(a.store.clientId,"] gateway unmuteRemote warning: "),d),d}})()}uploadWRTCStats(i){this.signal.uploadWRTCStats(i)}upload(i,o){this.signal.upload(i,o)}getSignalRTT(){return this.signal.rtt}restartICE(i){var o=this;return L(function*(){const a={p2p_id:o.store.p2pId,stream_id:o.store.uid,ortc:i};try{return yield o.signal.request(Pe.RESTART_ICE,a,!0)}catch(l){throw T.warning("[".concat(o.store.clientId,"] P2PChannel.restartICE warning: "),l),l}})()}reconnect(){"CONNECTED"===this.state&&this.signal.reconnect(void 0,Hr.P2P_FAILED)}getCurrentGatewayAddress(){var i,o;if(!B("GATEWAY_WSS_ADDRESS"))return B("USE_CANDIDATE_FROM_AP_DETAIL")&&null!==(i=this.joinInfo)&&void 0!==i&&i.apGatewayAddress?(T.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):null!==(o=this.joinInfo)&&void 0!==o&&o.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}setPublishAudioFilterEnabled(i){var o=this;return L(function*(){yield o.signal.request(Pe.SET_PARAMETER,{enablePublishAudioFilter:i})})()}}let qf=0,aD=0;function ta(r,i,o,a){return new le((l,d)=>{i.timeout=i.timeout||B("HTTP_CONNECT_TIMEOUT"),i.responseType=i.responseType||"json",i.data&&!o?(i.data=JSON.stringify(i.data),qf+=bc(i.data)):o&&(i.data.size?qf+=i.data.size:i.data instanceof FormData?qf+=Sc(i.data):qf+=bc(JSON.stringify(i.data))),i.headers=i.headers||{},i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json",i.method="POST",i.url=r,Oi.request(i).then(h=>{"string"==typeof h.data?aD+=bc(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?aD+=h.data.byteLength:aD+=bc(JSON.stringify(h.data)),a&&l({data:h.data,headers:h.headers}),l(h.data)}).catch(h=>{Oi.isCancel(h)?d(new K(k.OPERATION_ABORTED,"cancel token canceled")):d("ECONNABORTED"===h.code?new K(k.NETWORK_TIMEOUT,h.message):h.response?new K(k.NETWORK_RESPONSE_ERROR,h.response.status):new K(k.NETWORK_ERROR,h.message))})})}!function(){var r;function i(Z){var se=0;return function(){return se<Z.length?{done:!1,value:Z[se++]}:{done:!0}}}var a,o="function"==typeof Object.defineProperties?Object.defineProperty:function(Z,se,ve){return Z==Array.prototype||Z==Object.prototype||(Z[se]=ve.value),Z},l=function(Z){Z=["object"==typeof globalThis&&globalThis,Z,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Ji&&Ji];for(var se=0;se<Z.length;++se){var ve=Z[se];if(ve&&ve.Math==Math)return ve}throw Error("Cannot find global object")}(this);function d(Z,se){if(se)e:{var ve=l;Z=Z.split(".");for(var xe=0;xe<Z.length-1;xe++){var vt=Z[xe];if(!(vt in ve))break e;ve=ve[vt]}(se=se(xe=ve[Z=Z[Z.length-1]]))!=xe&&null!=se&&o(ve,Z,{configurable:!0,writable:!0,value:se})}}function h(Z){return(Z={next:Z})[Symbol.iterator]=function(){return this},Z}function f(Z){var se=typeof Symbol<"u"&&Symbol.iterator&&Z[Symbol.iterator];return se?se.call(Z):{next:i(Z)}}if(d("Symbol",function(Z){function se(vt,de){this.A=vt,o(this,"description",{configurable:!0,writable:!0,value:de})}if(Z)return Z;se.prototype.toString=function(){return this.A};var ve="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",xe=0;return function vt(de){if(this instanceof vt)throw new TypeError("Symbol is not a constructor");return new se(ve+(de||"")+"_"+xe++,de)}}),d("Symbol.iterator",function(Z){if(Z)return Z;Z=Symbol("Symbol.iterator");for(var se="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),ve=0;ve<se.length;ve++){var xe=l[se[ve]];"function"==typeof xe&&"function"!=typeof xe.prototype[Z]&&o(xe.prototype,Z,{configurable:!0,writable:!0,value:function(){return h(i(this))}})}return Z}),"function"==typeof Object.setPrototypeOf)a=Object.setPrototypeOf;else{var m;e:{var g={};try{g.__proto__={a:!0},m=g.a;break e}catch{}m=!1}a=m?function(Z,se){if(Z.__proto__=se,Z.__proto__!==se)throw new TypeError(Z+" is not extensible");return Z}:null}var v=a;function y(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function b(Z){if(Z.m)throw new TypeError("Generator is already running");Z.m=!0}function C(Z,se){return Z.h=3,{value:se}}function P(Z){this.g=new y,this.G=Z}function R(Z,se,ve,xe){try{var vt=se.call(Z.g.j,ve);if(!(vt instanceof Object))throw new TypeError("Iterator result "+vt+" is not an object");if(!vt.done)return Z.g.m=!1,vt;var de=vt.value}catch(I){return Z.g.j=null,Z.g.s(I),A(Z)}return Z.g.j=null,xe.call(Z.g,de),A(Z)}function A(Z){for(;Z.g.h;)try{var se=Z.G(Z.g);if(se)return Z.g.m=!1,{value:se.value,done:!1}}catch(ve){Z.g.v=void 0,Z.g.s(ve)}if(Z.g.m=!1,Z.g.l){if(se=Z.g.l,Z.g.l=null,se.F)throw se.D;return{value:se.return,done:!0}}return{value:void 0,done:!0}}function O(Z){this.next=function(se){return Z.o(se)},this.throw=function(se){return Z.s(se)},this.return=function(se){return function(ve,xe){b(ve.g);var vt=ve.g.j;return vt?R(ve,"return"in vt?vt.return:function(de){return{value:de,done:!0}},xe,ve.g.return):(ve.g.return(xe),A(ve))}(Z,se)},this[Symbol.iterator]=function(){return this}}function M(Z,se){return se=new O(new P(se)),v&&Z.prototype&&v(se,Z.prototype),se}if(y.prototype.o=function(Z){this.v=Z},y.prototype.s=function(Z){this.l={D:Z,F:!0},this.h=this.C||this.u},y.prototype.return=function(Z){this.l={return:Z},this.h=this.u},P.prototype.o=function(Z){return b(this.g),this.g.j?R(this,this.g.j.next,Z,this.g.o):(this.g.o(Z),A(this))},P.prototype.s=function(Z){return b(this.g),this.g.j?R(this,this.g.j.throw,Z,this.g.o):(this.g.s(Z),A(this))},d("Array.prototype.entries",function(Z){return Z||function(){return function(se,ve){se instanceof String&&(se+="");var xe=0,vt=!1,de={next:function(){if(!vt&&xe<se.length){var I=xe++;return{value:ve(I,se[I]),done:!1}}return vt=!0,{done:!0,value:void 0}}};return de[Symbol.iterator]=function(){return de},de}(this,function(se,ve){return[se,ve]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var x=function(Z,se){for(var ve=0;ve<Z.length;ve++)se(Z[ve])},j=function(Z){return Z.replace(/\r?\n|\r/g,"\r\n")},W=function(Z,se,ve){return se instanceof Blob?(se.name===(ve=void 0!==ve?ve+"":"string"==typeof se.name?se.name:"blob")&&"[object Blob]"!==Object.prototype.toString.call(se)||(se=new File([se],ve)),[String(Z),se]):[String(Z),String(se)]},q=function(Z,se){if(Z.length<se)throw new TypeError(se+" argument required, but only "+Z.length+" present.")},te="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,J=te.FormData,X=te.XMLHttpRequest&&te.XMLHttpRequest.prototype.send,Ce=te.Request&&te.fetch,Re=te.navigator&&te.navigator.sendBeacon,ut=te.Element&&te.Element.prototype,Nt=te.Symbol&&Symbol.toStringTag;Nt&&(Blob.prototype[Nt]||(Blob.prototype[Nt]="Blob"),"File"in te&&!File.prototype[Nt]&&(File.prototype[Nt]="File"));try{new File([],"")}catch{te.File=function(se,ve,xe){return se=new Blob(se,xe||{}),Object.defineProperties(se,{name:{value:ve},lastModified:{value:+(xe&&void 0!==xe.lastModified?new Date(xe.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Nt&&Object.defineProperty(se,Nt,{value:"File"}),se}}var _n=function(Z){return Z.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Zt=function(Z){this.i=[];var se=this;Z&&x(Z.elements,function(ve){if(ve.name&&!ve.disabled&&"submit"!==ve.type&&"button"!==ve.type&&!ve.matches("form fieldset[disabled] *"))if("file"===ve.type){var xe=ve.files&&ve.files.length?ve.files:[new File([],"",{type:"application/octet-stream"})];x(xe,function(vt){se.append(ve.name,vt)})}else"select-multiple"===ve.type||"select-one"===ve.type?x(ve.options,function(vt){!vt.disabled&&vt.selected&&se.append(ve.name,vt.value)}):"checkbox"===ve.type||"radio"===ve.type?ve.checked&&se.append(ve.name,ve.value):(xe="textarea"===ve.type?j(ve.value):ve.value,se.append(ve.name,xe))})};if((r=Zt.prototype).append=function(Z,se,ve){q(arguments,2),this.i.push(W(Z,se,ve))},r.delete=function(Z){q(arguments,1);var se=[];Z=String(Z),x(this.i,function(ve){ve[0]!==Z&&se.push(ve)}),this.i=se},r.entries=function Z(){var se,ve=this;return M(Z,function(xe){if(1==xe.h&&(se=0),3!=xe.h)return se<ve.i.length?xe=C(xe,ve.i[se]):(xe.h=0,xe=void 0),xe;se++,xe.h=2})},r.forEach=function(Z,se){q(arguments,1);for(var ve=f(this),xe=ve.next();!xe.done;xe=ve.next()){var vt=f(xe.value);xe=vt.next().value,vt=vt.next().value,Z.call(se,vt,xe,this)}},r.get=function(Z){q(arguments,1);var se=this.i;Z=String(Z);for(var ve=0;ve<se.length;ve++)if(se[ve][0]===Z)return se[ve][1];return null},r.getAll=function(Z){q(arguments,1);var se=[];return Z=String(Z),x(this.i,function(ve){ve[0]===Z&&se.push(ve[1])}),se},r.has=function(Z){q(arguments,1),Z=String(Z);for(var se=0;se<this.i.length;se++)if(this.i[se][0]===Z)return!0;return!1},r.keys=function Z(){var se,ve,de=this;return M(Z,function(I){if(1==I.h&&(se=f(de),ve=se.next()),3!=I.h)return ve.done?void(I.h=0):C(I,f(ve.value).next().value);ve=se.next(),I.h=2})},r.set=function(Z,se,ve){q(arguments,2),Z=String(Z);var xe=[],vt=W(Z,se,ve),de=!0;x(this.i,function(I){I[0]===Z?de&&(de=!xe.push(vt)):xe.push(I)}),de&&xe.push(vt),this.i=xe},r.values=function Z(){var se,ve,vt,de=this;return M(Z,function(I){if(1==I.h&&(se=f(de),ve=se.next()),3!=I.h)return ve.done?void(I.h=0):((vt=f(ve.value)).next(),C(I,vt.next().value));ve=se.next(),I.h=2})},Zt.prototype._asNative=function(){for(var Z=new J,se=f(this),ve=se.next();!ve.done;ve=se.next()){var xe=f(ve.value);ve=xe.next().value,xe=xe.next().value,Z.append(ve,xe)}return Z},Zt.prototype._blob=function(){var Z="----formdata-polyfill-"+Math.random(),se=[],ve="--"+Z+'\r\nContent-Disposition: form-data; name="';return this.forEach(function(xe,vt){return"string"==typeof xe?se.push(ve+_n(j(vt))+'"\r\n\r\n'+j(xe)+"\r\n"):se.push(ve+_n(j(vt))+'"; filename="'+_n(xe.name)+'"\r\nContent-Type: '+(xe.type||"application/octet-stream")+"\r\n\r\n",xe,"\r\n")}),se.push("--"+Z+"--"),new Blob(se,{type:"multipart/form-data; boundary="+Z})},Zt.prototype[Symbol.iterator]=function(){return this.entries()},Zt.prototype.toString=function(){return"[object FormData]"},ut&&!ut.matches&&(ut.matches=ut.matchesSelector||ut.mozMatchesSelector||ut.msMatchesSelector||ut.oMatchesSelector||ut.webkitMatchesSelector||function(Z){for(var se=(Z=(this.document||this.ownerDocument).querySelectorAll(Z)).length;0<=--se&&Z.item(se)!==this;);return-1<se}),Nt&&(Zt.prototype[Nt]="FormData"),X){var aa=te.XMLHttpRequest.prototype.setRequestHeader;te.XMLHttpRequest.prototype.setRequestHeader=function(Z,se){aa.call(this,Z,se),"content-type"===Z.toLowerCase()&&(this.B=!0)},te.XMLHttpRequest.prototype.send=function(Z){Z instanceof Zt?(Z=Z._blob(),this.B||this.setRequestHeader("Content-Type",Z.type),X.call(this,Z)):X.call(this,Z)}}Ce&&(te.fetch=function(Z,se){return se&&se.body&&se.body instanceof Zt&&(se.body=se.body._blob()),Ce.call(this,Z,se)}),Re&&(te.navigator.sendBeacon=function(Z,se){return se instanceof Zt&&(se=se._asNative()),Re.call(this,Z,se)}),te.FormData=Zt}}();const Ev=()=>{const r=B("AREAS");return 0===r.length&&r.push(mt.GLOBAL),Ue(r).call(r,(i,o,a)=>{const l=g2(o);return l?0===a?l:"".concat(i,",").concat(l):i},"")},g2=r=>r===mt.OVERSEA?"".concat(zr.ASIA,",").concat(zr.EUROPE,",").concat(zr.AFRICA,",").concat(zr.NORTH_AMERICA,",").concat(zr.SOUTH_AMERICA,",").concat(zr.OCEANIA):zr[r],sH=r=>{const i={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return r.map(o=>{const a=V_[o],l=Object.keys(a);l&&l.map(d=>{"CODE"!==d&&(i[d]=i[d].concat(a[d]))})}),i},sC={GLOBAL:{ASIA:[mt.CHINA,mt.JAPAN,mt.INDIA,mt.KOREA,mt.HKMC],EUROPE:[],NORTH_AMERICA:[mt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},yv=Object.keys(sC[mt.GLOBAL]),cD=[mt.CHINA,mt.NORTH_AMERICA,mt.EUROPE,mt.ASIA,mt.JAPAN,mt.INDIA,mt.OCEANIA,mt.SOUTH_AMERICA,mt.AFRICA,mt.KOREA,mt.HKMC,mt.US],_2=function(r,i){let o=[];if(he(r).call(r,mt.GLOBAL)){const d=[mt.GLOBAL,mt.OVERSEA],h=Object.keys(V_);if(i===mt.GLOBAL)throw new K(k.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(i===mt.CHINA)o=[mt.OVERSEA];else if(l=i,he(yv).call(yv,l)){const f=sC[mt.GLOBAL][i]||[],m=[...d,i,...f];o=h.filter(g=>!he(m).call(m,g))}else if(function(f){let m=!1;return yv.forEach(g=>{var v;he(v=sC[mt.GLOBAL][g]).call(v,f)&&(m=!0)}),m}(i)){const f=function(g){let v;return yv.forEach(y=>{var b;he(b=sC[mt.GLOBAL][y]).call(b,g)&&(v=y)}),v}(i),m=[...d,f,i];o=h.filter(g=>!he(m).call(m,g))}else o=r;o=function(f){const m=[];return cD.forEach(g=>{he(f).call(f,g)&&m.push(g)}),m.concat(f.filter(g=>!he(cD).call(cD,g)))}(o)}else o=r;var l;return o};function bv(r){var i,o;if(!r&&he(i=B("AREAS")).call(i,mt.EXTENSIONS))return T.debug("update area from ap : reset"),void Nh(PR,!0);if(!he(o=B("AREAS")).call(o,mt.GLOBAL)||!r)return;let a=V_.EXTENSIONS;a&&(a={CODE:g2(mt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(r,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(r,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(r,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(r,".agora.io"),"cds-ap-web-2-".concat(r,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(r,".agora.io"),"sua-ap-web-2-".concat(r,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(r,".agora.io"),"uap-ap-web-2-".concat(r,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(r,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(r,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(r,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(r,".agora.io")]},T.debug("update area from ap success: ".concat(r,",config is "),a),kt("AREAS",[mt.EXTENSIONS],!0),Object.keys(a).map(l=>{kt(l,"LOG_UPLOAD_SERVER"===l||"EVENT_REPORT_DOMAIN"===l||"EVENT_REPORT_BACKUP_DOMAIN"===l||"PROXY_SERVER_TYPE3"===l?a[l][0]:a[l])}))}function Nh(r){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=be.reportApiInvoke(null,{name:Yn.SET_AREA,options:r,tag:st.TRACER});try{let a=[];if("string"==typeof r&&(a=[r]),Array.isArray(r)&&(r.forEach(d=>{if(!he(HR).call(HR,d))throw new K(k.INVALID_PARAMS,"invalid area code")}),a=r),"[object Object]"===Object.prototype.toString.call(r)){const{areaCode:d,excludedArea:h}=r;if(!d)throw new K(k.INVALID_PARAMS,"area code is needed");let f=d;"string"==typeof d&&(f=[d]),a=h?_2(f,h):f}if(!i){if(Od.AREAS){const d=new K(k.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return o.onError(d),void T.warning("setArea is prohibited because of config-distribute")}if(he(a).call(a,mt.GLOBAL)&&B("AREAS")===mt.EXTENSIONS){const d=new K(k.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return o.onError(d),void T.warning("setArea is prohibited because of ap extensions")}}kt("AREAS",a,i);const l=sH(a);Object.keys(l).map(d=>{kt(d,"LOG_UPLOAD_SERVER"===d||"EVENT_REPORT_DOMAIN"===d||"EVENT_REPORT_BACKUP_DOMAIN"===d||"PROXY_SERVER_TYPE3"===d?l[d][0]:l[d])}),T.debug("set area success:",a.join(","))}catch(a){throw o.onError(a),a}o.onSuccess()}function v2(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function aC(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?v2(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):v2(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}let Sv=1;let lD=1;function cC(r,i,o,a){let{url:l,areaCode:d}=r;const{clientId:h,sid:f}=i,m=Date.now();let g;const[v,y]=hD(i,d,[jn.CHOOSE_SERVER]);let b=Se.networkState;return rs(L(function*(){b&&Se.networkState===so.OFFLINE&&Se.onlineWaiter&&(yield le.race([Se.onlineWaiter,wr(a&&a.maxRetryTimeout||Nn.maxRetryTimeout)])),b=Se.networkState;const{data:C,headers:P}=yield ta(l,{data:v,cancelToken:o,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);g="1"===P.http3?1:-1,be.reportResourceTiming(l,f),b2(C,l,i,m,[jn.CHOOSE_SERVER],g);const R=DS(C,jn.CHOOSE_SERVER);return dD(R),AS(R,l)}),C=>(C&&be.joinChooseServer(f,{lts:m,succ:!0,csAddr:l,opid:y,serverList:C.gatewayAddrs.map(P=>P.address),ec:null,cid:C.cid.toString(),uid:C.uid.toString(),csIp:C.csIp,unilbsServerIds:[jn.CHOOSE_SERVER].toString(),isHttp3:g,corssRegionTagReq:i.apRequestDetail,corssRegionTagRes:C.res.detail&&C.res.detail[38]}),!1),C=>C.code!==k.OPERATION_ABORTED&&(C.code===k.CAN_NOT_GET_GATEWAY_SERVER?C.data.retry:(be.joinChooseServer(f,{lts:m,succ:!1,csAddr:l,serverList:null,opid:y,ec:C.code,csIp:C.data&&C.data.csIp,unilbsServerIds:[jn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:b}),isHttp3:g,corssRegionTagReq:i.apRequestDetail}),T.warning("[".concat(h||"sid-".concat(f.slice(0,6)),"] Choose server network error, retry"),C),!0)),a)}function y2(r,i,o,a){let l,{url:d,areaCode:h,serviceIds:f}=r;const m=Date.now(),[g,v]=hD(i,h,f);let y;return rs(L(function*(){y&&Se.networkState===so.OFFLINE&&Se.onlineWaiter&&(yield le.race([Se.onlineWaiter,wr(a&&a.maxRetryTimeout||Nn.maxRetryTimeout)])),y=Se.networkState;const{data:b,headers:C}=yield ta(d,{data:g,cancelToken:o,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l="1"===C.http3?1:-1,be.reportResourceTiming(d,i.sid),b2(b,d,i,m,f,l);const P=DS(b,jn.CHOOSE_SERVER),R=DS(b,"proxy5"===i.cloudProxyServer?jn.CLOUD_PROXY_5:"proxy3"===i.cloudProxyServer||"proxy4"===i.cloudProxyServer?jn.CLOUD_PROXY:jn.CLOUD_PROXY_FALLBACK);return dD(P),{gatewayInfo:AS(P,d),proxyInfo:R,url:d}}),b=>(b.gatewayInfo&&be.joinChooseServer(i.sid,{lts:m,succ:!0,csAddr:d,serverList:b.gatewayInfo.gatewayAddrs.map(C=>C.address),ec:null,opid:v,cid:b.gatewayInfo.cid.toString(),uid:b.gatewayInfo.uid.toString(),csIp:b.gatewayInfo.csIp,unilbsServerIds:f.toString(),isHttp3:l,corssRegionTagReq:i.apRequestDetail,corssRegionTagRes:b.gatewayInfo.res.detail&&b.gatewayInfo.res.detail[38]}),b.proxyInfo&&be.joinWebProxyAP(i.sid,{lts:m,sucess:1,apServerAddr:d,turnServerAddrList:b.proxyInfo.addresses.map(C=>C.ip).join(","),errorCode:null,eventType:i.cloudProxyServer,unilbsServerIds:f.toString()}),!1),b=>b.code!==k.OPERATION_ABORTED&&(b.code===k.CAN_NOT_GET_GATEWAY_SERVER?b.data.retry:(be.joinWebProxyAP(i.sid,{lts:m,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:b.code,eventType:i.cloudProxyServer,unilbsServerIds:f.toString(),extend:JSON.stringify({networkState:y})}),T.warning("[".concat(i.clientId,"] multi unilbs network error, retry"),b),!0)),a)}const b2=(r,i,o,a,l,d)=>{const{sid:h,clientId:f,cloudProxyServer:m}=o,g=[],v=y=>{4096===y.flag?be.joinChooseServer(h,{lts:a,succ:!1,csAddr:i,opid:r.opid,serverList:null,ec:y.error.message,csIp:y.error.data&&y.error.data.csIp,unilbsServerIds:l.toString(),isHttp3:d,corssRegionTagReq:o.apRequestDetail}):1048576!==y.flag&&4194304!==y.flag&&4194310!==y.flag||be.joinWebProxyAP(h,{lts:a,sucess:0,apServerAddr:i,turnServerAddrList:null,errorCode:y.error.code,eventType:m,unilbsServerIds:l.toString()})};if(r.response_body.forEach(y=>{const b=y.buffer.code;if(23===y.uri&&0===b&&!y.buffer.edges_services)if(4194310===y.buffer.flag)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),y.buffer.edges_services=[];else{const C={error:new K(k.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:r.detail[502]}),flag:y.buffer.flag};g.push(C),v(C)}if(0!==b){const C=Pf(b),P={error:new K(k.CAN_NOT_GET_GATEWAY_SERVER,C.desc,{desc:C.desc,retry:C.retry,csIp:r.detail[502]}),flag:y.buffer.flag};4194310===y.buffer.flag?T.warning(P.error.toString()):g.push(P),v(P)}}),g.length)throw T.warning("[".concat(f||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(i," failed, ").concat(g.map(y=>"flag: ".concat(y.flag,", message: ").concat(y.error.message,", retry: ").concat(y.error.data.retry)).join(" | "))),new K(k.CAN_NOT_GET_GATEWAY_SERVER,g.map(y=>"flag: ".concat(y.flag,", message: ").concat(y.error.message)).join(" | "),{retry:!!g.find(y=>y.error.data.retry),csIp:r.detail[502],desc:[...new Set(g.map(y=>{var b;return null==y||null===(b=y.error)||void 0===b||null===(b=b.data)||void 0===b?void 0:b.desc}).filter(y=>!!y))]})},dD=r=>{var i,o,a,l;if(r.addresses&&0===r.addresses.length&&0===r.code)throw new K(k.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:r.detail&&r.detail[502]});if(B("AP_AREA")&&(null!==(a=r.detail)&&void 0!==a&&a[23]&&"string"==typeof(null===(l=r.detail)||void 0===l?void 0:l[23])?bv(r.detail[23].toLowerCase()):bv()),null!==(i=r.detail)&&void 0!==i&&i[19]&&"string"==typeof(null===(o=r.detail)||void 0===o?void 0:o[19])){const h=r.detail[19],f=h?.split(";");for(let m=0;m<f.length;m++){var d;const g=vi(d=f[m]).call(d);r.addresses[m]&&f&&(r.addresses[m].fingerprint=g)}}if(B("GATEWAY_ADDRESS")&&B("GATEWAY_ADDRESS").length>0){T.debug("assign gateway address to",B("GATEWAY_ADDRESS"));const h=B("GATEWAY_ADDRESS").map(f=>{var m,g;const v=null!==(m=null===(g=r.addresses.find(y=>y.ip===f.ip&&y.port===f.port))||void 0===g?void 0:g.fingerprint)&&void 0!==m?m:"";return{ip:f.ip,port:f.port,ticket:r.addresses[0]&&r.addresses[0].ticket,fingerprint:v}});r.addresses=h}},uD=(r,i)=>{if(r.response_body&&r.response_body.length){const o=r.response_body[0];if(0!==o.buffer.code){const a=Pf(o.buffer.code);throw new K(k.UPDATE_TICKET_FAILED,"[".concat(o.buffer.code,"]: ").concat(a.desc),{retry:a.retry})}return o.buffer.ticket}throw T.debug("update ticket request received ap response without response body:",i),new K(k.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},hD=(r,i,o)=>{const a=Math.floor(1e12*Math.random()),l={appid:r.appId,client_ts:Date.now(),opid:a,sid:r.sid,request_bodies:[{uri:22,buffer:{cname:r.cname,detail:aC(aC({6:r.stringUid,11:i,12:B("USE_NEW_TOKEN")?"1":void 0,22:i},r.apRequestDetail?{33:r.apRequestDetail}:{}),r.apRTM?{26:"RTM2"}:{}),key:r.token,service_ids:o,uid:r.uid||0}}]};l.request_bodies.forEach(h=>{r.multiIP&&r.multiIP.gateway_ip&&(h.buffer.detail[5]=JSON.stringify({vocs_ip:[r.multiIP.uni_lbs_ip],vos_ip:[r.multiIP.gateway_ip]}))});const d=new FormData;return d.append("request",JSON.stringify(l)),[d,a]},aH=(r,i)=>{const o=Math.floor(1e12*Math.random()),a={appid:r.appId,client_ts:Date.now(),opid:o,sid:r.sid,request_bodies:[{uri:28,buffer:{cname:r.cname,detail:{1:"",6:r.stringUid,12:"1"},token:r.token,service_ids:i,uid:r.uid||0,edges_services:r.apResponse.addresses.map(d=>({ip:d.ip,port:d.port}))}}]},l=new FormData;return l.append("request",JSON.stringify(a)),[l,o]};let Yf=0;function Wd(r){return le.all(r.map(i=>i.then(o=>{throw o},o=>o))).then(i=>{throw i},i=>i)}const Ph=function(){var r=L(function*(i){let{fragementLength:o,referenceList:a,asyncMapHandler:l,allFailedhandler:d,promisesCollector:h}=i,f=0;const m=o;let g,v=0;const y=function(){var b=L(function*(){const C=(()=>{const P=f*m;return a.slice(P,P+m).map(l)})();h&&h.push(...C);try{g=yield Wd(C)}catch(P){if(v+=m,f++,!(v>=a.length))return void(yield y());d(P)}C.forEach(P=>P.cancel())});return function(){return b.apply(this,arguments)}}();return yield y(),g});return function(o){return r.apply(this,arguments)}}(),pD=function(){var r=L(function*(i){let{referenceList:o,asyncMapHandler:a,closeFn:l}=i;const d=o.length;let h=0;const f=function(){var m=L(function*(){const g=a(o.shift());try{return yield g}catch(v){if(h++,h>=d||null!=l&&l(v))throw v;return f()}});return function(){return m.apply(this,arguments)}}();return f()});return function(o){return r.apply(this,arguments)}}();function fD(r,i,o,a){return S2.apply(this,arguments)}function S2(){return S2=L(function*(r,i,o,a){return{gatewayInfo:yield(d=L(function*(h,f,m,g){let v=null;const y=[],b=function(){var P=L(function*(){const R=B("WEBCS_DOMAIN").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(M=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(M+"/api/v2/transpond/webrtc?v=2"):"https://".concat(M,"/api/v2/transpond/webrtc?v=2"),areaCode:Ev()})),A=g.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(M=>M.url)}),O=yield Ph({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:M=>(T.debug("[".concat(h.clientId,"] Connect to choose_server:"),M.url),cC(M,h,f,m)),allFailedhandler:M=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},A),M[0]},promisesCollector:y});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},A),O});return function(){return P.apply(this,arguments)}}(),C=function(){var P=L(function*(){if(yield wr(1e3),null!==v)return v;const R=B("WEBCS_DOMAIN_BACKUP_LIST").map(M=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(M+"/api/v2/transpond/webrtc?v=2"):"https://".concat(M,"/api/v2/transpond/webrtc?v=2"),areaCode:Ev()})),A=g.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(M=>M.url)}),O=yield Ph({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:M=>(T.debug("[".concat(h.clientId,"] Connect to backup choose_server:"),M.url),cC(M,h,f,m)),allFailedhandler:M=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},A),M[0]},promisesCollector:y});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},A),O});return function(){return P.apply(this,arguments)}}();try{return v=yield Wd([b(),C()]),y.length&&y.forEach(P=>P.cancel&&"function"==typeof P.cancel&&P.cancel()),v}catch(P){throw P[0]}}),function(h,f,m,g){return d.apply(this,arguments)})(r,i,o,a)};var d}),S2.apply(this,arguments)}function C2(r,i,o,a,l){return Cv.apply(this,arguments)}function Cv(){return Cv=L(function*(r,i,o,a,l){const d=r.cloudProxyServer;if("disabled"===d){if(!a)return;if(r.useLocalAccessPoint)return yield fD(r,i,o,l);if(B("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:b,proxyInfo:C}=yield dC(r,i,o,l);if(r.turnServer&&"auto"!==r.turnServer.mode)return{gatewayInfo:b};const P=C.map(R=>({turnServerURL:R.address,tcpport:R.tcpport||Wr.tcpport,udpport:R.udpport||Wr.udpport,username:R.username||Wr.username,password:R.password||Wr.password,forceturn:!1,security:!0}));if(l.useP2P){var h;const R=null!==(h=r.uid)&&void 0!==h?h:b.uid,A="glb:".concat(R.toString()),O=yield ER(A),M=C.map(x=>({turnServerURL:x.address,tcpport:x.tcpport||Wr.tcpport,udpport:x.udpport||Wr.udpport,username:A,password:O,forceturn:!1,security:!0}));P.push(...M)}return r.turnServer={mode:"manual",servers:P},{gatewayInfo:b}}return yield fD(r,i,o,l)}const{proxyInfo:f,gatewayInfo:m}=yield dC(r,i,o,l),g={gatewayInfo:m},v=f.map(b=>({turnServerURL:b.address,tcpport:"proxy3"===d?void 0:b.tcpport?b.tcpport:Wr.tcpport,udpport:"proxy4"===d?void 0:b.udpport?b.udpport:Wr.udpport,username:b.username||Wr.username,password:b.password||Wr.password,forceturn:"proxy4"!==d,security:"proxy5"===d}));if(l.useP2P){var y;const b=null!==(y=r.uid)&&void 0!==y?y:m.uid,C="glb:".concat(b.toString()),P=yield ER(C),R=f.map(A=>({turnServerURL:A.address,tcpport:"proxy3"===d?void 0:A.tcpport||Wr.tcpport,udpport:"proxy4"===d?void 0:A.udpport||Wr.udpport,username:C,password:P,forceturn:"proxy4"!==d,security:"proxy5"===d}));v.push(...R)}return r.turnServer={mode:"manual",servers:v},T.debug("[".concat(r.clientId,"] set proxy server: ").concat(r.proxyServer,", mode: ").concat(d)),g}),Cv.apply(this,arguments)}function mD(r,i,o,a,l){return Tv.apply(this,arguments)}function Tv(){return Tv=L(function*(r,i,o,a,l){let h=[];h=B("ACCOUNT_REGISTER").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(i.proxyServer?m=>"https://".concat(i.proxyServer,"/ap/?url=").concat(m+"/api/v1"):m=>"https://".concat(m,"/api/v1"));const f=l?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const m=yield(g=L(function*(v,y,b,C,P){const R=Date.now(),A={sid:b.sid,opid:10,appid:b.appId,string_uid:y};let O=v[0];const M=yield rs(()=>ta(O+"".concat(-1===O.indexOf("?")?"?":"&","action=stringuid"),{data:A,cancelToken:C,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(x,j)=>{if(0===x.code){if(x.uid<=0||x.uid>=Math.pow(2,32))throw T.error("Invalid Uint Uid ".concat(y," => ").concat(x.uid),x),be.reqUserAccount(A.sid,{lts:R,success:!1,serverAddr:O,stringUid:A.string_uid,uid:x.uid,errorCode:k.INVALID_UINT_UID_FROM_STRING_UID,extend:A}),new K(k.INVALID_UINT_UID_FROM_STRING_UID);return be.reqUserAccount(A.sid,{lts:R,success:!0,serverAddr:O,stringUid:A.string_uid,uid:x.uid,errorCode:null,extend:A}),!1}const W=Pf(x.code);return W.retry&&(O=v[(j+1)%v.length]),be.reqUserAccount(A.sid,{lts:R,success:!1,serverAddr:O,stringUid:A.string_uid,uid:x.uid,errorCode:W.desc,extend:A}),W.retry},(x,j)=>x.code!==k.OPERATION_ABORTED&&(be.reqUserAccount(A.sid,{lts:R,success:!1,serverAddr:O,stringUid:A.string_uid,uid:null,errorCode:x.code,extend:A}),O=v[(j+1)%v.length],!0),P);if(0!==M.code){const x=Pf(M.code);throw new K(k.UNEXPECTED_RESPONSE,x.desc)}return M}),function(v,y,b,C,P){return g.apply(this,arguments)})(h,r,i,o,a);return l?.recordJoinChannelService({status:"success",endTs:Date.now()},f),m.uid}catch(m){throw l?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[m]},f),m}var g}),Tv.apply(this,arguments)}function cH(r,i,o){return lC.apply(this,arguments)}function lC(){return lC=L(function*(r,i,o){let l=[];l=B("ACCOUNT_REGISTER").map(i.proxyServer?d=>"https://".concat(i.proxyServer,"/ap/?url=").concat(d+"/api/v1"):d=>"https://".concat(d,"/api/v1"));try{return yield pD({referenceList:l,asyncMapHandler:h=>{return(f=L(function*(m,g,v,y){const b=Date.now(),C={sid:v.sid,opid:10,appid:v.appId,string_uid:g};try{const P=yield ta(m+"".concat(-1===m.indexOf("?")?"?":"&","action=stringuid"),{data:C,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(0!==P.code){const R=Pf(P.code);throw new K(k.UNEXPECTED_RESPONSE,"preload sua error:".concat(R.desc),R)}if(P.uid<=0||P.uid>=Math.pow(2,32))throw new K(k.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:b,url:m,req:C,uid:P.uid,elapse:Date.now()-b}}catch(P){throw P}}),function(m,g,v,y){return f.apply(this,arguments)})(h,r,i,o);var f},closeFn:h=>h.code===k.OPERATION_ABORTED||h.code===k.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(d){throw d}}),lC.apply(this,arguments)}function gD(){return gD=L(function*(r,i,o){const l=B("CDS_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(m=>r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(m+"/api/v1"):"https://".concat(m,"/api/v1?action=config")).map(m=>function(g,v,y,b){const C=ot(),P={flag:64,cipher_method:0,features:{device:C.name,system:C.os,system_general:navigator.userAgent,vendor:v.appId,version:Ss,cname:v.cname,sid:v.sid,session_id:v.sid,detail:"",proxyServer:v.proxyServer}};return rs(()=>ta(g,{data:P,timeout:1e3,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,R=>R.code!==k.OPERATION_ABORTED,b)}(m,r,i,o));let d=null,h=null,f={};try{d=yield Wd(l)}catch(m){if(m.code===k.OPERATION_ABORTED)throw m;h=m}if(l.forEach(m=>m.cancel()),be.reportApiInvoke(r.sid,{name:Yn.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:d}}).onSuccess(),d&&d.test_tags)try{f=function(m){if(!m.test_tags)return{};const g=m.test_tags,v=Object.keys(g),y={};return v.forEach(b=>{var C;const P=vi(C=b.slice(4)).call(C),R=JSON.parse(g[b])[1];y[P]=R}),y}(d)}catch{}return f}),gD.apply(this,arguments)}function _D(r,i){return T2.apply(this,arguments)}function T2(){return T2=L(function*(r,i){const o=B("WEBCS_DOMAIN").concat(B("WEBCS_DOMAIN_BACKUP_LIST")).map(a=>({url:"https://".concat(a,"/api/v2/transpond/webrtc?v=2"),areaCode:Ev(),serviceIds:[jn.CHOOSE_SERVER,jn.CLOUD_PROXY_FALLBACK]}));try{return yield pD({referenceList:o,asyncMapHandler:l=>{return(d=L(function*(h,f,m){let g,{url:v,areaCode:y,serviceIds:b}=h;const C=Date.now(),[P,R]=hD(f,y,b);let A=Se.networkState;try{A&&Se.networkState===so.OFFLINE&&Se.onlineWaiter&&(yield le.race([Se.onlineWaiter,wr(Nn.maxRetryTimeout)])),A=Se.networkState;const{data:O,headers:M}=yield ta(v,{data:P,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);g="1"===M.http3?1:-1,(q=>{const te=[];if(q.response_body.forEach(J=>{const X=J.buffer.code;if(23===J.uri&&0===X&&!J.buffer.edges_services)if(4194310===J.buffer.flag)J.buffer.edges_services=[];else{const Ce={error:new K(k.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:q.detail[502]}),flag:J.buffer.flag};te.push(Ce)}if(0!==X){const Ce=Pf(X),Re={error:new K(k.CAN_NOT_GET_GATEWAY_SERVER,Ce.desc,{desc:Ce.desc,retry:Ce.retry,csIp:q.detail[502]}),flag:J.buffer.flag};4194310===J.buffer.flag?T.warning(Re.error.toString()):te.push(Re)}}),te.length)throw new K(k.CAN_NOT_GET_GATEWAY_SERVER,te.map(J=>"flag: ".concat(J.flag,", message: ").concat(J.error.message)).join(" | "),{retry:!!te.find(J=>J.error.data.retry),csIp:q.detail[502],desc:[...new Set(te.map(J=>{var X;return null==J||null===(X=J.error)||void 0===X||null===(X=X.data)||void 0===X?void 0:X.desc}).filter(J=>!!J))]})})(O);const j=DS(O,jn.CHOOSE_SERVER),W=DS(O,jn.CLOUD_PROXY_FALLBACK);return dD(j),{gatewayInfo:AS(j,v),proxyInfo:W,opid:R,requestTime:C,url:v,isHttp3:g,elapse:Date.now()-C}}catch(O){throw O}}),function(h,f,m){return d.apply(this,arguments)})(l,r,i);var d},closeFn:l=>l.code===k.OPERATION_ABORTED||l.code===k.CAN_NOT_GET_GATEWAY_SERVER&&!l.data.retry})}catch(a){throw a}}),T2.apply(this,arguments)}function dC(r,i,o,a){return vD.apply(this,arguments)}function vD(){return vD=L(function*(r,i,o,a){const l=B("PROXY_SERVER_TYPE3"),d=(C,P,R)=>{let A=R||l;return Array.isArray(A)&&(A=P%2==0?l[1]:l[0]),"https://".concat(A,"/ap/?url=").concat(C)};let h=null;const f=[],m=function(){var C=L(function*(){const P=B("WEBCS_DOMAIN").slice(0,B("AJAX_REQUEST_CONCURRENT")).map((O,M)=>{let x;return x="disabled"===r.cloudProxyServer&&r.proxyServer?d("".concat(O,"/api/v2/transpond/webrtc?v=2"),M,r.proxyServer):"disabled"===r.cloudProxyServer||"fallback"===r.cloudProxyServer?"https://".concat(O,"/api/v2/transpond/webrtc?v=2"):d("".concat(O,"/api/v2/transpond/webrtc?v=2"),M),{url:x,areaCode:Ev(),serviceIds:[jn.CHOOSE_SERVER,"proxy5"===r.cloudProxyServer?jn.CLOUD_PROXY_5:"proxy3"===r.cloudProxyServer||"proxy4"===r.cloudProxyServer?jn.CLOUD_PROXY:jn.CLOUD_PROXY_FALLBACK]}}),R=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(O=>O.url)}),A=yield Ph({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:O=>(T.debug("[".concat(r.clientId,"] Connect to choose_server:"),O.url),y2(O,r,i,o)),allFailedhandler:O=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},R),O[0]},promisesCollector:f});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},R),A});return function(){return C.apply(this,arguments)}}(),g=function(){var C=L(function*(){if(yield wr(1e3),null!==h)return h;const P=B("WEBCS_DOMAIN_BACKUP_LIST").map((O,M)=>{let x;return x="disabled"===r.cloudProxyServer&&r.proxyServer?d("".concat(O,"/api/v2/transpond/webrtc?v=2"),M,r.proxyServer):"disabled"===r.cloudProxyServer||"fallback"===r.cloudProxyServer?"https://".concat(O,"/api/v2/transpond/webrtc?v=2"):d("".concat(O,"/api/v2/transpond/webrtc?v=2"),M),{url:x,areaCode:Ev(),serviceIds:[jn.CHOOSE_SERVER,"proxy5"===r.cloudProxyServer?jn.CLOUD_PROXY_5:"proxy3"===r.cloudProxyServer||"proxy4"===r.cloudProxyServer?jn.CLOUD_PROXY:jn.CLOUD_PROXY_FALLBACK]}}),R=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(O=>O.url)}),A=yield Ph({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:O=>(T.debug("[".concat(r.clientId,"] Connect to backup choose_server:"),O.url),y2(O,r,i,o)),allFailedhandler:O=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},R),O[0]},promisesCollector:f});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},R),A});return function(){return C.apply(this,arguments)}}();let v,y,b;try{({gatewayInfo:v,proxyInfo:y,url:b}=yield Wd([m(),g()]))}catch(C){throw C[0]}if(f.length&&f.forEach(C=>C.cancel&&"function"==typeof C.cancel&&C.cancel()),!v||!y)throw new K(k.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(r.apUrl=b,"disabled"!==r.cloudProxyServer&&Array.isArray(l)&&b){const C=/^https?:\/\/(.+?)(\/.*)?$/.exec(b)[1];he(l).call(l,C)&&(r.proxyServer=C,T.setProxyServer(C),be.setProxyServer(C))}return h={gatewayInfo:v,proxyInfo:yield W_(y,v.uid)},h}),vD.apply(this,arguments)}function wv(){return wv=L(function*(r,i,o){const l=B("UAP_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(d=>r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap")).map(d=>function(h,f,m,g){const v={command:"convergeAllocateEdge",sid:f.sid,appId:f.appId,token:f.token,ts:Date.now(),version:Ss,cname:f.cname,uid:f.uid.toString(),requestId:lD,seq:lD};lD+=1;const y={service_name:"tele_channel",json_body:JSON.stringify(v)};return rs(L(function*(){const b=yield ta(h,{data:y,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==b.code){const P=new K(k.UNEXPECTED_RESPONSE,"cross channel ap error, code"+b.code,{retry:!0});throw T.error(P.toString()),P}const C=JSON.parse(b.json_body);if(200!==C.code){const P=new K(k.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(C.code,", reason: ").concat(C.reason));throw T.error(P.toString()),P}if(!C.servers||0===C.servers.length){const P=new K(k.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw T.error(P.toString()),P}return{vid:C.vid,workerToken:C.workerToken,addressList:(B("CHANNEL_MEDIA_RELAY_SERVERS")||C.servers).map(P=>"wss://".concat(P.address.replace(/\./g,"-"),".").concat(B("WORKER_DOMAIN"),":").concat(P.wss))}}),void 0,b=>!!(b.code!==k.OPERATION_ABORTED&&b.code!==k.UNEXPECTED_RESPONSE||b.data&&b.data.retry),g)}(d,r,i,o));try{const d=yield Wd(l);return l.forEach(h=>h.cancel()),d}catch(d){throw d[0]}}),wv.apply(this,arguments)}function yD(){return yD=L(function*(r,i,o){let a=null;const l=[],d=function(){var h=L(function*(f){const m=B(f?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(g=>r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(g+"/api/v2/transpond/webrtc?v=2"):"https://".concat(g,"/api/v2/transpond/webrtc?v=2"));return f&&(yield wr(1e3),null!==a)?a:yield Ph({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:g=>(T.debug("[".concat(r.clientId,"] update ticket, Connect to ").concat(f?"backup":""," choose_server:"),g),function(v,y,b,C){const[P]=aH(y,[jn.CHOOSE_SERVER]);let R=Se.networkState;return rs(L(function*(){R&&Se.networkState===so.OFFLINE&&Se.onlineWaiter&&(yield le.race([Se.onlineWaiter,wr(C&&C.maxRetryTimeout||Nn.maxRetryTimeout)])),R=Se.networkState;const A=yield ta(v,{data:P,cancelToken:b,headers:{"Content-Type":"multipart/form-data;"}},!0);return uD(A,v)}),()=>!1,A=>A.code!==k.OPERATION_ABORTED&&(A.code===k.UPDATE_TICKET_FAILED?A.data.retry:(T.warning("[".concat(y.clientId,"] update ticket network error, retry"),A),!0)),C)}(g,r,i,o)),allFailedhandler:g=>{throw g[0]},promisesCollector:l})});return function(m){return h.apply(this,arguments)}}();try{return a=yield Wd([d(!1),d(!0)]),l.length&&l.forEach(h=>h.cancel&&"function"==typeof h.cancel&&h.cancel()),a}catch(h){throw h[0]}}),yD.apply(this,arguments)}function I2(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function dH(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?I2(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):I2(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}class wz extends nn{get isSuccess(){return!!this.configs}constructor(i){super(),N(this,"configs",void 0),N(this,"joinInfo",void 0),N(this,"cancelToken",void 0),N(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),N(this,"interval",void 0),N(this,"mutex",void 0),N(this,"mutableParamsRead",!1),this.mutex=new Qr("config-distribute",i)}startGetConfigDistribute(i,o){this.joinInfo=i,this.cancelToken=o,this.interval&&this.stopGetConfigDistribute(),B("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},B("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}awaitConfigDistributeComplete(){var i=this;return L(function*(){i.mutex.isLocked&&(yield i.mutex.lock())()})()}updateConfigDistribute(){var i=this;return L(function*(){if(i.mutableParamsRead||(i.mutableParamsRead=!0,be.reportApiInvoke(null,{options:void 0,name:Yn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:st.TRACER}).onSuccess(JSON.stringify(Od))),!i.joinInfo||!i.cancelToken||!i.retryConfig)return void T.debug("[config-distribute] get config distribute interrupted have no joininfo");let o;const a=yield i.mutex.lock();try{o=yield function lH(r,i,o){return gD.apply(this,arguments)}(i.joinInfo,i.cancelToken,i.retryConfig),T.debug("[config-distribute] get config distribute",JSON.stringify(o)),o.limit_bitrate&&i.handleBitrateLimit(o.limit_bitrate),i.cacheGlobalParameterConfig(o),i.configs=o}catch(l){const d=new K(k.NETWORK_RESPONSE_ERROR,l);T.warning("[config-distribute] ".concat(d.toString()))}finally{a()}})()}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(i){var o;(o=i)&&o.uplink&&o.id&&void 0!==o.uplink.max_bitrate&&void 0!==o.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==i.id&&this.emit(IS.UPDATE_BITRATE_LIMIT,i):this.emit(IS.UPDATE_BITRATE_LIMIT,i))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&dH({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(i){var o;const a=md(o=Object.keys(i).filter(d=>/^webrtc_ng_global_parameter/.test(d))).call(o);for(let d=0;d<a.length;d++)for(let h=a.length-1;h>d;h--){const f=a[h];if("number"==typeof i[f].__priority){const g=a[h-1];if("number"==typeof i[g].__priority){if(!(i[f].__priority>i[g].__priority))continue;{const v=f;a[h]=a[h-1],a[h-1]=v}}else{const v=f;a[h]=a[h-1],a[h-1]=v}}}const l={};a.forEach(d=>{const h=i[d],f=h.__expires;Object.keys(h).forEach(m=>{"__priority"===m||"__expires"===m||Object.prototype.hasOwnProperty.call(l,m)||(l[m]=dH({value:h[m]},f&&{expires:f}))})});try{!function(f){try{const m=Date.now();Object.keys(f).forEach(g=>{switch(g){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(Pn,g)){const{value:v,expires:y}=f[g];if(y&&y<=m)return;Od[g]=v,Pn[g]=v,T.debug("Update global parameters from config distribute",g,v)}}})}catch(m){T.error("Error update config immediately: ".concat(f),m.message)}}(l);const d=JSON.stringify(l),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),T.debug("Caching global parameters ".concat(d))}catch(d){T.error("Error caching global parameters:",d.message)}}}class R2 extends nn{constructor(){super(...arguments),N(this,"resultStorage",new Map)}setLocalAudioStats(i,o,a){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",i,this.checkAudioInputLevel(a,o)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",i,this.checkSendAudioBitrate(a,o))}setLocalVideoStats(i,o,a){this.record("SEND_VIDEO_BITRATE_TOO_LOW",i,this.checkSendVideoBitrate(a,o)),this.record("FRAMERATE_INPUT_TOO_LOW",i,this.checkFramerateInput(a,o)),this.record("FRAMERATE_SENT_TOO_LOW",i,this.checkFramerateSent(a))}setRemoteAudioStats(i,o){const a=i.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",a,this.checkAudioOutputLevel(o))}setRemoteVideoStats(i,o){const a=i.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",a,this.checkVideoDecode(o))}record(i,o,a){if(B("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(i)||this.resultStorage.set(i,{result:[],isPrevNormal:!0});const l=this.resultStorage.get(i);if(l&&(l.result.push(a),l.result.length>=5)){var d;const h=he(d=l.result).call(d,!0);l.isPrevNormal&&!h&&this.emit("exception",A2[i],i,o),!l.isPrevNormal&&h&&this.emit("exception",A2[i]+2e3,i+"_RECOVER",o),l.isPrevNormal=h,l.result=[]}}checkAudioOutputLevel(i){return!(i.receiveBitrate>0&&0===i.receiveLevel)}checkAudioInputLevel(i,o){return o instanceof sr&&!o.isActive||!!o.muted||0!==i.sendVolumeLevel}checkFramerateInput(i,o){let a=null;o._encoderConfig&&o._encoderConfig.frameRate&&(a=Pi(o._encoderConfig.frameRate));const l=i.captureFrameRate;return!a||!l||!(a>10&&l<5||a<10&&a>=5&&l<=1)}checkFramerateSent(i){return!(i.captureFrameRate&&i.sendFrameRate&&i.captureFrameRate>5&&i.sendFrameRate<=1)}checkSendVideoBitrate(i,o){return!!o.muted||0!==i.sendBitrate}checkSendAudioBitrate(i,o){return o instanceof sr&&!o.isActive||!!o.muted||0!==i.sendBitrate}checkVideoDecode(i){return 0===i.receiveBitrate||0!==i.decodeFrameRate}}const A2={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},ti=new class{markSubscribeStart(r,i){performance.mark("agora-web-sdk/".concat(r,"/subscribe-").concat(i))}markPublishStart(r,i){performance.mark("agora-web-sdk/".concat(r,"/publish-").concat(i))}measureFromSubscribeStart(r,i){const o=performance.getEntriesByName("agora-web-sdk/".concat(r,"/subscribe-").concat(i));if(o.length>0){const a=o[o.length-1];return Math.round(performance.now()-a.startTime)}return 0}measureFromPublishStart(r,i){const o=performance.getEntriesByName("agora-web-sdk/".concat(r,"/publish-").concat(i));if(o.length>0){const a=o[o.length-1];return Math.round(performance.now()-a.startTime)}return 0}};var bD=Ht(Qi.Object.getOwnPropertySymbols),Iz=xt,Fa=UT.indexOf,uH=Bm,SD=ip([].indexOf),D2=!!SD&&1/SD([1],1,-0)<0;Iz({target:"Array",proto:!0,forced:D2||!uH("indexOf")},{indexOf:function(r){var i=arguments.length>1?arguments[1]:void 0;return D2?SD(this,r,i)||0:Fa(this,r,i)}});var hH=Di("Array").indexOf,CD=Ri,pH=hH,TD=Array.prototype,O2=Ht(function(r){var i=r.indexOf;return r===TD||CD(TD,r)&&i===TD.indexOf?pH:i});function na(r){if(Array.isArray(r))return r.map(o=>o);if(!N2(r))return r;const i={};for(const o in r){const a=r[o];i[o]=N2(a)||Array.isArray(a)?na(a):a}return i}function N2(r){return!("object"!=typeof r||Array.isArray(r)||!r)}class wD{constructor(i){N(this,"input",[]),N(this,"size",void 0),this.size=i}add(i){this.input.push(i),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const Dc={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Iv={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Dc,remoteCandidate:Dc},updateInterval:0},P2={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},M2={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},k2={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},L2={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function ID(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function x2(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?ID(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):ID(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}class RD{constructor(i,o){var a=this;N(this,"onFirstVideoReceived",void 0),N(this,"onFirstVideoDecoded",void 0),N(this,"onFirstAudioReceived",void 0),N(this,"onFirstVideoDecodedTimeout",void 0),N(this,"onFirstAudioDecoded",void 0),N(this,"onSelectedLocalCandidateChanged",void 0),N(this,"onSelectedRemoteCandidateChanged",void 0),N(this,"videoIsReady",!1),N(this,"videoIsReady2",{}),N(this,"pc",void 0),N(this,"options",void 0),N(this,"intervalTimer",void 0),N(this,"stats",na(Iv)),N(this,"isFirstVideoReceived",{}),N(this,"isFirstVideoDecoded",{}),N(this,"isFirstAudioReceived",{}),N(this,"isFirstAudioDecoded",{}),N(this,"isFirstVideoDecodedTimeout",{}),N(this,"lossRateWindowStats",[]),this.pc=i,this.options=o,this.intervalTimer=window.setInterval(L(function*(){a.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new le(i=>{i({local:x2({},Dc),remote:x2({},Dc)})})}setVideoIsReady(i){this.videoIsReady=i}setVideoIsReady2(i,o){this.videoIsReady2[i]=o}getVideoIsReady(i){return this.videoIsReady2[i]||!1}setIsFirstAudioDecoded(i){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(i){this.lossRateWindowStats.push(i),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const o=this.lossRateWindowStats.length,a=["videoSend","audioSend","videoRecv","audioRecv"];let l=0,d=0,h=0,f=0;for(const m of a)i[m].forEach((g,v)=>{if(!this.lossRateWindowStats[o-1][m][v]||!this.lossRateWindowStats[0][m][v])return;const y=this.lossRateWindowStats[o-1][m][v].packets-this.lossRateWindowStats[0][m][v].packets,b=this.lossRateWindowStats[o-1][m][v].packetsLost-this.lossRateWindowStats[0][m][v].packetsLost;"videoSend"===m||"audioSend"===m?(l+=y,h+=b):(d+=y,f+=b),g.packetLostRate=Number.isNaN(y)||Number.isNaN(y)||y<=0||b<=0?0:b/(y+b)});i.sendPacketLossRate=l<=0||h<=0?0:h/(l+h),i.recvPacketLossRate=d<=0||f<=0?0:f/(d+f)}}function F2(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function AD(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?F2(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):F2(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}class DD extends RD{constructor(){super(...arguments),N(this,"_stats",Iv),N(this,"lastDecodeVideoReceiverStats",new Map)}updateStats(){var i=this;return L(function*(){const o=yield i._getStats(),a=i.statsResponsesToObjects(o);i._stats=na(Iv);const l=a.filter(h=>"ssrc"===h.type);i.processSSRCStats(l);const d=a.find(h=>"VideoBwe"===h.type);d&&i.processBandwidthStats(d),i._stats.timestamp=Date.now(),i.calcLossRate(i._stats),i.stats=i._stats})()}processBandwidthStats(i){this._stats.bitrate={actualEncoded:Number(i.googActualEncBitrate),targetEncoded:Number(i.googTargetEncBitrate),retransmit:Number(i.googRetransmitBitrate),transmit:Number(i.googTransmitBitrate)},this._stats.sendBandwidth=Number(i.googAvailableSendBandwidth)}processSSRCStats(i){i.forEach(o=>{var a;const l=he(a=o.id).call(a,"send");switch("".concat(o.mediaType,"_").concat(l?"send":"recv")){case"video_send":{const d=na(M2);d.codec=o.googCodecName,d.adaptionChangeReason="none",o.googCpuLimitedResolution&&(d.adaptionChangeReason="cpu"),o.googBandwidthLimitedResolution&&(d.adaptionChangeReason="bandwidth"),d.avgEncodeMs=Number(o.googAvgEncodeMs),d.inputFrame={width:Number(o.googFrameWidthInput)||Number(o.googFrameWidthSent),height:Number(o.googFrameHeightInput)||Number(o.googFrameHeightSent),frameRate:Number(o.googFrameRateInput)},d.sentFrame={width:Number(o.googFrameWidthSent),height:Number(o.googFrameHeightSent),frameRate:Number(o.googFrameRateInput)},d.firsCount=Number(o.googFirReceived),d.nacksCount=Number(o.googNacksReceived),d.plisCount=Number(o.googPlisReceived),d.frameCount=Number(o.framesEncoded),d.bytes=Number(o.bytesSent),d.packets=Number(o.packetsSent),d.packetsLost=Number(o.packetsLost),d.ssrc=Number(o.ssrc),d.rttMs=Number(o.googRtt||0),this._stats.videoSend.push(d),this._stats.rtt=d.rttMs;break}case"video_recv":{const d=na(P2),h=this.lastDecodeVideoReceiverStats.get(Number(o.ssrc));if(d.codec=o.googCodecName,d.targetDelayMs=Number(o.googTargetDelayMs),d.renderDelayMs=Number(o.googRenderDelayMs),d.currentDelayMs=Number(o.googCurrentDelayMs),d.minPlayoutDelayMs=Number(o.googMinPlayoutDelayMs),d.decodeMs=Number(o.googDecodeMs),d.maxDecodeMs=Number(o.googMaxDecodeMs),d.receivedFrame={width:Number(o.googFrameWidthReceived),height:Number(o.googFrameHeightReceived),frameRate:Number(o.googFrameRateReceived)},d.decodedFrame={width:Number(o.googFrameWidthReceived),height:Number(o.googFrameHeightReceived),frameRate:Number(o.googFrameRateDecoded)},d.decodeFrameRate=Number(o.googFrameRateDecoded),d.outputFrame={width:Number(o.googFrameWidthReceived),height:Number(o.googFrameHeightReceived),frameRate:Number(o.googFrameRateOutput)},d.jitterBufferMs=Number(o.googJitterBufferMs),d.firsCount=Number(o.googFirsSent),d.nacksCount=Number(o.googNacksSent),d.plisCount=Number(o.googPlisSent),d.framesDecodeCount=Number(o.framesDecoded),d.bytes=Number(o.bytesReceived),d.packets=Number(o.packetsReceived),d.packetsLost=Number(o.packetsLost),d.ssrc=Number(o.ssrc),d.packets>0&&!this.isFirstVideoReceived[d.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(d.ssrc),this.isFirstVideoReceived[d.ssrc]=!0),d.framesDecodeCount>0&&!this.isFirstVideoDecoded[d.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(d.ssrc,d.decodedFrame.width,d.decodedFrame.height),this.isFirstVideoDecoded[d.ssrc]=!0),h){const f=h.stats,m=Date.now()-h.lts;d.framesDecodeFreezeTime=f.framesDecodeFreezeTime,d.framesDecodeInterval=f.framesDecodeInterval,d.framesDecodeCount>f.framesDecodeCount&&this.isFirstVideoDecoded[d.ssrc]?(h.lts=Date.now(),d.framesDecodeInterval=m,d.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(o.ssrc,10))?d.framesDecodeFreezeTime+=d.framesDecodeInterval:this.setVideoIsReady2(parseInt(o.ssrc,10),!0))):d.framesDecodeCount<h.stats.framesDecodeCount&&(d.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(d.ssrc,{stats:AD({},d),lts:Date.now()}),this._stats.videoRecv.push(d);break}case"audio_recv":{const d=na(L2);d.codec=o.googCodecName,d.outputLevel=Math.abs(Number(o.audioOutputLevel))/32767,d.decodingCNG=Number(o.googDecodingCNG),d.decodingCTN=Number(o.googDecodingCTN),d.decodingCTSG=Number(o.googDecodingCTSG),d.decodingNormal=Number(o.googDecodingNormal),d.decodingPLC=Number(o.googDecodingPLC),d.decodingPLCCNG=Number(o.googDecodingPLCCNG),d.expandRate=Number(o.googExpandRate),d.accelerateRate=Number(o.googAccelerateRate),d.preemptiveExpandRate=Number(o.googPreemptiveExpandRate),d.secondaryDecodedRate=Number(o.googSecondaryDecodedRate),d.speechExpandRate=Number(o.googSpeechExpandRate),d.preferredJitterBufferMs=Number(o.googPreferredJitterBufferMs),d.jitterBufferMs=Number(o.googJitterBufferMs),d.jitterMs=Number(o.googJitterReceived),d.bytes=Number(o.bytesReceived),d.packets=Number(o.packetsReceived),d.packetsLost=Number(o.packetsLost),d.ssrc=Number(o.ssrc),d.receivedFrames=Number(o.googDecodingCTN)||Number(o.packetsReceived),d.droppedFrames=Number(o.googDecodingPLC)+Number(o.googDecodingPLCCNG)||Number(o.packetsLost),d.receivedFrames>0&&!this.isFirstAudioReceived[d.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(d.ssrc),this.isFirstAudioReceived[d.ssrc]=!0),d.decodingNormal>0&&!this.isFirstAudioDecoded[d.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(d.ssrc),this.isFirstAudioDecoded[d.ssrc]=!0),this._stats.audioRecv.push(d);break}case"audio_send":{const d=na(k2);d.codec=o.googCodecName,d.inputLevel=Math.abs(Number(o.audioInputLevel))/32767,d.aecReturnLoss=Number(o.googEchoCancellationReturnLoss||0),d.aecReturnLossEnhancement=Number(o.googEchoCancellationReturnLossEnhancement||0),d.residualEchoLikelihood=Number(o.googResidualEchoLikelihood||0),d.residualEchoLikelihoodRecentMax=Number(o.googResidualEchoLikelihoodRecentMax||0),d.bytes=Number(o.bytesSent),d.packets=Number(o.packetsSent),d.packetsLost=Number(o.packetsLost),d.ssrc=Number(o.ssrc),d.rttMs=Number(o.googRtt||0),this._stats.rtt=d.rttMs,this._stats.audioSend.push(d);break}}})}_getStats(){return new le((i,o)=>{this.pc.getStats(i,o)})}statsResponsesToObjects(i){const o=[];return i.result().forEach(a=>{const l={id:a.id,timestamp:a.timestamp.valueOf().toString(),type:a.type};a.names().forEach(d=>{l[d]=a.stat(d)}),o.push(l)}),o}}var Rv=function(r){return r[r.kNone=1]="kNone",r[r.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",r[r.kBytesToBits=8]="kBytesToBits",r}(Rv||{});function uC(r,i,o,a){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Rv.kNone;if(!i)return;const d=Number(i[o]);if("number"!=typeof d)return;const h=Number(i[a]);if("number"!=typeof h)return;if(!r)return h?d/h*l:void 0;const f=Number(r[o]);if("number"!=typeof f)return;const m=Number(r[a]);if("number"!=typeof m)return;const g=h-m;return g?(d-f)/g*l:void 0}function OD(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function Ml(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?OD(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):OD(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}class U2 extends RD{constructor(){super(...arguments),N(this,"_stats",Iv),N(this,"report",void 0),N(this,"lastDecodeVideoReceiverStats",new Map),N(this,"lastVideoFramesRecv",new Map),N(this,"lastVideoFramesSent",new Map),N(this,"lastVideoFramesDecode",new Map),N(this,"lastVideoFramesOutput",new Map),N(this,"lastVideoJBDelay",new Map),N(this,"lastAudioJBDelay",new Map),N(this,"mediaBytesSent",new Map),N(this,"mediaBytesRetransmit",new Map),N(this,"mediaBytesTargetEncode",new Map),N(this,"lastDecodeAudioReceiverStats",new Map),N(this,"lastEncoderMs",new Map)}updateStats(){var i=this;return L(function*(){i.report=yield i.pc.getStats(),i._stats=na(Iv),i.report.forEach(o=>{switch(o.type){case kn.OUTBOUND:case kn.INBOUND:{const a=o.mediaType||o.kind,l=!a&&"frameWidth"in o,d=!a&&!("frameWidth"in o);o.type===kn.OUTBOUND?"audio"===a||d?i.processAudioOutboundStats(o):("video"===a||l)&&i.processVideoOutboundStats(o):o.type===kn.INBOUND&&("audio"===a||d?i.processAudioInboundStats(o):("video"===a||l)&&i.processVideoInboundStats(o));break}case kn.TRANSPORT:{const a=i.report.get(o.selectedCandidatePairId);a&&i.processCandidatePairStats(a);break}case kn.CANDIDATE_PAIR:o.selected&&i.processCandidatePairStats(o)}}),i.updateSendBitrate(),i._stats.updateInterval=Date.now()-i.stats.timestamp,i._stats.timestamp=Date.now(),i.calcLossRate(i._stats),i.stats=i._stats})()}getSelectedCandidatePair(){var i=this;return L(function*(){const o=yield i.pc.getStats(),a={local:Ml({},Dc),remote:Ml({},Dc)};return o.forEach(l=>{let d;if(l.type===kn.TRANSPORT&&(d=o.get(l.selectedCandidatePairId)),l.type===kn.CANDIDATE_PAIR&&l.selected&&(d=l),d){const h=(f,m)=>{f.type=m.type,f.id=m.id,m.address&&(f.address=m.address),m.candidateType&&(f.candidateType=m.candidateType),m.port&&(f.port=m.port),m.priority&&(f.priority=m.priority),m.protocol&&(f.protocol=m.protocol),m.relayProtocol&&(f.relayProtocol=m.relayProtocol)};if(d.localCandidateId){const f=o.get(d.localCandidateId);f&&h(a.local,f)}if(d.remoteCandidateId){const f=o.get(d.remoteCandidateId);f&&h(a.remote,f)}}}),a})()}processCandidatePairStats(i){if(this._stats.sendBandwidth=i.availableOutgoingBitrate||0,i.currentRoundTripTime&&(this._stats.rtt=1e3*i.currentRoundTripTime),this._stats.videoSend.forEach(o=>{i.currentRoundTripTime&&(o.rttMs=1e3*i.currentRoundTripTime)}),this._stats.audioSend.forEach(o=>{i.currentRoundTripTime&&(o.rttMs=1e3*i.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=i.id,i.localCandidateId){const o=this.report.get(i.localCandidateId);o&&this.processCandidateStats(o)}if(i.remoteCandidateId){const o=this.report.get(i.remoteCandidateId);o&&this.processCandidateStats(o)}}processCandidateStats(i){let o;i.type===kn.LOCAL_CANDIDATE&&(o=this._stats.selectedCandidatePair.localCandidate),i.type===kn.REMOTE_CANDIDATE&&(o=this._stats.selectedCandidatePair.remoteCandidate),o&&(o.type=i.type,o.id=i.id,i.address&&(o.address=i.address),i.candidateType&&(o.candidateType=i.candidateType),i.port&&(o.port=i.port),i.priority&&(o.priority=i.priority),i.protocol&&(o.protocol=i.protocol),i.relayProtocol&&(o.relayProtocol=i.relayProtocol),i.type===kn.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==o.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Ml({},o),Ml({},this.stats.selectedCandidatePair.localCandidate)),i.type===kn.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==o.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Ml({},o),Ml({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(i){let o=this._stats.audioRecv.find(l=>l.ssrc===i.ssrc);o||(o=na(L2),this._stats.audioRecv.push(o)),o.ssrc=i.ssrc,o.packets=i.packetsReceived,o.packetsLost=i.packetsLost,o.packetsDiscarded=i.packetsDiscarded,o.bytes=i.bytesReceived,o.jitterMs=1e3*i.jitter,o.retransmittedBytesReceived=i.retransmittedBytesReceived,o.retransmittedPacketsReceived=i.retransmittedPacketsReceived,o.totalProcessingDelay=i.totalProcessingDelay,o.jitterBufferEmittedCount=i.jitterBufferEmittedCount;const a=this.lastDecodeAudioReceiverStats.get(o.ssrc);o.avgProcessingDelayMs=uC(a,o,"totalProcessingDelay","jitterBufferEmittedCount",Rv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(i,i.trackId,o),i.codecId&&(o.codec=this.getCodecFromCodecStats(i.codecId)),o.receivedFrames||(o.receivedFrames=i.packetsReceived),o.droppedFrames||(o.droppedFrames=i.packetsLost),o.receivedFrames>0&&!this.isFirstAudioReceived[o.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(o.ssrc),this.isFirstAudioReceived[o.ssrc]=!0),o.outputLevel&&o.outputLevel>0&&!this.isFirstAudioDecoded[o.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(o.ssrc),this.isFirstAudioDecoded[o.ssrc]=!0),"number"==typeof i.concealedSamples&&(o.concealedSamples=i.concealedSamples),this.lastDecodeAudioReceiverStats.set(o.ssrc,Ml({},o))}processVideoInboundStats(i){let o=this._stats.videoRecv.find(f=>f.ssrc===i.ssrc);o||(o=na(P2),this._stats.videoRecv.push(o)),o.ssrc=i.ssrc,o.packets=i.packetsReceived,o.packetsLost=i.packetsLost,o.bytes=i.bytesReceived,o.firsCount=i.firCount,o.nacksCount=i.nackCount,o.plisCount=i.pliCount,o.framesDecodeCount=i.framesDecoded,o.framesDroppedCount=i.framesDropped,o.totalInterFrameDelay=i.totalInterFrameDelay,o.totalSquaredInterFrameDelay=i.totalSquaredInterFrameDelay,o.totalFreezesDuration=i.totalFreezesDuration,o.totalProcessingDelay=i.totalProcessingDelay,o.packetsDiscarded=i.packetsDiscarded,o.framesAssembledFromMultiplePackets=i.framesAssembledFromMultiplePackets,o.totalAssemblyTime=i.totalAssemblyTime,o.keyFramesDecoded=i.keyFramesDecoded,o.retransmittedBytesReceived=i.retransmittedBytesReceived,o.retransmittedPacketsReceived=i.retransmittedPacketsReceived;const a=this.lastDecodeVideoReceiverStats.get(o.ssrc),l=this.lastVideoFramesDecode.get(o.ssrc),d=this.lastVideoFramesOutput.get(o.ssrc),h=Date.now();if(o.framesDecodeCount>0&&!this.isFirstVideoDecoded[o.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(o.ssrc,o.decodedFrame?o.decodedFrame.width:0,o.decodedFrame?o.decodedFrame.height:0),this.isFirstVideoDecoded[o.ssrc]=!0),a){const f=a.stats,m=h-a.lts;o.framesDecodeFreezeTime=f.framesDecodeFreezeTime,o.framesDecodeInterval=f.framesDecodeInterval,!this.isFirstVideoDecoded[o.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[o.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(o.ssrc),this.isFirstVideoDecodedTimeout[o.ssrc]=!0),o.framesDecodeCount>f.framesDecodeCount&&this.isFirstVideoDecoded[o.ssrc]?(a.lts=Date.now(),o.framesDecodeInterval=m,o.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(i.ssrc))?o.framesDecodeFreezeTime+=o.framesDecodeInterval:this.setVideoIsReady2(parseInt(i.ssrc,10),!0))):o.framesDecodeCount<f.framesDecodeCount&&(o.framesDecodeInterval=0),i.framesDecoded&&i.qpSum&&(o.qpSumPerFrame=a.stats.framesDecodeCount>i.framesDecoded?i.qpSum/i.framesDecoded:(i.qpSum-a.qpSum)/(i.framesDecoded-a.stats.framesDecodeCount))}i.totalDecodeTime&&(o.decodeMs=1e3*i.totalDecodeTime,o.avgDecodeMs=uC(a?.stats,o,"decodeMs","framesDecodeCount")),o.avgProcessingDelayMs=uC(a?.stats,o,"totalProcessingDelay","framesDecodeCount",Rv.kMillisecondsFromSeconds),o.avgFramesAssembledFromMultiplePacketsMs=uC(a?.stats,o,"totalAssemblyTime","framesAssembledFromMultiplePackets",Rv.kMillisecondsFromSeconds),o.avgInterFrameDelayMs=uC(a?.stats,o,"totalInterFrameDelay","framesDecodeCount",Rv.kMillisecondsFromSeconds),l&&h-l.lts>=800?(o.decodeFrameRate=Math.round((o.framesDecodeCount-l.count)/((h-l.lts)/1e3)),this.lastVideoFramesDecode.set(o.ssrc,{count:o.framesDecodeCount,lts:h,rate:o.decodeFrameRate})):l?o.decodeFrameRate=l.rate:this.lastVideoFramesDecode.set(o.ssrc,{count:o.framesDecodeCount,lts:h,rate:0}),o.framesDroppedCount&&i.framesReceived&&(d&&h-d.lts>=800?(o.outputFrameRate=Math.round((i.framesReceived-o.framesDroppedCount-d.count)/((h-d.lts)/1e3)),this.lastVideoFramesOutput.set(o.ssrc,{count:i.framesReceived-o.framesDroppedCount,lts:h,rate:Math.max(o.outputFrameRate,0)})):d?o.outputFrameRate=d.rate:this.lastVideoFramesOutput.set(o.ssrc,{count:i.framesReceived-o.framesDroppedCount,lts:h,rate:0})),this.processVideoTrackReceiverStats(i,i.trackId,o),i.codecId&&(o.codec=this.getCodecFromCodecStats(i.codecId)),i.framerateMean&&(o.framesRateFirefox=i.framerateMean),o.packets>0&&!this.isFirstVideoReceived[o.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(o.ssrc),this.isFirstVideoReceived[o.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(o.ssrc,{stats:Ml({},o),lts:a?a.lts:Date.now(),qpSum:i.qpSum})}processVideoOutboundStats(i){let o=this._stats.videoSend.find(l=>l.ssrc===i.ssrc);o||(o=na(M2),this._stats.videoSend.push(o));const a=this.mediaBytesSent.get(i.ssrc);if(a)a.add(i.bytesSent);else{const l=new wD(10);l.add(i.bytesSent),this.mediaBytesSent.set(i.ssrc,l)}if(void 0!==i.retransmittedBytesSent){const l=this.mediaBytesRetransmit.get(i.ssrc);if(l)l.add(i.retransmittedBytesSent);else{const d=new wD(10);d.add(i.retransmittedBytesSent),this.mediaBytesRetransmit.set(i.ssrc,d)}}if(i.totalEncodedBytesTarget){const l=this.mediaBytesTargetEncode.get(i.ssrc);if(l)l.add(i.totalEncodedBytesTarget);else{const d=new wD(10);d.add(i.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(i.ssrc,d)}}if(o.ssrc=i.ssrc,o.bytes=i.bytesSent,o.packets=i.packetsSent,o.firsCount=i.firCount,o.nacksCount=i.nackCount,o.plisCount=i.pliCount,o.frameCount=i.framesEncoded,o.adaptionChangeReason=i.qualityLimitationReason,o.scalabilityMode=i.scalabilityMode,o.retransmittedBytesSent=i.retransmittedBytesSent,o.retransmittedPacketsSent=i.retransmittedPacketsSent,o.hugeFramesSent=i.hugeFramesSent,o.keyFramesEncoded=i.keyFramesEncoded,i.totalEncodeTime&&i.framesEncoded){const l=this.lastEncoderMs.get(i.ssrc);o.avgEncodeMs=!l||l.lastFrameCount>i.framesEncoded?1e3*i.totalEncodeTime/i.framesEncoded:1e3*(i.totalEncodeTime-l.lastEncoderTime)/(i.framesEncoded-l.lastFrameCount)}if(i.framesEncoded&&i.qpSum){const l=this.lastEncoderMs.get(i.ssrc);o.qpSumPerFrame=!l||l.lastFrameCount>i.framesEncoded?i.qpSum/i.framesEncoded:(i.qpSum-l.lastQpSum)/(i.framesEncoded-l.lastFrameCount)}if(this.lastEncoderMs.set(i.ssrc,{lastFrameCount:i.framesEncoded,lastEncoderTime:i.totalEncodeTime,lastQpSum:i.qpSum,lts:Date.now()}),i.codecId&&(o.codec=this.getCodecFromCodecStats(i.codecId)),i.mediaSourceId&&this.processVideoMediaSource(i.mediaSourceId,o),this.processVideoTrackSenderStats(i,i.trackId,o),i.remoteId)this.processRemoteInboundStats(i.remoteId,o);else{const l=this.findRemoteStatsId(i.ssrc,kn.REMOTE_INBOUND);l&&this.processRemoteInboundStats(l,o)}}processAudioOutboundStats(i){let o=this._stats.audioSend.find(a=>a.ssrc===i.ssrc);if(o||(o=na(k2),this._stats.audioSend.push(o)),o.ssrc=i.ssrc,o.packets=i.packetsSent,o.bytes=i.bytesSent,o.retransmittedBytesSent=i.retransmittedBytesSent,o.retransmittedPacketsSent=i.retransmittedPacketsSent,i.mediaSourceId&&this.processAudioMediaSource(i.mediaSourceId,o),i.codecId&&(o.codec=this.getCodecFromCodecStats(i.codecId)),this.processAudioTrackSenderStats(i,i.trackId,o),i.remoteId)this.processRemoteInboundStats(i.remoteId,o);else{const a=this.findRemoteStatsId(i.ssrc,kn.REMOTE_INBOUND);a&&this.processRemoteInboundStats(a,o)}}findRemoteStatsId(i,o){var a;const l=Array.from(xd(a=this.report).call(a)).find(d=>d.type===o&&d.ssrc===i);return l?l.id:null}processVideoMediaSource(i,o){const a=this.report.get(i);a&&a.width&&a.height&&a.framesPerSecond&&(o.inputFrame={width:a.width,height:a.height,frameRate:a.framesPerSecond})}processAudioMediaSource(i,o){const a=this.report.get(i);a&&(o.inputLevel=a.audioLevel)}processVideoTrackSenderStats(i,o,a){var l,d,h,f;const m=o?this.report.get(o):void 0,g=null!==(l=m?.framesSent)&&void 0!==l?l:i.framesSent;if("number"!=typeof g)return;let v=null!==(d=m?.frameWidth)&&void 0!==d?d:i.frameWidth,y=null!==(h=m?.frameHeight)&&void 0!==h?h:i.frameHeight,b=null!==(f=m?.framesPerSecond)&&void 0!==f?f:i.framesPerSecond;if("number"==typeof v&&"number"==typeof y||(v=0,y=0),null==b){const C=Date.now(),P=this.lastVideoFramesSent.get(a.ssrc);P&&C-P.lts>=800?(b=Math.round((g-P.count)/((C-P.lts)/1e3)),this.lastVideoFramesSent.set(a.ssrc,{count:g,lts:C,rate:b})):P?b=P.rate:this.lastVideoFramesSent.set(a.ssrc,{count:g,lts:C,rate:0})}a.sentFrame={width:v,height:y,frameRate:Math.max(0,b)}}processVideoTrackReceiverStats(i,o,a){var l,d,h,f,m;const g=o?this.report.get(o):void 0,v=null!==(l=g?.framesReceived)&&void 0!==l?l:i.framesReceived,y=null!==(d=g?.frameWidth)&&void 0!==d?d:i.frameWidth,b=null!==(h=g?.frameHeight)&&void 0!==h?h:i.frameHeight,C=null!==(f=g?.jitterBufferDelay)&&void 0!==f?f:i.jitterBufferDelay,P=null!==(m=g?.jitterBufferEmittedCount)&&void 0!==m?m:i.jitterBufferEmittedCount;if("number"==typeof v){const R=this.lastVideoFramesRecv.get(a.ssrc),A=Date.now();a.framesReceivedCount=v;let O=0;R&&A-R.lts>=800?(O=Math.round((v-R.count)/((A-R.lts)/1e3)),this.lastVideoFramesRecv.set(a.ssrc,{count:v,lts:A,rate:O})):R?O=R.rate:this.lastVideoFramesRecv.set(a.ssrc,{count:v,lts:A,rate:0}),a.receivedFrame={width:y||0,height:b||0,frameRate:O||0},a.decodedFrame={width:y||0,height:b||0,frameRate:a.decodeFrameRate||0},a.outputFrame={width:y||0,height:b||0,frameRate:a.outputFrameRate||a.decodeFrameRate||0}}if(C&&P){const R=this.lastVideoJBDelay.get(a.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let A=R.jitterBufferMs;const O=P-R.jitterBufferEmittedCount;O>0&&(A=1e3*(C-R.jitterBufferDelay)/O),a.jitterBufferMs=A,a.currentDelayMs=Math.round(A),this.lastVideoJBDelay.set(a.ssrc,{jitterBufferDelay:C,jitterBufferEmittedCount:P,jitterBufferMs:a.currentDelayMs})}}processAudioTrackSenderStats(i,o,a){var l,d,h,f;const m=o?this.report.get(o):void 0,g=null!==(l=null!==(d=m?.echoReturnLoss)&&void 0!==d?d:i.echoReturnLoss)&&void 0!==l?l:0,v=null!==(h=null!==(f=m?.echoReturnLossEnhancement)&&void 0!==f?f:i.echoReturnLossEnhancement)&&void 0!==h?h:0;a.aecReturnLoss=g,a.aecReturnLossEnhancement=v}processAudioTrackReceiverStats(i,o,a){var l,d,h,f,m,g,v;const y=o?this.report.get(o):void 0,b=null!==(l=y?.removedSamplesForAcceleration)&&void 0!==l?l:i.removedSamplesForAcceleration,C=null!==(d=y?.totalSamplesReceived)&&void 0!==d?d:i.totalSamplesReceived,P=null!==(h=y?.jitterBufferDelay)&&void 0!==h?h:i.jitterBufferDelay,R=null!==(f=y?.jitterBufferEmittedCount)&&void 0!==f?f:i.jitterBufferEmittedCount,A=null!==(m=y?.audioLevel)&&void 0!==m?m:i?.audioLevel,O=null!==(g=y?.totalSamplesDuration)&&void 0!==g?g:i?.totalSamplesDuration,M=null!==(v=y?.concealedSamples)&&void 0!==v?v:i.concealedSamples;if(b&&C&&(a.accelerateRate=b/C),P&&R){const j=this.lastAudioJBDelay.get(a.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let W=j.jitterBufferMs;const q=R-j.jitterBufferEmittedCount;q>0&&(W=1e3*(P-j.jitterBufferDelay)/q),a.jitterBufferMs=Math.round(W),this.lastAudioJBDelay.set(a.ssrc,{jitterBufferDelay:P,jitterBufferEmittedCount:R,jitterBufferMs:a.jitterBufferMs})}a.outputLevel=A;let x=1920;O&&C&&(x=C/O/50,a.receivedFrames=Math.round(C/x)),M&&(a.droppedFrames=Math.round(M/x))}processRemoteInboundStats(i,o){const a=this.report.get(i);a&&(o.packetsLost=a.packetsLost,a.roundTripTime&&(o.rttMs=1e3*a.roundTripTime),a.jitter&&(o.jitterMs=1e3*a.jitter),a.timestamp&&(o.timestamp=a.timestamp))}getCodecFromCodecStats(i){const o=this.report.get(i);if(!o)return"";const a=o.mimeType.match(/\/(.*)$/);return a&&a[1]?a[1]:""}updateSendBitrate(){let i=0,o=null,a=null;this.mediaBytesSent.forEach(d=>{i+=d.diffMean()}),this.mediaBytesRetransmit.forEach(d=>{o=null===o?d.diffMean():o+d.diffMean()}),this.mediaBytesTargetEncode.forEach(d=>{a=null===a?d.diffMean():a+d.diffMean()}),this._stats.bitrate={actualEncoded:8*(null!==o?i-o:i)/(this.options.updateInterval/1e3),transmit:8*i/(this.options.updateInterval/1e3)},null!==o&&(this._stats.bitrate.retransmit=8*o/(this.options.updateInterval/1e3)),null!==a&&(this._stats.bitrate.targetEncoded=8*a/(this.options.updateInterval/1e3))}}class gH extends RD{updateStats(){return le.resolve()}}function hC(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const d=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return d?d<76?new DD(r,{updateInterval:i,lossRateInterval:o,freezeRateLimit:a,firstVideoDecodedTimeout:l}):new U2(r,{updateInterval:i,lossRateInterval:o,freezeRateLimit:a,firstVideoDecodedTimeout:l}):function(h){if(!window.RTCStatsReport)return!1;const f=h.getStats();return!(!(f instanceof le)&&(m=f,!m||"object"!=typeof m&&"function"!=typeof m||"function"!=typeof m.then));var m}(r)?new U2(r,{updateInterval:i,lossRateInterval:o,freezeRateLimit:a,firstVideoDecodedTimeout:l}):new gH(r,{updateInterval:i,lossRateInterval:o,freezeRateLimit:a,firstVideoDecodedTimeout:l})}let _H=class{get localCapabilities(){return Vn(this._localCapabilities)}get rtpCapabilities(){return Vn(this._rtpCapabilities)}get candidates(){return Vn(this._candidates)}get iceParameters(){return Vn(this._iceParameters)}get dtlsParameters(){return Vn(this._dtlsParameters)}constructor(r){N(this,"sessionDesc",void 0),N(this,"_localCapabilities",void 0),N(this,"_rtpCapabilities",void 0),N(this,"_candidates",void 0),N(this,"_iceParameters",void 0),N(this,"_dtlsParameters",void 0),N(this,"setup",void 0),N(this,"currentMidIndex",void 0),N(this,"cname","o/i14u9pJrxRKAsu"),N(this,"firefoxSsrcMidMap",new Map),r=Vn(r);const{remoteIceParameters:i,remoteDtlsParameters:o,candidates:a,remoteRTPCapabilities:l,localCapabilities:d,direction:h,setup:f,videoCodec:m,audioCodec:g}=r;let v;this.setup=f,v=vr.parse(h===Ni.RECEIVE_ONLY?"v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n":"v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"),this._rtpCapabilities=l,this._candidates=a,this._iceParameters=i,this._dtlsParameters=o,this._localCapabilities=d;const y=h===Ni.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,b=h===Ni.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,C=h===Ni.RECEIVE_ONLY?l.send.videoCodecs:Lo(_e.VIDEO,y,b,m),P=h===Ni.RECEIVE_ONLY?l.send.audioCodecs:Lo(_e.AUDIO,y,b,g);for(const R of v.mediaDescriptions)R.attributes.iceUfrag=i.iceUfrag,R.attributes.icePwd=i.icePwd,R.attributes.fingerprints=o.fingerprints,R.attributes.candidates=a,R.attributes.setup=this.setup,"application"===R.media.mediaType&&(R.attributes.sctpPort="5000"),"video"===R.media.mediaType&&(R.media.fmts=C.map(A=>A.payloadType.toString(10)),R.attributes.payloads=C,R.attributes.extmaps=y.videoExtensions),"audio"===R.media.mediaType&&(R.media.fmts=P.map(A=>A.payloadType.toString(10)),R.attributes.payloads=P,R.attributes.extmaps=y.audioExtensions,Nl(R));this.sessionDesc=v,this.currentMidIndex=v.mediaDescriptions.length-1}toString(){return vr.print(this.sessionDesc)}hasMid(r){return Array.isArray(r)?r.every(i=>this.hasMid(i)):this.sessionDesc.mediaDescriptions.some(i=>i.attributes.mid===r)}send(r,i,o,a,l){o=o.replace(/ /g,"-");const{ssrcs:d,ssrcGroups:h}=Oh(i,this.cname,B("SYNC_GROUP")?o:void 0),f=this.findPreloadMediaDesc(d);if(f){if(hn()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,f.attributes.mid),l&&(l.twcc||l.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(f);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(f,l),{mid:f.attributes.mid,needExchangeSDP:!0}}return{mid:f.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(r,d,a);let g;return-1===m?(g=this.createOrRecycleSendMedia(r,d,h,"sendonly",a,l),this.updateBundleMids()):(g=Vn(this.sessionDesc.mediaDescriptions[m]),g.attributes.direction="sendonly",g.attributes.ssrcs=d,g.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(g,l)),hn()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,g.attributes.mid),{needExchangeSDP:!0,mid:g.attributes.mid}}}stopSending(r){const i=this.sessionDesc.mediaDescriptions.filter(o=>o.attributes.mid&&-1!==r.indexOf(o.attributes.mid));if(i.length!==r.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");i.forEach(o=>{o.attributes.ssrcs=[]}),this.updateBundleMids()}receive(r,i,o){const a=[];return r.forEach(l=>{const h=this.findAvailableRecvMediaIndex(l._mediaStreamTrack.kind);let f,m=!1;-1===h?(m=!0,f=this.createOrRecycleRecvMedia(l,[],"recvonly",i,o),this.updateBundleMids()):(f=Vn(this.sessionDesc.mediaDescriptions[h]),f.attributes.direction="recvonly"),a.push({mid:f.attributes.mid,needCreateTransceiver:m})}),a}stopReceiving(r){const i=this.sessionDesc.mediaDescriptions.filter(o=>-1!==r.indexOf(o.attributes.mid));if(i.length!==r.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");i.forEach(o=>{o.media.port="0",o.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(r){const{foundation:i,protocol:o,address:a,port:l,type:d,relatedAddress:h,relatedPort:f,priority:m}=new RTCIceCandidate(r),g={foundation:i??"",componentId:"1",transport:o??"",priority:m?m+"":"",connectionAddress:a??"",port:l?l+"":"",type:d?d+"":"",relAddr:h??"",relPort:f?f+"":"",extension:{}};this.candidates.some(v=>v.priority===g.priority&&v.connectionAddress===g.connectionAddress&&v.port===g.port)||(this._candidates.push(g),this.sessionDesc.mediaDescriptions.forEach(v=>{v.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(r,i,o,a,l){const d=r._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,f=Lo(d,h,this.localCapabilities.send,d===_e.AUDIO?l:a),m=d===_e.VIDEO?h.videoExtensions:h.audioExtensions,g="".concat(++this.currentMidIndex);let v={media:{mediaType:d,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};v=this.mungRecvMediaDsec(v,r);const y=this.findFirstClosedMedia(d);if(y){const b=this.sessionDesc.mediaDescriptions.indexOf(y);this.sessionDesc.mediaDescriptions[b]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}muteRemote(r){const i=this.sessionDesc.mediaDescriptions.filter(o=>he(r).call(r,o.attributes.mid||""));if(i.length!==r.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(o=>{o.attributes.direction="inactive"})}unmuteRemote(r){const i=this.sessionDesc.mediaDescriptions.filter(o=>he(r).call(r,o.attributes.mid||""));if(i.length!==r.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(o=>{o.attributes.direction="recvonly"})}findAvailableMediaIndex(r,i,o){return this.sessionDesc.mediaDescriptions.findIndex(a=>{const l=a.media.mediaType===r&&"0"!==a.media.port&&("sendonly"===a.attributes.direction||"sendrecv"===a.attributes.direction)&&0===a.attributes.ssrcs.length;if(hn()){if(l){const d=this.firefoxSsrcMidMap.get(i[0].ssrcId);return!(d||"0"!==a.attributes.mid&&"1"!==a.attributes.mid)||!(!d||d!==a.attributes.mid)}return!1}return l&&a.attributes.mid===o})}findAvailableRecvMediaIndex(r){return this.sessionDesc.mediaDescriptions.findIndex(i=>"0"!==i.attributes.mid&&"1"!==i.attributes.mid&&i.media.mediaType===r&&"0"!==i.media.port&&("recvonly"===i.attributes.direction||"sendrecv"===i.attributes.direction))}predictReceivingMids(r){const i=[];for(let o=0;o<r;o++)i.push((this.currentMidIndex+o+1).toString(10));return i}restartICE(r){r=Vn(r),this._iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=r.iceUfrag,i.attributes.icePwd=r.icePwd})}createOrRecycleSendMedia(r,i,o,a,l,d){const h=this.rtpCapabilities.send,f=r===_e.VIDEO?h.videoCodecs:h.audioCodecs,m=r===_e.VIDEO?h.videoExtensions:h.audioExtensions;hn()&&(l="".concat(++this.currentMidIndex));let g={media:{mediaType:r,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:o,rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:l}};g=this.mungSendMediaDesc(g,d);const v=this.findFirstClosedMedia(r);if(v){const y=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[y]=g}else this.sessionDesc.mediaDescriptions.push(g);return g}mungRecvMediaDsec(r,i,o){const a=Vn(r);return rD(a),Kf(a,i),iD(a,i),gv(a),iC(a,o,this.localCapabilities.send),a}mungSendMediaDesc(r,i){const o=Vn(r);return iC(o,i,this.localCapabilities.recv),Nl(o),o}updateRecvMedia(r,i){const o=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===r);if(-1!==o){const a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],i);this.sessionDesc.mediaDescriptions[o]=a}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(r=>"0"!==r.media.port).map(r=>r.attributes.mid)}findPreloadMediaDesc(r){return this.sessionDesc.mediaDescriptions.find(i=>{var o;return(null===(o=i.attributes)||void 0===o||null===(o=o.ssrcs[0])||void 0===o?void 0:o.ssrcId)===r[0].ssrcId})}findFirstClosedMedia(r){return this.sessionDesc.mediaDescriptions.find(i=>hn()?"0"===i.media.port&&i.media.mediaType===r:"0"===i.media.port)}};const Rz=["sdp"];var Xt;function V2(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function Mh(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?V2(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):V2(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}let B2=(Xt=class _T extends GR{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var i,o;return null!==(i=null===(o=this.peerConnection.getReceivers()[0])||void 0===o||null===(o=o.transport)||void 0===o?void 0:o.state)&&void 0!==i?i:null}get localCodecs(){return[]}set isInRestartIce(i){this._isInRestartIce=i}get isInRestartIce(){return this._isInRestartIce}constructor(i,o,a){super(i,o),N(this,"direction",void 0),N(this,"name",void 0),N(this,"store",void 0),N(this,"spec",void 0),N(this,"peerConnection",void 0),N(this,"initialOffer",void 0),N(this,"transport",void 0),N(this,"statsFilter",void 0),N(this,"localCandidateCount",0),N(this,"_isInRestartIce",!1),N(this,"mutex",void 0),N(this,"onLocalCandidate",void 0),N(this,"remoteSDP",void 0),N(this,"pendingCandidates",[]),N(this,"localCapabilities",void 0),N(this,"isReady",!1),N(this,"restartCnt",0),N(this,"curTurnServerIndex",0),this.store=o,this.spec=i,this.mutex=new Qr("P2PConnection-mutex",o.clientId),this.peerConnection=new RTCPeerConnection(_T.resolvePCConfiguration(i,o.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=a??Ni.SEND_ONLY,this.name=this.direction===Ni.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=hC(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,hn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}establish(i){var o=this;return L(function*(){try{const a=yield Tn();if(o.localCapabilities=ea(a),i){const{sdp:l}=i,d=function mH(r,i){if(null==r)return{};var o,a,l=function(h,f){if(null==h)return{};var m,g,v={},y=vL(h);for(g=0;g<y.length;g++)m=y[g],O2(f).call(f,m)>=0||(v[m]=h[m]);return v}(r,i);if(bD){var d=bD(r);for(a=0;a<d.length;a++)o=d[a],O2(i).call(i,o)>=0||Object.prototype.propertyIsEnumerable.call(r,o)&&(l[o]=r[o])}return l}(i,Rz),h=function(){const y={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},b=mv(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"sendonly"),C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},R={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ko(b,y,"videoExtensions",C,P,R),ko(b,y,"videoCodecs",C,P,R),ko(b,y,"audioExtensions",C,P,R),ko(b,y,"audioCodecs",C,P,R),B("RAISE_H264_BASELINE_PRIORITY")){const A=R.videoCodecs.findIndex(O=>O.rtpMap&&"h264"===O.rtpMap.encodingName.toLocaleLowerCase()&&O.fmtp&&"42001f"===O.fmtp.parameters["profile-level-id"]);if(-1!==A){const O=R.videoCodecs.findIndex(M=>M.rtpMap&&"h264"===M.rtpMap.encodingName.toLocaleLowerCase());if(O<A){T.debug("raising H264 baseline profile priority");const M=R.videoCodecs[A];R.videoCodecs.splice(A,1),R.videoCodecs.splice(O,0,M)}-1!==O&&B("FILTER_SEND_H264_BASELINE")&&(C.videoCodecs=C.videoCodecs.filter(M=>!(M.rtpMap&&"h264"===M.rtpMap.encodingName.toLocaleLowerCase()&&M.fmtp&&"42001f"!==M.fmtp.parameters["profile-level-id"])))}}return{send:C,recv:P,sendrecv:R}}({},{},l);o.remoteSDP=new _H({remoteIceParameters:d.iceParameters,remoteDtlsParameters:d.dtlsParameters,candidates:[],remoteRTPCapabilities:h,localCapabilities:o.localCapabilities,direction:o.direction,setup:"actpass",videoCodec:o.store.codec,audioCodec:o.store.audioCodec}),yield o.setRemoteDescription({type:"offer",sdp:o.remoteSDP.toString()}),o.isReady=!0;const f=yield o.peerConnection.createAnswer();if(!f.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=Gd(f.sdp);yield o.peerConnection.setLocalDescription(f);const g=yield h2({},{},f.sdp);o.localCapabilities=ea(g);const v=o.peerConnection.getTransceivers()[0];return null!=v&&v.receiver&&v.receiver.transport&&o.tryBindTransportEvents(v.receiver.transport),Mh(Mh({},m),{},{sdp:f.sdp})}{o.peerConnection.addTransceiver("video",{direction:"sendonly"}),o.peerConnection.addTransceiver("audio",{direction:"sendonly"});const l=yield o.peerConnection.createOffer();if(!l.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const d=Gd(l.sdp);return o.initialOffer=l,Mh(Mh({},d),{},{sdp:l.sdp})}}catch(a){throw new Y(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}})()}connect(i){var o=this;return L(function*(){try{if(!o.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");yield o.peerConnection.setLocalDescription(o.initialOffer);const{sdp:a,iceParameters:l,dtlsParameters:d}=i,h=yield h2({},{},a);o.remoteSDP=new _H({remoteIceParameters:l,remoteDtlsParameters:d,candidates:[],remoteRTPCapabilities:h,localCapabilities:o.localCapabilities,direction:o.direction,setup:"active",videoCodec:o.store.codec,audioCodec:o.store.audioCodec}),yield o.setRemoteDescription({type:"answer",sdp:o.remoteSDP.toString()});const f=o.peerConnection.getTransceivers()[0];null!=f&&f.sender&&f.sender.transport&&o.tryBindTransportEvents(f.sender.transport)}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(a.toString()))}})()}addRemoteCandidate(i){var o=this;return L(function*(){try{i&&o.pendingCandidates.push(i),o.peerConnection.remoteDescription&&o.isReady&&(o.pendingCandidates.forEach(a=>{o.peerConnection.addIceCandidate(a)}),o.pendingCandidates=[])}catch(a){throw new Y(k.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(a.toString()))}})()}send(i,o,a){var l=this;return ts(function*(){const d=yield tt(l.mutex.lock("From P2PConnection.send"));try{if(!l.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],f=l.remoteSDP.receive(i,o,a);i.forEach((A,O)=>{if(f[O].needCreateTransceiver){const M=l.peerConnection.addTransceiver(A._mediaStreamTrack,{direction:"sendonly"});h.push(M),A._updateRtpTransceiver(M)}else{const M=l.peerConnection.getTransceivers().find(x=>x.mid===f[O].mid);if(!M)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(f[O].mid));h.push(M),A._updateRtpTransceiver(M)}}),hn()&&!0===B("SIMULCAST")&&(yield tt(l.applySimulcastForFirefox(h,i)));const m=f.map(A=>A.mid),g=yield tt(l.peerConnection.createOffer()),v=l.mungSendOfferSDP(g.sdp,i,m),y=vr.parse(v),b=m.map(A=>{const O=y.mediaDescriptions.find(M=>M.attributes.mid===A);if(!O)throw new Error("Cannot extract ssrc from mediaDescription.");return oH(O,B("USE_PUB_RTX"))}),C=h.map((A,O)=>({localSSRC:b[O],id:m[O]}));yield tt(l.peerConnection.setLocalDescription({type:"offer",sdp:v}));try{yield C}catch(A){const O=l.remoteSDP.toString();throw yield tt(l.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield tt(l.peerConnection.setRemoteDescription({type:"answer",sdp:O})),yield tt(l.stopSending(m,!0)),A}yield tt(l.applySimulcastEncodings(h,i)),yield tt(l.applySendEncodings(h,i));const P=l.remoteSDP.toString(),R=l.logSDPExchange(v,"offer","local","send");return R?.(P),yield tt(l.setRemoteDescription({type:"answer",sdp:P})),h.map((A,O)=>({localSSRC:b[O],id:m[O]}))}catch(h){throw h instanceof Y?h:new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}stopSending(i,o){var a=this;return L(function*(){const l=o?void 0:yield a.mutex.lock("From P2PConnection.stopSending");try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const d=a.peerConnection.getTransceivers().filter(g=>-1!==i.indexOf(g.mid));if(d.length!==i.length)throw new Error("Transceivers' length (".concat(d.length,") doesn't match mids' length (").concat(i.length,") when trying to call P2PConnection.stopSending."));d.map(g=>{var v;g.direction="inactive",null===(v=g.stop)||void 0===v||v.call(g)});const h=yield a.peerConnection.createOffer(),f=a.logSDPExchange(h.sdp||"","offer","local","stopSending");yield a.peerConnection.setLocalDescription(h),a.remoteSDP.stopReceiving(i);const m=a.remoteSDP.toString();f?.(m),yield a.setRemoteDescription({type:"answer",sdp:m})}catch(d){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(d.toString()))}finally{l&&l()}})()}receive(i,o,a,l){var d=this;return L(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{mid:h,needExchangeSDP:f}=d.remoteSDP.send(i,o,a,l);if(f){const g=d.remoteSDP.toString(),v=d.logSDPExchange(g,"offer","remote","receive");yield d.setRemoteDescription({type:"offer",sdp:g});const y=yield d.peerConnection.createAnswer(),b=d.mungReceiveAnswerSDP(y.sdp,h,i);v?.(b||""),yield d.peerConnection.setLocalDescription({type:"answer",sdp:b}),T.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(i," by exchanging SDP."))}else T.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(i," no need to exchange SDP."));const m=d.peerConnection.getTransceivers().find(g=>g.mid===h);if(!m||null===m.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(h){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}mockReceive(i,o,a,l){var d=this;return L(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{mid:h,needExchangeSDP:f}=d.remoteSDP.send(i,o,a,l);if(f){const m=d.remoteSDP.toString(),g=d.logSDPExchange(m,"offer","remote","receive");yield d.setRemoteDescription({type:"offer",sdp:m});const v=yield d.peerConnection.createAnswer(),y=d.mungReceiveAnswerSDP(v.sdp,h,i);g?.(y||""),yield d.peerConnection.setLocalDescription({type:"answer",sdp:y}),T.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(i," by exchanging SDP."))}else T.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(i," no need to exchange SDP."))}catch(h){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}stopReceiving(i){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");o.remoteSDP.stopSending(i);const a=o.remoteSDP.toString(),l=o.logSDPExchange(a,"offer","remote","stopReceiving");yield o.setRemoteDescription({type:"offer",sdp:a});const d=yield o.peerConnection.createAnswer();l?.(d.sdp||""),yield o.peerConnection.setLocalDescription(d)}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}})()}restartICE(i){var o=this;return L(function*(){try{if(o.store.p2pTransport===Oa.Auto&&(o.store.p2pTransport=Oa.SdRtn,ct().supportPCSetConfiguration&&o.peerConnection.setConfiguration(_T.resolvePCConfiguration(o.spec,o.store.p2pTransport))),o.restartCnt>3&&(o.restartCnt=0,ct().supportPCSetConfiguration&&o.peerConnection.setConfiguration(_T.resolvePCConfiguration(o.spec,o.store.p2pTransport,++o.curTurnServerIndex))),!i){o.restartCnt++,o.isReady=!1;const a=yield o.peerConnection.createOffer({iceRestart:!0});if(!a.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:l}=Gd(a.sdp);return o.store.descriptionStart(),o.direction===Ni.SEND_ONLY&&(yield o.peerConnection.setLocalDescription(a)),l}if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(o.remoteSDP.restartICE(i),o.store.descriptionStart(),o.direction===Ni.RECEIVE_ONLY){o.restartCnt++,yield o.setRemoteDescription({type:"offer",sdp:o.remoteSDP.toString()});const a=yield o.peerConnection.createAnswer();if(!a.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:l}=Gd(a.sdp);return yield o.peerConnection.setLocalDescription(a),l}yield o.setRemoteDescription({type:"answer",sdp:o.remoteSDP.toString()}),o.isReady=!0}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}})()}close(){var i;this.peerConnection.close(),this.peerConnection.onicecandidate=null,null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}updateEncoderConfig(i,o){var a=this;return L(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const l=yield a.peerConnection.createOffer(),d=a.mungSendOfferSDP(l.sdp,[o],[i]);a.remoteSDP.updateRecvMedia(i,o);const h=a.remoteSDP.toString(),f=a.logSDPExchange(d,"offer","local","updateEncoderConfig");yield a.peerConnection.setLocalDescription({type:"offer",sdp:d}),f?.(h),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(l){throw new Y(k.EXCHANGE_SDP_FAILED,l.toString())}})()}updateSendParameters(i,o){var a=this;return L(function*(){const l=a.peerConnection.getTransceivers().filter(d=>d.mid===i);1===l.length&&(a.isVP8Simulcast(o)?hn()||(yield a.applySimulcastEncodings(l,[o])):yield a.applySendEncodings(l,[o]))})()}setStatsRemoteVideoIsReady(i,o){this.statsFilter.setVideoIsReady2(i,o)}replaceTrack(i,o){var a=this;return L(function*(){const l=a.peerConnection.getTransceivers().find(d=>d.mid===o);l&&(yield l.sender.replaceTrack(i._mediaStreamTrack))})()}getSelectedCandidatePair(){var i=this;return L(function*(){const o=i.peerConnection.getReceivers();if(o.length>0&&o[0].transport&&o[0].transport.iceTransport&&o[0].transport.iceTransport.getSelectedCandidatePair&&o[0].transport.iceTransport.getSelectedCandidatePair()){const a=o[0].transport.iceTransport,{local:l,remote:d}=a.getSelectedCandidatePair();return{local:Mh(Mh({},Dc),{},{candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port}),remote:Mh(Mh({},Dc),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})}}return i.statsFilter.getSelectedCandidatePair()})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i,o;he(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)&&(this.isReady=!1),null===(o=this.onICEConnectionStateChange)||void 0===o||o.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;"connected"===this.peerConnection.connectionState&&(this.restartCnt=0),null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=i=>{var o;i.candidate?(i.candidate.candidate&&(null===(o=this.onLocalCandidate)||void 0===o||o.call(this,i.candidate.toJSON())),this.localCandidateCount+=1):T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i,o){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const l={iceServers:[]};var d;return i.iceServers?l.iceServers=i.iceServers:i.turnServer&&"off"!==i.turnServer.mode&&(pS(i.turnServer.servers)?l.iceServers=i.turnServer.servers:(l.iceServers&&l.iceServers.push(..._T.turnServerConfigToIceServers(i.turnServer.servers,o,a)),B("USE_TURN_SERVER_OF_GATEWAY")&&l.iceServers&&i.turnServer.serversFromGateway&&l.iceServers.push(..._T.turnServerConfigToIceServers(i.turnServer.serversFromGateway,o,a)),he(d=[Oa.Relay,Oa.SdRtn]).call(d,o)&&(l.iceTransportPolicy="relay"),B("FORCE_TURN_TCP")?l.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(l.iceTransportPolicy="relay")}))),B("ENABLE_ENCODED_TRANSFORM")&&ct().supportWebRTCEncodedTransform&&(l.encodedInsertableStreams=!0),T.debug("P2PConnection p2pTransport is ".concat(o)),l}static turnServerConfigToIceServers(i,o){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const l=[],d=i.filter(f=>f.tcpport);T.debug("P2PConnection turnServers is ".concat(d,", current index is ").concat(a));const h=d.length>a?d[a]:d[0];switch(o){case Oa.SdRtn:const f=i.filter(g=>{var v;return he(v=g.username).call(v,"glb:")&&g.turnServerURL==g.turnServerURL}),m=f.length>a?f[a]:f[0];m&&(l.push({username:m.username,credential:m.password,credentialType:"password",urls:"turn:".concat(vh(m.turnServerURL),":").concat(m.tcpport,"?transport=udp")}),l.push({username:m.username,credential:m.password,credentialType:"password",urls:"turns:".concat(vh(m.turnServerURL),":").concat(m.tcpport,"?transport=tcp")}));break;case Oa.Relay:h&&(l.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),l.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(vh(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(l.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),l.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(vh(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),l.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return l}tryBindTransportEvents(i){if(i){this.transport=i,i.onstatechange=()=>{var a;null!=i&&i.state&&(null===(a=this.onDTLSTransportStateChange)||void 0===a||a.call(this,i.state))},i.onerror=a=>{var l;null===(l=this.onDTLSTransportError)||void 0===l||l.call(this,"error"in a?a.error:a)};const o=i.iceTransport;o&&(o.onstatechange=()=>{const a=i?.iceTransport.state;var l;a&&(null===(l=this.onICETransportStateChange)||void 0===l||l.call(this,a))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:a,remote:l}=o.getSelectedCandidatePair();T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol}),", remote ").concat(JSON.stringify({candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(i,o){var a=this;return L(function*(){var l;if(o||(o=a.peerConnection.getSenders().find(y=>y.track===i._mediaStreamTrack)),!o)return T.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(a.isVP8Simulcast(i))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ct().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(i._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(i._encoderConfig){var f;const{bitrateMax:y,frameRate:b,scaleResolutionDownBy:C}=i._encoderConfig;y&&(h.maxBitrate=1e3*y),he(f=i._hints).call(f,zt.LOW_STREAM)&&(b&&(h.maxFramerate=Pi(b)),C&&C>=1&&(h.scaleResolutionDownBy=C))}if(B("DSCP_TYPE")&&pl()){var m;const y=B("DSCP_TYPE");he(m=["very-low","low","medium","high"]).call(m,y)&&(h.networkPriority=y)}const g=o.getParameters(),v=null===(l=g.encodings)||void 0===l?void 0:l[0];hn()&&!v&&(d.encodings=[h]),v&&Object.assign(v,h),Object.assign(g,d),T.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),yield o.setParameters(g)})()}applySendEncodings(i,o){var a=this;return L(function*(){try{if(!ct().supportSetRtpSenderParameters||i.length!==o.length)return;for(let l=0;l<i.length;l++){const d=i[l],h=o[l];h instanceof Ve&&!a.isVP8Simulcast(h)&&(yield a.updateRtpSenderEncodings(h,d.sender))}}catch{T.debug("[".concat(a.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(i,o,a){const l=vr.parse(i);return o.forEach((d,h)=>{const f=a[h],m=l.mediaDescriptions.find(g=>g.attributes.mid===f);m&&(Kf(m,d),Ac(m,d,this.store.codec))}),vr.print(l)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var o;null===(o=this.onFirstAudioReceived)||void 0===o||o.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var o;null===(o=this.onFirstVideoReceived)||void 0===o||o.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var o;null===(o=this.onFirstAudioDecoded)||void 0===o||o.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,o,a)=>{var l;null===(l=this.onFirstVideoDecoded)||void 0===l||l.call(this,i,o,a)},this.statsFilter.onSelectedLocalCandidateChanged=(i,o)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,i,o)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,o)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,i,o)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var o;null===(o=this.onFirstVideoDecodedTimeout)||void 0===o||o.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(i,o){var a=this;return L(function*(){if(i.length===o.length)for(let g=0;g<i.length;g++){var l,d,h,f,m;const v=i[g],y=o[g];if(y instanceof Ve&&!he(l=y._hints).call(l,zt.LOW_STREAM)&&null!==(d=y._encoderConfig)&&void 0!==d&&d.bitrateMax&&(null===(h=y._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(f=y._scalabilityMode)&&void 0!==f&&f.numSpatialLayers&&(null===(m=y._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===a.store.codec){const b={},C={high:1e3*(y._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{rid:"m",active:!0,maxBitrate:C.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:C.high}];const P=v.sender.getParameters();yield v.sender.setParameters(Object.assign(P,b))}}})()}applySimulcastEncodings(i,o){var a=this;return L(function*(){if(!hn()&&i.length===o.length)for(let l=0;l<i.length;l++){const d=o[l];if(d instanceof Ve&&a.isVP8Simulcast(d)){const h=i[l],f={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=h.sender.getParameters();yield h.sender.setParameters(Object.assign(g,f))}}})()}isVP8Simulcast(i){var o,a,l,d,h;return!!(i instanceof Ve&&B("SIMULCAST")&&"vp8"===this.store.codec&&!he(o=i._hints).call(o,zt.LOW_STREAM)&&null!==(a=i._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(l=i._encoderConfig)||void 0===l?void 0:l.bitrateMax)>200&&null!==(d=i._scalabilityMode)&&void 0!==d&&d.numSpatialLayers&&(null===(h=i._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(i,o,a,l){if(B("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(o," SDP during P2PConnection.").concat(l,"\n"),i),"offer"===o?d=>{this.logSDPExchange(d,"answer","local"===a?"remote":"local",l)}:void 0}muteLocal(i){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const a=o.peerConnection.getTransceivers().filter(f=>f.mid&&-1!==i.indexOf(f.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(f=>{f.direction="inactive"});const l=yield o.peerConnection.createOffer(),d=o.logSDPExchange(l.sdp||"","offer","local","muteLocal");yield o.peerConnection.setLocalDescription(l),o.remoteSDP.muteRemote(i);const h=o.remoteSDP.toString();d?.(h),yield o.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(a.toString()))}})()}unmuteLocal(i){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const a=o.peerConnection.getTransceivers().filter(f=>f.mid&&-1!==i.indexOf(f.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(function(){var f=L(function*(m){m.direction="sendonly"});return function(m){return f.apply(this,arguments)}}());const l=yield o.peerConnection.createOffer(),d=o.logSDPExchange(l.sdp||"","offer","local","unmuteLocal");yield o.peerConnection.setLocalDescription(l),o.remoteSDP.unmuteRemote(i);const h=o.remoteSDP.toString();d?.(h),yield o.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(a.toString()))}})()}getRemoteSSRC(i,o){var a=this;return L(function*(){var l,d;if(o=null!==(l=o)&&void 0!==l?l:null===(d=a.currentRemoteDescription)||void 0===d?void 0:d.sdp){var h;const f=null===(h=vr.parse(o).mediaDescriptions.find(m=>m.attributes.mid===i))||void 0===h?void 0:h.attributes.ssrcs;return f?.[0].ssrcId}})()}setRemoteDescription(i){var o=this;return L(function*(){var a;yield o.peerConnection.setRemoteDescription(i),he(a=["connected","completed"]).call(a,o.peerConnection.iceConnectionState)||(o.isReady=!0,o.addRemoteCandidate())})()}mungReceiveAnswerSDP(i,o,a){const l=vr.parse(i),d=l.mediaDescriptions.find(h=>h.attributes.mid===o);return d&&a===_e.AUDIO&&"audio"===d.media.mediaType&&Nl(d),vr.print(l)}},pe(Xt.prototype,"establish",[xo],Object.getOwnPropertyDescriptor(Xt.prototype,"establish"),Xt.prototype),pe(Xt.prototype,"connect",[xo],Object.getOwnPropertyDescriptor(Xt.prototype,"connect"),Xt.prototype),pe(Xt.prototype,"receive",[xo],Object.getOwnPropertyDescriptor(Xt.prototype,"receive"),Xt.prototype),pe(Xt.prototype,"mockReceive",[xo],Object.getOwnPropertyDescriptor(Xt.prototype,"mockReceive"),Xt.prototype),pe(Xt.prototype,"stopReceiving",[xo],Object.getOwnPropertyDescriptor(Xt.prototype,"stopReceiving"),Xt.prototype),pe(Xt.prototype,"restartICE",[xo],Object.getOwnPropertyDescriptor(Xt.prototype,"restartICE"),Xt.prototype),pe(Xt.prototype,"close",[xo],Object.getOwnPropertyDescriptor(Xt.prototype,"close"),Xt.prototype),pe(Xt.prototype,"updateEncoderConfig",[xo],Object.getOwnPropertyDescriptor(Xt.prototype,"updateEncoderConfig"),Xt.prototype),pe(Xt.prototype,"updateSendParameters",[xo],Object.getOwnPropertyDescriptor(Xt.prototype,"updateSendParameters"),Xt.prototype),pe(Xt.prototype,"replaceTrack",[xo],Object.getOwnPropertyDescriptor(Xt.prototype,"replaceTrack"),Xt.prototype),pe(Xt.prototype,"muteLocal",[xo],Object.getOwnPropertyDescriptor(Xt.prototype,"muteLocal"),Xt.prototype),pe(Xt.prototype,"unmuteLocal",[xo],Object.getOwnPropertyDescriptor(Xt.prototype,"unmuteLocal"),Xt.prototype),Xt);function xo(r,i,o){const a=r[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return o.value=L(function*(){const l=this.mutex,d=yield l.lock("From P2PConnection.".concat(i));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return yield a.apply(this,f)}finally{d()}}),o}function j2(r,i){let o=document.createElement("video"),a=document.createElement("canvas");o.setAttribute("style","display:none"),a.setAttribute("style","display:none"),o.setAttribute("muted",""),o.muted=!0,o.setAttribute("autoplay",""),o.autoplay=!0,o.setAttribute("playsinline",""),a.width=Pi(i.width),a.height=Pi(i.height);const l=Pi(i.framerate||15);document.body.append(o),document.body.append(a);let d=r._mediaStreamTrack;o.srcObject=new MediaStream([d]),o.play();const h=a.getContext("2d");if(!h)throw new K(k.UNEXPECTED_ERROR,"can not get canvas context");const f=ct(),m=a.captureStream(f.supportRequestFrame?0:l).getVideoTracks()[0];m.canvas||(m.canvas=a),a.startCapture=()=>{if(!o)return a.stopCapture&&a.stopCapture();if(o.paused&&o.play(),o.videoHeight>2&&o.videoWidth>2){const b=a.width*(o.videoHeight/o.videoWidth);Math.abs(b-a.height)>=2&&(T.debug("adjust low stream resolution","".concat(a.width,"x").concat(a.height," -> ").concat(a.width,"x").concat(b)),a.height=b)}h.drawImage(o,0,0,a.width,a.height),m.requestFrame&&m.requestFrame(),d!==r._mediaStreamTrack&&(d=r._mediaStreamTrack,o.srcObject=new MediaStream([d]))},a.stopCapture=Sx(()=>a.startCapture&&a.startCapture(),l);const g=m.stop;return m.stop=()=>{g.call(m),o&&(o.remove(),o.srcObject=null,o=null),a&&(a.width=0,a.remove(),a.stopCapture&&a.stopCapture(),a.startCapture=void 0,a.stopCapture=void 0,a=null),T.debug("clean low stream renderer")},m}var kh=function(r){return r[r.HEIGHT=2033]="HEIGHT",r[r.FRAME_RATE=2034]="FRAME_RATE",r[r.WIDTH=2035]="WIDTH",r}(kh||{}),Xn=function(r){return r[r.FRAME_RATE=2002]="FRAME_RATE",r[r.WIDTH=2003]="WIDTH",r[r.HEIGHT=2004]="HEIGHT",r[r.PACKAGE_LOST=2005]="PACKAGE_LOST",r[r.AVG_ENCODE=2007]="AVG_ENCODE",r[r.NACKS=2009]="NACKS",r[r.PLIS=2010]="PLIS",r[r.FIRS=2011]="FIRS",r[r.BITRATE=2012]="BITRATE",r[r.PACKAGE_RATE=2031]="PACKAGE_RATE",r[r.ADAPTATION=2032]="ADAPTATION",r[r.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",r[r.BANDWIDTH=2061]="BANDWIDTH",r[r.RETRANSMIT=2062]="RETRANSMIT",r[r.TARGET_ENCODED=2064]="TARGET_ENCODED",r[r.TRANSMIT=2066]="TRANSMIT",r[r.FREEZE=2082]="FREEZE",r[r.DISABLED=2095]="DISABLED",r[r.PLAYER_STATUS=2128]="PLAYER_STATUS",r[r.QP_SUM=2143]="QP_SUM",r[r.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",r[r.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",r[r.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",r[r.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",r}(Xn||{}),zd=function(r){return r[r.BITRATE=2069]="BITRATE",r[r.PACKAGE_LOST=2070]="PACKAGE_LOST",r[r.PACKAGE_RATE=2071]="PACKAGE_RATE",r[r.HEIGHT=2073]="HEIGHT",r[r.FRAME_RATE=2075]="FRAME_RATE",r[r.WIDTH=2077]="WIDTH",r}(zd||{}),zn=function(r){return r[r.JITTER=-1]="JITTER",r[r.PACKAGE_LOST=2014]="PACKAGE_LOST",r[r.WIDTH=2018]="WIDTH",r[r.HEIGHT=2019]="HEIGHT",r[r.FRAME_RATE=2020]="FRAME_RATE",r[r.JITTER_BUFFER=2023]="JITTER_BUFFER",r[r.CURRENT_DELAY=2024]="CURRENT_DELAY",r[r.NACKS=2026]="NACKS",r[r.PLIS=2027]="PLIS",r[r.FIRS=2028]="FIRS",r[r.BITRATE=2029]="BITRATE",r[r.PACKAGE_RATE=2078]="PACKAGE_RATE",r[r.FREEZE=2084]="FREEZE",r[r.DISABLED=2101]="DISABLED",r[r.PLAYER_STATUS=2129]="PLAYER_STATUS",r[r.QP_SUM=2144]="QP_SUM",r[r.I_FRAME_DELAY=2149]="I_FRAME_DELAY",r[r.FRAMES_DROPPED=2181]="FRAMES_DROPPED",r[r.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",r[r.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",r[r.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",r[r.AVG_DECODE=2200]="AVG_DECODE",r[r.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",r[r.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",r[r.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",r[r.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",r}(zn||{}),Lh=function(r){return r[r.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",r[r.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",r[r.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",r[r.FREEZE_TIME=2109]="FREEZE_TIME",r[r.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",r[r.FREEZE_DURATION=2156]="FREEZE_DURATION",r}(Lh||{}),$f=function(r){return r[r.PCM_LEVEL=2104]="PCM_LEVEL",r}($f||{}),ra=function(r){return r[r.PACKAGE_LOST=-1]="PACKAGE_LOST",r[r.LEVEL=2038]="LEVEL",r[r.BITRATE=2039]="BITRATE",r[r.PACKAGE_RATE=2040]="PACKAGE_RATE",r[r.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",r[r.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",r[r.FREEZE=2081]="FREEZE",r[r.DISABLED=2096]="DISABLED",r[r.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",r[r.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",r}(ra||{}),Fo=function(r){return r[r.BITRATE=2044]="BITRATE",r[r.PACKAGE_LOST=2045]="PACKAGE_LOST",r[r.PACKAGE_RATE=2046]="PACKAGE_RATE",r[r.CURRENT_DELAY=2047]="CURRENT_DELAY",r[r.JITTER_BUFFER=2054]="JITTER_BUFFER",r[r.JITTER=2055]="JITTER",r[r.FREEZE=2083]="FREEZE",r[r.DISABLED=2102]="DISABLED",r[r.PCM_LEVEL=2105]="PCM_LEVEL",r[r.PLAYER_STATUS=2130]="PLAYER_STATUS",r[r.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",r[r.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",r[r.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",r[r.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",r[r.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",r}(Fo||{}),H2=function(r){return r[r.FREEZE_TIME=-1]="FREEZE_TIME",r[r.LEVEL=2043]="LEVEL",r}(H2||{}),Uo=function(r){return r[r.RTT=2006]="RTT",r[r.CONN_TYPE=801]="CONN_TYPE",r[r.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",r}(Uo||{});const Kd=1e3;function Ne(r,i,o){null!=o&&Number.isFinite(o)&&(r[i]=Math.round(Math.max(0,o)))}function G2(r){const i={[Uo.CONN_TYPE]:0,[Uo.RTT]:r.rtt,[Uo.STATS_UPDATE_INTERVAL]:r.updateInterval?Math.round(Math.max(0,r.updateInterval)):void 0};switch(r.selectedCandidatePair.localCandidate.candidateType){case"relay":{const o=r.selectedCandidatePair.localCandidate.relayProtocol;"udp"===o&&(i[Uo.CONN_TYPE]=1),"tcp"===o&&(i[Uo.CONN_TYPE]=3),"tls"===o&&(i[Uo.CONN_TYPE]=4);break}case"srflx":i[Uo.CONN_TYPE]=2}return i}function W2(r){let i=0;switch(r){case"none":i=0;break;case"cpu":i=1;break;case"bandwidth":i=2;break;case"other":i=3}return i}class vH extends nn{constructor(i){super(),N(this,"store",void 0),N(this,"uploadWRTCStatsTimer",void 0),N(this,"uploadOutboundDenoiserStatsTimer",void 0),N(this,"uploadExtStatsTimer",void 0),N(this,"uploadExtUsageStatsTimer",void 0),N(this,"uploadInboundExtStatsTimer",void 0),N(this,"requestStats",void 0),N(this,"requestTransportStats",void 0),N(this,"requestLocalMedia",void 0),N(this,"requestRemoteMedia",void 0),N(this,"requestAllTracks",void 0),N(this,"requestVideoIsReady",void 0),N(this,"requestUploadStats",void 0),N(this,"requestUpload",void 0),N(this,"uploadOutboundStarted",!1),N(this,"uploadInboundStarted",!1),N(this,"uploadTransportStarted",!1),N(this,"uploadExtensionUsageStarted",!1),N(this,"lastRecvStats",void 0),N(this,"lastSendStats",void 0),N(this,"lastFullRecvStats",void 0),N(this,"lastFullSendStats",void 0),N(this,"needUploadRenderFreezeTime",!0),this.store=i}uploadWRTCStats(i){if(!this.requestStats||!this.requestUploadStats)return;let o,a;if(this.uploadTransportStarted&&(o=this.requestStats(),this.store.useP2P&&(a=this.requestStats(!0))),!o&&this.uploadOutboundStarted&&(o=this.requestStats()),!a&&this.uploadInboundStarted&&(a=this.requestStats(!0)),o||a){const l={};if(this.uploadTransportStarted&&o){const d=this.getTransportStats(o,a,i);d&&(l.misc=[d])}if(this.uploadOutboundStarted&&o){const d=this.getOutboundStats(o,i?this.lastSendStats:this.lastFullSendStats,i);d&&(l.outbound=[d])}if(this.uploadInboundStarted&&a){const d=this.getInboundStats(a,i?this.lastRecvStats:this.lastFullRecvStats,i);d&&(l.inbound=d)}this.requestUploadStats(l)}this.lastRecvStats=a,this.lastSendStats=o,i||(this.lastFullRecvStats=a,this.lastFullSendStats=o)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let i=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(3!==i),4==++i&&(i=1)},Kd)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(i,o,a){if(!this.requestStats)return;if(a)return null==i.rtt?void 0:{addition:{[Uo.RTT]:i.rtt,[Uo.CONN_TYPE]:void 0,[Uo.STATS_UPDATE_INTERVAL]:i.updateInterval||void 0}};const l=G2(i);if(this.store.useP2P){if(o){const d=G2(o);l[Uo.CONN_TYPE]+=d[Uo.CONN_TYPE]<<3}l[Uo.CONN_TYPE]+=110}else l[Uo.CONN_TYPE]+=100;return{addition:l}}getOutboundStats(i,o,a){if(!this.requestUploadStats||!this.requestLocalMedia)return;const l=this.requestLocalMedia();if(!l||0===l.length)return;let d,h,f;return l.forEach(m=>{let[g,{track:v,ssrcs:y}]=m;switch(g){case ee.LocalVideoLowTrack:case ee.LocalVideoTrack:if(g===ee.LocalVideoTrack){const b=function(R,A,O,M,x){const j=A.videoSend.find(Ce=>Ce.ssrc===R);if(!j)return;const W={},{sentFrame:q,inputFrame:te}=j;if(te&&q&&(W[Xn.FREEZE]=function(ut,Nt){let _n=!0;return _n=!(ut<=5)&&(ut<=10?Nt<3:ut<=20?Nt<4:Nt<5),_n}(te.frameRate,q.frameRate)?1:0),Ne(W,Xn.QP_SUM,j.qpSumPerFrame),x)return W;switch(q&&(Ne(W,Xn.HEIGHT,q.height),Ne(W,Xn.WIDTH,q.width),Ne(W,Xn.FRAME_RATE,q.frameRate)),W[Xn.DISABLED]=M._originMediaStreamTrack&&!M._originMediaStreamTrack.enabled||M._mediaStreamTrack&&!M._mediaStreamTrack.enabled?1:0,j.adaptionChangeReason){case"none":W[Xn.ADAPTATION]=0;break;case"cpu":W[Xn.ADAPTATION]=1;break;case"bandwidth":W[Xn.ADAPTATION]=2;break;case"other":W[Xn.ADAPTATION]=3}let J=0;j.adaptionChangeReason&&(J+=W2(j.adaptionChangeReason)),A.qualityLimitationReason&&(J+=W2(A.qualityLimitationReason)<<3),W[Xn.ADAPTATION]=J,W[Xn.PLAYER_STATUS]=Ex[M._player?M._player.videoElementStatus:"uninit"],Ne(W,Xn.NACKS,j.nacksCount),Ne(W,Xn.PLIS,j.plisCount),Ne(W,Xn.FIRS,j.firsCount),Ne(W,Xn.AVG_ENCODE,j.avgEncodeMs),Ne(W,Xn.HUGE_FRAME_SENT,j.hugeFramesSent),Ne(W,Xn.BYTES_RETRANSMIT,j.retransmittedBytesSent),Ne(W,Xn.PACKAGES_RETRANSMIT,j.retransmittedPacketsSent),Ne(W,Xn.KEY_FRAMES_ENCODED,j.keyFramesEncoded);const X=O&&O.videoSend.find(Ce=>Ce.ssrc===R);if(X){let Ce=x?Kd:3e3;X.timestamp&&j.timestamp&&(Ce=j.timestamp-X.timestamp),null!=X.packets&&null!=j.packets&&Ne(W,Xn.PACKAGE_RATE,1e3*(j.packets-X.packets)/Ce),null!=j.packetsLost&&null!=X.packetsLost&&Ne(W,Xn.PACKAGE_LOST,j.packetsLost-X.packetsLost),null!=X.bytes&&null!=j.bytes&&Ne(W,Xn.BITRATE,8*(j.bytes-X.bytes)/Ce)}return W}(y[0].ssrcId,i,o,v,a),C=a?null:function(R,A,O){const M=A.videoSend.find(J=>J.ssrc===R);if(!M)return null;const x={},j=M.inputFrame,q=j&&j.width||O&&O.videoWidth||0,te=j&&j.frameRate||0;return Ne(x,kh.HEIGHT,j&&j.height||O&&O.videoHeight||0),Ne(x,kh.WIDTH,q),Ne(x,kh.FRAME_RATE,te),x}(y[0].ssrcId,i,v),P=a?null:function(R){const A={};return Ne(A,Xn.RETRANSMIT,R.bitrate.retransmit),Ne(A,Xn.TARGET_ENCODED,R.bitrate.targetEncoded),Ne(A,Xn.ACTUAL_ENCODED,R.bitrate.actualEncoded),Ne(A,Xn.TRANSMIT,R.bitrate.transmit),Ne(A,Xn.BANDWIDTH,R.sendBandwidth),A}(i);h=Object.assign({},b,C,P)}else f=a?void 0:function(b,C,P){const R=C.videoSend.find(M=>M.ssrc===b);if(!R)return;const A={},O=R.sentFrame;if(O&&(Ne(A,zd.HEIGHT,O.height),Ne(A,zd.WIDTH,O.width),Ne(A,zd.FRAME_RATE,O.frameRate)),P){const M=P.videoSend.find(x=>x.ssrc===b);if(M){let x=3e3;M.timestamp&&R.timestamp&&(x=R.timestamp-M.timestamp),null!=M.packets&&null!=R.packets&&Ne(A,zd.PACKAGE_RATE,1e3*(R.packets-M.packets)/x),null!=R.packetsLost&&null!=M.packetsLost&&Ne(A,zd.PACKAGE_LOST,R.packetsLost-M.packetsLost),null!=M.bytes&&null!=R.bytes&&Ne(A,zd.BITRATE,8*(R.bytes-M.bytes)/x)}}return A}(y[0].ssrcId,i,o);break;case ee.LocalAudioTrack:d=a?void 0:function(b,C,P,R){const A=C.audioSend.find(W=>W.ssrc===b);if(!A)return;const O={};O[ra.DISABLED]=R._originMediaStreamTrack&&!R._originMediaStreamTrack.enabled||R._mediaStreamTrack&&!R._mediaStreamTrack.enabled?1:0;const M=100*R._source.getAccurateVolumeLevel(),x=A.inputLevel;if(null!=x){const W=Math.ceil(50*Math.log10(100*x+1));Ne(O,ra.LEVEL,W)}else Ne(O,ra.LEVEL,M);Ne(O,$f.PCM_LEVEL,M),Ne(O,ra.AEC_RETURN_LOSS,A.aecReturnLoss),Ne(O,ra.AEC_RETURN_LOSS_ENH,A.aecReturnLossEnhancement),Ne(O,ra.BYTES_RETRANSMIT,A.retransmittedBytesSent),Ne(O,ra.PACKAGES_RETRANSMIT,A.retransmittedPacketsSent),O[ra.FREEZE]=0;const j=P&&P.audioSend.find(W=>W.ssrc===b);if(j){let W=3e3;j.timestamp&&A.timestamp&&(W=A.timestamp-j.timestamp),null!=j.bytes&&null!=A.bytes&&Ne(O,ra.BITRATE,8*(A.bytes-j.bytes)/W),null!=j.packets&&null!=A.packets&&Ne(O,ra.PACKAGE_RATE,1e3*(A.packets-j.packets)/W)}return O}(y[0].ssrcId,i,o,v)}}),{high:h,low:f,audio:d}}getInboundStats(i,o,a){if(!this.requestRemoteMedia)return;const l=this.requestRemoteMedia()||[],d=[];return l.forEach(h=>{let[f,m]=h;const g={peer:f.uid};if(m.has(_e.VIDEO)&&f.videoTrack){const v=f._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(f._videoSSRC)||!1,y=f.videoTrack?function(b,C,P,R,A,O,M){var x;const j=C.videoRecv.find(Re=>Re.ssrc===b);if(!j)return;const W={},{receivedFrame:q,outputFrame:te,decodeFrameRate:J}=j,X=P&&P.videoRecv.find(Re=>Re.ssrc===b);if(W[zn.FREEZE]=A&&pC.isRemoteVideoFreeze(R,j,X)?1:0,Ne(W,Lh.FRAME_RATE_DECODE,J),Ne(W,zn.QP_SUM,j.qpSumPerFrame),j.framesRateFirefox&&Ne(W,zn.FRAME_RATE,j.framesRateFirefox),q&&Ne(W,zn.FRAME_RATE,q.frameRate),Ne(W,zn.FRAMES_DROPPED,j.framesDroppedCount),Ne(W,zn.BYTES_RETRANSMIT,j.retransmittedBytesReceived),Ne(W,zn.PACKAGES_RETRANSMIT,j.retransmittedPacketsReceived),Ne(W,zn.PACKAGES_DISCARDED,j.packetsDiscarded),Ne(W,zn.AVG_DECODE,j.avgDecodeMs),Ne(W,zn.AVG_PROCESSING_DELAY,j.avgProcessingDelayMs),Ne(W,zn.AVG_ASSEMBLY_TIME,j.avgFramesAssembledFromMultiplePacketsMs),Ne(W,zn.AVG_INTER_FRAME_DELAY,j.avgInterFrameDelayMs),Ne(W,zn.KEY_FRAMES_DECODED,j.keyFramesDecoded),X){const Re=C.timestamp-P.timestamp||(M?Kd:3e3);null!=j.packetsLost&&null!=X.packetsLost&&Ne(W,zn.PACKAGE_LOST,j.packetsLost-X.packetsLost),null!=X.bytes&&null!=j.bytes&&Ne(W,zn.BITRATE,8*(j.bytes-X.bytes)/Re),null!=X.packets&&null!=j.packets&&Ne(W,zn.PACKAGE_RATE,1e3*(j.packets-X.packets)/Re)}if(M)return W;q?(Ne(W,zn.HEIGHT,q.height),Ne(W,zn.WIDTH,q.width)):R&&(Ne(W,zn.HEIGHT,R._videoHeight||0),Ne(W,zn.WIDTH,R._videoWidth||0)),te&&Ne(W,Lh.FRAME_RATE_OUTPUT,te.frameRate);const Ce=null===(x=R._player)||void 0===x?void 0:x.rendFrameRate.toFixed(0);if(Ce&&Ne(W,Lh.FRAME_RATE_RENDER,+Ce),Ne(W,zn.JITTER_BUFFER,j.jitterBufferMs),Ne(W,zn.CURRENT_DELAY,j.currentDelayMs),Ne(W,zn.FIRS,j.firsCount),Ne(W,zn.NACKS,j.nacksCount),Ne(W,zn.PLIS,j.plisCount),R){W[zn.DISABLED]=R._originMediaStreamTrack.enabled&&R._mediaStreamTrack.enabled?0:1;const Re=R._player;if(Re){const{freezeTimeCounterList:ut,renderFreezeAccTime:Nt,videoElementStatus:_n}=Re;if(ut&&ut.length>0&&Ne(W,Lh.FREEZE_TIME,ut.splice(0,1)[0]),O&&"visible"===cs.visibility&&_n===Kr.PLAYING&&ct().supportRequestVideoFrameCallback){const Zt=Math.min(6e3,Nt);Re.renderFreezeAccTime=Math.max(0,Nt-Zt),Ne(W,Lh.FREEZE_TIME_RENDER,Zt)}"number"==typeof j.totalFreezesDuration&&Ne(W,Lh.FREEZE_DURATION,1e3*(X&&X.totalFreezesDuration?j.totalFreezesDuration-X.totalFreezesDuration:j.totalFreezesDuration))}}if(W[zn.PLAYER_STATUS]=Ex[R._player?R._player.videoElementStatus:"uninit"],X&&void 0!==j.totalInterFrameDelay&&void 0!==j.totalSquaredInterFrameDelay&&void 0!==X.totalInterFrameDelay&&void 0!==X.totalSquaredInterFrameDelay){const Re=j.totalInterFrameDelay-X.totalInterFrameDelay,Nt=j.framesDecodeCount-X.framesDecodeCount,_n=Re/Nt*1e3,Zt=Math.round(1e3*Math.sqrt((j.totalSquaredInterFrameDelay-X.totalSquaredInterFrameDelay-Math.pow(Re,2)/Nt)/Nt));!isNaN(Zt)&&_n+Zt>Math.max(3*_n,_n+150)&&(W[zn.I_FRAME_DELAY]=Zt)}return W}(f._videoSSRC,i,o,f.videoTrack,!0===v,this.needUploadRenderFreezeTime,a):void 0;y&&(g.video=y)}if(m.has(_e.AUDIO)&&f.audioTrack){const v=f.audioTrack?function(y,b,C,P,R){const A=b.audioRecv.find(X=>X.ssrc===y);if(!A)return;const O={},M=C&&C.audioRecv.find(X=>X.ssrc===y),{receivedFrames:x,droppedFrames:j}=A;var W;if(Ne(O,Fo.JITTER,A.jitterMs),Ne(O,Fo.BYTES_RETRANSMIT,A.retransmittedBytesReceived),Ne(O,Fo.PACKAGES_RETRANSMIT,A.retransmittedPacketsReceived),Ne(O,Fo.PACKAGES_DISCARDED,A.packetsDiscarded),Ne(O,Fo.AVG_PROCESSING_DELAY,A.avgProcessingDelayMs),null!=x&&null!=j&&(O[Fo.FREEZE]=0===(W=x)||100*j/W>20?1:0),M){const X=b.timestamp-C.timestamp||(R?Kd:3e3);null!=A.packets&&null!=M.packets&&Ne(O,Fo.PACKAGE_RATE,1e3*(A.packets-M.packets)/X),null!=M.bytes&&null!=A.bytes&&Ne(O,Fo.BITRATE,8*(A.bytes-M.bytes)/X),null!=A.packetsLost&&null!=M.packetsLost&&Ne(O,Fo.PACKAGE_LOST,A.packetsLost-M.packetsLost)}if(R)return O;const te=100*P._source.getAccurateVolumeLevel(),J=A.outputLevel;if(null!=J){const X=Math.ceil(50*Math.log10(100*J+1));Ne(O,H2.LEVEL,X)}if(Ne(O,Fo.PCM_LEVEL,te),P&&(O[Fo.DISABLED]=P._originMediaStreamTrack.enabled&&P._mediaStreamTrack.enabled?0:1),Ne(O,Fo.JITTER_BUFFER,A.jitterBufferMs),Ne(O,Fo.CURRENT_DELAY,A.jitterBufferMs),O[Fo.PLAYER_STATUS]=Ex[Wi.getPlayerState(P.getTrackId())],M){const X=A.concealedSamples-M.concealedSamples;X>0&&Ne(O,Fo.CONCEALED_SAMPLES,X)}return O}(f._audioSSRC,i,o,f.audioTrack,a):void 0;v&&(g.audio=v)}(g.video||g.audio)&&d.push(g)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,d}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const i=(this.requestAllTracks()||[]).find(o=>o instanceof qS);if(i&&i._external.getDenoiserStats){const o=i._external.getDenoiserStats();o&&this.requestUpload(F_.DENOISER_STATS,o)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(i=>{i.getProcessorStats().forEach(o=>{this.requestUpload&&this.requestUpload(o.type,o.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(i=>{let[o,a]=i;a.has(_e.VIDEO)&&o.videoTrack&&o.videoTrack.getProcessorStats().forEach(l=>{this.requestUpload&&this.requestUpload(l.type,l.stats)}),a.has(_e.AUDIO)&&o.audioTrack&&o.audioTrack.getProcessorStats().forEach(l=>{this.requestUpload&&this.requestUpload(l.type,l.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){var i=this;if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const o=new Map;this.uploadExtUsageStatsTimer=window.setInterval(L(function*(){const a=Date.now(),l={connectionInterval:B("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:a};let d=[];const h=i.requestAllTracks&&i.requestAllTracks()||[];for(const v of h)!v.muted&&v.enabled&&(d=d.concat(yield v.getProcessorUsage()));const f=i.requestRemoteMedia&&i.requestRemoteMedia()||[];for(const[v,y]of f)y.has(_e.VIDEO)&&v.videoTrack&&(d=d.concat(yield v.videoTrack.getProcessorUsage())),y.has(_e.AUDIO)&&v.audioTrack&&(d=d.concat(yield v.audioTrack.getProcessorUsage()));if(0===d.length)return;l.details=function(v,y){const b={};for(const{id:A,value:O,level:M,direction:x}of v){var C;const j=null!==(C=y.get(A))&&void 0!==C?C:0,W=2===O?j+B("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:j;var P,R;y.set(A,W),b[A]?(2===O&&(b[A].value=O),M>b[A].level&&(b[A].level=M),"remote"===x&&(b[A].remoteUidCount+=1),b[A].totalTs=null!==(P=y.get(A))&&void 0!==P?P:0):b[A]={value:O,level:M,remoteUidCount:"local"===x?0:1,totalTs:null!==(R=y.get(A))&&void 0!==R?R:0}}return Object.keys(b).map(A=>{const{level:O,value:M,totalTs:x}=b[A];return{id:A,level:O,value:M,totalTs:x}})}(d,o);const m=Date.now();i.requestUpload&&i.requestUpload(F_.EXTENSION_USAGE_STATS,{usageStats:l,sendTs:m>a?m:a+1})}),B("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}}class xh{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(i,o){N(this,"uid",void 0),N(this,"_uintid",void 0),N(this,"_trust_in_room_",!0),N(this,"_trust_audio_enabled_state_",!0),N(this,"_trust_video_enabled_state_",!0),N(this,"_trust_audio_mute_state_",!0),N(this,"_trust_video_mute_state_",!0),N(this,"_audio_muted_",!1),N(this,"_video_muted_",!1),N(this,"_audio_enabled_",!0),N(this,"_video_enabled_",!0),N(this,"_audio_added_",!1),N(this,"_video_added_",!1),N(this,"_is_pre_created",!1),N(this,"_video_pre_subscribed",!1),N(this,"_audio_pre_subscribed",!1),N(this,"_trust_video_stream_added_state_",!0),N(this,"_trust_audio_stream_added_state_",!0),N(this,"_audioTrack",void 0),N(this,"_videoTrack",void 0),N(this,"_dataChannels",[]),N(this,"_audioSSRC",void 0),N(this,"_videoSSRC",void 0),N(this,"_audioOrtc",void 0),N(this,"_videoOrtc",void 0),N(this,"_cname",void 0),N(this,"_rtxSsrcId",void 0),N(this,"_videoMid",void 0),N(this,"_audioMid",void 0),this.uid=i,this._uintid=o}}let Ua=function(r){return r.SEND_ONLY="SEND_ONLY",r.RECEIVE_ONLY="RECEIVE_ONLY",r}({});function EH(r,i){var o;let a;switch(i){case ee.LocalAudioTrack:a=at.Audio;break;case ee.LocalVideoTrack:a=he(o=r._hints).call(o,zt.SCREEN_TRACK)?at.Screen:at.High;break;case ee.LocalVideoLowTrack:a=at.Low}return a}function ND(r){const i=ct();if(r.some(o=>o._bypassWebAudio))throw new Y(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!i.webAudioMediaStreamDest)throw new Y(k.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function z2(r,i){ND(r);const o=i||new sr;return r.forEach(a=>o.addAudioTrack(a)),o}var yH,K2,q2,Y2,bH,SH,$2,X2,Z2,CH,PD,on;function Zn(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function MD(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?Zn(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):Zn(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}let ds=(yH=Oc(Ua.SEND_ONLY),K2=Oc(Ua.SEND_ONLY),q2=Oc(),Y2=Oc(Ua.RECEIVE_ONLY),bH=Oc(Ua.RECEIVE_ONLY),SH=Oc(Ua.RECEIVE_ONLY),$2=Oc(Ua.RECEIVE_ONLY),X2=Oc(Ua.RECEIVE_ONLY),Z2=Oc(Ua.RECEIVE_ONLY),CH=Oc(),PD=Oc(Ua.RECEIVE_ONLY),on=class extends nn{get state(){return this._state}set state(r){const i=this._state;this._state=r,this.emit(De.StateChange,i,this._state)}constructor(r,i){var o;super(),o=this,N(this,"isPlanB",!1),N(this,"store",void 0),N(this,"statsUploader",void 0),N(this,"sendConnection",void 0),N(this,"recvConnection",void 0),N(this,"localTrackMap",new Map),N(this,"remoteUserMap",new Map),N(this,"localDataChannels",[]),N(this,"pendingLocalTracks",[]),N(this,"pendingRemoteTracks",[]),N(this,"statsCollector",void 0),N(this,"dtlsFailedCount",0),N(this,"sendMutex",void 0),N(this,"recvMutex",void 0),N(this,"_state",Dt.Disconnected),N(this,"_restartStates",["disconnected","failed"]),N(this,"reconnectInterval",void 0),N(this,"uploadUnplinkStarted",!1),N(this,"uploadDownlinkStarted",!1),N(this,"uplinkStateUploadInterval",void 0),N(this,"downlinkStatsUploadInterval",void 0),N(this,"handleMuteLocalTrack",function(){var a=L(function*(l,d,h){const f=yield o.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!o.sendConnection||o.state!==Dt.Connected)return void h(new Y(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const v=o.filterTobeMutedTracks(l);if(0===v.length)return void d();const y=v.find(R=>"videoLowTrack"===R[0]);y&&y[1].track._originMediaStreamTrack.stop(),yield o.sendConnection.muteLocal(v.map(R=>{let[,{id:A}]=R;return A}));let b=!1;var m,g;b="video"===l.trackMediaType?!(null===(m=o.localTrackMap.get(ee.LocalAudioTrack))||void 0===m||!m.track._muted):void 0===(null===(g=o.localTrackMap.get(ee.LocalVideoTrack))||void 0===g?void 0:g.id);const C=o.createMuteMessage(v);yield Bt(o,De.RequestMuteLocal,C);const P="video"===l.trackMediaType?kd.MUTE_LOCAL_VIDEO:kd.MUTE_LOCAL_AUDIO;yield Bt(o,De.RequestP2PMuteLocal,{action:P,message:C,isMuteAll:b}),d()}catch(v){h(v)}finally{f()}});return function(l,d,h){return a.apply(this,arguments)}}()),N(this,"handleUnmuteLocalTrack",function(){var a=L(function*(l,d,h){const f=yield o.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!o.sendConnection||o.state!==Dt.Connected)return void h(new Y(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const m=o.filterTobeUnmutedTracks(l);if(0===m.length)return void d();yield o.sendConnection.unmuteLocal(m.map(y=>{let[,{id:b}]=y;return b}));const g=o.createUnmuteMessage(m),v="video"===l.trackMediaType?kd.UNMUTE_LOCAL_VIDEO:kd.UNMUTE_LOCAL_AUDIO;yield Bt(o,De.RequestP2PMuteLocal,{action:v,message:g}),d()}catch(m){h(m)}finally{f()}});return function(l,d,h){return a.apply(this,arguments)}}()),N(this,"handleUpdateVideoEncoder",function(){var a=L(function*(l,d,h){const f=yield o.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const m=o.localTrackMap.get(ee.LocalVideoTrack);if(!o.sendConnection||!m||m.track!==l||o.state!==Dt.Connected)return void d();const{id:g,track:v}=m;g&&(yield o.sendConnection.updateSendParameters(g,v),yield o.sendConnection.updateEncoderConfig(g,v),o.emit(De.UpdateVideoEncoder,v)),d()}catch(m){h(m)}finally{f()}});return function(l,d,h){return a.apply(this,arguments)}}()),N(this,"handleUpdateVideoSendParameters",function(){var a=L(function*(l,d,h){const f=yield o.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const m=o.localTrackMap.get(ee.LocalVideoTrack);if(!o.sendConnection||!m||m.track!==l||o.state!==Dt.Connected)return void d();const{id:g,track:v}=m;g&&(yield o.sendConnection.updateSendParameters(g,v)),d()}catch(m){h(m)}finally{f()}});return function(l,d,h){return a.apply(this,arguments)}}()),N(this,"handleReplaceTrack",function(){var a=L(function*(l,d,h,f){let m;T.debug("[".concat(o.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(l.getTrackId(),"]")),"boolean"==typeof f&&f||(m=yield o.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var g;const y=Array.from(o.localTrackMap.entries()).find(b=>{let[,{track:C}]=b;return l===C});if(!o.sendConnection||!y||void 0===y[1].id||o.state!==Dt.Connected)return void d();if(yield null===(g=o.sendConnection)||void 0===g?void 0:g.replaceTrack(l,y[1].id),y[0]===ee.LocalVideoTrack&&ct().supportDualStreamEncoding){const b=o.localTrackMap.get(ee.LocalVideoLowTrack);if(b){const C=l._mediaStreamTrack.clone();b.track._originMediaStreamTrack.stop(),b.track._mediaStreamTrack=C,b.track._originMediaStreamTrack=C,yield new le((P,R)=>{o.handleReplaceTrack(b.track,P,R,!0)})}}d()}catch(y){h(y)}finally{var v;null===(v=m)||void 0===v||v()}});return function(l,d,h,f){return a.apply(this,arguments)}}()),N(this,"handleGetLocalVideoStats",a=>{a(this.statsCollector.getLocalVideoTrackStats())}),N(this,"handleGetLocalAudioStats",a=>{a(this.statsCollector.getLocalAudioTrackStats())}),N(this,"handleGetRemoteVideoStats",a=>this.statsCollector.getRemoteVideoTrackStats(a.uid)[a.uid]),N(this,"handleGetRemoteAudioStats",a=>this.statsCollector.getRemoteAudioTrackStats(a.uid)[a.uid]),this.store=r,this.statsCollector=i,this.statsCollector.addP2PChannel(this),this.statsUploader=new vH(r),this.bindStatsUploaderEvents(),this.sendMutex=new Qr("P2PChannel2-send-mutex",r.clientId),this.recvMutex=new Qr("P2PChannel2-recv-mutex",r.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(a=>{a&&("disconnected"!==a.iceConnectionState&&"failed"!==a.iceConnectionState||this.handleDisconnect(a.direction))})},B("ICE_RESTART_INTERVAL"))}startP2PConnection(r,i){return L(function*(){throw new Y(k.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")})()}connect(r){return L(function*(){throw new Y(k.NOT_SUPPORTED,"p2p mode does not support connect.")})()}startP2P(r,i){var o=this;return L(function*(){let a;try{if(i){o.recvConnection&&(T.warning("[".concat(o.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),o.recvConnection.close(),o.unbindConnectionEvents(o.recvConnection)),a=yield o.recvMutex.lock("From P2PChannel.startP2P"),o.recvConnection=new B2(r,o.store,Ni.RECEIVE_ONLY),o.bindConnectionEvents(o.recvConnection);const l=yield o.recvConnection.establish(i);return{iceParameters:l.iceParameters,dtlsParameters:l.dtlsParameters,sdp:l.sdp}}{o.state=Dt.New,o.sendConnection&&(T.warning("[".concat(o.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),o.sendConnection.close(),o.unbindConnectionEvents(o.sendConnection)),a=yield o.sendMutex.lock("From P2PChannel.startP2P"),o.sendConnection=new B2(r,o.store),o.store.peerConnectionStart(),o.bindConnectionEvents(o.sendConnection);const l=yield o.sendConnection.establish();return{iceParameters:l.iceParameters,dtlsParameters:l.dtlsParameters,sdp:l.sdp}}}finally{a&&a()}})()}p2pConnect(r){var i=this;return L(function*(){if(!i.sendConnection)throw new Y(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");i.store.peerConnectionStart(),yield i.sendConnection.connect(r),i.statsUploader.startUploadTransportStats(),i.statsUploader.startUploadExtensionUsageStats(),i.state=Dt.Connected})()}addRemoteCandidate(r,i){var o=this;return L(function*(){if(i===Ni.RECEIVE_ONLY){if(!o.sendConnection)throw new Y(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");yield o.sendConnection.addRemoteCandidate(r)}else{if(!o.recvConnection)throw new Y(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");yield o.recvConnection.addRemoteCandidate(r)}})()}publish(r,i,o){var a=this;return ts(function*(){const l=yield tt(a.sendMutex.lock("From P2PChannel.publish"));try{if(!a.sendConnection||a.state!==Dt.Connected){a.throwIfTrackTypeNotMatch(r);const g=r.filter(v=>-1===a.pendingLocalTracks.indexOf(v));return void(a.pendingLocalTracks=a.pendingLocalTracks.concat(g))}a.store.pubId=a.store.pubId+1,ti.markPublishStart(a.store.clientId,a.store.pubId);const d=a.filterTobePublishedTracks(r,i,o);if(0===d.length)return void(yield tt(a.tryToUnmuteAudio(r)));d.forEach(g=>{let{track:v,type:y}=g;const b=Date.now();a.store.publish(v.getTrackId(),y===ee.LocalAudioTrack?"audio":"video",b)}),a.bindLocalTrackEvents(d);const h=yield tt(a.sendConnection.send(d.map(g=>{let{track:v}=g;return v}),a.store.codec,a.store.audioCodec)),f=(yield tt(h.next())).value,m=a.createGatewayPublishMessage(d,f);try{yield m}catch(g){throw h.throw(g),g?.code===k.WS_ABORT&&d.forEach(v=>{let{track:y}=v;-1===a.pendingLocalTracks.indexOf(y)&&a.pendingLocalTracks.push(y)}),a.unbindLocalTrackEvents(d),g}yield tt(h.next()),d.forEach(g=>{let{type:v}=g;a.statsCollector.addLocalStats(v)}),a.statsUploader.startUploadOutboundStats(),a.assignLocalTracks(d,f),d.forEach(g=>{let{track:v,type:y}=g;const b=Date.now();a.store.publish(v.getTrackId(),y===ee.LocalAudioTrack?"audio":"video",void 0,b)}),a.startUploadUplinkState()}finally{l()}})()}unpublish(r){var i=this;return L(function*(){if(!i.sendConnection||i.state!==Dt.Connected)return void(0===r.length?i.pendingLocalTracks.length=0:i.pendingLocalTracks=i.pendingLocalTracks.filter(d=>!he(r).call(r,d)));const o=i.filterTobeUnpublishedTracks(r);if(0===o.length)return;const a=o.find(d=>"videoLowTrack"===d[0]);a&&a[1].track.close();const l=i.createGatewayUnpublishMessage(o);if(yield i.sendConnection.stopSending(o.map(d=>{let[,{id:h}]=d;return h})),i.withdrawLocalTracks(o),i.unbindLocalTrackEvents(o.map(d=>{let[h,{track:f}]=d;return{type:h,track:f}})),o.forEach(d=>{let[h]=d;i.statsCollector.removeLocalStats(h)}),0===i.localTrackMap.size&&(i.statsUploader.stopUploadOutboundStats(),i.stopUploadUplinkState()),i.sendConnection&&i.state===Dt.Connected)return a&&a[1].track.close(),l;r.forEach(d=>{const h=i.pendingLocalTracks.indexOf(d);-1!==h&&i.pendingLocalTracks.splice(h,1)})})()}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const r=()=>{const i=[],o=[];Array.from(this.localTrackMap.entries()).forEach(a=>{let[l,{track:d,ssrcs:h}]=a;const f={stream_type:EH(d,l),ssrcs:h};d._muted||!d._enabled?i.push(f):o.push(f)}),i.length>0&&i.forEach(a=>{Bt(this,De.RequestMuteLocal,[a])}),o.length>0&&o.forEach(a=>{Bt(this,De.RequestUnmuteLocal,[a])})};r(),this.uplinkStateUploadInterval=window.setInterval(()=>{r()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(r){return ts(function*(){throw new Y(k.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}republish(){var r=this;return L(function*(){r.pendingLocalTracks.length>0&&(T.debug("[".concat(r.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield Gr(r,De.RequestRePublish,r.pendingLocalTracks),r.emit(De.MediaReconnectEnd,r.store.uid),r.pendingLocalTracks=[])})()}unpublishLowStream(){return L(function*(){throw new Y(k.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")})()}subscribe(r,i,o,a){var l=this;return L(function*(){var d;if(!l.recvConnection)throw new Y(k.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(d=l.remoteUserMap.get(r))&&void 0!==d&&d.has(i))return;const{track:h,mid:f,transceiver:m}=yield l.recvConnection.receive(i,[{ssrcId:o}],String(r.uid),a);i===_e.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(h):(r._audioTrack=new Ol(h,r.uid,r._uintid,l.store),T.info("[".concat(l.store.clientId,"] [").concat(l.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),m&&r._audioTrack._updateRtpTransceiver(m),l.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoSSRC=o,r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(h):(r._videoTrack=new Dh(h,r.uid,r._uintid,l.store),T.info("[".concat(l.store.clientId,"] [").concat(l.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),m&&r._videoTrack._updateRtpTransceiver(m),l.bindRemoteTrackEvents(r,r._videoTrack));const g=l.remoteUserMap.get(r);g?g.set(i,f):l.remoteUserMap.set(r,new Map([[i,f]])),l.statsCollector.addRemoteStats(r.uid),l.statsUploader.startUploadInboundStats(),l.startUploadDownlinkState();const v=l.pendingRemoteTracks.findIndex(y=>{let{user:b,kind:C}=y;return b.uid===r.uid&&i===C});-1!==v&&(l.pendingRemoteTracks.splice(v,1),l.emit(De.MediaReconnectEnd,r.uid))})()}mockSubscribe(r,i,o,a){var l=this;return L(function*(){if(!l.recvConnection)throw new Y(k.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");yield l.recvConnection.mockReceive(i,[{ssrcId:o}],String(r.uid),a)})()}unsubscribe(r,i,o){var a=this;return L(function*(){const l=a.pendingRemoteTracks.filter(h=>{let{user:f,kind:m}=h;return void 0!==i?f.uid===r.uid&&i===m:f.uid===r.uid});if(l.forEach(h=>{const f=a.pendingRemoteTracks.indexOf(h);a.pendingRemoteTracks.splice(f,1)}),a.recvConnection||o||l.forEach(h=>{let{kind:f}=h;var m;if(f===_e.AUDIO)null===(m=r._audioTrack)||void 0===m||m._destroy(),r._audioTrack=void 0;else if(f===_e.VIDEO){var g;null===(g=r._videoTrack)||void 0===g||g._destroy(),r._videoTrack=void 0}}),!a.recvConnection)return;const d=a.filterTobeUnSubscribedTracks(r,i);0!==d.length&&(yield a.recvConnection.stopReceiving(d.map(h=>{let[,{id:f}]=h;return f})),a.withdrawRemoteTracks(d),0===a.remoteUserMap.size&&(a.statsUploader.stopUploadInboundStats(),a.stopUploadDownlinkState()),d.forEach(h=>{let[f,{kind:m}]=h;var g,v;if(m===_e.VIDEO&&f._videoSSRC&&(null===(g=a.recvConnection)||void 0===g||g.setStatsRemoteVideoIsReady(f._videoSSRC,!1)),m===_e.VIDEO)a.unbindRemoteTrackEvents(f._videoTrack),o||(null===(v=f._videoTrack)||void 0===v||v._destroy(),f._videoTrack=void 0);else if(m===_e.AUDIO){var y;a.unbindRemoteTrackEvents(f._audioTrack),!o&&(null===(y=f._audioTrack)||void 0===y||y._destroy(),f._audioTrack=void 0)}}),d.forEach(h=>{let[,{kind:f}]=h;Bt(a,De.RequestP2PMuteRemote,f)}))})()}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const r=()=>Array.from(this.remoteUserMap.entries()).forEach(i=>{let[,o]=i;[_e.VIDEO,_e.AUDIO].forEach(a=>{o.has(a)?Bt(this,De.RequestP2PUnmuteRemote,a):Bt(this,De.RequestP2PMuteRemote,a)})});r(),this.downlinkStatsUploadInterval=window.setInterval(()=>{r()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}massSubscribe(r){return L(function*(){throw new Y(k.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")})()}massSubscribeNoLock(r){return L(function*(){throw new Y(k.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")})()}massUnsubscribe(r){return L(function*(){throw new Y(k.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")})()}massUnsubscribeNoLock(r){return L(function*(){throw new Y(k.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")})()}muteRemote(r,i){var o=this;return L(function*(){if(!o.recvConnection)return;const a=o.remoteUserMap.get(r);if(!a)return void T.warning("[".concat(o.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(r.uid,"."));if(!a.get(i))return void T.warning("[".concat(o.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(r.uid," media type ").concat(i,"."));const l=i===_e.VIDEO?r._videoSSRC:r._audioSSRC;void 0!==l&&o.recvConnection.setStatsRemoteVideoIsReady(l,!1)})()}unmuteRemote(r,i){var o=this;return L(function*(){return o.unmuteRemoteNoLock(r,i)})()}unmuteRemoteNoLock(r,i){var o=this;return L(function*(){if(!o.recvConnection)return;const a=o.remoteUserMap.get(r);a?a.get(i)||T.warning("[".concat(o.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(r.uid," media type ").concat(i,".")):T.warning("[".concat(o.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(r.uid,"."))})()}getAllTracks(r){const i=this.localTrackMap.get(ee.LocalAudioTrack);if(i?.track instanceof sr){const o=i.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[l]=a;return l!==ee.LocalAudioTrack}).filter(a=>{let[l]=a;return!(r&&l===ee.LocalVideoLowTrack)}).map(a=>{let[,{track:l}]=a;return l}).concat(o.trackList)}return Array.from(this.localTrackMap.entries()).filter(o=>{let[a]=o;return!(r&&a===ee.LocalVideoLowTrack)}).map(o=>{let[,{track:a}]=o;return a})}reportPublishEvent(r,i,o,a,l){if(r){const h=this.localTrackMap.get(ee.LocalAudioTrack),f=this.localTrackMap.get(a?ee.LocalVideoLowTrack:ee.LocalVideoTrack);be.publish(this.store.sessionId,{eventElapse:ti.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:r,ec:i,audioName:h?.track.getTrackLabel(),videoName:f?.track.getTrackLabel(),screenshare:-1!==f?.track._hints.indexOf(zt.SCREEN_TRACK),audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:l})}else{var d;o||(o=[]);const h=o.find(m=>m instanceof Cn),f=a?null===(d=this.localTrackMap.get(ee.LocalVideoTrack))||void 0===d?void 0:d.track:o.find(m=>m instanceof Ve);be.publish(this.store.sessionId,{eventElapse:ti.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:r,ec:i,audioName:h?.getTrackLabel(),videoName:f?.getTrackLabel(),screenshare:-1!==f?._hints.indexOf(zt.SCREEN_TRACK),audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:l})}}reportSubscribeEvent(r,i,o,a){const l=a===_e.VIDEO?o._videoSSRC:o._audioSSRC;l&&be.subscribe(this.store.sessionId,{succ:r,ec:i,video:a===_e.VIDEO,audio:a===_e.AUDIO,peerid:o.uid,subscribeRequestid:a===_e.VIDEO?o._videoSSRC:o._audioSSRC,p2pid:this.store.p2pId,eventElapse:ti.measureFromSubscribeStart(this.store.clientId,l)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Qr("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Qr("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const r=this.localTrackMap.get(ee.LocalAudioTrack);if(r?.track instanceof sr){if(r.track.trackList.length>0){const i=r.track;r.track.trackList.forEach(o=>{i.removeAudioTrack(o)})}r.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Dt.Disconnected}getStats(r){var i,o;return r?null===(o=this.recvConnection)||void 0===o?void 0:o.getStats():null===(i=this.sendConnection)||void 0===i?void 0:i.getStats()}getRemoteVideoIsReady(r){var i;return(null===(i=this.recvConnection)||void 0===i?void 0:i.getRemoteVideoIsReady(r))||!1}getLocalAudioVolume(){const r=this.localTrackMap.get(ee.LocalAudioTrack);if(r)return r.track.getVolumeLevel()}getLocalVideoSize(){const r=this.localTrackMap.get(ee.LocalVideoTrack);if(r)return{width:r.track.videoWidth||0,height:r.track.videoHeight||0}}getEncoderConfig(r){const i=this.localTrackMap.get(r);return i&&i.track instanceof Ve||i&&i.track instanceof Cn?i.track._encoderConfig:void 0}getLocalMedia(r){return this.localTrackMap.get(r)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(r,i){if(!r)return this.remoteUserMap.size>0;const o=this.remoteUserMap.get(r);return!!o&&(!i||o.has(i))}hasRemoteMediaWithLock(r,i){var o=this;return L(function*(){if(!r)return o.remoteUserMap.size>0;const a=o.remoteUserMap.get(r);return!!a&&(!i||a.has(i))})()}getRemoteMedia(r){var i;const o=Array.from(wo(i=this.remoteUserMap).call(i)).find(a=>a.uid===r);return o?{audioTrack:o.audioTrack,audioSSRC:o._audioSSRC,videoTrack:o.videoTrack,videoSSRC:o._videoSSRC}:{}}getAudioLevels(){let r=Array.from(this.remoteUserMap.entries()).map(o=>{let[a]=o;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}});const i=this.localTrackMap.get(ee.LocalAudioTrack);return i&&r.push({level:100*i.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),r=md(r).call(r,(o,a)=>o.level-a.level),r}disconnectForReconnect(){var r=this;return L(function*(){r.sendConnection&&r.recvConnection&&(T.debug("[".concat(r.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),r.state=Dt.Reconnecting,B("KEEP_LAST_FRAME")&&0!==r.remoteUserMap.size&&Array.from(r.remoteUserMap.entries()).forEach(i=>{let[o]=i;var a;o._videoTrack&&o._videoTrack._player&&(null===(a=o._videoTrack._player.getVideoElement())||void 0===a||a.pause(),o._videoTrack._player.isKeepLastFrame=!0,o._videoTrack._originMediaStreamTrack.stop())}),r.sendConnection.close(),r.unbindConnectionEvents(r.sendConnection),r.sendConnection=void 0,r.recvConnection.close(),r.unbindConnectionEvents(r.recvConnection),r.recvConnection=void 0,0!==r.localTrackMap.size&&(Array.from(r.localTrackMap.entries()).forEach(i=>{var o;let[a,{track:l}]=i;switch(a){case ee.LocalVideoTrack:he(o=l._hints).call(o,zt.LOW_STREAM)?l.close():r.pendingLocalTracks.push(l);break;case ee.LocalAudioTrack:l instanceof sr?r.pendingLocalTracks=r.pendingLocalTracks.concat(l.trackList):r.pendingLocalTracks.push(l)}}),r.emit(De.MediaReconnectStart,r.store.uid)),r.unbindLocalTrackEvents(),r.localTrackMap.clear(),0!==r.remoteUserMap.size&&Array.from(r.remoteUserMap.entries()).forEach(i=>{let[o,a]=i;Array.from(wo(a).call(a)).forEach(l=>{r.setPendingRemoteMedia(o,l)}),r.emit(De.MediaReconnectStart,o.uid)}),r.unbindAllRemoteTrackEvents(),r.remoteUserMap.clear(),r.stopUploadUplinkState(),r.stopUploadDownlinkState(),r.statsUploader.stopUploadOutboundStats(),r.statsUploader.stopUploadInboundStats(),r.statsUploader.stopUploadTransportStats(),T.debug("[".concat(r.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))})()}hasPendingRemoteMedia(r,i){for(const o of this.pendingRemoteTracks){const{user:a,kind:l}=o;if((r instanceof xh?r.uid:r)===a.uid&&i===l)return!0}return!1}setPendingRemoteMedia(r,i){this.hasPendingRemoteMedia(r,i)||this.pendingRemoteTracks.push({user:r,kind:i})}restartICE(r,i){var o=this;return L(function*(){let a,l;if(r===Ni.SEND_ONLY){if(!o.sendConnection)throw new Y(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");a=yield o.sendMutex.lock("From P2PChannel.restartICE"),l=o.sendConnection}else{if(!o.recvConnection)throw new Y(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");a=yield o.recvMutex.lock("From P2PChannel.restartICE"),l=o.recvConnection}try{if(i){const d=yield l.restartICE(i);return l.isInRestartIce=!1,d}{const d=yield l.restartICE();if(d){const h=yield Gr(o,De.RequestP2PRestartICE,{direction:Ni.RECEIVE_ONLY,iceParameter:d});yield l.restartICE(h),l.isInRestartIce=!1}}}finally{a()}})()}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const r=this.sendConnection.getStats(),i=this.localTrackMap.get(ee.LocalVideoTrack),o=this.localTrackMap.get(ee.LocalAudioTrack),a=r.videoSend.find(C=>{var P;return C.ssrc===(null==i||null===(P=i.ssrcs)||void 0===P?void 0:P[0].ssrcId)}),l=r.audioSend.find(C=>{var P;return C.ssrc===(null==o||null===(P=o.ssrcs)||void 0===P?void 0:P[0].ssrcId)});if(!a||!l)return 1;const d=Ao(this,De.NeedSignalRTT),h=a?a.rttMs:void 0,f=l?l.rttMs:void 0,m=h&&f?(h+f)/2:h||f,v=100*r.sendPacketLossRate*.7/50+.3*((m&&d?(m+d)/2:m||d)||0)/1500,y=v<.17?1:v<.36?2:v<.59?3:v<.1?4:5,b=i?.track;if(b&&b._encoderConfig&&-1===b._hints.indexOf(zt.SCREEN_TRACK)){const C=b._encoderConfig.bitrateMax,P=r.bitrate.actualEncoded;if(C&&P){const R=(1e3*C-P)/(1e3*C);return fL[R<.15?0:R<.3?1:R<.45?2:R<.6?3:4][y]}}return y}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const r=this.recvConnection.getStats();let i=0;return Array.from(this.remoteUserMap.entries()).forEach(o=>{let[a]=o;const l=a._audioSSRC,d=a._videoSSRC,h=r.audioRecv.find(P=>P.ssrc===l),f=r.videoRecv.find(P=>P.ssrc===d);if(!h&&!f)return void(i+=1);const m=Ao(this,De.NeedSignalRTT),g=r.rtt,v=(g&&m?(g+m)/2:g||m)||0,y=h?h.jitterMs:void 0,b=r.recvPacketLossRate;let C=.7*b*100/50+.3*v/1500;y&&(C=.6*b*100/50+.2*v/1500+.2*y/400),i+=C<.1?1:C<.17?2:C<.36?3:C<.59?4:5}),this.remoteUserMap.size>0?Math.round(i/this.remoteUserMap.size):i}muteLocalTrack(r){var i=this;return L(function*(){return new le((o,a)=>{i.handleMuteLocalTrack(r,o,a)})})()}filterTobePublishedTracks(r,i,o){const a=[],l=ct(),d=this.getAllTracks();r=At(r=r.filter(m=>-1===d.indexOf(m)));let h=!1,f=!1;for(const m of r){if(m instanceof Ve&&(this.localTrackMap.has(ee.LocalVideoTrack)||h?new Y(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:m,type:ee.LocalVideoTrack}),h=!0),i)){const g=this.getLowVideoTrack(m,o);a.push({track:g,type:ee.LocalVideoLowTrack})}if(m instanceof Cn){const g=this.localTrackMap.get(ee.LocalAudioTrack);if(g){if(!(g.track instanceof sr))throw new Y(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new Y(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");g.track.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0)}else if(f){const v=a.find(y=>{let{type:b}=y;return b===ee.LocalAudioTrack});if(!(v.track instanceof sr))throw new Y(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new Y(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(m)}else{if(!l.webAudioMediaStreamDest||m instanceof sr||m._bypassWebAudio)a.push({track:m,type:ee.LocalAudioTrack});else{const v=new sr;v.addAudioTrack(m),a.push({track:v,type:ee.LocalAudioTrack})}f=!0}}}return a}filterTobeUnpublishedTracks(r){const i=[],o=this.getAllTracks();r=At(r=r.filter(a=>-1!==o.indexOf(a)));for(const a of r){if(a instanceof Cn){const l=this.localTrackMap.get(ee.LocalAudioTrack);if(!l)continue;l.track instanceof sr?(l.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),0===l.track.trackList.length&&(i.push([ee.LocalAudioTrack,l]),l.track.close())):i.push([ee.LocalAudioTrack,l])}if(a instanceof Ve){const l=this.localTrackMap.get(ee.LocalVideoTrack);if(!l)continue;i.push([ee.LocalVideoTrack,l]);const d=this.localTrackMap.get(ee.LocalVideoLowTrack);d&&i.push([ee.LocalVideoLowTrack,d])}}return i}bindLocalTrackEvents(r){r.forEach(i=>{let{track:o,type:a}=i;switch(a){case ee.LocalVideoTrack:o.addListener(ge.GET_STATS,this.handleGetLocalVideoStats),o.addListener(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.addListener(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.addListener(ge.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),o.addListener(ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),o.addListener(ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),o.addListener(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.addListener(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ee.LocalAudioTrack:this.bindLocalAudioTrackEvents(o)}})}bindLocalAudioTrackEvents(r,i){r instanceof sr?r.trackList.forEach(o=>{o.addListener(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.addListener(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.addListener(ge.GET_STATS,this.handleGetLocalAudioStats),o.addListener(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.addListener(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(r.addListener(ge.GET_STATS,this.handleGetLocalAudioStats),r.addListener(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),i||r.addListener(ge.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(r){r||(r=Array.from(this.localTrackMap.entries()).map(i=>{let[o,{track:a}]=i;return{track:a,type:o}})),r.forEach(i=>{let{track:o,type:a}=i;switch(a){case ee.LocalVideoTrack:o.off(ge.GET_STATS,this.handleGetLocalVideoStats),o.off(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.off(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.off(ge.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),o.off(ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),o.off(ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),o.off(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.off(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ee.LocalAudioTrack:this.unbindLocalAudioTrackEvents(o)}})}unbindLocalAudioTrackEvents(r){r instanceof sr?r.trackList.forEach(i=>{i.off(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(ge.GET_STATS,this.handleGetLocalAudioStats),i.off(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(r.off(ge.GET_STATS,this.handleGetLocalAudioStats),r.off(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(r,i){i instanceof Dh&&i.addListener(ge.GET_STATS,o=>{o(this.handleGetRemoteVideoStats(r))}),i instanceof Ol&&i.addListener(ge.GET_STATS,o=>{o(this.handleGetRemoteAudioStats(r))})}unbindRemoteTrackEvents(r){r&&r.removeAllListeners(ge.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(r=>{let[i,o]=r;o.has(_e.AUDIO)&&this.unbindRemoteTrackEvents(i._audioTrack),o.has(_e.VIDEO)&&this.unbindRemoteTrackEvents(i._videoTrack)})}createGatewayPublishMessage(r,i){return r.map((o,a)=>{var l;let d,{track:h,type:f}=o;switch(f){case ee.LocalAudioTrack:d=at.Audio;break;case ee.LocalVideoTrack:d=he(l=h._hints).call(l,zt.SCREEN_TRACK)?at.Screen:at.High;break;case ee.LocalVideoLowTrack:d=at.Low}return{kind:f===ee.LocalAudioTrack?_e.AUDIO:_e.VIDEO,stream_type:d,mid:i[a].id,ssrcs:i[a].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(r){return r.map(i=>{var o;let a,[l,{track:d,ssrcs:h,id:f}]=i;switch(l){case ee.LocalVideoTrack:a=he(o=d._hints).call(o,zt.SCREEN_TRACK)?at.Screen:at.High;break;case ee.LocalAudioTrack:a=at.Audio;break;case ee.LocalVideoLowTrack:a=at.Low}return{stream_type:a,ssrcs:h,mid:f}})}assignLocalTracks(r,i){r.forEach((o,a)=>{let{track:l,type:d}=o;this.localTrackMap.set(d,{track:l,id:i[a].id,ssrcs:i[a].localSSRC})})}withdrawLocalTracks(r){r.forEach(i=>{let[o]=i;this.localTrackMap.delete(o)})}bindConnectionEvents(r){var i=this;r.onConnectionStateChange=function(){var o=L(function*(a){var l;T.info("[".concat(i.store.clientId,"] [p2pId: ").concat(i.store.p2pId,"]: ").concat(r.name,".onConnectionStateChange(").concat(a,")")),i.emit(De.PeerConnectionStateChange,a),"connected"!==a||i.store.keyMetrics.peerConnectionEnd||i.store.peerConnectionEnd(),"connected"===a&&(r.isInRestartIce=!1),he(l=i._restartStates).call(l,a)&&!r.isInRestartIce&&("disconnected"===a&&(yield wr(800)),"disconnected"!==r.iceConnectionState&&"failed"!==r.iceConnectionState||i.handleDisconnect(r.direction))});return function(a){return o.apply(this,arguments)}}(),r.onICEConnectionStateChange=o=>{"connected"!==o||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(o,")")),be.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:o,tag:st.TRACER}).onSuccess(),this.emit(De.IceConnectionStateChange,o)},r.onICETransportStateChange=o=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(o,")"))},r.onDTLSTransportStateChange=o=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(o,")"))},r.onDTLSTransportError=o=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(o,")"))},r.onFirstAudioDecoded=o=>{var a;const l=Array.from(wo(a=this.remoteUserMap).call(a)).find(h=>h._audioSSRC===o);var d;l&&(this.store.subscribe(l.uid,"audio",void 0,void 0,void 0,Date.now()),null===(d=l.audioTrack)||void 0===d||d.emit(Th.FIRST_FRAME_DECODED),be.firstRemoteFrame(this.store.sessionId,Pr.FIRST_AUDIO_DECODE,sn.FIRST_AUDIO_DECODE,{peer:l._uintid,subscribeElapse:ti.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId}))},r.onFirstAudioReceived=o=>{var a;const l=Array.from(wo(a=this.remoteUserMap).call(a)).find(d=>d._audioSSRC===o);l&&be.firstRemoteFrame(this.store.sessionId,Pr.FIRST_AUDIO_RECEIVED,sn.FIRST_AUDIO_RECEIVED,{peer:l._uintid,subscribeElapse:ti.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId})},r.onFirstVideoDecoded=(o,a,l)=>{this.reportVideoFirstFrameDecoded(o,a,l)},r.onFirstVideoReceived=o=>{var a;const l=Array.from(wo(a=this.remoteUserMap).call(a)).find(d=>d._videoSSRC===o);l&&be.firstRemoteFrame(this.store.sessionId,Pr.FIRST_VIDEO_RECEIVED,sn.FIRST_VIDEO_RECEIVED,{peer:l._uintid,subscribeElapse:ti.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId})},r.onSelectedLocalCandidateChanged=(o,a)=>{const l="relay"===o.candidateType;"unknown"!==a.candidateType&&l===("relay"===a.candidateType)||this.emit(De.ConnectionTypeChange,l),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ld(a))," -> ").concat(JSON.stringify(Ld(o)),")"))},r.onSelectedRemoteCandidateChanged=(o,a)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ld(a))," -> ").concat(JSON.stringify(Ld(o)),")"))},r.onFirstVideoDecodedTimeout=o=>{this.reportVideoFirstFrameDecoded(o,void 0,void 0,!0)},r.onLocalCandidate=o=>{this.emit(De.LocalCandidate,{candidate:o,direction:r.direction})}}unbindConnectionEvents(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.onLocalCandidate=void 0}handleDisconnect(r){var i=this;return L(function*(){const o=r===Ni.SEND_ONLY?i.sendConnection:i.recvConnection;o&&!o.isInRestartIce&&(o.isInRestartIce=!0,T.debug("[".concat(i.store.clientId,"] [P2PChannel-").concat(o.name,"] start use restartICE")),r===Ni.SEND_ONLY?i.restartICE(r):Gr(i,De.RequestP2PRestartICE,{direction:Ni.SEND_ONLY}))})()}filterTobeMutedTracks(r){const i=[];if(-1===this.getAllTracks().indexOf(r))return i;const o=this.localTrackMap.get(ee.LocalAudioTrack);if(r instanceof Cn&&o?.track instanceof sr)return o.track.isActive||i.push([ee.LocalAudioTrack,o]),i;const a=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:d}]=l;return r===d});if(a&&(i.push(a),a[0]===ee.LocalVideoTrack)){const l=this.localTrackMap.get(ee.LocalVideoLowTrack);l&&i.push([ee.LocalVideoLowTrack,l])}return i}filterTobeUnmutedTracks(r){const i=[],o=this.localTrackMap.get(ee.LocalAudioTrack);if(r instanceof Cn&&o?.track instanceof sr)return o.track.isActive&&i.push([ee.LocalAudioTrack,o]),i;const a=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:d}]=l;return r===d});if(a)if(a[0]===ee.LocalVideoTrack){i.push(a);const l=this.localTrackMap.get(ee.LocalVideoLowTrack);l&&i.push([ee.LocalVideoLowTrack,l])}else i.push(a);return i}createMuteMessage(r){return r.map(i=>{var o;let a,[l,{track:d,ssrcs:h,id:f}]=i;switch(l){case ee.LocalAudioTrack:a=at.Audio;break;case ee.LocalVideoTrack:a=he(o=d._hints).call(o,zt.SCREEN_TRACK)?at.Screen:at.High;break;case ee.LocalVideoLowTrack:a=at.Low}return{stream_type:a,ssrcs:h,mid:f}})}createUnmuteMessage(r){return r.map(i=>{var o;let a,[l,{track:d,ssrcs:h,id:f}]=i;switch(l){case ee.LocalAudioTrack:a=at.Audio;break;case ee.LocalVideoTrack:a=he(o=d._hints).call(o,zt.SCREEN_TRACK)?at.Screen:at.High;break;case ee.LocalVideoLowTrack:a=at.Low}return{stream_type:a,ssrcs:h,mid:f}})}filterTobeUnSubscribedTracks(r,i){const o=[],a=this.remoteUserMap.get(r);if(!a)return o;if(i){const l=a.get(i);if(!l)return o;o.push([r,{kind:i,id:l}])}else Array.from(a.entries()).forEach(l=>{let[d,h]=l;o.push([r,{kind:d,id:h}])});return o}createUnsubscribeMessage(r){const i=[];return r.forEach(o=>{let[a,{kind:l}]=o;switch(l){case _e.VIDEO:return void(a._videoSSRC&&i.push({stream_type:_e.VIDEO,ssrcId:a._videoSSRC}));case _e.AUDIO:return void(a._audioSSRC&&i.push({stream_type:_e.AUDIO,ssrcId:a._audioSSRC}))}}),i}withdrawRemoteTracks(r){r.forEach(i=>{let[o,{kind:a}]=i;const l=this.remoteUserMap.get(o);l&&(l.delete(a),0===Array.from(l.entries()).length&&this.remoteUserMap.delete(o))})}updateBitrateLimit(r){var i=this;return L(function*(){const o=i.localTrackMap.get(ee.LocalVideoTrack),a=i.localTrackMap.get(ee.LocalVideoLowTrack);o&&(yield o.track.setBitrateLimit(r.uplink)),a&&r.low_stream_uplink&&(yield a.track.setBitrateLimit({max_bitrate:r.low_stream_uplink.bitrate,min_bitrate:r.low_stream_uplink.bitrate||0}))})()}isP2PDisconnected(){return!this.sendConnection||!this.recvConnection||"connected"!==this.sendConnection.peerConnectionState&&"connected"!==this.recvConnection.peerConnectionState}tryToUnmuteAudio(r){var i=this;return L(function*(){for(let o=0;o<r.length;o++)if(r[o]instanceof Cn){const a=i.filterTobeUnmutedTracks(r[o]);if(0===a.length)continue;const l=i.createUnmuteMessage(a);return void(yield Bt(i,De.RequestUnmuteLocal,l))}})()}bindStatsUploaderEvents(){this.statsUploader.requestStats=r=>this.getStats(r),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(r=>{let[,{ssrcs:i}]=r;return!!i}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=r=>{var i;return!(null===(i=this.recvConnection)||void 0===i||!i.getRemoteVideoIsReady(r))},this.statsUploader.requestUpload=(r,i)=>this.emit(De.RequestUpload,r,i),this.statsUploader.requestUploadStats=r=>this.emit(De.RequestUploadStats,r),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){var r=this;return L(function*(){r.dtlsFailedCount+=1,yield wr(TR(r.dtlsFailedCount,Nn)),r.emit(De.RequestReconnect)})()}reconnectP2P(){return L(function*(){})()}canPublishLowStream(){return this.localTrackMap.has(ee.LocalVideoTrack)||this.pendingLocalTracks.some(r=>r instanceof Ve)}throwIfTrackTypeNotMatch(r){if(r.filter(i=>i instanceof Ve).length>1)throw new Y(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r.filter(i=>i instanceof Cn).length>1&&(r.some(i=>i instanceof Cn&&i._bypassWebAudio)||!ct().webAudioMediaStreamDest))throw new Y(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const i of r){if(i instanceof Ve&&this.pendingLocalTracks.some(o=>o instanceof Ve))throw new Y(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(i instanceof Cn&&this.pendingLocalTracks.some(o=>o instanceof Cn)&&(!ct().webAudioMediaStreamDest||i._bypassWebAudio||this.pendingLocalTracks.some(o=>o instanceof Cn&&o._bypassWebAudio)))throw new Y(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(r,i){const o=!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&ct().supportDualStreamEncoding,a=MD(MD({},{width:160,height:120,framerate:15,bitrate:50}),i);let l;l=o?r._mediaStreamTrack.clone():j2(r,a);const d=Ct(8,"track-low-"),h=new Ve(l,MD(MD({},o&&{scaleResolutionDownBy:XR(a,r)}),{},{frameRate:a.framerate,bitrateMax:a.bitrate,bitrateMin:a.bitrate}),void 0,void 0,d);return h.on(jf.TRANSCEIVER_UPDATED,f=>{r._updateRtpTransceiver(f,rv.LOW_STREAM)}),h._hints.push(zt.LOW_STREAM),r.addListener(ge.NEED_CLOSE,()=>{h.close()}),h}globalLock(){var r=this;return L(function*(){return r.recvMutex.lock("From P2PChannel2.globalLock")})()}reportVideoFirstFrameDecoded(r,i,o,a){var l;const d=Array.from(wo(l=this.remoteUserMap).call(l)).find(h=>h._videoSSRC===r);if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,f=h.subscribe.find(m=>m.userId===d.uid&&"video"===m.type);be.firstRemoteVideoDecode(this.store.sessionId,Pr.FIRST_VIDEO_DECODE,sn.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:i,videoheight:o,subscribeElapse:ti.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:f?.subscribeEnd||0,subscriberStart:f?.subscribeStart||0,videoAddNotify:f?.streamAdded||0,state:a?1:0})}}remoteMediaSsrcChanged(r,i,o){var a=this;return L(function*(){if(!a.recvConnection)return!1;const l=a.remoteUserMap.get(r);if(!l)return!1;const d=l.get(i);if(!d)return!1;const h=yield a.recvConnection.getRemoteSSRC(d);return void 0!==h&&h!==o})()}isPreSubScribe(r){return!1}publishDataChannel(r){return L(function*(){throw new Y(k.NOT_SUPPORTED)})()}unpublishDataChannel(r){return L(function*(){throw new Y(k.NOT_SUPPORTED)})()}subscribeDataChannel(r,i){return L(function*(){throw new Y(k.NOT_SUPPORTED)})()}unsubscribeDataChannel(r,i){return L(function*(){throw new Y(k.NOT_SUPPORTED)})()}hasPendingRemoteDataChannel(r,i){throw new Y(k.NOT_SUPPORTED)}setPendingRemoteDataChannel(r,i){throw new Y(k.NOT_SUPPORTED)}preConnect(r){return L(function*(){throw new Y(k.NOT_SUPPORTED)})()}getEstablishParams(){throw new Y(k.NOT_SUPPORTED)}reSubscribe(r){return L(function*(){throw new Y(k.NOT_SUPPORTED)})()}updateVideoStreamParameter(r,i){return L(function*(){throw new Y(k.NOT_SUPPORTED)})()}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(r=>{let[i,{track:o}]=r;i===ee.LocalVideoLowTrack?o._updateRtpTransceiver(void 0,rv.LOW_STREAM):o._updateRtpTransceiver(void 0)})}},pe(on.prototype,"p2pConnect",[yH],Object.getOwnPropertyDescriptor(on.prototype,"p2pConnect"),on.prototype),pe(on.prototype,"unpublish",[K2],Object.getOwnPropertyDescriptor(on.prototype,"unpublish"),on.prototype),pe(on.prototype,"unpublishLowStream",[q2],Object.getOwnPropertyDescriptor(on.prototype,"unpublishLowStream"),on.prototype),pe(on.prototype,"subscribe",[Y2],Object.getOwnPropertyDescriptor(on.prototype,"subscribe"),on.prototype),pe(on.prototype,"mockSubscribe",[bH],Object.getOwnPropertyDescriptor(on.prototype,"mockSubscribe"),on.prototype),pe(on.prototype,"unsubscribe",[SH],Object.getOwnPropertyDescriptor(on.prototype,"unsubscribe"),on.prototype),pe(on.prototype,"muteRemote",[$2],Object.getOwnPropertyDescriptor(on.prototype,"muteRemote"),on.prototype),pe(on.prototype,"unmuteRemote",[X2],Object.getOwnPropertyDescriptor(on.prototype,"unmuteRemote"),on.prototype),pe(on.prototype,"hasRemoteMediaWithLock",[Z2],Object.getOwnPropertyDescriptor(on.prototype,"hasRemoteMediaWithLock"),on.prototype),pe(on.prototype,"disconnectForReconnect",[CH],Object.getOwnPropertyDescriptor(on.prototype,"disconnectForReconnect"),on.prototype),pe(on.prototype,"remoteMediaSsrcChanged",[PD],Object.getOwnPropertyDescriptor(on.prototype,"remoteMediaSsrcChanged"),on.prototype),on);function Oc(r){return function(i,o,a){const l=i[o];if("function"!=typeof l)throw new Error("Cannot use mutex on object property.");return a.value=L(function*(){for(var d=arguments.length,h=new Array(d),f=0;f<d;f++)h[f]=arguments[f];switch(r){case Ua.SEND_ONLY:{const m=yield this.sendMutex.lock("From P2PChannel2.".concat(o));try{return yield l.apply(this,h)}finally{m()}}case Ua.RECEIVE_ONLY:{const m=yield this.recvMutex.lock("From P2PChannel2.".concat(o));try{return yield l.apply(this,h)}finally{m()}}default:{const m=yield this.sendMutex.lock("From P2PChannel2.".concat(o)),g=yield this.recvMutex.lock("From P2PChannel2.".concat(o));try{return yield l.apply(this,h)}finally{m(),g()}}}}),a}}function TH(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function Zf(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?TH(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):TH(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}class pC{constructor(i){N(this,"store",void 0),N(this,"onStatsException",void 0),N(this,"onUploadPublishDuration",void 0),N(this,"onStatsChanged",void 0),N(this,"localStats",new Map),N(this,"remoteStats",new Map),N(this,"updateStatsInterval",void 0),N(this,"trafficStats",void 0),N(this,"trafficStatsPeerList",[]),N(this,"uplinkStats",void 0),N(this,"exceptionMonitor",void 0),N(this,"p2pChannel",void 0),N(this,"scalabilityMode",ci.L1T1),N(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=i,this.exceptionMonitor=new R2,this.exceptionMonitor.on("exception",(o,a,l)=>{this.onStatsException&&this.onStatsException(o,a,l)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ee.LocalAudioTrack)||Zf({},IA)}getLocalVideoTrackStats(){return this.localStats.get(ee.LocalVideoTrack)||Zf({},HS)}getRemoteAudioTrackStats(i){const o=(d,h)=>{if(!this.trafficStats)return h;const f=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return f&&(h.publishDuration=f.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},a={};if(i){var l;const d=null===(l=this.remoteStats.get(i))||void 0===l?void 0:l.audioStats;d&&(a[i]=o(i,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{audioStats:f}]=d;f&&(a[h]=o(h,f))});return a}getRemoteNetworkQualityStats(i){const o={};if(i){var a;const l=null===(a=this.remoteStats.get(i))||void 0===a?void 0:a.networkStats;l&&(o[i]=l)}else Array.from(this.remoteStats.entries()).forEach(l=>{let[d,{networkStats:h}]=l;h&&(o[d]=h)});return o}getRemoteVideoTrackStats(i){const o=(d,h)=>{if(!this.trafficStats)return h;const f=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return f&&(h.publishDuration=f.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},a={};if(i){var l;const d=null===(l=this.remoteStats.get(i))||void 0===l?void 0:l.videoStats;d&&(a[i]=o(i,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{videoStats:f}]=d;f&&(a[h]=o(h,f))});return a}getRTCStats(){let i=0,o=0,a=0,l=0;const d=this.localStats.get(ee.LocalAudioTrack);d&&(i+=d.sendBytes,o+=d.sendBitrate);const h=this.localStats.get(ee.LocalVideoTrack);h&&(i+=h.sendBytes,o+=h.sendBitrate);const f=this.localStats.get(ee.LocalVideoLowTrack);f&&(i+=f.sendBytes,o+=f.sendBitrate),this.remoteStats.forEach(g=>{let{audioStats:v,videoStats:y}=g;v&&(a+=v.receiveBytes,l+=v.receiveBitrate),y&&(a+=y.receiveBytes,l+=y.receiveBitrate)});let m=1;return this.trafficStats&&(m+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:m,SendBitrate:o,SendBytes:i,RecvBytes:a,RecvBitrate:l,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(i){this.localStats.set(i,void 0)}removeLocalStats(i){i?this.localStats.delete(i):this.localStats.clear()}addRemoteStats(i){this.remoteStats.set(i,{})}removeRemoteStats(i){i?this.remoteStats.delete(i):this.remoteStats.clear()}addP2PChannel(i){this.p2pChannel=i}updateTrafficStats(i){i.peer_delay=i.peer_delay.filter(o=>void 0!==o.B_ppad||void 0!==o.B_ppvd),i.peer_delay.filter(o=>-1===this.trafficStatsPeerList.indexOf(o.peer_uid)).forEach(o=>{var a;const l=null===(a=this.p2pChannel)||void 0===a?void 0:a.getRemoteMedia(o.peer_uid),d=null!=l&&l.videoSSRC?ti.measureFromSubscribeStart(this.store.clientId,l.videoSSRC):0,h=null!=l&&l.audioSSRC?ti.measureFromSubscribeStart(this.store.clientId,l.audioSSRC):0;void 0!==o.B_ppad&&void 0!==o.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(o.peer_uid,o.B_ppad,o.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(o.peer_uid))}),this.trafficStats=i}updateUplinkStats(i){this.uplinkStats&&this.uplinkStats.B_fir!==i.B_fir&&T.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(i.B_fir)),this.uplinkStats=i}static isRemoteVideoFreeze(i,o,a){return!!i&&(!!a&&o.framesDecodeFreezeTime>a.framesDecodeFreezeTime||!(!a||o.framesDecodeCount>a.framesDecodeCount))}static isRemoteAudioFreeze(i){return!!i&&i._isFreeze()}isLocalVideoFreeze(i){return!(!i.inputFrame||!i.sentFrame)&&i.inputFrame.frameRate>5&&i.sentFrame.frameRate<3}updateLocalStats(i){Array.from(this.localStats.entries()).forEach(o=>{let[a,l]=o;switch(a){case ee.LocalVideoTrack:case ee.LocalVideoLowTrack:{const h=l,f=Zf({},HS),m=i.getStats(),g=i.getLocalMedia(a);if(m){const v=m.videoSend.find(y=>y.ssrc===g?.ssrcs[0].ssrcId);if(v){const y=i.getLocalVideoSize(),b=i.getEncoderConfig(ee.LocalVideoTrack);"H264"!==v.codec&&"H265"!==v.codec&&"VP8"!==v.codec&&"VP9"!==v.codec&&"AV1X"!==v.codec&&"AV1"!==v.codec||(f.codecType=v.codec),f.sendBytes=v.bytes,f.sendBitrate=h?8*Math.max(0,f.sendBytes-h.sendBytes):0,v.inputFrame?(f.captureFrameRate=v.inputFrame.frameRate,f.captureResolutionHeight=v.inputFrame.height,f.captureResolutionWidth=v.inputFrame.width):y&&(f.captureResolutionWidth=y.width,f.captureResolutionHeight=y.height),v.sentFrame?(f.sendFrameRate=v.sentFrame.frameRate,f.sendResolutionHeight=v.sentFrame.height,f.sendResolutionWidth=v.sentFrame.width):y&&(f.sendResolutionWidth=y.width,f.sendResolutionHeight=y.height),v.avgEncodeMs&&(f.encodeDelay=v.avgEncodeMs),b&&b.bitrateMax&&(f.targetSendBitrate=1e3*b.bitrateMax),f.sendPackets=v.packets,f.sendPacketsLost=v.packetsLost,f.sendJitterMs=v.jitterMs,f.sendRttMs=v.rttMs,f.totalDuration=h?h.totalDuration+1:1,f.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(v)&&(f.totalFreezeTime+=1),v.scalabilityMode&&this.scalabilityMode!==v.scalabilityMode&&(T.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(v.scalabilityMode)),this.scalabilityMode=v.scalabilityMode)}this.trafficStats&&(f.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var d;this.localStats.set(a,f),(h?.sendResolutionWidth!==f.sendResolutionWidth||h?.sendResolutionHeight!==f.sendResolutionHeight)&&(null===(d=this.onStatsChanged)||void 0===d||d.call(this,"resolution",{width:f.sendResolutionWidth,height:f.sendResolutionHeight})),f&&g&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,g.track,f);break}case ee.LocalAudioTrack:{const h=l,f=Zf({},IA),m=i.getStats(),g=i.getLocalMedia(a);if(m){const v=m.audioSend.find(y=>y.ssrc===g?.ssrcs[0].ssrcId);if(v){if("opus"!==v.codec&&"aac"!==v.codec&&"PCMU"!==v.codec&&"PCMA"!==v.codec&&"G722"!==v.codec||(f.codecType=v.codec),v.inputLevel)f.sendVolumeLevel=Math.round(32767*v.inputLevel);else{const y=i.getLocalAudioVolume();y&&(f.sendVolumeLevel=Math.round(32767*y))}f.sendBytes=v.bytes,f.sendPackets=v.packets,f.sendPacketsLost=v.packetsLost,f.sendJitterMs=v.jitterMs,f.sendRttMs=v.rttMs,f.sendBitrate=h?8*Math.max(0,f.sendBytes-h.sendBytes):0}}this.trafficStats&&(f.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(ee.LocalAudioTrack,f),f&&g&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,g.track,f);break}}})}updateRemoteStats(i){Array.from(this.remoteStats.entries()).forEach(o=>{var a,l;let[d,{videoStats:h,audioStats:f,videoPcStats:m}]=o;const g=f,v=h,y=m,b=Zf({},Vd),C=Zf({},GS),P=Zf({},vx),{audioTrack:R,videoTrack:A,audioSSRC:O,videoSSRC:M}=i.getRemoteMedia(d);let x;x=i instanceof ds?i.getStats(!0):i.getStats();const j=null===(a=x)||void 0===a?void 0:a.audioRecv.find(te=>te.ssrc===O),W=null===(l=x)||void 0===l?void 0:l.videoRecv.find(te=>te.ssrc===M),q=this.trafficStats&&this.trafficStats.peer_delay.find(te=>te.peer_uid===d);if(j&&("opus"!==j.codec&&"aac"!==j.codec&&"PCMU"!==j.codec&&"PCMA"!==j.codec&&"G722"!==j.codec||(b.codecType=j.codec),j.outputLevel?b.receiveLevel=Math.round(32767*j.outputLevel):R&&(b.receiveLevel=Math.round(32767*R.getVolumeLevel())),b.receiveBytes=j.bytes,b.receivePackets=j.packets,b.receivePacketsLost=j.packetsLost,b.receivePacketsDiscarded=j.packetsDiscarded,b.packetLossRate=b.receivePacketsLost/(b.receivePackets+b.receivePacketsLost),b.receiveBitrate=g?8*Math.max(0,b.receiveBytes-g.receiveBytes):0,b.totalDuration=g?g.totalDuration+1:1,b.totalFreezeTime=g?g.totalFreezeTime:0,b.freezeRate=b.totalFreezeTime/b.totalDuration,b.receiveDelay=j.jitterBufferMs,b.totalDuration>10&&pC.isRemoteAudioFreeze(R)&&(b.totalFreezeTime+=1)),W){"H264"!==W.codec&&"H265"!==W.codec&&"VP8"!==W.codec&&"VP9"!==W.codec&&"AV1X"!==W.codec&&"AV1"!==W.codec||(C.codecType=W.codec),C.receiveBytes=W.bytes,C.receiveBitrate=v?8*Math.max(0,C.receiveBytes-v.receiveBytes):0,C.decodeFrameRate=W.decodeFrameRate<0?0:W.decodeFrameRate,C.renderFrameRate=W.decodeFrameRate<0?0:W.decodeFrameRate,W.outputFrame&&(C.renderFrameRate=W.outputFrame.frameRate),W.receivedFrame?(C.receiveFrameRate=W.receivedFrame.frameRate,C.receiveResolutionHeight=W.receivedFrame.height,C.receiveResolutionWidth=W.receivedFrame.width):A&&(C.receiveResolutionHeight=A._videoHeight||0,C.receiveResolutionWidth=A._videoWidth||0),void 0!==W.framesRateFirefox&&(C.receiveFrameRate=Math.round(W.framesRateFirefox)),C.receivePackets=W.packets,C.receivePacketsLost=W.packetsLost,C.packetLossRate=C.receivePacketsLost/(C.receivePackets+C.receivePacketsLost),C.totalDuration=v?v.totalDuration+1:1,C.totalFreezeTime=v?v.totalFreezeTime:0,C.receiveDelay=W.jitterBufferMs||0;const te=!!M&&i.getRemoteVideoIsReady(M);A&&te&&pC.isRemoteVideoFreeze(A,W,y)&&(C.totalFreezeTime+=1),C.freezeRate=C.totalFreezeTime/C.totalDuration}q&&(b.end2EndDelay=q.B_ad,C.end2EndDelay=q.B_vd,b.transportDelay=q.B_ed,C.transportDelay=q.B_ed,b.currentPacketLossRate=q.B_ealr4/100,C.currentPacketLossRate=q.B_evlr4/100,P.uplinkNetworkQuality=q.B_punq?q.B_punq:0,P.downlinkNetworkQuality=q.B_pdnq?q.B_pdnq:0),this.remoteStats.set(d,{audioStats:b,videoStats:C,videoPcStats:W,networkStats:P}),R&&this.exceptionMonitor.setRemoteAudioStats(R,b),A&&this.exceptionMonitor.setRemoteVideoStats(A,C)})}}class wH{constructor(){N(this,"destChannelMediaInfos",new Map),N(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(i){jR(i),this.srcChannelMediaInfo=i}addDestChannelInfo(i){jR(i),this.destChannelMediaInfos.set(i.channelName,i)}removeDestChannelInfo(i){bS(i),this.destChannelMediaInfos.delete(i)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function J2(r){if(!(r instanceof wH))return new K(k.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const i=r.getSrcChannelMediaInfo(),o=r.getDestChannelMediaInfo();return i?0===o.size?new K(k.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new K(k.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}function IH(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function RH(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?IH(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):IH(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}var Kt;function kD(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function fC(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?kD(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):kD(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}let Av=(Kt=class rN extends WR{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(i=>i.rtpMap&&i.rtpMap.encodingName.toLowerCase()||"").filter(i=>{var o;return he(o=Object.keys(DR)).call(o,i)}))]}constructor(i,o){super(i,o),N(this,"store",void 0),N(this,"peerConnection",void 0),N(this,"remoteSDP",void 0),N(this,"initialOffer",void 0),N(this,"statsFilter",void 0),N(this,"useRTX",!1),N(this,"localCapabilities",void 0),N(this,"localCandidateCount",0),N(this,"allCandidatesReceived",!1),N(this,"establishPromise",void 0),N(this,"mutex",void 0),this.store=o,this.mutex=new Qr("P2PConnection-mutex",o.clientId),this.peerConnection=new RTCPeerConnection(rN.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.statsFilter=hC(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,hn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(){var i=this;return L(function*(){try{const o=yield i.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=Gd(o.sdp),l=mv(o.sdp,{filterRTX:!i.useRTX,filterVideoFec:B("FILTER_VIDEO_FEC"),filterAudioFec:B("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return i.localCapabilities=l,i.initialOffer=o,fC(fC({},a),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:l},offerSDP:o.sdp})}catch(o){throw new Y(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}})()}updateRemoteConnect(){return L(function*(){})()}connect(i){var o=this;return L(function*(){try{if(!o.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");o.remoteSDP=new class{constructor(l){N(this,"sessionDesc",void 0),N(this,"localCapabilities",void 0),N(this,"rtpCapabilities",void 0),N(this,"candidates",void 0),N(this,"iceParameters",void 0),N(this,"dtlsParameters",void 0),N(this,"setup",void 0),N(this,"currentMidIndex",void 0),N(this,"cname",void 0),l=Vn(l);const{iceParameters:d,dtlsParameters:h,candidates:f,rtpCapabilities:m,setup:g,localCapabilities:v,sdkCodec:y,cname:b}=l,C=vr.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=m,this.candidates=f,this.iceParameters=d,this.dtlsParameters=h,this.setup=g,this.localCapabilities=v,this.cname=b;for(let P=0;P<C.mediaDescriptions.length;P++){const R=C.mediaDescriptions[P];if(R.attributes.iceUfrag=d.iceUfrag,R.attributes.icePwd=d.icePwd,R.attributes.fingerprints=h.fingerprints,R.attributes.candidates=f,R.attributes.setup=g,"video"===R.media.mediaType){R.media.fmts=m.videoCodecs.map(O=>O.payloadType.toString(10));let A=m.videoCodecs.filter(O=>{var M,x;return null===(M=O.rtpMap)||void 0===M?void 0:he(x=M.encodingName.toLowerCase()).call(x,y)});0===A.length&&(A=m.videoCodecs),R.attributes.payloads=A,R.attributes.extmaps=m.videoExtensions}"audio"===R.media.mediaType&&(R.media.fmts=m.audioCodecs.map(A=>A.payloadType.toString(10)),R.attributes.payloads=m.audioCodecs,R.attributes.extmaps=m.audioExtensions),C.mediaDescriptions[P]=this.mungMediaDesc(R)}this.sessionDesc=C,this.currentMidIndex=C.mediaDescriptions.length-1}toString(){return vr.print(this.sessionDesc)}send(l,d,h){const{ssrcs:f,ssrcGroups:m}=Oh(d,this.cname),g=this.sessionDesc.mediaDescriptions.find(b=>l===_e.VIDEO?"video"===b.media.mediaType:"audio"===b.media.mediaType),v=f[0].attributes.label,y=f[0].attributes.mslabel;return g.attributes.ssrcs=g.attributes.ssrcs.concat(f),g.attributes.ssrcGroups=g.attributes.ssrcGroups.concat(m),{id:v,mslabel:y}}batchSend(l){return l.map(d=>{let{kind:h,ssrcMsg:f}=d;return this.send(h,f,void 0)})}stopSending(l){this.sessionDesc.mediaDescriptions.forEach(d=>{const h=[],f=[],m=[];d.attributes.ssrcs.forEach(g=>{he(l).call(l,g.attributes.label||"")?m.push(g):h.push(g)}),d.attributes.ssrcGroups.forEach(g=>{var v;he(v=m.map(y=>y.ssrcId)).call(v,g.ssrcIds[0])||f.push(g)}),d.attributes.ssrcs=h,d.attributes.ssrcGroups=f})}mute(l){const d=this.sessionDesc.mediaDescriptions.find(h=>h.attributes.mid===l);if(!d)throw new Error("mediaDescription not found with ".concat(l," in remote SDP when calling RemoteSDP.mute."));d.attributes.direction="inactive"}unmute(l){const d=this.sessionDesc.mediaDescriptions.find(h=>h.attributes.mid===l);if(!d)throw new Error("mediaDescription not found with ".concat(l," in remote SDP when calling RemoteSDP.unmute."));d.attributes.direction="sendonly"}receive(l,d,h){l.forEach((f,m)=>{const g=f._mediaStreamTrack,v=this.sessionDesc.mediaDescriptions.findIndex(b=>b.attributes.mid===g.kind),y=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[v],f);this.sessionDesc.mediaDescriptions[v]=y})}stopReceiving(l){}updateCandidates(l){l===uo.TCP?this.candidates.forEach(d=>{-1===this.candidates.findIndex(h=>"tcp"===h.transport&&h.connectionAddress===d.connectionAddress&&h.port===d.port)&&this.candidates.push(RH(RH({},d),{},{foundation:"tcpcandidate",priority:Number(d.priority)-1+"",transport:"tcp",port:Number(d.port)+90+""}))}):this.candidates=this.candidates.filter(d=>"tcp"!==d.transport);for(const d of this.sessionDesc.mediaDescriptions)d.attributes.candidates=this.candidates}restartICE(l){l=Vn(l),this.iceParameters=l,this.sessionDesc.mediaDescriptions.forEach(d=>{d.attributes.iceUfrag=l.iceUfrag,d.attributes.icePwd=l.icePwd})}predictReceivingMids(l){const d=[];for(let h=0;h<l;h++)d.push((this.currentMidIndex+h+1).toString(10));return d}mungRecvMediaDsec(l,d){const h=Vn(l);return Kf(h,d),iD(h,d),h}updateRecvMedia(l,d){const h=this.sessionDesc.mediaDescriptions.findIndex(f=>f.attributes.mid===l);if(-1!==h){const f=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[h],d);this.sessionDesc.mediaDescriptions[h]=f}}bumpMid(l){this.currentMidIndex+=l}updateTrackLabel(l,d,h){const f=this.sessionDesc.mediaDescriptions.find(g=>l===_e.VIDEO?"video"===g.attributes.mid:"audio"===g.attributes.mid);if(f){const g=f.attributes.ssrcs.find(v=>v.attributes.label===d);var m;g&&(g.attributes.label=h,null===(m=g.attributes.msid)||void 0===m||m.replace(d,h))}}mungMediaDesc(l){const d=Vn(l);return rD(d),function(h){const f=h.attributes.extmaps.find(m=>nC(m.extensionName));f&&h.attributes.extmaps.splice(h.attributes.extmaps.indexOf(f),1),h.attributes.payloads.forEach(m=>{const g=m.rtcpFeedbacks.findIndex(v=>"transport-cc"===v.type);-1!==g&&m.rtcpFeedbacks.splice(g,1)})}(d),d}getSSRC(l){for(const d of this.sessionDesc.mediaDescriptions)for(const h of d.attributes.ssrcs)if(h.attributes.label===l)return[h]}}(fC(fC({},i),{},{rtpCapabilities:i.rtpCapabilities.send,localCapabilities:o.localCapabilities,sdkCodec:o.store.codec}));const a=o.remoteSDP.toString();yield o.peerConnection.setLocalDescription(o.initialOffer),yield o.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(a.toString()))}})()}updateRemoteRTPCapabilities(i,o){return L(function*(){throw new Y(k.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")})()}getPreMedia(i){}send(i,o){var a=this;return ts(function*(){const l=yield tt(a.mutex.lock());try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=i.map(b=>a.peerConnection.addTrack(b._mediaStreamTrack)),h=yield tt(a.peerConnection.createOffer()),f=vr.parse(h.sdp),m=i.map(b=>{const C=b._mediaStreamTrack,P=f.mediaDescriptions.find(R=>R.attributes.mid===C.kind);if(!P)throw new Error("Cannot extract ssrc from mediaDescription.");return function(R,A,O){const M=R.attributes.ssrcs.filter(j=>j.attributes.label===A),x=R.attributes.ssrcGroups;if(0===M.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(x&&M.length>1){const j=x.find(W=>-1!==W.ssrcIds.indexOf(M[0].ssrcId));return j?[{ssrcId:j.ssrcIds[0],rtx:O?j.ssrcIds[1]:void 0}]:[{ssrcId:M[0].ssrcId}]}return[{ssrcId:M[0].ssrcId}]}(P,C.id,a.useRTX)});let g;try{g=yield m}catch(b){throw d.forEach(C=>{$e()&&C.replaceTrack(null),a.peerConnection.removeTrack(C)}),b}const v=a.mungSendOfferSDP(h.sdp,i);a.remoteSDP.receive(i,o,g);const y=a.remoteSDP.toString();return yield tt(a.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield tt(a.applySendEncodings(d,i)),yield tt(a.peerConnection.setRemoteDescription({type:"answer",sdp:y})),i.map((b,C)=>({localSSRC:m[C],id:b._mediaStreamTrack.id}))}catch(d){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{l()}})()}stopSending(i){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const a=o.peerConnection.getSenders().filter(h=>{var f;return-1!==i.indexOf((null===(f=h.track)||void 0===f?void 0:f.id)||"")});if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");a.map(h=>{$e()&&h.replaceTrack(null),o.peerConnection.removeTrack(h)});const l=yield o.peerConnection.createOffer();yield o.peerConnection.setLocalDescription(l),o.remoteSDP.stopReceiving(i);const d=o.remoteSDP.toString();yield o.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(a.toString()))}})()}receive(i,o,a,l){var d=this;return L(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{id:h,mslabel:f}=d.remoteSDP.send(i,o,l),m=new le((y,b)=>{const C=setTimeout(()=>{b(new Error("Cannot receive track, id: ".concat(h)))},1e4),P=R=>{const A=ot();if(("Safari"===A.name&&11===Number(A.version)||nt())&&R.track.id!==h&&R.streams[0].id===f){var O;const M=R.streams[0].getTracks()[0];return null===(O=d.remoteSDP)||void 0===O||O.updateTrackLabel(i,h,R.track.id),d.peerConnection.removeEventListener("track",P),clearTimeout(C),void y(M)}if(R.track.id===h)return d.peerConnection.removeEventListener("track",P),clearTimeout(C),void y(R.track)};d.peerConnection.addEventListener("track",P)}),g=d.remoteSDP.toString();yield d.peerConnection.setRemoteDescription({type:"offer",sdp:g});const v=yield d.peerConnection.createAnswer();return yield d.peerConnection.setLocalDescription(v),{track:yield m,id:h}}catch(h){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}stopReceiving(i){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");o.remoteSDP.stopSending(i);const a=o.remoteSDP.toString();yield o.peerConnection.setRemoteDescription({type:"offer",sdp:a});const l=yield o.peerConnection.createAnswer();yield o.peerConnection.setLocalDescription(l)}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}})()}muteRemote(i){return L(function*(){})()}unmuteRemote(i){return L(function*(){})()}muteLocal(i){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const a=o.peerConnection.getSenders().filter(l=>{var d;return-1!==i.indexOf((null===(d=l.track)||void 0===d?void 0:d.id)||"")});if(a.length!==i.length)throw new Error("sender' length doesn't match mids' length.");a.map(l=>{if($e()&&l.track)l.track.enabled=!1;else{const d=l.getParameters();d.encodings.forEach(h=>h.active=!1),l.setParameters(d)}})}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(a.toString()))}})()}unmuteLocal(i){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const a=o.peerConnection.getSenders().filter(h=>{var f;return-1!==i.indexOf((null===(f=h.track)||void 0===f?void 0:f.id)||"")});if(a.length!==i.length)throw new Error("Senders' length doesn't match mids' length.");a.map(function(){var h=L(function*(f){if($e()&&f.track)f.track.enabled=!0;else{const m=f.getParameters();m.encodings.forEach(g=>g.active=!0),yield f.setParameters(m)}});return function(f){return h.apply(this,arguments)}}());const l=yield o.peerConnection.createOffer();yield o.peerConnection.setLocalDescription(l);const d=o.remoteSDP.toString();yield o.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(a.toString()))}})()}restartICE(i){var o=this;return ts(function*(){const a=yield tt(o.mutex.lock("From P2PConnection.restartICE"));try{if(!o.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(ct().supportPCSetConfiguration){const m=o.peerConnection.getConfiguration(),g=i===uo.RELAY?"relay":"all";m.iceTransportPolicy!==g&&(T.debug("[".concat(o.store.clientId,"] restartICE change iceTransportPolicy from [").concat(m.iceTransportPolicy,"] to [").concat(g,"]")),m.iceTransportPolicy=g,o.peerConnection.setConfiguration(m))}else if(i===uo.RELAY)return;i!==uo.RELAY&&o.remoteSDP.updateCandidates(i);const l=yield tt(o.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=Gd(l.sdp),{remoteIceParameters:h}=yield d.iceParameters;o.remoteSDP.restartICE(h);const f=o.remoteSDP.toString();yield tt(o.peerConnection.setLocalDescription(l)),yield tt(o.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(l){T.warning("[".concat(o.store.clientId,"] restart ICE failed, abort operation"),l)}finally{a()}})()}close(){var i;this.peerConnection.close(),null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}updateEncoderConfig(i,o){var a=this;return L(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const l=yield a.peerConnection.createOffer(),d=a.mungSendOfferSDP(l.sdp,[o]);a.remoteSDP.updateRecvMedia(o._mediaStreamTrack.kind,o);const h=a.remoteSDP.toString();yield a.peerConnection.setLocalDescription({type:"offer",sdp:d}),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(l){throw new Y(k.EXCHANGE_SDP_FAILED,l.toString())}})()}updateSendParameters(i,o){var a=this;return L(function*(){const l=a.peerConnection.getSenders().filter(d=>{var h;return(null===(h=d.track)||void 0===h?void 0:h.id)===i});1===l.length&&(yield a.applySendEncodings(l,[o]))})()}setStatsRemoteVideoIsReady(i,o){this.statsFilter.setVideoIsReady2(i,o)}replaceTrack(i,o){var a=this;return L(function*(){const l=a.peerConnection.getSenders().find(d=>{var h;return(null===(h=d.track)||void 0===h?void 0:h.id)===o});l&&(yield l.replaceTrack(i._mediaStreamTrack))})()}createDataChannels(i,o){throw new Y(k.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(i){throw new Y(k.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;null===(i=this.onICEConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},B("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const o={iceServers:[],sdpSemantics:"plan-b"};return i.iceServers?o.iceServers=i.iceServers:i.turnServer&&"off"!==i.turnServer.mode&&(pS(i.turnServer.servers)?o.iceServers=i.turnServer.servers:(o.iceServers&&o.iceServers.push(...rN.turnServerConfigToIceServers(i.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&o.iceServers&&i.turnServer.serversFromGateway&&o.iceServers.push(...rN.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(o.iceTransportPolicy="relay")}))),o}static turnServerConfigToIceServers(i){const o=[];return i.forEach(a=>{a.security?a.tcpport&&o.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&o.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&o.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),o}updateRtpSenderEncodings(i,o){var a=this;return L(function*(){var l;if(o||(o=a.peerConnection.getSenders().find(v=>{var y;return(null===(y=v.track)||void 0===y?void 0:y.id)===i._mediaStreamTrack.id})),!o)return T.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(!ct().supportSetRtpSenderParameters)return T.warn("Browser not support set rtp-sender parameters");const d={},h={};if(i instanceof Ve)switch(i._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(B("DSCP_TYPE")&&pl()){var f;const v=B("DSCP_TYPE");he(f=["very-low","low","medium","high"]).call(f,v)&&(h.networkPriority=v)}const m=o.getParameters(),g=null===(l=m.encodings)||void 0===l?void 0:l[0];g&&Object.assign(g,h),Object.assign(m,d),T.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),yield o.setParameters(m)})()}applySendEncodings(i,o){var a=this;return L(function*(){try{if(!ct().supportSetRtpSenderParameters||i.length!==o.length)return;for(let l=0;l<i.length;l++){const d=i[l],h=o[l];d&&h&&(yield a.updateRtpSenderEncodings(h,d))}}catch{T.debug("[".concat(a.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(i,o){const a=vr.parse(i);return o.forEach((l,d)=>{const h=l._mediaStreamTrack,f=a.mediaDescriptions.find(m=>m.attributes.mid===h.kind);f&&Kf(f,l)}),vr.print(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var o;null===(o=this.onFirstAudioReceived)||void 0===o||o.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var o;null===(o=this.onFirstVideoReceived)||void 0===o||o.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var o;null===(o=this.onFirstAudioDecoded)||void 0===o||o.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,o,a)=>{var l;null===(l=this.onFirstVideoDecoded)||void 0===l||l.call(this,i,o,a)},this.statsFilter.onSelectedLocalCandidateChanged=(i,o)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,i,o)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,o)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,i,o)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}batchReceive(i){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const a=o.remoteSDP.batchSend(i).map((h,f)=>{let{id:m,mslabel:g}=h;const{kind:v}=i[f];return new le((y,b)=>{const C=setTimeout(()=>{b(new Error("Cannot receive track, id: ".concat(m)))},1e4),P=R=>{const A=ot();if("Safari"===A.name&&11===Number(A.version)&&R.track.id!==m&&R.streams[0].id===g){var O;const M=R.streams[0].getTracks()[0];return null===(O=o.remoteSDP)||void 0===O||O.updateTrackLabel(v,m,R.track.id),o.peerConnection.removeEventListener("track",P),clearTimeout(C),void y({track:M,id:m})}if(R.track.id===m)return o.peerConnection.removeEventListener("track",P),clearTimeout(C),void y({track:R.track,id:m})};o.peerConnection.addEventListener("track",P)})}),l=o.remoteSDP.toString();yield o.peerConnection.setRemoteDescription({type:"offer",sdp:l});const d=yield o.peerConnection.createAnswer();return yield o.peerConnection.setLocalDescription(d),yield le.all(a)}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}})()}getRemoteSSRC(i){var o=this;return L(function*(){if(!o.remoteSDP)return;const a=o.remoteSDP.getSSRC(i);return a?.[0].ssrcId})()}setConfiguration(i){if(ct().supportPCSetConfiguration){const o=rN.resolvePCConfiguration(i);this.peerConnection.setConfiguration(o)}}},pe(Kt.prototype,"connect",[Vo],Object.getOwnPropertyDescriptor(Kt.prototype,"connect"),Kt.prototype),pe(Kt.prototype,"stopSending",[Vo],Object.getOwnPropertyDescriptor(Kt.prototype,"stopSending"),Kt.prototype),pe(Kt.prototype,"receive",[Vo],Object.getOwnPropertyDescriptor(Kt.prototype,"receive"),Kt.prototype),pe(Kt.prototype,"stopReceiving",[Vo],Object.getOwnPropertyDescriptor(Kt.prototype,"stopReceiving"),Kt.prototype),pe(Kt.prototype,"muteRemote",[Vo],Object.getOwnPropertyDescriptor(Kt.prototype,"muteRemote"),Kt.prototype),pe(Kt.prototype,"unmuteRemote",[Vo],Object.getOwnPropertyDescriptor(Kt.prototype,"unmuteRemote"),Kt.prototype),pe(Kt.prototype,"muteLocal",[Vo],Object.getOwnPropertyDescriptor(Kt.prototype,"muteLocal"),Kt.prototype),pe(Kt.prototype,"unmuteLocal",[Vo],Object.getOwnPropertyDescriptor(Kt.prototype,"unmuteLocal"),Kt.prototype),pe(Kt.prototype,"close",[Vo],Object.getOwnPropertyDescriptor(Kt.prototype,"close"),Kt.prototype),pe(Kt.prototype,"updateEncoderConfig",[Vo],Object.getOwnPropertyDescriptor(Kt.prototype,"updateEncoderConfig"),Kt.prototype),pe(Kt.prototype,"updateSendParameters",[Vo],Object.getOwnPropertyDescriptor(Kt.prototype,"updateSendParameters"),Kt.prototype),pe(Kt.prototype,"replaceTrack",[Vo],Object.getOwnPropertyDescriptor(Kt.prototype,"replaceTrack"),Kt.prototype),pe(Kt.prototype,"getRemoteSSRC",[Vo],Object.getOwnPropertyDescriptor(Kt.prototype,"getRemoteSSRC"),Kt.prototype),Kt);function Vo(r,i,o){const a=r[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return o.value=L(function*(){const l=this.mutex,d=yield l.lock("Locking from P2PConnection.".concat(i));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return yield a.apply(this,f)}finally{d()}}),o}function Jf(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function Fh(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?Jf(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):Jf(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}class Q2{get localCapabilities(){return Vn(this._localCapabilities)}get rtpCapabilities(){return Vn(this._rtpCapabilities)}get candidates(){return Vn(this._candidates)}get iceParameters(){return Vn(this._iceParameters)}get dtlsParameters(){return Vn(this._dtlsParameters)}constructor(i){N(this,"sessionDesc",void 0),N(this,"_localCapabilities",void 0),N(this,"_rtpCapabilities",void 0),N(this,"_candidates",void 0),N(this,"_iceParameters",void 0),N(this,"_dtlsParameters",void 0),N(this,"setup",void 0),N(this,"currentMidIndex",void 0),N(this,"cname",void 0),N(this,"firefoxSsrcMidMap",new Map),i=Vn(i);const{iceParameters:o,dtlsParameters:a,candidates:l,rtpCapabilities:d,setup:h,localCapabilities:f,cname:m}=i;this._rtpCapabilities=d,this._candidates=l,this._iceParameters=o,this._dtlsParameters=a,this._localCapabilities=f,this.setup=h,this.cname=m,this.sessionDesc=this.updateRemoteRTPCapabilities(d),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(i){const o=this.candidates,a=this.dtlsParameters,l=this.iceParameters,d=this.rtpCapabilities.send;let h=this.sessionDesc.mediaDescriptions.length-1;for(let f=1;f<i;f++){const m=2*f+2e4,g=2*f+4e4,{ssrcs:v,ssrcGroups:y}=Oh([{ssrcId:m}],this.cname),{ssrcs:b,ssrcGroups:C}=Oh([{ssrcId:g,rtx:B("USE_SUB_RTX")?g+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.videoCodecs.map(P=>P.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:l.iceUfrag,icePwd:l.icePwd,unrecognized:[],candidates:o,extmaps:d.videoExtensions,fingerprints:a.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:b,ssrcGroups:C,rtcpFeedbackWildcards:[],payloads:d.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++h)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.audioCodecs.map(P=>P.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:l.iceUfrag,icePwd:l.icePwd,unrecognized:[],candidates:o,extmaps:d.audioExtensions,fingerprints:a.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:v,ssrcGroups:y,rtcpFeedbackWildcards:[],payloads:d.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++h)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return vr.print(this.sessionDesc)}send(i,o,a,l){const{ssrcs:d,ssrcGroups:h}=Oh(o,this.cname,B("SYNC_GROUP")?a:void 0),f=this.findPreloadMediaDesc(d);if(f){if(hn()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,f.attributes.mid),l&&(l.twcc||l.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(f);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(f,l),{mid:f.attributes.mid,needExchangeSDP:!0}}return{mid:f.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(i,d);let g;return-1===m||1===m&&($e()||function(){const v=ot();return!(v.name!==It.CHROME||!v.osVersion)&&Number(v.version)<=90}())||0===m&&B("USE_SUB_RTX")||pR()?(g=this.createOrRecycleSendMedia(i,d,h,"sendonly",l),this.updateBundleMids()):(g=Vn(this.sessionDesc.mediaDescriptions[m]),g.attributes.direction="sendonly",g.attributes.ssrcs=d,g.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(g,l)),hn()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,g.attributes.mid),{mid:g.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:i,needExchangeSDP:o}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:i.attributes.mid,needExchangeSDP:o}}batchSend(i){const o=i.map(d=>{let{kind:h,ssrcMsg:f,mslabel:m}=d;return this.send(h,f,m)}),a=[];let l=!1;return o.forEach(d=>{let{mid:h,needExchangeSDP:f}=d;f&&(l=!0),a.push(h)}),{mids:a,needExchangeSDP:l}}stopSending(i){const o=this.sessionDesc.mediaDescriptions.filter(a=>a.attributes.mid&&-1!==i.indexOf(a.attributes.mid));if(o.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");o.forEach(a=>{"0"===a.attributes.mid||hn()||pR()?a.attributes.ssrcs=[]:(a.attributes.ssrcs=[],a.attributes.direction="inactive",a.media.port="0")}),this.updateBundleMids()}mute(i){const o=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===i);if(!o)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.mute."));o.attributes.direction="inactive"}unmute(i){const o=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===i);if(!o)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.unmute."));o.attributes.direction="sendonly"}muteRemote(i){const o=this.sessionDesc.mediaDescriptions.filter(a=>he(i).call(i,a.attributes.mid||""));if(o.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");o.forEach(a=>{a.attributes.direction="inactive"})}unmuteRemote(i){const o=this.sessionDesc.mediaDescriptions.filter(a=>he(i).call(i,a.attributes.mid||""));if(o.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");o.forEach(a=>{a.attributes.direction="recvonly"})}receive(i,o,a,l){i.forEach((d,h)=>{this.createOrRecycleRecvMedia(d,[],"recvonly",o,a,l[h])}),this.updateBundleMids()}stopReceiving(i){const o=this.sessionDesc.mediaDescriptions.filter(a=>-1!==i.indexOf(a.attributes.mid));if(o.length!==i.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");o.forEach(a=>{a.media.port="0",a.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(i){const o=this.sessionDesc||vr.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n");this._rtpCapabilities=i;const a=this.rtpCapabilities.send,l=this.localCapabilities.send;for(const d of o.mediaDescriptions){if(d.attributes.iceUfrag=this._iceParameters.iceUfrag,d.attributes.icePwd=this._iceParameters.icePwd,d.attributes.fingerprints=this._dtlsParameters.fingerprints,d.attributes.candidates=this._candidates,d.attributes.setup=this.setup,"application"===d.media.mediaType&&(d.attributes.sctpPort="5000"),"video"===d.media.mediaType)if(0===a.videoCodecs.length){const h=l.videoCodecs.filter(f=>{var m,g;return null===(m=f.rtpMap)||void 0===m?void 0:he(g=m.encodingName.toLowerCase()).call(g,"vp8")})||[l.videoCodecs[0]];d.media.fmts=h.map(f=>f.payloadType.toString(10)),d.attributes.payloads=h,d.attributes.extmaps=[]}else if(d.media.fmts=a.videoCodecs.map(h=>h.payloadType.toString(10)),d.attributes.payloads=a.videoCodecs,d.attributes.extmaps=a.videoExtensions,B("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:h,ssrcGroups:f}=Oh([{ssrcId:4e4,rtx:B("USE_SUB_RTX")?40001:void 0}],this.cname);d.attributes.ssrcs=h,d.attributes.ssrcGroups=f}if("audio"===d.media.mediaType)if(0===a.audioCodecs.length){const h=l.audioCodecs.filter(f=>{var m,g;return null===(m=f.rtpMap)||void 0===m?void 0:he(g=m.encodingName.toLowerCase()).call(g,"opus")})||[l.audioCodecs[0]];d.media.fmts=h.map(f=>f.payloadType.toString(10)),d.attributes.payloads=h,d.attributes.extmaps=[]}else if(d.media.fmts=a.audioCodecs.map(h=>h.payloadType.toString(10)),d.attributes.payloads=a.audioCodecs,d.attributes.extmaps=a.audioExtensions,Nl(d),B("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:h,ssrcGroups:f}=Oh([{ssrcId:2e4}],this.cname);d.attributes.ssrcs=h,d.attributes.ssrcGroups=f}}return this.sessionDesc=o,this.currentMidIndex=o.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(i){const o=this._candidates.filter(a=>"udp"===a.transport);if(i===uo.TCP){if(0===o.length)return;if(B("TCP_CANDIDATE_ONLY")){const a=this._candidates.filter(l=>"tcp"===l.transport);o.forEach(l=>{-1===a.findIndex(d=>d.connectionAddress===l.connectionAddress)&&a.push(Fh(Fh({},l),{},{foundation:"tcpcandidate",priority:Number(l.priority)-1+"",transport:"tcp",port:Number(l.port)+90+""}))}),this._candidates=a}else{const a=[];o.forEach(l=>{a.push(Fh(Fh({},l),{},{foundation:"tcpcandidate",priority:Number(l.priority)-1+"",transport:"tcp",port:Number(l.port)+90+""}))}),this._candidates=[...o,...a]}}else if(i===uo.RELAY){if(0!==o.length)return;{const a=this._candidates.filter(l=>"tcp"===l.transport);a.forEach(l=>{o.push(Fh(Fh({},l),{},{foundation:"udpcandidate",priority:Number(l.priority)+1+"",transport:"udp",port:Number(l.port)-90+""}))}),this._candidates=[...o,...a]}}else 0===o.length?(this._candidates.filter(a=>"tcp"===a.transport).forEach(a=>{o.push(Fh(Fh({},a),{},{foundation:"udpcandidate",priority:Number(a.priority)+1+"",transport:"udp",port:Number(a.port)-90+""}))}),this._candidates=o):this._candidates=this._candidates.filter(a=>"tcp"!==a.transport);for(const a of this.sessionDesc.mediaDescriptions)a.attributes.candidates=this.candidates}restartICE(i){i=Vn(i),this._iceParameters=i,this.sessionDesc.mediaDescriptions.forEach(o=>{o.attributes.iceUfrag=i.iceUfrag,o.attributes.icePwd=i.icePwd})}predictReceivingMids(i){const o=[];for(let a=0;a<i;a++)o.push((this.currentMidIndex+a+1).toString(10));return o}findAvailableMediaIndex(i,o){return this.sessionDesc.mediaDescriptions.findIndex(a=>{const l=a.media.mediaType===i&&"0"!==a.media.port&&("sendonly"===a.attributes.direction||"sendrecv"===a.attributes.direction)&&0===a.attributes.ssrcs.length;if(hn()){if(l){const d=this.firefoxSsrcMidMap.get(o[0].ssrcId);return!(d||"0"!==a.attributes.mid&&"1"!==a.attributes.mid)||!(!d||d!==a.attributes.mid)}return!1}return l})}createOrRecycleDataChannel(){for(const a of this.sessionDesc.mediaDescriptions)if("application"===a.media.mediaType)return{mediaDesc:a,needExchangeSDP:!1};this.currentMidIndex+=1;const i="".concat(this.currentMidIndex),o={media:{mediaType:"application",port:"9",protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(i),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(o),{mediaDesc:o,needExchangeSDP:!0}}createOrRecycleRecvMedia(i,o,a,l,d,h){const f=i._mediaStreamTrack.kind,m=this.rtpCapabilities.recv,g=Lo(f,m,this.localCapabilities.send,f===_e.VIDEO?l:d),v=f===_e.VIDEO?m.videoExtensions:m.audioExtensions;this.currentMidIndex+=1;const y="".concat(this.currentMidIndex);let b={media:{mediaType:f,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:g.map(P=>P.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:v,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:o,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:g,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(y)}};b=this.mungRecvMediaDsec(b,i,h);const C=this.findFirstClosedMedia(f);if(C){const P=this.sessionDesc.mediaDescriptions.indexOf(C);this.sessionDesc.mediaDescriptions[P]=b}else this.sessionDesc.mediaDescriptions.push(b);return b}updateRemoteCodec(i,o,a){const l=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(b=>b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||"").filter(b=>{var C;return he(C=Object.keys(DR)).call(C,b)}))],d=new Set(o);if(l.every(b=>d.has(b)))return T.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(o)),!1;const h=this._rtpCapabilities.recv.videoCodecs.filter(b=>o.some(C=>{var P;return he(P=b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||"").call(P,C)}));if(0===h.length)return T.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(l," codecs: ").concat(o)),!1;const f=[...new Set(h.map(b=>b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||""))];let m;if(T.debug("updateRemoteCodec, from ".concat(l," to ").concat(f)),0===i.length)m=this.sessionDesc.mediaDescriptions.filter(b=>"video"===b.media.mediaType&&"recvonly"===b.attributes.direction);else if(m=this.sessionDesc.mediaDescriptions.filter(b=>b.attributes.mid&&he(i).call(i,b.attributes.mid)&&"recvonly"===b.attributes.direction),m.length!==i.length)return T.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(i,", codecs: ").concat(o)),!1;if(B("USE_PUB_RTX")||B("USE_SUB_RTX")){const b=oD(h,this.rtpCapabilities.recv.videoCodecs);h.push(...b)}this._rtpCapabilities.recv.videoCodecs=h;const y=Lo(_e.VIDEO,this.rtpCapabilities.recv,this.localCapabilities.send,a);return m.forEach(b=>{const C=y.map(P=>P.payloadType.toString(10));T.debug("updateRemoteCodec mid: ".concat(b.attributes.mid,", from"),b.attributes.payloads,"to",y),b.attributes.payloads=y,b.media.fmts=C}),!0}createOrRecycleSendMedia(i,o,a,l,d){const h=this.rtpCapabilities.send,f=i===_e.VIDEO?h.videoCodecs:h.audioCodecs,m=i===_e.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const g="".concat(this.currentMidIndex);let v={media:{mediaType:i,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:o,ssrcGroups:a,rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:l,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};v=this.mungSendMediaDesc(v,d);const y=this.findFirstClosedMedia(i);if(y){const b=this.sessionDesc.mediaDescriptions.indexOf(y);this.sessionDesc.mediaDescriptions[b]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(i=>"0"!==i.media.port).map(i=>i.attributes.mid)}mungRecvMediaDsec(i,o,a){const l=Vn(i);return rD(l),Kf(l,o),iD(l,o),gv(l),iC(l,a,this.localCapabilities.send),l}mungSendMediaDesc(i,o){const a=Vn(i);return iC(a,o,this.localCapabilities.recv),Nl(a),a}updateRecvMedia(i,o){const a=this.sessionDesc.mediaDescriptions.findIndex(l=>l.attributes.mid===i);if(-1!==a){const l=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],o);this.sessionDesc.mediaDescriptions[a]=l}}bumpMid(i){this.currentMidIndex+=i}findFirstClosedMedia(i){return this.sessionDesc.mediaDescriptions.find(o=>hn()?"0"===o.media.port&&o.media.mediaType===i:"0"===o.media.port)}findPreloadMediaDesc(i){return this.sessionDesc.mediaDescriptions.find(o=>{var a;return(null===(a=o.attributes)||void 0===a||null===(a=a.ssrcs[0])||void 0===a?void 0:a.ssrcId)===i[0].ssrcId})}getSSRC(i){var o;return null===(o=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===i))||void 0===o?void 0:o.attributes.ssrcs}}function AH(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function qd(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?AH(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):AH(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}let gC=function(r){return r.BANDWIDTH="bandwidth",r.CPU="cpu",r.NONE="none",r.OTHER="other",r}({});var Yd=function(r){return r[r.DOWN=0]="DOWN",r[r.UP=1]="UP",r}(Yd||{});const Dv=new Map;function xD(r,i,o,a){let{scale:l}=r;if(0===l&&a===Yd.UP||l>=i.length-1&&a===Yd.DOWN)return r;let d=qd(qd({},r),{},{scale:a===Yd.DOWN?++l:--l});switch(o){case"maintain-framerate":d=qd(qd({},d),i[l].motion);break;case"maintain-resolution":d=qd(qd({},d),i[l].detail);break;case"balanced":d=qd(qd({},d),i[l].balanced)}return d}function eF(r,i){if(i){const o={overUse:0,underUse:0,adaptationList:FD(i)};Dv.set(r,o)}else Dv.delete(r)}function FD(r){const i=qd({},r),{bitrateMax:o,frameRate:a,scaleResolutionDownBy:l,bitrateMin:d}=i,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:f,MAX_SCALE:m,BITRATE_MIN_THRESHOLD:g,BITRATE_MAX_THRESHOLD:v,BWE_SCALE_UP_THRESHOLD:y,BWE_SCALE_DOWN_THRESHOLD:b,PERF_SCALE_DOWN_THRESHOLD:C,PERF_SCALE_UP_THRESHOLD:P,BALANCE_BITRATE_FACTOR:R,BALANCE_FRAMERATE_FACTOR:A,BALANCE_RESOLUTION_FACTOR:O,MOTION_RESOLUTION_FACTOR:M,MOTION_BITRATE_FACTOR:x,DETAIL_FRAMERATE_FACTOR:j,DETAIL_BITRATE_FACTOR:W}=RR,q=Math.min(i.frameRate,f),te=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(b,1)*o),bwe_up:o,fps_down:Math.round(Math.pow(C,1)*q),fps_up:a},balanced:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:o,bitrateMin:d},motion:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:o,bitrateMin:d},detail:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:o,bitrateMin:d}}];for(let J=1;J<=m;J++){const X={bwe_up:Math.round(Math.pow(y,J)*o),bwe_down:Math.round(Math.pow(b,J+1)*o),fps_up:Math.round(Math.pow(P,J)*q),fps_down:Math.round(Math.pow(C,J+1)*q)},Ce={scaleResolutionDownBy:l/Math.pow(O,J),frameRate:Math.max(Math.round(Math.pow(A,J)*a),h),bitrateMax:Math.max(Math.round(Math.pow(R,J)*o),v),bitrateMin:Math.max(Math.round(Math.pow(R,J)*d),g)},Re={scaleResolutionDownBy:l/Math.pow(M,J),frameRate:a,bitrateMax:Math.max(Math.round(Math.pow(x,J)*o),v),bitrateMin:Math.max(Math.round(Math.pow(x,J)*d),g)},ut={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(j,J)*a),h),bitrateMax:Math.max(Math.round(Math.pow(W,J)*o),v),bitrateMin:Math.max(Math.round(Math.pow(W,J)*d),g)};te.push({scale:J,threshold:X,balanced:Ce,motion:Re,detail:ut})}return te}function DH(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function tF(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?DH(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):DH(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}const UD=new Map;function VD(r,i){const o=UD.get(r);if(o){const{timer:a}=o;window.clearTimeout(a),UD.delete(r)}i.qualityLimitationReason=gC.NONE,eF(r)}var rt;function OH(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function kl(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?OH(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):OH(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}let Va=(rt=class iN extends WR{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var i,o;return null!==(i=null===(o=this.peerConnection.getReceivers()[0])||void 0===o||null===(o=o.transport)||void 0===o?void 0:o.state)&&void 0!==i?i:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(i=>i.rtpMap&&i.rtpMap.encodingName.toLowerCase()||"").filter(i=>{var o;return he(o=Object.keys(DR)).call(o,i)}))]}constructor(i,o){super(i,o),N(this,"store",void 0),N(this,"peerConnection",void 0),N(this,"id",Ct(5,"connection-")),N(this,"remoteSDP",void 0),N(this,"initialOffer",void 0),N(this,"transportEventReceiver",void 0),N(this,"statsFilter",void 0),N(this,"extension",{useXR:B("USE_XR")}),N(this,"localCapabilities",void 0),N(this,"remoteCodecs",void 0),N(this,"localCandidateCount",0),N(this,"allCandidatesReceived",!1),N(this,"isPreallocation",!1),N(this,"preSSRCMap",new Map),N(this,"dataStreamChannelMap",new Map),N(this,"establishPromise",void 0),N(this,"recoveredDataChannelIds",[]),N(this,"currentDataChannelId",1),N(this,"mutex",void 0),N(this,"qualityLimitationReason",gC.NONE),this.store=o,this.mutex=new Qr("P2PConnection-mutex",o.clientId),this.peerConnection=new RTCPeerConnection(iN.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.statsFilter=hC(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,hn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(i){const o=this.preSSRCMap.get(i);if(void 0!==o){const a=this.peerConnection.getTransceivers().find(l=>l.mid===o);if(a)return{transceiver:a,track:a.receiver.track,id:o}}}updateRemoteRTPCapabilities(i,o){var a=this;return L(function*(){if(a.remoteCodecs=o,a.remoteSDP)if(a.remoteSDP.updateRemoteCodec(i,o,a.store.codec)){const l=yield a.peerConnection.createOffer(),d=a.logSDPExchange(l.sdp||"","offer","local","muteLocal");yield a.peerConnection.setLocalDescription(l);const h=a.remoteSDP.toString();d?.(h),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}else T.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else T.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(a.localCodecs,", codecs: ").concat(o))})()}establish(){var i=this;return L(function*(){try{i.peerConnection.addTransceiver("video",{direction:"recvonly"}),i.peerConnection.addTransceiver("audio",{direction:"recvonly"});const a=yield i.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const l=Gd(a.sdp),d=yield Tn({filterRTX:!B("USE_PUB_RTX")&&!B("USE_SUB_RTX"),filterVideoFec:B("FILTER_VIDEO_FEC"),filterAudioFec:B("FILTER_AUDIO_FEC"),filterVideoCodec:B("FILTER_VIDEO_CODEC")},i.extension);let h;return i.localCapabilities=ea(d),i.initialOffer=a,a.sdp&&_v(a.sdp)&&(h=Vn(d),(o=h).send&&(fv(_e.VIDEO,o.send.videoExtensions),fv(_e.AUDIO,o.send.audioExtensions)),o.recv&&(fv(_e.VIDEO,o.recv.videoExtensions),fv(_e.AUDIO,o.recv.audioExtensions)),o.sendrecv&&(fv(_e.VIDEO,o.sendrecv.videoExtensions),fv(_e.AUDIO,o.sendrecv.audioExtensions))),kl(kl({},l),{},{rtpCapabilities:h||d,offerSDP:a.sdp})}catch(a){throw new Y(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}var o})()}connect(i){var o=this;return L(function*(){try{if(!o.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");o.initialOffer.sdp&&_v(o.initialOffer.sdp)&&(l=o.localCapabilities,(a=i.rtpCapabilities).send&&(tD(_e.VIDEO,a.send.videoExtensions,l.send.videoExtensions),tD(_e.AUDIO,a.send.audioExtensions,l.send.audioExtensions)),a.recv&&(tD(_e.VIDEO,a.recv.videoExtensions,l.recv.videoExtensions),tD(_e.AUDIO,a.recv.audioExtensions,l.recv.audioExtensions))),o.remoteSDP=new Q2(kl(kl({},i),{},{localCapabilities:o.localCapabilities})),i.preallocation&&(o.isPreallocation=!0),Array.isArray(o.remoteCodecs)&&o.remoteCodecs.length>0&&o.remoteSDP.updateRemoteCodec([],o.remoteCodecs,o.store.codec);const d=o.remoteSDP.toString(),h=cr(o.initialOffer.sdp,o.extension),f=o.logSDPExchange(h||"","offer","local","connect");o.store.descriptionStart(),yield o.peerConnection.setLocalDescription({type:"offer",sdp:h}),f?.(d),yield o.peerConnection.setRemoteDescription({type:"answer",sdp:d});const m=o.peerConnection.getTransceivers()[0];if(null!=m&&m.receiver&&o.tryBindTransportEvents(m.receiver),B("PRELOAD_MEDIA_COUNT")>0){o.remoteSDP.preloadRemoteMedia(B("PRELOAD_MEDIA_COUNT"));const v=o.remoteSDP.toString();yield o.peerConnection.setRemoteDescription({type:"offer",sdp:v});const y=yield o.peerConnection.createAnswer();yield o.peerConnection.setLocalDescription(y)}const{preSSRCs:g}=i;if(Array.isArray(g)&&g.length>0){const{mids:v}=o.remoteSDP.batchSend(g.map(y=>({kind:y.kind,ssrcMsg:[{ssrcId:y.ssrcId,rtx:y.rtx}],mslabel:y.mslabel})));v.forEach((y,b)=>{o.preSSRCMap.set(g[b].ssrcId,y)}),yield Lr(o.peerConnection,o.remoteSDP,o.extension),T.debug("[".concat(o.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(d){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(d.toString()))}var a,l})()}updateRemoteConnect(i){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:a}=i;o.remoteSDP.updateRemoteRTPCapabilities(a),Array.isArray(o.remoteCodecs)&&o.remoteCodecs.length>0&&o.remoteSDP.updateRemoteCodec([],o.remoteCodecs,o.store.codec);const{preSSRCs:l}=i;if(Array.isArray(l)&&l.length>0){const{mids:d}=o.remoteSDP.batchSend(l.map(h=>Object.assign({},{kind:h.kind,ssrcMsg:[{ssrcId:h.ssrcId,rtx:h.rtx}],mslabel:h.mslabel})));d.forEach((h,f)=>{o.preSSRCMap.set(l[f].ssrcId,h)})}yield Lr(o.peerConnection,o.remoteSDP,o.extension),T.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(a.toString()))}})()}send(i,o,a){var l=this;return ts(function*(){const d=yield tt(l.mutex.lock("From P2PConnection.send"));try{if(!l.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[];i.forEach(R=>{const A=l.peerConnection.addTransceiver(R._mediaStreamTrack,{direction:"sendonly"});h.push(A),R._updateRtpTransceiver(A)}),hn()&&!0===B("SIMULCAST")&&(yield tt(l.applySimulcastForFirefox(h,i)));const f=yield tt(l.peerConnection.createOffer()),m=l.remoteSDP.predictReceivingMids(i.length),g=l.mungSendOfferSDP(f.sdp,i,m),v=vr.parse(g),y=m.map(R=>{const A=v.mediaDescriptions.find(O=>O.attributes.mid===R);if(!A)throw new Error("Cannot extract ssrc from mediaDescription.");return oH(A,B("USE_PUB_RTX"))});let b;try{b=yield y}catch(R){b=[],l.remoteSDP.receive(i,o,a,b);const A=l.remoteSDP.toString();throw yield tt(l.peerConnection.setLocalDescription({type:"offer",sdp:g})),yield tt(l.peerConnection.setRemoteDescription({type:"answer",sdp:A})),yield tt(l.stopSending(m,!0)),R}l.remoteSDP.receive(i,o,a,b);const C=l.remoteSDP.toString(),P=l.logSDPExchange(g,"offer","local","send");return yield tt(l.peerConnection.setLocalDescription({type:"offer",sdp:g})),yield tt(l.applySimulcastEncodings(h,i)),yield tt(l.applySendEncodings(h,i)),P?.(C),yield tt(l.peerConnection.setRemoteDescription({type:"answer",sdp:C})),h.map((R,A)=>({localSSRC:y[A],id:m[A],transceiver:R}))}catch(h){throw h instanceof Y?h:new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}createDataChannels(i,o){var a=this;return L(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let l=a.dataStreamChannelMap.get(i);if(l&&"open"===l.readyState)T.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const h=a.currentDataChannelId<1023?a.currentDataChannelId++:a.recoveredDataChannelIds.shift();if("number"!=typeof h)throw new Error("create DataChannel error, because cannot get dc id");l=a.peerConnection.createDataChannel("datastream-channel",{id:h,negotiated:!0,ordered:!1,maxRetransmits:B("DATASTREAM_MAX_RETRANSMITS")}),l.binaryType="arraybuffer",a.dataStreamChannelMap.set(i,l)}o.forEach(h=>{h._updateOriginDataChannel(l)});const{needExchangeSDP:d}=a.remoteSDP.sendDataChannel();if(d){const h=a.remoteSDP.toString();yield a.peerConnection.setRemoteDescription({type:"offer",sdp:h});const f=yield a.peerConnection.createAnswer();yield a.peerConnection.setLocalDescription(f),T.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else T.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(l){throw l instanceof Y?l:new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(l.toString()))}})()}stopDataChannels(i){var o=this;return L(function*(){try{const a=o.dataStreamChannelMap.get(i);return a&&(a.id&&o.recoveredDataChannelIds.push(a.id),a.close()),void o.dataStreamChannelMap.delete(i)}catch(a){throw a instanceof Y?a:new Y(k.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(a.toString()))}})()}stopSending(i,o){var a=this;return L(function*(){const l=o?void 0:yield a.mutex.lock("From P2PConnection.stopSending");try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const d=a.peerConnection.getTransceivers().filter(g=>-1!==i.indexOf(g.mid));if(d.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");d.map(g=>{var v;VD(a.id+g.mid,a),g.direction="inactive",null===(v=g.stop)||void 0===v||v.call(g)});const h=yield a.peerConnection.createOffer(),f=a.logSDPExchange(h.sdp||"","offer","local","stopSending");yield a.peerConnection.setLocalDescription(h),a.remoteSDP.stopReceiving(i);const m=a.remoteSDP.toString();f?.(m),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(d){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(d.toString()))}finally{l&&l()}})()}receive(i,o,a,l){var d=this;return L(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{mid:h,needExchangeSDP:f}=d.remoteSDP.send(i,o,a,l);f&&(yield Lr(d.peerConnection,d.remoteSDP,d.extension),T.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(i," by exchanging SDP.")));const m=d.peerConnection.getTransceivers().find(g=>g.mid===h);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:h,transceiver:m}}catch(h){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}batchReceive(i){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:a,needExchangeSDP:l}=o.remoteSDP.batchSend(i);return l&&(yield Lr(o.peerConnection,o.remoteSDP,o.extension),T.debug("[".concat(o.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),a.map(d=>{const h=o.peerConnection.getTransceivers().find(f=>f.mid===d);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:d,transceiver:h}})}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}})()}stopReceiving(i){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");i.forEach(h=>{Array.from(o.preSSRCMap.entries()).some(f=>{let[m,g]=f;if(g===h)return o.preSSRCMap.delete(m),!0})}),o.remoteSDP.stopSending(i);const a=o.remoteSDP.toString(),l=o.logSDPExchange(a,"offer","remote","stopReceiving");yield o.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield o.peerConnection.createAnswer();l?.(d.sdp||""),yield o.peerConnection.setLocalDescription(d)}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}})()}muteRemote(i){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(i," before remote SDP created."));o.remoteSDP.mute(i);const a=o.remoteSDP.toString(),l=o.logSDPExchange(a,"offer","remote","muteRemote");yield o.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield o.peerConnection.createAnswer();l?.(d.sdp||""),yield o.peerConnection.setLocalDescription(d)}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(a.toString()))}})()}unmuteRemote(i){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(i," before remote SDP created."));o.remoteSDP.unmute(i);const a=o.remoteSDP.toString(),l=o.logSDPExchange(a,"offer","remote","unmuteRemote");yield o.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield o.peerConnection.createAnswer();l?.(d.sdp||""),yield o.peerConnection.setLocalDescription(d)}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(a.toString()))}})()}muteLocal(i){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const a=o.peerConnection.getTransceivers().filter(f=>f.mid&&-1!==i.indexOf(f.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(f=>{f.direction="inactive"});const l=yield o.peerConnection.createOffer(),d=o.logSDPExchange(l.sdp||"","offer","local","muteLocal");yield o.peerConnection.setLocalDescription(l),o.remoteSDP.muteRemote(i);const h=o.remoteSDP.toString();d?.(h),yield o.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(a.toString()))}})()}unmuteLocal(i){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const a=o.peerConnection.getTransceivers().filter(f=>f.mid&&-1!==i.indexOf(f.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(function(){var f=L(function*(m,g){m.direction="sendonly"});return function(m,g){return f.apply(this,arguments)}}());const l=yield o.peerConnection.createOffer(),d=o.logSDPExchange(l.sdp||"","offer","local","unmuteLocal");yield o.peerConnection.setLocalDescription(l),o.remoteSDP.unmuteRemote(i);const h=o.remoteSDP.toString();d?.(h),yield o.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(a.toString()))}})()}restartICE(i){var o=this;return ts(function*(){const a=yield tt(o.mutex.lock("From P2PConnection.restartICE"));try{if(!o.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(ct().supportPCSetConfiguration){const g=o.peerConnection.getConfiguration(),v=i===uo.RELAY?"relay":"all";g.iceTransportPolicy!==v&&(T.debug("[".concat(o.store.clientId,"] restartICE change iceTransportPolicy from [").concat(g.iceTransportPolicy,"] to [").concat(v,"]")),g.iceTransportPolicy=v,o.peerConnection.setConfiguration(g))}else if(i===uo.RELAY)return;o.remoteSDP.updateCandidates(i);const l=yield tt(o.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=Gd(l.sdp),{remoteIceParameters:h}=yield d.iceParameters;o.remoteSDP.restartICE(h);const f=o.remoteSDP.toString(),m=o.logSDPExchange(l.sdp||"","offer","local","restartICE");o.store.descriptionStart(),yield tt(o.peerConnection.setLocalDescription(l)),m?.(f),yield tt(o.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(l){T.warning("[".concat(o.store.clientId,"] restart ICE failed, abort operation"),l)}finally{a()}})()}close(){var i;this.peerConnection.getTransceivers().forEach(o=>{VD(this.id+o.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return kl(kl({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}updateEncoderConfig(i,o){var a=this;return L(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const l=yield a.peerConnection.createOffer(),d=a.mungSendOfferSDP(l.sdp,[o],[i]);a.remoteSDP.updateRecvMedia(i,o);const h=a.remoteSDP.toString(),f=a.logSDPExchange(d,"offer","local","updateEncoderConfig");yield a.peerConnection.setLocalDescription({type:"offer",sdp:d}),f?.(h),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(l){throw new Y(k.EXCHANGE_SDP_FAILED,l.toString())}})()}updateSendParameters(i,o){var a=this;return L(function*(){const l=a.peerConnection.getTransceivers().filter(d=>d.mid===i);1===l.length&&(a.isVP8Simulcast(o)?hn()||(yield a.applySimulcastEncodings(l,[o])):yield a.applySendEncodings(l,[o]))})()}setStatsRemoteVideoIsReady(i,o){this.statsFilter.setVideoIsReady2(i,o)}replaceTrack(i,o){var a=this;return L(function*(){const l=a.peerConnection.getTransceivers().find(d=>d.mid===o);l&&(yield l.sender.replaceTrack(i._mediaStreamTrack))})()}getSelectedCandidatePair(){var i=this;return L(function*(){const o=i.peerConnection.getReceivers();if(o.length>0&&o[0].transport&&o[0].transport.iceTransport&&o[0].transport.iceTransport.getSelectedCandidatePair&&o[0].transport.iceTransport.getSelectedCandidatePair()){const a=o[0].transport.iceTransport,{local:l,remote:d}=a.getSelectedCandidatePair();return{local:kl(kl({},Dc),{},{candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port}),remote:kl(kl({},Dc),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})}}return i.statsFilter.getSelectedCandidatePair()})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;null===(i=this.onICEConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},B("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const o={iceServers:[]};return i.iceServers?o.iceServers=i.iceServers:i.turnServer&&"off"!==i.turnServer.mode&&(pS(i.turnServer.servers)?o.iceServers=i.turnServer.servers:(o.iceServers&&o.iceServers.push(...iN.turnServerConfigToIceServers(i.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&o.iceServers&&i.turnServer.serversFromGateway&&o.iceServers.push(...iN.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),B("FORCE_TURN_TCP")?o.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(o.iceTransportPolicy="relay")}))),B("ENABLE_ENCODED_TRANSFORM")&&ct().supportWebRTCEncodedTransform&&(o.encodedInsertableStreams=!0),o}static turnServerConfigToIceServers(i){const o=[];return i.forEach(a=>{a.security?a.tcpport&&o.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(vh(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!B("FORCE_TURN_TCP")&&o.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&o.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),o}tryBindTransportEvents(i){const o=i.transport;if(o){this.transportEventReceiver=i,o.onstatechange=()=>{var l;null!=o&&o.state&&(null===(l=this.onDTLSTransportStateChange)||void 0===l||l.call(this,o.state))},o.onerror=l=>{var d;null===(d=this.onDTLSTransportError)||void 0===d||d.call(this,"error"in l?l.error:l)};const a=o.iceTransport;a&&(a.onstatechange=()=>{const l=o?.iceTransport.state;var d;l&&(null===(d=this.onICETransportStateChange)||void 0===d||d.call(this,l))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){const{local:l,remote:d}=a.getSelectedCandidatePair();T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:l.type,protocol:l.protocol}),", remote ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(i,o){var a=this;return L(function*(){var l,d;if(o||(o=a.peerConnection.getSenders().find(O=>O.track===i._mediaStreamTrack)),!o)return T.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(a.isVP8Simulcast(i))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ct().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const h={},f={};switch(i._optimizationMode){case"motion":h.degradationPreference="maintain-framerate";break;case"detail":h.degradationPreference="maintain-resolution";break;case"balanced":h.degradationPreference="balanced"}const m=(O=i._mediaStreamTrack,a.peerConnection.getTransceivers().find(M=>M.sender.track===O||M.receiver.track===O)),g=(r=>{const i=r._encoderConfig;if(!i)return;const{frameRate:o,width:a,height:l}=r.getMediaStreamTrackSettings();let{frameRate:d=o,width:h=a,height:f=l}=i;if(!d||!h||!f)return;h=mS(h),f=mS(f),d=mS(d);const{max:m,min:g}=function(C,P,R){const A=200*Math.pow(R/15,.6)*Math.pow(C*P/640/360,.75);return{min:Math.floor(A),max:Math.floor(4*A)}}(h,f,d),{bitrateMax:v,bitrateMin:y}=i||{};v||T.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(f,", fps: ").concat(d,"] => [brMax: ").concat(v,", brMin: ").concat(y,"]"));const{maxFramerate:b}=B("ENCODER_CONFIG_LIMIT");return b&&"number"==typeof b&&(d=Math.min(d,b)),{frameRate:d,bitrateMax:v||m,bitrateMin:y||g,scaleResolutionDownBy:1,scale:0}})(i);var O;if(function Az(r){var i;return!(!B("ENABLE_AG_ADAPTATION")||!(r instanceof XS||he(i=r._hints).call(i,zt.CUSTOM_TRACK))||!B("FORCE_SUPPORT_AG_ADAPTATION")&&!(function(){const a=ot();if(a.os!==hr.IOS||!a.osVersion)return!1;const l=a.osVersion.split(".");return Number(l[0])>=14}()&&Ws(17,4,!0)||Da(14)&&zs(17,4,!0)))}(i)&&m&&o&&g&&a.getLocalVideoStats&&he(l=["vp8","vp9"]).call(l,a.store.codec)){var v;const A=h.degradationPreference||(he(v=i._hints).call(v,zt.CUSTOM_TRACK)?B("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");!function(O,M,x,j,W,q){if(VD(O,x),W(M),"balanced"!==j&&"maintain-framerate"!==j&&"maintain-resolution"!==j)return;let te=-1;eF(O,M);const J=window.setInterval(()=>{const Ce=UD.get(O);if(!B("ENABLE_AG_ADAPTATION")||!Ce)return VD(O,x),void W(M);const Re=q();if(Re.sendPackets>0&&Re.OutgoingAvailableBandwidth>0){if(-1===te)return void(te=Date.now());if(Date.now()-te<1e3)return;const ut=Re.sendFrameRate,Nt=Re.OutgoingAvailableBandwidth,[_n,Zt]=function Qf(r,i,o,a,l,d){const h=Dv.get(r)||{overUse:0,underUse:0,adaptationList:FD(l)},{adaptationList:f}=h;Dv.set(r,h);const{OVERUSE_TIMES_THRESHOLD:m,UNDERUSE_TIMES_THRESHOLD:g}=RR,{scale:v}=a;let y,b;return"number"==typeof i&&i>0&&function(C,P,R,A){if(P>=R.length)return!1;let{threshold:{fps_down:O}}=R[P];return B("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===A&&(O=R[0].threshold.fps_down),C<O}(i,v,f,d)&&(h.overUse++,b=gC.CPU,h.overUse>m)||"number"==typeof o&&o>0&&function(C,P,R){if(P>=R.length)return!1;const{threshold:{bwe_down:A}}=R[P];return C<A}(o,v,f)&&(h.overUse++,b=gC.BANDWIDTH,h.overUse>m)?(h.overUse=0,h.underUse=0,y=xD(a,f,d,Yd.DOWN),[y,b]):("number"==typeof i&&i>0&&"number"==typeof o&&o>0&&function(C,P,R,A){if(0===P)return;let{threshold:{fps_up:O}}=R[P];return B("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===A&&(O=R[1].threshold.fps_up),C>O}(i,v,f,d)&&function(C,P,R){if(0===P)return;const{threshold:{bwe_up:A}}=R[P];return C>A}(o,v,f)&&(h.underUse++,h.underUse>g&&(h.overUse=0,h.underUse=0,y=xD(a,f,d,Yd.UP),0===y.scale&&(b=gC.NONE))),[y,b])}(O,ut,Nt,Ce.adaptationConfig,M,j);Zt&&(x.qualityLimitationReason=Zt),_n&&Ce.adaptationConfig.scale!==_n.scale&&(T.debug("[".concat(O,"] applyAdaptation: ").concat(x.qualityLimitationReason,"\n           sendFps ").concat(ut,", bwe ").concat(Nt,", switch from ").concat(Ce.adaptationConfig.scale," to ").concat(_n.scale," ")),Ce.adaptationConfig=tF(tF({},Ce.adaptationConfig),_n),W(_n))}},B("CHECK_LOCAL_STATS_INTERVAL")),X=tF({},M);UD.set(O,{timer:J,adaptationConfig:X,originConfig:M,adaptationFunc:W}),T.debug("[".concat(O,"] start adaptation, originConfig: ").concat(JSON.stringify(M),", degradationPreference: ").concat(j))}(a.id+m.mid,g,a,A,O=>{o&&a.updateAdaptation(o,O)},a.getLocalVideoStats.bind(a))}if(i._encoderConfig){var y;const{bitrateMax:A,frameRate:O,scaleResolutionDownBy:M}=i._encoderConfig;A&&(f.maxBitrate=1e3*A),(he(y=i._hints).call(y,zt.LOW_STREAM)||i.isUseScaleResolutionDownBy)&&(O&&(f.maxFramerate=Pi(O)),M&&M>=1&&(f.scaleResolutionDownBy=M))}const{maxFramerate:b}=B("ENCODER_CONFIG_LIMIT");if(b&&"number"==typeof b&&(f.maxFramerate=f.maxFramerate?Math.min(f.maxFramerate,b):b),B("DSCP_TYPE")&&pl()){var C;const A=B("DSCP_TYPE");he(C=["very-low","low","medium","high"]).call(C,A)&&(f.networkPriority=A)}const P=o.getParameters(),R=null===(d=P.encodings)||void 0===d?void 0:d[0];var A;hn()&&!R&&(h.encodings=[f]),R&&Object.assign(R,f),Object.assign(P,h),T.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(P.encodings))),yield o.setParameters(P),yield(A=L(function*(O,M,x){try{var j;if(!ct().supportSetRtpSenderParameters||!function(X){return"vp9"===X}(O)||!B("ENABLE_SVC"))return;const W={},q={},te=M.getParameters(),J=null===(j=te.encodings)||void 0===j?void 0:j[0];q.scalabilityMode=ls(x),J&&Object.assign(J,q),Object.assign(te,W),yield M.setParameters(te),T.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(te.encodings)))}catch(W){T.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",W)}}),function(O,M,x){return A.apply(this,arguments)})(a.store.codec,o,B("SVC_MODE"))})()}updateAdaptation(i,o){var a=this;return L(function*(){var l,d;if(!i)return T.debug("[updateAdaptation] no rtpSender found");if(!ct().supportSetRtpSenderParameters)return T.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const h={},{bitrateMax:f,frameRate:m,scaleResolutionDownBy:g}=o;f&&(h.maxBitrate=1e3*f),m&&(h.maxFramerate=Pi(m)),g&&g>=1&&he(l=["vp8","vp9"]).call(l,a.store.codec)&&(h.scaleResolutionDownBy=g);const v=i.getParameters(),y=null===(d=v.encodings)||void 0===d?void 0:d[0];y&&Object.assign(y,h),Object.assign(v,{});try{yield i.setParameters(v),T.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(b){!("transport"in i)||i.transport&&"connected"===i.transport.state?"connected"!==a.peerConnectionState?T.debug("[updateAdaptation] peerConnection not connected}"):T.debug("[updateAdaptation] updateRtpSenderEncodings failed",b):T.debug("[updateAdaptation] rtpSender transport not connected}")}})()}applySendEncodings(i,o){var a=this;return L(function*(){try{if(!ct().supportSetRtpSenderParameters||i.length!==o.length)return;for(let l=0;l<i.length;l++){const d=i[l],h=o[l];h instanceof Ve&&!a.isVP8Simulcast(h)&&(yield a.updateRtpSenderEncodings(h,d.sender))}}catch{T.debug("[".concat(a.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(i,o,a){const l=vr.parse(i);return o.forEach((d,h)=>{const f=a[h],m=l.mediaDescriptions.find(g=>g.attributes.mid===f);m&&(Kf(m,d),Ac(m,d,this.store.codec))}),vr.print(l)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var o;null===(o=this.onFirstAudioReceived)||void 0===o||o.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var o;null===(o=this.onFirstVideoReceived)||void 0===o||o.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var o;null===(o=this.onFirstAudioDecoded)||void 0===o||o.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,o,a)=>{var l;null===(l=this.onFirstVideoDecoded)||void 0===l||l.call(this,i,o,a)},this.statsFilter.onSelectedLocalCandidateChanged=(i,o)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,i,o)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,o)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,i,o)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var o;null===(o=this.onFirstVideoDecodedTimeout)||void 0===o||o.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(i,o){var a=this;return L(function*(){if(i.length===o.length)for(let g=0;g<i.length;g++){var l,d,h,f,m;const v=i[g],y=o[g];if(y instanceof Ve&&!he(l=y._hints).call(l,zt.LOW_STREAM)&&null!==(d=y._encoderConfig)&&void 0!==d&&d.bitrateMax&&(null===(h=y._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(f=y._scalabilityMode)&&void 0!==f&&f.numSpatialLayers&&(null===(m=y._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===a.store.codec){const b={},C={high:1e3*(y._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{rid:"m",active:!0,maxBitrate:C.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:C.high}];const P=v.sender.getParameters();yield v.sender.setParameters(Object.assign(P,b))}}})()}applySimulcastEncodings(i,o){var a=this;return L(function*(){if(!hn()&&i.length===o.length)for(let l=0;l<i.length;l++){const d=o[l];if(d instanceof Ve&&a.isVP8Simulcast(d)){const h=i[l],f={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=h.sender.getParameters();yield h.sender.setParameters(Object.assign(g,f))}}})()}isVP8Simulcast(i){var o,a,l,d,h;return!!(i instanceof Ve&&B("SIMULCAST")&&"vp8"===this.store.codec&&!he(o=i._hints).call(o,zt.LOW_STREAM)&&null!==(a=i._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(l=i._encoderConfig)||void 0===l?void 0:l.bitrateMax)>200&&null!==(d=i._scalabilityMode)&&void 0!==d&&d.numSpatialLayers&&(null===(h=i._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(i,o,a,l){if(B("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(o," SDP during P2PConnection.").concat(l,"\n"),i),"offer"===o?d=>{this.logSDPExchange(d,"answer","local"===a?"remote":"local",l)}:void 0}getRemoteSSRC(i){var o=this;return L(function*(){if(!o.remoteSDP)return;const a=o.remoteSDP.getSSRC(i);return a&&0!==a.length?a[0].ssrcId:void 0})()}setConfiguration(i){if(ct().supportPCSetConfiguration){const o=iN.resolvePCConfiguration(i);this.peerConnection.setConfiguration(o)}}},pe(rt.prototype,"updateRemoteRTPCapabilities",[Ki],Object.getOwnPropertyDescriptor(rt.prototype,"updateRemoteRTPCapabilities"),rt.prototype),pe(rt.prototype,"connect",[Ki],Object.getOwnPropertyDescriptor(rt.prototype,"connect"),rt.prototype),pe(rt.prototype,"updateRemoteConnect",[Ki],Object.getOwnPropertyDescriptor(rt.prototype,"updateRemoteConnect"),rt.prototype),pe(rt.prototype,"createDataChannels",[Ki],Object.getOwnPropertyDescriptor(rt.prototype,"createDataChannels"),rt.prototype),pe(rt.prototype,"receive",[Ki],Object.getOwnPropertyDescriptor(rt.prototype,"receive"),rt.prototype),pe(rt.prototype,"batchReceive",[Ki],Object.getOwnPropertyDescriptor(rt.prototype,"batchReceive"),rt.prototype),pe(rt.prototype,"stopReceiving",[Ki],Object.getOwnPropertyDescriptor(rt.prototype,"stopReceiving"),rt.prototype),pe(rt.prototype,"muteRemote",[Ki],Object.getOwnPropertyDescriptor(rt.prototype,"muteRemote"),rt.prototype),pe(rt.prototype,"unmuteRemote",[Ki],Object.getOwnPropertyDescriptor(rt.prototype,"unmuteRemote"),rt.prototype),pe(rt.prototype,"muteLocal",[Ki],Object.getOwnPropertyDescriptor(rt.prototype,"muteLocal"),rt.prototype),pe(rt.prototype,"unmuteLocal",[Ki],Object.getOwnPropertyDescriptor(rt.prototype,"unmuteLocal"),rt.prototype),pe(rt.prototype,"close",[Ki],Object.getOwnPropertyDescriptor(rt.prototype,"close"),rt.prototype),pe(rt.prototype,"updateEncoderConfig",[Ki],Object.getOwnPropertyDescriptor(rt.prototype,"updateEncoderConfig"),rt.prototype),pe(rt.prototype,"updateSendParameters",[Ki],Object.getOwnPropertyDescriptor(rt.prototype,"updateSendParameters"),rt.prototype),pe(rt.prototype,"replaceTrack",[Ki],Object.getOwnPropertyDescriptor(rt.prototype,"replaceTrack"),rt.prototype),pe(rt.prototype,"updateAdaptation",[Ki],Object.getOwnPropertyDescriptor(rt.prototype,"updateAdaptation"),rt.prototype),pe(rt.prototype,"getRemoteSSRC",[Ki],Object.getOwnPropertyDescriptor(rt.prototype,"getRemoteSSRC"),rt.prototype),rt);function Ki(r,i,o){const a=r[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return o.value=L(function*(){const l=this.mutex,d=yield l.lock("From P2PConnection.".concat(i));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return yield a.apply(this,f)}finally{d()}}),o}var ze;function NH(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function Nc(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?NH(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):NH(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}function PH(r){var i,o,a,l=2;for(typeof Symbol<"u"&&(o=rS,a=Symbol.iterator);l--;){if(o&&null!=(i=r[o]))return i.call(r);if(a&&null!=(i=r[a]))return new _C(i.call(r));o="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function _C(r){function i(o){if(Object(o)!==o)return le.reject(new TypeError(o+" is not an object."));var a=o.done;return le.resolve(o.value).then(function(l){return{value:l,done:a}})}return(_C=function(o){this.s=o,this.n=o.next}).prototype={s:null,n:null,next:function(){return i(this.n.apply(this.s,arguments))},return:function(o){var a=this.s.return;return void 0===a?le.resolve({value:o,done:!0}):i(a.apply(this.s,arguments))},throw:function(o){var a=this.s.return;return void 0===a?le.reject(o):i(a.apply(this.s,arguments))}},new _C(r)}let vC=(ze=class extends nn{get state(){return this._state}set state(r){const i=this._state;this._state=r,this.emit(De.StateChange,i,this._state)}constructor(r,i){var o;super(),o=this,N(this,"isPlanB",void 0),N(this,"store",void 0),N(this,"statsUploader",void 0),N(this,"connection",void 0),N(this,"localTrackMap",new Map),N(this,"remoteUserMap",new Map),N(this,"localDataChannels",[]),N(this,"remoteDataChannelMap",new Map),N(this,"pendingLocalTracks",[]),N(this,"pendingRemoteTracks",[]),N(this,"pendingLocalDataChannels",[]),N(this,"pendingRemoteDataChannels",[]),N(this,"statsCollector",void 0),N(this,"shouldForwardP2PCreation",void 0),N(this,"iceFailedCount",0),N(this,"dtlsFailedCount",0),N(this,"mutex",void 0),N(this,"_state",Dt.Disconnected),N(this,"_pcStatsUploadType",B("NEW_ICE_RESTART")?Tc.FIRST_CONNECTION:Tc.OLD_FIRST_CONNECTION),N(this,"_isInRestartIce",!1),N(this,"_isStartRestartIce",!1),N(this,"_restartStates",["disconnected","failed"]),N(this,"_restartTimer",void 0),N(this,"_isFirstConnected",!0),N(this,"handleMuteLocalTrack",function(){var a=L(function*(l,d,h){const f=yield o.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!o.connection||o.state!==Dt.Connected)return void h(new Y(k.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const m=o.filterTobeMutedTracks(l);if(0===m.length)return void d();const g=m.find(y=>"videoLowTrack"===y[0]);g&&g[1].track._originMediaStreamTrack.stop(),yield o.connection.muteLocal(m.map(y=>{let[,{id:b}]=y;return b}));const v=o.createMuteMessage(m);yield Bt(o,De.RequestMuteLocal,v),d()}catch(m){h(m)}finally{f()}});return function(l,d,h){return a.apply(this,arguments)}}()),N(this,"handleUnmuteLocalTrack",function(){var a=L(function*(l,d,h){const f=yield o.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!o.connection||o.state!==Dt.Connected)return void h(new Y(k.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const m=o.filterTobeUnmutedTracks(l);if(0===m.length)return void d();const g=m.find(y=>"videoLowTrack"===y[0]);if(g){const y=g[1];if(y.track._originMediaStreamTrack.stop(),!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&ct().supportDualStreamEncoding){const b=l._mediaStreamTrack.clone();y.track._mediaStreamTrack=b,y.track._originMediaStreamTrack=b}else{const b=j2(l,A_(o,De.RequestLowStreamParameter));y.track._mediaStreamTrack=b,y.track._originMediaStreamTrack=b}yield new le((b,C)=>{o.handleReplaceTrack(y.track,b,C,!0)})}yield o.connection.unmuteLocal(m.map(y=>{let[,{id:b}]=y;return b}));const v=o.createUnmuteMessage(m);yield Bt(o,De.RequestUnmuteLocal,v),d()}catch(m){h(m)}finally{f()}});return function(l,d,h){return a.apply(this,arguments)}}()),N(this,"handleUpdateVideoEncoder",function(){var a=L(function*(l,d,h){const f=yield o.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const m=o.localTrackMap.get(ee.LocalVideoTrack);if(!o.connection||!m||m.track!==l||o.state!==Dt.Connected)return void d();const{id:g,track:v}=m;yield o.connection.updateSendParameters(g,v),yield o.connection.updateEncoderConfig(g,v),o.emit(De.UpdateVideoEncoder,v),d()}catch(m){h(m)}finally{f()}});return function(l,d,h){return a.apply(this,arguments)}}()),N(this,"handleUpdateVideoSendParameters",function(){var a=L(function*(l,d,h){const f=yield o.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const m=o.localTrackMap.get(ee.LocalVideoTrack);if(!o.connection||!m||m.track!==l||o.state!==Dt.Connected)return void d();const{id:g,track:v}=m;yield o.connection.updateSendParameters(g,v),d()}catch(m){h(m)}finally{f()}});return function(l,d,h){return a.apply(this,arguments)}}()),N(this,"handleReplaceMixingTrack",function(){var a=L(function*(l,d,h,f){if(!o.connection||o.state!==Dt.Connected)return void d();const m=z2([l]);let g;T.debug("[".concat(o.store.clientId,"] [p2pId: ").concat(o.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(m.getTrackId(),"]")),"boolean"==typeof f&&f||(g=yield o.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{yield o.replaceTrack(l,m),d()}catch(y){h(y)}finally{var v;null===(v=g)||void 0===v||v()}});return function(l,d,h,f){return a.apply(this,arguments)}}()),N(this,"handleReplaceTrack",function(){var a=L(function*(l,d,h,f){let m;T.debug("[".concat(o.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(l.getTrackId(),"]")),"boolean"==typeof f&&f||(m=yield o.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var g;const y=Array.from(o.localTrackMap.entries()).find(b=>{let[,{track:C}]=b;return l===C});if(!o.connection||!y||o.state!==Dt.Connected)return void d();if(yield null===(g=o.connection)||void 0===g?void 0:g.replaceTrack(l,y[1].id),o.isPlanB){const b=y[1];b.id=l._mediaStreamTrack.id,o.localTrackMap.set(y[0],b)}if(y[0]===ee.LocalVideoTrack&&!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&ct().supportDualStreamEncoding){const b=o.localTrackMap.get(ee.LocalVideoLowTrack);if(b){const C=l._mediaStreamTrack.clone();b.track._originMediaStreamTrack.stop(),b.track._mediaStreamTrack=C,b.track._originMediaStreamTrack=C,yield new le((P,R)=>{o.handleReplaceTrack(b.track,P,R,!0)})}}d()}catch(y){h(y)}finally{var v;null===(v=m)||void 0===v||v()}});return function(l,d,h,f){return a.apply(this,arguments)}}()),N(this,"handleGetRTCStats",a=>{a(this.statsCollector.getRTCStats())}),N(this,"handleGetLocalVideoStats",a=>{a(this.statsCollector.getLocalVideoTrackStats())}),N(this,"handleGetLocalAudioStats",a=>{a(this.statsCollector.getLocalAudioTrackStats())}),N(this,"handleGetRemoteVideoStats",a=>this.statsCollector.getRemoteVideoTrackStats(a.uid)[a.uid]),N(this,"handleGetRemoteAudioStats",a=>this.statsCollector.getRemoteAudioTrackStats(a.uid)[a.uid]),this.store=r,this.statsCollector=i,this.statsCollector.addP2PChannel(this),this.statsUploader=new vH(this.store),this.bindStatsUploaderEvents(),this.mutex=new Qr("P2PChannel-mutex",this.store.clientId),this.isPlanB=!ct().supportUnifiedPlan||B("CHROME_FORCE_PLAN_B")&&pl(),this.shouldForwardP2PCreation=B("FORWARD_P2P_CREATION")&&ct().supportPCSetConfiguration&&mR(),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Av({},this.store):new Va({},this.store),this.bindConnectionEvents(this.connection))}startP2PConnection(r){var i=this;return L(function*(){var o;i.state=Dt.New;const a=i.shouldForwardP2PCreation&&"closed"===(null===(o=i.connection)||void 0===o?void 0:o.peerConnectionState);if(i.shouldForwardP2PCreation&&!a||(a&&i.connection&&(T.warning("[".concat(i.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),i.connection.close(),i.unbindConnectionEvents(i.connection)),i.connection=i.isPlanB?new Av(r,i.store):new Va(r,i.store),i.bindConnectionEvents(i.connection)),!i.connection)throw new Y(k.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return i._pcStatsUploadType=B("NEW_ICE_RESTART")?Tc.FIRST_CONNECTION:Tc.OLD_FIRST_CONNECTION,i._isFirstConnected=!0,i._isInRestartIce=!1,i._isStartRestartIce=!1,i.connection.setConfiguration(r),i.connection.establishPromise})()}connect(r){var i=this;return L(function*(){if(!i.connection)throw new Y(k.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");B("ENABLE_PREALLOC_PC")&&i.state===Dt.Connected?yield i.connection.updateRemoteConnect(r):(i.store.peerConnectionStart(),yield i.connection.connect(r),i.statsUploader.startUploadTransportStats(),i.statsUploader.startUploadExtensionUsageStats(),i.state=Dt.Connected)})()}updateRemoteRTPCapabilities(r){const i=Array.from(this.localTrackMap.entries()).filter(l=>{var d;let[h]=l;return he(d=[ee.LocalVideoLowTrack,ee.LocalVideoTrack]).call(d,h)}),o=i.map(l=>{let[,{id:d}]=l;return d}),a=i.map(l=>{let[d]=l;return d});if(this.connection instanceof Va){if(be.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(a),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(r)}),!he(r).call(r,this.store.codec)){const l=["vp9","vp8","h264"].find(d=>he(r).call(r,d));l&&(this.store.codec=l,T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(l,".")))}this.connection.updateRemoteRTPCapabilities(o,r)}}getEstablishParams(){var r=this;return L(function*(){var i;if(r.connection instanceof Va&&"closed"!==r.connection.peerConnectionState&&he(i=[Dt.New,Dt.Connected]).call(i,r.state))return r.connection.establishPromise})()}publishDataChannel(r){var i=this;return L(function*(){if(!i.connection||i.state!==Dt.Connected){if(i.state===Dt.Disconnected)throw new Y(k.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return r.forEach(a=>{var l;he(l=i.pendingLocalDataChannels).call(l,a)||i.pendingLocalDataChannels.push(a)}),[]}const o=i.filterTobePublishedDataChannels(r);return 0===o.length?[]:(o.forEach(a=>{const l=Date.now();i.store.publish(a.id.toString(),"datachannel",l)}),yield i.connection.createDataChannels(i.store.uid,o),o.forEach(a=>{i.localDataChannels.push(a);const l=Date.now();i.store.publish(a.id+"","datachannel",void 0,l)}),r.map(a=>({streamId:a.id,ordered:a.ordered,maxRetransmits:a.maxRetransmits,metadata:a.metadata,channelId:a._originDataChannelId})))})()}publish(r,i,o){var a=this;return ts(function*(){const l=yield tt(a.mutex.lock("From P2PChannel.publish"));try{if(!a.connection||a.state!==Dt.Connected){if(a.state===Dt.Disconnected)throw new Y(k.UNEXPECTED_ERROR,"PeerConnection already disconnected.");a.throwIfTrackTypeNotMatch(r);const h=r.filter(f=>-1===a.pendingLocalTracks.indexOf(f));return void(a.pendingLocalTracks=a.pendingLocalTracks.concat(h))}a.store.pubId=a.store.pubId+1,ti.markPublishStart(a.store.clientId,a.store.pubId);const d=a.filterTobePublishedTracks(r,i,o);if(0===d.length)return void(yield tt(a.tryToUnmuteAudio(r)));yield*__(PH(a.doPublish(a.connection,d)))}finally{l()}})()}doPublish(r,i){var o=this;return ts(function*(){i.forEach(y=>{let{track:b,type:C}=y;const P=Date.now();o.store.publish(b.getTrackId(),C===ee.LocalAudioTrack?"audio":"video",P)}),o.bindLocalTrackEvents(i);const a=i.map(y=>{let{track:b}=y;return b}),l=yield tt(r.send(a,o.store.codec,o.store.audioCodec)),d=(yield tt(l.next())).value,h=o.createGatewayPublishMessage(i,d);let f;try{f=yield h}catch(y){throw l.throw(y),y?.code===k.WS_ABORT&&i.forEach(b=>{let{track:C}=b;-1===o.pendingLocalTracks.indexOf(C)&&o.pendingLocalTracks.push(C)}),o.unbindLocalTrackEvents(i),y}const m=o.mapPubResToRemoteConfig(h,f,a),g=(yield tt(l.next(m))).value,v=B("ENABLE_VIDEO_SEI");a.forEach(function(){var y=L(function*(b){const C=b.getRTCRtpTransceiver();var P;C&&v&&(b.trackMediaType===_e.VIDEO?yield function rH(r,i){return eD.apply(this,arguments)}(C.sender,b):b.trackMediaType===_e.AUDIO&&(yield(P=L(function*(R){if(!ct().supportWebRTCEncodedTransform)return void T.warning("browser not support audio encoded transform");if(ZS.has(R)||!R.track)return;const A={track:R.track};if(hh()){if(!R.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let M=null;try{M=R.createEncodedStreams()}catch(j){return void T.error("create audio-encoded-streams error",j&&j.message)}const x=new TransformStream({transform(j,W){A.controller||(A.controller=W),R.track&&R.track.id!==A.track.id&&(T.debug("audio track changed: ".concat(A.track.id," => ").concat(R.track.id)),A.track.removeEventListener("ended",O),A.track=R.track,A.track.addEventListener("ended",O)),W.enqueue(j)}});M.readable.pipeThrough(x).pipeTo(M.writable)}else if($e()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const M=kr(),x=new MessageChannel;yield new le(W=>M.onmessage=q=>{"registered"===q.data&&W(void 0)});const j=new RTCRtpScriptTransform(M,{name:"tx",port:x.port2},[x.port2]);R.transform=j,yield new le(W=>M.onmessage=q=>{"started"===q.data&&W(void 0)}),x.port1.onmessage=W=>{var q;W.data.transformed&&R.track&&(null===(q=R.track)||void 0===q?void 0:q.id)!==A.track.id&&(T.debug("audio track changed: ".concat(A.track.id," => ").concat(R.track.id)),A.track.removeEventListener("ended",O),A.track=R.track,A.track.addEventListener("ended",O))},A.worker=M}function O(){if(R.track){if(this.id!==R.track.id)return;R.track.removeEventListener("ended",O)}const M=ZS.get(R);if(M){ZS.delete(R);try{var x,j;null===(x=M.controller)||void 0===x||x.terminate(),null===(j=M.worker)||void 0===j||j.terminate()}catch(W){T.warning(W&&W.message)}}}ZS.set(R,A),R.track.addEventListener("ended",O)}),function(R){return P.apply(this,arguments)})(C.sender)))});return function(b){return y.apply(this,arguments)}}()),i.forEach(y=>{let{type:b}=y;o.statsCollector.addLocalStats(b)}),o.assignLocalTracks(i,g),o.statsUploader.startUploadOutboundStats(),i.forEach(y=>{let{track:b,type:C}=y;const P=Date.now();o.store.publish(b.getTrackId(),C===ee.LocalAudioTrack?"audio":"video",void 0,P)})})()}updateVideoStreamParameter(r,i){var o=this;return L(function*(){const a=o.localTrackMap.get(i);if(!a)return;if(!(a.track instanceof Ve))return T.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(o.connection instanceof Va||o.connection instanceof Av))return T.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:l}=a,d=function(h,f){const m={};return h.height&&h.width&&(m.scaleResolutionDownBy=XR(h,f)),m.maxFramerate=h.framerate?Pi(h.framerate):void 0,m.maxBitrate=h.bitrate?1e3*h.bitrate:void 0,m}(r,l);if(l._encoderConfig||(l._encoderConfig={}),i!==ee.LocalVideoLowTrack||!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&ct().supportDualStreamEncoding)null!=d.scaleResolutionDownBy&&(l._encoderConfig.scaleResolutionDownBy=d.scaleResolutionDownBy);else{const h=l._originMediaStreamTrack;if(!h.canvas)return T.warn("[".concat(l.getTrackId(),"] no canvas on track"));!function(f,m){const g=f.canvas;m.width&&(g.width=Pi(m.width)),m.height&&(g.height=Pi(m.height)),m.framerate&&(g.stopCapture&&g.stopCapture(),g.stopCapture=Sx(()=>{!g.startCapture&&g.stopCapture&&g.stopCapture(),g.startCapture&&g.startCapture()},Pi(m.framerate)))}(h,r)}null!=d.maxBitrate&&(l._encoderConfig.bitrateMax=d.maxBitrate/1e3),null!=d.maxFramerate&&(l._encoderConfig.frameRate&&"object"==typeof l._encoderConfig.frameRate?l._encoderConfig.frameRate.max=d.maxFramerate:l._encoderConfig.frameRate={max:d.maxFramerate}),T.debug("[".concat(l.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(l._encoderConfig))),yield o.connection.updateRtpSenderEncodings(l)})()}publishLowStream(r){var i=this;return ts(function*(){if(!i.connection||i.state!==Dt.Connected)return;const o=yield tt(i.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const l=i.localTrackMap.get(ee.LocalVideoTrack);if(!l)throw new Y(k.UNEXPECTED_ERROR,"Could not find high stream");if(i.localTrackMap.has(ee.LocalVideoLowTrack))throw new Y(k.UNEXPECTED_ERROR,"[".concat(i.store.clientId,"] Can't publish low stream when stream already publish"));const d=[{track:i.getLowVideoTrack(l.track,r),type:ee.LocalVideoLowTrack}];if(yield*__(PH(i.doPublish(i.connection,d))),l.track.muted||!l.track.enabled){var a;const h=null===(a=i.localTrackMap.get(ee.LocalVideoLowTrack))||void 0===a?void 0:a.id;void 0!==h&&(yield tt(i.connection.muteLocal([h])))}}finally{o()}})()}republish(){var r=this;return L(function*(){r.pendingLocalTracks.length>0&&(T.debug("[".concat(r.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield Gr(r,De.RequestRePublish,r.pendingLocalTracks),r.emit(De.MediaReconnectEnd,r.store.uid),r.pendingLocalTracks=[]),r.pendingLocalDataChannels.length>0&&(T.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),yield Gr(r,De.RequestRePublishDataChannel,r.pendingLocalDataChannels),r.pendingLocalDataChannels=[])})()}reSubscribe(r){var i=this;return L(function*(){for(let o=i.pendingRemoteTracks.length-1;o>=0;o--){const{user:a,kind:l}=i.pendingRemoteTracks[o];(l!==_e.AUDIO||a._audio_added_&&a._audioSSRC)&&(l!==_e.VIDEO||a._video_added_&&a._videoSSRC)||i.pendingRemoteTracks.splice(o,1)}if(r)yield Gr(i,De.RequestReSubscribe,i.pendingRemoteTracks);else for(const{user:o,kind:a}of i.pendingRemoteTracks)yield i.subscribe(o,a,a===_e.VIDEO?o._videoSSRC:o._audioSSRC);i.pendingRemoteTracks.forEach(o=>{let{user:a}=o;i.emit(De.MediaReconnectEnd,a.uid)}),i.pendingRemoteTracks=[]})()}unpublish(r){var i=this;return L(function*(){if(!i.connection||i.state!==Dt.Connected)return void r.forEach(l=>{const d=i.pendingLocalTracks.indexOf(l);-1!==d&&i.pendingLocalTracks.splice(d,1)});const o=i.filterTobeUnpublishedTracks(r);if(0===o.length)return;const a=o.find(l=>"videoLowTrack"===l[0]);return a&&a[1].track.close(),i.doUnpublish(i.connection,o)})()}unpublishDataChannel(r){var i=this;return L(function*(){if(!i.connection||i.state!==Dt.Connected)return void r.forEach(a=>{const l=i.pendingLocalDataChannels.indexOf(a);-1!==l&&i.pendingLocalDataChannels.splice(l,1)});const o=i.filterTobeUnpublishedDataChannels(r);return 0!==o.length?(o.forEach(a=>{const l=i.localDataChannels.indexOf(a);-1!==l&&i.localDataChannels.splice(l,1)}),0===i.localDataChannels.length&&(yield i.connection.stopDataChannels(i.store.uid)),o.map(a=>a.id)):void 0})()}unpublishLowStream(){var r=this;return L(function*(){if(!r.connection||r.state!==Dt.Connected)return;const i=r.localTrackMap.get(ee.LocalVideoLowTrack);return i?(i.track.close(),r.doUnpublish(r.connection,[[ee.LocalVideoLowTrack,i]])):void 0})()}doUnpublish(r,i){var o=this;return L(function*(){const a=o.createGatewayUnpublishMessage(i);return yield r.stopSending(i.map(l=>{let[,{id:d}]=l;return d})),o.withdrawLocalTracks(i),o.unbindLocalTrackEvents(i.map(l=>{let[d,{track:h}]=l;return{type:d,track:h}})),i.forEach(l=>{let[d]=l;o.statsCollector.removeLocalStats(d)}),0===o.localTrackMap.size&&o.statsUploader.stopUploadOutboundStats(),a})()}subscribeDataChannel(r,i){var o=this;return L(function*(){if(!o.connection||o.state!==Dt.Connected)throw new Y(k.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const a=i.filter(l=>{var d;return!(null!==(d=o.remoteDataChannelMap.get(r))&&void 0!==d&&d.get(l.id))});if(0!==a.length)return yield o.connection.createDataChannels(r.uid,a),a.forEach(l=>{var d;o.remoteDataChannelMap.has(r)?null===(d=o.remoteDataChannelMap.get(r))||void 0===d||d.set(l.id,l):o.remoteDataChannelMap.set(r,new Map([[l.id,l]]));const h=o.pendingRemoteDataChannels.findIndex(f=>{let{user:m,id:g}=f;return m.uid===r.uid&&g===l.id});-1!==h&&o.pendingRemoteDataChannels.splice(h,1)}),a.map(l=>l.id)})()}subscribe(r,i,o,a,l){var d=this;return L(function*(){var h;if(!d.connection||d.state!==Dt.Connected)throw new Y(k.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(h=d.remoteUserMap.get(r))&&void 0!==h&&h.has(i))return;let f,m,g;const v=d.connection.getPreMedia(o);if(v)T.debug("[".concat(d.store.clientId,"] [").concat(d.store.p2pId,"] preSSRCMap has ssrcId: ").concat(o,", no need to send sub to gateway.")),g=v.transceiver,f=v.track,m=v.id;else if(l){const C=l.find(R=>{let{stream_type:A}=R;return A===i});if(!C)throw new Y(k.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(i," for user: ").concat(r.uid," because subscribe answer from gateway does not contain stream_type: ").concat(i,"."));const P=yield d.connection.receive(i,C.ssrcs,String(r._uintid),C.attributes);d.connection instanceof Va&&(g=P.transceiver),f=P.track,m=P.id}else{const C=yield d.connection.receive(i,[{ssrcId:o,rtx:a}],String(r._uintid),void 0);d.connection instanceof Va&&(g=C.transceiver),f=C.track,m=C.id}var C;i===_e.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(f):(r._audioTrack=new Ol(f,r.uid,r._uintid,d.store),T.info("[".concat(d.store.clientId,"] [").concat(d.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),g&&r._audioTrack._updateRtpTransceiver(g),d.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(f):(r._videoTrack=new Dh(f,r.uid,r._uintid,d.store),T.info("[".concat(d.store.clientId,"] [").concat(d.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),g&&r._videoTrack._updateRtpTransceiver(g),d.bindRemoteTrackEvents(r,r._videoTrack)),B("ENABLE_VIDEO_SEI")&&g&&(i==_e.VIDEO?yield(C=L(function*(P){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!ct().supportWebRTCEncodedTransform)return void T.warning("browser not support video encoded transform");if(!P.track)return;if(eC.has(P)){const M=eC.get(P);return void(M&&(M.onSei=R.onSei))}const A={track:P.track,onSei:R.onSei};if(hh()){if(!P.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let M=null;try{M=P.createEncodedStreams()}catch(j){return void T.error("create video-encoded-streams error",j&&j.message)}const x=new TransformStream({transform(j,W){A.controller||(A.controller=W),P.track&&P.track.id!==A.track.id&&(T.debug("video track changed: ".concat(A.track.id," => ").concat(P.track.id)),A.track.removeEventListener("ended",O),A.track=P.track,A.track.addEventListener("ended",O));const q=function(te){const J=new DataView(te.data);let X=0;for(;X+4<te.data.byteLength;){if(0===J.getUint8(X+0)&&0===J.getUint8(X+1)&&0===J.getUint8(X+2)&&1===J.getUint8(X+3)&&6===J.getUint8(X+4)){let Ce=X+6,Re=0,ut=0;for(;255===(ut=J.getUint8(Ce++));)Re+=255;Re+=ut;const Nt=nH(te.data,Ce,Re);return new Uint8Array(Nt)}X++}return null}(j);q&&A.onSei&&A.onSei(q),W.enqueue(j)}});M.readable.pipeThrough(x).pipeTo(M.writable)}else if($e()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const M=kr(),x=new MessageChannel;yield new le(W=>M.onmessage=q=>{"registered"===q.data&&W(void 0)});const j=new RTCRtpScriptTransform(M,{name:"rx",port:x.port2},[x.port2]);P.transform=j,yield new le(W=>M.onmessage=q=>{"started"===q.data&&W(void 0)}),x.port1.onmessage=W=>{var q;W.data.transformed&&P.track&&(null===(q=P.track)||void 0===q?void 0:q.id)!==A.track.id?(T.debug("video track changed: ".concat(A.track.id," => ").concat(P.track.id)),A.track.removeEventListener("ended",O),A.track=P.track,A.track.addEventListener("ended",O)):W.data.sei&&A.onSei&&A.onSei(W.data.sei)},A.worker=M}function O(){if(P.track){if(this.id!==P.track.id)return;P.track.removeEventListener("ended",O)}!function(M){const x=eC.get(M);if(x){eC.delete(M);try{var j,W;null===(j=x.controller)||void 0===j||j.terminate(),null===(W=x.worker)||void 0===W||W.terminate()}catch(q){T.warning(q&&q.message)}}}(P)}eC.set(P,A),P.track.addEventListener("ended",O)}),function(P){return C.apply(this,arguments)})(g.receiver,{onSei:C=>{var P;null===(P=r._videoTrack)||void 0===P||P._onSei(C)}}):i==_e.AUDIO&&(yield function(){var C=L(function*(P){if(!ct().supportWebRTCEncodedTransform)return void T.warning("browser not support audio encoded transform");if(JS.has(P))return;const R={track:P.track};if(hh()){if(!P.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let O=null;try{O=P.createEncodedStreams()}catch(x){return void T.error("create audio-encoded-streams error",x&&x.message)}const M=new TransformStream({transform(x,j){R.controller||(R.controller=j),P.track&&P.track.id!==R.track.id&&(T.debug("audio track changed: ".concat(R.track.id," => ").concat(P.track.id)),R.track.removeEventListener("ended",A),R.track=P.track,R.track.addEventListener("ended",A)),j.enqueue(x)}});O.readable.pipeThrough(M).pipeTo(O.writable)}else if($e()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const O=kr(),M=new MessageChannel;yield new le(j=>O.onmessage=W=>{"registered"===W.data&&j(void 0)});const x=new RTCRtpScriptTransform(O,{name:"rx",port:M.port2},[M.port2]);P.transform=x,yield new le(j=>O.onmessage=W=>{"started"===W.data&&j(void 0)}),M.port1.onmessage=j=>{var W;j.data.transformed&&P.track&&(null===(W=P.track)||void 0===W?void 0:W.id)!==R.track.id&&(T.debug("audio track changed: ".concat(R.track.id," => ").concat(P.track.id)),R.track.removeEventListener("ended",A),R.track=P.track,R.track.addEventListener("ended",A))},R.worker=O}function A(){P.track.removeEventListener("ended",A),function(O){const M=JS.get(O);if(M){JS.delete(O);try{var x,j;null===(x=M.controller)||void 0===x||x.terminate(),null===(j=M.worker)||void 0===j||j.terminate()}catch(W){T.warning(W&&W.message)}}}(P)}JS.set(P,R),P.track.addEventListener("ended",A)});return function(P){return C.apply(this,arguments)}}()(g.receiver)));const y=d.remoteUserMap.get(r);y?y.set(i,m):d.remoteUserMap.set(r,new Map([[i,m]])),d.statsCollector.addRemoteStats(r.uid),d.statsUploader.startUploadInboundStats();const b=d.pendingRemoteTracks.findIndex(C=>{let{user:P,kind:R}=C;return P.uid===r.uid&&i===R});-1!==b&&(d.pendingRemoteTracks.splice(b,1),d.emit(De.MediaReconnectEnd,r.uid))})()}massSubscribe(r){var i=this;return L(function*(){return i.massSubscribeNoLock(r)})()}massSubscribeNoLock(r){var i=this;return L(function*(){if(!i.connection||i.state!==Dt.Connected)throw new Y(k.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");r=r.filter(d=>{var h;let{user:f,mediaType:m}=d;return!(null!==(h=i.remoteUserMap.get(f))&&void 0!==h&&h.has(m))});const o=[],a=new Map;r.forEach(d=>{if(!i.connection)return;const h=i.connection.getPreMedia(d.ssrcId);h?a.set(d.ssrcId,h):o.push(d)});const l=yield i.connection.batchReceive(o.map(d=>{let{user:h,mediaType:f,ssrcId:m,rtxSsrcId:g}=d;return{kind:f,ssrcMsg:[{ssrcId:m,rtx:g}],mslabel:String(h._uintid)}}));o.forEach((d,h)=>{a.set(d.ssrcId,l[h])}),r.forEach(d=>{let{user:h,mediaType:f,ssrcId:m}=d;const g=a.get(m);if(!g)return void T.debug("[".concat(i.store.clientId,"] [").concat(i.store.p2pId,"] cannot find ").concat(h.uid," subscribe data,").concat(f,", ").concat(m));const{track:v,id:y,transceiver:b}=g;f===_e.AUDIO?(h._audioTrack?h._audioTrack._updateOriginMediaStreamTrack(v):(h._audioTrack=new Ol(v,h.uid,h._uintid,i.store),T.info("[".concat(i.store.clientId,"] [").concat(i.store.p2pId,"] create remote audio track: ").concat(h._audioTrack.getTrackId()))),b&&h._audioTrack._updateRtpTransceiver(b),i.bindRemoteTrackEvents(h,h._audioTrack)):(h._videoTrack?h._videoTrack._updateOriginMediaStreamTrack(v):(h._videoTrack=new Dh(v,h.uid,h._uintid,i.store),T.info("[".concat(i.store.clientId,"] [").concat(i.store.p2pId,"] create remote video track: ").concat(h._videoTrack.getTrackId()))),b&&h._videoTrack._updateRtpTransceiver(b),i.bindRemoteTrackEvents(h,h._videoTrack));const C=i.remoteUserMap.get(h);C?C.set(f,y):i.remoteUserMap.set(h,new Map([[f,y]])),i.statsCollector.addRemoteStats(h.uid),i.statsUploader.startUploadInboundStats();const P=i.pendingRemoteTracks.findIndex(R=>{let{user:A,kind:O}=R;return A.uid===h.uid&&f===O});-1!==P&&(i.pendingRemoteTracks.splice(P,1),i.emit(De.MediaReconnectEnd,h.uid))})})()}unsubscribe(r,i,o){var a=this;return L(function*(){const l=a.pendingRemoteTracks.filter(f=>{let{user:m,kind:g}=f;return void 0!==i?m.uid===r.uid&&i===g:m.uid===r.uid});if(l.forEach(f=>{const m=a.pendingRemoteTracks.indexOf(f);a.pendingRemoteTracks.splice(m,1)}),a.connection&&a.state===Dt.Connected||o||l.forEach(f=>{let{kind:m}=f;var g;if(m===_e.AUDIO)null===(g=r._audioTrack)||void 0===g||g._destroy(),r._audioTrack=void 0;else if(m===_e.VIDEO){var v;null===(v=r._videoTrack)||void 0===v||v._destroy(),r._videoTrack=void 0}}),!a.connection||a.state!==Dt.Connected)return;const d=a.filterTobeUnSubscribedTracks(r,i);if(0===d.length)return;yield a.connection.stopReceiving(d.map(f=>{let[,{id:m}]=f;return m}));const h=a.createUnsubscribeMessage(d);return a.withdrawRemoteTracks(d),0===a.remoteUserMap.size&&a.statsUploader.stopUploadInboundStats(),d.forEach(f=>{let[m,{kind:g}]=f;var v,y;if(g===_e.VIDEO&&m._videoSSRC&&(null===(v=a.connection)||void 0===v||v.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),g===_e.VIDEO)a.unbindRemoteTrackEvents(m._videoTrack),o||(null===(y=m._videoTrack)||void 0===y||y._destroy(),m._videoTrack=void 0);else if(g===_e.AUDIO){var b;a.unbindRemoteTrackEvents(m._audioTrack),!o&&(null===(b=m._audioTrack)||void 0===b||b._destroy(),m._audioTrack=void 0)}}),h})()}unsubscribeDataChannel(r,i){var o=this;return L(function*(){if(i.forEach(d=>{const h=o.pendingRemoteDataChannels.findIndex(f=>f.id===d.id);-1!==h&&o.pendingRemoteDataChannels.splice(h,1)}),!o.connection)return;const a=o.filterTobeUnSubscribedDataChannels(r,i);if(0===a.length)return;i.forEach(d=>{d._close()});const l=o.remoteDataChannelMap.get(r);return a.forEach(d=>{l&&l.delete(d.id)}),l&&0===l.size&&(o.remoteDataChannelMap.delete(r),yield o.connection.stopDataChannels(r.uid)),a.map(d=>d.id)})()}massUnsubscribe(r){var i=this;return L(function*(){return i.massUnsubscribeNoLock(r)})()}massUnsubscribeNoLock(r){var i=this;return L(function*(){let o=[];for(const{user:d,mediaType:h}of r){const f=i.pendingRemoteTracks.filter(m=>{let{user:g,kind:v}=m;return void 0!==h?g.uid===d.uid&&h===v:g.uid===d.uid});f.forEach(m=>{const g=i.pendingRemoteTracks.indexOf(m);i.pendingRemoteTracks.splice(g,1)}),o=o.concat(f)}if(!i.connection||i.state!==Dt.Connected)return void o.forEach(d=>{let{user:h,kind:f}=d;var m;if(f===_e.AUDIO)null===(m=h._audioTrack)||void 0===m||m._destroy(),h._audioTrack=void 0;else if(f===_e.VIDEO){var g;null===(g=h._videoTrack)||void 0===g||g._destroy(),h._videoTrack=void 0}});const a=Ue(r).call(r,(d,h)=>{let{user:f,mediaType:m}=h;const g=i.filterTobeUnSubscribedTracks(f,m);return d.concat(g)},[]);if(0===a.length)return;yield i.connection.stopReceiving(a.map(d=>{let[,{id:h}]=d;return h}));const l=i.createUnsubscribeAllMessage(a);return i.withdrawRemoteTracks(a),0===i.remoteUserMap.size&&i.statsUploader.stopUploadInboundStats(),a.forEach(d=>{let[h,{kind:f}]=d;var m,g;if(f===_e.VIDEO&&h._videoSSRC&&(null===(m=i.connection)||void 0===m||m.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),f===_e.VIDEO)i.unbindRemoteTrackEvents(h._videoTrack),null===(g=h._videoTrack)||void 0===g||g._destroy(),h._videoTrack=void 0;else if(f===_e.AUDIO){var v;i.unbindRemoteTrackEvents(h._audioTrack),null===(v=h._audioTrack)||void 0===v||v._destroy(),h._audioTrack=void 0}}),l})()}isPreSubScribe(r){return!(!this.connection||this.state!==Dt.Connected||!this.connection.getPreMedia(r))}muteRemote(r,i){var o=this;return L(function*(){if(!o.connection)return;const a=o.remoteUserMap.get(r);if(!a)return void T.warning("[".concat(o.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(r.uid,"."));if(!a.get(i))return void T.warning("[".concat(o.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(r.uid," media type ").concat(i,"."));const l=i===_e.VIDEO?r._videoSSRC:r._audioSSRC;void 0!==l&&o.connection.setStatsRemoteVideoIsReady(l,!1)})()}unmuteRemote(r,i){var o=this;return L(function*(){return o.unmuteRemoteNoLock(r,i)})()}unmuteRemoteNoLock(r,i){var o=this;return L(function*(){if(!o.connection)return;const a=o.remoteUserMap.get(r);a?a.get(i)||T.warning("[".concat(o.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(r.uid," media type ").concat(i,".")):T.warning("[".concat(o.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(r.uid,"."))})()}getAllTracks(r){const i=this.localTrackMap.get(ee.LocalAudioTrack);if(i?.track instanceof sr){const o=i.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[l]=a;return l!==ee.LocalAudioTrack}).filter(a=>{let[l]=a;return!(r&&l===ee.LocalVideoLowTrack)}).map(a=>{let[,{track:l}]=a;return l}).concat(o.trackList)}return Array.from(this.localTrackMap.entries()).filter(o=>{let[a]=o;return!(r&&a===ee.LocalVideoLowTrack)}).map(o=>{let[,{track:a}]=o;return a})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(r,i,o,a,l){if(r){const h=this.localTrackMap.get(ee.LocalAudioTrack),f=this.localTrackMap.get(a?ee.LocalVideoLowTrack:ee.LocalVideoTrack);be.publish(this.store.sessionId,{eventElapse:ti.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:r,ec:i,audioName:h?.track.getTrackLabel(),videoName:f?.track.getTrackLabel(),screenshare:-1!==f?.track._hints.indexOf(zt.SCREEN_TRACK),audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:l})}else{var d;o||(o=[]);const h=o.find(m=>m instanceof Cn),f=a?null===(d=this.localTrackMap.get(ee.LocalVideoTrack))||void 0===d?void 0:d.track:o.find(m=>m instanceof Ve);be.publish(this.store.sessionId,{eventElapse:ti.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:r,ec:i,audioName:h?.getTrackLabel(),videoName:f?.getTrackLabel(),screenshare:-1!==f?._hints.indexOf(zt.SCREEN_TRACK),audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:l})}}reportSubscribeEvent(r,i,o,a){const l=a===_e.VIDEO?o._videoSSRC:o._audioSSRC;l&&be.subscribe(this.store.sessionId,{succ:r,ec:i,video:a===_e.VIDEO,audio:a===_e.AUDIO,peerid:o.uid,subscribeRequestid:l,p2pid:this.store.p2pId,eventElapse:ti.measureFromSubscribeStart(this.store.clientId,l),preSsrc:this.isPreSubScribe(l)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Qr("P2PChannel-mutex",this.store.clientId),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Av({},this.store):new Va({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const r=this.localTrackMap.get(ee.LocalAudioTrack);if(r?.track instanceof sr){if(r.track.trackList.length>0){const i=r.track;r.track.trackList.forEach(o=>{i.removeAudioTrack(o)})}r.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Dt.Disconnected}getStats(){var r;return null===(r=this.connection)||void 0===r?void 0:r.getStats()}getRemoteVideoIsReady(r){var i;return(null===(i=this.connection)||void 0===i?void 0:i.getRemoteVideoIsReady(r))||!1}getLocalAudioVolume(){const r=this.localTrackMap.get(ee.LocalAudioTrack);if(r)return r.track.getVolumeLevel()}getLocalVideoSize(){const r=this.localTrackMap.get(ee.LocalVideoTrack);if(r)return{width:r.track.videoWidth||0,height:r.track.videoHeight||0}}getEncoderConfig(r){const i=this.localTrackMap.get(r);return i&&i.track instanceof Ve||i&&i.track instanceof Cn?i.track._encoderConfig:void 0}getLocalMedia(r){return this.localTrackMap.get(r)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(r,i){if(!r)return this.remoteUserMap.size>0;const o=this.remoteUserMap.get(r);return!!o&&(!i||o.has(i))}hasRemoteMediaWithLock(r,i){var o=this;return L(function*(){if(!r)return o.remoteUserMap.size>0;const a=o.remoteUserMap.get(r);return!!a&&(!i||a.has(i))})()}getRemoteMedia(r){var i;const o=Array.from(wo(i=this.remoteUserMap).call(i)).find(a=>a.uid===r);return o?{audioTrack:o.audioTrack,audioSSRC:o._audioSSRC,videoTrack:o.videoTrack,videoSSRC:o._videoSSRC}:{}}getAudioLevels(){let r=Array.from(this.remoteUserMap.entries()).map(o=>{let[a]=o;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}});const i=this.localTrackMap.get(ee.LocalAudioTrack);return i&&r.push({level:100*i.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),r=md(r).call(r,(o,a)=>o.level-a.level),r}disconnectForReconnect(){var r=this;return L(function*(){r.connection&&(T.debug("[".concat(r.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),r.state=Dt.Reconnecting,B("KEEP_LAST_FRAME")&&0!==r.remoteUserMap.size&&Array.from(r.remoteUserMap.entries()).forEach(i=>{let[o]=i;var a;o._videoTrack&&o._videoTrack._player&&(null===(a=o._videoTrack._player.getVideoElement())||void 0===a||a.pause(),o._videoTrack._player.isKeepLastFrame=!0,o._videoTrack._originMediaStreamTrack.stop())}),r.connection.close(),r.unbindConnectionEvents(r.connection),r.connection=void 0,r.shouldForwardP2PCreation&&(r.connection=r.isPlanB?new Av({},r.store):new Va({},r.store),r.bindConnectionEvents(r.connection)),0!==r.localTrackMap.size&&(Array.from(r.localTrackMap.entries()).forEach(i=>{var o;let[a,{track:l}]=i;switch(a){case ee.LocalVideoTrack:he(o=l._hints).call(o,zt.LOW_STREAM)?l.close():r.pendingLocalTracks.push(l);break;case ee.LocalAudioTrack:l instanceof sr?r.pendingLocalTracks=r.pendingLocalTracks.concat(l.trackList):r.pendingLocalTracks.push(l)}}),r.emit(De.MediaReconnectStart,r.store.uid)),r.unbindLocalTrackEvents(),r.localTrackMap.clear(),0!==r.remoteUserMap.size&&Array.from(r.remoteUserMap.entries()).forEach(i=>{let[o,a]=i;Array.from(wo(a).call(a)).forEach(l=>{r.setPendingRemoteMedia(o,l)}),r.emit(De.MediaReconnectStart,o.uid)}),r.unbindAllRemoteTrackEvents(),r.remoteUserMap.clear(),0!==r.localDataChannels.length&&(r.localDataChannels.forEach(i=>{r.pendingLocalDataChannels.push(i)}),r.localDataChannels.length=0),0!==r.remoteDataChannelMap.size&&(Array.from(r.remoteDataChannelMap.entries()).forEach(i=>{let[o,a]=i;Array.from(wo(a).call(a)).forEach(l=>{r.setPendingRemoteDataChannel(o,l)})}),r.remoteDataChannelMap.clear()),r.statsUploader.stopUploadOutboundStats(),r.statsUploader.stopUploadInboundStats(),r.statsUploader.stopUploadTransportStats(),T.debug("[".concat(r.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))})()}hasPendingRemoteDataChannel(r,i){for(const o of this.pendingRemoteDataChannels){const{user:a,id:l}=o;if((r instanceof xh?r.uid:r)===a.uid&&l===i)return!0}return!1}setPendingRemoteDataChannel(r,i){this.hasPendingRemoteDataChannel(r,i)||this.pendingRemoteDataChannels.push({user:r,id:i})}hasPendingRemoteMedia(r,i){for(const o of this.pendingRemoteTracks){const{user:a,kind:l}=o;if((r instanceof xh?r.uid:r)===a.uid&&i===l)return!0}return!1}setPendingRemoteMedia(r,i){this.hasPendingRemoteMedia(r,i)||this.pendingRemoteTracks.push({user:r,kind:i})}restartICE(r){var i=this;return ts(function*(){if(!i.connection||i.state!==Dt.Connected)return;const o=yield tt(i.mutex.lock("From P2PChannel.restartICE"));let a;try{a=yield tt(i.connection.restartICE(r));const d=yield tt(a.next());if(d.done)return;const h=d.value,f=yield h;switch(i.reportPCDisconnectedOrFailed(r),r){case uo.TCP:i._pcStatsUploadType=Tc.TCP_RESTART;break;case uo.RELAY:i._pcStatsUploadType=Tc.RELAY_RESTART;break;default:i._pcStatsUploadType=Tc.OLD_RESTART}i._isInRestartIce=!0,a.next(f)}catch(d){var l;null===(l=a)||void 0===l||l.throw(d)}finally{o()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const r=this.connection.getStats(),i=this.localTrackMap.get(ee.LocalVideoTrack),o=this.localTrackMap.get(ee.LocalAudioTrack),a=r.videoSend.find(C=>C.ssrc===i?.ssrcs[0].ssrcId),l=r.audioSend.find(C=>C.ssrc===o?.ssrcs[0].ssrcId);if(!a||!l)return 1;const d=Ao(this,De.NeedSignalRTT),h=a?a.rttMs:void 0,f=l?l.rttMs:void 0,m=h&&f?(h+f)/2:h||f,v=100*r.sendPacketLossRate*.7/50+.3*((m&&d?(m+d)/2:m||d)||0)/1500,y=v<.17?1:v<.36?2:v<.59?3:v<.1?4:5,b=i?.track;if(b&&b._encoderConfig&&-1===b._hints.indexOf(zt.SCREEN_TRACK)){const C=b._encoderConfig.bitrateMax,P=r.bitrate.actualEncoded;if(C&&P){const R=(1e3*C-P)/(1e3*C);return fL[R<.15?0:R<.3?1:R<.45?2:R<.6?3:4][y]}}return y}getDownlinkNetworkQuality(){if(!this.connection)return 0;const r=this.connection.getStats();let i=0;return Array.from(this.remoteUserMap.entries()).forEach(o=>{let[a]=o;const l=a._audioSSRC,d=a._videoSSRC,h=r.audioRecv.find(P=>P.ssrc===l),f=r.videoRecv.find(P=>P.ssrc===d);if(!h&&!f)return void(i+=1);const m=Ao(this,De.NeedSignalRTT),g=r.rtt,v=(g&&m?(g+m)/2:g||m)||0,y=h?h.jitterMs:void 0,b=r.recvPacketLossRate;let C=.7*b*100/50+.3*v/1500;y&&(C=.6*b*100/50+.2*v/1500+.2*y/400),i+=C<.1?1:C<.17?2:C<.36?3:C<.59?4:5}),this.remoteUserMap.size>0?Math.round(i/this.remoteUserMap.size):i}muteLocalTrack(r){var i=this;return L(function*(){return new le((o,a)=>{i.handleMuteLocalTrack(r,o,a)})})()}replaceTrack(r,i){var o=this;return L(function*(){var a;if(T.debug("[".concat(o.store.clientId,"] P2PChannel replaceTrack from [").concat(r.getTrackId(),"] to [").concat(i.getTrackId(),"]")),!o.connection||o.state!==Dt.Connected)return;const l=Array.from(o.localTrackMap.entries()).find(h=>{let[,{track:f}]=h;return r===f});if(!l)return;const d=l[0];if(r!==i&&(o.unbindLocalTrackEvents([{track:r,type:d}]),o.bindLocalTrackEvents([{track:i,type:d}]),l[1].track=i),yield null===(a=o.connection)||void 0===a?void 0:a.replaceTrack(i,l[1].id),o.isPlanB){const h=l[1];h.id=i._mediaStreamTrack.id,o.localTrackMap.set(d,h)}if(d===ee.LocalVideoTrack&&!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&ct().supportDualStreamEncoding){const h=o.localTrackMap.get(ee.LocalVideoLowTrack);if(h){const f=r._mediaStreamTrack.clone();h.track._originMediaStreamTrack.stop(),h.track._mediaStreamTrack=f,h.track._originMediaStreamTrack=f,yield new le((m,g)=>{o.handleReplaceTrack(h.track,m,g,!0)})}}})()}filterTobePublishedTracks(r,i,o){const a=[],l=this.getAllTracks();r=At(r=r.filter(m=>-1===l.indexOf(m)));let d,h=!1;const f=this.localTrackMap.get(ee.LocalAudioTrack);for(const m of r){if(m instanceof Ve&&(this.localTrackMap.has(ee.LocalVideoTrack)||h?new Y(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:m,type:ee.LocalVideoTrack}),h=!0),i)){const g=this.getLowVideoTrack(m,o);a.push({track:g,type:ee.LocalVideoLowTrack})}if(m instanceof Cn)if(f){const g=f.track;if(g instanceof sr)ND([m]),g.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0);else{const v=z2([g,m]);T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(v.getTrackId(),"]")),this.replaceTrack(g,v)}}else d instanceof sr?(ND([m]),d.addAudioTrack(m)):d=d||!m._useAudioElement&&ct().webAudioMediaStreamDest&&!m._bypassWebAudio?z2(d?[m,d]:[m]):m}return d&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(d.getTrackId(),"]")),a.push({track:d,type:ee.LocalAudioTrack})),a}filterTobeUnpublishedTracks(r){const i=[],o=this.getAllTracks();r=At(r=r.filter(a=>-1!==o.indexOf(a)));for(const a of r){if(a instanceof Cn){const l=this.localTrackMap.get(ee.LocalAudioTrack);if(!l)continue;l.track instanceof sr?(l.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),0===l.track.trackList.length&&(i.push([ee.LocalAudioTrack,l]),l.track.close())):i.push([ee.LocalAudioTrack,l])}if(a instanceof Ve){const l=this.localTrackMap.get(ee.LocalVideoTrack);if(!l)continue;i.push([ee.LocalVideoTrack,l]);const d=this.localTrackMap.get(ee.LocalVideoLowTrack);d&&i.push([ee.LocalVideoLowTrack,d])}}return i}filterTobePublishedDataChannels(r){return(r=At(r)).filter(i=>-1===this.localDataChannels.findIndex(o=>o.id===i.id))}filterTobeUnpublishedDataChannels(r){return(r=(r=At(r)).filter(i=>-1!==this.localDataChannels.indexOf(i))).filter(i=>i._originDataChannel)}bindLocalTrackEvents(r){r.forEach(i=>{let{track:o,type:a}=i;switch(a){case ee.LocalVideoTrack:o.addListener(ge.GET_STATS,this.handleGetLocalVideoStats),o.addListener(ge.GET_RTC_STATS,this.handleGetRTCStats),o.addListener(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.addListener(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.addListener(ge.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),o.addListener(ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),o.addListener(ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),o.addListener(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.addListener(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ee.LocalAudioTrack:this.bindLocalAudioTrackEvents(o)}})}bindLocalAudioTrackEvents(r,i){r instanceof sr?r.trackList.forEach(o=>{o.addListener(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.addListener(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.addListener(ge.GET_STATS,this.handleGetLocalAudioStats),o.addListener(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.addListener(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(r.addListener(ge.GET_STATS,this.handleGetLocalAudioStats),r.addListener(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),i||(r.addListener(ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(ge.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(r){r||(r=Array.from(this.localTrackMap.entries()).map(i=>{let[o,{track:a}]=i;return{track:a,type:o}})),r.forEach(i=>{let{track:o,type:a}=i;switch(a){case ee.LocalVideoTrack:o.off(ge.GET_STATS,this.handleGetLocalVideoStats),o.off(ge.GET_RTC_STATS,this.handleGetRTCStats),o.off(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.off(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.off(ge.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),o.off(ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),o.off(ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),o.off(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.off(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ee.LocalAudioTrack:this.unbindLocalAudioTrackEvents(o)}})}unbindLocalAudioTrackEvents(r){r instanceof sr?r.trackList.forEach(i=>{i.off(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(ge.GET_STATS,this.handleGetLocalAudioStats),i.off(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(r.off(ge.GET_STATS,this.handleGetLocalAudioStats),r.off(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(ge.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),r.off(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(r,i){i instanceof Dh&&i.addListener(ge.GET_STATS,o=>{o(this.handleGetRemoteVideoStats(r))}),i instanceof Ol&&i.addListener(ge.GET_STATS,o=>{o(this.handleGetRemoteAudioStats(r))})}unbindRemoteTrackEvents(r){r&&r.removeAllListeners(ge.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(r=>{let[i,o]=r;o.has(_e.AUDIO)&&this.unbindRemoteTrackEvents(i._audioTrack),o.has(_e.VIDEO)&&this.unbindRemoteTrackEvents(i._videoTrack)})}createGatewayPublishMessage(r,i){return r.map((o,a)=>{var l;let d,h,{track:f,type:m}=o;switch(m){case ee.LocalAudioTrack:d=at.Audio,h={dtx:f instanceof qS&&f._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ee.LocalVideoTrack:d=he(l=f._hints).call(l,zt.SCREEN_TRACK)?at.Screen:at.High,h=Nc(Nc({},FL(f)),{},{codec:this.store.codec,svc_mode:ls()});break;case ee.LocalVideoLowTrack:d=at.Low,h=Nc(Nc({},FL(f)),{},{codec:this.store.codec,svc_mode:ls()})}return{stream_type:d,attributes:h,ssrcs:i[a]}})}createGatewayUnpublishMessage(r){return r.map(i=>{var o;let a,[l,{track:d,ssrcs:h,id:f}]=i;switch(l){case ee.LocalVideoTrack:a=he(o=d._hints).call(o,zt.SCREEN_TRACK)?at.Screen:at.High;break;case ee.LocalAudioTrack:a=at.Audio;break;case ee.LocalVideoLowTrack:a=at.Low}return{stream_type:a,ssrcs:h,mid:f}})}assignLocalTracks(r,i){r.forEach((o,a)=>{let{track:l,type:d}=o;this.localTrackMap.set(d,{track:l,id:i[a].id,ssrcs:i[a].localSSRC})})}withdrawLocalTracks(r){r.forEach(i=>{let[o]=i;this.localTrackMap.delete(o)})}bindConnectionEvents(r){var i=this;r.onConnectionStateChange=function(){var o=L(function*(a){if(T.info("[".concat(i.store.clientId,"] [p2pId: ").concat(i.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(a,")")),i.emit(De.PeerConnectionStateChange,a),"connected"!==a||i.store.keyMetrics.peerConnectionEnd||i.store.peerConnectionEnd(),"connected"===a&&(i._restartTimer&&(clearTimeout(i._restartTimer),i._restartTimer=void 0),(i._isFirstConnected||i._isInRestartIce)&&i.reportPCStats(Date.now(),!0,i._pcStatsUploadType),i._isInRestartIce=!1,i._isFirstConnected=!1,i._isStartRestartIce=!1),B("NEW_ICE_RESTART")){var l;if(he(l=i._restartStates).call(l,a)){if(i._isStartRestartIce)return;i._isStartRestartIce=!0;const d=m=>{("disconnected"===r.iceConnectionState||"checking"===r.iceConnectionState||"failed"===r.iceConnectionState)&&(T.debug("[".concat(i.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(m)),"CONNECTED"===Ao(i,De.QueryClientConnectionState)&&i.emit(De.RequestRestartICE,m))},h=()=>{"disconnected"!==r.iceConnectionState&&"checking"!==r.iceConnectionState&&"failed"!==r.iceConnectionState||(i.reportPCStats(Date.now(),!1,i._pcStatsUploadType),T.debug("[".concat(i.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>i.emit(De.P2PLost),0),i.iceFailedCount+=1,i.requestReconnect())},f=B("ICE_RESTART_INTERVAL");return void(i._restartTimer=window.setTimeout(()=>{if(B("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&ct().supportPCSetConfiguration)d(uo.RELAY),i._restartTimer=window.setTimeout(h,f);else if(hn())d(uo.UDP),i._restartTimer=window.setTimeout(h,4e3);else{if(d(uo.TCP),ct().supportPCSetConfiguration)return void(i._restartTimer=window.setTimeout(()=>{d(uo.RELAY),i._restartTimer=window.setTimeout(h,f)},f));i._restartTimer=window.setTimeout(h,f)}},800))}}else{if("disconnected"===a&&"disconnected"===r.iceConnectionState)return setTimeout(()=>{"disconnected"===r.iceConnectionState&&B("ICE_RESTART")&&"CONNECTED"===Ao(i,De.QueryClientConnectionState)&&i.emit(De.RequestRestartICE)},800),void setTimeout(()=>{"disconnected"===r.peerConnectionState&&(T.debug("[".concat(i.store.clientId,"] [p2pId: ").concat(i.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),i.reportPCStats(Date.now(),!1,i._pcStatsUploadType),i._isInRestartIce=!1,setTimeout(()=>i.emit(De.P2PLost),0),i.iceFailedCount+=1,i.requestReconnect())},4e3);"failed"===a&&(T.debug("[".concat(i.store.clientId,"] [p2pId: ").concat(i.store.p2pId,"]: P2PConnection state failed, force reconnect")),i.reportPCDisconnectedOrFailed(),setTimeout(()=>i.emit(De.P2PLost),0),i.iceFailedCount+=1,yield i.requestReconnect())}});return function(a){return o.apply(this,arguments)}}(),r.onICEConnectionStateChange=o=>{"connected"!==o||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(o,")")),be.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:o,tag:st.TRACER}).onSuccess(),this.emit(De.IceConnectionStateChange,o)},r.onICETransportStateChange=o=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(o,")"))},r.onDTLSTransportStateChange=o=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(o,")"))},r.onDTLSTransportError=o=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(o,")"))},r.onFirstAudioDecoded=o=>{var a;const l=Array.from(wo(a=this.remoteUserMap).call(a)).find(h=>h._audioSSRC===o);var d;l&&(this.store.subscribe(l.uid,"audio",void 0,void 0,void 0,Date.now()),null===(d=l.audioTrack)||void 0===d||d.emit(Th.FIRST_FRAME_DECODED),be.firstRemoteFrame(this.store.sessionId,Pr.FIRST_AUDIO_DECODE,sn.FIRST_AUDIO_DECODE,{peer:l._uintid,subscribeElapse:ti.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId}))},r.onFirstAudioReceived=o=>{var a;const l=Array.from(wo(a=this.remoteUserMap).call(a)).find(d=>d._audioSSRC===o);l&&be.firstRemoteFrame(this.store.sessionId,Pr.FIRST_AUDIO_RECEIVED,sn.FIRST_AUDIO_RECEIVED,{peer:l._uintid,subscribeElapse:ti.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId})},r.onFirstVideoDecoded=(o,a,l)=>{this.reportVideoFirstFrameDecoded(o,a,l)},r.onFirstVideoReceived=o=>{var a;const l=Array.from(wo(a=this.remoteUserMap).call(a)).find(d=>d._videoSSRC===o);l&&be.firstRemoteFrame(this.store.sessionId,Pr.FIRST_VIDEO_RECEIVED,sn.FIRST_VIDEO_RECEIVED,{peer:l._uintid,subscribeElapse:ti.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId})},r.onSelectedLocalCandidateChanged=(o,a)=>{const l="relay"===o.candidateType;"unknown"!==a.candidateType&&l===("relay"===a.candidateType)||this.emit(De.ConnectionTypeChange,l),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ld(a))," -> ").concat(JSON.stringify(Ld(o)),")"))},r.onSelectedRemoteCandidateChanged=(o,a)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ld(a))," -> ").concat(JSON.stringify(Ld(o)),")"))},r.onFirstVideoDecodedTimeout=o=>{this.reportVideoFirstFrameDecoded(o,void 0,void 0,!0)},r.getLocalVideoStats=()=>{const o=this.statsCollector.getLocalVideoTrackStats(),a=this.statsCollector.getRTCStats();return Nc(Nc({},o),a)}}unbindConnectionEvents(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}filterTobeMutedTracks(r){const i=[];if(-1===this.getAllTracks().indexOf(r))return i;const o=this.localTrackMap.get(ee.LocalAudioTrack);if(r instanceof Cn&&o?.track instanceof sr)return o.track.isActive||i.push([ee.LocalAudioTrack,o]),i;const a=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:d}]=l;return r===d});if(a&&(i.push(a),a[0]===ee.LocalVideoTrack)){const l=this.localTrackMap.get(ee.LocalVideoLowTrack);l&&i.push([ee.LocalVideoLowTrack,l])}return i}filterTobeUnmutedTracks(r){const i=[],o=this.localTrackMap.get(ee.LocalAudioTrack);if(r instanceof Cn&&o?.track instanceof sr)return o.track.isActive&&i.push([ee.LocalAudioTrack,o]),i;const a=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:d}]=l;return r===d});if(a)if(a[0]===ee.LocalVideoTrack){i.push(a);const l=this.localTrackMap.get(ee.LocalVideoLowTrack);l&&i.push([ee.LocalVideoLowTrack,l])}else i.push(a);return i}createMuteMessage(r){return r.map(i=>{var o;let a,[l,{track:d,ssrcs:h,id:f}]=i;switch(l){case ee.LocalAudioTrack:a=at.Audio;break;case ee.LocalVideoTrack:a=he(o=d._hints).call(o,zt.SCREEN_TRACK)?at.Screen:at.High;break;case ee.LocalVideoLowTrack:a=at.Low}return{stream_type:a,ssrcs:h,mid:f}})}createUnmuteMessage(r){return r.map(i=>{var o;let a,[l,{track:d,ssrcs:h,id:f}]=i;switch(l){case ee.LocalAudioTrack:a=at.Audio;break;case ee.LocalVideoTrack:a=he(o=d._hints).call(o,zt.SCREEN_TRACK)?at.Screen:at.High;break;case ee.LocalVideoLowTrack:a=at.Low}return{stream_type:a,ssrcs:h,mid:f}})}filterTobeUnSubscribedTracks(r,i){const o=[],a=this.remoteUserMap.get(r);if(!a)return o;if(i){const l=a.get(i);if(!l)return o;o.push([r,{kind:i,id:l}])}else Array.from(a.entries()).forEach(l=>{let[d,h]=l;o.push([r,{kind:d,id:h}])});return o}filterTobeUnSubscribedDataChannels(r,i){const o=[];return i.forEach(a=>{var l;null!==(l=this.remoteDataChannelMap.get(r))&&void 0!==l&&l.has(a.id)&&o.push(a)}),o}createUnsubscribeMessage(r){const i=[];return r.forEach(o=>{let[a,{kind:l}]=o;switch(l){case _e.VIDEO:return void(a._videoSSRC&&i.push({stream_type:_e.VIDEO,ssrcId:a._videoSSRC}));case _e.AUDIO:return void(a._audioSSRC&&i.push({stream_type:_e.AUDIO,ssrcId:a._audioSSRC}))}}),i}createUnsubscribeAllMessage(r){const i=new Map;return r.forEach(o=>{let[a,{kind:l}]=o;if(i.has(a)){let d=i.get(a);d|=l===_e.VIDEO?gr.Video:gr.Audio,i.set(a,d)}else i.set(a,l===_e.VIDEO?gr.Video:gr.Audio)}),{users:Array.from(i.entries()).map(o=>{let[a,l]=o;return{stream_id:a.uid,stream_type:l}})}}withdrawRemoteTracks(r){r.forEach(i=>{let[o,{kind:a}]=i;const l=this.remoteUserMap.get(o);l&&(l.delete(a),0===Array.from(l.entries()).length&&this.remoteUserMap.delete(o))})}updateBitrateLimit(r){var i=this;return L(function*(){const o=i.localTrackMap.get(ee.LocalVideoTrack),a=i.localTrackMap.get(ee.LocalVideoLowTrack);o&&(yield o.track.setBitrateLimit(r.uplink)),a&&r.low_stream_uplink&&(yield a.track.setBitrateLimit({max_bitrate:r.low_stream_uplink.bitrate,min_bitrate:r.low_stream_uplink.bitrate||0}))})()}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(r,i,o){return r.map((a,l)=>{var d;let{stream_type:h}=a;const f=null===(d=i.find(m=>{let{stream_type:g}=m;return h===g}))||void 0===d?void 0:d.attributes;if(f&&B("DISABLE_SCREEN_SHARE_REMB")){const m=o[l]._hints;(he(m).call(m,zt.SCREEN_TRACK)||he(m).call(m,zt.SCREEN_LOW_TRACK))&&(f.remb=!1,T.debug("disable remb for screen share, hints:",m))}return f})}tryToUnmuteAudio(r){var i=this;return L(function*(){for(let a=0;a<r.length;a++)if(r[a]instanceof Cn){var o;const l=i.filterTobeUnmutedTracks(r[a]);if(0===l.length)continue;yield null===(o=i.connection)||void 0===o?void 0:o.unmuteLocal(l.map(h=>{let[,{id:f}]=h;return f}));const d=i.createUnmuteMessage(l);return void(yield Bt(i,De.RequestUnmuteLocal,d))}})()}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=r=>{var i;return!(null===(i=this.connection)||void 0===i||!i.getRemoteVideoIsReady(r))},this.statsUploader.requestUpload=(r,i)=>this.emit(De.RequestUpload,r,i),this.statsUploader.requestUploadStats=r=>this.emit(De.RequestUploadStats,r),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){var r=this;return L(function*(){r.dtlsFailedCount+=1,yield wr(TR(r.dtlsFailedCount,Nn)),r.emit(De.RequestReconnect)})()}reconnectP2P(){var r=this;return L(function*(){const i=Array.from(r.localTrackMap.entries()),o=r.createGatewayUnpublishMessage(i);Array.from(r.remoteUserMap.entries()),o.length>0&&(yield Gr(r,De.RequestUnpublishForReconnectPC,o)),r.disconnectForReconnect(),r.emit(De.RequestReconnectPC)})()}canPublishLowStream(){return this.localTrackMap.has(ee.LocalVideoTrack)||this.pendingLocalTracks.some(r=>r instanceof Ve)}throwIfTrackTypeNotMatch(r){if(r.filter(i=>i instanceof Ve).length>1)throw new Y(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r.filter(i=>i instanceof Cn).length>1&&(r.some(i=>i instanceof Cn&&i._bypassWebAudio)||!ct().webAudioMediaStreamDest))throw new Y(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const i of r){if(i instanceof Ve&&this.pendingLocalTracks.some(o=>o instanceof Ve))throw new Y(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(i instanceof Cn&&this.pendingLocalTracks.some(o=>o instanceof Cn)&&(!ct().webAudioMediaStreamDest||i._bypassWebAudio||this.pendingLocalTracks.some(o=>o instanceof Cn&&o._bypassWebAudio)))throw new Y(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(r,i){var o;const a=!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&ct().supportDualStreamEncoding,l=Nc(Nc({},{width:160,height:120,framerate:15,bitrate:50}),i);let d;d=a?r._mediaStreamTrack.clone():j2(r,l);const h=Ct(8,"track-low-"),f=new Ve(d,Nc(Nc({},a&&{scaleResolutionDownBy:XR(l,r)}),{},{frameRate:l.framerate,bitrateMax:l.bitrate,bitrateMin:l.bitrate}),void 0,void 0,h);return f.on(jf.TRANSCEIVER_UPDATED,m=>{r._updateRtpTransceiver(m,rv.LOW_STREAM)}),f._hints.push(zt.LOW_STREAM),he(o=r._hints).call(o,zt.SCREEN_TRACK)&&f._hints.push(zt.SCREEN_LOW_TRACK),r.on("sei-to-send",m=>{f.emit("sei-to-send",m)}),r.addListener(ge.NEED_CLOSE,()=>{f.close()}),f}globalLock(){var r=this;return L(function*(){return r.mutex.lock("From P2PChannel.globalLock")})()}reportPCStats(r,i,o){var a=arguments,l=this;return L(function*(){let d=a.length>3&&void 0!==a[3]?a[3]:null;if(l.connection&&l.connection instanceof Va){var h,f,m,g;const v=l.store.keyMetrics.descriptionStart||0,{iceConnectionState:y,dtlsTransportState:b,peerConnectionState:C}=l.connection,{local:P,remote:R}=yield l.connection.getSelectedCandidatePair();be.pcStats(l.store.sessionId,{startTime:v,eventElapse:r-v||0,iceconnectionsate:y,dtlsstate:b,connectionstate:C,intSucc:i?1:2,error:d,selectedLocalCandidateProtocol:null!==(h=P?.protocol)&&void 0!==h?h:"",selectedLocalCandidateType:null!==(f=P.candidateType)&&void 0!==f?f:"",selectedLocalCandidateAddress:"".concat(P.address,":").concat(P.port),selectedRemoteCandidateProtocol:null!==(m=R.protocol)&&void 0!==m?m:"",selectedRemoteCandidateType:null!==(g=R.candidateType)&&void 0!==g?g:"",selectedRemoteCandidateAddress:"".concat(R.address,":").concat(R.port),restartCnt:o,preallocation:l.connection.isPreallocation})}})()}reportVideoFirstFrameDecoded(r,i,o,a){var l;const d=Array.from(wo(l=this.remoteUserMap).call(l)).find(h=>h._videoSSRC===r);if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,f=h.subscribe.find(m=>m.userId===d.uid&&"video"===m.type);be.firstRemoteVideoDecode(this.store.sessionId,Pr.FIRST_VIDEO_DECODE,sn.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:i,videoheight:o,subscribeElapse:ti.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:f?.subscribeEnd||0,subscriberStart:f?.subscribeStart||0,videoAddNotify:f?.streamAdded||0,state:a?1:0,firstFrame:f?.firstFrame||0})}}remoteMediaSsrcChanged(r,i,o){var a=this;return L(function*(){if(!a.connection)return!1;const l=a.remoteUserMap.get(r);if(!l)return!1;const d=l.get(i);if(!d)return!1;const h=yield a.connection.getRemoteSSRC(d);return void 0!==h&&h!==o})()}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(r=>{let[i,{track:o}]=r;i===ee.LocalVideoLowTrack?o._updateRtpTransceiver(void 0,rv.LOW_STREAM):o._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(r){this.connection&&this.connection instanceof Va&&("disconnected"!==this.connection.iceConnectionState&&"checking"!==this.connection.iceConnectionState&&"failed"!==this.connection.iceConnectionState||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this.reportPCStats(Date.now(),!1,this._pcStatsUploadType===Tc.TCP_RESTART&&r===uo.RELAY?this._pcStatsUploadType:Tc.DISCONNECTED_OR_FAILED)))}},pe(ze.prototype,"startP2PConnection",[Mi],Object.getOwnPropertyDescriptor(ze.prototype,"startP2PConnection"),ze.prototype),pe(ze.prototype,"connect",[Mi],Object.getOwnPropertyDescriptor(ze.prototype,"connect"),ze.prototype),pe(ze.prototype,"updateRemoteRTPCapabilities",[Mi],Object.getOwnPropertyDescriptor(ze.prototype,"updateRemoteRTPCapabilities"),ze.prototype),pe(ze.prototype,"publishDataChannel",[Mi],Object.getOwnPropertyDescriptor(ze.prototype,"publishDataChannel"),ze.prototype),pe(ze.prototype,"unpublish",[Mi],Object.getOwnPropertyDescriptor(ze.prototype,"unpublish"),ze.prototype),pe(ze.prototype,"unpublishDataChannel",[Mi],Object.getOwnPropertyDescriptor(ze.prototype,"unpublishDataChannel"),ze.prototype),pe(ze.prototype,"unpublishLowStream",[Mi],Object.getOwnPropertyDescriptor(ze.prototype,"unpublishLowStream"),ze.prototype),pe(ze.prototype,"subscribeDataChannel",[Mi],Object.getOwnPropertyDescriptor(ze.prototype,"subscribeDataChannel"),ze.prototype),pe(ze.prototype,"subscribe",[Mi],Object.getOwnPropertyDescriptor(ze.prototype,"subscribe"),ze.prototype),pe(ze.prototype,"massSubscribe",[Mi],Object.getOwnPropertyDescriptor(ze.prototype,"massSubscribe"),ze.prototype),pe(ze.prototype,"unsubscribe",[Mi],Object.getOwnPropertyDescriptor(ze.prototype,"unsubscribe"),ze.prototype),pe(ze.prototype,"unsubscribeDataChannel",[Mi],Object.getOwnPropertyDescriptor(ze.prototype,"unsubscribeDataChannel"),ze.prototype),pe(ze.prototype,"massUnsubscribe",[Mi],Object.getOwnPropertyDescriptor(ze.prototype,"massUnsubscribe"),ze.prototype),pe(ze.prototype,"muteRemote",[Mi],Object.getOwnPropertyDescriptor(ze.prototype,"muteRemote"),ze.prototype),pe(ze.prototype,"unmuteRemote",[Mi],Object.getOwnPropertyDescriptor(ze.prototype,"unmuteRemote"),ze.prototype),pe(ze.prototype,"hasRemoteMediaWithLock",[Mi],Object.getOwnPropertyDescriptor(ze.prototype,"hasRemoteMediaWithLock"),ze.prototype),pe(ze.prototype,"disconnectForReconnect",[Mi],Object.getOwnPropertyDescriptor(ze.prototype,"disconnectForReconnect"),ze.prototype),pe(ze.prototype,"updateBitrateLimit",[Mi],Object.getOwnPropertyDescriptor(ze.prototype,"updateBitrateLimit"),ze.prototype),pe(ze.prototype,"remoteMediaSsrcChanged",[Mi],Object.getOwnPropertyDescriptor(ze.prototype,"remoteMediaSsrcChanged"),ze.prototype),ze);function Mi(r,i,o){const a=r[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return o.value=L(function*(){const l=this.mutex,d=yield l.lock("From P2PChannel.".concat(i));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return yield a.apply(this,f)}finally{d()}}),o}const MH={};function EC(r){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&T.debug("install service ".concat(r.name)),MH[r.name]=r}function yC(r){const i=MH[r];if(!i)throw new Y(k.INVALID_OPERATION,"".concat(r," not found, please use AgoraRTC.use(").concat(r,"Service) to load it first"));return i}function kH(r,i){return yC("DataStream").create(r,i)}function LH(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function xH(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?LH(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):LH(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}const Dz=Date.now(),Oz=20,nF=new Map,BD=new Map;function bC(r){return rF.apply(this,arguments)}function rF(){return rF=L(function*(r){const i=nF.get(r),o=Array.isArray(i)&&i[i.length-1],a=BD.get(r);if(!o)return void(a.isSyncing=!1);const l={uid:o.uid,payload:o.payload};0===a.firstRecvTs&&(a.firstRecvTs=o.recvTs,a.firstSendTs=o.sendTs);const d=o.sendTs-a.firstSendTs,h=d-(Date.now()-a.firstRecvTs);h>0&&(a.firstRecvTs=Date.now()-d);let f=o.mediaDelay+h;f<=0?(i.pop(),jD(o.context,l),f=0):f=Math.min(f,Oz),setTimeout(()=>i.length&&bC(r),f)}),rF.apply(this,arguments)}function jD(r,i){r.safeEmit(Je.STREAM_MESSAGE,i.uid,i.payload),r.onStreamMessage&&r.onStreamMessage(i)}const Nz=ot().name;function FH(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function iF(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?FH(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):FH(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}const $d="websdk_ng_cache_parameter",Ov=B("MAX_PRELOAD_ASYNC_LENGTH"),UH=1e4,Uh=new Map,Vh=[];let HD=null,Nv=0,CC=0;const Pv=new Map,GD=function(r,i){const o=[];let a=0;const l=function(){var d=L(function*(){const h=o.shift();h&&(yield h()),o.length>0&&a<i?l():a--});return function(){return d.apply(this,arguments)}}();return L(function*(){for(var d=arguments.length,h=new Array(d),f=0;f<d;f++)h[f]=arguments[f];return new le(function(){var m=L(function*(g,v){o.push(L(function*(){try{const y=yield r(...h);g(y)}catch(y){v(y)}})),a<i&&(a++,l())});return function(g,v){return m.apply(this,arguments)}}())})}(wC,Ov),TC=Oi.CancelToken.source();function wC(r,i,o,a,l,d){return Mv.apply(this,arguments)}function Mv(){return Mv=L(function*(r,i,o,a,l,d){try{if(!B("ENABLE_PRELOAD"))return;if(!ct().supportWebCrypto)return void yc(()=>{T.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!o&&null!==o)throw new Y(k.INVALID_PARAMS,"Invalid token: ".concat(o,". If you don not use token, set it to null"));o&&Nr(o,"token",1,2047),Nr(r,"appid",1,2047),bS(i),a&&SS(a);const h=Rf();T.debug("preload channel ".concat(i,", uid is ").concat(a));const f={appId:r,cname:i,token:o||r,uid:"string"!=typeof a?a:null,sid:h,proxyServer:l};let m,g;"string"==typeof a?(f.stringUid=a,[g,m]=yield le.all([cH(a,{sid:h,appId:r},TC.token),_D(iF(iF({},f),{},{token:o||r,uid:0}),TC.token)]),f.uid=g.uid,m.gatewayInfo.uid=f.uid,m.gatewayInfo.res.uid=f.uid):(d&&(f.stringUid=d),m=yield _D(f,TC.token));const v={sid:h,appId:r,cname:i,token:o||r,uid:f.stringUid||a,intUid:f.uid||m.gatewayInfo.uid,stringUid:f.stringUid,ts:Date.now(),sua:g,ap:m};yield(y=L(function*(b){let C;try{b.uid&&oF({appId:b.appId,cname:b.cname,token:b.token,uid:b.uid,stringUid:b.stringUid});const P=IC(b),R=yield(O=L(function*(M,x){try{const j=yield window.crypto.subtle.importKey("raw",SR(x),"AES-GCM",!1,["encrypt"]),W=yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},j,_l(window.btoa(JSON.stringify(M))));return vl(new Uint8Array(W))}catch{return}}),function(M,x){return O.apply(this,arguments)})(b,b.token||b.appId);if(!R)return;C=cF($d);const A=C?JSON.parse(C):[];A.push({[P]:R}),A.length>B("AP_CACHE_NUM")&&A.shift(),kv($d,JSON.stringify(A))}catch(P){T.warn("Error caching server parameters:",P.message),kv($d,"")}var O}),function(b){return y.apply(this,arguments)})(v),Nv++}catch(h){throw CC++,function(f){HD||(HD=window.setTimeout(()=>{let g="";Pv.forEach((v,y)=>{g+="".concat(y,": ").concat(v," ;")}),be.reportApiInvoke(null,{name:Yn.PRELOAD,options:{success:Nv,failed:CC,err:g}}).onError(f),Nv=0,CC=0,Pv.clear(),HD=null},UH));const m=Pv.get(f.code)||0;Pv.set(f.code,m+1)}(h),h}var y}),Mv.apply(this,arguments)}function WD(r){return zD.apply(this,arguments)}function zD(){return zD=L(function*(r){try{if(B("AP_REQUEST_DETAIL"))return;const i=oF(r);if(!i||"disabled"!==r.cloudProxyServer)return;const o=yield(a=L(function*(l,d){try{const h=yield window.crypto.subtle.importKey("raw",SR(d),"AES-GCM",!1,["decrypt"]),f=yield window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},h,_l(l));return JSON.parse(window.atob(vl(new Uint8Array(f))))}catch{return}}),function(l,d){return a.apply(this,arguments)})(i,r.token||r.appId);if(!o||!function(a,l){return a.cname===l.cname&&a.appId===l.appId&&a.token===l.token&&(l.stringUid?a.stringUid===l.stringUid:"number"==typeof l.uid?a.uid===l.uid:a.uid==l.uid)}(o,r))return;if(o&&Date.now()-o.ts<B("AP_CACHE_LIFETIME"))return o}catch(i){T.warn("Error get preloadInfo",i.message)}var a}),zD.apply(this,arguments)}function oF(r){let i;try{if(i=cF($d),!i)return;const o=JSON.parse(i),a=IC(r),l=function(h,f){for(let m=h.length-1;m>=0;m--)if(f(h[m]))return m;return-1}(o,h=>a in h);if(-1===l)return;const d=o.splice(l,1)[0];return kv($d,JSON.stringify(o)),d[a]}catch(o){T.warn("Error delete preload info: ".concat(i),o.message),kv($d,"")}}function KD(r){if(r){let i=Uh.get(r);i&&(window.clearTimeout(i),i=null,Uh.delete(r)),he(Vh).call(Vh,r)||"disabled"!==r.cloudProxyServer||Vh.push(r)}if(Uh.size<B("AP_CACHE_NUM")&&Vh.length>0){const i=Vh.shift();Uh.set(i,window.setTimeout(L(function*(){const{appId:o,cname:a,token:l,stringUid:d,uid:h,proxyServer:f}=i;try{yield GD(o,a,l,h,f,d),Uh.has(i)&&KD(i)}catch(m){T.warn("update preload failed",m.message),sF(i)}}),B("AP_UPDATE_INTERVAL")))}}function sF(r){const i=Vh.indexOf(r);-1!==i&&Vh.splice(i,1);let o=Uh.get(r);o&&(window.clearTimeout(o),o=null,Uh.delete(r),KD())}function aF(r,i){const o=r.sua,a=r.ap;i&&o&&be.reqUserAccount(r.sid,{lts:o.requestTime,elapse:o.elapse,success:!0,serverAddr:o.url,stringUid:i,uid:r.intUid,errorCode:null,extend:o.req}),be.reportResourceTiming(r.ap.url,r.sid),be.joinWebProxyAP(r.sid,{lts:a.requestTime,elapse:a.elapse,sucess:1,apServerAddr:a.url,turnServerAddrList:a.proxyInfo.addresses.map(l=>l.ip).join(","),eventType:"disabled",unilbsServerIds:[jn.CHOOSE_SERVER,jn.CLOUD_PROXY_FALLBACK].toString()}),be.joinChooseServer(r.sid,{lts:a.requestTime,elapse:a.elapse,succ:!0,csAddr:a.url,opid:a.opid,serverList:a.gatewayInfo.gatewayAddrs.map(l=>l.address),ec:null,cid:a.gatewayInfo.cid.toString(),uid:a.gatewayInfo.uid.toString(),csIp:a.gatewayInfo.csIp,unilbsServerIds:[jn.CHOOSE_SERVER].toString(),isHttp3:a.isHttp3})}function cF(r){return window.atob(window.localStorage.getItem(r)||"")}function kv(r,i){window.localStorage.setItem(r,window.btoa(i))}function IC(r){let i="".concat(r.appId,"_").concat(r.cname);return"string"==typeof r.uid&&(i+="_s_".concat(r.uid)),"number"==typeof r.uid&&(i+="_".concat(r.uid)),r.token&&(i+="_".concat(r.token)),m4(i)}function Pz(r,i){switch(i){case 0:for(;128&ia(r););break;case 2:Lv(r,em(r));break;case 5:Lv(r,4);break;case 1:Lv(r,8);break;default:throw new Error("Unimplemented type: "+i)}}function Bh(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}let BH=[];function Lv(r,i){if(r.offset+i>r.limit)throw new Error("Skip past limit");r.offset+=i}function lF(r){return r.offset>=r.limit}function RC(r,i){let o=r.bytes,a=r.offset,l=r.limit,d=a+i;if(d>o.length){let h=new Uint8Array(2*d);h.set(o),r.bytes=h}return r.offset=d,d>l&&(r.limit=d),a}function YD(r,i){let o=r.offset;if(o+i>r.limit)throw new Error("Read past limit");return r.offset+=i,o}function dF(r,i){let o=RC(r,i.length);r.bytes.set(i,o)}function uF(r,i){let o=YD(r,i),a=String.fromCharCode,l=r.bytes,d="\ufffd",h="";for(let f=0;f<i;f++){let m,g,v,y,b=l[f+o];128&b?192==(224&b)?f+1>=i?h+=d:(m=l[f+o+1],128!=(192&m)?h+=d:(y=(31&b)<<6|63&m,y<128?h+=d:(h+=a(y),f++))):224==(240&b)?f+2>=i?h+=d:(m=l[f+o+1],g=l[f+o+2],32896!=(49344&(m|g<<8))?h+=d:(y=(15&b)<<12|(63&m)<<6|63&g,y<2048||y>=55296&&y<=57343?h+=d:(h+=a(y),f+=2))):240==(248&b)?f+3>=i?h+=d:(m=l[f+o+1],g=l[f+o+2],v=l[f+o+3],8421504!=(12632256&(m|g<<8|v<<16))?h+=d:(y=(7&b)<<18|(63&m)<<12|(63&g)<<6|63&v,y<65536||y>1114111?h+=d:(y-=65536,h+=a(55296+(y>>10),56320+(1023&y)),f+=3))):h+=d:h+=a(b)}return h}function Xd(r,i){let o=i.length,a=0;for(let h=0;h<o;h++){let f=i.charCodeAt(h);f>=55296&&f<=56319&&h+1<o&&(f=(f<<10)+i.charCodeAt(++h)-56613888),a+=f<128?1:f<2048?2:f<65536?3:4}Jn(r,a);let l=RC(r,a),d=r.bytes;for(let h=0;h<o;h++){let f=i.charCodeAt(h);f>=55296&&f<=56319&&h+1<o&&(f=(f<<10)+i.charCodeAt(++h)-56613888),f<128?d[l++]=f:(f<2048?d[l++]=f>>6&31|192:(f<65536?d[l++]=f>>12&15|224:(d[l++]=f>>18&7|240,d[l++]=f>>12&63|128),d[l++]=f>>6&63|128),d[l++]=63&f|128)}}function ia(r){return r.bytes[YD(r,1)]}function jH(r,i){let o=RC(r,1);r.bytes[o]=i}function em(r){let i,o=0,a=0;do{i=ia(r),o<32&&(a|=(127&i)<<o),o+=7}while(128&i);return a}function Jn(r,i){for(i>>>=0;i>=128;)jH(r,127&i|128),i>>>=7;jH(r,i)}function HH(r,i){let o,a=0,l=0,d=0;return o=ia(r),a=127&o,128&o&&(o=ia(r),a|=(127&o)<<7,128&o&&(o=ia(r),a|=(127&o)<<14,128&o&&(o=ia(r),a|=(127&o)<<21,128&o&&(o=ia(r),l=127&o,128&o&&(o=ia(r),l|=(127&o)<<7,128&o&&(o=ia(r),l|=(127&o)<<14,128&o&&(o=ia(r),l|=(127&o)<<21,128&o&&(o=ia(r),d=127&o,128&o&&(o=ia(r),d|=(127&o)<<7))))))))),{low:a|l<<28,high:l>>>4|d<<24,unsigned:i}}function Zd(r,i){let o=i.low>>>0,a=(i.low>>>28|i.high<<4)>>>0,l=i.high>>>24,d=0===l?0===a?o<16384?o<128?1:2:o<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:l<128?9:10,h=RC(r,d),f=r.bytes;switch(d){case 10:f[h+9]=l>>>7&1;case 9:f[h+8]=9!==d?128|l:127&l;case 8:f[h+7]=8!==d?a>>>21|128:a>>>21&127;case 7:f[h+6]=7!==d?a>>>14|128:a>>>14&127;case 6:f[h+5]=6!==d?a>>>7|128:a>>>7&127;case 5:f[h+4]=5!==d?128|a:127&a;case 4:f[h+3]=4!==d?o>>>21|128:o>>>21&127;case 3:f[h+2]=3!==d?o>>>14|128:o>>>14&127;case 2:f[h+1]=2!==d?o>>>7|128:o>>>7&127;case 1:f[h]=1!==d?128|o:127&o}}const hF={},pF={},$D=4294967296,GH=$D*$D,fF=GH/2,XD=ZD(0,!0),WH=ZD(0),Mz=tm(0,-2147483648,!1),kz=tm(-1,2147483647,!1),zH=tm(-1,-1,!0);function ZD(r,i){let o,a,l;return i?(l=0<=(r>>>=0)&&r<256)&&(a=pF[r],a)?a:(o=tm(r,0,!0),l&&(pF[r]=o),o):(l=-128<=(r|=0)&&r<128)&&(a=hF[r],a)?a:(o=tm(r,r<0?-1:0,!1),l&&(hF[r]=o),o)}function tm(r,i,o){return{low:0|r,high:0|i,unsigned:!!o}}function KH(r,i){if(isNaN(r))return i?XD:WH;if(i){if(r<0)return XD;if(r>=GH)return zH}else{if(r<=-fF)return Mz;if(r+1>=fF)return kz}return r<0?i?XD:WH:tm(r%$D|0,r/$D|0,i)}function JD(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}class mF extends nn{get connectionState(){return this._connectionState}set connectionState(i){if(this._connectionState===i)return;const o=this._connectionState;this._connectionState=i,this.emit(Pa.CONNECTION_STATE_CHANGE,i,o)}get quality(){return this._quality}set quality(i){this._quality=i>1?1:i<.1?.1:i,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(i){var o;super(),N(this,"name","AgoraRTCImageModeration"),N(this,"_connectionState",ws.CONNECTING),N(this,"_sequence",0),N(this,"_moderationStartTime",void 0),N(this,"_workerConnection",void 0),N(this,"_workerMessageLengthLimit",void 0),N(this,"_qualityRatio",void 0),N(this,"_connectInfo",void 0),N(this,"_cancelTokenSource",Oi.CancelToken.source()),N(this,"_retryConfig",void 0),N(this,"_moderationInterval",void 0),N(this,"_moderationTimer",null),N(this,"_moderationMode",1),N(this,"_quality",1),N(this,"_qualityTimer",null),N(this,"_ticket",void 0),N(this,"_moderationIntervalMinimum",void 0),N(this,"_uploadFailedNum",0),N(this,"_uploadNum",0),N(this,"_uploadTimer",null),N(this,"_extraInfo",void 0),N(this,"_vendor",""),N(this,"_encoder",new TextEncoder),N(this,"_moderationId",void 0),N(this,"inspectImage",()=>{if(this.connectionState!==ws.CONNECTED)throw new K(k.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===ws.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Ct(5,"image-moderation-"),this._workerMessageLengthLimit=B("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=B("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(o=i.interval)&&void 0!==o?o:1e3,i.extraInfo&&(this._extraInfo=this._encoder.encode(i.extraInfo)),i.vendor&&(this._vendor=i.vendor),this._qualityRatio=B("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new j_("worker-"+this._moderationId,Nn),this.on(Pa.STATE_CHANGE,(a,l)=>{T.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Md[a]," ").concat(l||""))}),this.handleWorkerEvents()}init(i,o){var a=this;return L(function*(){a.emit(Pa.STATE_CHANGE,Md.CONNECT_AP),a._connectInfo=i;const l=a._cancelTokenSource.token;return a._retryConfig=o,new le((d,h)=>{a.on(Pa.CONNECTION_STATE_CHANGE,(f,m)=>{f===ws.CONNECTED&&d()}),a.requestAP(i,l,o).then(f=>{a.connectWorker(f)}).catch(f=>{h(f)})})})()}updateConfig(i){var o;this._moderationInterval=null!==(o=i.interval)&&void 0!==o?o:1e3,i.extraInfo&&(this._extraInfo=this._encoder.encode(i.extraInfo)),i.vendor&&(this._vendor=i.vendor),T.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(i))),this.connectionState===ws.CONNECTED&&this.inspectImage()}requestAP(i,o,a){var l=this;return L(function*(){const d=B("WEBCS_DOMAIN").map(g=>"https://".concat(g,"/api/v1")),h=yield function(g,v,y,b){let{appId:C,areaCode:P,cname:R,sid:A,token:O,uid:M}=v;Yf++;const x="moderation_plugin",j={service_name:x,json_body:JSON.stringify({appId:C,areaCode:P,cname:R,command:"allocateEdge",requestId:Yf,seq:Yf,sid:A,appToken:O,ts:Date.now(),uid:M+""})};let W,q,te=g[0];return rs(L(function*(){W=Date.now();const J=yield ta(te,{data:j,cancelToken:y,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(q=Date.now()-W,0!==J.code){const Re=new K(k.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+J.code,{retry:!0,responseTime:q});throw T.error(Re.toString()),Re}const X=JSON.parse(J.json_body);if(200!==X.code){const Re=new K(k.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(X.code,", reason: ").concat(X.reason),{code:X.code,responseTime:q});throw T.error(Re.toString()),Re}if(!X.servers||!Array.isArray(X.servers)||0===X.servers.length){const Re=new K(k.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:X.code,responseTime:q});throw T.error(Re.toString()),Re}if(!X.servers.some(Re=>!!Re.wss)){const Re=new K(k.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:X.code,responseTime:q});throw T.error(Re.toString()),Re}const Ce=B("IMAGE_MODERATION_WORKER_HOST");return{addressList:X.servers.map(Re=>{let{address:ut,wss:Nt}=Re;if(ut&&Nt)return"wss://".concat(ut.replace(/\./g,"-"),".").concat(Ce,":").concat(Nt,"/moderation")}).filter(Re=>!!Re),workerToken:X.workerToken,vid:X.vid,ticket:X.appTicket,responseTime:q}}),(J,X)=>(be.apworkerEvent(A,{success:!0,sc:200,serviceName:x,responseDetail:JSON.stringify(J.addressList),firstSuccess:0===X,responseTime:q,serverIp:g[X%g.length]}),!1),(J,X)=>(be.apworkerEvent(A,{success:!1,sc:J.data&&J.data.code||200,serviceName:x,responseTime:q,serverIp:g[X%g.length]}),!!(J.code!==k.OPERATION_ABORTED&&J.code!==k.UNEXPECTED_RESPONSE||J.data&&J.data.retry)&&(te=g[(X+1)%g.length],!0)),b)}(d,i,o,a);l.emit(Pa.STATE_CHANGE,Md.AP_CONNECTED);const{addressList:f,ticket:m}=h;return l._ticket=m,f})()}connectWorker(i){var o=this;return L(function*(){o.emit(Pa.STATE_CHANGE,Md.CONNECT_WORKER),yield o._workerConnection.init(i,1e4)})()}handleWorkerEvents(){var i=this;this._workerConnection.on(Fe.CONNECTED,L(function*(){i.emit(Pa.STATE_CHANGE,Md.WORKER_CONNECTED,i._workerConnection.url),i.connectionState=ws.CONNECTED})),this._workerConnection.on(Fe.CLOSED,()=>{this.connectionState=ws.CLOSED}),this._workerConnection.on(Fe.FAILED,()=>{this.connectionState=ws.CLOSED}),this._workerConnection.on(Fe.RECONNECTING,()=>{this.connectionState=this.connectionState===ws.CONNECTED?ws.RECONNECTING:ws.CONNECTING}),this._workerConnection.on(Fe.ON_MESSAGE,function(){var o=L(function*(a){if(a.data instanceof ArrayBuffer){const l=function VH(r){return function(o){let a={};e:for(;!lF(o);){let l=em(o);switch(l>>>3){case 0:break e;case 1:a.code=em(o);break;case 2:a.msg=uF(o,em(o));break;case 3:a.requestId=uF(o,em(o));break;case 4:a.timestamp=HH(o,!1);break;default:Pz(o,7&l)}}return a}({bytes:i=r,offset:0,limit:i.length});var i}(new Uint8Array(a.data));B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("[".concat(i._moderationId,"] Response message for worker of image moderation "),JSON.stringify(l)),i._uploadNum++,void 0===l.code||0===l.code||(i._uploadFailedNum++,T.error("[".concat(i._moderationId,"] Error response from worke, code is ").concat(l.code,", msg is ").concat(l.msg)),i._uploadTimer||(i._uploadTimer=window.setTimeout(()=>{be.reportApiInvoke(i._connectInfo.sid||null,{name:Yn.IMAGE_MODERATION_UPLOAD,options:[i._uploadFailedNum,i._uploadNum,l.code],tag:st.TRACER}).onError(new K(k.IMAGE_MODERATION_UPLOAD_FAILED,l.msg)),i._uploadTimer=null},B("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else T.error("[".concat(i._moderationId,"] Unexpected message type from worker"))});return function(a){return o.apply(this,arguments)}}()),this._workerConnection.on(Fe.WILL_RECONNECT,(o,a,l)=>{"recover"===o&&l(o),l("tryNext")}),this._workerConnection.on(Fe.REQUEST_NEW_URLS,(o,a)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o).catch(a)})}static intToLong(i){return{low:i|=0,high:i>>31,unsigned:i>=0}}requestToInspectImage(){var i=this;return L(function*(){const o=Ao(i,Pa.CLIENT_LOCAL_VIDEO_TRACK),a={appId:i._connectInfo.appId,cname:i._connectInfo.cname,cid:i._connectInfo.cid,sid:i._connectInfo.sid,uid:i._connectInfo.uid,vid:i._connectInfo.vid};if(o){if(!o.isPlaying)return void(B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being played can be inspected"));i._sequence++;const l=yield i.generateRequestData(o,a);i._workerConnection.sendMessage(l,!0,!0)}else B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being published can be inspected")})()}generateRequestData(i,o){var a=this;return L(function*(){let{appId:l,cname:d,cid:h,vid:f,sid:m,uid:g}=o;const v=Date.now(),y=yield i.getCurrentFrameImage("image/jpeg",a.quality),b=yield Ox(y,l,d),C=a._sequence+"-"+h+"-"+g+"-"+v+"-"+Ct(12,""),P={appId:l,cid:h,cname:d,deviceId:"",elapse:mF.intToLong(Number(v-a._moderationStartTime)),fileSize:y.buffer.byteLength,height:y.height,width:y.width,jpg:b,networkType:6,osType:7,requestId:C,sdkVersion:"4.22.2",sequence:a._sequence,sid:m,timestamp:KH(v),uid:g,vid:f,service:a._moderationMode,ticket:a._ticket,callbackData:a._extraInfo,vendorConfigs:a._vendor};void 0===a._extraInfo&&delete P.callbackData;const R=function qD(r){let i=function(){const o=BH.pop();return o?(o.offset=o.limit=0,o):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(o,a){let l=o.appId;void 0!==l&&(Jn(a,10),Xd(a,l));let d=o.cid;void 0!==d&&(Jn(a,16),Jn(a,d));let h=o.cname;void 0!==h&&(Jn(a,26),Xd(a,h));let f=o.deviceId;void 0!==f&&(Jn(a,34),Xd(a,f));let m=o.elapse;void 0!==m&&(Jn(a,40),Zd(a,m));let g=o.fileSize;void 0!==g&&(Jn(a,48),Zd(a,Bh(g)));let v=o.height;void 0!==v&&(Jn(a,56),Zd(a,Bh(v)));let y=o.jpg;void 0!==y&&(Jn(a,66),Jn(a,y.length),dF(a,y));let b=o.networkType;void 0!==b&&(Jn(a,72),Zd(a,Bh(b)));let C=o.osType;void 0!==C&&(Jn(a,80),Zd(a,Bh(C)));let P=o.requestId;void 0!==P&&(Jn(a,90),Xd(a,P));let R=o.sdkVersion;void 0!==R&&(Jn(a,98),Xd(a,R));let A=o.sequence;void 0!==A&&(Jn(a,104),Zd(a,Bh(A)));let O=o.sid;void 0!==O&&(Jn(a,114),Xd(a,O));let M=o.timestamp;void 0!==M&&(Jn(a,120),Zd(a,M));let x=o.uid;void 0!==x&&(Jn(a,128),Jn(a,x));let j=o.vid;void 0!==j&&(Jn(a,136),Jn(a,j));let W=o.width;void 0!==W&&(Jn(a,144),Zd(a,Bh(W)));let q=o.service;void 0!==q&&(Jn(a,152),Jn(a,q));let te=o.callbackData;void 0!==te&&(Jn(a,162),Jn(a,te.length),dF(a,te));let J=o.ticket;void 0!==J&&(Jn(a,170),Xd(a,J));let X=o.vendorConfigs;void 0!==X&&(Jn(a,178),Xd(a,X))}(r,i),function(o){let a=o.bytes,l=o.limit;return a.length===l?a:a.subarray(0,l)}(i)}(P);if(R.byteLength<a._workerMessageLengthLimit){if(B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const A=function(O){for(var M=1;M<arguments.length;M++){var x=null!=arguments[M]?arguments[M]:{};M%2?JD(Object(x),!0).forEach(function(j){N(O,j,x[j])}):Object.getOwnPropertyDescriptors?Object.defineProperties(O,Object.getOwnPropertyDescriptors(x)):JD(Object(x)).forEach(function(j){Object.defineProperty(O,j,Object.getOwnPropertyDescriptor(x,j))})}return O}({},P);delete A.jpg,T.debug("[".concat(a._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(A))}return R}return a.quality=a.quality*a._qualityRatio,yield a.generateRequestData(i,{appId:l,cname:d,cid:h,vid:f,sid:m,uid:g})})()}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Oi.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=ws.CLOSED,this.emit(Pa.STATE_CHANGE,Md.CLOSED)}}function qH(r){if(Ft(r.interval,"interval",1e3,1/0),r&&r.extraInfo&&r.extraInfo.length>1024)throw new K(k.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(r&&r.vendor&&r.vendor.length>1024)throw new K(k.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Lz={name:"ImageModeration",create:function(r){let{config:i}=r;return qH(i),new mF(i)}};var gF,YH,$H,XH,ZH,JH,QH,e6,t6,Jd,xv,n6,r6,i6,o6,s6,a6,c6,AC,DC,_F,OC,vF,EF,yF,bF,SF,CF,TF,wF,QD,IF,NC,RF,PC,eO,AF,DF,OF,Ll,fe;function NF(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function Os(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?NF(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):NF(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}Qr.setLogger(T);let l6=(gF=Ae(),YH=Ae({argsMap:(r,i)=>{if(!Array.isArray(i)){if(!(i instanceof Ih))return[i];i=[i]}return i.map(o=>o?Object(o).toString():"null")}}),$H=Ae({argsMap:(r,i)=>(i||(i=[]),Array.isArray(i)||i.trackMediaType!==wl.DATA?(Array.isArray(i)||(i=[i]),i.map(o=>o.getTrackId())):[i.getChannelId()])}),XH=Ae({argsMap:(r,i,o,a)=>["object"==typeof i?i.uid:i,o,a]}),ZH=Ae({argsMap:(r,i,o)=>[i,o]}),JH=Ae({argsMap:(r,i)=>i.map(o=>{let{user:a,mediaType:l}=o;return[a?.uid,l]})}),QH=Ae({argsMap:(r,i,o,a)=>["object"==typeof i?i.uid:i,o,a]}),e6=Ae({argsMap:(r,i)=>i.map(o=>{let{user:a,mediaType:l}=o;return{uid:a?.uid,mediaType:l}})}),t6=Ae(),Jd=Ae(),xv=Ae(),n6=Ae(),r6=Ae(),i6=Ae(),o6=Ae(),s6=Ae(),a6=Ae(),c6=Ae(),AC=Ae(),DC=Ae(),_F=Ae(),OC=Ae(),vF=Ae({argsMap:(r,i)=>[i]}),EF=Ae(),yF=Ae(),bF=Ae(),SF=Ae(),CF=Ae(),TF=Ae(),wF=Ae(),QD=Ae(),IF=Ae({argsMap:(r,i)=>(Array.isArray(i)||(i=[i]),[JSON.stringify(i)])}),NC=Ae(),RF=Ae(),PC=Ae(),eO=Ae(),AF=Ae(),DF=Ae(),OF=Ae({reportResult:!0}),Ll=Ae(),fe=class extends nn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var r;return(null===(r=this._config)||void 0===r?void 0:r.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(r,i){var o;let a;if(super(),o=this,N(this,"store",void 0),N(this,"_uid",void 0),N(this,"_channelName",void 0),N(this,"_uintUid",void 0),N(this,"_users",[]),N(this,"_config",void 0),N(this,"_clientId",void 0),N(this,"_appId",void 0),N(this,"_sessionId",null),N(this,"_key",void 0),N(this,"_rtmConfig",{}),N(this,"_joinInfo",void 0),N(this,"_gateway",void 0),N(this,"_statsCollector",void 0),N(this,"_configDistribute",void 0),N(this,"_leaveMutex",void 0),N(this,"_publishMutex",void 0),N(this,"_renewTokenMutex",void 0),N(this,"_subscribeMutex",void 0),N(this,"_encryptionMode","none"),N(this,"_encryptionSecret",null),N(this,"_encryptionSalt",null),N(this,"_encryptDataStream",!1),N(this,"_encryptDataStreamKey",null),N(this,"_encryptDataStreamIv",null),N(this,"_proxyServer",void 0),N(this,"_turnServer",{servers:[],mode:"auto"}),N(this,"_cloudProxyServerMode","disabled"),N(this,"_isDualStreamEnabled",!1),N(this,"_defaultStreamFallbackType",void 0),N(this,"_lowStreamParameter",void 0),N(this,"_streamFallbackTypeCacheMap",new Map),N(this,"_remoteStreamTypeCacheMap",new Map),N(this,"_axiosCancelSource",Oi.CancelToken.source()),N(this,"_audioVolumeIndicationInterval",void 0),N(this,"_networkQualityInterval",void 0),N(this,"_userOfflineTimeout",void 0),N(this,"_streamRemovedTimeout",void 0),N(this,"_liveTranscodeStreamingClient",void 0),N(this,"_liveRawStreamingClient",void 0),N(this,"_channelMediaRelayClient",void 0),N(this,"_networkQualitySensitivity","normal"),N(this,"_p2pChannel",void 0),N(this,"_useLocalAccessPoint",!1),N(this,"_setLocalAPVersion",void 0),N(this,"_joinAndNotLeaveYet",!1),N(this,"_numberOfJoinCount",0),N(this,"_remoteDefaultVideoStreamType",void 0),N(this,"_inspect",void 0),N(this,"_moderation",void 0),N(this,"_license",void 0),N(this,"_pendingPublishedUsers",[]),N(this,"ntpAlignErrorCount",0),N(this,"remoteInboundOffset",0),N(this,"_handleLocalTrackEnable",(l,d,h)=>{this.publish(l,!1).then(d).catch(h)}),N(this,"_handleLocalTrackDisable",(l,d,h)=>{this.unpublish(l).then(d).catch(h)}),N(this,"_handleUserOnline",l=>{if(B("BLOCK_LOCAL_CLIENT")&&Pd(l.uid,this.channelName))return void T.debug("[".concat(l.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof l.uid&&T.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const d=this._users.find(h=>h.uid===l.uid);if(d)d._trust_in_room_=!0,d._is_pre_created&&(d._is_pre_created=!1,this.safeEmit(Je.USER_JOINED,d));else{const h=new xh(l.uid,l.uint_id||l.uid);this._users.push(h),T.debug("[".concat(this._clientId,"] user online"),l.uid),this.safeEmit(Je.USER_JOINED,h)}}),N(this,"_handleUserOffline",l=>{if(B("BLOCK_LOCAL_CLIENT")&&Pd(l.uid,this.channelName))return;const d=this._users.find(h=>h.uid===l.uid);d&&(this._handleRemoveStream(l),this._handleRemoveDataChannels(l),d._audio_pre_subscribed||d._video_pre_subscribed?d._is_pre_created=!0:Be(this._users,d),this._remoteStreamTypeCacheMap.delete(d.uid),this._streamFallbackTypeCacheMap.delete(d.uid),T.debug("[".concat(this._clientId,"] user offline"),l.uid,"reason:",l.reason),this.safeEmit(Je.USER_LEAVED,d,l.reason))}),N(this,"_handleAddAudioOrVideoStream",(l,d,h,f,m,g,v)=>{if(B("BLOCK_LOCAL_CLIENT")&&Pd(d,this.channelName))return;const y=this._users.find(C=>C.uid===d);if(!y)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(l)),this.store.subscribe(y.uid,l,void 0,void 0,void 0,Date.now());const b="audio"===l?y.hasAudio:y.hasVideo;y._uintid||(y._uintid=m||d),"audio"===l?y._trust_audio_stream_added_state_=!0:y._trust_video_stream_added_state_=!0,"audio"===l?(y._audio_added_=!0,void 0!==h&&(y._audioSSRC=h),void 0!==f&&(y._cname=f),g&&(y._audioOrtc=g)):(y._video_added_=!0,void 0!==h&&(y._videoSSRC=h),void 0!==f&&(y._cname=f),void 0!==v&&(y._rtxSsrcId=v),g&&(y._videoOrtc=g)),("audio"===l?y.hasAudio:y.hasVideo)&&!b&&(T.info("[".concat(this._clientId,"] remote user ").concat(y.uid," published ").concat(l)),this.safeEmit(Je.USER_PUBLISHED,y,l)),"video"===l?be.onGatewayStream(this._sessionId,Pr.ON_ADD_VIDEO_STREAM,sn.ON_ADD_VIDEO_STREAM,{peer:m||d,ssrc:y._videoSSRC}):be.onGatewayStream(this._sessionId,Pr.ON_ADD_AUDIO_STREAM,sn.ON_ADD_AUDIO_STREAM,{peer:m||d,ssrc:y._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(y,l,h).then(C=>{if(C&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(l," for user ").concat(y.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof vC))return this._p2pChannel.unsubscribe(y,l,!0).then(()=>this._subscribe(y,l,!0).catch(P=>{T.error("[".concat(this._clientId,"] resubscribe error"),P.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(y,l)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(l," for user ").concat(y.uid," after reconnect.")),this._subscribe(y,l,!0).catch(C=>{T.error("[".concat(this._clientId,"] resubscribe error"),C.toString())}))}),N(this,"_handleRemoveStream",l=>{if(B("BLOCK_LOCAL_CLIENT")&&Pd(l.uid,this.channelName))return;const d=this._users.find(f=>f.uid===l.uid);if(!d)return void T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));T.debug("[".concat(this._clientId,"] stream removed with uid ").concat(l.uid));let h=()=>{};d.hasAudio&&d.hasVideo?h=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(Je.USER_UNPUBLISHED,d,"audio"),T.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(Je.USER_UNPUBLISHED,d,"video")}:d.hasVideo?h=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(Je.USER_UNPUBLISHED,d,"video")}:d.hasAudio&&(h=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(Je.USER_UNPUBLISHED,d,"audio")}),d._video_pre_subscribed||d._audio_pre_subscribed||(d._trust_audio_stream_added_state_=!0,d._trust_video_stream_added_state_=!0,d._audio_added_=!1,d._video_added_=!1,this._p2pChannel instanceof vC&&this._p2pChannel.unsubscribe(d).then(f=>{if(f)return this._gateway.unsubscribe(f,d.uid)}),d._audioSSRC=void 0,d._videoSSRC=void 0,d._audioOrtc=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),be.onGatewayStream(this._sessionId,Pr.ON_REMOVE_STREAM,sn.ON_REMOVE_STREAM,{peer:l.uint_id||l.uid}),h()}),N(this,"_handleSetStreamLocalEnable",(l,d,h)=>{if(B("BLOCK_LOCAL_CLIENT")&&Pd(d,this.channelName))return;const f=this._users.find(v=>v.uid===d);if(!f)return void T.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));T.debug("[".concat(this._clientId,"] local ").concat(l," ").concat(h?"enabled":"disabled"," with uid ").concat(d));const m="audio"===l?f.hasAudio:f.hasVideo;if("audio"===l){f._trust_audio_enabled_state_=!0;const v=f._audio_enabled_;if(f._audio_enabled_=h,f._audio_enabled_===v)return;{const y=f._audio_enabled_?"enable-local-audio":"disable-local-audio";T.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(d,", msg: ").concat(y)),this.safeEmit(Je.USER_INFO_UPDATED,d,y)}}else{f._trust_video_enabled_state_=!0;const v=f._video_enabled_;if(f._video_enabled_=h,f._video_enabled_===v)return;{const y=f._video_enabled_?"enable-local-video":"disable-local-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(y)),this.safeEmit(Je.USER_INFO_UPDATED,d,y)}}const g="audio"===l?f.hasAudio:f.hasVideo;return m!==g?!m&&g?(T.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(l)),void this.safeEmit(Je.USER_PUBLISHED,f,l)):("video"===l&&f._videoTrack&&f._videoTrack._destroy(),this._p2pChannel.muteRemote(f,l),T.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(l)),void this.safeEmit(Je.USER_UNPUBLISHED,f,l)):void 0}),N(this,"_handleMuteStream",(l,d,h)=>{if(B("BLOCK_LOCAL_CLIENT")&&Pd(l,this.channelName))return;T.debug("[".concat(this._clientId,"] receive mute message"),l,d,h);const f=this._users.find(v=>v.uid===l);if(!f)return void T.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(l));const m="audio"===d?f.hasAudio:f.hasVideo;if("audio"===d){f._trust_audio_mute_state_=!0;const v=f._audio_muted_;if(f._audio_muted_=h,f._audio_muted_===v)return;{const y=f._audio_muted_?"mute-audio":"unmute-audio";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(y)),this.safeEmit(Je.USER_INFO_UPDATED,l,y)}}else{f._trust_video_mute_state_=!0;const v=f._video_muted_;if(f._video_muted_=h,f._video_muted_===v)return;{const y=f._video_muted_?"mute-video":"unmute-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(y)),this.safeEmit(Je.USER_INFO_UPDATED,l,y)}}const g="audio"===d?f.hasAudio:f.hasVideo;if(m!==g){if(!m&&g)return("audio"===d?f._audioSSRC:f._videoSSRC)?(T.info("[".concat(this._clientId,"] remote user ").concat(l," published ").concat(d)),void this.safeEmit(Je.USER_PUBLISHED,f,d)):void T.warning("[".concat(this._clientId,"] remote user ").concat(l," receive ").concat(d," unmute message  before add stream message, ").concat(d," SSRC doesn't exist yet."));"video"===d&&f._videoTrack&&!f._video_pre_subscribed&&f._videoTrack._destroy(),this._p2pChannel.muteRemote(f,d),T.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished ").concat(d)),this.safeEmit(Je.USER_UNPUBLISHED,f,d)}}),N(this,"_handleP2PLost",function(){var l=L(function*(d){T.debug("[".concat(o._clientId,"] receive p2p lost"),d),parseInt(d.p2pid,10)===o.store.p2pId?yield o._p2pChannel.requestReconnect():T.warning("[".concat(o._clientId,"] P2PLost stream not found"),d)});return function(d){return l.apply(this,arguments)}}()),N(this,"_handleTokenWillExpire",()=>{T.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Je.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),N(this,"_handleBeforeUnload",l=>{"beforeunload"===l.type&&void 0!==l.returnValue&&""!==l.returnValue||(this.leave(),T.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),N(this,"_handleUpdateNetworkQuality",()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(Je.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const l={downlinkNetworkQuality:0,uplinkNetworkQuality:0};l.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),l.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Je.NETWORK_QUALITY,l)}),N(this,"_handleP2PAddAudioOrVideoStream",(l,d,h,f)=>{const m=this._users.find(v=>v.uid===d);if(!m)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(l)),this.store.subscribe(m.uid,l,void 0,void 0,void 0,Date.now());const g="audio"===l?m.hasAudio:m.hasVideo;"audio"===l?m._trust_audio_stream_added_state_=!0:m._trust_video_stream_added_state_=!0,"audio"===l?(m._audio_added_=!0,void 0!==h&&(m._audioSSRC=h),void 0!==f&&(m._audioMid=f)):(m._video_added_=!0,void 0!==h&&(m._videoSSRC=h),void 0!==f&&(m._videoMid=f)),("audio"===l?m.hasAudio:m.hasVideo)&&!g&&(T.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published ").concat(l)),this.safeEmit(Je.USER_PUBLISHED,m,l)),this._p2pChannel.hasPendingRemoteMedia(m,l)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(l," for user ").concat(m.uid," after reconnect.")),this._subscribe(m,l,!0).catch(v=>{T.error("[".concat(this._clientId,"] resubscribe error"),v.toString())}))}),this._config=r,this._clientId=i||Ct(5,"client-"),this.store=new g4(r.codec,r.audioCodec,r.mode,this._clientId),this._leaveMutex=new Qr("client-leave",this._clientId),this._publishMutex=new Qr("client-publish",this._clientId),this._renewTokenMutex=new Qr("client-renewtoken",this._clientId),this._subscribeMutex=new Qr("client-subscribe",this._clientId),this.store.clientCreated(),r.proxyServer&&this.setProxyServer(r.proxyServer,!0),r.turnServer&&this.setTurnServer(r.turnServer,!0),T.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Ss," build: ").concat(AR,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),r.clientRoleOptions)try{p4(r.clientRoleOptions),a=Object.assign({},r.clientRoleOptions)}catch(l){T.warning("[".concat(this._clientId,"] ").concat(l.toString()))}this._statsCollector=new pC(this.store),this._statsCollector.onStatsException=(l,d,h)=>{T.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(l,", msg: ").concat(d,", uid: ").concat(h)),this.safeEmit(Je.EXCEPTION,{code:l,msg:d,uid:h})},this._statsCollector.onUploadPublishDuration=(l,d,h,f)=>{const m=this._users.find(g=>g.uid===l);m&&be.peerPublishStatus(this._sessionId,{subscribeElapse:f,audioPublishDuration:d,videoPublishDuration:h,peer:m._uintid})},this.store.useP2P="p2p"===r.mode,this._gateway=new oC(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:r.websocketRetryConfig||Nn,httpRetryConfig:r.httpRetryConfig||Nn,forceWaitGatewayResponse:void 0===r.forceWaitGatewayResponse||r.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:r.role,clientRoleOptions:a}),this._configDistribute=new wz(this._clientId),this.store.useP2P?(this._p2pChannel=new ds(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new vC(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}joinMeta(r,i,o,a,l){var d=arguments,h=this;return L(function*(){let f=!(d.length>5&&void 0!==d[5])||d[5],m=d.length>6&&void 0!==d[6]&&d[6];kt("JOIN_GATEWAY_USE_443PORT_ONLY",f),kt("JOIN_GATEWAY_USE_DUAL_DOMAIN",m);const g=h._gateway.signal.websocket;return g instanceof qR&&(g.use443PortOnly=f,g.tryDoubleDomain=m),(v=L(function*(y,b,C){S_.get(y)||S_.set(y,[]),aS.get(y)||aS.set(y,b),Ec.get(y)||Ec.set(y,0);const P=S_.get(y),R=aS.get(y);if(!P||!R)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Ec.get(y)===R){const j=Or();P.push(j),yield j.promise}Ec.set(y,Ec.get(y)+1);for(var A=arguments.length,O=new Array(A>3?A-3:0),M=3;M<A;M++)O[M-3]=arguments[M];const x=yield C(...O);return Ec.set(y,Ec.get(y)-1),Ec.get(y)===R-1&&P.length>0&&(P[0].resolve(),P.shift()),0===Ec.get(y)&&(S_.set(y,[]),aS.set(y,0),Ec.set(y,0)),x}),function(y,b,C){return v.apply(this,arguments)})("client.join",B("JOIN_MAX_CONCURRENCY"),h.join.bind(h),r,i,o,a,l);var v})()}join(r,i,o,a,l){var d=this;return L(function*(){const h=++d._numberOfJoinCount;d.store.joinStart(),a&&(d.store.uid=a);const f="HTTPS"===(Hi||Hi||(Hi=(window.location.protocol.split(":")[0]||"").toUpperCase(),Hi)),m=lL()?window.isSecureContext:"Browser Not Support";(!lL()&&!f||!window.isSecureContext)&&T.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),"DISCONNECTED"===d.connectionState&&(d.store.avoidJoinStart=Math.round(Date.now()),T.debug("[".concat(d._clientId,"] set avoidJoinStart to ").concat(d.store.avoidJoinStart))),be.setAppId(r);try{if(!o&&null!==o)throw new K(k.INVALID_PARAMS,"Invalid token: ".concat(o,". If you don not use token, set it to null"));o&&Nr(o,"token",1,2047),Nr(r,"appid",1,2047),bS(i),a&&SS(a),l&&Nr(l,"optionalInfo",1,2047)}catch(A){throw be.reportApiInvoke(Rf(),{name:Yn.JOIN,options:[r,i,o,a],states:{isHttps:f,isSecureContext:m},tag:st.TRACER}).onError(A),A}if(d._leaveMutex.isLocked&&(T.debug("[".concat(d._clientId,"] join: waiting leave operation")),(yield d._leaveMutex.lock())(),T.debug("[".concat(d._clientId,"] join: continue"))),d._joinAndNotLeaveYet=!0,"DISCONNECTED"!==d.connectionState){const A=new K(k.INVALID_OPERATION,"[".concat(d._clientId,"] Client already in connecting/connected state"));throw be.reportApiInvoke(Rf(),{name:Yn.JOIN,options:[r,i,o,a],states:{isHttps:f,isSecureContext:m},tag:st.TRACER}).onError(A),A}d._gateway.state="CONNECTING";const g=yield WD({appId:r,cname:i,uid:a,stringUid:"string"==typeof a?a:void 0,token:o||r,cloudProxyServer:d._cloudProxyServerMode});if(!d._joinAndNotLeaveYet)throw new K(k.INVALID_OPERATION,"[".concat(d._clientId,"] Client already left"));const v=g?.sid||Rf();T.info("[".concat(d._clientId,"] start join channel ").concat(i,", join number: ").concat(h)),d._sessionId||(d._sessionId=v,d.store.sessionId=d._sessionId);const y=be.reportApiInvoke(v,{id:d._clientId,name:Yn.JOIN,options:[r,i,o,a],states:{isHttps:f,isSecureContext:m},tag:st.TRACER}),b=Os(Os(Os({},d._rtmConfig),{},{clientId:d._clientId,appId:r,sid:d._sessionId,cname:i,uid:"string"!=typeof a?a:null,turnServer:d._turnServer,proxyServer:d._proxyServer,token:o||r,cloudProxyServer:d._cloudProxyServerMode,optionalInfo:l,license:d._license,useLocalAccessPoint:d._useLocalAccessPoint,preload:!!g},void 0!==d._remoteDefaultVideoStreamType&&{defaultVideoStream:d._remoteDefaultVideoStreamType}),{},{apRequestDetail:B("AP_REQUEST_DETAIL")||void 0});if(d._useLocalAccessPoint&&(b.setLocalAPVersion=d._setLocalAPVersion),"string"==typeof a&&(b.stringUid=a,d._uintUid?(b.uid=d._uintUid,d._uintUid=void 0):b.uid=0),"none"!==d._encryptionMode&&d._encryptionSecret){if(b.aesmode=d._encryptionMode,b.aespassword=yield(A=L(function*(O){const M=function(){const te=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),J=new Uint8Array(new ArrayBuffer(te.length));for(let X=0;X<te.length;X+=1)J[X]=te.charCodeAt(X);return J}(),x=yield window.crypto.subtle.importKey("spki",M,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),j=R_(O),W=yield window.crypto.subtle.encrypt({name:"RSA-OAEP"},x,j);return function(q){let te="";for(let J=0;J<q.length;J+=1)te+=String.fromCharCode(q[J]);return window.btoa(te)}(new Uint8Array(W))}),function(O){return A.apply(this,arguments)})(d._encryptionSecret),!d._joinAndNotLeaveYet)throw new K(k.INVALID_OPERATION,"[".concat(d._clientId,"] Client already left"));d._encryptionSalt&&(b.aessalt=d._encryptionSalt)}var A,M;if(d._encryptDataStream&&("aes-128-gcm2"===d._encryptionMode||"aes-256-gcm2"===d._encryptionMode))if(d._encryptionSalt&&d._encryptionSecret)if(window.crypto.subtle){const A=new TextEncoder,O=B("USE_PURE_ENCRYPTION_MASTER_KEY")?A.encode(b.appId+d._encryptionSecret+d._encryptionSecret):A.encode(b.appId+b.cname+d._encryptionSecret);d._encryptDataStreamIv=yield(M=L(function*(x,j,W){const q=yield window.crypto.subtle.importKey("raw",j,"PBKDF2",!1,["deriveBits","deriveKey"]),te="aes-128-gcm2"===x?128:256,J=yield window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:W},q,te+96);return new Uint8Array(J).subarray(te/8)}),function(x,j,W){return M.apply(this,arguments)})(d._encryptionMode,O,_l(d._encryptionSalt)),d._encryptDataStreamKey=yield function(){var M=L(function*(x,j,W){const q=yield window.crypto.subtle.importKey("raw",j,"PBKDF2",!1,["deriveBits","deriveKey"]),te="aes-128-gcm2"===x?128:256;return yield window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:W},q,{name:"AES-GCM",length:te},!0,["encrypt","decrypt"])});return function(x,j,W){return M.apply(this,arguments)}}()(d._encryptionMode,O,_l(d._encryptionSalt))}else T.warning("[".concat(d._clientId,m?"] encrypt datastream must be running in a secure context, fallback to plain data stream":"] current browser do not support WebCrypto ,fallback to plain data stream")),d._encryptDataStream=!1;else d._encryptDataStream=!1,T.debug("[".concat(d._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));d._startSession(d._sessionId,{channel:i,appId:r,stringUid:b.stringUid});const C=d._sessionId;setTimeout(()=>{"CONNECTING"===d.connectionState&&C===d._sessionId&&be.joinChannelTimeout(d._sessionId,5)},5e3);try{var P;let A;const O=b.cloudProxyServer;if(he(P=["proxy3","proxy4","proxy5"]).call(P,O)){const q=B("PROXY_SERVER_TYPE3");b.proxyServer=Array.isArray(q)?q[0]:q}if(be.setProxyServer(b.proxyServer),T.setProxyServer(b.proxyServer),d.store.requestAPStart(),g){if(T.debug("[".concat(d._clientId,"] get serverInfo Success from Preload Cache ").concat(b.stringUid?", ".concat(b.stringUid," => ").concat(g.intUid):""," ")),b.stringUid&&!b.uid&&(b.uid=g.intUid),A={gatewayInfo:g.ap.gatewayInfo},B("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&"auto"===b.turnServer.mode)if(0===g.ap.proxyInfo.addresses.length)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const q=(yield W_(g.ap.proxyInfo,g.ap.gatewayInfo.uid)).map(te=>({turnServerURL:te.address,tcpport:te.tcpport||Wr.tcpport,udpport:te.udpport||Wr.udpport,username:te.username||Wr.username,password:te.password||Wr.password,forceturn:!1,security:!0}));b.turnServer={mode:"manual",servers:q}}aF(g,b.stringUid)}else{if(b.stringUid&&!b.uid){let q;[q,A]=yield le.all([mD(b.stringUid,b,d._axiosCancelSource.token,d._config.httpRetryConfig||Nn,d.store),C2(b,d._axiosCancelSource.token,d._config.httpRetryConfig||Nn,!0,d.store)]),T.debug("[".concat(d._clientId,"] getUserAccount Success ").concat(b.stringUid," => ").concat(q)),b.uid=q,A.gatewayInfo.uid=q,A.gatewayInfo.res.uid=q}else A=yield C2(b,d._axiosCancelSource.token,d._config.httpRetryConfig||Nn,!0,d.store);if(!d._joinAndNotLeaveYet)throw new K(k.INVALID_OPERATION,"[".concat(d._clientId,"] Client already left"))}d.store.requestAPEnd(),setTimeout(()=>{d._configDistribute.startGetConfigDistribute(b,d._axiosCancelSource.token),d._configDistribute.on(IS.UPDATE_BITRATE_LIMIT,q=>{d._p2pChannel.updateBitrateLimit(q)})},0),d._key=o||r;const M=A.gatewayInfo,x=b.uid?b.uid:M.uid;d._joinInfo=Os(Os({},b),{},{cid:M.cid,uid:x,vid:M.vid,apResponse:M.res,apGatewayAddress:M.apGatewayAddress,uni_lbs_ip:M.uni_lbs_ip,gatewayAddrs:M.gatewayAddrs}),d.store.intUid=x;const j=yield d._joinGateway();if(!d._joinAndNotLeaveYet)throw new K(k.INVALID_OPERATION,"[".concat(d._clientId,"] Client already left"));y.onSuccess(j),d._appId=r,d._channelName=b.cname,d._uid=j,d.store.uid=j,setTimeout(()=>{d._networkQualityInterval&&window.clearInterval(d._networkQualityInterval),d._networkQualityInterval=window.setInterval(d._handleUpdateNetworkQuality,2e3),window.addEventListener($e()?"beforeunload":"pagehide",d._handleBeforeUnload),d._statsCollector.startUpdateStats()},0);const W=b.stringUid?"string uid: ".concat(b.stringUid,",uid: ").concat(b.uid):"uid: ".concat(d._uid);return T.info("[".concat(d._clientId,"] Joining channel success: channel: ").concat(i,",").concat(W)),setTimeout(()=>{T.startUpload()},5e3),d.store.joinEnd(),R=d,he(Nd).call(Nd,R)||Nd.push(R),"disabled"===d._cloudProxyServerMode&&ct().supportWebCrypto&&B("ENABLE_PRELOAD")&&KD(d._joinInfo),j}catch(A){const O=Array.isArray(A)?A[0]:A;throw O&&O.code===k.OPERATION_ABORTED?T.warning("[".concat(d._clientId,"] join number: ").concat(h,", Joining channel failed, rollback"),O):T.error("[".concat(d._clientId,"] join number: ").concat(h,", Joining channel failed, rollback"),O),O.code!==k.OPERATION_ABORTED&&d._numberOfJoinCount===h&&(d._gateway.state="DISCONNECTED",d._reset()),y.onError(O),O}var R})()}_joinGateway(){if(!this._joinInfo||!this._key)throw new K(k.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!B("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}leave(){var r=this;return L(function*(){T.info("[".concat(r._clientId,"] Leaving channel")),window.removeEventListener($e()?"beforeunload":"pagehide",r._handleBeforeUnload),r._reset(),function(o){const a=Nd.indexOf(o);-1!==a&&Nd.splice(a,1)}(r),r._statsCollector.stopUpdateStats();const i=yield r._leaveMutex.lock();if("DISCONNECTED"===r.connectionState)return T.info("[".concat(r._clientId,"] Leaving channel repeated, success")),void i();yield r._gateway.leave("CONNECTED"!==r.connectionState),T.info("[".concat(r._clientId,"] Leaving channel success")),r._joinAndNotLeaveYet=!1,r.store.resetJoinChannelServiceRecords(),i()})()}publish(r){var i=arguments,o=this;return L(function*(){let a=!(i.length>1&&void 0!==i[1])||i[1];if(!Array.isArray(r)){if(!(r instanceof Ih))return o._publishDataChannel(r);r=[r]}if(0===r.length)throw new K(k.INVALID_PARAMS,"param list is empty");const l=r;if("audience"===o._gateway.role)throw new K(k.INVALID_OPERATION,"audience can not publish stream");for(const h of l){if(!(h instanceof Ih))throw new K(k.INVALID_PARAMS,"parameter is not local track");if(!h._enabled&&a)throw new K(k.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(h.getTrackId()))}T.info("[".concat(o._clientId,"] Publishing tracks, id ").concat(l.map(h=>"".concat(h.getTrackId()," "))));const d=yield o._publishMutex.lock();yield o._configDistribute.awaitConfigDistributeComplete(),a&&l.forEach(h=>{const f=o._configDistribute.getBitrateLimit();h instanceof Ve&&f&&h.setBitrateLimit(f.uplink)});try{yield o._publishHighStream(l),T.info("[".concat(o._clientId,"] Publish success, id ").concat(l.map(h=>"".concat(h.getTrackId()," "))))}catch(h){throw T.error("[".concat(o._clientId,"] publish error"),h.toString()),h}finally{d()}})()}_publishDataChannel(r){var i=this;return L(function*(){Ft(r.id,"id",0,65535,!0),fl(r.ordered,"ordered"),Nr(r.metadata,"metadata",0,512),T.info("[".concat(i._clientId,"] Publishing datachannels, id ").concat(r.id));const o=yield i._publishMutex.lock();try{if(-1!==i._p2pChannel.getAllDataChannels().findIndex(d=>d.id===r.id))throw new K(k.INVALID_PARAMS,"Invalid id: ".concat(r.id,". If you want to republish the datachannel, unpublish first"));if(!i._joinInfo||void 0===i._uid)throw new K(k.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==i.connectionState&&"RECONNECTING"!==i.connectionState)throw new K(k.INVALID_OPERATION,"can not publish datachannel in ".concat(i.connectionState," state"));if("auto"===i._turnServer.mode&&B("FORCE_TURN")&&!B("TURN_ENABLE_TCP")&&!B("TURN_ENABLE_UDP"))throw new K(k.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const a=kH(d=r,!1),l=yield i._p2pChannel.publishDataChannel([a]);if(l.length>0){if("number"!=typeof a._originDataChannelId)throw T.error("[".concat(i._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new K(k.CREATE_DATACHANNEL_ERROR);try{yield le.all(l.map(d=>i._uid&&i._gateway.publishDataChannel(i._uid,d,!0))),yield a._waitTillOpen()}catch(d){if(d.code!==k.DISCONNECT_P2P)throw d}}return T.info("[".concat(i._clientId,"] Publish dataChannels success, id ").concat(a.id)),a}catch(a){throw T.error("[".concat(i._clientId,"] publish datachannels error"),a.toString()),a}finally{o()}var d})()}unpublish(r){var i=this;return L(function*(){if(!i._joinInfo||void 0===i._uid)throw new K(k.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let o=[];if(r)if(Array.isArray(r))o=r;else{if(!(r instanceof Ih))return i._unpublishDataChannel([r]);o=[r]}else i.store.useP2P||(yield i._unpublishDataChannel()),o=i._p2pChannel.getAllTracks(!0);T.info("[".concat(i._clientId,"] Unpublish tracks, tracks ").concat(o.map(l=>"".concat(l.getTrackId()," "))," "));const a=yield i._publishMutex.lock();try{if(i._p2pChannel instanceof ds){const l=yield i._p2pChannel.unpublish(o);l&&(yield i._gateway.sendExtensionMessage(Bn.UNPUBLISH,{unpubMsg:l},!0))}else{const l=yield i._p2pChannel.unpublish(o);l&&(yield i._gateway.unpublish(l,i._uid)),T.info("[".concat(i._clientId,"] Unpublish success,tracks ").concat(o.map(d=>"".concat(d.getTrackId()))))}}catch(l){throw T.error("[".concat(i._clientId,"] unpublish error"),l.toString()),l}finally{a&&a()}})()}_unpublishDataChannel(r){var i=this;return L(function*(){void 0!==r&&0!==r.length||(r=i._p2pChannel.getAllDataChannels()),T.info("[".concat(i._clientId,"] Unpublish datachannels, datachannels ").concat(r.map(a=>"".concat(a.id," "))," "));const o=yield i._publishMutex.lock();try{const a=yield i._p2pChannel.unpublishDataChannel(r);a&&(yield i._gateway.unpublishDataChannel(a)),T.info("[".concat(i._clientId,"] Unpublish dataChannel success,dataChannel ").concat(r.map(l=>"".concat(l.id))))}catch(a){throw T.error("[".concat(i._clientId,"] unpublish dataChannel error"),a.toString()),a}finally{o&&o()}})()}subscribe(r,i,o){var a=this;return L(function*(){if(!(r instanceof xh)){const l=a.remoteUsers.find(d=>d.uid===r);if(!l)throw new K(k.INVALID_REMOTE_USER,"user is not in the channel");r=l}return"datachannel"===i?a._subscribeDataChannel(r,o):a._subscribe(r,i)})()}presubscribe(r,i){var o=this;return L(function*(){if(pr(i,"mediaType",["audio","video"]),o._p2pChannel instanceof ds)throw new K(k.INVALID_OPERATION,"can't presub at p2p mode");if(!o._joinInfo)throw new K(k.INVALID_OPERATION,"can't presub when not join");if("CONNECTED"!==o.connectionState&&"RECONNECTING"!==o.connectionState)throw new K(k.INVALID_OPERATION,"can't presub in ".concat(o.connectionState," state"));const a=i===_e.AUDIO,l=i===_e.VIDEO,d=yield o._subscribeMutex.lock();try{const{ssrcId:h,ortc:f,rtxSsrcId:m,cname:g,uint_id:v}=yield o._gateway.presubscribe(r,i,!0);if(null==h)throw new K(k.UNEXPECTED_RESPONSE,"no ssrc id");let y=o._users.find(C=>C.uid===r);y||(y=new xh(r,v||r),y._is_pre_created=!0,o._users.push(y)),g&&(y._cname=g),y._uintid||(y._uintid=v||r),a&&(y._audioSSRC=h,y._audio_pre_subscribed=!0,f&&(y._audioOrtc=f)),l&&(y._videoSSRC=h,y._video_pre_subscribed=!0,f&&(y._videoOrtc=f),null!=m&&(y._rtxSsrcId=m)),T.info("[".concat(o._clientId,"] presub succeed ssrc: ").concat(h)),yield o._p2pChannel.subscribe(y,i,h,m,f);const b=a?y._audioTrack:y._videoTrack;if(!b)throw new K(k.UNEXPECTED_ERROR,"can not find remote track in user");return a&&(y._trust_audio_stream_added_state_=!0,y._audio_added_=!0),l&&(y._trust_video_stream_added_state_=!0,y._video_added_=!0),b}catch(h){throw T.error("[".concat(o._clientId,"] presub user ").concat(r," error"),h),h}finally{d()}})()}_subscribeDataChannel(r,i){var o=this;return L(function*(){var a;if(Ft(i,"channelId",0,65535,!0),!o._joinInfo)throw new K(k.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==o.connectionState&&"RECONNECTING"!==o.connectionState)throw new K(k.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(o.connectionState," state"));if(!o._users.find(m=>m===r))throw T.error("[".concat(o._clientId,"] can not subscribe ").concat(r.uid,", this user is not in the channel")),new K(k.INVALID_REMOTE_USER,"user is not in the channel");if(!r.hasAudio&&!r.hasVideo&&0===r._dataChannels.length)throw T.error("[".concat(o._clientId,"] can not subscribe ").concat(r.uid,", user is not published")),new K(k.INVALID_REMOTE_USER,"user is not published");const d=null===(a=r._dataChannels)||void 0===a?void 0:a.find(m=>m.id===i);if(!d)throw T.error("[".concat(o._clientId,"] can not subscribe ").concat(r.uid," with mediaType datachannel, remote datachannel is not published")),new K(k.REMOTE_USER_IS_NOT_PUBLISHED);const h=yield o._subscribeMutex.lock();T.info("[".concat(o._clientId,"] subscribe user ").concat(r.uid,", mediaType: datachannel"));try{const m=yield o._p2pChannel.subscribeDataChannel(r,[d]);if(m&&he(m).call(m,d.id))try{var f;if("number"!=typeof d._originDataChannelId)throw T.error("[".concat(o._clientId,"] can not subscribe ").concat(r.uid," with mediaType datachannel, cannot get RTCDatachannel")),new K(k.CREATE_DATACHANNEL_ERROR);const g={id:d.id,datachannelId:d._originDataChannelId,ordered:d.ordered,maxRetransmits:d.maxRetransmits,metadata:null!==(f=d.metadata)&&void 0!==f?f:""};yield o._gateway.subscribeDataChannel(r.uid,g,!0),yield d._waitTillOpen()}catch(g){if(g?.code!==k.WS_ABORT)throw yield o._p2pChannel.unsubscribeDataChannel(r,[d]),g;yield o._p2pChannel.unsubscribeDataChannel(r,[d]),o._p2pChannel.setPendingRemoteDataChannel(r,d.id)}return T.info("[".concat(o._clientId,"] subscribe success user ").concat(r.uid,", mediaType: datachannel")),d}finally{h()}})()}_p2pSubscribe(r,i,o){var a=this;return L(function*(){if(pr(i,"mediaType",["audio","video"]),!a._joinInfo)throw new K(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==a.connectionState&&"RECONNECTING"!==a.connectionState)throw new K(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(a.connectionState," state"));if(!a._users.find(h=>h===r)){const h=new K(k.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(a._clientId,"] can not subscribe ").concat(r.uid,", this user is not in the channel")),h}if(!r.hasAudio&&!r.hasVideo){const h=new K(k.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(a._clientId,"] can not subscribe ").concat(r.uid,", user is not published")),h}if(!o&&("audio"===i&&!r.hasAudio||"video"===i&&!r.hasVideo)){const h=new K(k.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(a._clientId,"] can not subscribe ").concat(r.uid," with mediaType ").concat(i,", remote track is not published")),h}const d=yield a._subscribeMutex.lock();T.info("[".concat(a._clientId,"] subscribe user ").concat(r.uid,", mediaType: ").concat(i));try{if(yield a._p2pChannel.hasRemoteMediaWithLock(r,i))yield a._p2pChannel.unmuteRemote(r,i);else try{const f="audio"===i?r._audioSSRC:r._videoSSRC,m="audio"===i?r._audioMid:r._videoMid;a.store.subscribe(r.uid,i,Date.now()),a._p2pChannel instanceof ds&&(yield a._p2pChannel.subscribe(r,i,f,m))}catch(f){throw f}T.info("[".concat(a._clientId,"] subscribe success user ").concat(r.uid,", mediaType: ").concat(i)),a._defaultStreamFallbackType&&a.setStreamFallbackOption(r.uid,a._defaultStreamFallbackType).catch(f=>{T.warning("[".concat(a._clientId,"] auto set fallback failed"),f)});const h="audio"===i?r._audioTrack:r._videoTrack;if(!h)throw new K(k.UNEXPECTED_ERROR,"can not find remote track in user object");return h}catch(h){throw T.error("[".concat(a._clientId,"] subscribe user ").concat(r.uid," error"),h),h}finally{d()}})()}_subscribe(r,i,o){var a=this;return L(function*(){if(a._p2pChannel instanceof ds)return a._p2pSubscribe(r,i);if(pr(i,"mediaType",["audio","video"]),!a._joinInfo)throw new K(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==a.connectionState&&"RECONNECTING"!==a.connectionState)throw new K(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(a.connectionState," state"));if(!a._users.find(v=>v===r)){const v=new K(k.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(a._clientId,"] can not subscribe ").concat(r.uid,", this user is not in the channel")),v}if(!r.hasAudio&&!r.hasVideo){const v=new K(k.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(a._clientId,"] can not subscribe ").concat(r.uid,", user is not published")),v}if(!(o||("audio"!==i||r.hasAudio&&void 0!==r._audioSSRC)&&("video"!==i||r.hasVideo&&void 0!==r._videoSSRC))){const v=new K(k.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(a._clientId,"] can not subscribe ").concat(r.uid," with mediaType ").concat(i,", remote track is not published")),v}let d="audio"===i?r._audioSSRC:r._videoSSRC,h="audio"===i?r._audioOrtc:r._videoOrtc,f="video"===i?r._rtxSsrcId:void 0,m={stream_type:"audio"===i?_e.AUDIO:_e.VIDEO,ssrcId:d};const g=yield a._subscribeMutex.lock();T.info("[".concat(a._clientId,"] subscribe user ").concat(r.uid,", mediaType: ").concat(i));try{if(yield a._p2pChannel.hasRemoteMediaWithLock(r,i))yield a._p2pChannel.unmuteRemote(r,i);else try{const y="audio"===i?r._audioSSRC:r._videoSSRC;void 0!==y&&y!==d&&(d=y,h="audio"===i?r._audioOrtc:r._videoOrtc,f="video"===i?r._rtxSsrcId:void 0,m={stream_type:"audio"===i?_e.AUDIO:_e.VIDEO,ssrcId:d}),ti.markSubscribeStart(a.store.clientId,d),a.store.subscribe(r.uid,i,Date.now()),yield a._p2pChannel.subscribe(r,i,d,f,h);try{a._p2pChannel.isPreSubScribe(d)||(yield a._gateway.subscribe(r.uid,m,!0))}catch(b){if(b?.code!==k.WS_ABORT)throw yield a._p2pChannel.unsubscribe(r,i),b;yield a._p2pChannel.unsubscribe(r,i,!0),a._p2pChannel.setPendingRemoteMedia(r,i)}a.store.subscribe(r.uid,i,void 0,Date.now()),a._p2pChannel.reportSubscribeEvent(!0,null,r,i)}catch(y){throw a._p2pChannel.reportSubscribeEvent(!1,y?.code,r,i),y}T.info("[".concat(a._clientId,"] subscribe success user ").concat(r.uid,", mediaType: ").concat(i)),a._defaultStreamFallbackType&&a.setStreamFallbackOption(r.uid,a._defaultStreamFallbackType).catch(y=>{T.warning("[".concat(a._clientId,"] auto set fallback failed"),y)});const v="audio"===i?r._audioTrack:r._videoTrack;if(!v)throw new K(k.UNEXPECTED_ERROR,"can not find remote track in user object");return v}catch(v){throw T.error("[".concat(a._clientId,"] subscribe user ").concat(r.uid," error"),v),v}finally{g()}})()}massSubscribe(r){var i=this;return L(function*(){if(ml(r,"subscribeList"),!i._joinInfo)throw new K(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==i.connectionState&&"RECONNECTING"!==i.connectionState)throw new K(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(i.connectionState," state"));const o=Date.now(),a=new Map,l=yield i._subscribeMutex.lock();T.info("[".concat(i._clientId,"]start massSubscribe user ").concat(r.map(m=>{let{user:g,mediaType:v}=m;return"user: ".concat(g?.uid,", mediaType: ").concat(v)}).join("; ")));const d=(r=[...r]).map(m=>{let{user:g,mediaType:v}=m;return{user:g,mediaType:v}}),h=yield i._p2pChannel.globalLock();try{var f;for(let g=r.length-1;g>=0;g--){const v=r[g],{user:y,mediaType:b}=v;if(pr(b,"mediaType",["audio","video"]),!y){const A=new K(k.INVALID_PARAMS,"user property does not exist in subscribeList item");throw T.error("[".concat(i._clientId,"] user property does not exist in subscribeList item")),A}if(!i._users.find(A=>A===y)){const A=new K(k.INVALID_REMOTE_USER,"user is not in the channel");T.error("[".concat(i._clientId,"] can not massSubscribe ").concat(y.uid,", this user is not in the channel")),d[g].error=A,r.splice(g,1);continue}if("audio"===b&&(!y.hasAudio||void 0===y._audioSSRC)||"video"===b&&(!y.hasVideo||void 0===y._videoSSRC)){const A=new K(k.REMOTE_USER_IS_NOT_PUBLISHED);T.error("[".concat(i._clientId,"] can not subscribe ").concat(y.uid," with mediaType ").concat(b,", remote user is not published")),d[g].error=A,r.splice(g,1);continue}const P=gr.Video|gr.LwoVideo,R=a.get(y);if(R){if("video"===b?R&P:R&gr.Audio){r.splice(g,1),T.warning("[".concat(i._clientId,"] repeat massSubscribe user:").concat(y.uid,", mediaType:").concat(b," twice"));continue}a.set(y,R|("video"===b?P:gr.Audio))}else a.set(y,"video"===b?P:gr.Audio)}for(let g=r.length-1;g>=0;g--){const v=r[g],{user:y,mediaType:b}=v,C=gr.Video|gr.LwoVideo;if(i._p2pChannel.hasRemoteMedia(y,b)){yield i._p2pChannel.unmuteRemoteNoLock(y,b);const P=a.get(y);a.set(y,"video"===b?P^C:P^gr.Audio),r.splice(g,1)}}i.store.massSubscribe(r.map(g=>({userId:g.user.uid,type:g.mediaType})),o);let m=Ue(f=Array.from(a.entries())).call(f,(g,v)=>{let[y,b]=v;if(0===b)return g;const C={stream_id:y.uid,stream_type:b};return b&gr.Audio&&(C.audio_ssrc=y._audioSSRC),b&gr.Video&&(C.video_ssrc=y._videoSSRC),g.push(C),g},[]);try{r.length>0&&(yield i._p2pChannel.massSubscribeNoLock(r.map(v=>{let{user:y,mediaType:b}=v;return{user:y,mediaType:b,ssrcId:b===_e.VIDEO?y._videoSSRC:y._audioSSRC,rtxSsrcId:b===_e.VIDEO?y._rtxSsrcId:void 0}})));const g=new Map;if(m=m.filter(v=>v.video_ssrc&&!i._p2pChannel.isPreSubScribe(v.video_ssrc)||v.audio_ssrc&&!i._p2pChannel.isPreSubScribe(v.audio_ssrc)||!v.video_ssrc&&!v.audio_ssrc),m.length>0){const v=yield i._gateway.subscribeAll(m,!0);(v?.users||[]).forEach(y=>{let{stream_id:b,video_error_code:C,audio_error_code:P,error_code:R}=y;(C||P||R)&&g.set(b,{video_error_code:C,audio_error_code:P,error_code:R})})}if(Array.from(g.entries()).length>0){const v=[];Array.from(g.entries()).forEach(y=>{let[b,C]=y;const P=i.remoteUsers.find(R=>R.uid===b);if(P){let R;C.error_code||C.video_error_code&&C.audio_error_code?R=void 0:C.video_error_code?R=_e.VIDEO:C.audio_error_code&&(R=_e.AUDIO),v.push({user:P,mediaType:R})}}),v.length>0&&(yield i._p2pChannel.massUnsubscribeNoLock(v))}for(const v of d){const y=g.get(v.user.uid);if(y){const b=y.error_code||"audio"===v.mediaType&&y.audio_error_code||"video"===v.mediaType&&y.video_error_code;if(b){const C=Mf(b);T.error("user:".concat(v.user.uid," mediaType:").concat(v.mediaType," has massSubscribe error ").concat(C.desc)),v.error=new K(k.SUBSCRIBE_FAILED,"code ".concat(b,": ").concat(C.desc))}}v.error||(v.track="video"===v.mediaType?v.user.videoTrack:v.user.audioTrack)}return i.store.massSubscribe(d.filter(v=>!v.error).map(v=>({userId:v.user.uid,type:v.mediaType})),void 0,Date.now()),d.forEach(v=>{var y;be.subscribe(i.store.sessionId,{succ:!!v.error,ec:(null===(y=v.error)||void 0===y?void 0:y.code)||null,video:v.mediaType===_e.VIDEO,audio:v.mediaType===_e.AUDIO,peerid:v.user.uid,subscribeRequestid:v.mediaType===_e.VIDEO?v.user._videoSSRC:v.user._audioSSRC,p2pid:i.store.p2pId,eventElapse:Math.floor(performance.now()-o),preSsrc:i._p2pChannel.isPreSubScribe(v.user._videoSSRC)},!0)}),T.info("[".concat(i._clientId,"] massSubscribe success ").concat(r.map(v=>{let{user:y,mediaType:b}=v;return"user: ".concat(y?.uid,", mediaType: ").concat(b)}).join("; "))),d}catch(g){throw yield i._p2pChannel.massUnsubscribeNoLock(r),g}}finally{h(),l()}})()}unsubscribe(r,i,o){var a=this;return L(function*(){if(!(r instanceof xh)){const h=a.remoteUsers.find(f=>f.uid===r);if(!h)throw new K(k.INVALID_REMOTE_USER,"user is not in the channel");r=h}if(i||a.store.useP2P){if("datachannel"===i)return a._unsubscribeDataChannel(r,o)}else yield a._unsubscribeDataChannel(r,o);if(i&&pr(i,"mediaType",["audio","video"]),!a._joinInfo)throw new K(k.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!a._users.find(h=>h===r)){const h=new K(k.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(a._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),h}T.info("[".concat(a._clientId,"] unsubscribe uid: ").concat(r.uid,", mediaType: ").concat(i));const d=yield a._subscribeMutex.lock();try{if(a._p2pChannel instanceof ds)yield a._p2pChannel.unsubscribe(r,i);else{const h=yield a._p2pChannel.unsubscribe(r,i);h&&(yield a._gateway.unsubscribe(h,r.uid)),i&&"audio"!==i||(r._audio_pre_subscribed=!1),i&&"video"!==i||(r._video_pre_subscribed=!1),r._is_pre_created&&Be(a._users,r),T.info("[".concat(a._clientId,"] unsubscribe success uid: ").concat(r.uid,", mediaType: ").concat(i))}}catch(h){if(h.code===k.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(a._clientId,"] unsubscribe user ").concat(r.uid," error"),h.toString()),h}finally{d()}})()}_unsubscribeDataChannel(r,i){var o=this;return L(function*(){if(i&&Ft(i,"id",0,65535,!0),!o._joinInfo)throw new K(k.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!o._users.find(d=>d===r)){const d=new K(k.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(o._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),d}let l;if("number"==typeof i){const d=r._dataChannels.find(h=>h.id===i);d&&(l=[d])}else l=r._dataChannels;if(void 0===l){const d=new K(k.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(o._clientId,"] can not unsubscribe ").concat(r.uid," with channelId ").concat(i,", remote datachannel is not published")),d}T.info("[".concat(o._clientId,"] unsubscribe uid: ").concat(r.uid,", mediaType: datachannel, ids: ").concat(l.map(d=>d.id)));try{const d=yield o._p2pChannel.unsubscribeDataChannel(r,l);d&&(yield o._gateway.unsubscribeDataChannel(d,r.uid)),T.info("[".concat(o._clientId,"] unsubscribe datachannel success uid: ").concat(r.uid,", mediaType: datachannel, ids: ").concat(d))}catch(d){if(d.code===k.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(o._clientId,"] unsubscribe user ").concat(r.uid," error"),d.toString()),d}})()}massUnsubscribe(r){var i=this;return L(function*(){if(ml(r,"unsubscribeList"),!i._joinInfo)throw new K(k.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");T.info("[".concat(i._clientId,"] start massUnsubscribe ").concat(r.map(a=>{let{user:l,mediaType:d}=a;return"user: ".concat(l?.uid,", mediaType: ").concat(d,";")}).join())),r=[...r];const o=new Map;for(let a=r.length-1;a>=0;a--){const{user:l,mediaType:d}=r[a];if(!l){const m=new K(k.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw T.error("[".concat(i._clientId,"] user property does not exist in unsubscribeList item")),m}if(pr(d,"mediaType",["video","audio",void 0]),!i._users.find(m=>m===l)){T.warning("[".concat(i._clientId,"] can not unsubscribe ").concat(l.uid,", user is not in the channel")),r.splice(a,1);continue}const f=gr.Video|gr.LwoVideo;if(o.has(l)){const m=o.get(l);let g;switch(d){case"video":g=m&f;break;case"audio":g=m&gr.Audio;break;default:g=m&(gr.Audio|f)}if(g){T.warning("[".concat(i._clientId,"] repeat massUnsubscribe user:").concat(l.uid,",mediaType:").concat(d," twice.")),r.splice(a,1);continue}d?"audio"===d?o.set(l,m|gr.Audio):"video"===d&&o.set(l,m|f):o.set(l,m|gr.Audio|f)}else d?"audio"===d?o.set(l,gr.Audio):"video"===d&&o.set(l,f):o.set(l,gr.Audio|f)}try{const a=yield i._p2pChannel.massUnsubscribe(r);a&&(yield i._gateway.massUnsubscribe(a)),T.info("[".concat(i._clientId,"] massUnsubscribe success ").concat(r.map(l=>{let{user:d,mediaType:h}=l;return"user: ".concat(d?.uid,", mediaType: ").concat(h,";")}).join()))}catch(a){if(a.code===k.DISCONNECT_P2P)return void T.warning("[".concat(i._clientId,"] disconnecting p2p, abort unsubscribe request."));throw T.error("[".concat(i._clientId,"] massUnsubscribe error"),a.toString()),a}})()}setLowStreamParameter(r){var i=this;return L(function*(){(function(a){if(!a)throw new Y(k.INVALID_PARAMS);pn(a.width)||_R(a.width,"streamParameter.width"),pn(a.height)||_R(a.height,"streamParameter.height"),pn(a.framerate)||_R(a.framerate,"streamParameter.framerate"),pn(a.bitrate)||Ft(a.bitrate,"streamParameter.bitrate")})(r),(!r.width&&r.height||r.width&&!r.height)&&T.warning("[".concat(i._clientId,"] The width and height parameters take effect only when both are set")),T.info("[".concat(i._clientId,"] set low stream parameter to"),JSON.stringify(r));const o=i._configDistribute.getLowStreamConfigDistribute();if(o&&o.bitrate&&r.bitrate&&o.bitrate<r.bitrate&&(r.bitrate=o.bitrate),i._lowStreamParameter=r,i._isDualStreamEnabled)return i._p2pChannel.updateVideoStreamParameter(r,ee.LocalVideoLowTrack)})()}enableDualStream(){var r=this;return L(function*(){if(!ct().supportDualStream)throw be.streamSwitch(r._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new K(k.NOT_SUPPORTED,"Your browser is not support dual stream");if(r._isDualStreamEnabled)throw new K(k.INVALID_OPERATION,"Dual stream is already enabled");if(r._p2pChannel.canPublishLowStream())try{yield r._publishLowStream()}catch(i){throw be.streamSwitch(r._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),i}r._isDualStreamEnabled=!0,be.streamSwitch(r._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),T.info("[".concat(r._clientId,"] enable dual stream"))})()}disableDualStream(){var r=this;return L(function*(){if(r._isDualStreamEnabled){if(!r._joinInfo)throw new K(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(r._p2pChannel.getLocalMedia(ee.LocalVideoLowTrack))try{const i=yield r._p2pChannel.unpublishLowStream();i&&(yield r._gateway.unpublish(i,r._joinInfo.stringUid||r._joinInfo.uid))}catch(i){throw be.streamSwitch(r._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),i}r._isDualStreamEnabled=!1,be.streamSwitch(r._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),T.info("[".concat(r._clientId,"] disable dual stream"))}})()}setClientRole(r,i){var o=this;return L(function*(){if(pr(r,"role",["audience","host"]),i&&p4(i),"rtc"===o.mode||"p2p"===o.mode)throw T.warning("[".concat(o._clientId,"]").concat(o.mode," mode can not use setClientRole")),new K(k.INVALID_OPERATION,"".concat(o.mode," mode can not use setClientRole"));if(i&&i.level&&"host"===r)throw new K(k.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===r&&o._p2pChannel.hasLocalMedia())throw new K(k.INVALID_OPERATION,"can not set client role to audience when publishing stream");yield o._gateway.setClientRole(r,i),o._config.role=r,T.info("[".concat(o._clientId,"] set client role to ").concat(r,", level: ").concat(i&&i.level))})()}getRemoteInboundOffset(){var r;const i=null===(r=this._p2pChannel.getStats())||void 0===r?void 0:r.audioSend[0];if(!i||!i.timestamp)return 0;const o=i.timestamp-Date.now();return Math.abs(o)>1e3+i.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?o:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(r,i){if(Nr(r,"proxyServer"),!i){if("DISCONNECTED"!==this.connectionState)throw new K(k.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new K(k.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=r,be.setProxyServer(this._proxyServer),T.setProxyServer(this._proxyServer),T.info("[".concat(this._clientId,"] Set proxy server ").concat(i?"by initialize call":""," success."))}setTurnServer(r,i){if(Array.isArray(r)||(r=[r]),!i){if("DISCONNECTED"!==this.connectionState)throw new K(k.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new K(k.INVALID_OPERATION,"You have already set the proxy")}if(pS(r))return this._turnServer={servers:r,mode:"original-manual"},void T.info("[".concat(this._clientId,"] Set original turnserver ").concat(i?"by initialize call":""," success: ").concat(r.map(o=>o.urls).join(","),"."));r.forEach(o=>bR(o)),this._turnServer={servers:r,mode:"manual"},T.info("[".concat(this._clientId,"] Set turnserver ").concat(i?"by initialize call":""," success."))}setLicense(r){if("DISCONNECTED"!==this.connectionState)throw new K(k.INVALID_OPERATION,"you should set license before join channel");if(Nr(r,"license",32,32),!/^[A-Za-z\d]+$/.test(r))throw new K(k.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=r,T.info("[".concat(this._clientId,"] set license success"),r)}startProxyServer(r){if("DISCONNECTED"!==this.connectionState)throw new K(k.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new K(k.INVALID_OPERATION,"You have already set the proxy");const i=[3,4,5];let o;switch(void 0===r&&(r=3),r){case 1:case 2:throw new K(k.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:o="proxy3";break;case 4:o="proxy4";break;case 5:o="proxy5";break;default:throw new K(k.INVALID_PARAMS,"proxy server mode must be ".concat(i.join("|")))}this._cloudProxyServerMode=o,this.store.cloudProxyServerMode=o,T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new K(k.INVALID_OPERATION,"Stop proxy server after leave channel");be.setProxyServer(),T.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(r){if(!r.accessPoints)throw new K(k.INVALID_PARAMS,"accessPoints is required.");ml(r.accessPoints.serverList,"accessPoints.serverList"),Nr(r.accessPoints.domain,"accessPoints.domain");const i=(b,C)=>{Ft(b,C,0,65535,!0)};let o=443;if(r.accessPoints.port&&(i(r.accessPoints.port,"accessPoints.port"),o=r.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new K(k.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");B("CLOSE_AFB_FOR_LOCAL_AP")&&(kt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),kt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const a=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,l=r.accessPoints.domain,d=r.accessPoints.serverList.map(b=>a.test(b)?"".concat(b.replace(/\./g,"-"),".").concat(l):b),h=d.map(b=>"".concat(b,":").concat(o));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,kt("WEBCS_DOMAIN",h),kt("WEBCS_DOMAIN_BACKUP_LIST",h),kt("GATEWAY_DOMAINS",[l]),r.report&&r.report.hostname&&Array.isArray(r.report.hostname)&&r.report.hostname.length?(ml(r.report.hostname,"report.hostname"),kt("EVENT_REPORT_DOMAIN",r.report.hostname[0]),kt("EVENT_REPORT_BACKUP_DOMAIN",r.report.hostname[1]||r.report.hostname[0])):(kt("EVENT_REPORT_DOMAIN",d[0]),kt("EVENT_REPORT_BACKUP_DOMAIN",d[1]||d[0]));let f=6443;r.report&&r.report.port&&(i(r.report.port,"report.port"),f=r.report.port),kt("STATS_COLLECTOR_PORT",f),kt("ENABLE_EVENT_REPORT",!!r.report);let m="";r.log&&r.log.hostname&&Array.isArray(r.log.hostname)&&r.log.hostname.length?(ml(r.log.hostname,"log.hostname"),m=r.log.hostname[0]):m=d[0];let g=6444;r.log&&r.log.port&&(i(r.log.port,"log.port"),g=r.log.port),kt("LOG_UPLOAD_SERVER","".concat(m,":").concat(g));let v=[];r.cds&&r.cds.hostname&&Array.isArray(r.cds.hostname)&&r.cds.hostname.length?(ml(r.cds.hostname,"cds.hostname"),v=r.cds.hostname):v=d;let y=443;r.cds&&r.cds.port&&(i(r.cds.port,"cds.port"),y=r.cds.port),kt("CDS_AP",v.map(b=>"".concat(b,":").concat(y))),kt("ENABLE_CONFIG_DISTRIBUTE",!!r.cds),T.info("set local access point v2 success")}setLocalAccessPoints(r,i){if(ml(r,"serverList"),Nr(i,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new K(k.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const o=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;r=r.map(a=>o.test(a)?"".concat(a.replace(/\./g,"-"),".").concat(i):a),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,kt("WEBCS_DOMAIN",r),kt("WEBCS_DOMAIN_BACKUP_LIST",r),kt("GATEWAY_DOMAINS",[i]),kt("EVENT_REPORT_DOMAIN",r[0]),kt("EVENT_REPORT_BACKUP_DOMAIN",r[1]||r[0]),kt("LOG_UPLOAD_SERVER","".concat(r[0],":6444")),T.info("[".concat(this._clientId,"] set local access point success"))}setRemoteDefaultVideoStreamType(r){var i=this;return L(function*(){if(pr(r,"streamType",[0,1,4,5,6,7,8,9]),i._remoteDefaultVideoStreamType=r,i._joinInfo)try{yield i._gateway.setDefaultRemoteVideoStreamType(r),i._joinInfo.defaultVideoStream=i._remoteDefaultVideoStreamType}catch(o){throw T.error("[".concat(i._clientId,"] set default remote video stream type error"),o.toString()),o}else T.debug("[".concat(i._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(r))})()}setRemoteVideoStreamType(r,i){var o=this;return L(function*(){pr(i,"streamType",[0,1,4,5,6,7,8,9]);try{yield o._gateway.setRemoteVideoStreamType(r,i),setTimeout(()=>{const a=o._users.find(l=>l.uid===r);a&&a.videoTrack&&a.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(a){throw T.error("[".concat(o._clientId,"] set remote video stream type error"),a.toString()),a}T.info("[".concat(o._clientId,"] set remote ").concat(r," video stream type to ").concat(i)),o._remoteStreamTypeCacheMap.set(r,i)})()}setStreamFallbackOption(r,i){var o=this;return L(function*(){pr(i,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{yield o._gateway.setStreamFallbackOption(r,i)}catch(a){throw T.error("[".concat(o._clientId,"] set stream fallback option"),a.toString()),a}T.info("[".concat(o._clientId,"] set remote ").concat(r," stream fallback type to ").concat(i)),o._streamFallbackTypeCacheMap.set(r,i)})()}setEncryptionConfig(r,i,o,a){pr(r,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"]),Nr(i,"secret");const l=["aes-128-gcm2","aes-256-gcm2"];if(he(l).call(l,r)){if(!o||!(o instanceof Uint8Array&&32===o.length))throw new K(k.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(o)throw new K(k.INVALID_PARAMS,"current encrypt mode does not need salt");if(a){if(fl(a,"encryptDataStream"),!he(l).call(l,r))throw new K(k.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(i)||T.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=r,this._encryptionSecret=i,o&&(this._encryptionSalt=vl(o))}renewToken(r){var i=this;return L(function*(){if(Nr(r,"token",1,2047),!i._key||!i._joinInfo)throw new K(k.INVALID_OPERATION,"renewToken should not be called before user join");const o=i._key;i._key=r,i._joinInfo&&(i._joinInfo.token=r);const a=yield i._renewTokenMutex.lock();try{if(B("USE_NEW_TOKEN")){T.debug("[".concat(i._clientId,"] start renew token with ticket from unilbs"));const l=yield function ED(r,i,o){return yD.apply(this,arguments)}(i._joinInfo,i._axiosCancelSource.token,i._config.httpRetryConfig||Nn);T.debug("[".concat(i._clientId,"] get ticket from unilbs success")),yield i._gateway.renewToken({token:r,ticket:l})}else T.debug("[".concat(i._clientId,"] start renew token without ticket")),yield i._gateway.renewToken({token:r});T.debug("[".concat(i._clientId,"] renewToken success"))}catch(l){throw i._key=o,i._joinInfo.token=o,T.error("[".concat(i._clientId,"] renewToken failed"),l.toString()),l}finally{a()}})()}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?T.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const r=this._p2pChannel.getAudioLevels();this.safeEmit(Je.VOLUME_INDICATOR,r)},B("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const r=this._statsCollector.getRTCStats(),i=this._gateway.getInChannelInfo();return r.Duration=Math.round(i.duration/1e3),r}startLiveStreaming(r,i){var o=this;return L(function*(){if(!i){if("h264"!==o.codec)throw new K(k.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!o._p2pChannel.hasLocalMedia())throw new K(k.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(o._liveRawStreamingClient&&o._liveRawStreamingClient.hasUrl(r)||o._liveTranscodeStreamingClient&&o._liveTranscodeStreamingClient.hasUrl(r))throw new K(k.LIVE_STREAMING_TASK_CONFLICT);const a=i?Na.TRANSCODE:Na.RAW;return o._createLiveStreamingClient(a).startLiveStreamingTask(r,a)})()}setLiveTranscoding(r){return this._createLiveStreamingClient(Na.TRANSCODE).setTranscodingConfig(r)}stopLiveStreaming(r){var i=this;return L(function*(){const o=[i._liveRawStreamingClient,i._liveTranscodeStreamingClient].filter(a=>a&&a.hasUrl(r));if(!o.length)throw new K(k.INVALID_PARAMS,"can not find live streaming url to stop");yield le.all(o.map(a=>a&&a.stopLiveStreamingTask(r)))})()}startChannelMediaRelay(r){var i=this;return L(function*(){J2(r),yield i._createChannelMediaRelayClient().startChannelMediaRelay(r)})()}updateChannelMediaRelay(r){var i=this;return L(function*(){J2(r),yield i._createChannelMediaRelayClient().updateChannelMediaRelay(r)})()}stopChannelMediaRelay(){var r=this;return L(function*(){yield r._createChannelMediaRelayClient().stopChannelMediaRelay(),r._statsCollector.onStatsChanged&&(r._statsCollector.onStatsChanged=void 0)})()}sendStreamMessage(r){var i=arguments,o=this;return L(function*(){var a;let l=!(i.length>1&&void 0!==i[1])||i[1];if(!o._joinInfo)throw new K(k.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof r||r instanceof Uint8Array)&&(r={payload:r}),"string"==typeof r.payload){const h=new TextEncoder;r.payload=h.encode(r.payload)}let d=!1;if(o._encryptDataStream&&o._encryptDataStreamIv&&o._encryptDataStreamKey&&window.crypto.subtle&&he(a=["aes-128-gcm2","aes-256-gcm2"]).call(a,o._encryptionMode)&&(d=!0,r.payload=yield(h=L(function*(f,m,g){var v;const y=Ue(v=Array.from(g)).call(v,(M,x)=>M+x,0),b={serverTs:0,seq:_S++,length:g.length,checkSum:y},C=new Uint8Array(CR(y,2)),P=new ArrayBuffer(10),R=new DataView(P);R.setUint32(0,b.serverTs),R.setUint16(4,b.seq),R.setUint16(6,b.length),R.setUint16(8,b.checkSum),g=sL(g,new Uint8Array(16-g.length%16));const O=yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:f,tagLength:128,additionalData:C},m,g);return sL(new Uint8Array(P),new Uint8Array(O))}),function(f,m,g){return h.apply(this,arguments)})(o._encryptDataStreamIv,o._encryptDataStreamKey,r.payload)),new Blob([r.payload]).size>1024)throw new K(k.INVALID_PARAMS,d?"encrypted stream message out of range.":"stream message out of range.");var h;return o._gateway.signal.request(Pe.DATA_STREAM,{payload:vl(r.payload),syncWithAudio:r.syncWithAudio,sendTs:Date.now()-Dz},!l)})()}sendMetadata(r){if(!this._joinInfo)throw new K(k.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([r]).size>1024)throw new K(k.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Pe.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:vl(r)})}sendCustomReportMessage(r){var i=this;return L(function*(){if(Array.isArray(r)||(r=[r]),r.forEach(y4),!i._joinInfo)throw new K(k.INVALID_OPERATION,"can not send custom report, not joined");yield be.sendCustomReportMessage(i._joinInfo.sid,r)})()}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}pickSVCLayer(r,i){var o=this;return L(function*(){pr(i.spatialLayer,"spatialLayer",[0,1,2,3]),pr(i.temporalLayer,"temporalLayer",[0,1,2,3]);try{yield o._gateway.pickSVCLayer(r,i)}catch(a){throw T.error("[".concat(o._clientId,"] pick SVC layer failed"),a.toString()),a}})()}setRTMConfig(r){var i=this;return L(function*(){const{apRTM:o=!1,rtmFlag:a}=r;if(fl(o,"apRTM"),Ft(a,"rtmFlag",0),i._rtmConfig.apRTM=o,i._rtmConfig.rtmFlag=a,T.debug("[".concat(i._clientId,"] setRTMconfig ").concat(JSON.stringify(r)," in ").concat(i.connectionState," state")),("CONNECTED"===i.connectionState||"RECONNECTING"===i.connectionState)&&i._joinInfo)return i._joinInfo.apRTM=o,i._joinInfo.rtmFlag=a,i._gateway.setRTM2Flag(a)})()}_reset(){if(T.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Oi.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&sF(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&be.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(r=>{r._audioTrack&&r._audioTrack._destroy(),r._videoTrack&&r._videoTrack._destroy(),r._dataChannels&&(r._dataChannels.forEach(i=>i._close()),r._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Qr("client-publish",this._clientId),this._subscribeMutex=new Qr("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(r,i){var o;const a=r||Rf();T.debug(r?"[".concat(this._clientId,"] new Session ").concat(a):"[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(a));const l=r?"":this._sessionId||"";this._sessionId=a,this.store.sessionId=a,be.addSid(a);const d={lts:(new Date).getTime(),mode:this.mode,buildFormat:1,stringUid:i?.stringUid||(null===(o=this._joinInfo)||void 0===o?void 0:o.stringUid),channelProfile:"live"===this.mode?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:l,clientRole:"audience"===this.role?2:1};be.sessionInit(this._sessionId,Os({cname:i.channel,appid:i.appId},d)),this._joinInfo&&(this._joinInfo.sid=a),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=a)}_publishHighStream(r){var i=this;return L(function*(){if(!i._joinInfo||void 0===i._uid)throw new K(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==i.connectionState&&"RECONNECTING"!==i.connectionState)throw new K(k.INVALID_OPERATION,"can not publish stream in ".concat(i.connectionState," state"));if("auto"===i._turnServer.mode&&B("FORCE_TURN")&&!B("TURN_ENABLE_TCP")&&!B("TURN_ENABLE_UDP"))throw new K(k.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");T.debug("[".concat(i._clientId,"] publish high stream"));try{const a=yield i._p2pChannel.publish(r,i._isDualStreamEnabled,i._lowStreamParameter);if(i._p2pChannel instanceof ds){const l=(yield a.next()).value;if(l){try{yield i._gateway.sendExtensionMessage(Bn.PUBLISH,l,!0)}catch(d){throw a.throw(d),d}yield a.next()}i._p2pChannel.reportPublishEvent(!0,null)}else{const l=(yield a.next()).value;if(l){var o;let d;try{d=yield i._gateway.publish(i._uid,l,!0)}catch(h){if(h.code!==k.DISCONNECT_P2P)throw a.throw(h),h}yield a.next((null===(o=d)||void 0===o?void 0:o.ortc)||[])}i._p2pChannel.reportPublishEvent(!0,null);for(const d of r)d instanceof Ve&&d._encoderConfig&&i._gateway.setVideoProfile(d._encoderConfig),!d.muted&&d.enabled||(yield i._p2pChannel.muteLocalTrack(d))}}catch(a){if(i._p2pChannel.reportPublishEvent(!1,a?.code,r),a?.code===k.WS_ABORT)return;throw a}})()}_publishLowStream(){var r=this;return L(function*(){if(!r._joinInfo||void 0===r._uid)throw new K(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new K(k.INVALID_OPERATION,"can not publish stream in ".concat(r.connectionState," state"));T.debug("[".concat(r._clientId,"] publish low stream"));const i=r._configDistribute.getLowStreamConfigDistribute();i&&i.bitrate&&(r._lowStreamParameter||(r._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),r._lowStreamParameter&&r._lowStreamParameter.bitrate&&i.bitrate<r._lowStreamParameter.bitrate&&(r._lowStreamParameter.bitrate=i.bitrate));try{const a=yield r._p2pChannel.publishLowStream(r._lowStreamParameter),l=(yield a.next()).value;if(l){var o;let d;try{d=yield r._gateway.publish(r._uid,l,!0)}catch(h){if(h.code!==k.DISCONNECT_P2P)throw a.throw(h),h}a.next((null===(o=d)||void 0===o?void 0:o.ortc)||[]),r._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(a){if(r._p2pChannel.reportPublishEvent(!1,a?.code,void 0,!0),a?.code===k.WS_ABORT)return;throw a}})()}_createLiveStreamingClient(r){const i=()=>{if(!this._joinInfo||!this._appId)return new K(k.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const o=(a={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},yC("LiveStreaming").create(a));var a;return o.onLiveStreamError=(l,d)=>{be.reportApiInvoke(this._sessionId,{name:Yn.ON_LIVE_STREAM_ERROR,options:[l,d],tag:st.TRACER}).onSuccess(),this.safeEmit(Je.LIVE_STREAMING_ERROR,l,d)},o.onLiveStreamWarning=(l,d)=>{be.reportApiInvoke(this._sessionId,{name:Yn.ON_LIVE_STREAM_WARNING,options:[l,d],tag:st.TRACER}).onSuccess(),this.safeEmit(Je.LIVE_STREAMING_WARNING,l,d)},o.on(wS.REQUEST_WORKER_MANAGER_LIST,(l,d,h)=>{if(!this._joinInfo)return h(new K(k.INVALID_OPERATION,"can not find join info to get worker manager"));var f;(f=L(function*(m,g,v,y){const b=B("UAP_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(C=>g.proxyServer?"https://".concat(g.proxyServer,"/ap/?url=").concat(C+"/api/v1?action=uap"):"https://".concat(C,"/api/v1?action=uap"));return yield function E2(r,i,o,a,l){Sv+=1;const d={sid:o.sid,command:"convergeAllocateEdge",uid:"666",appId:o.appId,ts:Math.floor(Date.now()/1e3),seq:Sv,requestId:Sv,version:Ss,cname:o.cname},h={service_name:i,json_body:JSON.stringify(d)};let f,m,g=r[0];return rs(L(function*(){f=Date.now();const v=yield ta(g,{data:h,cancelToken:a,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(m=Date.now()-f,0!==v.code){const C=new K(k.UNEXPECTED_RESPONSE,"live streaming ap error, code"+v.code,{retry:!0,responseTime:m});throw T.error(C.toString()),C}const y=JSON.parse(v.json_body);if(200!==y.code){const C=new K(k.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(y.code,", reason: ").concat(y.reason),{code:y.code,responseTime:m});throw T.error(C.toString()),C}if(!y.servers||0===y.servers.length){const C=new K(k.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:y.code,responseTime:m});throw T.error(C.toString()),C}const b=(P=i,{addressList:(C=y).servers.map(R=>"wss://".concat(R.address.replace(/\./g,"-"),".").concat(B("WORKER_DOMAIN"),":").concat(R.wss,"?serviceName=").concat(encodeURIComponent(P))),workerToken:C.workerToken,vid:C.vid});var C,P;return B("LIVE_STREAMING_ADDRESS")&&(b.addressList=B("LIVE_STREAMING_ADDRESS")instanceof Array?B("LIVE_STREAMING_ADDRESS"):[B("LIVE_STREAMING_ADDRESS")]),aC(aC({},b),{},{responseTime:m})}),(v,y)=>(be.apworkerEvent(o.sid,{success:!0,sc:200,serviceName:i,responseDetail:JSON.stringify(v.addressList),firstSuccess:0===y,responseTime:m,serverIp:r[y%r.length]}),!1),(v,y)=>(be.apworkerEvent(o.sid,{success:!1,sc:v.data&&v.data.code||200,serviceName:i,responseTime:m,serverIp:r[y%r.length]}),!!(v.code!==k.OPERATION_ABORTED&&v.code!==k.UNEXPECTED_RESPONSE||v.data&&v.data.retry)&&(g=r[(y+1)%r.length],!0)),l)}(b,m,g,v,y)}),function(m,g,v,y){return f.apply(this,arguments)})(l,this._joinInfo,this._axiosCancelSource.token,Nn).then(d).catch(h)}),o};return r===Na.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||i(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||i(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new K(k.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:i,sendResolutionHeight:o}=this.getLocalVideoStats(),a=(r={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:i,height:o}},yC("ChannelMediaRelay").create(r));a.on("state",l=>{l===lo.RELAY_STATE_FAILURE&&a&&a.dispose(),this.safeEmit(Je.CHANNEL_MEDIA_RELAY_STATE,l)}),a.on("event",l=>{this.safeEmit(Je.CHANNEL_MEDIA_RELAY_EVENT,l)}),this._channelMediaRelayClient=a,this._statsCollector.onStatsChanged=(l,d)=>{var h;"resolution"===l&&(null===(h=this._channelMediaRelayClient)||void 0===h||h.setVideoProfile(d))}}var r;return this._channelMediaRelayClient}_handleUpdateDataChannel(r,i){const{added:o,deleted:a}=r,l=[];if(i){const d=[];this._users.forEach(h=>{h._dataChannels.forEach(f=>{o.every(m=>m.uid!==h._uintid||m.stream_id!==f.id)&&d.push({uid:h._uintid,stream_id:f.id,ordered:f.ordered,max_retrans_times:f.maxRetransmits,metadata:f.metadata})})}),d.length>0&&this._handleUpdateDataChannel({added:[],deleted:d})}Array.isArray(o)&&o.length>0&&o.forEach(d=>{const{uid:h,stream_id:f,ordered:m,max_retrans_times:g,metadata:v}=d,y=this._users.find(b=>b._uintid===h);if(y){if(T.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),he(l).call(l,y)||l.push(y),y._uintid||(y._uintid=h),-1===y._dataChannels.findIndex(b=>b.id===d.stream_id)){const b={id:f,ordered:!!m,maxRetransmits:g,metadata:v},C=kH(b,!0);y._dataChannels.push(C),T.info("[".concat(this._clientId,"] remote user ").concat(y.uid," published datachannel")),i||this.safeEmit(Je.USER_PUBLISHED,y,"datachannel",b)}this._p2pChannel.hasPendingRemoteDataChannel(y,d.stream_id)&&(T.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(y.uid," after reconnect.")),this._subscribeDataChannel(y,d.stream_id).catch(b=>{T.error("[".concat(this._clientId,"] resubscribe datachannel error"),b.toString())}))}else T.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))}),i&&(this.safeEmit(Je.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(a)&&a.length>0&&a.forEach(d=>{const{uid:h}=d,m=this._users.find(v=>v._uintid===h);if(!m)return void T.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const g=m._dataChannels.find(v=>v.id===d.stream_id);g&&(T.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(m,[g]).then(v=>{if(m._dataChannels=m._dataChannels.filter(y=>y!==g),v)return this._gateway.unsubscribeDataChannel(v,m.uid)}),T.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(g.id)),this.safeEmit(Je.USER_UNPUBLISHED,m,"datachannel",g._config))})}_handleRemoveDataChannels(r){const i=this._users.find(o=>o.uid===r.uid);if(i){if(void 0!==i._dataChannels&&i._dataChannels.length>0){T.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(r.uid));const o=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished datachannel")),i._dataChannels.forEach(a=>{this.safeEmit(Je.USER_UNPUBLISHED,i,"datachannel",a._config)})};this._p2pChannel.unsubscribeDataChannel(i,i._dataChannels).then(a=>{if(a)return this._gateway.unsubscribeDataChannel(a,i.uid)}),o()}}else T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){var r=this;this._gateway.on(mr.DISCONNECT_P2P,L(function*(){yield r._p2pChannel.disconnectForReconnect()})),this._gateway.on(mr.CONNECTION_STATE_CHANGE,(i,o,a)=>{var l;if(a===Rt.FALLBACK)return;const d=()=>{this.safeEmit(Je.CONNECTION_STATE_CHANGE,i,o,a)};if(be.reportApiInvoke(this._sessionId||(null===(l=this._gateway.joinInfo)||void 0===l?void 0:l.sid)||null,{name:Yn.CONNECTION_STATE_CHANGE,options:[i,o,a],tag:st.TRACER}).onSuccess(JSON.stringify({cur:i,prev:o,reason:a})),T.info("[".concat(this._clientId,"] signal connection state change: ").concat(o," -> ").concat(i)),"DISCONNECTED"===i)return this._reset(),void d();if("RECONNECTING"===i)this._users.forEach(f=>{f._trust_in_room_=!1,f._trust_audio_enabled_state_=!1,f._trust_video_enabled_state_=!1,f._trust_audio_mute_state_=!1,f._trust_video_mute_state_=!1,f._trust_audio_stream_added_state_=!1,f._trust_video_stream_added_state_=!1,f._is_pre_created||(f._audio_pre_subscribed||(f._audioSSRC=void 0,f._audioOrtc=void 0),f._video_pre_subscribed||(f._videoSSRC=void 0,f._videoOrtc=void 0,f._rtxSsrcId=void 0),f._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===i){var h;this._streamFallbackTypeCacheMap.forEach((f,m)=>{this._gateway.setStreamFallbackOption(m,f).catch(g=>{T.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),g)})}),this._remoteStreamTypeCacheMap.forEach((f,m)=>{this._gateway.setRemoteVideoStreamType(m,f).catch(g=>{T.warning("[".concat(this._clientId,"] auto set remote stream type failed"),g)})}),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(h=this._joinInfo)||void 0===h?void 0:h.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{T.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(f=>{T.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(f))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter(f=>!f._trust_in_room_).forEach(f=>{T.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(f.uid)),this._handleUserOffline({uid:f.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach(f=>{f._trust_audio_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(f.uid)),this._handleMuteStream(f.uid,_e.AUDIO,!1)),f._trust_video_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(f.uid)),this._handleMuteStream(f.uid,_e.VIDEO,!1)),f._trust_audio_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(f.uid)),this._handleSetStreamLocalEnable("audio",f.uid,!0)),f._trust_video_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(f.uid)),this._handleSetStreamLocalEnable("video",f.uid,!0)),f._trust_video_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(f.uid)),this._handleResetAddStream(f,"video")),f._trust_audio_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(f.uid)),this._handleResetAddStream(f,"audio")),f._video_added_||f._audio_added_||(T.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(f.uid)),this._handleRemoveStream({uid:f.uid,uint_id:f._uintid}))}))},1e3))}d()}),this._gateway.on(mr.REQUEST_NEW_GATEWAY_LIST,function(){var i=L(function*(o,a){if(!r._joinInfo)return a(new K(k.UNEXPECTED_ERROR,"can not recover, no join info"));try{let l;const d=yield WD(Os(Os({},r._joinInfo),{},{uid:r._joinInfo.uid,stringUid:void 0}));d?(l=d.ap,aF(d),r._joinInfo.preload=!0):(l=yield fD(r._joinInfo,r._axiosCancelSource.token,r._config.httpRetryConfig||Nn,r.store),r._joinInfo.preload=!1),r._joinInfo&&(r._joinInfo.apResponse=l.gatewayInfo.res,r._joinInfo.gatewayAddrs=l.gatewayInfo.gatewayAddrs,r._joinInfo.uni_lbs_ip=l.gatewayInfo.uni_lbs_ip);const h=[];l.gatewayInfo.gatewayAddrs.forEach(f=>{let{address:m}=f;const[g,v]=m.split(":");h.push(r._joinInfo&&r._joinInfo.proxyServer?{proxy:r._joinInfo.proxyServer,host:g,port:v}:{host:g,port:v})}),o(h)}catch(l){a(l)}});return function(o,a){return i.apply(this,arguments)}}()),this._gateway.on(mr.NETWORK_QUALITY,i=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(Je.NETWORK_QUALITY,i)}),this._gateway.on(mr.STREAM_TYPE_CHANGE,(i,o)=>{this.safeEmit(Je.STREAM_TYPE_CHANGED,i,o),be.reportApiInvoke(this._sessionId,{name:Yn.STREAM_TYPE_CHANGE,options:[i,o],tag:st.TRACER}).onSuccess(JSON.stringify({uid:i,streamType:o}))}),this._gateway.on(mr.IS_P2P_DISCONNECTED,i=>{this._p2pChannel.isP2PDisconnected()?i(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?i(!1):i(!0)}),this._gateway.on(mr.REQUEST_P2P_CONNECTION_PARAMS,function(){var i=L(function*(o,a,l){try{let d=yield r._p2pChannel.getEstablishParams();B("ENABLE_PREALLOC_PC")&&d||(d=yield r._p2pChannel.startP2PConnection(o)),a(d)}catch(d){l(d)}});return function(o,a,l){return i.apply(this,arguments)}}()),this._gateway.on(mr.JOIN_RESPONSE,(i,o)=>{if(this.store.useP2P)return;let a;i.attributes?a=i.attributes.userAttributes.preSubSsrcs:T.debug("no attributes in joinResponse");const l=As(i.ortc,o,a);this._p2pChannel.connect(l)}),this._gateway.on(mr.PRE_CONNECT_PC,function(){var i=L(function*(o){const{candidates:a,fingerprint:l}=o;if(r._joinInfo&&a.length>0&&!r._p2pChannel.isPlanB){var d;yield r._p2pChannel.startP2PConnection({turnServer:r._joinInfo.turnServer});const{cert:h,cid:f}=r._joinInfo.apResponse;yield r._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(f,"_").concat(h),icePwd:"".concat(f,"_").concat(h)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(d=B("FINGERPRINT"))&&void 0!==d?d:l}]},candidates:a,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}});return function(o){return i.apply(this,arguments)}}())}_handleGatewaySignalEvents(){var r=this;this._gateway.signal.on(qe.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(qe.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(qe.ON_ADD_AUDIO_STREAM,i=>this._handleAddAudioOrVideoStream("audio",i.uid,i.ssrcId,i.cname,i.uint_id,i.ortc)),this._gateway.signal.on(qe.ON_ADD_VIDEO_STREAM,i=>this._handleAddAudioOrVideoStream("video",i.uid,i.ssrcId,i.cname,i.uint_id,i.ortc,i.rtxSsrcId)),this._gateway.signal.on(qe.ON_REMOTE_DATASTREAM_UPDATE,i=>{this._handleUpdateDataChannel(i)}),this._gateway.signal.on(qe.ON_REMOTE_FULL_DATASTREAM_INFO,i=>{this._handleUpdateDataChannel({added:i.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(qe.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(qe.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(qe.MUTE_AUDIO,i=>this._handleMuteStream(i.uid,_e.AUDIO,!0)),this._gateway.signal.on(qe.UNMUTE_AUDIO,i=>this._handleMuteStream(i.uid,_e.AUDIO,!1)),this._gateway.signal.on(qe.MUTE_VIDEO,i=>this._handleMuteStream(i.uid,_e.VIDEO,!0)),this._gateway.signal.on(qe.UNMUTE_VIDEO,i=>this._handleMuteStream(i.uid,_e.VIDEO,!1)),this._gateway.signal.on(qe.RECEIVE_METADATA,i=>{const o=_l(i.metadata);this.safeEmit(Je.RECEIVE_METADATA,i.uid,o)}),this._gateway.signal.on(qe.ON_DATA_STREAM,function(){var i=L(function*(o){var a;if(!o)return;let l=_l(o.payload);if(r._encryptDataStream&&r._encryptDataStreamIv&&r._encryptDataStreamKey&&window.crypto.subtle&&he(a=["aes-128-gcm2","aes-256-gcm2"]).call(a,r._encryptionMode)){if(o.payload.length<10)throw new K(k.UNEXPECTED_RESPONSE,"payload length ".concat(o.payload.length," is less than header length ").concat(10));l=yield(f=L(function*(m,g,v){const y=v.subarray(0,10),b=y.slice(8,10),C=(b[0]<<8)+b[1],P=(y[6]<<8)+y[7],R=yield window.crypto.subtle.decrypt({name:"AES-GCM",iv:m,tagLength:128,additionalData:new Uint8Array(CR(C,2))},g,v.subarray(10));return new Uint8Array(R).subarray(0,P)}),function(m,g,v){return f.apply(this,arguments)})(r._encryptDataStreamIv,r._encryptDataStreamKey,l)}var f;let d=0;if(o.ordered||o.syncWithAudio){const h=r._p2pChannel.getStats(),f=r.remoteUsers.find(g=>g.uid===o.uid),m=h?.audioRecv.find(g=>g.ssrc===f?._audioSSRC);d=m?.jitterBufferMs}null==d&&(d=0),function SC(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;if(!r.syncWithAudio)return jD(o,{uid:r.uid,payload:r.payload});const a="".concat(o.id,"-").concat(r.uid),l=nF.get(a)||[],d=l.findIndex(g=>r.sendTs>=g.sendTs),h=xH(xH({},r),{},{context:o,mediaDelay:i,recvTs:Date.now()});-1===d?l.push(h):l.splice(d,0,h),nF.set(a,l);let f=!1;var m;BD.has(a)?f=!(null===(m=BD.get(a))||void 0===m||!m.isSyncing):BD.set(a,{isSyncing:f,firstRecvTs:0,firstSendTs:0}),f||bC(a)}(Os(Os({},o),{},{payload:l}),d,{id:r._clientId,onStreamMessage:"function"==typeof r.onStreamMessage?r.onStreamMessage.bind(r):void 0,safeEmit:r.safeEmit.bind(r)})});return function(o){return i.apply(this,arguments)}}()),this._gateway.signal.on(qe.ON_CRYPT_ERROR,()=>{yc(()=>{T.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Je.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(qe.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(qe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{T.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Rt.TOKEN_EXPIRE),this.safeEmit(Je.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(qe.ON_STREAM_FALLBACK_UPDATE,i=>{T.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(i.stream_id,", attr: ").concat(i.stream_type)),this.safeEmit(Je.STREAM_FALLBACK,i.stream_id,1===i.stream_type?"fallback":"recover")}),this._gateway.signal.on(qe.ON_PUBLISH_STREAM,i=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:i.proxy})),T.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(i))))}),this._gateway.signal.on(qe.ENABLE_LOCAL_VIDEO,i=>{this._handleSetStreamLocalEnable("video",i.uid,!0)}),this._gateway.signal.on(qe.DISABLE_LOCAL_VIDEO,i=>{this._handleSetStreamLocalEnable("video",i.uid,!1)}),this._gateway.signal.on(Me.REQUEST_TIMEOUT,(i,o)=>{if(this._joinInfo)switch(i){case Pe.PUBLISH:{if(!o)return;const d=o.ortc;if(d){var a,l;const h=d.some(g=>{let{stream_type:v}=g;return v===at.Audio}),f=d.some(g=>{let{stream_type:v}=g;return v!==at.Audio}),m=d.some(g=>{let{stream_type:v}=g;return v===at.Screen||v===at.ScreenLow});"offer"===o.state&&be.publish(this._joinInfo.sid,{eventElapse:ti.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:k.TIMEOUT,audio:h,video:f,p2pid:o.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:h?null===(a=d.find(g=>{let{stream_type:v}=g;return v===at.Audio}))||void 0===a||null===(a=a.ssrcs[0])||void 0===a?void 0:a.ssrcId.toString():void 0,videoName:f?null===(l=d.find(g=>{let{stream_type:v}=g;return v!==at.Audio}))||void 0===l||null===(l=l.ssrcs[0])||void 0===l?void 0:l.ssrcId.toString():void 0})}break}case Pe.SUBSCRIBE:o&&be.subscribe(this._joinInfo.sid,{succ:!1,ec:k.TIMEOUT,audio:o.stream_type===_e.AUDIO,video:o.stream_type===_e.VIDEO,peerid:o.stream_id,subscribeRequestid:o.ssrcId,p2pid:this.store.p2pId,eventElapse:ti.measureFromSubscribeStart(this.store.clientId,o.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(o.ssrcId)})}}),this._gateway.signal.on(qe.ON_P2P_OK,i=>{}),this._gateway.signal.on(qe.ON_PUBLISHED_USER_LIST,i=>{if(null==i||!i.users)return;B("BLOCK_LOCAL_CLIENT")&&(i.users=i.users.filter(l=>!Pd(l.string_id||l.stream_id,this.channelName)));const o=[],a=[];for(const l of i.users){let d=this._users.find(y=>y._uintid===l.stream_id);d?d._trust_in_room_=!0:(d=new xh(l.string_id||l.stream_id,l.stream_id),this._users.push(d),0===this.getListeners(Je.PUBLISHED_USER_LIST).length&&(T.debug("[".concat(this._clientId,"] user online"),l.stream_id),this.safeEmit(Je.USER_JOINED,d)));const h=gr.Audio&l.stream_type,f=(gr.Video|gr.LwoVideo)&l.stream_type,m=!!(65280&l.stream_type),g=h&&d.hasAudio,v=f&&d.hasVideo;f&&(d._trust_video_stream_added_state_=!0,d._video_added_=!0,d._videoSSRC=l.video_ssrc,d._rtxSsrcId=l.video_rtx),h&&(d._trust_audio_stream_added_state_=!0,d._audio_added_=!0,d._audioSSRC=l.audio_ssrc),h&&!g&&0===this.getListeners(Je.PUBLISHED_USER_LIST).length&&(T.info("[".concat(this._clientId,"] remote user ").concat(d.uid," published audio")),this.safeEmit(Je.USER_PUBLISHED,d,"audio")),f&&!v&&0===this.getListeners(Je.PUBLISHED_USER_LIST).length&&(T.info("[".concat(this._clientId,"] remote user ").concat(d.uid," published video")),this.safeEmit(Je.USER_PUBLISHED,d,"video")),(h&&!g||f&&!v||m)&&o.push(d),f&&this._p2pChannel.hasPendingRemoteMedia(d,"video")&&a.push({user:d,mediaType:"video"}),h&&this._p2pChannel.hasPendingRemoteMedia(d,"audio")&&a.push({user:d,mediaType:"audio"})}a.length>0&&(T.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(a.map(l=>"user: ".concat(l.user.uid,", mediaType: ").concat(l.mediaType)).join("; ")," ")),this.massSubscribe(a).catch(l=>{T.error("[".concat(this._clientId,"] mass resubscribe error"),l.toString())})),this.getListeners(Je.PUBLISHED_USER_LIST).length>0?B("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=o:(T.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(o.map(l=>l.uid).join(", "))),this.safeEmit(Je.PUBLISHED_USER_LIST,o)):T.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(o.map(l=>l.uid).join(", ")))}),this._gateway.signal.on(qe.ON_RTP_CAPABILITY_CHANGE,i=>{const{video_codec:o}=i;this._p2pChannel instanceof vC&&this._p2pChannel.updateRemoteRTPCapabilities(o.map(a=>a.toLowerCase()).filter(a=>{var l;return he(l=Object.keys(DR)).call(l,a)}))})}_handleP2PEvents(){var r=this;this._gateway.signal.on(qe.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Bn.PUBLISH,(i,o,a)=>{const{uid:l}=i;i.forEach(d=>{const{kind:h,ssrcs:f,mid:m,isMuted:g}=d;this._handleP2PAddAudioOrVideoStream(h,l,f[0].ssrcId,m);const v=this._users.find(y=>y.uid===l);return v&&this._p2pChannel instanceof ds?this._p2pChannel.mockSubscribe(v,h,f[0].ssrcId,m).then(()=>{o()}).catch(a):o(),this._handleMuteStream(l,h,!!g)})}),this._gateway.signal.on(Bn.CALL,function(){var i=L(function*(o,a,l){if(r._p2pChannel instanceof ds)try{var d;a(yield r._p2pChannel.startP2P({turnServer:null===(d=r._joinInfo)||void 0===d?void 0:d.turnServer},o))}catch(h){l(h)}});return function(o,a,l){return i.apply(this,arguments)}}()),this._gateway.signal.on(Me.P2P_CONNECTION,function(){var i=L(function*(o){r._p2pChannel instanceof ds&&(yield r._p2pChannel.p2pConnect(o))});return function(o){return i.apply(this,arguments)}}()),this._gateway.signal.on(Bn.UNPUBLISH,function(){var i=L(function*(o,a,l){if(r._p2pChannel instanceof ds){const{unpubMsg:d,uid:h}=o,f=r._users.find(m=>m.uid===h);if(!f)return T.warning("[".concat(r._clientId,"] can not find remote user, ignore mute event, uid: ").concat(h)),void a();try{d.forEach(function(){var m=L(function*(g){let{stream_type:v}=g;const y=v===at.Audio?_e.AUDIO:_e.VIDEO;yield r._p2pChannel.unsubscribe(f,y),r._handleMuteStream(h,y,!0)});return function(g){return m.apply(this,arguments)}}()),a()}catch(m){l(m)}}});return function(o,a,l){return i.apply(this,arguments)}}()),this._gateway.signal.on(Bn.CONTROL,function(){var i=L(function*(o,a){const{action:l}=o;switch(l){case kd.MUTE_LOCAL_VIDEO:r._handleMuteStream(a,_e.VIDEO,!0);break;case kd.MUTE_LOCAL_AUDIO:r._handleMuteStream(a,_e.AUDIO,!0);break;case kd.UNMUTE_LOCAL_VIDEO:r._handleP2PAddAudioOrVideoStream("video",a),r._handleMuteStream(a,_e.VIDEO,!1);break;case kd.UNMUTE_LOCAL_AUDIO:r._handleP2PAddAudioOrVideoStream("audio",a),r._handleMuteStream(a,_e.AUDIO,!1)}});return function(o,a){return i.apply(this,arguments)}}()),this._gateway.signal.on(Bn.RESTART_ICE,function(){var i=L(function*(o,a,l){if(r._p2pChannel instanceof ds)try{const{direction:d,iceParameter:h}=o;d!==Ni.SEND_ONLY||h?a(yield r._p2pChannel.restartICE(d,h)):(r._p2pChannel.handleDisconnect(d),a())}catch(d){l(d)}});return function(o,a,l){return i.apply(this,arguments)}}()),this._gateway.signal.on(Bn.CANDIDATE,i=>{if(this._p2pChannel instanceof ds){const{candidate:o,direction:a}=i;this._p2pChannel.addRemoteCandidate(o,a)}}),this._p2pChannel.on(De.RequestP2PRestartICE,function(){var i=L(function*(o,a,l){try{const{direction:d}=o;a(yield r._gateway.sendExtensionMessage(Bn.RESTART_ICE,o,d===Ni.SEND_ONLY))}catch(d){l(d)}});return function(o,a,l){return i.apply(this,arguments)}}()),this._p2pChannel.on(De.LocalCandidate,i=>{this._gateway.sendExtensionMessage(Bn.CANDIDATE,JSON.stringify(i),!0)}),this._p2pChannel.on(De.RequestP2PMuteLocal,function(){var i=L(function*(o,a,l){try{yield r._gateway.sendExtensionMessage(Bn.CONTROL,o,!0),a()}catch(d){l(d)}});return function(o,a,l){return i.apply(this,arguments)}}()),this._p2pChannel.on(De.RequestP2PUnmuteRemote,function(){var i=L(function*(o,a,l){if(r._joinInfo)try{yield r._gateway.unmuteRemote(o,r._joinInfo.stringUid||r._joinInfo.uid),a()}catch(d){d.code===k.DISCONNECT_P2P?a():l(d)}else a()});return function(o,a,l){return i.apply(this,arguments)}}()),this._p2pChannel.on(De.RequestP2PMuteRemote,function(){var i=L(function*(o,a,l){if(r._joinInfo)try{yield r._gateway.muteRemote(o,r._joinInfo.stringUid||r._joinInfo.uid),a()}catch(d){d.code===k.DISCONNECT_P2P?a():l(d)}else a()});return function(o,a,l){return i.apply(this,arguments)}}()),this._p2pChannel.on(De.StateChange,(i,o)=>{o===Dt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){var r=this;this._p2pChannel.on(De.RequestMuteLocal,function(){var i=L(function*(o,a,l){if(r._joinInfo)try{yield r._gateway.muteLocal(o,r._joinInfo.stringUid||r._joinInfo.uid),a()}catch(d){d.code===k.DISCONNECT_P2P?a():l(d)}else a()});return function(o,a,l){return i.apply(this,arguments)}}()),this._p2pChannel.on(De.RequestUnmuteLocal,function(){var i=L(function*(o,a,l){if(r._joinInfo)try{yield r._gateway.unmuteLocal(o,r._joinInfo.stringUid||r._joinInfo.uid),a()}catch(d){d.code===k.DISCONNECT_P2P?a():l(d)}else a()});return function(o,a,l){return i.apply(this,arguments)}}()),this._p2pChannel.on(De.RequestRePublish,(i,o,a)=>{this.publish(i,!1).then(o).catch(a)}),this._p2pChannel.on(De.RequestRePublishDataChannel,(i,o,a)=>{le.all(i.map(function(){var l=L(function*(d){const h=yield r._p2pChannel.publishDataChannel([d]);try{h.forEach(f=>{r._uid&&r._gateway.publishDataChannel(r._uid,f,!0)})}catch(f){if(f.code!==k.DISCONNECT_P2P)throw f}});return function(d){return l.apply(this,arguments)}}())).then(o).catch(a)}),this._p2pChannel.on(De.RequestReSubscribe,function(){var i=L(function*(o,a,l){try{for(const{user:d,kind:h}of o)h===_e.VIDEO?yield r.subscribe(d,"video"):yield r.subscribe(d,"audio");a()}catch(d){l(d)}});return function(o,a,l){return i.apply(this,arguments)}}()),this._p2pChannel.on(De.RequestUpload,(i,o)=>{this._gateway.upload(i,o)}),this._p2pChannel.on(De.RequestUploadStats,i=>{this._gateway.uploadWRTCStats(i)}),this._p2pChannel.on(De.MediaReconnectStart,i=>{this.safeEmit(Je.MEDIA_RECONNECT_START,i)}),this._p2pChannel.on(De.MediaReconnectEnd,i=>{this.safeEmit(Je.MEDIA_RECONNECT_END,i)}),this._p2pChannel.on(De.NeedSignalRTT,i=>{i(this._gateway.getSignalRTT())}),this._p2pChannel.on(De.RequestRestartICE,function(){var i=L(function*(o){if(r._p2pChannel instanceof ds)return;const a=yield r._p2pChannel.restartICE(o),l=yield a.next();if(l.done)return;const d=l.value;let h;try{h=yield r._gateway.restartICE({iceParameters:d})}catch(m){return void a.throw(m)}const{iceParameters:f}=function(m){const g=m.iceParameters;return{iceParameters:{iceUfrag:g.iceUfrag,icePwd:g.icePwd}}}(h);yield a.next({remoteIceParameters:f})});return function(o){return i.apply(this,arguments)}}()),this._p2pChannel.on(De.RequestReconnect,L(function*(){r._gateway.reconnect()})),this._p2pChannel.on(De.RequestReconnectPC,L(function*(){var i;const{iceParameters:o,dtlsParameters:a,rtpCapabilities:l}=yield r._p2pChannel.startP2PConnection({turnServer:null===(i=r._joinInfo)||void 0===i?void 0:i.turnServer}),{gatewayEstablishParams:d,gatewayAddress:h}=yield r._gateway.reconnectPC({iceParameters:o,dtlsParameters:a,rtpCapabilities:l}),f=As(d,h);yield r._p2pChannel.connect(f),yield r._p2pChannel.republish(),yield r._p2pChannel.reSubscribe()})),this._p2pChannel.on(De.RequestUnpublishForReconnectPC,function(){var i=L(function*(o,a,l){r._joinInfo&&void 0!==r._uid?(yield r._gateway.unpublish(o,r._uid),a()):l()});return function(o,a,l){return i.apply(this,arguments)}}()),this._p2pChannel.on(De.P2PLost,()=>{this.safeEmit(Je.P2P_LOST,this.store.uid)}),this._p2pChannel.on(De.UpdateVideoEncoder,i=>{i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig)}),this._p2pChannel.on(De.ConnectionTypeChange,i=>{this.safeEmit(Je.IS_USING_CLOUD_PROXY,i)}),this._p2pChannel.on(De.RequestLowStreamParameter,i=>{i(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(De.QueryClientConnectionState,i=>{i(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}enableContentInspect(r){var i=this;return L(function*(){if(!i._joinInfo||"CONNECTED"!==i.connectionState)throw new K(k.INVALID_OPERATION,"[".concat(i._clientId,"] can not create content inspect, please join channel first"));if(i._inspect)throw new K(k.INVALID_OPERATION,"[".concat(i._clientId,"] Inspect content service already in connecting/connected state"));try{const a=(o={config:r},yC("ContentInspect").create(o));i._inspect=a,i.handleVideoInspectEvents(a);const{appId:l,cname:d,sid:h,token:f,uid:m,cid:g,vid:v}=i._joinInfo;yield a.init({appId:l,areaCode:"",cname:d,sid:h,token:f,uid:m,cid:g,vid:v?Number(v):0},Nn)}catch(a){throw Array.isArray(a)?a[0]:a}var o})()}handleVideoInspectEvents(r){r.on(_r.CONNECTION_STATE_CHANGE,(i,o)=>{if(this.safeEmit(Je.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,i,o),o===qs.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit(Je.CONTENT_INSPECT_ERROR,new K(k.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));r.inspectImage()}}),r.on(_r.INSPECT_RESULT,(i,o)=>{var a;if(o?.code===k.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return T.debug("Stop inspect content because that has left channel"),null==this||null===(a=this._inspect)||void 0===a||a.close(),void(this._inspect=void 0);this.safeEmit(Je.CONTENT_INSPECT_RESULT,i,o)}),r.on(_r.CLIENT_LOCAL_VIDEO_TRACK,i=>{i(this.localTracks.filter(o=>"video"===o.trackMediaType)[0])})}disableContentInspect(){var r=this;return L(function*(){if(!r._inspect)throw new K(k.INVALID_OPERATION,"[".concat(r._clientId,"] inspectVideoContent not started"));try{r._inspect.close(),r._inspect=void 0}catch(i){throw Array.isArray(i)?i[0]:i}})()}setImageModeration(r,i){var o=this;return L(function*(){if(fl(r,"enabled"),r){if(!i)throw new K(k.INVALID_PARAMS,"config is required");if(qH(i),!o._joinInfo)throw new K(k.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(o._moderation)o._moderation.updateConfig(i);else{const l=(a={config:i},yC("ImageModeration").create(a));o._moderation=l,o.handleImageModerationEvents(l);const{appId:d,cname:h,sid:f,token:m,uid:g,cid:v,vid:y}=o._joinInfo;yield l.init({appId:d,areaCode:"",cname:h,sid:f,token:m,uid:g,cid:v,vid:y?Number(y):0},Nn)}}catch(l){throw Array.isArray(l)?l[0]:l}}else{var a;if(!o._moderation)throw new K(k.INVALID_OPERATION,"[".concat(o._clientId,"] image moderation not started"));try{o._moderation.close(),o._moderation.removeAllListeners(),o._moderation=void 0}catch(l){throw Array.isArray(l)?l[0]:l}}})()}handleImageModerationEvents(r){r.on(Pa.CONNECTION_STATE_CHANGE,(i,o)=>{if(this.safeEmit(Je.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,i,o),i===ws.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new K(k.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");r.inspectImage()}}),r.on(Pa.CLIENT_LOCAL_VIDEO_TRACK,i=>{i(this.localTracks.filter(o=>"video"===o.trackMediaType)[0])})}setP2PTransport(r){if(pr(r,"transport",["default","auto","relay","sd-rtn"]),"p2p"!==this.mode)throw new K(k.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=r,T.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(r))}getJoinChannelServiceRecords(){return T.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}setPublishAudioFilterEnabled(r){var i=this;return L(function*(){fl(r,"enabled"),kt("ENABLE_PUBLISH_AUDIO_FILTER",r),i._joinInfo&&(yield i._gateway.setPublishAudioFilterEnabled(r))})()}_handleResetAddStream(r,i){switch(i){case"audio":r._audio_added_=!1,r._trust_audio_stream_added_state_=!0;break;case"video":r._video_added_=!1,r._trust_video_stream_added_state_=!0}}},pe(fe.prototype,"leave",[gF],Object.getOwnPropertyDescriptor(fe.prototype,"leave"),fe.prototype),pe(fe.prototype,"publish",[YH],Object.getOwnPropertyDescriptor(fe.prototype,"publish"),fe.prototype),pe(fe.prototype,"unpublish",[$H],Object.getOwnPropertyDescriptor(fe.prototype,"unpublish"),fe.prototype),pe(fe.prototype,"subscribe",[XH],Object.getOwnPropertyDescriptor(fe.prototype,"subscribe"),fe.prototype),pe(fe.prototype,"presubscribe",[ZH],Object.getOwnPropertyDescriptor(fe.prototype,"presubscribe"),fe.prototype),pe(fe.prototype,"massSubscribe",[JH],Object.getOwnPropertyDescriptor(fe.prototype,"massSubscribe"),fe.prototype),pe(fe.prototype,"unsubscribe",[QH],Object.getOwnPropertyDescriptor(fe.prototype,"unsubscribe"),fe.prototype),pe(fe.prototype,"massUnsubscribe",[e6],Object.getOwnPropertyDescriptor(fe.prototype,"massUnsubscribe"),fe.prototype),pe(fe.prototype,"setLowStreamParameter",[t6],Object.getOwnPropertyDescriptor(fe.prototype,"setLowStreamParameter"),fe.prototype),pe(fe.prototype,"enableDualStream",[Jd],Object.getOwnPropertyDescriptor(fe.prototype,"enableDualStream"),fe.prototype),pe(fe.prototype,"disableDualStream",[xv],Object.getOwnPropertyDescriptor(fe.prototype,"disableDualStream"),fe.prototype),pe(fe.prototype,"setClientRole",[n6],Object.getOwnPropertyDescriptor(fe.prototype,"setClientRole"),fe.prototype),pe(fe.prototype,"setProxyServer",[r6],Object.getOwnPropertyDescriptor(fe.prototype,"setProxyServer"),fe.prototype),pe(fe.prototype,"setTurnServer",[i6],Object.getOwnPropertyDescriptor(fe.prototype,"setTurnServer"),fe.prototype),pe(fe.prototype,"setLicense",[o6],Object.getOwnPropertyDescriptor(fe.prototype,"setLicense"),fe.prototype),pe(fe.prototype,"startProxyServer",[s6],Object.getOwnPropertyDescriptor(fe.prototype,"startProxyServer"),fe.prototype),pe(fe.prototype,"stopProxyServer",[a6],Object.getOwnPropertyDescriptor(fe.prototype,"stopProxyServer"),fe.prototype),pe(fe.prototype,"setLocalAccessPointsV2",[c6],Object.getOwnPropertyDescriptor(fe.prototype,"setLocalAccessPointsV2"),fe.prototype),pe(fe.prototype,"setLocalAccessPoints",[AC],Object.getOwnPropertyDescriptor(fe.prototype,"setLocalAccessPoints"),fe.prototype),pe(fe.prototype,"setRemoteDefaultVideoStreamType",[DC],Object.getOwnPropertyDescriptor(fe.prototype,"setRemoteDefaultVideoStreamType"),fe.prototype),pe(fe.prototype,"setRemoteVideoStreamType",[_F],Object.getOwnPropertyDescriptor(fe.prototype,"setRemoteVideoStreamType"),fe.prototype),pe(fe.prototype,"setStreamFallbackOption",[OC],Object.getOwnPropertyDescriptor(fe.prototype,"setStreamFallbackOption"),fe.prototype),pe(fe.prototype,"setEncryptionConfig",[vF],Object.getOwnPropertyDescriptor(fe.prototype,"setEncryptionConfig"),fe.prototype),pe(fe.prototype,"renewToken",[EF],Object.getOwnPropertyDescriptor(fe.prototype,"renewToken"),fe.prototype),pe(fe.prototype,"enableAudioVolumeIndicator",[yF],Object.getOwnPropertyDescriptor(fe.prototype,"enableAudioVolumeIndicator"),fe.prototype),pe(fe.prototype,"startLiveStreaming",[bF],Object.getOwnPropertyDescriptor(fe.prototype,"startLiveStreaming"),fe.prototype),pe(fe.prototype,"setLiveTranscoding",[SF],Object.getOwnPropertyDescriptor(fe.prototype,"setLiveTranscoding"),fe.prototype),pe(fe.prototype,"stopLiveStreaming",[CF],Object.getOwnPropertyDescriptor(fe.prototype,"stopLiveStreaming"),fe.prototype),pe(fe.prototype,"startChannelMediaRelay",[TF],Object.getOwnPropertyDescriptor(fe.prototype,"startChannelMediaRelay"),fe.prototype),pe(fe.prototype,"updateChannelMediaRelay",[wF],Object.getOwnPropertyDescriptor(fe.prototype,"updateChannelMediaRelay"),fe.prototype),pe(fe.prototype,"stopChannelMediaRelay",[QD],Object.getOwnPropertyDescriptor(fe.prototype,"stopChannelMediaRelay"),fe.prototype),pe(fe.prototype,"sendCustomReportMessage",[IF],Object.getOwnPropertyDescriptor(fe.prototype,"sendCustomReportMessage"),fe.prototype),pe(fe.prototype,"pickSVCLayer",[NC],Object.getOwnPropertyDescriptor(fe.prototype,"pickSVCLayer"),fe.prototype),pe(fe.prototype,"setRTMConfig",[RF],Object.getOwnPropertyDescriptor(fe.prototype,"setRTMConfig"),fe.prototype),pe(fe.prototype,"enableContentInspect",[PC],Object.getOwnPropertyDescriptor(fe.prototype,"enableContentInspect"),fe.prototype),pe(fe.prototype,"disableContentInspect",[eO],Object.getOwnPropertyDescriptor(fe.prototype,"disableContentInspect"),fe.prototype),pe(fe.prototype,"setImageModeration",[AF],Object.getOwnPropertyDescriptor(fe.prototype,"setImageModeration"),fe.prototype),pe(fe.prototype,"setP2PTransport",[DF],Object.getOwnPropertyDescriptor(fe.prototype,"setP2PTransport"),fe.prototype),pe(fe.prototype,"getJoinChannelServiceRecords",[OF],Object.getOwnPropertyDescriptor(fe.prototype,"getJoinChannelServiceRecords"),fe.prototype),pe(fe.prototype,"setPublishAudioFilterEnabled",[Ll],Object.getOwnPropertyDescriptor(fe.prototype,"setPublishAudioFilterEnabled"),fe.prototype),fe);class Fv{constructor(i,o){N(this,"id",0),N(this,"element",void 0),N(this,"peerPair",void 0),N(this,"context",void 0),N(this,"audioPlayerElement",void 0),N(this,"audioTrack",void 0),Fv.count+=1,this.id=Fv.count,this.element=i,this.context=o}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=i=>{const o=document.createElement("audio");o.srcObject=new MediaStream([i.track]),o.play(),this.audioPlayerElement=o}}switchSdp(){var i=this;return L(function*(){if(!i.peerPair)return;const o=function(){var l=L(function*(d,h){const f="offer"===h?yield d.createOffer():yield d.createAnswer();return yield d.setLocalDescription(f),"complete"===d.iceGatheringState?d.localDescription:new le(m=>{d.onicegatheringstatechange=()=>{"complete"===d.iceGatheringState&&m(d.localDescription)}})});return function(h,f){return l.apply(this,arguments)}}(),a=function(){var l=L(function*(d,h){return yield d.setRemoteDescription(h)});return function(h,f){return l.apply(this,arguments)}}();try{const l=yield o(i.peerPair[0],"offer");yield a(i.peerPair[1],l);const d=yield o(i.peerPair[1],"answer");yield a(i.peerPair[0],d)}catch(l){throw new K(k.LOCAL_AEC_ERROR,l.toString()).print()}})()}getTracksFromMediaElement(i){var o=this;return L(function*(){if(o.audioTrack)return o.audioTrack;let a;try{i instanceof HTMLVideoElement&&(i.captureStream?i.captureStream():i.mozCaptureStream()),a=o.context.createMediaStreamDestination(),o.context.createMediaElementSource(i).connect(a)}catch(d){throw new K(k.LOCAL_AEC_ERROR,d.toString()).print()}if(!a)throw new K(k.LOCAL_AEC_ERROR,"no dest node when local aec").print();const l=a.stream.getAudioTracks()[0];return o.audioTrack=l,l})()}getElement(){return this.element}startEchoCancellation(){var i=this;return L(function*(){i.context.resume(),i.peerPair&&i.close(),i.initPeers();const o=i.element,a=yield i.getTracksFromMediaElement(o);i.peerPair&&i.peerPair[0].addTrack(a),yield i.switchSdp()})()}close(){T.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(i=>{i.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var MC,kC;N(Fv,"count",0);const d6=window.AudioContext||window.webkitAudioContext,u6=new(MC=Ae({report:be}),pe((kC=class{constructor(){N(this,"units",[]),N(this,"context",void 0)}processExternalMediaAEC(r){if(!this._doesEnvironmentNeedAEC())return T.debug("the system does not need to process local aec"),-1;this.context||(this.context=new d6);let i=this.units.find(o=>o&&o.getElement()===r);return i||(i=new Fv(r,this.context),this.units.push(i)),i.startEchoCancellation(),T.debug("start processing local audio echo cancellation, id is",i.id),i.id}_doesEnvironmentNeedAEC(){return ot().name!==It.SAFARI}}).prototype,"processExternalMediaAEC",[MC],Object.getOwnPropertyDescriptor(kC.prototype,"processExternalMediaAEC"),kC.prototype),kC);function PF(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function MF(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?PF(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):PF(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}const tO=window||document;function kF(r){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!tO)return;const o=er._cspEventHandlerPointer;if(o&&i)return void console.error(o,i);const a=l=>{if(!(l&&l.blockedURI&&(er.onSecurityPolicyViolation||er.getListeners(Ys.SECURITY_POLICY_VIOLATION).length>0)))return;const d=l.blockedURI;B("CSP_DETECTED_HOSTNAME_LIST").some(h=>he(d).call(d,h))&&(er.onSecurityPolicyViolation&&"function"==typeof er.onSecurityPolicyViolation&&er.onSecurityPolicyViolation(l),er.getListeners(Ys.SECURITY_POLICY_VIOLATION).length>0&&er.safeEmit(Ys.SECURITY_POLICY_VIOLATION,l))};o&&tO.removeEventListener("securitypolicyviolation",o),(i||r&&"function"==typeof r||er.getListeners(Ys.SECURITY_POLICY_VIOLATION).length>0)&&tO.addEventListener("securitypolicyviolation",a),er._cspEventHandlerPointer=a}var h6=Ri,p6=nh,f6=RegExp.prototype,hi=Ht(function(r){return r===f6||h6(f6,r)?p6(r):r.flags});function jh(r){let i=r.length;for(;--i>=0;)r[i]=0}const xC=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Vv=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),LF=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),go=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),xl=new Array(576);jh(xl);const Bv=new Array(60);jh(Bv);const jv=new Array(512);jh(jv);const Hv=new Array(256);jh(Hv);const FC=new Array(29);jh(FC);const UC=new Array(30);function iO(r,i,o,a,l){this.static_tree=r,this.extra_bits=i,this.extra_base=o,this.elems=a,this.max_length=l,this.has_stree=r&&r.length}let Pc,oO,sO;function aO(r,i){this.dyn_tree=r,this.max_code=0,this.stat_desc=i}jh(UC);const xF=r=>r<256?jv[r]:jv[256+(r>>>7)],Gv=(r,i)=>{r.pending_buf[r.pending++]=255&i,r.pending_buf[r.pending++]=i>>>8&255},us=(r,i,o)=>{r.bi_valid>16-o?(r.bi_buf|=i<<r.bi_valid&65535,Gv(r,r.bi_buf),r.bi_buf=i>>16-r.bi_valid,r.bi_valid+=o-16):(r.bi_buf|=i<<r.bi_valid&65535,r.bi_valid+=o)},Ba=(r,i,o)=>{us(r,o[2*i],o[2*i+1])},FF=(r,i)=>{let o=0;do{o|=1&r,r>>>=1,o<<=1}while(--i>0);return o>>>1},UF=(r,i,o)=>{const a=new Array(16);let l,d,h=0;for(l=1;l<=15;l++)h=h+o[l-1]<<1,a[l]=h;for(d=0;d<=i;d++){let f=r[2*d+1];0!==f&&(r[2*d]=FF(a[f]++,f))}},ki=r=>{let i;for(i=0;i<286;i++)r.dyn_ltree[2*i]=0;for(i=0;i<30;i++)r.dyn_dtree[2*i]=0;for(i=0;i<19;i++)r.bl_tree[2*i]=0;r.dyn_ltree[512]=1,r.opt_len=r.static_len=0,r.sym_next=r.matches=0},cO=r=>{r.bi_valid>8?Gv(r,r.bi_buf):r.bi_valid>0&&(r.pending_buf[r.pending++]=r.bi_buf),r.bi_buf=0,r.bi_valid=0},VC=(r,i,o,a)=>{const l=2*i,d=2*o;return r[l]<r[d]||r[l]===r[d]&&a[i]<=a[o]},BC=(r,i,o)=>{const a=r.heap[o];let l=o<<1;for(;l<=r.heap_len&&(l<r.heap_len&&VC(i,r.heap[l+1],r.heap[l],r.depth)&&l++,!VC(i,a,r.heap[l],r.depth));)r.heap[o]=r.heap[l],o=l,l<<=1;r.heap[o]=a},rm=(r,i,o)=>{let a,l,d,h,f=0;if(0!==r.sym_next)do{a=255&r.pending_buf[r.sym_buf+f++],a+=(255&r.pending_buf[r.sym_buf+f++])<<8,l=r.pending_buf[r.sym_buf+f++],0===a?Ba(r,l,i):(d=Hv[l],Ba(r,d+256+1,i),h=xC[d],0!==h&&(l-=FC[d],us(r,l,h)),a--,d=xF(a),Ba(r,d,o),h=Vv[d],0!==h&&(a-=UC[d],us(r,a,h)))}while(f<r.sym_next);Ba(r,256,i)},lO=(r,i)=>{const o=i.dyn_tree,a=i.stat_desc.static_tree,l=i.stat_desc.has_stree,d=i.stat_desc.elems;let h,f,m,g=-1;for(r.heap_len=0,r.heap_max=573,h=0;h<d;h++)0!==o[2*h]?(r.heap[++r.heap_len]=g=h,r.depth[h]=0):o[2*h+1]=0;for(;r.heap_len<2;)m=r.heap[++r.heap_len]=g<2?++g:0,o[2*m]=1,r.depth[m]=0,r.opt_len--,l&&(r.static_len-=a[2*m+1]);for(i.max_code=g,h=r.heap_len>>1;h>=1;h--)BC(r,o,h);m=d;do{h=r.heap[1],r.heap[1]=r.heap[r.heap_len--],BC(r,o,1),f=r.heap[1],r.heap[--r.heap_max]=h,r.heap[--r.heap_max]=f,o[2*m]=o[2*h]+o[2*f],r.depth[m]=(r.depth[h]>=r.depth[f]?r.depth[h]:r.depth[f])+1,o[2*h+1]=o[2*f+1]=m,r.heap[1]=m++,BC(r,o,1)}while(r.heap_len>=2);r.heap[--r.heap_max]=r.heap[1],((v,y)=>{const b=y.dyn_tree,C=y.max_code,P=y.stat_desc.static_tree,R=y.stat_desc.has_stree,A=y.stat_desc.extra_bits,O=y.stat_desc.extra_base,M=y.stat_desc.max_length;let x,j,W,q,te,J,X=0;for(q=0;q<=15;q++)v.bl_count[q]=0;for(b[2*v.heap[v.heap_max]+1]=0,x=v.heap_max+1;x<573;x++)j=v.heap[x],q=b[2*b[2*j+1]+1]+1,q>M&&(q=M,X++),b[2*j+1]=q,j>C||(v.bl_count[q]++,te=0,j>=O&&(te=A[j-O]),J=b[2*j],v.opt_len+=J*(q+te),R&&(v.static_len+=J*(P[2*j+1]+te)));if(0!==X){do{for(q=M-1;0===v.bl_count[q];)q--;v.bl_count[q]--,v.bl_count[q+1]+=2,v.bl_count[M]--,X-=2}while(X>0);for(q=M;0!==q;q--)for(j=v.bl_count[q];0!==j;)W=v.heap[--x],W>C||(b[2*W+1]!==q&&(v.opt_len+=(q-b[2*W+1])*b[2*W],b[2*W+1]=q),j--)}})(r,i),UF(o,g,r.bl_count)},Et=(r,i,o)=>{let a,l,d=-1,h=i[1],f=0,m=7,g=4;for(0===h&&(m=138,g=3),i[2*(o+1)+1]=65535,a=0;a<=o;a++)l=h,h=i[2*(a+1)+1],++f<m&&l===h||(f<g?r.bl_tree[2*l]+=f:0!==l?(l!==d&&r.bl_tree[2*l]++,r.bl_tree[32]++):f<=10?r.bl_tree[34]++:r.bl_tree[36]++,f=0,d=l,0===h?(m=138,g=3):l===h?(m=6,g=3):(m=7,g=4))},Wv=(r,i,o)=>{let a,l,d=-1,h=i[1],f=0,m=7,g=4;for(0===h&&(m=138,g=3),a=0;a<=o;a++)if(l=h,h=i[2*(a+1)+1],!(++f<m&&l===h)){if(f<g)do{Ba(r,l,r.bl_tree)}while(0!=--f);else 0!==l?(l!==d&&(Ba(r,l,r.bl_tree),f--),Ba(r,16,r.bl_tree),us(r,f-3,2)):f<=10?(Ba(r,17,r.bl_tree),us(r,f-3,3)):(Ba(r,18,r.bl_tree),us(r,f-11,7));f=0,d=l,0===h?(m=138,g=3):l===h?(m=6,g=3):(m=7,g=4)}};let VF=!1;const BF=(r,i,o,a)=>{us(r,0+(a?1:0),3),cO(r),Gv(r,o),Gv(r,~o),o&&r.pending_buf.set(r.window.subarray(i,i+o),r.pending),r.pending+=o};var v6={_tr_init:r=>{VF||((()=>{let i,o,a,l,d;const h=new Array(16);for(a=0,l=0;l<28;l++)for(FC[l]=a,i=0;i<1<<xC[l];i++)Hv[a++]=l;for(Hv[a-1]=l,d=0,l=0;l<16;l++)for(UC[l]=d,i=0;i<1<<Vv[l];i++)jv[d++]=l;for(d>>=7;l<30;l++)for(UC[l]=d<<7,i=0;i<1<<Vv[l]-7;i++)jv[256+d++]=l;for(o=0;o<=15;o++)h[o]=0;for(i=0;i<=143;)xl[2*i+1]=8,i++,h[8]++;for(;i<=255;)xl[2*i+1]=9,i++,h[9]++;for(;i<=279;)xl[2*i+1]=7,i++,h[7]++;for(;i<=287;)xl[2*i+1]=8,i++,h[8]++;for(UF(xl,287,h),i=0;i<30;i++)Bv[2*i+1]=5,Bv[2*i]=FF(i,5);Pc=new iO(xl,xC,257,286,15),oO=new iO(Bv,Vv,0,30,15),sO=new iO(new Array(0),LF,0,19,7)})(),VF=!0),r.l_desc=new aO(r.dyn_ltree,Pc),r.d_desc=new aO(r.dyn_dtree,oO),r.bl_desc=new aO(r.bl_tree,sO),r.bi_buf=0,r.bi_valid=0,ki(r)},_tr_stored_block:BF,_tr_flush_block:(r,i,o,a)=>{let l,d,h=0;r.level>0?(2===r.strm.data_type&&(r.strm.data_type=(f=>{let m,g=4093624447;for(m=0;m<=31;m++,g>>>=1)if(1&g&&0!==f.dyn_ltree[2*m])return 0;if(0!==f.dyn_ltree[18]||0!==f.dyn_ltree[20]||0!==f.dyn_ltree[26])return 1;for(m=32;m<256;m++)if(0!==f.dyn_ltree[2*m])return 1;return 0})(r)),lO(r,r.l_desc),lO(r,r.d_desc),h=(f=>{let m;for(Et(f,f.dyn_ltree,f.l_desc.max_code),Et(f,f.dyn_dtree,f.d_desc.max_code),lO(f,f.bl_desc),m=18;m>=3&&0===f.bl_tree[2*go[m]+1];m--);return f.opt_len+=3*(m+1)+5+5+4,m})(r),l=r.opt_len+3+7>>>3,d=r.static_len+3+7>>>3,d<=l&&(l=d)):l=d=o+5,o+4<=l&&-1!==i?BF(r,i,o,a):4===r.strategy||d===l?(us(r,2+(a?1:0),3),rm(r,xl,Bv)):(us(r,4+(a?1:0),3),((f,m,g,v)=>{let y;for(us(f,m-257,5),us(f,g-1,5),us(f,v-4,4),y=0;y<v;y++)us(f,f.bl_tree[2*go[y]+1],3);Wv(f,f.dyn_ltree,m-1),Wv(f,f.dyn_dtree,g-1)})(r,r.l_desc.max_code+1,r.d_desc.max_code+1,h+1),rm(r,r.dyn_ltree,r.dyn_dtree)),ki(r),a&&cO(r)},_tr_tally:(r,i,o)=>(r.pending_buf[r.sym_buf+r.sym_next++]=i,r.pending_buf[r.sym_buf+r.sym_next++]=i>>8,r.pending_buf[r.sym_buf+r.sym_next++]=o,0===i?r.dyn_ltree[2*o]++:(r.matches++,i--,r.dyn_ltree[2*(Hv[o]+256+1)]++,r.dyn_dtree[2*xF(i)]++),r.sym_next===r.sym_end),_tr_align:r=>{var i;us(r,2,3),Ba(r,256,xl),16===(i=r).bi_valid?(Gv(i,i.bi_buf),i.bi_buf=0,i.bi_valid=0):i.bi_valid>=8&&(i.pending_buf[i.pending++]=255&i.bi_buf,i.bi_buf>>=8,i.bi_valid-=8)}},zv=(r,i,o,a)=>{let l=65535&r,d=r>>>16&65535,h=0;for(;0!==o;){h=o>2e3?2e3:o,o-=h;do{l=l+i[a++]|0,d=d+l|0}while(--h);l%=65521,d%=65521}return l|d<<16};const dO=new Uint32Array((()=>{let r,i=[];for(var o=0;o<256;o++){r=o;for(var a=0;a<8;a++)r=1&r?3988292384^r>>>1:r>>>1;i[o]=r}return i})());var Si=(r,i,o,a)=>{const l=dO,d=a+o;r^=-1;for(let h=a;h<d;h++)r=r>>>8^l[255&(r^i[h])];return~r},Fl={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},im={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:HF,_tr_stored_block:uO,_tr_flush_block:_o,_tr_tally:ja,_tr_align:E6}=v6,{Z_NO_FLUSH:Ha,Z_PARTIAL_FLUSH:GF,Z_FULL_FLUSH:jC,Z_FINISH:xr,Z_BLOCK:y6,Z_OK:qi,Z_STREAM_END:HC,Z_STREAM_ERROR:Ga,Z_DATA_ERROR:Ul,Z_BUF_ERROR:Wa,Z_DEFAULT_COMPRESSION:WF,Z_FILTERED:Ns,Z_HUFFMAN_ONLY:Hh,Z_RLE:zF,Z_FIXED:b6,Z_DEFAULT_STRATEGY:Gh,Z_UNKNOWN:GC,Z_DEFLATED:pi}=im,oa=262,zh=(r,i)=>(r.msg=Fl[i],i),Kh=r=>2*r-(r>4?9:0),eu=r=>{let i=r.length;for(;--i>=0;)r[i]=0},w6=r=>{let i,o,a,l=r.w_size;i=r.hash_size,a=i;do{o=r.head[--a],r.head[a]=o>=l?o-l:0}while(--i);i=l,a=i;do{o=r.prev[--a],r.prev[a]=o>=l?o-l:0}while(--i)};let Yi=(r,i,o)=>(i<<r.hash_shift^o)&r.hash_mask;const Bo=r=>{const i=r.state;let o=i.pending;o>r.avail_out&&(o=r.avail_out),0!==o&&(r.output.set(i.pending_buf.subarray(i.pending_out,i.pending_out+o),r.next_out),r.next_out+=o,i.pending_out+=o,r.total_out+=o,r.avail_out-=o,i.pending-=o,0===i.pending&&(i.pending_out=0))},hs=(r,i)=>{_o(r,r.block_start>=0?r.block_start:-1,r.strstart-r.block_start,i),r.block_start=r.strstart,Bo(r.strm)},wn=(r,i)=>{r.pending_buf[r.pending++]=i},sa=(r,i)=>{r.pending_buf[r.pending++]=i>>>8&255,r.pending_buf[r.pending++]=255&i},pO=(r,i,o,a)=>{let l=r.avail_in;return l>a&&(l=a),0===l?0:(r.avail_in-=l,i.set(r.input.subarray(r.next_in,r.next_in+l),o),1===r.state.wrap?r.adler=zv(r.adler,i,l,o):2===r.state.wrap&&(r.adler=Si(r.adler,i,l,o)),r.next_in+=l,r.total_in+=l,l)},fO=(r,i)=>{let o,a,l=r.max_chain_length,d=r.strstart,h=r.prev_length,f=r.nice_match;const m=r.strstart>r.w_size-oa?r.strstart-(r.w_size-oa):0,g=r.window,v=r.w_mask,y=r.prev,b=r.strstart+258;let C=g[d+h-1],P=g[d+h];r.prev_length>=r.good_match&&(l>>=2),f>r.lookahead&&(f=r.lookahead);do{if(o=i,g[o+h]===P&&g[o+h-1]===C&&g[o]===g[d]&&g[++o]===g[d+1]){d+=2,o++;do{}while(g[++d]===g[++o]&&g[++d]===g[++o]&&g[++d]===g[++o]&&g[++d]===g[++o]&&g[++d]===g[++o]&&g[++d]===g[++o]&&g[++d]===g[++o]&&g[++d]===g[++o]&&d<b);if(a=258-(b-d),d=b-258,a>h){if(r.match_start=i,h=a,a>=f)break;C=g[d+h-1],P=g[d+h]}}}while((i=y[i&v])>m&&0!=--l);return h<=r.lookahead?h:r.lookahead},qh=r=>{const i=r.w_size;let o,a,l;do{if(a=r.window_size-r.lookahead-r.strstart,r.strstart>=i+(i-oa)&&(r.window.set(r.window.subarray(i,i+i-a),0),r.match_start-=i,r.strstart-=i,r.block_start-=i,r.insert>r.strstart&&(r.insert=r.strstart),w6(r),a+=i),0===r.strm.avail_in)break;if(o=pO(r.strm,r.window,r.strstart+r.lookahead,a),r.lookahead+=o,r.lookahead+r.insert>=3)for(l=r.strstart-r.insert,r.ins_h=r.window[l],r.ins_h=Yi(r,r.ins_h,r.window[l+1]);r.insert&&(r.ins_h=Yi(r,r.ins_h,r.window[l+3-1]),r.prev[l&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=l,l++,r.insert--,!(r.lookahead+r.insert<3)););}while(r.lookahead<oa&&0!==r.strm.avail_in)},KF=(r,i)=>{let o,a,l,d=r.pending_buf_size-5>r.w_size?r.w_size:r.pending_buf_size-5,h=0,f=r.strm.avail_in;do{if(o=65535,l=r.bi_valid+42>>3,r.strm.avail_out<l||(l=r.strm.avail_out-l,a=r.strstart-r.block_start,o>a+r.strm.avail_in&&(o=a+r.strm.avail_in),o>l&&(o=l),o<d&&(0===o&&i!==xr||i===Ha||o!==a+r.strm.avail_in)))break;h=i===xr&&o===a+r.strm.avail_in?1:0,uO(r,0,0,h),r.pending_buf[r.pending-4]=o,r.pending_buf[r.pending-3]=o>>8,r.pending_buf[r.pending-2]=~o,r.pending_buf[r.pending-1]=~o>>8,Bo(r.strm),a&&(a>o&&(a=o),r.strm.output.set(r.window.subarray(r.block_start,r.block_start+a),r.strm.next_out),r.strm.next_out+=a,r.strm.avail_out-=a,r.strm.total_out+=a,r.block_start+=a,o-=a),o&&(pO(r.strm,r.strm.output,r.strm.next_out,o),r.strm.next_out+=o,r.strm.avail_out-=o,r.strm.total_out+=o)}while(0===h);return f-=r.strm.avail_in,f&&(f>=r.w_size?(r.matches=2,r.window.set(r.strm.input.subarray(r.strm.next_in-r.w_size,r.strm.next_in),0),r.strstart=r.w_size,r.insert=r.strstart):(r.window_size-r.strstart<=f&&(r.strstart-=r.w_size,r.window.set(r.window.subarray(r.w_size,r.w_size+r.strstart),0),r.matches<2&&r.matches++,r.insert>r.strstart&&(r.insert=r.strstart)),r.window.set(r.strm.input.subarray(r.strm.next_in-f,r.strm.next_in),r.strstart),r.strstart+=f,r.insert+=f>r.w_size-r.insert?r.w_size-r.insert:f),r.block_start=r.strstart),r.high_water<r.strstart&&(r.high_water=r.strstart),h?4:i!==Ha&&i!==xr&&0===r.strm.avail_in&&r.strstart===r.block_start?2:(l=r.window_size-r.strstart,r.strm.avail_in>l&&r.block_start>=r.w_size&&(r.block_start-=r.w_size,r.strstart-=r.w_size,r.window.set(r.window.subarray(r.w_size,r.w_size+r.strstart),0),r.matches<2&&r.matches++,l+=r.w_size,r.insert>r.strstart&&(r.insert=r.strstart)),l>r.strm.avail_in&&(l=r.strm.avail_in),l&&(pO(r.strm,r.window,r.strstart,l),r.strstart+=l,r.insert+=l>r.w_size-r.insert?r.w_size-r.insert:l),r.high_water<r.strstart&&(r.high_water=r.strstart),l=r.bi_valid+42>>3,l=r.pending_buf_size-l>65535?65535:r.pending_buf_size-l,d=l>r.w_size?r.w_size:l,a=r.strstart-r.block_start,(a>=d||(a||i===xr)&&i!==Ha&&0===r.strm.avail_in&&a<=l)&&(o=a>l?l:a,h=i===xr&&0===r.strm.avail_in&&o===a?1:0,uO(r,r.block_start,o,h),r.block_start+=o,Bo(r.strm)),h?3:1)},WC=(r,i)=>{let o,a;for(;;){if(r.lookahead<oa){if(qh(r),r.lookahead<oa&&i===Ha)return 1;if(0===r.lookahead)break}if(o=0,r.lookahead>=3&&(r.ins_h=Yi(r,r.ins_h,r.window[r.strstart+3-1]),o=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),0!==o&&r.strstart-o<=r.w_size-oa&&(r.match_length=fO(r,o)),r.match_length>=3)if(a=ja(r,r.strstart-r.match_start,r.match_length-3),r.lookahead-=r.match_length,r.match_length<=r.max_lazy_match&&r.lookahead>=3){r.match_length--;do{r.strstart++,r.ins_h=Yi(r,r.ins_h,r.window[r.strstart+3-1]),o=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart}while(0!=--r.match_length);r.strstart++}else r.strstart+=r.match_length,r.match_length=0,r.ins_h=r.window[r.strstart],r.ins_h=Yi(r,r.ins_h,r.window[r.strstart+1]);else a=ja(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++;if(a&&(hs(r,!1),0===r.strm.avail_out))return 1}return r.insert=r.strstart<2?r.strstart:2,i===xr?(hs(r,!0),0===r.strm.avail_out?3:4):r.sym_next&&(hs(r,!1),0===r.strm.avail_out)?1:2},om=(r,i)=>{let o,a,l;for(;;){if(r.lookahead<oa){if(qh(r),r.lookahead<oa&&i===Ha)return 1;if(0===r.lookahead)break}if(o=0,r.lookahead>=3&&(r.ins_h=Yi(r,r.ins_h,r.window[r.strstart+3-1]),o=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),r.prev_length=r.match_length,r.prev_match=r.match_start,r.match_length=2,0!==o&&r.prev_length<r.max_lazy_match&&r.strstart-o<=r.w_size-oa&&(r.match_length=fO(r,o),r.match_length<=5&&(r.strategy===Ns||3===r.match_length&&r.strstart-r.match_start>4096)&&(r.match_length=2)),r.prev_length>=3&&r.match_length<=r.prev_length){l=r.strstart+r.lookahead-3,a=ja(r,r.strstart-1-r.prev_match,r.prev_length-3),r.lookahead-=r.prev_length-1,r.prev_length-=2;do{++r.strstart<=l&&(r.ins_h=Yi(r,r.ins_h,r.window[r.strstart+3-1]),o=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart)}while(0!=--r.prev_length);if(r.match_available=0,r.match_length=2,r.strstart++,a&&(hs(r,!1),0===r.strm.avail_out))return 1}else if(r.match_available){if(a=ja(r,0,r.window[r.strstart-1]),a&&hs(r,!1),r.strstart++,r.lookahead--,0===r.strm.avail_out)return 1}else r.match_available=1,r.strstart++,r.lookahead--}return r.match_available&&(a=ja(r,0,r.window[r.strstart-1]),r.match_available=0),r.insert=r.strstart<2?r.strstart:2,i===xr?(hs(r,!0),0===r.strm.avail_out?3:4):r.sym_next&&(hs(r,!1),0===r.strm.avail_out)?1:2};function za(r,i,o,a,l){this.good_length=r,this.max_lazy=i,this.nice_length=o,this.max_chain=a,this.func=l}const sm=[new za(0,0,0,0,KF),new za(4,4,8,4,WC),new za(4,5,16,8,WC),new za(4,6,32,32,WC),new za(4,4,16,16,om),new za(8,16,32,32,om),new za(8,16,128,128,om),new za(8,32,128,256,om),new za(32,128,258,1024,om),new za(32,258,258,4096,om)];function zC(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=pi,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),eu(this.dyn_ltree),eu(this.dyn_dtree),eu(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),eu(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),eu(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ka=r=>{if(!r)return 1;const i=r.state;return!i||i.strm!==r||42!==i.status&&57!==i.status&&69!==i.status&&73!==i.status&&91!==i.status&&103!==i.status&&113!==i.status&&666!==i.status?1:0},Kn=r=>{if(Ka(r))return zh(r,Ga);r.total_in=r.total_out=0,r.data_type=GC;const i=r.state;return i.pending=0,i.pending_out=0,i.wrap<0&&(i.wrap=-i.wrap),i.status=2===i.wrap?57:i.wrap?42:113,r.adler=2===i.wrap?0:1,i.last_flush=-2,HF(i),qi},am=r=>{const i=Kn(r);return i===qi&&((o=r.state).window_size=2*o.w_size,eu(o.head),o.max_lazy_match=sm[o.level].max_lazy,o.good_match=sm[o.level].good_length,o.nice_match=sm[o.level].nice_length,o.max_chain_length=sm[o.level].max_chain,o.strstart=0,o.block_start=0,o.lookahead=0,o.insert=0,o.match_length=o.prev_length=2,o.match_available=0,o.ins_h=0),i;var o},qF=(r,i,o,a,l,d)=>{if(!r)return Ga;let h=1;if(i===WF&&(i=6),a<0?(h=0,a=-a):a>15&&(h=2,a-=16),l<1||l>9||o!==pi||a<8||a>15||i<0||i>9||d<0||d>b6||8===a&&1!==h)return zh(r,Ga);8===a&&(a=9);const f=new zC;return r.state=f,f.strm=r,f.status=42,f.wrap=h,f.gzhead=null,f.w_bits=a,f.w_size=1<<f.w_bits,f.w_mask=f.w_size-1,f.hash_bits=l+7,f.hash_size=1<<f.hash_bits,f.hash_mask=f.hash_size-1,f.hash_shift=~~((f.hash_bits+3-1)/3),f.window=new Uint8Array(2*f.w_size),f.head=new Uint16Array(f.hash_size),f.prev=new Uint16Array(f.w_size),f.lit_bufsize=1<<l+6,f.pending_buf_size=4*f.lit_bufsize,f.pending_buf=new Uint8Array(f.pending_buf_size),f.sym_buf=f.lit_bufsize,f.sym_end=3*(f.lit_bufsize-1),f.level=i,f.strategy=d,f.method=o,am(r)};var Mc={deflateInit:(r,i)=>qF(r,i,pi,15,8,Gh),deflateInit2:qF,deflateReset:am,deflateResetKeep:Kn,deflateSetHeader:(r,i)=>Ka(r)||2!==r.state.wrap?Ga:(r.state.gzhead=i,qi),deflate:(r,i)=>{if(Ka(r)||i>y6||i<0)return r?zh(r,Ga):Ga;const o=r.state;if(!r.output||0!==r.avail_in&&!r.input||666===o.status&&i!==xr)return zh(r,0===r.avail_out?Wa:Ga);const a=o.last_flush;if(o.last_flush=i,0!==o.pending){if(Bo(r),0===r.avail_out)return o.last_flush=-1,qi}else if(0===r.avail_in&&Kh(i)<=Kh(a)&&i!==xr)return zh(r,Wa);if(666===o.status&&0!==r.avail_in)return zh(r,Wa);if(42===o.status&&0===o.wrap&&(o.status=113),42===o.status){let l=pi+(o.w_bits-8<<4)<<8,d=-1;if(d=o.strategy>=Hh||o.level<2?0:o.level<6?1:6===o.level?2:3,l|=d<<6,0!==o.strstart&&(l|=32),l+=31-l%31,sa(o,l),0!==o.strstart&&(sa(o,r.adler>>>16),sa(o,65535&r.adler)),r.adler=1,o.status=113,Bo(r),0!==o.pending)return o.last_flush=-1,qi}if(57===o.status)if(r.adler=0,wn(o,31),wn(o,139),wn(o,8),o.gzhead)wn(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),wn(o,255&o.gzhead.time),wn(o,o.gzhead.time>>8&255),wn(o,o.gzhead.time>>16&255),wn(o,o.gzhead.time>>24&255),wn(o,9===o.level?2:o.strategy>=Hh||o.level<2?4:0),wn(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(wn(o,255&o.gzhead.extra.length),wn(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(r.adler=Si(r.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=69;else if(wn(o,0),wn(o,0),wn(o,0),wn(o,0),wn(o,0),wn(o,9===o.level?2:o.strategy>=Hh||o.level<2?4:0),wn(o,3),o.status=113,Bo(r),0!==o.pending)return o.last_flush=-1,qi;if(69===o.status){if(o.gzhead.extra){let l=o.pending,d=(65535&o.gzhead.extra.length)-o.gzindex;for(;o.pending+d>o.pending_buf_size;){let f=o.pending_buf_size-o.pending;if(o.pending_buf.set(o.gzhead.extra.subarray(o.gzindex,o.gzindex+f),o.pending),o.pending=o.pending_buf_size,o.gzhead.hcrc&&o.pending>l&&(r.adler=Si(r.adler,o.pending_buf,o.pending-l,l)),o.gzindex+=f,Bo(r),0!==o.pending)return o.last_flush=-1,qi;l=0,d-=f}let h=new Uint8Array(o.gzhead.extra);o.pending_buf.set(h.subarray(o.gzindex,o.gzindex+d),o.pending),o.pending+=d,o.gzhead.hcrc&&o.pending>l&&(r.adler=Si(r.adler,o.pending_buf,o.pending-l,l)),o.gzindex=0}o.status=73}if(73===o.status){if(o.gzhead.name){let l,d=o.pending;do{if(o.pending===o.pending_buf_size){if(o.gzhead.hcrc&&o.pending>d&&(r.adler=Si(r.adler,o.pending_buf,o.pending-d,d)),Bo(r),0!==o.pending)return o.last_flush=-1,qi;d=0}l=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,wn(o,l)}while(0!==l);o.gzhead.hcrc&&o.pending>d&&(r.adler=Si(r.adler,o.pending_buf,o.pending-d,d)),o.gzindex=0}o.status=91}if(91===o.status){if(o.gzhead.comment){let l,d=o.pending;do{if(o.pending===o.pending_buf_size){if(o.gzhead.hcrc&&o.pending>d&&(r.adler=Si(r.adler,o.pending_buf,o.pending-d,d)),Bo(r),0!==o.pending)return o.last_flush=-1,qi;d=0}l=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,wn(o,l)}while(0!==l);o.gzhead.hcrc&&o.pending>d&&(r.adler=Si(r.adler,o.pending_buf,o.pending-d,d))}o.status=103}if(103===o.status){if(o.gzhead.hcrc){if(o.pending+2>o.pending_buf_size&&(Bo(r),0!==o.pending))return o.last_flush=-1,qi;wn(o,255&r.adler),wn(o,r.adler>>8&255),r.adler=0}if(o.status=113,Bo(r),0!==o.pending)return o.last_flush=-1,qi}if(0!==r.avail_in||0!==o.lookahead||i!==Ha&&666!==o.status){let l=0===o.level?KF(o,i):o.strategy===Hh?((d,h)=>{let f;for(;;){if(0===d.lookahead&&(qh(d),0===d.lookahead)){if(h===Ha)return 1;break}if(d.match_length=0,f=ja(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,f&&(hs(d,!1),0===d.strm.avail_out))return 1}return d.insert=0,h===xr?(hs(d,!0),0===d.strm.avail_out?3:4):d.sym_next&&(hs(d,!1),0===d.strm.avail_out)?1:2})(o,i):o.strategy===zF?((d,h)=>{let f,m,g,v;const y=d.window;for(;;){if(d.lookahead<=258){if(qh(d),d.lookahead<=258&&h===Ha)return 1;if(0===d.lookahead)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(g=d.strstart-1,m=y[g],m===y[++g]&&m===y[++g]&&m===y[++g])){v=d.strstart+258;do{}while(m===y[++g]&&m===y[++g]&&m===y[++g]&&m===y[++g]&&m===y[++g]&&m===y[++g]&&m===y[++g]&&m===y[++g]&&g<v);d.match_length=258-(v-g),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(f=ja(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(f=ja(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),f&&(hs(d,!1),0===d.strm.avail_out))return 1}return d.insert=0,h===xr?(hs(d,!0),0===d.strm.avail_out?3:4):d.sym_next&&(hs(d,!1),0===d.strm.avail_out)?1:2})(o,i):sm[o.level].func(o,i);if(3!==l&&4!==l||(o.status=666),1===l||3===l)return 0===r.avail_out&&(o.last_flush=-1),qi;if(2===l&&(i===GF?E6(o):i!==y6&&(uO(o,0,0,!1),i===jC&&(eu(o.head),0===o.lookahead&&(o.strstart=0,o.block_start=0,o.insert=0))),Bo(r),0===r.avail_out))return o.last_flush=-1,qi}return i!==xr?qi:o.wrap<=0?HC:(2===o.wrap?(wn(o,255&r.adler),wn(o,r.adler>>8&255),wn(o,r.adler>>16&255),wn(o,r.adler>>24&255),wn(o,255&r.total_in),wn(o,r.total_in>>8&255),wn(o,r.total_in>>16&255),wn(o,r.total_in>>24&255)):(sa(o,r.adler>>>16),sa(o,65535&r.adler)),Bo(r),o.wrap>0&&(o.wrap=-o.wrap),0!==o.pending?qi:HC)},deflateEnd:r=>{if(Ka(r))return Ga;const i=r.state.status;return r.state=null,113===i?zh(r,Ul):qi},deflateSetDictionary:(r,i)=>{let o=i.length;if(Ka(r))return Ga;const a=r.state,l=a.wrap;if(2===l||1===l&&42!==a.status||a.lookahead)return Ga;if(1===l&&(r.adler=zv(r.adler,i,o,0)),a.wrap=0,o>=a.w_size){0===l&&(eu(a.head),a.strstart=0,a.block_start=0,a.insert=0);let m=new Uint8Array(a.w_size);m.set(i.subarray(o-a.w_size,o),0),i=m,o=a.w_size}const d=r.avail_in,h=r.next_in,f=r.input;for(r.avail_in=o,r.next_in=0,r.input=i,qh(a);a.lookahead>=3;){let m=a.strstart,g=a.lookahead-2;do{a.ins_h=Yi(a,a.ins_h,a.window[m+3-1]),a.prev[m&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=m,m++}while(--g);a.strstart=m,a.lookahead=2,qh(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,r.next_in=h,r.input=f,r.avail_in=d,a.wrap=l,qi},deflateInfo:"pako deflate (from Nodeca project)"};const KC=(r,i)=>Object.prototype.hasOwnProperty.call(r,i);var qC={assign:function(r){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const o=i.shift();if(o){if("object"!=typeof o)throw new TypeError(o+"must be non-object");for(const a in o)KC(o,a)&&(r[a]=o[a])}}return r},flattenChunks:r=>{let i=0;for(let a=0,l=r.length;a<l;a++)i+=r[a].length;const o=new Uint8Array(i);for(let a=0,l=0,d=r.length;a<d;a++){let h=r[a];o.set(h,l),l+=h.length}return o}};let Kv=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Kv=!1}const Bl=new Uint8Array(256);for(let r=0;r<256;r++)Bl[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;Bl[254]=Bl[254]=1;var cm={string2buf:r=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(r);let i,o,a,l,d,h=r.length,f=0;for(l=0;l<h;l++)o=r.charCodeAt(l),55296==(64512&o)&&l+1<h&&(a=r.charCodeAt(l+1),56320==(64512&a)&&(o=65536+(o-55296<<10)+(a-56320),l++)),f+=o<128?1:o<2048?2:o<65536?3:4;for(i=new Uint8Array(f),d=0,l=0;d<f;l++)o=r.charCodeAt(l),55296==(64512&o)&&l+1<h&&(a=r.charCodeAt(l+1),56320==(64512&a)&&(o=65536+(o-55296<<10)+(a-56320),l++)),o<128?i[d++]=o:o<2048?(i[d++]=192|o>>>6,i[d++]=128|63&o):o<65536?(i[d++]=224|o>>>12,i[d++]=128|o>>>6&63,i[d++]=128|63&o):(i[d++]=240|o>>>18,i[d++]=128|o>>>12&63,i[d++]=128|o>>>6&63,i[d++]=128|63&o);return i},buf2string:(r,i)=>{const o=i||r.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(r.subarray(0,i));let a,l;const d=new Array(2*o);for(l=0,a=0;a<o;){let h=r[a++];if(h<128){d[l++]=h;continue}let f=Bl[h];if(f>4)d[l++]=65533,a+=f-1;else{for(h&=2===f?31:3===f?15:7;f>1&&a<o;)h=h<<6|63&r[a++],f--;f>1?d[l++]=65533:h<65536?d[l++]=h:(h-=65536,d[l++]=55296|h>>10&1023,d[l++]=56320|1023&h)}}return((h,f)=>{if(f<65534&&h.subarray&&Kv)return String.fromCharCode.apply(null,h.length===f?h:h.subarray(0,f));let m="";for(let g=0;g<f;g++)m+=String.fromCharCode(h[g]);return m})(d,l)},utf8border:(r,i)=>{(i=i||r.length)>r.length&&(i=r.length);let o=i-1;for(;o>=0&&128==(192&r[o]);)o--;return o<0||0===o?i:o+Bl[r[o]]>i?o:i}},qv=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const YF=Object.prototype.toString,{Z_NO_FLUSH:mO,Z_SYNC_FLUSH:YC,Z_FULL_FLUSH:$F,Z_FINISH:XF,Z_OK:$C,Z_STREAM_END:R6,Z_DEFAULT_COMPRESSION:A6,Z_DEFAULT_STRATEGY:gO,Z_DEFLATED:D6}=im;function Yv(r){this.options=qC.assign({level:A6,method:D6,chunkSize:16384,windowBits:15,memLevel:8,strategy:gO},r||{});let i=this.options;i.raw&&i.windowBits>0?i.windowBits=-i.windowBits:i.gzip&&i.windowBits>0&&i.windowBits<16&&(i.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new qv,this.strm.avail_out=0;let o=Mc.deflateInit2(this.strm,i.level,i.method,i.windowBits,i.memLevel,i.strategy);if(o!==$C)throw new Error(Fl[o]);if(i.header&&Mc.deflateSetHeader(this.strm,i.header),i.dictionary){let a;if(a="string"==typeof i.dictionary?cm.string2buf(i.dictionary):"[object ArrayBuffer]"===YF.call(i.dictionary)?new Uint8Array(i.dictionary):i.dictionary,o=Mc.deflateSetDictionary(this.strm,a),o!==$C)throw new Error(Fl[o]);this._dict_set=!0}}function _O(r,i){const o=new Yv(i);if(o.push(r,!0),o.err)throw o.msg||Fl[o.err];return o.result}Yv.prototype.push=function(r,i){const o=this.strm,a=this.options.chunkSize;let l,d;if(this.ended)return!1;for(d=i===~~i?i:!0===i?XF:mO,o.input="string"==typeof r?cm.string2buf(r):"[object ArrayBuffer]"===YF.call(r)?new Uint8Array(r):r,o.next_in=0,o.avail_in=o.input.length;;)if(0===o.avail_out&&(o.output=new Uint8Array(a),o.next_out=0,o.avail_out=a),(d===YC||d===$F)&&o.avail_out<=6)this.onData(o.output.subarray(0,o.next_out)),o.avail_out=0;else{if(l=Mc.deflate(o,d),l===R6)return o.next_out>0&&this.onData(o.output.subarray(0,o.next_out)),l=Mc.deflateEnd(this.strm),this.onEnd(l),this.ended=!0,l===$C;if(0!==o.avail_out){if(d>0&&o.next_out>0)this.onData(o.output.subarray(0,o.next_out)),o.avail_out=0;else if(0===o.avail_in)break}else this.onData(o.output)}return!0},Yv.prototype.onData=function(r){this.chunks.push(r)},Yv.prototype.onEnd=function(r){r===$C&&(this.result=qC.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};var O6={Deflate:Yv,deflate:_O,deflateRaw:function(r,i){return(i=i||{}).raw=!0,_O(r,i)},gzip:function(r,i){return(i=i||{}).gzip=!0,_O(r,i)},constants:im};const XC=16209;var N6=function(r,i){let o,a,l,d,h,f,m,g,v,y,b,C,P,R,A,O,M,x,j,W,q,te,J,X;const Ce=r.state;o=r.next_in,J=r.input,a=o+(r.avail_in-5),l=r.next_out,X=r.output,d=l-(i-r.avail_out),h=l+(r.avail_out-257),f=Ce.dmax,m=Ce.wsize,g=Ce.whave,v=Ce.wnext,y=Ce.window,b=Ce.hold,C=Ce.bits,P=Ce.lencode,R=Ce.distcode,A=(1<<Ce.lenbits)-1,O=(1<<Ce.distbits)-1;e:do{C<15&&(b+=J[o++]<<C,C+=8,b+=J[o++]<<C,C+=8),M=P[b&A];t:for(;;){if(x=M>>>24,b>>>=x,C-=x,x=M>>>16&255,0===x)X[l++]=65535&M;else{if(!(16&x)){if(!(64&x)){M=P[(65535&M)+(b&(1<<x)-1)];continue t}if(32&x){Ce.mode=16191;break e}r.msg="invalid literal/length code",Ce.mode=XC;break e}j=65535&M,x&=15,x&&(C<x&&(b+=J[o++]<<C,C+=8),j+=b&(1<<x)-1,b>>>=x,C-=x),C<15&&(b+=J[o++]<<C,C+=8,b+=J[o++]<<C,C+=8),M=R[b&O];n:for(;;){if(x=M>>>24,b>>>=x,C-=x,x=M>>>16&255,!(16&x)){if(!(64&x)){M=R[(65535&M)+(b&(1<<x)-1)];continue n}r.msg="invalid distance code",Ce.mode=XC;break e}if(W=65535&M,x&=15,C<x&&(b+=J[o++]<<C,C+=8,C<x&&(b+=J[o++]<<C,C+=8)),W+=b&(1<<x)-1,W>f){r.msg="invalid distance too far back",Ce.mode=XC;break e}if(b>>>=x,C-=x,x=l-d,W>x){if(x=W-x,x>g&&Ce.sane){r.msg="invalid distance too far back",Ce.mode=XC;break e}if(q=0,te=y,0===v){if(q+=m-x,x<j){j-=x;do{X[l++]=y[q++]}while(--x);q=l-W,te=X}}else if(v<x){if(q+=m+v-x,x-=v,x<j){j-=x;do{X[l++]=y[q++]}while(--x);if(q=0,v<j){x=v,j-=x;do{X[l++]=y[q++]}while(--x);q=l-W,te=X}}}else if(q+=v-x,x<j){j-=x;do{X[l++]=y[q++]}while(--x);q=l-W,te=X}for(;j>2;)X[l++]=te[q++],X[l++]=te[q++],X[l++]=te[q++],j-=3;j&&(X[l++]=te[q++],j>1&&(X[l++]=te[q++]))}else{q=l-W;do{X[l++]=X[q++],X[l++]=X[q++],X[l++]=X[q++],j-=3}while(j>2);j&&(X[l++]=X[q++],j>1&&(X[l++]=X[q++]))}break}}break}}while(o<a&&l<h);j=C>>3,o-=j,C-=j<<3,b&=(1<<C)-1,r.next_in=o,r.next_out=l,r.avail_in=o<a?a-o+5:5-(o-a),r.avail_out=l<h?h-l+257:257-(l-h),Ce.hold=b,Ce.bits=C};const ZF=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),JF=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),P6=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),$h=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var $v=(r,i,o,a,l,d,h,f)=>{const m=f.bits;let g,v,y,b,C,P,R=0,A=0,O=0,M=0,x=0,j=0,W=0,q=0,te=0,J=0,X=null;const Ce=new Uint16Array(16),Re=new Uint16Array(16);let ut,Nt,_n,Zt=null;for(R=0;R<=15;R++)Ce[R]=0;for(A=0;A<a;A++)Ce[i[o+A]]++;for(x=m,M=15;M>=1&&0===Ce[M];M--);if(x>M&&(x=M),0===M)return l[d++]=20971520,l[d++]=20971520,f.bits=1,0;for(O=1;O<M&&0===Ce[O];O++);for(x<O&&(x=O),q=1,R=1;R<=15;R++)if(q<<=1,q-=Ce[R],q<0)return-1;if(q>0&&(0===r||1!==M))return-1;for(Re[1]=0,R=1;R<15;R++)Re[R+1]=Re[R]+Ce[R];for(A=0;A<a;A++)0!==i[o+A]&&(h[Re[i[o+A]]++]=A);if(0===r?(X=Zt=h,P=20):1===r?(X=ZF,Zt=JF,P=257):(X=P6,Zt=$h,P=0),J=0,A=0,R=O,C=d,j=x,W=0,y=-1,te=1<<x,b=te-1,1===r&&te>852||2===r&&te>592)return 1;for(;;){ut=R-W,h[A]+1<P?(Nt=0,_n=h[A]):h[A]>=P?(Nt=Zt[h[A]-P],_n=X[h[A]-P]):(Nt=96,_n=0),g=1<<R-W,v=1<<j,O=v;do{v-=g,l[C+(J>>W)+v]=ut<<24|Nt<<16|_n}while(0!==v);for(g=1<<R-1;J&g;)g>>=1;if(0!==g?(J&=g-1,J+=g):J=0,A++,0==--Ce[R]){if(R===M)break;R=i[o+h[A]]}if(R>x&&(J&b)!==y){for(0===W&&(W=x),C+=O,j=R-W,q=1<<j;j+W<M&&(q-=Ce[j+W],!(q<=0));)j++,q<<=1;if(te+=1<<j,1===r&&te>852||2===r&&te>592)return 1;y=J&b,l[y]=x<<24|j<<16|C-d}}return 0!==J&&(l[C+J]=R-W<<24|64<<16),f.bits=x,0};const{Z_FINISH:vO,Z_BLOCK:QF,Z_TREES:Xh,Z_OK:qa,Z_STREAM_END:EO,Z_NEED_DICT:eU,Z_STREAM_ERROR:Ps,Z_DATA_ERROR:tU,Z_MEM_ERROR:Xv,Z_BUF_ERROR:M6,Z_DEFLATED:nU}=im,JC=16180,Zv=16190,Ms=16191,QC=16199,Qv=16200,Qn=16209,Jt=r=>(r>>>24&255)+(r>>>8&65280)+((65280&r)<<8)+((255&r)<<24);function kc(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const jl=r=>{if(!r)return 1;const i=r.state;return!i||i.strm!==r||i.mode<JC||i.mode>16211?1:0},tu=r=>{if(jl(r))return Ps;const i=r.state;return r.total_in=r.total_out=i.total=0,r.msg="",i.wrap&&(r.adler=1&i.wrap),i.mode=JC,i.last=0,i.havedict=0,i.flags=-1,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Int32Array(852),i.distcode=i.distdyn=new Int32Array(592),i.sane=1,i.back=-1,qa},ps=r=>{if(jl(r))return Ps;const i=r.state;return i.wsize=0,i.whave=0,i.wnext=0,tu(r)},tT=(r,i)=>{let o;if(jl(r))return Ps;const a=r.state;return i<0?(o=0,i=-i):(o=5+(i>>4),i<48&&(i&=15)),i&&(i<8||i>15)?Ps:(null!==a.window&&a.wbits!==i&&(a.window=null),a.wrap=o,a.wbits=i,ps(r))},nu=(r,i)=>{if(!r)return Ps;const o=new kc;r.state=o,o.strm=r,o.window=null,o.mode=JC;const a=tT(r,i);return a!==qa&&(r.state=null),a};let Zh,eE,bO=!0;const k6=r=>{if(bO){Zh=new Int32Array(512),eE=new Int32Array(32);let i=0;for(;i<144;)r.lens[i++]=8;for(;i<256;)r.lens[i++]=9;for(;i<280;)r.lens[i++]=7;for(;i<288;)r.lens[i++]=8;for($v(1,r.lens,0,288,Zh,0,r.work,{bits:9}),i=0;i<32;)r.lens[i++]=5;$v(2,r.lens,0,32,eE,0,r.work,{bits:5}),bO=!1}r.lencode=Zh,r.lenbits=9,r.distcode=eE,r.distbits=5},rU=(r,i,o,a)=>{let l;const d=r.state;return null===d.window&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),a>=d.wsize?(d.window.set(i.subarray(o-d.wsize,o),0),d.wnext=0,d.whave=d.wsize):(l=d.wsize-d.wnext,l>a&&(l=a),d.window.set(i.subarray(o-a,o-a+l),d.wnext),(a-=l)?(d.window.set(i.subarray(o-a,o),0),d.wnext=a,d.whave=d.wsize):(d.wnext+=l,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=l))),0};var Hl={inflateReset:ps,inflateReset2:tT,inflateResetKeep:tu,inflateInit:r=>nu(r,15),inflateInit2:nu,inflate:(r,i)=>{let o,a,l,d,h,f,m,g,v,y,b,C,P,R,A,O,M,x,j,W,q,te,J=0;const X=new Uint8Array(4);let Ce,Re;const ut=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(jl(r)||!r.output||!r.input&&0!==r.avail_in)return Ps;o=r.state,o.mode===Ms&&(o.mode=16192),h=r.next_out,l=r.output,m=r.avail_out,d=r.next_in,a=r.input,f=r.avail_in,g=o.hold,v=o.bits,y=f,b=m,te=qa;e:for(;;)switch(o.mode){case JC:if(0===o.wrap){o.mode=16192;break}for(;v<16;){if(0===f)break e;f--,g+=a[d++]<<v,v+=8}if(2&o.wrap&&35615===g){0===o.wbits&&(o.wbits=15),o.check=0,X[0]=255&g,X[1]=g>>>8&255,o.check=Si(o.check,X,2,0),g=0,v=0,o.mode=16181;break}if(o.head&&(o.head.done=!1),!(1&o.wrap)||(((255&g)<<8)+(g>>8))%31){r.msg="incorrect header check",o.mode=Qn;break}if((15&g)!==nU){r.msg="unknown compression method",o.mode=Qn;break}if(g>>>=4,v-=4,q=8+(15&g),0===o.wbits&&(o.wbits=q),q>15||q>o.wbits){r.msg="invalid window size",o.mode=Qn;break}o.dmax=1<<o.wbits,o.flags=0,r.adler=o.check=1,o.mode=512&g?16189:Ms,g=0,v=0;break;case 16181:for(;v<16;){if(0===f)break e;f--,g+=a[d++]<<v,v+=8}if(o.flags=g,(255&hi(o))!==nU){r.msg="unknown compression method",o.mode=Qn;break}if(57344&hi(o)){r.msg="unknown header flags set",o.mode=Qn;break}o.head&&(o.head.text=g>>8&1),512&hi(o)&&4&o.wrap&&(X[0]=255&g,X[1]=g>>>8&255,o.check=Si(o.check,X,2,0)),g=0,v=0,o.mode=16182;case 16182:for(;v<32;){if(0===f)break e;f--,g+=a[d++]<<v,v+=8}o.head&&(o.head.time=g),512&hi(o)&&4&o.wrap&&(X[0]=255&g,X[1]=g>>>8&255,X[2]=g>>>16&255,X[3]=g>>>24&255,o.check=Si(o.check,X,4,0)),g=0,v=0,o.mode=16183;case 16183:for(;v<16;){if(0===f)break e;f--,g+=a[d++]<<v,v+=8}o.head&&(o.head.xflags=255&g,o.head.os=g>>8),512&hi(o)&&4&o.wrap&&(X[0]=255&g,X[1]=g>>>8&255,o.check=Si(o.check,X,2,0)),g=0,v=0,o.mode=16184;case 16184:if(1024&hi(o)){for(;v<16;){if(0===f)break e;f--,g+=a[d++]<<v,v+=8}o.length=g,o.head&&(o.head.extra_len=g),512&hi(o)&&4&o.wrap&&(X[0]=255&g,X[1]=g>>>8&255,o.check=Si(o.check,X,2,0)),g=0,v=0}else o.head&&(o.head.extra=null);o.mode=16185;case 16185:if(1024&hi(o)&&(C=o.length,C>f&&(C=f),C&&(o.head&&(q=o.head.extra_len-o.length,o.head.extra||(o.head.extra=new Uint8Array(o.head.extra_len)),o.head.extra.set(a.subarray(d,d+C),q)),512&hi(o)&&4&o.wrap&&(o.check=Si(o.check,a,C,d)),f-=C,d+=C,o.length-=C),o.length))break e;o.length=0,o.mode=16186;case 16186:if(2048&hi(o)){if(0===f)break e;C=0;do{q=a[d+C++],o.head&&q&&o.length<65536&&(o.head.name+=String.fromCharCode(q))}while(q&&C<f);if(512&hi(o)&&4&o.wrap&&(o.check=Si(o.check,a,C,d)),f-=C,d+=C,q)break e}else o.head&&(o.head.name=null);o.length=0,o.mode=16187;case 16187:if(4096&hi(o)){if(0===f)break e;C=0;do{q=a[d+C++],o.head&&q&&o.length<65536&&(o.head.comment+=String.fromCharCode(q))}while(q&&C<f);if(512&hi(o)&&4&o.wrap&&(o.check=Si(o.check,a,C,d)),f-=C,d+=C,q)break e}else o.head&&(o.head.comment=null);o.mode=16188;case 16188:if(512&hi(o)){for(;v<16;){if(0===f)break e;f--,g+=a[d++]<<v,v+=8}if(4&o.wrap&&g!==(65535&o.check)){r.msg="header crc mismatch",o.mode=Qn;break}g=0,v=0}o.head&&(o.head.hcrc=hi(o)>>9&1,o.head.done=!0),r.adler=o.check=0,o.mode=Ms;break;case 16189:for(;v<32;){if(0===f)break e;f--,g+=a[d++]<<v,v+=8}r.adler=o.check=Jt(g),g=0,v=0,o.mode=Zv;case Zv:if(0===o.havedict)return r.next_out=h,r.avail_out=m,r.next_in=d,r.avail_in=f,o.hold=g,o.bits=v,eU;r.adler=o.check=1,o.mode=Ms;case Ms:if(i===QF||i===Xh)break e;case 16192:if(o.last){g>>>=7&v,v-=7&v,o.mode=16206;break}for(;v<3;){if(0===f)break e;f--,g+=a[d++]<<v,v+=8}switch(o.last=1&g,g>>>=1,v-=1,3&g){case 0:o.mode=16193;break;case 1:if(k6(o),o.mode=QC,i===Xh){g>>>=2,v-=2;break e}break;case 2:o.mode=16196;break;case 3:r.msg="invalid block type",o.mode=Qn}g>>>=2,v-=2;break;case 16193:for(g>>>=7&v,v-=7&v;v<32;){if(0===f)break e;f--,g+=a[d++]<<v,v+=8}if((65535&g)!=(g>>>16^65535)){r.msg="invalid stored block lengths",o.mode=Qn;break}if(o.length=65535&g,g=0,v=0,o.mode=16194,i===Xh)break e;case 16194:o.mode=16195;case 16195:if(C=o.length,C){if(C>f&&(C=f),C>m&&(C=m),0===C)break e;l.set(a.subarray(d,d+C),h),f-=C,d+=C,m-=C,h+=C,o.length-=C;break}o.mode=Ms;break;case 16196:for(;v<14;){if(0===f)break e;f--,g+=a[d++]<<v,v+=8}if(o.nlen=257+(31&g),g>>>=5,v-=5,o.ndist=1+(31&g),g>>>=5,v-=5,o.ncode=4+(15&g),g>>>=4,v-=4,o.nlen>286||o.ndist>30){r.msg="too many length or distance symbols",o.mode=Qn;break}o.have=0,o.mode=16197;case 16197:for(;o.have<o.ncode;){for(;v<3;){if(0===f)break e;f--,g+=a[d++]<<v,v+=8}o.lens[ut[o.have++]]=7&g,g>>>=3,v-=3}for(;o.have<19;)o.lens[ut[o.have++]]=0;if(o.lencode=o.lendyn,o.lenbits=7,Ce={bits:o.lenbits},te=$v(0,o.lens,0,19,o.lencode,0,o.work,Ce),o.lenbits=Ce.bits,te){r.msg="invalid code lengths set",o.mode=Qn;break}o.have=0,o.mode=16198;case 16198:for(;o.have<o.nlen+o.ndist;){for(;J=o.lencode[g&(1<<o.lenbits)-1],A=J>>>24,O=J>>>16&255,M=65535&J,!(A<=v);){if(0===f)break e;f--,g+=a[d++]<<v,v+=8}if(M<16)g>>>=A,v-=A,o.lens[o.have++]=M;else{if(16===M){for(Re=A+2;v<Re;){if(0===f)break e;f--,g+=a[d++]<<v,v+=8}if(g>>>=A,v-=A,0===o.have){r.msg="invalid bit length repeat",o.mode=Qn;break}q=o.lens[o.have-1],C=3+(3&g),g>>>=2,v-=2}else if(17===M){for(Re=A+3;v<Re;){if(0===f)break e;f--,g+=a[d++]<<v,v+=8}g>>>=A,v-=A,q=0,C=3+(7&g),g>>>=3,v-=3}else{for(Re=A+7;v<Re;){if(0===f)break e;f--,g+=a[d++]<<v,v+=8}g>>>=A,v-=A,q=0,C=11+(127&g),g>>>=7,v-=7}if(o.have+C>o.nlen+o.ndist){r.msg="invalid bit length repeat",o.mode=Qn;break}for(;C--;)o.lens[o.have++]=q}}if(o.mode===Qn)break;if(0===o.lens[256]){r.msg="invalid code -- missing end-of-block",o.mode=Qn;break}if(o.lenbits=9,Ce={bits:o.lenbits},te=$v(1,o.lens,0,o.nlen,o.lencode,0,o.work,Ce),o.lenbits=Ce.bits,te){r.msg="invalid literal/lengths set",o.mode=Qn;break}if(o.distbits=6,o.distcode=o.distdyn,Ce={bits:o.distbits},te=$v(2,o.lens,o.nlen,o.ndist,o.distcode,0,o.work,Ce),o.distbits=Ce.bits,te){r.msg="invalid distances set",o.mode=Qn;break}if(o.mode=QC,i===Xh)break e;case QC:o.mode=Qv;case Qv:if(f>=6&&m>=258){r.next_out=h,r.avail_out=m,r.next_in=d,r.avail_in=f,o.hold=g,o.bits=v,N6(r,b),h=r.next_out,l=r.output,m=r.avail_out,d=r.next_in,a=r.input,f=r.avail_in,g=o.hold,v=o.bits,o.mode===Ms&&(o.back=-1);break}for(o.back=0;J=o.lencode[g&(1<<o.lenbits)-1],A=J>>>24,O=J>>>16&255,M=65535&J,!(A<=v);){if(0===f)break e;f--,g+=a[d++]<<v,v+=8}if(O&&!(240&O)){for(x=A,j=O,W=M;J=o.lencode[W+((g&(1<<x+j)-1)>>x)],A=J>>>24,O=J>>>16&255,M=65535&J,!(x+A<=v);){if(0===f)break e;f--,g+=a[d++]<<v,v+=8}g>>>=x,v-=x,o.back+=x}if(g>>>=A,v-=A,o.back+=A,o.length=M,0===O){o.mode=16205;break}if(32&O){o.back=-1,o.mode=Ms;break}if(64&O){r.msg="invalid literal/length code",o.mode=Qn;break}o.extra=15&O,o.mode=16201;case 16201:if(o.extra){for(Re=o.extra;v<Re;){if(0===f)break e;f--,g+=a[d++]<<v,v+=8}o.length+=g&(1<<o.extra)-1,g>>>=o.extra,v-=o.extra,o.back+=o.extra}o.was=o.length,o.mode=16202;case 16202:for(;J=o.distcode[g&(1<<o.distbits)-1],A=J>>>24,O=J>>>16&255,M=65535&J,!(A<=v);){if(0===f)break e;f--,g+=a[d++]<<v,v+=8}if(!(240&O)){for(x=A,j=O,W=M;J=o.distcode[W+((g&(1<<x+j)-1)>>x)],A=J>>>24,O=J>>>16&255,M=65535&J,!(x+A<=v);){if(0===f)break e;f--,g+=a[d++]<<v,v+=8}g>>>=x,v-=x,o.back+=x}if(g>>>=A,v-=A,o.back+=A,64&O){r.msg="invalid distance code",o.mode=Qn;break}o.offset=M,o.extra=15&O,o.mode=16203;case 16203:if(o.extra){for(Re=o.extra;v<Re;){if(0===f)break e;f--,g+=a[d++]<<v,v+=8}o.offset+=g&(1<<o.extra)-1,g>>>=o.extra,v-=o.extra,o.back+=o.extra}if(o.offset>o.dmax){r.msg="invalid distance too far back",o.mode=Qn;break}o.mode=16204;case 16204:if(0===m)break e;if(C=b-m,o.offset>C){if(C=o.offset-C,C>o.whave&&o.sane){r.msg="invalid distance too far back",o.mode=Qn;break}C>o.wnext?(C-=o.wnext,P=o.wsize-C):P=o.wnext-C,C>o.length&&(C=o.length),R=o.window}else R=l,P=h-o.offset,C=o.length;C>m&&(C=m),m-=C,o.length-=C;do{l[h++]=R[P++]}while(--C);0===o.length&&(o.mode=Qv);break;case 16205:if(0===m)break e;l[h++]=o.length,m--,o.mode=Qv;break;case 16206:if(o.wrap){for(;v<32;){if(0===f)break e;f--,g|=a[d++]<<v,v+=8}if(b-=m,r.total_out+=b,o.total+=b,4&o.wrap&&b&&(r.adler=o.check=hi(o)?Si(o.check,l,b,h-b):zv(o.check,l,b,h-b)),b=m,4&o.wrap&&(hi(o)?g:Jt(g))!==o.check){r.msg="incorrect data check",o.mode=Qn;break}g=0,v=0}o.mode=16207;case 16207:if(o.wrap&&hi(o)){for(;v<32;){if(0===f)break e;f--,g+=a[d++]<<v,v+=8}if(4&o.wrap&&g!==(4294967295&o.total)){r.msg="incorrect length check",o.mode=Qn;break}g=0,v=0}o.mode=16208;case 16208:te=EO;break e;case Qn:te=tU;break e;case 16210:return Xv;default:return Ps}return r.next_out=h,r.avail_out=m,r.next_in=d,r.avail_in=f,o.hold=g,o.bits=v,(o.wsize||b!==r.avail_out&&o.mode<Qn&&(o.mode<16206||i!==vO))&&rU(r,r.output,r.next_out,b-r.avail_out),y-=r.avail_in,b-=r.avail_out,r.total_in+=y,r.total_out+=b,o.total+=b,4&o.wrap&&b&&(r.adler=o.check=hi(o)?Si(o.check,l,b,r.next_out-b):zv(o.check,l,b,r.next_out-b)),r.data_type=o.bits+(o.last?64:0)+(o.mode===Ms?128:0)+(o.mode===QC||16194===o.mode?256:0),(0===y&&0===b||i===vO)&&te===qa&&(te=M6),te},inflateEnd:r=>{if(jl(r))return Ps;let i=r.state;return i.window&&(i.window=null),r.state=null,qa},inflateGetHeader:(r,i)=>{if(jl(r))return Ps;const o=r.state;return 2&o.wrap?(o.head=i,i.done=!1,qa):Ps},inflateSetDictionary:(r,i)=>{const o=i.length;let a,l,d;return jl(r)?Ps:(a=r.state,0!==a.wrap&&a.mode!==Zv?Ps:a.mode===Zv&&(l=1,l=zv(l,i,o,0),l!==a.check)?tU:(d=rU(r,i,o,o),d?(a.mode=16210,Xv):(a.havedict=1,qa)))},inflateInfo:"pako inflate (from Nodeca project)"},x6=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const iU=Object.prototype.toString,{Z_NO_FLUSH:F6,Z_FINISH:U6,Z_OK:tE,Z_STREAM_END:SO,Z_NEED_DICT:oU,Z_STREAM_ERROR:CO,Z_DATA_ERROR:nE,Z_MEM_ERROR:xz}=im;function rE(r){this.options=qC.assign({chunkSize:65536,windowBits:15,to:""},r||{});const i=this.options;i.raw&&i.windowBits>=0&&i.windowBits<16&&(i.windowBits=-i.windowBits,0===i.windowBits&&(i.windowBits=-15)),!(i.windowBits>=0&&i.windowBits<16)||r&&r.windowBits||(i.windowBits+=32),i.windowBits>15&&i.windowBits<48&&!(15&i.windowBits)&&(i.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new qv,this.strm.avail_out=0;let o=Hl.inflateInit2(this.strm,i.windowBits);if(o!==tE)throw new Error(Fl[o]);if(this.header=new x6,Hl.inflateGetHeader(this.strm,this.header),i.dictionary&&("string"==typeof i.dictionary?i.dictionary=cm.string2buf(i.dictionary):"[object ArrayBuffer]"===iU.call(i.dictionary)&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw&&(o=Hl.inflateSetDictionary(this.strm,i.dictionary),o!==tE)))throw new Error(Fl[o])}function sU(r,i){const o=new rE(i);if(o.push(r),o.err)throw o.msg||Fl[o.err];return o.result}rE.prototype.push=function(r,i){const o=this.strm,a=this.options.chunkSize,l=this.options.dictionary;let d,h,f;if(this.ended)return!1;for(h=i===~~i?i:!0===i?U6:F6,o.input="[object ArrayBuffer]"===iU.call(r)?new Uint8Array(r):r,o.next_in=0,o.avail_in=o.input.length;;){for(0===o.avail_out&&(o.output=new Uint8Array(a),o.next_out=0,o.avail_out=a),d=Hl.inflate(o,h),d===oU&&l&&(d=Hl.inflateSetDictionary(o,l),d===tE?d=Hl.inflate(o,h):d===nE&&(d=oU));o.avail_in>0&&d===SO&&o.state.wrap>0&&0!==r[o.next_in];)Hl.inflateReset(o),d=Hl.inflate(o,h);switch(d){case CO:case nE:case oU:case xz:return this.onEnd(d),this.ended=!0,!1}if(f=o.avail_out,o.next_out&&(0===o.avail_out||d===SO))if("string"===this.options.to){let m=cm.utf8border(o.output,o.next_out),g=o.next_out-m,v=cm.buf2string(o.output,m);o.next_out=g,o.avail_out=a-g,g&&o.output.set(o.output.subarray(m,m+g),0),this.onData(v)}else this.onData(o.output.length===o.next_out?o.output:o.output.subarray(0,o.next_out));if(d!==tE||0!==f){if(d===SO)return d=Hl.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(0===o.avail_in)break}}return!0},rE.prototype.onData=function(r){this.chunks.push(r)},rE.prototype.onEnd=function(r){r===tE&&(this.result="string"===this.options.to?this.chunks.join(""):qC.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};var Fz={Inflate:rE,inflate:sU,inflateRaw:function(r,i){return(i=i||{}).raw=!0,sU(r,i)},ungzip:sU,constants:im};const{deflate:Uz}=O6,{inflate:V6}=Fz;var iE=Uz,B6=V6,lm=function(r){return r[r.ONE_BYTE=0]="ONE_BYTE",r[r.TWO_BYTE=1]="TWO_BYTE",r}(lm||{});class aU{constructor(){N(this,"_sequence",0),N(this,"_startTime",Date.now()),N(this,"isUseOneByte",!0)}get startTime(){const i=Date.now()-this._startTime;return i<Math.pow(2,16)?i:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(i){const o={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:i};if(i.byteLength>128){const f=new Uint8Array(4);f.set([1,0,0,0]);const g={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[{id:0,length:4,data:f.buffer}]};o.commonPacketHeader.extension=1,o.extension=g,o.payload=this.compress(i),o.commonPacketHeader.length=8+(o.extension.length+2)+o.payload.byteLength}else o.commonPacketHeader.length=8+o.payload.byteLength;B("SHOW_DATASTREAM2_LOG")&&T.debug("send data header: ".concat(JSON.stringify(o.commonPacketHeader)));const a=new ArrayBuffer(o.commonPacketHeader.length),l=new Uint8Array(a),d=new DataView(a);let h=0;if(d.setUint16(h,o.commonPacketHeader.extension<<15|o.commonPacketHeader.reserved<<14|o.commonPacketHeader.length,!0),h+=2,d.setUint32(h,o.commonPacketHeader.sequence,!0),h+=4,d.setUint16(h,o.commonStreamHeader,!0),h+=2,o.extension){const f=this.serializeExtension(o.extension);l.set(new Uint8Array(f),h),h+=f.byteLength}if(l.set(new Uint8Array(o.payload),h),h+=o.payload.byteLength,h!==o.commonPacketHeader.length)throw Error("serialize error!");return a}deserialize(i){if(i.byteLength<4)return new ArrayBuffer(0);const o=new DataView(i);let a=0;const l=o.getUint16(a,!0);a+=2;const d={length:16383&l,reserved:(16384&l)>>14,extension:(32768&l)>>15,sequence:o.getUint16(a+2,!0)<<16|o.getUint16(a,!0)};let h,f;if(a+=4,B("SHOW_DATASTREAM2_LOG")&&T.debug("receive data header: ".concat(JSON.stringify(d))),o.getUint16(a,!0),a+=2,d.extension){f=this.deserializeExtension(i.slice(a)),a+=2+f.length,h=i.slice(a);let m=!1;if(f.datas.length>0){const g=f.datas.find(v=>0===v.id);g&&(m=!(1&~new DataView(g.data).getUint32(0,!0)))}h=m?this.decompress(h):h}else h=i.slice(8);return h}serializeExtension(i){const{profile:o,length:a,datas:l}=i,d=new ArrayBuffer(a+2),h=new Uint8Array(d),f=new DataView(d);let m=0;if(f.setUint8(m++,o),f.setUint8(m++,a),l.forEach(g=>{o?(f.setUint8(m++,g.id),f.setUint8(m++,g.length),h.set(new Uint8Array(g.data),m),m+=g.data.byteLength):(f.setUint8(m++,g.id|g.length<<4),h.set(new Uint8Array(g.data),m),m+=g.data.byteLength)}),m!==a+2)throw Error("serialize extension error, is ".concat(m,"!==").concat(a+2));return d}deserializeExtension(i){const o=new DataView(i);let a=0;const l=o.getUint8(a);a++;const d=o.getUint8(a);a++;const h=l===lm.TWO_BYTE,f=[],m=new DataView(i,2);let g=0;for(;g<d;){let v=0,y=0,b=new ArrayBuffer(0);h?(v=m.getUint8(g),g++,y=m.getUint8(g),g++):(v=15&m.getUint8(g),y=m.getUint8(g)>>4,g++),y>0&&(b=m.buffer.slice(g+2,g+2+y),g+=b.byteLength),f.push({id:v,length:y,data:b})}if(g!==d)throw Error("parse error");return{profile:l,length:d,datas:f}}decompress(i){return B6(new Uint8Array(i))}compress(i){return iE(new Uint8Array(i))}}const TO={name:"DataStream",create:(r,i)=>{const o=i?new ar(r):new Rs(r);return o.useDataStream(new aU),o}};class wO extends nn{constructor(i,o,a){super(),N(this,"ws",void 0),N(this,"requestId",1),N(this,"heartBeatTimer",void 0),N(this,"joinInfo",void 0),N(this,"clientId",void 0),N(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),N(this,"onClose",l=>{this.emit("close"),this.dispose()}),N(this,"onMessage",l=>{const d=JSON.parse(l.data);if(!d||"serverResponse"!==d.command||!d.requestId)return d&&"serverStatus"===d.command&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)}),this.joinInfo=i,this.clientId=o,this.ws=new j_("cross-channel-".concat(this.clientId),a),this.ws.on(Fe.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Fe.CONNECTED,this.onOpen),this.ws.on(Fe.ON_MESSAGE,this.onMessage),this.ws.on(Fe.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(i){const o=this.requestId++;return i.requestId=o,i.seq=o,this.ws.sendMessage(i),o}waitStatus(i){return new le((o,a)=>{const l=window.setTimeout(()=>{a(new K(k.TIMEOUT,"wait status timeout, status: ".concat(i)))},5e3);this.once(i,d=>{window.clearTimeout(l),d.state&&0!==d.state?a(new K(k.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(i))):o(void 0)}),this.once("dispose",()=>{window.clearTimeout(l),a(new K(k.WS_ABORT))})})}request(i){var o=this;return L(function*(){if("closed"===o.ws.state)throw new K(k.WS_DISCONNECT);"connected"!==o.ws.state&&(yield new le((f,m)=>{o.ws.once(Fe.CLOSED,()=>m(new K(k.WS_ABORT))),o.ws.once(Fe.CONNECTED,f)}));const l=o.sendMessage(i),d=new le((f,m)=>{const g=()=>{m(new K(k.WS_ABORT))};o.ws.once(Fe.RECONNECTING,g),o.ws.once(Fe.CLOSED,g),o.once("req_".concat(l),f),wr(3e3).then(()=>{o.removeAllListeners("req_".concat(l)),o.ws.off(Fe.RECONNECTING,g),o.ws.off(Fe.CLOSED,g),m(new K(k.TIMEOUT,"cross channel ws request timeout"))})}),h=yield d;if(!h||200!==h.code)throw new K(k.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(h)));return h})()}connect(i){var o=this;return L(function*(){o.ws.removeAllListeners(Fe.REQUEST_NEW_URLS),o.ws.on(Fe.REQUEST_NEW_URLS,a=>{a(i)}),yield o.ws.init(i)})()}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(i){const o=this.requestId++;return i.requestId=o,this.ws.sendMessage(i),o}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Ya extends nn{set state(i){i!==this._state&&(i!==lo.RELAY_STATE_FAILURE&&(this.errorCode=Nf.RELAY_OK),this.emit("state",i,this.errorCode),this._state=i)}get state(){return this._state}constructor(i,o,a,l,d){var h;super(),h=this,N(this,"joinInfo",void 0),N(this,"sid",void 0),N(this,"clientId",void 0),N(this,"cancelToken",Oi.CancelToken.source()),N(this,"workerToken",void 0),N(this,"requestId",0),N(this,"signal",void 0),N(this,"prevChannelMediaConfig",void 0),N(this,"httpRetryConfig",void 0),N(this,"_resolution",void 0),N(this,"_state",lo.RELAY_STATE_IDLE),N(this,"errorCode",Nf.RELAY_OK),N(this,"onStatus",f=>{T.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(f))),f&&f.command&&("onAudioPacketReceived"===f.command&&this.emit("event",Cc.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===f.command&&this.emit("event",Cc.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===f.command&&(this.errorCode=Nf.SRC_TOKEN_EXPIRED,this.state=lo.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===f.command&&(this.errorCode=Nf.DEST_TOKEN_EXPIRED,this.state=lo.RELAY_STATE_FAILURE))}),N(this,"onReconnect",L(function*(){T.debug("[".concat(h.clientId,"] ChannelMediaSocket disconnect, reconnecting")),h.emit("event",Cc.NETWORK_DISCONNECTED),h.state=lo.RELAY_STATE_IDLE,h.prevChannelMediaConfig&&h.sendStartRelayMessage(h.prevChannelMediaConfig).catch(f=>{h.state!==lo.RELAY_STATE_IDLE&&(T.error("auto restart channel media relay failed",f.toString()),h.errorCode=Nf.SERVER_CONNECTION_LOST,h.state=lo.RELAY_STATE_FAILURE)})})),this.joinInfo=i,this.clientId=o,this.sid=Rf(),this.signal=new wO(this.joinInfo,this.clientId,a),this.httpRetryConfig=l,this._resolution=d}startChannelMediaRelay(i){var o=this;return L(function*(){if(o.state!==lo.RELAY_STATE_IDLE)throw new K(k.INVALID_OPERATION);o.state=lo.RELAY_STATE_CONNECTING,yield o.connect(),T.debug("[".concat(o.clientId,"] startChannelMediaRelay: connect success"));try{yield o.sendStartRelayMessage(i)}catch(a){throw a.data&&a.data.serverResponse&&"SetSourceChannel"===a.data.serverResponse.command?new K(k.CROSS_CHANNEL_FAILED_JOIN_SRC):a.data&&a.data.serverResponse&&"SetDestChannelStatus"===a.serverResponse.command?new K(k.CROSS_CHANNEL_FAILED_JOIN_DEST):a.data&&a.data.serverResponse&&"StartPacketTransfer"===a.serverResponse.command?new K(k.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):a}o.prevChannelMediaConfig=i})()}updateChannelMediaRelay(i){var o=this;return L(function*(){if(o.state!==lo.RELAY_STATE_RUNNING)throw new K(k.INVALID_OPERATION);yield o.sendUpdateMessage(i),o.prevChannelMediaConfig=i})()}setVideoProfile(i){var o=this;return L(function*(){if(o._resolution=i,o.state!==lo.RELAY_STATE_RUNNING)throw new K(k.INVALID_OPERATION);const a=o.genMessage(fn.SetVideoProfile);yield o.signal.request(a),T.debug("[".concat(o.clientId,"] startChannelMediaRelay: setVideoProfile success"))})()}stopChannelMediaRelay(){var i=this;return L(function*(){yield i.sendStopRelayMessage(),T.debug("[".concat(i.clientId,"] stopChannelMediaRelay: send stop message success")),i.state=lo.RELAY_STATE_IDLE,i.dispose()})()}dispose(){T.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Oi.CancelToken.source(),this.state=lo.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}connect(){var i=this;return L(function*(){const o=yield function w2(r,i,o){return wv.apply(this,arguments)}(i.joinInfo,i.cancelToken.token,i.httpRetryConfig);i.workerToken=o.workerToken,yield i.signal.connect(o.addressList),i.emit("event",Cc.NETWORK_CONNECTED),i.signal.on("status",i.onStatus),i.signal.on("reconnecting",i.onReconnect)})()}sendStartRelayMessage(i){var o=this;return L(function*(){const a=o.genMessage(fn.StopPacketTransfer);yield o.signal.request(a),yield o.signal.waitStatus("Normal Quit"),T.debug("[".concat(o.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const l=o.genMessage(fn.SetSdkProfile,i);yield o.signal.request(l),T.debug("[".concat(o.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const d=o.genMessage(fn.SetSourceChannel,i);yield o.signal.request(d),yield o.signal.waitStatus("SetSourceChannelStatus"),o.emit("event",Cc.PACKET_JOINED_SRC_CHANNEL),T.debug("[".concat(o.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const h=o.genMessage(fn.SetSourceUserId,i);yield o.signal.request(h),T.debug("[".concat(o.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const f=o.genMessage(fn.SetDestChannel,i);yield o.signal.request(f),yield o.signal.waitStatus("SetDestChannelStatus"),o.emit("event",Cc.PACKET_JOINED_DEST_CHANNEL),T.debug("[".concat(o.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=o.genMessage(fn.StartPacketTransfer,i);yield o.signal.request(m),o.emit("event",Cc.PACKET_SENT_TO_DEST_CHANNEL),o.state=lo.RELAY_STATE_RUNNING,T.debug("[".concat(o.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),o.setVideoProfile(o._resolution)})()}sendUpdateMessage(i){var o=this;return L(function*(){const a=o.genMessage(fn.UpdateDestChannel,i);yield o.signal.request(a),o.emit("event",Cc.PACKET_UPDATE_DEST_CHANNEL),T.debug("[".concat(o.clientId,"] sendUpdateMessage: UpdateDestChannel success"))})()}sendStopRelayMessage(){var i=this;return L(function*(){const o=i.genMessage(fn.StopPacketTransfer);yield i.signal.request(o),T.debug("[".concat(i.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))})()}genMessage(i,o){const a=[],l=[],d=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Ss,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.22.2"===h.sdkVersion&&(h.sdkVersion="0.0.1");let f=null,m=null;switch(i){case fn.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case fn.SetSourceChannel:if(m=o&&o.getSrcChannelMediaInfo(),!m)throw new K(k.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:m.channelName,token:m.token||this.joinInfo.appId},h;case fn.SetSourceUserId:if(m=o&&o.getSrcChannelMediaInfo(),!m)throw new K(k.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:m.uid+""},h;case fn.SetDestChannel:if(f=o&&o.getDestChannelMediaInfo(),!f)throw new K(k.UNEXPECTED_ERROR,"can not find dest config");return f.forEach(g=>{a.push(g.channelName),l.push(g.uid+""),d.push(g.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:a,uid:l,token:d},h;case fn.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case fn.Reconnect:return h.clientRequest={command:"Reconnect"},h;case fn.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case fn.UpdateDestChannel:if(f=o&&o.getDestChannelMediaInfo(),!f)throw new K(k.UNEXPECTED_ERROR,"can not find dest config");return f.forEach(g=>{a.push(g.channelName),l.push(g.uid+""),d.push(g.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:a,uid:l,token:d},h;case fn.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const dm={name:"ChannelMediaRelay",create:function(r){return new Ya(r.joinInfo,r.clientId,r.websocketRetryConfig||Nn,r.httpRetryConfig||Nn,r.resolution)}};function IO(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function um(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?IO(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):IO(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}class j6 extends nn{constructor(i,o,a,l){super(),N(this,"spec",void 0),N(this,"token",void 0),N(this,"websocket",void 0),N(this,"pingpongTimer",void 0),N(this,"reconnectMode","retry"),N(this,"serviceMode",void 0),N(this,"reqId",0),N(this,"commandReqId",0),N(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),N(this,"handleWebSocketMessage",d=>{if(!d.data)return;const h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(be.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===Na.TRANSCODE?1:2}),this.emit(El.PUBLISH_STREAM_STATUS,h))}),this.spec=o,this.token=i,this.serviceMode=l,this.websocket=new j_("live-streaming",a),this.websocket.on(Fe.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Fe.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Fe.REQUEST_NEW_URLS,(d,h)=>{Gr(this,El.REQUEST_NEW_ADDRESS).then(d).catch(h)}),this.websocket.on(Fe.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(i){return this.websocket.init(i)}request(i,o,a,l){var d=this;return L(function*(){d.reqId+=1,"request"===i&&(d.commandReqId+=1);const h=d.commandReqId,f=d.reqId;if(!f||!d.websocket)throw new K(k.UNEXPECTED_ERROR);const m=um({command:i,sdkVersion:"4.22.2"===Ss?"0.0.1":Ss,seq:f,requestId:f,allocate:a,cname:d.spec.cname,appId:d.spec.appId,sid:d.spec.sid,uid:d.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},o);if("closed"===d.websocket.state)throw new K(k.WS_DISCONNECT);const g=()=>new le((C,P)=>{d.websocket.once(Fe.CLOSED,()=>P(new K(k.WS_ABORT))),d.websocket.once(Fe.CONNECTED,C)});"connected"!==d.websocket.state&&(yield g()),m.clientRequest&&(m.clientRequest.workerToken=d.token);const v=new le((C,P)=>{const R=()=>{P(new K(k.WS_ABORT))};d.websocket.once(Fe.RECONNECTING,R),d.websocket.once(Fe.CLOSED,R),d.once("@".concat(f,"-").concat(d.spec.sid),A=>{C(A)})});l&&be.workerEvent(d.spec.sid,um(um({},l),{},{requestId:h,actionType:"request",payload:JSON.stringify(o.clientRequest),serverCode:0,code:0}));const y=Date.now();d.websocket.sendMessage(m);let b=null;try{b=yield v}catch(C){if("closed"===d.websocket.state)throw C;return yield g(),yield d.request(i,o,a)}return l&&be.workerEvent(d.spec.sid,um(um({},l),{},{requestId:h,actionType:"response",payload:JSON.stringify(b.serverResponse),serverCode:b.code,success:200===b.code,responseTime:Date.now()-y})),200!==b.code&&d.handleResponseError(b),b})()}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const i="4.22.2"===Ss?"0.0.1":Ss;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:i,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(i){switch(i.code){case $n.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void T.warning("live stream response already exists stream");case $n.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case $n.LIVE_STREAM_RESPONSE_BAD_STREAM:case $n.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new K(k.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:i.code}).throw();case $n.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===i.serverResponse.command)return;throw new K(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case $n.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new K(k.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:i.code}).throw();case $n.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const o=new K(k.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(El.WARNING,o,i.serverResponse.url)}case $n.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const o=new K(k.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(El.WARNING,o,i.serverResponse.url)}case $n.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new K(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case $n.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new K(k.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:i.code}).throw();case $n.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const o=new K(k.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(El.WARNING,o,i.serverResponse.url)}case $n.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new K(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:i.code}).throw();case $n.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new K(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case $n.LIVE_STREAM_RESPONSE_WORKER_LOST:case $n.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===i.serverResponse.command)return;throw new K(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case $n.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===i.serverResponse.command)return;if("UpdateTranscoding"===i.serverResponse.command||"ControlStream"===i.serverResponse.command)return new K(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:i.code}).throw();throw new K(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case $n.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case $n.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case $n.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case $n.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new K(k.LIVE_STREAMING_CDN_ERROR,"",{code:i.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(fS)},6e3)}}function ru(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}function Ti(r){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?ru(Object(o),!0).forEach(function(a){N(r,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):ru(Object(o)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(o,a))})}return r}class nT extends nn{constructor(i){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Nn,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Nn;super(),N(this,"onLiveStreamWarning",void 0),N(this,"onLiveStreamError",void 0),N(this,"spec",void 0),N(this,"retryTimeout",1e4),N(this,"connection",void 0),N(this,"httpRetryConfig",void 0),N(this,"wsRetryConfig",void 0),N(this,"streamingTasks",new Map),N(this,"isStartingStreamingTask",!1),N(this,"taskMutex",new Qr("live-streaming")),N(this,"cancelToken",Oi.CancelToken.source()),N(this,"transcodingConfig",void 0),N(this,"uapResponse",void 0),N(this,"lastTaskId",1),N(this,"statusError",new Map),this.spec=i,this.httpRetryConfig=a,this.wsRetryConfig=o}setTranscodingConfig(i){var o=this;return L(function*(){const a=Ti(Ti({},NL),i);var f;66!==a.videoCodecProfile&&77!==a.videoCodecProfile&&100!==a.videoCodecProfile&&(T.debug("[".concat(o.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(a.videoCodecProfile," -> 100")),a.videoCodecProfile=100),a.transcodingUsers||(a.transcodingUsers=a.userConfigs),a.transcodingUsers&&(a.transcodingUsers=a.transcodingUsers.map(f=>Ti(Ti(Ti({},OL),f),{},{zOrder:f.zOrder?f.zOrder+1:1}))),pn((f=a).width)||Ft(f.width,"config.width",0,1e4),pn(f.height)||Ft(f.height,"config.height",0,1e4),pn(f.videoBitrate)||Ft(f.videoBitrate,"config.videoBitrate",1,1e6),pn(f.videoFrameRate)||Ft(f.videoFrameRate,"config.videoFrameRate"),pn(f.lowLatency)||fl(f.lowLatency,"config.lowLatency"),pn(f.audioSampleRate)||pr(f.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),pn(f.audioBitrate)||Ft(f.audioBitrate,"config.audioBitrate",1,128),pn(f.audioChannels)||pr(f.audioChannels,"config.audioChannels",[1,2,3,4,5]),pn(f.videoGop)||Ft(f.videoGop,"config.videoGop"),pn(f.videoCodecProfile)||pr(f.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),pn(f.userCount)||Ft(f.userCount,"config.userCount",0,17),pn(f.backgroundColor)||Ft(f.backgroundColor,"config.backgroundColor",0,16777215),pn(f.userConfigExtraInfo)||Nr(f.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),f.transcodingUsers&&!pn(f.transcodingUsers)&&(ml(f.transcodingUsers,"config.transcodingUsers"),f.transcodingUsers.forEach((m,g)=>{SS(m.uid),pn(m.x)||Ft(m.x,"transcodingUser[".concat(g,"].x"),0,1e4),pn(m.y)||Ft(m.y,"transcodingUser[".concat(g,"].y"),0,1e4),pn(m.width)||Ft(m.width,"transcodingUser[".concat(g,"].width"),0,1e4),pn(m.height)||Ft(m.height,"transcodingUser[".concat(g,"].height"),0,1e4),pn(m.zOrder)||Ft(m.zOrder-1,"transcodingUser[".concat(g,"].zOrder"),0,100),pn(m.alpha)||Ft(m.alpha,"transcodingUser[".concat(g,"].alpha"),0,1,!1)})),pn(f.watermark)||TS(f.watermark,"watermark"),pn(f.backgroundImage)||TS(f.backgroundImage,"backgroundImage"),f.images&&!pn(f.images)&&(ml(f.images,"config.images"),f.images.forEach((m,g)=>{TS(m,"images[".concat(g,"]"))}));const l=[];a.images&&l.push(...a.images.map(f=>Ti(Ti(Ti({},CS),f),{},{zOrder:255}))),a.backgroundImage&&(l.push(Ti(Ti(Ti({},CS),a.backgroundImage),{},{zOrder:0})),delete a.backgroundImage),a.watermark&&(l.push(Ti(Ti(Ti({},CS),a.watermark),{},{zOrder:255})),delete a.watermark),a.images=l,a.transcodingUsers&&(a.userConfigs=a.transcodingUsers.map(f=>Ti({},f)),a.userCount=a.transcodingUsers.length,delete a.transcodingUsers);const d=(a.userConfigs||[]).map(f=>"number"==typeof f.uid?le.resolve(f.uid):mD(f.uid,o.spec,o.cancelToken.token,o.httpRetryConfig));if((yield le.all(d)).forEach((f,m)=>{a.userConfigs&&a.userConfigs[m]&&(a.userConfigs[m].uid=f)}),o.transcodingConfig=a,o.connection)try{var h;const f=yield o.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:o.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(xd(h=o.streamingTasks).call(h)).map(m=>m.taskId).join("#")});T.debug("[".concat(o.spec.clientId,"] update live transcoding config success, code: ").concat(f.code,", config:"),JSON.stringify(o.transcodingConfig))}catch(f){if(!f.data||!f.data.retry)throw f;f.data.changeAddress&&o.connection.tryNextAddress(),o.streamingTasks.forEach(m=>{T.warning("[".concat(o.spec.clientId,"] live streaming receive error"),f.toString(),"try to republish",m.url),o.startLiveStreamingTask(m.url,m.mode,f).then(()=>{T.debug("[".concat(o.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(g=>{T.error("[".concat(o.spec.clientId,"] live streaming republish failed"),m.url,g.toString()),o.onLiveStreamError&&o.onLiveStreamError(m.url,g)})})}})()}startLiveStreamingTask(i,o,a){var l=this;return L(function*(){if(!l.transcodingConfig&&o===Na.TRANSCODE)throw new K(k.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const d={command:"PublishStream",ts:Date.now(),url:i,uid:l.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};T.debug("[".concat(l.spec.clientId,"] start live streaming ").concat(i,", mode: ").concat(o));const h=yield l.taskMutex.lock();if(!l.connection&&a)return void h();if(l.streamingTasks.get(i)&&!a)return h(),new K(k.LIVE_STREAMING_TASK_CONFLICT).throw();try{l.connection||(l.connection=yield l.connect(o))}catch(m){throw h(),m}o===Na.TRANSCODE&&(d.transcodingConfig=Ti({},l.transcodingConfig)),l.uapResponse&&l.uapResponse.vid&&(d.vid=l.uapResponse.vid),l.isStartingStreamingTask=!0;const f=l.lastTaskId++;try{const m=new le((v,y)=>{wr(l.retryTimeout).then(()=>{if(a)return y(a);const b=l.statusError.get(i);return b?(l.statusError.delete(i),y(b)):void 0})}),g=yield le.race([l.connection.request("request",{clientRequest:d},!0,{url:i,command:"PublishStream",workerType:o===Na.TRANSCODE?1:2,requestByUser:!a,tid:f.toString()}),m]);l.isStartingStreamingTask=!1,T.debug("[".concat(l.spec.clientId,"] live streaming started, code: ").concat(g.code)),l.streamingTasks.set(i,{clientRequest:d,mode:o,url:i,taskId:f}),h()}catch(m){if(h(),l.isStartingStreamingTask=!1,!m.data||!m.data.retry||a)throw m;return m.data.changeAddress?(l.connection.tryNextAddress(),yield l.startLiveStreamingTask(i,o,m)):yield l.startLiveStreamingTask(i,o,m)}})()}stopLiveStreamingTask(i){return new le((o,a)=>{const l=this.streamingTasks.get(i);if(!l||!this.connection)return new K(k.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=l.mode;l.abortTask=()=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(i),o()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:l.url}},!1,{url:i,command:"UnPublishStream",workerType:d===Na.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(i),0===this.streamingTasks.size&&(this.connection&&this.connection.close(),this.connection=void 0),o()}).catch(a)})}resetAllTask(){var i;const o=Array.from(xd(i=this.streamingTasks).call(i));this.terminate();for(const a of o)this.startLiveStreamingTask(a.url,a.mode).catch(l=>{this.onLiveStreamError&&this.onLiveStreamError(a.url,l)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Oi.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}connect(i){var o=this;return L(function*(){if(o.connection)throw new K(k.UNEXPECTED_ERROR,"live streaming connection has already connected");const a=yield Gr(o,wS.REQUEST_WORKER_MANAGER_LIST,i);return o.uapResponse=a,o.connection=new j6(a.workerToken,o.spec,o.wsRetryConfig,i),o.connection.on(El.WARNING,(l,d)=>o.onLiveStreamWarning&&o.onLiveStreamWarning(d,l)),o.connection.on(El.PUBLISH_STREAM_STATUS,l=>o.handlePublishStreamServer(l)),o.connection.on(El.REQUEST_NEW_ADDRESS,(l,d)=>{if(!o.connection)return d(new K(k.UNEXPECTED_ERROR,"can not get new live streaming address list"));Gr(o,wS.REQUEST_WORKER_MANAGER_LIST,i).then(h=>{o.uapResponse=h,l(h.addressList)}).catch(d)}),yield o.connection.init(a.addressList),o.connection})()}handlePublishStreamServer(i){const o=i.serverStatus&&i.serverStatus.url||"empty_url",a=this.streamingTasks.get(o),l=i.reason;switch(i.code){case $n.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case $n.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case $n.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case $n.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new K(k.LIVE_STREAMING_CDN_ERROR,"",{code:i.code});if(a)return T.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(o,h);if(!this.isStartingStreamingTask)return;this.statusError.set(o,h)}case $n.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new K(k.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,l);return this.onLiveStreamWarning&&this.onLiveStreamWarning(o,h)}case $n.LIVE_STREAM_RESPONSE_WORKER_LOST:case $n.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(xd(d=this.streamingTasks).call(d));for(const f of h)f.abortTask?f.abortTask():(T.warning("[".concat(this.spec.clientId,"] publish stream status code"),i.code,"try to republish",f.url),this.startLiveStreamingTask(f.url,f.mode,new K(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:i.code})).then(()=>{T.debug("[".concat(this.spec.clientId,"] republish live stream success"),f.url)}).catch(m=>{T.error(m.toString()),this.onLiveStreamError&&this.onLiveStreamError(f.url,m)}));return}}}hasUrl(i){return this.streamingTasks.has(i)}}const cU={name:"LiveStreaming",create:function(r){return new nT(r.joinInfo,r.websocketRetryConfig||Nn,r.httpRetryConfig||Nn)}};function AO(r){let i={};e:for(;!NO(r);){let o=xc(r);switch(o>>>3){case 0:break e;case 1:i.requestId=hU(r,xc(r));break;case 2:i.requestType=xc(r)>>>0;break;case 3:i.scorePorn=oT(r);break;case 4:i.scoreSexy=oT(r);break;case 5:i.scoreNeutral=oT(r);break;case 6:i.requestScene=xc(r)>>>0;break;case 7:i.scene=xc(r)>>>0;break;default:rT(r,7&o)}}return i}function DO(r,i){let o=r.service;void 0!==o&&(Ot(i,8),Ot(i,o));let a=r.vendor;void 0!==a&&(Ot(i,16),Ot(i,a));let l=r.token;void 0!==l&&(Ot(i,26),$a(i,l));let d=r.callbackUrl;void 0!==d&&(Ot(i,34),$a(i,d))}function dU(r){let i=xc(r),o=r.limit;return r.limit=r.offset+i,o}function rT(r,i){switch(i){case 0:for(;128&pU(r););break;case 2:oE(r,xc(r));break;case 5:oE(r,4);break;case 1:oE(r,8);break;default:throw new Error("Unimplemented type: "+i)}}let OO=new Float32Array(1);new Uint8Array(OO.buffer);let hm=new Float64Array(1),$i=new Uint8Array(hm.buffer);function pm(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}let fm=[];function uU(){const r=fm.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}}function H6(r){fm.push(r)}function oE(r,i){if(r.offset+i>r.limit)throw new Error("Skip past limit");r.offset+=i}function NO(r){return r.offset>=r.limit}function Gl(r,i){let o=r.bytes,a=r.offset,l=r.limit,d=a+i;if(d>o.length){let h=new Uint8Array(2*d);h.set(o),r.bytes=h}return r.offset=d,d>l&&(r.limit=d),a}function iT(r,i){let o=r.offset;if(o+i>r.limit)throw new Error("Read past limit");return r.offset+=i,o}function hU(r,i){let o=iT(r,i),a=String.fromCharCode,l=r.bytes,d="\ufffd",h="";for(let f=0;f<i;f++){let m,g,v,y,b=l[f+o];128&b?192==(224&b)?f+1>=i?h+=d:(m=l[f+o+1],128!=(192&m)?h+=d:(y=(31&b)<<6|63&m,y<128?h+=d:(h+=a(y),f++))):224==(240&b)?f+2>=i?h+=d:(m=l[f+o+1],g=l[f+o+2],32896!=(49344&(m|g<<8))?h+=d:(y=(15&b)<<12|(63&m)<<6|63&g,y<2048||y>=55296&&y<=57343?h+=d:(h+=a(y),f+=2))):240==(248&b)?f+3>=i?h+=d:(m=l[f+o+1],g=l[f+o+2],v=l[f+o+3],8421504!=(12632256&(m|g<<8|v<<16))?h+=d:(y=(7&b)<<18|(63&m)<<12|(63&g)<<6|63&v,y<65536||y>1114111?h+=d:(y-=65536,h+=a(55296+(y>>10),56320+(1023&y)),f+=3))):h+=d:h+=a(b)}return h}function $a(r,i){let o=i.length,a=0;for(let h=0;h<o;h++){let f=i.charCodeAt(h);f>=55296&&f<=56319&&h+1<o&&(f=(f<<10)+i.charCodeAt(++h)-56613888),a+=f<128?1:f<2048?2:f<65536?3:4}Ot(r,a);let l=Gl(r,a),d=r.bytes;for(let h=0;h<o;h++){let f=i.charCodeAt(h);f>=55296&&f<=56319&&h+1<o&&(f=(f<<10)+i.charCodeAt(++h)-56613888),f<128?d[l++]=f:(f<2048?d[l++]=f>>6&31|192:(f<65536?d[l++]=f>>12&15|224:(d[l++]=f>>18&7|240,d[l++]=f>>12&63|128),d[l++]=f>>6&63|128),d[l++]=63&f|128)}}function Hz(r,i){let o=Gl(r,i.limit),a=r.bytes,l=i.bytes;for(let d=0,h=i.limit;d<h;d++)a[d+o]=l[d]}function pU(r){return r.bytes[iT(r,1)]}function fU(r,i){let o=Gl(r,1);r.bytes[o]=i}function oT(r){let i=iT(r,8),o=r.bytes;return $i[0]=o[i++],$i[1]=o[i++],$i[2]=o[i++],$i[3]=o[i++],$i[4]=o[i++],$i[5]=o[i++],$i[6]=o[i++],$i[7]=o[i++],hm[0]}function mm(r,i){let o=Gl(r,8),a=r.bytes;hm[0]=i,a[o++]=$i[0],a[o++]=$i[1],a[o++]=$i[2],a[o++]=$i[3],a[o++]=$i[4],a[o++]=$i[5],a[o++]=$i[6],a[o++]=$i[7]}function xc(r){let i,o=0,a=0;do{i=pU(r),o<32&&(a|=(127&i)<<o),o+=7}while(128&i);return a}function Ot(r,i){for(i>>>=0;i>=128;)fU(r,127&i|128),i>>>=7;fU(r,i)}function ks(r,i){let o=i.low>>>0,a=(i.low>>>28|i.high<<4)>>>0,l=i.high>>>24,d=0===l?0===a?o<16384?o<128?1:2:o<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:l<128?9:10,h=Gl(r,d),f=r.bytes;switch(d){case 10:f[h+9]=l>>>7&1;case 9:f[h+8]=9!==d?128|l:127&l;case 8:f[h+7]=8!==d?a>>>21|128:a>>>21&127;case 7:f[h+6]=7!==d?a>>>14|128:a>>>14&127;case 6:f[h+5]=6!==d?a>>>7|128:a>>>7&127;case 5:f[h+4]=5!==d?128|a:127&a;case 4:f[h+3]=4!==d?o>>>21|128:o>>>21&127;case 3:f[h+2]=3!==d?o>>>14|128:o>>>14&127;case 2:f[h+1]=2!==d?o>>>7|128:o>>>7&127;case 1:f[h]=1!==d?128|o:127&o}}function gm(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),o.push.apply(o,a)}return o}const G6=new Map([["moderation",1],["supervise",2]]);function mU(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}class sE extends nn{get connectionState(){return this._connectionState}set connectionState(i){if(this._connectionState===i)return;const o=this._connectionState;this._connectionState=i,this.emit(_r.CONNECTION_STATE_CHANGE,o,i)}get inspectType(){return this._inspectType}set inspectType(i){var o;this._inspectMode=Ue(o=i.map(a=>G6.get(a)||0)).call(o,(a,l)=>a+l),this._inspectType=i}get quality(){return this._quality}set quality(i){this._quality=i>1?1:i<.1?.1:i,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(i){super(),N(this,"name","AgoraRTCVideoContentInspect"),N(this,"_connectionState",qs.CONNECTING),N(this,"_innerConnectionState",void 0),N(this,"sequence",0),N(this,"inspectStartTime",void 0),N(this,"workerManagerConnection",void 0),N(this,"workerConnection",void 0),N(this,"workerMessageLengthLimit",void 0),N(this,"inspectIntervalMinimum",void 0),N(this,"qualityRatio",void 0),N(this,"_connectInfo",void 0),N(this,"_cancelTokenSource",Oi.CancelToken.source()),N(this,"_retryConfig",void 0),N(this,"wmSequence",0),N(this,"inspectInterval",void 0),N(this,"inspectTimer",null),N(this,"ossFilePrefix",void 0),N(this,"extraInfo",void 0),N(this,"_inspectType",void 0),N(this,"_inspectMode",void 0),N(this,"_quality",1),N(this,"qualityTimer",null),N(this,"_inspectId",void 0),N(this,"_needWorkUrlOnly",!1),N(this,"inspectImage",()=>{if(this.connectionState!==qs.CONNECTED)throw new K(k.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===qs.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Ct(5,"inspect-"),this.workerMessageLengthLimit=B("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=B("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=B("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=i.interval,this.ossFilePrefix=i.ossFilePrefix,this.extraInfo=i.extraInfo,this.inspectType=i.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new j_("worker-manager-"+this._inspectId,Nn),this.on(_r.STATE_CHANGE,(o,a)=>{this._innerConnectionState=o,T.debug("[".concat(this._inspectId,"] Inspect operation :").concat(is[o]," ").concat(a||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new j_("worker-"+this._inspectId,Nn),this.handleWorkerEvents()}init(i,o){var a=this;return L(function*(){a.emit(_r.STATE_CHANGE,is.CONNECT_AP),a._connectInfo=i;const l=a._cancelTokenSource.token;return a._retryConfig=o,new le((d,h)=>{a.on(_r.CONNECTION_STATE_CHANGE,(f,m)=>{m===qs.CONNECTED&&d()}),a.requestAP(i,l,o).then(f=>{a.connectWorkerManager(f)}).catch(f=>{h(f)})})})()}requestAP(i,o,a){var l=this;return L(function*(){const d=B("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),h=yield function(m,g,v,y){let{appId:b,areaCode:C,cname:P,sid:R,token:A,uid:O}=g;Yf++;const M="image_moderation_api",x={service_name:M,json_body:JSON.stringify({appId:b,areaCode:C,cname:P,command:"allocateEdge",requestId:Yf,seq:Yf,sid:R,token:A,ts:Date.now(),uid:O+""})};let j,W,q=m[0];return rs(L(function*(){j=Date.now();const te=yield ta(q,{data:x,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(W=Date.now()-j,0!==te.code){const Re=new K(k.UNEXPECTED_RESPONSE,"image inspect ap error, code"+te.code,{retry:!0,responseTime:W});throw T.error(Re.toString()),Re}const J=JSON.parse(te.json_body);if(200!==J.code){const Re=new K(k.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(J.code,", reason: ").concat(J.reason),{code:J.code,responseTime:W});throw T.error(Re.toString()),Re}if(!J.servers||!Array.isArray(J.servers)||0===J.servers.length){const Re=new K(k.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:J.code,responseTime:W});throw T.error(Re.toString()),Re}const X=B("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Ce=B("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:J.servers.map(Re=>{let{address:ut,wss:Nt}=Re;if(ut&&Nt)return"wss://".concat(ut.replace(/\./g,"-"),".").concat(X,":").concat(Ce||Nt)}).filter(Re=>!!Re),workerToken:J.workerToken,vid:J.vid,responseTime:W}}),(te,J)=>(be.apworkerEvent(R,{success:!0,sc:200,serviceName:M,responseDetail:JSON.stringify(te.addressList),firstSuccess:0===J,responseTime:W,serverIp:m[J%m.length]}),!1),(te,J)=>(be.apworkerEvent(R,{success:!1,sc:te.data&&te.data.code||200,serviceName:M,responseTime:W,serverIp:m[J%m.length]}),!!(te.code!==k.OPERATION_ABORTED&&te.code!==k.UNEXPECTED_RESPONSE||te.data&&te.data.retry)&&(q=m[(J+1)%m.length],!0)),y)}(d,i,o,a);l.emit(_r.STATE_CHANGE,is.AP_CONNECTED);const{addressList:f}=h;return l.wmSequence++,f})()}connectWorkerManager(i){var o=arguments,a=this;return L(function*(){a._needWorkUrlOnly=o.length>1&&void 0!==o[1]&&o[1],a.emit(_r.STATE_CHANGE,is.CONNECT_WORKER_MANAGER),yield a.workerManagerConnection.init(i,1e4)})()}connectWorker(i){var o=this;return L(function*(){yield o.workerConnection.init([i])})()}handleWorkerManagerEvents(){var i=this;this.workerManagerConnection.on(Fe.CONNECTED,L(function*(){i.emit(_r.STATE_CHANGE,is.WORKER_MANAGER_CONNECTED,i.workerManagerConnection.url),i.workerManagerConnection.sendMessage({appId:i._connectInfo.appId,cname:i._connectInfo.cname,uid:i._connectInfo.uid+"",sdkVersion:"4.22.2",sid:i._connectInfo.sid,seq:i.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(Fe.CLOSED,()=>{this._innerConnectionState<is.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Fe.FAILED,()=>{this._innerConnectionState<is.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Fe.RECONNECTING,()=>{this._innerConnectionState<is.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Fe.ON_MESSAGE,function(){var o=L(function*(a){i.emit(_r.STATE_CHANGE,is.GET_WORKER_MANAGER_RESPONSE);const l=i.workerManagerConnection.url;i.workerManagerConnection.close();const d=JSON.parse(a.data);if(200!==d.code)throw T.error("[".concat(i._inspectId,"] Unexpected code ").concat(d.code," from worker manager")),new K(k.UNEXPECTED_RESPONSE,"response code of worker is unexpected",d);if(!(d.serverResponse&&d.serverResponse.portWss&&l))throw T.error("[".concat(i._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(d))),new K(k.UNEXPECTED_RESPONSE,"response content of worker is unexpected",d);{const h=B("VIDEO_INSPECT_WORKER_PORT")||d.serverResponse.portWss,f=l.replace(/:\d+\/?$/,":".concat(h));i.emit(_r.STATE_CHANGE,is.CONNECT_WORKER,f),i._needWorkUrlOnly?i.emit(_r.REQUEST_NEW_WORKER_URL,f):yield i.connectWorker(f)}});return function(a){return o.apply(this,arguments)}}()),this.workerManagerConnection.on(Fe.WILL_RECONNECT,(o,a,l)=>{l(o)}),this.workerManagerConnection.on(Fe.REQUEST_NEW_URLS,(o,a)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o).catch(a)})}handleWorkerEvents(){var i=this;this.workerConnection.on(Fe.CONNECTED,L(function*(){i.emit(_r.STATE_CHANGE,is.WORKER_CONNECTED,i.workerConnection.url),i.connectionState=qs.CONNECTED})),this.workerConnection.on(Fe.ON_MESSAGE,function(){var o=L(function*(a){if(a.data instanceof ArrayBuffer){const d=function lU(r){return function(o){let a={};e:for(;!NO(o);){let l=xc(o);switch(l>>>3){case 0:break e;case 1:a.code=xc(o);break;case 2:a.msg=hU(o,xc(o));break;case 3:{let d=dU(o);a.data=AO(o),o.limit=d;break}default:rT(o,7&l)}}return a}({bytes:i=r,offset:0,limit:i.length});var i}(new Uint8Array(a.data));if(B("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&T.debug("[".concat(i._inspectId,"] Response message for worker of inspect content "),JSON.stringify(d)),200===d.code){if(Array.isArray(i.inspectType)&&1===i.inspectType.length&&"supervise"===i.inspectType[0])return void i.emit(_r.INSPECT_RESULT,void 0,void 0);if(d.data&&d.data.scorePorn&&d.data.scoreSexy&&d.data.scoreNeutral){var l;const h={porn:d.data.scorePorn,sexy:d.data.scoreSexy,neutral:d.data.scoreNeutral},f=Ue(l=Object.keys(h)).call(l,(g,v)=>h[g]>h[v]?g:v,"porn"),m=Object.keys(h).find(g=>g===f);i.emit(_r.INSPECT_RESULT,m)}else i.emit(_r.INSPECT_RESULT,void 0,new K(k.UNEXPECTED_RESPONSE,d.code+"","There is an unexpected data on message"))}else i.emit(_r.INSPECT_RESULT,void 0,new K(k.UNEXPECTED_RESPONSE,d.code+"",d.msg))}else T.error("[".concat(i._inspectId,"] Unexpected message type from worker")),i.emit(_r.INSPECT_RESULT,void 0,new K(k.UNEXPECTED_RESPONSE,"invalid worker message type"))});return function(a){return o.apply(this,arguments)}}()),this.workerConnection.on(Fe.CLOSED,()=>{this.connectionState=qs.CLOSED}),this.workerConnection.on(Fe.FAILED,()=>{this.connectionState=qs.CLOSED}),this.workerConnection.on(Fe.RECONNECTING,()=>{this.connectionState=this.connectionState===qs.CONNECTED?qs.RECONNECTING:qs.CONNECTING}),this.workerConnection.on(Fe.WILL_RECONNECT,(o,a,l)=>{"recover"===o&&l(o),l("tryNext")}),this.workerConnection.on(Fe.REQUEST_NEW_URLS,(o,a)=>{this.workerManagerConnection.close(),this.once(_r.REQUEST_NEW_WORKER_URL,l=>{o([l])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(l=>{this.connectWorkerManager(l,!0)}).catch(l=>{a(l)})})}requestToInspectImage(){var i=this;return L(function*(){i.sequence++;const o=Ao(i,_r.CLIENT_LOCAL_VIDEO_TRACK),a={appId:i._connectInfo.appId,cname:i._connectInfo.cname,cid:i._connectInfo.cid,sid:i._connectInfo.sid,uid:i._connectInfo.uid,vid:i._connectInfo.vid};if(o){if(!o.isPlaying)return void i.emit(_r.INSPECT_RESULT,void 0,new K(k.INVALID_OPERATION,"Only the track being played can be inspected"));const l=yield i.generateRequestData(o,a);i.workerConnection.sendMessage(l,!0,!0)}else i.emit(_r.INSPECT_RESULT,void 0,new K(k.INVALID_OPERATION,"Only the track being published can be inspected"))})()}generateRequestData(i,o){var a=this;return L(function*(){let{appId:l,cname:d,cid:h,vid:f,sid:m,uid:g}=o;const v=Date.now(),y=yield i.getCurrentFrameImage("image/jpeg",a.quality),b=yield Ox(y,l,d),C=a.sequence+"-"+h+"-"+g+"-"+v+"-"+Ct(12,""),P={appId:l,cid:h,cname:d,deviceId:"",elapse:mU(Number(v-a.inspectStartTime)),fileSize:b.byteLength,jpgEncryption:2,height:y.height,width:y.width,jpg:b,networkType:6,osType:7,requestId:C,sdkVersion:"4.22.2",sequence:a.sequence,sid:m,timestamp:mU(v),uid:g,vid:f,service:a._inspectMode,callbackData:a.extraInfo,ossFilePrefix:a.ossFilePrefix};void 0===a.extraInfo&&delete P.callbackData,void 0===a.ossFilePrefix&&delete P.ossFilePrefix;const R=function RO(r){let i=uU();return function(o,a){let l=o.appId;void 0!==l&&(Ot(a,10),$a(a,l));let d=o.cid;void 0!==d&&(Ot(a,16),Ot(a,d));let h=o.cname;void 0!==h&&(Ot(a,26),$a(a,h));let f=o.deviceId;void 0!==f&&(Ot(a,34),$a(a,f));let m=o.elapse;void 0!==m&&(Ot(a,40),ks(a,m));let g=o.fileSize;void 0!==g&&(Ot(a,48),ks(a,pm(g)));let v=o.height;void 0!==v&&(Ot(a,56),ks(a,pm(v)));let y=o.jpg;void 0!==y&&(Ot(a,66),Ot(a,y.length),function(aa,Z){let se=Gl(aa,Z.length);aa.bytes.set(Z,se)}(a,y));let b=o.networkType;void 0!==b&&(Ot(a,72),ks(a,pm(b)));let C=o.osType;void 0!==C&&(Ot(a,80),ks(a,pm(C)));let P=o.requestId;void 0!==P&&(Ot(a,90),$a(a,P));let R=o.sdkVersion;void 0!==R&&(Ot(a,98),$a(a,R));let A=o.sequence;void 0!==A&&(Ot(a,104),ks(a,pm(A)));let O=o.sid;void 0!==O&&(Ot(a,114),$a(a,O));let M=o.timestamp;void 0!==M&&(Ot(a,120),ks(a,M));let x=o.uid;void 0!==x&&(Ot(a,128),Ot(a,x));let j=o.vid;void 0!==j&&(Ot(a,136),Ot(a,j));let W=o.width;void 0!==W&&(Ot(a,144),ks(a,pm(W)));let q=o.service;void 0!==q&&(Ot(a,152),Ot(a,q));let te=o.callbackData;void 0!==te&&(Ot(a,162),$a(a,te));let J=o.jpgEncryption;void 0!==J&&(Ot(a,168),Ot(a,J));let X=o.requestType;void 0!==X&&(Ot(a,176),Ot(a,X));let Ce=o.scorePorn;void 0!==Ce&&(Ot(a,185),mm(a,Ce));let Re=o.scoreSexy;void 0!==Re&&(Ot(a,193),mm(a,Re));let ut=o.scoreNeutral;void 0!==ut&&(Ot(a,201),mm(a,ut));let Nt=o.scene;void 0!==Nt&&(Ot(a,208),Ot(a,Nt));let _n=o.ossFilePrefix;void 0!==_n&&(Ot(a,218),$a(a,_n));let Zt=o.serviceVendor;if(void 0!==Zt)for(let aa of Zt){Ot(a,226);let Z=uU();DO(aa,Z),Ot(a,Z.limit),Hz(a,Z),H6(Z)}}(r,i),function(o){let a=o.bytes,l=o.limit;return a.length===l?a:a.subarray(0,l)}(i)}(P);if(R.byteLength<a.workerMessageLengthLimit){if(B("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const A=function(O){for(var M=1;M<arguments.length;M++){var x=null!=arguments[M]?arguments[M]:{};M%2?gm(Object(x),!0).forEach(function(j){N(O,j,x[j])}):Object.getOwnPropertyDescriptors?Object.defineProperties(O,Object.getOwnPropertyDescriptors(x)):gm(Object(x)).forEach(function(j){Object.defineProperty(O,j,Object.getOwnPropertyDescriptor(x,j))})}return O}({},P);delete A.jpg,T.debug("[".concat(a._inspectId,"] Request message for worker of inspect content "),JSON.stringify(A))}return R}return a.quality=a.quality*a.qualityRatio,yield a.generateRequestData(i,{appId:l,cname:d,cid:h,vid:f,sid:m,uid:g})})()}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Oi.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=qs.CLOSED,this.emit(_r.STATE_CHANGE,is.CLOSED)}}const aE={name:"ContentInspect",create:function(r){let{config:i}=r;return function(o){if(!o)throw new K(k.INVALID_PARAMS,"inspectConfig is necessary.");if(!o.inspectType||!Array.isArray(o.inspectType))throw new K(k.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const a=[...new Set(o.inspectType)];a.forEach(l=>{var d;if(!he(d=["supervise","moderation"]).call(d,l))throw new K(k.INVALID_PARAMS,"".concat(l," is not a valid inspect type."))}),o.inspectType=a}if(o&&o.extraInfo&&o.extraInfo.length>1024)throw new K(k.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(i),new sE(i)}};kt("PROCESS_ID","process-".concat(Ct(8,""),"-").concat(Ct(4,""),"-").concat(Ct(4,""),"-").concat(Ct(4,""),"-").concat(Ct(12,""))),function(){let r;try{r=window.localStorage.getItem("websdk_ng_global_parameter")}catch(i){return void T.error("Error loading sdk config",i.message)}if(r)try{const i=JSON.parse(window.atob(r)),o=Date.now();T.debug("Loading global parameters from cache",i),Object.keys(i).forEach(a=>{if(Object.prototype.hasOwnProperty.call(Pn,a)){const{value:l,expires:d}=i[a];if(d&&d<=o)return;Od[a]=l,Pn[a]=l}})}catch(i){T.error("Error loading mutableParamsCache: ".concat(r),i.message)}}(),Array.isArray(Od.AREAS)&&Od.AREAS.length>0&&Nh(Od.AREAS,!0);const gU=(r,i,o)=>{T.debug("setParameter key:".concat(r,", value:").concat(JSON.stringify(i))),kt(r,i,o)};EC(dm,!1),EC(cU,!1),EC(Lz,!1),EC(aE,!1),EC(TO,!1);const er=function(r){const i=new nn,o=r,a={getListeners:i.getListeners.bind(i),on:(l,d)=>(l===Ys.SECURITY_POLICY_VIOLATION&&kF(d,!0),i.on.bind(i)(l,d)),addListener:i.addListener.bind(i),once:i.once.bind(i),off:i.off.bind(i),removeAllListeners:i.removeAllListeners.bind(i),emit:i.emit.bind(i),safeEmit:i.safeEmit.bind(i)};return MF(MF({},o),a)}({__TRACK_LIST__:Ch,VERSION:Ss,BUILD:AR,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:gU,getParameter:B,getSupportedCodec:function(){var r=L(function*(){let i={audio:[],video:[]};try{let o=new RTCPeerConnection;const a=yield(l=L(function*(d){let h;return ct().supportUnifiedPlan?(d.addTransceiver("video",{direction:"recvonly"}),d.addTransceiver("audio",{direction:"recvonly"}),h=(yield d.createOffer()).sdp):h=(yield d.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,h}),function(d){return l.apply(this,arguments)})(o);if(!a)return i;o.close(),o=null,i=function(l){const d={video:[],audio:[]};return l.match(/ VP8/i)&&d.video.push("VP8"),l.match(/ VP9/i)&&d.video.push("VP9"),l.match(/ AV1/i)&&d.video.push("AV1"),l.match(/ H264/i)&&d.video.push("H264"),l.match(/ H265/i)&&d.video.push("H265"),l.match(/ opus/i)&&d.audio.push("OPUS"),l.match(/ PCMU/i)&&d.audio.push("PCMU"),l.match(/ PCMA/i)&&d.audio.push("PCMA"),l.match(/ G722/i)&&d.audio.push("G722"),d}(a)}catch(o){throw new K(k.CREATE_OFFER_FAILED,o.toString&&o.toString()).print()}var l;return i});return function(){return r.apply(this,arguments)}}(),checkSystemRequirements:function(){const r=be.reportApiInvoke(null,{name:Yn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:st.TRACER});let i=!1;try{const d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,f=window.WebSocket;i=!!(d&&h&&f),i&&mR()&&eL(75)&&(new d).close()}catch(d){return T.error("check system requirement failed: ",d),!1}let o=!1;const a=ot();a.name===It.CHROME&&Number(a.version)>=58&&("WebKit"!==Hs.engine.name||function(){const d=ot();if(T_()){if(d.os===hr.MAC_OS)return!0;if(d.os===hr.IOS){const h=Hs.os.version&&Hs.os.version.split(".");if(h&&14===Number(h[0])&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(o=!0),(a.name===It.FIREFOX&&Number(a.version)>=56||a.name===It.OPERA&&Number(a.version)>=45||a.name===It.SAFARI&&Number(a.version)>=11||"WebKit"===a.name&&(nt()||Ks())&&a.osVersion&&Number(a.osVersion.split(".")[0])>=11||uS()||ot().name===It.QQ)&&(o=!0),T.debug("checkSystemRequirements, api:",i,"browser",o);const l=i&&o;return r.onSuccess(l),l},getDevices:function(r){return po.enumerateDevices(!0,!0,r)},getMicrophones:function(r){return po.getRecordingDevices(r)},getCameras:function(r){return po.getCamerasDevices(r)},getElectronScreenSources:T5,getPlaybackDevices:function(r){return po.getSpeakers(r)},createClient:function(){var r;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const o=Ct(5,"client-"),a=be.reportApiInvoke(null,{id:o,name:Yn.CREATE_CLIENT,options:[i],tag:st.TRACER});try{pr((l=i).codec,"config.codec",["vp8","vp9","av1","h264","h265"]),pr(l.mode,"config.mode",["rtc","live","p2p"]),void 0!==l.audioCodec&&pr(l.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==l.proxyServer&&Nr(l.proxyServer,"config.proxyServer",1,1e4),void 0!==l.turnServer&&bR(l.turnServer),void 0!==l.httpRetryConfig&&iL(l.httpRetryConfig),void 0!==l.websocketRetryConfig&&iL(l.websocketRetryConfig)}catch(l){throw a.onError(l),l}var l;return(Ws(16,0,!0)||zs(16,0,!0))&&("vp9"===i.codec&&(i.codec="vp8",T.debug("browser not support vp9, force use vp8")),kt("UNSUPPORTED_VIDEO_CODEC",["vp9"])),void 0===i.audioCodec&&(i.audioCodec="opus"),a.onSuccess(),new l6(Os(Os({forceWaitGatewayResponse:!0},i),{},{role:he(r=["rtc","p2p"]).call(r,i.mode)?"host":i.role||"audience"}),o)},createCameraVideoTrack:function(){var r=L(function*(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const o=B("CAMERA_CAPTURE_CONFIG"),a=Ct(8,"track-cam-"),l=be.reportApiInvoke(null,{id:a,tag:st.TRACER,name:Yn.CREATE_CAM_VIDEO_TRACK,options:[rn({},i),o]});o&&(i.encoderConfig=o);const d=dv(i);let h=null;T.info("start create camera video track with config",JSON.stringify(i),"trackId",a);try{h=(yield Gi({video:d},a)).getVideoTracks()[0]||null}catch(m){throw l.onError(m),m}if(!h){const m=new Y(k.UNEXPECTED_ERROR,"can not find track in media stream");return l.onError(m),m.throw(T)}i.optimizationMode&&r2(a,h,i,Tl(i.encoderConfig));const f=new XS(h,i,d,i.scalabiltyMode?TA(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,a);return l.onSuccess(f.getTrackId()),T.info("create camera video success, trackId:",a),f});return function(){return r.apply(this,arguments)}}(),createCustomVideoTrack:function(r){const i=Ct(8,"track-cus-"),o=be.reportApiInvoke(null,{id:i,tag:st.TRACER,name:Yn.CREATE_CUSTOM_VIDEO_TRACK,options:[r]}),a=new Ve(r.mediaStreamTrack,{width:r.width,height:r.height,frameRate:r.frameRate,bitrateMax:r.bitrateMax,bitrateMin:r.bitrateMin},r.scalabiltyMode?TA(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,i,[zt.CUSTOM_TRACK]);return o.onSuccess(a.getTrackId()),T.info("create custom video track success with config",r,"trackId",a.getTrackId()),a},createScreenVideoTrack:function(){var r=L(function*(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const a="object"==typeof o?w5(C=o):void 0;var C;a&&(o="auto");const l=Ct(8,"track-scr-v-"),d=be.reportApiInvoke(null,{id:l,tag:st.TRACER,name:Yn.CREATE_SCREEN_VIDEO_TRACK,options:[rn({},i),o]});i.encoderConfig?"string"==typeof i.encoderConfig||i.encoderConfig.width&&i.encoderConfig.height||(i.encoderConfig.width={max:1920},i.encoderConfig.height={max:1080}):i.encoderConfig="1080p_2";const h=function(C){const P={};C.screenSourceType&&(P.mediaSource=C.screenSourceType),C.extensionId&&hh()&&(P.extensionId=C.extensionId);const{displaySurface:R,selfBrowserSurface:A,surfaceSwitching:O,systemAudio:M}=C;(Gs(107)||dS(107)||hR(93))&&(R&&(pr(R,"displaySurface",["browser","window","monitor"]),P.displaySurface=R),A?(pr(A,"selfBrowserSurface",["exclude","include"]),P.selfBrowserSurface=A):P.selfBrowserSurface="include",O&&(pr(O,"surfaceSwitching",["exclude","include"]),P.surfaceSwitching=O)),(Gs(105)||dS(105)||hR(91))&&M&&(pr(M,"systemAudio",["exclude","include"]),P.systemAudio=M),C.electronScreenSourceId&&(P.sourceId=C.electronScreenSourceId);const x=C.encoderConfig?_x(C.encoderConfig):null;return P.mandatory={chromeMediaSource:"desktop",maxWidth:x?x.width:void 0,maxHeight:x?x.height:void 0},x&&(x.frameRate&&("number"==typeof x.frameRate?(P.mandatory.maxFrameRate=x.frameRate,P.mandatory.minFrameRate=x.frameRate):(P.mandatory.maxFrameRate=x.frameRate.max||x.frameRate.ideal||x.frameRate.exact||void 0,P.mandatory.minFrameRate=x.frameRate.min||x.frameRate.ideal||x.frameRate.exact||void 0),P.frameRate=x.frameRate),x.width&&(P.width=x.width),x.height&&(P.height=x.height)),P}(i);let f=null,m=null;const g=ct();if(!g.supportShareAudio&&"enable"===o){const C=new Y(k.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return d.onError(C),C.throw(T)}T.info("start create screen video track with config",i,"withAudio",o,"trackId",l);const v=g.supportShareAudio&&"disable"!==o;try{const C=yield Gi({screen:h,screenAudio:v?a||!0:void 0},l);f=C.getVideoTracks()[0]||null,m=C.getAudioTracks()[0]||null}catch(C){throw d.onError(C),C}if(!f){const C=new Y(k.UNEXPECTED_ERROR,"can not find track in media stream");return d.onError(C),C.throw(T)}if(!m&&"enable"===o){f&&f.stop();const C=new Y(k.SHARE_AUDIO_NOT_ALLOWED);return d.onError(C),C.throw(T)}i.optimizationMode||(i.optimizationMode="detail"),i.optimizationMode&&(r2(l,f,i,i.encoderConfig&&_x(i.encoderConfig)||void 0),i.encoderConfig&&"string"!=typeof i.encoderConfig&&(i.encoderConfig.bitrateMin=i.encoderConfig.bitrateMax));const y=new Ve(f,i.encoderConfig?_x(i.encoderConfig):{},i.scalabiltyMode?TA(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,l,[zt.SCREEN_TRACK]);if(!m)return d.onSuccess(y.getTrackId()),T.info("create screen video track success","video:",y.getTrackId()),y;const b=new Cn(m,void 0,Ct(8,"track-scr-a-"),!1);return d.onSuccess([y.getTrackId(),b.getTrackId()]),T.info("create screen video track success","video:",y.getTrackId(),"audio:",b.getTrackId()),[y,b]});return function(){return r.apply(this,arguments)}}(),createMicrophoneAndCameraTracks:function(){var r=L(function*(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=B("CAMERA_CAPTURE_CONFIG"),l=Ct(8,"track-mic-"),d=Ct(8,"track-cam-"),h=be.reportApiInvoke(null,{id:"".concat(l,"-").concat(d),tag:st.TRACER,name:Yn.CREATE_MIC_AND_CAM_TRACKS,options:[i,o,a]});a&&(o.encoderConfig=a);const f=dv(o),m=I5(i);let g=null,v=null;T.info("start create camera video track(".concat(d,") and microphone audio track(").concat(l,") with config, audio: ").concat(JSON.stringify(i),", video: ").concat(JSON.stringify(o)));try{const C=yield Gi({audio:m,video:f},"".concat(l,"-").concat(d));g=C.getAudioTracks()[0],v=C.getVideoTracks()[0]}catch(C){throw h.onError(C),C}if(!g||!v){const C=new Y(k.UNEXPECTED_ERROR,"can not find tracks in media stream");return h.onError(C),C.throw(T)}o.optimizationMode&&r2(d,v,o,Tl(o.encoderConfig));const y=new qS(g,i,m,l),b=new XS(v,o,f,o.scalabiltyMode?TA(o.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},o.optimizationMode,d);return h.onSuccess([y.getTrackId(),b.getTrackId()]),T.info("create camera video track(".concat(d,") and microphone audio track(").concat(l,") success")),[y,b]});return function(){return r.apply(this,arguments)}}(),createMicrophoneAudioTrack:function(){var r=L(function*(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const o=Ct(8,"track-mic-"),a=be.reportApiInvoke(null,{id:o,tag:st.TRACER,name:Yn.CREATE_MIC_AUDIO_TRACK,options:[i]}),l=I5(i);let d=null;T.info("start create microphone audio track with config",JSON.stringify(i),"trackId",o);try{d=(yield Gi({audio:l},o)).getAudioTracks()[0]||null}catch(f){throw a.onError(f),f}if(!d){const f=new Y(k.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(f),f.throw(T)}const h=new qS(d,i,l,o);return a.onSuccess(h.getTrackId()),T.info("create microphone audio track success, trackId:",o),h});return function(){return r.apply(this,arguments)}}(),createCustomAudioTrack:function(r){const i=Ct(8,"track-cus-"),o=be.reportApiInvoke(null,{id:i,tag:st.TRACER,name:Yn.CREATE_CUSTOM_AUDIO_TRACK,options:[r]}),a=new Cn(r.mediaStreamTrack,r.encoderConfig?wA(r.encoderConfig):{},i,!1);return T.info("create custom audio track success with config",r,"trackId",a.getTrackId()),o.onSuccess(a.getTrackId()),a},createBufferSourceAudioTrack:function(){var r=L(function*(i){var o;const{cacheOnlineFile:a,encoderConfig:l}=i;let{source:d}=i;const h={source:d instanceof AudioBuffer?"AudioBuffer":d instanceof File?null!==(o=File.name)&&void 0!==o?o:"File":d,cacheOnlineFile:a,encoderConfig:l},f=Ct(8,"track-buf-"),m=be.reportApiInvoke(null,{id:f,tag:st.TRACER,name:Yn.CREATE_BUFFER_AUDIO_TRACK,options:[h]});if(B("DISABLE_WEBAUDIO"))throw new Y(k.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");T.info("start create buffer source audio track with config",JSON.stringify(h),"trackId",f);const g=d;if(!(d instanceof AudioBuffer))try{d=yield(b=L(function*(C,P){let R=null;if("string"==typeof C){const O=$A.get(C);if(O)return T.debug("use cached audio resource: ",C),O;try{R=(yield rs(()=>Oi.get(C,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(M){throw new Y(k.FETCH_AUDIO_FILE_FAILED,M.toString())}}else R=yield new le((M,x)=>{const j=new FileReader;j.onload=W=>{W.target?M(W.target.result):x(new Y(k.READ_LOCAL_AUDIO_FILE_ERROR))},j.onerror=()=>{x(new Y(k.READ_LOCAL_AUDIO_FILE_ERROR))},j.readAsArrayBuffer(C)});const A=yield function(O){const M=Hf();return new le((x,j)=>{M.decodeAudioData(O,W=>{x(W)},W=>{j(new Y(k.DECODE_AUDIO_FILE_FAILED,W.toString()))})})}(R);return"string"==typeof C&&P&&$A.set(C,A),A}),function(C,P){return b.apply(this,arguments)})(d,a)}catch(b){return m.onError(b),b.throw(T)}var b;const v=new F5(d),y=new YS(g,v,l?wA(l):{},f);return T.info("create buffer source audio track success, trackId:",f),m.onSuccess(y.getTrackId()),y});return function(o){return r.apply(this,arguments)}}(),setAppType:function(r){if(T.debug("setAppType: ".concat(r)),!(Number.isInteger(r)&&r>=0))throw T.debug("Invalid appType"),new K(k.INVALID_PARAMS,"invalid app type",r);kt("APP_TYPE",Math.floor(r))},setLogLevel:function(r){T.setLogLevel(r)},enableLogUpload:function(){B("USE_NEW_LOG")?kt("UPLOAD_LOG",!0):T.enableLogUpload()},disableLogUpload:function(){B("USE_NEW_LOG")?kt("UPLOAD_LOG",!1):T.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new wH},checkAudioTrackIsActive:function(){var r=L(function*(i){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const a=be.reportApiInvoke(null,{tag:st.TRACER,name:Yn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[o]});if(!(i instanceof Cn||i instanceof Ol)){const g=new K(k.INVALID_TRACK,"the parameter is not a audio track");return a.onError(g),g.throw()}o&&o<1e3&&(o=1e3);const l=i instanceof Cn?i.getTrackLabel():"remote_track",d=i.getVolumeLevel();let h=d,f=d;const m=Date.now();return new le(g=>{const v=setInterval(()=>{const y=i.getVolumeLevel();h=y>h?y:h,f=y<f?y:f;const b=h-f>1e-4,C=Date.now()-m;if(b||C>o){clearInterval(v);const P=b,R={duration:C,deviceLabel:l,maxVolumeLevel:h,result:P};T.info("[track-".concat(i.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(R))),a.onSuccess(R),g(P)}},200)})});return function(o){return r.apply(this,arguments)}}(),checkVideoTrackIsActive:function(){var r=L(function*(i){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const a=be.reportApiInvoke(null,{tag:st.TRACER,name:Yn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[o]});if(!(i instanceof Ve||i instanceof Dh)){const b=new K(k.INVALID_TRACK,"the parameter is not a video track");return a.onError(b),b.throw()}o&&o<1e3&&(o=1e3);const l=i instanceof Ve?i.getTrackLabel():"remote_track",d=i.getMediaStreamTrack(!0),h=document.createElement("video");h.style.width="1px",h.style.height="1px",h.setAttribute("muted",""),h.muted=!0,h.setAttribute("playsinline",""),h.controls=!1,($e()||T_())&&(h.style.opacity="0.01",h.style.position="fixed",h.style.left="0",h.style.top="0",document.body.appendChild(h)),h.srcObject=new MediaStream([d]),h.play();const f=document.createElement("canvas");f.width=160,f.height=120;let m=0,g=0;try{const b=Date.now();m=yield function(C,P,R){let O,M=0,x=null;return new le((j,W)=>{setTimeout(()=>{O&&(O(),j(M))},P),O=Sx(()=>{!function q(){M>4&&O&&(O(),j(M));const te=R.getContext("2d");if(!te){const Ce=new K(k.UNEXPECTED_ERROR,"can not get canvas 2d context.");return T.error(Ce.toString()),void W(Ce)}te.drawImage(C,0,0,160,120);const J=te.getImageData(0,0,R.width,R.height),X=Math.floor(J.data.length/3);if(x){for(let Ce=0;Ce<X;Ce+=3)if(J.data[Ce]!==x[Ce])return M+=1,void(x=J.data);x=J.data}else x=J.data}()},30)})}(h,o,f),g=Date.now()-b}catch(b){throw a.onError(b),b}Nz===It.SAFARI&&(h.pause(),h.remove()),h.srcObject=null;const v=m>4,y={duration:g,changedPicNum:m,deviceLabel:l,result:v};return T.info("[track-".concat(i.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(y))),a.onSuccess(y),v});return function(o){return r.apply(this,arguments)}}(),setArea:Nh,audioElementPlayCenter:Wi,resumeAudioContext:function(){Wi.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(r){u6.processExternalMediaAEC(r)},registerExtensions:function(r){const i=B("PLUGIN_INFO")||[];r.forEach(o=>{"name"in o&&!he(i).call(i,o.name)&&i.push(o.name);const a=o;a.__registered__=!0,a.logger.hookLog=T.extLog,a.reporter.hookApiInvoke=be.extApiInvoke,a.parameters&&Object.keys(a.parameters).forEach(l=>{a.parameters[l]=B(l)})}),gU("PLUGIN_INFO",i)},ChannelMediaRelayError:Nf,ChannelMediaRelayEvent:Cc,ChannelMediaRelayState:lo,RemoteStreamFallbackType:bz,RemoteStreamType:yz,ConnectionDisconnectedReason:Rt,AudienceLatencyLevelType:h4,AREAS:mt,preload:function(){var r=L(function*(i,o,a,l){return wC(i,o,a,l)});return function(o,a,l,d){return r.apply(this,arguments)}}()});return Object.defineProperties(er,{onAudioAutoplayFailed:{get:()=>Mo.onAudioAutoplayFailed,set:r=>{Mo.onAudioAutoplayFailed=r}},onAutoplayFailed:{get:()=>Mo.onAutoplayFailed,set:r=>{Mo.onAutoplayFailed=r}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>er._onSecurityPolicyViolation,set(r){er._onSecurityPolicyViolation=r,kF(r)}},__CLIENT_LIST__:{get:()=>B("SHOW_GLOBAL_CLIENT_LIST")?Nd:[]}}),po.on(Il.CAMERA_DEVICE_CHANGED,r=>{T.info("camera device changed",JSON.stringify(r)),er.onCameraChanged&&er.onCameraChanged(r),er.safeEmit(Ys.CAMERA_CHANGED,r)}),po.on(Il.RECORDING_DEVICE_CHANGED,r=>{T.info("microphone device changed",JSON.stringify(r)),er.onMicrophoneChanged&&er.onMicrophoneChanged(r),er.safeEmit(Ys.MICROPHONE_CHANGED,r)}),po.on(Il.PLAYOUT_DEVICE_CHANGED,r=>{T.debug("playout device changed",JSON.stringify(r)),er.onPlaybackDeviceChanged&&er.onPlaybackDeviceChanged(r),er.safeEmit(Ys.PLAYBACK_DEVICE_CHANGED,r)}),Wi.onAutoplayFailed=()=>{T.info("detect audio element autoplay failed"),Mo.onAudioAutoplayFailed&&Mo.onAudioAutoplayFailed()},Lt.on("autoplay-failed",()=>{T.info("detect webaudio autoplay failed"),Mo.onAudioAutoplayFailed&&Mo.onAudioAutoplayFailed(),er.safeEmit(Ys.AUTOPLAY_FAILED)}),Lt.on(Ir.STATE_CHANGE,(r,i)=>{T.info("audio context state changed: ".concat(i," => ").concat(r)),er.onAudioContextStateChanged&&er.onAudioContextStateChanged(r,i),er.safeEmit(Ys.AUDIO_CONTEXT_STATE_CHANGED,r,i)}),Se.on(gl.NETWORK_STATE_CHANGE,(r,i)=>{T.info("[network-indicator] network state changed, ".concat(i," => ").concat(r))}),window&&(window.__ARTC__=er),er}()},293:Yl=>{function CE(L,Sr,Ji,Ht,Pt,gt,nc){try{var $l=L[gt](nc),jc=$l.value}catch(pu){return void Ji(pu)}$l.done?Sr(jc):Promise.resolve(jc).then(Ht,Pt)}Yl.exports=function Im(L){return function(){var Sr=this,Ji=arguments;return new Promise(function(Ht,Pt){var gt=L.apply(Sr,Ji);function nc(jc){CE(gt,Ht,Pt,nc,$l,"next",jc)}function $l(jc){CE(gt,Ht,Pt,nc,$l,"throw",jc)}nc(void 0)})}},Yl.exports.__esModule=!0,Yl.exports.default=Yl.exports}},Yl=>{Yl(Yl.s=631)}]);