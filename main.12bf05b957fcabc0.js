(self.webpackChunkngx_webrtc=self.webpackChunkngx_webrtc||[]).push([[179],{572:(rd,z_,Xp)=>{"use strict";let Rt=null,As=1;const qo=Symbol("SIGNAL");function An(e){const n=Rt;return Rt=e,n}function JI(e){if((!Jp(e)||e.dirty)&&(e.dirty||e.lastCleanEpoch!==As)){if(!e.producerMustRecompute(e)&&!ny(e))return e.dirty=!1,void(e.lastCleanEpoch=As);e.producerRecomputeValue(e),e.dirty=!1,e.lastCleanEpoch=As}}function ny(e){dc(e);for(let n=0;n<e.producerNode.length;n++){const t=e.producerNode[n],o=e.producerLastReadVersion[n];if(o!==t.version||(JI(t),o!==t.version))return!0}return!1}function K_(e,n){if(function Y_(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}(e),dc(e),1===e.liveConsumerNode.length)for(let o=0;o<e.producerNode.length;o++)K_(e.producerNode[o],e.producerIndexOfThis[o]);const t=e.liveConsumerNode.length-1;if(e.liveConsumerNode[n]=e.liveConsumerNode[t],e.liveConsumerIndexOfThis[n]=e.liveConsumerIndexOfThis[t],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,n<e.liveConsumerNode.length){const o=e.liveConsumerIndexOfThis[n],c=e.liveConsumerNode[n];dc(c),c.producerIndexOfThis[o]=n}}function Jp(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function dc(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}let Zp=null;function cn(e){return"function"==typeof e}function ay(e){const t=e(o=>{Error.call(o),o.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const gl=ay(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((o,c)=>`${c+1}) ${o.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function J_(e,n){if(e){const t=e.indexOf(n);0<=t&&e.splice(t,1)}}class nr{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const u of t)u.remove(this);else t.remove(this);const{initialTeardown:o}=this;if(cn(o))try{o()}catch(u){n=u instanceof gl?u.errors:[u]}const{_finalizers:c}=this;if(c){this._finalizers=null;for(const u of c)try{tw(u)}catch(p){n=n??[],p instanceof gl?n=[...n,...p.errors]:n.push(p)}}if(n)throw new gl(n)}}add(n){var t;if(n&&n!==this)if(this.closed)tw(n);else{if(n instanceof nr){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(n)}}_hasParent(n){const{_parentage:t}=this;return t===n||Array.isArray(t)&&t.includes(n)}_addParent(n){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(n),t):t?[t,n]:n}_removeParent(n){const{_parentage:t}=this;t===n?this._parentage=null:Array.isArray(t)&&J_(t,n)}remove(n){const{_finalizers:t}=this;t&&J_(t,n),n instanceof nr&&n._removeParent(this)}}nr.EMPTY=(()=>{const e=new nr;return e.closed=!0,e})();const od=nr.EMPTY;function cy(e){return e instanceof nr||e&&"closed"in e&&cn(e.remove)&&cn(e.add)&&cn(e.unsubscribe)}function tw(e){cn(e)?e():e.unsubscribe()}const ur={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Os={setTimeout(e,n,...t){const{delegate:o}=Os;return o?.setTimeout?o.setTimeout(e,n,...t):setTimeout(e,n,...t)},clearTimeout(e){const{delegate:n}=Os;return(n?.clearTimeout||clearTimeout)(e)},delegate:void 0};function Q_(e){Os.setTimeout(()=>{const{onUnhandledError:n}=ur;if(!n)throw e;n(e)})}function ef(){}const fx=lc("C",void 0,void 0);function lc(e,n,t){return{kind:e,value:n,error:t}}let sd=null;function Yu(e){if(ur.useDeprecatedSynchronousErrorHandling){const n=!sd;if(n&&(sd={errorThrown:!1,error:null}),e(),n){const{errorThrown:t,error:o}=sd;if(sd=null,t)throw o}}else e()}class Z_ extends nr{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,cy(n)&&n.add(this)):this.destination=ow}static create(n,t,o){return new $u(n,t,o)}next(n){this.isStopped?ad(function Eo(e){return lc("N",e,void 0)}(n),this):this._next(n)}error(n){this.isStopped?ad(function nw(e){return lc("E",void 0,e)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?ad(fx,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const rw=Function.prototype.bind;function eg(e,n){return rw.call(e,n)}class El{constructor(n){this.partialObserver=n}next(n){const{partialObserver:t}=this;if(t.next)try{t.next(n)}catch(o){tg(o)}}error(n){const{partialObserver:t}=this;if(t.error)try{t.error(n)}catch(o){tg(o)}else tg(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(t){tg(t)}}}class $u extends Z_{constructor(n,t,o){let c;if(super(),cn(n)||!n)c={next:n??void 0,error:t??void 0,complete:o??void 0};else{let u;this&&ur.useDeprecatedNextContext?(u=Object.create(n),u.unsubscribe=()=>this.unsubscribe(),c={next:n.next&&eg(n.next,u),error:n.error&&eg(n.error,u),complete:n.complete&&eg(n.complete,u)}):c=n}this.destination=new El(c)}}function tg(e){ur.useDeprecatedSynchronousErrorHandling?function iw(e){ur.useDeprecatedSynchronousErrorHandling&&sd&&(sd.errorThrown=!0,sd.error=e)}(e):Q_(e)}function ad(e,n){const{onStoppedNotification:t}=ur;t&&Os.setTimeout(()=>t(e,n))}const ow={closed:!0,next:ef,error:function mx(e){throw e},complete:ef},dy="function"==typeof Symbol&&Symbol.observable||"@@observable";function cd(e){return e}function sw(e){return 0===e.length?cd:1===e.length?e[0]:function(t){return e.reduce((o,c)=>c(o),t)}}let Wn=(()=>{class e{constructor(t){t&&(this._subscribe=t)}lift(t){const o=new e;return o.source=this,o.operator=t,o}subscribe(t,o,c){const u=function gx(e){return e&&e instanceof Z_||function Xu(e){return e&&cn(e.next)&&cn(e.error)&&cn(e.complete)}(e)&&cy(e)}(t)?t:new $u(t,o,c);return Yu(()=>{const{operator:p,source:m}=this;u.add(p?p.call(u,m):m?this._subscribe(u):this._trySubscribe(u))}),u}_trySubscribe(t){try{return this._subscribe(t)}catch(o){t.error(o)}}forEach(t,o){return new(o=aw(o))((c,u)=>{const p=new $u({next:m=>{try{t(m)}catch(E){u(E),p.unsubscribe()}},error:u,complete:c});this.subscribe(p)})}_subscribe(t){var o;return null===(o=this.source)||void 0===o?void 0:o.subscribe(t)}[dy](){return this}pipe(...t){return sw(t)(this)}toPromise(t){return new(t=aw(t))((o,c)=>{let u;this.subscribe(p=>u=p,p=>c(p),()=>o(u))})}}return e.create=n=>new e(n),e})();function aw(e){var n;return null!==(n=e??ur.Promise)&&void 0!==n?n:Promise}const Ex=ay(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let bn=(()=>{class e extends Wn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const o=new Ko(this,this);return o.operator=t,o}_throwIfClosed(){if(this.closed)throw new Ex}next(t){Yu(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const o of this.currentObservers)o.next(t)}})}error(t){Yu(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:o}=this;for(;o.length;)o.shift().error(t)}})}complete(){Yu(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:o,isStopped:c,observers:u}=this;return o||c?od:(this.currentObservers=null,u.push(t),new nr(()=>{this.currentObservers=null,J_(u,t)}))}_checkFinalizedStatuses(t){const{hasError:o,thrownError:c,isStopped:u}=this;o?t.error(c):u&&t.complete()}asObservable(){const t=new Wn;return t.source=this,t}}return e.create=(n,t)=>new Ko(n,t),e})();class Ko extends bn{constructor(n,t){super(),this.destination=n,this.source=t}next(n){var t,o;null===(o=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===o||o.call(t,n)}error(n){var t,o;null===(o=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===o||o.call(t,n)}complete(){var n,t;null===(t=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===t||t.call(n)}_subscribe(n){var t,o;return null!==(o=null===(t=this.source)||void 0===t?void 0:t.subscribe(n))&&void 0!==o?o:od}}class Yo extends bn{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const t=super._subscribe(n);return!t.closed&&n.next(this._value),t}getValue(){const{hasError:n,thrownError:t,_value:o}=this;if(n)throw t;return this._throwIfClosed(),o}next(n){super.next(this._value=n)}}function cw(e){return cn(e?.lift)}function Si(e){return n=>{if(cw(n))return n.lift(function(t){try{return e(t,this)}catch(o){this.error(o)}});throw new TypeError("Unable to lift unknown Observable type")}}function di(e,n,t,o,c){return new ly(e,n,t,o,c)}class ly extends Z_{constructor(n,t,o,c,u,p){super(n),this.onFinalize=u,this.shouldUnsubscribe=p,this._next=t?function(m){try{t(m)}catch(E){n.error(E)}}:super._next,this._error=c?function(m){try{c(m)}catch(E){n.error(E)}finally{this.unsubscribe()}}:super._error,this._complete=o?function(){try{o()}catch(m){n.error(m)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function Zt(e,n){return Si((t,o)=>{let c=0;t.subscribe(di(o,u=>{o.next(e.call(n,u,c++))}))})}const uy="https://g.co/ng/security#xss";class pe extends Error{constructor(n,t){super(function Ju(e,n){return`NG0${Math.abs(e)}${n?": "+n:""}`}(n,t)),this.code=n}}function Dn(e){for(let n in e)if(e[n]===Dn)return n;throw Error("Could not find renamed property on target object.")}function bx(e,n){for(const t in n)n.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&(e[t]=n[t])}function Yt(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(Yt).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const n=e.toString();if(null==n)return""+n;const t=n.indexOf("\n");return-1===t?n:n.substring(0,t)}function hy(e,n){return null==e||""===e?null===n?"":n:null==n||""===n?e:e+" "+n}const yx=Dn({__forward_ref__:Dn});function Ln(e){return e.__forward_ref__=Ln,e.toString=function(){return Yt(this())},e}function nt(e){return ng(e)?e():e}function ng(e){return"function"==typeof e&&e.hasOwnProperty(yx)&&e.__forward_ref__===Ln}function ig(e){return e&&!!e.\u0275providers}const tf=Dn({\u0275cmp:Dn}),py=Dn({\u0275dir:Dn}),fy=Dn({\u0275pipe:Dn}),yl=Dn({\u0275mod:Dn}),$s=Dn({\u0275fac:Dn}),nf=Dn({__NG_ELEMENT_ID__:Dn}),li=Dn({__NG_ENV_ID__:Dn});function yt(e){return"string"==typeof e?e:null==e?"":String(e)}function my(e,n){throw new pe(-201,!1)}function vo(e,n){null==e&&function ct(e,n,t,o){throw new Error(`ASSERTION ERROR: ${e}`+(null==o?"":` [Expected=> ${t} ${o} ${n} <=Actual]`))}(n,e,null,"!=")}function Pe(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Jn(e){return{providers:e.providers||[],imports:e.imports||[]}}function og(e){return mw(e,ag)||mw(e,Qu)}function mw(e,n){return e.hasOwnProperty(n)?e[n]:null}function sg(e){return e&&(e.hasOwnProperty(gy)||e.hasOwnProperty(Ns))?e[gy]:null}const ag=Dn({\u0275prov:Dn}),gy=Dn({\u0275inj:Dn}),Qu=Dn({ngInjectableDef:Dn}),Ns=Dn({ngInjectorDef:Dn});var Vt=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(Vt||{});let Ey;function gw(){return Ey}function bo(e){const n=Ey;return Ey=e,n}function Ps(e,n,t){const o=og(e);return o&&"root"==o.providedIn?void 0===o.value?o.value=o.factory():o.value:t&Vt.Optional?null:void 0!==n?n:void my()}const yn=globalThis;class De{constructor(n,t){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Pe({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const cf={},Cy="__NG_DI_FLAG__",cg="ngTempTokenPath",Zu=/\n/gm,Cl="__source";let Tl;function Bt(e){const n=Tl;return Tl=e,n}function xx(e,n=Vt.Default){if(void 0===Tl)throw new pe(-203,!1);return null===Tl?Ps(e,void 0,n):Tl.get(e,n&Vt.Optional?null:void 0,n)}function be(e,n=Vt.Default){return(gw()||xx)(nt(e),n)}function Te(e,n=Vt.Default){return be(e,dg(n))}function dg(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function Ty(e){const n=[];for(let t=0;t<e.length;t++){const o=nt(e[t]);if(Array.isArray(o)){if(0===o.length)throw new pe(900,!1);let c,u=Vt.Default;for(let p=0;p<o.length;p++){const m=o[p],E=bw(m);"number"==typeof E?-1===E?c=m.token:u|=E:c=m}n.push(be(c,u))}else n.push(be(o))}return n}function df(e,n){return e[Cy]=n,e.prototype[Cy]=n,e}function bw(e){return e[Cy]}function uc(e){return{toString:e}.toString()}var Ia=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(Ia||{}),Xs=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(Xs||{});const wa={},ln=[];var Xe=function(e){return e[e.None=0]="None",e[e.SignalBased=1]="SignalBased",e[e.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",e}(Xe||{});function lg(e,n,t){let o=e.length;for(;;){const c=e.indexOf(n,t);if(-1===c)return c;if(0===c||e.charCodeAt(c-1)<=32){const u=n.length;if(c+u===o||e.charCodeAt(c+u)<=32)return c}t=c+1}}function Iy(e,n,t){let o=0;for(;o<t.length;){const c=t[o];if("number"==typeof c){if(0!==c)break;o++;const u=t[o++],p=t[o++],m=t[o++];e.setAttribute(n,p,m,u)}else{const u=c,p=t[++o];hc(u)?e.setProperty(n,u,p):e.setAttribute(n,u,p),o++}}return o}function yw(e){return 3===e||4===e||6===e}function hc(e){return 64===e.charCodeAt(0)}function lf(e,n){if(null!==n&&0!==n.length)if(null===e||0===e.length)e=n.slice();else{let t=-1;for(let o=0;o<n.length;o++){const c=n[o];"number"==typeof c?t=c:0===t||Sw(e,t,c,null,-1===t||2===t?n[++o]:null)}}return e}function Sw(e,n,t,o,c){let u=0,p=e.length;if(-1===n)p=-1;else for(;u<e.length;){const m=e[u++];if("number"==typeof m){if(m===n){p=-1;break}if(m>n){p=u-1;break}}}for(;u<e.length;){const m=e[u];if("number"==typeof m)break;if(m===t){if(null===o)return void(null!==c&&(e[u+1]=c));if(o===e[u+1])return void(e[u+2]=c)}u++,null!==o&&u++,null!==c&&u++}-1!==p&&(e.splice(p,0,n),u=p+1),e.splice(u++,0,t),null!==o&&e.splice(u++,0,o),null!==c&&e.splice(u++,0,c)}const Cw="ng-template";function Fx(e,n,t){let o=0,c=!0;for(;o<e.length;){let u=e[o++];if("string"==typeof u&&c){const p=e[o++];if(t&&"class"===u&&-1!==lg(p.toLowerCase(),n,0))return!0}else{if(1===u){for(;o<e.length&&"string"==typeof(u=e[o++]);)if(u.toLowerCase()===n)return!0;return!1}"number"==typeof u&&(c=!1)}}return!1}function Tw(e){return 4===e.type&&e.value!==Cw}function Ux(e,n,t){return n===(4!==e.type||t?e.value:Cw)}function Iw(e,n,t){let o=4;const c=e.attrs||[],u=function Bx(e){for(let n=0;n<e.length;n++)if(yw(e[n]))return n;return e.length}(c);let p=!1;for(let m=0;m<n.length;m++){const E=n[m];if("number"!=typeof E){if(!p)if(4&o){if(o=2|1&o,""!==E&&!Ux(e,E,t)||""===E&&1===n.length){if(Xo(o))return!1;p=!0}}else{const S=8&o?E:n[++m];if(8&o&&null!==e.attrs){if(!Fx(e.attrs,S,t)){if(Xo(o))return!1;p=!0}continue}const P=Vx(8&o?"class":E,c,Tw(e),t);if(-1===P){if(Xo(o))return!1;p=!0;continue}if(""!==S){let V;V=P>u?"":c[P+1].toLowerCase();const H=8&o?V:null;if(H&&-1!==lg(H,S,0)||2&o&&S!==V){if(Xo(o))return!1;p=!0}}}}else{if(!p&&!Xo(o)&&!Xo(E))return!1;if(p&&Xo(E))continue;p=!1,o=E|1&o}}return Xo(o)||p}function Xo(e){return 0==(1&e)}function Vx(e,n,t,o){if(null===n)return-1;let c=0;if(o||!t){let u=!1;for(;c<n.length;){const p=n[c];if(p===e)return c;if(3===p||6===p)u=!0;else{if(1===p||2===p){let m=n[++c];for(;"string"==typeof m;)m=n[++c];continue}if(4===p)break;if(0===p){c+=4;continue}}c+=u?1:2}return-1}return function jx(e,n){let t=e.indexOf(4);if(t>-1)for(t++;t<e.length;){const o=e[t];if("number"==typeof o)return-1;if(o===n)return t;t++}return-1}(n,e)}function ww(e,n,t=!1){for(let o=0;o<n.length;o++)if(Iw(e,n[o],t))return!0;return!1}function Hx(e,n){e:for(let t=0;t<n.length;t++){const o=n[t];if(e.length===o.length){for(let c=0;c<e.length;c++)if(e[c]!==o[c])continue e;return!0}}return!1}function ld(e,n){return e?":not("+n.trim()+")":n}function Gx(e){let n=e[0],t=1,o=2,c="",u=!1;for(;t<e.length;){let p=e[t];if("string"==typeof p)if(2&o){const m=e[++t];c+="["+p+(m.length>0?'="'+m+'"':"")+"]"}else 8&o?c+="."+p:4&o&&(c+=" "+p);else""!==c&&!Xo(p)&&(n+=ld(u,c),c=""),o=p,u=u||!Xo(o);t++}return""!==c&&(n+=ld(u,c)),n}function Br(e){return uc(()=>{const n=hg(e),t={...n,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===Ia.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||Xs.Emulated,styles:e.styles||ln,_:null,schemas:e.schemas||null,tView:null,id:""};ye(t);const o=e.dependencies;return t.directiveDefs=uf(o,!1),t.pipeDefs=uf(o,!0),t.id=function pg(e){let n=0;const t=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const c of t)n=Math.imul(31,n)+c.charCodeAt(0)<<0;return n+=2147483648,"c"+n}(t),t})}function zx(e){return Lt(e)||qi(e)}function qx(e){return null!==e}function ui(e){return uc(()=>({type:e.type,bootstrap:e.bootstrap||ln,declarations:e.declarations||ln,imports:e.imports||ln,exports:e.exports||ln,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function wy(e,n){if(null==e)return wa;const t={};for(const o in e)if(e.hasOwnProperty(o)){const c=e[o];let u,p,m=Xe.None;Array.isArray(c)?(m=c[0],u=c[1],p=c[2]??u):(u=c,p=c),n?(t[u]=m!==Xe.None?[o,m]:o,n[u]=p):t[u]=o}return t}function Ye(e){return uc(()=>{const n=hg(e);return ye(n),n})}function yo(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function Lt(e){return e[tf]||null}function qi(e){return e[py]||null}function Ar(e){return e[fy]||null}function hr(e,n){const t=e[yl]||null;if(!t&&!0===n)throw new Error(`Type ${Yt(e)} does not have '\u0275mod' property.`);return t}function hg(e){const n={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:e.inputs||wa,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||ln,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:wy(e.inputs,n),outputs:wy(e.outputs),debugInfo:null}}function ye(e){e.features?.forEach(n=>n(e))}function uf(e,n){if(!e)return null;const t=n?Ar:zx;return()=>("function"==typeof e?e():e).map(o=>t(o)).filter(qx)}const Sn=0,Ne=1,et=2,Ai=3,Jo=4,Dr=5,Ms=6,hd=7,zn=8,jr=9,Ra=10,St=11,eh=12,Ry=13,Il=14,fi=15,th=16,wl=17,xs=18,nh=19,Ay=20,fc=21,hf=22,mc=23,mt=25,fg=1,Js=7,Rl=9,Di=10;var mg=function(e){return e[e.None=0]="None",e[e.HasTransplantedViews=2]="HasTransplantedViews",e}(mg||{});function Or(e){return Array.isArray(e)&&"object"==typeof e[fg]}function Nr(e){return Array.isArray(e)&&!0===e[fg]}function _g(e){return 0!=(4&e.flags)}function pd(e){return e.componentOffset>-1}function ff(e){return 1==(1&e.flags)}function ks(e){return!!e.template}function gg(e){return 0!=(512&e[et])}function Al(e,n){return e.hasOwnProperty($s)?e[$s]:null}class ky{constructor(n,t,o){this.previousValue=n,this.currentValue=t,this.firstChange=o}isFirstChange(){return this.firstChange}}function Lw(e,n,t,o){null!==n?n.applyValueToInputSignal(n,o):e[t]=o}function So(){return Fw}function Fw(e){return e.type.prototype.ngOnChanges&&(e.setInput=Uw),Xx}function Xx(){const e=bg(this),n=e?.current;if(n){const t=e.previous;if(t===wa)e.previous=n;else for(let o in n)t[o]=n[o];e.current=null,this.ngOnChanges(n)}}function Uw(e,n,t,o,c){const u=this.declaredInputs[o],p=bg(e)||function Jx(e,n){return e[Vw]=n}(e,{previous:wa,current:null}),m=p.current||(p.current={}),E=p.previous,S=E[u];m[u]=new ky(S&&S.currentValue,t,E===wa),Lw(e,n,c,t)}So.ngInherit=!0;const Vw="__ngSimpleChanges__";function bg(e){return e[Vw]||null}const Aa=function(e,n,t){},Ly="svg";let jw=!1;function On(e){for(;Array.isArray(e);)e=e[Sn];return e}function gf(e,n){return On(n[e])}function io(e,n){return On(n[e.index])}function rh(e,n){return e.data[n]}function Dl(e,n){return e[n]}function Co(e,n){const t=n[e];return Or(t)?t:t[Sn]}function Fy(e){return 128==(128&e[et])}function Qs(e,n){return null==n?null:e[n]}function Gw(e){e[wl]=0}function Ww(e){1024&e[et]||(e[et]|=1024,Fy(e)&&vf(e))}function qw(e){return 9216&e[et]||e[mc]?.dirty}function Uy(e){qw(e)?vf(e):64&e[et]&&(function Hw(){return jw}()?(e[et]|=1024,vf(e)):e[Ra].changeDetectionScheduler?.notify())}function vf(e){e[Ra].changeDetectionScheduler?.notify();let n=Ol(e);for(;null!==n&&!(8192&n[et])&&(n[et]|=8192,Fy(n));)n=Ol(n)}function Sg(e,n){if(256==(256&e[et]))throw new pe(911,!1);null===e[fc]&&(e[fc]=[]),e[fc].push(n)}function Ol(e){const n=e[Ai];return Nr(n)?n[Ai]:n}const dt={lFrame:qy(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function $w(){return dt.bindingsEnabled}function Nl(){return null!==dt.skipHydrationRootTNode}function me(){return dt.lFrame.lView}function qt(){return dt.lFrame.tView}function Da(e){return dt.lFrame.contextLView=e,e[zn]}function Zs(e){return dt.lFrame.contextLView=null,e}function Nn(){let e=Tg();for(;null!==e&&64===e.type;)e=e.parent;return e}function Tg(){return dt.lFrame.currentTNode}function Oa(e,n){const t=dt.lFrame;t.currentTNode=e,t.isParent=n}function yf(){return dt.lFrame.isParent}function Hy(){dt.lFrame.isParent=!1}function ro(){const e=dt.lFrame;let n=e.bindingRootIndex;return-1===n&&(n=e.bindingRootIndex=e.tView.bindingStartIndex),n}function ea(){return dt.lFrame.bindingIndex++}function gc(e){const n=dt.lFrame,t=n.bindingIndex;return n.bindingIndex=n.bindingIndex+e,t}function c1(e,n){const t=dt.lFrame;t.bindingIndex=t.bindingRootIndex=e,Ig(n)}function Ig(e){dt.lFrame.currentDirectiveIndex=e}function Qw(){return dt.lFrame.currentQueryIndex}function Wy(e){dt.lFrame.currentQueryIndex=e}function zy(e){const n=e[Ne];return 2===n.type?n.declTNode:1===n.type?e[Dr]:null}function wg(e,n,t){if(t&Vt.SkipSelf){let c=n,u=e;for(;!(c=c.parent,null!==c||t&Vt.Host||(c=zy(u),null===c||(u=u[Il],10&c.type))););if(null===c)return!1;n=c,e=u}const o=dt.lFrame=Ag();return o.currentTNode=n,o.lView=e,!0}function Rg(e){const n=Ag(),t=e[Ne];dt.lFrame=n,n.currentTNode=t.firstChild,n.lView=e,n.tView=t,n.contextLView=e,n.bindingIndex=t.bindingStartIndex,n.inI18n=!1}function Ag(){const e=dt.lFrame,n=null===e?null:e.child;return null===n?qy(e):n}function qy(e){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=n),n}function Ky(){const e=dt.lFrame;return dt.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const Tf=Ky;function oh(){const e=Ky();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Hr(){return dt.lFrame.selectedIndex}function Pl(e){dt.lFrame.selectedIndex=e}function Qn(){const e=dt.lFrame;return rh(e.tView,e.selectedIndex)}function Qo(){dt.lFrame.currentNamespace=Ly}function Ec(){!function u1(){dt.lFrame.currentNamespace=null}()}let Yy=!0;function Og(){return Yy}function fd(e){Yy=e}function Ng(e,n){for(let t=n.directiveStart,o=n.directiveEnd;t<o;t++){const u=e.data[t].type.prototype,{ngAfterContentInit:p,ngAfterContentChecked:m,ngAfterViewInit:E,ngAfterViewChecked:S,ngOnDestroy:w}=u;p&&(e.contentHooks??=[]).push(-t,p),m&&((e.contentHooks??=[]).push(t,m),(e.contentCheckHooks??=[]).push(t,m)),E&&(e.viewHooks??=[]).push(-t,E),S&&((e.viewHooks??=[]).push(t,S),(e.viewCheckHooks??=[]).push(t,S)),null!=w&&(e.destroyHooks??=[]).push(t,w)}}function If(e,n,t){sh(e,n,3,t)}function Ml(e,n,t,o){(3&e[et])===t&&sh(e,n,t,o)}function $y(e,n){let t=e[et];(3&t)===n&&(t&=16383,t+=1,e[et]=t)}function sh(e,n,t,o){const u=o??-1,p=n.length-1;let m=0;for(let E=void 0!==o?65535&e[wl]:0;E<p;E++)if("number"==typeof n[E+1]){if(m=n[E],null!=o&&m>=o)break}else n[E]<0&&(e[wl]+=65536),(m<u||-1==u)&&(nR(e,t,n,E),e[wl]=(4294901760&e[wl])+E+2),E++}function tR(e,n){Aa(4,e,n);const t=An(null);try{n.call(e)}finally{An(t),Aa(5,e,n)}}function nR(e,n,t,o){const c=t[o]<0,u=t[o+1],m=e[c?-t[o]:t[o]];c?e[et]>>14<e[wl]>>16&&(3&e[et])===n&&(e[et]+=16384,tR(m,u)):tR(m,u)}const ta=-1;class wf{constructor(n,t,o){this.factory=n,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=o}}function mi(e){return e!==ta}function Rf(e){return 32767&e}function Af(e,n){let t=function p1(e){return e>>16}(e),o=n;for(;t>0;)o=o[Il],t--;return o}let Xy=!0;function Df(e){const n=Xy;return Xy=e,n}const rR=255,oR=5;let f1=0;const Na={};function xg(e,n){const t=kl(e,n);if(-1!==t)return t;const o=n[Ne];o.firstCreatePass&&(e.injectorIndex=n.length,kg(o.data,e),kg(n,null),kg(o.blueprint,null));const c=Lg(e,n),u=e.injectorIndex;if(mi(c)){const p=Rf(c),m=Af(c,n),E=m[Ne].data;for(let S=0;S<8;S++)n[u+S]=m[p+S]|E[p+S]}return n[u+8]=c,u}function kg(e,n){e.push(0,0,0,0,0,0,0,0,n)}function kl(e,n){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===n[e.injectorIndex+8]?-1:e.injectorIndex}function Lg(e,n){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let t=0,o=null,c=n;for(;null!==c;){if(o=lR(c),null===o)return ta;if(t++,c=c[Il],-1!==o.injectorIndex)return o.injectorIndex|t<<16}return ta}function Fg(e,n,t){!function m1(e,n,t){let o;"string"==typeof t?o=t.charCodeAt(0)||0:t.hasOwnProperty(nf)&&(o=t[nf]),null==o&&(o=t[nf]=f1++);const c=o&rR;n.data[e+(c>>oR)]|=1<<c}(e,n,t)}function Jy(e,n,t){if(t&Vt.Optional||void 0!==e)return e;my()}function sR(e,n,t,o){if(t&Vt.Optional&&void 0===o&&(o=null),!(t&(Vt.Self|Vt.Host))){const c=e[jr],u=bo(void 0);try{return c?c.get(n,o,t&Vt.Optional):Ps(n,o,t&Vt.Optional)}finally{bo(u)}}return Jy(o,0,t)}function aR(e,n,t,o=Vt.Default,c){if(null!==e){if(2048&n[et]&&!(o&Vt.Self)){const p=function E1(e,n,t,o,c){let u=e,p=n;for(;null!==u&&null!==p&&2048&p[et]&&!(512&p[et]);){const m=Ug(u,p,t,o|Vt.Self,Na);if(m!==Na)return m;let E=u.parent;if(!E){const S=p[Ay];if(S){const w=S.get(t,Na,o);if(w!==Na)return w}E=lR(p),p=p[Il]}u=E}return c}(e,n,t,o,Na);if(p!==Na)return p}const u=Ug(e,n,t,o,Na);if(u!==Na)return u}return sR(n,t,o,c)}function Ug(e,n,t,o,c){const u=function cR(e){if("string"==typeof e)return e.charCodeAt(0)||0;const n=e.hasOwnProperty(nf)?e[nf]:void 0;return"number"==typeof n?n>=0?n&rR:g1:n}(t);if("function"==typeof u){if(!wg(n,e,o))return o&Vt.Host?Jy(c,0,o):sR(n,t,o,c);try{let p;if(p=u(o),null!=p||o&Vt.Optional)return p;my()}finally{Tf()}}else if("number"==typeof u){let p=null,m=kl(e,n),E=ta,S=o&Vt.Host?n[fi][Dr]:null;for((-1===m||o&Vt.SkipSelf)&&(E=-1===m?Lg(e,n):n[m+8],E!==ta&&dR(o,!1)?(p=n[Ne],m=Rf(E),n=Af(E,n)):m=-1);-1!==m;){const w=n[Ne];if(Bg(u,m,w.data)){const P=Qy(m,n,t,p,o,S);if(P!==Na)return P}E=n[m+8],E!==ta&&dR(o,n[Ne].data[m+8]===S)&&Bg(u,m,n)?(p=w,m=Rf(E),n=Af(E,n)):m=-1}}return c}function Qy(e,n,t,o,c,u){const p=n[Ne],m=p.data[e+8],w=Vg(m,p,t,null==o?pd(m)&&Xy:o!=p&&0!=(3&m.type),c&Vt.Host&&u===m);return null!==w?Ll(n,p,w,m):Na}function Vg(e,n,t,o,c){const u=e.providerIndexes,p=n.data,m=1048575&u,E=e.directiveStart,w=u>>20,V=c?m+w:e.directiveEnd;for(let H=o?m:m+w;H<V;H++){const z=p[H];if(H<E&&t===z||H>=E&&z.type===t)return H}if(c){const H=p[E];if(H&&ks(H)&&H.type===t)return E}return null}function Ll(e,n,t,o){let c=e[t];const u=n.data;if(function Pg(e){return e instanceof wf}(c)){const p=c;p.resolving&&function Tx(e,n){const t=n?`. Dependency path: ${n.join(" > ")} > ${e}`:"";throw new pe(-200,`Circular dependency in DI detected for ${e}${t}`)}(function dn(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():yt(e)}(u[t]));const m=Df(p.canSeeViewProviders);p.resolving=!0;const S=p.injectImpl?bo(p.injectImpl):null;wg(e,o,Vt.Default);try{c=e[t]=p.factory(void 0,u,e,o),n.firstCreatePass&&t>=o.directiveStart&&function eR(e,n,t){const{ngOnChanges:o,ngOnInit:c,ngDoCheck:u}=n.type.prototype;if(o){const p=Fw(n);(t.preOrderHooks??=[]).push(e,p),(t.preOrderCheckHooks??=[]).push(e,p)}c&&(t.preOrderHooks??=[]).push(0-e,c),u&&((t.preOrderHooks??=[]).push(e,u),(t.preOrderCheckHooks??=[]).push(e,u))}(t,u[t],n)}finally{null!==S&&bo(S),Df(m),p.resolving=!1,Tf()}}return c}function Bg(e,n,t){return!!(t[n+(e>>oR)]&1<<e)}function dR(e,n){return!(e&Vt.Self||e&Vt.Host&&n)}class Oi{constructor(n,t){this._tNode=n,this._lView=t}get(n,t,o){return aR(this._tNode,this._lView,n,dg(o),t)}}function g1(){return new Oi(Nn(),me())}function Ki(e){return uc(()=>{const n=e.prototype.constructor,t=n[$s]||Zy(n),o=Object.prototype;let c=Object.getPrototypeOf(e.prototype).constructor;for(;c&&c!==o;){const u=c[$s]||Zy(c);if(u&&u!==t)return u;c=Object.getPrototypeOf(c)}return u=>new u})}function Zy(e){return ng(e)?()=>{const n=Zy(nt(e));return n&&n()}:Al(e)}function lR(e){const n=e[Ne],t=n.type;return 2===t?n.declTNode:1===t?e[Dr]:null}const ch="__parameters__";function dh(e,n,t){return uc(()=>{const o=function Of(e){return function(...t){if(e){const o=e(...t);for(const c in o)this[c]=o[c]}}}(n);function c(...u){if(this instanceof c)return o.apply(this,u),this;const p=new c(...u);return m.annotation=p,m;function m(E,S,w){const P=E.hasOwnProperty(ch)?E[ch]:Object.defineProperty(E,ch,{value:[]})[ch];for(;P.length<=w;)P.push(null);return(P[w]=P[w]||[]).push(p),E}}return t&&(c.prototype=Object.create(t.prototype)),c.prototype.ngMetadataName=e,c.annotationCls=c,c})}function Fl(e,n){e.forEach(t=>Array.isArray(t)?Fl(t,n):n(t))}function pR(e,n,t){n>=e.length?e.push(t):e.splice(n,0,t)}function Mf(e,n){return n>=e.length-1?e.pop():e.splice(n,1)[0]}function es(e,n,t){let o=ph(e,n);return o>=0?e[1|o]=t:(o=~o,function iS(e,n,t,o){let c=e.length;if(c==n)e.push(t,o);else if(1===c)e.push(o,e[0]),e[0]=t;else{for(c--,e.push(e[c-1],e[c]);c>n;)e[c]=e[c-2],c--;e[n]=t,e[n+1]=o}}(e,o,n,t)),o}function rS(e,n){const t=ph(e,n);if(t>=0)return e[1|t]}function ph(e,n){return function mR(e,n,t){let o=0,c=e.length>>t;for(;c!==o;){const u=o+(c-o>>1),p=e[u<<t];if(n===p)return u<<t;p>n?c=u:o=u+1}return~(c<<t)}(e,n,1)}const Vl=df(dh("Optional"),8),fh=df(dh("SkipSelf"),4),_d=new De(""),SR=new De("",-1),cS=new De("");class Kg{get(n,t=cf){if(t===cf){const o=new Error(`NullInjectorError: No provider for ${Yt(n)}!`);throw o.name="NullInjectorError",o}return t}}function CR(...e){return{\u0275providers:TR(0,e),\u0275fromNgModule:!0}}function TR(e,...n){const t=[],o=new Set;let c;const u=p=>{t.push(p)};return Fl(n,p=>{const m=p;$g(m,u,[],o)&&(c||=[],c.push(m))}),void 0!==c&&Yg(c,u),t}function Yg(e,n){for(let t=0;t<e.length;t++){const{ngModule:o,providers:c}=e[t];lS(c,u=>{n(u,o)})}}function $g(e,n,t,o){if(!(e=nt(e)))return!1;let c=null,u=sg(e);const p=!u&&Lt(e);if(u||p){if(p&&!p.standalone)return!1;c=e}else{const E=e.ngModule;if(u=sg(E),!u)return!1;c=E}const m=o.has(c);if(p){if(m)return!1;if(o.add(c),p.dependencies){const E="function"==typeof p.dependencies?p.dependencies():p.dependencies;for(const S of E)$g(S,n,t,o)}}else{if(!u)return!1;{if(null!=u.imports&&!m){let S;o.add(c);try{Fl(u.imports,w=>{$g(w,n,t,o)&&(S||=[],S.push(w))})}finally{}void 0!==S&&Yg(S,n)}if(!m){const S=Al(c)||(()=>new c);n({provide:c,useFactory:S,deps:ln},c),n({provide:cS,useValue:c,multi:!0},c),n({provide:_d,useValue:()=>be(c),multi:!0},c)}const E=u.providers;if(null!=E&&!m){const S=e;lS(E,w=>{n(w,S)})}}}return c!==e&&void 0!==e.providers}function lS(e,n){for(let t of e)ig(t)&&(t=t.\u0275providers),Array.isArray(t)?lS(t,n):n(t)}const I1=Dn({provide:String,useValue:Dn});function uS(e){return null!==e&&"object"==typeof e&&I1 in e}function gd(e){return"function"==typeof e}const pS=new De(""),Uf={},w1={};let Xg;function Jg(){return void 0===Xg&&(Xg=new Kg),Xg}class ts{}class jl extends ts{get destroyed(){return this._destroyed}constructor(n,t,o,c){super(),this.parent=t,this.source=o,this.scopes=c,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,_S(n,p=>this.processProvider(p)),this.records.set(SR,Hl(void 0,this)),c.has("environment")&&this.records.set(ts,Hl(void 0,this));const u=this.records.get(pS);null!=u&&"string"==typeof u.value&&this.scopes.add(u.value),this.injectorDefTypes=new Set(this.get(cS,ln,Vt.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();const n=this._onDestroyHooks;this._onDestroyHooks=[];for(const t of n)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(n){return this.assertNotDestroyed(),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){this.assertNotDestroyed();const t=Bt(this),o=bo(void 0);try{return n()}finally{Bt(t),bo(o)}}get(n,t=cf,o=Vt.Default){if(this.assertNotDestroyed(),n.hasOwnProperty(li))return n[li](this);o=dg(o);const u=Bt(this),p=bo(void 0);try{if(!(o&Vt.SkipSelf)){let E=this.records.get(n);if(void 0===E){const S=function A1(e){return"function"==typeof e||"object"==typeof e&&e instanceof De}(n)&&og(n);E=S&&this.injectableDefInScope(S)?Hl(fS(n),Uf):null,this.records.set(n,E)}if(null!=E)return this.hydrate(n,E)}return(o&Vt.Self?Jg():this.parent).get(n,t=o&Vt.Optional&&t===cf?null:t)}catch(m){if("NullInjectorError"===m.name){if((m[cg]=m[cg]||[]).unshift(Yt(n)),u)throw m;return function kx(e,n,t,o){const c=e[cg];throw n[Cl]&&c.unshift(n[Cl]),e.message=function Lx(e,n,t,o=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let c=Yt(n);if(Array.isArray(n))c=n.map(Yt).join(" -> ");else if("object"==typeof n){let u=[];for(let p in n)if(n.hasOwnProperty(p)){let m=n[p];u.push(p+":"+("string"==typeof m?JSON.stringify(m):Yt(m)))}c=`{${u.join(", ")}}`}return`${t}${o?"("+o+")":""}[${c}]: ${e.replace(Zu,"\n  ")}`}("\n"+e.message,c,t,o),e.ngTokenPath=c,e[cg]=null,e}(m,n,"R3InjectorError",this.source)}throw m}finally{bo(p),Bt(u)}}resolveInjectorInitializers(){const n=Bt(this),t=bo(void 0);try{const c=this.get(_d,ln,Vt.Self);for(const u of c)u()}finally{Bt(n),bo(t)}}toString(){const n=[],t=this.records;for(const o of t.keys())n.push(Yt(o));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new pe(205,!1)}processProvider(n){let t=gd(n=nt(n))?n:nt(n&&n.provide);const o=function RR(e){return uS(e)?Hl(void 0,e.useValue):Hl(mS(e),Uf)}(n);if(!gd(n)&&!0===n.multi){let c=this.records.get(t);c||(c=Hl(void 0,Uf,!0),c.factory=()=>Ty(c.multi),this.records.set(t,c)),t=n,c.multi.push(n)}this.records.set(t,o)}hydrate(n,t){return t.value===Uf&&(t.value=w1,t.value=t.factory()),"object"==typeof t.value&&t.value&&function R1(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(n){if(!n.providedIn)return!1;const t=nt(n.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(n){const t=this._onDestroyHooks.indexOf(n);-1!==t&&this._onDestroyHooks.splice(t,1)}}function fS(e){const n=og(e),t=null!==n?n.factory:Al(e);if(null!==t)return t;if(e instanceof De)throw new pe(204,!1);if(e instanceof Function)return function Vf(e){if(e.length>0)throw new pe(204,!1);const t=function _w(e){return e&&(e[ag]||e[Qu])||null}(e);return null!==t?()=>t.factory(e):()=>new e}(e);throw new pe(204,!1)}function mS(e,n,t){let o;if(gd(e)){const c=nt(e);return Al(c)||fS(c)}if(uS(e))o=()=>nt(e.useValue);else if(function hS(e){return!(!e||!e.useFactory)}(e))o=()=>e.useFactory(...Ty(e.deps||[]));else if(function IR(e){return!(!e||!e.useExisting)}(e))o=()=>be(nt(e.useExisting));else{const c=nt(e&&(e.useClass||e.provide));if(!function AR(e){return!!e.deps}(e))return Al(c)||fS(c);o=()=>new c(...Ty(e.deps))}return o}function Hl(e,n,t=!1){return{factory:e,value:n,multi:t?[]:void 0}}function _S(e,n){for(const t of e)Array.isArray(t)?_S(t,n):t&&ig(t)?_S(t.\u0275providers,n):n(t)}function wo(e,n){e instanceof jl&&e.assertNotDestroyed();const o=Bt(e),c=bo(void 0);try{return n()}finally{Bt(o),bo(c)}}function PR(e,n=null,t=null,o){const c=MR(e,n,t,o);return c.resolveInjectorInitializers(),c}function MR(e,n=null,t=null,o,c=new Set){const u=[t||ln,CR(e)];return o=o||("object"==typeof e?void 0:Yt(e)),new jl(u,n||Jg(),o||null,c)}let bS,pr=(()=>{class e{static#e=this.THROW_IF_NOT_FOUND=cf;static#t=this.NULL=new Kg;static create(t,o){if(Array.isArray(t))return PR({name:""},o,t,"");{const c=t.name??"";return PR({name:c},t.parent,t.providers,c)}}static#n=this.\u0275prov=Pe({token:e,providedIn:"any",factory:()=>be(SR)});static#i=this.__NG_ELEMENT_ID__=-1}return e})();const Bf=new De("",{providedIn:"root",factory:()=>FR}),FR="ng",UR=new De(""),Ma=new De("",{providedIn:"platform",factory:()=>"unknown"}),yc=new De(""),yS=new De("",{providedIn:"root",factory:()=>function Pa(){if(void 0!==bS)return bS;if(typeof document<"u")return document;throw new pe(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});function ao(e){return e instanceof Function?e():e}function nE(e){return 128==(128&e.flags)}var xa=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(xa||{});const qR=/^>|^->|<!--|-->|--!>|<!-$/g,iE=/(<|>)/g,KR="\u200b$1\u200b";const rE=new Map;let $R=0;const NS="__ngContext__";function Gr(e,n){Or(n)?(e[NS]=n[nh],function XR(e){rE.set(e[nh],e)}(n)):e[NS]=n}let aE;function MS(e,n){return aE(e,n)}function yd(e,n,t,o,c){if(null!=o){let u,p=!1;Nr(o)?u=o:Or(o)&&(p=!0,o=o[Sn]);const m=On(o);0===e&&null!==t?null==c?pE(n,t,m):Ls(n,t,m,c||null,!0):1===e&&null!==t?Ls(n,t,m,c||null,!0):2===e?function _E(e,n,t){const o=fE(e,n);o&&function $1(e,n,t,o){e.removeChild(n,t,o)}(e,o,n,t)}(n,m,p):3===e&&n.destroyNode(m),null!=u&&function J1(e,n,t,o,c){const u=t[Js];u!==On(t)&&yd(n,e,o,u,c);for(let m=Di;m<t.length;m++){const E=t[m];gE(E[Ne],E,e,n,o,u)}}(n,e,u,t,c)}}function dE(e,n){return e.createComment(function YR(e){return e.replace(qR,n=>n.replace(iE,KR))}(n))}function lE(e,n,t){return e.createElement(n,t)}function sA(e,n){gE(e,n,n[St],2,null,null)}function xS(e,n){const t=e[Rl],o=t.indexOf(n);t.splice(o,1)}function Gf(e,n){if(e.length<=Di)return;const t=Di+n,o=e[t];if(o){const c=o[th];null!==c&&c!==e&&xS(c,o),n>0&&(e[t-1][Jo]=o[Jo]);const u=Mf(e,Di+n);!function oA(e,n){sA(e,n),n[Sn]=null,n[Dr]=null}(o[Ne],o);const p=u[xs];null!==p&&p.detachView(u[Ne]),o[Ai]=null,o[Jo]=null,o[et]&=-129}return o}function Wf(e,n){if(!(256&n[et])){const t=n[St];t.destroyNode&&gE(e,n,t,3,null,null),function K1(e){let n=e[eh];if(!n)return zf(e[Ne],e);for(;n;){let t=null;if(Or(n))t=n[eh];else{const o=n[Di];o&&(t=o)}if(!t){for(;n&&!n[Jo]&&n!==e;)Or(n)&&zf(n[Ne],n),n=n[Ai];null===n&&(n=e),Or(n)&&zf(n[Ne],n),t=n&&n[Jo]}n=t}}(n)}}function zf(e,n){if(!(256&n[et])){n[et]&=-129,n[et]|=256,n[mc]&&function QI(e){if(dc(e),Jp(e))for(let n=0;n<e.producerNode.length;n++)K_(e.producerNode[n],e.producerIndexOfThis[n]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}(n[mc]),function Y1(e,n){let t;if(null!=e&&null!=(t=e.destroyHooks))for(let o=0;o<t.length;o+=2){const c=n[t[o]];if(!(c instanceof wf)){const u=t[o+1];if(Array.isArray(u))for(let p=0;p<u.length;p+=2){const m=c[u[p]],E=u[p+1];Aa(4,m,E);try{E.call(m)}finally{Aa(5,m,E)}}else{Aa(4,c,u);try{u.call(c)}finally{Aa(5,c,u)}}}}}(e,n),function cA(e,n){const t=e.cleanup,o=n[hd];if(null!==t)for(let u=0;u<t.length-1;u+=2)if("string"==typeof t[u]){const p=t[u+3];p>=0?o[p]():o[-p].unsubscribe(),u+=2}else t[u].call(o[t[u+1]]);null!==o&&(n[hd]=null);const c=n[fc];if(null!==c){n[fc]=null;for(let u=0;u<c.length;u++)(0,c[u])()}}(e,n),1===n[Ne].type&&n[St].destroy();const t=n[th];if(null!==t&&Nr(n[Ai])){t!==n[Ai]&&xS(t,n);const o=n[xs];null!==o&&o.detachView(e)}!function H1(e){rE.delete(e[nh])}(n)}}function hE(e,n,t){return function kS(e,n,t){let o=n;for(;null!==o&&40&o.type;)o=(n=o).parent;if(null===o)return t[Sn];{const{componentOffset:c}=o;if(c>-1){const{encapsulation:u}=e.data[o.directiveStart+c];if(u===Xs.None||u===Xs.Emulated)return null}return io(o,t)}}(e,n.parent,t)}function Ls(e,n,t,o,c){e.insertBefore(n,t,o,c)}function pE(e,n,t){e.appendChild(n,t)}function dA(e,n,t,o,c){null!==o?Ls(e,n,t,o,c):pE(e,n,t)}function fE(e,n){return e.parentNode(n)}function uA(e,n,t){return hA(e,n,t)}let FS,hA=function LS(e,n,t){return 40&e.type?io(e,t):null};function mE(e,n,t,o){const c=hE(e,o,n),u=n[St],m=uA(o.parent||n[Dr],o,n);if(null!=c)if(Array.isArray(t))for(let E=0;E<t.length;E++)dA(u,c,t[E],m,!1);else dA(u,c,t,m,!1);void 0!==FS&&FS(u,o,n,t,c)}function yh(e,n){if(null!==n){const t=n.type;if(3&t)return io(n,e);if(4&t)return BS(-1,e[n.index]);if(8&t){const o=n.child;if(null!==o)return yh(e,o);{const c=e[n.index];return Nr(c)?BS(-1,c):On(c)}}if(32&t)return MS(n,e)()||On(e[n.index]);{const o=VS(e,n);return null!==o?Array.isArray(o)?o[0]:yh(Ol(e[fi]),o):yh(e,n.next)}}return null}function VS(e,n){return null!==n?e[fi][Dr].projection[n.projection]:null}function BS(e,n){const t=Di+e+1;if(t<n.length){const o=n[t],c=o[Ne].firstChild;if(null!==c)return yh(o,c)}return n[Js]}function Wl(e,n,t,o,c,u,p){for(;null!=t;){const m=o[t.index],E=t.type;if(p&&0===n&&(m&&Gr(On(m),o),t.flags|=2),32!=(32&t.flags))if(8&E)Wl(e,n,t.child,o,c,u,!1),yd(n,e,c,m,u);else if(32&E){const S=MS(t,o);let w;for(;w=S();)yd(n,e,c,w,u);yd(n,e,c,m,u)}else 16&E?C(e,n,o,t,c,u):yd(n,e,c,m,u);t=p?t.projectionNext:t.next}}function gE(e,n,t,o,c,u){Wl(t,o,e.firstChild,n,c,u,!1)}function C(e,n,t,o,c,u){const p=t[fi],E=p[Dr].projection[o.projection];if(Array.isArray(E))for(let S=0;S<E.length;S++)yd(n,e,c,E[S],u);else{let S=E;const w=p[Ai];nE(o)&&(S.flags|=128),Wl(e,n,S,w,c,u,!0)}}function pA(e,n,t){""===t?e.removeAttribute(n,"class"):e.setAttribute(n,"class",t)}function fA(e,n,t){const{mergedAttrs:o,classes:c,styles:u}=t;null!==o&&Iy(e,n,o),null!==c&&pA(e,n,c),null!==u&&function Z1(e,n,t){e.setAttribute(n,"style",t)}(e,n,u)}class EE{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${uy})`}}function Sd(e){return e instanceof EE?e.changingThisBreaksApplicationSecurity:e}const TA=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var wh=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}(wh||{});function KS(e){const n=function Rh(){const e=me();return e&&e[Ra].sanitizer}();return n?n.sanitize(wh.URL,e)||"":function Th(e,n){const t=function sk(e){return e instanceof EE&&e.getTypeName()||null}(e);if(null!=t&&t!==n){if("ResourceURL"===t&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${t} (see ${uy})`)}return t===n}(e,"URL")?Sd(e):function vE(e){return(e=String(e)).match(TA)?e:"unsafe:"+e}(yt(e))}class YS{}let LA=()=>null;function tC(e,n,t=!1){return LA(e,n,t)}class Ok{}class UA{}class RE{resolveComponentFactory(n){throw function Nk(e){const n=Error(`No component factory found for ${Yt(e)}.`);return n.ngComponent=e,n}(n)}}let Mh=(()=>{class e{static#e=this.NULL=new RE}return e})();function xh(){return Cd(Nn(),me())}function Cd(e,n){return new en(io(e,n))}let en=(()=>{class e{constructor(t){this.nativeElement=t}static#e=this.__NG_ELEMENT_ID__=xh}return e})();function kh(e){return e instanceof en?e.nativeElement:e}class AE{}let Fs=(()=>{class e{constructor(){this.destroyNode=null}static#e=this.__NG_ELEMENT_ID__=()=>function Jf(){const e=me(),t=Co(Nn().index,e);return(Or(t)?t:e)[St]}()}return e})(),Pk=(()=>{class e{static#e=this.\u0275prov=Pe({token:e,providedIn:"root",factory:()=>null})}return e})();const oC={};function BA(e){const n=An(null);try{return e()}finally{An(n)}}function DE(e){return!!function sC(e){return null!==e&&("function"==typeof e||"object"==typeof e)}(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}class HA{constructor(){}supports(n){return DE(n)}create(n){return new Fk(n)}}const GA=(e,n)=>n;class Fk{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||GA}forEachItem(n){let t;for(t=this._itHead;null!==t;t=t._next)n(t)}forEachOperation(n){let t=this._itHead,o=this._removalsHead,c=0,u=null;for(;t||o;){const p=!o||t&&t.currentIndex<qA(o,c,u)?t:o,m=qA(p,c,u),E=p.currentIndex;if(p===o)c--,o=o._nextRemoved;else if(t=t._next,null==p.previousIndex)c++;else{u||(u=[]);const S=m-c,w=E-c;if(S!=w){for(let V=0;V<S;V++){const H=V<u.length?u[V]:u[V]=0,z=H+V;w<=z&&z<S&&(u[V]=H+1)}u[p.previousIndex]=w-S}}m!==E&&n(p,m,E)}}forEachPreviousItem(n){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)n(t)}forEachAddedItem(n){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)n(t)}forEachMovedItem(n){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)n(t)}forEachRemovedItem(n){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)n(t)}forEachIdentityChange(n){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)n(t)}diff(n){if(null==n&&(n=[]),!DE(n))throw new pe(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let c,u,p,t=this._itHead,o=!1;if(Array.isArray(n)){this.length=n.length;for(let m=0;m<this.length;m++)u=n[m],p=this._trackByFn(m,u),null!==t&&Object.is(t.trackById,p)?(o&&(t=this._verifyReinsertion(t,u,p,m)),Object.is(t.item,u)||this._addIdentityChange(t,u)):(t=this._mismatch(t,u,p,m),o=!0),t=t._next}else c=0,function Lk(e,n){if(Array.isArray(e))for(let t=0;t<e.length;t++)n(e[t]);else{const t=e[Symbol.iterator]();let o;for(;!(o=t.next()).done;)n(o.value)}}(n,m=>{p=this._trackByFn(c,m),null!==t&&Object.is(t.trackById,p)?(o&&(t=this._verifyReinsertion(t,m,p,c)),Object.is(t.item,m)||this._addIdentityChange(t,m)):(t=this._mismatch(t,m,p,c),o=!0),t=t._next,c++}),this.length=c;return this._truncate(t),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,t,o,c){let u;return null===n?u=this._itTail:(u=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(o,null))?(Object.is(n.item,t)||this._addIdentityChange(n,t),this._reinsertAfter(n,u,c)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(o,c))?(Object.is(n.item,t)||this._addIdentityChange(n,t),this._moveAfter(n,u,c)):n=this._addAfter(new WA(t,o),u,c),n}_verifyReinsertion(n,t,o,c){let u=null===this._unlinkedRecords?null:this._unlinkedRecords.get(o,null);return null!==u?n=this._reinsertAfter(u,n._prev,c):n.currentIndex!=c&&(n.currentIndex=c,this._addToMoves(n,c)),n}_truncate(n){for(;null!==n;){const t=n._next;this._addToRemovals(this._unlink(n)),n=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,t,o){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const c=n._prevRemoved,u=n._nextRemoved;return null===c?this._removalsHead=u:c._nextRemoved=u,null===u?this._removalsTail=c:u._prevRemoved=c,this._insertAfter(n,t,o),this._addToMoves(n,o),n}_moveAfter(n,t,o){return this._unlink(n),this._insertAfter(n,t,o),this._addToMoves(n,o),n}_addAfter(n,t,o){return this._insertAfter(n,t,o),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,t,o){const c=null===t?this._itHead:t._next;return n._next=c,n._prev=t,null===c?this._itTail=n:c._prev=n,null===t?this._itHead=n:t._next=n,null===this._linkedRecords&&(this._linkedRecords=new zA),this._linkedRecords.put(n),n.currentIndex=o,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const t=n._prev,o=n._next;return null===t?this._itHead=o:t._next=o,null===o?this._itTail=t:o._prev=t,n}_addToMoves(n,t){return n.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new zA),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,t){return n.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class WA{constructor(n,t){this.item=n,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class ns{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,t){let o;for(o=this._head;null!==o;o=o._nextDup)if((null===t||t<=o.currentIndex)&&Object.is(o.trackById,n))return o;return null}remove(n){const t=n._prevDup,o=n._nextDup;return null===t?this._head=o:t._nextDup=o,null===o?this._tail=t:o._prevDup=t,null===this._head}}class zA{constructor(){this.map=new Map}put(n){const t=n.trackById;let o=this.map.get(t);o||(o=new ns,this.map.set(t,o)),o.add(n)}get(n,t){const c=this.map.get(n);return c?c.get(n,t):null}remove(n){const t=n.trackById;return this.map.get(t).remove(n)&&this.map.delete(t),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function qA(e,n,t){const o=e.previousIndex;if(null===o)return o;let c=0;return t&&o<t.length&&(c=t[o]),o+n+c}function cC(){return new dC([new HA])}let dC=(()=>{class e{static#e=this.\u0275prov=Pe({token:e,providedIn:"root",factory:cC});constructor(t){this.factories=t}static create(t,o){if(null!=o){const c=o.factories.slice();t=t.concat(c)}return new e(t)}static extend(t){return{provide:e,useFactory:o=>e.create(t,o||cC()),deps:[[e,new fh,new Vl]]}}find(t){const o=this.factories.find(c=>c.supports(t));if(null!=o)return o;throw new pe(901,!1)}}return e})();function ql(e,n,t,o,c=!1){for(;null!==t;){const u=n[t.index];null!==u&&o.push(On(u)),Nr(u)&&NE(u,o);const p=t.type;if(8&p)ql(e,n,t.child,o);else if(32&p){const m=MS(t,n);let E;for(;E=m();)o.push(E)}else if(16&p){const m=VS(n,t);if(Array.isArray(m))o.push(...m);else{const E=Ol(n[fi]);ql(E[Ne],E,m,o,!0)}}t=c?t.projectionNext:t.next}return o}function NE(e,n){for(let t=Di;t<e.length;t++){const o=e[t],c=o[Ne].firstChild;null!==c&&ql(o[Ne],o,c,n)}e[Js]!==e[Sn]&&n.push(e[Js])}let $A=[];const Hk={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{},consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{vf(e.lView)},consumerOnSignalRead(){this.lView[mc]=this}};function hC(e){return ME(e[eh])}function PE(e){return ME(e[Jo])}function ME(e){for(;null!==e&&!Nr(e);)e=e[Jo];return e}function xE(e){return e.ngOriginalError}class ka{constructor(){this._console=console}handleError(n){const t=this._findOriginalError(n);this._console.error("ERROR",n),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(n){let t=n&&xE(n);for(;t&&xE(t);)t=xE(t);return t||null}}const Kl=new De("",{providedIn:"root",factory:()=>Te(ka).handleError.bind(void 0)}),LE=new De("",{providedIn:"root",factory:()=>!1}),_t={};function Qe(e=1){fC(qt(),me(),Hr()+e,!1)}function fC(e,n,t,o){if(!o)if(3==(3&n[et])){const u=e.preOrderCheckHooks;null!==u&&If(n,u,t)}else{const u=e.preOrderHooks;null!==u&&Ml(n,u,0,t)}Pl(t)}function ae(e,n=Vt.Default){const t=me();return null===t?be(e,n):aR(Nn(),t,nt(e),n)}function Fh(){throw new Error("invalid")}function mC(e,n,t,o,c,u){const p=An(null);try{let m=null;c&Xe.SignalBased&&(m=n[o][qo]),null!==m&&void 0!==m.transformFn&&(u=m.transformFn(u)),c&Xe.HasDecoratorInputTransform&&(u=e.inputTransforms[o].call(n,u)),null!==e.setInput?e.setInput(n,m,u,t,o):Lw(n,m,o,u)}finally{An(p)}}function Yl(e,n,t,o,c,u,p,m,E,S,w){const P=n.blueprint.slice();return P[Sn]=c,P[et]=204|o,(null!==S||e&&2048&e[et])&&(P[et]|=2048),Gw(P),P[Ai]=P[Il]=e,P[zn]=t,P[Ra]=p||e&&e[Ra],P[St]=m||e&&e[St],P[jr]=E||e&&e[jr]||null,P[Dr]=u,P[nh]=function j1(){return $R++}(),P[Ms]=w,P[Ay]=S,P[fi]=2==n.type?e[fi]:P,P}function Sc(e,n,t,o,c){let u=e.data[n];if(null===u)u=function gC(e,n,t,o,c){const u=Tg(),p=yf(),E=e.data[n]=function Qk(e,n,t,o,c,u){let p=n?n.injectorIndex:-1,m=0;return Nl()&&(m|=128),{type:t,index:o,insertBeforeIndex:null,injectorIndex:p,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:m,providerIndexes:0,value:c,attrs:u,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,p?u:u&&u.parent,t,n,o,c);return null===e.firstChild&&(e.firstChild=E),null!==u&&(p?null==u.child&&null!==E.parent&&(u.child=E):null===u.next&&(u.next=E,E.prev=u)),E}(e,n,t,o,c),function Jw(){return dt.lFrame.inI18n}()&&(u.flags|=32);else if(64&u.type){u.type=t,u.value=o,u.attrs=c;const p=function bf(){const e=dt.lFrame,n=e.currentTNode;return e.isParent?n:n.parent}();u.injectorIndex=null===p?-1:p.injectorIndex}return Oa(u,!0),u}function La(e,n,t,o){if(0===t)return-1;const c=n.length;for(let u=0;u<t;u++)n.push(o),e.blueprint.push(o),e.data.push(null);return c}function Id(e,n,t,o,c){const u=Hr(),p=2&o;try{Pl(-1),p&&n.length>mt&&fC(e,n,mt,!1),Aa(p?2:0,c),t(o,c)}finally{Pl(u),Aa(p?3:1,c)}}function FE(e,n,t){if(_g(n)){const o=An(null);try{const u=n.directiveEnd;for(let p=n.directiveStart;p<u;p++){const m=e.data[p];m.contentQueries&&m.contentQueries(1,t[p],p)}}finally{An(o)}}}function EC(e,n,t){$w()&&(function wd(e,n,t,o){const c=t.directiveStart,u=t.directiveEnd;pd(t)&&function aL(e,n,t){const o=io(n,e),c=Uh(t);let p=16;t.signals?p=4096:t.onPush&&(p=64);const m=Bh(e,Yl(e,c,null,p,o,n,null,e[Ra].rendererFactory.createRenderer(o,t),null,null,null));e[n.index]=m}(n,t,e.data[c+t.componentOffset]),e.firstCreatePass||xg(t,n),Gr(o,n);const p=t.initialInputs;for(let m=c;m<u;m++){const E=e.data[m],S=Ll(n,e,m,t);Gr(S,n),null!==p&&cL(0,m-c,S,E,0,p),ks(E)&&(Co(t.index,n)[zn]=Ll(n,e,m,t))}}(e,n,t,io(t,n)),64==(64&t.flags)&&Vh(e,n,t))}function vC(e,n,t=io){const o=n.localNames;if(null!==o){let c=n.index+1;for(let u=0;u<o.length;u+=2){const p=o[u+1],m=-1===p?t(n,e):e[p];e[c++]=m}}}function Uh(e){const n=e.tView;return null===n||n.incompleteFirstPass?e.tView=bC(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):n}function bC(e,n,t,o,c,u,p,m,E,S,w){const P=mt+o,V=P+c,H=function Yk(e,n){const t=[];for(let o=0;o<n;o++)t.push(o<e?null:_t);return t}(P,V),z="function"==typeof S?S():S;return H[Ne]={type:e,blueprint:H,template:t,queries:null,viewQuery:m,declTNode:n,data:H.slice().fill(null,P),bindingStartIndex:P,expandoStartIndex:V,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof u?u():u,pipeRegistry:"function"==typeof p?p():p,firstChild:null,schemas:E,consts:z,incompleteFirstPass:!1,ssrId:w}}let nD=()=>null;function SC(e,n,t,o,c){for(let u in n){if(!n.hasOwnProperty(u))continue;const p=n[u];if(void 0===p)continue;o??={};let m,E=Xe.None;Array.isArray(p)?(m=p[0],E=p[1]):m=p;let S=u;if(null!==c){if(!c.hasOwnProperty(u))continue;S=c[u]}0===e?CC(o,t,S,m,E):CC(o,t,S,m)}return o}function CC(e,n,t,o,c){let u;e.hasOwnProperty(t)?(u=e[t]).push(n,o):u=e[t]=[n,o],void 0!==c&&u.push(c)}function Ni(e,n,t,o,c,u,p,m){const E=io(n,t);let w,S=n.inputs;!m&&null!=S&&(w=S[o])?(DC(e,t,w,o,c),pd(n)&&function rD(e,n){const t=Co(n,e);16&t[et]||(t[et]|=64)}(t,n.index)):3&n.type&&(o=function Zf(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(o),c=null!=p?p(c,n.value||"",o):c,u.setProperty(E,o,c))}function em(e,n,t,o){if($w()){const c=null===o?null:{"":-1},u=function iL(e,n){const t=e.directiveRegistry;let o=null,c=null;if(t)for(let u=0;u<t.length;u++){const p=t[u];if(ww(n,p.selectors,!1))if(o||(o=[]),ks(p))if(null!==p.findHostDirectiveDefs){const m=[];c=c||new Map,p.findHostDirectiveDefs(p,m,c),o.unshift(...m,p),IC(e,n,m.length)}else o.unshift(p),IC(e,n,0);else c=c||new Map,p.findHostDirectiveDefs?.(p,o,c),o.push(p)}return null===o?null:[o,c]}(e,t);let p,m;null===u?p=m=null:[p,m]=u,null!==p&&TC(e,n,t,p,c,m),c&&function rL(e,n,t){if(n){const o=e.localNames=[];for(let c=0;c<n.length;c+=2){const u=t[n[c+1]];if(null==u)throw new pe(-301,!1);o.push(n[c],u)}}}(t,o,c)}t.mergedAttrs=lf(t.mergedAttrs,t.attrs)}function TC(e,n,t,o,c,u){for(let S=0;S<o.length;S++)Fg(xg(t,n),e,o[S].type);!function oL(e,n,t){e.flags|=1,e.directiveStart=n,e.directiveEnd=n+t,e.providerIndexes=n}(t,e.data.length,o.length);for(let S=0;S<o.length;S++){const w=o[S];w.providersResolver&&w.providersResolver(w)}let p=!1,m=!1,E=La(e,n,o.length,null);for(let S=0;S<o.length;S++){const w=o[S];t.mergedAttrs=lf(t.mergedAttrs,w.hostAttrs),sL(e,t,n,E,w),wC(E,w,c),null!==w.contentQueries&&(t.flags|=4),(null!==w.hostBindings||null!==w.hostAttrs||0!==w.hostVars)&&(t.flags|=64);const P=w.type.prototype;!p&&(P.ngOnChanges||P.ngOnInit||P.ngDoCheck)&&((e.preOrderHooks??=[]).push(t.index),p=!0),!m&&(P.ngOnChanges||P.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(t.index),m=!0),E++}!function Zk(e,n,t){const c=n.directiveEnd,u=e.data,p=n.attrs,m=[];let E=null,S=null;for(let w=n.directiveStart;w<c;w++){const P=u[w],V=t?t.get(P):null,z=V?V.outputs:null;E=SC(0,P.inputs,w,E,V?V.inputs:null),S=SC(1,P.outputs,w,S,z);const J=null===E||null===p||Tw(n)?null:dL(E,w,p);m.push(J)}null!==E&&(E.hasOwnProperty("class")&&(n.flags|=8),E.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=m,n.inputs=E,n.outputs=S}(e,t,u)}function Vh(e,n,t){const o=t.directiveStart,c=t.directiveEnd,u=t.index,p=function d1(){return dt.lFrame.currentDirectiveIndex}();try{Pl(u);for(let m=o;m<c;m++){const E=e.data[m],S=n[m];Ig(m),(null!==E.hostBindings||0!==E.hostVars||null!==E.hostAttrs)&&nL(E,S)}}finally{Pl(-1),Ig(p)}}function nL(e,n){null!==e.hostBindings&&e.hostBindings(1,n)}function IC(e,n,t){n.componentOffset=t,(e.components??=[]).push(n.index)}function wC(e,n,t){if(t){if(n.exportAs)for(let o=0;o<n.exportAs.length;o++)t[n.exportAs[o]]=e;ks(n)&&(t[""]=e)}}function sL(e,n,t,o,c){e.data[o]=c;const u=c.factory||(c.factory=Al(c.type)),p=new wf(u,ks(c),ae);e.blueprint[o]=p,t[o]=p,function tL(e,n,t,o,c){const u=c.hostBindings;if(u){let p=e.hostBindingOpCodes;null===p&&(p=e.hostBindingOpCodes=[]);const m=~n.index;(function UE(e){let n=e.length;for(;n>0;){const t=e[--n];if("number"==typeof t&&t<0)return t}return 0})(p)!=m&&p.push(m),p.push(t,o,u)}}(e,n,o,La(e,t,c.hostVars,_t),c)}function ra(e,n,t,o,c,u){const p=io(e,n);!function tm(e,n,t,o,c,u,p){if(null==u)e.removeAttribute(n,c,t);else{const m=null==p?yt(u):p(u,o||"",c);e.setAttribute(n,c,m,t)}}(n[St],p,u,e.value,t,o,c)}function cL(e,n,t,o,c,u){const p=u[n];if(null!==p)for(let m=0;m<p.length;)mC(o,t,p[m++],p[m++],p[m++],p[m++])}function dL(e,n,t){let o=null,c=0;for(;c<t.length;){const u=t[c];if(0!==u)if(5!==u){if("number"==typeof u)break;if(e.hasOwnProperty(u)){null===o&&(o=[]);const p=e[u];for(let m=0;m<p.length;m+=3)if(p[m]===n){o.push(u,p[m+1],p[m+2],t[c+1]);break}}c+=2}else c+=2;else c+=4}return o}function oD(e,n,t,o){return[e,!0,0,n,null,o,null,t,null,null]}function RC(e,n){const t=e.contentQueries;if(null!==t){const o=An(null);try{for(let c=0;c<t.length;c+=2){const p=t[c+1];if(-1!==p){const m=e.data[p];Wy(t[c]),m.contentQueries(2,n[p],p)}}}finally{An(o)}}}function Bh(e,n){return e[eh]?e[Ry][Jo]=n:e[eh]=n,e[Ry]=n,n}function VE(e,n,t){Wy(0);const o=An(null);try{n(e,t)}finally{An(o)}}function nm(e){return e[hd]||(e[hd]=[])}function AC(e){return e.cleanup||(e.cleanup=[])}function jh(e,n){const t=e[jr],o=t?t.get(ka,null):null;o&&o.handleError(n)}function DC(e,n,t,o,c){for(let u=0;u<t.length;){const p=t[u++],m=t[u++],E=t[u++];mC(e.data[p],n[p],o,m,E,c)}}function OC(e,n,t,o){const c=n[et];if(256==(256&c))return;n[Ra].inlineEffectRunner?.flush(),Rg(n);let p=null,m=null;(function NC(e){return 2!==e.type})(e)&&(m=function lC(e){return e[mc]??function jk(e){const n=$A.pop()??Object.create(Hk);return n.lView=e,n}(e)}(n),p=function q_(e){return e&&(e.nextProducerIndex=0),An(e)}(m));try{Gw(n),function Sf(e){return dt.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==t&&Id(e,n,t,2,o);const E=3==(3&c);if(E){const P=e.preOrderCheckHooks;null!==P&&If(n,P,null)}else{const P=e.preOrderHooks;null!==P&&Ml(n,P,0,null),$y(n,0)}if(function uL(e){for(let n=hC(e);null!==n;n=PE(n)){if(!(n[et]&mg.HasTransplantedViews))continue;const t=n[Rl];for(let o=0;o<t.length;o++){Ww(t[o])}}}(n),dD(n,0),null!==e.contentQueries&&RC(e,n),E){const P=e.contentCheckHooks;null!==P&&If(n,P)}else{const P=e.contentHooks;null!==P&&Ml(n,P,1),$y(n,1)}!function _C(e,n){const t=e.hostBindingOpCodes;if(null!==t)try{for(let o=0;o<t.length;o++){const c=t[o];if(c<0)Pl(~c);else{const u=c,p=t[++o],m=t[++o];c1(p,u),m(2,n[u])}}}finally{Pl(-1)}}(e,n);const S=e.components;null!==S&&MC(n,S,0);const w=e.viewQuery;if(null!==w&&VE(2,w,o),E){const P=e.viewCheckHooks;null!==P&&If(n,P)}else{const P=e.viewHooks;null!==P&&Ml(n,P,2),$y(n,2)}if(!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),n[hf]){for(const P of n[hf])P();n[hf]=null}n[et]&=-73}catch(E){throw vf(n),E}finally{null!==m&&(function ty(e,n){if(An(n),e&&void 0!==e.producerNode&&void 0!==e.producerIndexOfThis&&void 0!==e.producerLastReadVersion){if(Jp(e))for(let t=e.nextProducerIndex;t<e.producerNode.length;t++)K_(e.producerNode[t],e.producerIndexOfThis[t]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}(m,p),function XA(e){e.lView[mc]!==e&&(e.lView=null,$A.push(e))}(m)),oh()}}function dD(e,n){for(let t=hC(e);null!==t;t=PE(t))for(let o=Di;o<t.length;o++)PC(t[o],n)}function lD(e,n,t){PC(Co(n,e),t)}function PC(e,n){Fy(e)&&BE(e,n)}function BE(e,n){const o=e[Ne],c=e[et],u=e[mc];let p=!!(0===n&&16&c);if(p||=!!(64&c&&0===n),p||=!!(1024&c),p||=!(!u?.dirty||!ny(u)),u&&(u.dirty=!1),e[et]&=-9217,p)OC(o,e,o.template,e[zn]);else if(8192&c){dD(e,1);const m=o.components;null!==m&&MC(e,m,1)}}function MC(e,n,t){for(let o=0;o<n.length;o++)lD(e,n[o],t)}function Hh(e){for(e[Ra].changeDetectionScheduler?.notify();e;){e[et]|=64;const n=Ol(e);if(gg(e)&&!n)return e;e=n}return null}class om{get rootNodes(){const n=this._lView,t=n[Ne];return ql(t,n,t.firstChild,[])}constructor(n,t,o=!0){this._lView=n,this._cdRefInjectingView=t,this.notifyErrorHandler=o,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[zn]}set context(n){this._lView[zn]=n}get destroyed(){return 256==(256&this._lView[et])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[Ai];if(Nr(n)){const t=n[8],o=t?t.indexOf(this):-1;o>-1&&(Gf(n,o),Mf(t,o))}this._attachedToViewContainer=!1}Wf(this._lView[Ne],this._lView)}onDestroy(n){Sg(this._lView,n)}markForCheck(){Hh(this._cdRefInjectingView||this._lView)}detach(){this._lView[et]&=-129}reattach(){Uy(this._lView),this._lView[et]|=128}detectChanges(){this._lView[et]|=1024,function rm(e,n=!0){const t=e[Ra],o=t.rendererFactory;o.begin?.();try{!function aD(e){BE(e,0);let n=0;for(;qw(e);){if(100===n)throw new pe(103,!1);n++,BE(e,1)}}(e)}catch(u){throw n&&jh(e,u),u}finally{o.end?.(),t.inlineEffectRunner?.flush()}}(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new pe(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,sA(this._lView[Ne],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new pe(902,!1);this._appRef=n,Uy(this._lView)}}let Us=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=hL}return e})();function hL(e){return function Gh(e,n,t){if(pd(e)&&!t){const o=Co(e.index,n);return new om(o,o)}return 47&e.type?new om(n[fi],n):null}(Nn(),me(),16==(16&e))}let jE=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=mL;static#t=this.__NG_ENV_ID__=t=>t}return e})();class uD extends jE{constructor(n){super(),this._lView=n}onDestroy(n){return Sg(this._lView,n),()=>function Vy(e,n){if(null===e[fc])return;const t=e[fc].indexOf(n);-1!==t&&e[fc].splice(t,1)}(this._lView,n)}}function mL(){return new uD(me())}const hD=new Set;function $l(e){hD.has(e)||(hD.add(e),performance?.mark?.("mark_feature_usage",{detail:{feature:e}}))}function kC(e){return n=>{setTimeout(e,void 0,n)}}const hn=class bL extends bn{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,t,o){let c=n,u=t||(()=>null),p=o;if(n&&"object"==typeof n){const E=n;c=E.next?.bind(E),u=E.error?.bind(E),p=E.complete?.bind(E)}this.__isAsync&&(u=kC(u),c&&(c=kC(c)),p&&(p=kC(p)));const m=super.subscribe({next:c,error:u,complete:p});return n instanceof nr&&n.add(m),m}};function pD(...e){}class it{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:o=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new hn(!1),this.onMicrotaskEmpty=new hn(!1),this.onStable=new hn(!1),this.onError=new hn(!1),typeof Zone>"u")throw new pe(908,!1);Zone.assertZonePatched();const c=this;c._nesting=0,c._outer=c._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(c._inner=c._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(c._inner=c._inner.fork(Zone.longStackTraceZoneSpec)),c.shouldCoalesceEventChangeDetection=!o&&t,c.shouldCoalesceRunChangeDetection=o,c.lastRequestAnimationFrameId=-1,c.nativeRequestAnimationFrame=function yL(){const e="function"==typeof yn.requestAnimationFrame;let n=yn[e?"requestAnimationFrame":"setTimeout"],t=yn[e?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&n&&t){const o=n[Zone.__symbol__("OriginalDelegate")];o&&(n=o);const c=t[Zone.__symbol__("OriginalDelegate")];c&&(t=c)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function TL(e){const n=()=>{!function CL(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(yn,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,GE(e),e.isCheckStableRunning=!0,LC(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),GE(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,o,c,u,p,m)=>{if(function IL(e){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0].data?.__ignore_ng_zone__}(m))return t.invokeTask(c,u,p,m);try{return fD(e),t.invokeTask(c,u,p,m)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===u.type||e.shouldCoalesceRunChangeDetection)&&n(),mD(e)}},onInvoke:(t,o,c,u,p,m,E)=>{try{return fD(e),t.invoke(c,u,p,m,E)}finally{e.shouldCoalesceRunChangeDetection&&n(),mD(e)}},onHasTask:(t,o,c,u)=>{t.hasTask(c,u),o===c&&("microTask"==u.change?(e._hasPendingMicrotasks=u.microTask,GE(e),LC(e)):"macroTask"==u.change&&(e.hasPendingMacrotasks=u.macroTask))},onHandleError:(t,o,c,u)=>(t.handleError(c,u),e.runOutsideAngular(()=>e.onError.emit(u)),!1)})}(c)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!it.isInAngularZone())throw new pe(909,!1)}static assertNotInAngularZone(){if(it.isInAngularZone())throw new pe(909,!1)}run(n,t,o){return this._inner.run(n,t,o)}runTask(n,t,o,c){const u=this._inner,p=u.scheduleEventTask("NgZoneEvent: "+c,n,SL,pD,pD);try{return u.runTask(p,t,o)}finally{u.cancelTask(p)}}runGuarded(n,t,o){return this._inner.runGuarded(n,t,o)}runOutsideAngular(n){return this._outer.run(n)}}const SL={};function LC(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function GE(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function fD(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function mD(e){e._nesting--,LC(e)}class _D{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new hn,this.onMicrotaskEmpty=new hn,this.onStable=new hn,this.onError=new hn}run(n,t,o){return n.apply(t,o)}runGuarded(n,t,o){return n.apply(t,o)}runOutsideAngular(n){return n()}runTask(n,t,o,c){return n.apply(t,o)}}var Xl=function(e){return e[e.EarlyRead=0]="EarlyRead",e[e.Write=1]="Write",e[e.MixedReadWrite=2]="MixedReadWrite",e[e.Read=3]="Read",e}(Xl||{});const gD={destroy(){}};function vD(e,n){!n&&function _h(e){if(!gw()&&!function Mx(){return Tl}())throw new pe(-203,!1)}();const t=n?.injector??Te(pr);if(!function vd(e){return"browser"===(e??Te(pr)).get(Ma)}(t))return gD;$l("NgAfterNextRender");const o=t.get(sm),c=o.handler??=new yD,u=n?.phase??Xl.MixedReadWrite,p=()=>{c.unregister(E),m()},m=t.get(jE).onDestroy(p),E=new bD(t,u,()=>{p(),e()});return c.register(E),{destroy:p}}class bD{constructor(n,t,o){this.phase=t,this.callbackFn=o,this.zone=n.get(it),this.errorHandler=n.get(ka,null,{optional:!0})}invoke(){try{this.zone.runOutsideAngular(this.callbackFn)}catch(n){this.errorHandler?.handleError(n)}}}class yD{constructor(){this.executingCallbacks=!1,this.buckets={[Xl.EarlyRead]:new Set,[Xl.Write]:new Set,[Xl.MixedReadWrite]:new Set,[Xl.Read]:new Set},this.deferredCallbacks=new Set}register(n){(this.executingCallbacks?this.deferredCallbacks:this.buckets[n.phase]).add(n)}unregister(n){this.buckets[n.phase].delete(n),this.deferredCallbacks.delete(n)}execute(){let n=!1;this.executingCallbacks=!0;for(const t of Object.values(this.buckets))for(const o of t)n=!0,o.invoke();this.executingCallbacks=!1;for(const t of this.deferredCallbacks)this.buckets[t.phase].add(t);return this.deferredCallbacks.clear(),n}destroy(){for(const n of Object.values(this.buckets))n.clear();this.deferredCallbacks.clear()}}let sm=(()=>{class e{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){const t=[...this.internalCallbacks];this.internalCallbacks.length=0;for(const c of t)c();return!!this.handler?.execute()||t.length>0}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}static#e=this.\u0275prov=Pe({token:e,providedIn:"root",factory:()=>new e})}return e})();function AL(e,n){const t=Co(n,e),o=t[Ne];!function DL(e,n){for(let t=n.length;t<e.blueprint.length;t++)n.push(e.blueprint[t])}(o,t);const c=t[Sn];null!==c&&null===t[Ms]&&(t[Ms]=tC(c,t[jr])),FC(o,t,t[zn])}function FC(e,n,t){Rg(n);try{const o=e.viewQuery;null!==o&&VE(1,o,t);const c=e.template;null!==c&&Id(e,n,c,1,t),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&RC(e,n),e.staticViewQueries&&VE(2,e.viewQuery,t);const u=e.components;null!==u&&function OL(e,n){for(let t=0;t<n.length;t++)AL(e,n[t])}(n,u)}catch(o){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),o}finally{n[et]&=-5,oh()}}function am(e,n,t){let o=t?e.styles:null,c=t?e.classes:null,u=0;if(null!==n)for(let p=0;p<n.length;p++){const m=n[p];"number"==typeof m?u=m:1==u?c=hy(c,m):2==u&&(o=hy(o,m+": "+n[++p]+";"))}t?e.styles=o:e.stylesWithoutHost=o,t?e.classes=c:e.classesWithoutHost=c}class SD extends Mh{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const t=Lt(n);return new cm(t,this.ngModule)}}function WE(e){const n=[];for(const t in e){if(!e.hasOwnProperty(t))continue;const o=e[t];void 0!==o&&n.push({propName:Array.isArray(o)?o[0]:o,templateName:t})}return n}class PL{constructor(n,t){this.injector=n,this.parentInjector=t}get(n,t,o){o=dg(o);const c=this.injector.get(n,oC,o);return c!==oC||t===oC?c:this.parentInjector.get(n,t,o)}}class cm extends UA{get inputs(){const n=this.componentDef,t=n.inputTransforms,o=WE(n.inputs);if(null!==t)for(const c of o)t.hasOwnProperty(c.propName)&&(c.transform=t[c.propName]);return o}get outputs(){return WE(this.componentDef.outputs)}constructor(n,t){super(),this.componentDef=n,this.ngModule=t,this.componentType=n.type,this.selector=function Wx(e){return e.map(Gx).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!t}create(n,t,o,c){let u=(c=c||this.ngModule)instanceof ts?c:c?.injector;u&&null!==this.componentDef.getStandaloneInjector&&(u=this.componentDef.getStandaloneInjector(u)||u);const p=u?new PL(n,u):n,m=p.get(AE,null);if(null===m)throw new pe(407,!1);const P={rendererFactory:m,sanitizer:p.get(Pk,null),inlineEffectRunner:null,afterRenderEventManager:p.get(sm,null),changeDetectionScheduler:p.get(YS,null)},V=m.createRenderer(null,this.componentDef),H=this.componentDef.selectors[0][0]||"div",z=o?function $k(e,n,t,o){const u=o.get(LE,!1)||t===Xs.ShadowDom,p=e.selectRootElement(n,u);return function Xk(e){nD(e)}(p),p}(V,o,this.componentDef.encapsulation,p):lE(V,H,function NL(e){const n=e.toLowerCase();return"svg"===n?Ly:"math"===n?"math":null}(H));let J=512;this.componentDef.signals?J|=4096:this.componentDef.onPush||(J|=16);let ce=null;null!==z&&(ce=tC(z,p,!0));const he=bC(0,null,null,1,0,null,null,null,null,null,null),le=Yl(null,he,null,J,null,null,P,V,p,null,ce);let Le,He;Rg(le);try{const pt=this.componentDef;let kn,wr=null;pt.findHostDirectiveDefs?(kn=[],wr=new Map,pt.findHostDirectiveDefs(pt,kn,wr),kn.push(pt)):kn=[pt];const Wo=function CD(e,n){const t=e[Ne],o=mt;return e[o]=n,Sc(t,o,2,"#host",null)}(le,z),Wu=function xL(e,n,t,o,c,u,p){const m=c[Ne];!function TD(e,n,t,o){for(const c of e)n.mergedAttrs=lf(n.mergedAttrs,c.hostAttrs);null!==n.mergedAttrs&&(am(n,n.mergedAttrs,!0),null!==t&&fA(o,t,n))}(o,e,n,p);let E=null;null!==n&&(E=tC(n,c[jr]));const S=u.rendererFactory.createRenderer(n,t);let w=16;t.signals?w=4096:t.onPush&&(w=64);const P=Yl(c,Uh(t),null,w,c[e.index],e,u,S,null,null,E);return m.firstCreatePass&&IC(m,e,o.length-1),Bh(c,P),c[e.index]=P}(Wo,z,pt,kn,le,P,V);He=rh(he,mt),z&&function kL(e,n,t,o){if(o)Iy(e,t,["ng-version","17.1.2"]);else{const{attrs:c,classes:u}=function pc(e){const n=[],t=[];let o=1,c=2;for(;o<e.length;){let u=e[o];if("string"==typeof u)2===c?""!==u&&n.push(u,e[++o]):8===c&&t.push(u);else{if(!Xo(c))break;c=u}o++}return{attrs:n,classes:t}}(n.selectors[0]);c&&Iy(e,t,c),u&&u.length>0&&pA(e,t,u.join(" "))}}(V,pt,z,o),void 0!==t&&function dm(e,n,t){const o=e.projection=[];for(let c=0;c<n.length;c++){const u=t[c];o.push(null!=u?Array.from(u):null)}}(He,this.ngContentSelectors,t),Le=function X(e,n,t,o,c,u){const p=Nn(),m=c[Ne],E=io(p,c);TC(m,c,p,t,null,o);for(let w=0;w<t.length;w++)Gr(Ll(c,m,p.directiveStart+w,p),c);Vh(m,c,p),E&&Gr(E,c);const S=Ll(c,m,p.directiveStart+p.componentOffset,p);if(e[zn]=c[zn]=S,null!==u)for(const w of u)w(S,n);return FE(m,p,e),S}(Wu,pt,kn,wr,le,[zE]),FC(he,le,null)}finally{oh()}return new ML(this.componentType,Le,Cd(He,le),le,He)}}class ML extends Ok{constructor(n,t,o,c,u){super(),this.location=o,this._rootLView=c,this._tNode=u,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new om(c,void 0,!1),this.componentType=n}setInput(n,t){const o=this._tNode.inputs;let c;if(null!==o&&(c=o[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),t))return;const u=this._rootLView;DC(u[Ne],u,c,n,t),this.previousInputValues.set(n,t),Hh(Co(this._tNode.index,u))}}get injector(){return new Oi(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}function zE(){const e=Nn();Ng(me()[Ne],e)}function Nt(e){let n=function lm(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),t=!0;const o=[e];for(;n;){let c;if(ks(e))c=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new pe(903,!1);c=n.\u0275dir}if(c){if(t){o.push(c);const p=e;p.inputs=zh(e.inputs),p.inputTransforms=zh(e.inputTransforms),p.declaredInputs=zh(e.declaredInputs),p.outputs=zh(e.outputs);const m=c.hostBindings;m&&VC(e,m);const E=c.viewQuery,S=c.contentQueries;if(E&&UC(e,E),S&&Tc(e,S),Zn(e,c),bx(e.outputs,c.outputs),ks(c)&&c.data.animation){const w=e.data;w.animation=(w.animation||[]).concat(c.data.animation)}}const u=c.features;if(u)for(let p=0;p<u.length;p++){const m=u[p];m&&m.ngInherit&&m(e),m===Nt&&(t=!1)}}n=Object.getPrototypeOf(n)}!function gt(e){let n=0,t=null;for(let o=e.length-1;o>=0;o--){const c=e[o];c.hostVars=n+=c.hostVars,c.hostAttrs=lf(c.hostAttrs,t=lf(t,c.hostAttrs))}}(o)}function Zn(e,n){for(const t in n.inputs){if(!n.inputs.hasOwnProperty(t)||e.inputs.hasOwnProperty(t))continue;const o=n.inputs[t];if(void 0!==o&&(e.inputs[t]=o,e.declaredInputs[t]=n.declaredInputs[t],null!==n.inputTransforms)){const c=Array.isArray(o)?o[0]:o;if(!n.inputTransforms.hasOwnProperty(c))continue;e.inputTransforms??={},e.inputTransforms[c]=n.inputTransforms[c]}}}function zh(e){return e===wa?{}:e===ln?[]:e}function UC(e,n){const t=e.viewQuery;e.viewQuery=t?(o,c)=>{n(o,c),t(o,c)}:n}function Tc(e,n){const t=e.contentQueries;e.contentQueries=t?(o,c,u)=>{n(o,c,u),t(o,c,u)}:n}function VC(e,n){const t=e.hostBindings;e.hostBindings=t?(o,c)=>{n(o,c),t(o,c)}:n}function Pi(e){const n=e.inputConfig,t={};for(const o in n)if(n.hasOwnProperty(o)){const c=n[o];Array.isArray(c)&&c[3]&&(t[o]=c[3])}e.inputTransforms=t}let $i=()=>null;function oa(e,n){return $i(e,n)}function Xh(e,n,t,o){const c=n.tView,m=Yl(e,c,t,4096&e[et]?4096:16,null,n,null,null,null,o?.injector??null,o?.dehydratedView??null);m[th]=e[n.index];const S=e[xs];return null!==S&&(m[xs]=S.createEmbeddedView(c)),FC(c,m,t),m}function nn(e,n){return!n||null===n.firstChild||nE(e)}function Tt(e,n,t,o=!0){const c=n[Ne];if(function uE(e,n,t,o){const c=Di+o,u=t.length;o>0&&(t[c-1][Jo]=n),o<u-Di?(n[Jo]=t[c],pR(t,Di+o,n)):(t.push(n),n[Jo]=null),n[Ai]=t;const p=n[th];null!==p&&t!==p&&function aA(e,n){const t=e[Rl];n[fi]!==n[Ai][Ai][fi]&&(e[et]|=mg.HasTransplantedViews),null===t?e[Rl]=[n]:t.push(n)}(p,n);const m=n[xs];null!==m&&m.insertView(e),Uy(n),n[et]|=128}(c,n,e,t),o){const p=BS(t,e),m=n[St],E=fE(m,e[Js]);null!==E&&function q1(e,n,t,o,c,u){o[Sn]=c,o[Dr]=n,gE(e,o,t,1,c,u)}(c,e[Dr],m,n,E,p)}const u=n[Ms];null!==u&&null!==u.firstChild&&(u.firstChild=null)}let mr=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=Fn}return e})();function Fn(){return _m(Nn(),me())}const UD=mr,Ad=class extends UD{constructor(n,t,o){super(),this._lContainer=n,this._hostTNode=t,this._hostLView=o}get element(){return Cd(this._hostTNode,this._hostLView)}get injector(){return new Oi(this._hostTNode,this._hostLView)}get parentInjector(){const n=Lg(this._hostTNode,this._hostLView);if(mi(n)){const t=Af(n,this._hostLView),o=Rf(n);return new Oi(t[Ne].data[o+8],t)}return new Oi(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const t=mm(this._lContainer);return null!==t&&t[n]||null}get length(){return this._lContainer.length-Di}createEmbeddedView(n,t,o){let c,u;"number"==typeof o?c=o:null!=o&&(c=o.index,u=o.injector);const p=oa(this._lContainer,n.ssrId),m=n.createEmbeddedViewImpl(t||{},u,p);return this.insertImpl(m,c,nn(this._hostTNode,p)),m}createComponent(n,t,o,c,u){const p=n&&!function hh(e){return"function"==typeof e}(n);let m;if(p)m=t;else{const z=t||{};m=z.index,o=z.injector,c=z.projectableNodes,u=z.environmentInjector||z.ngModuleRef}const E=p?n:new cm(Lt(n)),S=o||this.parentInjector;if(!u&&null==E.ngModule){const J=(p?S:this.parentInjector).get(ts,null);J&&(u=J)}const w=Lt(E.componentType??{}),P=oa(this._lContainer,w?.id??null),H=E.create(S,c,P?.firstChild??null,u);return this.insertImpl(H.hostView,m,nn(this._hostTNode,P)),H}insert(n,t){return this.insertImpl(n,t,!0)}insertImpl(n,t,o){const c=n._lView;if(function e1(e){return Nr(e[Ai])}(c)){const m=this.indexOf(n);if(-1!==m)this.detach(m);else{const E=c[Ai],S=new Ad(E,E[Dr],E[Ai]);S.detach(S.indexOf(n))}}const u=this._adjustIndex(t),p=this._lContainer;return Tt(p,c,u,o),n.attachToViewContainerRef(),pR(Dd(p),u,n),n}move(n,t){return this.insert(n,t)}indexOf(n){const t=mm(this._lContainer);return null!==t?t.indexOf(n):-1}remove(n){const t=this._adjustIndex(n,-1),o=Gf(this._lContainer,t);o&&(Mf(Dd(this._lContainer),t),Wf(o[Ne],o))}detach(n){const t=this._adjustIndex(n,-1),o=Gf(this._lContainer,t);return o&&null!=Mf(Dd(this._lContainer),t)?new om(o):null}_adjustIndex(n,t=0){return n??this.length+t}};function mm(e){return e[8]}function Dd(e){return e[8]||(e[8]=[])}function _m(e,n){let t;const o=n[e.index];return Nr(o)?t=o:(t=oD(o,n,null,e),n[e.index]=t,Bh(n,t)),Od(t,n,e,o),new Ad(t,e,n)}let Od=function gm(e,n,t,o){if(e[Js])return;let c;c=8&t.type?On(o):function Ft(e,n){const t=e[St],o=t.createComment(""),c=io(n,e);return Ls(t,fE(t,c),o,function lA(e,n){return e.nextSibling(n)}(t,c),!1),o}(n,t),e[Js]=c},JE=()=>!1;function Va(e,n,t){return e[n]=t}function qe(e,n,t){return!Object.is(e[n],t)&&(e[n]=t,!0)}function Dc(e,n,t,o){const c=qe(e,n,t);return qe(e,n+1,o)||c}function Tn(e,n,t,o,c,u,p,m){const E=me(),S=qt(),w=e+mt,P=S.firstCreatePass?function BD(e,n,t,o,c,u,p,m,E){const S=n.consts,w=Sc(n,e,4,p||null,Qs(S,m));em(n,t,w,Qs(S,E)),Ng(n,w);const P=w.tView=bC(2,w,o,c,u,n.directiveRegistry,n.pipeRegistry,null,n.schemas,S,null);return null!==n.queries&&(n.queries.template(n,w),P.queries=n.queries.embeddedTView(w)),w}(w,S,E,n,t,o,c,u,p):S.data[w];Oa(P,!1);const V=QE(S,E,P,e);Og()&&mE(S,E,V,P),Gr(V,E);const H=oD(V,E,V,P);return E[w]=H,Bh(E,H),function Jh(e,n,t){return JE(e,n,t)}(H,P,E),ff(P)&&EC(S,E,P),null!=p&&vC(E,P,m),Tn}let QE=function jD(e,n,t,o){return fd(!0),n[St].createComment("")};function Xi(e,n,t,o){const c=me();return qe(c,ea(),n)&&(qt(),ra(Qn(),c,e,n,t,o)),Xi}function Cm(e,n){return e<<17|n<<2}function Pc(e){return e>>17&32767}function uv(e){return 2|e}function ru(e){return(131068&e)>>2}function ja(e,n){return-131069&e|n<<2}function hv(e){return 1|e}function cT(e,n,t,o){const c=e[t+1],u=null===n;let p=o?Pc(c):ru(c),m=!1;for(;0!==p&&(!1===m||u);){const S=e[p+1];wO(e[p],n)&&(m=!0,e[p+1]=o?hv(S):uv(S)),p=o?Pc(S):ru(S)}m&&(e[t+1]=o?uv(c):hv(c))}function wO(e,n){return null===e||null==n||(Array.isArray(e)?e[1]:e)===n||!(!Array.isArray(e)||"string"!=typeof n)&&ph(e,n)>=0}const or={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function dT(e){return e.substring(or.key,or.keyEnd)}function lT(e,n){const t=or.textEnd;return t===n?-1:(n=or.keyEnd=function cp(e,n,t){for(;n<t&&e.charCodeAt(n)>32;)n++;return n}(e,or.key=n,t),sa(e,n,t))}function sa(e,n,t){for(;n<t&&e.charCodeAt(n)<=32;)n++;return n}function Ze(e,n,t){const o=me();return qe(o,ea(),n)&&Ni(qt(),Qn(),o,e,n,o[St],t,!1),Ze}function mv(e,n,t,o,c){const p=c?"class":"style";DC(e,t,n.inputs[p],p,o)}function _v(e,n,t){return as(e,n,t,!1),_v}function Ht(e,n){return as(e,n,null,!0),Ht}function Tm(e){!function aa(e,n,t,o){const c=qt(),u=gc(2);c.firstUpdatePass&&Ao(c,null,u,o);const p=me();if(t!==_t&&qe(p,u,t)){const m=c.data[Hr()];if(MO(m,o)&&!pT(c,u)){let E=o?m.classesWithoutHost:m.stylesWithoutHost;null!==E&&(t=hy(E,t||"")),mv(c,m,p,t,o)}else!function Ke(e,n,t,o,c,u,p,m){c===_t&&(c=ln);let E=0,S=0,w=0<c.length?c[0]:null,P=0<u.length?u[0]:null;for(;null!==w||null!==P;){const V=E<c.length?c[E+1]:void 0,H=S<u.length?u[S+1]:void 0;let J,z=null;w===P?(E+=2,S+=2,V!==H&&(z=P,J=H)):null===P||null!==w&&w<P?(E+=2,z=w):(S+=2,z=P,J=H),null!==z&&PO(e,n,t,o,z,J,p,m),w=E<c.length?c[E]:null,P=S<u.length?u[S]:null}}(c,m,p,p[St],p[u+1],p[u+1]=function Ld(e,n,t){if(null==t||""===t)return ln;const o=[],c=Sd(t);if(Array.isArray(c))for(let u=0;u<c.length;u++)e(o,c[u],!0);else if("object"==typeof c)for(const u in c)c.hasOwnProperty(u)&&e(o,u,c[u]);else"string"==typeof c&&n(o,c);return o}(e,n,t),o,u)}}(Re,Ha,e,!0)}function Ha(e,n){for(let t=function RO(e){return function uT(e){or.key=0,or.keyEnd=0,or.value=0,or.valueEnd=0,or.textEnd=e.length}(e),lT(e,sa(e,0,or.textEnd))}(n);t>=0;t=lT(n,t))es(e,dT(n),!0)}function as(e,n,t,o){const c=me(),u=qt(),p=gc(2);u.firstUpdatePass&&Ao(u,e,p,o),n!==_t&&qe(c,p,n)&&PO(u,u.data[Hr()],c,c[St],e,c[p+1]=function gv(e,n){return null==e||""===e||("string"==typeof n?e+=n:"object"==typeof e&&(e=Yt(Sd(e)))),e}(n,t),o,p)}function pT(e,n){return n>=e.expandoStartIndex}function Ao(e,n,t,o){const c=e.data;if(null===c[t+1]){const u=c[Hr()],p=pT(e,t);MO(u,o)&&null===n&&!p&&(n=!1),n=function fT(e,n,t,o){const c=function Gy(e){const n=dt.lFrame.currentDirectiveIndex;return-1===n?null:e[n]}(e);let u=o?n.residualClasses:n.residualStyles;if(null===c)0===(o?n.classBindings:n.styleBindings)&&(t=B(t=It(null,e,n,t,o),n.attrs,o),u=null);else{const p=n.directiveStylingLast;if(-1===p||e[p]!==c)if(t=It(c,e,n,t,o),null===u){let E=function Mc(e,n,t){const o=t?n.classBindings:n.styleBindings;if(0!==ru(o))return e[Pc(o)]}(e,n,o);void 0!==E&&Array.isArray(E)&&(E=It(null,e,n,E[1],o),E=B(E,n.attrs,o),function mT(e,n,t,o){e[Pc(t?n.classBindings:n.styleBindings)]=o}(e,n,o,E))}else u=function gr(e,n,t){let o;const c=n.directiveEnd;for(let u=1+n.directiveStylingLast;u<c;u++)o=B(o,e[u].hostAttrs,t);return B(o,n.attrs,t)}(e,n,o)}return void 0!==u&&(o?n.residualClasses=u:n.residualStyles=u),t}(c,u,n,o),function TO(e,n,t,o,c,u){let p=u?n.classBindings:n.styleBindings,m=Pc(p),E=ru(p);e[o]=t;let w,S=!1;if(Array.isArray(t)?(w=t[1],(null===w||ph(t,w)>0)&&(S=!0)):w=t,c)if(0!==E){const V=Pc(e[m+1]);e[o+1]=Cm(V,m),0!==V&&(e[V+1]=ja(e[V+1],o)),e[m+1]=function CO(e,n){return 131071&e|n<<17}(e[m+1],o)}else e[o+1]=Cm(m,0),0!==m&&(e[m+1]=ja(e[m+1],o)),m=o;else e[o+1]=Cm(E,0),0===m?m=o:e[E+1]=ja(e[E+1],o),E=o;S&&(e[o+1]=uv(e[o+1])),cT(e,w,o,!0),cT(e,w,o,!1),function IO(e,n,t,o,c){const u=c?e.residualClasses:e.residualStyles;null!=u&&"string"==typeof n&&ph(u,n)>=0&&(t[o+1]=hv(t[o+1]))}(n,w,e,o,u),p=Cm(m,E),u?n.classBindings=p:n.styleBindings=p}(c,u,n,t,p,o)}}function It(e,n,t,o,c){let u=null;const p=t.directiveEnd;let m=t.directiveStylingLast;for(-1===m?m=t.directiveStart:m++;m<p&&(u=n[m],o=B(o,u.hostAttrs,c),u!==e);)m++;return null!==e&&(t.directiveStylingLast=m),o}function B(e,n,t){const o=t?1:2;let c=-1;if(null!==n)for(let u=0;u<n.length;u++){const p=n[u];"number"==typeof p?c=p:c===o&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),es(e,p,!!t||n[++u]))}return void 0===e?null:e}function Re(e,n,t){const o=String(n);""!==o&&!o.includes(" ")&&es(e,o,t)}function PO(e,n,t,o,c,u,p,m){if(!(3&n.type))return;const E=e.data,S=E[m+1],w=function aT(e){return 1==(1&e)}(S)?xc(E,n,t,c,ru(S),p):void 0;Im(w)||(Im(u)||function rs(e){return 2==(2&e)}(S)&&(u=xc(E,null,t,c,m,p)),function Q1(e,n,t,o,c){if(n)c?e.addClass(t,o):e.removeClass(t,o);else{let u=-1===o.indexOf("-")?void 0:xa.DashCase;null==c?e.removeStyle(t,o,u):("string"==typeof c&&c.endsWith("!important")&&(c=c.slice(0,-10),u|=xa.Important),e.setStyle(t,o,c,u))}}(o,p,gf(Hr(),t),c,u))}function xc(e,n,t,o,c,u){const p=null===n;let m;for(;c>0;){const E=e[c],S=Array.isArray(E),w=S?E[1]:E,P=null===w;let V=t[c+1];V===_t&&(V=P?ln:void 0);let H=P?rS(V,o):w===o?V:void 0;if(S&&!Im(H)&&(H=rS(E,o)),Im(H)&&(m=H,p))return m;const z=e[c+1];c=p?Pc(z):ru(z)}if(null!==n){let E=u?n.residualClasses:n.residualStyles;null!=E&&(m=rS(E,o))}return m}function Im(e){return void 0!==e}function MO(e,n){return 0!=(e.flags&(n?8:16))}function we(e,n,t){$l("NgControlFlow");const o=me(),c=ea(),u=function vr(e,n){return e[n]}(o,mt+e);if(qe(o,c,n)){const m=An(null);try{if(function Mr(e,n){const t=Gf(e,n);return void 0!==t&&Wf(t[Ne],t),t}(u,0),-1!==n){const E=function zr(e,n){return rh(e,n)}(o[Ne],mt+n),S=oa(u,E.tView.ssrId);Tt(u,Xh(o,E,t,{dehydratedView:S}),0,nn(E,S))}}finally{An(m)}}else{const m=function WC(e,n){const t=Di+n;if(t<e.length)return e[t]}(u,0);void 0!==m&&(m[zn]=t)}}function oe(e,n,t,o){const c=me(),u=qt(),p=mt+e,m=c[St],E=u.firstCreatePass?function Ji(e,n,t,o,c,u){const p=n.consts,E=Sc(n,e,2,o,Qs(p,c));return em(n,t,E,Qs(p,u)),null!==E.attrs&&am(E,E.attrs,!1),null!==E.mergedAttrs&&am(E,E.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,E),E}(p,u,c,n,t,o):u.data[p],S=Ae(u,c,E,m,n,e);c[p]=S;const w=ff(E);return Oa(E,!0),fA(m,S,E),32!=(32&E.flags)&&Og()&&mE(u,c,S,E),0===function Yw(){return dt.lFrame.elementDepthCount}()&&Gr(S,c),function n1(){dt.lFrame.elementDepthCount++}(),w&&(EC(u,c,E),FE(u,E,c)),null!==o&&vC(c,E),oe}function Ee(){let e=Nn();yf()?Hy():(e=e.parent,Oa(e,!1));const n=e;(function o1(e){return dt.skipHydrationRootTNode===e})(n)&&function jy(){dt.skipHydrationRootTNode=null}(),function r1(){dt.lFrame.elementDepthCount--}();const t=qt();return t.firstCreatePass&&(Ng(t,e),_g(e)&&t.queries.elementEnd(e)),null!=n.classesWithoutHost&&function iR(e){return 0!=(8&e.flags)}(n)&&mv(t,n,me(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function h1(e){return 0!=(16&e.flags)}(n)&&mv(t,n,me(),n.stylesWithoutHost,!1),Ee}function de(e,n,t,o){return oe(e,n,t,o),Ee(),de}let Ae=(e,n,t,o,c,u)=>(fd(!0),lE(o,c,function Zw(){return dt.lFrame.currentNamespace}()));function Ei(e,n,t){const o=me(),c=qt(),u=e+mt,p=c.firstCreatePass?function VO(e,n,t,o,c){const u=n.consts,p=Qs(u,o),m=Sc(n,e,8,"ng-container",p);return null!==p&&am(m,p,!0),em(n,t,m,Qs(u,c)),null!==n.queries&&n.queries.elementStart(n,m),m}(u,c,o,n,t):c.data[u];Oa(p,!0);const m=Lc(c,o,p,e);return o[u]=m,Og()&&mE(c,o,m,p),Gr(m,o),ff(p)&&(EC(c,o,p),FE(c,p,o)),null!=t&&vC(o,p),Ei}function Me(){let e=Nn();const n=qt();return yf()?Hy():(e=e.parent,Oa(e,!1)),n.firstCreatePass&&(Ng(n,e),_g(e)&&n.queries.elementEnd(e)),Me}let Lc=(e,n,t,o)=>(fd(!0),dE(n[St],""));function up(){return me()}function Am(e,n,t){const o=me();return qe(o,ea(),n)&&Ni(qt(),Qn(),o,e,n,o[St],t,!0),Am}const da="en-US";let sr=da;function fp(e){return!!e&&"function"==typeof e.then}function Rv(e){return!!e&&"function"==typeof e.subscribe}function mn(e,n,t,o){const c=me(),u=qt(),p=Nn();return function Bc(e,n,t,o,c,u,p){const m=ff(o),S=e.firstCreatePass&&AC(e),w=n[zn],P=nm(n);let V=!0;if(3&o.type||p){const J=io(o,n),ce=p?p(J):J,he=P.length,le=p?He=>p(On(He[o.index])):o.index;let Le=null;if(!p&&m&&(Le=function OT(e,n,t,o){const c=e.cleanup;if(null!=c)for(let u=0;u<c.length-1;u+=2){const p=c[u];if(p===t&&c[u+1]===o){const m=n[hd],E=c[u+2];return m.length>E?m[E]:null}"string"==typeof p&&(u+=2)}return null}(e,n,c,o.index)),null!==Le)(Le.__ngLastListenerFn__||Le).__ngNextListenerFn__=u,Le.__ngLastListenerFn__=u,V=!1;else{u=nN(o,n,w,u,!1);const He=t.listen(ce,c,u);P.push(u,He),S&&S.push(c,le,he,he+1)}}else u=nN(o,n,w,u,!1);const H=o.outputs;let z;if(V&&null!==H&&(z=H[c])){const J=z.length;if(J)for(let ce=0;ce<J;ce+=2){const pt=n[z[ce]][z[ce+1]].subscribe(u),kn=P.length;P.push(u,pt),S&&S.push(c,o.index,kn,-(kn+1))}}}(u,c,c[St],p,e,n,o),mn}function NT(e,n,t,o){try{return Aa(6,n,t),!1!==t(o)}catch(c){return jh(e,c),!1}finally{Aa(7,n,t)}}function nN(e,n,t,o,c){return function u(p){if(p===Function)return o;Hh(e.componentOffset>-1?Co(e.index,n):n);let E=NT(n,t,o,p),S=u.__ngNextListenerFn__;for(;S;)E=NT(n,t,S,p)&&E,S=S.__ngNextListenerFn__;return c&&!1===E&&p.preventDefault(),E}}function _n(e=1){return function Dg(e){return(dt.lFrame.contextLView=function zw(e,n){for(;e>0;)n=n[Il],e--;return n}(e,dt.lFrame.contextLView))[zn]}(e)}function iN(e,n){let t=null;const o=function ug(e){const n=e.attrs;if(null!=n){const t=n.indexOf(5);if(!(1&t))return n[t+1]}return null}(e);for(let c=0;c<n.length;c++){const u=n[c];if("*"!==u){if(null===o?ww(e,u,!0):Hx(o,u))return c}else t=c}return t}function Po(e){const n=me()[fi][Dr];if(!n.projection){const o=n.projection=function xf(e,n){const t=[];for(let o=0;o<e;o++)t.push(n);return t}(e?e.length:1,null),c=o.slice();let u=n.child;for(;null!==u;){const p=e?iN(u,e):0;null!==p&&(c[p]?c[p].projectionNext=u:o[p]=u,c[p]=u),u=u.next}}}function xi(e,n=0,t){const o=me(),c=qt(),u=Sc(c,mt+e,16,null,t||null);null===u.projection&&(u.projection=n),Hy(),(!o[Ms]||Nl())&&32!=(32&u.flags)&&function X1(e,n,t){C(n[St],0,n,t,hE(e,t,n),uA(t.parent||n[Dr],t,n))}(c,o,u)}function f2(){return this._results[Symbol.iterator]()}class mp{static#e=Symbol.iterator;get changes(){return this._changes??=new hn}constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;const t=mp.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=f2)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,t){return this._results.reduce(n,t)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,t){this.dirty=!1;const o=function so(e){return e.flat(Number.POSITIVE_INFINITY)}(n);(this._changesDetected=!function b1(e,n,t){if(e.length!==n.length)return!1;for(let o=0;o<e.length;o++){let c=e[o],u=n[o];if(t&&(c=t(c),u=t(u)),u!==c)return!1}return!0}(this._results,o,t))&&(this._results=o,this.length=o.length,this.last=o[this.length-1],this.first=o[0])}notifyOnChanges(){void 0!==this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){void 0!==this._changes&&(this._changes.complete(),this._changes.unsubscribe())}}let js=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=oN}return e})();const xT=js,m2=class extends xT{constructor(n,t,o){super(),this._declarationLView=n,this._declarationTContainer=t,this.elementRef=o}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,t){return this.createEmbeddedViewImpl(n,t)}createEmbeddedViewImpl(n,t,o){const c=Xh(this._declarationLView,this._declarationTContainer,n,{injector:t,dehydratedView:o});return new om(c)}};function oN(){return _p(Nn(),me())}function _p(e,n){return 4&e.type?new m2(n,e,Cd(e,n)):null}class Pv{constructor(n){this.queryList=n,this.matches=null}clone(){return new Pv(this.queryList)}setDirty(){this.queryList.setDirty()}}class Vm{constructor(n=[]){this.queries=n}createEmbeddedView(n){const t=n.queries;if(null!==t){const o=null!==n.contentQueries?n.contentQueries[0]:t.length,c=[];for(let u=0;u<o;u++){const p=t.getByIndex(u);c.push(this.queries[p.indexInDeclarationView].clone())}return new Vm(c)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let t=0;t<this.queries.length;t++)null!==kv(n,t).matches&&this.queries[t].setDirty()}}class Mv{constructor(n,t,o=null){this.predicate=n,this.flags=t,this.read=o}}class kT{constructor(n=[]){this.queries=n}elementStart(n,t){for(let o=0;o<this.queries.length;o++)this.queries[o].elementStart(n,t)}elementEnd(n){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(n)}embeddedTView(n){let t=null;for(let o=0;o<this.length;o++){const c=null!==t?t.length:0,u=this.getByIndex(o).embeddedTView(n,c);u&&(u.indexInDeclarationView=o,null!==t?t.push(u):t=[u])}return null!==t?new kT(t):null}template(n,t){for(let o=0;o<this.queries.length;o++)this.queries[o].template(n,t)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class Bm{constructor(n,t=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(n,t){this.isApplyingToNode(t)&&this.matchTNode(n,t)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,t){this.elementStart(n,t)}embeddedTView(n,t){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,t),new Bm(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let o=n.parent;for(;null!==o&&8&o.type&&o.index!==t;)o=o.parent;return t===(null!==o?o.index:-1)}return this._appliesToNextNode}matchTNode(n,t){const o=this.metadata.predicate;if(Array.isArray(o))for(let c=0;c<o.length;c++){const u=o[c];this.matchTNodeWithReadOption(n,t,sN(t,u)),this.matchTNodeWithReadOption(n,t,Vg(t,n,u,!1,!1))}else o===js?4&t.type&&this.matchTNodeWithReadOption(n,t,-1):this.matchTNodeWithReadOption(n,t,Vg(t,n,o,!1,!1))}matchTNodeWithReadOption(n,t,o){if(null!==o){const c=this.metadata.read;if(null!==c)if(c===en||c===mr||c===js&&4&t.type)this.addMatch(t.index,-2);else{const u=Vg(t,n,c,!1,!1);null!==u&&this.addMatch(t.index,u)}else this.addMatch(t.index,o)}}addMatch(n,t){null===this.matches?this.matches=[n,t]:this.matches.push(n,t)}}function sN(e,n){const t=e.localNames;if(null!==t)for(let o=0;o<t.length;o+=2)if(t[o]===n)return t[o+1];return null}function cN(e,n,t,o){return-1===t?function aN(e,n){return 11&e.type?Cd(e,n):4&e.type?_p(e,n):null}(n,e):-2===t?function dN(e,n,t){return t===en?Cd(n,e):t===js?_p(n,e):t===mr?_m(n,e):void 0}(e,n,o):Ll(e,e[Ne],t,n)}function lN(e,n,t,o){const c=n[xs].queries[o];if(null===c.matches){const u=e.data,p=t.matches,m=[];for(let E=0;E<p.length;E+=2){const S=p[E];m.push(S<0?null:cN(n,u[S],p[E+1],t.metadata.read))}c.matches=m}return c.matches}function xv(e,n,t,o){const c=e.queries.getByIndex(t),u=c.matches;if(null!==u){const p=lN(e,n,c,t);for(let m=0;m<u.length;m+=2){const E=u[m];if(E>0)o.push(p[m/2]);else{const S=u[m+1],w=n[-E];for(let P=Di;P<w.length;P++){const V=w[P];V[th]===V[Ai]&&xv(V[Ne],V,S,o)}if(null!==w[Rl]){const P=w[Rl];for(let V=0;V<P.length;V++){const H=P[V];xv(H[Ne],H,S,o)}}}}}return o}function cu(e,n,t){const o=new mp(4==(4&t));(function iD(e,n,t,o){const c=nm(n);c.push(t),e.firstCreatePass&&AC(e).push(o,c.length-1)})(e,n,o,o.destroy),null===n[xs]&&(n[xs]=new Vm),n[xs].queries.push(new Pv(o))}function du(e,n,t){null===e.queries&&(e.queries=new kT),e.queries.track(new Bm(n,t))}function kv(e,n){return e.queries.getByIndex(n)}function ua(e,n,t,o){const c=qt();if(c.firstCreatePass){const u=Nn();du(c,new Mv(n,t,o),u.index),function jm(e,n){const t=e.contentQueries||(e.contentQueries=[]);n!==(t.length?t[t.length-1]:-1)&&t.push(e.queries.length-1,n)}(c,e),2==(2&t)&&(c.staticContentQueries=!0)}cu(c,me(),t)}function ha(e,n,t){const o=qt();o.firstCreatePass&&(du(o,new Mv(e,n,t),-1),2==(2&n)&&(o.staticViewQueries=!0)),cu(o,me(),n)}function Qi(e){const n=me(),t=qt(),o=Qw();Wy(o+1);const c=kv(t,o);if(e.dirty&&function Zx(e){return 4==(4&e[et])}(n)===(2==(2&c.metadata.flags))){if(null===c.matches)e.reset([]);else{const u=c.crossesNgTemplate?xv(t,n,o,[]):lN(t,n,c,o);e.reset(u,kh),e.notifyOnChanges()}return!0}return!1}function ar(){return function _2(e,n){return e[xs].queries[n].queryList}(me(),Qw())}function Hm(e){return Dl(function a1(){return dt.lFrame.contextLView}(),mt+e)}function br(e,n=""){const t=me(),o=qt(),c=e+mt,u=o.firstCreatePass?Sc(o,c,1,n,null):o.data[c],p=fN(o,t,u,n,e);t[c]=p,Og()&&mE(o,t,p,u),Oa(u,!1)}let fN=(e,n,t,o,c)=>(fd(!0),function cE(e,n){return e.createText(n)}(n[St],o));function uu(e){return Mo("",e,""),uu}function Mo(e,n,t){const o=me(),c=function sp(e,n,t,o){return qe(e,ea(),t)?n+yt(t)+o:_t}(o,e,n,t);return c!==_t&&function Cc(e,n,t){const o=gf(n,e);!function rA(e,n,t){e.setValue(n,t)}(e[St],o,t)}(o,Hr(),c),Mo}function zm(e,n,t,o,c){if(e=nt(e),Array.isArray(e))for(let u=0;u<e.length;u++)zm(e[u],n,t,o,c);else{const u=qt(),p=me(),m=Nn();let E=gd(e)?e:nt(e.provide);const S=mS(e),w=1048575&m.providerIndexes,P=m.directiveStart,V=m.providerIndexes>>20;if(gd(e)||!e.multi){const H=new wf(S,c,ae),z=Wa(E,n,c?w:w+V,P);-1===z?(Fg(xg(m,p),u,E),qm(u,e,n.length),n.push(E),m.directiveStart++,m.directiveEnd++,c&&(m.providerIndexes+=1048576),t.push(H),p.push(H)):(t[z]=H,p[z]=H)}else{const H=Wa(E,n,w+V,P),z=Wa(E,n,w,w+V),ce=z>=0&&t[z];if(c&&!ce||!c&&!(H>=0&&t[H])){Fg(xg(m,p),u,E);const he=function zT(e,n,t,o,c){const u=new wf(e,t,ae);return u.multi=[],u.index=n,u.componentProviders=0,pu(u,c,o&&!t),u}(c?Kr:fu,t.length,c,o,S);!c&&ce&&(t[z].providerFactory=he),qm(u,e,n.length,0),n.push(E),m.directiveStart++,m.directiveEnd++,c&&(m.providerIndexes+=1048576),t.push(he),p.push(he)}else qm(u,e,H>-1?H:z,pu(t[c?z:H],S,!c&&o));!c&&o&&ce&&t[z].componentProviders++}}}function qm(e,n,t,o){const c=gd(n),u=function wR(e){return!!e.useClass}(n);if(c||u){const E=(u?nt(n.useClass):n).prototype.ngOnDestroy;if(E){const S=e.destroyHooks||(e.destroyHooks=[]);if(!c&&n.multi){const w=S.indexOf(t);-1===w?S.push(t,[o,E]):S[w+1].push(o,E)}else S.push(t,E)}}}function pu(e,n,t){return t&&e.componentProviders++,e.multi.push(n)-1}function Wa(e,n,t,o){for(let c=t;c<o;c++)if(n[c]===e)return c;return-1}function fu(e,n,t,o){return gp(this.multi,[])}function Kr(e,n,t,o){const c=this.multi;let u;if(this.providerFactory){const p=this.providerFactory.componentProviders,m=Ll(t,t[Ne],this.providerFactory.index,o);u=m.slice(0,p),gp(c,u);for(let E=p;E<m.length;E++)u.push(m[E])}else u=[],gp(c,u);return u}function gp(e,n){for(let t=0;t<e.length;t++)n.push((0,e[t])());return n}function wn(e,n=[]){return t=>{t.providersResolver=(o,c)=>function jd(e,n,t){const o=qt();if(o.firstCreatePass){const c=ks(e);zm(t,o.data,o.blueprint,c,!0),zm(n,o.data,o.blueprint,c,!1)}}(o,c?c(e):e,n)}}class Hd{}class _N{}class yr extends Hd{constructor(n,t,o){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new SD(this);const c=hr(n);this._bootstrapComponents=ao(c.bootstrap),this._r3Injector=MR(n,t,[{provide:Hd,useValue:this},{provide:Mh,useValue:this.componentFactoryResolver},...o],Yt(n),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(n)}get injector(){return this._r3Injector}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class jc extends _N{constructor(n){super(),this.moduleType=n}create(n){return new yr(this.moduleType,n,[])}}class Vi extends Hd{constructor(n){super(),this.componentFactoryResolver=new SD(this),this.instance=null;const t=new jl([...n.providers,{provide:Hd,useValue:this},{provide:Mh,useValue:this.componentFactoryResolver}],n.parent||Jg(),n.debugName,new Set(["environment"]));this.injector=t,n.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}}function Km(e,n,t=null){return new Vi({providers:e,parent:n,debugName:t,runEnvironmentInitializers:!0}).injector}let Ep=(()=>{class e{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){const o=TR(0,t.type),c=o.length>0?Km([o],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,c)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=Pe({token:e,providedIn:"environment",factory:()=>new e(be(ts))})}return e})();function Gc(e){$l("NgStandalone"),e.getStandaloneInjector=n=>n.get(Ep).getOrCreateStandaloneInjector(e)}function _u(e,n,t,o,c,u,p){return function gn(e,n,t,o,c,u,p,m,E){const S=n+t;return function is(e,n,t,o,c,u){const p=Dc(e,n,t,o);return Dc(e,n+2,c,u)||p}(e,S,c,u,p,m)?Va(e,S+4,E?o.call(E,c,u,p,m):o(c,u,p,m)):bp(e,S+4)}(me(),ro(),e,n,t,o,c,u,p)}function bp(e,n){const t=e[n];return t===_t?void 0:t}function gu(e,n){const t=qt();let o;const c=e+mt;t.firstCreatePass?(o=function IN(e,n){if(n)for(let t=n.length-1;t>=0;t--){const o=n[t];if(e===o.name)return o}}(n,t.pipeRegistry),t.data[c]=o,o.onDestroy&&(t.destroyHooks??=[]).push(c,o.onDestroy)):o=t.data[c];const u=o.factory||(o.factory=Al(o.type)),m=bo(ae);try{const E=Df(!1),S=u();return Df(E),function LT(e,n,t,o){t>=e.data.length&&(e.data[t]=null,e.blueprint[t]=null),n[t]=o}(t,me(),c,S),S}finally{bo(m)}}function Eu(e,n,t){const o=e+mt,c=me(),u=Dl(c,o);return function vu(e,n){return e[Ne].data[n].pure}(c,o)?function t0(e,n,t,o,c,u){const p=n+t;return qe(e,p,c)?Va(e,p+1,u?o.call(u,c):o(c)):bp(e,p+1)}(c,ro(),n,u.transform,t,u):u.transform(t)}function jv(e,n){return _p(e,n)}let E0=(()=>{class e{log(t){console.log(t)}warn(t){console.warn(t)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();class PN{constructor(n,t){this.ngModuleFactory=n,this.componentFactories=t}}let qv=(()=>{class e{compileModuleSync(t){return new jc(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const o=this.compileModuleSync(t),u=ao(hr(t).declarations).reduce((p,m)=>{const E=Lt(m);return E&&p.push(new cm(E)),p},[]);return new PN(o,u)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),i_=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Yo(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);const t=this.taskId++;return this.pendingTasks.add(t),t}remove(t){this.pendingTasks.delete(t),0===this.pendingTasks.size&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const BN=new De(""),yu=new De("");let C0,s_=(()=>{class e{constructor(t,o,c){this._ngZone=t,this.registry=o,this._pendingCount=0,this._isZoneStable=!0,this._callbacks=[],this.taskTrackingZone=null,C0||(function Q2(e){C0=e}(c),c.addToWindow(o)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{it.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb()}});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(o=>!o.updateCb||!o.updateCb(t)||(clearTimeout(o.timeoutId),!1))}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,o,c){let u=-1;o&&o>0&&(u=setTimeout(()=>{this._callbacks=this._callbacks.filter(p=>p.timeoutId!==u),t()},o)),this._callbacks.push({doneCb:t,timeoutId:u,updateCb:c})}whenStable(t,o,c){if(c&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,o,c),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,o,c){return[]}static#e=this.\u0275fac=function(o){return new(o||e)(be(it),be(S0),be(yu))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})(),S0=(()=>{class e{constructor(){this._applications=new Map}registerApplication(t,o){this._applications.set(t,o)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,o=!0){return C0?.findTestabilityInTree(this,t,o)??null}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();const T0=new De("");let qc=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,o)=>{this.resolve=t,this.reject=o}),this.appInits=Te(T0,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const t=[];for(const c of this.appInits){const u=c();if(fp(u))t.push(u);else if(Rv(u)){const p=new Promise((m,E)=>{u.subscribe({complete:m,error:E})});t.push(p)}}const o=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{o()}).catch(c=>{this.reject(c)}),0===t.length&&o(),this.initialized=!0}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Gs=new De("");function jN(e,n){return Array.isArray(n)?n.reduce(jN,e):{...e,...n}}let Yr=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Te(Kl),this.afterRenderEffectManager=Te(sm),this.componentTypes=[],this.components=[],this.isStable=Te(i_).hasPendingTasks.pipe(Zt(t=>!t)),this._injector=Te(ts)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(t,o){const c=t instanceof UA;if(!this._injector.get(qc).done)throw!c&&function ud(e){const n=Lt(e)||qi(e)||Ar(e);return null!==n&&n.standalone}(t),new pe(405,!1);let p;p=c?t:this._injector.get(Mh).resolveComponentFactory(t),this.componentTypes.push(p.componentType);const m=function Su(e){return e.isBoundToModule}(p)?void 0:this._injector.get(Hd),S=p.create(pr.NULL,[],o||p.selector,m),w=S.location.nativeElement,P=S.injector.get(BN,null);return P?.registerApplication(w),S.onDestroy(()=>{this.detachView(S.hostView),$r(this.components,S),P?.unregisterApplication(w)}),this._loadComponent(S),S}tick(){if(this._runningTick)throw new pe(101,!1);try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this.internalErrorHandler(t)}finally{try{this.afterRenderEffectManager.execute()}catch(t){this.internalErrorHandler(t)}this._runningTick=!1}}attachView(t){const o=t;this._views.push(o),o.attachToAppRef(this)}detachView(t){const o=t;$r(this._views,o),o.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const o=this._injector.get(Gs,[]);[...this._bootstrapListeners,...o].forEach(c=>c(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>$r(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new pe(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function $r(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}let I0=(()=>{class e{constructor(){this.zone=Te(it),this.applicationRef=Te(Yr)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function HN(){const e=Te(it),n=Te(ka);return t=>e.runOutsideAngular(()=>n.handleError(t))}let Ka=(()=>{class e{constructor(){this.subscription=new nr,this.initialized=!1,this.zone=Te(it),this.pendingTasks=Te(i_)}initialize(){if(this.initialized)return;this.initialized=!0;let t=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(t=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{it.assertNotInAngularZone(),queueMicrotask(()=>{null!==t&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(t),t=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{it.assertInAngularZone(),t??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Ya=new De("",{providedIn:"root",factory:()=>Te(Ya,Vt.Optional|Vt.SkipSelf)||function c_(){return typeof $localize<"u"&&$localize.locale||da}()}),R0=new De("");let WN=(()=>{class e{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,o){const c=function wL(e="zone.js",n){return"noop"===e?new _D:"zone.js"===e?new it(n):e}(o?.ngZone,function Tu(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}({eventCoalescing:o?.ngZoneEventCoalescing,runCoalescing:o?.ngZoneRunCoalescing}));return c.run(()=>{const u=function Hc(e,n,t){return new yr(e,n,t)}(t.moduleType,this.injector,function Cu(e){return[{provide:it,useFactory:e},{provide:_d,multi:!0,useFactory:()=>{const n=Te(I0,{optional:!0});return()=>n.initialize()}},{provide:_d,multi:!0,useFactory:()=>{const n=Te(Ka);return()=>{n.initialize()}}},{provide:Kl,useFactory:HN}]}(()=>c)),p=u.injector.get(ka,null);return c.runOutsideAngular(()=>{const m=c.onError.subscribe({next:E=>{p.handleError(E)}});u.onDestroy(()=>{$r(this._modules,u),m.unsubscribe()})}),function Kc(e,n,t){try{const o=t();return fp(o)?o.catch(c=>{throw n.runOutsideAngular(()=>e.handleError(c)),c}):o}catch(o){throw n.runOutsideAngular(()=>e.handleError(o)),o}}(p,c,()=>{const m=u.injector.get(qc);return m.runInitializers(),m.donePromise.then(()=>(function Uc(e){vo(e,"Expected localeId to be defined"),"string"==typeof e&&(sr=e.toLowerCase().replace(/_/g,"-"))}(u.injector.get(Ya,da)||da),this._moduleDoBootstrap(u),u))})})}bootstrapModule(t,o=[]){const c=jN({},o);return function Ap(e,n,t){const o=new jc(t);return Promise.resolve(o)}(0,0,t).then(u=>this.bootstrapModuleFactory(u,c))}_moduleDoBootstrap(t){const o=t.injector.get(Yr);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(c=>o.bootstrap(c));else{if(!t.instance.ngDoBootstrap)throw new pe(-403,!1);t.instance.ngDoBootstrap(o)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new pe(404,!1);this._modules.slice().forEach(o=>o.destroy()),this._destroyListeners.forEach(o=>o());const t=this._injector.get(R0,null);t&&(t.forEach(o=>o()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#e=this.\u0275fac=function(o){return new(o||e)(be(pr))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})(),Ws=null;const zN=new De("");function A0(e,n,t=[]){const o=`Platform: ${n}`,c=new De(o);return(u=[])=>{let p=$v();if(!p||p.injector.get(zN,!1)){const m=[...t,...u,{provide:c,useValue:!0}];e?e(m):function Yv(e){if(Ws&&!Ws.get(zN,!1))throw new pe(400,!1);(function Op(){!function ry(e){Zp=e}(()=>{throw new pe(600,!1)})})(),Ws=e;const n=e.get(WN);(function qN(e){e.get(UR,null)?.forEach(t=>t())})(e)}(function Np(e=[],n){return pr.create({name:n,providers:[{provide:pS,useValue:"platform"},{provide:R0,useValue:new Set([()=>Ws=null])},...e]})}(m,o))}return function l_(e){const n=$v();if(!n)throw new pe(401,!1);return n}()}}function $v(){return Ws?.get(WN)??null}const JN=A0(null,"core",[]);let cF=(()=>{class e{constructor(t){}static#e=this.\u0275fac=function(o){return new(o||e)(be(Yr))};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Jn({})}return e})();function uo(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}let db=null;function $c(){return db}class xF{}const on=new De("");let Xc=(()=>{class e{historyGo(t){throw new Error("")}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:()=>Te(kF),providedIn:"platform"})}return e})();const vP=new De("");let kF=(()=>{class e extends Xc{constructor(){super(),this._doc=Te(on),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return $c().getBaseHref(this._doc)}onPopState(t){const o=$c().getGlobalEventTarget(this._doc,"window");return o.addEventListener("popstate",t,!1),()=>o.removeEventListener("popstate",t)}onHashChange(t){const o=$c().getGlobalEventTarget(this._doc,"window");return o.addEventListener("hashchange",t,!1),()=>o.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,o,c){this._history.pushState(t,o,c)}replaceState(t,o,c){this._history.replaceState(t,o,c)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:()=>new e,providedIn:"platform"})}return e})();function xp(e,n){if(0==e.length)return n;if(0==n.length)return e;let t=0;return e.endsWith("/")&&t++,n.startsWith("/")&&t++,2==t?e+n.substring(1):1==t?e+n:e+"/"+n}function B0(e){const n=e.match(/#|\?|$/),t=n&&n.index||e.length;return e.slice(0,t-("/"===e[t-1]?1:0))+e.slice(t)}function Xa(e){return e&&"?"!==e[0]?"?"+e:e}let _a=(()=>{class e{historyGo(t){throw new Error("")}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:()=>Te(lb),providedIn:"root"})}return e})();const qs=new De("");let lb=(()=>{class e extends _a{constructor(t,o){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=o??this._platformLocation.getBaseHrefFromDOM()??Te(on).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return xp(this._baseHref,t)}path(t=!1){const o=this._platformLocation.pathname+Xa(this._platformLocation.search),c=this._platformLocation.hash;return c&&t?`${o}${c}`:o}pushState(t,o,c,u){const p=this.prepareExternalUrl(c+Xa(u));this._platformLocation.pushState(t,o,p)}replaceState(t,o,c,u){const p=this.prepareExternalUrl(c+Xa(u));this._platformLocation.replaceState(t,o,p)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(o){return new(o||e)(be(Xc),be(qs,8))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),bP=(()=>{class e extends _a{constructor(t,o){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=o&&(this._baseHref=o)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){const o=this._platformLocation.hash??"#";return o.length>0?o.substring(1):o}prepareExternalUrl(t){const o=xp(this._baseHref,t);return o.length>0?"#"+o:o}pushState(t,o,c,u){let p=this.prepareExternalUrl(c+Xa(u));0==p.length&&(p=this._platformLocation.pathname),this._platformLocation.pushState(t,o,p)}replaceState(t,o,c,u){let p=this.prepareExternalUrl(c+Xa(u));0==p.length&&(p=this._platformLocation.pathname),this._platformLocation.replaceState(t,o,p)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(o){return new(o||e)(be(Xc),be(qs,8))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})(),Hi=(()=>{class e{constructor(t){this._subject=new hn,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const o=this._locationStrategy.getBaseHref();this._basePath=function j0(e){if(new RegExp("^(https?:)?//").test(e)){const[,t]=e.split(/\/\/[^\/]+/);return t}return e}(B0(f_(o))),this._locationStrategy.onPopState(c=>{this._subject.emit({url:this.path(!0),pop:!0,state:c.state,type:c.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,o=""){return this.path()==this.normalize(t+Xa(o))}normalize(t){return e.stripTrailingSlash(function ub(e,n){if(!e||!n.startsWith(e))return n;const t=n.substring(e.length);return""===t||["/",";","?","#"].includes(t[0])?t:n}(this._basePath,f_(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,o="",c=null){this._locationStrategy.pushState(c,"",t,o),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Xa(o)),c)}replaceState(t,o="",c=null){this._locationStrategy.replaceState(c,"",t,o),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Xa(o)),c)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(o=>{this._notifyUrlChangeListeners(o.url,o.state)}),()=>{const o=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(o,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",o){this._urlChangeListeners.forEach(c=>c(t,o))}subscribe(t,o,c){return this._subject.subscribe({next:t,error:o,complete:c})}static#e=this.normalizeQueryParams=Xa;static#t=this.joinWithSlash=xp;static#n=this.stripTrailingSlash=B0;static#i=this.\u0275fac=function(o){return new(o||e)(be(_a))};static#r=this.\u0275prov=Pe({token:e,factory:()=>function Jd(){return new Hi(be(_a))}(),providedIn:"root"})}return e})();function f_(e){return e.replace(/\/index.html$/,"")}const si=/\s+/,Wi=[];let Y0=(()=>{class e{constructor(t,o){this._ngEl=t,this._renderer=o,this.initialClasses=Wi,this.stateMap=new Map}set klass(t){this.initialClasses=null!=t?t.trim().split(si):Wi}set ngClass(t){this.rawClass="string"==typeof t?t.trim().split(si):t}ngDoCheck(){for(const o of this.initialClasses)this._updateState(o,!0);const t=this.rawClass;if(Array.isArray(t)||t instanceof Set)for(const o of t)this._updateState(o,!0);else if(null!=t)for(const o of Object.keys(t))this._updateState(o,!!t[o]);this._applyStateDiff()}_updateState(t,o){const c=this.stateMap.get(t);void 0!==c?(c.enabled!==o&&(c.changed=!0,c.enabled=o),c.touched=!0):this.stateMap.set(t,{enabled:o,changed:!0,touched:!0})}_applyStateDiff(){for(const t of this.stateMap){const o=t[0],c=t[1];c.changed?(this._toggleClass(o,c.enabled),c.changed=!1):c.touched||(c.enabled&&this._toggleClass(o,!1),this.stateMap.delete(o)),c.touched=!1}}_toggleClass(t,o){(t=t.trim()).length>0&&t.split(si).forEach(c=>{o?this._renderer.addClass(this._ngEl.nativeElement,c):this._renderer.removeClass(this._ngEl.nativeElement,c)})}static#e=this.\u0275fac=function(o){return new(o||e)(ae(en),ae(Fs))};static#t=this.\u0275dir=Ye({type:e,selectors:[["","ngClass",""]],inputs:{klass:[Xe.None,"class","klass"],ngClass:"ngClass"},standalone:!0})}return e})();class HF{constructor(n,t,o,c){this.$implicit=n,this.ngForOf=t,this.index=o,this.count=c}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let kP=(()=>{class e{set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}constructor(t,o,c){this._viewContainer=t,this._template=o,this._differs=c,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const o=this._viewContainer;t.forEachOperation((c,u,p)=>{if(null==c.previousIndex)o.createEmbeddedView(this._template,new HF(c.item,this._ngForOf,-1,-1),null===p?void 0:p);else if(null==p)o.remove(null===u?void 0:u);else if(null!==u){const m=o.get(u);o.move(m,p),$0(m,c)}});for(let c=0,u=o.length;c<u;c++){const m=o.get(c).context;m.index=c,m.count=u,m.ngForOf=this._ngForOf}t.forEachIdentityChange(c=>{$0(o.get(c.currentIndex),c)})}static ngTemplateContextGuard(t,o){return!0}static#e=this.\u0275fac=function(o){return new(o||e)(ae(mr),ae(js),ae(dC))};static#t=this.\u0275dir=Ye({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}return e})();function $0(e,n){e.context.$implicit=n.item}let Mu=(()=>{class e{constructor(t,o){this._viewContainer=t,this._context=new Zr,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=o}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){xu("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){xu("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,o){return!0}static#e=this.\u0275fac=function(o){return new(o||e)(ae(mr),ae(js))};static#t=this.\u0275dir=Ye({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}return e})();class Zr{constructor(){this.$implicit=null,this.ngIf=null}}function xu(e,n){if(n&&!n.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${Yt(n)}'.`)}let Z0=(()=>{class e{constructor(t){this._viewContainerRef=t,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(t){if(this._shouldRecreateView(t)){const o=this._viewContainerRef;if(this._viewRef&&o.remove(o.indexOf(this._viewRef)),!this.ngTemplateOutlet)return void(this._viewRef=null);const c=this._createContextForwardProxy();this._viewRef=o.createEmbeddedView(this.ngTemplateOutlet,c,{injector:this.ngTemplateOutletInjector??void 0})}}_shouldRecreateView(t){return!!t.ngTemplateOutlet||!!t.ngTemplateOutletInjector}_createContextForwardProxy(){return new Proxy({},{set:(t,o,c)=>!!this.ngTemplateOutletContext&&Reflect.set(this.ngTemplateOutletContext,o,c),get:(t,o,c)=>{if(this.ngTemplateOutletContext)return Reflect.get(this.ngTemplateOutletContext,o,c)}})}static#e=this.\u0275fac=function(o){return new(o||e)(ae(mr))};static#t=this.\u0275dir=Ye({type:e,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[So]})}return e})();class eI{createSubscription(n,t){return BA(()=>n.subscribe({next:t,error:o=>{throw o}}))}dispose(n){BA(()=>n.unsubscribe())}}class Za{createSubscription(n,t){return n.then(t,o=>{throw o})}dispose(n){}}const wt=new Za,il=new eI;let Cb=(()=>{class e{constructor(t){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=t}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(t){return this._obj?t!==this._obj?(this._dispose(),this.transform(t)):this._latestValue:(t&&this._subscribe(t),this._latestValue)}_subscribe(t){this._obj=t,this._strategy=this._selectStrategy(t),this._subscription=this._strategy.createSubscription(t,o=>this._updateLatestValue(t,o))}_selectStrategy(t){if(fp(t))return wt;if(Rv(t))return il;throw function Cs(e,n){return new pe(2100,!1)}()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(t,o){t===this._obj&&(this._latestValue=o,this._ref.markForCheck())}static#e=this.\u0275fac=function(o){return new(o||e)(ae(Us,16))};static#t=this.\u0275pipe=yo({name:"async",type:e,pure:!1,standalone:!0})}return e})(),ku=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Jn({})}return e})();const iI="browser";function zP(e){return e===iI}function qP(e){return"server"===e}let eU=(()=>{class e{static#e=this.\u0275prov=Pe({token:e,providedIn:"root",factory:()=>zP(Te(Ma))?new KP(Te(on),window):new YP})}return e})();class KP{constructor(n,t){this.document=n,this.window=t,this.offset=()=>[0,0]}setOffset(n){this.offset=Array.isArray(n)?()=>n:n}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(n){this.window.scrollTo(n[0],n[1])}scrollToAnchor(n){const t=function oI(e,n){const t=e.getElementById(n)||e.getElementsByName(n)[0];if(t)return t;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const o=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let c=o.currentNode;for(;c;){const u=c.shadowRoot;if(u){const p=u.getElementById(n)||u.querySelector(`[name="${n}"]`);if(p)return p}c=o.nextNode()}}return null}(this.document,n);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(n){this.window.history.scrollRestoration=n}scrollToElement(n){const t=n.getBoundingClientRect(),o=t.left+this.window.pageXOffset,c=t.top+this.window.pageYOffset,u=this.offset();this.window.scrollTo(o-u[0],c-u[1])}}class YP{setOffset(n){}getScrollPosition(){return[0,0]}scrollToPosition(n){}scrollToAnchor(n){}setHistoryScrollRestoration(n){}}class Up extends xF{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class un extends Up{static makeCurrent(){!function MF(e){db??=e}(new un)}onAndCancel(n,t,o){return n.addEventListener(t,o),()=>{n.removeEventListener(t,o)}}dispatchEvent(n,t){n.dispatchEvent(t)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,t){return(t=t||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,t){return"window"===t?window:"document"===t?n:"body"===t?n.body:null}getBaseHref(n){const t=function zt(){return En=En||document.querySelector("base"),En?En.getAttribute("href"):null}();return null==t?null:function fo(e){return new URL(e,document.baseURI).pathname}(t)}resetBaseElement(){En=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return function yb(e,n){n=encodeURIComponent(n);for(const t of e.split(";")){const o=t.indexOf("="),[c,u]=-1==o?[t,""]:[t.slice(0,o),t.slice(o+1)];if(c.trim()===n)return decodeURIComponent(u)}return null}(document.cookie,n)}}let En=null,Rn=(()=>{class e{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})();const at=new De("");let Ur=(()=>{class e{constructor(t,o){this._zone=o,this._eventNameToPlugin=new Map,t.forEach(c=>{c.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,o,c){return this._findPluginFor(o).addEventListener(t,o,c)}getZone(){return this._zone}_findPluginFor(t){let o=this._eventNameToPlugin.get(t);if(o)return o;if(o=this._plugins.find(u=>u.supports(t)),!o)throw new pe(5101,!1);return this._eventNameToPlugin.set(t,o),o}static#e=this.\u0275fac=function(o){return new(o||e)(be(at),be(it))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})();class Qc{constructor(n){this._doc=n}}const Is="ng-app-id";let uI=(()=>{class e{constructor(t,o,c,u={}){this.doc=t,this.appId=o,this.nonce=c,this.platformId=u,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=qP(u),this.resetHostNodes()}addStyles(t){for(const o of t)1===this.changeUsageCount(o,1)&&this.onStyleAdded(o)}removeStyles(t){for(const o of t)this.changeUsageCount(o,-1)<=0&&this.onStyleRemoved(o)}ngOnDestroy(){const t=this.styleNodesInDOM;t&&(t.forEach(o=>o.remove()),t.clear());for(const o of this.getAllStyles())this.onStyleRemoved(o);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const o of this.getAllStyles())this.addStyleToHost(t,o)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(const o of this.hostNodes)this.addStyleToHost(o,t)}onStyleRemoved(t){const o=this.styleRef;o.get(t)?.elements?.forEach(c=>c.remove()),o.delete(t)}collectServerRenderedStyles(){const t=this.doc.head?.querySelectorAll(`style[${Is}="${this.appId}"]`);if(t?.length){const o=new Map;return t.forEach(c=>{null!=c.textContent&&o.set(c.textContent,c)}),o}return null}changeUsageCount(t,o){const c=this.styleRef;if(c.has(t)){const u=c.get(t);return u.usage+=o,u.usage}return c.set(t,{usage:o,elements:[]}),o}getStyleElement(t,o){const c=this.styleNodesInDOM,u=c?.get(o);if(u?.parentNode===t)return c.delete(o),u.removeAttribute(Is),u;{const p=this.doc.createElement("style");return this.nonce&&p.setAttribute("nonce",this.nonce),p.textContent=o,this.platformIsServer&&p.setAttribute(Is,this.appId),t.appendChild(p),p}}addStyleToHost(t,o){const c=this.getStyleElement(t,o),u=this.styleRef,p=u.get(o)?.elements;p?p.push(c):u.set(o,{elements:[c],usage:1})}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}static#e=this.\u0275fac=function(o){return new(o||e)(be(on),be(Bf),be(yS,8),be(Ma))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})();const sU={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},aU=/%COMP%/g,x8=new De("",{providedIn:"root",factory:()=>!0});function dj(e,n){return n.map(t=>t.replace(aU,e))}let cU=(()=>{class e{constructor(t,o,c,u,p,m,E,S=null){this.eventManager=t,this.sharedStylesHost=o,this.appId=c,this.removeStylesOnCompDestroy=u,this.doc=p,this.platformId=m,this.ngZone=E,this.nonce=S,this.rendererByCompId=new Map,this.platformIsServer=qP(m),this.defaultRenderer=new dU(t,p,E,this.platformIsServer)}createRenderer(t,o){if(!t||!o)return this.defaultRenderer;this.platformIsServer&&o.encapsulation===Xs.ShadowDom&&(o={...o,encapsulation:Xs.Emulated});const c=this.getOrCreateRenderer(t,o);return c instanceof uj?c.applyToHost(t):c instanceof lU&&c.applyStyles(),c}getOrCreateRenderer(t,o){const c=this.rendererByCompId;let u=c.get(o.id);if(!u){const p=this.doc,m=this.ngZone,E=this.eventManager,S=this.sharedStylesHost,w=this.removeStylesOnCompDestroy,P=this.platformIsServer;switch(o.encapsulation){case Xs.Emulated:u=new uj(E,S,o,this.appId,w,p,m,P);break;case Xs.ShadowDom:return new U8(E,S,t,o,p,m,this.nonce,P);default:u=new lU(E,S,o,w,p,m,P)}c.set(o.id,u)}return u}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(o){return new(o||e)(be(Ur),be(uI),be(Bf),be(x8),be(on),be(Ma),be(it),be(yS))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})();class dU{constructor(n,t,o,c){this.eventManager=n,this.doc=t,this.ngZone=o,this.platformIsServer=c,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(n,t){return t?this.doc.createElementNS(sU[t]||t,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,t){(lj(n)?n.content:n).appendChild(t)}insertBefore(n,t,o){n&&(lj(n)?n.content:n).insertBefore(t,o)}removeChild(n,t){n&&n.removeChild(t)}selectRootElement(n,t){let o="string"==typeof n?this.doc.querySelector(n):n;if(!o)throw new pe(-5104,!1);return t||(o.textContent=""),o}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,t,o,c){if(c){t=c+":"+t;const u=sU[c];u?n.setAttributeNS(u,t,o):n.setAttribute(t,o)}else n.setAttribute(t,o)}removeAttribute(n,t,o){if(o){const c=sU[o];c?n.removeAttributeNS(c,t):n.removeAttribute(`${o}:${t}`)}else n.removeAttribute(t)}addClass(n,t){n.classList.add(t)}removeClass(n,t){n.classList.remove(t)}setStyle(n,t,o,c){c&(xa.DashCase|xa.Important)?n.style.setProperty(t,o,c&xa.Important?"important":""):n.style[t]=o}removeStyle(n,t,o){o&xa.DashCase?n.style.removeProperty(t):n.style[t]=""}setProperty(n,t,o){null!=n&&(n[t]=o)}setValue(n,t){n.nodeValue=t}listen(n,t,o){if("string"==typeof n&&!(n=$c().getGlobalEventTarget(this.doc,n)))throw new Error(`Unsupported event target ${n} for event ${t}`);return this.eventManager.addEventListener(n,t,this.decoratePreventDefault(o))}decoratePreventDefault(n){return t=>{if("__ngUnwrap__"===t)return n;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>n(t)):n(t))&&t.preventDefault()}}}function lj(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class U8 extends dU{constructor(n,t,o,c,u,p,m,E){super(n,u,p,E),this.sharedStylesHost=t,this.hostEl=o,this.shadowRoot=o.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const S=dj(c.id,c.styles);for(const w of S){const P=document.createElement("style");m&&P.setAttribute("nonce",m),P.textContent=w,this.shadowRoot.appendChild(P)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,t){return super.appendChild(this.nodeOrShadowRoot(n),t)}insertBefore(n,t,o){return super.insertBefore(this.nodeOrShadowRoot(n),t,o)}removeChild(n,t){return super.removeChild(this.nodeOrShadowRoot(n),t)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class lU extends dU{constructor(n,t,o,c,u,p,m,E){super(n,u,p,m),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=c,this.styles=E?dj(E,o.styles):o.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class uj extends lU{constructor(n,t,o,c,u,p,m,E){const S=c+"-"+o.id;super(n,t,o,u,p,m,E,S),this.contentAttr=function k8(e){return"_ngcontent-%COMP%".replace(aU,e)}(S),this.hostAttr=function L8(e){return"_nghost-%COMP%".replace(aU,e)}(S)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,t){const o=super.createElement(n,t);return super.setAttribute(o,this.contentAttr,""),o}}let V8=(()=>{class e extends Qc{constructor(t){super(t)}supports(t){return!0}addEventListener(t,o,c){return t.addEventListener(o,c,!1),()=>this.removeEventListener(t,o,c)}removeEventListener(t,o,c){return t.removeEventListener(o,c)}static#e=this.\u0275fac=function(o){return new(o||e)(be(on))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})();const hj=["alt","control","meta","shift"],B8={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},j8={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let H8=(()=>{class e extends Qc{constructor(t){super(t)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,o,c){const u=e.parseEventName(o),p=e.eventCallback(u.fullKey,c,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>$c().onAndCancel(t,u.domEventName,p))}static parseEventName(t){const o=t.toLowerCase().split("."),c=o.shift();if(0===o.length||"keydown"!==c&&"keyup"!==c)return null;const u=e._normalizeKey(o.pop());let p="",m=o.indexOf("code");if(m>-1&&(o.splice(m,1),p="code."),hj.forEach(S=>{const w=o.indexOf(S);w>-1&&(o.splice(w,1),p+=S+".")}),p+=u,0!=o.length||0===u.length)return null;const E={};return E.domEventName=c,E.fullKey=p,E}static matchEventFullKeyCode(t,o){let c=B8[t.key]||t.key,u="";return o.indexOf("code.")>-1&&(c=t.code,u="code."),!(null==c||!c)&&(c=c.toLowerCase()," "===c?c="space":"."===c&&(c="dot"),hj.forEach(p=>{p!==c&&(0,j8[p])(t)&&(u+=p+".")}),u+=c,u===o)}static eventCallback(t,o,c){return u=>{e.matchEventFullKeyCode(u,t)&&c.runGuarded(()=>o(u))}}static _normalizeKey(t){return"esc"===t?"escape":t}static#e=this.\u0275fac=function(o){return new(o||e)(be(on))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})();const q8=A0(JN,"browser",[{provide:Ma,useValue:iI},{provide:UR,useValue:function G8(){un.makeCurrent()},multi:!0},{provide:on,useFactory:function z8(){return function gh(e){bS=e}(document),document},deps:[]}]),K8=new De(""),mj=[{provide:yu,useClass:class tc{addToWindow(n){yn.getAngularTestability=(o,c=!0)=>{const u=n.findTestabilityInTree(o,c);if(null==u)throw new pe(5103,!1);return u},yn.getAllAngularTestabilities=()=>n.getAllTestabilities(),yn.getAllAngularRootElements=()=>n.getAllRootElements(),yn.frameworkStabilizers||(yn.frameworkStabilizers=[]),yn.frameworkStabilizers.push(o=>{const c=yn.getAllAngularTestabilities();let u=c.length;const p=function(){u--,0==u&&o()};c.forEach(m=>{m.whenStable(p)})})}findTestabilityInTree(n,t,o){return null==t?null:n.getTestability(t)??(o?$c().isShadowRoot(t)?this.findTestabilityInTree(n,t.host,!0):this.findTestabilityInTree(n,t.parentElement,!0):null)}},deps:[]},{provide:BN,useClass:s_,deps:[it,S0,yu]},{provide:s_,useClass:s_,deps:[it,S0,yu]}],_j=[{provide:pS,useValue:"root"},{provide:ka,useFactory:function W8(){return new ka},deps:[]},{provide:at,useClass:V8,multi:!0,deps:[on,it,Ma]},{provide:at,useClass:H8,multi:!0,deps:[on]},cU,uI,Ur,{provide:AE,useExisting:cU},{provide:class $P{},useClass:Rn,deps:[]},[]];let gj=(()=>{class e{constructor(t){}static withServerTransition(t){return{ngModule:e,providers:[{provide:Bf,useValue:t.appId}]}}static#e=this.\u0275fac=function(o){return new(o||e)(be(K8,12))};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Jn({providers:[..._j,...mj],imports:[ku,cF]})}return e})(),Y8=(()=>{class e{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static#e=this.\u0275fac=function(o){return new(o||e)(be(on))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function Vp(e){return this instanceof Vp?(this.v=e,this):new Vp(e)}function Tj(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function fU(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],o=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(u){t[u]=e[u]&&function(p){return new Promise(function(m,E){!function c(u,p,m,E){Promise.resolve(E).then(function(S){u({value:S,done:m})},p)}(m,E,(p=e[u](p)).done,p.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const mU=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function Ij(e){return cn(e?.then)}function wj(e){return cn(e[dy])}function Rj(e){return Symbol.asyncIterator&&cn(e?.[Symbol.asyncIterator])}function Aj(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Dj=function vG(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Oj(e){return cn(e?.[Dj])}function Nj(e){return function Cj(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,o=t.apply(e,n||[]),u=[];return c={},p("next"),p("throw"),p("return"),c[Symbol.asyncIterator]=function(){return this},c;function p(V){o[V]&&(c[V]=function(H){return new Promise(function(z,J){u.push([V,H,z,J])>1||m(V,H)})})}function m(V,H){try{!function E(V){V.value instanceof Vp?Promise.resolve(V.value.v).then(S,w):P(u[0][2],V)}(o[V](H))}catch(z){P(u[0][3],z)}}function S(V){m("next",V)}function w(V){m("throw",V)}function P(V,H){V(H),u.shift(),u.length&&m(u[0][0],u[0][1])}}(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:o,done:c}=yield Vp(t.read());if(c)return yield Vp(void 0);yield yield Vp(o)}}finally{t.releaseLock()}})}function Pj(e){return cn(e?.getReader)}function ws(e){if(e instanceof Wn)return e;if(null!=e){if(wj(e))return function bG(e){return new Wn(n=>{const t=e[dy]();if(cn(t.subscribe))return t.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(mU(e))return function yG(e){return new Wn(n=>{for(let t=0;t<e.length&&!n.closed;t++)n.next(e[t]);n.complete()})}(e);if(Ij(e))return function SG(e){return new Wn(n=>{e.then(t=>{n.closed||(n.next(t),n.complete())},t=>n.error(t)).then(null,Q_)})}(e);if(Rj(e))return Mj(e);if(Oj(e))return function CG(e){return new Wn(n=>{for(const t of e)if(n.next(t),n.closed)return;n.complete()})}(e);if(Pj(e))return function TG(e){return Mj(Nj(e))}(e)}throw Aj(e)}function Mj(e){return new Wn(n=>{(function IG(e,n){var t,o,c,u;return function yj(e,n,t,o){return new(t||(t=Promise))(function(u,p){function m(w){try{S(o.next(w))}catch(P){p(P)}}function E(w){try{S(o.throw(w))}catch(P){p(P)}}function S(w){w.done?u(w.value):function c(u){return u instanceof t?u:new t(function(p){p(u)})}(w.value).then(m,E)}S((o=o.apply(e,n||[])).next())})}(this,void 0,void 0,function*(){try{for(t=Tj(e);!(o=yield t.next()).done;)if(n.next(o.value),n.closed)return}catch(p){c={error:p}}finally{try{o&&!o.done&&(u=t.return)&&(yield u.call(t))}finally{if(c)throw c.error}}n.complete()})})(e,n).catch(t=>n.error(t))})}function Fu(e,n,t,o=0,c=!1){const u=n.schedule(function(){t(),c?e.add(this.schedule(null,o)):this.unsubscribe()},o);if(e.add(u),!c)return u}function xj(e,n=0){return Si((t,o)=>{t.subscribe(di(o,c=>Fu(o,e,()=>o.next(c),n),()=>Fu(o,e,()=>o.complete(),n),c=>Fu(o,e,()=>o.error(c),n)))})}function kj(e,n=0){return Si((t,o)=>{o.add(e.schedule(()=>t.subscribe(o),n))})}function Lj(e,n){if(!e)throw new Error("Iterable cannot be null");return new Wn(t=>{Fu(t,n,()=>{const o=e[Symbol.asyncIterator]();Fu(t,n,()=>{o.next().then(c=>{c.done?t.complete():t.next(c.value)})},0,!0)})})}function Vr(e,n){return n?function NG(e,n){if(null!=e){if(wj(e))return function wG(e,n){return ws(e).pipe(kj(n),xj(n))}(e,n);if(mU(e))return function AG(e,n){return new Wn(t=>{let o=0;return n.schedule(function(){o===e.length?t.complete():(t.next(e[o++]),t.closed||this.schedule())})})}(e,n);if(Ij(e))return function RG(e,n){return ws(e).pipe(kj(n),xj(n))}(e,n);if(Rj(e))return Lj(e,n);if(Oj(e))return function DG(e,n){return new Wn(t=>{let o;return Fu(t,n,()=>{o=e[Dj](),Fu(t,n,()=>{let c,u;try{({value:c,done:u}=o.next())}catch(p){return void t.error(p)}u?t.complete():t.next(c)},0,!0)}),()=>cn(o?.return)&&o.return()})}(e,n);if(Pj(e))return function OG(e,n){return Lj(Nj(e),n)}(e,n)}throw Aj(e)}(e,n):ws(e)}const{isArray:PG}=Array,{getPrototypeOf:MG,prototype:xG,keys:kG}=Object;function Fj(e){if(1===e.length){const n=e[0];if(PG(n))return{args:n,keys:null};if(function LG(e){return e&&"object"==typeof e&&MG(e)===xG}(n)){const t=kG(n);return{args:t.map(o=>n[o]),keys:t}}}return{args:e,keys:null}}function Uj(e){return e&&cn(e.schedule)}function _U(e){return e[e.length-1]}function Vj(e){return cn(_U(e))?e.pop():void 0}function pI(e){return Uj(_U(e))?e.pop():void 0}const{isArray:UG}=Array;function gU(e){return Zt(n=>function VG(e,n){return UG(n)?e(...n):e(n)}(e,n))}function Bj(e,n){return e.reduce((t,o,c)=>(t[o]=n[c],t),{})}let jj=(()=>{class e{constructor(t,o){this._renderer=t,this._elementRef=o,this.onChange=c=>{},this.onTouched=()=>{}}setProperty(t,o){this._renderer.setProperty(this._elementRef.nativeElement,t,o)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static#e=this.\u0275fac=function(o){return new(o||e)(ae(Fs),ae(en))};static#t=this.\u0275dir=Ye({type:e})}return e})(),A_=(()=>{class e extends jj{static#e=this.\u0275fac=(()=>{let t;return function(c){return(t||(t=Ki(e)))(c||e)}})();static#t=this.\u0275dir=Ye({type:e,features:[Nt]})}return e})();const Zc=new De(""),HG={provide:Zc,useExisting:Ln(()=>nM),multi:!0},WG=new De("");let nM=(()=>{class e extends jj{constructor(t,o,c){super(t,o),this._compositionMode=c,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function GG(){const e=$c()?$c().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(t){this.setProperty("value",t??"")}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static#e=this.\u0275fac=function(o){return new(o||e)(ae(Fs),ae(en),ae(WG,8))};static#t=this.\u0275dir=Ye({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(o,c){1&o&&mn("input",function(p){return c._handleInput(p.target.value)})("blur",function(){return c.onTouched()})("compositionstart",function(){return c._compositionStart()})("compositionend",function(p){return c._compositionEnd(p.target.value)})},features:[wn([HG]),Nt]})}return e})();function Bp(e){return null==e||("string"==typeof e||Array.isArray(e))&&0===e.length}function Gj(e){return null!=e&&"number"==typeof e.length}const to=new De(""),jp=new De(""),zG=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class Wj{static min(n){return function zj(e){return n=>{if(Bp(n.value)||Bp(e))return null;const t=parseFloat(n.value);return!isNaN(t)&&t<e?{min:{min:e,actual:n.value}}:null}}(n)}static max(n){return function qj(e){return n=>{if(Bp(n.value)||Bp(e))return null;const t=parseFloat(n.value);return!isNaN(t)&&t>e?{max:{max:e,actual:n.value}}:null}}(n)}static required(n){return function Kj(e){return Bp(e.value)?{required:!0}:null}(n)}static requiredTrue(n){return function Yj(e){return!0===e.value?null:{required:!0}}(n)}static email(n){return function $j(e){return Bp(e.value)||zG.test(e.value)?null:{email:!0}}(n)}static minLength(n){return function Xj(e){return n=>Bp(n.value)||!Gj(n.value)?null:n.value.length<e?{minlength:{requiredLength:e,actualLength:n.value.length}}:null}(n)}static maxLength(n){return function Jj(e){return n=>Gj(n.value)&&n.value.length>e?{maxlength:{requiredLength:e,actualLength:n.value.length}}:null}(n)}static pattern(n){return function Qj(e){if(!e)return iM;let n,t;return"string"==typeof e?(t="","^"!==e.charAt(0)&&(t+="^"),t+=e,"$"!==e.charAt(e.length-1)&&(t+="$"),n=new RegExp(t)):(t=e.toString(),n=e),o=>{if(Bp(o.value))return null;const c=o.value;return n.test(c)?null:{pattern:{requiredPattern:t,actualValue:c}}}}(n)}static nullValidator(n){return null}static compose(n){return r4(n)}static composeAsync(n){return o4(n)}}function iM(e){return null}function Zj(e){return null!=e}function e4(e){return fp(e)?Vr(e):e}function t4(e){let n={};return e.forEach(t=>{n=null!=t?{...n,...t}:n}),0===Object.keys(n).length?null:n}function n4(e,n){return n.map(t=>t(e))}function i4(e){return e.map(n=>function qG(e){return!e.validate}(n)?n:t=>n.validate(t))}function r4(e){if(!e)return null;const n=e.filter(Zj);return 0==n.length?null:function(t){return t4(n4(t,n))}}function EU(e){return null!=e?r4(i4(e)):null}function o4(e){if(!e)return null;const n=e.filter(Zj);return 0==n.length?null:function(t){return function BG(...e){const n=Vj(e),{args:t,keys:o}=Fj(e),c=new Wn(u=>{const{length:p}=t;if(!p)return void u.complete();const m=new Array(p);let E=p,S=p;for(let w=0;w<p;w++){let P=!1;ws(t[w]).subscribe(di(u,V=>{P||(P=!0,S--),m[w]=V},()=>E--,void 0,()=>{(!E||!P)&&(S||u.next(o?Bj(o,m):m),u.complete())}))}});return n?c.pipe(gU(n)):c}(n4(t,n).map(e4)).pipe(Zt(t4))}}function vU(e){return null!=e?o4(i4(e)):null}function s4(e,n){return null===e?[n]:Array.isArray(e)?[...e,n]:[e,n]}function a4(e){return e._rawValidators}function c4(e){return e._rawAsyncValidators}function bU(e){return e?Array.isArray(e)?e:[e]:[]}function rM(e,n){return Array.isArray(e)?e.includes(n):e===n}function d4(e,n){const t=bU(n);return bU(e).forEach(c=>{rM(t,c)||t.push(c)}),t}function l4(e,n){return bU(n).filter(t=>!rM(e,t))}class u4{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=EU(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=vU(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,t){return!!this.control&&this.control.hasError(n,t)}getError(n,t){return this.control?this.control.getError(n,t):null}}class Rs extends u4{get formDirective(){return null}get path(){return null}}class Uu extends u4{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class h4{constructor(n){this._cd=n}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let p4=(()=>{class e extends h4{constructor(t){super(t)}static#e=this.\u0275fac=function(o){return new(o||e)(ae(Uu,2))};static#t=this.\u0275dir=Ye({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(o,c){2&o&&Ht("ng-untouched",c.isUntouched)("ng-touched",c.isTouched)("ng-pristine",c.isPristine)("ng-dirty",c.isDirty)("ng-valid",c.isValid)("ng-invalid",c.isInvalid)("ng-pending",c.isPending)},features:[Nt]})}return e})(),f4=(()=>{class e extends h4{constructor(t){super(t)}static#e=this.\u0275fac=function(o){return new(o||e)(ae(Rs,10))};static#t=this.\u0275dir=Ye({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(o,c){2&o&&Ht("ng-untouched",c.isUntouched)("ng-touched",c.isTouched)("ng-pristine",c.isPristine)("ng-dirty",c.isDirty)("ng-valid",c.isValid)("ng-invalid",c.isInvalid)("ng-pending",c.isPending)("ng-submitted",c.isSubmitted)},features:[Nt]})}return e})();const fI="VALID",sM="INVALID",Rb="PENDING",mI="DISABLED";function CU(e){return(aM(e)?e.validators:e)||null}function TU(e,n){return(aM(n)?n.asyncValidators:e)||null}function aM(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}function _4(e,n,t){const o=e.controls;if(!(n?Object.keys(o):o).length)throw new pe(1e3,"");if(!o[t])throw new pe(1001,"")}function g4(e,n,t){e._forEachChild((o,c)=>{if(void 0===t[c])throw new pe(1002,"")})}class cM{constructor(n,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(n),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get valid(){return this.status===fI}get invalid(){return this.status===sM}get pending(){return this.status==Rb}get disabled(){return this.status===mI}get enabled(){return this.status!==mI}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(d4(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(d4(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(l4(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(l4(n,this._rawAsyncValidators))}hasValidator(n){return rM(this._rawValidators,n)}hasAsyncValidator(n){return rM(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){this.touched=!0,this._parent&&!n.onlySelf&&this._parent.markAsTouched(n)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(n=>n.markAllAsTouched())}markAsUntouched(n={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}markAsDirty(n={}){this.pristine=!1,this._parent&&!n.onlySelf&&this._parent.markAsDirty(n)}markAsPristine(n={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}markAsPending(n={}){this.status=Rb,!1!==n.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!n.onlySelf&&this._parent.markAsPending(n)}disable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=mI,this.errors=null,this._forEachChild(o=>{o.disable({...n,onlySelf:!0})}),this._updateValue(),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...n,skipPristineCheck:t}),this._onDisabledChange.forEach(o=>o(!0))}enable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=fI,this._forEachChild(o=>{o.enable({...n,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors({...n,skipPristineCheck:t}),this._onDisabledChange.forEach(o=>o(!1))}_updateAncestors(n){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===fI||this.status===Rb)&&this._runAsyncValidator(n.emitEvent)),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(n)}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?mI:fI}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n){if(this.asyncValidator){this.status=Rb,this._hasOwnPendingAsyncValidator=!0;const t=e4(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(o=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(o,{emitEvent:n})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(n,t={}){this.errors=n,this._updateControlsErrors(!1!==t.emitEvent)}get(n){let t=n;return null==t||(Array.isArray(t)||(t=t.split(".")),0===t.length)?null:t.reduce((o,c)=>o&&o._find(c),this)}getError(n,t){const o=t?this.get(t):this;return o&&o.errors?o.errors[n]:null}hasError(n,t){return!!this.getError(n,t)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(n)}_initObservables(){this.valueChanges=new hn,this.statusChanges=new hn}_calculateStatus(){return this._allControlsDisabled()?mI:this.errors?sM:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Rb)?Rb:this._anyControlsHaveStatus(sM)?sM:fI}_anyControlsHaveStatus(n){return this._anyControls(t=>t.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n={}){this.pristine=!this._anyControlsDirty(),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}_updateTouched(n={}){this.touched=this._anyControlsTouched(),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){aM(n)&&null!=n.updateOn&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){return!n&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=function XG(e){return Array.isArray(e)?EU(e):e||null}(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=function JG(e){return Array.isArray(e)?vU(e):e||null}(this._rawAsyncValidators)}}class _I extends cM{constructor(n,t,o){super(CU(t),TU(o,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(n,t){return this.controls[n]?this.controls[n]:(this.controls[n]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(n,t,o={}){this.registerControl(n,t),this.updateValueAndValidity({emitEvent:o.emitEvent}),this._onCollectionChange()}removeControl(n,t={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(n,t,o={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],t&&this.registerControl(n,t),this.updateValueAndValidity({emitEvent:o.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,t={}){g4(this,0,n),Object.keys(n).forEach(o=>{_4(this,!0,o),this.controls[o].setValue(n[o],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){null!=n&&(Object.keys(n).forEach(o=>{const c=this.controls[o];c&&c.patchValue(n[o],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n={},t={}){this._forEachChild((o,c)=>{o.reset(n?n[c]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(n,t,o)=>(n[o]=t.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(t,o)=>!!o._syncPendingControls()||t);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(t=>{const o=this.controls[t];o&&n(o,t)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(const[t,o]of Object.entries(this.controls))if(this.contains(t)&&n(o))return!0;return!1}_reduceValue(){return this._reduceChildren({},(t,o,c)=>((o.enabled||this.disabled)&&(t[c]=o.value),t))}_reduceChildren(n,t){let o=n;return this._forEachChild((c,u)=>{o=t(o,c,u)}),o}_allControlsDisabled(){for(const n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}}class E4 extends _I{}const Ab=new De("CallSetDisabledState",{providedIn:"root",factory:()=>dM}),dM="always";function gI(e,n,t=dM){IU(e,n),n.valueAccessor.writeValue(e.value),(e.disabled||"always"===t)&&n.valueAccessor.setDisabledState?.(e.disabled),function ZG(e,n){n.valueAccessor.registerOnChange(t=>{e._pendingValue=t,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&v4(e,n)})}(e,n),function tW(e,n){const t=(o,c)=>{n.valueAccessor.writeValue(o),c&&n.viewToModelUpdate(o)};e.registerOnChange(t),n._registerOnDestroy(()=>{e._unregisterOnChange(t)})}(e,n),function eW(e,n){n.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&v4(e,n),"submit"!==e.updateOn&&e.markAsTouched()})}(e,n),function QG(e,n){if(n.valueAccessor.setDisabledState){const t=o=>{n.valueAccessor.setDisabledState(o)};e.registerOnDisabledChange(t),n._registerOnDestroy(()=>{e._unregisterOnDisabledChange(t)})}}(e,n)}function uM(e,n,t=!0){const o=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(o),n.valueAccessor.registerOnTouched(o)),pM(e,n),e&&(n._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function hM(e,n){e.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(n)})}function IU(e,n){const t=a4(e);null!==n.validator?e.setValidators(s4(t,n.validator)):"function"==typeof t&&e.setValidators([t]);const o=c4(e);null!==n.asyncValidator?e.setAsyncValidators(s4(o,n.asyncValidator)):"function"==typeof o&&e.setAsyncValidators([o]);const c=()=>e.updateValueAndValidity();hM(n._rawValidators,c),hM(n._rawAsyncValidators,c)}function pM(e,n){let t=!1;if(null!==e){if(null!==n.validator){const c=a4(e);if(Array.isArray(c)&&c.length>0){const u=c.filter(p=>p!==n.validator);u.length!==c.length&&(t=!0,e.setValidators(u))}}if(null!==n.asyncValidator){const c=c4(e);if(Array.isArray(c)&&c.length>0){const u=c.filter(p=>p!==n.asyncValidator);u.length!==c.length&&(t=!0,e.setAsyncValidators(u))}}}const o=()=>{};return hM(n._rawValidators,o),hM(n._rawAsyncValidators,o),t}function v4(e,n){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function b4(e,n){IU(e,n)}function y4(e,n){e._syncPendingControls(),n.forEach(t=>{const o=t.control;"submit"===o.updateOn&&o._pendingChange&&(t.viewToModelUpdate(o._pendingValue),o._pendingChange=!1)})}const sW={provide:Rs,useExisting:Ln(()=>fM)},EI=Promise.resolve();let fM=(()=>{class e extends Rs{constructor(t,o,c){super(),this.callSetDisabledState=c,this.submitted=!1,this._directives=new Set,this.ngSubmit=new hn,this.form=new _I({},EU(t),vU(o))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){EI.then(()=>{const o=this._findContainer(t.path);t.control=o.registerControl(t.name,t.control),gI(t.control,t,this.callSetDisabledState),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){EI.then(()=>{const o=this._findContainer(t.path);o&&o.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){EI.then(()=>{const o=this._findContainer(t.path),c=new _I({});b4(c,t),o.registerControl(t.name,c),c.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){EI.then(()=>{const o=this._findContainer(t.path);o&&o.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,o){EI.then(()=>{this.form.get(t.path).setValue(o)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submitted=!0,y4(this.form,this._directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}static#e=this.\u0275fac=function(o){return new(o||e)(ae(to,10),ae(jp,10),ae(Ab,8))};static#t=this.\u0275dir=Ye({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(o,c){1&o&&mn("submit",function(p){return c.onSubmit(p)})("reset",function(){return c.onReset()})},inputs:{options:[Xe.None,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[wn([sW]),Nt]})}return e})();function S4(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}function C4(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const vI=class extends cM{constructor(n=null,t,o){super(CU(t),TU(o,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(n),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),aM(t)&&(t.nonNullable||t.initialValueIsDefault)&&(this.defaultValue=C4(n)?n.value:n)}setValue(n,t={}){this.value=this._pendingValue=n,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(o=>o(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(n,t={}){this.setValue(n,t)}reset(n=this.defaultValue,t={}){this._applyFormState(n),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){S4(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){S4(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(n){C4(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}};Promise.resolve();let A4=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275dir=Ye({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}return e})();const DU=new De(""),mW={provide:Rs,useExisting:Ln(()=>bI)};let bI=(()=>{class e extends Rs{constructor(t,o,c){super(),this.callSetDisabledState=c,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new hn,this._setValidators(t),this._setAsyncValidators(o)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(pM(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){const o=this.form.get(t.path);return gI(o,t,this.callSetDisabledState),o.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),o}getControl(t){return this.form.get(t.path)}removeControl(t){uM(t.control||null,t,!1),function oW(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,o){this.form.get(t.path).setValue(o)}onSubmit(t){return this.submitted=!0,y4(this.form,this.directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submitted=!1}_updateDomValue(){this.directives.forEach(t=>{const o=t.control,c=this.form.get(t.path);o!==c&&(uM(o||null,t),(e=>e instanceof vI)(c)&&(gI(c,t,this.callSetDisabledState),t.control=c))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){const o=this.form.get(t.path);b4(o,t),o.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){const o=this.form.get(t.path);o&&function nW(e,n){return pM(e,n)}(o,t)&&o.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){IU(this.form,this),this._oldForm&&pM(this._oldForm,this)}_checkFormPresent(){}static#e=this.\u0275fac=function(o){return new(o||e)(ae(to,10),ae(jp,10),ae(Ab,8))};static#t=this.\u0275dir=Ye({type:e,selectors:[["","formGroup",""]],hostBindings:function(o,c){1&o&&mn("submit",function(p){return c.onSubmit(p)})("reset",function(){return c.onReset()})},inputs:{form:[Xe.None,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[wn([mW]),Nt,So]})}return e})();const EW={provide:Uu,useExisting:Ln(()=>PU)};let PU=(()=>{class e extends Uu{set isDisabled(t){}static#e=this._ngModelWarningSentOnce=!1;constructor(t,o,c,u,p){super(),this._ngModelWarningConfig=p,this._added=!1,this.name=null,this.update=new hn,this._ngModelWarningSent=!1,this._parent=t,this._setValidators(o),this._setAsyncValidators(c),this.valueAccessor=function AU(e,n){if(!n)return null;let t,o,c;return Array.isArray(n),n.forEach(u=>{u.constructor===nM?t=u:function rW(e){return Object.getPrototypeOf(e.constructor)===A_}(u)?o=u:c=u}),c||o||t||null}(0,u)}ngOnChanges(t){this._added||this._setUpControl(),function RU(e,n){if(!e.hasOwnProperty("model"))return!1;const t=e.model;return!!t.isFirstChange()||!Object.is(n,t.currentValue)}(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return function lM(e,n){return[...n.path,e]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}static#t=this.\u0275fac=function(o){return new(o||e)(ae(Rs,13),ae(to,10),ae(jp,10),ae(Zc,10),ae(DU,8))};static#n=this.\u0275dir=Ye({type:e,selectors:[["","formControlName",""]],inputs:{name:[Xe.None,"formControlName","name"],isDisabled:[Xe.None,"disabled","isDisabled"],model:[Xe.None,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[wn([EW]),Nt,So]})}return e})(),MW=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Jn({})}return e})();class W4 extends cM{constructor(n,t,o){super(CU(t),TU(o,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(n){return this.controls[this._adjustIndex(n)]}push(n,t={}){this.controls.push(n),this._registerControl(n),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(n,t,o={}){this.controls.splice(n,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:o.emitEvent})}removeAt(n,t={}){let o=this._adjustIndex(n);o<0&&(o=0),this.controls[o]&&this.controls[o]._registerOnCollectionChange(()=>{}),this.controls.splice(o,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(n,t,o={}){let c=this._adjustIndex(n);c<0&&(c=0),this.controls[c]&&this.controls[c]._registerOnCollectionChange(()=>{}),this.controls.splice(c,1),t&&(this.controls.splice(c,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:o.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,t={}){g4(this,0,n),n.forEach((o,c)=>{_4(this,!1,c),this.at(c).setValue(o,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){null!=n&&(n.forEach((o,c)=>{this.at(c)&&this.at(c).patchValue(o,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n=[],t={}){this._forEachChild((o,c)=>{o.reset(n[c],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(n=>n.getRawValue())}clear(n={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_adjustIndex(n){return n<0?n+this.length:n}_syncPendingControls(){let n=this.controls.reduce((t,o)=>!!o._syncPendingControls()||t,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){this.controls.forEach((t,o)=>{n(t,o)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(t=>t.enabled&&n(t))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_allControlsDisabled(){for(const n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}_find(n){return this.at(n)??null}}function z4(e){return!!e&&(void 0!==e.asyncValidators||void 0!==e.validators||void 0!==e.updateOn)}let FU,xW=(()=>{class e{constructor(){this.useNonNullable=!1}get nonNullable(){const t=new e;return t.useNonNullable=!0,t}group(t,o=null){const c=this._reduceControls(t);let u={};return z4(o)?u=o:null!==o&&(u.validators=o.validator,u.asyncValidators=o.asyncValidator),new _I(c,u)}record(t,o=null){const c=this._reduceControls(t);return new E4(c,o)}control(t,o,c){let u={};return this.useNonNullable?(z4(o)?u=o:(u.validators=o,u.asyncValidators=c),new vI(t,{...u,nonNullable:!0})):new vI(t,o,c)}array(t,o,c){const u=t.map(p=>this._createControl(p));return new W4(u,o,c)}_reduceControls(t){const o={};return Object.keys(t).forEach(c=>{o[c]=this._createControl(t[c])}),o}_createControl(t){return t instanceof vI||t instanceof cM?t:Array.isArray(t)?this.control(t[0],t.length>1?t[1]:null,t.length>2?t[2]:null):this.control(t)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),kW=(()=>{class e extends xW{group(t,o=null){return super.group(t,o)}control(t,o,c){return super.control(t,o,c)}array(t,o,c){return super.array(t,o,c)}static#e=this.\u0275fac=(()=>{let t;return function(c){return(t||(t=Ki(e)))(c||e)}})();static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),LW=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:DU,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:Ab,useValue:t.callSetDisabledState??dM}]}}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Jn({imports:[MW]})}return e})();try{FU=typeof Intl<"u"&&Intl.v8BreakIterator}catch{FU=!1}let Db,mo=(()=>{class e{constructor(t){this._platformId=t,this.isBrowser=this._platformId?zP(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!FU)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}static#e=this.\u0275fac=function(o){return new(o||e)(be(Ma))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const q4=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function K4(){if(Db)return Db;if("object"!=typeof document||!document)return Db=new Set(q4),Db;let e=document.createElement("input");return Db=new Set(q4.filter(n=>(e.setAttribute("type",n),e.type===n))),Db}let yI,O_,UU;function Ob(e){return function FW(){if(null==yI&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>yI=!0}))}finally{yI=yI||!1}return yI}()?e:!!e.capture}function UW(){if(null==O_){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return O_=!1,O_;if("scrollBehavior"in document.documentElement.style)O_=!0;else{const e=Element.prototype.scrollTo;O_=!!e&&!/\{\s*\[native code\]\s*\}/.test(e.toString())}}return O_}function Hp(e){return e.composedPath?e.composedPath()[0]:e.target}function VU(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function vt(...e){return Vr(e,pI(e))}function Ea(e,n){return Si((t,o)=>{let c=0;t.subscribe(di(o,u=>e.call(n,u,c++)&&o.next(u)))})}function Y4(e){return Ea((n,t)=>e<=t)}function $W(e,n){return e===n}function Go(e){return Si((n,t)=>{ws(e).subscribe(di(t,()=>t.complete(),ef)),!t.closed&&n.subscribe(t)})}let XW=(()=>{class e{create(t){return typeof MutationObserver>"u"?null:new MutationObserver(t)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),$4=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Jn({providers:[XW]})}return e})();function Nb(e){return null!=e&&"false"!=`${e}`}function X4(e,n=0){return function JW(e){return!isNaN(parseFloat(e))&&!isNaN(Number(e))}(e)?Number(e):n}function _M(e){return Array.isArray(e)?e:[e]}function Tr(e){return null==e?"":"string"==typeof e?e:`${e}px`}function Gp(e){return e instanceof en?e.nativeElement:e}function gM(...e){const n=pI(e),t=Vj(e),{args:o,keys:c}=Fj(e);if(0===o.length)return Vr([],n);const u=new Wn(function QW(e,n,t=cd){return o=>{J4(n,()=>{const{length:c}=e,u=new Array(c);let p=c,m=c;for(let E=0;E<c;E++)J4(n,()=>{const S=Vr(e[E],n);let w=!1;S.subscribe(di(o,P=>{u[E]=P,w||(w=!0,m--),m||o.next(t(u.slice()))},()=>{--p||o.complete()}))},o)},o)}}(o,n,c?p=>Bj(c,p):cd));return t?u.pipe(gU(t)):u}function J4(e,n,t){e?Fu(t,e,n):n()}function _o(e,n,t=1/0){return cn(n)?_o((o,c)=>Zt((u,p)=>n(o,u,c,p))(ws(e(o,c))),t):("number"==typeof n&&(t=n),Si((o,c)=>function ZW(e,n,t,o,c,u,p,m){const E=[];let S=0,w=0,P=!1;const V=()=>{P&&!E.length&&!S&&n.complete()},H=J=>S<o?z(J):E.push(J),z=J=>{u&&n.next(J),S++;let ce=!1;ws(t(J,w++)).subscribe(di(n,he=>{c?.(he),u?H(he):n.next(he)},()=>{ce=!0},void 0,()=>{if(ce)try{for(S--;E.length&&S<o;){const he=E.shift();p?Fu(n,p,()=>z(he)):z(he)}V()}catch(he){n.error(he)}}))};return e.subscribe(di(n,H,()=>{P=!0,V()})),()=>{m?.()}}(o,c,e,t)))}function Pb(e=1/0){return _o(cd,e)}function EM(...e){return function e9(){return Pb(1)}()(Vr(e,pI(e)))}const ed=new Wn(e=>e.complete());function Vu(e){return e<=0?()=>ed:Si((n,t)=>{let o=0;n.subscribe(di(t,c=>{++o<=e&&(t.next(c),e<=o&&t.complete())}))})}class n9 extends nr{constructor(n,t){super()}schedule(n,t=0){return this}}const vM={setInterval(e,n,...t){const{delegate:o}=vM;return o?.setInterval?o.setInterval(e,n,...t):setInterval(e,n,...t)},clearInterval(e){const{delegate:n}=vM;return(n?.clearInterval||clearInterval)(e)},delegate:void 0};class BU extends n9{constructor(n,t){super(n,t),this.scheduler=n,this.work=t,this.pending=!1}schedule(n,t=0){var o;if(this.closed)return this;this.state=n;const c=this.id,u=this.scheduler;return null!=c&&(this.id=this.recycleAsyncId(u,c,t)),this.pending=!0,this.delay=t,this.id=null!==(o=this.id)&&void 0!==o?o:this.requestAsyncId(u,this.id,t),this}requestAsyncId(n,t,o=0){return vM.setInterval(n.flush.bind(n,this),o)}recycleAsyncId(n,t,o=0){if(null!=o&&this.delay===o&&!1===this.pending)return t;null!=t&&vM.clearInterval(t)}execute(n,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const o=this._execute(n,t);if(o)return o;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,t){let c,o=!1;try{this.work(n)}catch(u){o=!0,c=u||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),c}unsubscribe(){if(!this.closed){const{id:n,scheduler:t}=this,{actions:o}=t;this.work=this.state=this.scheduler=null,this.pending=!1,J_(o,this),null!=n&&(this.id=this.recycleAsyncId(t,n,null)),this.delay=null,super.unsubscribe()}}}const jU={now:()=>(jU.delegate||Date).now(),delegate:void 0};class CI{constructor(n,t=CI.now){this.schedulerActionCtor=n,this.now=t}schedule(n,t=0,o){return new this.schedulerActionCtor(this,n).schedule(o,t)}}CI.now=jU.now;class HU extends CI{constructor(n,t=CI.now){super(n,t),this.actions=[],this._active=!1}flush(n){const{actions:t}=this;if(this._active)return void t.push(n);let o;this._active=!0;do{if(o=n.execute(n.state,n.delay))break}while(n=t.shift());if(this._active=!1,o){for(;n=t.shift();)n.unsubscribe();throw o}}}const GU=new HU(BU),i9=GU;function Q4(...e){const n=pI(e);return Si((t,o)=>{(n?EM(e,t,n):EM(e,t)).subscribe(o)})}const Z4=new Set;let N_,o9=(()=>{class e{constructor(t,o){this._platform=t,this._nonce=o,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):a9}matchMedia(t){return(this._platform.WEBKIT||this._platform.BLINK)&&function s9(e,n){if(!Z4.has(e))try{N_||(N_=document.createElement("style"),n&&(N_.nonce=n),N_.setAttribute("type","text/css"),document.head.appendChild(N_)),N_.sheet&&(N_.sheet.insertRule(`@media ${e} {body{ }}`,0),Z4.add(e))}catch(t){console.error(t)}}(t,this._nonce),this._matchMedia(t)}static#e=this.\u0275fac=function(o){return new(o||e)(be(mo),be(yS,8))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function a9(e){return{matches:"all"===e||""===e,media:e,addListener:()=>{},removeListener:()=>{}}}let c9=(()=>{class e{constructor(t,o){this._mediaMatcher=t,this._zone=o,this._queries=new Map,this._destroySubject=new bn}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(t){return e5(_M(t)).some(c=>this._registerQuery(c).mql.matches)}observe(t){let u=gM(e5(_M(t)).map(p=>this._registerQuery(p).observable));return u=EM(u.pipe(Vu(1)),u.pipe(Y4(1),function r9(e,n=GU){return Si((t,o)=>{let c=null,u=null,p=null;const m=()=>{if(c){c.unsubscribe(),c=null;const S=u;u=null,o.next(S)}};function E(){const S=p+e,w=n.now();if(w<S)return c=this.schedule(void 0,S-w),void o.add(c);m()}t.subscribe(di(o,S=>{u=S,p=n.now(),c||(c=n.schedule(E,e),o.add(c))},()=>{m(),o.complete()},void 0,()=>{u=c=null}))})}(0))),u.pipe(Zt(p=>{const m={matches:!1,breakpoints:{}};return p.forEach(({matches:E,query:S})=>{m.matches=m.matches||E,m.breakpoints[S]=E}),m}))}_registerQuery(t){if(this._queries.has(t))return this._queries.get(t);const o=this._mediaMatcher.matchMedia(t),u={observable:new Wn(p=>{const m=E=>this._zone.run(()=>p.next(E));return o.addListener(m),()=>{o.removeListener(m)}}).pipe(Q4(o),Zt(({matches:p})=>({query:t,matches:p})),Go(this._destroySubject)),mql:o};return this._queries.set(t,u),u}static#e=this.\u0275fac=function(o){return new(o||e)(be(o9),be(it))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function e5(e){return e.map(n=>n.split(",")).reduce((n,t)=>n.concat(t)).map(n=>n.trim())}function bM(e,n){return e.getAttribute(n)?.match(/\S+/g)??[]}const n5="cdk-describedby-message",yM="cdk-describedby-host";let WU=0,u9=(()=>{class e{constructor(t,o){this._platform=o,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+WU++,this._document=t,this._id=Te(Bf)+"-"+WU++}describe(t,o,c){if(!this._canBeDescribed(t,o))return;const u=zU(o,c);"string"!=typeof o?(r5(o,this._id),this._messageRegistry.set(u,{messageElement:o,referenceCount:0})):this._messageRegistry.has(u)||this._createMessageElement(o,c),this._isElementDescribedByMessage(t,u)||this._addMessageReference(t,u)}removeDescription(t,o,c){if(!o||!this._isElementNode(t))return;const u=zU(o,c);if(this._isElementDescribedByMessage(t,u)&&this._removeMessageReference(t,u),"string"==typeof o){const p=this._messageRegistry.get(u);p&&0===p.referenceCount&&this._deleteMessageElement(u)}0===this._messagesContainer?.childNodes.length&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){const t=this._document.querySelectorAll(`[${yM}="${this._id}"]`);for(let o=0;o<t.length;o++)this._removeCdkDescribedByReferenceIds(t[o]),t[o].removeAttribute(yM);this._messagesContainer?.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(t,o){const c=this._document.createElement("div");r5(c,this._id),c.textContent=t,o&&c.setAttribute("role",o),this._createMessagesContainer(),this._messagesContainer.appendChild(c),this._messageRegistry.set(zU(t,o),{messageElement:c,referenceCount:0})}_deleteMessageElement(t){this._messageRegistry.get(t)?.messageElement?.remove(),this._messageRegistry.delete(t)}_createMessagesContainer(){if(this._messagesContainer)return;const t="cdk-describedby-message-container",o=this._document.querySelectorAll(`.${t}[platform="server"]`);for(let u=0;u<o.length;u++)o[u].remove();const c=this._document.createElement("div");c.style.visibility="hidden",c.classList.add(t),c.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&c.setAttribute("platform","server"),this._document.body.appendChild(c),this._messagesContainer=c}_removeCdkDescribedByReferenceIds(t){const o=bM(t,"aria-describedby").filter(c=>0!=c.indexOf(n5));t.setAttribute("aria-describedby",o.join(" "))}_addMessageReference(t,o){const c=this._messageRegistry.get(o);(function d9(e,n,t){const o=bM(e,n);t=t.trim(),!o.some(c=>c.trim()===t)&&(o.push(t),e.setAttribute(n,o.join(" ")))})(t,"aria-describedby",c.messageElement.id),t.setAttribute(yM,this._id),c.referenceCount++}_removeMessageReference(t,o){const c=this._messageRegistry.get(o);c.referenceCount--,function l9(e,n,t){const o=bM(e,n);t=t.trim();const c=o.filter(u=>u!==t);c.length?e.setAttribute(n,c.join(" ")):e.removeAttribute(n)}(t,"aria-describedby",c.messageElement.id),t.removeAttribute(yM)}_isElementDescribedByMessage(t,o){const c=bM(t,"aria-describedby"),u=this._messageRegistry.get(o),p=u&&u.messageElement.id;return!!p&&-1!=c.indexOf(p)}_canBeDescribed(t,o){if(!this._isElementNode(t))return!1;if(o&&"object"==typeof o)return!0;const c=null==o?"":`${o}`.trim(),u=t.getAttribute("aria-label");return!(!c||u&&u.trim()===c)}_isElementNode(t){return t.nodeType===this._document.ELEMENT_NODE}static#e=this.\u0275fac=function(o){return new(o||e)(be(on),be(mo))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function zU(e,n){return"string"==typeof e?`${n||""}/${e}`:e}function r5(e,n){e.id||(e.id=`${n5}-${n}-${WU++}`)}function s5(e){return 0===e.buttons||0===e.detail}function a5(e){const n=e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0];return!(!n||-1!==n.identifier||null!=n.radiusX&&1!==n.radiusX||null!=n.radiusY&&1!==n.radiusY)}const g9=new De("cdk-input-modality-detector-options"),E9={ignoreKeys:[18,17,224,91,16]},Mb=Ob({passive:!0,capture:!0});let v9=(()=>{class e{get mostRecentModality(){return this._modality.value}constructor(t,o,c,u){this._platform=t,this._mostRecentTarget=null,this._modality=new Yo(null),this._lastTouchMs=0,this._onKeydown=p=>{this._options?.ignoreKeys?.some(m=>m===p.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Hp(p))},this._onMousedown=p=>{Date.now()-this._lastTouchMs<650||(this._modality.next(s5(p)?"keyboard":"mouse"),this._mostRecentTarget=Hp(p))},this._onTouchstart=p=>{a5(p)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Hp(p))},this._options={...E9,...u},this.modalityDetected=this._modality.pipe(Y4(1)),this.modalityChanged=this.modalityDetected.pipe(function YW(e,n=cd){return e=e??$W,Si((t,o)=>{let c,u=!0;t.subscribe(di(o,p=>{const m=n(p);(u||!e(c,m))&&(u=!1,c=m,o.next(p))}))})}()),t.isBrowser&&o.runOutsideAngular(()=>{c.addEventListener("keydown",this._onKeydown,Mb),c.addEventListener("mousedown",this._onMousedown,Mb),c.addEventListener("touchstart",this._onTouchstart,Mb)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Mb),document.removeEventListener("mousedown",this._onMousedown,Mb),document.removeEventListener("touchstart",this._onTouchstart,Mb))}static#e=this.\u0275fac=function(o){return new(o||e)(be(mo),be(it),be(on),be(g9,8))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var SM=function(e){return e[e.IMMEDIATE=0]="IMMEDIATE",e[e.EVENTUAL=1]="EVENTUAL",e}(SM||{});const y9=new De("cdk-focus-monitor-default-options"),CM=Ob({passive:!0,capture:!0});let qU=(()=>{class e{constructor(t,o,c,u,p){this._ngZone=t,this._platform=o,this._inputModalityDetector=c,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new bn,this._rootNodeFocusAndBlurListener=m=>{for(let S=Hp(m);S;S=S.parentElement)"focus"===m.type?this._onFocus(m,S):this._onBlur(m,S)},this._document=u,this._detectionMode=p?.detectionMode||SM.IMMEDIATE}monitor(t,o=!1){const c=Gp(t);if(!this._platform.isBrowser||1!==c.nodeType)return vt();const u=function BW(e){if(function VW(){if(null==UU){const e=typeof document<"u"?document.head:null;UU=!(!e||!e.createShadowRoot&&!e.attachShadow)}return UU}()){const n=e.getRootNode?e.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&n instanceof ShadowRoot)return n}return null}(c)||this._getDocument(),p=this._elementInfo.get(c);if(p)return o&&(p.checkChildren=!0),p.subject;const m={checkChildren:o,subject:new bn,rootNode:u};return this._elementInfo.set(c,m),this._registerGlobalListeners(m),m.subject}stopMonitoring(t){const o=Gp(t),c=this._elementInfo.get(o);c&&(c.subject.complete(),this._setClasses(o),this._elementInfo.delete(o),this._removeGlobalListeners(c))}focusVia(t,o,c){const u=Gp(t);u===this._getDocument().activeElement?this._getClosestElementsInfo(u).forEach(([m,E])=>this._originChanged(m,o,E)):(this._setOrigin(o),"function"==typeof u.focus&&u.focus(c))}ngOnDestroy(){this._elementInfo.forEach((t,o)=>this.stopMonitoring(o))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(t){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(t)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:t&&this._isLastInteractionFromInputLabel(t)?"mouse":"program"}_shouldBeAttributedToTouch(t){return this._detectionMode===SM.EVENTUAL||!!t?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(t,o){t.classList.toggle("cdk-focused",!!o),t.classList.toggle("cdk-touch-focused","touch"===o),t.classList.toggle("cdk-keyboard-focused","keyboard"===o),t.classList.toggle("cdk-mouse-focused","mouse"===o),t.classList.toggle("cdk-program-focused","program"===o)}_setOrigin(t,o=!1){this._ngZone.runOutsideAngular(()=>{this._origin=t,this._originFromTouchInteraction="touch"===t&&o,this._detectionMode===SM.IMMEDIATE&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(t,o){const c=this._elementInfo.get(o),u=Hp(t);!c||!c.checkChildren&&o!==u||this._originChanged(o,this._getFocusOrigin(u),c)}_onBlur(t,o){const c=this._elementInfo.get(o);!c||c.checkChildren&&t.relatedTarget instanceof Node&&o.contains(t.relatedTarget)||(this._setClasses(o),this._emitOrigin(c,null))}_emitOrigin(t,o){t.subject.observers.length&&this._ngZone.run(()=>t.subject.next(o))}_registerGlobalListeners(t){if(!this._platform.isBrowser)return;const o=t.rootNode,c=this._rootNodeFocusListenerCount.get(o)||0;c||this._ngZone.runOutsideAngular(()=>{o.addEventListener("focus",this._rootNodeFocusAndBlurListener,CM),o.addEventListener("blur",this._rootNodeFocusAndBlurListener,CM)}),this._rootNodeFocusListenerCount.set(o,c+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Go(this._stopInputModalityDetector)).subscribe(u=>{this._setOrigin(u,!0)}))}_removeGlobalListeners(t){const o=t.rootNode;if(this._rootNodeFocusListenerCount.has(o)){const c=this._rootNodeFocusListenerCount.get(o);c>1?this._rootNodeFocusListenerCount.set(o,c-1):(o.removeEventListener("focus",this._rootNodeFocusAndBlurListener,CM),o.removeEventListener("blur",this._rootNodeFocusAndBlurListener,CM),this._rootNodeFocusListenerCount.delete(o))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(t,o,c){this._setClasses(t,o),this._emitOrigin(c,o),this._lastFocusOrigin=o}_getClosestElementsInfo(t){const o=[];return this._elementInfo.forEach((c,u)=>{(u===t||c.checkChildren&&u.contains(t))&&o.push([u,c])}),o}_isLastInteractionFromInputLabel(t){const{_mostRecentTarget:o,mostRecentModality:c}=this._inputModalityDetector;if("mouse"!==c||!o||o===t||"INPUT"!==t.nodeName&&"TEXTAREA"!==t.nodeName||t.disabled)return!1;const u=t.labels;if(u)for(let p=0;p<u.length;p++)if(u[p].contains(o))return!0;return!1}static#e=this.\u0275fac=function(o){return new(o||e)(be(it),be(mo),be(v9),be(on,8),be(y9,8))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var P_=function(e){return e[e.NONE=0]="NONE",e[e.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",e[e.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",e}(P_||{});const d5="cdk-high-contrast-black-on-white",l5="cdk-high-contrast-white-on-black",KU="cdk-high-contrast-active";let u5=(()=>{class e{constructor(t,o){this._platform=t,this._document=o,this._breakpointSubscription=Te(c9).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return P_.NONE;const t=this._document.createElement("div");t.style.backgroundColor="rgb(1,2,3)",t.style.position="absolute",this._document.body.appendChild(t);const o=this._document.defaultView||window,c=o&&o.getComputedStyle?o.getComputedStyle(t):null,u=(c&&c.backgroundColor||"").replace(/ /g,"");switch(t.remove(),u){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return P_.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return P_.BLACK_ON_WHITE}return P_.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const t=this._document.body.classList;t.remove(KU,d5,l5),this._hasCheckedHighContrastMode=!0;const o=this.getHighContrastMode();o===P_.BLACK_ON_WHITE?t.add(KU,d5):o===P_.WHITE_ON_BLACK&&t.add(KU,l5)}}static#e=this.\u0275fac=function(o){return new(o||e)(be(mo),be(on))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),S9=(()=>{class e{constructor(t){t._applyBodyHighContrastModeCssClasses()}static#e=this.\u0275fac=function(o){return new(o||e)(be(u5))};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Jn({imports:[$4]})}return e})();const C9=new De("cdk-dir-doc",{providedIn:"root",factory:function T9(){return Te(on)}}),I9=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let YU=(()=>{class e{constructor(t){this.value="ltr",this.change=new hn,t&&(this.value=function w9(e){const n=e?.toLowerCase()||"";return"auto"===n&&typeof navigator<"u"&&navigator?.language?I9.test(navigator.language)?"rtl":"ltr":"rtl"===n?"rtl":"ltr"}((t.body?t.body.dir:null)||(t.documentElement?t.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}static#e=this.\u0275fac=function(o){return new(o||e)(be(C9,8))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),TI=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Jn({})}return e})();const R9=["mat-internal-form-field",""],A9=["*"],O9=new De("mat-sanity-checks",{providedIn:"root",factory:function D9(){return!0}});let nc=(()=>{class e{constructor(t,o,c){this._sanityChecks=o,this._document=c,this._hasDoneGlobalChecks=!1,t._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(t){return!VU()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[t])}static#e=this.\u0275fac=function(o){return new(o||e)(be(u5),be(O9,8),be(on))};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Jn({imports:[TI,TI]})}return e})();class f5{constructor(n,t,o,c,u){this._defaultMatcher=n,this.ngControl=t,this._parentFormGroup=o,this._parentForm=c,this._stateChanges=u,this.errorState=!1}updateErrorState(){const n=this.errorState,t=this._parentFormGroup||this._parentForm,o=this.matcher||this._defaultMatcher,c=this.ngControl?this.ngControl.control:null,u=o?.isErrorState(c,t)??!1;u!==n&&(this.errorState=u,this._stateChanges.next())}}let L9=(()=>{class e{isErrorState(t,o){return!!(t&&t.invalid&&(t.touched||o&&o.submitted))}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var ic=function(e){return e[e.FADING_IN=0]="FADING_IN",e[e.VISIBLE=1]="VISIBLE",e[e.FADING_OUT=2]="FADING_OUT",e[e.HIDDEN=3]="HIDDEN",e}(ic||{});class F9{constructor(n,t,o,c=!1){this._renderer=n,this.element=t,this.config=o,this._animationForciblyDisabledThroughCss=c,this.state=ic.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}}const m5=Ob({passive:!0,capture:!0});class U9{constructor(){this._events=new Map,this._delegateEventHandler=n=>{const t=Hp(n);t&&this._events.get(n.type)?.forEach((o,c)=>{(c===t||c.contains(t))&&o.forEach(u=>u.handleEvent(n))})}}addHandler(n,t,o,c){const u=this._events.get(t);if(u){const p=u.get(o);p?p.add(c):u.set(o,new Set([c]))}else this._events.set(t,new Map([[o,new Set([c])]])),n.runOutsideAngular(()=>{document.addEventListener(t,this._delegateEventHandler,m5)})}removeHandler(n,t,o){const c=this._events.get(n);if(!c)return;const u=c.get(t);u&&(u.delete(o),0===u.size&&c.delete(t),0===c.size&&(this._events.delete(n),document.removeEventListener(n,this._delegateEventHandler,m5)))}}const _5={enterDuration:225,exitDuration:150},g5=Ob({passive:!0,capture:!0}),E5=["mousedown","touchstart"],v5=["mouseup","mouseleave","touchend","touchcancel"];class TM{static#e=this._eventManager=new U9;constructor(n,t,o,c){this._target=n,this._ngZone=t,this._platform=c,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,c.isBrowser&&(this._containerElement=Gp(o))}fadeInRipple(n,t,o={}){const c=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),u={..._5,...o.animation};o.centered&&(n=c.left+c.width/2,t=c.top+c.height/2);const p=o.radius||function B9(e,n,t){const o=Math.max(Math.abs(e-t.left),Math.abs(e-t.right)),c=Math.max(Math.abs(n-t.top),Math.abs(n-t.bottom));return Math.sqrt(o*o+c*c)}(n,t,c),m=n-c.left,E=t-c.top,S=u.enterDuration,w=document.createElement("div");w.classList.add("mat-ripple-element"),w.style.left=m-p+"px",w.style.top=E-p+"px",w.style.height=2*p+"px",w.style.width=2*p+"px",null!=o.color&&(w.style.backgroundColor=o.color),w.style.transitionDuration=`${S}ms`,this._containerElement.appendChild(w);const P=window.getComputedStyle(w),H=P.transitionDuration,z="none"===P.transitionProperty||"0s"===H||"0s, 0s"===H||0===c.width&&0===c.height,J=new F9(this,w,o,z);w.style.transform="scale3d(1, 1, 1)",J.state=ic.FADING_IN,o.persistent||(this._mostRecentTransientRipple=J);let ce=null;return!z&&(S||u.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const he=()=>this._finishRippleTransition(J),le=()=>this._destroyRipple(J);w.addEventListener("transitionend",he),w.addEventListener("transitioncancel",le),ce={onTransitionEnd:he,onTransitionCancel:le}}),this._activeRipples.set(J,ce),(z||!S)&&this._finishRippleTransition(J),J}fadeOutRipple(n){if(n.state===ic.FADING_OUT||n.state===ic.HIDDEN)return;const t=n.element,o={..._5,...n.config.animation};t.style.transitionDuration=`${o.exitDuration}ms`,t.style.opacity="0",n.state=ic.FADING_OUT,(n._animationForciblyDisabledThroughCss||!o.exitDuration)&&this._finishRippleTransition(n)}fadeOutAll(){this._getActiveRipples().forEach(n=>n.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(n=>{n.config.persistent||n.fadeOut()})}setupTriggerEvents(n){const t=Gp(n);!this._platform.isBrowser||!t||t===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=t,E5.forEach(o=>{TM._eventManager.addHandler(this._ngZone,o,t,this)}))}handleEvent(n){"mousedown"===n.type?this._onMousedown(n):"touchstart"===n.type?this._onTouchStart(n):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{v5.forEach(t=>{this._triggerElement.addEventListener(t,this,g5)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(n){n.state===ic.FADING_IN?this._startFadeOutTransition(n):n.state===ic.FADING_OUT&&this._destroyRipple(n)}_startFadeOutTransition(n){const t=n===this._mostRecentTransientRipple,{persistent:o}=n.config;n.state=ic.VISIBLE,!o&&(!t||!this._isPointerDown)&&n.fadeOut()}_destroyRipple(n){const t=this._activeRipples.get(n)??null;this._activeRipples.delete(n),this._activeRipples.size||(this._containerRect=null),n===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),n.state=ic.HIDDEN,null!==t&&(n.element.removeEventListener("transitionend",t.onTransitionEnd),n.element.removeEventListener("transitioncancel",t.onTransitionCancel)),n.element.remove()}_onMousedown(n){const t=s5(n),o=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!t&&!o&&(this._isPointerDown=!0,this.fadeInRipple(n.clientX,n.clientY,this._target.rippleConfig))}_onTouchStart(n){if(!this._target.rippleDisabled&&!a5(n)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const t=n.changedTouches;if(t)for(let o=0;o<t.length;o++)this.fadeInRipple(t[o].clientX,t[o].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(n=>{!n.config.persistent&&(n.state===ic.VISIBLE||n.config.terminateOnPointerUp&&n.state===ic.FADING_IN)&&n.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const n=this._triggerElement;n&&(E5.forEach(t=>TM._eventManager.removeHandler(t,n,this)),this._pointerUpEventsRegistered&&v5.forEach(t=>n.removeEventListener(t,this,g5)))}}const b5=new De("mat-ripple-global-options");let y5=(()=>{class e{get disabled(){return this._disabled}set disabled(t){t&&this.fadeOutAllNonPersistent(),this._disabled=t,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(t){this._trigger=t,this._setupTriggerEventsIfEnabled()}constructor(t,o,c,u,p){this._elementRef=t,this._animationMode=p,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=u||{},this._rippleRenderer=new TM(this,o,t,c)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:{...this._globalOptions.animation,..."NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{},...this.animation},terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(t,o=0,c){return"number"==typeof t?this._rippleRenderer.fadeInRipple(t,o,{...this.rippleConfig,...c}):this._rippleRenderer.fadeInRipple(0,0,{...this.rippleConfig,...t})}static#e=this.\u0275fac=function(o){return new(o||e)(ae(en),ae(it),ae(mo),ae(b5,8),ae(yc,8))};static#t=this.\u0275dir=Ye({type:e,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(o,c){2&o&&Ht("mat-ripple-unbounded",c.unbounded)},inputs:{color:[Xe.None,"matRippleColor","color"],unbounded:[Xe.None,"matRippleUnbounded","unbounded"],centered:[Xe.None,"matRippleCentered","centered"],radius:[Xe.None,"matRippleRadius","radius"],animation:[Xe.None,"matRippleAnimation","animation"],disabled:[Xe.None,"matRippleDisabled","disabled"],trigger:[Xe.None,"matRippleTrigger","trigger"]},exportAs:["matRipple"],standalone:!0})}return e})(),j9=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Jn({imports:[nc,nc]})}return e})();const S5={capture:!0},C5=["focus","click","mouseenter","touchstart"],$U="mat-ripple-loader-uninitialized",XU="mat-ripple-loader-class-name",T5="mat-ripple-loader-centered",IM="mat-ripple-loader-disabled";let H9=(()=>{class e{constructor(){this._document=Te(on,{optional:!0}),this._animationMode=Te(yc,{optional:!0}),this._globalRippleOptions=Te(b5,{optional:!0}),this._platform=Te(mo),this._ngZone=Te(it),this._hosts=new Map,this._onInteraction=t=>{if(!(t.target instanceof HTMLElement))return;const c=t.target.closest(`[${$U}]`);c&&this._createRipple(c)},this._ngZone.runOutsideAngular(()=>{for(const t of C5)this._document?.addEventListener(t,this._onInteraction,S5)})}ngOnDestroy(){const t=this._hosts.keys();for(const o of t)this.destroyRipple(o);for(const o of C5)this._document?.removeEventListener(o,this._onInteraction,S5)}configureRipple(t,o){t.setAttribute($U,""),(o.className||!t.hasAttribute(XU))&&t.setAttribute(XU,o.className||""),o.centered&&t.setAttribute(T5,""),o.disabled&&t.setAttribute(IM,"")}getRipple(t){return this._hosts.get(t)||this._createRipple(t)}setDisabled(t,o){const c=this._hosts.get(t);c?c.disabled=o:o?t.setAttribute(IM,""):t.removeAttribute(IM)}_createRipple(t){if(!this._document)return;const o=this._hosts.get(t);if(o)return o;t.querySelector(".mat-ripple")?.remove();const c=this._document.createElement("span");c.classList.add("mat-ripple",t.getAttribute(XU)),t.append(c);const u=new y5(new en(c),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return u._isInitialized=!0,u.trigger=t,u.centered=t.hasAttribute(T5),u.disabled=t.hasAttribute(IM),this.attachRipple(t,u),u}attachRipple(t,o){t.removeAttribute($U),this._hosts.set(t,o)}destroyRipple(t){const o=this._hosts.get(t);o&&(o.ngOnDestroy(),this._hosts.delete(t))}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),G9=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275cmp=Br({type:e,selectors:[["div","mat-internal-form-field",""]],hostAttrs:[1,"mdc-form-field","mat-internal-form-field"],hostVars:2,hostBindings:function(o,c){2&o&&Ht("mdc-form-field--align-end","before"===c.labelPosition)},inputs:{labelPosition:"labelPosition"},standalone:!0,features:[Gc],attrs:R9,ngContentSelectors:A9,decls:1,vars:0,template:function(o,c){1&o&&(Po(),xi(0))},styles:[".mdc-form-field{display:inline-flex;align-items:center;vertical-align:middle}.mdc-form-field[hidden]{display:none}.mdc-form-field>label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0;order:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{margin-left:auto;margin-right:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{padding-left:0;padding-right:4px}.mdc-form-field--nowrap>label{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.mdc-form-field--align-end>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px;order:-1}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{margin-left:0;margin-right:auto}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{padding-left:4px;padding-right:0}.mdc-form-field--space-between{justify-content:space-between}.mdc-form-field--space-between>label{margin:0}[dir=rtl] .mdc-form-field--space-between>label,.mdc-form-field--space-between>label[dir=rtl]{margin:0}.mdc-form-field{font-family:var(--mdc-form-field-label-text-font);line-height:var(--mdc-form-field-label-text-line-height);font-size:var(--mdc-form-field-label-text-size);font-weight:var(--mdc-form-field-label-text-weight);letter-spacing:var(--mdc-form-field-label-text-tracking);color:var(--mdc-form-field-label-text-color)}.mat-internal-form-field{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}"],encapsulation:2,changeDetection:0})}return e})();const W9=["mat-button",""],z9=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],q9=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"],K9=new De("MAT_BUTTON_CONFIG"),Y9=[{attribute:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{attribute:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{attribute:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{attribute:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{attribute:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{attribute:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{attribute:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}];let $9=(()=>{class e{get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(t){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,t)}get disableRipple(){return this._disableRipple}set disableRipple(t){this._disableRipple=t,this._updateRippleDisabled()}get disabled(){return this._disabled}set disabled(t){this._disabled=t,this._updateRippleDisabled()}constructor(t,o,c,u){this._elementRef=t,this._platform=o,this._ngZone=c,this._animationMode=u,this._focusMonitor=Te(qU),this._rippleLoader=Te(H9),this._isFab=!1,this._disableRipple=!1,this._disabled=!1;const p=Te(K9,{optional:!0}),m=t.nativeElement,E=m.classList;this.disabledInteractive=p?.disabledInteractive??!1,this._rippleLoader?.configureRipple(m,{className:"mat-mdc-button-ripple"});for(const{attribute:S,mdcClasses:w}of Y9)m.hasAttribute(S)&&E.add(...w)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(t="program",o){t?this._focusMonitor.focusVia(this._elementRef.nativeElement,t,o):this._elementRef.nativeElement.focus(o)}_getAriaDisabled(){return null!=this.ariaDisabled?this.ariaDisabled:!(!this.disabled||!this.disabledInteractive)||null}_getDisabledAttribute(){return!(this.disabledInteractive||!this.disabled)||null}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}static#e=this.\u0275fac=function(o){Fh()};static#t=this.\u0275dir=Ye({type:e,inputs:{color:"color",disableRipple:[Xe.HasDecoratorInputTransform,"disableRipple","disableRipple",uo],disabled:[Xe.HasDecoratorInputTransform,"disabled","disabled",uo],ariaDisabled:[Xe.HasDecoratorInputTransform,"aria-disabled","ariaDisabled",uo],disabledInteractive:[Xe.HasDecoratorInputTransform,"disabledInteractive","disabledInteractive",uo]},features:[Pi]})}return e})(),X9=(()=>{class e extends $9{constructor(t,o,c,u){super(t,o,c,u)}static#e=this.\u0275fac=function(o){return new(o||e)(ae(en),ae(mo),ae(it),ae(yc,8))};static#t=this.\u0275cmp=Br({type:e,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:14,hostBindings:function(o,c){2&o&&(Xi("disabled",c._getDisabledAttribute())("aria-disabled",c._getAriaDisabled()),Tm(c.color?"mat-"+c.color:""),Ht("mat-mdc-button-disabled",c.disabled)("mat-mdc-button-disabled-interactive",c.disabledInteractive)("_mat-animation-noopable","NoopAnimations"===c._animationMode)("mat-unthemed",!c.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[Nt,Gc],attrs:W9,ngContentSelectors:q9,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(o,c){1&o&&(Po(z9),de(0,"span",0),xi(1),oe(2,"span",1),xi(3,1),Ee(),xi(4,2),de(5,"span",2)(6,"span",3)),2&o&&Ht("mdc-button__ripple",!c._isFab)("mdc-fab__ripple",c._isFab)},styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px);display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{font-family:var(--mdc-text-button-label-text-font);font-size:var(--mdc-text-button-label-text-size);letter-spacing:var(--mdc-text-button-label-text-tracking);font-weight:var(--mdc-text-button-label-text-weight);text-transform:var(--mdc-text-button-label-text-transform);height:var(--mdc-text-button-container-height);border-radius:var(--mdc-text-button-container-shape)}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-text-button-ripple-color)}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-state-layer-color)}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-disabled-state-layer-color)}.mat-mdc-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-hover-state-layer-opacity)}.mat-mdc-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-focus-state-layer-opacity)}.mat-mdc-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-pressed-state-layer-opacity)}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-unelevated-button{font-family:var(--mdc-filled-button-label-text-font);font-size:var(--mdc-filled-button-label-text-size);letter-spacing:var(--mdc-filled-button-label-text-tracking);font-weight:var(--mdc-filled-button-label-text-weight);text-transform:var(--mdc-filled-button-label-text-transform);height:var(--mdc-filled-button-container-height);border-radius:var(--mdc-filled-button-container-shape)}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color)}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-filled-button-ripple-color)}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-state-layer-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-disabled-state-layer-color)}.mat-mdc-unelevated-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-hover-state-layer-opacity)}.mat-mdc-unelevated-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-focus-state-layer-opacity)}.mat-mdc-unelevated-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-pressed-state-layer-opacity)}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-filled-button-disabled-label-text-color);background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{font-family:var(--mdc-protected-button-label-text-font);font-size:var(--mdc-protected-button-label-text-size);letter-spacing:var(--mdc-protected-button-label-text-tracking);font-weight:var(--mdc-protected-button-label-text-weight);text-transform:var(--mdc-protected-button-label-text-transform);height:var(--mdc-protected-button-container-height);border-radius:var(--mdc-protected-button-container-shape);box-shadow:var(--mdc-protected-button-container-elevation-shadow)}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color)}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-protected-button-ripple-color)}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-state-layer-color)}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-disabled-state-layer-color)}.mat-mdc-raised-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-hover-state-layer-opacity)}.mat-mdc-raised-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-focus-state-layer-opacity)}.mat-mdc-raised-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-pressed-state-layer-opacity)}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation-shadow)}.mat-mdc-raised-button:focus{box-shadow:var(--mdc-protected-button-focus-container-elevation-shadow)}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mdc-protected-button-pressed-container-elevation-shadow)}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-protected-button-disabled-label-text-color);background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation-shadow)}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{font-family:var(--mdc-outlined-button-label-text-font);font-size:var(--mdc-outlined-button-label-text-size);letter-spacing:var(--mdc-outlined-button-label-text-tracking);font-weight:var(--mdc-outlined-button-label-text-weight);text-transform:var(--mdc-outlined-button-label-text-transform);height:var(--mdc-outlined-button-container-height);border-radius:var(--mdc-outlined-button-container-shape);padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color)}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape)}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color)}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width))}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-outlined-button-ripple-color)}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-state-layer-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-disabled-state-layer-color)}.mat-mdc-outlined-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-hover-state-layer-opacity)}.mat-mdc-outlined-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-focus-state-layer-opacity)}.mat-mdc-outlined-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-pressed-state-layer-opacity)}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-outlined-button-disabled-label-text-color);border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-button-base{text-decoration:none}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-outlined-button .mdc-button__label{z-index:1}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button .mat-mdc-button-touch-target,.mat-mdc-unelevated-button .mat-mdc-button-touch-target,.mat-mdc-raised-button .mat-mdc-button-touch-target,.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}[dir=rtl] .mat-mdc-button>.mat-icon,.mat-mdc-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:0}.mat-mdc-button .mdc-button__label+.mat-icon{margin-left:8px;margin-right:0}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon,.mat-mdc-button .mdc-button__label+.mat-icon[dir=rtl]{margin-left:0;margin-right:8px}.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem;margin-left:-4px;margin-right:8px}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon,[dir=rtl] .mat-mdc-raised-button>.mat-icon,[dir=rtl] .mat-mdc-outlined-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon[dir=rtl],.mat-mdc-raised-button>.mat-icon[dir=rtl],.mat-mdc-outlined-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:0}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon,[dir=rtl] .mat-mdc-raised-button>.mat-icon,[dir=rtl] .mat-mdc-outlined-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon[dir=rtl],.mat-mdc-raised-button>.mat-icon[dir=rtl],.mat-mdc-outlined-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:-4px}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon,.mat-mdc-raised-button .mdc-button__label+.mat-icon,.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-left:8px;margin-right:-4px}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon,[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon,[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon,.mat-mdc-unelevated-button .mdc-button__label+.mat-icon[dir=rtl],.mat-mdc-raised-button .mdc-button__label+.mat-icon[dir=rtl],.mat-mdc-outlined-button .mdc-button__label+.mat-icon[dir=rtl]{margin-left:-4px;margin-right:8px}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px)*-1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0})}return e})(),Q9=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Jn({imports:[nc,j9,nc]})}return e})();const I5=Ob({passive:!0});let Z9=(()=>{class e{constructor(t,o){this._platform=t,this._ngZone=o,this._monitoredElements=new Map}monitor(t){if(!this._platform.isBrowser)return ed;const o=Gp(t),c=this._monitoredElements.get(o);if(c)return c.subject;const u=new bn,p="cdk-text-field-autofilled",m=E=>{"cdk-text-field-autofill-start"!==E.animationName||o.classList.contains(p)?"cdk-text-field-autofill-end"===E.animationName&&o.classList.contains(p)&&(o.classList.remove(p),this._ngZone.run(()=>u.next({target:E.target,isAutofilled:!1}))):(o.classList.add(p),this._ngZone.run(()=>u.next({target:E.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{o.addEventListener("animationstart",m,I5),o.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(o,{subject:u,unlisten:()=>{o.removeEventListener("animationstart",m,I5)}}),u}stopMonitoring(t){const o=Gp(t),c=this._monitoredElements.get(o);c&&(c.unlisten(),c.subject.complete(),o.classList.remove("cdk-text-field-autofill-monitored"),o.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(o))}ngOnDestroy(){this._monitoredElements.forEach((t,o)=>this.stopMonitoring(o))}static#e=this.\u0275fac=function(o){return new(o||e)(be(mo),be(it))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),ez=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Jn({})}return e})();function w5(...e){const n=pI(e),t=function FG(e,n){return"number"==typeof _U(e)?e.pop():n}(e,1/0),o=e;return o.length?1===o.length?ws(o[0]):Pb(t)(Vr(o,n)):ed}class tz extends bn{constructor(n=1/0,t=1/0,o=jU){super(),this._bufferSize=n,this._windowTime=t,this._timestampProvider=o,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,n),this._windowTime=Math.max(1,t)}next(n){const{isStopped:t,_buffer:o,_infiniteTimeWindow:c,_timestampProvider:u,_windowTime:p}=this;t||(o.push(n),!c&&o.push(u.now()+p)),this._trimBuffer(),super.next(n)}_subscribe(n){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(n),{_infiniteTimeWindow:o,_buffer:c}=this,u=c.slice();for(let p=0;p<u.length&&!n.closed;p+=o?1:2)n.next(u[p]);return this._checkFinalizedStatuses(n),t}_trimBuffer(){const{_bufferSize:n,_timestampProvider:t,_buffer:o,_infiniteTimeWindow:c}=this,u=(c?1:2)*n;if(n<1/0&&u<o.length&&o.splice(0,o.length-u),!c){const p=t.now();let m=0;for(let E=1;E<o.length&&o[E]<=p;E+=2)m=E;m&&o.splice(0,m+1)}}}function JU(e,n,...t){if(!0===n)return void e();if(!1===n)return;const o=new $u({next:()=>{o.unsubscribe(),e()}});return ws(n(...t)).subscribe(o)}class rz{constructor(n){this._box=n,this._destroyed=new bn,this._resizeSubject=new bn,this._elementObservables=new Map,typeof ResizeObserver<"u"&&(this._resizeObserver=new ResizeObserver(t=>this._resizeSubject.next(t)))}observe(n){return this._elementObservables.has(n)||this._elementObservables.set(n,new Wn(t=>{const o=this._resizeSubject.subscribe(t);return this._resizeObserver?.observe(n,{box:this._box}),()=>{this._resizeObserver?.unobserve(n),o.unsubscribe(),this._elementObservables.delete(n)}}).pipe(Ea(t=>t.some(o=>o.target===n)),function iz(e,n,t){let o,c=!1;return e&&"object"==typeof e?({bufferSize:o=1/0,windowTime:n=1/0,refCount:c=!1,scheduler:t}=e):o=e??1/0,function nz(e={}){const{connector:n=(()=>new bn),resetOnError:t=!0,resetOnComplete:o=!0,resetOnRefCountZero:c=!0}=e;return u=>{let p,m,E,S=0,w=!1,P=!1;const V=()=>{m?.unsubscribe(),m=void 0},H=()=>{V(),p=E=void 0,w=P=!1},z=()=>{const J=p;H(),J?.unsubscribe()};return Si((J,ce)=>{S++,!P&&!w&&V();const he=E=E??n();ce.add(()=>{S--,0===S&&!P&&!w&&(m=JU(z,c))}),he.subscribe(ce),!p&&S>0&&(p=new $u({next:le=>he.next(le),error:le=>{P=!0,V(),m=JU(H,t,le),he.error(le)},complete:()=>{w=!0,V(),m=JU(H,o),he.complete()}}),ws(J).subscribe(p))})(u)}}({connector:()=>new tz(o,n,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:c})}({bufferSize:1,refCount:!0}),Go(this._destroyed))),this._elementObservables.get(n)}destroy(){this._destroyed.next(),this._destroyed.complete(),this._resizeSubject.complete(),this._elementObservables.clear()}}let oz=(()=>{class e{constructor(){this._observers=new Map,this._ngZone=Te(it)}ngOnDestroy(){for(const[,t]of this._observers)t.destroy();this._observers.clear()}observe(t,o){const c=o?.box||"content-box";return this._observers.has(c)||this._observers.set(c,new rz(c)),this._observers.get(c).observe(t)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var bt=function(e){return e[e.State=0]="State",e[e.Transition=1]="Transition",e[e.Sequence=2]="Sequence",e[e.Group=3]="Group",e[e.Animate=4]="Animate",e[e.Keyframes=5]="Keyframes",e[e.Style=6]="Style",e[e.Trigger=7]="Trigger",e[e.Reference=8]="Reference",e[e.AnimateChild=9]="AnimateChild",e[e.AnimateRef=10]="AnimateRef",e[e.Query=11]="Query",e[e.Stagger=12]="Stagger",e}(bt||{});const Bu="*";function QU(e,n){return{type:bt.Trigger,name:e,definitions:n,options:{}}}function wI(e,n=null){return{type:bt.Animate,styles:n,timings:e}}function al(e){return{type:bt.Style,styles:e,offset:null}}function ZU(e,n,t){return{type:bt.State,name:e,styles:n,options:t}}function RI(e,n,t=null){return{type:bt.Transition,expr:e,animation:n,options:t}}class AI{constructor(n=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=n+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(n=>n()),this._onDoneFns=[])}onStart(n){this._originalOnStartFns.push(n),this._onStartFns.push(n)}onDone(n){this._originalOnDoneFns.push(n),this._onDoneFns.push(n)}onDestroy(n){this._onDestroyFns.push(n)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(n=>n()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(n=>n()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(n){this._position=this.totalTime?n*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(n){const t="start"==n?this._onStartFns:this._onDoneFns;t.forEach(o=>o()),t.length=0}}class R5{constructor(n){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=n;let t=0,o=0,c=0;const u=this.players.length;0==u?queueMicrotask(()=>this._onFinish()):this.players.forEach(p=>{p.onDone(()=>{++t==u&&this._onFinish()}),p.onDestroy(()=>{++o==u&&this._onDestroy()}),p.onStart(()=>{++c==u&&this._onStart()})}),this.totalTime=this.players.reduce((p,m)=>Math.max(p,m.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(n=>n()),this._onDoneFns=[])}init(){this.players.forEach(n=>n.init())}onStart(n){this._onStartFns.push(n)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(n=>n()),this._onStartFns=[])}onDone(n){this._onDoneFns.push(n)}onDestroy(n){this._onDestroyFns.push(n)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(n=>n.play())}pause(){this.players.forEach(n=>n.pause())}restart(){this.players.forEach(n=>n.restart())}finish(){this._onFinish(),this.players.forEach(n=>n.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(n=>n.destroy()),this._onDestroyFns.forEach(n=>n()),this._onDestroyFns=[])}reset(){this.players.forEach(n=>n.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(n){const t=n*this.totalTime;this.players.forEach(o=>{const c=o.totalTime?Math.min(1,t/o.totalTime):1;o.setPosition(c)})}getPosition(){const n=this.players.reduce((t,o)=>null===t||o.totalTime>t.totalTime?o:t,null);return null!=n?n.getPosition():0}beforeDestroy(){this.players.forEach(n=>{n.beforeDestroy&&n.beforeDestroy()})}triggerCallback(n){const t="start"==n?this._onStartFns:this._onDoneFns;t.forEach(o=>o()),t.length=0}}const lz=["notch"],uz=["matFormFieldNotchedOutline",""],hz=["*"],pz=["textField"],fz=["iconPrefixContainer"],mz=["textPrefixContainer"];function _z(e,n){1&e&&de(0,"span",16)}function gz(e,n){if(1&e&&(oe(0,"label",14),xi(1,1),Tn(2,_z,1,0,"span",15),Ee()),2&e){const t=_n(2);Ze("floating",t._shouldLabelFloat())("monitorResize",t._hasOutline())("id",t._labelId),Xi("for",t._control.id),Qe(2),we(2,!t.hideRequiredMarker&&t._control.required?2:-1)}}function Ez(e,n){1&e&&Tn(0,gz,3,5,"label",14),2&e&&we(0,_n()._hasFloatingLabel()?0:-1)}function vz(e,n){1&e&&de(0,"div",17)}function bz(e,n){}function yz(e,n){1&e&&Tn(0,bz,0,0,"ng-template",9),2&e&&(_n(2),Ze("ngTemplateOutlet",Hm(1)))}function Sz(e,n){if(1&e&&(oe(0,"div",5),Tn(1,yz,1,1,null,9),Ee()),2&e){const t=_n();Ze("matFormFieldNotchedOutlineOpen",t._shouldLabelFloat()),Qe(),we(1,t._forceDisplayInfixLabel()?-1:1)}}function Cz(e,n){1&e&&(oe(0,"div",18,19),xi(2,2),Ee())}function Tz(e,n){1&e&&(oe(0,"div",20,21),xi(2,3),Ee())}function Iz(e,n){}function wz(e,n){1&e&&Tn(0,Iz,0,0,"ng-template",9),2&e&&(_n(),Ze("ngTemplateOutlet",Hm(1)))}function Rz(e,n){1&e&&(oe(0,"div",22),xi(1,4),Ee())}function Az(e,n){1&e&&(oe(0,"div",23),xi(1,5),Ee())}function Dz(e,n){1&e&&de(0,"div",12)}function Oz(e,n){1&e&&(oe(0,"div",24),xi(1,6),Ee()),2&e&&Ze("@transitionMessages",_n()._subscriptAnimationState)}function Nz(e,n){if(1&e&&(oe(0,"mat-hint",26),br(1),Ee()),2&e){const t=_n(2);Ze("id",t._hintLabelId),Qe(),uu(t.hintLabel)}}function Pz(e,n){if(1&e&&(oe(0,"div",25),Tn(1,Nz,2,2,"mat-hint",26),xi(2,7),de(3,"div",27),xi(4,8),Ee()),2&e){const t=_n();Ze("@transitionMessages",t._subscriptAnimationState),Qe(),we(1,t.hintLabel?1:-1)}}const Mz=["*",[["mat-label"]],[["","matPrefix",""],["","matIconPrefix",""]],[["","matTextPrefix",""]],[["","matTextSuffix",""]],[["","matSuffix",""],["","matIconSuffix",""]],[["mat-error"],["","matError",""]],[["mat-hint",3,"align","end"]],[["mat-hint","align","end"]]],xz=["*","mat-label","[matPrefix], [matIconPrefix]","[matTextPrefix]","[matTextSuffix]","[matSuffix], [matIconSuffix]","mat-error, [matError]","mat-hint:not([align='end'])","mat-hint[align='end']"];let tV=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275dir=Ye({type:e,selectors:[["mat-label"]],standalone:!0})}return e})();const kz=new De("MatError");let Lz=0,A5=(()=>{class e{constructor(){this.align="start",this.id="mat-mdc-hint-"+Lz++}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275dir=Ye({type:e,selectors:[["mat-hint"]],hostAttrs:[1,"mat-mdc-form-field-hint","mat-mdc-form-field-bottom-align"],hostVars:4,hostBindings:function(o,c){2&o&&(Am("id",c.id),Xi("align",null),Ht("mat-mdc-form-field-hint-end","end"===c.align))},inputs:{align:"align",id:"id"},standalone:!0})}return e})();const Fz=new De("MatPrefix"),Uz=new De("MatSuffix"),D5=new De("FloatingLabelParent");let O5=(()=>{class e{get floating(){return this._floating}set floating(t){this._floating=t,this.monitorResize&&this._handleResize()}get monitorResize(){return this._monitorResize}set monitorResize(t){this._monitorResize=t,this._monitorResize?this._subscribeToResize():this._resizeSubscription.unsubscribe()}constructor(t){this._elementRef=t,this._floating=!1,this._monitorResize=!1,this._resizeObserver=Te(oz),this._ngZone=Te(it),this._parent=Te(D5),this._resizeSubscription=new nr}ngOnDestroy(){this._resizeSubscription.unsubscribe()}getWidth(){return function Vz(e){if(null!==e.offsetParent)return e.scrollWidth;const t=e.cloneNode(!0);t.style.setProperty("position","absolute"),t.style.setProperty("transform","translate(-9999px, -9999px)"),document.documentElement.appendChild(t);const o=t.scrollWidth;return t.remove(),o}(this._elementRef.nativeElement)}get element(){return this._elementRef.nativeElement}_handleResize(){setTimeout(()=>this._parent._handleLabelResized())}_subscribeToResize(){this._resizeSubscription.unsubscribe(),this._ngZone.runOutsideAngular(()=>{this._resizeSubscription=this._resizeObserver.observe(this._elementRef.nativeElement,{box:"border-box"}).subscribe(()=>this._handleResize())})}static#e=this.\u0275fac=function(o){return new(o||e)(ae(en))};static#t=this.\u0275dir=Ye({type:e,selectors:[["label","matFormFieldFloatingLabel",""]],hostAttrs:[1,"mdc-floating-label","mat-mdc-floating-label"],hostVars:2,hostBindings:function(o,c){2&o&&Ht("mdc-floating-label--float-above",c.floating)},inputs:{floating:"floating",monitorResize:"monitorResize"},standalone:!0})}return e})();const N5="mdc-line-ripple--active",wM="mdc-line-ripple--deactivating";let P5=(()=>{class e{constructor(t,o){this._elementRef=t,this._handleTransitionEnd=c=>{const u=this._elementRef.nativeElement.classList,p=u.contains(wM);"opacity"===c.propertyName&&p&&u.remove(N5,wM)},o.runOutsideAngular(()=>{t.nativeElement.addEventListener("transitionend",this._handleTransitionEnd)})}activate(){const t=this._elementRef.nativeElement.classList;t.remove(wM),t.add(N5)}deactivate(){this._elementRef.nativeElement.classList.add(wM)}ngOnDestroy(){this._elementRef.nativeElement.removeEventListener("transitionend",this._handleTransitionEnd)}static#e=this.\u0275fac=function(o){return new(o||e)(ae(en),ae(it))};static#t=this.\u0275dir=Ye({type:e,selectors:[["div","matFormFieldLineRipple",""]],hostAttrs:[1,"mdc-line-ripple"],standalone:!0})}return e})(),M5=(()=>{class e{constructor(t,o){this._elementRef=t,this._ngZone=o,this.open=!1}ngAfterViewInit(){const t=this._elementRef.nativeElement.querySelector(".mdc-floating-label");t?(this._elementRef.nativeElement.classList.add("mdc-notched-outline--upgraded"),"function"==typeof requestAnimationFrame&&(t.style.transitionDuration="0s",this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>t.style.transitionDuration="")}))):this._elementRef.nativeElement.classList.add("mdc-notched-outline--no-label")}_setNotchWidth(t){this._notch.nativeElement.style.width=this.open&&t?`calc(${t}px * var(--mat-mdc-form-field-floating-label-scale, 0.75) + 9px)`:""}static#e=this.\u0275fac=function(o){return new(o||e)(ae(en),ae(it))};static#t=this.\u0275cmp=Br({type:e,selectors:[["div","matFormFieldNotchedOutline",""]],viewQuery:function(o,c){if(1&o&&ha(lz,5),2&o){let u;Qi(u=ar())&&(c._notch=u.first)}},hostAttrs:[1,"mdc-notched-outline"],hostVars:2,hostBindings:function(o,c){2&o&&Ht("mdc-notched-outline--notched",c.open)},inputs:{open:[Xe.None,"matFormFieldNotchedOutlineOpen","open"]},standalone:!0,features:[Gc],attrs:uz,ngContentSelectors:hz,decls:5,vars:0,consts:[[1,"mdc-notched-outline__leading"],[1,"mdc-notched-outline__notch"],["notch",""],[1,"mdc-notched-outline__trailing"]],template:function(o,c){1&o&&(Po(),de(0,"div",0),oe(1,"div",1,2),xi(3),Ee(),de(4,"div",3))},encapsulation:2,changeDetection:0})}return e})();const Bz={transitionMessages:QU("transitionMessages",[ZU("enter",al({opacity:1,transform:"translateY(0%)"})),RI("void => enter",[al({opacity:0,transform:"translateY(-5px)"}),wI("300ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])};let x5=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275dir=Ye({type:e})}return e})();const k5=new De("MatFormField"),jz=new De("MAT_FORM_FIELD_DEFAULT_OPTIONS");let L5=0,Wz=(()=>{class e{get hideRequiredMarker(){return this._hideRequiredMarker}set hideRequiredMarker(t){this._hideRequiredMarker=Nb(t)}get floatLabel(){return this._floatLabel||this._defaults?.floatLabel||"auto"}set floatLabel(t){t!==this._floatLabel&&(this._floatLabel=t,this._changeDetectorRef.markForCheck())}get appearance(){return this._appearance}set appearance(t){const o=this._appearance;this._appearance=t||this._defaults?.appearance||"fill","outline"===this._appearance&&this._appearance!==o&&(this._needsOutlineLabelOffsetUpdateOnStable=!0)}get subscriptSizing(){return this._subscriptSizing||this._defaults?.subscriptSizing||"fixed"}set subscriptSizing(t){this._subscriptSizing=t||this._defaults?.subscriptSizing||"fixed"}get hintLabel(){return this._hintLabel}set hintLabel(t){this._hintLabel=t,this._processHints()}get _control(){return this._explicitFormFieldControl||this._formFieldControl}set _control(t){this._explicitFormFieldControl=t}constructor(t,o,c,u,p,m,E,S){this._elementRef=t,this._changeDetectorRef=o,this._ngZone=c,this._dir=u,this._platform=p,this._defaults=m,this._animationMode=E,this._hideRequiredMarker=!1,this.color="primary",this._appearance="fill",this._subscriptSizing=null,this._hintLabel="",this._hasIconPrefix=!1,this._hasTextPrefix=!1,this._hasIconSuffix=!1,this._hasTextSuffix=!1,this._labelId="mat-mdc-form-field-label-"+L5++,this._hintLabelId="mat-mdc-hint-"+L5++,this._subscriptAnimationState="",this._destroyed=new bn,this._isFocused=null,this._needsOutlineLabelOffsetUpdateOnStable=!1,m&&(m.appearance&&(this.appearance=m.appearance),this._hideRequiredMarker=!!m?.hideRequiredMarker,m.color&&(this.color=m.color))}ngAfterViewInit(){this._updateFocusState(),this._subscriptAnimationState="enter",this._changeDetectorRef.detectChanges()}ngAfterContentInit(){this._assertFormFieldControl(),this._initializeControl(),this._initializeSubscript(),this._initializePrefixAndSuffix(),this._initializeOutlineLabelOffsetSubscriptions()}ngAfterContentChecked(){this._assertFormFieldControl()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}getLabelId(){return this._hasFloatingLabel()?this._labelId:null}getConnectedOverlayOrigin(){return this._textField||this._elementRef}_animateAndLockLabel(){this._hasFloatingLabel()&&(this.floatLabel="always")}_initializeControl(){const t=this._control;t.controlType&&this._elementRef.nativeElement.classList.add(`mat-mdc-form-field-type-${t.controlType}`),t.stateChanges.subscribe(()=>{this._updateFocusState(),this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),t.ngControl&&t.ngControl.valueChanges&&t.ngControl.valueChanges.pipe(Go(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck())}_checkPrefixAndSuffixTypes(){this._hasIconPrefix=!!this._prefixChildren.find(t=>!t._isText),this._hasTextPrefix=!!this._prefixChildren.find(t=>t._isText),this._hasIconSuffix=!!this._suffixChildren.find(t=>!t._isText),this._hasTextSuffix=!!this._suffixChildren.find(t=>t._isText)}_initializePrefixAndSuffix(){this._checkPrefixAndSuffixTypes(),w5(this._prefixChildren.changes,this._suffixChildren.changes).subscribe(()=>{this._checkPrefixAndSuffixTypes(),this._changeDetectorRef.markForCheck()})}_initializeSubscript(){this._hintChildren.changes.subscribe(()=>{this._processHints(),this._changeDetectorRef.markForCheck()}),this._errorChildren.changes.subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._validateHints(),this._syncDescribedByIds()}_assertFormFieldControl(){}_updateFocusState(){this._control.focused&&!this._isFocused?(this._isFocused=!0,this._lineRipple?.activate()):!this._control.focused&&(this._isFocused||null===this._isFocused)&&(this._isFocused=!1,this._lineRipple?.deactivate()),this._textField?.nativeElement.classList.toggle("mdc-text-field--focused",this._control.focused)}_initializeOutlineLabelOffsetSubscriptions(){this._prefixChildren.changes.subscribe(()=>this._needsOutlineLabelOffsetUpdateOnStable=!0),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(Go(this._destroyed)).subscribe(()=>{this._needsOutlineLabelOffsetUpdateOnStable&&(this._needsOutlineLabelOffsetUpdateOnStable=!1,this._updateOutlineLabelOffset())})}),this._dir.change.pipe(Go(this._destroyed)).subscribe(()=>this._needsOutlineLabelOffsetUpdateOnStable=!0)}_shouldAlwaysFloat(){return"always"===this.floatLabel}_hasOutline(){return"outline"===this.appearance}_forceDisplayInfixLabel(){return!this._platform.isBrowser&&this._prefixChildren.length&&!this._shouldLabelFloat()}_hasFloatingLabel(){return!!this._labelChildNonStatic||!!this._labelChildStatic}_shouldLabelFloat(){return this._control.shouldLabelFloat||this._shouldAlwaysFloat()}_shouldForward(t){const o=this._control?this._control.ngControl:null;return o&&o[t]}_getDisplayedMessages(){return this._errorChildren&&this._errorChildren.length>0&&this._control.errorState?"error":"hint"}_handleLabelResized(){this._refreshOutlineNotchWidth()}_refreshOutlineNotchWidth(){this._hasOutline()&&this._floatingLabel&&this._shouldLabelFloat()?this._notchedOutline?._setNotchWidth(this._floatingLabel.getWidth()):this._notchedOutline?._setNotchWidth(0)}_processHints(){this._validateHints(),this._syncDescribedByIds()}_validateHints(){}_syncDescribedByIds(){if(this._control){let t=[];if(this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&t.push(...this._control.userAriaDescribedBy.split(" ")),"hint"===this._getDisplayedMessages()){const o=this._hintChildren?this._hintChildren.find(u=>"start"===u.align):null,c=this._hintChildren?this._hintChildren.find(u=>"end"===u.align):null;o?t.push(o.id):this._hintLabel&&t.push(this._hintLabelId),c&&t.push(c.id)}else this._errorChildren&&t.push(...this._errorChildren.map(o=>o.id));this._control.setDescribedByIds(t)}}_updateOutlineLabelOffset(){if(!this._platform.isBrowser||!this._hasOutline()||!this._floatingLabel)return;const t=this._floatingLabel.element;if(!this._iconPrefixContainer&&!this._textPrefixContainer)return void(t.style.transform="");if(!this._isAttachedToDom())return void(this._needsOutlineLabelOffsetUpdateOnStable=!0);const o=this._iconPrefixContainer?.nativeElement,c=this._textPrefixContainer?.nativeElement,u=o?.getBoundingClientRect().width??0,p=c?.getBoundingClientRect().width??0;t.style.transform=`var(\n        --mat-mdc-form-field-label-transform,\n        translateY(-50%) translateX(calc(${"rtl"===this._dir.value?"-1":"1"} * (${u+p}px + var(--mat-mdc-form-field-label-offset-x, 0px))))\n    )`}_isAttachedToDom(){const t=this._elementRef.nativeElement;if(t.getRootNode){const o=t.getRootNode();return o&&o!==t}return document.documentElement.contains(t)}static#e=this.\u0275fac=function(o){return new(o||e)(ae(en),ae(Us),ae(it),ae(YU),ae(mo),ae(jz,8),ae(yc,8),ae(on))};static#t=this.\u0275cmp=Br({type:e,selectors:[["mat-form-field"]],contentQueries:function(o,c,u){if(1&o&&(ua(u,tV,5),ua(u,tV,7),ua(u,x5,5),ua(u,Fz,5),ua(u,Uz,5),ua(u,kz,5),ua(u,A5,5)),2&o){let p;Qi(p=ar())&&(c._labelChildNonStatic=p.first),Qi(p=ar())&&(c._labelChildStatic=p.first),Qi(p=ar())&&(c._formFieldControl=p.first),Qi(p=ar())&&(c._prefixChildren=p),Qi(p=ar())&&(c._suffixChildren=p),Qi(p=ar())&&(c._errorChildren=p),Qi(p=ar())&&(c._hintChildren=p)}},viewQuery:function(o,c){if(1&o&&(ha(pz,5),ha(fz,5),ha(mz,5),ha(O5,5),ha(M5,5),ha(P5,5)),2&o){let u;Qi(u=ar())&&(c._textField=u.first),Qi(u=ar())&&(c._iconPrefixContainer=u.first),Qi(u=ar())&&(c._textPrefixContainer=u.first),Qi(u=ar())&&(c._floatingLabel=u.first),Qi(u=ar())&&(c._notchedOutline=u.first),Qi(u=ar())&&(c._lineRipple=u.first)}},hostAttrs:[1,"mat-mdc-form-field"],hostVars:42,hostBindings:function(o,c){2&o&&Ht("mat-mdc-form-field-label-always-float",c._shouldAlwaysFloat())("mat-mdc-form-field-has-icon-prefix",c._hasIconPrefix)("mat-mdc-form-field-has-icon-suffix",c._hasIconSuffix)("mat-form-field-invalid",c._control.errorState)("mat-form-field-disabled",c._control.disabled)("mat-form-field-autofilled",c._control.autofilled)("mat-form-field-no-animations","NoopAnimations"===c._animationMode)("mat-form-field-appearance-fill","fill"==c.appearance)("mat-form-field-appearance-outline","outline"==c.appearance)("mat-form-field-hide-placeholder",c._hasFloatingLabel()&&!c._shouldLabelFloat())("mat-focused",c._control.focused)("mat-primary","accent"!==c.color&&"warn"!==c.color)("mat-accent","accent"===c.color)("mat-warn","warn"===c.color)("ng-untouched",c._shouldForward("untouched"))("ng-touched",c._shouldForward("touched"))("ng-pristine",c._shouldForward("pristine"))("ng-dirty",c._shouldForward("dirty"))("ng-valid",c._shouldForward("valid"))("ng-invalid",c._shouldForward("invalid"))("ng-pending",c._shouldForward("pending"))},inputs:{hideRequiredMarker:"hideRequiredMarker",color:"color",floatLabel:"floatLabel",appearance:"appearance",subscriptSizing:"subscriptSizing",hintLabel:"hintLabel"},exportAs:["matFormField"],standalone:!0,features:[wn([{provide:k5,useExisting:e},{provide:D5,useExisting:e}]),Gc],ngContentSelectors:xz,decls:18,vars:21,consts:[["labelTemplate",""],[1,"mat-mdc-text-field-wrapper","mdc-text-field",3,"click"],["textField",""],["class","mat-mdc-form-field-focus-overlay"],[1,"mat-mdc-form-field-flex"],["matFormFieldNotchedOutline","",3,"matFormFieldNotchedOutlineOpen"],["class","mat-mdc-form-field-icon-prefix"],["class","mat-mdc-form-field-text-prefix"],[1,"mat-mdc-form-field-infix"],[3,"ngTemplateOutlet"],["class","mat-mdc-form-field-text-suffix"],["class","mat-mdc-form-field-icon-suffix"],["matFormFieldLineRipple",""],[1,"mat-mdc-form-field-subscript-wrapper","mat-mdc-form-field-bottom-align"],["matFormFieldFloatingLabel","",3,"floating","monitorResize","id"],["aria-hidden","true","class","mat-mdc-form-field-required-marker mdc-floating-label--required"],["aria-hidden","true",1,"mat-mdc-form-field-required-marker","mdc-floating-label--required"],[1,"mat-mdc-form-field-focus-overlay"],[1,"mat-mdc-form-field-icon-prefix"],["iconPrefixContainer",""],[1,"mat-mdc-form-field-text-prefix"],["textPrefixContainer",""],[1,"mat-mdc-form-field-text-suffix"],[1,"mat-mdc-form-field-icon-suffix"],[1,"mat-mdc-form-field-error-wrapper"],[1,"mat-mdc-form-field-hint-wrapper"],[3,"id"],[1,"mat-mdc-form-field-hint-spacer"]],template:function(o,c){if(1&o&&(Po(Mz),Tn(0,Ez,1,1,"ng-template",null,0,jv),oe(2,"div",1,2),mn("click",function(p){return c._control.onContainerClick(p)}),Tn(4,vz,1,0,"div",3),oe(5,"div",4),Tn(6,Sz,2,2,"div",5)(7,Cz,3,0,"div",6)(8,Tz,3,0,"div",7),oe(9,"div",8),Tn(10,wz,1,1,null,9),xi(11),Ee(),Tn(12,Rz,2,0,"div",10)(13,Az,2,0,"div",11),Ee(),Tn(14,Dz,1,0,"div",12),Ee(),oe(15,"div",13),Tn(16,Oz,2,1)(17,Pz,5,2),Ee()),2&o){let u;Qe(2),Ht("mdc-text-field--filled",!c._hasOutline())("mdc-text-field--outlined",c._hasOutline())("mdc-text-field--no-label",!c._hasFloatingLabel())("mdc-text-field--disabled",c._control.disabled)("mdc-text-field--invalid",c._control.errorState),Qe(2),we(4,c._hasOutline()||c._control.disabled?-1:4),Qe(2),we(6,c._hasOutline()?6:-1),Qe(),we(7,c._hasIconPrefix?7:-1),Qe(),we(8,c._hasTextPrefix?8:-1),Qe(2),we(10,!c._hasOutline()||c._forceDisplayInfixLabel()?10:-1),Qe(2),we(12,c._hasTextSuffix?12:-1),Qe(),we(13,c._hasIconSuffix?13:-1),Qe(),we(14,c._hasOutline()?-1:14),Qe(),Ht("mat-mdc-form-field-subscript-dynamic-size","dynamic"===c.subscriptSizing),Qe(),we(16,"error"===(u=c._getDisplayedMessages())?16:"hint"===u?17:-1)}},dependencies:[O5,M5,Z0,P5,A5],styles:['.mdc-text-field{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:0;border-bottom-left-radius:0;display:inline-flex;align-items:baseline;padding:0 16px;position:relative;box-sizing:border-box;overflow:hidden;will-change:opacity,transform,color}.mdc-text-field .mdc-floating-label{top:50%;transform:translateY(-50%);pointer-events:none}.mdc-text-field__input{height:28px;width:100%;min-width:0;border:none;border-radius:0;background:none;appearance:none;padding:0}.mdc-text-field__input::-ms-clear{display:none}.mdc-text-field__input::-webkit-calendar-picker-indicator{display:none}.mdc-text-field__input:focus{outline:none}.mdc-text-field__input:invalid{box-shadow:none}@media all{.mdc-text-field__input::placeholder{opacity:0}}@media all{.mdc-text-field__input:-ms-input-placeholder{opacity:0}}@media all{.mdc-text-field--no-label .mdc-text-field__input::placeholder,.mdc-text-field--focused .mdc-text-field__input::placeholder{opacity:1}}@media all{.mdc-text-field--no-label .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mdc-text-field__input:-ms-input-placeholder{opacity:1}}.mdc-text-field__affix{height:28px;opacity:0;white-space:nowrap}.mdc-text-field--label-floating .mdc-text-field__affix,.mdc-text-field--no-label .mdc-text-field__affix{opacity:1}@supports(-webkit-hyphens: none){.mdc-text-field--outlined .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field__affix--prefix,.mdc-text-field__affix--prefix[dir=rtl]{padding-left:2px;padding-right:0}.mdc-text-field--end-aligned .mdc-text-field__affix--prefix{padding-left:0;padding-right:12px}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--end-aligned .mdc-text-field__affix--prefix[dir=rtl]{padding-left:12px;padding-right:0}.mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field__affix--suffix,.mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:12px}.mdc-text-field--end-aligned .mdc-text-field__affix--suffix{padding-left:2px;padding-right:0}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--end-aligned .mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:2px}.mdc-text-field--filled{height:56px}.mdc-text-field--filled::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}.mdc-text-field--filled .mdc-floating-label{left:16px;right:initial}[dir=rtl] .mdc-text-field--filled .mdc-floating-label,.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:16px}.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{height:100%}.mdc-text-field--filled.mdc-text-field--no-label .mdc-floating-label{display:none}.mdc-text-field--filled.mdc-text-field--no-label::before{display:none}@supports(-webkit-hyphens: none){.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field--outlined{height:56px;overflow:visible}.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) scale(1)}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) scale(0.75)}.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--outlined .mdc-text-field__input{height:100%}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:4px;border-bottom-left-radius:var(--mdc-shape-small, 4px)}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading[dir=rtl]{border-top-left-radius:0;border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:4px;border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px,var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px,var(--mdc-shape-small, 4px))*2)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing{border-top-left-radius:0;border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:4px;border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing[dir=rtl]{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:4px;border-bottom-left-radius:var(--mdc-shape-small, 4px)}@supports(top: max(0%)){.mdc-text-field--outlined{padding-left:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px,var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-left:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-right:max(16px,var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-left:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-right:max(16px,var(--mdc-shape-small, 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-right:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:max(16px,var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-right:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-left:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-right:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:1px}.mdc-text-field--outlined .mdc-floating-label{left:4px;right:initial}[dir=rtl] .mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:4px}.mdc-text-field--outlined .mdc-text-field__input{display:flex;border:none !important;background-color:rgba(0,0,0,0)}.mdc-text-field--outlined .mdc-notched-outline{z-index:1}.mdc-text-field--textarea{flex-direction:column;align-items:center;width:auto;height:auto;padding:0}.mdc-text-field--textarea .mdc-floating-label{top:19px}.mdc-text-field--textarea .mdc-floating-label:not(.mdc-floating-label--float-above){transform:none}.mdc-text-field--textarea .mdc-text-field__input{flex-grow:1;height:auto;min-height:1.5rem;overflow-x:hidden;overflow-y:auto;box-sizing:border-box;resize:none;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--filled::before{display:none}.mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-10.25px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--filled .mdc-text-field__input{margin-top:23px;margin-bottom:9px}.mdc-text-field--textarea.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-27.25px) scale(1)}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-24.75px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label{top:18px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field__input{margin-bottom:2px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter{align-self:flex-end;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::after{display:inline-block;width:0;height:16px;content:"";vertical-align:-16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::before{display:none}.mdc-text-field__resizer{align-self:stretch;display:inline-flex;flex-direction:column;flex-grow:1;max-height:100%;max-width:100%;min-height:56px;min-width:fit-content;min-width:-moz-available;min-width:-webkit-fill-available;overflow:hidden;resize:both}.mdc-text-field--filled .mdc-text-field__resizer{transform:translateY(-1px)}.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateY(1px)}.mdc-text-field--outlined .mdc-text-field__resizer{transform:translateX(-1px) translateY(-1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer,.mdc-text-field--outlined .mdc-text-field__resizer[dir=rtl]{transform:translateX(1px) translateY(-1px)}.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateX(1px) translateY(1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input[dir=rtl],.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter[dir=rtl]{transform:translateX(-1px) translateY(1px)}.mdc-text-field--with-leading-icon{padding-left:0;padding-right:16px}[dir=rtl] .mdc-text-field--with-leading-icon,.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:16px;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 48px);left:48px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:48px}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 64px/0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label{left:36px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:36px}.mdc-text-field--with-leading-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) translateX(-32px) scale(1)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-37.25px) translateX(32px) scale(1)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) translateX(-32px) scale(0.75)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl],.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-34.75px) translateX(32px) scale(0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--with-trailing-icon{padding-left:16px;padding-right:0}[dir=rtl] .mdc-text-field--with-trailing-icon,.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0;padding-right:16px}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 64px)}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 64px/0.75)}.mdc-text-field--with-trailing-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 96px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 96px/0.75)}.mdc-text-field-helper-line{display:flex;justify-content:space-between;box-sizing:border-box}.mdc-text-field+.mdc-text-field-helper-line{padding-right:16px;padding-left:16px}.mdc-form-field>.mdc-text-field+label{align-self:flex-start}.mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--focused .mdc-notched-outline__trailing{border-width:2px}.mdc-text-field--focused+.mdc-text-field-helper-line .mdc-text-field-helper-text:not(.mdc-text-field-helper-text--validation-msg){opacity:1}.mdc-text-field--focused.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:2px}.mdc-text-field--focused.mdc-text-field--outlined.mdc-text-field--textarea .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--invalid+.mdc-text-field-helper-line .mdc-text-field-helper-text--validation-msg{opacity:1}.mdc-text-field--disabled{pointer-events:none}@media screen and (forced-colors: active){.mdc-text-field--disabled .mdc-text-field__input{background-color:Window}.mdc-text-field--disabled .mdc-floating-label{z-index:1}}.mdc-text-field--disabled .mdc-floating-label{cursor:default}.mdc-text-field--disabled.mdc-text-field--filled .mdc-text-field__ripple{display:none}.mdc-text-field--disabled .mdc-text-field__input{pointer-events:auto}.mdc-text-field--end-aligned .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--end-aligned .mdc-text-field__input[dir=rtl]{text-align:left}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix{direction:ltr}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--leading,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--leading{order:1}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{order:2}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input{order:3}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{order:4}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--trailing,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--trailing{order:5}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--prefix{padding-right:12px}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--suffix{padding-left:2px}.mdc-floating-label{position:absolute;left:0;-webkit-transform-origin:left top;transform-origin:left top;line-height:1.15rem;text-align:left;text-overflow:ellipsis;white-space:nowrap;cursor:text;overflow:hidden;will-change:transform}[dir=rtl] .mdc-floating-label,.mdc-floating-label[dir=rtl]{right:0;left:auto;-webkit-transform-origin:right top;transform-origin:right top;text-align:right}.mdc-floating-label--float-above{cursor:auto}.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after{margin-left:1px;margin-right:0px;content:"*"}[dir=rtl] .mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after,.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)[dir=rtl]::after{margin-left:0;margin-right:1px}.mdc-notched-outline{display:flex;position:absolute;top:0;right:0;left:0;box-sizing:border-box;width:100%;max-width:100%;height:100%;text-align:left;pointer-events:none}[dir=rtl] .mdc-notched-outline,.mdc-notched-outline[dir=rtl]{text-align:right}.mdc-notched-outline__leading,.mdc-notched-outline__notch,.mdc-notched-outline__trailing{box-sizing:border-box;height:100%;pointer-events:none}.mdc-notched-outline__trailing{flex-grow:1}.mdc-notched-outline__notch{flex:0 0 auto;width:auto}.mdc-notched-outline .mdc-floating-label{display:inline-block;position:relative;max-width:100%}.mdc-notched-outline .mdc-floating-label--float-above{text-overflow:clip}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:133.3333333333%}.mdc-notched-outline--notched .mdc-notched-outline__notch{padding-left:0;padding-right:8px;border-top:none}[dir=rtl] .mdc-notched-outline--notched .mdc-notched-outline__notch,.mdc-notched-outline--notched .mdc-notched-outline__notch[dir=rtl]{padding-left:8px;padding-right:0}.mdc-notched-outline--no-label .mdc-notched-outline__notch{display:none}.mdc-line-ripple::before,.mdc-line-ripple::after{position:absolute;bottom:0;left:0;width:100%;border-bottom-style:solid;content:""}.mdc-line-ripple::before{z-index:1}.mdc-line-ripple::after{transform:scaleX(0);opacity:0;z-index:2}.mdc-line-ripple--active::after{transform:scaleX(1);opacity:1}.mdc-line-ripple--deactivating::after{opacity:0}.mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-notched-outline__leading,.mdc-notched-outline__notch,.mdc-notched-outline__trailing{border-top:1px solid;border-bottom:1px solid}.mdc-notched-outline__leading{border-left:1px solid;border-right:none;width:12px}[dir=rtl] .mdc-notched-outline__leading,.mdc-notched-outline__leading[dir=rtl]{border-left:none;border-right:1px solid}.mdc-notched-outline__trailing{border-left:none;border-right:1px solid}[dir=rtl] .mdc-notched-outline__trailing,.mdc-notched-outline__trailing[dir=rtl]{border-left:1px solid;border-right:none}.mdc-notched-outline__notch{max-width:calc(100% - 12px*2)}.mdc-line-ripple::before{border-bottom-width:1px}.mdc-line-ripple::after{border-bottom-width:2px}.mdc-text-field--filled{border-top-left-radius:var(--mdc-filled-text-field-container-shape);border-top-right-radius:var(--mdc-filled-text-field-container-shape);border-bottom-right-radius:0;border-bottom-left-radius:0}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-caret-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-error-caret-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-filled-text-field-input-text-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-filled-text-field-disabled-input-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-focus-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-hover-label-text-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-disabled-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-focus-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-hover-label-text-color)}.mdc-text-field--filled .mdc-floating-label{font-family:var(--mdc-filled-text-field-label-text-font);font-size:var(--mdc-filled-text-field-label-text-size);font-weight:var(--mdc-filled-text-field-label-text-weight);letter-spacing:var(--mdc-filled-text-field-label-text-tracking)}@media all{.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}}@media all{.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}}.mdc-text-field--filled:not(.mdc-text-field--disabled){background-color:var(--mdc-filled-text-field-container-color)}.mdc-text-field--filled.mdc-text-field--disabled{background-color:var(--mdc-filled-text-field-disabled-container-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-hover-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-focus-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-disabled-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-hover-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-error-focus-active-indicator-color)}.mdc-text-field--filled .mdc-line-ripple::before{border-bottom-width:var(--mdc-filled-text-field-active-indicator-height)}.mdc-text-field--filled .mdc-line-ripple::after{border-bottom-width:var(--mdc-filled-text-field-focus-active-indicator-height)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-caret-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-error-caret-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-outlined-text-field-input-text-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-outlined-text-field-disabled-input-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-focus-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-hover-label-text-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-disabled-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-focus-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-hover-label-text-color)}.mdc-text-field--outlined .mdc-floating-label{font-family:var(--mdc-outlined-text-field-label-text-font);font-size:var(--mdc-outlined-text-field-label-text-size);font-weight:var(--mdc-outlined-text-field-label-text-weight);letter-spacing:var(--mdc-outlined-text-field-label-text-tracking)}@media all{.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}}@media all{.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}}.mdc-text-field--outlined.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:calc(.75*var(--mdc-outlined-text-field-label-text-size))}.mdc-text-field--outlined.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:var(--mdc-outlined-text-field-label-text-size)}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading[dir=rtl]{border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:0}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px,var(--mdc-outlined-text-field-container-shape))}}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px,var(--mdc-outlined-text-field-container-shape))*2)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing{border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:0}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing[dir=rtl]{border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}@supports(top: max(0%)){.mdc-text-field--outlined{padding-left:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-left:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-left:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-right:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:max(16px,var(--mdc-outlined-text-field-container-shape))}}.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-right:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-left:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-right:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-hover-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-focus-outline-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-disabled-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-hover-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-focus-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__trailing{border-width:var(--mdc-outlined-text-field-outline-width)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__trailing{border-width:var(--mdc-outlined-text-field-focus-outline-width)}.mat-mdc-form-field-textarea-control{vertical-align:middle;resize:vertical;box-sizing:border-box;height:auto;margin:0;padding:0;border:none;overflow:auto}.mat-mdc-form-field-input-control.mat-mdc-form-field-input-control{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:inherit;letter-spacing:inherit;text-decoration:inherit;text-transform:inherit;border:none}.mat-mdc-form-field .mat-mdc-floating-label.mdc-floating-label{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;line-height:normal;pointer-events:all}.mat-mdc-form-field:not(.mat-form-field-disabled) .mat-mdc-floating-label.mdc-floating-label{cursor:inherit}.mdc-text-field--no-label:not(.mdc-text-field--textarea) .mat-mdc-form-field-input-control.mdc-text-field__input,.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control{height:auto}.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control.mdc-text-field__input[type=color]{height:23px}.mat-mdc-text-field-wrapper{height:auto;flex:auto}.mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-left:0;--mat-mdc-form-field-label-offset-x: -16px}.mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-right:0}[dir=rtl] .mat-mdc-text-field-wrapper{padding-left:16px;padding-right:16px}[dir=rtl] .mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-left:0}[dir=rtl] .mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-right:0}.mat-form-field-disabled .mdc-text-field__input::placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-moz-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-webkit-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input:-ms-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-mdc-form-field-label-always-float .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms;opacity:1}.mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-floating-label{left:auto;right:auto}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-text-field__input{display:inline-block}.mat-mdc-form-field .mat-mdc-text-field-wrapper.mdc-text-field .mdc-notched-outline__notch{padding-top:0}.mat-mdc-text-field-wrapper::before{content:none}.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field .mdc-notched-outline__notch{border-left:1px solid rgba(0,0,0,0)}[dir=rtl] .mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field .mdc-notched-outline__notch{border-left:none;border-right:1px solid rgba(0,0,0,0)}.mat-mdc-form-field-infix{min-height:var(--mat-form-field-container-height);padding-top:var(--mat-form-field-filled-with-label-container-padding-top);padding-bottom:var(--mat-form-field-filled-with-label-container-padding-bottom)}.mdc-text-field--outlined .mat-mdc-form-field-infix,.mdc-text-field--no-label .mat-mdc-form-field-infix{padding-top:var(--mat-form-field-container-vertical-padding);padding-bottom:var(--mat-form-field-container-vertical-padding)}.mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-floating-label{top:calc(var(--mat-form-field-container-height)/2)}.mdc-text-field--filled .mat-mdc-floating-label{display:var(--mat-form-field-filled-label-display, block)}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{--mat-mdc-form-field-label-transform: translateY(calc(calc(6.75px + var(--mat-form-field-container-height) / 2) * -1)) scale(var(--mat-mdc-form-field-floating-label-scale, 0.75));transform:var(--mat-mdc-form-field-label-transform)}.mat-mdc-form-field-subscript-wrapper{box-sizing:border-box;width:100%;position:relative}.mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-error-wrapper{position:absolute;top:0;left:0;right:0;padding:0 16px}.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-error-wrapper{position:static}.mat-mdc-form-field-bottom-align::before{content:"";display:inline-block;height:16px}.mat-mdc-form-field-bottom-align.mat-mdc-form-field-subscript-dynamic-size::before{content:unset}.mat-mdc-form-field-hint-end{order:1}.mat-mdc-form-field-hint-wrapper{display:flex}.mat-mdc-form-field-hint-spacer{flex:1 0 1em}.mat-mdc-form-field-error{display:block;color:var(--mat-form-field-error-text-color)}.mat-mdc-form-field-subscript-wrapper,.mat-mdc-form-field-bottom-align::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-subscript-text-font);line-height:var(--mat-form-field-subscript-text-line-height);font-size:var(--mat-form-field-subscript-text-size);letter-spacing:var(--mat-form-field-subscript-text-tracking);font-weight:var(--mat-form-field-subscript-text-weight)}.mat-mdc-form-field-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;opacity:0;pointer-events:none;background-color:var(--mat-form-field-state-layer-color)}.mat-mdc-text-field-wrapper:hover .mat-mdc-form-field-focus-overlay{opacity:var(--mat-form-field-hover-state-layer-opacity)}.mat-mdc-form-field.mat-focused .mat-mdc-form-field-focus-overlay{opacity:var(--mat-form-field-focus-state-layer-opacity)}select.mat-mdc-form-field-input-control{-moz-appearance:none;-webkit-appearance:none;background-color:rgba(0,0,0,0);display:inline-flex;box-sizing:border-box}select.mat-mdc-form-field-input-control:not(:disabled){cursor:pointer}select.mat-mdc-form-field-input-control:not(.mat-mdc-native-select-inline) option{color:var(--mat-form-field-select-option-text-color)}select.mat-mdc-form-field-input-control:not(.mat-mdc-native-select-inline) option:disabled{color:var(--mat-form-field-select-disabled-option-text-color)}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{content:"";width:0;height:0;border-left:5px solid rgba(0,0,0,0);border-right:5px solid rgba(0,0,0,0);border-top:5px solid;position:absolute;right:0;top:50%;margin-top:-2.5px;pointer-events:none;color:var(--mat-form-field-enabled-select-arrow-color)}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{right:auto;left:0}.mat-mdc-form-field-type-mat-native-select.mat-focused .mat-mdc-form-field-infix::after{color:var(--mat-form-field-focus-select-arrow-color)}.mat-mdc-form-field-type-mat-native-select.mat-form-field-disabled .mat-mdc-form-field-infix::after{color:var(--mat-form-field-disabled-select-arrow-color)}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:15px}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:0;padding-left:15px}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-mdc-text-field-wrapper{outline:solid 1px}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-form-field-disabled .mat-mdc-text-field-wrapper{outline-color:GrayText}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-focused .mat-mdc-text-field-wrapper{outline:dashed 3px}.cdk-high-contrast-active .mat-mdc-form-field.mat-focused .mdc-notched-outline{border:dashed 3px}.mat-mdc-form-field-input-control[type=date],.mat-mdc-form-field-input-control[type=datetime],.mat-mdc-form-field-input-control[type=datetime-local],.mat-mdc-form-field-input-control[type=month],.mat-mdc-form-field-input-control[type=week],.mat-mdc-form-field-input-control[type=time]{line-height:1}.mat-mdc-form-field-input-control::-webkit-datetime-edit{line-height:1;padding:0;margin-bottom:-2px}.mat-mdc-form-field{--mat-mdc-form-field-floating-label-scale: 0.75;display:inline-flex;flex-direction:column;min-width:0;text-align:left;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-container-text-font);line-height:var(--mat-form-field-container-text-line-height);font-size:var(--mat-form-field-container-text-size);letter-spacing:var(--mat-form-field-container-text-tracking);font-weight:var(--mat-form-field-container-text-weight)}[dir=rtl] .mat-mdc-form-field{text-align:right}.mat-mdc-form-field .mdc-text-field--outlined .mdc-floating-label--float-above{font-size:calc(var(--mat-form-field-outlined-label-text-populated-size)*var(--mat-mdc-form-field-floating-label-scale))}.mat-mdc-form-field .mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:var(--mat-form-field-outlined-label-text-populated-size)}.mat-mdc-form-field-flex{display:inline-flex;align-items:baseline;box-sizing:border-box;width:100%}.mat-mdc-text-field-wrapper{width:100%}.mat-mdc-form-field-icon-prefix,.mat-mdc-form-field-icon-suffix{align-self:center;line-height:0;pointer-events:auto;position:relative;z-index:1}.mat-mdc-form-field-icon-prefix>.mat-icon,.mat-mdc-form-field-icon-suffix>.mat-icon{padding:12px;box-sizing:content-box}.mat-mdc-form-field-icon-prefix{color:var(--mat-form-field-leading-icon-color)}.mat-form-field-disabled .mat-mdc-form-field-icon-prefix{color:var(--mat-form-field-disabled-leading-icon-color)}.mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-trailing-icon-color)}.mat-form-field-disabled .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-disabled-trailing-icon-color)}.mat-form-field-invalid .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-trailing-icon-color)}.mat-form-field-invalid:not(.mat-focused):not(.mat-form-field-disabled) .mat-mdc-text-field-wrapper:hover .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-hover-trailing-icon-color)}.mat-form-field-invalid.mat-focused .mat-mdc-text-field-wrapper .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-focus-trailing-icon-color)}.mat-mdc-form-field-icon-prefix,[dir=rtl] .mat-mdc-form-field-icon-suffix{padding:0 4px 0 0}.mat-mdc-form-field-icon-suffix,[dir=rtl] .mat-mdc-form-field-icon-prefix{padding:0 0 0 4px}.mat-mdc-form-field-subscript-wrapper .mat-icon,.mat-mdc-form-field label .mat-icon{width:1em;height:1em;font-size:inherit}.mat-mdc-form-field-infix{flex:auto;min-width:0;width:180px;position:relative;box-sizing:border-box}.mat-mdc-form-field .mdc-notched-outline__notch{margin-left:-1px;-webkit-clip-path:inset(-9em -999em -9em 1px);clip-path:inset(-9em -999em -9em 1px)}[dir=rtl] .mat-mdc-form-field .mdc-notched-outline__notch{margin-left:0;margin-right:-1px;-webkit-clip-path:inset(-9em 1px -9em -999em);clip-path:inset(-9em 1px -9em -999em)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition-delay:40ms;transition-duration:110ms}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__affix{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled.mdc-ripple-upgraded--background-focused .mdc-text-field__ripple::before,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled:not(.mdc-ripple-upgraded):focus .mdc-text-field__ripple::before{transition-duration:75ms}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea{transition:none}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-filled 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-filled{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-outlined{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon{0%{transform:translateX(calc(0% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}}[dir=rtl] .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined[dir=rtl] .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon-rtl{0%{transform:translateX(calc(0% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-floating-label{transition:transform 150ms cubic-bezier(0.4, 0, 0.2, 1),color 150ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-standard 250ms 1}@keyframes mdc-floating-label-shake-float-above-standard{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-line-ripple::after{transition:transform 180ms cubic-bezier(0.4, 0, 0.2, 1),opacity 180ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-notched-outline .mdc-floating-label{max-width:calc(100% + 1px)}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:calc(133.3333333333% + 1px)}'],encapsulation:2,data:{animation:[Bz.transitionMessages]},changeDetection:0})}return e})(),V5=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Jn({imports:[nc,ku,$4,nc]})}return e})();const zz=new De("MAT_INPUT_VALUE_ACCESSOR"),qz=["button","checkbox","file","hidden","image","radio","range","reset","submit"];let Kz=0,Yz=(()=>{class e{get disabled(){return this._disabled}set disabled(t){this._disabled=Nb(t),this.focused&&(this.focused=!1,this.stateChanges.next())}get id(){return this._id}set id(t){this._id=t||this._uid}get required(){return this._required??this.ngControl?.control?.hasValidator(Wj.required)??!1}set required(t){this._required=Nb(t)}get type(){return this._type}set type(t){this._type=t||"text",this._validateType(),!this._isTextarea&&K4().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get errorStateMatcher(){return this._errorStateTracker.matcher}set errorStateMatcher(t){this._errorStateTracker.matcher=t}get value(){return this._inputValueAccessor.value}set value(t){t!==this.value&&(this._inputValueAccessor.value=t,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(t){this._readonly=Nb(t)}get errorState(){return this._errorStateTracker.errorState}set errorState(t){this._errorStateTracker.errorState=t}constructor(t,o,c,u,p,m,E,S,w,P){this._elementRef=t,this._platform=o,this.ngControl=c,this._autofillMonitor=S,this._formField=P,this._uid="mat-input-"+Kz++,this.focused=!1,this.stateChanges=new bn,this.controlType="mat-input",this.autofilled=!1,this._disabled=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(z=>K4().has(z)),this._iOSKeyupListener=z=>{const J=z.target;!J.value&&0===J.selectionStart&&0===J.selectionEnd&&(J.setSelectionRange(1,1),J.setSelectionRange(0,0))};const V=this._elementRef.nativeElement,H=V.nodeName.toLowerCase();this._inputValueAccessor=E||V,this._previousNativeValue=this.value,this.id=this.id,o.IOS&&w.runOutsideAngular(()=>{t.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._errorStateTracker=new f5(m,c,p,u,this.stateChanges),this._isServer=!this._platform.isBrowser,this._isNativeSelect="select"===H,this._isTextarea="textarea"===H,this._isInFormField=!!P,this._isNativeSelect&&(this.controlType=V.multiple?"mat-native-select-multiple":"mat-native-select")}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(t=>{this.autofilled=t.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener)}ngDoCheck(){this.ngControl&&(this.updateErrorState(),null!==this.ngControl.disabled&&this.ngControl.disabled!==this.disabled&&(this.disabled=this.ngControl.disabled,this.stateChanges.next())),this._dirtyCheckNativeValue(),this._dirtyCheckPlaceholder()}focus(t){this._elementRef.nativeElement.focus(t)}updateErrorState(){this._errorStateTracker.updateErrorState()}_focusChanged(t){t!==this.focused&&(this.focused=t,this.stateChanges.next())}_onInput(){}_dirtyCheckNativeValue(){const t=this._elementRef.nativeElement.value;this._previousNativeValue!==t&&(this._previousNativeValue=t,this.stateChanges.next())}_dirtyCheckPlaceholder(){const t=this._getPlaceholder();if(t!==this._previousPlaceholder){const o=this._elementRef.nativeElement;this._previousPlaceholder=t,t?o.setAttribute("placeholder",t):o.removeAttribute("placeholder")}}_getPlaceholder(){return this.placeholder||null}_validateType(){qz.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){let t=this._elementRef.nativeElement.validity;return t&&t.badInput}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}get shouldLabelFloat(){if(this._isNativeSelect){const t=this._elementRef.nativeElement,o=t.options[0];return this.focused||t.multiple||!this.empty||!!(t.selectedIndex>-1&&o&&o.label)}return this.focused||!this.empty}setDescribedByIds(t){t.length?this._elementRef.nativeElement.setAttribute("aria-describedby",t.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}_isInlineSelect(){const t=this._elementRef.nativeElement;return this._isNativeSelect&&(t.multiple||t.size>1)}static#e=this.\u0275fac=function(o){return new(o||e)(ae(en),ae(mo),ae(Uu,10),ae(fM,8),ae(bI,8),ae(L9),ae(zz,10),ae(Z9),ae(it),ae(k5,8))};static#t=this.\u0275dir=Ye({type:e,selectors:[["input","matInput",""],["textarea","matInput",""],["select","matNativeControl",""],["input","matNativeControl",""],["textarea","matNativeControl",""]],hostAttrs:[1,"mat-mdc-input-element"],hostVars:18,hostBindings:function(o,c){1&o&&mn("focus",function(){return c._focusChanged(!0)})("blur",function(){return c._focusChanged(!1)})("input",function(){return c._onInput()}),2&o&&(Am("id",c.id)("disabled",c.disabled)("required",c.required),Xi("name",c.name||null)("readonly",c.readonly&&!c._isNativeSelect||null)("aria-invalid",c.empty&&c.required?null:c.errorState)("aria-required",c.required)("id",c.id),Ht("mat-input-server",c._isServer)("mat-mdc-form-field-textarea-control",c._isInFormField&&c._isTextarea)("mat-mdc-form-field-input-control",c._isInFormField)("mdc-text-field__input",c._isInFormField)("mat-mdc-native-select-inline",c._isInlineSelect()))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:[Xe.None,"aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["matInput"],standalone:!0,features:[wn([{provide:x5,useExisting:e}]),So]})}return e})(),$z=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Jn({imports:[nc,V5,V5,ez,nc]})}return e})();const Xz=["switch"];function Jz(e,n){1&e&&(oe(0,"div",12),Qo(),oe(1,"svg",13),de(2,"path",14),Ee(),oe(3,"svg",15),de(4,"path",16),Ee()())}const Qz=["*"],Zz=new De("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1,hideIcon:!1})}),e7={provide:Zc,useExisting:Ln(()=>nV),multi:!0};class B5{constructor(n,t){this.source=n,this.checked=t}}let t7=0,nV=(()=>{class e{_createChangeEvent(t){return new B5(this,t)}get buttonId(){return`${this.id||this._uniqueId}-button`}focus(){this._switchElement.nativeElement.focus()}get checked(){return this._checked}set checked(t){this._checked=t,this._changeDetectorRef.markForCheck()}get inputId(){return`${this.id||this._uniqueId}-input`}constructor(t,o,c,u,p,m){this._elementRef=t,this._focusMonitor=o,this._changeDetectorRef=c,this.defaults=p,this._onChange=E=>{},this._onTouched=()=>{},this._validatorOnChange=()=>{},this._checked=!1,this.name=null,this.labelPosition="after",this.ariaLabel=null,this.ariaLabelledby=null,this.disabled=!1,this.disableRipple=!1,this.tabIndex=0,this.change=new hn,this.toggleChange=new hn,this.tabIndex=parseInt(u)||0,this.color=p.color||"accent",this._noopAnimations="NoopAnimations"===m,this.id=this._uniqueId="mat-mdc-slide-toggle-"+ ++t7,this.hideIcon=p.hideIcon??!1,this._labelId=this._uniqueId+"-label"}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{"keyboard"===t||"program"===t?(this._focused=!0,this._changeDetectorRef.markForCheck()):t||Promise.resolve().then(()=>{this._focused=!1,this._onTouched(),this._changeDetectorRef.markForCheck()})})}ngOnChanges(t){t.required&&this._validatorOnChange()}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}writeValue(t){this.checked=!!t}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}validate(t){return this.required&&!0!==t.value?{required:!0}:null}registerOnValidatorChange(t){this._validatorOnChange=t}setDisabledState(t){this.disabled=t,this._changeDetectorRef.markForCheck()}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(this._createChangeEvent(this.checked))}_handleClick(){this.toggleChange.emit(),this.defaults.disableToggleValue||(this.checked=!this.checked,this._onChange(this.checked),this.change.emit(new B5(this,this.checked)))}_getAriaLabelledBy(){return this.ariaLabelledby?this.ariaLabelledby:this.ariaLabel?null:this._labelId}static#e=this.\u0275fac=function(o){return new(o||e)(ae(en),ae(qU),ae(Us),function ah(e){return function _1(e,n){if("class"===n)return e.classes;if("style"===n)return e.styles;const t=e.attrs;if(t){const o=t.length;let c=0;for(;c<o;){const u=t[c];if(yw(u))break;if(0===u)c+=2;else if("number"==typeof u)for(c++;c<o&&"string"==typeof t[c];)c++;else{if(u===n)return t[c+1];c+=2}}}return null}(Nn(),e)}("tabindex"),ae(Zz),ae(yc,8))};static#t=this.\u0275cmp=Br({type:e,selectors:[["mat-slide-toggle"]],viewQuery:function(o,c){if(1&o&&ha(Xz,5),2&o){let u;Qi(u=ar())&&(c._switchElement=u.first)}},hostAttrs:[1,"mat-mdc-slide-toggle"],hostVars:13,hostBindings:function(o,c){2&o&&(Am("id",c.id),Xi("tabindex",null)("aria-label",null)("name",null)("aria-labelledby",null),Tm(c.color?"mat-"+c.color:""),Ht("mat-mdc-slide-toggle-focused",c._focused)("mat-mdc-slide-toggle-checked",c.checked)("_mat-animation-noopable",c._noopAnimations))},inputs:{name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:[Xe.None,"aria-label","ariaLabel"],ariaLabelledby:[Xe.None,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[Xe.None,"aria-describedby","ariaDescribedby"],required:[Xe.HasDecoratorInputTransform,"required","required",uo],color:"color",disabled:[Xe.HasDecoratorInputTransform,"disabled","disabled",uo],disableRipple:[Xe.HasDecoratorInputTransform,"disableRipple","disableRipple",uo],tabIndex:[Xe.HasDecoratorInputTransform,"tabIndex","tabIndex",t=>null==t?0:function _P(e,n=NaN){return isNaN(parseFloat(e))||isNaN(Number(e))?n:Number(e)}(t)],checked:[Xe.HasDecoratorInputTransform,"checked","checked",uo],hideIcon:[Xe.HasDecoratorInputTransform,"hideIcon","hideIcon",uo]},outputs:{change:"change",toggleChange:"toggleChange"},exportAs:["matSlideToggle"],standalone:!0,features:[wn([e7,{provide:to,useExisting:e,multi:!0}]),Pi,So,Gc],ngContentSelectors:Qz,decls:13,vars:24,consts:[["mat-internal-form-field","",3,"labelPosition"],["role","switch","type","button",1,"mdc-switch",3,"tabIndex","disabled","click"],["switch",""],[1,"mdc-switch__track"],[1,"mdc-switch__handle-track"],[1,"mdc-switch__handle"],[1,"mdc-switch__shadow"],[1,"mdc-elevation-overlay"],[1,"mdc-switch__ripple"],["mat-ripple","",1,"mat-mdc-slide-toggle-ripple","mat-mdc-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],["class","mdc-switch__icons"],[1,"mdc-label",3,"for","click"],[1,"mdc-switch__icons"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--on"],["d","M19.69,5.23L8.96,15.96l-4.23-4.23L2.96,13.5l6,6L21.46,7L19.69,5.23z"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--off"],["d","M20 13H4v-2h16v2z"]],template:function(o,c){if(1&o&&(Po(),oe(0,"div",0)(1,"button",1,2),mn("click",function(){return c._handleClick()}),de(3,"div",3),oe(4,"div",4)(5,"div",5)(6,"div",6),de(7,"div",7),Ee(),oe(8,"div",8),de(9,"div",9),Ee(),Tn(10,Jz,5,0,"div",10),Ee()()(),oe(11,"label",11),mn("click",function(p){return p.stopPropagation()}),xi(12),Ee()()),2&o){const u=Hm(2);Ze("labelPosition",c.labelPosition),Qe(),Ht("mdc-switch--selected",c.checked)("mdc-switch--unselected",!c.checked)("mdc-switch--checked",c.checked)("mdc-switch--disabled",c.disabled),Ze("tabIndex",c.disabled?-1:c.tabIndex)("disabled",c.disabled),Xi("id",c.buttonId)("name",c.name)("aria-label",c.ariaLabel)("aria-labelledby",c._getAriaLabelledBy())("aria-describedby",c.ariaDescribedby)("aria-required",c.required||null)("aria-checked",c.checked),Qe(8),Ze("matRippleTrigger",u)("matRippleDisabled",c.disableRipple||c.disabled)("matRippleCentered",!0),Qe(),we(10,c.hideIcon?-1:10),Qe(),Ze("for",c.buttonId),Xi("id",c._labelId)}},dependencies:[y5,G9],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1);background-color:var(--mdc-elevation-overlay-color)}.mdc-switch{align-items:center;background:none;border:none;cursor:pointer;display:inline-flex;flex-shrink:0;margin:0;outline:none;overflow:visible;padding:0;position:relative}.mdc-switch[hidden]{display:none}.mdc-switch:disabled{cursor:default;pointer-events:none}.mdc-switch__track{overflow:hidden;position:relative;width:100%}.mdc-switch__track::before,.mdc-switch__track::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";height:100%;left:0;position:absolute;width:100%}@media screen and (forced-colors: active){.mdc-switch__track::before,.mdc-switch__track::after{border-color:currentColor}}.mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(-100%)}[dir=rtl] .mdc-switch__track::after,.mdc-switch__track[dir=rtl]::after{transform:translateX(100%)}.mdc-switch--selected .mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__track::before,.mdc-switch--selected .mdc-switch__track[dir=rtl]::before{transform:translateX(-100%)}.mdc-switch--selected .mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__handle-track{height:100%;pointer-events:none;position:absolute;top:0;transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);left:0;right:auto;transform:translateX(0)}[dir=rtl] .mdc-switch__handle-track,.mdc-switch__handle-track[dir=rtl]{left:auto;right:0}.mdc-switch--selected .mdc-switch__handle-track{transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__handle-track,.mdc-switch--selected .mdc-switch__handle-track[dir=rtl]{transform:translateX(-100%)}.mdc-switch__handle{display:flex;pointer-events:auto;position:absolute;top:50%;transform:translateY(-50%);left:0;right:auto}[dir=rtl] .mdc-switch__handle,.mdc-switch__handle[dir=rtl]{left:auto;right:0}.mdc-switch__handle::before,.mdc-switch__handle::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";width:100%;height:100%;left:0;position:absolute;top:0;transition:background-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1),border-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);z-index:-1}@media screen and (forced-colors: active){.mdc-switch__handle::before,.mdc-switch__handle::after{border-color:currentColor}}.mdc-switch__shadow{border-radius:inherit;bottom:0;left:0;position:absolute;right:0;top:0}.mdc-elevation-overlay{bottom:0;left:0;right:0;top:0}.mdc-switch__ripple{left:50%;position:absolute;top:50%;transform:translate(-50%, -50%);z-index:-1}.mdc-switch:disabled .mdc-switch__ripple{display:none}.mdc-switch__icons{height:100%;position:relative;width:100%;z-index:1}.mdc-switch__icon{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0;opacity:0;transition:opacity 30ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-switch--selected .mdc-switch__icon--on,.mdc-switch--unselected .mdc-switch__icon--off{opacity:1;transition:opacity 45ms 30ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle .mdc-switch--disabled+label{color:var(--mdc-switch-disabled-label-text-color)}.mdc-switch{width:var(--mdc-switch-track-width)}.mdc-switch.mdc-switch--selected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-selected-handle-color)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-hover-handle-color)}.mdc-switch.mdc-switch--selected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-focus-handle-color)}.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-selected-pressed-handle-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-selected-handle-color)}.mdc-switch.mdc-switch--unselected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-unselected-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-hover-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-focus-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-unselected-pressed-handle-color)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-unselected-handle-color)}.mdc-switch .mdc-switch__handle::before{background:var(--mdc-switch-handle-surface-color)}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation)}.mdc-switch:disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation)}.mdc-switch .mdc-switch__focus-ring-wrapper,.mdc-switch .mdc-switch__handle{height:var(--mdc-switch-handle-height)}.mdc-switch:disabled .mdc-switch__handle::after{opacity:var(--mdc-switch-disabled-handle-opacity)}.mdc-switch .mdc-switch__handle{border-radius:var(--mdc-switch-handle-shape)}.mdc-switch .mdc-switch__handle{width:var(--mdc-switch-handle-width)}.mdc-switch .mdc-switch__handle-track{width:calc(100% - var(--mdc-switch-handle-width))}.mdc-switch.mdc-switch--selected:enabled .mdc-switch__icon{fill:var(--mdc-switch-selected-icon-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-selected-icon-color)}.mdc-switch.mdc-switch--unselected:enabled .mdc-switch__icon{fill:var(--mdc-switch-unselected-icon-color)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-unselected-icon-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-selected-icon-opacity)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-unselected-icon-opacity)}.mdc-switch.mdc-switch--selected .mdc-switch__icon{width:var(--mdc-switch-selected-icon-size);height:var(--mdc-switch-selected-icon-size)}.mdc-switch.mdc-switch--unselected .mdc-switch__icon{width:var(--mdc-switch-unselected-icon-size);height:var(--mdc-switch-unselected-icon-size)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-hover-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-focus-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-pressed-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-hover-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-focus-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-pressed-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-selected-hover-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-selected-focus-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-selected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-selected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-unselected-hover-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-unselected-focus-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity)}.mdc-switch .mdc-switch__ripple{height:var(--mdc-switch-state-layer-size);width:var(--mdc-switch-state-layer-size)}.mdc-switch .mdc-switch__track{height:var(--mdc-switch-track-height)}.mdc-switch:disabled .mdc-switch__track{opacity:var(--mdc-switch-disabled-track-opacity)}.mdc-switch:enabled .mdc-switch__track::after{background:var(--mdc-switch-selected-track-color)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-hover-track-color)}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-focus-track-color)}.mdc-switch:enabled:active .mdc-switch__track::after{background:var(--mdc-switch-selected-pressed-track-color)}.mdc-switch:disabled .mdc-switch__track::after{background:var(--mdc-switch-disabled-selected-track-color)}.mdc-switch:enabled .mdc-switch__track::before{background:var(--mdc-switch-unselected-track-color)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-hover-track-color)}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-focus-track-color)}.mdc-switch:enabled:active .mdc-switch__track::before{background:var(--mdc-switch-unselected-pressed-track-color)}.mdc-switch:disabled .mdc-switch__track::before{background:var(--mdc-switch-disabled-unselected-track-color)}.mdc-switch .mdc-switch__track{border-radius:var(--mdc-switch-track-shape)}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation-shadow)}.mdc-switch:disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation-shadow)}.mat-mdc-slide-toggle{display:inline-block;-webkit-tap-highlight-color:rgba(0,0,0,0);outline:0}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple,.mat-mdc-slide-toggle .mdc-switch__ripple::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:50%;pointer-events:none}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple:not(:empty),.mat-mdc-slide-toggle .mdc-switch__ripple::after:not(:empty){transform:translateZ(0)}.mat-mdc-slide-toggle .mdc-switch__ripple::after{content:"";opacity:0}.mat-mdc-slide-toggle .mdc-switch:hover .mdc-switch__ripple::after{opacity:.04;transition:opacity 75ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mdc-switch .mdc-switch__ripple::after{opacity:.12}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mat-mdc-focus-indicator::before{content:""}.mat-mdc-slide-toggle .mat-ripple-element{opacity:.12}.mat-mdc-slide-toggle .mat-mdc-focus-indicator::before{border-radius:50%}.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle-track,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-elevation-overlay,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__icon,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::after,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::after{transition:none}.mat-mdc-slide-toggle .mdc-switch:enabled+.mdc-label{cursor:pointer}'],encapsulation:2,changeDetection:0})}return e})(),r7=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Jn({imports:[nV,nc,nc]})}return e})();const o7=["addListener","removeListener"],s7=["addEventListener","removeEventListener"],a7=["on","off"];function iV(e,n,t,o){if(cn(t)&&(o=t,t=void 0),o)return iV(e,n,t).pipe(gU(o));const[c,u]=function l7(e){return cn(e.addEventListener)&&cn(e.removeEventListener)}(e)?s7.map(p=>m=>e[p](n,m,t)):function c7(e){return cn(e.addListener)&&cn(e.removeListener)}(e)?o7.map(j5(e,n)):function d7(e){return cn(e.on)&&cn(e.off)}(e)?a7.map(j5(e,n)):[];if(!c&&mU(e))return _o(p=>iV(p,n,t))(ws(e));if(!c)throw new TypeError("Invalid event target");return new Wn(p=>{const m=(...E)=>p.next(1<E.length?E:E[0]);return c(m),()=>u(m)})}function j5(e,n){return t=>o=>e[t](n,o)}const DI={schedule(e){let n=requestAnimationFrame,t=cancelAnimationFrame;const{delegate:o}=DI;o&&(n=o.requestAnimationFrame,t=o.cancelAnimationFrame);const c=n(u=>{t=void 0,e(u)});return new nr(()=>t?.(c))},requestAnimationFrame(...e){const{delegate:n}=DI;return(n?.requestAnimationFrame||requestAnimationFrame)(...e)},cancelAnimationFrame(...e){const{delegate:n}=DI;return(n?.cancelAnimationFrame||cancelAnimationFrame)(...e)},delegate:void 0};new class h7 extends HU{flush(n){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:o}=this;let c;n=n||o.shift();do{if(c=n.execute(n.state,n.delay))break}while((n=o[0])&&n.id===t&&o.shift());if(this._active=!1,c){for(;(n=o[0])&&n.id===t&&o.shift();)n.unsubscribe();throw c}}}(class u7 extends BU{constructor(n,t){super(n,t),this.scheduler=n,this.work=t}requestAsyncId(n,t,o=0){return null!==o&&o>0?super.requestAsyncId(n,t,o):(n.actions.push(this),n._scheduled||(n._scheduled=DI.requestAnimationFrame(()=>n.flush(void 0))))}recycleAsyncId(n,t,o=0){var c;if(null!=o?o>0:this.delay>0)return super.recycleAsyncId(n,t,o);const{actions:u}=n;null!=t&&(null===(c=u[u.length-1])||void 0===c?void 0:c.id)!==t&&(DI.cancelAnimationFrame(t),n._scheduled=void 0)}});let rV,f7=1;const RM={};function H5(e){return e in RM&&(delete RM[e],!0)}const m7={setImmediate(e){const n=f7++;return RM[n]=!0,rV||(rV=Promise.resolve()),rV.then(()=>H5(n)&&e()),n},clearImmediate(e){H5(e)}},{setImmediate:_7,clearImmediate:g7}=m7,AM={setImmediate(...e){const{delegate:n}=AM;return(n?.setImmediate||_7)(...e)},clearImmediate(e){const{delegate:n}=AM;return(n?.clearImmediate||g7)(e)},delegate:void 0};new class v7 extends HU{flush(n){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:o}=this;let c;n=n||o.shift();do{if(c=n.execute(n.state,n.delay))break}while((n=o[0])&&n.id===t&&o.shift());if(this._active=!1,c){for(;(n=o[0])&&n.id===t&&o.shift();)n.unsubscribe();throw c}}}(class E7 extends BU{constructor(n,t){super(n,t),this.scheduler=n,this.work=t}requestAsyncId(n,t,o=0){return null!==o&&o>0?super.requestAsyncId(n,t,o):(n.actions.push(this),n._scheduled||(n._scheduled=AM.setImmediate(n.flush.bind(n,void 0))))}recycleAsyncId(n,t,o=0){var c;if(null!=o?o>0:this.delay>0)return super.recycleAsyncId(n,t,o);const{actions:u}=n;null!=t&&(null===(c=u[u.length-1])||void 0===c?void 0:c.id)!==t&&(AM.clearImmediate(t),n._scheduled===t&&(n._scheduled=void 0))}});function G5(e,n=GU){return function y7(e){return Si((n,t)=>{let o=!1,c=null,u=null,p=!1;const m=()=>{if(u?.unsubscribe(),u=null,o){o=!1;const S=c;c=null,t.next(S)}p&&t.complete()},E=()=>{u=null,p&&t.complete()};n.subscribe(di(t,S=>{o=!0,c=S,u||ws(e(S)).subscribe(u=di(t,m,E))},()=>{p=!0,(!o||!u||u.closed)&&t.complete()}))})}(()=>function C7(e=0,n,t=i9){let o=-1;return null!=n&&(Uj(n)?t=n:o=n),new Wn(c=>{let u=function S7(e){return e instanceof Date&&!isNaN(e)}(e)?+e-t.now():e;u<0&&(u=0);let p=0;return t.schedule(function(){c.closed||(c.next(p++),0<=o?this.schedule(void 0,o):c.complete())},u)})}(e,n))}let W5=(()=>{class e{constructor(t,o,c){this._ngZone=t,this._platform=o,this._scrolled=new bn,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=c}register(t){this.scrollContainers.has(t)||this.scrollContainers.set(t,t.elementScrolled().subscribe(()=>this._scrolled.next(t)))}deregister(t){const o=this.scrollContainers.get(t);o&&(o.unsubscribe(),this.scrollContainers.delete(t))}scrolled(t=20){return this._platform.isBrowser?new Wn(o=>{this._globalSubscription||this._addGlobalListener();const c=t>0?this._scrolled.pipe(G5(t)).subscribe(o):this._scrolled.subscribe(o);return this._scrolledCount++,()=>{c.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):vt()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((t,o)=>this.deregister(o)),this._scrolled.complete()}ancestorScrolled(t,o){const c=this.getAncestorScrollContainers(t);return this.scrolled(o).pipe(Ea(u=>!u||c.indexOf(u)>-1))}getAncestorScrollContainers(t){const o=[];return this.scrollContainers.forEach((c,u)=>{this._scrollableContainsElement(u,t)&&o.push(u)}),o}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(t,o){let c=Gp(o),u=t.getElementRef().nativeElement;do{if(c==u)return!0}while(c=c.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>iV(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}static#e=this.\u0275fac=function(o){return new(o||e)(be(it),be(mo),be(on,8))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),z5=(()=>{class e{constructor(t,o,c){this._platform=t,this._change=new bn,this._changeListener=u=>{this._change.next(u)},this._document=c,o.runOutsideAngular(()=>{if(t.isBrowser){const u=this._getWindow();u.addEventListener("resize",this._changeListener),u.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const t=this._getWindow();t.removeEventListener("resize",this._changeListener),t.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const t={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),t}getViewportRect(){const t=this.getViewportScrollPosition(),{width:o,height:c}=this.getViewportSize();return{top:t.top,left:t.left,bottom:t.top+c,right:t.left+o,height:c,width:o}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const t=this._document,o=this._getWindow(),c=t.documentElement,u=c.getBoundingClientRect();return{top:-u.top||t.body.scrollTop||o.scrollY||c.scrollTop||0,left:-u.left||t.body.scrollLeft||o.scrollX||c.scrollLeft||0}}change(t=20){return t>0?this._change.pipe(G5(t)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const t=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:t.innerWidth,height:t.innerHeight}:{width:0,height:0}}static#e=this.\u0275fac=function(o){return new(o||e)(be(mo),be(it),be(on,8))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),oV=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Jn({})}return e})(),q5=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Jn({imports:[TI,oV,TI,oV]})}return e})();class sV{attach(n){return this._attachedHost=n,n.attach(this)}detach(){let n=this._attachedHost;null!=n&&(this._attachedHost=null,n.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(n){this._attachedHost=n}}class K5 extends sV{constructor(n,t,o,c,u){super(),this.component=n,this.viewContainerRef=t,this.injector=o,this.componentFactoryResolver=c,this.projectableNodes=u}}class w7 extends sV{constructor(n,t,o,c){super(),this.templateRef=n,this.viewContainerRef=t,this.context=o,this.injector=c}get origin(){return this.templateRef.elementRef}attach(n,t=this.context){return this.context=t,super.attach(n)}detach(){return this.context=void 0,super.detach()}}class R7 extends sV{constructor(n){super(),this.element=n instanceof en?n.nativeElement:n}}class A7{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(n){return n instanceof K5?(this._attachedPortal=n,this.attachComponentPortal(n)):n instanceof w7?(this._attachedPortal=n,this.attachTemplatePortal(n)):this.attachDomPortal&&n instanceof R7?(this._attachedPortal=n,this.attachDomPortal(n)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(n){this._disposeFn=n}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class D7 extends A7{constructor(n,t,o,c,u){super(),this.outletElement=n,this._componentFactoryResolver=t,this._appRef=o,this._defaultInjector=c,this.attachDomPortal=p=>{const m=p.element,E=this._document.createComment("dom-portal");m.parentNode.insertBefore(E,m),this.outletElement.appendChild(m),this._attachedPortal=p,super.setDisposeFn(()=>{E.parentNode&&E.parentNode.replaceChild(m,E)})},this._document=u}attachComponentPortal(n){const o=(n.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(n.component);let c;return n.viewContainerRef?(c=n.viewContainerRef.createComponent(o,n.viewContainerRef.length,n.injector||n.viewContainerRef.injector,n.projectableNodes||void 0),this.setDisposeFn(()=>c.destroy())):(c=o.create(n.injector||this._defaultInjector||pr.NULL),this._appRef.attachView(c.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(c.hostView),c.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(c)),this._attachedPortal=n,c}attachTemplatePortal(n){let t=n.viewContainerRef,o=t.createEmbeddedView(n.templateRef,n.context,{injector:n.injector});return o.rootNodes.forEach(c=>this.outletElement.appendChild(c)),o.detectChanges(),this.setDisposeFn(()=>{let c=t.indexOf(o);-1!==c&&t.remove(c)}),this._attachedPortal=n,o}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(n){return n.hostView.rootNodes[0]}}let O7=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Jn({})}return e})();const Y5=UW();class N7{constructor(n,t){this._viewportRuler=n,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=t}attach(){}enable(){if(this._canBeEnabled()){const n=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=n.style.left||"",this._previousHTMLStyles.top=n.style.top||"",n.style.left=Tr(-this._previousScrollPosition.left),n.style.top=Tr(-this._previousScrollPosition.top),n.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const n=this._document.documentElement,o=n.style,c=this._document.body.style,u=o.scrollBehavior||"",p=c.scrollBehavior||"";this._isEnabled=!1,o.left=this._previousHTMLStyles.left,o.top=this._previousHTMLStyles.top,n.classList.remove("cdk-global-scrollblock"),Y5&&(o.scrollBehavior=c.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),Y5&&(o.scrollBehavior=u,c.scrollBehavior=p)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const t=this._document.body,o=this._viewportRuler.getViewportSize();return t.scrollHeight>o.height||t.scrollWidth>o.width}}class P7{constructor(n,t,o,c){this._scrollDispatcher=n,this._ngZone=t,this._viewportRuler=o,this._config=c,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(n){this._overlayRef=n}enable(){if(this._scrollSubscription)return;const n=this._scrollDispatcher.scrolled(0).pipe(Ea(t=>!t||!this._overlayRef.overlayElement.contains(t.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=n.subscribe(()=>{const t=this._viewportRuler.getViewportScrollPosition().top;Math.abs(t-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=n.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class $5{enable(){}disable(){}attach(){}}function aV(e,n){return n.some(t=>e.bottom<t.top||e.top>t.bottom||e.right<t.left||e.left>t.right)}function X5(e,n){return n.some(t=>e.top<t.top||e.bottom>t.bottom||e.left<t.left||e.right>t.right)}class M7{constructor(n,t,o,c){this._scrollDispatcher=n,this._viewportRuler=t,this._ngZone=o,this._config=c,this._scrollSubscription=null}attach(n){this._overlayRef=n}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const t=this._overlayRef.overlayElement.getBoundingClientRect(),{width:o,height:c}=this._viewportRuler.getViewportSize();aV(t,[{width:o,height:c,bottom:c,right:o,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let x7=(()=>{class e{constructor(t,o,c,u){this._scrollDispatcher=t,this._viewportRuler=o,this._ngZone=c,this.noop=()=>new $5,this.close=p=>new P7(this._scrollDispatcher,this._ngZone,this._viewportRuler,p),this.block=()=>new N7(this._viewportRuler,this._document),this.reposition=p=>new M7(this._scrollDispatcher,this._viewportRuler,this._ngZone,p),this._document=u}static#e=this.\u0275fac=function(o){return new(o||e)(be(W5),be(z5),be(it),be(on))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class k7{constructor(n){if(this.scrollStrategy=new $5,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,n){const t=Object.keys(n);for(const o of t)void 0!==n[o]&&(this[o]=n[o])}}}class L7{constructor(n,t){this.connectionPair=n,this.scrollableViewProperties=t}}let J5=(()=>{class e{constructor(t){this._attachedOverlays=[],this._document=t}ngOnDestroy(){this.detach()}add(t){this.remove(t),this._attachedOverlays.push(t)}remove(t){const o=this._attachedOverlays.indexOf(t);o>-1&&this._attachedOverlays.splice(o,1),0===this._attachedOverlays.length&&this.detach()}static#e=this.\u0275fac=function(o){return new(o||e)(be(on))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),F7=(()=>{class e extends J5{constructor(t,o){super(t),this._ngZone=o,this._keydownListener=c=>{const u=this._attachedOverlays;for(let p=u.length-1;p>-1;p--)if(u[p]._keydownEvents.observers.length>0){const m=u[p]._keydownEvents;this._ngZone?this._ngZone.run(()=>m.next(c)):m.next(c);break}}}add(t){super.add(t),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}static#e=this.\u0275fac=function(o){return new(o||e)(be(on),be(it,8))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),U7=(()=>{class e extends J5{constructor(t,o,c){super(t),this._platform=o,this._ngZone=c,this._cursorStyleIsSet=!1,this._pointerDownListener=u=>{this._pointerDownEventTarget=Hp(u)},this._clickListener=u=>{const p=Hp(u),m="click"===u.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:p;this._pointerDownEventTarget=null;const E=this._attachedOverlays.slice();for(let S=E.length-1;S>-1;S--){const w=E[S];if(w._outsidePointerEvents.observers.length<1||!w.hasAttached())continue;if(w.overlayElement.contains(p)||w.overlayElement.contains(m))break;const P=w._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>P.next(u)):P.next(u)}}}add(t){if(super.add(t),!this._isAttached){const o=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(o)):this._addEventListeners(o),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=o.style.cursor,o.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const t=this._document.body;t.removeEventListener("pointerdown",this._pointerDownListener,!0),t.removeEventListener("click",this._clickListener,!0),t.removeEventListener("auxclick",this._clickListener,!0),t.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(t.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(t){t.addEventListener("pointerdown",this._pointerDownListener,!0),t.addEventListener("click",this._clickListener,!0),t.addEventListener("auxclick",this._clickListener,!0),t.addEventListener("contextmenu",this._clickListener,!0)}static#e=this.\u0275fac=function(o){return new(o||e)(be(on),be(mo),be(it,8))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Q5=(()=>{class e{constructor(t,o){this._platform=o,this._document=t}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const t="cdk-overlay-container";if(this._platform.isBrowser||VU()){const c=this._document.querySelectorAll(`.${t}[platform="server"], .${t}[platform="test"]`);for(let u=0;u<c.length;u++)c[u].remove()}const o=this._document.createElement("div");o.classList.add(t),VU()?o.setAttribute("platform","test"):this._platform.isBrowser||o.setAttribute("platform","server"),this._document.body.appendChild(o),this._containerElement=o}static#e=this.\u0275fac=function(o){return new(o||e)(be(on),be(mo))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class V7{constructor(n,t,o,c,u,p,m,E,S,w=!1){this._portalOutlet=n,this._host=t,this._pane=o,this._config=c,this._ngZone=u,this._keyboardDispatcher=p,this._document=m,this._location=E,this._outsideClickDispatcher=S,this._animationsDisabled=w,this._backdropElement=null,this._backdropClick=new bn,this._attachments=new bn,this._detachments=new bn,this._locationChanges=nr.EMPTY,this._backdropClickHandler=P=>this._backdropClick.next(P),this._backdropTransitionendHandler=P=>{this._disposeBackdrop(P.target)},this._keydownEvents=new bn,this._outsidePointerEvents=new bn,c.scrollStrategy&&(this._scrollStrategy=c.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=c.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(n){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const t=this._portalOutlet.attach(n);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Vu(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof t?.onDestroy&&t.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),t}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const n=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),n}dispose(){const n=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,n&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(n){n!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=n,this.hasAttached()&&(n.attach(this),this.updatePosition()))}updateSize(n){this._config={...this._config,...n},this._updateElementSize()}setDirection(n){this._config={...this._config,direction:n},this._updateElementDirection()}addPanelClass(n){this._pane&&this._toggleClasses(this._pane,n,!0)}removePanelClass(n){this._pane&&this._toggleClasses(this._pane,n,!1)}getDirection(){const n=this._config.direction;return n?"string"==typeof n?n:n.value:"ltr"}updateScrollStrategy(n){n!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=n,this.hasAttached()&&(n.attach(this),n.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const n=this._pane.style;n.width=Tr(this._config.width),n.height=Tr(this._config.height),n.minWidth=Tr(this._config.minWidth),n.minHeight=Tr(this._config.minHeight),n.maxWidth=Tr(this._config.maxWidth),n.maxHeight=Tr(this._config.maxHeight)}_togglePointerEvents(n){this._pane.style.pointerEvents=n?"":"none"}_attachBackdrop(){const n="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(n)})}):this._backdropElement.classList.add(n)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const n=this._backdropElement;if(n){if(this._animationsDisabled)return void this._disposeBackdrop(n);n.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{n.addEventListener("transitionend",this._backdropTransitionendHandler)}),n.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(n)},500))}}_toggleClasses(n,t,o){const c=_M(t||[]).filter(u=>!!u);c.length&&(o?n.classList.add(...c):n.classList.remove(...c))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const n=this._ngZone.onStable.pipe(Go(w5(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),n.unsubscribe())})})}_disposeScrollStrategy(){const n=this._scrollStrategy;n&&(n.disable(),n.detach&&n.detach())}_disposeBackdrop(n){n&&(n.removeEventListener("click",this._backdropClickHandler),n.removeEventListener("transitionend",this._backdropTransitionendHandler),n.remove(),this._backdropElement===n&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const Z5="cdk-overlay-connected-position-bounding-box",B7=/([A-Za-z%]+)$/;class j7{get positions(){return this._preferredPositions}constructor(n,t,o,c,u){this._viewportRuler=t,this._document=o,this._platform=c,this._overlayContainer=u,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new bn,this._resizeSubscription=nr.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(n)}attach(n){this._validatePositions(),n.hostElement.classList.add(Z5),this._overlayRef=n,this._boundingBox=n.hostElement,this._pane=n.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const n=this._originRect,t=this._overlayRect,o=this._viewportRect,c=this._containerRect,u=[];let p;for(let m of this._preferredPositions){let E=this._getOriginPoint(n,c,m),S=this._getOverlayPoint(E,t,m),w=this._getOverlayFit(S,t,o,m);if(w.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(m,E);this._canFitWithFlexibleDimensions(w,S,o)?u.push({position:m,origin:E,overlayRect:t,boundingBoxRect:this._calculateBoundingBoxRect(E,m)}):(!p||p.overlayFit.visibleArea<w.visibleArea)&&(p={overlayFit:w,overlayPoint:S,originPoint:E,position:m,overlayRect:t})}if(u.length){let m=null,E=-1;for(const S of u){const w=S.boundingBoxRect.width*S.boundingBoxRect.height*(S.position.weight||1);w>E&&(E=w,m=S)}return this._isPushed=!1,void this._applyPosition(m.position,m.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(p.position,p.originPoint);this._applyPosition(p.position,p.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&M_(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(Z5),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const n=this._lastPosition;if(n){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._getOriginPoint(this._originRect,this._containerRect,n);this._applyPosition(n,t)}else this.apply()}withScrollableContainers(n){return this._scrollables=n,this}withPositions(n){return this._preferredPositions=n,-1===n.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(n){return this._viewportMargin=n,this}withFlexibleDimensions(n=!0){return this._hasFlexibleDimensions=n,this}withGrowAfterOpen(n=!0){return this._growAfterOpen=n,this}withPush(n=!0){return this._canPush=n,this}withLockedPosition(n=!0){return this._positionLocked=n,this}setOrigin(n){return this._origin=n,this}withDefaultOffsetX(n){return this._offsetX=n,this}withDefaultOffsetY(n){return this._offsetY=n,this}withTransformOriginOn(n){return this._transformOriginSelector=n,this}_getOriginPoint(n,t,o){let c,u;if("center"==o.originX)c=n.left+n.width/2;else{const p=this._isRtl()?n.right:n.left,m=this._isRtl()?n.left:n.right;c="start"==o.originX?p:m}return t.left<0&&(c-=t.left),u="center"==o.originY?n.top+n.height/2:"top"==o.originY?n.top:n.bottom,t.top<0&&(u-=t.top),{x:c,y:u}}_getOverlayPoint(n,t,o){let c,u;return c="center"==o.overlayX?-t.width/2:"start"===o.overlayX?this._isRtl()?-t.width:0:this._isRtl()?0:-t.width,u="center"==o.overlayY?-t.height/2:"top"==o.overlayY?0:-t.height,{x:n.x+c,y:n.y+u}}_getOverlayFit(n,t,o,c){const u=t6(t);let{x:p,y:m}=n,E=this._getOffset(c,"x"),S=this._getOffset(c,"y");E&&(p+=E),S&&(m+=S);let V=0-m,H=m+u.height-o.height,z=this._subtractOverflows(u.width,0-p,p+u.width-o.width),J=this._subtractOverflows(u.height,V,H),ce=z*J;return{visibleArea:ce,isCompletelyWithinViewport:u.width*u.height===ce,fitsInViewportVertically:J===u.height,fitsInViewportHorizontally:z==u.width}}_canFitWithFlexibleDimensions(n,t,o){if(this._hasFlexibleDimensions){const c=o.bottom-t.y,u=o.right-t.x,p=e6(this._overlayRef.getConfig().minHeight),m=e6(this._overlayRef.getConfig().minWidth);return(n.fitsInViewportVertically||null!=p&&p<=c)&&(n.fitsInViewportHorizontally||null!=m&&m<=u)}return!1}_pushOverlayOnScreen(n,t,o){if(this._previousPushAmount&&this._positionLocked)return{x:n.x+this._previousPushAmount.x,y:n.y+this._previousPushAmount.y};const c=t6(t),u=this._viewportRect,p=Math.max(n.x+c.width-u.width,0),m=Math.max(n.y+c.height-u.height,0),E=Math.max(u.top-o.top-n.y,0),S=Math.max(u.left-o.left-n.x,0);let w=0,P=0;return w=c.width<=u.width?S||-p:n.x<this._viewportMargin?u.left-o.left-n.x:0,P=c.height<=u.height?E||-m:n.y<this._viewportMargin?u.top-o.top-n.y:0,this._previousPushAmount={x:w,y:P},{x:n.x+w,y:n.y+P}}_applyPosition(n,t){if(this._setTransformOrigin(n),this._setOverlayElementStyles(t,n),this._setBoundingBoxStyles(t,n),n.panelClass&&this._addPanelClasses(n.panelClass),this._lastPosition=n,this._positionChanges.observers.length){const o=this._getScrollVisibility(),c=new L7(n,o);this._positionChanges.next(c)}this._isInitialRender=!1}_setTransformOrigin(n){if(!this._transformOriginSelector)return;const t=this._boundingBox.querySelectorAll(this._transformOriginSelector);let o,c=n.overlayY;o="center"===n.overlayX?"center":this._isRtl()?"start"===n.overlayX?"right":"left":"start"===n.overlayX?"left":"right";for(let u=0;u<t.length;u++)t[u].style.transformOrigin=`${o} ${c}`}_calculateBoundingBoxRect(n,t){const o=this._viewportRect,c=this._isRtl();let u,p,m,w,P,V;if("top"===t.overlayY)p=n.y,u=o.height-p+this._viewportMargin;else if("bottom"===t.overlayY)m=o.height-n.y+2*this._viewportMargin,u=o.height-m+this._viewportMargin;else{const H=Math.min(o.bottom-n.y+o.top,n.y),z=this._lastBoundingBoxSize.height;u=2*H,p=n.y-H,u>z&&!this._isInitialRender&&!this._growAfterOpen&&(p=n.y-z/2)}if("end"===t.overlayX&&!c||"start"===t.overlayX&&c)V=o.width-n.x+this._viewportMargin,w=n.x-this._viewportMargin;else if("start"===t.overlayX&&!c||"end"===t.overlayX&&c)P=n.x,w=o.right-n.x;else{const H=Math.min(o.right-n.x+o.left,n.x),z=this._lastBoundingBoxSize.width;w=2*H,P=n.x-H,w>z&&!this._isInitialRender&&!this._growAfterOpen&&(P=n.x-z/2)}return{top:p,left:P,bottom:m,right:V,width:w,height:u}}_setBoundingBoxStyles(n,t){const o=this._calculateBoundingBoxRect(n,t);!this._isInitialRender&&!this._growAfterOpen&&(o.height=Math.min(o.height,this._lastBoundingBoxSize.height),o.width=Math.min(o.width,this._lastBoundingBoxSize.width));const c={};if(this._hasExactPosition())c.top=c.left="0",c.bottom=c.right=c.maxHeight=c.maxWidth="",c.width=c.height="100%";else{const u=this._overlayRef.getConfig().maxHeight,p=this._overlayRef.getConfig().maxWidth;c.height=Tr(o.height),c.top=Tr(o.top),c.bottom=Tr(o.bottom),c.width=Tr(o.width),c.left=Tr(o.left),c.right=Tr(o.right),c.alignItems="center"===t.overlayX?"center":"end"===t.overlayX?"flex-end":"flex-start",c.justifyContent="center"===t.overlayY?"center":"bottom"===t.overlayY?"flex-end":"flex-start",u&&(c.maxHeight=Tr(u)),p&&(c.maxWidth=Tr(p))}this._lastBoundingBoxSize=o,M_(this._boundingBox.style,c)}_resetBoundingBoxStyles(){M_(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){M_(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(n,t){const o={},c=this._hasExactPosition(),u=this._hasFlexibleDimensions,p=this._overlayRef.getConfig();if(c){const w=this._viewportRuler.getViewportScrollPosition();M_(o,this._getExactOverlayY(t,n,w)),M_(o,this._getExactOverlayX(t,n,w))}else o.position="static";let m="",E=this._getOffset(t,"x"),S=this._getOffset(t,"y");E&&(m+=`translateX(${E}px) `),S&&(m+=`translateY(${S}px)`),o.transform=m.trim(),p.maxHeight&&(c?o.maxHeight=Tr(p.maxHeight):u&&(o.maxHeight="")),p.maxWidth&&(c?o.maxWidth=Tr(p.maxWidth):u&&(o.maxWidth="")),M_(this._pane.style,o)}_getExactOverlayY(n,t,o){let c={top:"",bottom:""},u=this._getOverlayPoint(t,this._overlayRect,n);return this._isPushed&&(u=this._pushOverlayOnScreen(u,this._overlayRect,o)),"bottom"===n.overlayY?c.bottom=this._document.documentElement.clientHeight-(u.y+this._overlayRect.height)+"px":c.top=Tr(u.y),c}_getExactOverlayX(n,t,o){let p,c={left:"",right:""},u=this._getOverlayPoint(t,this._overlayRect,n);return this._isPushed&&(u=this._pushOverlayOnScreen(u,this._overlayRect,o)),p=this._isRtl()?"end"===n.overlayX?"left":"right":"end"===n.overlayX?"right":"left","right"===p?c.right=this._document.documentElement.clientWidth-(u.x+this._overlayRect.width)+"px":c.left=Tr(u.x),c}_getScrollVisibility(){const n=this._getOriginRect(),t=this._pane.getBoundingClientRect(),o=this._scrollables.map(c=>c.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:X5(n,o),isOriginOutsideView:aV(n,o),isOverlayClipped:X5(t,o),isOverlayOutsideView:aV(t,o)}}_subtractOverflows(n,...t){return t.reduce((o,c)=>o-Math.max(c,0),n)}_getNarrowedViewportRect(){const n=this._document.documentElement.clientWidth,t=this._document.documentElement.clientHeight,o=this._viewportRuler.getViewportScrollPosition();return{top:o.top+this._viewportMargin,left:o.left+this._viewportMargin,right:o.left+n-this._viewportMargin,bottom:o.top+t-this._viewportMargin,width:n-2*this._viewportMargin,height:t-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(n,t){return"x"===t?null==n.offsetX?this._offsetX:n.offsetX:null==n.offsetY?this._offsetY:n.offsetY}_validatePositions(){}_addPanelClasses(n){this._pane&&_M(n).forEach(t=>{""!==t&&-1===this._appliedPanelClasses.indexOf(t)&&(this._appliedPanelClasses.push(t),this._pane.classList.add(t))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(n=>{this._pane.classList.remove(n)}),this._appliedPanelClasses=[])}_getOriginRect(){const n=this._origin;if(n instanceof en)return n.nativeElement.getBoundingClientRect();if(n instanceof Element)return n.getBoundingClientRect();const t=n.width||0,o=n.height||0;return{top:n.y,bottom:n.y+o,left:n.x,right:n.x+t,height:o,width:t}}}function M_(e,n){for(let t in n)n.hasOwnProperty(t)&&(e[t]=n[t]);return e}function e6(e){if("number"!=typeof e&&null!=e){const[n,t]=e.split(B7);return t&&"px"!==t?null:parseFloat(n)}return e||null}function t6(e){return{top:Math.floor(e.top),right:Math.floor(e.right),bottom:Math.floor(e.bottom),left:Math.floor(e.left),width:Math.floor(e.width),height:Math.floor(e.height)}}const n6="cdk-global-overlay-wrapper";class H7{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(n){const t=n.getConfig();this._overlayRef=n,this._width&&!t.width&&n.updateSize({width:this._width}),this._height&&!t.height&&n.updateSize({height:this._height}),n.hostElement.classList.add(n6),this._isDisposed=!1}top(n=""){return this._bottomOffset="",this._topOffset=n,this._alignItems="flex-start",this}left(n=""){return this._xOffset=n,this._xPosition="left",this}bottom(n=""){return this._topOffset="",this._bottomOffset=n,this._alignItems="flex-end",this}right(n=""){return this._xOffset=n,this._xPosition="right",this}start(n=""){return this._xOffset=n,this._xPosition="start",this}end(n=""){return this._xOffset=n,this._xPosition="end",this}width(n=""){return this._overlayRef?this._overlayRef.updateSize({width:n}):this._width=n,this}height(n=""){return this._overlayRef?this._overlayRef.updateSize({height:n}):this._height=n,this}centerHorizontally(n=""){return this.left(n),this._xPosition="center",this}centerVertically(n=""){return this.top(n),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const n=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement.style,o=this._overlayRef.getConfig(),{width:c,height:u,maxWidth:p,maxHeight:m}=o,E=!("100%"!==c&&"100vw"!==c||p&&"100%"!==p&&"100vw"!==p),S=!("100%"!==u&&"100vh"!==u||m&&"100%"!==m&&"100vh"!==m),w=this._xPosition,P=this._xOffset,V="rtl"===this._overlayRef.getConfig().direction;let H="",z="",J="";E?J="flex-start":"center"===w?(J="center",V?z=P:H=P):V?"left"===w||"end"===w?(J="flex-end",H=P):("right"===w||"start"===w)&&(J="flex-start",z=P):"left"===w||"start"===w?(J="flex-start",H=P):("right"===w||"end"===w)&&(J="flex-end",z=P),n.position=this._cssPosition,n.marginLeft=E?"0":H,n.marginTop=S?"0":this._topOffset,n.marginBottom=this._bottomOffset,n.marginRight=E?"0":z,t.justifyContent=J,t.alignItems=S?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const n=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement,o=t.style;t.classList.remove(n6),o.justifyContent=o.alignItems=n.marginTop=n.marginBottom=n.marginLeft=n.marginRight=n.position="",this._overlayRef=null,this._isDisposed=!0}}let G7=(()=>{class e{constructor(t,o,c,u){this._viewportRuler=t,this._document=o,this._platform=c,this._overlayContainer=u}global(){return new H7}flexibleConnectedTo(t){return new j7(t,this._viewportRuler,this._document,this._platform,this._overlayContainer)}static#e=this.\u0275fac=function(o){return new(o||e)(be(z5),be(on),be(mo),be(Q5))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),W7=0,xb=(()=>{class e{constructor(t,o,c,u,p,m,E,S,w,P,V,H){this.scrollStrategies=t,this._overlayContainer=o,this._componentFactoryResolver=c,this._positionBuilder=u,this._keyboardDispatcher=p,this._injector=m,this._ngZone=E,this._document=S,this._directionality=w,this._location=P,this._outsideClickDispatcher=V,this._animationsModuleType=H}create(t){const o=this._createHostElement(),c=this._createPaneElement(o),u=this._createPortalOutlet(c),p=new k7(t);return p.direction=p.direction||this._directionality.value,new V7(u,o,c,p,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(t){const o=this._document.createElement("div");return o.id="cdk-overlay-"+W7++,o.classList.add("cdk-overlay-pane"),t.appendChild(o),o}_createHostElement(){const t=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(t),t}_createPortalOutlet(t){return this._appRef||(this._appRef=this._injector.get(Yr)),new D7(t,this._componentFactoryResolver,this._appRef,this._injector,this._document)}static#e=this.\u0275fac=function(o){return new(o||e)(be(x7),be(Q5),be(Mh),be(G7),be(F7),be(pr),be(it),be(on),be(YU),be(Hi),be(U7),be(yc,8))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const K7={provide:new De("cdk-connected-overlay-scroll-strategy",{providedIn:"root",factory:()=>{const e=Te(xb);return()=>e.scrollStrategies.reposition()}}),deps:[xb],useFactory:function q7(e){return()=>e.scrollStrategies.reposition()}};let Y7=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Jn({providers:[xb,K7],imports:[TI,O7,q5,q5]})}return e})();const $7=["tooltip"],r6=new De("mat-tooltip-scroll-strategy",{providedIn:"root",factory:()=>{const e=Te(xb);return()=>e.scrollStrategies.reposition({scrollThrottle:20})}}),J7={provide:r6,deps:[xb],useFactory:function X7(e){return()=>e.scrollStrategies.reposition({scrollThrottle:20})}},Z7=new De("mat-tooltip-default-options",{providedIn:"root",factory:function Q7(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}}),o6="tooltip-panel",s6=Ob({passive:!0});let oq=(()=>{class e{get position(){return this._position}set position(t){t!==this._position&&(this._position=t,this._overlayRef&&(this._updatePosition(this._overlayRef),this._tooltipInstance?.show(0),this._overlayRef.updatePosition()))}get positionAtOrigin(){return this._positionAtOrigin}set positionAtOrigin(t){this._positionAtOrigin=Nb(t),this._detach(),this._overlayRef=null}get disabled(){return this._disabled}set disabled(t){this._disabled=Nb(t),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(t){this._showDelay=X4(t)}get hideDelay(){return this._hideDelay}set hideDelay(t){this._hideDelay=X4(t),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(t){this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=null!=t?String(t).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this.message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(t){this._tooltipClass=t,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}constructor(t,o,c,u,p,m,E,S,w,P,V,H){this._overlay=t,this._elementRef=o,this._scrollDispatcher=c,this._viewContainerRef=u,this._ngZone=p,this._platform=m,this._ariaDescriber=E,this._focusMonitor=S,this._dir=P,this._defaultOptions=V,this._position="below",this._positionAtOrigin=!1,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._tooltipComponent=sq,this._viewportMargin=8,this._cssClassPrefix="mat-mdc",this.touchGestures="auto",this._message="",this._passiveListeners=[],this._destroyed=new bn,this._scrollStrategy=w,this._document=H,V&&(this._showDelay=V.showDelay,this._hideDelay=V.hideDelay,V.position&&(this.position=V.position),V.positionAtOrigin&&(this.positionAtOrigin=V.positionAtOrigin),V.touchGestures&&(this.touchGestures=V.touchGestures)),P.change.pipe(Go(this._destroyed)).subscribe(()=>{this._overlayRef&&this._updatePosition(this._overlayRef)}),this._viewportMargin=8}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(Go(this._destroyed)).subscribe(t=>{t?"keyboard"===t&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const t=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([o,c])=>{t.removeEventListener(o,c,s6)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),this._ariaDescriber.removeDescription(t,this.message,"tooltip"),this._focusMonitor.stopMonitoring(t)}show(t=this.showDelay,o){if(this.disabled||!this.message||this._isTooltipVisible())return void this._tooltipInstance?._cancelPendingAnimations();const c=this._createOverlay(o);this._detach(),this._portal=this._portal||new K5(this._tooltipComponent,this._viewContainerRef);const u=this._tooltipInstance=c.attach(this._portal).instance;u._triggerElement=this._elementRef.nativeElement,u._mouseLeaveHideDelay=this._hideDelay,u.afterHidden().pipe(Go(this._destroyed)).subscribe(()=>this._detach()),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),u.show(t)}hide(t=this.hideDelay){const o=this._tooltipInstance;o&&(o.isVisible()?o.hide(t):(o._cancelPendingAnimations(),this._detach()))}toggle(t){this._isTooltipVisible()?this.hide():this.show(void 0,t)}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(t){if(this._overlayRef){const u=this._overlayRef.getConfig().positionStrategy;if((!this.positionAtOrigin||!t)&&u._origin instanceof en)return this._overlayRef;this._detach()}const o=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),c=this._overlay.position().flexibleConnectedTo(this.positionAtOrigin&&t||this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(o);return c.positionChanges.pipe(Go(this._destroyed)).subscribe(u=>{this._updateCurrentPositionClass(u.connectionPair),this._tooltipInstance&&u.scrollableViewProperties.isOverlayClipped&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({direction:this._dir,positionStrategy:c,panelClass:`${this._cssClassPrefix}-${o6}`,scrollStrategy:this._scrollStrategy()}),this._updatePosition(this._overlayRef),this._overlayRef.detachments().pipe(Go(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.outsidePointerEvents().pipe(Go(this._destroyed)).subscribe(()=>this._tooltipInstance?._handleBodyInteraction()),this._overlayRef.keydownEvents().pipe(Go(this._destroyed)).subscribe(u=>{this._isTooltipVisible()&&27===u.keyCode&&!function KW(e,...n){return n.length?n.some(t=>e[t]):e.altKey||e.shiftKey||e.ctrlKey||e.metaKey}(u)&&(u.preventDefault(),u.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._defaultOptions?.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}_updatePosition(t){const o=t.getConfig().positionStrategy,c=this._getOrigin(),u=this._getOverlayPosition();o.withPositions([this._addOffset({...c.main,...u.main}),this._addOffset({...c.fallback,...u.fallback})])}_addOffset(t){const c=!this._dir||"ltr"==this._dir.value;return"top"===t.originY?t.offsetY=-8:"bottom"===t.originY?t.offsetY=8:"start"===t.originX?t.offsetX=c?-8:8:"end"===t.originX&&(t.offsetX=c?8:-8),t}_getOrigin(){const t=!this._dir||"ltr"==this._dir.value,o=this.position;let c;"above"==o||"below"==o?c={originX:"center",originY:"above"==o?"top":"bottom"}:"before"==o||"left"==o&&t||"right"==o&&!t?c={originX:"start",originY:"center"}:("after"==o||"right"==o&&t||"left"==o&&!t)&&(c={originX:"end",originY:"center"});const{x:u,y:p}=this._invertPosition(c.originX,c.originY);return{main:c,fallback:{originX:u,originY:p}}}_getOverlayPosition(){const t=!this._dir||"ltr"==this._dir.value,o=this.position;let c;"above"==o?c={overlayX:"center",overlayY:"bottom"}:"below"==o?c={overlayX:"center",overlayY:"top"}:"before"==o||"left"==o&&t||"right"==o&&!t?c={overlayX:"end",overlayY:"center"}:("after"==o||"right"==o&&t||"left"==o&&!t)&&(c={overlayX:"start",overlayY:"center"});const{x:u,y:p}=this._invertPosition(c.overlayX,c.overlayY);return{main:c,fallback:{overlayX:u,overlayY:p}}}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(Vu(1),Go(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(t){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=t,this._tooltipInstance._markForCheck())}_invertPosition(t,o){return"above"===this.position||"below"===this.position?"top"===o?o="bottom":"bottom"===o&&(o="top"):"end"===t?t="start":"start"===t&&(t="end"),{x:t,y:o}}_updateCurrentPositionClass(t){const{overlayY:o,originX:c,originY:u}=t;let p;if(p="center"===o?this._dir&&"rtl"===this._dir.value?"end"===c?"left":"right":"start"===c?"left":"right":"bottom"===o&&"top"===u?"above":"below",p!==this._currentPosition){const m=this._overlayRef;if(m){const E=`${this._cssClassPrefix}-${o6}-`;m.removePanelClass(E+this._currentPosition),m.addPanelClass(E+p)}this._currentPosition=p}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||(this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",t=>{let o;this._setupPointerExitEventsIfNeeded(),void 0!==t.x&&void 0!==t.y&&(o=t),this.show(void 0,o)}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",t=>{const o=t.targetTouches?.[0],c=o?{x:o.clientX,y:o.clientY}:void 0;this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(void 0,c),500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const t=[];if(this._platformSupportsMouseEvents())t.push(["mouseleave",o=>{const c=o.relatedTarget;(!c||!this._overlayRef?.overlayElement.contains(c))&&this.hide()}],["wheel",o=>this._wheelListener(o)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const o=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};t.push(["touchend",o],["touchcancel",o])}this._addListeners(t),this._passiveListeners.push(...t)}_addListeners(t){t.forEach(([o,c])=>{this._elementRef.nativeElement.addEventListener(o,c,s6)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(t){if(this._isTooltipVisible()){const o=this._document.elementFromPoint(t.clientX,t.clientY),c=this._elementRef.nativeElement;o!==c&&!c.contains(o)&&this.hide()}}_disableNativeGesturesIfNecessary(){const t=this.touchGestures;if("off"!==t){const o=this._elementRef.nativeElement,c=o.style;("on"===t||"INPUT"!==o.nodeName&&"TEXTAREA"!==o.nodeName)&&(c.userSelect=c.msUserSelect=c.webkitUserSelect=c.MozUserSelect="none"),("on"===t||!o.draggable)&&(c.webkitUserDrag="none"),c.touchAction="none",c.webkitTapHighlightColor="transparent"}}static#e=this.\u0275fac=function(o){return new(o||e)(ae(xb),ae(en),ae(W5),ae(mr),ae(it),ae(mo),ae(u9),ae(qU),ae(r6),ae(YU),ae(Z7,8),ae(on))};static#t=this.\u0275dir=Ye({type:e,selectors:[["","matTooltip",""]],hostAttrs:[1,"mat-mdc-tooltip-trigger"],hostVars:2,hostBindings:function(o,c){2&o&&Ht("mat-mdc-tooltip-disabled",c.disabled)},inputs:{position:[Xe.None,"matTooltipPosition","position"],positionAtOrigin:[Xe.None,"matTooltipPositionAtOrigin","positionAtOrigin"],disabled:[Xe.None,"matTooltipDisabled","disabled"],showDelay:[Xe.None,"matTooltipShowDelay","showDelay"],hideDelay:[Xe.None,"matTooltipHideDelay","hideDelay"],touchGestures:[Xe.None,"matTooltipTouchGestures","touchGestures"],message:[Xe.None,"matTooltip","message"],tooltipClass:[Xe.None,"matTooltipClass","tooltipClass"]},exportAs:["matTooltip"],standalone:!0})}return e})(),sq=(()=>{class e{constructor(t,o,c){this._changeDetectorRef=t,this._elementRef=o,this._isMultiline=!1,this._closeOnInteraction=!1,this._isVisible=!1,this._onHide=new bn,this._showAnimation="mat-mdc-tooltip-show",this._hideAnimation="mat-mdc-tooltip-hide",this._animationsDisabled="NoopAnimations"===c}show(t){null!=this._hideTimeoutId&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=setTimeout(()=>{this._toggleVisibility(!0),this._showTimeoutId=void 0},t)}hide(t){null!=this._showTimeoutId&&clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0},t)}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){this._cancelPendingAnimations(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:t}){(!t||!this._triggerElement.contains(t))&&(this.isVisible()?this.hide(this._mouseLeaveHideDelay):this._finalizeAnimation(!1))}_onShow(){this._isMultiline=this._isTooltipMultiline(),this._markForCheck()}_isTooltipMultiline(){const t=this._elementRef.nativeElement.getBoundingClientRect();return t.height>24&&t.width>=200}_handleAnimationEnd({animationName:t}){(t===this._showAnimation||t===this._hideAnimation)&&this._finalizeAnimation(t===this._showAnimation)}_cancelPendingAnimations(){null!=this._showTimeoutId&&clearTimeout(this._showTimeoutId),null!=this._hideTimeoutId&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=this._hideTimeoutId=void 0}_finalizeAnimation(t){t?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next()}_toggleVisibility(t){const o=this._tooltip.nativeElement,c=this._showAnimation,u=this._hideAnimation;if(o.classList.remove(t?u:c),o.classList.add(t?c:u),this._isVisible=t,t&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const p=getComputedStyle(o);("0s"===p.getPropertyValue("animation-duration")||"none"===p.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}t&&this._onShow(),this._animationsDisabled&&(o.classList.add("_mat-animation-noopable"),this._finalizeAnimation(t))}static#e=this.\u0275fac=function(o){return new(o||e)(ae(Us),ae(en),ae(yc,8))};static#t=this.\u0275cmp=Br({type:e,selectors:[["mat-tooltip-component"]],viewQuery:function(o,c){if(1&o&&ha($7,7),2&o){let u;Qi(u=ar())&&(c._tooltip=u.first)}},hostAttrs:["aria-hidden","true"],hostVars:2,hostBindings:function(o,c){1&o&&mn("mouseleave",function(p){return c._handleMouseLeave(p)}),2&o&&_v("zoom",c.isVisible()?1:null)},standalone:!0,features:[Gc],decls:4,vars:4,consts:[[1,"mdc-tooltip","mdc-tooltip--shown","mat-mdc-tooltip",3,"ngClass","animationend"],["tooltip",""],[1,"mdc-tooltip__surface","mdc-tooltip__surface-animation"]],template:function(o,c){1&o&&(oe(0,"div",0,1),mn("animationend",function(p){return c._handleAnimationEnd(p)}),oe(2,"div",2),br(3),Ee()()),2&o&&(Ht("mdc-tooltip--multiline",c._isMultiline),Ze("ngClass",c.tooltipClass),Qe(3),uu(c.message))},dependencies:[Y0],styles:['.mdc-tooltip__surface{word-break:break-all;word-break:var(--mdc-tooltip-word-break, normal);overflow-wrap:anywhere}.mdc-tooltip--showing-transition .mdc-tooltip__surface-animation{transition:opacity 150ms 0ms cubic-bezier(0, 0, 0.2, 1),transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-tooltip--hide-transition .mdc-tooltip__surface-animation{transition:opacity 75ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-tooltip{position:fixed;display:none;z-index:9}.mdc-tooltip-wrapper--rich{position:relative}.mdc-tooltip--shown,.mdc-tooltip--showing,.mdc-tooltip--hide{display:inline-flex}.mdc-tooltip--shown.mdc-tooltip--rich,.mdc-tooltip--showing.mdc-tooltip--rich,.mdc-tooltip--hide.mdc-tooltip--rich{display:inline-block;left:-320px;position:absolute}.mdc-tooltip__surface{line-height:16px;padding:4px 8px;min-width:40px;max-width:200px;min-height:24px;max-height:40vh;box-sizing:border-box;overflow:hidden;text-align:center}.mdc-tooltip__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-tooltip__surface::before{border-color:CanvasText}}.mdc-tooltip--rich .mdc-tooltip__surface{align-items:flex-start;display:flex;flex-direction:column;min-height:24px;min-width:40px;max-width:320px;position:relative}.mdc-tooltip--multiline .mdc-tooltip__surface{text-align:left}[dir=rtl] .mdc-tooltip--multiline .mdc-tooltip__surface,.mdc-tooltip--multiline .mdc-tooltip__surface[dir=rtl]{text-align:right}.mdc-tooltip__surface .mdc-tooltip__title{margin:0 8px}.mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(200px - 2*8px);margin:8px;text-align:left}[dir=rtl] .mdc-tooltip__surface .mdc-tooltip__content,.mdc-tooltip__surface .mdc-tooltip__content[dir=rtl]{text-align:right}.mdc-tooltip--rich .mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(320px - 2*8px);align-self:stretch}.mdc-tooltip__surface .mdc-tooltip__content-link{text-decoration:none}.mdc-tooltip--rich-actions,.mdc-tooltip__content,.mdc-tooltip__title{z-index:1}.mdc-tooltip__surface-animation{opacity:0;transform:scale(0.8);will-change:transform,opacity}.mdc-tooltip--shown .mdc-tooltip__surface-animation{transform:scale(1);opacity:1}.mdc-tooltip--hide .mdc-tooltip__surface-animation{transform:scale(1)}.mdc-tooltip__caret-surface-top,.mdc-tooltip__caret-surface-bottom{position:absolute;height:24px;width:24px;transform:rotate(35deg) skewY(20deg) scaleX(0.9396926208)}.mdc-tooltip__caret-surface-top .mdc-elevation-overlay,.mdc-tooltip__caret-surface-bottom .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-tooltip__caret-surface-bottom{box-shadow:0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12);outline:1px solid rgba(0,0,0,0);z-index:-1}@media screen and (forced-colors: active){.mdc-tooltip__caret-surface-bottom{outline-color:CanvasText}}.mat-mdc-tooltip .mdc-tooltip__surface{background-color:var(--mdc-plain-tooltip-container-color)}.mat-mdc-tooltip .mdc-tooltip__surface{border-radius:var(--mdc-plain-tooltip-container-shape)}.mat-mdc-tooltip .mdc-tooltip__caret-surface-top,.mat-mdc-tooltip .mdc-tooltip__caret-surface-bottom{border-radius:var(--mdc-plain-tooltip-container-shape)}.mat-mdc-tooltip .mdc-tooltip__surface{color:var(--mdc-plain-tooltip-supporting-text-color)}.mat-mdc-tooltip .mdc-tooltip__surface{font-family:var(--mdc-plain-tooltip-supporting-text-font);line-height:var(--mdc-plain-tooltip-supporting-text-line-height);font-size:var(--mdc-plain-tooltip-supporting-text-size);font-weight:var(--mdc-plain-tooltip-supporting-text-weight);letter-spacing:var(--mdc-plain-tooltip-supporting-text-tracking)}.mat-mdc-tooltip{position:relative;transform:scale(0)}.mat-mdc-tooltip::before{content:"";top:0;right:0;bottom:0;left:0;z-index:-1;position:absolute}.mat-mdc-tooltip-panel-below .mat-mdc-tooltip::before{top:-8px}.mat-mdc-tooltip-panel-above .mat-mdc-tooltip::before{bottom:-8px}.mat-mdc-tooltip-panel-right .mat-mdc-tooltip::before{left:-8px}.mat-mdc-tooltip-panel-left .mat-mdc-tooltip::before{right:-8px}.mat-mdc-tooltip._mat-animation-noopable{animation:none;transform:scale(1)}.mat-mdc-tooltip-panel.mat-mdc-tooltip-panel-non-interactive{pointer-events:none}@keyframes mat-mdc-tooltip-show{0%{opacity:0;transform:scale(0.8)}100%{opacity:1;transform:scale(1)}}@keyframes mat-mdc-tooltip-hide{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0.8)}}.mat-mdc-tooltip-show{animation:mat-mdc-tooltip-show 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-mdc-tooltip-hide{animation:mat-mdc-tooltip-hide 75ms cubic-bezier(0.4, 0, 1, 1) forwards}'],encapsulation:2,changeDetection:0})}return e})(),aq=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Jn({providers:[J7],imports:[S9,ku,Y7,nc,nc,oV]})}return e})();function a6(e){return new pe(3e3,!1)}function Wp(e){switch(e.length){case 0:return new AI;case 1:return e[0];default:return new R5(e)}}function c6(e,n,t=new Map,o=new Map){const c=[],u=[];let p=-1,m=null;if(n.forEach(E=>{const S=E.get("offset"),w=S==p,P=w&&m||new Map;E.forEach((V,H)=>{let z=H,J=V;if("offset"!==H)switch(z=e.normalizePropertyName(z,c),J){case"!":J=t.get(H);break;case Bu:J=o.get(H);break;default:J=e.normalizeStyleValue(H,z,J,c)}P.set(z,J)}),w||u.push(P),m=P,p=S}),c.length)throw function Oq(e){return new pe(3502,!1)}();return u}function cV(e,n,t,o){switch(n){case"start":e.onStart(()=>o(t&&dV(t,"start",e)));break;case"done":e.onDone(()=>o(t&&dV(t,"done",e)));break;case"destroy":e.onDestroy(()=>o(t&&dV(t,"destroy",e)))}}function dV(e,n,t){const u=lV(e.element,e.triggerName,e.fromState,e.toState,n||e.phaseName,t.totalTime??e.totalTime,!!t.disabled),p=e._data;return null!=p&&(u._data=p),u}function lV(e,n,t,o,c="",u=0,p){return{element:e,triggerName:n,fromState:t,toState:o,phaseName:c,totalTime:u,disabled:!!p}}function va(e,n,t){let o=e.get(n);return o||e.set(n,o=t),o}function d6(e){const n=e.indexOf(":");return[e.substring(1,n),e.slice(n+1)]}const Hq=typeof document>"u"?null:document.documentElement;function uV(e){const n=e.parentNode||e.host||null;return n===Hq?null:n}let x_=null,l6=!1;function u6(e,n){for(;n;){if(n===e)return!0;n=uV(n)}return!1}function h6(e,n,t){if(t)return Array.from(e.querySelectorAll(n));const o=e.querySelector(n);return o?[o]:[]}let hV=(()=>{class e{validateStyleProperty(t){return function Wq(e){x_||(x_=function zq(){return typeof document<"u"?document.body:null}()||{},l6=!!x_.style&&"WebkitAppearance"in x_.style);let n=!0;return x_.style&&!function Gq(e){return"ebkit"==e.substring(1,6)}(e)&&(n=e in x_.style,!n&&l6&&(n="Webkit"+e.charAt(0).toUpperCase()+e.slice(1)in x_.style)),n}(t)}matchesElement(t,o){return!1}containsElement(t,o){return u6(t,o)}getParentElement(t){return uV(t)}query(t,o,c){return h6(t,o,c)}computeStyle(t,o,c){return c||""}animate(t,o,c,u,p,m=[],E){return new AI(c,u)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})();class pV{static#e=this.NOOP=new hV}class fV{}const Kq=1e3,mV="ng-enter",DM="ng-leave",OM="ng-trigger",NM=".ng-trigger",f6="ng-animating",_V=".ng-animating";function ju(e){if("number"==typeof e)return e;const n=e.match(/^(-?[\.\d]+)(m?s)/);return!n||n.length<2?0:gV(parseFloat(n[1]),n[2])}function gV(e,n){return"s"===n?e*Kq:e}function PM(e,n,t){return e.hasOwnProperty("duration")?e:function $q(e,n,t){let c,u=0,p="";if("string"==typeof e){const m=e.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===m)return n.push(a6()),{duration:0,delay:0,easing:""};c=gV(parseFloat(m[1]),m[2]);const E=m[3];null!=E&&(u=gV(parseFloat(E),m[4]));const S=m[5];S&&(p=S)}else c=e;if(!t){let m=!1,E=n.length;c<0&&(n.push(function cq(){return new pe(3100,!1)}()),m=!0),u<0&&(n.push(function dq(){return new pe(3101,!1)}()),m=!0),m&&n.splice(E,0,a6())}return{duration:c,delay:u,easing:p}}(e,n,t)}function cl(e,n,t){n.forEach((o,c)=>{const u=vV(c);t&&!t.has(c)&&t.set(c,e.style[u]),e.style[u]=o})}function k_(e,n){n.forEach((t,o)=>{const c=vV(o);e.style[c]=""})}function OI(e){return Array.isArray(e)?1==e.length?e[0]:function sz(e,n=null){return{type:bt.Sequence,steps:e,options:n}}(e):e}const EV=new RegExp("{{\\s*(.+?)\\s*}}","g");function _6(e){let n=[];if("string"==typeof e){let t;for(;t=EV.exec(e);)n.push(t[1]);EV.lastIndex=0}return n}function NI(e,n,t){const o=`${e}`,c=o.replace(EV,(u,p)=>{let m=n[p];return null==m&&(t.push(function uq(e){return new pe(3003,!1)}()),m=""),m.toString()});return c==o?e:c}const Qq=/-+([a-z0-9])/g;function vV(e){return e.replace(Qq,(...n)=>n[1].toUpperCase())}function ba(e,n,t){switch(n.type){case bt.Trigger:return e.visitTrigger(n,t);case bt.State:return e.visitState(n,t);case bt.Transition:return e.visitTransition(n,t);case bt.Sequence:return e.visitSequence(n,t);case bt.Group:return e.visitGroup(n,t);case bt.Animate:return e.visitAnimate(n,t);case bt.Keyframes:return e.visitKeyframes(n,t);case bt.Style:return e.visitStyle(n,t);case bt.Reference:return e.visitReference(n,t);case bt.AnimateChild:return e.visitAnimateChild(n,t);case bt.AnimateRef:return e.visitAnimateRef(n,t);case bt.Query:return e.visitQuery(n,t);case bt.Stagger:return e.visitStagger(n,t);default:throw function hq(e){return new pe(3004,!1)}()}}function bV(e,n){return window.getComputedStyle(e)[n]}const tK=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class g6 extends fV{normalizePropertyName(n,t){return vV(n)}normalizeStyleValue(n,t,o,c){let u="";const p=o.toString().trim();if(tK.has(t)&&0!==o&&"0"!==o)if("number"==typeof o)u="px";else{const m=o.match(/^[+-]?[\d\.]+([a-z]*)$/);m&&0==m[1].length&&c.push(function pq(e,n){return new pe(3005,!1)}())}return p+u}}const MM="*";const xM=new Set(["true","1"]),kM=new Set(["false","0"]);function E6(e,n){const t=xM.has(e)||kM.has(e),o=xM.has(n)||kM.has(n);return(c,u)=>{let p=e==MM||e==c,m=n==MM||n==u;return!p&&t&&"boolean"==typeof c&&(p=c?xM.has(e):kM.has(e)),!m&&o&&"boolean"==typeof u&&(m=u?xM.has(n):kM.has(n)),p&&m}}const oK=new RegExp("s*:selfs*,?","g");function yV(e,n,t,o){return new sK(e).build(n,t,o)}class sK{constructor(n){this._driver=n}build(n,t,o){const c=new dK(t);return this._resetContextStyleTimingState(c),ba(this,OI(n),c)}_resetContextStyleTimingState(n){n.currentQuerySelector="",n.collectedStyles=new Map,n.collectedStyles.set("",new Map),n.currentTime=0}visitTrigger(n,t){let o=t.queryCount=0,c=t.depCount=0;const u=[],p=[];return"@"==n.name.charAt(0)&&t.errors.push(function fq(){return new pe(3006,!1)}()),n.definitions.forEach(m=>{if(this._resetContextStyleTimingState(t),m.type==bt.State){const E=m,S=E.name;S.toString().split(/\s*,\s*/).forEach(w=>{E.name=w,u.push(this.visitState(E,t))}),E.name=S}else if(m.type==bt.Transition){const E=this.visitTransition(m,t);o+=E.queryCount,c+=E.depCount,p.push(E)}else t.errors.push(function mq(){return new pe(3007,!1)}())}),{type:bt.Trigger,name:n.name,states:u,transitions:p,queryCount:o,depCount:c,options:null}}visitState(n,t){const o=this.visitStyle(n.styles,t),c=n.options&&n.options.params||null;if(o.containsDynamicStyles){const u=new Set,p=c||{};o.styles.forEach(m=>{m instanceof Map&&m.forEach(E=>{_6(E).forEach(S=>{p.hasOwnProperty(S)||u.add(S)})})}),u.size&&t.errors.push(function _q(e,n){return new pe(3008,!1)}(0,u.values()))}return{type:bt.State,name:n.name,style:o,options:c?{params:c}:null}}visitTransition(n,t){t.queryCount=0,t.depCount=0;const o=ba(this,OI(n.animation),t),c=function nK(e,n){const t=[];return"string"==typeof e?e.split(/\s*,\s*/).forEach(o=>function iK(e,n,t){if(":"==e[0]){const E=function rK(e,n){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,o)=>parseFloat(o)>parseFloat(t);case":decrement":return(t,o)=>parseFloat(o)<parseFloat(t);default:return n.push(function wq(e){return new pe(3016,!1)}()),"* => *"}}(e,t);if("function"==typeof E)return void n.push(E);e=E}const o=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==o||o.length<4)return t.push(function Iq(e){return new pe(3015,!1)}()),n;const c=o[1],u=o[2],p=o[3];n.push(E6(c,p)),"<"==u[0]&&(c!=MM||p!=MM)&&n.push(E6(p,c))}(o,t,n)):t.push(e),t}(n.expr,t.errors);return{type:bt.Transition,matchers:c,animation:o,queryCount:t.queryCount,depCount:t.depCount,options:L_(n.options)}}visitSequence(n,t){return{type:bt.Sequence,steps:n.steps.map(o=>ba(this,o,t)),options:L_(n.options)}}visitGroup(n,t){const o=t.currentTime;let c=0;const u=n.steps.map(p=>{t.currentTime=o;const m=ba(this,p,t);return c=Math.max(c,t.currentTime),m});return t.currentTime=c,{type:bt.Group,steps:u,options:L_(n.options)}}visitAnimate(n,t){const o=function uK(e,n){if(e.hasOwnProperty("duration"))return e;if("number"==typeof e)return SV(PM(e,n).duration,0,"");const t=e;if(t.split(/\s+/).some(u=>"{"==u.charAt(0)&&"{"==u.charAt(1))){const u=SV(0,0,"");return u.dynamic=!0,u.strValue=t,u}const c=PM(t,n);return SV(c.duration,c.delay,c.easing)}(n.timings,t.errors);t.currentAnimateTimings=o;let c,u=n.styles?n.styles:al({});if(u.type==bt.Keyframes)c=this.visitKeyframes(u,t);else{let p=n.styles,m=!1;if(!p){m=!0;const S={};o.easing&&(S.easing=o.easing),p=al(S)}t.currentTime+=o.duration+o.delay;const E=this.visitStyle(p,t);E.isEmptyStep=m,c=E}return t.currentAnimateTimings=null,{type:bt.Animate,timings:o,style:c,options:null}}visitStyle(n,t){const o=this._makeStyleAst(n,t);return this._validateStyleAst(o,t),o}_makeStyleAst(n,t){const o=[],c=Array.isArray(n.styles)?n.styles:[n.styles];for(let m of c)"string"==typeof m?m===Bu?o.push(m):t.errors.push(new pe(3002,!1)):o.push(new Map(Object.entries(m)));let u=!1,p=null;return o.forEach(m=>{if(m instanceof Map&&(m.has("easing")&&(p=m.get("easing"),m.delete("easing")),!u))for(let E of m.values())if(E.toString().indexOf("{{")>=0){u=!0;break}}),{type:bt.Style,styles:o,easing:p,offset:n.offset,containsDynamicStyles:u,options:null}}_validateStyleAst(n,t){const o=t.currentAnimateTimings;let c=t.currentTime,u=t.currentTime;o&&u>0&&(u-=o.duration+o.delay),n.styles.forEach(p=>{"string"!=typeof p&&p.forEach((m,E)=>{const S=t.collectedStyles.get(t.currentQuerySelector),w=S.get(E);let P=!0;w&&(u!=c&&u>=w.startTime&&c<=w.endTime&&(t.errors.push(function Eq(e,n,t,o,c){return new pe(3010,!1)}()),P=!1),u=w.startTime),P&&S.set(E,{startTime:u,endTime:c}),t.options&&function Jq(e,n,t){const o=n.params||{},c=_6(e);c.length&&c.forEach(u=>{o.hasOwnProperty(u)||t.push(function lq(e){return new pe(3001,!1)}())})}(m,t.options,t.errors)})})}visitKeyframes(n,t){const o={type:bt.Keyframes,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(function vq(){return new pe(3011,!1)}()),o;let u=0;const p=[];let m=!1,E=!1,S=0;const w=n.steps.map(he=>{const le=this._makeStyleAst(he,t);let Le=null!=le.offset?le.offset:function lK(e){if("string"==typeof e)return null;let n=null;if(Array.isArray(e))e.forEach(t=>{if(t instanceof Map&&t.has("offset")){const o=t;n=parseFloat(o.get("offset")),o.delete("offset")}});else if(e instanceof Map&&e.has("offset")){const t=e;n=parseFloat(t.get("offset")),t.delete("offset")}return n}(le.styles),He=0;return null!=Le&&(u++,He=le.offset=Le),E=E||He<0||He>1,m=m||He<S,S=He,p.push(He),le});E&&t.errors.push(function bq(){return new pe(3012,!1)}()),m&&t.errors.push(function yq(){return new pe(3200,!1)}());const P=n.steps.length;let V=0;u>0&&u<P?t.errors.push(function Sq(){return new pe(3202,!1)}()):0==u&&(V=1/(P-1));const H=P-1,z=t.currentTime,J=t.currentAnimateTimings,ce=J.duration;return w.forEach((he,le)=>{const Le=V>0?le==H?1:V*le:p[le],He=Le*ce;t.currentTime=z+J.delay+He,J.duration=He,this._validateStyleAst(he,t),he.offset=Le,o.styles.push(he)}),o}visitReference(n,t){return{type:bt.Reference,animation:ba(this,OI(n.animation),t),options:L_(n.options)}}visitAnimateChild(n,t){return t.depCount++,{type:bt.AnimateChild,options:L_(n.options)}}visitAnimateRef(n,t){return{type:bt.AnimateRef,animation:this.visitReference(n.animation,t),options:L_(n.options)}}visitQuery(n,t){const o=t.currentQuerySelector,c=n.options||{};t.queryCount++,t.currentQuery=n;const[u,p]=function aK(e){const n=!!e.split(/\s*,\s*/).find(t=>":self"==t);return n&&(e=e.replace(oK,"")),e=e.replace(/@\*/g,NM).replace(/@\w+/g,t=>NM+"-"+t.slice(1)).replace(/:animating/g,_V),[e,n]}(n.selector);t.currentQuerySelector=o.length?o+" "+u:u,va(t.collectedStyles,t.currentQuerySelector,new Map);const m=ba(this,OI(n.animation),t);return t.currentQuery=null,t.currentQuerySelector=o,{type:bt.Query,selector:u,limit:c.limit||0,optional:!!c.optional,includeSelf:p,animation:m,originalSelector:n.selector,options:L_(n.options)}}visitStagger(n,t){t.currentQuery||t.errors.push(function Cq(){return new pe(3013,!1)}());const o="full"===n.timings?{duration:0,delay:0,easing:"full"}:PM(n.timings,t.errors,!0);return{type:bt.Stagger,animation:ba(this,OI(n.animation),t),timings:o,options:null}}}class dK{constructor(n){this.errors=n,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function L_(e){return e?(e={...e}).params&&(e.params=function cK(e){return e?{...e}:null}(e.params)):e={},e}function SV(e,n,t){return{duration:e,delay:n,easing:t}}function CV(e,n,t,o,c,u,p=null,m=!1){return{type:1,element:e,keyframes:n,preStyleProps:t,postStyleProps:o,duration:c,delay:u,totalTime:c+u,easing:p,subTimeline:m}}class LM{constructor(){this._map=new Map}get(n){return this._map.get(n)||[]}append(n,t){let o=this._map.get(n);o||this._map.set(n,o=[]),o.push(...t)}has(n){return this._map.has(n)}clear(){this._map.clear()}}const fK=new RegExp(":enter","g"),_K=new RegExp(":leave","g");function TV(e,n,t,o,c,u=new Map,p=new Map,m,E,S=[]){return(new gK).buildKeyframes(e,n,t,o,c,u,p,m,E,S)}class gK{buildKeyframes(n,t,o,c,u,p,m,E,S,w=[]){S=S||new LM;const P=new IV(n,t,S,c,u,w,[]);P.options=E;const V=E.delay?ju(E.delay):0;P.currentTimeline.delayNextStep(V),P.currentTimeline.setStyles([p],null,P.errors,E),ba(this,o,P);const H=P.timelines.filter(z=>z.containsAnimation());if(H.length&&m.size){let z;for(let J=H.length-1;J>=0;J--){const ce=H[J];if(ce.element===t){z=ce;break}}z&&!z.allowOnlyTimelineStyles()&&z.setStyles([m],null,P.errors,E)}return H.length?H.map(z=>z.buildKeyframes()):[CV(t,[],[],[],0,V,"",!1)]}visitTrigger(n,t){}visitState(n,t){}visitTransition(n,t){}visitAnimateChild(n,t){const o=t.subInstructions.get(t.element);if(o){const c=t.createSubContext(n.options),u=t.currentTimeline.currentTime,p=this._visitSubInstructions(o,c,c.options);u!=p&&t.transformIntoNewTimeline(p)}t.previousNode=n}visitAnimateRef(n,t){const o=t.createSubContext(n.options);o.transformIntoNewTimeline(),this._applyAnimationRefDelays([n.options,n.animation.options],t,o),this.visitReference(n.animation,o),t.transformIntoNewTimeline(o.currentTimeline.currentTime),t.previousNode=n}_applyAnimationRefDelays(n,t,o){for(const c of n){const u=c?.delay;if(u){const p="number"==typeof u?u:ju(NI(u,c?.params??{},t.errors));o.delayNextStep(p)}}}_visitSubInstructions(n,t,o){let u=t.currentTimeline.currentTime;const p=null!=o.duration?ju(o.duration):null,m=null!=o.delay?ju(o.delay):null;return 0!==p&&n.forEach(E=>{const S=t.appendInstructionToTimeline(E,p,m);u=Math.max(u,S.duration+S.delay)}),u}visitReference(n,t){t.updateOptions(n.options,!0),ba(this,n.animation,t),t.previousNode=n}visitSequence(n,t){const o=t.subContextCount;let c=t;const u=n.options;if(u&&(u.params||u.delay)&&(c=t.createSubContext(u),c.transformIntoNewTimeline(),null!=u.delay)){c.previousNode.type==bt.Style&&(c.currentTimeline.snapshotCurrentStyles(),c.previousNode=FM);const p=ju(u.delay);c.delayNextStep(p)}n.steps.length&&(n.steps.forEach(p=>ba(this,p,c)),c.currentTimeline.applyStylesToKeyframe(),c.subContextCount>o&&c.transformIntoNewTimeline()),t.previousNode=n}visitGroup(n,t){const o=[];let c=t.currentTimeline.currentTime;const u=n.options&&n.options.delay?ju(n.options.delay):0;n.steps.forEach(p=>{const m=t.createSubContext(n.options);u&&m.delayNextStep(u),ba(this,p,m),c=Math.max(c,m.currentTimeline.currentTime),o.push(m.currentTimeline)}),o.forEach(p=>t.currentTimeline.mergeTimelineCollectedStyles(p)),t.transformIntoNewTimeline(c),t.previousNode=n}_visitTiming(n,t){if(n.dynamic){const o=n.strValue;return PM(t.params?NI(o,t.params,t.errors):o,t.errors)}return{duration:n.duration,delay:n.delay,easing:n.easing}}visitAnimate(n,t){const o=t.currentAnimateTimings=this._visitTiming(n.timings,t),c=t.currentTimeline;o.delay&&(t.incrementTime(o.delay),c.snapshotCurrentStyles());const u=n.style;u.type==bt.Keyframes?this.visitKeyframes(u,t):(t.incrementTime(o.duration),this.visitStyle(u,t),c.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=n}visitStyle(n,t){const o=t.currentTimeline,c=t.currentAnimateTimings;!c&&o.hasCurrentStyleProperties()&&o.forwardFrame();const u=c&&c.easing||n.easing;n.isEmptyStep?o.applyEmptyStep(u):o.setStyles(n.styles,u,t.errors,t.options),t.previousNode=n}visitKeyframes(n,t){const o=t.currentAnimateTimings,c=t.currentTimeline.duration,u=o.duration,m=t.createSubContext().currentTimeline;m.easing=o.easing,n.styles.forEach(E=>{m.forwardTime((E.offset||0)*u),m.setStyles(E.styles,E.easing,t.errors,t.options),m.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(m),t.transformIntoNewTimeline(c+u),t.previousNode=n}visitQuery(n,t){const o=t.currentTimeline.currentTime,c=n.options||{},u=c.delay?ju(c.delay):0;u&&(t.previousNode.type===bt.Style||0==o&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=FM);let p=o;const m=t.invokeQuery(n.selector,n.originalSelector,n.limit,n.includeSelf,!!c.optional,t.errors);t.currentQueryTotal=m.length;let E=null;m.forEach((S,w)=>{t.currentQueryIndex=w;const P=t.createSubContext(n.options,S);u&&P.delayNextStep(u),S===t.element&&(E=P.currentTimeline),ba(this,n.animation,P),P.currentTimeline.applyStylesToKeyframe(),p=Math.max(p,P.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(p),E&&(t.currentTimeline.mergeTimelineCollectedStyles(E),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=n}visitStagger(n,t){const o=t.parentContext,c=t.currentTimeline,u=n.timings,p=Math.abs(u.duration),m=p*(t.currentQueryTotal-1);let E=p*t.currentQueryIndex;switch(u.duration<0?"reverse":u.easing){case"reverse":E=m-E;break;case"full":E=o.currentStaggerTime}const w=t.currentTimeline;E&&w.delayNextStep(E);const P=w.currentTime;ba(this,n.animation,t),t.previousNode=n,o.currentStaggerTime=c.currentTime-P+(c.startTime-o.currentTimeline.startTime)}}const FM={};class IV{constructor(n,t,o,c,u,p,m,E){this._driver=n,this.element=t,this.subInstructions=o,this._enterClassName=c,this._leaveClassName=u,this.errors=p,this.timelines=m,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=FM,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=E||new UM(this._driver,t,0),m.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(n,t){if(!n)return;const o=n;let c=this.options;null!=o.duration&&(c.duration=ju(o.duration)),null!=o.delay&&(c.delay=ju(o.delay));const u=o.params;if(u){let p=c.params;p||(p=this.options.params={}),Object.keys(u).forEach(m=>{(!t||!p.hasOwnProperty(m))&&(p[m]=NI(u[m],p,this.errors))})}}_copyOptions(){const n={};if(this.options){const t=this.options.params;if(t){const o=n.params={};Object.keys(t).forEach(c=>{o[c]=t[c]})}}return n}createSubContext(n=null,t,o){const c=t||this.element,u=new IV(this._driver,c,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(c,o||0));return u.previousNode=this.previousNode,u.currentAnimateTimings=this.currentAnimateTimings,u.options=this._copyOptions(),u.updateOptions(n),u.currentQueryIndex=this.currentQueryIndex,u.currentQueryTotal=this.currentQueryTotal,u.parentContext=this,this.subContextCount++,u}transformIntoNewTimeline(n){return this.previousNode=FM,this.currentTimeline=this.currentTimeline.fork(this.element,n),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(n,t,o){const c={duration:t??n.duration,delay:this.currentTimeline.currentTime+(o??0)+n.delay,easing:""},u=new EK(this._driver,n.element,n.keyframes,n.preStyleProps,n.postStyleProps,c,n.stretchStartingKeyframe);return this.timelines.push(u),c}incrementTime(n){this.currentTimeline.forwardTime(this.currentTimeline.duration+n)}delayNextStep(n){n>0&&this.currentTimeline.delayNextStep(n)}invokeQuery(n,t,o,c,u,p){let m=[];if(c&&m.push(this.element),n.length>0){n=(n=n.replace(fK,"."+this._enterClassName)).replace(_K,"."+this._leaveClassName);let S=this._driver.query(this.element,n,1!=o);0!==o&&(S=o<0?S.slice(S.length+o,S.length):S.slice(0,o)),m.push(...S)}return!u&&0==m.length&&p.push(function Tq(e){return new pe(3014,!1)}()),m}}class UM{constructor(n,t,o,c){this._driver=n,this.element=t,this.startTime=o,this._elementTimelineStylesLookup=c,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(n){const t=1===this._keyframes.size&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+n),t&&this.snapshotCurrentStyles()):this.startTime+=n}fork(n,t){return this.applyStylesToKeyframe(),new UM(this._driver,n,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(n){this.applyStylesToKeyframe(),this.duration=n,this._loadKeyframe()}_updateStyle(n,t){this._localTimelineStyles.set(n,t),this._globalTimelineStyles.set(n,t),this._styleSummary.set(n,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(n){n&&this._previousKeyframe.set("easing",n);for(let[t,o]of this._globalTimelineStyles)this._backFill.set(t,o||Bu),this._currentKeyframe.set(t,Bu);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(n,t,o,c){t&&this._previousKeyframe.set("easing",t);const u=c&&c.params||{},p=function vK(e,n){const t=new Map;let o;return e.forEach(c=>{if("*"===c){o??=n.keys();for(let u of o)t.set(u,Bu)}else for(let[u,p]of c)t.set(u,p)}),t}(n,this._globalTimelineStyles);for(let[m,E]of p){const S=NI(E,u,o);this._pendingStyles.set(m,S),this._localTimelineStyles.has(m)||this._backFill.set(m,this._globalTimelineStyles.get(m)??Bu),this._updateStyle(m,S)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((n,t)=>{this._currentKeyframe.set(t,n)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((n,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,n)}))}snapshotCurrentStyles(){for(let[n,t]of this._localTimelineStyles)this._pendingStyles.set(n,t),this._updateStyle(n,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const n=[];for(let t in this._currentKeyframe)n.push(t);return n}mergeTimelineCollectedStyles(n){n._styleSummary.forEach((t,o)=>{const c=this._styleSummary.get(o);(!c||t.time>c.time)&&this._updateStyle(o,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();const n=new Set,t=new Set,o=1===this._keyframes.size&&0===this.duration;let c=[];this._keyframes.forEach((m,E)=>{const S=new Map([...this._backFill,...m]);S.forEach((w,P)=>{"!"===w?n.add(P):w===Bu&&t.add(P)}),o||S.set("offset",E/this.duration),c.push(S)});const u=[...n.values()],p=[...t.values()];if(o){const m=c[0],E=new Map(m);m.set("offset",0),E.set("offset",1),c=[m,E]}return CV(this.element,c,u,p,this.duration,this.startTime,this.easing,!1)}}class EK extends UM{constructor(n,t,o,c,u,p,m=!1){super(n,t,p.delay),this.keyframes=o,this.preStyleProps=c,this.postStyleProps=u,this._stretchStartingKeyframe=m,this.timings={duration:p.duration,delay:p.delay,easing:p.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let n=this.keyframes,{delay:t,duration:o,easing:c}=this.timings;if(this._stretchStartingKeyframe&&t){const u=[],p=o+t,m=t/p,E=new Map(n[0]);E.set("offset",0),u.push(E);const S=new Map(n[0]);S.set("offset",y6(m)),u.push(S);const w=n.length-1;for(let P=1;P<=w;P++){let V=new Map(n[P]);const H=V.get("offset");V.set("offset",y6((t+H*o)/p)),u.push(V)}o=p,t=0,c="",n=u}return CV(this.element,n,this.preStyleProps,this.postStyleProps,o,t,c,!0)}}function y6(e,n=3){const t=Math.pow(10,n-1);return Math.round(e*t)/t}function S6(e,n,t,o,c,u,p,m,E,S,w,P,V){return{type:0,element:e,triggerName:n,isRemovalTransition:c,fromState:t,fromStyles:u,toState:o,toStyles:p,timelines:m,queriedElements:E,preStyleProps:S,postStyleProps:w,totalTime:P,errors:V}}const wV={};class C6{constructor(n,t,o){this._triggerName=n,this.ast=t,this._stateStyles=o}match(n,t,o,c){return function bK(e,n,t,o,c){return e.some(u=>u(n,t,o,c))}(this.ast.matchers,n,t,o,c)}buildStyles(n,t,o){let c=this._stateStyles.get("*");return void 0!==n&&(c=this._stateStyles.get(n?.toString())||c),c?c.buildStyles(t,o):new Map}build(n,t,o,c,u,p,m,E,S,w){const P=[],V=this.ast.options&&this.ast.options.params||wV,z=this.buildStyles(o,m&&m.params||wV,P),J=E&&E.params||wV,ce=this.buildStyles(c,J,P),he=new Set,le=new Map,Le=new Map,He="void"===c,pt={params:T6(J,V),delay:this.ast.options?.delay},kn=w?[]:TV(n,t,this.ast.animation,u,p,z,ce,pt,S,P);let wr=0;return kn.forEach(Wo=>{wr=Math.max(Wo.duration+Wo.delay,wr)}),P.length?S6(t,this._triggerName,o,c,He,z,ce,[],[],le,Le,wr,P):(kn.forEach(Wo=>{const Wu=Wo.element,$b=va(le,Wu,new Set);Wo.preStyleProps.forEach(G_=>$b.add(G_));const I8=va(Le,Wu,new Set);Wo.postStyleProps.forEach(G_=>I8.add(G_)),Wu!==t&&he.add(Wu)}),S6(t,this._triggerName,o,c,He,z,ce,kn,[...he.values()],le,Le,wr))}}function T6(e,n){const t={...n};return Object.entries(e).forEach(([o,c])=>{null!=c&&(t[o]=c)}),t}class yK{constructor(n,t,o){this.styles=n,this.defaultParams=t,this.normalizer=o}buildStyles(n,t){const o=new Map,c=T6(n,this.defaultParams);return this.styles.styles.forEach(u=>{"string"!=typeof u&&u.forEach((p,m)=>{p&&(p=NI(p,c,t));const E=this.normalizer.normalizePropertyName(m,t);p=this.normalizer.normalizeStyleValue(m,E,p,t),o.set(m,p)})}),o}}class CK{constructor(n,t,o){this.name=n,this.ast=t,this._normalizer=o,this.transitionFactories=[],this.states=new Map,t.states.forEach(c=>{this.states.set(c.name,new yK(c.style,c.options&&c.options.params||{},o))}),I6(this.states,"true","1"),I6(this.states,"false","0"),t.transitions.forEach(c=>{this.transitionFactories.push(new C6(n,c,this.states))}),this.fallbackTransition=function TK(e,n,t){return new C6(e,{type:bt.Transition,animation:{type:bt.Sequence,steps:[],options:null},matchers:[(p,m)=>!0],options:null,queryCount:0,depCount:0},n)}(n,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(n,t,o,c){return this.transitionFactories.find(p=>p.match(n,t,o,c))||null}matchStyles(n,t,o){return this.fallbackTransition.buildStyles(n,t,o)}}function I6(e,n,t){e.has(n)?e.has(t)||e.set(t,e.get(n)):e.has(t)&&e.set(n,e.get(t))}const IK=new LM;class wK{constructor(n,t,o){this.bodyNode=n,this._driver=t,this._normalizer=o,this._animations=new Map,this._playersById=new Map,this.players=[]}register(n,t){const o=[],u=yV(this._driver,t,o,[]);if(o.length)throw function Nq(e){return new pe(3503,!1)}();this._animations.set(n,u)}_buildPlayer(n,t,o){const c=n.element,u=c6(this._normalizer,n.keyframes,t,o);return this._driver.animate(c,u,n.duration,n.delay,n.easing,[],!0)}create(n,t,o={}){const c=[],u=this._animations.get(n);let p;const m=new Map;if(u?(p=TV(this._driver,t,u,mV,DM,new Map,new Map,o,IK,c),p.forEach(w=>{const P=va(m,w.element,new Map);w.postStyleProps.forEach(V=>P.set(V,null))})):(c.push(function Pq(){return new pe(3300,!1)}()),p=[]),c.length)throw function Mq(e){return new pe(3504,!1)}();m.forEach((w,P)=>{w.forEach((V,H)=>{w.set(H,this._driver.computeStyle(P,H,Bu))})});const S=Wp(p.map(w=>{const P=m.get(w.element);return this._buildPlayer(w,new Map,P)}));return this._playersById.set(n,S),S.onDestroy(()=>this.destroy(n)),this.players.push(S),S}destroy(n){const t=this._getPlayer(n);t.destroy(),this._playersById.delete(n);const o=this.players.indexOf(t);o>=0&&this.players.splice(o,1)}_getPlayer(n){const t=this._playersById.get(n);if(!t)throw function xq(e){return new pe(3301,!1)}();return t}listen(n,t,o,c){const u=lV(t,"","","");return cV(this._getPlayer(n),o,u,c),()=>{}}command(n,t,o,c){if("register"==o)return void this.register(n,c[0]);if("create"==o)return void this.create(n,t,c[0]||{});const u=this._getPlayer(n);switch(o){case"play":u.play();break;case"pause":u.pause();break;case"reset":u.reset();break;case"restart":u.restart();break;case"finish":u.finish();break;case"init":u.init();break;case"setPosition":u.setPosition(parseFloat(c[0]));break;case"destroy":this.destroy(n)}}}const w6="ng-animate-queued",RV="ng-animate-disabled",NK=[],R6={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},PK={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},td="__ng_removed";class AV{get params(){return this.options.params}constructor(n,t=""){this.namespaceId=t;const o=n&&n.hasOwnProperty("value");if(this.value=function LK(e){return e??null}(o?n.value:n),o){const{value:u,...p}=n;this.options=p}else this.options={};this.options.params||(this.options.params={})}absorbOptions(n){const t=n.params;if(t){const o=this.options.params;Object.keys(t).forEach(c=>{null==o[c]&&(o[c]=t[c])})}}}const PI="void",DV=new AV(PI);class MK{constructor(n,t,o){this.id=n,this.hostElement=t,this._engine=o,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+n,rc(t,this._hostClassName)}listen(n,t,o,c){if(!this._triggers.has(t))throw function kq(e,n){return new pe(3302,!1)}();if(null==o||0==o.length)throw function Lq(e){return new pe(3303,!1)}();if(!function FK(e){return"start"==e||"done"==e}(o))throw function Fq(e,n){return new pe(3400,!1)}();const u=va(this._elementListeners,n,[]),p={name:t,phase:o,callback:c};u.push(p);const m=va(this._engine.statesByElement,n,new Map);return m.has(t)||(rc(n,OM),rc(n,OM+"-"+t),m.set(t,DV)),()=>{this._engine.afterFlush(()=>{const E=u.indexOf(p);E>=0&&u.splice(E,1),this._triggers.has(t)||m.delete(t)})}}register(n,t){return!this._triggers.has(n)&&(this._triggers.set(n,t),!0)}_getTrigger(n){const t=this._triggers.get(n);if(!t)throw function Uq(e){return new pe(3401,!1)}();return t}trigger(n,t,o,c=!0){const u=this._getTrigger(t),p=new OV(this.id,t,n);let m=this._engine.statesByElement.get(n);m||(rc(n,OM),rc(n,OM+"-"+t),this._engine.statesByElement.set(n,m=new Map));let E=m.get(t);const S=new AV(o,this.id);if(!(o&&o.hasOwnProperty("value"))&&E&&S.absorbOptions(E.options),m.set(t,S),E||(E=DV),S.value!==PI&&E.value===S.value){if(!function BK(e,n){const t=Object.keys(e),o=Object.keys(n);if(t.length!=o.length)return!1;for(let c=0;c<t.length;c++){const u=t[c];if(!n.hasOwnProperty(u)||e[u]!==n[u])return!1}return!0}(E.params,S.params)){const J=[],ce=u.matchStyles(E.value,E.params,J),he=u.matchStyles(S.value,S.params,J);J.length?this._engine.reportError(J):this._engine.afterFlush(()=>{k_(n,ce),cl(n,he)})}return}const V=va(this._engine.playersByElement,n,[]);V.forEach(J=>{J.namespaceId==this.id&&J.triggerName==t&&J.queued&&J.destroy()});let H=u.matchTransition(E.value,S.value,n,S.params),z=!1;if(!H){if(!c)return;H=u.fallbackTransition,z=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:n,triggerName:t,transition:H,fromState:E,toState:S,player:p,isFallbackTransition:z}),z||(rc(n,w6),p.onStart(()=>{kb(n,w6)})),p.onDone(()=>{let J=this.players.indexOf(p);J>=0&&this.players.splice(J,1);const ce=this._engine.playersByElement.get(n);if(ce){let he=ce.indexOf(p);he>=0&&ce.splice(he,1)}}),this.players.push(p),V.push(p),p}deregister(n){this._triggers.delete(n),this._engine.statesByElement.forEach(t=>t.delete(n)),this._elementListeners.forEach((t,o)=>{this._elementListeners.set(o,t.filter(c=>c.name!=n))})}clearElementCache(n){this._engine.statesByElement.delete(n),this._elementListeners.delete(n);const t=this._engine.playersByElement.get(n);t&&(t.forEach(o=>o.destroy()),this._engine.playersByElement.delete(n))}_signalRemovalForInnerTriggers(n,t){const o=this._engine.driver.query(n,NM,!0);o.forEach(c=>{if(c[td])return;const u=this._engine.fetchNamespacesByElement(c);u.size?u.forEach(p=>p.triggerLeaveAnimation(c,t,!1,!0)):this.clearElementCache(c)}),this._engine.afterFlushAnimationsDone(()=>o.forEach(c=>this.clearElementCache(c)))}triggerLeaveAnimation(n,t,o,c){const u=this._engine.statesByElement.get(n),p=new Map;if(u){const m=[];if(u.forEach((E,S)=>{if(p.set(S,E.value),this._triggers.has(S)){const w=this.trigger(n,S,PI,c);w&&m.push(w)}}),m.length)return this._engine.markElementAsRemoved(this.id,n,!0,t,p),o&&Wp(m).onDone(()=>this._engine.processLeaveNode(n)),!0}return!1}prepareLeaveAnimationListeners(n){const t=this._elementListeners.get(n),o=this._engine.statesByElement.get(n);if(t&&o){const c=new Set;t.forEach(u=>{const p=u.name;if(c.has(p))return;c.add(p);const E=this._triggers.get(p).fallbackTransition,S=o.get(p)||DV,w=new AV(PI),P=new OV(this.id,p,n);this._engine.totalQueuedPlayers++,this._queue.push({element:n,triggerName:p,transition:E,fromState:S,toState:w,player:P,isFallbackTransition:!0})})}}removeNode(n,t){const o=this._engine;if(n.childElementCount&&this._signalRemovalForInnerTriggers(n,t),this.triggerLeaveAnimation(n,t,!0))return;let c=!1;if(o.totalAnimations){const u=o.players.length?o.playersByQueriedElement.get(n):[];if(u&&u.length)c=!0;else{let p=n;for(;p=p.parentNode;)if(o.statesByElement.get(p)){c=!0;break}}}if(this.prepareLeaveAnimationListeners(n),c)o.markElementAsRemoved(this.id,n,!1,t);else{const u=n[td];(!u||u===R6)&&(o.afterFlush(()=>this.clearElementCache(n)),o.destroyInnerAnimations(n),o._onRemovalComplete(n,t))}}insertNode(n,t){rc(n,this._hostClassName)}drainQueuedTransitions(n){const t=[];return this._queue.forEach(o=>{const c=o.player;if(c.destroyed)return;const u=o.element,p=this._elementListeners.get(u);p&&p.forEach(m=>{if(m.name==o.triggerName){const E=lV(u,o.triggerName,o.fromState.value,o.toState.value);E._data=n,cV(o.player,m.phase,E,m.callback)}}),c.markedForDestroy?this._engine.afterFlush(()=>{c.destroy()}):t.push(o)}),this._queue=[],t.sort((o,c)=>{const u=o.transition.ast.depCount,p=c.transition.ast.depCount;return 0==u||0==p?u-p:this._engine.driver.containsElement(o.element,c.element)?1:-1})}destroy(n){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,n)}}class xK{_onRemovalComplete(n,t){this.onRemovalComplete(n,t)}constructor(n,t,o,c){this.bodyNode=n,this.driver=t,this._normalizer=o,this.scheduler=c,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(u,p)=>{}}get queuedPlayers(){const n=[];return this._namespaceList.forEach(t=>{t.players.forEach(o=>{o.queued&&n.push(o)})}),n}createNamespace(n,t){const o=new MK(n,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(o,t):(this.newHostElements.set(t,o),this.collectEnterElement(t)),this._namespaceLookup[n]=o}_balanceNamespaceList(n,t){const o=this._namespaceList,c=this.namespacesByHostElement;if(o.length-1>=0){let p=!1,m=this.driver.getParentElement(t);for(;m;){const E=c.get(m);if(E){const S=o.indexOf(E);o.splice(S+1,0,n),p=!0;break}m=this.driver.getParentElement(m)}p||o.unshift(n)}else o.push(n);return c.set(t,n),n}register(n,t){let o=this._namespaceLookup[n];return o||(o=this.createNamespace(n,t)),o}registerTrigger(n,t,o){let c=this._namespaceLookup[n];c&&c.register(t,o)&&this.totalAnimations++}destroy(n,t){n&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{const o=this._fetchNamespace(n);this.namespacesByHostElement.delete(o.hostElement);const c=this._namespaceList.indexOf(o);c>=0&&this._namespaceList.splice(c,1),o.destroy(t),delete this._namespaceLookup[n]}))}_fetchNamespace(n){return this._namespaceLookup[n]}fetchNamespacesByElement(n){const t=new Set,o=this.statesByElement.get(n);if(o)for(let c of o.values())if(c.namespaceId){const u=this._fetchNamespace(c.namespaceId);u&&t.add(u)}return t}trigger(n,t,o,c){if(VM(t)){const u=this._fetchNamespace(n);if(u)return u.trigger(t,o,c),!0}return!1}insertNode(n,t,o,c){if(!VM(t))return;const u=t[td];if(u&&u.setForRemoval){u.setForRemoval=!1,u.setForMove=!0;const p=this.collectedLeaveElements.indexOf(t);p>=0&&this.collectedLeaveElements.splice(p,1)}if(n){const p=this._fetchNamespace(n);p&&p.insertNode(t,o)}c&&this.collectEnterElement(t)}collectEnterElement(n){this.collectedEnterElements.push(n)}markElementAsDisabled(n,t){t?this.disabledNodes.has(n)||(this.disabledNodes.add(n),rc(n,RV)):this.disabledNodes.has(n)&&(this.disabledNodes.delete(n),kb(n,RV))}removeNode(n,t,o){if(VM(t)){this.scheduler?.notify();const c=n?this._fetchNamespace(n):null;c?c.removeNode(t,o):this.markElementAsRemoved(n,t,!1,o);const u=this.namespacesByHostElement.get(t);u&&u.id!==n&&u.removeNode(t,o)}else this._onRemovalComplete(t,o)}markElementAsRemoved(n,t,o,c,u){this.collectedLeaveElements.push(t),t[td]={namespaceId:n,setForRemoval:c,hasAnimation:o,removedBeforeQueried:!1,previousTriggersValues:u}}listen(n,t,o,c,u){return VM(t)?this._fetchNamespace(n).listen(t,o,c,u):()=>{}}_buildInstruction(n,t,o,c,u){return n.transition.build(this.driver,n.element,n.fromState.value,n.toState.value,o,c,n.fromState.options,n.toState.options,t,u)}destroyInnerAnimations(n){let t=this.driver.query(n,NM,!0);t.forEach(o=>this.destroyActiveAnimationsForElement(o)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(n,_V,!0),t.forEach(o=>this.finishActiveQueriedAnimationOnElement(o)))}destroyActiveAnimationsForElement(n){const t=this.playersByElement.get(n);t&&t.forEach(o=>{o.queued?o.markedForDestroy=!0:o.destroy()})}finishActiveQueriedAnimationOnElement(n){const t=this.playersByQueriedElement.get(n);t&&t.forEach(o=>o.finish())}whenRenderingDone(){return new Promise(n=>{if(this.players.length)return Wp(this.players).onDone(()=>n());n()})}processLeaveNode(n){const t=n[td];if(t&&t.setForRemoval){if(n[td]=R6,t.namespaceId){this.destroyInnerAnimations(n);const o=this._fetchNamespace(t.namespaceId);o&&o.clearElementCache(n)}this._onRemovalComplete(n,t.setForRemoval)}n.classList?.contains(RV)&&this.markElementAsDisabled(n,!1),this.driver.query(n,".ng-animate-disabled",!0).forEach(o=>{this.markElementAsDisabled(o,!1)})}flush(n=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((o,c)=>this._balanceNamespaceList(o,c)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let o=0;o<this.collectedEnterElements.length;o++)rc(this.collectedEnterElements[o],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const o=[];try{t=this._flushAnimations(o,n)}finally{for(let c=0;c<o.length;c++)o[c]()}}else for(let o=0;o<this.collectedLeaveElements.length;o++)this.processLeaveNode(this.collectedLeaveElements[o]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(o=>o()),this._flushFns=[],this._whenQuietFns.length){const o=this._whenQuietFns;this._whenQuietFns=[],t.length?Wp(t).onDone(()=>{o.forEach(c=>c())}):o.forEach(c=>c())}}reportError(n){throw function Vq(e){return new pe(3402,!1)}()}_flushAnimations(n,t){const o=new LM,c=[],u=new Map,p=[],m=new Map,E=new Map,S=new Map,w=new Set;this.disabledNodes.forEach(We=>{w.add(We);const ot=this.driver.query(We,".ng-animate-queued",!0);for(let ft=0;ft<ot.length;ft++)w.add(ot[ft])});const P=this.bodyNode,V=Array.from(this.statesByElement.keys()),H=O6(V,this.collectedEnterElements),z=new Map;let J=0;H.forEach((We,ot)=>{const ft=mV+J++;z.set(ot,ft),We.forEach(vn=>rc(vn,ft))});const ce=[],he=new Set,le=new Set;for(let We=0;We<this.collectedLeaveElements.length;We++){const ot=this.collectedLeaveElements[We],ft=ot[td];ft&&ft.setForRemoval&&(ce.push(ot),he.add(ot),ft.hasAnimation?this.driver.query(ot,".ng-star-inserted",!0).forEach(vn=>he.add(vn)):le.add(ot))}const Le=new Map,He=O6(V,Array.from(he));He.forEach((We,ot)=>{const ft=DM+J++;Le.set(ot,ft),We.forEach(vn=>rc(vn,ft))}),n.push(()=>{H.forEach((We,ot)=>{const ft=z.get(ot);We.forEach(vn=>kb(vn,ft))}),He.forEach((We,ot)=>{const ft=Le.get(ot);We.forEach(vn=>kb(vn,ft))}),ce.forEach(We=>{this.processLeaveNode(We)})});const pt=[],kn=[];for(let We=this._namespaceList.length-1;We>=0;We--)this._namespaceList[We].drainQueuedTransitions(t).forEach(ft=>{const vn=ft.player,no=ft.element;if(pt.push(vn),this.collectedEnterElements.length){const zo=no[td];if(zo&&zo.setForMove){if(zo.previousTriggersValues&&zo.previousTriggersValues.has(ft.triggerName)){const W_=zo.previousTriggersValues.get(ft.triggerName),sc=this.statesByElement.get(ft.element);if(sc&&sc.has(ft.triggerName)){const lx=sc.get(ft.triggerName);lx.value=W_,sc.set(ft.triggerName,lx)}}return void vn.destroy()}}const ml=!P||!this.driver.containsElement(P,no),Ca=Le.get(no),$p=z.get(no),zi=this._buildInstruction(ft,o,$p,Ca,ml);if(zi.errors&&zi.errors.length)return void kn.push(zi);if(ml)return vn.onStart(()=>k_(no,zi.fromStyles)),vn.onDestroy(()=>cl(no,zi.toStyles)),void c.push(vn);if(ft.isFallbackTransition)return vn.onStart(()=>k_(no,zi.fromStyles)),vn.onDestroy(()=>cl(no,zi.toStyles)),void c.push(vn);const A8=[];zi.timelines.forEach(zo=>{zo.stretchStartingKeyframe=!0,this.disabledNodes.has(zo.element)||A8.push(zo)}),zi.timelines=A8,o.append(no,zi.timelines),p.push({instruction:zi,player:vn,element:no}),zi.queriedElements.forEach(zo=>va(m,zo,[]).push(vn)),zi.preStyleProps.forEach((zo,W_)=>{if(zo.size){let sc=E.get(W_);sc||E.set(W_,sc=new Set),zo.forEach((lx,D3)=>sc.add(D3))}}),zi.postStyleProps.forEach((zo,W_)=>{let sc=S.get(W_);sc||S.set(W_,sc=new Set),zo.forEach((lx,D3)=>sc.add(D3))})});if(kn.length){const We=[];kn.forEach(ot=>{We.push(function Bq(e,n){return new pe(3505,!1)}())}),pt.forEach(ot=>ot.destroy()),this.reportError(We)}const wr=new Map,Wo=new Map;p.forEach(We=>{const ot=We.element;o.has(ot)&&(Wo.set(ot,ot),this._beforeAnimationBuild(We.player.namespaceId,We.instruction,wr))}),c.forEach(We=>{const ot=We.element;this._getPreviousPlayers(ot,!1,We.namespaceId,We.triggerName,null).forEach(vn=>{va(wr,ot,[]).push(vn),vn.destroy()})});const Wu=ce.filter(We=>P6(We,E,S)),$b=new Map;D6($b,this.driver,le,S,Bu).forEach(We=>{P6(We,E,S)&&Wu.push(We)});const G_=new Map;H.forEach((We,ot)=>{D6(G_,this.driver,new Set(We),E,"!")}),Wu.forEach(We=>{const ot=$b.get(We),ft=G_.get(We);$b.set(We,new Map([...ot?.entries()??[],...ft?.entries()??[]]))});const A3=[],w8=[],R8={};p.forEach(We=>{const{element:ot,player:ft,instruction:vn}=We;if(o.has(ot)){if(w.has(ot))return ft.onDestroy(()=>cl(ot,vn.toStyles)),ft.disabled=!0,ft.overrideTotalTime(vn.totalTime),void c.push(ft);let no=R8;if(Wo.size>1){let Ca=ot;const $p=[];for(;Ca=Ca.parentNode;){const zi=Wo.get(Ca);if(zi){no=zi;break}$p.push(Ca)}$p.forEach(zi=>Wo.set(zi,no))}const ml=this._buildAnimation(ft.namespaceId,vn,wr,u,G_,$b);if(ft.setRealPlayer(ml),no===R8)A3.push(ft);else{const Ca=this.playersByElement.get(no);Ca&&Ca.length&&(ft.parentPlayer=Wp(Ca)),c.push(ft)}}else k_(ot,vn.fromStyles),ft.onDestroy(()=>cl(ot,vn.toStyles)),w8.push(ft),w.has(ot)&&c.push(ft)}),w8.forEach(We=>{const ot=u.get(We.element);if(ot&&ot.length){const ft=Wp(ot);We.setRealPlayer(ft)}}),c.forEach(We=>{We.parentPlayer?We.syncPlayerEvents(We.parentPlayer):We.destroy()});for(let We=0;We<ce.length;We++){const ot=ce[We],ft=ot[td];if(kb(ot,DM),ft&&ft.hasAnimation)continue;let vn=[];if(m.size){let ml=m.get(ot);ml&&ml.length&&vn.push(...ml);let Ca=this.driver.query(ot,_V,!0);for(let $p=0;$p<Ca.length;$p++){let zi=m.get(Ca[$p]);zi&&zi.length&&vn.push(...zi)}}const no=vn.filter(ml=>!ml.destroyed);no.length?UK(this,ot,no):this.processLeaveNode(ot)}return ce.length=0,A3.forEach(We=>{this.players.push(We),We.onDone(()=>{We.destroy();const ot=this.players.indexOf(We);this.players.splice(ot,1)}),We.play()}),A3}afterFlush(n){this._flushFns.push(n)}afterFlushAnimationsDone(n){this._whenQuietFns.push(n)}_getPreviousPlayers(n,t,o,c,u){let p=[];if(t){const m=this.playersByQueriedElement.get(n);m&&(p=m)}else{const m=this.playersByElement.get(n);if(m){const E=!u||u==PI;m.forEach(S=>{S.queued||!E&&S.triggerName!=c||p.push(S)})}}return(o||c)&&(p=p.filter(m=>!(o&&o!=m.namespaceId||c&&c!=m.triggerName))),p}_beforeAnimationBuild(n,t,o){const u=t.element,p=t.isRemovalTransition?void 0:n,m=t.isRemovalTransition?void 0:t.triggerName;for(const E of t.timelines){const S=E.element,w=S!==u,P=va(o,S,[]);this._getPreviousPlayers(S,w,p,m,t.toState).forEach(H=>{const z=H.getRealPlayer();z.beforeDestroy&&z.beforeDestroy(),H.destroy(),P.push(H)})}k_(u,t.fromStyles)}_buildAnimation(n,t,o,c,u,p){const m=t.triggerName,E=t.element,S=[],w=new Set,P=new Set,V=t.timelines.map(z=>{const J=z.element;w.add(J);const ce=J[td];if(ce&&ce.removedBeforeQueried)return new AI(z.duration,z.delay);const he=J!==E,le=function VK(e){const n=[];return N6(e,n),n}((o.get(J)||NK).map(wr=>wr.getRealPlayer())).filter(wr=>!!wr.element&&wr.element===J),Le=u.get(J),He=p.get(J),pt=c6(this._normalizer,z.keyframes,Le,He),kn=this._buildPlayer(z,pt,le);if(z.subTimeline&&c&&P.add(J),he){const wr=new OV(n,m,J);wr.setRealPlayer(kn),S.push(wr)}return kn});S.forEach(z=>{va(this.playersByQueriedElement,z.element,[]).push(z),z.onDone(()=>function kK(e,n,t){let o=e.get(n);if(o){if(o.length){const c=o.indexOf(t);o.splice(c,1)}0==o.length&&e.delete(n)}return o}(this.playersByQueriedElement,z.element,z))}),w.forEach(z=>rc(z,f6));const H=Wp(V);return H.onDestroy(()=>{w.forEach(z=>kb(z,f6)),cl(E,t.toStyles)}),P.forEach(z=>{va(c,z,[]).push(H)}),H}_buildPlayer(n,t,o){return t.length>0?this.driver.animate(n.element,t,n.duration,n.delay,n.easing,o):new AI(n.duration,n.delay)}}class OV{constructor(n,t,o){this.namespaceId=n,this.triggerName=t,this.element=o,this._player=new AI,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(n){this._containsRealPlayer||(this._player=n,this._queuedCallbacks.forEach((t,o)=>{t.forEach(c=>cV(n,o,void 0,c))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(n.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(n){this.totalTime=n}syncPlayerEvents(n){const t=this._player;t.triggerCallback&&n.onStart(()=>t.triggerCallback("start")),n.onDone(()=>this.finish()),n.onDestroy(()=>this.destroy())}_queueEvent(n,t){va(this._queuedCallbacks,n,[]).push(t)}onDone(n){this.queued&&this._queueEvent("done",n),this._player.onDone(n)}onStart(n){this.queued&&this._queueEvent("start",n),this._player.onStart(n)}onDestroy(n){this.queued&&this._queueEvent("destroy",n),this._player.onDestroy(n)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(n){this.queued||this._player.setPosition(n)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(n){const t=this._player;t.triggerCallback&&t.triggerCallback(n)}}function VM(e){return e&&1===e.nodeType}function A6(e,n){const t=e.style.display;return e.style.display=n??"none",t}function D6(e,n,t,o,c){const u=[];t.forEach(E=>u.push(A6(E)));const p=[];o.forEach((E,S)=>{const w=new Map;E.forEach(P=>{const V=n.computeStyle(S,P,c);w.set(P,V),(!V||0==V.length)&&(S[td]=PK,p.push(S))}),e.set(S,w)});let m=0;return t.forEach(E=>A6(E,u[m++])),p}function O6(e,n){const t=new Map;if(e.forEach(m=>t.set(m,[])),0==n.length)return t;const c=new Set(n),u=new Map;function p(m){if(!m)return 1;let E=u.get(m);if(E)return E;const S=m.parentNode;return E=t.has(S)?S:c.has(S)?1:p(S),u.set(m,E),E}return n.forEach(m=>{const E=p(m);1!==E&&t.get(E).push(m)}),t}function rc(e,n){e.classList?.add(n)}function kb(e,n){e.classList?.remove(n)}function UK(e,n,t){Wp(t).onDone(()=>e.processLeaveNode(n))}function N6(e,n){for(let t=0;t<e.length;t++){const o=e[t];o instanceof R5?N6(o.players,n):n.push(o)}}function P6(e,n,t){const o=t.get(e);if(!o)return!1;let c=n.get(e);return c?o.forEach(u=>c.add(u)):n.set(e,o),t.delete(e),!0}class MI{constructor(n,t,o,c){this._driver=t,this._normalizer=o,this._triggerCache={},this.onRemovalComplete=(u,p)=>{},this._transitionEngine=new xK(n.body,t,o,c),this._timelineEngine=new wK(n.body,t,o),this._transitionEngine.onRemovalComplete=(u,p)=>this.onRemovalComplete(u,p)}registerTrigger(n,t,o,c,u){const p=n+"-"+c;let m=this._triggerCache[p];if(!m){const E=[],w=yV(this._driver,u,E,[]);if(E.length)throw function Dq(e,n){return new pe(3404,!1)}();m=function SK(e,n,t){return new CK(e,n,t)}(c,w,this._normalizer),this._triggerCache[p]=m}this._transitionEngine.registerTrigger(t,c,m)}register(n,t){this._transitionEngine.register(n,t)}destroy(n,t){this._transitionEngine.destroy(n,t)}onInsert(n,t,o,c){this._transitionEngine.insertNode(n,t,o,c)}onRemove(n,t,o){this._transitionEngine.removeNode(n,t,o)}disableAnimations(n,t){this._transitionEngine.markElementAsDisabled(n,t)}process(n,t,o,c){if("@"==o.charAt(0)){const[u,p]=d6(o);this._timelineEngine.command(u,t,p,c)}else this._transitionEngine.trigger(n,t,o,c)}listen(n,t,o,c,u){if("@"==o.charAt(0)){const[p,m]=d6(o);return this._timelineEngine.listen(p,t,m,u)}return this._transitionEngine.listen(n,t,o,c,u)}flush(n=-1){this._transitionEngine.flush(n)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(n){this._transitionEngine.afterFlushAnimationsDone(n)}}class xI{static#e=this.initialStylesByElement=new WeakMap;constructor(n,t,o){this._element=n,this._startStyles=t,this._endStyles=o,this._state=0;let c=xI.initialStylesByElement.get(n);c||xI.initialStylesByElement.set(n,c=new Map),this._initialStyles=c}start(){this._state<1&&(this._startStyles&&cl(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(cl(this._element,this._initialStyles),this._endStyles&&(cl(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(xI.initialStylesByElement.delete(this._element),this._startStyles&&(k_(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(k_(this._element,this._endStyles),this._endStyles=null),cl(this._element,this._initialStyles),this._state=3)}}function NV(e){let n=null;return e.forEach((t,o)=>{(function HK(e){return"display"===e||"position"===e})(o)&&(n=n||new Map,n.set(o,t))}),n}class M6{constructor(n,t,o,c){this.element=n,this.keyframes=t,this.options=o,this._specialStyles=c,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=o.duration,this._delay=o.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(n=>n()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const n=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,n,this.options),this._finalKeyframe=n.length?n[n.length-1]:new Map;const t=()=>this._onFinish();this.domPlayer.addEventListener("finish",t),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",t)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(n){const t=[];return n.forEach(o=>{t.push(Object.fromEntries(o))}),t}_triggerWebAnimation(n,t,o){return n.animate(this._convertKeyframesToObject(t),o)}onStart(n){this._originalOnStartFns.push(n),this._onStartFns.push(n)}onDone(n){this._originalOnDoneFns.push(n),this._onDoneFns.push(n)}onDestroy(n){this._onDestroyFns.push(n)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(n=>n()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(n=>n()),this._onDestroyFns=[])}setPosition(n){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=n*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const n=new Map;this.hasStarted()&&this._finalKeyframe.forEach((o,c)=>{"offset"!==c&&n.set(c,this._finished?o:bV(this.element,c))}),this.currentSnapshot=n}triggerCallback(n){const t="start"===n?this._onStartFns:this._onDoneFns;t.forEach(o=>o()),t.length=0}}class x6{validateStyleProperty(n){return!0}validateAnimatableStyleProperty(n){return!0}matchesElement(n,t){return!1}containsElement(n,t){return u6(n,t)}getParentElement(n){return uV(n)}query(n,t,o){return h6(n,t,o)}computeStyle(n,t,o){return bV(n,t)}animate(n,t,o,c,u,p=[]){const E={duration:o,delay:c,fill:0==c?"both":"forwards"};u&&(E.easing=u);const S=new Map,w=p.filter(H=>H instanceof M6);(function Zq(e,n){return 0===e||0===n})(o,c)&&w.forEach(H=>{H.currentSnapshot.forEach((z,J)=>S.set(J,z))});let P=function Xq(e){return e.length?e[0]instanceof Map?e:e.map(n=>new Map(Object.entries(n))):[]}(t).map(H=>new Map(H));P=function eK(e,n,t){if(t.size&&n.length){let o=n[0],c=[];if(t.forEach((u,p)=>{o.has(p)||c.push(p),o.set(p,u)}),c.length)for(let u=1;u<n.length;u++){let p=n[u];c.forEach(m=>p.set(m,bV(e,m)))}}return n}(n,P,S);const V=function jK(e,n){let t=null,o=null;return Array.isArray(n)&&n.length?(t=NV(n[0]),n.length>1&&(o=NV(n[n.length-1]))):n instanceof Map&&(t=NV(n)),t||o?new xI(e,t,o):null}(n,P);return new M6(n,P,E,V)}}const k6="@.disabled";class L6{constructor(n,t,o,c){this.namespaceId=n,this.delegate=t,this.engine=o,this._onDestroy=c,this.\u0275type=0}get data(){return this.delegate.data}destroyNode(n){this.delegate.destroyNode?.(n)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(n,t){return this.delegate.createElement(n,t)}createComment(n){return this.delegate.createComment(n)}createText(n){return this.delegate.createText(n)}appendChild(n,t){this.delegate.appendChild(n,t),this.engine.onInsert(this.namespaceId,t,n,!1)}insertBefore(n,t,o,c=!0){this.delegate.insertBefore(n,t,o),this.engine.onInsert(this.namespaceId,t,n,c)}removeChild(n,t,o){this.engine.onRemove(this.namespaceId,t,this.delegate)}selectRootElement(n,t){return this.delegate.selectRootElement(n,t)}parentNode(n){return this.delegate.parentNode(n)}nextSibling(n){return this.delegate.nextSibling(n)}setAttribute(n,t,o,c){this.delegate.setAttribute(n,t,o,c)}removeAttribute(n,t,o){this.delegate.removeAttribute(n,t,o)}addClass(n,t){this.delegate.addClass(n,t)}removeClass(n,t){this.delegate.removeClass(n,t)}setStyle(n,t,o,c){this.delegate.setStyle(n,t,o,c)}removeStyle(n,t,o){this.delegate.removeStyle(n,t,o)}setProperty(n,t,o){"@"==t.charAt(0)&&t==k6?this.disableAnimations(n,!!o):this.delegate.setProperty(n,t,o)}setValue(n,t){this.delegate.setValue(n,t)}listen(n,t,o){return this.delegate.listen(n,t,o)}disableAnimations(n,t){this.engine.disableAnimations(n,t)}}class GK extends L6{constructor(n,t,o,c,u){super(t,o,c,u),this.factory=n,this.namespaceId=t}setProperty(n,t,o){"@"==t.charAt(0)?"."==t.charAt(1)&&t==k6?this.disableAnimations(n,o=void 0===o||!!o):this.engine.process(this.namespaceId,n,t.slice(1),o):this.delegate.setProperty(n,t,o)}listen(n,t,o){if("@"==t.charAt(0)){const c=function WK(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(n);let u=t.slice(1),p="";return"@"!=u.charAt(0)&&([u,p]=function zK(e){const n=e.indexOf(".");return[e.substring(0,n),e.slice(n+1)]}(u)),this.engine.listen(this.namespaceId,c,u,p,m=>{this.factory.scheduleListenerCallback(m._data||-1,o,m)})}return this.delegate.listen(n,t,o)}}class qK{constructor(n,t,o){this.delegate=n,this.engine=t,this._zone=o,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,t.onRemovalComplete=(c,u)=>{const p=u?.parentNode(c);p&&u.removeChild(p,c)}}createRenderer(n,t){const c=this.delegate.createRenderer(n,t);if(!n||!t?.data?.animation){const S=this._rendererCache;let w=S.get(c);return w||(w=new L6("",c,this.engine,()=>S.delete(c)),S.set(c,w)),w}const u=t.id,p=t.id+"-"+this._currentId;this._currentId++,this.engine.register(p,n);const m=S=>{Array.isArray(S)?S.forEach(m):this.engine.registerTrigger(u,p,n,S.name,S)};return t.data.animation.forEach(m),new GK(this,p,c,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(n,t,o){if(n>=0&&n<this._microtaskId)return void this._zone.run(()=>t(o));const c=this._animationCallbacksBuffer;0==c.length&&queueMicrotask(()=>{this._zone.run(()=>{c.forEach(u=>{const[p,m]=u;p(m)}),this._animationCallbacksBuffer=[]})}),c.push([t,o])}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}const F6=[{provide:fV,useFactory:function YK(){return new g6}},{provide:MI,useClass:(()=>{class e extends MI{constructor(t,o,c){super(t,o,c,Te(YS,{optional:!0}))}ngOnDestroy(){this.flush()}static#e=this.\u0275fac=function(o){return new(o||e)(be(on),be(pV),be(fV))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})()},{provide:AE,useFactory:function $K(e,n,t){return new qK(e,n,t)},deps:[cU,MI,it]}],PV=[{provide:pV,useFactory:()=>new x6},{provide:yc,useValue:"BrowserAnimations"},...F6],U6=[{provide:pV,useClass:hV},{provide:yc,useValue:"NoopAnimations"},...F6];let XK=(()=>{class e{static withConfig(t){return{ngModule:e,providers:t.disableAnimations?U6:PV}}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Jn({providers:PV,imports:[gj]})}return e})();const jM=ay(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function V6(e){return new Wn(n=>{ws(e()).subscribe(n)})}function HM(e,n){const t=cn(e)?e:()=>e,o=c=>c.error(t());return new Wn(n?c=>n.schedule(o,0,c):o)}function MV(){return Si((e,n)=>{let t=null;e._refCount++;const o=di(n,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(t=null);const c=e._connection,u=t;t=null,c&&(!u||c===u)&&c.unsubscribe(),n.unsubscribe()});e.subscribe(o),o.closed||(t=e.connect())})}class B6 extends Wn{constructor(n,t){super(),this.source=n,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,cw(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new nr;const t=this.getSubject();n.add(this.source.subscribe(di(t,void 0,()=>{this._teardown(),t.complete()},o=>{this._teardown(),t.error(o)},()=>this._teardown()))),n.closed&&(this._connection=null,n=nr.EMPTY)}return n}refCount(){return MV()(this)}}function dl(e,n){return Si((t,o)=>{let c=null,u=0,p=!1;const m=()=>p&&!c&&o.complete();t.subscribe(di(o,E=>{c?.unsubscribe();let S=0;const w=u++;ws(e(E,w)).subscribe(c=di(o,P=>o.next(n?n(E,P,w,S++):P),()=>{c=null,m()}))},()=>{p=!0,m()}))})}function GM(e){return Si((n,t)=>{let o=!1;n.subscribe(di(t,c=>{o=!0,t.next(c)},()=>{o||t.next(e),t.complete()}))})}function j6(e=QK){return Si((n,t)=>{let o=!1;n.subscribe(di(t,c=>{o=!0,t.next(c)},()=>o?t.complete():t.error(e())))})}function QK(){return new jM}function F_(e,n){const t=arguments.length>=2;return o=>o.pipe(e?Ea((c,u)=>e(c,u,o)):cd,Vu(1),t?GM(n):j6(()=>new jM))}function kI(e,n){return cn(n)?_o(e,n,1):_o(e,1)}function go(e,n,t){const o=cn(e)||n||t?{next:e,error:n,complete:t}:e;return o?Si((c,u)=>{var p;null===(p=o.subscribe)||void 0===p||p.call(o);let m=!0;c.subscribe(di(u,E=>{var S;null===(S=o.next)||void 0===S||S.call(o,E),u.next(E)},()=>{var E;m=!1,null===(E=o.complete)||void 0===E||E.call(o),u.complete()},E=>{var S;m=!1,null===(S=o.error)||void 0===S||S.call(o,E),u.error(E)},()=>{var E,S;m&&(null===(E=o.unsubscribe)||void 0===E||E.call(o)),null===(S=o.finalize)||void 0===S||S.call(o)}))}):cd}function Lb(e){return Si((n,t)=>{let u,o=null,c=!1;o=n.subscribe(di(t,void 0,void 0,p=>{u=ws(e(p,Lb(e)(n))),o?(o.unsubscribe(),o=null,u.subscribe(t)):c=!0})),c&&(o.unsubscribe(),o=null,u.subscribe(t))})}function xV(e){return e<=0?()=>ed:Si((n,t)=>{let o=[];n.subscribe(di(t,c=>{o.push(c),e<o.length&&o.shift()},()=>{for(const c of o)t.next(c);t.complete()},void 0,()=>{o=null}))})}function kV(e){return Si((n,t)=>{try{n.subscribe(t)}finally{t.add(e)}})}const Ut="primary",LI=Symbol("RouteTitle");class iY{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t[0]:t}return null}getAll(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function Fb(e){return new iY(e)}function rY(e,n,t){const o=t.path.split("/");if(o.length>e.length||"full"===t.pathMatch&&(n.hasChildren()||o.length<e.length))return null;const c={};for(let u=0;u<o.length;u++){const p=o[u],m=e[u];if(p.startsWith(":"))c[p.substring(1)]=m;else if(p!==m.path)return null}return{consumed:e.slice(0,o.length),posParams:c}}function ll(e,n){const t=e?LV(e):void 0,o=n?LV(n):void 0;if(!t||!o||t.length!=o.length)return!1;let c;for(let u=0;u<t.length;u++)if(c=t[u],!H6(e[c],n[c]))return!1;return!0}function LV(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function H6(e,n){if(Array.isArray(e)&&Array.isArray(n)){if(e.length!==n.length)return!1;const t=[...e].sort(),o=[...n].sort();return t.every((c,u)=>o[u]===c)}return e===n}function G6(e){return e.length>0?e[e.length-1]:null}function zp(e){return function JK(e){return!!e&&(e instanceof Wn||cn(e.lift)&&cn(e.subscribe))}(e)?e:fp(e)?Vr(Promise.resolve(e)):vt(e)}const sY={exact:function q6(e,n,t){if(!U_(e.segments,n.segments)||!WM(e.segments,n.segments,t)||e.numberOfChildren!==n.numberOfChildren)return!1;for(const o in n.children)if(!e.children[o]||!q6(e.children[o],n.children[o],t))return!1;return!0},subset:K6},W6={exact:function aY(e,n){return ll(e,n)},subset:function cY(e,n){return Object.keys(n).length<=Object.keys(e).length&&Object.keys(n).every(t=>H6(e[t],n[t]))},ignored:()=>!0};function z6(e,n,t){return sY[t.paths](e.root,n.root,t.matrixParams)&&W6[t.queryParams](e.queryParams,n.queryParams)&&!("exact"===t.fragment&&e.fragment!==n.fragment)}function K6(e,n,t){return Y6(e,n,n.segments,t)}function Y6(e,n,t,o){if(e.segments.length>t.length){const c=e.segments.slice(0,t.length);return!(!U_(c,t)||n.hasChildren()||!WM(c,t,o))}if(e.segments.length===t.length){if(!U_(e.segments,t)||!WM(e.segments,t,o))return!1;for(const c in n.children)if(!e.children[c]||!K6(e.children[c],n.children[c],o))return!1;return!0}{const c=t.slice(0,e.segments.length),u=t.slice(e.segments.length);return!!(U_(e.segments,c)&&WM(e.segments,c,o)&&e.children[Ut])&&Y6(e.children[Ut],n,u,o)}}function WM(e,n,t){return n.every((o,c)=>W6[t](e[c].parameters,o.parameters))}class Ub{constructor(n=new ci([],{}),t={},o=null){this.root=n,this.queryParams=t,this.fragment=o}get queryParamMap(){return this._queryParamMap??=Fb(this.queryParams),this._queryParamMap}toString(){return uY.serialize(this)}}class ci{constructor(n,t){this.segments=n,this.children=t,this.parent=null,Object.values(t).forEach(o=>o.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return zM(this)}}class FI{constructor(n,t){this.path=n,this.parameters=t}get parameterMap(){return this._parameterMap??=Fb(this.parameters),this._parameterMap}toString(){return J6(this)}}function U_(e,n){return e.length===n.length&&e.every((t,o)=>t.path===n[o].path)}let Vb=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:()=>new FV,providedIn:"root"})}return e})();class FV{parse(n){const t=new SY(n);return new Ub(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(n){const t=`/${UI(n.root,!0)}`,o=function fY(e){const n=Object.entries(e).map(([t,o])=>Array.isArray(o)?o.map(c=>`${qM(t)}=${qM(c)}`).join("&"):`${qM(t)}=${qM(o)}`).filter(t=>t);return n.length?`?${n.join("&")}`:""}(n.queryParams);return`${t}${o}${"string"==typeof n.fragment?`#${function hY(e){return encodeURI(e)}(n.fragment)}`:""}`}}const uY=new FV;function zM(e){return e.segments.map(n=>J6(n)).join("/")}function UI(e,n){if(!e.hasChildren())return zM(e);if(n){const t=e.children[Ut]?UI(e.children[Ut],!1):"",o=[];return Object.entries(e.children).forEach(([c,u])=>{c!==Ut&&o.push(`${c}:${UI(u,!1)}`)}),o.length>0?`${t}(${o.join("//")})`:t}{const t=function lY(e,n){let t=[];return Object.entries(e.children).forEach(([o,c])=>{o===Ut&&(t=t.concat(n(c,o)))}),Object.entries(e.children).forEach(([o,c])=>{o!==Ut&&(t=t.concat(n(c,o)))}),t}(e,(o,c)=>c===Ut?[UI(e.children[Ut],!1)]:[`${c}:${UI(o,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[Ut]?`${zM(e)}/${t[0]}`:`${zM(e)}/(${t.join("//")})`}}function $6(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function qM(e){return $6(e).replace(/%3B/gi,";")}function UV(e){return $6(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function KM(e){return decodeURIComponent(e)}function X6(e){return KM(e.replace(/\+/g,"%20"))}function J6(e){return`${UV(e.path)}${function pY(e){return Object.entries(e).map(([n,t])=>`;${UV(n)}=${UV(t)}`).join("")}(e.parameters)}`}const mY=/^[^\/()?;#]+/;function VV(e){const n=e.match(mY);return n?n[0]:""}const _Y=/^[^\/()?;=#]+/,EY=/^[^=?&#]+/,bY=/^[^&#]+/;class SY{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new ci([],{}):new ci([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let o={};return this.peekStartsWith("(")&&(o=this.parseParens(!1)),(n.length>0||Object.keys(t).length>0)&&(o[Ut]=new ci(n,t)),o}parseSegment(){const n=VV(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new pe(4009,!1);return this.capture(n),new FI(KM(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const t=function gY(e){const n=e.match(_Y);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let o="";if(this.consumeOptional("=")){const c=VV(this.remaining);c&&(o=c,this.capture(o))}n[KM(t)]=KM(o)}parseQueryParam(n){const t=function vY(e){const n=e.match(EY);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let o="";if(this.consumeOptional("=")){const p=function yY(e){const n=e.match(bY);return n?n[0]:""}(this.remaining);p&&(o=p,this.capture(o))}const c=X6(t),u=X6(o);if(n.hasOwnProperty(c)){let p=n[c];Array.isArray(p)||(p=[p],n[c]=p),p.push(u)}else n[c]=u}parseParens(n){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const o=VV(this.remaining),c=this.remaining[o.length];if("/"!==c&&")"!==c&&";"!==c)throw new pe(4010,!1);let u;o.indexOf(":")>-1?(u=o.slice(0,o.indexOf(":")),this.capture(u),this.capture(":")):n&&(u=Ut);const p=this.parseChildren();t[u]=1===Object.keys(p).length?p[Ut]:new ci([],p),this.consumeOptional("//")}return t}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new pe(4011,!1)}}function Q6(e){return e.segments.length>0?new ci([],{[Ut]:e}):e}function Z6(e){const n={};for(const[o,c]of Object.entries(e.children)){const u=Z6(c);if(o===Ut&&0===u.segments.length&&u.hasChildren())for(const[p,m]of Object.entries(u.children))n[p]=m;else(u.segments.length>0||u.hasChildren())&&(n[o]=u)}return function CY(e){if(1===e.numberOfChildren&&e.children[Ut]){const n=e.children[Ut];return new ci(e.segments.concat(n.segments),n.children)}return e}(new ci(e.segments,n))}function Bb(e){return e instanceof Ub}function eH(e){let n;const c=Q6(function t(u){const p={};for(const E of u.children){const S=t(E);p[E.outlet]=S}const m=new ci(u.url,p);return u===e&&(n=m),m}(e.root));return n??c}function tH(e,n,t,o){let c=e;for(;c.parent;)c=c.parent;if(0===n.length)return BV(c,c,c,t,o);const u=function IY(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new iH(!0,0,e);let n=0,t=!1;const o=e.reduce((c,u,p)=>{if("object"==typeof u&&null!=u){if(u.outlets){const m={};return Object.entries(u.outlets).forEach(([E,S])=>{m[E]="string"==typeof S?S.split("/"):S}),[...c,{outlets:m}]}if(u.segmentPath)return[...c,u.segmentPath]}return"string"!=typeof u?[...c,u]:0===p?(u.split("/").forEach((m,E)=>{0==E&&"."===m||(0==E&&""===m?t=!0:".."===m?n++:""!=m&&c.push(m))}),c):[...c,u]},[]);return new iH(t,n,o)}(n);if(u.toRoot())return BV(c,c,new ci([],{}),t,o);const p=function wY(e,n,t){if(e.isAbsolute)return new $M(n,!0,0);if(!t)return new $M(n,!1,NaN);if(null===t.parent)return new $M(t,!0,0);const o=YM(e.commands[0])?0:1;return function RY(e,n,t){let o=e,c=n,u=t;for(;u>c;){if(u-=c,o=o.parent,!o)throw new pe(4005,!1);c=o.segments.length}return new $M(o,!1,c-u)}(t,t.segments.length-1+o,e.numberOfDoubleDots)}(u,c,e),m=p.processChildren?BI(p.segmentGroup,p.index,u.commands):rH(p.segmentGroup,p.index,u.commands);return BV(c,p.segmentGroup,m,t,o)}function YM(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function VI(e){return"object"==typeof e&&null!=e&&e.outlets}function BV(e,n,t,o,c){let p,u={};o&&Object.entries(o).forEach(([E,S])=>{u[E]=Array.isArray(S)?S.map(w=>`${w}`):`${S}`}),p=e===n?t:nH(e,n,t);const m=Q6(Z6(p));return new Ub(m,u,c)}function nH(e,n,t){const o={};return Object.entries(e.children).forEach(([c,u])=>{o[c]=u===n?t:nH(u,n,t)}),new ci(e.segments,o)}class iH{constructor(n,t,o){if(this.isAbsolute=n,this.numberOfDoubleDots=t,this.commands=o,n&&o.length>0&&YM(o[0]))throw new pe(4003,!1);const c=o.find(VI);if(c&&c!==G6(o))throw new pe(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class $M{constructor(n,t,o){this.segmentGroup=n,this.processChildren=t,this.index=o}}function rH(e,n,t){if(e??=new ci([],{}),0===e.segments.length&&e.hasChildren())return BI(e,n,t);const o=function DY(e,n,t){let o=0,c=n;const u={match:!1,pathIndex:0,commandIndex:0};for(;c<e.segments.length;){if(o>=t.length)return u;const p=e.segments[c],m=t[o];if(VI(m))break;const E=`${m}`,S=o<t.length-1?t[o+1]:null;if(c>0&&void 0===E)break;if(E&&S&&"object"==typeof S&&void 0===S.outlets){if(!sH(E,S,p))return u;o+=2}else{if(!sH(E,{},p))return u;o++}c++}return{match:!0,pathIndex:c,commandIndex:o}}(e,n,t),c=t.slice(o.commandIndex);if(o.match&&o.pathIndex<e.segments.length){const u=new ci(e.segments.slice(0,o.pathIndex),{});return u.children[Ut]=new ci(e.segments.slice(o.pathIndex),e.children),BI(u,0,c)}return o.match&&0===c.length?new ci(e.segments,{}):o.match&&!e.hasChildren()?jV(e,n,t):o.match?BI(e,0,c):jV(e,n,t)}function BI(e,n,t){if(0===t.length)return new ci(e.segments,{});{const o=function AY(e){return VI(e[0])?e[0].outlets:{[Ut]:e}}(t),c={};if(Object.keys(o).some(u=>u!==Ut)&&e.children[Ut]&&1===e.numberOfChildren&&0===e.children[Ut].segments.length){const u=BI(e.children[Ut],n,t);return new ci(e.segments,u.children)}return Object.entries(o).forEach(([u,p])=>{"string"==typeof p&&(p=[p]),null!==p&&(c[u]=rH(e.children[u],n,p))}),Object.entries(e.children).forEach(([u,p])=>{void 0===o[u]&&(c[u]=p)}),new ci(e.segments,c)}}function jV(e,n,t){const o=e.segments.slice(0,n);let c=0;for(;c<t.length;){const u=t[c];if(VI(u)){const E=OY(u.outlets);return new ci(o,E)}if(0===c&&YM(t[0])){o.push(new FI(e.segments[n].path,oH(t[0]))),c++;continue}const p=VI(u)?u.outlets[Ut]:`${u}`,m=c<t.length-1?t[c+1]:null;p&&m&&YM(m)?(o.push(new FI(p,oH(m))),c+=2):(o.push(new FI(p,{})),c++)}return new ci(o,{})}function OY(e){const n={};return Object.entries(e).forEach(([t,o])=>{"string"==typeof o&&(o=[o]),null!==o&&(n[t]=jV(new ci([],{}),0,o))}),n}function oH(e){const n={};return Object.entries(e).forEach(([t,o])=>n[t]=`${o}`),n}function sH(e,n,t){return e==t.path&&ll(n,t.parameters)}const jI="imperative";var sn=function(e){return e[e.NavigationStart=0]="NavigationStart",e[e.NavigationEnd=1]="NavigationEnd",e[e.NavigationCancel=2]="NavigationCancel",e[e.NavigationError=3]="NavigationError",e[e.RoutesRecognized=4]="RoutesRecognized",e[e.ResolveStart=5]="ResolveStart",e[e.ResolveEnd=6]="ResolveEnd",e[e.GuardsCheckStart=7]="GuardsCheckStart",e[e.GuardsCheckEnd=8]="GuardsCheckEnd",e[e.RouteConfigLoadStart=9]="RouteConfigLoadStart",e[e.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",e[e.ChildActivationStart=11]="ChildActivationStart",e[e.ChildActivationEnd=12]="ChildActivationEnd",e[e.ActivationStart=13]="ActivationStart",e[e.ActivationEnd=14]="ActivationEnd",e[e.Scroll=15]="Scroll",e[e.NavigationSkipped=16]="NavigationSkipped",e}(sn||{});class ul{constructor(n,t){this.id=n,this.url=t}}class XM extends ul{constructor(n,t,o="imperative",c=null){super(n,t),this.type=sn.NavigationStart,this.navigationTrigger=o,this.restoredState=c}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Hu extends ul{constructor(n,t,o){super(n,t),this.urlAfterRedirects=o,this.type=sn.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}var oc=function(e){return e[e.Redirect=0]="Redirect",e[e.SupersededByNewNavigation=1]="SupersededByNewNavigation",e[e.NoDataFromResolver=2]="NoDataFromResolver",e[e.GuardRejected=3]="GuardRejected",e}(oc||{}),JM=function(e){return e[e.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",e[e.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",e}(JM||{});class jb extends ul{constructor(n,t,o,c){super(n,t),this.reason=o,this.code=c,this.type=sn.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Hb extends ul{constructor(n,t,o,c){super(n,t),this.reason=o,this.code=c,this.type=sn.NavigationSkipped}}class QM extends ul{constructor(n,t,o,c){super(n,t),this.error=o,this.target=c,this.type=sn.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class aH extends ul{constructor(n,t,o,c){super(n,t),this.urlAfterRedirects=o,this.state=c,this.type=sn.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class NY extends ul{constructor(n,t,o,c){super(n,t),this.urlAfterRedirects=o,this.state=c,this.type=sn.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class PY extends ul{constructor(n,t,o,c,u){super(n,t),this.urlAfterRedirects=o,this.state=c,this.shouldActivate=u,this.type=sn.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class MY extends ul{constructor(n,t,o,c){super(n,t),this.urlAfterRedirects=o,this.state=c,this.type=sn.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class xY extends ul{constructor(n,t,o,c){super(n,t),this.urlAfterRedirects=o,this.state=c,this.type=sn.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class kY{constructor(n){this.route=n,this.type=sn.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class LY{constructor(n){this.route=n,this.type=sn.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class FY{constructor(n){this.snapshot=n,this.type=sn.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class UY{constructor(n){this.snapshot=n,this.type=sn.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class VY{constructor(n){this.snapshot=n,this.type=sn.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class BY{constructor(n){this.snapshot=n,this.type=sn.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class cH{constructor(n,t,o){this.routerEvent=n,this.position=t,this.anchor=o,this.type=sn.Scroll}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class HV{}class GV{constructor(n){this.url=n}}class jY{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new HI,this.attachRef=null}}let HI=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(t,o){const c=this.getOrCreateContext(t);c.outlet=o,this.contexts.set(t,c)}onChildOutletDestroyed(t){const o=this.getContext(t);o&&(o.outlet=null,o.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let o=this.getContext(t);return o||(o=new jY,this.contexts.set(t,o)),o}getContext(t){return this.contexts.get(t)||null}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class dH{constructor(n){this._root=n}get root(){return this._root.value}parent(n){const t=this.pathFromRoot(n);return t.length>1?t[t.length-2]:null}children(n){const t=WV(n,this._root);return t?t.children.map(o=>o.value):[]}firstChild(n){const t=WV(n,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(n){const t=zV(n,this._root);return t.length<2?[]:t[t.length-2].children.map(c=>c.value).filter(c=>c!==n)}pathFromRoot(n){return zV(n,this._root).map(t=>t.value)}}function WV(e,n){if(e===n.value)return n;for(const t of n.children){const o=WV(e,t);if(o)return o}return null}function zV(e,n){if(e===n.value)return[n];for(const t of n.children){const o=zV(e,t);if(o.length)return o.unshift(n),o}return[]}class nd{constructor(n,t){this.value=n,this.children=t}toString(){return`TreeNode(${this.value})`}}function Gb(e){const n={};return e&&e.children.forEach(t=>n[t.value.outlet]=t),n}class lH extends dH{constructor(n,t){super(n),this.snapshot=t,YV(this,n)}toString(){return this.snapshot.toString()}}function uH(e){const n=function HY(e){const u=new KV([],{},{},"",{},Ut,e,null,{});return new hH("",new nd(u,[]))}(e),t=new Yo([new FI("",{})]),o=new Yo({}),c=new Yo({}),u=new Yo({}),p=new Yo(""),m=new V_(t,o,u,p,c,Ut,e,n.root);return m.snapshot=n.root,new lH(new nd(m,[]),n)}class V_{constructor(n,t,o,c,u,p,m,E){this.urlSubject=n,this.paramsSubject=t,this.queryParamsSubject=o,this.fragmentSubject=c,this.dataSubject=u,this.outlet=p,this.component=m,this._futureSnapshot=E,this.title=this.dataSubject?.pipe(Zt(S=>S[LI]))??vt(void 0),this.url=n,this.params=t,this.queryParams=o,this.fragment=c,this.data=u}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Zt(n=>Fb(n))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Zt(n=>Fb(n))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function qV(e,n,t="emptyOnly"){let o;const{routeConfig:c}=e;return o=null===n||"always"!==t&&""!==c?.path&&(n.component||n.routeConfig?.loadComponent)?{params:{...e.params},data:{...e.data},resolve:{...e.data,...e._resolvedData??{}}}:{params:{...n.params,...e.params},data:{...n.data,...e.data},resolve:{...e.data,...n.data,...c?.data,...e._resolvedData}},c&&fH(c)&&(o.resolve[LI]=c.title),o}class KV{get title(){return this.data?.[LI]}constructor(n,t,o,c,u,p,m,E,S){this.url=n,this.params=t,this.queryParams=o,this.fragment=c,this.data=u,this.outlet=p,this.component=m,this.routeConfig=E,this._resolve=S}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Fb(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Fb(this.queryParams),this._queryParamMap}toString(){return`Route(url:'${this.url.map(o=>o.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class hH extends dH{constructor(n,t){super(t),this.url=n,YV(this,t)}toString(){return pH(this._root)}}function YV(e,n){n.value._routerState=e,n.children.forEach(t=>YV(e,t))}function pH(e){const n=e.children.length>0?` { ${e.children.map(pH).join(", ")} } `:"";return`${e.value}${n}`}function $V(e){if(e.snapshot){const n=e.snapshot,t=e._futureSnapshot;e.snapshot=t,ll(n.queryParams,t.queryParams)||e.queryParamsSubject.next(t.queryParams),n.fragment!==t.fragment&&e.fragmentSubject.next(t.fragment),ll(n.params,t.params)||e.paramsSubject.next(t.params),function oY(e,n){if(e.length!==n.length)return!1;for(let t=0;t<e.length;++t)if(!ll(e[t],n[t]))return!1;return!0}(n.url,t.url)||e.urlSubject.next(t.url),ll(n.data,t.data)||e.dataSubject.next(t.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function XV(e,n){const t=ll(e.params,n.params)&&function dY(e,n){return U_(e,n)&&e.every((t,o)=>ll(t.parameters,n[o].parameters))}(e.url,n.url);return t&&!(!e.parent!=!n.parent)&&(!e.parent||XV(e.parent,n.parent))}function fH(e){return"string"==typeof e.title||null===e.title}let JV=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=Ut,this.activateEvents=new hn,this.deactivateEvents=new hn,this.attachEvents=new hn,this.detachEvents=new hn,this.parentContexts=Te(HI),this.location=Te(mr),this.changeDetector=Te(Us),this.environmentInjector=Te(ts),this.inputBinder=Te(ZM,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(t){if(t.name){const{firstChange:o,previousValue:c}=t.name;if(o)return;this.isTrackedInParentContexts(c)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(c)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new pe(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new pe(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new pe(4012,!1);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,o){this.activated=t,this._activatedRoute=o,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,o){if(this.isActivated)throw new pe(4013,!1);this._activatedRoute=t;const c=this.location,p=t.snapshot.component,m=this.parentContexts.getOrCreateContext(this.name).children,E=new GY(t,m,c.injector);this.activated=c.createComponent(p,{index:c.length,injector:E,environmentInjector:o??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275dir=Ye({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[So]})}return e})();class GY{constructor(n,t,o){this.route=n,this.childContexts=t,this.parent=o}get(n,t){return n===V_?this.route:n===HI?this.childContexts:this.parent.get(n,t)}}const ZM=new De("");let mH=(()=>{class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(t){this.unsubscribeFromRouteData(t),this.subscribeToRouteData(t)}unsubscribeFromRouteData(t){this.outletDataSubscriptions.get(t)?.unsubscribe(),this.outletDataSubscriptions.delete(t)}subscribeToRouteData(t){const{activatedRoute:o}=t,c=gM([o.queryParams,o.params,o.data]).pipe(dl(([u,p,m],E)=>(m={...u,...p,...m},0===E?vt(m):Promise.resolve(m)))).subscribe(u=>{if(!t.isActivated||!t.activatedComponentRef||t.activatedRoute!==o||null===o.component)return void this.unsubscribeFromRouteData(t);const p=function EP(e){const n=Lt(e);if(!n)return null;const t=new cm(n);return{get selector(){return t.selector},get type(){return t.componentType},get inputs(){return t.inputs},get outputs(){return t.outputs},get ngContentSelectors(){return t.ngContentSelectors},get isStandalone(){return n.standalone},get isSignal(){return n.signals}}}(o.component);if(p)for(const{templateName:m}of p.inputs)t.activatedComponentRef.setInput(m,u[m]);else this.unsubscribeFromRouteData(t)});this.outletDataSubscriptions.set(t,c)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})();function GI(e,n,t){if(t&&e.shouldReuseRoute(n.value,t.value.snapshot)){const o=t.value;o._futureSnapshot=n.value;const c=function zY(e,n,t){return n.children.map(o=>{for(const c of t.children)if(e.shouldReuseRoute(o.value,c.value.snapshot))return GI(e,o,c);return GI(e,o)})}(e,n,t);return new nd(o,c)}{if(e.shouldAttach(n.value)){const u=e.retrieve(n.value);if(null!==u){const p=u.route;return p.value._futureSnapshot=n.value,p.children=n.children.map(m=>GI(e,m)),p}}const o=function qY(e){return new V_(new Yo(e.url),new Yo(e.params),new Yo(e.queryParams),new Yo(e.fragment),new Yo(e.data),e.outlet,e.component,e)}(n.value),c=n.children.map(u=>GI(e,u));return new nd(o,c)}}const _H="ngNavigationCancelingError";function gH(e,n){const{redirectTo:t,navigationBehaviorOptions:o}=Bb(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,c=EH(!1,oc.Redirect);return c.url=t,c.navigationBehaviorOptions=o,c}function EH(e,n){const t=new Error(`NavigationCancelingError: ${e||""}`);return t[_H]=!0,t.cancellationCode=n,t}function vH(e){return!!e&&e[_H]}let bH=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275cmp=Br({type:e,selectors:[["ng-component"]],standalone:!0,features:[Gc],decls:1,vars:0,template:function(o,c){1&o&&de(0,"router-outlet")},dependencies:[JV],encapsulation:2})}return e})();function QV(e){const n=e.children&&e.children.map(QV),t=n?{...e,children:n}:{...e};return!t.component&&!t.loadComponent&&(n||t.loadChildren)&&t.outlet&&t.outlet!==Ut&&(t.component=bH),t}function hl(e){return e.outlet||Ut}function WI(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let n=e.parent;n;n=n.parent){const t=n.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class e${constructor(n,t,o,c,u){this.routeReuseStrategy=n,this.futureState=t,this.currState=o,this.forwardEvent=c,this.inputBindingEnabled=u}activate(n){const t=this.futureState._root,o=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,o,n),$V(this.futureState.root),this.activateChildRoutes(t,o,n)}deactivateChildRoutes(n,t,o){const c=Gb(t);n.children.forEach(u=>{const p=u.value.outlet;this.deactivateRoutes(u,c[p],o),delete c[p]}),Object.values(c).forEach(u=>{this.deactivateRouteAndItsChildren(u,o)})}deactivateRoutes(n,t,o){const c=n.value,u=t?t.value:null;if(c===u)if(c.component){const p=o.getContext(c.outlet);p&&this.deactivateChildRoutes(n,t,p.children)}else this.deactivateChildRoutes(n,t,o);else u&&this.deactivateRouteAndItsChildren(t,o)}deactivateRouteAndItsChildren(n,t){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,t):this.deactivateRouteAndOutlet(n,t)}detachAndStoreRouteSubtree(n,t){const o=t.getContext(n.value.outlet),c=o&&n.value.component?o.children:t,u=Gb(n);for(const p of Object.values(u))this.deactivateRouteAndItsChildren(p,c);if(o&&o.outlet){const p=o.outlet.detach(),m=o.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:p,route:n,contexts:m})}}deactivateRouteAndOutlet(n,t){const o=t.getContext(n.value.outlet),c=o&&n.value.component?o.children:t,u=Gb(n);for(const p of Object.values(u))this.deactivateRouteAndItsChildren(p,c);o&&(o.outlet&&(o.outlet.deactivate(),o.children.onOutletDeactivated()),o.attachRef=null,o.route=null)}activateChildRoutes(n,t,o){const c=Gb(t);n.children.forEach(u=>{this.activateRoutes(u,c[u.value.outlet],o),this.forwardEvent(new BY(u.value.snapshot))}),n.children.length&&this.forwardEvent(new UY(n.value.snapshot))}activateRoutes(n,t,o){const c=n.value,u=t?t.value:null;if($V(c),c===u)if(c.component){const p=o.getOrCreateContext(c.outlet);this.activateChildRoutes(n,t,p.children)}else this.activateChildRoutes(n,t,o);else if(c.component){const p=o.getOrCreateContext(c.outlet);if(this.routeReuseStrategy.shouldAttach(c.snapshot)){const m=this.routeReuseStrategy.retrieve(c.snapshot);this.routeReuseStrategy.store(c.snapshot,null),p.children.onOutletReAttached(m.contexts),p.attachRef=m.componentRef,p.route=m.route.value,p.outlet&&p.outlet.attach(m.componentRef,m.route.value),$V(m.route.value),this.activateChildRoutes(n,null,p.children)}else{const m=WI(c.snapshot);p.attachRef=null,p.route=c,p.injector=m,p.outlet&&p.outlet.activateWith(c,p.injector),this.activateChildRoutes(n,null,p.children)}}else this.activateChildRoutes(n,null,o)}}class yH{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class ex{constructor(n,t){this.component=n,this.route=t}}function t$(e,n,t){const o=e._root;return zI(o,n?n._root:null,t,[o.value])}function Wb(e,n){const t=Symbol(),o=n.get(e,t);return o===t?"function"!=typeof e||function Ox(e){return null!==og(e)}(e)?n.get(e):e:o}function zI(e,n,t,o,c={canDeactivateChecks:[],canActivateChecks:[]}){const u=Gb(n);return e.children.forEach(p=>{(function i$(e,n,t,o,c={canDeactivateChecks:[],canActivateChecks:[]}){const u=e.value,p=n?n.value:null,m=t?t.getContext(e.value.outlet):null;if(p&&u.routeConfig===p.routeConfig){const E=function r$(e,n,t){if("function"==typeof t)return t(e,n);switch(t){case"pathParamsChange":return!U_(e.url,n.url);case"pathParamsOrQueryParamsChange":return!U_(e.url,n.url)||!ll(e.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!XV(e,n)||!ll(e.queryParams,n.queryParams);default:return!XV(e,n)}}(p,u,u.routeConfig.runGuardsAndResolvers);E?c.canActivateChecks.push(new yH(o)):(u.data=p.data,u._resolvedData=p._resolvedData),zI(e,n,u.component?m?m.children:null:t,o,c),E&&m&&m.outlet&&m.outlet.isActivated&&c.canDeactivateChecks.push(new ex(m.outlet.component,p))}else p&&qI(n,m,c),c.canActivateChecks.push(new yH(o)),zI(e,null,u.component?m?m.children:null:t,o,c)})(p,u[p.value.outlet],t,o.concat([p.value]),c),delete u[p.value.outlet]}),Object.entries(u).forEach(([p,m])=>qI(m,t.getContext(p),c)),c}function qI(e,n,t){const o=Gb(e),c=e.value;Object.entries(o).forEach(([u,p])=>{qI(p,c.component?n?n.children.getContext(u):null:n,t)}),t.canDeactivateChecks.push(new ex(c.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,c))}function KI(e){return"function"==typeof e}function SH(e){return e instanceof jM||"EmptyError"===e?.name}const tx=Symbol("INITIAL_VALUE");function zb(){return dl(e=>gM(e.map(n=>n.pipe(Vu(1),Q4(tx)))).pipe(Zt(n=>{for(const t of n)if(!0!==t){if(t===tx)return tx;if(!1===t||t instanceof Ub)return t}return!0}),Ea(n=>n!==tx),Vu(1)))}function CH(e){return function _x(...e){return sw(e)}(go(n=>{if(Bb(n))throw gH(0,n)}),Zt(n=>!0===n))}class ZV{constructor(n){this.segmentGroup=n||null}}class e3 extends Error{constructor(n){super(),this.urlTree=n}}function qb(e){return HM(new ZV(e))}class C${constructor(n,t){this.urlSerializer=n,this.urlTree=t}lineralizeSegments(n,t){let o=[],c=t.root;for(;;){if(o=o.concat(c.segments),0===c.numberOfChildren)return vt(o);if(c.numberOfChildren>1||!c.children[Ut])return HM(new pe(4e3,!1));c=c.children[Ut]}}applyRedirectCommands(n,t,o){const c=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),n,o);if(t.startsWith("/"))throw new e3(c);return c}applyRedirectCreateUrlTree(n,t,o,c){const u=this.createSegmentGroup(n,t.root,o,c);return new Ub(u,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(n,t){const o={};return Object.entries(n).forEach(([c,u])=>{if("string"==typeof u&&u.startsWith(":")){const m=u.substring(1);o[c]=t[m]}else o[c]=u}),o}createSegmentGroup(n,t,o,c){const u=this.createSegments(n,t.segments,o,c);let p={};return Object.entries(t.children).forEach(([m,E])=>{p[m]=this.createSegmentGroup(n,E,o,c)}),new ci(u,p)}createSegments(n,t,o,c){return t.map(u=>u.path.startsWith(":")?this.findPosParam(n,u,c):this.findOrReturn(u,o))}findPosParam(n,t,o){const c=o[t.path.substring(1)];if(!c)throw new pe(4001,!1);return c}findOrReturn(n,t){let o=0;for(const c of t){if(c.path===n.path)return t.splice(o),c;o++}return n}}const t3={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function T$(e,n,t,o,c){const u=n3(e,n,t);return u.matched?(o=function YY(e,n){return e.providers&&!e._injector&&(e._injector=Km(e.providers,n,`Route: ${e.path}`)),e._injector??n}(n,o),function b$(e,n,t,o){const c=n.canMatch;return c&&0!==c.length?vt(c.map(p=>{const m=Wb(p,e);return zp(function l$(e){return e&&KI(e.canMatch)}(m)?m.canMatch(n,t):wo(e,()=>m(n,t)))})).pipe(zb(),CH()):vt(!0)}(o,n,t).pipe(Zt(p=>!0===p?u:{...t3}))):vt(u)}function n3(e,n,t){if("**"===n.path)return function I$(e){return{matched:!0,parameters:e.length>0?G6(e).parameters:{},consumedSegments:e,remainingSegments:[],positionalParamSegments:{}}}(t);if(""===n.path)return"full"===n.pathMatch&&(e.hasChildren()||t.length>0)?{...t3}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const c=(n.matcher||rY)(t,e,n);if(!c)return{...t3};const u={};Object.entries(c.posParams??{}).forEach(([m,E])=>{u[m]=E.path});const p=c.consumed.length>0?{...u,...c.consumed[c.consumed.length-1].parameters}:u;return{matched:!0,consumedSegments:c.consumed,remainingSegments:t.slice(c.consumed.length),parameters:p,positionalParamSegments:c.posParams??{}}}function TH(e,n,t,o){return t.length>0&&function A$(e,n,t){return t.some(o=>nx(e,n,o)&&hl(o)!==Ut)}(e,t,o)?{segmentGroup:new ci(n,R$(o,new ci(t,e.children))),slicedSegments:[]}:0===t.length&&function D$(e,n,t){return t.some(o=>nx(e,n,o))}(e,t,o)?{segmentGroup:new ci(e.segments,w$(e,t,o,e.children)),slicedSegments:t}:{segmentGroup:new ci(e.segments,e.children),slicedSegments:t}}function w$(e,n,t,o){const c={};for(const u of t)if(nx(e,n,u)&&!o[hl(u)]){const p=new ci([],{});c[hl(u)]=p}return{...o,...c}}function R$(e,n){const t={};t[Ut]=n;for(const o of e)if(""===o.path&&hl(o)!==Ut){const c=new ci([],{});t[hl(o)]=c}return t}function nx(e,n,t){return(!(e.hasChildren()||n.length>0)||"full"!==t.pathMatch)&&""===t.path}class P${}class k${constructor(n,t,o,c,u,p,m){this.injector=n,this.configLoader=t,this.rootComponentType=o,this.config=c,this.urlTree=u,this.paramsInheritanceStrategy=p,this.urlSerializer=m,this.applyRedirects=new C$(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(n){return new pe(4002,`'${n.segmentGroup}'`)}recognize(){const n=TH(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(n).pipe(Zt(t=>{const o=new KV([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Ut,this.rootComponentType,null,{}),c=new nd(o,t),u=new hH("",c),p=function TY(e,n,t=null,o=null){return tH(eH(e),n,t,o)}(o,[],this.urlTree.queryParams,this.urlTree.fragment);return p.queryParams=this.urlTree.queryParams,u.url=this.urlSerializer.serialize(p),this.inheritParamsAndData(u._root,null),{state:u,tree:p}}))}match(n){return this.processSegmentGroup(this.injector,this.config,n,Ut).pipe(Lb(o=>{if(o instanceof e3)return this.urlTree=o.urlTree,this.match(o.urlTree.root);throw o instanceof ZV?this.noMatchError(o):o}))}inheritParamsAndData(n,t){const o=n.value,c=qV(o,t,this.paramsInheritanceStrategy);o.params=Object.freeze(c.params),o.data=Object.freeze(c.data),n.children.forEach(u=>this.inheritParamsAndData(u,o))}processSegmentGroup(n,t,o,c){return 0===o.segments.length&&o.hasChildren()?this.processChildren(n,t,o):this.processSegment(n,t,o,o.segments,c,!0).pipe(Zt(u=>u instanceof nd?[u]:[]))}processChildren(n,t,o){const c=[];for(const u of Object.keys(o.children))"primary"===u?c.unshift(u):c.push(u);return Vr(c).pipe(kI(u=>{const p=o.children[u],m=function QY(e,n){const t=e.filter(o=>hl(o)===n);return t.push(...e.filter(o=>hl(o)!==n)),t}(t,u);return this.processSegmentGroup(n,m,p,u)}),function eY(e,n){return Si(function ZK(e,n,t,o,c){return(u,p)=>{let m=t,E=n,S=0;u.subscribe(di(p,w=>{const P=S++;E=m?e(E,w,P):(m=!0,w),o&&p.next(E)},c&&(()=>{m&&p.next(E),p.complete()})))}}(e,n,arguments.length>=2,!0))}((u,p)=>(u.push(...p),u)),GM(null),function tY(e,n){const t=arguments.length>=2;return o=>o.pipe(e?Ea((c,u)=>e(c,u,o)):cd,xV(1),t?GM(n):j6(()=>new jM))}(),_o(u=>{if(null===u)return qb(o);const p=IH(u);return function L$(e){e.sort((n,t)=>n.value.outlet===Ut?-1:t.value.outlet===Ut?1:n.value.outlet.localeCompare(t.value.outlet))}(p),vt(p)}))}processSegment(n,t,o,c,u,p){return Vr(t).pipe(kI(m=>this.processSegmentAgainstRoute(m._injector??n,t,m,o,c,u,p).pipe(Lb(E=>{if(E instanceof ZV)return vt(null);throw E}))),F_(m=>!!m),Lb(m=>{if(SH(m))return function N$(e,n,t){return 0===n.length&&!e.children[t]}(o,c,u)?vt(new P$):qb(o);throw m}))}processSegmentAgainstRoute(n,t,o,c,u,p,m){return function O$(e,n,t,o){return!!(hl(e)===o||o!==Ut&&nx(n,t,e))&&n3(n,e,t).matched}(o,c,u,p)?void 0===o.redirectTo?this.matchSegmentAgainstRoute(n,c,o,u,p):this.allowRedirects&&m?this.expandSegmentAgainstRouteUsingRedirect(n,c,t,o,u,p):qb(c):qb(c)}expandSegmentAgainstRouteUsingRedirect(n,t,o,c,u,p){const{matched:m,consumedSegments:E,positionalParamSegments:S,remainingSegments:w}=n3(t,c,u);if(!m)return qb(t);c.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const P=this.applyRedirects.applyRedirectCommands(E,c.redirectTo,S);return this.applyRedirects.lineralizeSegments(c,P).pipe(_o(V=>this.processSegment(n,o,t,V.concat(w),p,!1)))}matchSegmentAgainstRoute(n,t,o,c,u){const p=T$(t,o,c,n);return"**"===o.path&&(t.children={}),p.pipe(dl(m=>m.matched?this.getChildConfig(n=o._injector??n,o,c).pipe(dl(({routes:E})=>{const S=o._loadedInjector??n,{consumedSegments:w,remainingSegments:P,parameters:V}=m,H=new KV(w,V,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,function U$(e){return e.data||{}}(o),hl(o),o.component??o._loadedComponent??null,o,function V$(e){return e.resolve||{}}(o)),{segmentGroup:z,slicedSegments:J}=TH(t,w,P,E);if(0===J.length&&z.hasChildren())return this.processChildren(S,E,z).pipe(Zt(he=>null===he?null:new nd(H,he)));if(0===E.length&&0===J.length)return vt(new nd(H,[]));const ce=hl(o)===u;return this.processSegment(S,E,z,J,ce?Ut:u,!0).pipe(Zt(he=>new nd(H,he instanceof nd?[he]:[])))})):qb(t)))}getChildConfig(n,t,o){return t.children?vt({routes:t.children,injector:n}):t.loadChildren?void 0!==t._loadedRoutes?vt({routes:t._loadedRoutes,injector:t._loadedInjector}):function v$(e,n,t,o){const c=n.canLoad;return void 0===c||0===c.length?vt(!0):vt(c.map(p=>{const m=Wb(p,e);return zp(function s$(e){return e&&KI(e.canLoad)}(m)?m.canLoad(n,t):wo(e,()=>m(n,t)))})).pipe(zb(),CH())}(n,t,o).pipe(_o(c=>c?this.configLoader.loadChildren(n,t).pipe(go(u=>{t._loadedRoutes=u.routes,t._loadedInjector=u.injector})):function S$(e){return HM(EH(!1,oc.GuardRejected))}())):vt({routes:[],injector:n})}}function F$(e){const n=e.value.routeConfig;return n&&""===n.path}function IH(e){const n=[],t=new Set;for(const o of e){if(!F$(o)){n.push(o);continue}const c=n.find(u=>o.value.routeConfig===u.value.routeConfig);void 0!==c?(c.children.push(...o.children),t.add(c)):n.push(o)}for(const o of t){const c=IH(o.children);n.push(new nd(o.value,c))}return n.filter(o=>!t.has(o))}function wH(e){const n=e.children.map(t=>wH(t)).flat();return[e,...n]}function i3(e){return dl(n=>{const t=e(n);return t?Vr(t).pipe(Zt(()=>n)):vt(n)})}let RH=(()=>{class e{buildTitle(t){let o,c=t.root;for(;void 0!==c;)o=this.getResolvedTitleForRoute(c)??o,c=c.children.find(u=>u.outlet===Ut);return o}getResolvedTitleForRoute(t){return t.data[LI]}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:()=>Te(z$),providedIn:"root"})}return e})(),z$=(()=>{class e extends RH{constructor(t){super(),this.title=t}updateTitle(t){const o=this.buildTitle(t);void 0!==o&&this.title.setTitle(o)}static#e=this.\u0275fac=function(o){return new(o||e)(be(Y8))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Kb=new De("",{providedIn:"root",factory:()=>({})}),Yb=new De("");let r3=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Te(qv)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return vt(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const o=zp(t.loadComponent()).pipe(Zt(AH),go(u=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=u}),kV(()=>{this.componentLoaders.delete(t)})),c=new B6(o,()=>new bn).pipe(MV());return this.componentLoaders.set(t,c),c}loadChildren(t,o){if(this.childrenLoaders.get(o))return this.childrenLoaders.get(o);if(o._loadedRoutes)return vt({routes:o._loadedRoutes,injector:o._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(o);const u=function q$(e,n,t,o){return zp(e.loadChildren()).pipe(Zt(AH),_o(c=>c instanceof _N||Array.isArray(c)?vt(c):Vr(n.compileModuleAsync(c))),Zt(c=>{o&&o(e);let u,p,m=!1;return Array.isArray(c)?(p=c,!0):(u=c.create(t).injector,p=u.get(Yb,[],{optional:!0,self:!0}).flat()),{routes:p.map(QV),injector:u}}))}(o,this.compiler,t,this.onLoadEndListener).pipe(kV(()=>{this.childrenLoaders.delete(o)})),p=new B6(u,()=>new bn).pipe(MV());return this.childrenLoaders.set(o,p),p}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function AH(e){return function K$(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let o3=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:()=>Te(Y$),providedIn:"root"})}return e})(),Y$=(()=>{class e{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,o){return t}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const DH=new De(""),OH=new De("");function $$(e,n,t){const o=e.get(OH),c=e.get(on);return e.get(it).runOutsideAngular(()=>{if(!c.startViewTransition||o.skipNextTransition)return o.skipNextTransition=!1,Promise.resolve();let u;const p=new Promise(S=>{u=S}),m=c.startViewTransition(()=>(u(),function X$(e){return new Promise(n=>{vD(n,{injector:e})})}(e))),{onViewTransitionCreated:E}=o;return E&&wo(e,()=>E({transition:m,from:n,to:t})),p})}let ix=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new bn,this.transitionAbortSubject=new bn,this.configLoader=Te(r3),this.environmentInjector=Te(ts),this.urlSerializer=Te(Vb),this.rootContexts=Te(HI),this.location=Te(Hi),this.inputBindingEnabled=null!==Te(ZM,{optional:!0}),this.titleStrategy=Te(RH),this.options=Te(Kb,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=Te(o3),this.createViewTransition=Te(DH,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>vt(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=c=>this.events.next(new LY(c)),this.configLoader.onLoadStartListener=c=>this.events.next(new kY(c))}complete(){this.transitions?.complete()}handleNavigationRequest(t){const o=++this.navigationId;this.transitions?.next({...this.transitions.value,...t,id:o})}setupNavigations(t,o,c){return this.transitions=new Yo({id:0,currentUrlTree:o,currentRawUrl:o,extractedUrl:this.urlHandlingStrategy.extract(o),urlAfterRedirects:this.urlHandlingStrategy.extract(o),rawUrl:o,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:jI,restoredState:null,currentSnapshot:c.snapshot,targetSnapshot:null,currentRouterState:c,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Ea(u=>0!==u.id),Zt(u=>({...u,extractedUrl:this.urlHandlingStrategy.extract(u.rawUrl)})),dl(u=>{this.currentTransition=u;let p=!1,m=!1;return vt(u).pipe(go(E=>{this.currentNavigation={id:E.id,initialUrl:E.rawUrl,extractedUrl:E.extractedUrl,trigger:E.source,extras:E.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),dl(E=>{const S=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl();if(!S&&"reload"!==(E.extras.onSameUrlNavigation??t.onSameUrlNavigation)){const P="";return this.events.next(new Hb(E.id,this.urlSerializer.serialize(E.rawUrl),P,JM.IgnoredSameUrlNavigation)),E.resolve(null),ed}if(this.urlHandlingStrategy.shouldProcessUrl(E.rawUrl))return vt(E).pipe(dl(P=>{const V=this.transitions?.getValue();return this.events.next(new XM(P.id,this.urlSerializer.serialize(P.extractedUrl),P.source,P.restoredState)),V!==this.transitions?.getValue()?ed:Promise.resolve(P)}),function B$(e,n,t,o,c,u){return _o(p=>function M$(e,n,t,o,c,u,p="emptyOnly"){return new k$(e,n,t,o,c,p,u).recognize()}(e,n,t,o,p.extractedUrl,c,u).pipe(Zt(({state:m,tree:E})=>({...p,targetSnapshot:m,urlAfterRedirects:E}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),go(P=>{u.targetSnapshot=P.targetSnapshot,u.urlAfterRedirects=P.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:P.urlAfterRedirects};const V=new aH(P.id,this.urlSerializer.serialize(P.extractedUrl),this.urlSerializer.serialize(P.urlAfterRedirects),P.targetSnapshot);this.events.next(V)}));if(S&&this.urlHandlingStrategy.shouldProcessUrl(E.currentRawUrl)){const{id:P,extractedUrl:V,source:H,restoredState:z,extras:J}=E,ce=new XM(P,this.urlSerializer.serialize(V),H,z);this.events.next(ce);const he=uH(this.rootComponentType).snapshot;return this.currentTransition=u={...E,targetSnapshot:he,urlAfterRedirects:V,extras:{...J,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.finalUrl=V,vt(u)}{const P="";return this.events.next(new Hb(E.id,this.urlSerializer.serialize(E.extractedUrl),P,JM.IgnoredByUrlHandlingStrategy)),E.resolve(null),ed}}),go(E=>{const S=new NY(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot);this.events.next(S)}),Zt(E=>(this.currentTransition=u={...E,guards:t$(E.targetSnapshot,E.currentSnapshot,this.rootContexts)},u)),function u$(e,n){return _o(t=>{const{targetSnapshot:o,currentSnapshot:c,guards:{canActivateChecks:u,canDeactivateChecks:p}}=t;return 0===p.length&&0===u.length?vt({...t,guardsResult:!0}):function h$(e,n,t,o){return Vr(e).pipe(_o(c=>function E$(e,n,t,o,c){const u=n&&n.routeConfig?n.routeConfig.canDeactivate:null;return u&&0!==u.length?vt(u.map(m=>{const E=WI(n)??c,S=Wb(m,E);return zp(function d$(e){return e&&KI(e.canDeactivate)}(S)?S.canDeactivate(e,n,t,o):wo(E,()=>S(e,n,t,o))).pipe(F_())})).pipe(zb()):vt(!0)}(c.component,c.route,t,n,o)),F_(c=>!0!==c,!0))}(p,o,c,e).pipe(_o(m=>m&&function o$(e){return"boolean"==typeof e}(m)?function p$(e,n,t,o){return Vr(n).pipe(kI(c=>EM(function m$(e,n){return null!==e&&n&&n(new FY(e)),vt(!0)}(c.route.parent,o),function f$(e,n){return null!==e&&n&&n(new VY(e)),vt(!0)}(c.route,o),function g$(e,n,t){const o=n[n.length-1],u=n.slice(0,n.length-1).reverse().map(p=>function n$(e){const n=e.routeConfig?e.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:e,guards:n}:null}(p)).filter(p=>null!==p).map(p=>V6(()=>vt(p.guards.map(E=>{const S=WI(p.node)??t,w=Wb(E,S);return zp(function c$(e){return e&&KI(e.canActivateChild)}(w)?w.canActivateChild(o,e):wo(S,()=>w(o,e))).pipe(F_())})).pipe(zb())));return vt(u).pipe(zb())}(e,c.path,t),function _$(e,n,t){const o=n.routeConfig?n.routeConfig.canActivate:null;if(!o||0===o.length)return vt(!0);const c=o.map(u=>V6(()=>{const p=WI(n)??t,m=Wb(u,p);return zp(function a$(e){return e&&KI(e.canActivate)}(m)?m.canActivate(n,e):wo(p,()=>m(n,e))).pipe(F_())}));return vt(c).pipe(zb())}(e,c.route,t))),F_(c=>!0!==c,!0))}(o,u,e,n):vt(m)),Zt(m=>({...t,guardsResult:m})))})}(this.environmentInjector,E=>this.events.next(E)),go(E=>{if(u.guardsResult=E.guardsResult,Bb(E.guardsResult))throw gH(0,E.guardsResult);const S=new PY(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot,!!E.guardsResult);this.events.next(S)}),Ea(E=>!!E.guardsResult||(this.cancelNavigationTransition(E,"",oc.GuardRejected),!1)),i3(E=>{if(E.guards.canActivateChecks.length)return vt(E).pipe(go(S=>{const w=new MY(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot);this.events.next(w)}),dl(S=>{let w=!1;return vt(S).pipe(function j$(e,n){return _o(t=>{const{targetSnapshot:o,guards:{canActivateChecks:c}}=t;if(!c.length)return vt(t);const u=new Set(c.map(E=>E.route)),p=new Set;for(const E of u)if(!p.has(E))for(const S of wH(E))p.add(S);let m=0;return Vr(p).pipe(kI(E=>u.has(E)?function H$(e,n,t,o){const c=e.routeConfig,u=e._resolve;return void 0!==c?.title&&!fH(c)&&(u[LI]=c.title),function G$(e,n,t,o){const c=LV(e);if(0===c.length)return vt({});const u={};return Vr(c).pipe(_o(p=>function W$(e,n,t,o){const c=WI(n)??o,u=Wb(e,c);return zp(u.resolve?u.resolve(n,t):wo(c,()=>u(n,t)))}(e[p],n,t,o).pipe(F_(),go(m=>{u[p]=m}))),xV(1),function nY(e){return Zt(()=>e)}(u),Lb(p=>SH(p)?ed:HM(p)))}(u,e,n,o).pipe(Zt(p=>(e._resolvedData=p,e.data=qV(e,e.parent,t).resolve,null)))}(E,o,e,n):(E.data=qV(E,E.parent,e).resolve,vt(void 0))),go(()=>m++),xV(1),_o(E=>m===p.size?vt(t):ed))})}(this.paramsInheritanceStrategy,this.environmentInjector),go({next:()=>w=!0,complete:()=>{w||this.cancelNavigationTransition(S,"",oc.NoDataFromResolver)}}))}),go(S=>{const w=new xY(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot);this.events.next(w)}))}),i3(E=>{const S=w=>{const P=[];w.routeConfig?.loadComponent&&!w.routeConfig._loadedComponent&&P.push(this.configLoader.loadComponent(w.routeConfig).pipe(go(V=>{w.component=V}),Zt(()=>{})));for(const V of w.children)P.push(...S(V));return P};return gM(S(E.targetSnapshot.root)).pipe(GM(null),Vu(1))}),i3(()=>this.afterPreactivation()),dl(()=>{const{currentSnapshot:E,targetSnapshot:S}=u,w=this.createViewTransition?.(this.environmentInjector,E.root,S.root);return w?Vr(w).pipe(Zt(()=>u)):vt(u)}),Zt(E=>{const S=function WY(e,n,t){const o=GI(e,n._root,t?t._root:void 0);return new lH(o,n)}(t.routeReuseStrategy,E.targetSnapshot,E.currentRouterState);return this.currentTransition=u={...E,targetRouterState:S},this.currentNavigation.targetRouterState=S,u}),go(()=>{this.events.next(new HV)}),((e,n,t,o)=>Zt(c=>(new e$(n,c.targetRouterState,c.currentRouterState,t,o).activate(e),c)))(this.rootContexts,t.routeReuseStrategy,E=>this.events.next(E),this.inputBindingEnabled),Vu(1),go({next:E=>{p=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Hu(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects))),this.titleStrategy?.updateTitle(E.targetRouterState.snapshot),E.resolve(!0)},complete:()=>{p=!0}}),Go(this.transitionAbortSubject.pipe(go(E=>{throw E}))),kV(()=>{!p&&!m&&this.cancelNavigationTransition(u,"",oc.SupersededByNewNavigation),this.currentNavigation?.id===u.id&&(this.currentNavigation=null)}),Lb(E=>{if(m=!0,vH(E))this.events.next(new jb(u.id,this.urlSerializer.serialize(u.extractedUrl),E.message,E.cancellationCode)),function KY(e){return vH(e)&&Bb(e.url)}(E)?this.events.next(new GV(E.url)):u.resolve(!1);else{this.events.next(new QM(u.id,this.urlSerializer.serialize(u.extractedUrl),E,u.targetSnapshot??void 0));try{u.resolve(t.errorHandler(E))}catch(S){this.options.resolveNavigationPromiseOnError?u.resolve(!1):u.reject(S)}}return ed}))}))}cancelNavigationTransition(t,o,c){const u=new jb(t.id,this.urlSerializer.serialize(t.extractedUrl),o,c);this.events.next(u),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function J$(e){return e!==jI}let Q$=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:()=>Te(eX),providedIn:"root"})}return e})();class Z${shouldDetach(n){return!1}store(n,t){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,t){return n.routeConfig===t.routeConfig}}let eX=(()=>{class e extends Z${static#e=this.\u0275fac=(()=>{let t;return function(c){return(t||(t=Ki(e)))(c||e)}})();static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),NH=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:()=>Te(tX),providedIn:"root"})}return e})(),tX=(()=>{class e extends NH{constructor(){super(...arguments),this.location=Te(Hi),this.urlSerializer=Te(Vb),this.options=Te(Kb,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=Te(o3),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Ub,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=uH(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(o=>{"popstate"===o.type&&t(o.url,o.state)})}handleRouterEvent(t,o){if(t instanceof XM)this.stateMemento=this.createStateMemento();else if(t instanceof Hb)this.rawUrlTree=o.initialUrl;else if(t instanceof aH){if("eager"===this.urlUpdateStrategy&&!o.extras.skipLocationChange){const c=this.urlHandlingStrategy.merge(o.finalUrl,o.initialUrl);this.setBrowserUrl(c,o)}}else t instanceof HV?(this.currentUrlTree=o.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(o.finalUrl,o.initialUrl),this.routerState=o.targetRouterState,"deferred"===this.urlUpdateStrategy&&(o.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,o))):t instanceof jb&&(t.code===oc.GuardRejected||t.code===oc.NoDataFromResolver)?this.restoreHistory(o):t instanceof QM?this.restoreHistory(o,!0):t instanceof Hu&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,o){const c=this.urlSerializer.serialize(t);if(this.location.isCurrentPathEqualTo(c)||o.extras.replaceUrl){const p={...o.extras.state,...this.generateNgRouterState(o.id,this.browserPageId)};this.location.replaceState(c,"",p)}else{const u={...o.extras.state,...this.generateNgRouterState(o.id,this.browserPageId+1)};this.location.go(c,"",u)}}restoreHistory(t,o=!1){if("computed"===this.canceledNavigationResolution){const u=this.currentPageId-this.browserPageId;0!==u?this.location.historyGo(u):this.currentUrlTree===t.finalUrl&&0===u&&(this.resetState(t),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(o&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,o){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:o}:{navigationId:t}}static#e=this.\u0275fac=(()=>{let t;return function(c){return(t||(t=Ki(e)))(c||e)}})();static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var YI=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(YI||{});function PH(e,n){e.events.pipe(Ea(t=>t instanceof Hu||t instanceof jb||t instanceof QM||t instanceof Hb),Zt(t=>t instanceof Hu||t instanceof Hb?YI.COMPLETE:t instanceof jb&&(t.code===oc.Redirect||t.code===oc.SupersededByNewNavigation)?YI.REDIRECTING:YI.FAILED),Ea(t=>t!==YI.REDIRECTING),Vu(1)).subscribe(()=>{n()})}function nX(e){throw e}const iX={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},rX={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let ya=(()=>{class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=Te(E0),this.stateManager=Te(NH),this.options=Te(Kb,{optional:!0})||{},this.pendingTasks=Te(i_),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=Te(ix),this.urlSerializer=Te(Vb),this.location=Te(Hi),this.urlHandlingStrategy=Te(o3),this._events=new bn,this.errorHandler=this.options.errorHandler||nX,this.navigated=!1,this.routeReuseStrategy=Te(Q$),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=Te(Yb,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!Te(ZM,{optional:!0}),this.eventsSubscription=new nr,this.isNgZoneEnabled=Te(it)instanceof it&&it.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const t=this.navigationTransitions.events.subscribe(o=>{try{const c=this.navigationTransitions.currentTransition,u=this.navigationTransitions.currentNavigation;if(null!==c&&null!==u)if(this.stateManager.handleRouterEvent(o,u),o instanceof jb&&o.code!==oc.Redirect&&o.code!==oc.SupersededByNewNavigation)this.navigated=!0;else if(o instanceof Hu)this.navigated=!0;else if(o instanceof GV){const p=this.urlHandlingStrategy.merge(o.url,c.currentRawUrl),m={info:c.extras.info,skipLocationChange:c.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||J$(c.source)};this.scheduleNavigation(p,jI,null,m,{resolve:c.resolve,reject:c.reject,promise:c.promise})}(function sX(e){return!(e instanceof HV||e instanceof GV)})(o)&&this._events.next(o)}catch(c){this.navigationTransitions.transitionAbortSubject.next(c)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),jI,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,o)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(t,"popstate",o)},0)})}navigateToSyncWithBrowser(t,o,c){const u={replaceUrl:!0},p=c?.navigationId?c:null;if(c){const E={...c};delete E.navigationId,delete E.\u0275routerPageId,0!==Object.keys(E).length&&(u.state=E)}const m=this.parseUrl(t);this.scheduleNavigation(m,o,p,u)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(QV),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,o={}){const{relativeTo:c,queryParams:u,fragment:p,queryParamsHandling:m,preserveFragment:E}=o,S=E?this.currentUrlTree.fragment:p;let P,w=null;switch(m){case"merge":w={...this.currentUrlTree.queryParams,...u};break;case"preserve":w=this.currentUrlTree.queryParams;break;default:w=u||null}null!==w&&(w=this.removeEmptyProps(w));try{P=eH(c?c.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof t[0]||!t[0].startsWith("/"))&&(t=[]),P=this.currentUrlTree.root}return tH(P,t,w,S??null)}navigateByUrl(t,o={skipLocationChange:!1}){const c=Bb(t)?t:this.parseUrl(t),u=this.urlHandlingStrategy.merge(c,this.rawUrlTree);return this.scheduleNavigation(u,jI,null,o)}navigate(t,o={skipLocationChange:!1}){return function oX(e){for(let n=0;n<e.length;n++)if(null==e[n])throw new pe(4008,!1)}(t),this.navigateByUrl(this.createUrlTree(t,o),o)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.urlSerializer.parse("/")}}isActive(t,o){let c;if(c=!0===o?{...iX}:!1===o?{...rX}:o,Bb(t))return z6(this.currentUrlTree,t,c);const u=this.parseUrl(t);return z6(this.currentUrlTree,u,c)}removeEmptyProps(t){return Object.entries(t).reduce((o,[c,u])=>(null!=u&&(o[c]=u),o),{})}scheduleNavigation(t,o,c,u,p){if(this.disposed)return Promise.resolve(!1);let m,E,S;p?(m=p.resolve,E=p.reject,S=p.promise):S=new Promise((P,V)=>{m=P,E=V});const w=this.pendingTasks.add();return PH(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(w))}),this.navigationTransitions.handleNavigationRequest({source:o,restoredState:c,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:u,resolve:m,reject:E,promise:S,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),S.catch(P=>Promise.reject(P))}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class MH{}let dX=(()=>{class e{constructor(t,o,c,u,p){this.router=t,this.injector=c,this.preloadingStrategy=u,this.loader=p}setUpPreloading(){this.subscription=this.router.events.pipe(Ea(t=>t instanceof Hu),kI(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,o){const c=[];for(const u of o){u.providers&&!u._injector&&(u._injector=Km(u.providers,t,`Route: ${u.path}`));const p=u._injector??t,m=u._loadedInjector??p;(u.loadChildren&&!u._loadedRoutes&&void 0===u.canLoad||u.loadComponent&&!u._loadedComponent)&&c.push(this.preloadConfig(p,u)),(u.children||u._loadedRoutes)&&c.push(this.processRoutes(m,u.children??u._loadedRoutes))}return Vr(c).pipe(Pb())}preloadConfig(t,o){return this.preloadingStrategy.preload(o,()=>{let c;c=o.loadChildren&&void 0===o.canLoad?this.loader.loadChildren(t,o):vt(null);const u=c.pipe(_o(p=>null===p?vt(void 0):(o._loadedRoutes=p.routes,o._loadedInjector=p.injector,this.processRoutes(p.injector??t,p.routes))));return o.loadComponent&&!o._loadedComponent?Vr([u,this.loader.loadComponent(o)]).pipe(Pb()):u})}static#e=this.\u0275fac=function(o){return new(o||e)(be(ya),be(qv),be(ts),be(MH),be(r3))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const a3=new De("");let xH=(()=>{class e{constructor(t,o,c,u,p={}){this.urlSerializer=t,this.transitions=o,this.viewportScroller=c,this.zone=u,this.options=p,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},p.scrollPositionRestoration||="disabled",p.anchorScrolling||="disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof XM?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof Hu?(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment)):t instanceof Hb&&t.code===JM.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof cH&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,o){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new cH(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,o))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#e=this.\u0275fac=function(o){Fh()};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})();function pl(e,n){return{\u0275kind:e,\u0275providers:n}}function LH(){const e=Te(pr);return n=>{const t=e.get(Yr);if(n!==t.components[0])return;const o=e.get(ya),c=e.get(FH);1===e.get(c3)&&o.initialNavigation(),e.get(UH,null,Vt.Optional)?.setUpPreloading(),e.get(a3,null,Vt.Optional)?.init(),o.resetRootComponentType(t.componentTypes[0]),c.closed||(c.next(),c.complete(),c.unsubscribe())}}const FH=new De("",{factory:()=>new bn}),c3=new De("",{providedIn:"root",factory:()=>1}),UH=new De("");function pX(e){return pl(0,[{provide:UH,useExisting:dX},{provide:MH,useExisting:e}])}function mX(e){return pl(9,[{provide:DH,useValue:$$},{provide:OH,useValue:{skipNextTransition:!!e?.skipInitialTransition,...e}}])}const VH=new De("ROUTER_FORROOT_GUARD"),_X=[Hi,{provide:Vb,useClass:FV},ya,HI,{provide:V_,useFactory:function kH(e){return e.routerState.root},deps:[ya]},r3,[]];let gX=(()=>{class e{constructor(t){}static forRoot(t,o){return{ngModule:e,providers:[_X,[],{provide:Yb,multi:!0,useValue:t},{provide:VH,useFactory:yX,deps:[[ya,new Vl,new fh]]},{provide:Kb,useValue:o||{}},o?.useHash?{provide:_a,useClass:bP}:{provide:_a,useClass:lb},{provide:a3,useFactory:()=>{const e=Te(eU),n=Te(it),t=Te(Kb),o=Te(ix),c=Te(Vb);return t.scrollOffset&&e.setOffset(t.scrollOffset),new xH(c,o,e,n,t)}},o?.preloadingStrategy?pX(o.preloadingStrategy).\u0275providers:[],o?.initialNavigation?SX(o):[],o?.bindToComponentInputs?pl(8,[mH,{provide:ZM,useExisting:mH}]).\u0275providers:[],o?.enableViewTransitions?mX().\u0275providers:[],[{provide:BH,useFactory:LH},{provide:Gs,multi:!0,useExisting:BH}]]}}static forChild(t){return{ngModule:e,providers:[{provide:Yb,multi:!0,useValue:t}]}}static#e=this.\u0275fac=function(o){return new(o||e)(be(VH,8))};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Jn({})}return e})();function yX(e){return"guarded"}function SX(e){return["disabled"===e.initialNavigation?pl(3,[{provide:T0,multi:!0,useFactory:()=>{const n=Te(ya);return()=>{n.setUpLocationChangeListener()}}},{provide:c3,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?pl(2,[{provide:c3,useValue:0},{provide:T0,multi:!0,deps:[pr],useFactory:n=>{const t=n.get(vP,Promise.resolve());return()=>t.then(()=>new Promise(o=>{const c=n.get(ya),u=n.get(FH);PH(c,()=>{o(!0)}),n.get(ix).afterPreactivation=()=>(o(!0),u.closed?vt(void 0):u),c.initialNavigation()}))}}]).\u0275providers:[]]}const BH=new De(""),jH_configs={AppID:"fee9eb8f5bb44a6893ec96fd5e993a31"};let TX=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275cmp=Br({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(o,c){1&o&&de(0,"router-outlet")},dependencies:[JV],changeDetection:0})}return e})();function Ir(e){return"function"==typeof e}function HH(e){const t=e(o=>{Error.call(o),o.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const d3=HH(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((o,c)=>`${c+1}) ${o.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function rx(e,n){if(e){const t=e.indexOf(n);0<=t&&e.splice(t,1)}}class id{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const u of t)u.remove(this);else t.remove(this);const{initialTeardown:o}=this;if(Ir(o))try{o()}catch(u){n=u instanceof d3?u.errors:[u]}const{_finalizers:c}=this;if(c){this._finalizers=null;for(const u of c)try{zH(u)}catch(p){n=n??[],p instanceof d3?n=[...n,...p.errors]:n.push(p)}}if(n)throw new d3(n)}}add(n){var t;if(n&&n!==this)if(this.closed)zH(n);else{if(n instanceof id){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(n)}}_hasParent(n){const{_parentage:t}=this;return t===n||Array.isArray(t)&&t.includes(n)}_addParent(n){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(n),t):t?[t,n]:n}_removeParent(n){const{_parentage:t}=this;t===n?this._parentage=null:Array.isArray(t)&&rx(t,n)}remove(n){const{_finalizers:t}=this;t&&rx(t,n),n instanceof id&&n._removeParent(this)}}id.EMPTY=(()=>{const e=new id;return e.closed=!0,e})();const GH=id.EMPTY;function WH(e){return e instanceof id||e&&"closed"in e&&Ir(e.remove)&&Ir(e.add)&&Ir(e.unsubscribe)}function zH(e){Ir(e)?e():e.unsubscribe()}const B_={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ox={setTimeout(e,n,...t){const{delegate:o}=ox;return o?.setTimeout?o.setTimeout(e,n,...t):setTimeout(e,n,...t)},clearTimeout(e){const{delegate:n}=ox;return(n?.clearTimeout||clearTimeout)(e)},delegate:void 0};function qH(e){ox.setTimeout(()=>{const{onUnhandledError:n}=B_;if(!n)throw e;n(e)})}function l3(){}const IX=u3("C",void 0,void 0);function u3(e,n,t){return{kind:e,value:n,error:t}}let j_=null;function sx(e){if(B_.useDeprecatedSynchronousErrorHandling){const n=!j_;if(n&&(j_={errorThrown:!1,error:null}),e(),n){const{errorThrown:t,error:o}=j_;if(j_=null,t)throw o}}else e()}class h3 extends id{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,WH(n)&&n.add(this)):this.destination=PX}static create(n,t,o){return new f3(n,t,o)}next(n){this.isStopped?m3(function RX(e){return u3("N",e,void 0)}(n),this):this._next(n)}error(n){this.isStopped?m3(function wX(e){return u3("E",void 0,e)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?m3(IX,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const DX=Function.prototype.bind;function p3(e,n){return DX.call(e,n)}class OX{constructor(n){this.partialObserver=n}next(n){const{partialObserver:t}=this;if(t.next)try{t.next(n)}catch(o){ax(o)}}error(n){const{partialObserver:t}=this;if(t.error)try{t.error(n)}catch(o){ax(o)}else ax(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(t){ax(t)}}}class f3 extends h3{constructor(n,t,o){let c;if(super(),Ir(n)||!n)c={next:n??void 0,error:t??void 0,complete:o??void 0};else{let u;this&&B_.useDeprecatedNextContext?(u=Object.create(n),u.unsubscribe=()=>this.unsubscribe(),c={next:n.next&&p3(n.next,u),error:n.error&&p3(n.error,u),complete:n.complete&&p3(n.complete,u)}):c=n}this.destination=new OX(c)}}function ax(e){B_.useDeprecatedSynchronousErrorHandling?function AX(e){B_.useDeprecatedSynchronousErrorHandling&&j_&&(j_.errorThrown=!0,j_.error=e)}(e):qH(e)}function m3(e,n){const{onStoppedNotification:t}=B_;t&&ox.setTimeout(()=>t(e,n))}const PX={closed:!0,next:l3,error:function NX(e){throw e},complete:l3},_3="function"==typeof Symbol&&Symbol.observable||"@@observable";function g3(e){return e}let Sa=(()=>{class e{constructor(t){t&&(this._subscribe=t)}lift(t){const o=new e;return o.source=this,o.operator=t,o}subscribe(t,o,c){const u=function xX(e){return e&&e instanceof h3||function MX(e){return e&&Ir(e.next)&&Ir(e.error)&&Ir(e.complete)}(e)&&WH(e)}(t)?t:new f3(t,o,c);return sx(()=>{const{operator:p,source:m}=this;u.add(p?p.call(u,m):m?this._subscribe(u):this._trySubscribe(u))}),u}_trySubscribe(t){try{return this._subscribe(t)}catch(o){t.error(o)}}forEach(t,o){return new(o=YH(o))((c,u)=>{const p=new f3({next:m=>{try{t(m)}catch(E){u(E),p.unsubscribe()}},error:u,complete:c});this.subscribe(p)})}_subscribe(t){var o;return null===(o=this.source)||void 0===o?void 0:o.subscribe(t)}[_3](){return this}pipe(...t){return function KH(e){return 0===e.length?g3:1===e.length?e[0]:function(t){return e.reduce((o,c)=>c(o),t)}}(t)(this)}toPromise(t){return new(t=YH(t))((o,c)=>{let u;this.subscribe(p=>u=p,p=>c(p),()=>o(u))})}}return e.create=n=>new e(n),e})();function YH(e){var n;return null!==(n=e??B_.Promise)&&void 0!==n?n:Promise}const kX=HH(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let $I=(()=>{class e extends Sa{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const o=new $H(this,this);return o.operator=t,o}_throwIfClosed(){if(this.closed)throw new kX}next(t){sx(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const o of this.currentObservers)o.next(t)}})}error(t){sx(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:o}=this;for(;o.length;)o.shift().error(t)}})}complete(){sx(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:o,isStopped:c,observers:u}=this;return o||c?GH:(this.currentObservers=null,u.push(t),new id(()=>{this.currentObservers=null,rx(u,t)}))}_checkFinalizedStatuses(t){const{hasError:o,thrownError:c,isStopped:u}=this;o?t.error(c):u&&t.complete()}asObservable(){const t=new Sa;return t.source=this,t}}return e.create=(n,t)=>new $H(n,t),e})();class $H extends $I{constructor(n,t){super(),this.destination=n,this.source=t}next(n){var t,o;null===(o=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===o||o.call(t,n)}error(n){var t,o;null===(o=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===o||o.call(t,n)}complete(){var n,t;null===(t=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===t||t.call(n)}_subscribe(n){var t,o;return null!==(o=null===(t=this.source)||void 0===t?void 0:t.subscribe(n))&&void 0!==o?o:GH}}function XH(e){return e&&Ir(e.schedule)}function JH(e){return XH(function E3(e){return e[e.length-1]}(e))?e.pop():void 0}function qp(e){return this instanceof qp?(this.v=e,this):new qp(e)}function t8(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function S3(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],o=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(u){t[u]=e[u]&&function(p){return new Promise(function(m,E){!function c(u,p,m,E){Promise.resolve(E).then(function(S){u({value:S,done:m})},p)}(m,E,(p=e[u](p)).done,p.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const n8=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function i8(e){return Ir(e?.then)}function r8(e){return Ir(e[_3])}function o8(e){return Symbol.asyncIterator&&Ir(e?.[Symbol.asyncIterator])}function s8(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const a8=function iJ(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function c8(e){return Ir(e?.[a8])}function d8(e){return function e8(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,o=t.apply(e,n||[]),u=[];return c={},p("next"),p("throw"),p("return"),c[Symbol.asyncIterator]=function(){return this},c;function p(V){o[V]&&(c[V]=function(H){return new Promise(function(z,J){u.push([V,H,z,J])>1||m(V,H)})})}function m(V,H){try{!function E(V){V.value instanceof qp?Promise.resolve(V.value.v).then(S,w):P(u[0][2],V)}(o[V](H))}catch(z){P(u[0][3],z)}}function S(V){m("next",V)}function w(V){m("throw",V)}function P(V,H){V(H),u.shift(),u.length&&m(u[0][0],u[0][1])}}(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:o,done:c}=yield qp(t.read());if(c)return yield qp(void 0);yield yield qp(o)}}finally{t.releaseLock()}})}function l8(e){return Ir(e?.getReader)}function H_(e){if(e instanceof Sa)return e;if(null!=e){if(r8(e))return function rJ(e){return new Sa(n=>{const t=e[_3]();if(Ir(t.subscribe))return t.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(n8(e))return function oJ(e){return new Sa(n=>{for(let t=0;t<e.length&&!n.closed;t++)n.next(e[t]);n.complete()})}(e);if(i8(e))return function sJ(e){return new Sa(n=>{e.then(t=>{n.closed||(n.next(t),n.complete())},t=>n.error(t)).then(null,qH)})}(e);if(o8(e))return u8(e);if(c8(e))return function aJ(e){return new Sa(n=>{for(const t of e)if(n.next(t),n.closed)return;n.complete()})}(e);if(l8(e))return function cJ(e){return u8(d8(e))}(e)}throw s8(e)}function u8(e){return new Sa(n=>{(function dJ(e,n){var t,o,c,u;return function QH(e,n,t,o){return new(t||(t=Promise))(function(u,p){function m(w){try{S(o.next(w))}catch(P){p(P)}}function E(w){try{S(o.throw(w))}catch(P){p(P)}}function S(w){w.done?u(w.value):function c(u){return u instanceof t?u:new t(function(p){p(u)})}(w.value).then(m,E)}S((o=o.apply(e,n||[])).next())})}(this,void 0,void 0,function*(){try{for(t=t8(e);!(o=yield t.next()).done;)if(n.next(o.value),n.closed)return}catch(p){c={error:p}}finally{try{o&&!o.done&&(u=t.return)&&(yield u.call(t))}finally{if(c)throw c.error}}n.complete()})})(e,n).catch(t=>n.error(t))})}function Kp(e,n,t,o=0,c=!1){const u=n.schedule(function(){t(),c?e.add(this.schedule(null,o)):this.unsubscribe()},o);if(e.add(u),!c)return u}function Yp(e){return n=>{if(function lJ(e){return Ir(e?.lift)}(n))return n.lift(function(t){try{return e(t,this)}catch(o){this.error(o)}});throw new TypeError("Unable to lift unknown Observable type")}}function Gu(e,n,t,o,c){return new uJ(e,n,t,o,c)}class uJ extends h3{constructor(n,t,o,c,u,p){super(n),this.onFinalize=u,this.shouldUnsubscribe=p,this._next=t?function(m){try{t(m)}catch(E){n.error(E)}}:super._next,this._error=c?function(m){try{c(m)}catch(E){n.error(E)}finally{this.unsubscribe()}}:super._error,this._complete=o?function(){try{o()}catch(m){n.error(m)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function h8(e,n=0){return Yp((t,o)=>{t.subscribe(Gu(o,c=>Kp(o,e,()=>o.next(c),n),()=>Kp(o,e,()=>o.complete(),n),c=>Kp(o,e,()=>o.error(c),n)))})}function p8(e,n=0){return Yp((t,o)=>{o.add(e.schedule(()=>t.subscribe(o),n))})}function f8(e,n){if(!e)throw new Error("Iterable cannot be null");return new Sa(t=>{Kp(t,n,()=>{const o=e[Symbol.asyncIterator]();Kp(t,n,()=>{o.next().then(c=>{c.done?t.complete():t.next(c.value)})},0,!0)})})}function m8(e,n){return n?function gJ(e,n){if(null!=e){if(r8(e))return function hJ(e,n){return H_(e).pipe(p8(n),h8(n))}(e,n);if(n8(e))return function fJ(e,n){return new Sa(t=>{let o=0;return n.schedule(function(){o===e.length?t.complete():(t.next(e[o++]),t.closed||this.schedule())})})}(e,n);if(i8(e))return function pJ(e,n){return H_(e).pipe(p8(n),h8(n))}(e,n);if(o8(e))return f8(e,n);if(c8(e))return function mJ(e,n){return new Sa(t=>{let o;return Kp(t,n,()=>{o=e[a8](),Kp(t,n,()=>{let c,u;try{({value:c,done:u}=o.next())}catch(p){return void t.error(p)}u?t.complete():t.next(c)},0,!0)}),()=>Ir(o?.return)&&o.return()})}(e,n);if(l8(e))return function _J(e,n){return f8(d8(e),n)}(e,n)}throw s8(e)}(e,n):H_(e)}const _8=new Sa(e=>e.complete());function fl(e){return e<=0?()=>_8:Yp((n,t)=>{let o=0;n.subscribe(Gu(t,c=>{++o<=e&&(t.next(c),e<=o&&t.complete())}))})}const cx_HIDDEN={opacity:0,"margin-top":"100%"},cx_SHOWN={opacity:1,"margin-top":0},g8=QU("fade",[RI(":enter",[al(cx_HIDDEN),wI("250ms ease-in-out",al(cx_SHOWN))]),RI(":leave",[al(cx_SHOWN),wI("250ms ease-in-out",al(cx_HIDDEN))])]);class E8{constructor(n){this.cdr=n,this.afterClosed=new $I,this.shown=!0}closeDialog(n){this.onAfterClosed(n)}onAfterClosed(n){this.shown=!1,this.cdr.markForCheck(),this.afterClosed.next(n)}}var SJ=Xp(885),CJ=Xp.n(SJ);class v8 extends $I{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const t=super._subscribe(n);return!t.closed&&n.next(this._value),t}getValue(){const{hasError:n,thrownError:t,_value:o}=this;if(n)throw t;return this._throwIfClosed(),o}next(n){super.next(this._value=n)}}class TJ extends id{constructor(n,t){super()}schedule(n,t=0){return this}}const dx={setInterval(e,n,...t){const{delegate:o}=dx;return o?.setInterval?o.setInterval(e,n,...t):setInterval(e,n,...t)},clearInterval(e){const{delegate:n}=dx;return(n?.clearInterval||clearInterval)(e)},delegate:void 0},b8={now:()=>(b8.delegate||Date).now(),delegate:void 0};class XI{constructor(n,t=XI.now){this.schedulerActionCtor=n,this.now=t}schedule(n,t=0,o){return new this.schedulerActionCtor(this,n).schedule(o,t)}}XI.now=b8.now;const C3=new class wJ extends XI{constructor(n,t=XI.now){super(n,t),this.actions=[],this._active=!1}flush(n){const{actions:t}=this;if(this._active)return void t.push(n);let o;this._active=!0;do{if(o=n.execute(n.state,n.delay))break}while(n=t.shift());if(this._active=!1,o){for(;n=t.shift();)n.unsubscribe();throw o}}}(class IJ extends TJ{constructor(n,t){super(n,t),this.scheduler=n,this.work=t,this.pending=!1}schedule(n,t=0){var o;if(this.closed)return this;this.state=n;const c=this.id,u=this.scheduler;return null!=c&&(this.id=this.recycleAsyncId(u,c,t)),this.pending=!0,this.delay=t,this.id=null!==(o=this.id)&&void 0!==o?o:this.requestAsyncId(u,this.id,t),this}requestAsyncId(n,t,o=0){return dx.setInterval(n.flush.bind(n,this),o)}recycleAsyncId(n,t,o=0){if(null!=o&&this.delay===o&&!1===this.pending)return t;null!=t&&dx.clearInterval(t)}execute(n,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const o=this._execute(n,t);if(o)return o;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,t){let c,o=!1;try{this.work(n)}catch(u){o=!0,c=u||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),c}unsubscribe(){if(!this.closed){const{id:n,scheduler:t}=this,{actions:o}=t;this.work=this.state=this.scheduler=null,this.pending=!1,rx(o,this),null!=n&&(this.id=this.recycleAsyncId(t,n,null)),this.delay=null,super.unsubscribe()}}}),RJ=C3;function T3(e=0,n,t=RJ){let o=-1;return null!=n&&(XH(n)?t=n:o=n),new Sa(c=>{let u=function AJ(e){return e instanceof Date&&!isNaN(e)}(e)?+e-t.now():e;u<0&&(u=0);let p=0;return t.schedule(function(){c.closed||(c.next(p++),0<=o?this.schedule(void 0,o):c.complete())},u)})}function I3(e=0,n=C3){return e<0&&(e=0),T3(e,e,n)}const y8={connected:!1,loading:!0,statusText:"Initializing",started:null,ended:!1,error:!1},DJ={mode:"rtc",codec:"h264"};let S8=(()=>{class e{constructor(t){this.config=t,this.agoraRTC=CJ(),this.streamState=new v8(y8),this.remoteStreamVideoToggle=new v8(!0),this.callEnd=new $I,this.localContainerId="local-video",this.remoteCalls=[],this.remoteStreamVideoToggle$=this.remoteStreamVideoToggle.asObservable(),this.streamState$=this.streamState.asObservable(),this.agoraRTC.checkSystemRequirements()||this.handleError(new Error("Web RTC is not supported in this browser"))}init(t,o,c=!1){return this.uid=t,this.agoraRTC.setLogLevel(c?0:4),this.client=this.agoraRTC.createClient(DJ),this.assignClientHandlers(),this.initLocalStream().then(()=>{this.client.join(this.config.AppID,o,null,this.uid).then(()=>{this.localTracks.videoTrack.play(this.localContainerId),this.client.publish(Object.values(this.localTracks)),this.streamState.next({...this.streamState.value,connected:!0,statusText:"Waiting others to join"})}).catch(u=>this.handleError(u))}),this.callEnd.asObservable()}deinit(){this.streamState.next(y8)}endCall(){this.client.leave().then(()=>{this.stopLocalStream(),this.streamState.next({...this.streamState.value,started:null,loading:!0,statusText:"",ended:!0}),this.remoteCalls=[],I3(500).pipe(fl(1)).subscribe(()=>this.callEnd.next())})}toggleVideo(t){this.localTracks&&this.localTracks.videoTrack.setMuted(t)}toggleAudio(t){this.localTracks&&this.localTracks.audioTrack.setMuted(t)}toggleFullScreen(t){t?document.exitFullscreen():document.documentElement.requestFullscreen()}isVideoEnabled(){return!!this.localTracks&&!this.localTracks.videoTrack.muted}isAudioEnabled(){return!!this.localTracks&&!this.localTracks.audioTrack.muted}assignClientHandlers(){this.client.on("user-joined",t=>{this.streamState.next({...this.streamState.value,started:Date.now(),loading:!1}),this.remoteCalls.length||this.remoteCalls.push(this.getRemoteId(t))}),this.client.on("user-published",(t,o)=>{const c=this.getRemoteId(t);this.client.subscribe(t,o).then(u=>{this.remoteCalls.includes(c)&&u.play(c)})}),this.client.on("user-info-updated",(t,o)=>{"mute-video"===o&&this.remoteStreamVideoToggle.next(!1),"unmute-video"===o&&this.remoteStreamVideoToggle.next(!0)}),this.client.on("user-left",()=>{this.endCall()})}initLocalStream(){return Promise.all([this.agoraRTC.createCameraVideoTrack(),this.agoraRTC.createMicrophoneAudioTrack()]).then(([t,o])=>{this.localTracks={audioTrack:o,videoTrack:t}}).catch(t=>{this.handleError(t)})}getRemoteId(t){return`remote_call-${t.uid}`}handleError(t){throw this.streamState.next({...this.streamState.value,statusText:t.message,error:!0}),this.stopLocalStream(),I3(5e3).pipe(fl(1)).subscribe(()=>this.callEnd.next()),new Error(t.message)}stopLocalStream(){this.localTracks&&Object.values(this.localTracks).forEach(t=>{t.stop(),t.close()})}static#e=this.\u0275fac=function(o){return new(o||e)(be("AgoraConfig"))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function OJ(e,n){if(1&e){const t=up();oe(0,"div",1)(1,"button",2),mn("click",function(){return Da(t),Zs(_n().onToggleFullScreen())}),oe(2,"div",3),Qo(),oe(3,"svg",4)(4,"g",26)(5,"g",6)(6,"g",7)(7,"g",11),de(8,"path",27)(9,"path",28)(10,"path",29)(11,"path",30),Ee()()()(),oe(12,"g",31)(13,"g",6)(14,"g",32)(15,"g",7),de(16,"path",33)(17,"path",34)(18,"path",35)(19,"path",36),Ee()()()()()(),Ec(),oe(20,"p"),br(21),Ee()()()}if(2&e){const t=_n();Qe(),Ht("controls__button--active",t.fullScreenEnabled),Qe(3),Ht("controls__icon--shown",!t.fullScreenEnabled),Qe(8),Ht("controls__icon--shown",t.fullScreenEnabled),Qe(9),uu(t.fullScreenEnabled?"Exit fullscreen":"Fullscreen")}}function NJ(e,n){if(1&e){const t=up();oe(0,"div",1)(1,"button",37),mn("click",function(){return Da(t),Zs(_n().onToggleSmallScreen())}),oe(2,"div",3),Qo(),oe(3,"svg",4)(4,"g",38),de(5,"path",39),Ee(),oe(6,"defs")(7,"filter",40),de(8,"feFlood",41)(9,"feColorMatrix",42)(10,"feOffset",43)(11,"feGaussianBlur",44)(12,"feComposite",45)(13,"feColorMatrix",46)(14,"feBlend",47)(15,"feBlend",48),Ee()()()(),Ec(),oe(16,"p"),br(17,"Minimize"),Ee()()()}if(2&e){const t=_n();Qe(),Ht("controls__button--active",t.smallScreenEnabled)}}let PJ=(()=>{class e{constructor(){this.cameraEnabled=!0,this.microphoneEnabled=!0,this.fullScreenEnabled=!1,this.smallScreenEnabled=!1,this.displaySmallScreen=!1,this.toggleCamera=new hn,this.toggleMicrophone=new hn,this.toggleFullScreen=new hn,this.toggleSmallScreen=new hn,this.endCall=new hn}onToggleCamera(){this.toggleCamera.emit(this.cameraEnabled)}onToggleMicrophone(){this.toggleMicrophone.emit(this.microphoneEnabled)}onToggleFullScreen(){this.toggleFullScreen.emit(this.fullScreenEnabled)}onToggleSmallScreen(){this.toggleSmallScreen.emit(this.smallScreenEnabled)}onEndCall(){this.endCall.emit()}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275cmp=Br({type:e,selectors:[["ngx-controls"]],inputs:{cameraEnabled:"cameraEnabled",microphoneEnabled:"microphoneEnabled",fullScreenEnabled:"fullScreenEnabled",smallScreenEnabled:"smallScreenEnabled",displaySmallScreen:"displaySmallScreen"},outputs:{toggleCamera:"toggleCamera",toggleMicrophone:"toggleMicrophone",toggleFullScreen:"toggleFullScreen",toggleSmallScreen:"toggleSmallScreen",endCall:"endCall"},decls:43,vars:16,consts:[[1,"controls"],[1,"controls__item"],[1,"controls__button",3,"click"],[1,"controls__icon-wrapper"],["viewBox","0 0 64 64","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","video-camera",1,"controls__icon"],["id","Group"],["id","Group_2"],["id","Vector","d","M63.4134 16.2294C63.0454 15.9814 62.5787 15.928 62.1707 16.096L50.6668 20.6986V20C50.6668 16.3226 47.6748 13.3334 44.0001 13.3334H6.66663C2.992 13.3334 0 16.3226 0 20V44C0 47.6774 2.992 50.6666 6.66663 50.6666H44C47.6746 50.6666 50.6666 47.6772 50.6666 44V43.3014L62.1706 47.904C62.5812 48.072 63.048 48.0186 63.4132 47.7706C63.7786 47.5226 63.9999 47.1093 63.9999 46.6666V17.3334C64 16.8906 63.7786 16.4774 63.4134 16.2294Z","fill","white"],["id","no-camera",1,"controls__icon"],["id","Vector","d","M44.0002 13.3325H6.66735C2.99276 13.3325 0.000793457 16.3218 0.000793457 19.999V43.9988C0.000793457 47.6761 2.99276 50.6654 6.66735 50.6654H7.67797L44.9176 13.4257C44.6162 13.3832 44.315 13.3325 44.0002 13.3325Z","fill","white"],["id","Group_3"],["id","Group_4"],["id","Vector_2","d","M63.4134 16.2285C63.0454 15.9805 62.5788 15.9271 62.1708 16.0951L50.6669 20.6977V19.9991C50.6669 18.6417 50.2535 17.3831 49.5549 16.3297L63.608 2.2766C64.128 1.75661 64.128 0.911242 63.608 0.391247C63.088 -0.128748 62.2426 -0.128748 61.7226 0.391247L0.389996 61.724C-0.129999 62.244 -0.129999 63.0894 0.389996 63.6094C0.651369 63.868 0.992615 63.9988 1.33399 63.9988C1.67536 63.9988 2.01661 63.8681 2.27798 63.6094L15.2192 50.6655H44.0003C47.6749 50.6655 50.6669 47.6762 50.6669 43.9989V43.3003L62.1708 47.9029C62.5814 48.0709 63.0481 48.0175 63.4134 47.7695C63.7788 47.5215 64 47.1082 64 46.6655V17.3325C64 16.8898 63.7788 16.4765 63.4134 16.2285Z","fill","white"],["id","microphone",1,"controls__icon"],["id","Vector"],["fill-rule","evenodd","clip-rule","evenodd","d","M44.3474 12.1407L44.3468 17.2309V33.8672C44.3468 40.6024 38.9004 46.0823 32.206 46.0823C27.8366 46.0787 23.8059 43.7286 21.6503 39.9279L20.4131 36.8161C20.1824 35.875 20.0659 34.9098 20.0659 33.941V12.1407C20.0659 5.43551 25.5014 0 32.2066 0C38.9118 0 44.3474 5.43551 44.3474 12.1407Z","fill","white"],["fill-rule","evenodd","clip-rule","evenodd","d","M15.0971 33.7512C15.0947 36.1345 15.5932 38.4912 16.5596 40.6697L18.1223 43.4553C22.3699 49.6259 30.1387 52.3143 37.292 50.089C44.4453 47.8638 49.318 41.2426 49.3156 33.7518C49.3156 32.9026 50.0039 32.2143 50.8532 32.2143C51.7018 32.2143 52.3907 32.9026 52.3907 33.7518C52.4051 44.4499 44.0585 53.2951 33.3778 53.9017V60.9246H39.8098C40.6584 60.9246 41.3473 61.6135 41.3473 62.4622C41.3473 63.3114 40.6584 63.9997 39.8098 63.9997H24.6029C23.7537 63.9997 23.0654 63.3114 23.0654 62.4622C23.0654 61.6135 23.7537 60.9246 24.6029 60.9246H30.3033V53.847C25.6228 53.4212 21.2413 51.3623 17.926 48.0313C17.1926 47.298 16.5163 46.51 15.9031 45.6739L14.2418 42.9874C12.7757 40.1297 12.0148 36.9633 12.022 33.7512C12.022 32.902 12.7103 32.2137 13.5595 32.2137C14.4088 32.2137 15.0971 32.902 15.0971 33.7512Z","fill","white"],["id","no-microphone",1,"controls__icon"],["id","Vector","d","M52.9733 4.25592L44.3474 12.8813V12.1407C44.3474 5.43551 38.9118 0 32.2066 0C25.5014 0 20.0659 5.43551 20.0659 12.1407V33.941C20.0659 34.9098 20.1824 35.875 20.4131 36.8161L16.5596 40.6697C15.5932 38.4912 15.0947 36.1345 15.0971 33.7512C15.0971 32.902 14.4088 32.2137 13.5595 32.2137C12.7103 32.2137 12.022 32.902 12.022 33.7512C12.0148 36.9633 12.7757 40.1297 14.2418 42.9874L8.81411 48.4151C8.4117 48.8007 8.24954 49.3731 8.39008 49.9124C8.53002 50.4518 8.95105 50.8728 9.4898 51.0133C10.0291 51.1539 10.6021 50.9917 10.9877 50.5899L15.9031 45.6739C16.5163 46.51 17.1926 47.298 17.926 48.0313C21.2413 51.3623 25.6228 53.4212 30.3033 53.847V60.9246H24.6029C23.7537 60.9246 23.0654 61.6135 23.0654 62.4622C23.0654 63.3114 23.7537 63.9997 24.6029 63.9997H39.8098C40.6584 63.9997 41.3473 63.3114 41.3473 62.4622C41.3473 61.6135 40.6584 60.9246 39.8098 60.9246H33.3778V53.9017C44.0585 53.2951 52.4051 44.4499 52.3907 33.7518C52.3907 32.9026 51.7018 32.2143 50.8532 32.2143C50.0039 32.2143 49.3156 32.9026 49.3156 33.7518C49.318 41.2426 44.4453 47.8638 37.292 50.089C30.1387 52.3143 22.3699 49.6259 18.1224 43.4553L21.6503 39.9279C23.8059 43.7286 27.8366 46.0787 32.206 46.0823C38.9004 46.0823 44.3468 40.6024 44.3468 33.8672V17.2309L55.1475 6.43072C55.7481 5.83071 55.7481 4.85713 55.1475 4.25652C54.5469 3.65591 53.5733 3.65591 52.9733 4.25652V4.25592Z","fill","white"],["class","controls__item",4,"ngIf"],[1,"controls__button","controls__button--danger",3,"click"],["id","phone"],["id","Vector","d","M51.7097 13.2478C51.2458 12.7839 50.4959 12.7839 50.032 13.2478L1.38351 61.8963C0.919568 62.3602 0.919568 63.1101 1.38351 63.574C1.61488 63.8054 1.91864 63.9217 2.2224 63.9217C2.52615 63.9217 2.82991 63.8054 3.06129 63.574L51.7097 14.9256C52.1737 14.4628 52.1737 13.7117 51.7097 13.2478Z","fill","white"],["id","Vector_2","d","M16.9605 42.9635L26.1159 33.8081L21.3365 29.0287C18.91 26.6022 18.6869 24.3679 20.5878 21.5629C20.8535 21.1951 22.5444 19.6941 23.992 18.4839C24.9151 17.9333 25.5487 17.1181 25.8264 16.1155C26.1954 14.783 25.9225 13.2156 25.0516 11.6885C24.8463 11.3373 19.9625 3.06229 15.4583 0.680892C14.6171 0.235937 13.6714 0.0010004 12.721 0.0010004C11.1571 0.0010004 9.68576 0.610886 8.58109 1.71556L5.57082 4.72702C-3.21082 13.5098 -1.58525 24.419 10.2719 36.2749L16.9605 42.9635Z","fill","white"],["id","Vector_3","d","M63.313 48.5357C60.9304 44.0328 52.6566 39.1478 52.2923 38.9342C51.2304 38.329 50.1209 38.0099 49.0839 38.0099C47.5402 38.0099 46.2753 38.717 45.51 40.0033C44.2986 41.452 42.7964 43.1429 42.4345 43.4051C39.6129 45.3154 37.4071 45.1007 34.9652 42.6588L31.148 38.8416L21.9926 47.997L27.7189 53.7233C34.5356 60.5412 41.0367 63.9976 47.0371 63.9976C47.0383 63.9976 47.0383 63.9976 47.0383 63.9976C51.4534 63.9976 55.5672 62.1217 59.2669 58.4232L62.2771 55.413C64.1068 53.5845 64.5233 50.821 63.313 48.5357Z","fill","white"],["id","fullscreen",1,"controls__icon"],["id","Vector","d","M57.8018 53.4382L44.3964 40.0328L40.0328 44.3964L53.4382 57.8018H43.0205V64H64V43.0205H57.8018V53.4382Z","fill","white"],["id","Vector_2","d","M44.3964 23.9803L57.8018 10.5618V20.9795H64V0H43.0205V6.1982H53.4382L40.0328 19.6036L44.3964 23.9803Z","fill","white"],["id","Vector_3","d","M19.6036 40.0328L6.1982 53.4382V43.0205H0V64H20.9795V57.8018H10.5618L23.9803 44.3964L19.6036 40.0328Z","fill","white"],["id","Vector_4","d","M20.9795 6.1982V0H0V20.9795H6.1982V10.5618L19.6036 23.9803L23.9803 19.6036L10.5618 6.1982H20.9795Z","fill","white"],["id","exit-full-screen",1,"controls__icon"],["id","fullscreen_x5F_exit"],["id","Vector","d","M49.172 54.828L58.344 64L64 58.344L54.828 49.172L64 40H40V64L49.172 54.828Z","fill","white"],["id","Vector_2","d","M0 24H24V0L14.828 9.172L5.75 0.086L0.094 5.742L9.172 14.828L0 24Z","fill","white"],["id","Vector_3","d","M0 58.344L5.656 64L14.828 54.828L24 64V40H0L9.172 49.172L0 58.344Z","fill","white"],["id","Vector_4","d","M40 24H64L54.828 14.828L63.922 5.742L58.266 0.086L49.172 9.172L40 0V24Z","fill","white"],[1,"controls__button","controls__button--rotate",3,"click"],["filter","url(#filter0_d_0_4)"],["d","M-4.81762e-07 34.7678V57.0215C-4.81762e-07 60.8696 3.13284 64 6.98275 64H57.016C60.8672 64 64 60.8696 64 57.0215V7.05508C64 3.20697 60.8672 0.0757321 57.016 0.0757321H34.6959C35.8972 1.3077 36.6961 2.93443 36.871 4.74067H57.0168C58.2942 4.74067 59.3335 5.77899 59.3335 7.05508V57.0216C59.3335 58.2969 58.2942 59.3352 57.0168 59.3352H6.98342C5.7062 59.3352 4.66761 58.2969 4.66761 57.0216V36.9389C2.90982 36.7703 1.27948 36.0149 -4.81762e-07 34.7678ZM10.7807 30.6654H26.0384L1.34093 5.97437C-0.02533 4.60686 -0.02533 2.39174 1.34093 1.02583C2.70813 -0.341677 4.92462 -0.341677 6.29089 1.02423L30.9883 25.7159V10.4614C30.9883 8.52907 32.5556 6.96139 34.4888 6.96139C35.4553 6.96139 36.3305 7.35214 36.9642 7.98612C37.5976 8.62116 37.9897 9.49543 37.9897 10.4613V34.1643C37.9897 36.0966 36.4228 37.6635 34.4896 37.6635H10.7807C8.84705 37.6635 7.28056 36.0974 7.28056 34.1643C7.28056 32.2312 8.84705 30.6654 10.7807 30.6654Z","fill","white"],["id","filter0_d_0_4","x","-4","y","0","width","72","height","72","filterUnits","userSpaceOnUse","color-interpolation-filters","sRGB"],["flood-opacity","0","result","BackgroundImageFix"],["in","SourceAlpha","type","matrix","values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0","result","hardAlpha"],["dy","4"],["stdDeviation","2"],["in2","hardAlpha","operator","out"],["type","matrix","values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"],["mode","normal","in2","BackgroundImageFix","result","effect1_dropShadow_0_4"],["mode","normal","in","SourceGraphic","in2","effect1_dropShadow_0_4","result","shape"]],template:function(o,c){1&o&&(oe(0,"div",0)(1,"div",1)(2,"button",2),mn("click",function(){return c.onToggleCamera()}),oe(3,"div",3),Qo(),oe(4,"svg",4)(5,"g",5)(6,"g",6)(7,"g",7),de(8,"path",8),Ee()()(),oe(9,"g",9)(10,"g",6)(11,"g",7),de(12,"path",10),Ee()(),oe(13,"g",11)(14,"g",12),de(15,"path",13),Ee()()()()(),Ec(),oe(16,"p"),br(17,"Camera"),Ee()()(),oe(18,"div",1)(19,"button",2),mn("click",function(){return c.onToggleMicrophone()}),oe(20,"div",3),Qo(),oe(21,"svg",4)(22,"g",14)(23,"g",15),de(24,"path",16)(25,"path",17),Ee()(),oe(26,"g",18),de(27,"path",19),Ee()()(),Ec(),oe(28,"p"),br(29,"Mic"),Ee()()(),Tn(30,OJ,22,7,"div",20)(31,NJ,18,2,"div",20),oe(32,"div",1)(33,"button",21),mn("click",function(){return c.onEndCall()}),oe(34,"div",3),Qo(),oe(35,"svg",4)(36,"g",22)(37,"g",6),de(38,"path",23)(39,"path",24)(40,"path",25),Ee()()()(),Ec(),oe(41,"p"),br(42,"End"),Ee()()()()),2&o&&(Ht("controls--small",c.smallScreenEnabled),Qe(2),Ht("controls__button--active",c.cameraEnabled),Qe(3),Ht("controls__icon--shown",c.cameraEnabled),Qe(4),Ht("controls__icon--shown",!c.cameraEnabled),Qe(10),Ht("controls__button--active",c.microphoneEnabled),Qe(3),Ht("controls__icon--shown",c.microphoneEnabled),Qe(4),Ht("controls__icon--shown",!c.microphoneEnabled),Qe(4),Ze("ngIf",!c.smallScreenEnabled),Qe(),Ze("ngIf",c.displaySmallScreen))},dependencies:[Mu],styles:["[_nghost-%COMP%]{transition:.3s}.controls[_ngcontent-%COMP%]{background:#0000004d;bottom:0;display:flex;justify-content:center;padding:15px 0;position:absolute;left:0;width:100%}.controls--small[_ngcontent-%COMP%]{border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding:5px 0}.controls--small[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{height:32px;width:32px}.controls--small[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:16px;width:16px}.controls--small[_ngcontent-%COMP%]   .controls__item[_ngcontent-%COMP%]{margin:0}.controls--small[_ngcontent-%COMP%]   .controls__button[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:none}.controls__item[_ngcontent-%COMP%]{margin:0 5px;text-align:center}.controls__button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer}.controls__button[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#101316}.controls__button--active[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#0b73c9}.controls__button--active[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#158ef2}.controls__button--active.controls__button--rotate[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{transform:translate(-50%,-50%) rotate(-180deg)}.controls__button--danger[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#d73b3d}.controls__button--danger[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#e06567}.controls__button[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;margin:8px 0 0}.controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#313a42;border-radius:50%;box-shadow:0 3px 8px #00000080;margin:auto;position:relative;height:60px;width:60px;transition:.3s}.controls__icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%) rotate(0);height:32px;width:32px;transition:.3s}.controls__icon[_ngcontent-%COMP%]{opacity:0;transition:.3s}.controls__icon--shown[_ngcontent-%COMP%]{opacity:1}"],changeDetection:0})}return e})();function w3(e,n){return Yp((t,o)=>{let c=0;t.subscribe(Gu(o,u=>{o.next(e.call(n,u,c++))}))})}let MJ=(()=>{class e{constructor(){this.started=Date.now()}ngOnInit(){this.time$=T3(0,1e3).pipe(w3(()=>this.format(Date.now()-this.started)))}format(t){const o=Math.floor(t/1e3%60).toString().padStart(2,"0"),c=Math.floor(t/6e4%60).toString().padStart(2,"0");return[Math.floor(t/36e5%24).toString().padStart(2,"0"),c,o].join(":")}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275cmp=Br({type:e,selectors:[["ngx-timer"]],inputs:{started:"started"},decls:4,vars:3,consts:[[1,"timer"]],template:function(o,c){1&o&&(oe(0,"div",0)(1,"span"),br(2),gu(3,"async"),Ee()()),2&o&&(Qe(2),uu(Eu(3,1,c.time$)))},dependencies:[Cb],styles:[".timer[_ngcontent-%COMP%]{color:#fff;position:relative;text-align:center;z-index:1}.timer[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#0000004d;border-radius:5px;padding:5px 10px}"],changeDetection:0})}return e})();function xJ(e,n){if(1&e&&(oe(0,"div",8),br(1),Ee()),2&e){const t=_n();Qe(),uu(t.text)}}const kJ=(e,n,t,o)=>({"spinner--connected":e,"spinner--ended":n,"spinner--small":t,"spinner--error":o});let LJ=(()=>{class e{constructor(){this.error=!1,this.connected=!0,this.ended=!1,this.small=!1}get color(){return this.ended?"#aaa":this.error?"#d73b3d":this.connected?"#37D425":"#1195E6"}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275cmp=Br({type:e,selectors:[["ngx-spinner"]],inputs:{text:"text",error:"error",connected:"connected",ended:"ended",small:"small"},decls:8,vars:9,consts:[[1,"spinner",3,"ngClass"],[1,"spinner__wrapper"],[1,"spinner__icon"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 32 32","fill","none"],["d","M5.25 5.5C3.45507 5.5 2 6.95508 2 8.75V19.25C2 21.0449 3.45507 22.5 5.25 22.5H14.75C16.5449 22.5 18 21.0449 18 19.25V8.75C18 6.95507 16.5449 5.5 14.75 5.5H5.25Z"],["d","M23.1232 20.6431L19.5 17.0935V10.9989L23.1121 7.3706C23.8988 6.58044 25.248 7.13753 25.248 8.25251V19.7502C25.248 20.8577 23.9143 21.4181 23.1232 20.6431Z"],[1,"spinner__cirle"],["class","spinner__text",4,"ngIf"],[1,"spinner__text"]],template:function(o,c){1&o&&(oe(0,"div",0)(1,"div",1)(2,"div",2),Qo(),oe(3,"svg",3),de(4,"path",4)(5,"path",5),Ee()(),Ec(),de(6,"div",6),Tn(7,xJ,2,1,"div",7),Ee()()),2&o&&(Ze("ngClass",_u(4,kJ,c.connected,c.ended,c.small,c.error)),Qe(4),Xi("fill",c.color),Qe(),Xi("fill",c.color),Qe(2),Ze("ngIf",!c.small))},dependencies:[Y0,Mu],styles:[".spinner[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;position:relative;transition:.3s}.spinner--connected[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:#37d425}.spinner--ended[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:transparent}.spinner--error[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:#d73b3d}.spinner--small[_ngcontent-%COMP%]{border-radius:10px;height:200px}.spinner--small[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-width:4px;height:80px;width:80px}.spinner--small[_ngcontent-%COMP%]   .spinner__icon[_ngcontent-%COMP%]{top:26px;transform:translate(-35%)}.spinner--small[_ngcontent-%COMP%]   .spinner__icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:32px;width:32px}.spinner__wrapper[_ngcontent-%COMP%]{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%)}.spinner__cirle[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 2s linear infinite;border:5px solid #1195E6;border-radius:50%;border-top-color:transparent;height:160px;margin:auto;width:160px;transition:.3s}.spinner__icon[_ngcontent-%COMP%]{left:50%;position:absolute;top:52px;transform:translate(-40%);transition:.3s}.spinner__icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:64px;width:64px;transition:.3s}.spinner__text[_ngcontent-%COMP%]{color:#fff;font-size:1.3em;margin-top:25px;text-align:center}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"],changeDetection:0})}return e})(),FJ=(()=>{class e{onEnter(){this.subscription.unsubscribe(),this.setStyle(1)}onLeave(){this.hide()}constructor(t,o){this.renderer=t,this.el=o,this.subscription=new id,this.delay=5e3}ngOnInit(){this.hide()}hide(){this.subscription.unsubscribe(),this.subscription=I3(this.delay).pipe(fl(1)).subscribe(()=>this.setStyle(0))}setStyle(t){this.renderer.setStyle(this.el.nativeElement,"opacity",t)}static#e=this.\u0275fac=function(o){return new(o||e)(ae(Fs),ae(en))};static#t=this.\u0275dir=Ye({type:e,selectors:[["","ngxToggle",""]],hostBindings:function(o,c){1&o&&mn("mouseenter",function(){return c.onEnter()})("mouseleave",function(){return c.onLeave()})}})}return e})();function UJ(e,n){if(1&e&&de(0,"ngx-spinner",15),2&e){const t=_n().ngIf,o=_n(2);Ze("error",t.error)("text",t.statusText)("connected",t.connected)("ended",t.ended)("small",o.smallScreenEnabled)}}function VJ(e,n){1&e&&de(0,"ngx-timer",16),2&e&&Ze("started",_n().ngIf.started)}function BJ(e,n){if(1&e&&(de(0,"div",17),gu(1,"async")),2&e){const t=n.$implicit;Ht("hidden",!1===Eu(1,3,_n(3).remoteStreamVideoToggle$)),Ze("id",t)}}function jJ(e,n){if(1&e){const t=up();Qo(),Ec(),oe(0,"ngx-controls",18),mn("toggleCamera",function(c){return Da(t),Zs(_n(3).onToggleCamera(c))})("toggleMicrophone",function(c){return Da(t),Zs(_n(3).onToggleMicrophone(c))})("toggleFullScreen",function(c){return Da(t),Zs(_n(3).onToggleFullScreen(c))})("toggleSmallScreen",function(c){return Da(t),Zs(_n(3).onToggleSmallScreen(c))})("endCall",function(){return Da(t),Zs(_n(3).onEndCall())}),Ee()}if(2&e){const t=_n(3);Ze("cameraEnabled",t.cameraEnabled)("microphoneEnabled",t.microphoneEnabled)("fullScreenEnabled",t.fullScreenEnabled)("smallScreenEnabled",t.smallScreenEnabled)("displaySmallScreen",t.displaySmallScreen)}}function HJ(e,n){if(1&e&&(oe(0,"div",2),Tn(1,UJ,1,5,"ngx-spinner",3)(2,VJ,1,1,"ngx-timer",4),de(3,"div",5),Tn(4,BJ,2,5,"div",6),oe(5,"div",7),Qo(),oe(6,"svg",8)(7,"g",9),de(8,"path",10)(9,"path",11),Ee(),oe(10,"defs")(11,"clipPath",12),de(12,"rect",13),Ee()()()(),Tn(13,jJ,1,5,"ngx-controls",14),Ee()),2&e){const t=n.ngIf,o=_n(2);Qe(),Ze("ngIf",t.loading),Qe(),Ze("ngIf",t.started),Qe(),Ht("hidden",!o.cameraEnabled||o.smallScreenEnabled),Ze("id",o.localContainerId),Qe(),Ze("ngForOf",o.remoteCalls),Qe(9),Ze("ngIf",t.connected&&!t.ended)}}function GJ(e,n){if(1&e&&(oe(0,"div"),Tn(1,HJ,14,7,"div",1),gu(2,"async"),Ee()),2&e){const t=_n();Ze("@fade",void 0)("@.disabled",!t.animate),Qe(),Ze("ngIf",Eu(2,3,t.streamState$))}}let C8=(()=>{class e extends E8{constructor(t,o){super(o),this.webRtcService=t,this.animate=!0,this.displaySmallScreen=!1,this.debug=!1,this.callEnd=new hn,this.smallScreenEnabled=!1,this.active=!1,this.streamState$=this.webRtcService.streamState$,this.remoteStreamVideoToggle$=this.webRtcService.remoteStreamVideoToggle$}ngOnInit(){this.webRtcService.init(this.uid,this.channel,this.debug).pipe(fl(1)).subscribe(()=>{this.active=this.smallScreenEnabled,this.callEnd.emit(),this.closeDialog(!0)})}ngOnDestroy(){this.webRtcService.deinit()}get localContainerId(){return this.webRtcService.localContainerId}get remoteCalls(){return this.webRtcService.remoteCalls}get cameraEnabled(){return this.webRtcService.isVideoEnabled()}get microphoneEnabled(){return this.webRtcService.isAudioEnabled()}get fullScreenEnabled(){return!!document.fullscreenElement}onToggleCamera(t){this.webRtcService.toggleVideo(t)}onToggleMicrophone(t){this.webRtcService.toggleAudio(t)}onToggleFullScreen(t){this.webRtcService.toggleFullScreen(t)}onToggleSmallScreen(t){this.smallScreenEnabled=!t,this.active=!0}onEndCall(){this.webRtcService.endCall()}static#e=this.\u0275fac=function(o){return new(o||e)(ae(S8),ae(Us))};static#t=this.\u0275cmp=Br({type:e,selectors:[["ngx-webrtc"]],hostVars:4,hostBindings:function(o,c){2&o&&Ht("small-screen",c.smallScreenEnabled)("active",c.active)},inputs:{uid:"uid",channel:"channel",animate:"animate",displaySmallScreen:"displaySmallScreen",debug:"debug"},outputs:{callEnd:"callEnd"},features:[Nt],decls:1,vars:1,consts:[[4,"ngIf"],["class","container",4,"ngIf"],[1,"container"],[3,"error","text","connected","ended","small",4,"ngIf"],[3,"started",4,"ngIf"],[1,"container__local",3,"id"],["class","container__remote",3,"id","hidden",4,"ngFor","ngForOf"],[1,"container__user-icon"],["viewBox","0 0 64 64","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","user","clip-path","url(#clip0)"],["id","Vector","d","M31.5439 30.829C35.7793 30.829 39.4468 29.3099 42.4434 26.3129C45.4399 23.3163 46.959 19.6498 46.959 15.414C46.959 11.1796 45.4399 7.51267 42.4429 4.51512C39.4458 1.51904 35.7788 0 31.5439 0C27.3081 0 23.6416 1.51904 20.645 4.51561C17.6484 7.51218 16.1289 11.1792 16.1289 15.414C16.1289 19.6498 17.6484 23.3168 20.6455 26.3134C23.6426 29.3095 27.3096 30.829 31.5439 30.829V30.829Z","fill","#0B73C9"],["id","Vector_2","d","M58.5161 49.2127C58.4297 47.9656 58.2549 46.6053 57.9976 45.1688C57.7378 43.7215 57.4033 42.3533 57.0029 41.1029C56.5894 39.8104 56.0269 38.534 55.3315 37.3109C54.6099 36.0414 53.7622 34.9359 52.811 34.0262C51.8164 33.0746 50.5986 32.3094 49.1904 31.7513C47.7871 31.1962 46.2319 30.9149 44.5684 30.9149C43.915 30.9149 43.2832 31.183 42.063 31.9774C41.312 32.4672 40.4336 33.0336 39.4531 33.66C38.6147 34.1942 37.479 34.6947 36.0762 35.1478C34.7075 35.5907 33.3179 35.8153 31.9463 35.8153C30.5747 35.8153 29.1855 35.5907 27.8154 35.1478C26.4141 34.6952 25.2783 34.1947 24.4409 33.6605C23.4697 33.0399 22.5908 32.4735 21.8286 31.9769C20.6099 31.1825 19.9775 30.9144 19.3242 30.9144C17.6602 30.9144 16.1055 31.1962 14.7026 31.7518C13.2954 32.309 12.0771 33.0741 11.0815 34.0267C10.1309 34.9369 9.28271 36.0419 8.56201 37.3109C7.86719 38.534 7.30469 39.8099 6.89062 41.1034C6.49072 42.3538 6.15625 43.7215 5.89648 45.1688C5.63916 46.6033 5.46436 47.9642 5.37793 49.2142C5.29297 50.4388 5.25 51.7098 5.25 52.9934C5.25 56.3343 6.31201 59.0388 8.40625 61.0335C10.4746 63.0017 13.2114 64.0002 16.5396 64.0002H47.356C50.6841 64.0002 53.4199 63.0022 55.4888 61.0335C57.5835 59.0403 58.6455 56.3352 58.6455 52.993C58.645 51.7034 58.6016 50.4314 58.5161 49.2127V49.2127Z","fill","#0B73C9"],["id","clip0"],["width","64","height","64","fill","#0B73C9"],["ngxToggle","",3,"cameraEnabled","microphoneEnabled","fullScreenEnabled","smallScreenEnabled","displaySmallScreen","toggleCamera","toggleMicrophone","toggleFullScreen","toggleSmallScreen","endCall",4,"ngIf"],[3,"error","text","connected","ended","small"],[3,"started"],[1,"container__remote",3,"id"],["ngxToggle","",3,"cameraEnabled","microphoneEnabled","fullScreenEnabled","smallScreenEnabled","displaySmallScreen","toggleCamera","toggleMicrophone","toggleFullScreen","toggleSmallScreen","endCall"]],template:function(o,c){1&o&&Tn(0,GJ,3,5,"div",0),2&o&&Ze("ngIf",c.shown)},dependencies:[kP,Mu,PJ,MJ,LJ,FJ,Cb],styles:["ngx-timer[_ngcontent-%COMP%]{display:block;padding-top:25px}[_nghost-%COMP%]{bottom:0;max-width:100%;right:0;width:100%;transition:.3s}.active[_nghost-%COMP%]{position:fixed}.small-screen[_nghost-%COMP%]{max-width:210px}.small-screen[_nghost-%COMP%]   ngx-timer[_ngcontent-%COMP%]{padding-top:10px}.small-screen[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{border-radius:10px;box-shadow:#00000059 0 5px 15px;height:200px;max-width:200px;margin-right:10px;margin-bottom:10px}.small-screen[_nghost-%COMP%]   .container__remote[_ngcontent-%COMP%]{border-radius:10px;height:200px;width:200px}.small-screen[_nghost-%COMP%]   .container__remote[_ngcontent-%COMP%]    >div{border-radius:10px}.small-screen[_nghost-%COMP%]   .container__user-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:32px;width:32px}.container[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;max-width:100%;margin-left:auto;overflow:hidden;position:relative;transition:.3s}.container__local[_ngcontent-%COMP%]{border-radius:5px;height:20vh;opacity:1;overflow:hidden;position:absolute;right:1rem;top:1rem;width:20vw;z-index:1;transition:.3s}.container__local.hidden[_ngcontent-%COMP%]{opacity:0;visibility:hidden}.container__local[_ngcontent-%COMP%]:not(:empty){box-shadow:0 3px 8px #00000080}.container__remote[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;left:0;position:absolute;top:0;width:100vw;transition:.3s}.container__remote[_ngcontent-%COMP%]    >div{transition:.3s}.container__remote.hidden[_ngcontent-%COMP%]{display:none}.container__remote.hidden[_ngcontent-%COMP%] + .container__user-icon[_ngcontent-%COMP%]{display:block}.container__remote[_ngcontent-%COMP%]:empty{display:none}.container__user-icon[_ngcontent-%COMP%]{background:#0000004d;border-radius:50%;box-shadow:0 3px 8px #00000080;display:none;left:50%;padding:20px;position:absolute;top:50%;transform:translate(-50%,-50%)}.container__user-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:64px;width:64px}@media screen and (max-width: 769px){ngx-controls[_ngcontent-%COMP%]{opacity:1!important}}"],data:{animation:[g8]},changeDetection:0})}return e})();function WJ(e,n){if(1&e&&(Ei(0),br(1),Me()),2&e){const t=_n(2);Qe(),Mo(" Calling to ",t.data.user.name," ")}}function zJ(e,n){1&e&&br(0),2&e&&Mo(" ",_n(2).data.user.name," is calling ")}function qJ(e,n){if(1&e){const t=up();Ei(0),oe(1,"button",11),mn("click",function(){return Da(t),Zs(_n(2).onAcceptCall())}),Ee(),Me()}}function KJ(e,n){if(1&e){const t=up();oe(0,"div",1)(1,"div",2)(2,"div",3),de(3,"img",4),Ee(),oe(4,"p",5),Tn(5,WJ,2,1,"ng-container",6)(6,zJ,1,1,"ng-template",null,7,jv),Ee()(),oe(8,"div",8),Tn(9,qJ,2,0,"ng-container",9),oe(10,"span")(11,"button",10),mn("click",function(){return Da(t),Zs(_n().onDeclineCall())}),Ee()()()()}if(2&e){const t=Hm(7),o=_n();Ht("video-call--full-screen",o.fullScreen),Ze("@fade",void 0),Qe(3),Ze("src",o.data.user.photoURL,KS),Qe(2),Ze("ngIf",o.data.outcome)("ngIfElse",t),Qe(4),Ze("ngIf",!o.data.outcome)}}let YJ=(()=>{class e extends E8{constructor(t){super(t),this.fullScreen=!1}ngOnInit(){this.play(`assets/${this.data.outcome?"outcome":"income"}.mp3`)}ngOnDestroy(){this.stop()}onAcceptCall(){this.fullScreen=!0,this.cdr.markForCheck(),this.afterClosed.next(this.data)}onDeclineCall(){this.play("assets/cancel.mp3"),setTimeout(()=>this.closeDialog(null),200)}play(t,o=!0){this.audio&&this.stop(),this.audio=new Audio(t),this.audio.loop=o,this.audio.load(),this.audio.play()}stop(){this.audio.pause(),this.audio.remove()}static#e=this.\u0275fac=function(o){return new(o||e)(ae(Us))};static#t=this.\u0275cmp=Br({type:e,selectors:[["ngx-video-call"]],inputs:{data:"data"},features:[Nt],decls:1,vars:1,consts:[["class","video-call",3,"video-call--full-screen",4,"ngIf"],[1,"video-call"],[1,"video-call-user"],[1,"video-call-user__block","video-call-user__block--animated"],["alt","",1,"video-call-user__img",3,"src"],[1,"video-call-user__title"],[4,"ngIf","ngIfElse"],["income",""],[1,"video-call__actions"],[4,"ngIf"],["aria-label","Decline",1,"video-call__button","video-call__button--decline",3,"click"],["aria-label","Accept",1,"video-call__button","video-call__button--accept",3,"click"]],template:function(o,c){1&o&&Tn(0,KJ,12,7,"div",0),2&o&&Ze("ngIf",c.shown&&c.data)},dependencies:[Mu],styles:['[_nghost-%COMP%]{display:block;height:100vh;position:relative}.video-call[_ngcontent-%COMP%]{background-image:linear-gradient(#3f51b5,#313a42);background-size:cover;border-radius:10px;box-shadow:0 5px 10px #0000001a;display:flex;flex-direction:column;height:100%;justify-content:flex-end;left:50%;max-height:400px;max-width:400px;position:absolute;top:50%;transform:translate(-50%,-50%);width:100%;z-index:5;transition:.3s}.video-call--full-screen[_ngcontent-%COMP%]{background-image:linear-gradient(#22292f);border-radius:0;max-height:100%;max-width:100%}.video-call-user[_ngcontent-%COMP%]{left:50%;position:absolute;text-align:center;top:50%;transform:translate(-50%,-55%);z-index:1}.video-call-user__block[_ngcontent-%COMP%]{background:#fff;border-radius:50%;border:solid 5px #fff;height:180px;margin:0 auto;transform:scale(1);width:180px}.video-call-user__block--animated[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_play 2s ease infinite;backface-visibility:hidden}.video-call-user__img[_ngcontent-%COMP%]{border-radius:50%;height:100%;left:0;object-fit:cover;position:absolute;top:0;width:100%}.video-call-user__title[_ngcontent-%COMP%]{color:#fff;font-size:1.2em;font-weight:700;margin:15px 0 0}.video-call__actions[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:10px 0}.video-call__button[_ngcontent-%COMP%]{border-radius:50%;box-shadow:0 0 #3f51b500,0 .05em .1em #0003;border:0;cursor:pointer;display:block;font-size:40px;height:1em;margin:0 5px;position:relative;transform:translateZ(0) scale(1);width:1em;transition:.3s}.video-call__button[_ngcontent-%COMP%]:before, .video-call__button[_ngcontent-%COMP%]:after{content:"";position:absolute}.video-call__button[_ngcontent-%COMP%]:before{background-color:#ffffff1a;border-radius:50%;height:1em;left:0;opacity:1;top:0;transform:translateZ(0) scale(0);width:1em}.video-call__button[_ngcontent-%COMP%]:after{background-position:50% 50%;background-repeat:no-repeat;background-size:cover;background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTYuNiAxMC44YzEuNCAyLjggMy44IDUuMSA2LjYgNi42bDIuMi0yLjJjLjMtLjMuNy0uNCAxLS4yIDEuMS40IDIuMy42IDMuNi42LjUgMCAxIC40IDEgMVYyMGMwIC41LS41IDEtMSAxLTkuNCAwLTE3LTcuNi0xNy0xNyAwLS42LjQtMSAxLTFoMy41Yy41IDAgMSAuNCAxIDEgMCAxLjIuMiAyLjUuNiAzLjYuMS40IDAgLjctLjIgMWwtMi4zIDIuMnoiIGZpbGw9IiNmZmZmZmYiLz48L3N2Zz4=);height:.5em;left:.25em;top:.25em;transform:translateZ(0);width:.5em;transition:.3s}.video-call__button--accept[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_phone-outer 3s infinite;background-color:#3f51b5}.video-call__button--accept[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_phone-inner 3s infinite}.video-call__button--accept[_ngcontent-%COMP%]:after{animation:_ngcontent-%COMP%_phone-icon 3s infinite}.video-call__button--decline[_ngcontent-%COMP%]{background-color:#d73b3d}.video-call__button--decline[_ngcontent-%COMP%]:hover{background-color:#ce2a2c}.video-call__button--decline[_ngcontent-%COMP%]:after{top:.28em;transform:translateZ(0) rotate(135deg)}@keyframes _ngcontent-%COMP%_play{0%{transform:scale(1)}15%{box-shadow:0 0 0 5px #9b9da466}25%{box-shadow:0 0 0 10px #9b9da466,0 0 0 20px #9b9da433}25%{box-shadow:0 0 0 15px #9b9da466,0 0 0 30px #9b9da433}}@keyframes _ngcontent-%COMP%_phone-outer{0%{box-shadow:0 0 #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}33.3333%{box-shadow:0 0 #3f51b51a,0 .05em .1em #00000080;transform:translateZ(0) scale(1.1)}66.6666%{box-shadow:0 0 0 .5em #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}to{box-shadow:0 0 #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}}@keyframes _ngcontent-%COMP%_phone-inner{0%{opacity:1;transform:translateZ(0) scale(0)}33.3333%{opacity:1;transform:translateZ(0) scale(.9)}66.6666%{opacity:0;transform:translateZ(0) scale(0)}to{opacity:0;transform:translateZ(0) scale(0)}}@keyframes _ngcontent-%COMP%_phone-icon{0%{transform:translateZ(0)}2%{transform:translate3d(.01em,0,0)}4%{transform:translate3d(-.01em,0,0)}6%{transform:translate3d(.01em,0,0)}8%{transform:translate3d(-.01em,0,0)}10%{transform:translate3d(.01em,0,0)}12%{transform:translate3d(-.01em,0,0)}14%{transform:translate3d(.01em,0,0)}16%{transform:translate3d(-.01em,0,0)}18%{transform:translate3d(.01em,0,0)}20%{transform:translate3d(-.01em,0,0)}22%{transform:translate3d(.01em,0,0)}24%{transform:translate3d(-.01em,0,0)}26%{transform:translate3d(.01em,0,0)}28%{transform:translate3d(-.01em,0,0)}30%{transform:translate3d(.01em,0,0)}32%{transform:translate3d(-.01em,0,0)}34%{transform:translate3d(.01em,0,0)}36%{transform:translate3d(-.01em,0,0)}38%{transform:translate3d(.01em,0,0)}40%{transform:translate3d(-.01em,0,0)}42%{transform:translate3d(.01em,0,0)}44%{transform:translate3d(-.01em,0,0)}46%{transform:translateZ(0)}}'],data:{animation:[g8]},changeDetection:0})}return e})();function R3(e,n,t=1/0){return Ir(n)?R3((o,c)=>w3((u,p)=>n(o,u,c,p))(H_(e(o,c))),t):("number"==typeof n&&(t=n),Yp((o,c)=>function $J(e,n,t,o,c,u,p,m){const E=[];let S=0,w=0,P=!1;const V=()=>{P&&!E.length&&!S&&n.complete()},H=J=>S<o?z(J):E.push(J),z=J=>{u&&n.next(J),S++;let ce=!1;H_(t(J,w++)).subscribe(Gu(n,he=>{c?.(he),u?H(he):n.next(he)},()=>{ce=!0},void 0,()=>{if(ce)try{for(S--;E.length&&S<o;){const he=E.shift();p?Kp(n,p,()=>z(he)):z(he)}V()}catch(he){n.error(he)}}))};return e.subscribe(Gu(n,H,()=>{P=!0,V()})),()=>{m?.()}}(o,c,e,t)))}function T8(e,n){return n?t=>function QJ(...e){return function JJ(){return function XJ(e=1/0){return R3(g3,e)}(1)}()(m8(e,JH(e)))}(n.pipe(fl(1),function ZJ(){return Yp((e,n)=>{e.subscribe(Gu(n,l3))})}()),t.pipe(T8(e))):R3((t,o)=>H_(e(t,o)).pipe(fl(1),function eQ(e){return w3(()=>e)}(t)))}let nQ=(()=>{class e{constructor(t,o,c,u){this.document=t,this.componentFactoryResolver=o,this.appRef=c,this.injector=u,this.wrapperSelector="ngx-webrtc-wrapper"}open(t,o={}){return this.appendComponent(t,o)}appendComponent(t,o){const c=this.componentFactoryResolver.resolveComponentFactory(t).create(this.injector),{instance:u}=c;Object.keys(o).forEach(m=>u[m]=o[m]),this.appRef.attachView(c.hostView);const p=c.hostView.rootNodes[0];return this.getContainer().append(p),u.afterClosed.pipe(fl(1),function tQ(e,n=C3){const t=T3(e,n);return T8(()=>t)}(250)).subscribe(()=>{this.appRef.detachView(c.hostView),c.destroy()}),u}getContainer(){let t=this.document.querySelector(`.${this.wrapperSelector}`);return t||(t=this.document.createElement("div"),t.setAttribute("class",this.wrapperSelector),t.setAttribute("style","position: fixed; top: 0; width: 100%; z-index: 1;"),this.document.body.appendChild(t)),t}static#e=this.\u0275fac=function(o){return new(o||e)(be(on),be(Mh),be(Yr),be(pr))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),iQ=(()=>{class e{constructor(t){this.dialog=t}open(t){const o=new $I,c=this.dialog.open(YJ,{data:t});return c.afterClosed.asObservable().pipe(function vJ(e,n){return Yp((t,o)=>{let c=null,u=0,p=!1;const m=()=>p&&!c&&o.complete();t.subscribe(Gu(o,E=>{c?.unsubscribe();let S=0;const w=u++;H_(e(E,w)).subscribe(c=Gu(o,P=>o.next(n?n(E,P,w,S++):P),()=>{c=null,m()}))},()=>{p=!0,m()}))})}(u=>u?.channel?this.dialog.open(C8,{uid:u.uid,channel:u.channel,debug:!!u.debug,displaySmallScreen:!0}).afterClosed.asObservable():function EJ(...e){return m8(e,JH(e))}(!1)),fl(1),function yJ(e,n,t){const o=Ir(e)||n||t?{next:e,error:n,complete:t}:e;return o?Yp((c,u)=>{var p;null===(p=o.subscribe)||void 0===p||p.call(o);let m=!0;c.subscribe(Gu(u,E=>{var S;null===(S=o.next)||void 0===S||S.call(o,E),u.next(E)},()=>{var E;m=!1,null===(E=o.complete)||void 0===E||E.call(o),u.complete()},E=>{var S;m=!1,null===(S=o.error)||void 0===S||S.call(o,E),u.error(E)},()=>{var E,S;m&&(null===(E=o.unsubscribe)||void 0===E||E.call(o)),null===(S=o.finalize)||void 0===S||S.call(o)}))}):g3}(()=>o.next(!0))).subscribe(),{acceptCall:c.onAcceptCall.bind(c),close:c.closeDialog.bind(c),afterConfirmation:()=>c.afterClosed.asObservable().pipe(fl(1)),afterCallEnd:()=>o.asObservable().pipe(fl(1))}}static#e=this.\u0275fac=function(o){return new(o||e)(be(nQ))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),rQ=(()=>{class e{constructor(t,o,c,u,p){this.formBuilder=t,this.router=o,this.localStorage=c,this.videoCallDialogService=u,this.cdr=p,this.sessionKey="ngx-webrtc:channelId",this.outcome=!1}get channelId(){return this.localStorage.getItem(this.sessionKey)||"test-channel-ngx-webrtc"}get tooltipText(){return this.outcome?"Outcome":"Income"}ngOnInit(){this.form=this.formBuilder.group({channelId:[this.channelId,Wj.required]})}onSubmit(){this.saveChannel(),this.router.navigate(["conference"],{queryParams:{...this.form.value}})}onModalOpen(){this.saveChannel(),this.dialog=this.videoCallDialogService.open({uid:String(Math.floor(100*Math.random())),channel:this.channelId,outcome:this.outcome,user:{name:"Test User",photoURL:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTvDtoEwuV9E2kHqNDi6MnBzXlefn8TfyrwgQ&usqp=CAU"},debug:!0});const t=setTimeout(()=>this.dialog?.close(),7e3);this.dialog.afterConfirmation().pipe(Ea(o=>!!o),go(()=>clearTimeout(t))).subscribe(),this.dialog.afterCallEnd().subscribe(()=>{clearTimeout(t),this.dialog=null,this.cdr.markForCheck()})}saveChannel(){const{channelId:t}=this.form.value;this.localStorage.setItem(this.sessionKey,t)}static#e=this.\u0275fac=function(o){return new(o||e)(ae(kW),ae(ya),ae(Storage),ae(iQ),ae(Us))};static#t=this.\u0275cmp=Br({type:e,selectors:[["app-home"]],decls:25,vars:8,consts:[[1,"home"],[1,"home__welcome"],[1,"home__form",3,"formGroup","ngSubmit"],[1,"home__wrapper","home__wrapper--center"],["src","assets/user.svg","alt","User",1,"user"],[1,"home__title"],["appearance","outline",1,"home__wrapper"],["matInput","","placeholder","Channel id","formControlName","channelId"],[1,"home__wrapper","home__wrapper--center","home__wrapper--buttons"],["mat-flat-button","","color","primary",1,"home__btn",3,"disabled"],["mat-raised-button","","type","button",1,"home__btn",3,"disabled","click"],[3,"checked","disabled","matTooltip","change","click"],[1,"home__footer"],["href","https://www.npmjs.com/package/ngx-webrtc-lib","target","_blank"],["viewBox","0 0 27.23 27.23"],["width","27.23","height","27.23","rx","2"],["fill","#fff","points","5.8 21.75 13.66 21.75 13.67 9.98 17.59 9.98 17.58 21.76 21.51 21.76 21.52 6.06 5.82 6.04 5.8 21.75"],["href","https://github.com/TarasMoskovych/ngx-webrtc","target","_blank"],["aria-hidden","true","role","img","viewBox","0 0 16 16","width","50","height","50",1,""],["fill-rule","evenodd","d","M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"]],template:function(o,c){1&o&&(oe(0,"div",0)(1,"div",1)(2,"form",2),mn("ngSubmit",function(){return!c.dialog&&c.onSubmit()}),oe(3,"div",3),de(4,"img",4),Ee(),oe(5,"h1",5),br(6," Welcome "),Ee(),oe(7,"mat-form-field",6)(8,"mat-label"),br(9,"Channel Id"),Ee(),de(10,"input",7),Ee(),oe(11,"div",8)(12,"button",9),br(13,"Start / Join call"),Ee(),oe(14,"button",10),mn("click",function(){return!c.dialog&&c.onModalOpen()}),br(15,"Open Call Dialog "),oe(16,"mat-slide-toggle",11),mn("change",function(p){return c.outcome=p.checked})("click",function(p){return p.stopPropagation()}),Ee()()()(),oe(17,"div",12)(18,"a",13),Qo(),oe(19,"svg",14),de(20,"rect",15)(21,"polygon",16),Ee()(),Ec(),oe(22,"a",17),Qo(),oe(23,"svg",18),de(24,"path",19),Ee()()()()()),2&o&&(Qe(2),Ze("formGroup",c.form),Qe(5),Ht("mat-focused",c.form.valid),Qe(5),Ze("disabled",c.form.invalid||!!c.dialog),Qe(2),Ze("disabled",c.form.invalid||!!c.dialog),Qe(2),Ze("checked",c.outcome)("disabled",!!c.dialog)("matTooltip",c.tooltipText))},dependencies:[A4,nM,p4,f4,bI,PU,Yz,Wz,tV,X9,oq,nV],styles:[".home[_ngcontent-%COMP%]{align-items:center;background-color:#f2f2f2;display:flex;flex-wrap:wrap;justify-content:center;min-height:100vh;width:100%}.home__welcome[_ngcontent-%COMP%]{background:#fff;border-radius:10px;box-shadow:0 5px 10px #0000001a;overflow:hidden;padding:10px 35px;width:390px}.home__welcome[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]{height:150px}.home__title[_ngcontent-%COMP%]{color:#333;display:block;font-size:30px;font-weight:500;margin:10px 0 60px;text-align:center}.home__wrapper[_ngcontent-%COMP%]{width:100%}.home__wrapper--center[_ngcontent-%COMP%]{text-align:center}.home__wrapper--buttons[_ngcontent-%COMP%]{align-items:center;display:flex}.home__btn[_ngcontent-%COMP%]{letter-spacing:normal}.home__btn[_ngcontent-%COMP%]:first-of-type{margin-right:5px}.home__btn[_ngcontent-%COMP%]:last-of-type{margin-left:5px}.home__footer[_ngcontent-%COMP%]{margin-top:30px;text-align:center}.home__footer[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{fill:#333;cursor:pointer;height:24px;margin:0 5px;width:24px;transition:.3s}.home__footer[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]:hover{fill:#aaa}"],changeDetection:0})}return e})(),oQ=(()=>{class e{constructor(t,o){this.route=t,this.router=o,this.uid=String(Math.floor(100*Math.random()))}ngOnInit(){this.channel=this.route.snapshot.queryParams.channelId||"test-channel"}onCallEnd(){this.router.navigateByUrl("/")}static#e=this.\u0275fac=function(o){return new(o||e)(ae(V_),ae(ya))};static#t=this.\u0275cmp=Br({type:e,selectors:[["app-conference"]],decls:1,vars:4,consts:[[3,"animate","channel","debug","uid","callEnd"]],template:function(o,c){1&o&&(oe(0,"ngx-webrtc",0),mn("callEnd",function(){return c.onCallEnd()}),Ee()),2&o&&Ze("animate",!1)("channel",c.channel)("debug",!0)("uid",c.uid)},dependencies:[C8],changeDetection:0})}return e})(),sQ=(()=>{class e{static forRoot(t){return{ngModule:e,providers:[S8,{provide:"AgoraConfig",useValue:t}]}}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Jn({imports:[ku]})}return e})();const aQ=[{path:"",component:rQ},{path:"conference",component:oQ},{path:"**",redirectTo:""}];let cQ=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e,bootstrap:[TX]});static#n=this.\u0275inj=Jn({providers:[{provide:Storage,useValue:window.localStorage}],imports:[gj,XK,sQ.forRoot(jH_configs),LW,gX.forRoot(aQ),$z,Q9,aq,r7]})}return e})();q8().bootstrapModule(cQ).catch(e=>console.error(e))},885:function(rd,z_,Xp){var L=Xp(156).default;rd.exports=function(){"use strict";var Ys=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Rt(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var an=function(s){try{return!!s()}catch{return!0}},As=!an(function(){var s=function(){}.bind();return"function"!=typeof s||s.hasOwnProperty("prototype")}),qo=As,An=Function.prototype,ac=An.call,Jb=qo&&An.bind.bind(ac,ac),Ri=qo?Jb:function(s){return function(){return ac.apply(s,arguments)}},Ds=Ri({}.isPrototypeOf),qu=function(s){return s&&s.Math==Math&&s},lr=qu("object"==typeof globalThis&&globalThis)||qu("object"==typeof window&&window)||qu("object"==typeof self&&self)||qu("object"==typeof Ys&&Ys)||function(){return this}()||Ys||Function("return this")(),Qb=Function.prototype,Zb=Qb.apply,ey=Qb.call,q_="object"==typeof Reflect&&Reflect.apply||(As?ey.bind(Zb):function(){return ey.apply(Zb,arguments)}),ty=Ri,ny=ty({}.toString),QI=ty("".slice),cc=function(s){return QI(ny(s),8,-1)},K_=cc,Jp=Ri,dc=function(s){if("Function"===K_(s))return Jp(s)},Y_="object"==typeof document&&document.all,iy={all:Y_,IS_HTMLDDA:void 0===Y_&&void 0!==Y_},O3=iy.all,tr=iy.IS_HTMLDDA?function(s){return"function"==typeof s||s===O3}:function(s){return"function"==typeof s},Qp={},Ta=!an(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),Zp=Function.prototype.call,Rr=As?Zp.bind(Zp):function(){return Zp.apply(Zp,arguments)},ry={},$_={}.propertyIsEnumerable,ux=Object.getOwnPropertyDescriptor,P3=ux&&!$_.call({1:2},1);ry.f=P3?function(s){var i=ux(this,s);return!!i&&i.enumerable}:$_;var _l,X_,Ku=function(s,i){return{enumerable:!(1&s),configurable:!(2&s),writable:!(4&s),value:i}},hx=an,px=cc,ZI=Object,ew=Ri("".split),oy=hx(function(){return!ZI("z").propertyIsEnumerable(0)})?function(s){return"String"==px(s)?ew(s,""):ZI(s)}:ZI,sy=function(s){return null==s},cn=sy,ay=TypeError,gl=function(s){if(cn(s))throw ay("Can't call method on "+s);return s},J_=oy,nr=gl,od=function(s){return J_(nr(s))},cy=tr,tw=iy.all,ur=iy.IS_HTMLDDA?function(s){return"object"==typeof s?null!==s:cy(s)||s===tw}:function(s){return"object"==typeof s?null!==s:cy(s)},Os={},Q_=Os,ef=lr,fx=tr,nw=function(s){return fx(s)?s:void 0},Eo=function(s,i){return arguments.length<2?nw(Q_[s])||nw(ef[s]):Q_[s]&&Q_[s][i]||ef[s]&&ef[s][i]},lc=typeof navigator<"u"&&String(navigator.userAgent)||"",Yu=lc,iw=lr.process,Z_=lr.Deno,rw=iw&&iw.versions||Z_&&Z_.version,eg=rw&&rw.v8;eg&&(X_=(_l=eg.split("."))[0]>0&&_l[0]<4?1:+(_l[0]+_l[1])),!X_&&Yu&&(!(_l=Yu.match(/Edge\/(\d+)/))||_l[1]>=74)&&(_l=Yu.match(/Chrome\/(\d+)/))&&(X_=+_l[1]);var El=X_,$u=El,mx=lr.String,ad=!!Object.getOwnPropertySymbols&&!an(function(){var s=Symbol();return!mx(s)||!(Object(s)instanceof Symbol)||!Symbol.sham&&$u&&$u<41}),ow=ad&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,dy=Eo,cd=tr,_x=Ds,sw=Object,Wn=ow?function(s){return"symbol"==typeof s}:function(s){var i=dy("Symbol");return cd(i)&&_x(i.prototype,sw(s))},aw=String,Xu=function(s){try{return aw(s)}catch{return"Object"}},gx=tr,Ex=Xu,bn=TypeError,Ko=function(s){if(gx(s))return s;throw bn(Ex(s)+" is not a function")},Yo=Ko,cw=sy,Si=function(s,i){var r=s[i];return cw(r)?void 0:Yo(r)},di=Rr,ly=tr,Zt=ur,M3=TypeError,uy={exports:{}},pe=lr,Ju=Object.defineProperty,lw="__core-js_shared__",uw=lr[lw]||function(s,i){try{Ju(pe,s,{value:i,configurable:!0,writable:!0})}catch{pe[s]=i}return i}(lw,{}),vx=uw;(uy.exports=function(s,i){return vx[s]||(vx[s]=void 0!==i?i:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var vl=uy.exports,x3=gl,k3=Object,bl=function(s){return k3(x3(s))},Dn=bl,bx=Ri({}.hasOwnProperty),Yt=Object.hasOwn||function(s,i){return bx(Dn(s),i)},hy=Ri,L3=0,yx=Math.random(),Ln=hy(1..toString),nt=function(s){return"Symbol("+(void 0===s?"":s)+")_"+Ln(++L3+yx,36)},ig=Yt,tf=nt,py=ad,fy=ow,yl=lr.Symbol,$s=vl("wks"),nf=fy?yl.for||yl:yl&&yl.withoutSetter||tf,li=function(s){return ig($s,s)||($s[s]=py&&ig(yl,s)?yl[s]:nf("Symbol."+s)),$s[s]},yt=Rr,dn=ur,Sx=Wn,Cx=Si,F3=TypeError,Ix=li("toPrimitive"),my=function(s,i){if(!dn(s)||Sx(s))return s;var r,a=Cx(s,Ix);if(a){if(void 0===i&&(i="default"),r=yt(a,s,i),!dn(r)||Sx(r))return r;throw F3("Can't convert object to primitive value")}return void 0===i&&(i="number"),function(s,i){var r,a;if("string"===i&&ly(r=s.toString)&&!Zt(a=di(r,s))||ly(r=s.valueOf)&&!Zt(a=di(r,s))||"string"!==i&&ly(r=s.toString)&&!Zt(a=di(r,s)))return a;throw M3("Can't convert object to primitive value")}(s,i)},$o=Wn,_y=function(s){var i=my(s,"string");return $o(i)?i:i+""},hw=ur,pw=lr.document,dd=hw(pw)&&hw(pw.createElement),fw=function(s){return dd?pw.createElement(s):{}},U3=fw,wx=!Ta&&!an(function(){return 7!=Object.defineProperty(U3("div"),"a",{get:function(){return 7}}).a}),Rx=Rr,B3=ry,Ax=Ku,j3=od,vo=_y,ct=Yt,H3=wx,Dx=Object.getOwnPropertyDescriptor;Qp.f=Ta?Dx:function(s,i){if(s=j3(s),i=vo(i),H3)try{return Dx(s,i)}catch{}if(ct(s,i))return Ax(!Rx(B3.f,s,i),s[i])};var G3=an,W3=tr,Pe=/#|\.prototype\./,rg=function(s,i){var r=og[Jn(s)];return r==mw||r!=Ox&&(W3(i)?G3(i):!!i)},Jn=rg.normalize=function(s){return String(s).replace(Pe,".").toLowerCase()},og=rg.data={},Ox=rg.NATIVE="N",mw=rg.POLYFILL="P",_w=rg,sg=Ko,ag=As,gy=dc(dc.bind),Qu=function(s,i){return sg(s),void 0===i?s:ag?gy(s,i):function(){return s.apply(i,arguments)}},Ns={},Vt=Ta&&an(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),Ey=ur,gw=String,bo=TypeError,Ps=function(s){if(Ey(s))return s;throw bo(gw(s)+" is not an object")},yn=wx,vy=Ps,De=_y,by=TypeError,rf=Object.defineProperty,Ew=Object.getOwnPropertyDescriptor,sf="enumerable",yy="configurable",af="writable";Ns.f=Ta?Vt?function(s,i,r){if(vy(s),i=De(i),vy(r),"function"==typeof s&&"prototype"===i&&"value"in r&&af in r&&!r[af]){var a=Ew(s,i);a&&a[af]&&(s[i]=r.value,r={configurable:yy in r?r[yy]:a[yy],enumerable:sf in r?r[sf]:a[sf],writable:!1})}return rf(s,i,r)}:rf:function(s,i,r){if(vy(s),i=De(i),vy(r),yn)try{return rf(s,i,r)}catch{}if("get"in r||"set"in r)throw by("Accessors not supported");return"value"in r&&(s[i]=r.value),s};var K3=Ns,Y3=Ku,Sl=Ta?function(s,i,r){return K3.f(s,i,Y3(1,r))}:function(s,i,r){return s[i]=r,s},Sy=lr,$3=q_,cf=dc,Cy=tr,cg=Qp.f,Nx=_w,Zu=Os,Px=Qu,Cl=Sl,Tl=Yt,Mx=function(s){var i=function(r,a,d){if(this instanceof i){switch(arguments.length){case 0:return new s;case 1:return new s(r);case 2:return new s(r,a)}return new s(r,a,d)}return $3(s,this,arguments)};return i.prototype=s.prototype,i},Bt=function(s,i){var r,a,d,l,h,f,_,g,v,b=s.target,y=s.global,T=s.stat,M=s.proto,O=y?Sy:T?Sy[b]:(Sy[b]||{}).prototype,D=y?Zu:Zu[b]||Cl(Zu,b,{})[b],x=D.prototype;for(l in i)a=!(r=Nx(y?l:b+(T?".":"#")+l,s.forced))&&O&&Tl(O,l),f=D[l],a&&(_=s.dontCallGetSet?(v=cg(O,l))&&v.value:O[l]),h=a&&_?_:i[l],a&&typeof f==typeof h||(g=s.bind&&a?Px(h,Sy):s.wrap&&a?Mx(h):M&&Cy(h)?cf(h):h,(s.sham||h&&h.sham||f&&f.sham)&&Cl(g,"sham",!0),Cl(D,l,g),M&&(Tl(Zu,d=b+"Prototype")||Cl(Zu,d,{}),Cl(Zu[d],l,h),s.real&&x&&(r||!x[l])&&Cl(x,l,h)))},xx=Math.ceil,be=Math.floor,vw=Math.trunc||function(s){var i=+s;return(i>0?be:xx)(i)},Te=function(s){var i=+s;return i!=i||0===i?0:vw(i)},dg=Te,Ty=Math.max,df=Math.min,bw=function(s,i){var r=dg(s);return r<0?Ty(r+i,0):df(r,i)},kx=Te,Lx=Math.min,Ia=function(s){return function(s){return s>0?Lx(kx(s),9007199254740991):0}(s.length)},Xs=od,wa=bw,ln=Ia,Xe=function(s){return function(i,r,a){var d,l=Xs(i),h=ln(l),f=wa(a,h);if(s&&r!=r){for(;h>f;)if((d=l[f++])!=d)return!0}else for(;h>f;f++)if((s||f in l)&&l[f]===r)return s||f||0;return!s&&-1}},lg={includes:Xe(!0),indexOf:Xe(!1)},Iy=lg.includes;Bt({target:"Array",proto:!0,forced:an(function(){return!Array(1).includes()})},{includes:function(s){return Iy(this,s,arguments.length>1?arguments[1]:void 0)}});var yw=Os,hc=function(s){return yw[s+"Prototype"]},lf=hc("Array").includes,Sw=ur,Cw=cc,Fx=li("match"),Ux=TypeError,Iw={};Iw[li("toStringTag")]="z";var Xo="[object z]"===String(Iw),Vx=Xo,ww=tr,ug=cc,Bx=li("toStringTag"),jx=Object,Hx="Arguments"==ug(function(){return arguments}()),ld=Vx?ug:function(s){var i,r,a;return void 0===s?"Undefined":null===s?"Null":"string"==typeof(r=function(d,l){try{return d[l]}catch{}}(i=jx(s),Bx))?r:Hx?ug(i):"Object"==(a=ug(i))&&ww(i.callee)?"Arguments":a},Gx=ld,Wx=String,pc=function(s){if("Symbol"===Gx(s))throw TypeError("Cannot convert a Symbol value to a string");return Wx(s)},Br=li("match"),zx=Bt,qx=function(s){if(function(s){var i;return Sw(s)&&(void 0!==(i=s[Fx])?!!i:"RegExp"==Cw(s))}(s))throw Ux("The method doesn't accept regular expressions");return s},ui=gl,wy=pc,yo=Ri("".indexOf);zx({target:"String",proto:!0,forced:!function(s){var i=/./;try{"/./"[s](i)}catch{try{return i[Br]=!1,"/./"[s](i)}catch{}}return!1}("includes")},{includes:function(s){return!!~yo(wy(ui(this)),wy(qx(s)),arguments.length>1?arguments[1]:void 0)}});var Lt=hc("String").includes,qi=Ds,Ar=lf,ud=Lt,hr=Array.prototype,hg=String.prototype,ye=Rt(function(s){var i=s.includes;return s===hr||qi(hr,s)&&i===hr.includes?Ar:"string"==typeof s||s===hg||qi(hg,s)&&i===hg.includes?ud:i});let uf=!0,Rw=!0;function pg(s,i,r){const a=s.match(i);return a&&a.length>=r&&parseInt(a[r],10)}function Sn(s,i,r){if(!s.RTCPeerConnection)return;const a=s.RTCPeerConnection.prototype,d=a.addEventListener;a.addEventListener=function(h,f){if(h!==i)return d.apply(this,arguments);const _=g=>{const v=r(g);v&&(f.handleEvent?f.handleEvent(v):f(v))};return this._eventMap=this._eventMap||{},this._eventMap[i]||(this._eventMap[i]=new Map),this._eventMap[i].set(f,_),d.apply(this,[h,_])};const l=a.removeEventListener;a.removeEventListener=function(h,f){if(h!==i||!this._eventMap||!this._eventMap[i])return l.apply(this,arguments);if(!this._eventMap[i].has(f))return l.apply(this,arguments);const _=this._eventMap[i].get(f);return this._eventMap[i].delete(f),0===this._eventMap[i].size&&delete this._eventMap[i],0===Object.keys(this._eventMap).length&&delete this._eventMap,l.apply(this,[h,_])},Object.defineProperty(a,"on"+i,{get(){return this["_on"+i]},set(h){this["_on"+i]&&(this.removeEventListener(i,this["_on"+i]),delete this["_on"+i]),h&&this.addEventListener(i,this["_on"+i]=h)},enumerable:!0,configurable:!0})}function Ne(s){return"boolean"!=typeof s?new Error("Argument type: "+typeof s+". Please use a boolean."):(uf=s,s?"adapter.js logging disabled":"adapter.js logging enabled")}function et(s){return"boolean"!=typeof s?new Error("Argument type: "+typeof s+". Please use a boolean."):(Rw=!s,"adapter.js deprecation warnings "+(s?"disabled":"enabled"))}function Ai(){if("object"==typeof window){if(uf)return;typeof console<"u"&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Jo(s,i){Rw&&console.warn(s+" is deprecated, please use "+i+" instead.")}function Dr(s){return"[object Object]"===Object.prototype.toString.call(s)}function Ms(s){return Dr(s)?Object.keys(s).reduce(function(i,r){const a=Dr(s[r]),d=a?Ms(s[r]):s[r],l=a&&!Object.keys(d).length;return void 0===d||l?i:Object.assign(i,{[r]:d})},{}):s}function hd(s,i,r){i&&!r.has(i.id)&&(r.set(i.id,i),Object.keys(i).forEach(a=>{a.endsWith("Id")?hd(s,s.get(i[a]),r):a.endsWith("Ids")&&i[a].forEach(d=>{hd(s,s.get(d),r)})}))}function zn(s,i,r){const a=r?"outbound-rtp":"inbound-rtp",d=new Map;if(null===i)return d;const l=[];return s.forEach(h=>{"track"===h.type&&h.trackIdentifier===i.id&&l.push(h)}),l.forEach(h=>{s.forEach(f=>{f.type===a&&f.trackId===h.id&&hd(s,f,d)})}),d}const jr=Ai;function Ra(s,i){const r=s&&s.navigator;if(!r.mediaDevices)return;const a=function(h){if("object"!=typeof h||h.mandatory||h.optional)return h;const f={};return Object.keys(h).forEach(_=>{if("require"===_||"advanced"===_||"mediaSource"===_)return;const g="object"==typeof h[_]?h[_]:{ideal:h[_]};void 0!==g.exact&&"number"==typeof g.exact&&(g.min=g.max=g.exact);const v=function(b,y){return b?b+y.charAt(0).toUpperCase()+y.slice(1):"deviceId"===y?"sourceId":y};if(void 0!==g.ideal){f.optional=f.optional||[];let b={};"number"==typeof g.ideal?(b[v("min",_)]=g.ideal,f.optional.push(b),b={},b[v("max",_)]=g.ideal,f.optional.push(b)):(b[v("",_)]=g.ideal,f.optional.push(b))}void 0!==g.exact&&"number"!=typeof g.exact?(f.mandatory=f.mandatory||{},f.mandatory[v("",_)]=g.exact):["min","max"].forEach(b=>{void 0!==g[b]&&(f.mandatory=f.mandatory||{},f.mandatory[v(b,_)]=g[b])})}),h.advanced&&(f.optional=(f.optional||[]).concat(h.advanced)),f},d=function(h,f){if(i.version>=61)return f(h);if((h=JSON.parse(JSON.stringify(h)))&&"object"==typeof h.audio){const _=function(g,v,b){v in g&&!(b in g)&&(g[b]=g[v],delete g[v])};_((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),_(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=a(h.audio)}if(h&&"object"==typeof h.video){let _=h.video.facingMode;_=_&&("object"==typeof _?_:{ideal:_});const g=i.version<66;if(_&&("user"===_.exact||"environment"===_.exact||"user"===_.ideal||"environment"===_.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||g)){let v;if(delete h.video.facingMode,"environment"===_.exact||"environment"===_.ideal?v=["back","rear"]:"user"!==_.exact&&"user"!==_.ideal||(v=["front"]),v)return r.mediaDevices.enumerateDevices().then(b=>{let y=(b=b.filter(T=>"videoinput"===T.kind)).find(T=>v.some(M=>T.label.toLowerCase().includes(M)));return!y&&b.length&&v.includes("back")&&(y=b[b.length-1]),y&&(h.video.deviceId=_.exact?{exact:y.deviceId}:{ideal:y.deviceId}),h.video=a(h.video),jr("chrome: "+JSON.stringify(h)),f(h)})}h.video=a(h.video)}return jr("chrome: "+JSON.stringify(h)),f(h)},l=function(h){return i.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=function(h,f,_){d(h,g=>{r.webkitGetUserMedia(g,f,v=>{_&&_(l(v))})})}.bind(r),r.mediaDevices.getUserMedia){const h=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(f){return d(f,_=>h(_).then(g=>{if(_.audio&&!g.getAudioTracks().length||_.video&&!g.getVideoTracks().length)throw g.getTracks().forEach(v=>{v.stop()}),new DOMException("","NotFoundError");return g},g=>Promise.reject(l(g))))}}}function St(s){s.MediaStream=s.MediaStream||s.webkitMediaStream}function eh(s){if("object"==typeof s&&s.RTCPeerConnection&&!("ontrack"in s.RTCPeerConnection.prototype)){Object.defineProperty(s.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const i=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",a=>{let d;d=s.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.track.id):{track:a.track};const l=new Event("track");l.track=a.track,l.receiver=d,l.transceiver={receiver:d},l.streams=[r.stream],this.dispatchEvent(l)}),r.stream.getTracks().forEach(a=>{let d;d=s.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.id):{track:a};const l=new Event("track");l.track=a,l.receiver=d,l.transceiver={receiver:d},l.streams=[r.stream],this.dispatchEvent(l)})},this.addEventListener("addstream",this._ontrackpoly)),i.apply(this,arguments)}}else Sn(s,"track",i=>(i.transceiver||Object.defineProperty(i,"transceiver",{value:{receiver:i.receiver}}),i))}function Ry(s){if("object"==typeof s&&s.RTCPeerConnection&&!("getSenders"in s.RTCPeerConnection.prototype)&&"createDTMFSender"in s.RTCPeerConnection.prototype){const i=function(d,l){return{track:l,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===l.kind?d.createDTMFSender(l):null),this._dtmf},_pc:d}};if(!s.RTCPeerConnection.prototype.getSenders){s.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const d=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(h,f){let _=d.apply(this,arguments);return _||(_=i(this,h),this._senders.push(_)),_};const l=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(h){l.apply(this,arguments);const f=this._senders.indexOf(h);-1!==f&&this._senders.splice(f,1)}}const r=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(d){this._senders=this._senders||[],r.apply(this,[d]),d.getTracks().forEach(l=>{this._senders.push(i(this,l))})};const a=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(d){this._senders=this._senders||[],a.apply(this,[d]),d.getTracks().forEach(l=>{const h=this._senders.find(f=>f.track===l);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if("object"==typeof s&&s.RTCPeerConnection&&"getSenders"in s.RTCPeerConnection.prototype&&"createDTMFSender"in s.RTCPeerConnection.prototype&&s.RTCRtpSender&&!("dtmf"in s.RTCRtpSender.prototype)){const i=s.RTCPeerConnection.prototype.getSenders;s.RTCPeerConnection.prototype.getSenders=function(){const r=i.apply(this,[]);return r.forEach(a=>a._pc=this),r},Object.defineProperty(s.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}}function Il(s){if(!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[r,a,d]=arguments;if(arguments.length>0&&"function"==typeof r)return i.apply(this,arguments);if(0===i.length&&(0===arguments.length||"function"!=typeof r))return i.apply(this,[]);const l=function(f){const _={};return f.result().forEach(g=>{const v={id:g.id,timestamp:g.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[g.type]||g.type};g.names().forEach(b=>{v[b]=g.stat(b)}),_[v.id]=v}),_},h=function(f){return new Map(Object.keys(f).map(_=>[_,f[_]]))};return arguments.length>=2?i.apply(this,[function(_){a(h(l(_)))},r]):new Promise((f,_)=>{i.apply(this,[function(g){f(h(l(g)))},_])}).then(a,d)}}function fi(s){if(!("object"==typeof s&&s.RTCPeerConnection&&s.RTCRtpSender&&s.RTCRtpReceiver))return;if(!("getStats"in s.RTCRtpSender.prototype)){const r=s.RTCPeerConnection.prototype.getSenders;r&&(s.RTCPeerConnection.prototype.getSenders=function(){const d=r.apply(this,[]);return d.forEach(l=>l._pc=this),d});const a=s.RTCPeerConnection.prototype.addTrack;a&&(s.RTCPeerConnection.prototype.addTrack=function(){const d=a.apply(this,arguments);return d._pc=this,d}),s.RTCRtpSender.prototype.getStats=function(){const d=this;return this._pc.getStats().then(l=>zn(l,d.track,!0))}}if(!("getStats"in s.RTCRtpReceiver.prototype)){const r=s.RTCPeerConnection.prototype.getReceivers;r&&(s.RTCPeerConnection.prototype.getReceivers=function(){const a=r.apply(this,[]);return a.forEach(d=>d._pc=this),a}),Sn(s,"track",a=>(a.receiver._pc=a.srcElement,a)),s.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(d=>zn(d,a.track,!1))}}if(!("getStats"in s.RTCRtpSender.prototype)||!("getStats"in s.RTCRtpReceiver.prototype))return;const i=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof s.MediaStreamTrack){const r=arguments[0];let a,d,l;return this.getSenders().forEach(h=>{h.track===r&&(a?l=!0:a=h)}),this.getReceivers().forEach(h=>(h.track===r&&(d?l=!0:d=h),h.track===r)),l||a&&d?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():d?d.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}function th(s){s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(l=>this._shimmedLocalStreams[l][0])};const i=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(l,h){if(!h)return i.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const f=i.apply(this,arguments);return this._shimmedLocalStreams[h.id]?-1===this._shimmedLocalStreams[h.id].indexOf(f)&&this._shimmedLocalStreams[h.id].push(f):this._shimmedLocalStreams[h.id]=[h,f],f};const r=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(l){this._shimmedLocalStreams=this._shimmedLocalStreams||{},l.getTracks().forEach(_=>{if(this.getSenders().find(g=>g.track===_))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();r.apply(this,arguments);const f=this.getSenders().filter(_=>-1===h.indexOf(_));this._shimmedLocalStreams[l.id]=[l].concat(f)};const a=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[l.id],a.apply(this,arguments)};const d=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},l&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const f=this._shimmedLocalStreams[h].indexOf(l);-1!==f&&this._shimmedLocalStreams[h].splice(f,1),1===this._shimmedLocalStreams[h].length&&delete this._shimmedLocalStreams[h]}),d.apply(this,arguments)}}function wl(s,i){if(!s.RTCPeerConnection)return;if(s.RTCPeerConnection.prototype.addTrack&&i.version>=65)return th(s);const r=s.RTCPeerConnection.prototype.getLocalStreams;s.RTCPeerConnection.prototype.getLocalStreams=function(){const _=r.apply(this);return this._reverseStreams=this._reverseStreams||{},_.map(g=>this._reverseStreams[g.id])};const a=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(_){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},_.getTracks().forEach(g=>{if(this.getSenders().find(v=>v.track===g))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[_.id]){const g=new s.MediaStream(_.getTracks());this._streams[_.id]=g,this._reverseStreams[g.id]=_,_=g}a.apply(this,[_])};const d=s.RTCPeerConnection.prototype.removeStream;function l(_,g){let v=g.sdp;return Object.keys(_._reverseStreams||[]).forEach(b=>{const y=_._reverseStreams[b];v=v.replace(new RegExp(_._streams[y.id].id,"g"),y.id)}),new RTCSessionDescription({type:g.type,sdp:v})}s.RTCPeerConnection.prototype.removeStream=function(_){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.apply(this,[this._streams[_.id]||_]),delete this._reverseStreams[this._streams[_.id]?this._streams[_.id].id:_.id],delete this._streams[_.id]},s.RTCPeerConnection.prototype.addTrack=function(_,g){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const v=[].slice.call(arguments,1);if(1!==v.length||!v[0].getTracks().find(y=>y===_))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(y=>y.track===_))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const b=this._streams[g.id];if(b)b.addTrack(_),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const y=new s.MediaStream([_]);this._streams[g.id]=y,this._reverseStreams[y.id]=g,this.addStream(y)}return this.getSenders().find(y=>y.track===_)},["createOffer","createAnswer"].forEach(function(_){const g=s.RTCPeerConnection.prototype[_],v={[_](){const b=arguments;return arguments.length&&"function"==typeof arguments[0]?g.apply(this,[y=>{const T=l(this,y);b[0].apply(null,[T])},y=>{b[1]&&b[1].apply(null,y)},arguments[2]]):g.apply(this,arguments).then(y=>l(this,y))}};s.RTCPeerConnection.prototype[_]=v[_]});const h=s.RTCPeerConnection.prototype.setLocalDescription;s.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(_,g){let v=g.sdp;return Object.keys(_._reverseStreams||[]).forEach(b=>{const y=_._reverseStreams[b],T=_._streams[y.id];v=v.replace(new RegExp(y.id,"g"),T.id)}),new RTCSessionDescription({type:g.type,sdp:v})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const f=Object.getOwnPropertyDescriptor(s.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(s.RTCPeerConnection.prototype,"localDescription",{get(){const _=f.get.apply(this);return""===_.type?_:l(this,_)}}),s.RTCPeerConnection.prototype.removeTrack=function(_){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!_._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(_._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let g;this._streams=this._streams||{},Object.keys(this._streams).forEach(v=>{this._streams[v].getTracks().find(b=>_.track===b)&&(g=this._streams[v])}),g&&(1===g.getTracks().length?this.removeStream(this._reverseStreams[g.id]):g.removeTrack(_.track),this.dispatchEvent(new Event("negotiationneeded")))}}function xs(s,i){!s.RTCPeerConnection&&s.webkitRTCPeerConnection&&(s.RTCPeerConnection=s.webkitRTCPeerConnection),s.RTCPeerConnection&&i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const a=s.RTCPeerConnection.prototype[r],d={[r](){return arguments[0]=new("addIceCandidate"===r?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};s.RTCPeerConnection.prototype[r]=d[r]})}function nh(s,i){Sn(s,"negotiationneeded",r=>{const a=r.target;if(!(i.version<72||a.getConfiguration&&"plan-b"===a.getConfiguration().sdpSemantics)||"stable"===a.signalingState)return r})}var Ay=Object.freeze({__proto__:null,fixNegotiationNeeded:nh,shimAddTrackRemoveTrack:wl,shimAddTrackRemoveTrackWithNative:th,shimGetDisplayMedia:function(s,i){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&("function"==typeof i?s.navigator.mediaDevices.getDisplayMedia=function(r){return i(r).then(a=>{const d=r.video&&r.video.width,l=r.video&&r.video.height;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:r.video&&r.video.frameRate||3}},d&&(r.video.mandatory.maxWidth=d),l&&(r.video.mandatory.maxHeight=l),s.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Ry,shimGetStats:Il,shimGetUserMedia:Ra,shimMediaStream:St,shimOnTrack:eh,shimPeerConnection:xs,shimSenderReceiverGetStats:fi});function fc(s,i){const r=s&&s.navigator,a=s&&s.MediaStreamTrack;if(r.getUserMedia=function(d,l,h){Jo("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(d).then(l,h)},!(i.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const d=function(h,f,_){f in h&&!(_ in h)&&(h[_]=h[f],delete h[f])},l=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(h){return"object"==typeof h&&"object"==typeof h.audio&&(h=JSON.parse(JSON.stringify(h)),d(h.audio,"autoGainControl","mozAutoGainControl"),d(h.audio,"noiseSuppression","mozNoiseSuppression")),l(h)},a&&a.prototype.getSettings){const h=a.prototype.getSettings;a.prototype.getSettings=function(){const f=h.apply(this,arguments);return d(f,"mozAutoGainControl","autoGainControl"),d(f,"mozNoiseSuppression","noiseSuppression"),f}}if(a&&a.prototype.applyConstraints){const h=a.prototype.applyConstraints;a.prototype.applyConstraints=function(f){return"audio"===this.kind&&"object"==typeof f&&(f=JSON.parse(JSON.stringify(f)),d(f,"autoGainControl","mozAutoGainControl"),d(f,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[f])}}}}function hf(s){"object"==typeof s&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function mc(s,i){if("object"!=typeof s||!s.RTCPeerConnection&&!s.mozRTCPeerConnection)return;!s.RTCPeerConnection&&s.mozRTCPeerConnection&&(s.RTCPeerConnection=s.mozRTCPeerConnection),i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(d){const l=s.RTCPeerConnection.prototype[d],h={[d](){return arguments[0]=new("addIceCandidate"===d?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};s.RTCPeerConnection.prototype[d]=h[d]});const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[d,l,h]=arguments;return a.apply(this,[d||null]).then(f=>{if(i.version<53&&!l)try{f.forEach(_=>{_.type=r[_.type]||_.type})}catch(_){if("TypeError"!==_.name)throw _;f.forEach((g,v)=>{f.set(v,Object.assign({},g,{type:r[g.type]||g.type}))})}return f}).then(l,h)}}function mt(s){if("object"!=typeof s||!s.RTCPeerConnection||!s.RTCRtpSender||s.RTCRtpSender&&"getStats"in s.RTCRtpSender.prototype)return;const i=s.RTCPeerConnection.prototype.getSenders;i&&(s.RTCPeerConnection.prototype.getSenders=function(){const a=i.apply(this,[]);return a.forEach(d=>d._pc=this),a});const r=s.RTCPeerConnection.prototype.addTrack;r&&(s.RTCPeerConnection.prototype.addTrack=function(){const a=r.apply(this,arguments);return a._pc=this,a}),s.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function fg(s){if("object"!=typeof s||!s.RTCPeerConnection||!s.RTCRtpSender||s.RTCRtpSender&&"getStats"in s.RTCRtpReceiver.prototype)return;const i=s.RTCPeerConnection.prototype.getReceivers;i&&(s.RTCPeerConnection.prototype.getReceivers=function(){const r=i.apply(this,[]);return r.forEach(a=>a._pc=this),r}),Sn(s,"track",r=>(r.receiver._pc=r.srcElement,r)),s.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function ih(s){s.RTCPeerConnection&&!("removeStream"in s.RTCPeerConnection.prototype)&&(s.RTCPeerConnection.prototype.removeStream=function(i){Jo("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&i.getTracks().includes(r.track)&&this.removeTrack(r)})})}function Js(s){s.DataChannel&&!s.RTCDataChannel&&(s.RTCDataChannel=s.DataChannel)}function pf(s){if("object"!=typeof s||!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype.addTransceiver;i&&(s.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;void 0===r&&(r=[]),r=[...r];const a=r.length>0;a&&r.forEach(l=>{if("rid"in l&&!/^[a-z0-9]{0,16}$/i.test(l.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in l&&!(parseFloat(l.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in l&&!(parseFloat(l.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const d=i.apply(this,arguments);if(a){const{sender:l}=d,h=l.getParameters();(!("encodings"in h)||1===h.encodings.length&&0===Object.keys(h.encodings[0]).length)&&(h.encodings=r,l.sendEncodings=r,this.setParametersPromises.push(l.setParameters(h).then(()=>{delete l.sendEncodings}).catch(()=>{delete l.sendEncodings})))}return d})}function Rl(s){if("object"!=typeof s||!s.RTCRtpSender)return;const i=s.RTCRtpSender.prototype.getParameters;i&&(s.RTCRtpSender.prototype.getParameters=function(){const r=i.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function Di(s){if("object"!=typeof s||!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}function mg(s){if("object"!=typeof s||!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype.createAnswer;s.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}var Or=Object.freeze({__proto__:null,shimAddTransceiver:pf,shimCreateAnswer:mg,shimCreateOffer:Di,shimGetDisplayMedia:function(s,i){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&(s.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,Promise.reject(a)}return!0===r.video?r.video={mediaSource:i}:r.video.mediaSource=i,s.navigator.mediaDevices.getUserMedia(r)})},shimGetParameters:Rl,shimGetUserMedia:fc,shimOnTrack:hf,shimPeerConnection:mc,shimRTCDataChannel:Js,shimReceiverGetStats:fg,shimRemoveStream:ih,shimSenderGetStats:mt});function Nr(s){if("object"==typeof s&&s.RTCPeerConnection){if("getLocalStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in s.RTCPeerConnection.prototype)){const i=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(a=>i.call(this,a,r)),r.getVideoTracks().forEach(a=>i.call(this,a,r))},s.RTCPeerConnection.prototype.addTrack=function(r,...a){return a&&a.forEach(d=>{this._localStreams?this._localStreams.includes(d)||this._localStreams.push(d):this._localStreams=[d]}),i.apply(this,arguments)}}"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(i){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(i);if(-1===r)return;this._localStreams.splice(r,1);const a=i.getTracks();this.getSenders().forEach(d=>{a.includes(d.track)&&this.removeTrack(d)})})}}function _g(s){if("object"==typeof s&&s.RTCPeerConnection&&("getRemoteStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in s.RTCPeerConnection.prototype))){Object.defineProperty(s.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(d=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(d))return;this._remoteStreams.push(d);const l=new Event("addstream");l.stream=d,this.dispatchEvent(l)})})}});const i=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(d=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(d)>=0)return;r._remoteStreams.push(d);const l=new Event("addstream");l.stream=d,r.dispatchEvent(l)})}),i.apply(r,arguments)}}}function pd(s){if("object"!=typeof s||!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype,r=i.createOffer,a=i.createAnswer,d=i.setLocalDescription,l=i.setRemoteDescription,h=i.addIceCandidate;i.createOffer=function(_,g){const b=r.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return g?(b.then(_,g),Promise.resolve()):b},i.createAnswer=function(_,g){const b=a.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return g?(b.then(_,g),Promise.resolve()):b};let f=function(_,g,v){const b=d.apply(this,[_]);return v?(b.then(g,v),Promise.resolve()):b};i.setLocalDescription=f,f=function(_,g,v){const b=l.apply(this,[_]);return v?(b.then(g,v),Promise.resolve()):b},i.setRemoteDescription=f,f=function(_,g,v){const b=h.apply(this,[_]);return v?(b.then(g,v),Promise.resolve()):b},i.addIceCandidate=f}function ff(s){const i=s&&s.navigator;if(i.mediaDevices&&i.mediaDevices.getUserMedia){const r=i.mediaDevices,a=r.getUserMedia.bind(r);i.mediaDevices.getUserMedia=d=>a(ks(d))}!i.getUserMedia&&i.mediaDevices&&i.mediaDevices.getUserMedia&&(i.getUserMedia=function(r,a,d){i.mediaDevices.getUserMedia(r).then(a,d)}.bind(i))}function ks(s){return s&&void 0!==s.video?Object.assign({},s,{video:Ms(s.video)}):s}function gg(s){if(!s.RTCPeerConnection)return;const i=s.RTCPeerConnection;s.RTCPeerConnection=function(r,a){if(r&&r.iceServers){const d=[];for(let l=0;l<r.iceServers.length;l++){let h=r.iceServers[l];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(Jo("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,d.push(h)):d.push(r.iceServers[l])}r.iceServers=d}return new i(r,a)},s.RTCPeerConnection.prototype=i.prototype,"generateCertificate"in i&&Object.defineProperty(s.RTCPeerConnection,"generateCertificate",{get:()=>i.generateCertificate})}function Aw(s){"object"==typeof s&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Dw(s){const i=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(r){if(r){void 0!==r.offerToReceiveAudio&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const a=this.getTransceivers().find(l=>"audio"===l.receiver.track.kind);!1===r.offerToReceiveAudio&&a?"sendrecv"===a.direction?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":"recvonly"===a.direction&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):!0!==r.offerToReceiveAudio||a||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==r.offerToReceiveVideo&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const d=this.getTransceivers().find(l=>"video"===l.receiver.track.kind);!1===r.offerToReceiveVideo&&d?"sendrecv"===d.direction?d.setDirection?d.setDirection("sendonly"):d.direction="sendonly":"recvonly"===d.direction&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive"):!0!==r.offerToReceiveVideo||d||this.addTransceiver("video",{direction:"recvonly"})}return i.apply(this,arguments)}}function Eg(s){"object"!=typeof s||s.AudioContext||(s.AudioContext=s.webkitAudioContext)}var Dy=Object.freeze({__proto__:null,shimAudioContext:Eg,shimCallbacksAPI:pd,shimConstraints:ks,shimCreateOfferLegacy:Dw,shimGetUserMedia:ff,shimLocalStreamsAPI:Nr,shimRTCIceServerUrls:gg,shimRemoteStreamsAPI:_g,shimTrackEventTransceiver:Aw}),Ow={exports:{}};!function(s){const i={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};i.localCName=i.generateIdentifier(),i.splitLines=function(r){return r.trim().split("\n").map(a=>a.trim())},i.splitSections=function(r){return r.split("\nm=").map((a,d)=>(d>0?"m="+a:a).trim()+"\r\n")},i.getDescription=function(r){const a=i.splitSections(r);return a&&a[0]},i.getMediaSections=function(r){const a=i.splitSections(r);return a.shift(),a},i.matchPrefix=function(r,a){return i.splitLines(r).filter(d=>0===d.indexOf(a))},i.parseCandidate=function(r){let a;a=0===r.indexOf("a=candidate:")?r.substring(12).split(" "):r.substring(10).split(" ");const d={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let l=8;l<a.length;l+=2)switch(a[l]){case"raddr":d.relatedAddress=a[l+1];break;case"rport":d.relatedPort=parseInt(a[l+1],10);break;case"tcptype":d.tcpType=a[l+1];break;case"ufrag":d.ufrag=a[l+1],d.usernameFragment=a[l+1];break;default:void 0===d[a[l]]&&(d[a[l]]=a[l+1])}return d},i.writeCandidate=function(r){const a=[];a.push(r.foundation);const d=r.component;a.push("rtp"===d?1:"rtcp"===d?2:d),a.push(r.protocol.toUpperCase()),a.push(r.priority),a.push(r.address||r.ip),a.push(r.port);const l=r.type;return a.push("typ"),a.push(l),"host"!==l&&r.relatedAddress&&r.relatedPort&&(a.push("raddr"),a.push(r.relatedAddress),a.push("rport"),a.push(r.relatedPort)),r.tcpType&&"tcp"===r.protocol.toLowerCase()&&(a.push("tcptype"),a.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(a.push("ufrag"),a.push(r.usernameFragment||r.ufrag)),"candidate:"+a.join(" ")},i.parseIceOptions=function(r){return r.substring(14).split(" ")},i.parseRtpMap=function(r){let a=r.substring(9).split(" ");const d={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),d.name=a[0],d.clockRate=parseInt(a[1],10),d.channels=3===a.length?parseInt(a[2],10):1,d.numChannels=d.channels,d},i.writeRtpMap=function(r){let a=r.payloadType;void 0!==r.preferredPayloadType&&(a=r.preferredPayloadType);const d=r.channels||r.numChannels||1;return"a=rtpmap:"+a+" "+r.name+"/"+r.clockRate+(1!==d?"/"+d:"")+"\r\n"},i.parseExtmap=function(r){const a=r.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},i.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&"sendrecv"!==r.direction?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+"\r\n"},i.parseFmtp=function(r){const a={};let d;const l=r.substring(r.indexOf(" ")+1).split(";");for(let h=0;h<l.length;h++)d=l[h].trim().split("="),a[d[0].trim()]=d[1];return a},i.writeFmtp=function(r){let a="",d=r.payloadType;if(void 0!==r.preferredPayloadType&&(d=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){const l=[];Object.keys(r.parameters).forEach(h=>{l.push(void 0!==r.parameters[h]?h+"="+r.parameters[h]:h)}),a+="a=fmtp:"+d+" "+l.join(";")+"\r\n"}return a},i.parseRtcpFb=function(r){const a=r.substring(r.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},i.writeRtcpFb=function(r){let a="",d=r.payloadType;return void 0!==r.preferredPayloadType&&(d=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(l=>{a+="a=rtcp-fb:"+d+" "+l.type+(l.parameter&&l.parameter.length?" "+l.parameter:"")+"\r\n"}),a},i.parseSsrcMedia=function(r){const a=r.indexOf(" "),d={ssrc:parseInt(r.substring(7,a),10)},l=r.indexOf(":",a);return l>-1?(d.attribute=r.substring(a+1,l),d.value=r.substring(l+1)):d.attribute=r.substring(a+1),d},i.parseSsrcGroup=function(r){const a=r.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(d=>parseInt(d,10))}},i.getMid=function(r){const a=i.matchPrefix(r,"a=mid:")[0];if(a)return a.substring(6)},i.parseFingerprint=function(r){const a=r.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},i.getDtlsParameters=function(r,a){return{role:"auto",fingerprints:i.matchPrefix(r+a,"a=fingerprint:").map(i.parseFingerprint)}},i.writeDtlsParameters=function(r,a){let d="a=setup:"+a+"\r\n";return r.fingerprints.forEach(l=>{d+="a=fingerprint:"+l.algorithm+" "+l.value+"\r\n"}),d},i.parseCryptoLine=function(r){const a=r.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},i.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+("object"==typeof r.keyParams?i.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+"\r\n"},i.parseCryptoKeyParams=function(r){if(0!==r.indexOf("inline:"))return null;const a=r.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},i.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},i.getCryptoParameters=function(r,a){return i.matchPrefix(r+a,"a=crypto:").map(i.parseCryptoLine)},i.getIceParameters=function(r,a){const d=i.matchPrefix(r+a,"a=ice-ufrag:")[0],l=i.matchPrefix(r+a,"a=ice-pwd:")[0];return d&&l?{usernameFragment:d.substring(12),password:l.substring(10)}:null},i.writeIceParameters=function(r){let a="a=ice-ufrag:"+r.usernameFragment+"\r\na=ice-pwd:"+r.password+"\r\n";return r.iceLite&&(a+="a=ice-lite\r\n"),a},i.parseRtpParameters=function(r){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},d=i.splitLines(r)[0].split(" ");a.profile=d[2];for(let h=3;h<d.length;h++){const f=d[h],_=i.matchPrefix(r,"a=rtpmap:"+f+" ")[0];if(_){const g=i.parseRtpMap(_),v=i.matchPrefix(r,"a=fmtp:"+f+" ");switch(g.parameters=v.length?i.parseFmtp(v[0]):{},g.rtcpFeedback=i.matchPrefix(r,"a=rtcp-fb:"+f+" ").map(i.parseRtcpFb),a.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(g.name.toUpperCase())}}}i.matchPrefix(r,"a=extmap:").forEach(h=>{a.headerExtensions.push(i.parseExtmap(h))});const l=i.matchPrefix(r,"a=rtcp-fb:* ").map(i.parseRtcpFb);return a.codecs.forEach(h=>{l.forEach(f=>{h.rtcpFeedback.find(_=>_.type===f.type&&_.parameter===f.parameter)||h.rtcpFeedback.push(f)})}),a},i.writeRtpDescription=function(r,a){let d="";d+="m="+r+" ",d+=a.codecs.length>0?"9":"0",d+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",d+=a.codecs.map(h=>void 0!==h.preferredPayloadType?h.preferredPayloadType:h.payloadType).join(" ")+"\r\n",d+="c=IN IP4 0.0.0.0\r\n",d+="a=rtcp:9 IN IP4 0.0.0.0\r\n",a.codecs.forEach(h=>{d+=i.writeRtpMap(h),d+=i.writeFmtp(h),d+=i.writeRtcpFb(h)});let l=0;return a.codecs.forEach(h=>{h.maxptime>l&&(l=h.maxptime)}),l>0&&(d+="a=maxptime:"+l+"\r\n"),a.headerExtensions&&a.headerExtensions.forEach(h=>{d+=i.writeExtmap(h)}),d},i.parseRtpEncodingParameters=function(r){const a=[],d=i.parseRtpParameters(r),l=-1!==d.fecMechanisms.indexOf("RED"),h=-1!==d.fecMechanisms.indexOf("ULPFEC"),f=i.matchPrefix(r,"a=ssrc:").map(y=>i.parseSsrcMedia(y)).filter(y=>"cname"===y.attribute),_=f.length>0&&f[0].ssrc;let g;const v=i.matchPrefix(r,"a=ssrc-group:FID").map(y=>y.substring(17).split(" ").map(T=>parseInt(T,10)));v.length>0&&v[0].length>1&&v[0][0]===_&&(g=v[0][1]),d.codecs.forEach(y=>{if("RTX"===y.name.toUpperCase()&&y.parameters.apt){let T={ssrc:_,codecPayloadType:parseInt(y.parameters.apt,10)};_&&g&&(T.rtx={ssrc:g}),a.push(T),l&&(T=JSON.parse(JSON.stringify(T)),T.fec={ssrc:_,mechanism:h?"red+ulpfec":"red"},a.push(T))}}),0===a.length&&_&&a.push({ssrc:_});let b=i.matchPrefix(r,"b=");return b.length&&(b=0===b[0].indexOf("b=TIAS:")?parseInt(b[0].substring(7),10):0===b[0].indexOf("b=AS:")?1e3*parseInt(b[0].substring(5),10)*.95-16e3:void 0,a.forEach(y=>{y.maxBitrate=b})),a},i.parseRtcpParameters=function(r){const a={},d=i.matchPrefix(r,"a=ssrc:").map(f=>i.parseSsrcMedia(f)).filter(f=>"cname"===f.attribute)[0];d&&(a.cname=d.value,a.ssrc=d.ssrc);const l=i.matchPrefix(r,"a=rtcp-rsize");a.reducedSize=l.length>0,a.compound=0===l.length;const h=i.matchPrefix(r,"a=rtcp-mux");return a.mux=h.length>0,a},i.writeRtcpParameters=function(r){let a="";return r.reducedSize&&(a+="a=rtcp-rsize\r\n"),r.mux&&(a+="a=rtcp-mux\r\n"),void 0!==r.ssrc&&r.cname&&(a+="a=ssrc:"+r.ssrc+" cname:"+r.cname+"\r\n"),a},i.parseMsid=function(r){let a;const d=i.matchPrefix(r,"a=msid:");if(1===d.length)return a=d[0].substring(7).split(" "),{stream:a[0],track:a[1]};const l=i.matchPrefix(r,"a=ssrc:").map(h=>i.parseSsrcMedia(h)).filter(h=>"msid"===h.attribute);return l.length>0?(a=l[0].value.split(" "),{stream:a[0],track:a[1]}):void 0},i.parseSctpDescription=function(r){const a=i.parseMLine(r),d=i.matchPrefix(r,"a=max-message-size:");let l;d.length>0&&(l=parseInt(d[0].substring(19),10)),isNaN(l)&&(l=65536);const h=i.matchPrefix(r,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:a.fmt,maxMessageSize:l};const f=i.matchPrefix(r,"a=sctpmap:");if(f.length>0){const _=f[0].substring(10).split(" ");return{port:parseInt(_[0],10),protocol:_[1],maxMessageSize:l}}},i.writeSctpDescription=function(r,a){let d=[];return d="DTLS/SCTP"!==r.protocol?["m="+r.kind+" 9 "+r.protocol+" "+a.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+a.port+"\r\n"]:["m="+r.kind+" 9 "+r.protocol+" "+a.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+a.port+" "+a.protocol+" 65535\r\n"],void 0!==a.maxMessageSize&&d.push("a=max-message-size:"+a.maxMessageSize+"\r\n"),d.join("")},i.generateSessionId=function(){return Math.random().toString().substr(2,22)},i.writeSessionBoilerplate=function(r,a,d){let l;const h=void 0!==a?a:2;return l=r||i.generateSessionId(),"v=0\r\no="+(d||"thisisadapterortc")+" "+l+" "+h+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},i.getDirection=function(r,a){const d=i.splitLines(r);for(let l=0;l<d.length;l++)switch(d[l]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return d[l].substring(2)}return a?i.getDirection(a):"sendrecv"},i.getKind=function(r){return i.splitLines(r)[0].split(" ")[0].substring(2)},i.isRejected=function(r){return"0"===r.split(" ",2)[1]},i.parseMLine=function(r){const a=i.splitLines(r)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},i.parseOLine=function(r){const a=i.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},i.isValidSDP=function(r){if("string"!=typeof r||0===r.length)return!1;const a=i.splitLines(r);for(let d=0;d<a.length;d++)if(a[d].length<2||"="!==a[d].charAt(1))return!1;return!0},s.exports=i}(Ow);var vg=Ow.exports,mf=Rt(vg),X3=function zu(s,i){return i.forEach(function(r){r&&"string"!=typeof r&&!Array.isArray(r)&&Object.keys(r).forEach(function(a){if("default"!==a&&!(a in s)){var d=Object.getOwnPropertyDescriptor(r,a);Object.defineProperty(s,a,d.get?d:{enumerable:!0,get:function(){return r[a]}})}})}),Object.freeze(s)}({__proto__:null,default:mf},[vg]);function Oy(s){if(!s.RTCIceCandidate||s.RTCIceCandidate&&"foundation"in s.RTCIceCandidate.prototype)return;const i=s.RTCIceCandidate;s.RTCIceCandidate=function(r){if("object"==typeof r&&r.candidate&&0===r.candidate.indexOf("a=")&&((r=JSON.parse(JSON.stringify(r))).candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){const a=new i(r),d=mf.parseCandidate(r.candidate),l=Object.assign(a,d);return l.toJSON=function(){return{candidate:l.candidate,sdpMid:l.sdpMid,sdpMLineIndex:l.sdpMLineIndex,usernameFragment:l.usernameFragment}},l}return new i(r)},s.RTCIceCandidate.prototype=i.prototype,Sn(s,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new s.RTCIceCandidate(r.candidate),writable:"false"}),r))}function Nw(s){!s.RTCIceCandidate||s.RTCIceCandidate&&"relayProtocol"in s.RTCIceCandidate.prototype||Sn(s,"icecandidate",i=>{if(i.candidate){const r=mf.parseCandidate(i.candidate.candidate);"relay"===r.type&&(i.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return i})}function Ny(s,i){if(!s.RTCPeerConnection)return;"sctp"in s.RTCPeerConnection.prototype||Object.defineProperty(s.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const h=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===i.browser&&i.version>=76){const{sdpSemantics:f}=this.getConfiguration();"plan-b"===f&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(f){if(!f||!f.sdp)return!1;const _=mf.splitSections(f.sdp);return _.shift(),_.some(g=>{const v=mf.parseMLine(g);return v&&"application"===v.kind&&-1!==v.protocol.indexOf("SCTP")})}(arguments[0])){const f=function(f){const _=f.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===_||_.length<2)return-1;const g=parseInt(_[1],10);return g!=g?-1:g}(arguments[0]),_=function(f){let _=65536;return"firefox"===i.browser&&(_=i.version<57?-1===f?16384:2147483637:i.version<60?57===i.version?65535:65536:2147483637),_}(f),g=function(f,_){let g=65536;"firefox"===i.browser&&57===i.version&&(g=65535);const v=mf.matchPrefix(f.sdp,"a=max-message-size:");return v.length>0?g=parseInt(v[0].substr(19),10):"firefox"===i.browser&&-1!==_&&(g=2147483637),g}(arguments[0],f);let v;v=0===_&&0===g?Number.POSITIVE_INFINITY:0===_||0===g?Math.max(_,g):Math.min(_,g);const b={};Object.defineProperty(b,"maxMessageSize",{get:()=>v}),this._sctp=b}return h.apply(this,arguments)}}function Py(s){if(!s.RTCPeerConnection||!("createDataChannel"in s.RTCPeerConnection.prototype))return;function i(a,d){const l=a.send;a.send=function(){const h=arguments[0];if("open"===a.readyState&&d.sctp&&(h.length||h.size||h.byteLength)>d.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+d.sctp.maxMessageSize+" bytes)");return l.apply(a,arguments)}}const r=s.RTCPeerConnection.prototype.createDataChannel;s.RTCPeerConnection.prototype.createDataChannel=function(){const a=r.apply(this,arguments);return i(a,this),a},Sn(s,"datachannel",a=>(i(a.channel,a.target),a))}function Pw(s){if(!s.RTCPeerConnection||"connectionState"in s.RTCPeerConnection.prototype)return;const i=s.RTCPeerConnection.prototype;Object.defineProperty(i,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(i,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{const a=i[r];i[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=d=>{const l=d.target;if(l._lastConnectionState!==l.connectionState){l._lastConnectionState=l.connectionState;const h=new Event("connectionstatechange",d);l.dispatchEvent(h)}return d},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function Mw(s,i){if(!s.RTCPeerConnection||"chrome"===i.browser&&i.version>=71||"safari"===i.browser&&i.version>=605)return;const r=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&-1!==a.sdp.indexOf("\na=extmap-allow-mixed")){const d=a.sdp.split("\n").filter(l=>"a=extmap-allow-mixed"!==l.trim()).join("\n");s.RTCSessionDescription&&a instanceof s.RTCSessionDescription?arguments[0]=new s.RTCSessionDescription({type:a.type,sdp:d}):a.sdp=d}return r.apply(this,arguments)}}function My(s,i){if(!s.RTCPeerConnection||!s.RTCPeerConnection.prototype)return;const r=s.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(s.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===i.browser&&i.version<78||"firefox"===i.browser&&i.version<68||"safari"===i.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function xy(s,i){if(!s.RTCPeerConnection||!s.RTCPeerConnection.prototype)return;const r=s.RTCPeerConnection.prototype.setLocalDescription;r&&0!==r.length&&(s.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if("object"!=typeof a||a.type&&a.sdp)return r.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||"offer"!==a.type&&"answer"!==a.type?r.apply(this,[a]):("offer"===a.type?this.createOffer:this.createAnswer).apply(this).then(d=>r.apply(this,[d]))})}var J3=Object.freeze({__proto__:null,removeExtmapAllowMixed:Mw,shimAddIceCandidateNullOrEmpty:My,shimConnectionState:Pw,shimMaxMessageSize:Ny,shimParameterlessSetLocalDescription:xy,shimRTCIceCandidate:Oy,shimRTCIceCandidateRelayProtocol:Nw,shimSendThrowTypeError:Py});!function({window:s}={},i={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const r=Ai,a=function(l){const h={browser:null,version:null};if(void 0===l||!l.navigator)return h.browser="Not a browser.",h;const{navigator:f}=l;if(f.mozGetUserMedia)h.browser="firefox",h.version=pg(f.userAgent,/Firefox\/(\d+)\./,1);else if(f.webkitGetUserMedia||!1===l.isSecureContext&&l.webkitRTCPeerConnection)h.browser="chrome",h.version=pg(f.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!l.RTCPeerConnection||!f.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=pg(f.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=l.RTCRtpTransceiver&&"currentDirection"in l.RTCRtpTransceiver.prototype}return h}(s),d={browserDetails:a,commonShim:J3,extractVersion:pg,disableLog:Ne,disableWarnings:et,sdp:X3};switch(a.browser){case"chrome":if(!Ay||!xs||!i.shimChrome)return r("Chrome shim is not included in this adapter release."),d;if(null===a.version)return r("Chrome shim can not determine version, not shimming."),d;r("adapter.js shimming chrome."),d.browserShim=Ay,My(s,a),xy(s),Ra(s,a),St(s),xs(s,a),eh(s),wl(s,a),Ry(s),Il(s),fi(s),nh(s,a),Oy(s),Nw(s),Pw(s),Ny(s,a),Py(s),Mw(s,a);break;case"firefox":if(!Or||!mc||!i.shimFirefox)return r("Firefox shim is not included in this adapter release."),d;r("adapter.js shimming firefox."),d.browserShim=Or,My(s,a),xy(s),fc(s,a),mc(s,a),hf(s),ih(s),mt(s),fg(s),Js(s),pf(s),Rl(s),Di(s),mg(s),Oy(s),Pw(s),Ny(s,a),Py(s);break;case"safari":if(!Dy||!i.shimSafari)return r("Safari shim is not included in this adapter release."),d;r("adapter.js shimming safari."),d.browserShim=Dy,My(s,a),xy(s),gg(s),Dw(s),pd(s),Nr(s),_g(s),Aw(s),ff(s),Eg(s),Oy(s),Nw(s),Ny(s,a),Py(s),Mw(s,a);break;default:r("Unsupported browser!")}}({window:typeof window>"u"?void 0:window});var Kx={exports:{}},Yx=Ns.f;Bt({target:"Object",stat:!0,forced:Object.defineProperty!==Yx,sham:!Ta},{defineProperty:Yx});var $x=Os.Object,Q3=Kx.exports=function(s,i,r){return $x.defineProperty(s,i,r)};$x.defineProperty.sham&&(Q3.sham=!0);var Z3=Rt(Kx.exports),Al=cc,ky=Array.isArray||function(s){return"Array"==Al(s)},Lw=TypeError,So=_y,Fw=Ns,Xx=Ku,Uw=function(s,i,r){var a=So(i);a in s?Fw.f(s,a,Xx(0,r)):s[a]=r},Vw=tr,bg=uw,Jx=Ri(Function.toString);Vw(bg.inspectSource)||(bg.inspectSource=function(s){return Jx(s)});var yg=bg.inspectSource,Qx=Ri,Aa=an,Ly=tr,Bw=ld,jw=yg,Hw=function(){},eB=[],On=Eo("Reflect","construct"),_f=/^\s*(?:class|function)\b/,gf=Qx(_f.exec),io=!_f.exec(Hw),Ef=function(s){if(!Ly(s))return!1;try{return On(Hw,eB,s),!0}catch{return!1}},rh=function(s){if(!Ly(s))return!1;switch(Bw(s)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return io||!!gf(_f,jw(s))}catch{return!0}};rh.sham=!0;var Dl=!On||Aa(function(){var s;return Ef(Ef.call)||!Ef(Object)||!Ef(function(){s=!0})||s})?rh:Ef,Co=ky,Zx=Dl,Fy=ur,e1=li("species"),Qs=Array,Ww=function(s,i){return new(function(s){var i;return Co(s)&&(Zx(i=s.constructor)&&(i===Qs||Co(i.prototype))||Fy(i)&&null===(i=i[e1]))&&(i=void 0),void 0===i?Qs:i}(s))(0===i?0:i)},zw=an,qw=El,Uy=li("species"),vf=Bt,Sg=an,Vy=ky,Ol=ur,dt=bl,Kw=Ia,t1=function(s){if(s>9007199254740991)throw Lw("Maximum allowed index exceeded");return s},Yw=Uw,n1=Ww,$w=El,Nl=li("isConcatSpreadable"),o1=$w>=51||!Sg(function(){var s=[];return s[Nl]=!1,s.concat()[0]!==s}),s1=function(s){if(!Ol(s))return!1;var i=s[Nl];return void 0!==i?!!i:Vy(s)};vf({target:"Array",proto:!0,arity:1,forced:!o1||!function(s){return qw>=51||!zw(function(){var i=[];return(i.constructor={})[Uy]=function(){return{foo:1}},1!==i[s](Boolean).foo})}("concat")},{concat:function(s){var i,r,a,d,l,h=dt(this),f=n1(h,0),_=0;for(i=-1,a=arguments.length;i<a;i++)if(s1(l=-1===i?h:arguments[i]))for(d=Kw(l),t1(_+d),r=0;r<d;r++,_++)r in l&&Yw(f,_,l[r]);else t1(_+1),Yw(f,_++,l);return f.length=_,f}});var By={},Cg={},jy=Yt,me=od,qt=lg.indexOf,Da=Cg,Zs=Ri([].push),Nn=function(s,i){var r,a=me(s),d=0,l=[];for(r in a)!jy(Da,r)&&jy(a,r)&&Zs(l,r);for(;i.length>d;)jy(a,r=i[d++])&&(~qt(l,r)||Zs(l,r));return l},Tg=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],bf=Nn,Oa=Tg,yf=Object.keys||function(s){return bf(s,Oa)},tB=Ns,Xw=Ps,ro=od,_c=yf;By.f=Ta&&!Vt?Object.defineProperties:function(s,i){Xw(s);for(var r,a=ro(i),d=_c(i),l=d.length,h=0;l>h;)tB.f(s,r=d[h++],a[r]);return s};var Sf,ea=Eo("document","documentElement"),gc=nt,Jw=vl("keys"),Cf=function(s){return Jw[s]||(Jw[s]=gc(s))},c1=Ps,d1=By,Ig=Tg,Gy=Cg,Qw=ea,Wy=fw,zy="prototype",wg="script",Rg=Cf("IE_PROTO"),Ag=function(){},qy=function(s){return"<script>"+s+"</"+wg+">"},Ky=function(s){s.write(qy("")),s.close();var i=s.parentWindow.Object;return s=null,i},Tf=function(){try{Sf=new ActiveXObject("htmlfile")}catch{}var s,i;Tf=typeof document<"u"?document.domain&&Sf?Ky(Sf):("javascript:",(i=Wy("iframe")).style.display="none",Qw.appendChild(i),i.src=String("javascript:"),(s=i.contentWindow.document).open(),s.write(qy("document.F=Object")),s.close(),s.F):Ky(Sf);for(var a=Ig.length;a--;)delete Tf[zy][Ig[a]];return Tf()};Gy[Rg]=!0;var oh=Object.create||function(s,i){var r;return null!==s?(Ag[zy]=c1(s),r=new Ag,Ag[zy]=null,r[Rg]=s):r=Tf(),void 0===i?r:d1.f(r,i)},Dg={},Hr=Nn,Pl=Tg.concat("length","prototype");Dg.f=Object.getOwnPropertyNames||function(s){return Hr(s,Pl)};var Qn={},Qo=bw,l1=Ia,Ec=Uw,u1=Array,Zw=Math.max,Yy=function(s,i,r){for(var a=l1(s),d=Qo(i,a),l=Qo(void 0===r?a:r,a),h=u1(Zw(l-d,0)),f=0;d<l;d++,f++)Ec(h,f,s[d]);return h.length=f,h},Og=cc,fd=od,eR=Dg.f,Ng=Yy,If="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Qn.f=function(s){return If&&"Window"==Og(s)?function(i){try{return eR(i)}catch{return Ng(If)}}(s):eR(fd(s))};var Ml={};Ml.f=Object.getOwnPropertySymbols;var $y=Sl,sh=function(s,i,r,a){return a&&a.enumerable?s[i]=r:$y(s,i,r),s},tR=Ns,nR=function(s,i,r){return tR.f(s,i,r)},ta={};ta.f=li;var Pg,xl,Mg,iR=Os,h1=Yt,nB=ta,iB=Ns.f,mi=function(s){var i=iR.Symbol||(iR.Symbol={});h1(i,s)||iB(i,s,{value:nB.f(s)})},Rf=Rr,p1=Eo,Af=li,Xy=sh,Df=function(){var s=p1("Symbol"),i=s&&s.prototype,r=i&&i.valueOf,a=Af("toPrimitive");i&&!i[a]&&Xy(i,a,function(d){return Rf(r,this)},{arity:1})},rB=ld,oR=Xo,f1=Ns.f,Na=Sl,m1=Yt,xg=Xo?{}.toString:function(){return"[object "+rB(this)+"]"},kg=li("toStringTag"),kl=function(s,i,r,a){if(s){var d=r?s:s.prototype;m1(d,kg)||f1(d,kg,{configurable:!0,value:i}),a&&!oR&&Na(d,"toString",xg)}},Fg=lr.WeakMap,_1=tr(Fg)&&/native code/.test(String(Fg)),sR=ur,aR=Sl,Ug=Yt,Vg=Cf,Ll=Cg,cR="Object already initialized",Bg=lr.TypeError;if(_1||uw.state){var oo=uw.state||(uw.state=new(0,lr.WeakMap));oo.get=oo.get,oo.has=oo.has,oo.set=oo.set,Pg=function(s,i){if(oo.has(s))throw Bg(cR);return i.facade=s,oo.set(s,i),i},xl=function(s){return oo.get(s)||{}},Mg=function(s){return oo.has(s)}}else{var na=Vg("state");Ll[na]=!0,Pg=function(s,i){if(Ug(s,na))throw Bg(cR);return i.facade=s,aR(s,na,i),i},xl=function(s){return Ug(s,na)?s[na]:{}},Mg=function(s){return Ug(s,na)}}var Oi={set:Pg,get:xl,has:Mg,enforce:function(s){return Mg(s)?xl(s):Pg(s,{})},getterFor:function(s){return function(i){var r;if(!sR(i)||(r=xl(i)).type!==s)throw Bg("Incompatible receiver, "+s+" required");return r}}},g1=Qu,Ki=oy,Zy=bl,E1=Ia,lR=Ww,ah=Ri([].push),Zo=function(s){var i=1==s,r=2==s,a=3==s,d=4==s,l=6==s,h=7==s,f=5==s||l;return function(_,g,v,b){for(var y,T,M=Zy(_),O=Ki(M),D=g1(g,v),x=E1(O),F=0,j=b||lR,Y=i?j(_,x):r||h?j(_,0):void 0;x>F;F++)if((f||F in O)&&(T=D(y=O[F],F,M),s))if(i)Y[F]=T;else if(T)switch(s){case 3:return!0;case 5:return y;case 6:return F;case 2:ah(Y,y)}else switch(s){case 4:return!1;case 7:ah(Y,y)}return l?-1:a||d?d:Y}},ch={forEach:Zo(0),map:Zo(1),filter:Zo(2),some:Zo(3),every:Zo(4),find:Zo(5),findIndex:Zo(6),filterReject:Zo(7)},vc=Bt,jg=lr,Of=Rr,dh=Ri,Nf=Ta,lh=ad,oB=an,Pr=Yt,sB=Ds,uR=Ps,eS=od,hR=_y,uh=pc,tS=Ku,Pf=oh,Yi=yf,v1=Dg,hh=Qn,b1=Ml,so=Qp,Fl=Ns,pR=By,Mf=ry,xf=sh,nS=nR,fR=vl,iS=Cg,y1=nt,es=li,rS=ta,ph=mi,aB=Df,mR=kl,_R=Oi,Hg=ch.forEach,To=Cf("hidden"),Gg="Symbol",kf="prototype",S1=_R.set,Wg=_R.getterFor(Gg),Io=Object[kf],Ul=jg.Symbol,Vl=Ul&&Ul[kf],C1=jg.TypeError,fh=jg.QObject,gR=so.f,md=Fl.f,zg=hh.f,qg=Mf.f,oS=dh([].push),bc=fR("symbols"),Lf=fR("op-symbols"),mh=fR("wks"),Bl=!fh||!fh[kf]||!fh[kf].findChild,sS=Nf&&oB(function(){return 7!=Pf(md({},"a",{get:function(){return md(this,"a",{value:7}).a}})).a})?function(s,i,r){var a=gR(Io,i);a&&delete Io[i],md(s,i,r),a&&s!==Io&&md(Io,i,a)}:md,ER=function(s,i){var r=bc[s]=Pf(Vl);return S1(r,{type:Gg,tag:s,description:i}),Nf||(r.description=i),r},Ff=function(s,i,r){s===Io&&Ff(Lf,i,r),uR(s);var a=hR(i);return uR(r),Pr(bc,a)?(r.enumerable?(Pr(s,To)&&s[To][a]&&(s[To][a]=!1),r=Pf(r,{enumerable:tS(0,!1)})):(Pr(s,To)||md(s,To,tS(1,{})),s[To][a]=!0),sS(s,a,r)):md(s,a,r)},aS=function(s,i){uR(s);var r=eS(i),a=Yi(r).concat(yR(r));return Hg(a,function(d){Nf&&!Of(T1,r,d)||Ff(s,d,r[d])}),s},T1=function(s){var i=hR(s),r=Of(qg,this,i);return!(this===Io&&Pr(bc,i)&&!Pr(Lf,i))&&(!(r||!Pr(this,i)||!Pr(bc,i)||Pr(this,To)&&this[To][i])||r)},vR=function(s,i){var r=eS(s),a=hR(i);if(r!==Io||!Pr(bc,a)||Pr(Lf,a)){var d=gR(r,a);return!d||!Pr(bc,a)||Pr(r,To)&&r[To][a]||(d.enumerable=!0),d}},bR=function(s){var i=zg(eS(s)),r=[];return Hg(i,function(a){Pr(bc,a)||Pr(iS,a)||oS(r,a)}),r},yR=function(s){var i=s===Io,r=zg(i?Lf:eS(s)),a=[];return Hg(r,function(d){!Pr(bc,d)||i&&!Pr(Io,d)||oS(a,bc[d])}),a};lh||(Ul=function(){if(sB(Vl,this))throw C1("Symbol is not a constructor");var s=arguments.length&&void 0!==arguments[0]?uh(arguments[0]):void 0,i=y1(s),r=function(a){this===Io&&Of(r,Lf,a),Pr(this,To)&&Pr(this[To],i)&&(this[To][i]=!1),sS(this,i,tS(1,a))};return Nf&&Bl&&sS(Io,i,{configurable:!0,set:r}),ER(i,s)},xf(Vl=Ul[kf],"toString",function(){return Wg(this).tag}),xf(Ul,"withoutSetter",function(s){return ER(y1(s),s)}),Mf.f=T1,Fl.f=Ff,pR.f=aS,so.f=vR,v1.f=hh.f=bR,b1.f=yR,rS.f=function(s){return ER(es(s),s)},Nf&&nS(Vl,"description",{configurable:!0,get:function(){return Wg(this).description}})),vc({global:!0,constructor:!0,wrap:!0,forced:!lh,sham:!lh},{Symbol:Ul}),Hg(Yi(mh),function(s){ph(s)}),vc({target:Gg,stat:!0,forced:!lh},{useSetter:function(){Bl=!0},useSimple:function(){Bl=!1}}),vc({target:"Object",stat:!0,forced:!lh,sham:!Nf},{create:function(s,i){return void 0===i?Pf(s):aS(Pf(s),i)},defineProperty:Ff,defineProperties:aS,getOwnPropertyDescriptor:vR}),vc({target:"Object",stat:!0,forced:!lh},{getOwnPropertyNames:bR}),aB(),mR(Ul,Gg),iS[To]=!0;var _d=ad&&!!Symbol.for&&!!Symbol.keyFor,SR=Bt,cS=Eo,Kg=Yt,dS=pc,CR=vl,TR=_d,Yg=CR("string-to-symbol-registry"),$g=CR("symbol-to-string-registry");SR({target:"Symbol",stat:!0,forced:!TR},{for:function(s){var i=dS(s);if(Kg(Yg,i))return Yg[i];var r=cS("Symbol")(i);return Yg[i]=r,$g[r]=i,r}});var cB=Bt,lS=Yt,I1=Wn,uS=Xu,IR=_d,hS=vl("symbol-to-string-registry");cB({target:"Symbol",stat:!0,forced:!IR},{keyFor:function(s){if(!I1(s))throw TypeError(uS(s)+" is not a symbol");if(lS(hS,s))return hS[s]}});var gd=Ri([].slice),wR=ky,pS=tr,Uf=cc,w1=pc,Xg=Ri([].push),Jg=Bt,ts=Eo,jl=q_,fS=Rr,Vf=Ri,RR=an,mS=tr,Hl=Wn,AR=gd,A1=ad,_S=String,wo=ts("JSON","stringify"),_h=Vf(/./.exec),gS=Vf("".charAt),D1=Vf("".charCodeAt),O1=Vf("".replace),DR=Vf(1..toString),N1=/[\uD800-\uDFFF]/g,ES=/^[\uD800-\uDBFF]$/,OR=/^[\uDC00-\uDFFF]$/,NR=!A1||RR(function(){var s=ts("Symbol")();return"[null]"!=wo([s])||"{}"!=wo({a:s})||"{}"!=wo(Object(s))}),P1=RR(function(){return'"\\udf06\\ud834"'!==wo("\udf06\ud834")||'"\\udead"'!==wo("\udead")}),PR=function(s,i){var r=AR(arguments),a=function(s){if(pS(s))return s;if(wR(s)){for(var i=s.length,r=[],a=0;a<i;a++){var d=s[a];"string"==typeof d?Xg(r,d):"number"!=typeof d&&"Number"!=Uf(d)&&"String"!=Uf(d)||Xg(r,w1(d))}var l=r.length,h=!0;return function(f,_){if(h)return h=!1,_;if(wR(this))return _;for(var g=0;g<l;g++)if(r[g]===f)return _}}}(i);if(mS(a)||void 0!==s&&!Hl(s))return r[1]=function(d,l){if(mS(a)&&(l=fS(a,this,_S(d),l)),!Hl(l))return l},jl(wo,null,r)},MR=function(s,i,r){var a=gS(r,i-1),d=gS(r,i+1);return _h(ES,s)&&!_h(OR,d)||_h(OR,s)&&!_h(ES,a)?"\\u"+DR(D1(s,0),16):s};wo&&Jg({target:"JSON",stat:!0,arity:3,forced:NR||P1},{stringify:function(s,i,r){var a=AR(arguments),d=jl(NR?PR:wo,null,a);return P1&&"string"==typeof d?O1(d,N1,MR):d}});var pr=Ml,vS=bl;Bt({target:"Object",stat:!0,forced:!ad||an(function(){pr.f(1)})},{getOwnPropertySymbols:function(s){var i=pr.f;return i?i(vS(s)):[]}}),mi("asyncIterator"),mi("hasInstance"),mi("isConcatSpreadable"),mi("iterator"),mi("match"),mi("matchAll"),mi("replace"),mi("search"),mi("species"),mi("split");var Ed=Df;mi("toPrimitive"),Ed();var Qg=Eo,xR=kl;mi("toStringTag"),xR(Qg("Symbol"),"Symbol"),mi("unscopables"),kl(lr.JSON,"JSON",!0);var ia,kR,LR,bS=Os.Symbol,gh={},Pa=Ta,FR=Function.prototype,UR=Pa&&Object.getOwnPropertyDescriptor,Ma=Yt(FR,"name"),M1={EXISTS:Ma,PROPER:Ma&&"something"===function(){}.name,CONFIGURABLE:Ma&&(!Pa||Pa&&UR(FR,"name").configurable)},yc=!an(function(){function s(){}return s.prototype.constructor=null,Object.getPrototypeOf(new s)!==s.prototype}),yS=Yt,x1=tr,k1=bl,L1=yc,VR=Cf("IE_PROTO"),Zg=Object,Eh=Zg.prototype,ao=L1?Zg.getPrototypeOf:function(s){var i=k1(s);if(yS(i,VR))return i[VR];var r=i.constructor;return x1(r)&&i instanceof r?r.prototype:i instanceof Zg?Eh:null},vd=an,SS=tr,BR=ur,bd=oh,vh=ao,dB=sh,bh=li("iterator"),CS=!1;[].keys&&("next"in(LR=[].keys())?(kR=vh(vh(LR)))!==Object.prototype&&(ia=kR):CS=!0);var F1=!BR(ia)||vd(function(){var s={};return ia[bh].call(s)!==s});SS((ia=F1?{}:bd(ia))[bh])||dB(ia,bh,function(){return this});var TS={IteratorPrototype:ia,BUGGY_SAFARI_ITERATORS:CS},lB=TS.IteratorPrototype,jR=oh,uB=Ku,U1=kl,V1=gh,IS=function(){return this},hB=Ri,pB=Ko,wS=tr,fB=String,mB=TypeError,gB=Ps,B1=Object.setPrototypeOf||("__proto__"in{}?function(){var s,i=!1,r={};try{(s=function(s,i,r){try{return hB(pB(Object.getOwnPropertyDescriptor(s,i)[r]))}catch{}}(Object.prototype,"__proto__","set"))(r,[]),i=r instanceof Array}catch{}return function(a,d){return gB(a),function(s){if("object"==typeof s||wS(s))return s;throw mB("Can't set "+fB(s)+" as a prototype")}(d),i?s(a,d):a.__proto__=d,a}}():void 0),eE=Bt,tE=Rr,GR=ao,jf=kl,WR=sh,AS=gh,nE=M1.PROPER,Gl=TS.BUGGY_SAFARI_ITERATORS,xa=li("iterator"),iE="values",KR="entries",YR=function(){return this},rE=function(s,i,r,a,d,l,h){!function(s,i,r,a){var d=i+" Iterator";s.prototype=jR(lB,{next:uB(+!a,r)}),U1(s,d,!1,!0),V1[d]=IS}(r,i,a);var f,_,g,v=function(x){if(x===d&&O)return O;if(!Gl&&x in T)return T[x];switch(x){case"keys":case iE:case KR:return function(){return new r(this,x)}}return function(){return new r(this)}},b=i+" Iterator",y=!1,T=s.prototype,M=T[xa]||T["@@iterator"]||d&&T[d],O=!Gl&&M||v(d),D="Array"==i&&T.entries||M;if(D&&(f=GR(D.call(new s)))!==Object.prototype&&f.next&&(jf(f,b,!0,!0),AS[b]=YR),nE&&d==iE&&M&&M.name!==iE&&(y=!0,O=function(){return tE(M,this)}),d)if(_={values:v(iE),keys:l?O:v("keys"),entries:v(KR)},h)for(g in _)(Gl||y||!(g in T))&&WR(T,g,_[g]);else eE({target:i,proto:!0,forced:Gl||y},_);return h&&T[xa]!==O&&WR(T,xa,O,{name:d}),AS[i]=O,_},$R=function(s,i){return{value:s,done:i}},j1=od,XR=gh,H1=rE,JR=$R,co="Array Iterator",OS=Oi.set,QR=Oi.getterFor(co);H1(Array,"Array",function(s,i){OS(this,{type:co,target:j1(s),index:0,kind:i})},function(){var s=QR(this),i=s.target,r=s.kind,a=s.index++;return!i||a>=i.length?(s.target=void 0,JR(void 0,!0)):JR("keys"==r?a:"values"==r?i[a]:[a,i[a]],!1)},"values"),XR.Arguments=XR.Array;var Gr=lr,Hf=ld,ZR=Sl,PS=gh,eA=li("toStringTag");for(var oE in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var tA=Gr[oE],sE=tA&&tA.prototype;sE&&Hf(sE)!==eA&&ZR(sE,eA,oE),PS[oE]=PS.Array}var G1=bS,W1=Ns.f,iA=li("metadata"),aE=Function.prototype;void 0===aE[iA]&&W1(aE,iA,{value:null}),mi("dispose"),mi("metadata");var MS=G1;mi("asyncDispose");var z1=Ri,yd=Eo("Symbol"),cE=yd.keyFor,rA=z1(yd.prototype.valueOf),dE=yd.isRegisteredSymbol||function(s){try{return void 0!==cE(rA(s))}catch{return!1}};Bt({target:"Symbol",stat:!0},{isRegisteredSymbol:dE});for(var lE=vl,oA=Eo,q1=Ri,sA=Wn,K1=li,uE=oA("Symbol"),aA=uE.isWellKnownSymbol,xS=oA("Object","getOwnPropertyNames"),Gf=q1(uE.prototype.valueOf),Wf=lE("wks"),zf=0,cA=xS(uE),Y1=cA.length;zf<Y1;zf++)try{var hE=cA[zf];sA(uE[hE])&&K1(hE)}catch{}var kS=function(s){if(aA&&aA(s))return!0;try{for(var i=Gf(s),r=0,a=xS(Wf),d=a.length;r<d;r++)if(Wf[a[r]]==i)return!0}catch{}return!1};Bt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:kS}),mi("matcher"),mi("observable"),Bt({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:dE}),Bt({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:kS}),mi("metadataKey"),mi("patternMatch"),mi("replaceAll");var Ls=Rt(MS),pE=Ri,dA=Te,$1=pc,vB=gl,fE=pE("".charAt),lA=pE("".charCodeAt),uA=pE("".slice),LS=function(s){return function(i,r){var a,d,l=$1(vB(i)),h=dA(r),f=l.length;return h<0||h>=f?s?"":void 0:(a=lA(l,h))<55296||a>56319||h+1===f||(d=lA(l,h+1))<56320||d>57343?s?fE(l,h):a:s?uA(l,h,h+2):d-56320+(a-55296<<10)+65536}},hA=(LS(!1),LS(!0)),FS=pc,mE=rE,yh=$R,VS="String Iterator",BS=Oi.set,_E=Oi.getterFor(VS);mE(String,"String",function(s){BS(this,{type:VS,string:FS(s),index:0})},function(){var s,i=_E(this),r=i.string,a=i.index;return a>=r.length?yh(void 0,!0):(s=hA(r,a),i.index+=s.length,yh(s,!1))});var jS=Rt(ta.f("iterator"));function Wl(s){return(Wl="function"==typeof Ls&&"symbol"==typeof jS?function(i){return typeof i}:function(i){return i&&"function"==typeof Ls&&i.constructor===Ls&&i!==Ls.prototype?"symbol":typeof i})(s)}var gE=Rt(ta.f("toPrimitive"));function C(s,i,r){return(i=function X1(s){var i=function(r,a){if("object"!==Wl(r)||null===r)return r;var d=r[gE];if(void 0!==d){var l=d.call(r,"string");if("object"!==Wl(l))return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}(s);return"symbol"===Wl(i)?i:String(i)}(i))in s?Z3(s,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[i]=r,s}var J1=hc("Array").keys,Q1=ld,Z1=Yt,pA=Ds,fA=J1,Sh=Array.prototype,HS={DOMTokenList:!0,NodeList:!0},ir=Rt(function(s){var i=s.keys;return s===Sh||pA(Sh,s)&&i===Sh.keys||Z1(HS,Q1(s))?fA:i}),mA=Xu,ek=TypeError,tk=Yy,nk=Math.floor,Ch=function(s,i){var r=s.length,a=nk(r/2);return r<8?GS(s,i):_A(s,Ch(tk(s,0,a),i),Ch(tk(s,a),i),i)},GS=function(s,i){for(var r,a,d=s.length,l=1;l<d;){for(a=l,r=s[l];a&&i(s[a-1],r)>0;)s[a]=s[--a];a!==l++&&(s[a]=r)}return s},_A=function(s,i,r,a){for(var d=i.length,l=r.length,h=0,f=0;h<d||f<l;)s[h+f]=h<d&&f<l?a(i[h],r[f])<=0?i[h++]:r[f++]:h<d?i[h++]:r[f++];return s},gA=Ch,EA=an,EE=function(s,i){var r=[][s];return!!r&&EA(function(){r.call(null,i||function(){return 1},1)})},vA=lc.match(/firefox\/(\d+)/i),ik=!!vA&&+vA[1],rk=/MSIE|Trident/.test(lc),bA=lc.match(/AppleWebKit\/(\d+)\./),Sd=Bt,Th=Ri,sk=Ko,bB=bl,ak=Ia,yB=function(s,i){if(!delete s[i])throw ek("Cannot delete property "+mA(i)+" of "+mA(s))},ck=pc,yA=an,SA=gA,dk=EE,CA=ik,lk=rk,TA=El,vE=!!bA&&+bA[1],Wr=[],Ih=Th(Wr.sort),IA=Th(Wr.push),wA=yA(function(){Wr.sort(void 0)}),RA=yA(function(){Wr.sort(null)}),SB=dk("sort"),uk=!yA(function(){if(TA)return TA<70;if(!(CA&&CA>3)){if(lk)return!0;if(vE)return vE<603;var s,i,r,a,d="";for(s=65;s<76;s++){switch(i=String.fromCharCode(s),s){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(a=0;a<47;a++)Wr.push({k:i+a,v:r})}for(Wr.sort(function(l,h){return h.v-l.v}),a=0;a<Wr.length;a++)i=Wr[a].k.charAt(0),d.charAt(d.length-1)!==i&&(d+=i);return"DGBEFHACIJK"!==d}});Sd({target:"Array",proto:!0,forced:wA||!RA||!SB||!uk},{sort:function(s){void 0!==s&&sk(s);var i=bB(this);if(uk)return void 0===s?Ih(i):Ih(i,s);var r,a,d=[],l=ak(i);for(a=0;a<l;a++)a in i&&IA(d,i[a]);for(SA(d,function(h){return function(f,_){return void 0===_?-1:void 0===f?1:void 0!==h?+h(f,_)||0:ck(f)>ck(_)?1:-1}}(s)),r=ak(d),a=0;a<r;)i[a]=d[a++];for(;a<l;)yB(i,a++);return i}});var CB=hc("Array").sort,WS=Ds,zS=CB,AA=Array.prototype,bE=Rt(function(s){var i=s.sort;return s===AA||WS(AA,s)&&i===AA.sort?zS:i}),DA=Eo,hk=Dg,pk=Ml,fk=Ps,mk=Ri([].concat),OA=DA("Reflect","ownKeys")||function(s){var i=hk.f(fk(s)),r=pk.f;return r?mk(i,r(s)):i},qf=Yt,_k=OA,qS=Qp,gk=Ns,wh=ur,Ek=Sl,NA=Error,KS=Ri("".replace),PA=String(NA("zxcasd").stack),MA=/\n\s*at [^:]*:[^\n]*/,vk=MA.test(PA),bk=Ku,yk=!an(function(){var s=Error("a");return!("stack"in s)||(Object.defineProperty(s,"stack",bk(1,7)),7!==s.stack)}),xA=Sl,IB=yk,Rh=Error.captureStackTrace,YS=gh,wB=li("iterator"),RB=Array.prototype,yE=ld,kA=Si,$S=sy,XS=gh,Ah=li("iterator"),SE=function(s){if(!$S(s))return kA(s,Ah)||kA(s,"@@iterator")||XS[yE(s)]},JS=Rr,Kf=Ko,CE=Ps,Dh=Xu,QS=SE,ZS=TypeError,TE=Rr,Sk=Ps,eC=Si,Yf=Qu,Ck=Rr,LA=Ps,Tk=Xu,tC=Ia,nC=Ds,Rk=SE,zl=function(s,i,r){var a,d;Sk(s);try{if(!(a=eC(s,"return"))){if("throw"===i)throw r;return r}a=TE(a,s)}catch(l){d=!0,a=l}if("throw"===i)throw r;if(d)throw a;return Sk(a),r},FA=TypeError,Oh=function(s,i){this.stopped=s,this.result=i},iC=Oh.prototype,IE=function(s,i,r){var a,d,l,h,f,_,g,b=!(!r||!r.AS_ENTRIES),y=!(!r||!r.IS_RECORD),T=!(!r||!r.IS_ITERATOR),M=!(!r||!r.INTERRUPTED),O=Yf(i,r&&r.that),D=function(F){return a&&zl(a,"normal",F),new Oh(!0,F)},x=function(F){return b?(LA(F),M?O(F[0],F[1],D):O(F[0],F[1])):M?O(F,D):O(F)};if(y)a=s.iterator;else if(T)a=s;else{if(!(d=Rk(s)))throw FA(Tk(s)+" is not iterable");if(function(s){return void 0!==s&&(YS.Array===s||RB[wB]===s)}(d)){for(l=0,h=tC(s);h>l;l++)if((f=x(s[l]))&&nC(iC,f))return f;return new Oh(!1)}a=function(s,i){var r=arguments.length<2?QS(s):i;if(Kf(r))return CE(JS(r,s));throw ZS(Dh(s)+" is not iterable")}(s,d)}for(_=y?s.next:a.next;!(g=Ck(_,a)).done;){try{f=x(g.value)}catch(F){zl(a,"throw",F)}if("object"==typeof f&&f&&nC(iC,f))return f}return new Oh(!1)},AB=pc,$f=Bt,Ak=Ds,wE=ao,Nh=B1,rC=oh,Xf=Sl,Ph=Ku,UA=function(s,i,r,a){IB&&(Rh?Rh(s,i):xA(s,"stack",function(s,i){if(vk&&"string"==typeof s&&!NA.prepareStackTrace)for(;i--;)s=KS(s,MA,"");return s}(r,a)))},Nk=IE,DB=li("toStringTag"),RE=Error,Mh=[].push,xh=function(s,i){var r,a=Ak(Cd,this);Nh?r=Nh(RE(),a?wE(this):Cd):(r=a?this:rC(Cd),Xf(r,DB,"Error")),void 0!==i&&Xf(r,"message",function(s,i){return void 0===s?arguments.length<2?"":i:AB(s)}(i)),UA(r,xh,r.stack,1),arguments.length>2&&function(s,i){wh(i)&&"cause"in i&&Ek(s,"cause",i.cause)}(r,arguments[2]);var d=[];return Nk(s,Mh,{that:d}),Xf(r,"errors",d),r};Nh?Nh(xh,RE):function(s,i,r){for(var a=_k(i),d=gk.f,l=qS.f,h=0;h<a.length;h++){var f=a[h];qf(s,f)||r&&qf(r,f)||d(s,f,l(i,f))}}(xh,RE,{name:!0});var Cd=xh.prototype=rC(RE.prototype,{constructor:Ph(1,xh),message:Ph(1,""),name:Ph(1,"AggregateError")});$f({global:!0,constructor:!0,arity:2},{AggregateError:xh});var en,kh,AE,Fs,Jf=typeof process<"u"&&"process"==cc(process),Pk=Eo,oC=nR,Mk=Ta,xk=li("species"),OB=Ds,kk=TypeError,BA=Dl,NB=Xu,DE=TypeError,jA=Ps,sC=sy,HA=li("species"),GA=function(s,i){var r,a=jA(s).constructor;return void 0===a||sC(r=jA(a)[HA])?i:function(s){if(BA(s))return s;throw DE(NB(s)+" is not a constructor")}(r)},Fk=TypeError,WA=/(?:ipad|iphone|ipod).*applewebkit/i.test(lc),ns=lr,zA=q_,qA=Qu,aC=tr,Uk=Yt,KA=an,cC=ea,dC=gd,Vk=fw,OE=WA,Bk=Jf,ql=ns.setImmediate,NE=ns.clearImmediate,$A=ns.process,lC=ns.Dispatch,jk=ns.Function,XA=ns.MessageChannel,Hk=ns.String,uC=0,Qf={},hC="onreadystatechange";KA(function(){en=ns.location});var PE=function(s){if(Uk(Qf,s)){var i=Qf[s];delete Qf[s],i()}},ME=function(s){return function(){PE(s)}},pC=function(s){PE(s.data)},Gk=function(s){ns.postMessage(Hk(s),en.protocol+"//"+en.host)};ql&&NE||(ql=function(s){!function(s,i){if(s<i)throw Fk("Not enough arguments")}(arguments.length,1);var i=aC(s)?s:jk(s),r=dC(arguments,1);return Qf[++uC]=function(){zA(i,void 0,r)},kh(uC),uC},NE=function(s){delete Qf[s]},Bk?kh=function(s){$A.nextTick(ME(s))}:lC&&lC.now?kh=function(s){lC.now(ME(s))}:XA&&!OE?(Fs=(AE=new XA).port2,AE.port1.onmessage=pC,kh=qA(Fs.postMessage,Fs)):ns.addEventListener&&aC(ns.postMessage)&&!ns.importScripts&&en&&"file:"!==en.protocol&&!KA(Gk)?(kh=Gk,ns.addEventListener("message",pC,!1)):kh=hC in Vk("script")?function(s){cC.appendChild(Vk("script"))[hC]=function(){cC.removeChild(this),PE(s)}}:function(s){setTimeout(ME(s),0)});var xE={set:ql,clear:NE},ka=function(){this.head=null,this.tail=null};ka.prototype={add:function(s){var i={item:s,next:null},r=this.tail;r?r.next=i:this.head=i,this.tail=i},get:function(){var s=this.head;if(s)return null===(this.head=s.next)&&(this.tail=null),s.item}};var Kl,Lh,kE,LE,JA,QA=ka,Wk=/ipad|iphone|ipod/i.test(lc)&&typeof Pebble<"u",zk=/web0s(?!.*chrome)/i.test(lc),Td=lr,qk=Qu,ZA=xE.set,PB=QA,eD=WA,tD=Wk,MB=zk,_t=Jf,Qe=Td.MutationObserver||Td.WebKitMutationObserver,fC=Td.document,ae=Td.process,Fh=Td.Promise,mC=(0,Qp.f)(Td,"queueMicrotask"),_C=mC&&mC.value;if(!_C){var Yl=new PB,Sc=function(){var s,i;for(_t&&(s=ae.domain)&&s.exit();i=Yl.get();)try{i()}catch(r){throw Yl.head&&Kl(),r}s&&s.enter()};eD||_t||MB||!Qe||!fC?!tD&&Fh&&Fh.resolve?((LE=Fh.resolve(void 0)).constructor=Fh,JA=qk(LE.then,LE),Kl=function(){JA(Sc)}):_t?Kl=function(){ae.nextTick(Sc)}:(ZA=qk(ZA,Td),Kl=function(){ZA(Sc)}):(Lh=!0,kE=fC.createTextNode(""),new Qe(Sc).observe(kE,{characterData:!0}),Kl=function(){kE.data=Lh=!Lh}),_C=function(s){Yl.head||Kl(),Yl.add(s)}}var gC=_C,La=function(s){try{return{error:!1,value:s()}}catch(i){return{error:!0,value:i}}},Id=lr.Promise,FE="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,EC=!FE&&!Jf&&"object"==typeof window&&"object"==typeof document,vC=lr,Uh=Id,bC=tr,Yk=_w,$k=yg,nD=EC,Jk=FE,yC=El,iD=Uh&&Uh.prototype,Qk=li("species"),SC=!1,CC=bC(vC.PromiseRejectionEvent),Zf={CONSTRUCTOR:Yk("Promise",function(){var s=$k(Uh),i=s!==String(Uh);if(!i&&66===yC||!iD.catch||!iD.finally)return!0;if(!yC||yC<51||!/native code/.test(s)){var r=new Uh(function(d){d(1)}),a=function(d){d(function(){},function(){})};if((r.constructor={})[Qk]=a,!(SC=r.then(function(){})instanceof a))return!0}return!i&&(nD||Jk)&&!CC}),REJECTION_EVENT:CC,SUBCLASSING:SC},Ni={},rD=Ko,eL=TypeError,xB=function(s){var i,r;this.promise=new s(function(a,d){if(void 0!==i||void 0!==r)throw eL("Bad Promise constructor");i=a,r=d}),this.resolve=rD(i),this.reject=rD(r)};Ni.f=function(s){return new xB(s)};var em,TC,tL=Bt,UE=Jf,wd=lr,Vh=Rr,nL=sh,iL=kl,rL=Ko,wC=tr,oL=ur,aL=GA,ra=xE.set,tm=gC,dL=La,oD=QA,RC=Oi,Bh=Id,lL=Ni,nm="Promise",AC=Zf.CONSTRUCTOR,sD=Zf.REJECTION_EVENT,jh=RC.getterFor(nm),DC=RC.set,im=Bh,rm=Bh&&Bh.prototype,aD=wd.TypeError,cD=wd.document,OC=wd.process,NC=lL.f,dD=NC,uL=!!(cD&&cD.createEvent&&wd.dispatchEvent),lD="unhandledrejection",PC=function(s){var i;return!(!oL(s)||!wC(i=s.then))&&i},BE=function(s,i){var r,a,d,l=i.value,h=1==i.state,f=h?s.ok:s.fail,_=s.resolve,g=s.reject,v=s.domain;try{f?(h||(2===i.rejection&&hL(i),i.rejection=1),!0===f?r=l:(v&&v.enter(),r=f(l),v&&(v.exit(),d=!0)),r===s.promise?g(aD("Promise-chain cycle")):(a=PC(r))?Vh(a,r,_,g):_(r)):g(l)}catch(b){v&&!d&&v.exit(),g(b)}},MC=function(s,i){s.notified||(s.notified=!0,tm(function(){for(var r,a=s.reactions;r=a.get();)BE(r,s);s.notified=!1,i&&!s.rejection&&om(s)}))},Hh=function(s,i,r){var a,d;uL?((a=cD.createEvent("Event")).promise=i,a.reason=r,a.initEvent(s,!1,!0),wd.dispatchEvent(a)):a={promise:i,reason:r},!sD&&(d=wd["on"+s])?d(a):s===lD&&function(s,i){try{1==arguments.length?console.error(s):console.error(s,i)}catch{}}("Unhandled promise rejection",r)},om=function(s){Vh(ra,wd,function(){var i,r=s.facade,a=s.value;if(Us(s)&&(i=dL(function(){UE?OC.emit("unhandledRejection",a,r):Hh(lD,r,a)}),s.rejection=UE||Us(s)?2:1,i.error))throw i.value})},Us=function(s){return 1!==s.rejection&&!s.parent},hL=function(s){Vh(ra,wd,function(){var i=s.facade;UE?OC.emit("rejectionHandled",i):Hh("rejectionhandled",i,s.value)})},Gh=function(s,i,r){return function(a){s(i,a,r)}},Wh=function(s,i,r){s.done||(s.done=!0,r&&(s=r),s.value=i,s.state=2,MC(s,!0))},xC=function(s,i,r){if(!s.done){s.done=!0,r&&(s=r);try{if(s.facade===i)throw aD("Promise can't be resolved itself");var a=PC(i);a?tm(function(){var d={done:!1};try{Vh(a,i,Gh(xC,d,s),Gh(Wh,d,s))}catch(l){Wh(d,l,s)}}):(s.value=i,s.state=1,MC(s,!1))}catch(d){Wh({done:!1},d,s)}}};AC&&(rm=(im=function(s){(function(s,i){if(OB(i,s))return s;throw kk("Incorrect invocation")})(this,rm),rL(s),Vh(em,this);var i=jh(this);try{s(Gh(xC,i),Gh(Wh,i))}catch(r){Wh(i,r)}}).prototype,(em=function(s){DC(this,{type:nm,done:!1,notified:!1,parent:!1,reactions:new oD,rejection:!1,state:0,value:void 0})}).prototype=nL(rm,"then",function(s,i){var r=jh(this),a=NC(aL(this,im));return r.parent=!0,a.ok=!wC(s)||s,a.fail=wC(i)&&i,a.domain=UE?OC.domain:void 0,0==r.state?r.reactions.add(a):tm(function(){BE(a,r)}),a.promise}),TC=function(){var s=new em,i=jh(s);this.promise=s,this.resolve=Gh(xC,i),this.reject=Gh(Wh,i)},lL.f=NC=function(s){return s===im||void 0===s?new TC(s):dD(s)}),tL({global:!0,constructor:!0,wrap:!0,forced:AC},{Promise:im}),iL(im,nm,!1,!0),function(s){var i=Pk(s);Mk&&i&&!i[xk]&&oC(i,xk,{configurable:!0,get:function(){return this}})}(nm);var pL=li("iterator"),fL=!1;try{var jE=0,uD={next:function(){return{done:!!jE++}},return:function(){fL=!0}};uD[pL]=function(){return this},Array.from(uD,function(){throw 2})}catch{}var mL=Id,HE=Zf.CONSTRUCTOR||!function(s,i){if(!i&&!fL)return!1;var r=!1;try{var a={};a[pL]=function(){return{next:function(){return{done:r=!0}}}},s(a)}catch{}return r}(function(s){mL.all(s).then(void 0,function(){})}),_L=Rr,gL=Ko,EL=Ni,vL=La,hD=IE;Bt({target:"Promise",stat:!0,forced:HE},{all:function(s){var i=this,r=EL.f(i),a=r.resolve,d=r.reject,l=vL(function(){var h=gL(i.resolve),f=[],_=0,g=1;hD(s,function(v){var b=_++,y=!1;g++,_L(h,i,v).then(function(T){y||(y=!0,f[b]=T,--g||a(f))},d)}),--g||a(f)});return l.error&&d(l.value),r.promise}}),Bt({target:"Promise",proto:!0,forced:Zf.CONSTRUCTOR,real:!0},{catch:function(s){return this.then(void 0,s)}});var kC=Rr,hn=Ko,pD=Ni,yL=La,LB=IE;Bt({target:"Promise",stat:!0,forced:HE},{race:function(s){var i=this,r=pD.f(i),a=r.reject,d=yL(function(){var l=hn(i.resolve);LB(s,function(h){kC(l,i,h).then(r.resolve,a)})});return d.error&&a(d.value),r.promise}});var it=Rr,SL=Ni;Bt({target:"Promise",stat:!0,forced:Zf.CONSTRUCTOR},{reject:function(s){var i=SL.f(this);return it(i.reject,void 0,s),i.promise}});var LC=Ps,CL=ur,TL=Ni,GE=function(s,i){if(LC(s),CL(i)&&i.constructor===s)return i;var r=TL.f(s);return(0,r.resolve)(i),r.promise},fD=Bt,mD=Id,_D=Zf.CONSTRUCTOR,IL=GE,wL=Eo("Promise"),Xl=!_D;fD({target:"Promise",stat:!0,forced:!0},{resolve:function(s){return IL(Xl&&this===wL?mD:this,s)}});var gD=Rr,ED=Ko,RL=Ni,vD=La,bD=IE;Bt({target:"Promise",stat:!0,forced:HE},{allSettled:function(s){var i=this,r=RL.f(i),a=r.resolve,d=r.reject,l=vD(function(){var h=ED(i.resolve),f=[],_=0,g=1;bD(s,function(v){var b=_++,y=!1;g++,gD(h,i,v).then(function(T){y||(y=!0,f[b]={status:"fulfilled",value:T},--g||a(f))},function(T){y||(y=!0,f[b]={status:"rejected",reason:T},--g||a(f))})}),--g||a(f)});return l.error&&d(l.value),r.promise}});var yD=Rr,sm=Ko,AL=Eo,DL=Ni,FC=La,OL=IE,am="No one promise resolved";Bt({target:"Promise",stat:!0,forced:HE},{any:function(s){var i=this,r=AL("AggregateError"),a=DL.f(i),d=a.resolve,l=a.reject,h=FC(function(){var f=sm(i.resolve),_=[],g=0,v=1,b=!1;OL(s,function(y){var T=g++,M=!1;v++,yD(f,i,y).then(function(O){M||b||(b=!0,d(O))},function(O){M||b||(M=!0,_[T]=O,--v||l(new r(_,am)))})}),--v||l(new r(_,am))});return h.error&&l(h.value),a.promise}});var PL=Eo,cm=tr,ML=GA,CD=GE,xL=Id&&Id.prototype;Bt({target:"Promise",proto:!0,real:!0,forced:!!Id&&an(function(){xL.finally.call({then:function(){}},function(){})})},{finally:function(s){var i=ML(this,PL("Promise")),r=cm(s);return this.then(r?function(a){return CD(i,s()).then(function(){return a})}:s,r?function(a){return CD(i,s()).then(function(){throw a})}:s)}});var TD=Os.Promise,X=Rt(TD);const kL=()=>{};function dm(){const s={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:kL};return s.promise=new X((i,r)=>{s.resolve=a=>{s.isFinished||(s.isResolved=!0,s.isFinished=!0,i(a),s.value=a)},s.reject=a=>{s.isFinished||(s.isRejected=!0,s.isFinished=!0,r(a))}}),s}const zE=new Map,lm=new Map,Nt=new Map;var Zn,gt,s;(s=Zn||(Zn={})).WIN_10="Windows 10",s.WIN_81="Windows 8.1",s.WIN_8="Windows 8",s.WIN_7="Windows 7",s.WIN_VISTA="Windows Vista",s.WIN_SERVER_2003="Windows Server 2003",s.WIN_XP="Windows XP",s.WIN_2000="Windows 2000",s.ANDROID="Android",s.HARMONY_OS="HarmonyOS",s.OPEN_BSD="Open BSD",s.SUN_OS="Sun OS",s.LINUX="Linux",s.IOS="iOS",s.MAC_OS="Mac OS",s.CHROMIUM_OS="Chromium OS",s.QNX="QNX",s.UNIX="UNIX",s.BEOS="BeOS",s.OS_2="OS/2",s.SEARCH_BOT="Search Bot",function(s){s.CHROME="Chrome",s.SAFARI="Safari",s.EDGE="Edge",s.FIREFOX="Firefox",s.OPERA="OPR",s.QQ="QQBrowser",s.WECHAT="MicroMessenger"}(gt||(gt={}));var zh={exports:{}};!function(s,i){!function(r,a){var d="function",l="undefined",h="object",f="string",_="major",g="model",v="name",b="type",y="vendor",T="version",M="architecture",O="console",D="mobile",x="tablet",F="smarttv",j="wearable",Y="embedded",te="Amazon",K="Apple",Q="ASUS",$="BlackBerry",q="Browser",ge="Chrome",_e="Firefox",Fe="Google",Qt="Microsoft",Fi="Motorola",ie="Opera",ue="Samsung",ke="Sony",ht="Xiaomi",fe="Zebra",R="Facebook",U="Chromium OS",G="Mac OS",se=function(un){for(var En={},zt=0;zt<un.length;zt++)En[un[zt].toUpperCase()]=un[zt];return En},Ue=function(un,En){return typeof un===f&&-1!==Wt(En).indexOf(Wt(un))},Wt=function(un){return un.toLowerCase()},er=function(un,En){if(typeof un===f)return un=un.replace(/^\s\s*/,""),typeof En===l?un:un.substring(0,350)},Ho=function(un,En){for(var zt,fo,tc,Rn,at,Ur,Qc=0;Qc<En.length&&!at;){var Is=En[Qc],uI=En[Qc+1];for(zt=fo=0;zt<Is.length&&!at&&Is[zt];)if(at=Is[zt++].exec(un))for(tc=0;tc<uI.length;tc++)Ur=at[++fo],typeof(Rn=uI[tc])===h&&Rn.length>0?2===Rn.length?this[Rn[0]]=typeof Rn[1]==d?Rn[1].call(this,Ur):Rn[1]:3===Rn.length?this[Rn[0]]=typeof Rn[1]!==d||Rn[1].exec&&Rn[1].test?Ur?Ur.replace(Rn[1],Rn[2]):a:Ur?Rn[1].call(this,Ur,Rn[2]):a:4===Rn.length&&(this[Rn[0]]=Ur?Rn[3].call(this,Ur.replace(Rn[1],Rn[2])):a):this[Rn]=Ur||a;Qc+=2}},sl=function(un,En){for(var zt in En)if(typeof En[zt]===h&&En[zt].length>0){for(var fo=0;fo<En[zt].length;fo++)if(Ue(En[zt][fo],un))return"?"===zt?a:zt}else if(Ue(En[zt],un))return"?"===zt?a:zt;return un},dI={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},lI={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[T,[v,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[T,[v,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[v,T],[/opios[\/ ]+([\w\.]+)/i],[T,[v,ie+" Mini"]],[/\bopr\/([\w\.]+)/i],[T,[v,ie]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[v,T],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[T,[v,"UC"+q]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[T,[v,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[T,[v,"WeChat"]],[/konqueror\/([\w\.]+)/i],[T,[v,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[T,[v,"IE"]],[/yabrowser\/([\w\.]+)/i],[T,[v,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[v,/(.+)/,"$1 Secure "+q],T],[/\bfocus\/([\w\.]+)/i],[T,[v,_e+" Focus"]],[/\bopt\/([\w\.]+)/i],[T,[v,ie+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[T,[v,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[T,[v,"Dolphin"]],[/coast\/([\w\.]+)/i],[T,[v,ie+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[T,[v,"MIUI "+q]],[/fxios\/([-\w\.]+)/i],[T,[v,_e]],[/\bqihu|(qi?ho?o?|360)browser/i],[[v,"360 "+q]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[v,/(.+)/,"$1 "+q],T],[/(comodo_dragon)\/([\w\.]+)/i],[[v,/_/g," "],T],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[v,T],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[v],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[v,R],T],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[v,T],[/\bgsa\/([\w\.]+) .*safari\//i],[T,[v,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[T,[v,ge+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[v,ge+" WebView"],T],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[T,[v,"Android "+q]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[v,T],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[T,[v,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[T,v],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[v,[T,sl,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[v,T],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[v,"Netscape"],T],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[T,[v,_e+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[v,T],[/(cobalt)\/([\w\.]+)/i],[v,[T,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[M,"amd64"]],[/(ia32(?=;))/i],[[M,Wt]],[/((?:i[346]|x)86)[;\)]/i],[[M,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[M,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[M,"armhf"]],[/windows (ce|mobile); ppc;/i],[[M,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[M,/ower/,"",Wt]],[/(sun4\w)[;\)]/i],[[M,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[M,Wt]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[g,[y,ue],[b,x]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[g,[y,ue],[b,D]],[/\((ip(?:hone|od)[\w ]*);/i],[g,[y,K],[b,D]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[g,[y,K],[b,x]],[/(macintosh);/i],[g,[y,K]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[g,[y,"Sharp"],[b,D]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[g,[y,"Huawei"],[b,x]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[g,[y,"Huawei"],[b,D]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[g,/_/g," "],[y,ht],[b,D]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[g,/_/g," "],[y,ht],[b,x]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[g,[y,"OPPO"],[b,D]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[g,[y,"Vivo"],[b,D]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[g,[y,"Realme"],[b,D]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[g,[y,Fi],[b,D]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[g,[y,Fi],[b,x]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[g,[y,"LG"],[b,x]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[g,[y,"LG"],[b,D]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[g,[y,"Lenovo"],[b,x]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[g,/_/g," "],[y,"Nokia"],[b,D]],[/(pixel c)\b/i],[g,[y,Fe],[b,x]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[g,[y,Fe],[b,D]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[g,[y,ke],[b,D]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[g,"Xperia Tablet"],[y,ke],[b,x]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[g,[y,"OnePlus"],[b,D]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[g,[y,te],[b,x]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[g,/(.+)/g,"Fire Phone $1"],[y,te],[b,D]],[/(playbook);[-\w\),; ]+(rim)/i],[g,y,[b,x]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[g,[y,$],[b,D]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[g,[y,Q],[b,x]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[g,[y,Q],[b,D]],[/(nexus 9)/i],[g,[y,"HTC"],[b,x]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[y,[g,/_/g," "],[b,D]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[g,[y,"Acer"],[b,x]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[g,[y,"Meizu"],[b,D]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[y,g,[b,D]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[y,g,[b,x]],[/(surface duo)/i],[g,[y,Qt],[b,x]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[g,[y,"Fairphone"],[b,D]],[/(u304aa)/i],[g,[y,"AT&T"],[b,D]],[/\bsie-(\w*)/i],[g,[y,"Siemens"],[b,D]],[/\b(rct\w+) b/i],[g,[y,"RCA"],[b,x]],[/\b(venue[\d ]{2,7}) b/i],[g,[y,"Dell"],[b,x]],[/\b(q(?:mv|ta)\w+) b/i],[g,[y,"Verizon"],[b,x]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[g,[y,"Barnes & Noble"],[b,x]],[/\b(tm\d{3}\w+) b/i],[g,[y,"NuVision"],[b,x]],[/\b(k88) b/i],[g,[y,"ZTE"],[b,x]],[/\b(nx\d{3}j) b/i],[g,[y,"ZTE"],[b,D]],[/\b(gen\d{3}) b.+49h/i],[g,[y,"Swiss"],[b,D]],[/\b(zur\d{3}) b/i],[g,[y,"Swiss"],[b,x]],[/\b((zeki)?tb.*\b) b/i],[g,[y,"Zeki"],[b,x]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[y,"Dragon Touch"],g,[b,x]],[/\b(ns-?\w{0,9}) b/i],[g,[y,"Insignia"],[b,x]],[/\b((nxa|next)-?\w{0,9}) b/i],[g,[y,"NextBook"],[b,x]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[y,"Voice"],g,[b,D]],[/\b(lvtel\-)?(v1[12]) b/i],[[y,"LvTel"],g,[b,D]],[/\b(ph-1) /i],[g,[y,"Essential"],[b,D]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[g,[y,"Envizen"],[b,x]],[/\b(trio[-\w\. ]+) b/i],[g,[y,"MachSpeed"],[b,x]],[/\btu_(1491) b/i],[g,[y,"Rotor"],[b,x]],[/(shield[\w ]+) b/i],[g,[y,"Nvidia"],[b,x]],[/(sprint) (\w+)/i],[y,g,[b,D]],[/(kin\.[onetw]{3})/i],[[g,/\./g," "],[y,Qt],[b,D]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[g,[y,fe],[b,x]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[g,[y,fe],[b,D]],[/smart-tv.+(samsung)/i],[y,[b,F]],[/hbbtv.+maple;(\d+)/i],[[g,/^/,"SmartTV"],[y,ue],[b,F]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[y,"LG"],[b,F]],[/(apple) ?tv/i],[y,[g,K+" TV"],[b,F]],[/crkey/i],[[g,ge+"cast"],[y,Fe],[b,F]],[/droid.+aft(\w)( bui|\))/i],[g,[y,te],[b,F]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[g,[y,"Sharp"],[b,F]],[/(bravia[\w ]+)( bui|\))/i],[g,[y,ke],[b,F]],[/(mitv-\w{5}) bui/i],[g,[y,ht],[b,F]],[/Hbbtv.*(technisat) (.*);/i],[y,g,[b,F]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[y,er],[g,er],[b,F]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[b,F]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[y,g,[b,O]],[/droid.+; (shield) bui/i],[g,[y,"Nvidia"],[b,O]],[/(playstation [345portablevi]+)/i],[g,[y,ke],[b,O]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[g,[y,Qt],[b,O]],[/((pebble))app/i],[y,g,[b,j]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[g,[y,K],[b,j]],[/droid.+; (glass) \d/i],[g,[y,Fe],[b,j]],[/droid.+; (wt63?0{2,3})\)/i],[g,[y,fe],[b,j]],[/(quest( 2| pro)?)/i],[g,[y,R],[b,j]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[y,[b,Y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[g,[b,D]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[g,[b,x]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[b,x]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[b,D]],[/(android[-\w\. ]{0,9});.+buil/i],[g,[y,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[T,[v,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[T,[v,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[v,T],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[T,v]],os:[[/microsoft (windows) (vista|xp)/i],[v,T],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[v,[T,sl,dI]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[v,"Windows"],[T,sl,dI]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[T,/_/g,"."],[v,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[v,G],[T,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[T,v],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[v,T],[/\(bb(10);/i],[T,[v,$]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[T,[v,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[T,[v,_e+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[T,[v,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[T,[v,"watchOS"]],[/crkey\/([\d\.]+)/i],[T,[v,ge+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[v,U],T],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[v,T],[/(sunos) ?([\w\.\d]*)/i],[[v,"Solaris"],T],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[v,T]]},eo=function(un,En){if(typeof un===h&&(En=un,un=a),!(this instanceof eo))return new eo(un,En).getResult();var zt=typeof r!==l&&r.navigator?r.navigator:a,fo=un||(zt&&zt.userAgent?zt.userAgent:""),tc=zt&&zt.userAgentData?zt.userAgentData:a,Rn=En?function(at,Ur){var Qc={};for(var Is in at)Qc[Is]=Ur[Is]&&Ur[Is].length%2==0?Ur[Is].concat(at[Is]):at[Is];return Qc}(lI,En):lI;return this.getBrowser=function(){var Ur,at={};return at[v]=a,at[T]=a,Ho.call(at,fo,Rn.browser),at[_]=typeof(Ur=at[T])===f?Ur.replace(/[^\d\.]/g,"").split(".")[0]:a,zt&&zt.brave&&typeof zt.brave.isBrave==d&&(at[v]="Brave"),at},this.getCPU=function(){var at={};return at[M]=a,Ho.call(at,fo,Rn.cpu),at},this.getDevice=function(){var at={};return at[y]=a,at[g]=a,at[b]=a,Ho.call(at,fo,Rn.device),!at[b]&&tc&&tc.mobile&&(at[b]=D),"Macintosh"==at[g]&&zt&&typeof zt.standalone!==l&&zt.maxTouchPoints&&zt.maxTouchPoints>2&&(at[g]="iPad",at[b]=x),at},this.getEngine=function(){var at={};return at[v]=a,at[T]=a,Ho.call(at,fo,Rn.engine),at},this.getOS=function(){var at={};return at[v]=a,at[T]=a,Ho.call(at,fo,Rn.os),!at[v]&&tc&&"Unknown"!=tc.platform&&(at[v]=tc.platform.replace(/chrome os/i,U).replace(/macos/i,G)),at},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return fo},this.setUA=function(at){return fo=typeof at===f&&at.length>350?er(at,350):at,this},this.setUA(fo),this};eo.VERSION="0.7.34",eo.BROWSER=se([v,T,_]),eo.CPU=se([M]),eo.DEVICE=se([g,y,b,O,D,F,x,j,Y]),eo.ENGINE=eo.OS=se([v,T]),s.exports&&(i=s.exports=eo),i.UAParser=eo;var Lu=typeof r!==l&&(r.jQuery||r.Zepto);if(Lu&&!Lu.ua){var Up=new eo;Lu.ua=Up.getResult(),Lu.ua.get=function(){return Up.getUA()},Lu.ua.set=function(un){Up.setUA(un);var En=Up.getResult();for(var zt in En)Lu.ua[zt]=En[zt]}}}("object"==typeof window?window:Ys)}(zh,zh.exports);const UC=new(Rt(zh.exports));let Tc=UC.getResult(),VC=null;function lt(s){if(!VC){s&&UC.setUA(s),Tc=UC.getResult();const i=function(l){if("Blink"===l.engine.name&&"WeChat"!==l.browser.name)return gt.CHROME;switch(l.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return gt.CHROME;case"Safari":case"Mobile Safari":return gt.SAFARI;case"Edge":return gt.EDGE;case"Firefox":return gt.FIREFOX;case"QQBrowser":return gt.QQ;case"Opera":return gt.OPERA;case"WeChat":return gt.WECHAT;default:return l.browser.name||""}}(Tc),r=function(l){let h;return h="Blink"===l.engine.name?l.engine.version||"":l.browser.version||"",h.split(".")[0]}(Tc),a="Windows"===(l=Tc).os.name?l.os.version?l.os.name+" "+l.os.version:l.os.name:l.os.name||"",d=Tc.os.version;if(!(i&&r&&a&&d))return{name:i,version:r,os:a,osVersion:d};VC={name:i,version:r,os:a,osVersion:d}}var l;return VC}function qE(){return lt().os}function ID(){const s=lt();return"".concat(s.os," ").concat(s.osVersion)}function KE(){const s=lt();return!!("WebKit"===Tc.engine.name&&s.os===Zn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&s.name!==gt.SAFARI||Pi()&&s.name!==gt.SAFARI)}function um(){return lt().name===gt.CHROME}function fr(){return lt().name===gt.SAFARI}function Pt(){return lt().name===gt.FIREFOX}function Pi(){return lt().os===Zn.IOS}function hm(s){const i=lt();return!(i.name!==gt.CHROME||!i.osVersion)&&Number(i.version)>=s}function AD(s){const i=lt();return!(i.name!==gt.EDGE||!i.osVersion)&&Number(i.version)>=s}function LL(s){const i=lt();return!(i.name!==gt.OPERA||!i.osVersion)&&Number(i.version)>=s}function FL(){const s=lt();return!(s.name!==gt.CHROME||!s.osVersion)&&Number(s.version)<=90}function DD(){const s=lt();if(s.os!==Zn.IOS||!s.osVersion)return!1;const i=s.osVersion.split(".");return Number(i[0])<14||14===Number(i[0])&&Number(i[1])<=6}function qh(){const s=lt();if(s.os!==Zn.IOS||!s.osVersion)return!1;const i=s.osVersion.split(".");return 15===Number(i[0])}function OD(){const s=lt();if(s.os!==Zn.IOS||!s.osVersion)return!1;const i=s.osVersion.split(".");return 16===Number(i[0])}function ND(){const s=lt();if(s.os!==Zn.IOS||!s.osVersion)return!1;const i=s.osVersion.split(".");return 15===Number(i[0])&&Number(i[1])>=1}function Ic(){return fr()&&navigator.maxTouchPoints>0}function PD(){return lt().name===gt.WECHAT}function MD(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function Rd(){const s=lt();return s.name!==gt.EDGE&&s.name!==gt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Kh(){return qE()===Zn.ANDROID}function wc(){const s=lt();return Kh()&&(s.name===gt.CHROME||s.name===gt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}var k;!function(s){s.UNEXPECTED_ERROR="UNEXPECTED_ERROR",s.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",s.TIMEOUT="TIMEOUT",s.INVALID_PARAMS="INVALID_PARAMS",s.NOT_READABLE="NOT_READABLE",s.NOT_SUPPORTED="NOT_SUPPORTED",s.INVALID_OPERATION="INVALID_OPERATION",s.OPERATION_ABORTED="OPERATION_ABORTED",s.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",s.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",s.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",s.DATACHANNEL_FAILED="DATACHANNEL_FAILED",s.NETWORK_ERROR="NETWORK_ERROR",s.NETWORK_TIMEOUT="NETWORK_TIMEOUT",s.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",s.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",s.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",s.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",s.ELECTRON_IS_NULL="ELECTRON_IS_NULL",s.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",s.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",s.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",s.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",s.PERMISSION_DENIED="PERMISSION_DENIED",s.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",s.TRACK_IS_DISABLED="TRACK_IS_DISABLED",s.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",s.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",s.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",s.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",s.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",s.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",s.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",s.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",s.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",s.UID_CONFLICT="UID_CONFLICT",s.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",s.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",s.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",s.INVALID_TRACK="INVALID_TRACK",s.SENDER_NOT_FOUND="SENDER_NOT_FOUND",s.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",s.SET_ANSWER_FAILED="SET_ANSWER_FAILED",s.ICE_FAILED="ICE_FAILED",s.PC_CLOSED="PC_CLOSED",s.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",s.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",s.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",s.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",s.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",s.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",s.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",s.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",s.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",s.INVALID_REMOTE_USER="INVALID_REMOTE_USER",s.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",s.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",s.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",s.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",s.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",s.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",s.WS_ABORT="WS_ABORT",s.WS_DISCONNECT="WS_DISCONNECT",s.WS_ERR="WS_ERR",s.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",s.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",s.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",s.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",s.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",s.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",s.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",s.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",s.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",s.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",s.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",s.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",s.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",s.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",s.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",s.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",s.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",s.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",s.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",s.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",s.INVALID_PLUGIN="INVALID_PLUGIN",s.DISCONNECT_P2P="DISCONNECT_P2P",s.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",s.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",s.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",s.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",s.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",s.PROHIBITED_OPERATION="PROHIBITED_OPERATION",s.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",s.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED"}(k||(k={}));let ee=class extends Error{constructor(s){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(i),C(this,"code",void 0),C(this,"message",void 0),C(this,"data",void 0),C(this,"name","AgoraRTCException"),this.code=s,this.message="AgoraRTCError ".concat(this.code,": ").concat(i),this.data=r}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),"\n").concat(this.stack):"".concat(this.stack)}print(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",i=arguments.length>1?arguments[1]:void 0;return"error"===s&&(i||console).error(this.toString()),"warning"===s&&(i||console).warn(this.toString()),this}throw(s){throw this.print("error",s),this}};function Rc(s,i){if("boolean"!=typeof s)throw new ee(k.INVALID_PARAMS,"Invalid ".concat(i,": The value is of the boolean type."))}function Cn(s,i,r){if(!ye(r).call(r,s))throw new ee(k.INVALID_PARAMS,"".concat(i," can only be set as ").concat(JSON.stringify(r)))}function At(s,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(s<r||s>a||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&("number"!=typeof(d=s)||d%1!=0))throw new ee(k.INVALID_PARAMS,"invalid ".concat(i,": the value range is [").concat(r,", ").concat(a,"]. integer only"));var d}function BC(s,i){if("number"!=typeof s){if(!(s.min||s.max||s.ideal||s.exact))throw new ee(k.INVALID_PARAMS,"".concat(i," is not a valid ConstrainLong"));void 0!==s.min&&At(s.min,"".concat(i,".min"),0,1/0),void 0!==s.max&&At(s.max,"".concat(i,".max"),1,1/0),void 0!==s.exact&&At(s.exact,"".concat(i,".exact"),1,1/0),void 0!==s.ideal&&At(s.ideal,"".concat(i,".ideal"),1,1/0)}else At(s,i,1,1/0)}function hi(s,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,d=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==s)throw new ee(k.INVALID_PARAMS,"".concat(i||"param"," cannot be empty"));if(!jC(s,r,a,d))throw new ee(k.INVALID_PARAMS,"Invalid ".concat(i||"string param",": Length of the string: [").concat(r,",").concat(a,"].").concat(d?" ASCII characters only.":""))}function Fa(s,i){if(!Array.isArray(s))throw new ee(k.INVALID_PARAMS,"".concat(i," should be an array"))}function tn(s){return null==s}function jC(s){return"string"==typeof s&&s.length<=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:255)&&s.length>=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)&&(!(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])||function(d){if("string"!=typeof d)return!1;for(let l=0;l<d.length;l+=1){const h=d.charCodeAt(l);if(h<0||h>255)return!1}return!0}(s))}function pm(s,i,r){if("getBigUint64"in DataView.prototype)return s.getBigUint64(i,r);const a=s.getUint32(i,r),d=s.getUint32(i+4,r),l=+!!r,h=+!r;return BigInt(a*h+d*l)<<BigInt(32)|BigInt(a*l+d*h)}function xD(s,i,r,a){if("setBigUint64"in DataView.prototype)return s.setBigUint64(i,r,a);const d=Number(r>>BigInt(32)),l=Number(r&BigInt(4294967295));a?(s.setUint32(i+4,d,a),s.setUint32(i,l,a)):(s.setUint32(i,d,a),s.setUint32(i+4,l,a))}var Yh,YE;(function(s){s.COVERED="COVERED",s.POSITION="POSITION",s.SIZE="SIZE",s.STYLE="STYLE"})(Yh||(Yh={})),function(s){s.UNMOUNTED="UNMOUNTED",s.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(YE||(YE={}));const kD=new class{constructor(){C(this,"_clientSize",null),C(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),C(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),C(this,"getStyle",s=>window.getComputedStyle(s,null)),C(this,"checkCssVisibleProperty",s=>{var i;let r=!0;const a=this.getStyle(s),{display:d,visibility:l,opacity:h,filter:f}=a;return("none"===d||ye(i=["hidden","collapse"]).call(i,l)||Number(h)<.1)&&(r=!1),!!r&&(f&&f.split(" ").filter(_=>{var g;const v=_.split("(")[0];return ye(g=["brightness","blur","opacity"]).call(g,v)}).map(_=>{const[g,v]=_.split(/\(|\)/);return[g,Number(v.match(/^[0-9\.]+/))]}).forEach(_=>{const[g,v]=_;switch(g){case"brightness":(v<.1||v>3)&&(r=!1);break;case"blur":v>3&&(r=!1);break;case"opacity":v<.1&&(r=!1)}}),r)}),C(this,"checkPropertyUpToAllParentNodes",(s,i)=>{let r=!0,a=!0;let l=s;for(;l&&a;)i(l)||(r=!1,a=!1),l=l.parentElement,l||(a=!1);return r}),C(this,"checkActualCssVisibleIncludeInherit",s=>this.checkPropertyUpToAllParentNodes(s,this.checkCssVisibleProperty)),C(this,"getSizeAboutClient",s=>{const{width:i,height:r,left:a,right:d,top:l,bottom:h}=s.getBoundingClientRect(),f=this.getClientWidth(),_=this.getClientHeight();return{width:i,height:r,left:a,right:d,top:l,bottom:h,clientWidth:f,clientHeight:_,clientMin:Math.min(f,_)}}),C(this,"checkActualSize",()=>{const{width:s,height:i,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(s,i,r)}),C(this,"elementFromPoint",(s,i)=>document.elementFromPoint?document.elementFromPoint(s,i):null),C(this,"checkCoverForAPoint",(s,i,r)=>{const a=this.elementFromPoint(s,i);return null!==a&&a!==r}),C(this,"getPointPositionList",()=>{const{width:s,height:i,left:r,top:a}=this._clientSize,d=s/6,l=i/6,h=[],f=10**6;for(let _=0;_<5;_++)for(let g=0;g<5;g++)h.push({x:(r*f+(0===_?.1:4===_?(d*_*f-1e5)/f:d*_)*f)/f,y:(a*f+(0===g?.1:4===g?(l*g*f-1e5)/f:l*g)*f)/f});return[...h]}),C(this,"checkElementCover",s=>this.getPointPositionList().map(i=>this.checkCoverForAPoint(i.x,i.y,s)).filter(i=>!!i).length>6),C(this,"checkSizeIsVisible",(s,i,r)=>(s>50||r/s<=10)&&(i>50||r/i<=10)),C(this,"checkSizeOfPartInClient",()=>{const{left:s,right:i,top:r,bottom:a,clientHeight:d,clientWidth:l,clientMin:h}=this._clientSize;let f,_,g,v;if(s<0)f=0;else{if(!(s<l))return!1;f=s}if(i<0)return!1;if(_=i<l?i:l,r<0)g=0;else{if(!(r<d))return!1;g=r}return!(a<0)&&(v=a<d?a:d,this.checkSizeIsVisible(_-f,v-g,h))}),C(this,"returnHiddenResult",s=>(this._clientSize=null,{visible:!1,reason:s})),C(this,"checkOneElementVisible",s=>{if(s instanceof HTMLElement){if(this.checkElementIsMountedOnDom(s)){if(this.checkActualCssVisibleIncludeInherit(s)){if(this._clientSize=this.getSizeAboutClient(s),this.checkElementCover(s))return this.returnHiddenResult(Yh.COVERED);{const i=this.checkActualSize(),r=this.checkSizeOfPartInClient();return i&&!r?this.returnHiddenResult(Yh.POSITION):i?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Yh.SIZE)}}return this.returnHiddenResult(Yh.STYLE)}return this.returnHiddenResult(YE.UNMOUNTED)}return this.returnHiddenResult(YE.INVALID_HTML_ELEMENT)}),C(this,"checkElementIsMountedOnDom",s=>this.checkPropertyUpToAllParentNodes(s,i=>"HTML"!==i.nodeName.toUpperCase()?null!==i.parentElement:!!document.documentElement))}};function HC(s){return(new TextEncoder).encode(s)}const $E=function(s,i){const r=new Uint8Array(s.byteLength+i.byteLength);return r.set(new Uint8Array(s),0),r.set(new Uint8Array(i),s.byteLength),r},fm=function(){var s=L(function*(i){const r=function(h){const f=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),_=new Uint8Array(new ArrayBuffer(f.length));for(let g=0;g<f.length;g+=1)_[g]=f.charCodeAt(g);return _}(),a=yield window.crypto.subtle.importKey("spki",r,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),d=HC(i),l=yield window.crypto.subtle.encrypt({name:"RSA-OAEP"},a,d);return function(h){let f="";for(let _=0;_<h.length;_+=1)f+=String.fromCharCode(h[_]);return window.btoa(f)}(new Uint8Array(l))});return function(r){return s.apply(this,arguments)}}(),$h=function(){var s=L(function*(i){return function(r,a){let d="";return new Uint8Array(r).forEach(l=>{d+=l.toString(16).padStart(2,"0")}),d}(yield crypto.subtle.digest("SHA-256",HC(i)))});return function(r){return s.apply(this,arguments)}}();class jt{constructor(){C(this,"_events",{}),C(this,"addListener",this.on)}getListeners(i){return this._events[i]?this._events[i].map(r=>r.listener):[]}on(i,r){this._events[i]||(this._events[i]=[]);const a=this._events[i];-1===this._indexOfListener(a,r)&&a.push({listener:r,once:!1})}once(i,r){this._events[i]||(this._events[i]=[]);const a=this._events[i];-1===this._indexOfListener(a,r)&&a.push({listener:r,once:!0})}off(i,r){if(!this._events[i])return;const a=this._events[i],d=this._indexOfListener(a,r);-1!==d&&a.splice(d,1),0===this._events[i].length&&delete this._events[i]}removeAllListeners(i){i?delete this._events[i]:this._events={}}emit(i){this._events[i]||(this._events[i]=[]);const r=this._events[i].map(h=>h);for(var a=arguments.length,d=new Array(a>1?a-1:0),l=1;l<a;l++)d[l-1]=arguments[l];for(let h=0;h<r.length;h+=1){const f=r[h];f.once&&this.off(i,f.listener),f.listener.apply(this,d||[])}}safeEmit(i){for(var r=arguments.length,a=new Array(r>1?r-1:0),d=1;d<r;d++)a[d-1]=arguments[d];[...this._events[i]||[]].forEach(l=>{l.once&&this.off(i,l.listener);try{l.listener.apply(this,a)}catch(h){console.error("safeEmit event:".concat(i," error ").concat(h?.toString()))}})}_indexOfListener(i,r){let a=i.length;for(;a--;)if(i[a].listener===r)return a;return-1}}let XE=null;function LD(){if(XE)return XE;if(window.electron)return XE=window.electron;if(!window.require)return null;try{return XE=window.require("electron"),XE}catch{return null}}var qn,Kt,GC,ze,$e,_i,$i,Ac;function FD(s){return At(s.timeout,"config.timeout",0,1e5),At(s.timeoutFactor,"config.timeoutFactor",0,100,!1),At(s.maxRetryCount,"config.maxRetryConfig",0,1/0),At(s.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function oa(s){if(!Array.isArray(s)||s.length<1)return!1;try{s.forEach(i=>{if(!i.urls)throw Error()})}catch{return!1}return!0}function Xh(s){return hi(s.turnServerURL,"turnServerURL"),hi(s.username,"username"),hi(s.password,"password"),s.udpport&&At(s.udpport,"udpport",1,99999,!0),s.forceturn&&Rc(s.forceturn,"forceturn"),s.security&&Rc(s.security,"security"),s.tcpport&&At(s.tcpport,"tcpport",1,99999,!0),!0}function WC(s){return void 0!==s.level&&Cn(s.level,"level",[1,2,3]),void 0!==s.delay&&At(s.delay,"delay",0,3e3,!0),!0}function nn(s,i){for(var r=arguments.length,a=new Array(r>2?r-2:0),d=2;d<r;d++)a[d-2]=arguments[d];return 0===s.getListeners(i).length?X.reject(new ee(k.UNEXPECTED_ERROR,"can not emit promise")):new X((l,h)=>{s.emit(i,...a,l,h)})}function Tt(s,i){if(0===s.getListeners(i).length)return X.resolve();for(var r=arguments.length,a=new Array(r>2?r-2:0),d=2;d<r;d++)a[d-2]=arguments[d];return nn(s,i,...a)}function Mr(s,i){if(0===s.getListeners(i).length)return null;for(var r=arguments.length,a=new Array(r>2?r-2:0),d=2;d<r;d++)a[d-2]=arguments[d];return mr(s,i,...a)}function mr(s,i){let r=null,a=null;for(var d=arguments.length,l=new Array(d>2?d-2:0),h=2;h<d;h++)l[h-2]=arguments[h];if(s.emit(i,...l,f=>{r=f},f=>{a=f}),null!==a)throw a;if(null===r)throw new ee(k.UNEXPECTED_ERROR,"handler is not sync");return r}(function(s){s.CREATE_CLIENT="createClient",s.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",s.SET_AREA="setArea",s.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",s.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",s.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",s.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",s.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",s.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",s.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",s.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",s.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",s.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",s.START_PROXY_SERVER="Client.startProxyServer",s.STOP_PROXY_SERVER="Client.stopProxyServer",s.SET_PROXY_SERVER="Client.setProxyServer",s.SET_TURN_SERVER="Client.setTurnServer",s.SET_CLIENT_ROLE="Client.setClientRole",s.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",s.ENABLE_DUAL_STREAM="Client.enableDualStream",s.DISABLE_DUAL_STREAM="Client.disableDualStream",s.JOIN="Client.join",s.LEAVE="Client.leave",s.PUBLISH="Client.publish",s.UNPUBLISH="Client.unpublish",s.SUBSCRIBE="Client.subscribe",s.MASS_SUBSCRIBE="Client.massSubscribe",s.MASS_UNSUBSCRIBE="Client.massUnsubscribe",s.UNSUBSCRIBE="Client.unsubscribe",s.RENEW_TOKEN="Client.renewToken",s.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",s.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",s.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",s.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",s.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",s.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",s.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",s.DATACHANNEL_FAILBACK="Client._datachannelFailback",s.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",s.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",s.START_LIVE_STREAMING="Client.startLiveStreaming",s.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",s.STOP_LIVE_STREAMING="Client.stopLiveStreaming",s.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",s.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",s.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",s.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",s.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",s.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",s.SET_CONFIG_DISTRIBUTE="_configDistribute",s.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",s.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",s.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",s.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",s.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",s.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",s.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",s.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",s.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",s.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",s.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",s.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",s.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",s.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",s.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",s.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",s.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",s.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",s.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",s.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",s.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",s.STREAM_TYPE_CHANGE="streamTypeChange",s.CONNECTION_STATE_CHANGE="connectionStateChange",s.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",s.IMAGE_MODERATION_UPLOAD="imageModerationUpload"})(qn||(qn={})),function(s){s.TRACER="tracer"}(Kt||(Kt={})),function(s){s[s.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",s[s.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",s[s.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(GC||(GC={})),function(s){s.LEAVE="LEAVE",s.NETWORK_ERROR="NETWORK_ERROR",s.SERVER_ERROR="SERVER_ERROR",s.UID_BANNED="UID_BANNED",s.IP_BANNED="IP_BANNED",s.CHANNEL_BANNED="CHANNEL_BANNED",s.FALLBACK="FALLBACK",s.LICENSE_MISSING="LICENSE_MISSING",s.LICENSE_EXPIRED="LICENSE_EXPIRED",s.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",s.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",s.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",s.LICENSE_ILLEGAL="LICENSE_ILLEGAL",s.TOKEN_EXPIRE="TOKEN_EXPIRE"}(ze||(ze={})),function(s){s.CONNECTION_STATE_CHANGE="connection-state-change",s.MEDIA_RECONNECT_START="media-reconnect-start",s.MEDIA_RECONNECT_END="media-reconnect-end",s.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",s.USER_JOINED="user-joined",s.USER_LEAVED="user-left",s.USER_PUBLISHED="user-published",s.USER_UNPUBLISHED="user-unpublished",s.USER_INFO_UPDATED="user-info-updated",s.CLIENT_BANNED="client-banned",s.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",s.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",s.VOLUME_INDICATOR="volume-indicator",s.CRYPT_ERROR="crypt-error",s.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",s.NETWORK_QUALITY="network-quality",s.STREAM_TYPE_CHANGED="stream-type-changed",s.STREAM_FALLBACK="stream-fallback",s.RECEIVE_METADATA="receive-metadata",s.STREAM_MESSAGE="stream-message",s.LIVE_STREAMING_ERROR="live-streaming-error",s.LIVE_STREAMING_WARNING="live-streaming-warning",s.INJECT_STREAM_STATUS="stream-inject-status",s.EXCEPTION="exception",s.ERROR="error",s.P2P_LOST="p2p_lost",s.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",s.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",s.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",s.PUBLISHED_USER_LIST="published-user-list",s.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",s.CONTENT_INSPECT_ERROR="content-inspect-error",s.CONTENT_INSPECT_RESULT="content-inspect-result",s.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}($e||($e={})),function(s){s.NETWORK_ERROR="NETWORK_ERROR",s.SERVER_ERROR="SERVER_ERROR",s.MULTI_IP="MULTI_IP",s.TIMEOUT="TIMEOUT",s.OFFLINE="OFFLINE",s.LEAVE="LEAVE",s.P2P_FAILED="P2P_FAILED",s.FALLBACK="FALLBACK"}(_i||(_i={})),function(s){s.ONLINE="ONLINE",s.OFFLINE="OFFLINE"}($i||($i={})),function(s){s.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",s.ONLINE="ONLINE",s.OFFLINE="OFFLINE"}(Ac||(Ac={}));const Fn=new class extends jt{set networkState(s){this.emit(Ac.NETWORK_STATE_CHANGE,s,this._networkState),s===$i.ONLINE?this.emit(Ac.ONLINE):s===$i.OFFLINE&&(this.onlineWaiter=new X(i=>{this.once(Ac.ONLINE,()=>{this.onlineWaiter=void 0,i($i.ONLINE)})}),this.emit(Ac.OFFLINE)),this._networkState=s}get networkState(){return this._networkState}get isOnline(){return this._networkState===$i.ONLINE}constructor(){super(),C(this,"_moduleName","network-indicator"),C(this,"_networkState",$i.ONLINE),C(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=$i.ONLINE}),window.addEventListener("offline",()=>{this.networkState=$i.OFFLINE})}};function UD(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Ad(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?UD(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):UD(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function mm(s,i){const r=s.indexOf(i);-1!==r&&s.splice(r,1)}function Dd(s){const i=[];return s.forEach(r=>{-1===i.indexOf(r)&&i.push(r)}),i}function _m(s){void 0!==X?X.resolve().then(s):setTimeout(s,0)}function Ft(s){return JSON.parse(JSON.stringify(s))}function Od(s){try{return Ft(s)}catch{return s}}const JE={};function Jh(s,i){JE[i]||(JE[i]=!0,s())}function gm(s){const i=window.atob(s),r=new Uint8Array(new ArrayBuffer(i.length));for(let a=0;a<i.length;a+=1)r[a]=i.charCodeAt(a);return r}function Qh(s){let i="";for(let r=0;r<s.length;r+=1)i+=String.fromCharCode(s[r]);return window.btoa(i)}function Ua(s){return window.TextEncoder?(new TextEncoder).encode(s).length:s.length}function VD(s){let i=0;return/DingTalk/i.test(navigator.userAgent)&&s.realFormData&&(s=s.realFormData),s.forEach(r=>{i+="string"==typeof r?Ua(r):r.size}),i+138}function Va(s){const i=new ee(k.TIMEOUT,"timeout");return new X((r,a)=>{window.setTimeout(()=>a(i),s)})}function Un(s){return new X(i=>{window.setTimeout(i,s)})}function qe(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,i=arguments.length>1?arguments[1]:void 0;const r=Math.random().toString(16).substr(2,s).toLowerCase();return r.length===s?"".concat(i).concat(r):"".concat(i).concat(r)+qe(s-r.length,"")}function Dc(){return qe(32,"").toUpperCase()}const Jl=()=>{},is=new class{constructor(){C(this,"fnMap",new Map)}throttleByKey(s,i,r,a){for(var d=arguments.length,l=new Array(d>4?d-4:0),h=4;h<d;h++)l[h-4]=arguments[h];if(this.fnMap.has(i)){const f=this.fnMap.get(i);if(f.threshold!==r){f.fn(...f.args),clearTimeout(f.timer);const _=window.setTimeout(()=>{const g=this.fnMap.get(i);g&&g.fn(...g.args),this.fnMap.delete(i)},r);this.fnMap.set(i,{fn:s,threshold:r,timer:_,args:l,skipFn:a})}else f.skipFn&&f.skipFn(...f.args),this.fnMap.set(i,Ad(Ad({},f),{},{fn:s,args:l,skipFn:a}))}else{const f=window.setTimeout(()=>{const _=this.fnMap.get(i);_&&_.fn(..._.args),this.fnMap.delete(i)},r);this.fnMap.set(i,{fn:s,threshold:r,timer:f,args:l,skipFn:a})}}},BD=is.throttleByKey.bind(is);function Tn(s){return"object"==typeof s&&null!==s&&!(s instanceof RegExp)}function QE(s,i){if(!Tn(s)||!Tn(i)||Array.isArray(s)&&!Array.isArray(i)||!Array.isArray(s)&&Array.isArray(i))return i;if(Array.isArray(i)&&Array.isArray(s)){const r=[...s];for(let a=0;a<i.length;a++)r[a]=QE(s[a],i[a]);return r}{const r=Ad({},s);for(const a in i)Object.prototype.hasOwnProperty.call(i,a)&&(r[a]=Object.prototype.hasOwnProperty.call(s,a)?QE(s[a],i[a]):i[a]);return r}}let jD=1,ZE=console;class gi{static setLogger(i){ZE=i}constructor(i){C(this,"lockingPromise",X.resolve()),C(this,"locks",0),C(this,"name",""),C(this,"lockId",void 0),this.lockId=jD++,i&&(this.name=i),ZE.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(i){let r;this.locks+=1,ZE.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat("string"==typeof i?i:""));const a=new X(l=>{r=()=>{this.locks-=1,ZE.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat("string"==typeof i?i:"")),l()}}),d=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>a),d}}function ei(s,i){return function(r,a,d){const l=d.value;if("function"!=typeof l)throw new Error("Cannot use mutex on object property.");return d.value=L(function*(){const h=this[i];if(!h)throw new Error("mutex property key ".concat(i," doesn't exist on ").concat(s));const f=yield h.lock("From ".concat(s,".").concat(a));try{for(var _=arguments.length,g=new Array(_),v=0;v<_;v++)g[v]=arguments[v];return yield l.apply(this,g)}finally{f()}}),d}}const Pn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function ev(s,i){const r=Math.floor(i.timeout*Math.pow(i.timeoutFactor,s));return Math.min(i.maxRetryTimeout,r)}function In(s,i,r,a){const d=Object.assign({},Pn,a);let l=d.timeout;const h=function(){var g=L(function*(){var v;yield(v=l,new X(b=>{window.setTimeout(b,v)})),l*=d.timeoutFactor,l=Math.min(d.maxRetryTimeout,l)});return function(){return g.apply(this,arguments)}}();let f=!1;const _=new X(function(){var g=L(function*(v,b){i=i||(()=>!1),r=r||(()=>!0);for(let y=0;y<d.maxRetryCount;y+=1){if(f)return b(new ee(k.OPERATION_ABORTED));try{const T=yield s();if(!i(T,y)||y+1===d.maxRetryCount)return v(T);yield h()}catch(T){if(!r(T,y)||y+1===d.maxRetryCount)return b(T);yield h()}}});return function(v,b){return g.apply(this,arguments)}}());return _.cancel=()=>f=!0,_}var Em=Ko,Zh=bl,tv=oy,vm=Ia,nv=TypeError,zC=function(s){return function(i,r,a,d){Em(r);var l=Zh(i),h=tv(l),f=vm(l),_=s?f-1:0,g=s?-1:1;if(a<2)for(;;){if(_ in h){d=h[_],_+=g;break}if(_+=g,s?_<0:f<=_)throw nv("Reduce of empty array with no initial value")}for(;s?_>=0:f>_;_+=g)_ in h&&(d=r(d,h[_],_,l));return d}},HD=[zC(!1),zC(!0)][0];Bt({target:"Array",proto:!0,forced:!Jf&&El>79&&El<83||!EE("reduce")},{reduce:function(s){var i=arguments.length;return HD(this,s,i,i>1?arguments[1]:void 0)}});var GD=hc("Array").reduce,iv=Ds,qC=GD,rv=Array.prototype,Ba=Rt(function(s){var i=s.reduce;return s===rv||iv(rv,s)&&i===rv.reduce?qC:i});let Oc=class{constructor(s){C(this,"input",[]),C(this,"size",void 0),this.size=s}add(s){this.input.push(s),this.input.length>this.size&&this.input.splice(0,1)}mean(){var s;return 0===this.input.length?0:Ba(s=this.input).call(s,(i,r)=>i+r)/this.input.length}};var KC,Ro={exports:{}},WD=function(s,i){return function(){for(var r=new Array(arguments.length),a=0;a<r.length;a++)r[a]=arguments[a];return s.apply(i,r)}},UL=WD,bm=Object.prototype.toString,ov=(KC=Object.create(null),function(s){var i=bm.call(s);return KC[i]||(KC[i]=i.slice(8,-1).toLowerCase())});function Nd(s){return s=s.toLowerCase(),function(i){return ov(i)===s}}function YC(s){return Array.isArray(s)}function $C(s){return void 0===s}var zD=Nd("ArrayBuffer");function ym(s){return null!==s&&"object"==typeof s}function ep(s){if("object"!==ov(s))return!1;var i=Object.getPrototypeOf(s);return null===i||i===Object.prototype}var XC=Nd("Date"),tp=Nd("File"),qD=Nd("Blob"),KD=Nd("FileList");function Pd(s){return"[object Function]"===bm.call(s)}var JC=Nd("URLSearchParams");function Sm(s,i){if(null!=s)if("object"!=typeof s&&(s=[s]),YC(s))for(var r=0,a=s.length;r<a;r++)i.call(null,s[r],r,s);else for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&i.call(null,s[d],d,s)}var sv,YD=(sv=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(s){return sv&&s instanceof sv}),_r={isArray:YC,isArrayBuffer:zD,isBuffer:function(s){return null!==s&&!$C(s)&&null!==s.constructor&&!$C(s.constructor)&&"function"==typeof s.constructor.isBuffer&&s.constructor.isBuffer(s)},isFormData:function(s){var i="[object FormData]";return s&&("function"==typeof FormData&&s instanceof FormData||bm.call(s)===i||Pd(s.toString)&&s.toString()===i)},isArrayBufferView:function(s){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(s):s&&s.buffer&&zD(s.buffer)},isString:function(s){return"string"==typeof s},isNumber:function(s){return"number"==typeof s},isObject:ym,isPlainObject:ep,isUndefined:$C,isDate:XC,isFile:tp,isBlob:qD,isFunction:Pd,isStream:function(s){return ym(s)&&Pd(s.pipe)},isURLSearchParams:JC,isStandardBrowserEnv:function(){return(typeof navigator>"u"||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&typeof window<"u"&&typeof document<"u"},forEach:Sm,merge:function s(){var i={};function r(l,h){i[h]=ep(i[h])&&ep(l)?s(i[h],l):ep(l)?s({},l):YC(l)?l.slice():l}for(var a=0,d=arguments.length;a<d;a++)Sm(arguments[a],r);return i},extend:function(s,i,r){return Sm(i,function(a,d){s[d]=r&&"function"==typeof a?UL(a,r):a}),s},trim:function(s){return s.trim?s.trim():s.replace(/^\s+|\s+$/g,"")},stripBOM:function(s){return 65279===s.charCodeAt(0)&&(s=s.slice(1)),s},inherits:function(s,i,r,a){s.prototype=Object.create(i.prototype,a),s.prototype.constructor=s,r&&Object.assign(s.prototype,r)},toFlatObject:function(s,i,r){var a,d,l,h={};i=i||{};do{for(d=(a=Object.getOwnPropertyNames(s)).length;d-- >0;)h[l=a[d]]||(i[l]=s[l],h[l]=!0);s=Object.getPrototypeOf(s)}while(s&&(!r||r(s,i))&&s!==Object.prototype);return i},kindOf:ov,kindOfTest:Nd,endsWith:function(s,i,r){s=String(s),(void 0===r||r>s.length)&&(r=s.length);var a=s.indexOf(i,r-=i.length);return-1!==a&&a===r},toArray:function(s){if(!s)return null;var i=s.length;if($C(i))return null;for(var r=new Array(i);i-- >0;)r[i]=s[i];return r},isTypedArray:YD,isFileList:KD},np=_r;function $D(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Ql=function(s,i,r){if(!i)return s;var a;if(r)a=r(i);else if(np.isURLSearchParams(i))a=i.toString();else{var d=[];np.forEach(i,function(h,f){null!=h&&(np.isArray(h)?f+="[]":h=[h],np.forEach(h,function(_){np.isDate(_)?_=_.toISOString():np.isObject(_)&&(_=JSON.stringify(_)),d.push($D(f)+"="+$D(_))}))}),a=d.join("&")}if(a){var l=s.indexOf("#");-1!==l&&(s=s.slice(0,l)),s+=(-1===s.indexOf("?")?"?":"&")+a}return s},XD=_r;function av(){this.handlers=[]}av.prototype.use=function(s,i,r){return this.handlers.push({fulfilled:s,rejected:i,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},av.prototype.eject=function(s){this.handlers[s]&&(this.handlers[s]=null)},av.prototype.forEach=function(s){XD.forEach(this.handlers,function(i){null!==i&&s(i)})};var JD,QD,ZD=av,eO=_r;function ip(){if(QD)return JD;QD=1;var s=_r;function i(d,l,h,f,_){Error.call(this),this.message=d,this.name="AxiosError",l&&(this.code=l),h&&(this.config=h),f&&(this.request=f),_&&(this.response=_)}s.inherits(i,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var r=i.prototype,a={};return["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(d){a[d]={value:d}}),Object.defineProperties(i,a),Object.defineProperty(r,"isAxiosError",{value:!0}),i.from=function(d,l,h,f,_,g){var v=Object.create(r);return s.toFlatObject(d,v,function(b){return b!==Error.prototype}),i.call(v,d.message,l,h,f,_),v.name=d.name,g&&Object.assign(v,g),v},JD=i}var tO,nO,QC,cv,ZC,iO,rO={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};function oO(){if(nO)return tO;nO=1;var s=_r;return tO=function(i,r){r=r||new FormData;var a=[];function d(l){return null===l?"":s.isDate(l)?l.toISOString():s.isArrayBuffer(l)||s.isTypedArray(l)?"function"==typeof Blob?new Blob([l]):Buffer.from(l):l}return function l(h,f){if(s.isPlainObject(h)||s.isArray(h)){if(-1!==a.indexOf(h))throw Error("Circular reference detected in "+f);a.push(h),s.forEach(h,function(_,g){if(!s.isUndefined(_)){var v,b=f?f+"."+g:g;if(_&&!f&&"object"==typeof _)if(s.endsWith(g,"{}"))_=JSON.stringify(_);else if(s.endsWith(g,"[]")&&(v=s.toArray(_)))return void v.forEach(function(y){!s.isUndefined(y)&&r.append(b,d(y))});l(_,b)}}),a.pop()}else r.append(f,d(h))}(i),r}}var eT,sO,aO,cO,dO,lO,uO,hO,tT,pO,nT,iT,mO=function(s,i){return s&&!function(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}(i)?function(s,i){return i?s.replace(/\/+$/,"")+"/"+i.replace(/^\/+/,""):s}(s,i):i};function xd(){if(lO)return dO;lO=1;var s=ip();function i(r){s.call(this,r??"canceled",s.ERR_CANCELED),this.name="CanceledError"}return _r.inherits(i,s,{__CANCEL__:!0}),dO=i}var rr=_r,Zl=function(s,i){eO.forEach(s,function(r,a){a!==i&&a.toUpperCase()===i.toUpperCase()&&(s[i]=r,delete s[a])})},Xi=ip(),op=rO,sp=oO(),ap={"Content-Type":"application/x-www-form-urlencoded"};function eu(s,i){!rr.isUndefined(s)&&rr.isUndefined(s["Content-Type"])&&(s["Content-Type"]=i)}var tu,Nc={transitional:op,adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&"[object process]"===Object.prototype.toString.call(process))&&(tu=function rp(){if(pO)return tT;pO=1;var s=_r,i=function VL(){if(cv)return QC;cv=1;var s=ip();return QC=function(i,r,a){var d=a.config.validateStatus;a.status&&d&&!d(a.status)?r(new s("Request failed with status code "+a.status,[s.ERR_BAD_REQUEST,s.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a)):i(a)}}(),r=function BL(){if(iO)return ZC;iO=1;var s=_r;return ZC=s.isStandardBrowserEnv()?{write:function(i,r,a,d,l,h){var f=[];f.push(i+"="+encodeURIComponent(r)),s.isNumber(a)&&f.push("expires="+new Date(a).toGMTString()),s.isString(d)&&f.push("path="+d),s.isString(l)&&f.push("domain="+l),!0===h&&f.push("secure"),document.cookie=f.join("; ")},read:function(i){var r=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove:function(i){this.write(i,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}}(),a=Ql,d=mO,l=function _O(){if(sO)return eT;sO=1;var s=_r,i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return eT=function(r){var a,d,l,h={};return r&&s.forEach(r.split("\n"),function(f){if(l=f.indexOf(":"),a=s.trim(f.substr(0,l)).toLowerCase(),d=s.trim(f.substr(l+1)),a){if(h[a]&&i.indexOf(a)>=0)return;h[a]="set-cookie"===a?(h[a]?h[a]:[]).concat([d]):h[a]?h[a]+", "+d:d}}),h}}(),h=function gO(){if(cO)return aO;cO=1;var s=_r;return aO=s.isStandardBrowserEnv()?function(){var i,r=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement("a");function d(l){var h=l;return r&&(a.setAttribute("href",h),h=a.href),a.setAttribute("href",h),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,""):"",host:a.host,search:a.search?a.search.replace(/^\?/,""):"",hash:a.hash?a.hash.replace(/^#/,""):"",hostname:a.hostname,port:a.port,pathname:"/"===a.pathname.charAt(0)?a.pathname:"/"+a.pathname}}return i=d(window.location.href),function(l){var h=s.isString(l)?d(l):l;return h.protocol===i.protocol&&h.host===i.host}}():function(){return!0}}(),f=rO,_=ip(),g=xd(),v=function rT(){return hO||(hO=1,uO=function(s){var i=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return i&&i[1]||""}),uO}();return tT=function(b){return new Promise(function(y,T){var M,O=b.data,D=b.headers,x=b.responseType;function F(){b.cancelToken&&b.cancelToken.unsubscribe(M),b.signal&&b.signal.removeEventListener("abort",M)}s.isFormData(O)&&s.isStandardBrowserEnv()&&delete D["Content-Type"];var j=new XMLHttpRequest;if(b.auth){var Y=b.auth.username||"",te=b.auth.password?unescape(encodeURIComponent(b.auth.password)):"";D.Authorization="Basic "+btoa(Y+":"+te)}var K=d(b.baseURL,b.url);function Q(){if(j){var ge="getAllResponseHeaders"in j?l(j.getAllResponseHeaders()):null;i(function(Fe){y(Fe),F()},function(Fe){T(Fe),F()},{data:x&&"text"!==x&&"json"!==x?j.response:j.responseText,status:j.status,statusText:j.statusText,headers:ge,config:b,request:j}),j=null}}if(j.open(b.method.toUpperCase(),a(K,b.params,b.paramsSerializer),!0),j.timeout=b.timeout,"onloadend"in j?j.onloadend=Q:j.onreadystatechange=function(){j&&4===j.readyState&&(0!==j.status||j.responseURL&&0===j.responseURL.indexOf("file:"))&&setTimeout(Q)},j.onabort=function(){j&&(T(new _("Request aborted",_.ECONNABORTED,b,j)),j=null)},j.onerror=function(){T(new _("Network Error",_.ERR_NETWORK,b,j,j)),j=null},j.ontimeout=function(){var ge=b.timeout?"timeout of "+b.timeout+"ms exceeded":"timeout exceeded";b.timeoutErrorMessage&&(ge=b.timeoutErrorMessage),T(new _(ge,(b.transitional||f).clarifyTimeoutError?_.ETIMEDOUT:_.ECONNABORTED,b,j)),j=null},s.isStandardBrowserEnv()){var $=(b.withCredentials||h(K))&&b.xsrfCookieName?r.read(b.xsrfCookieName):void 0;$&&(D[b.xsrfHeaderName]=$)}"setRequestHeader"in j&&s.forEach(D,function(ge,_e){void 0===O&&"content-type"===_e.toLowerCase()?delete D[_e]:j.setRequestHeader(_e,ge)}),s.isUndefined(b.withCredentials)||(j.withCredentials=!!b.withCredentials),x&&"json"!==x&&(j.responseType=b.responseType),"function"==typeof b.onDownloadProgress&&j.addEventListener("progress",b.onDownloadProgress),"function"==typeof b.onUploadProgress&&j.upload&&j.upload.addEventListener("progress",b.onUploadProgress),(b.cancelToken||b.signal)&&(M=function(ge){j&&(T(!ge||ge&&ge.type?new g:ge),j.abort(),j=null)},b.cancelToken&&b.cancelToken.subscribe(M),b.signal&&(b.signal.aborted?M():b.signal.addEventListener("abort",M))),O||(O=null);var q=v(K);q&&-1===["http","https","file"].indexOf(q)?T(new _("Unsupported protocol "+q+":",_.ERR_BAD_REQUEST,b)):j.send(O)})}}()),tu),transformRequest:[function(s,i){if(Zl(i,"Accept"),Zl(i,"Content-Type"),rr.isFormData(s)||rr.isArrayBuffer(s)||rr.isBuffer(s)||rr.isStream(s)||rr.isFile(s)||rr.isBlob(s))return s;if(rr.isArrayBufferView(s))return s.buffer;if(rr.isURLSearchParams(s))return eu(i,"application/x-www-form-urlencoded;charset=utf-8"),s.toString();var r,a=rr.isObject(s),d=i&&i["Content-Type"];if((r=rr.isFileList(s))||a&&"multipart/form-data"===d){var l=this.env&&this.env.FormData;return sp(r?{"files[]":s}:s,l&&new l)}return a||"application/json"===d?(eu(i,"application/json"),function(h,f,_){if(rr.isString(h))try{return(0,JSON.parse)(h),rr.trim(h)}catch(g){if("SyntaxError"!==g.name)throw g}return(0,JSON.stringify)(h)}(s)):s}],transformResponse:[function(s){var i=this.transitional||Nc.transitional,d=!(i&&i.silentJSONParsing)&&"json"===this.responseType;if(d||i&&i.forcedJSONParsing&&rr.isString(s)&&s.length)try{return JSON.parse(s)}catch(l){if(d)throw"SyntaxError"===l.name?Xi.from(l,Xi.ERR_BAD_RESPONSE,this,null,this.response):l}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:iT?nT:(iT=1,nT=null)},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};rr.forEach(["delete","get","head"],function(s){Nc.headers[s]={}}),rr.forEach(["post","put","patch"],function(s){Nc.headers[s]=rr.merge(ap)});var nu,iu,kd=Nc,EO=_r,vO=kd;function oT(){return iu?nu:(iu=1,nu=function(s){return!(!s||!s.__CANCEL__)})}var sT=_r,dv=function(s,i,r){var a=this||vO;return EO.forEach(r,function(d){s=d.call(a,s,i)}),s},bO=oT(),yO=kd,SO=xd();function lv(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new SO}var Cm,Pc,rs=_r,CO=function(s,i){i=i||{};var r={};function a(g,v){return rs.isPlainObject(g)&&rs.isPlainObject(v)?rs.merge(g,v):rs.isPlainObject(v)?rs.merge({},v):rs.isArray(v)?v.slice():v}function d(g){return rs.isUndefined(i[g])?rs.isUndefined(s[g])?void 0:a(void 0,s[g]):a(s[g],i[g])}function l(g){if(!rs.isUndefined(i[g]))return a(void 0,i[g])}function h(g){return rs.isUndefined(i[g])?rs.isUndefined(s[g])?void 0:a(void 0,s[g]):a(void 0,i[g])}function f(g){return g in i?a(s[g],i[g]):g in s?a(void 0,s[g]):void 0}var _={url:l,method:l,data:l,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:f};return rs.forEach(Object.keys(s).concat(Object.keys(i)),function(g){var v=_[g]||d,b=v(g);rs.isUndefined(b)&&v!==f||(r[g]=b)}),r};function uv(){return Pc?Cm:(Pc=1,Cm={version:"0.27.2"})}var ru=uv().version,ja=ip(),aT={};["object","boolean","number","function","string","symbol"].forEach(function(s,i){aT[s]=function(r){return typeof r===s||"a"+(i<1?"n ":" ")+s}});var hv={};aT.transitional=function(s,i,r){function a(d,l){return"[Axios v"+ru+"] Transitional option '"+d+"'"+l+(r?". "+r:"")}return function(d,l,h){if(!1===s)throw new ja(a(l," has been removed"+(i?" in "+i:"")),ja.ERR_DEPRECATED);return i&&!hv[l]&&(hv[l]=!0,console.warn(a(l," has been deprecated since v"+i+" and will be removed in the near future"))),!s||s(d,l,h)}};var jL,HL,TO,IO,cT,wO,dT=_r,GL=Ql,RO=ZD,lT=function(s){return lv(s),s.headers=s.headers||{},s.data=dv.call(s,s.data,s.headers,s.transformRequest),s.headers=sT.merge(s.headers.common||{},s.headers[s.method]||{},s.headers),sT.forEach(["delete","get","head","post","put","patch","common"],function(i){delete s.headers[i]}),(s.adapter||yO.adapter)(s).then(function(i){return lv(s),i.data=dv.call(s,i.data,i.headers,s.transformResponse),i},function(i){return bO(i)||(lv(s),i&&i.response&&(i.response.data=dv.call(s,i.response.data,i.response.headers,s.transformResponse))),Promise.reject(i)})},pv=CO,AO=mO,uT={assertOptions:function(s,i,r){if("object"!=typeof s)throw new ja("options must be an object",ja.ERR_BAD_OPTION_VALUE);for(var a=Object.keys(s),d=a.length;d-- >0;){var l=a[d],h=i[l];if(h){var f=s[l],_=void 0===f||h(f,l,s);if(!0!==_)throw new ja("option "+l+" must be "+_,ja.ERR_BAD_OPTION_VALUE)}else if(!0!==r)throw new ja("Unknown option "+l,ja.ERR_BAD_OPTION)}},validators:aT},sa=uT.validators;function cp(s){this.defaults=s,this.interceptors={request:new RO,response:new RO}}cp.prototype.request=function(s,i){"string"==typeof s?(i=i||{}).url=s:i=s||{},i.method=(i=pv(this.defaults,i)).method?i.method.toLowerCase():this.defaults.method?this.defaults.method.toLowerCase():"get";var r=i.transitional;void 0!==r&&uT.assertOptions(r,{silentJSONParsing:sa.transitional(sa.boolean),forcedJSONParsing:sa.transitional(sa.boolean),clarifyTimeoutError:sa.transitional(sa.boolean)},!1);var a=[],d=!0;this.interceptors.request.forEach(function(b){"function"==typeof b.runWhen&&!1===b.runWhen(i)||(d=d&&b.synchronous,a.unshift(b.fulfilled,b.rejected))});var l,h=[];if(this.interceptors.response.forEach(function(b){h.push(b.fulfilled,b.rejected)}),!d){var f=[lT,void 0];for(Array.prototype.unshift.apply(f,a),f=f.concat(h),l=Promise.resolve(i);f.length;)l=l.then(f.shift(),f.shift());return l}for(var _=i;a.length;){var g=a.shift(),v=a.shift();try{_=g(_)}catch(b){v(b);break}}try{l=lT(_)}catch(b){return Promise.reject(b)}for(;h.length;)l=l.then(h.shift(),h.shift());return l},cp.prototype.getUri=function(s){s=pv(this.defaults,s);var i=AO(s.baseURL,s.url);return GL(i,s.params,s.paramsSerializer)},dT.forEach(["delete","get","head","options"],function(s){cp.prototype[s]=function(i,r){return this.request(pv(r||{},{method:s,url:i,data:(r||{}).data}))}}),dT.forEach(["post","put","patch"],function(s){function i(r){return function(a,d,l){return this.request(pv(l||{},{method:s,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:d}))}}cp.prototype[s]=i(),cp.prototype[s+"Form"]=i(!0)});var DO=_r,OO=WD,fv=cp,NO=CO,os=function s(i){var r=new fv(i),a=OO(fv.prototype.request,r);return DO.extend(a,fv.prototype,r),DO.extend(a,r),a.create=function(d){return s(NO(i,d))},a}(kd);os.Axios=fv,os.CanceledError=xd(),os.CancelToken=function(){if(HL)return jL;HL=1;var s=xd();function i(r){if("function"!=typeof r)throw new TypeError("executor must be a function.");var a;this.promise=new Promise(function(l){a=l});var d=this;this.promise.then(function(l){if(d._listeners){var h,f=d._listeners.length;for(h=0;h<f;h++)d._listeners[h](l);d._listeners=null}}),this.promise.then=function(l){var h,f=new Promise(function(_){d.subscribe(_),h=_}).then(l);return f.cancel=function(){d.unsubscribe(h)},f},r(function(l){d.reason||(d.reason=new s(l),a(d.reason))})}return i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.prototype.subscribe=function(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]},i.prototype.unsubscribe=function(r){if(this._listeners){var a=this._listeners.indexOf(r);-1!==a&&this._listeners.splice(a,1)}},i.source=function(){var r;return{token:new i(function(a){r=a}),cancel:r}},jL=i}(),os.isCancel=oT(),os.VERSION=uv().version,os.toFormData=oO(),os.AxiosError=ip(),os.Cancel=os.CanceledError,os.all=function(s){return Promise.all(s)},os.spread=IO?TO:(IO=1,TO=function(s){return function(i){return s.apply(null,i)}}),os.isAxiosError=function(){if(wO)return cT;wO=1;var s=_r;return cT=function(i){return s.isObject(i)&&!0===i.isAxiosError}}(),Ro.exports=os,Ro.exports.default=os;var Ze=Rt(Ro.exports);function mv(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function _v(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?mv(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):mv(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}let Ht,ss=0,hT=0;function Tm(s,i,r,a){return new X((d,l)=>{i.responseType=i.responseType||"json",i.data&&!r?(i.data=JSON.stringify(i.data),ss+=Ua(i.data)):r&&(i.data.size?ss+=i.data.size:i.data instanceof FormData?ss+=VD(i.data):ss+=Ua(JSON.stringify(i.data))),i.headers=i.headers||{},i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json",i.method="POST",i.url=s,Ze.request(i).then(h=>{"string"==typeof h.data?hT+=Ua(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?hT+=h.data.byteLength:hT+=Ua(JSON.stringify(h.data)),a&&d({data:h.data,headers:h.headers}),d(h.data)}).catch(h=>{Ze.isCancel(h)?l(new ee(k.OPERATION_ABORTED,"cancel token canceled")):l("ECONNABORTED"===h.code?new ee(k.NETWORK_TIMEOUT,h.message):h.response?new ee(k.NETWORK_RESPONSE_ERROR,h.response.status):new ee(k.NETWORK_ERROR,h.message))})})}function Ha(s,i){return as.apply(this,arguments)}function as(){return as=L(function*(s,i){const r=new Blob([i.data],{type:"buffer"});return yield Tm(s,_v(_v({},i),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}),as.apply(this,arguments)}const pT=()=>void 0!==window.isSecureContext,Ao=function(s){if(s.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return s;const i=s.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(i&&i[1]&&i[2]){const d=i[2];return"".concat(i[1],".").concat(d)}const r=s.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(r&&r[1]&&r[2]){const d=r[2];return"".concat(r[1],".").concat(100*(Number(d)+1))}return"4.0.0.999"}("4.20.0"),fT=function(){try{return!0===JSON.parse("true")}catch{return!0}}();var Mc;!function(s){s.Default="default",s.Auto="auto",s.Relay="relay",s.SdRtn="sd-rtn"}(Mc||(Mc={}));const mT="v4.20.0-0-g334e514b-dirty(12/8/2023, 3:48:29 PM)",gr={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:100,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,USE_XR:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],PLUGIN_INFO:[]};function It(s,i,r){var a,d;ye(a=Object.keys(gr)).call(a,s)&&(!r&&ye(d=Object.keys(Ld)).call(d,s)||(gr[s]=i))}function B(s){return gr[s]}const Ld={};function _T(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Re(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?_T(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):_T(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}var Ke,xc,Im;!function(s){s.SET_SESSION_ID="SET_SESSION_ID",s.SET_P2P_ID="SET_P2P_id",s.SET_DC_ID="SET_DC_id",s.SET_UID="SET_UID",s.SET_INT_UID="SET_INT_UID",s.SET_PUB_ID="SET_PUB_ID",s.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",s.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",s.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",s.AVOID_JOIN_START="AVOID_JOIN_START",s.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",s.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",s.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",s.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",s.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",s.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",s.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",s.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",s.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",s.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",s.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",s.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",s.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",s.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",s.RESET_KEY_METRICS="RESET_KEY_METRICS",s.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",s.SET_USE_P2P="SET_USE_P2P",s.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE"}(Ke||(Ke={}));class PO{constructor(i,r,a,d){C(this,"state",void 0),this.state={codec:i,audioCodec:r,mode:a,clientId:d,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1,p2pTransport:Mc.Default}}dispatch(i){this.state=function(r,a){switch(a.type){case Ke.SET_SESSION_ID:return Re(Re({},r),{},{sessionId:a.sessionId});case Ke.SET_P2P_ID:return Re(Re({},r),{},{p2pId:a.p2pId});case Ke.SET_UID:return Re(Re({},r),{},{uid:a.uid});case Ke.SET_INT_UID:return Re(Re({},r),{},{intUid:a.intUid});case Ke.SET_PUB_ID:return Re(Re({},r),{},{pubId:a.pubId});case Ke.KEY_METRIC_CLIENT_CREATED:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{clientCreated:a.metric})});case Ke.KEY_METRIC_JOIN_START:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{joinStart:a.metric})});case Ke.AVOID_JOIN_START:return Re(Re({},r),{},{avoidJoinStart:a.avoidJoinStart});case Ke.KEY_METRIC_JOIN_END:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{joinEnd:a.metric})});case Ke.KEY_METRIC_REQUEST_AP_START:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{requestAPStart:a.metric})});case Ke.KEY_METRIC_REQUEST_AP_END:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{requestAPEnd:a.metric})});case Ke.KEY_METRIC_JOIN_GATEWAY_START:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{joinGatewayStart:a.metric})});case Ke.KEY_METRIC_JOIN_GATEWAY_END:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{joinGatewayEnd:a.metric})});case Ke.KEY_METRIC_PEER_CONNECTION_START:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{peerConnectionStart:a.metric})});case Ke.KEY_METRIC_PEER_CONNECTION_END:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{peerConnectionEnd:a.metric})});case Ke.KEY_METRIC_DESCRIPTION_START:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{descriptionStart:a.metric})});case Ke.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{signalChannelOpen:a.metric})});case Ke.KEY_METRIC_ICE_CONNECTION_END:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{iceConnectionEnd:a.metric})});case Ke.KEY_METRIC_PUBLISH:{const d=r.keyMetrics.publish,l=d.findIndex(h=>h.trackId===a.metric.trackId);return-1!==l?(d[l]=Re(Re({},d[l]),a.metric),Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{publish:[...d]})})):Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{publish:[...r.keyMetrics.publish,a.metric]})})}case Ke.KEY_METRIC_SUBSCRIBE:{const d=r.keyMetrics.subscribe,l=d.findIndex(h=>h.userId===a.metric.userId&&h.type===a.metric.type);return-1!==l?(d[l]=Re(Re({},d[l]),a.metric),Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{subscribe:[...d]})})):Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{subscribe:[...r.keyMetrics.subscribe,a.metric]})})}case Ke.SET_CLOUD_PROXY_SERVER_MODE:return r.cloudProxyServerMode=a.mode,r;case Ke.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof a.index?r.joinChannelServiceRecords=[...r.joinChannelServiceRecords,a.record]:(r.joinChannelServiceRecords[a.index]=Re(Re({},r.joinChannelServiceRecords[a.index]),a.record),r.joinChannelServiceRecords=[...r.joinChannelServiceRecords]),r;case Ke.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return r.joinChannelServiceRecords=[],r;case Ke.RESET_KEY_METRICS:return r.keyMetrics={publish:[],subscribe:[]},r;case Ke.SET_USE_DATACHANNEL:return Re(Re({},r),{},{useDataChannel:a.val});case Ke.SET_USE_P2P:return Re(Re({},r),{},{useP2P:a.val});case Ke.SET_TRANSPORT_TYPE:return Re(Re({},r),{},{p2pTransport:a.val});default:return r}}(this.state,i)}set sessionId(i){this.dispatch({type:Ke.SET_SESSION_ID,sessionId:i})}get sessionId(){return this.state.sessionId}set codec(i){this.state.codec=i}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(i){this.dispatch({type:Ke.SET_P2P_ID,p2pId:i})}get p2pId(){return this.state.p2pId}set dcId(i){this.dispatch({type:Ke.SET_DC_ID,dcId:i})}get dcId(){return this.state.dcId}set uid(i){this.dispatch({type:Ke.SET_UID,uid:i})}get uid(){return this.state.uid}set intUid(i){this.dispatch({type:Ke.SET_INT_UID,intUid:i})}get intUid(){return this.state.intUid}set pubId(i){this.dispatch({type:Ke.SET_PUB_ID,pubId:i})}get pubId(){return this.state.pubId}set cloudProxyServerMode(i){this.dispatch({type:Ke.SET_CLOUD_PROXY_SERVER_MODE,mode:i})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(i){this.dispatch({type:Ke.SET_USE_DATACHANNEL,val:i})}get useDataChannel(){return this.state.useDataChannel}set useP2P(i){this.dispatch({type:Ke.SET_USE_P2P,val:i})}get useP2P(){return this.state.useP2P}set p2pTransport(i){this.dispatch({type:Ke.SET_TRANSPORT_TYPE,val:i})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:Ke.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Ke.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Ke.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Ke.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Ke.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Ke.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Ke.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Ke.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Ke.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Ke.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Ke.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Ke.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(i,r,a,d){this.dispatch({type:Ke.KEY_METRIC_PUBLISH,metric:Re(Re({trackId:i,type:r},a&&{publishStart:a}),d&&{publishEnd:d})})}subscribe(i,r,a,d,l,h,f){this.dispatch({type:Ke.KEY_METRIC_SUBSCRIBE,metric:Re(Re(Re(Re(Re({userId:i,type:r},a&&{subscribeStart:a}),d&&{subscribeEnd:d}),l&&{firstFrame:l}),h&&{streamAdded:h}),f&&{firstDecoded:f})})}massSubscribe(i,r,a,d){i.forEach(l=>{this.dispatch({type:Ke.KEY_METRIC_SUBSCRIBE,metric:Re(Re(Re({userId:l.userId,type:l.type},r&&{subscribeStart:r}),a&&{subscribeEnd:a}),d&&{firstFrame:d})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(i,r){"gateway"===i.service&&Array.isArray(i.urls)&&(i.urls=i.urls.map(a=>a.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return"number"!=typeof r?(this.dispatch({type:Ke.RECORD_JOIN_CHANNEL_SERVICE,record:Re(Re({},i),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(r<0||r>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Ke.RECORD_JOIN_CHANNEL_SERVICE,record:i,index:r}),r)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Ke.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Ke.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(i){this.dispatch({type:Ke.AVOID_JOIN_START,avoidJoinStart:i})}}(function(s){s.h264="h264",s.h265="h265",s.vp8="vp8",s.vp9="vp9",s.av1="av1"})(xc||(xc={})),function(s){s.opus="opus",s.pcma="pcma",s.pcmu="pcmu",s.g722="g722"}(Im||(Im={}));const gv=new class extends jt{reportLogUploadError(s){this.emit("REPORT_LOG_UPLOAD",s)}};class MO{constructor(i){C(this,"logger",void 0),C(this,"prefixLists",[]),this.logger=i}debug(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];this.logger.debug(...this.prefixLists,...r)}info(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];this.logger.info(...this.prefixLists,...r)}warning(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];this.logger.warning(...this.prefixLists,...r)}error(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];this.logger.error(...this.prefixLists,...r)}prefix(i){return this.prefixLists.push(i),this}popPrefix(){return this.prefixLists.pop(),this}}function gT(){const s=new Date;return s.toTimeString().split(" ")[0]+":"+s.getMilliseconds()}function xO(){const s=new Date,i=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return i?i?.[0]+":"+s.getUTCMilliseconds():s.toTimeString().split(" ")[0]+":"+s.getMilliseconds()}const cs={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Ev=Date.now(),wm=s=>{for(const i in cs)if(Object.prototype.hasOwnProperty.call(cs,i)&&cs[i]===s)return i;return"DEFAULT"},I=new class{constructor(){C(this,"proxyServerURL",void 0),C(this,"logLevel",cs.DEBUG),C(this,"uploadState","collecting"),C(this,"uploadLogWaitingList",[]),C(this,"uploadLogUploadingList",[]),C(this,"uploadErrorCount",0),C(this,"currentLogID",0),C(this,"url",void 0),C(this,"extLog",(s,i)=>{this.appendLogToWaitingList(s,...i)})}debug(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];const a=[cs.DEBUG].concat(i);this.log.apply(this,a)}info(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];const a=[cs.INFO].concat(i);this.log.apply(this,a)}warning(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];const a=[cs.WARNING].concat(i);this.log.apply(this,a)}warn(){this.warning(...arguments)}error(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];const a=[cs.ERROR].concat(i);this.log.apply(this,a)}upload(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];const a=[cs.DEBUG].concat(i);this.uploadLog.apply(this,a)}setLogLevel(s){s=Math.min(Math.max(0,s),4),this.logLevel=s}enableLogUpload(){It("UPLOAD_LOG",!0)}disableLogUpload(){It("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(s){this.proxyServerURL=s}prefix(s){return new MO(this).prefix(s)}log(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];if(Date.now()-Ev<100)return void setTimeout(()=>{this.log(...i)},Date.now()-Ev);const a=Math.max(0,Math.min(4,i[0]));if(i[0]=gT()+" Agora-SDK [".concat(wm(a),"]:"),this.appendLogToWaitingList(a,...i),a<this.logLevel)return;const d=gT()+" %cAgora-SDK [".concat(wm(a),"]:");let l=[];if(!B("USE_NEW_LOG"))switch(a){case cs.DEBUG:l=[d,"color: #64B5F6;"].concat(i.slice(1)),console.log.apply(console,l);break;case cs.INFO:l=[d,"color: #1E88E5; font-weight: bold;"].concat(i.slice(1)),console.log.apply(console,l);break;case cs.WARNING:l=[d,"color: #FB8C00; font-weight: bold;"].concat(i.slice(1)),console.warn.apply(console,l);break;case cs.ERROR:l=[d,"color: #B00020; font-weight: bold;"].concat(i.slice(1)),console.error.apply(console,l)}}uploadLog(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];if(Date.now()-Ev<100)return void setTimeout(()=>{this.uploadLog(...i)},Date.now()-Ev);const a=Math.max(0,Math.min(4,i[0]));i[0]=gT()+" Agora-SDK [".concat(wm(a),"]:"),this.appendLogToWaitingList(a,...i)}appendLogToWaitingList(s){if(!B("UPLOAD_LOG"))return;for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];Array.isArray(r[0])?r[0][0]=xO()+" Agora-SDK [".concat(wm(s),"]:"):r[0]=xO()+" Agora-SDK [".concat(wm(s),"]:");let d="";r.forEach(l=>{"object"==typeof l&&(l=JSON.stringify(l)),d+="".concat(l," ")}),this.uploadLogWaitingList.push({payload_str:d,log_level:s,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}uploadLogs(){var s=this;return L(function*(){const i=s.uploadLogUploadingList,r={sdk_version:Ao,process_id:B("PROCESS_ID"),payload:JSON.stringify(i)};return In(L(function*(){const a=yield Ze.post(s.url||(s.proxyServerURL?"https://".concat(s.proxyServerURL,"/ls/?h=").concat(B("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(B("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if("OK"!==a.data){const d=new Error("unexpected upload log response");throw d.response=a,d}}),()=>(s.uploadLogUploadingList=[],!1),a=>(gv.reportLogUploadError(a.response?{status:a.response.status,data:a.response.data,headers:a.response.headers,message:a.message}:a.request?{status:a.request.status,message:a.message}:{status:-1,message:a.message}),!0),{timeout:B("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:B("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})})()}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,B("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),B("UPLOAD_LOG_INTERVAL"))}).catch(s=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),B("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),B("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var kO,LO;function WL(s){return hi(s.reportId,"params.reportId",0,100,!1),hi(s.category,"params.category",0,100,!1),hi(s.event,"params.event",0,100,!1),hi(s.label,"params.label",0,100,!1),At(s.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(function(s){s.FREE="free",s.UPLOADING="uploading"})(kO||(kO={})),function(s){s[s.MISC=0]="MISC",s[s.INTERNAL_EVENT=1]="INTERNAL_EVENT",s[s.PUBLIC_EVENT=2]="PUBLIC_EVENT",s[s.WEB_EVENT=3]="WEB_EVENT",s[s.INTERNAL_API=4]="INTERNAL_API",s[s.WEB_API=5]="WEB_API",s[s.PUBLIC_API=6]="PUBLIC_API"}(LO||(LO={}));const zL={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var ti,Gt,FO,vv;function ET(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Ve(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?ET(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):ET(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}(function(s){s.PUBLISH="publish",s.SUBSCRIBE="subscribe",s.WS_COMPRESSOR_INIT="ws_compressor_init",s.SESSION_INIT="session_init",s.JOIN_CHOOSE_SERVER="join_choose_server",s.REQ_USER_ACCOUNT="req_user_account",s.JOIN_GATEWAY="join_gateway",s.REJOIN_GATEWAY="rejoin_gateway",s.STREAM_SWITCH="stream_switch",s.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",s.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",s.FIRST_VIDEO_RECEIVED="first_video_received",s.FIRST_AUDIO_RECEIVED="first_audio_received",s.FIRST_VIDEO_DECODE="first_video_decode",s.FIRST_AUDIO_DECODE="first_audio_decode",s.ON_ADD_AUDIO_STREAM="on_add_audio_stream",s.ON_ADD_VIDEO_STREAM="on_add_video_stream",s.ON_UPDATE_STREAM="on_update_stream",s.ON_REMOVE_STREAM="on_remove_stream",s.USER_ANALYTICS="req_user_analytics",s.PC_STATS="pc_stats",s.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities"})(ti||(ti={})),function(s){s.SESSION="io.agora.pb.Wrtc.Session",s.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",s.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",s.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",s.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",s.PUBLISH="io.agora.pb.Wrtc.Publish",s.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",s.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",s.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",s.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",s.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",s.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",s.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",s.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",s.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",s.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",s.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",s.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",s.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",s.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",s.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",s.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",s.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",s.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",s.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",s.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",s.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",s.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",s.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",s.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",s.PC_STATS="io.agora.pb.Wrtc.PCStats",s.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities"}(Gt||(Gt={})),function(s){s[s.WORKER_EVENT=156]="WORKER_EVENT",s[s.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(FO||(FO={})),function(s){s[s.SESSION=26]="SESSION",s[s.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",s[s.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",s[s.JOIN_GATEWAY=28]="JOIN_GATEWAY",s[s.PUBLISH=30]="PUBLISH",s[s.SUBSCRIBE=29]="SUBSCRIBE",s[s.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",s[s.STREAM_SWITCH=32]="STREAM_SWITCH",s[s.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",s[s.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",s[s.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",s[s.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",s[s.API_INVOKE=41]="API_INVOKE",s[s.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",s[s.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",s[s.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",s[s.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",s[s.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",s[s.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",s[s.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",s[s.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",s[s.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",s[s.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",s[s.WORKER_EVENT=156]="WORKER_EVENT",s[s.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",s[s.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",s[s.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",s[s.USER_ANALYTICS=1e4]="USER_ANALYTICS",s[s.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(vv||(vv={}));class dp{constructor(){var i=this;C(this,"baseInfoMap",new Map),C(this,"proxyServer",void 0),C(this,"eventUploadTimer",void 0),C(this,"setSessionIdTimer",void 0),C(this,"url",void 0),C(this,"backupUrl",void 0),C(this,"_appId",void 0),C(this,"keyEventUploadPendingItems",[]),C(this,"normalEventUploadPendingItems",[]),C(this,"apiInvokeUploadPendingItems",[]),C(this,"apiInvokeCount",0),C(this,"ltsList",[]),C(this,"lastSendNormalEventTime",Date.now()),C(this,"customReportCounterTimer",void 0),C(this,"customReportCount",0),C(this,"extApiInvoke",function(){var r=L(function*(a){for(const d of a){const l=Ve(Ve({},d),{},{sid:null,invokeId:++i.apiInvokeCount,tag:Kt.TRACER});i.sendApiInvoke(l)}});return function(a){return r.apply(this,arguments)}}()),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),B("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),B("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(i){return this.baseInfoMap.get(i)}adjustSessionStartTime(i){if(!this.baseInfoMap.has(i)&&!this.baseInfoMap.get(i))return void I.error("adjust session ".concat(i," start time, sid is not exist or info is undefined"));const r=this.baseInfoMap.get(i),a=Date.now(),d=r.startTime;r.startTime=a,I.debug("rewrite session ".concat(i," startTime: ").concat(a," , ").concat(a-d,"ms")),this.baseInfoMap.set(i,r)}setAppId(i){this._appId=i}reportApiInvoke(i,r,a){r.timeout=r.timeout||6e4,r.reportResult=void 0===r.reportResult||r.reportResult;const d=Date.now();this.apiInvokeCount+=1;const l=this.apiInvokeCount,h=()=>({tag:r.tag,invokeId:l,sid:i,name:r.name,apiInvokeTime:d,options:r.options,states:r.states||null}),f=!!B("SHOW_REPORT_INVOKER_LOG");f&&I.info("".concat(r.name," start"),r.options);let _=!1;Un(r.timeout).then(()=>{_||(this.sendApiInvoke(Ve(Ve({},h()),{},{error:k.API_INVOKE_TIMEOUT,success:!1})),I.debug("".concat(r.name," timeout")))});const g=new ee(k.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:v=>{const b=()=>{if(_)throw g;return _=!0,this.sendApiInvoke(Ve(Ve({},h()),{},{success:!0},r.reportResult&&{result:v})),f&&I.info("".concat(r.name," onSuccess")),v};return a?BD(b,r.name+"Success",a,()=>_=!0):b()},onError:v=>{const b=()=>{if(_)throw v;_=!0,this.sendApiInvoke(Ve(Ve({},h()),{},{success:!1,error:v})),f&&I.info("".concat(r.name," onFailure"),v.toString())};return a?BD(b,r.name+"Error",a,()=>_=!0):b()}}}sessionInit(i,r){if(this.baseInfoMap.has(i))return;const a=Date.now(),d=this.createBaseInfo(i,a);d.cname=r.cname;const l=Object.assign({},{willUploadConsoleLog:B("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:fT?"global":"oversea",areas:B("AREAS")&&B("AREAS").join(",")},r.extend),{stringUid:h,channelProfile:f,channelMode:_,isABTestSuccess:g,lsid:v,clientRole:b}=r,y=Date.now(),T=Ve(Ve({},d),{},{eventType:ti.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,build:mT,lts:y,elapse:y-a,extend:JSON.stringify(l),mode:r.mode,process:B("PROCESS_ID"),appType:B("APP_TYPE"),success:!0,version:Ao,stringUid:h,channelProfile:f,channelMode:_,isABTestSuccess:g,lsid:v,clientType:20,clientRole:b,serviceId:B("PROCESS_ID"),extensionID:B("PLUGIN_INFO").join(",")||""});this.send({type:Gt.SESSION,data:T},!0)}joinChooseServer(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve({},d),{},{eventType:ti.JOIN_CHOOSE_SERVER,lts:l,eventElapse:l-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:l-a.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3});this.send({type:Gt.JOIN_CHOOSE_SERVER,data:h},!0)}reqUserAccount(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve({},d),{},{eventType:ti.REQ_USER_ACCOUNT,lts:l,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:l-a.startTime,eventElapse:l-r.lts,extend:JSON.stringify(r.extend)});this.send({type:Gt.REQ_USER_ACCOUNT,data:h},!0)}joinGateway(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info;r.vid&&(d.vid=r.vid),d.uid=r.uid,d.cid=r.cid;const l=Date.now(),{firstSuccess:h,avoidJoinStartTime:f,isProxy:_,addr:g}=r,v=l-(h&&f?f:a.startTime),b=Ve(Ve({},d),{},{eventType:ti.JOIN_GATEWAY,lts:l,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,elapse:v,eventElapse:l-r.lts,firstSuccess:h,signalChannel:r.signalChannel}),y=b.success?1:0;if(r.succ&&(a.lastJoinSuccessTime=l),h)this.send({type:Gt.JOIN_GATEWAY,data:b},!0);else{let T;if(g)if(_){const O=g.match(/h=(\d{1,3}-){3}\d{1,3}/g),D=g.match(/p=[0-9]{1,6}/g);T={isSuccess:y,gatewayIp:O&&O.length?O[0].split("=")[1].replace(/-/g,"."):"",port:D&&D.length?D[0].split("=")[1]:"",isProxy:_?1:0}}else{const O=g.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),D=g.match(/(:|p=)[0-9]{1,6}/g);T={isSuccess:y,gatewayIp:O&&O.length?O[0].split("//")[1].replace(/-/g,"."):"",port:D&&D.length?D[0].split(/:|p=/g)[1]:"",isProxy:_?1:0}}else T={isSuccess:y,gatewayIp:"",port:"",isProxy:_?1:0};delete b.success,delete b.eventType,delete b.firstSuccess,b.vid=Number(b.vid);const M=Object.assign({},b,T,{eventType:ti.REJOIN_GATEWAY});this.send({type:Gt.RE_JOIN_GATEWAY,data:M},!0)}}joinChannelTimeout(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=Date.now(),l=Ve(Ve({},a.info),{},{lts:d,timeout:r,elapse:d-a.startTime});this.send({type:Gt.JOIN_CHANNEL_TIMEOUT,data:l},!0)}publish(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve({},d),{},{eventType:ti.PUBLISH,lts:l,eventElapse:r.eventElapse,elapse:l-a.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:Gt.PUBLISH,data:h},!0)}subscribe(i,r,a){const d=this.baseInfoMap.get(i);if(!d)return;const l=d.info,h=Date.now(),f=Ve(Ve({},l),{},{eventType:ti.SUBSCRIBE,lts:h,eventElapse:r.eventElapse,elapse:h-d.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid},a&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof r.peerid?f.peerSuid=r.peerid:f.peer=r.peerid,this.send({type:Gt.SUBSCRIBE,data:f},!0)}wsCompressorInit(i){var r;const a=[...ir(r=this.baseInfoMap).call(r)],l=this.baseInfoMap.get(a.length?a[0]:"UnableToGetSid");if(!l)return;const h=l.info,f=Date.now(),_=Ve(Ve({},h),{},{eventType:ti.WS_COMPRESSOR_INIT,lts:f,eventElapse:i.eventElapse,elapse:f-l.startTime,status:i.status?1:2});this.send({type:Gt.WS_COMPRESSOR_INIT,data:_},!0)}firstRemoteVideoDecode(i,r,a,d){const l=this.baseInfoMap.get(i);if(!l)return;const h=l.info,f=Date.now(),_=Ve(Ve(Ve({},h),d),{},{elapse:f-l.startTime,eventType:r,lts:f,firstDecodeFrame:Math.max(f-l.startTime,0),apEnd:Math.max(d.apEnd-l.startTime,0),apStart:Math.max(d.apStart-l.startTime,0),joinGwEnd:Math.max(d.joinGwEnd-l.startTime,0),joinGwStart:Math.max(d.joinGwStart-l.startTime,0),pcEnd:Math.max(d.pcEnd-l.startTime,0),pcStart:Math.max(d.pcStart-l.startTime,0),subscriberEnd:Math.max(d.subscriberEnd-l.startTime,0),subscriberStart:Math.max(d.subscriberStart-l.startTime,0),videoAddNotify:Math.max(d.videoAddNotify-l.startTime,0)});this.send({type:a,data:_},!0)}firstRemoteFrame(i,r,a,d){const l=this.baseInfoMap.get(i);if(!l)return;const h=l.info,f=Date.now(),_=Ve(Ve(Ve({},h),d),{},{elapse:f-l.startTime,eventType:r,lts:f});this.send({type:a,data:_},!0)}pcStats(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve(Ve({},d),r),{},{vid:void 0===d.vid?0:Number(d.vid),elapse:l-a.startTime,eventType:ti.PC_STATS,lts:l});this.send({type:Gt.PC_STATS,data:h},!0)}updateRemoteRTPCapabilities(i,r){if(i){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve(Ve({},d),r),{},{vid:void 0===d.vid?0:Number(d.vid),eventType:ti.UPDATE_REMOTE_RTPCAPABILITIES,lts:l});this.send({type:Gt.UPDATE_REMOTE_RTPCAPABILITIES,data:h},!0)}}onGatewayStream(i,r,a,d){const l=this.baseInfoMap.get(i);if(!l)return;const h=l.info,f=Date.now(),_=Ve(Ve(Ve({},h),d),{},{eventType:r,lts:f});this.send({type:a,data:_},!0)}streamSwitch(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve({},d),{},{eventType:ti.STREAM_SWITCH,lts:l,isDual:r.isdual,elapse:l-a.startTime,success:r.succ});this.send({type:Gt.STREAM_SWITCH,data:h},!0)}requestProxyAppCenter(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve({},d),{},{eventType:ti.REQUEST_PROXY_APPCENTER,lts:l,eventElapse:l-r.lts,elapse:l-a.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Gt.REQUEST_PROXY_APPCENTER,data:h},!0)}requestProxyWorkerManager(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve({},d),{},{eventType:ti.REQUEST_PROXY_WORKER_MANAGER,lts:l,eventElapse:l-r.lts,elapse:l-a.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Gt.REQUEST_PROXY_WORKER_MANAGER,data:h},!0)}setProxyServer(i){this.proxyServer=i,I.debug(i?"reportProxyServerurl: ".concat(i):"disable reportProxyServerurl: ".concat(i))}peerPublishStatus(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve({},d),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:l,elapse:l-a.startTime,joinChannelSuccessElapse:l-(a.lastJoinSuccessTime||l),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:Gt.PEER_PUBLISH_STATUS,data:h},!0)}workerEvent(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now();(function(f,_,g){const v=f[_];if(!v||"string"!=typeof v)return[f];f[_]="";const b=Ua(JSON.stringify(f));let y=0;const T=[];let M=0;for(let O=0;O<v.length;O++)M+=v.charCodeAt(O)<=127?1:3,M<=1300-b||(T[T.length]=Ad(Ad({},f),{},{[_]:v.substring(y,O)}),y=O,M=v.charCodeAt(O)<=127?1:3);return y!==v.length-1&&(T[T.length]=Ad(Ad({},f),{},{[_]:v.substring(y)})),T})(Ve(Ve(Ve({},d),r),{},{elapse:l-a.startTime,lts:l,productType:"WebRTC"}),"payload").forEach(f=>this.send({type:Gt.WORKER_EVENT,data:f},!0))}apworkerEvent(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve(Ve({},d),r),{},{elapse:l-a.startTime,lts:l});this.send({type:Gt.AP_WORKER_EVENT,data:h},!0)}joinWebProxyAP(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve(Ve({},d),r),{},{elapse:l-a.startTime,lts:l,extend:r.extend||void 0});this.send({type:Gt.JOIN_WEB_PROXY_AP,data:h},!0)}WebSocketQuit(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve(Ve({},d),r),{},{elapse:l-a.startTime,lts:l});this.send({type:Gt.WEBSOCKET_QUIT,data:h},!0)}sendCustomReportMessage(i,r){var a=this;return L(function*(){if(a.customReportCount+=r.length,a.customReportCount>B("CUSTOM_REPORT_LIMIT"))throw new ee(k.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);a.customReportCounterTimer||(a.customReportCounterTimer=window.setInterval(()=>{a.customReportCount=0},5e3));const d=Date.now(),l=r.map(h=>({type:Gt.USER_ANALYTICS,data:Ve(Ve({sid:i},h),{},{lts:d})}));try{B("NEW_REPORT_SERVER")?yield a.postDataToStatsCollector2(l):yield a.postDataToStatsCollector(l)}catch(h){throw I.error("send custom report message failed",h.toString()),new ee(k.CUSTOM_REPORT_SEND_FAILED,h.message)}})()}sendApiInvoke(i){const r=B("NOT_REPORT_EVENT");if(i.tag&&ye(r)&&ye(r).call(r,i.tag))return!1;if(null===i.sid)return this.apiInvokeUploadPendingItems.push(i),!1;const a=this.baseInfoMap.get(i.sid);if(!a)return this.apiInvokeUploadPendingItems.push(i),!1;const{cname:d,uid:l,cid:h}=a.info;let f;if(i.lts=i.lts||Date.now(),i.error)if(i.error instanceof ee){const{code:g,message:v}=i.error;f=g||v||i.error.toString()}else f=i.error.toString();const _={invokeId:i.invokeId,sid:i.sid,cname:d,cid:h,uid:l,lts:i.lts,success:i.success,elapse:i.lts-a.startTime,execElapse:i.lts-i.apiInvokeTime,apiName:i.name,options:i.options?JSON.stringify(i.options):void 0,execStates:i.states?JSON.stringify(i.states):void 0,execResult:i.result?JSON.stringify(i.result):void 0,errorCode:i.error?f:void 0,errorMsg:i.error?JSON.stringify(i.error):void 0};return this.send({type:Gt.API_INVOKE,data:_},!1),!0}appendSessionId(){dp.__CLIENT_LIST__.forEach(i=>{if(i._sessionId){const r=this.apiInvokeUploadPendingItems.length;for(let a=0;a<r;a++){const d=this.apiInvokeUploadPendingItems.shift();d&&(d.sid=i._sessionId,this.sendApiInvoke(Object.assign({},d)))}}})}send(i,r){if(r)return this.keyEventUploadPendingItems.push(i),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(i),this.normalEventUploadPendingItems.length>B("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(i,r){const a=[],d=[];for(;i.length;){const h=i.shift();a.length<20?a.push(h):d.push(h)}i.push(...d);for(const h of[...a]){var l;-1!==this.ltsList.indexOf(h.data.lts)?(h.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(h.data.lts)):(this.ltsList.push(h.data.lts),bE(l=this.ltsList).call(l,(f,_)=>f-_))}return r||(this.lastSendNormalEventTime=Date.now()),B("ENABLE_EVENT_REPORT")&&a.length&&(B("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(a):this.postDataToStatsCollector(a)).catch((h=>f=>{B("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(h):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(h),this.normalEventUploadPendingItems.length>B("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-B("NORMAL_EVENT_QUEUE_CAPACITY")),I.warning("report: drop normal events"))))})(a)),i}postDataToStatsCollector2(i){var r=this;return L(function*(){Fn.networkState===$i.OFFLINE&&(yield X.race([Fn.onlineWaiter,Un(2*Pn.maxRetryTimeout)]));const a=h=>{let f=new Uint8Array;return h.forEach(_=>{const g=HC(JSON.stringify(_.data)),v=new ArrayBuffer(5),b=(T=>{let M=0;return Object.entries(Gt).forEach(O=>{let[D,x]=O;x===T.type&&(M=EventNameToID[D])}),M})(_),y=new DataView(v);y.setUint16(0,g.byteLength,!0),y.setUint8(2,255&b),y.setUint8(3,b>>>8&255),y.setUint8(4,b>>>16&255),f=$E(f,new Uint8Array(v)),f=$E(f,g)}),f},d="event";let l=r.proxyServer?"https://".concat(r.proxyServer,"/rs/?h=").concat(B("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(d):"https://".concat(B("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(d);for(let h=0;h<2;h+=1){1===h&&(l=r.proxyServer?"https://".concat(r.proxyServer,"/rs/?h=").concat(B("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(d):"https://".concat(B("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(d));try{yield Tm(l,{timeout:1e4,data:a(i),headers:Ve(Ve({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},r._appId&&{appid:r._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(f){if(1===h)throw f;continue}return}})()}postDataToStatsCollector(i){var r=arguments,a=this;return L(function*(){let d=r.length>1&&void 0!==r[1]&&r[1];const l={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:i.map(_=>JSON.stringify(_)),vid:(_=>{const g=_&&_.data.sid&&a.baseInfoMap.get(_.data.sid);return g&&g.info.vid&&+g.info.vid||0})(i[0])};Fn.networkState===$i.OFFLINE&&(yield X.race([Fn.onlineWaiter,Un(2*Pn.maxRetryTimeout)]));const h=d?"/events/proto-raws":"/events/messages";let f=a.url||(a.proxyServer?"https://".concat(a.proxyServer,"/rs/?h=").concat(B("EVENT_REPORT_DOMAIN"),"&p=").concat(B("STATS_COLLECTOR_PORT"),"&d=").concat(h):"https://".concat(B("EVENT_REPORT_DOMAIN"),":").concat(B("STATS_COLLECTOR_PORT")).concat(h));for(let _=0;_<2;_+=1){1===_&&(f=a.backupUrl||(a.proxyServer?"https://".concat(a.proxyServer,"/rs/?h=").concat(B("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(B("STATS_COLLECTOR_PORT"),"&d=").concat(h):"https://".concat(B("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(B("STATS_COLLECTOR_PORT")).concat(h)));try{d?yield Ha(f,{timeout:1e4,data:l}):yield Tm(f,{timeout:1e4,data:l})}catch(g){if(1===_)throw g;continue}return}})()}createBaseInfo(i,r){const a=Object.assign({},zL);return a.sid=i,this.baseInfoMap.set(i,{info:a,startTime:r}),a}reportResourceTiming(i,r){const a=performance.getEntriesByName(i),d=a[a.length-1];d&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:d,tag:Kt.TRACER}).onSuccess()}}function we(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(i,r,a){const d=a.value;if("function"==typeof d){const l=s.className||i.__className__||("AgoraRTCClient"===i.constructor.name?"Client":i.constructor.name);a.value=function(){for(var h=arguments.length,f=new Array(h),_=0;_<h;_++)f[_]=arguments[_];let g=f;if(s.argsMap)try{g=s.argsMap(this,...f)}catch(b){I.warning(b),g=[]}try{JSON.stringify(g)}catch{I.warning("arguments for method ".concat(l,".").concat(String(r)," not serializable for apiInvoke.")),g=[]}const v=(s.report||Ie).reportApiInvoke(this._sessionId||null,{name:"".concat(l,".").concat(String(r)),options:g,tag:Kt.TRACER,reportResult:s.reportResult},s.throttleTime);try{const b=d.apply(this,f);return b instanceof X?b.then(y=>(v.onSuccess(s.reportResult&&y),y)).catch(y=>{throw v.onError(y),y}):(v.onSuccess(s.reportResult&&b),b)}catch(b){throw v.onError(b),b}}}return a}}C(dp,"__CLIENT_LIST__",[]);const Ie=new dp;gv.on("REPORT_LOG_UPLOAD",s=>{s.networkState=Fn.networkState,Ie.reportApiInvoke(null,{name:"logUploadError",options:s,tag:Kt.TRACER})});const qL=["CHINA","GLOBAL"],Er=function(){const s="us".concat("erna","me"),i="pa".concat("sswo","rd"),r=["t","s","t"];r.splice(1,0,"e");const a=r.join(""),d=[];for(let f=0;f<6;f++)d.push("1");const l=d.join(""),h={};return h[s]=a,h[i]=l,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Er,fT||(gr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],gr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],gr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],gr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],gr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],gr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],gr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",gr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",gr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",gr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",gr.AREAS=["NORTH_AMERICA","OVERSEA"]);const UO=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Fd=[];function ou(s,i){return!!i&&Fd.some(r=>r.uid===s&&r.channelName===i)}dp.__CLIENT_LIST__=Fd;var vT,vr,lp,Rm,zr,Ji,oe,Ee,de,Ae,kc,xe,VO,Ei,Me,Kn,Lc,KL=hc("Array").values,YL=ld,up=Yt,Am=Ds,BO=KL,Fc=Array.prototype,$L={DOMTokenList:!0,NodeList:!0},ca=Rt(function(s){var i=s.values;return s===Fc||Am(Fc,s)&&i===Fc.values||up($L,YL(s))?BO:i});function ne(s,i,r,a){var d,l=arguments.length,h=l<3?i:null===a?a=Object.getOwnPropertyDescriptor(i,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect.decorate(s,i,r,a);else for(var f=s.length-1;f>=0;f--)(d=s[f])&&(h=(l<3?d(h):l>3?d(i,r,h):d(i,r))||h);return l>3&&h&&Object.defineProperty(i,r,h),h}function N(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)}(function(s){s.L1T1="L1T1",s.L1T2="L1T2",s.L1T3="L1T3",s.L2T1_KEY="L2T1_KEY",s.L2T2_KEY="L2T2_KEY",s.L2T3_KEY="L2T3_KEY",s.L3T1_KEY="L3T1_KEY",s.L3T2_KEY="L3T2_KEY",s.L3T3_KEY="L3T3_KEY"})(vT||(vT={})),function(s){s.CERTIFICATE="certificate",s.CODEC="codec",s.CANDIDATE_PAIR="candidate-pair",s.LOCAL_CANDIDATE="local-candidate",s.REMOTE_CANDIDATE="remote-candidate",s.INBOUND="inbound-rtp",s.TRACK="track",s.OUTBOUND="outbound-rtp",s.PC="peer-connection",s.REMOTE_INBOUND="remote-inbound-rtp",s.REMOTE_OUTBOUND="remote-outbound-rtp",s.TRANSPORT="transport",s.CSRC="csrc",s.DATA_CHANNEL="data-channel",s.STREAM="stream",s.SENDER="sender",s.RECEIVER="receiver"}(vr||(vr={})),function(s){s[s.ACCESS_POINT=101]="ACCESS_POINT",s[s.UNILBS=201]="UNILBS",s[s.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(lp||(lp={})),function(s){s[s.IIIEGAL_APPID=1]="IIIEGAL_APPID",s[s.IIIEGAL_UID=2]="IIIEGAL_UID",s[s.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(Rm||(Rm={})),function(s){s[s.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",s[s.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",s[s.INTERNAL_ERROR=8]="INTERNAL_ERROR",s[s.NO_AUTHORIZED=9]="NO_AUTHORIZED",s[s.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",s[s.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",s[s.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",s[s.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",s[s.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",s[s.USER_OVERLOAD=16]="USER_OVERLOAD",s[s.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",s[s.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(zr||(zr={})),function(s){s[s.NO_FLAG_SET=100]="NO_FLAG_SET",s[s.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",s[s.INVALID_FALG_SET=102]="INVALID_FALG_SET",s[s.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",s[s.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",s[s.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",s[s.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",s[s.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",s[s.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",s[s.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",s[s.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",s[s.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",s[s.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",s[s.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",s[s.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",s[s.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",s[s.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",s[s.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",s[s.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(Ji||(Ji={})),function(s){s[s.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",s[s.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",s[s.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",s[s.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",s[s.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",s[s.K_TICKET_INVALID=7]="K_TICKET_INVALID",s[s.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",s[s.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",s[s.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",s[s.K_UID_BANNED=14]="K_UID_BANNED",s[s.K_IP_BANNED=15]="K_IP_BANNED",s[s.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",s[s.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",s[s.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",s[s.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",s[s.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",s[s.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",s[s.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",s[s.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",s[s.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",s[s.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",s[s.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",s[s.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",s[s.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",s[s.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",s[s.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",s[s.ERR_INVALID_UID=117]="ERR_INVALID_UID",s[s.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",s[s.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",s[s.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",s[s.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",s[s.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",s[s.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",s[s.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",s[s.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",s[s.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",s[s.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",s[s.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",s[s.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",s[s.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",s[s.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",s[s.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",s[s.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",s[s.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",s[s.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",s[s.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",s[s.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",s[s.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",s[s.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",s[s.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",s[s.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",s[s.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",s[s.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",s[s.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",s[s.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",s[s.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",s[s.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",s[s.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",s[s.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",s[s.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",s[s.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",s[s.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",s[s.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",s[s.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(oe||(oe={})),function(s){s.CONNECTING="connecting",s.CONNECTED="connected",s.RECONNECTING="reconnecting",s.CLOSED="closed"}(Ee||(Ee={})),function(s){s.WS_CONNECTED="ws_connected",s.WS_RECONNECTING="ws_reconnecting",s.WS_CLOSED="ws_closed",s.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",s.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",s.ON_BINARY_DATA="on_binary_data",s.REQUEST_RECOVER="request_recover",s.REQUEST_JOIN_INFO="request_join_info",s.REQUEST_REJOIN_INFO="req_rejoin_info",s.IS_P2P_DISCONNECTED="is_p2p_dis",s.DISCONNECT_P2P="dis_p2p",s.ABORT_P2P_EXECUTION="abort_p2p_execution",s.NEED_RENEW_SESSION="need-sid",s.REPORT_JOIN_GATEWAY="report_join_gateway",s.REQUEST_TIMEOUT="request_timeout",s.REQUEST_SUCCESS="request_success",s.JOIN_RESPONSE="join_response",s.DATACHANNEL_PRECONNECT="datachannel_preconnect",s.DATACHANNEL_CONNECTING="datachannel_connecting",s.DATACHANNEL_FAILBACK="datachannel_failback",s.P2P_CONNECTION="p2p_connection",s.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",s.P2P_SUBSCRIBE="p2p_subscribe",s.P2P_UNSUBSCRIBE="p2p_unsubscribe",s.P2P_EXCHANGE_SDP="p2p_exchange_sdp",s.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",s.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream"}(de||(de={})),function(s){s.PING="ping",s.PING_BACK="ping_back",s.JOIN="join_v3",s.REJOIN="rejoin_v3",s.LEAVE="leave",s.SET_CLIENT_ROLE="set_client_role",s.PUBLISH="publish",s.PUBLISH_DATASTREAM="publish_datastream",s.UNPUBLISH="unpublish",s.UNPUBLISH_DATASTREAM="unpublish_datastream",s.SUBSCRIBE="subscribe",s.PRE_SUBSCRIBE="pre_subscribe",s.SUBSCRIBE_DATASTREAM="subscribe_datastream",s.SUBSCRIBE_STREAMS="subscribe_streams",s.UNSUBSCRIBE="unsubscribe",s.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",s.UNSUBSCRIBE_STREAMS="unsubscribe_streams",s.SUBSCRIBE_CHANGE="subscribe_change",s.TRAFFIC_STATS="traffic_stats",s.RENEW_TOKEN="renew_token",s.SWITCH_VIDEO_STREAM="switch_video_stream",s.DEFAULT_VIDEO_STREAM="default_video_stream",s.SET_FALLBACK_OPTION="set_fallback_option",s.GATEWAY_INFO="gateway_info",s.CONTROL="control",s.SEND_METADATA="send_metadata",s.DATA_STREAM="data_stream",s.PICK_SVC_LAYER="pick_svc_layer",s.RESTART_ICE="restart_ice",s.CONNECT_PC="connect_pc",s.SET_VIDEO_PROFILE="set_video_profile",s.SET_PARAMETER="set_parameter",s.SET_RTM2_FLAG="set_rtm2_flag"}(Ae||(Ae={})),function(s){s.WRTC_STATS="wrtc_stats",s.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",s.DENOISER_STATS="denoiser_stats",s.EXTENSION_USAGE_STATS="extension_usage_stats"}(kc||(kc={})),function(s){s.ON_USER_ONLINE="on_user_online",s.ON_USER_OFFLINE="on_user_offline",s.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",s.ON_PUBLISH_STREAM="on_publish_stream",s.ON_UPLINK_STATS="on_uplink_stats",s.ON_P2P_LOST="on_p2p_lost",s.ON_REMOVE_STREAM="on_remove_stream",s.ON_ADD_AUDIO_STREAM="on_add_audio_stream",s.ON_ADD_VIDEO_STREAM="on_add_video_stream",s.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",s.ON_USER_BANNED="on_user_banned",s.ON_USER_LICENSE_BANNED="on_user_license_banned",s.ON_NOTIFICATION="on_notification",s.ON_CRYPT_ERROR="on_crypt_error",s.MUTE_AUDIO="mute_audio",s.MUTE_VIDEO="mute_video",s.UNMUTE_AUDIO="unmute_audio",s.UNMUTE_VIDEO="unmute_video",s.ON_P2P_OK="on_p2p_ok",s.RECEIVE_METADATA="receive_metadata",s.ON_DATA_STREAM="on_data_stream",s.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",s.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",s.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",s.ENABLE_LOCAL_VIDEO="enable_local_video",s.DISABLE_LOCAL_VIDEO="disable_local_video",s.ENABLE_LOCAL_AUDIO="enable_local_audio",s.DISABLE_LOCAL_AUDIO="disable_local_audio",s.ON_PUBLISHED_USER_LIST="on_published_user_list"}(xe||(xe={})),function(s){s.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",s.NEED_ANSWER="NEED_ANSWER",s.NEED_RENEGOTIATE="NEED_RENEGOTIATE",s.P2P_LOST="P2P_LOST",s.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",s.NEED_UNPUB="NEED_UNPUB",s.NEED_UNSUB="NEED_UNSUB",s.NEED_UPLOAD="NEED_UPLOAD",s.NEED_CONTROL="NEED_CONTROL",s.START_RECONNECT="START_RECONNECT",s.END_RECONNECT="END_RECONNECT",s.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(VO||(VO={})),function(s){s.SEND_ONLY="SEND_ONLY",s.RECEIVE_ONLY="RECEIVE_ONLY"}(Ei||(Ei={})),function(s){s.CONNECTED="websocket:connected",s.RECONNECTING="websocket:reconnecting",s.WILL_RECONNECT="websocket:will_reconnect",s.CLOSED="websocket:closed",s.FAILED="websocket:failed",s.ON_MESSAGE="websocket:on_message",s.REQUEST_NEW_URLS="websocket:request_new_urls",s.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",s.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"}(Me||(Me={}));class W extends ee{constructor(i){super(i,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),C(this,"name","AgoraRTCException")}print(){return super.print(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",I)}throw(){super.throw(I)}}function jO(s){if("string"!=typeof s||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(s))throw I.error("Invalid Channel Name ".concat(s)),new W(k.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function bv(s){if(!("number"==typeof(i=s)&&Math.floor(i)===i&&0<=i&&i<=4294967295||jC(s,1,255)))throw new W(k.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var i;"string"==typeof s&&I.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}(function(s){s.TRANSCODE="mix_streaming",s.RAW="raw_streaming",s.INJECT="inject_streaming"})(Kn||(Kn={})),function(s){s[s.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",s[s.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",s[s.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",s[s.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",s[s.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",s[s.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",s[s.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",s[s.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",s[s.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",s[s.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",s[s.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(Lc||(Lc={}));const HO={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},GO={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Vn(s,i){hi(s.url,"".concat(i,".url"),1,1e3,!1),tn(s.x)||At(s.x,"".concat(i,".x"),0,1e4),tn(s.y)||At(s.y,"".concat(i,".y"),0,1e4),tn(s.width)||At(s.width,"".concat(i,".width"),0,1e4),tn(s.height)||At(s.height,"".concat(i,".height"),0,1e4),tn(s.zOrder)||At(s.zOrder,"".concat(i,".zOrder"),0,255),tn(s.alpha)||At(s.alpha,"".concat(i,".alpha"),0,1,!1)}const XL={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},JL={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var Vs,da,Mn,Dm,Ci,vi,sr,Uc,ut,rn,Ud,Bn,Om,st;function WO(s){if(!s.channelName)throw new W(k.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof s.uid)throw new W(k.INVALID_PARAMS,"invalid uid in info, uid must be a number");return s.token&&hi(s.token,"info.token",1,2047),bv(s.uid),jO(s.channelName),!0}(function(s){s.WARNING="@live_uap-warning",s.ERROR="@line_uap-error",s.PUBLISH_STREAM_STATUS="@live_uap-publish-status",s.INJECT_STREAM_STATUS="@live_uap-inject-status",s.WORKER_STATUS="@live_uap-worker-status",s.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(Vs||(Vs={})),function(s){s.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(da||(da={})),function(s){s[s.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",s[s.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",s[s.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",s[s.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",s[s.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",s[s.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",s[s.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",s[s.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",s[s.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",s[s.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",s[s.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",s[s.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",s[s.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",s[s.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",s[s.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",s[s.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",s[s.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",s[s.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",s[s.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",s[s.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",s[s.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(Mn||(Mn={})),function(s){s.CONNECT_FAILED="connect failed",s.CONNECT_TIMEOUT="connect timeout",s.WS_DISCONNECTED="websocket disconnected",s.REQUEST_TIMEOUT="request timeout",s.REQUEST_FAILED="request failed",s.WAIT_STATUS_TIMEOUT="wait status timeout",s.WAIT_STATUS_ERROR="wait status error",s.BAD_STATE="bad state",s.WS_ABORT="ws abort",s.AP_REQUEST_TIMEOUT="AP request timeout",s.AP_JSON_PARSE_ERROR="AP json parse error",s.AP_REQUEST_ERROR="AP request error",s.AP_REQUEST_ABORT="AP request abort"}(Dm||(Dm={})),function(s){s[s.SetSdkProfile=0]="SetSdkProfile",s[s.SetSourceChannel=1]="SetSourceChannel",s[s.SetSourceUserId=2]="SetSourceUserId",s[s.SetDestChannel=3]="SetDestChannel",s[s.StartPacketTransfer=4]="StartPacketTransfer",s[s.StopPacketTransfer=5]="StopPacketTransfer",s[s.UpdateDestChannel=6]="UpdateDestChannel",s[s.Reconnect=7]="Reconnect",s[s.SetVideoProfile=8]="SetVideoProfile"}(Ci||(Ci={})),function(s){s.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",s.NETWORK_CONNECTED="NETWORK_CONNECTED",s.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",s.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",s.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",s.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",s.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",s.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",s.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",s.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(vi||(vi={})),function(s){s.RELAY_STATE_IDLE="RELAY_STATE_IDLE",s.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",s.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",s.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(sr||(sr={})),function(s){s.RELAY_OK="RELAY_OK",s.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",s.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",s.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(Uc||(Uc={})),function(s){s.High="high",s.Low="low",s.Audio="audio",s.Screen="screen",s.ScreenLow="screen_low"}(ut||(ut={})),function(s){s.DISCONNECT="disconnect",s.CONNECTION_STATE_CHANGE="connection-state-change",s.NETWORK_QUALITY="network-quality",s.STREAM_TYPE_CHANGE="stream-type-change",s.IS_P2P_DISCONNECTED="is-p2p-dis",s.DISCONNECT_P2P="dis-p2p",s.REQUEST_NEW_GATEWAY_LIST="req-gate-url",s.NEED_RENEW_SESSION="need-sid",s.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",s.JOIN_RESPONSE="join-response",s.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",s.RESET_CONNECTION_EVENTS="reset-connection-events",s.DATACHANNEL_PRECONNECT="datachannel_preconnect",s.DATACHANNEL_FAILBACK="datachannel_failback",s.RESET_SIGNAL="reset-signal"}(rn||(rn={})),function(s){s.P2P_DISCONNECTED="P2P_DISCONNECTED",s.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",s.TIMEOUT="TIMEOUT",s.UNKNOWN_REASON="UNKNOWN_REASON"}(Ud||(Ud={})),function(s){s[s.Nothing=0]="Nothing",s[s.Audio=1]="Audio",s[s.LwoVideo=2]="LwoVideo",s[s.Video=4]="Video",s[s.Data=8]="Data",s[s.DataStream0=256]="DataStream0",s[s.DataStream1=512]="DataStream1",s[s.DataStream2=1024]="DataStream2",s[s.DataStream3=2048]="DataStream3",s[s.DataStream4=4096]="DataStream4",s[s.DataStream5=8192]="DataStream5",s[s.DataStream6=16384]="DataStream6",s[s.DataStream7=32768]="DataStream7"}(Bn||(Bn={})),function(s){s[s.websocket=0]="websocket",s[s.datachannel=1]="datachannel"}(Om||(Om={})),function(s){s.CHINA="CHINA",s.ASIA="ASIA",s.NORTH_AMERICA="NORTH_AMERICA",s.EUROPE="EUROPE",s.JAPAN="JAPAN",s.INDIA="INDIA",s.KOREA="KOREA",s.HKMC="HKMC",s.US="US",s.OCEANIA="OCEANIA",s.SOUTH_AMERICA="SOUTH_AMERICA",s.AFRICA="AFRICA",s.OVERSEA="OVERSEA",s.GLOBAL="GLOBAL",s.EXTENSIONS="EXTENSIONS"}(st||(st={}));const zO=[st.AFRICA,st.ASIA,st.CHINA,st.EUROPE,st.GLOBAL,st.INDIA,st.JAPAN,st.NORTH_AMERICA,st.OCEANIA,st.OVERSEA,st.SOUTH_AMERICA];var Yn;!function(s){s.CHINA="CN",s.ASIA="AS",s.NORTH_AMERICA="NA",s.EUROPE="EU",s.JAPAN="JP",s.INDIA="IN",s.KOREA="KR",s.HKMC="HK",s.US="US",s.OCEANIA="OC",s.SOUTH_AMERICA="SA",s.AFRICA="AF",s.OVERSEA="OVERSEA",s.GLOBAL="GLOBAL",s.EXTENSIONS="GLOBAL"}(Yn||(Yn={}));const yv={CHINA:{},ASIA:{CODE:Yn.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Yn.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Yn.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Yn.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Yn.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Yn.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Yn.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Yn.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Yn.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Yn.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Yn.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Yn.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Yn.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};var Nm,qO,Se,Mi,Bs,re,Dt,Oe,hp,Do,Oo,ni,la,pn,ds,KO,qr,ls,Vd,fn,su,Vc,QL,Sv;fT&&(yv.CHINA={CODE:Yn.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(s){s.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(Nm||(Nm={}));class Pm extends jt{constructor(i,r){super(),C(this,"onICEConnectionStateChange",void 0),C(this,"onConnectionStateChange",void 0),C(this,"onDTLSTransportStateChange",void 0),C(this,"onDTLSTransportError",void 0),C(this,"onICETransportStateChange",void 0),C(this,"onFirstAudioReceived",void 0),C(this,"onFirstVideoReceived",void 0),C(this,"onFirstAudioDecoded",void 0),C(this,"onFirstVideoDecoded",void 0),C(this,"onFirstVideoDecodedTimeout",void 0),C(this,"onSelectedLocalCandidateChanged",void 0),C(this,"onSelectedRemoteCandidateChanged",void 0)}}class Cv extends Pm{constructor(i,r){super(i,r)}}(function(s){s.SEND="sendonly",s.RECV="recvonly",s.SENDRECV="sendrecv",s.INACTIVE="inactive"})(qO||(qO={})),function(s){s.VIDEO="video",s.AUDIO="audio"}(Se||(Se={})),function(s){s[s.UDP=0]="UDP",s[s.TCP=1]="TCP",s[s.RELAY=2]="RELAY"}(Mi||(Mi={})),function(s){s[s.FIRST_CONNECTION=0]="FIRST_CONNECTION",s[s.TCP_RESTART=1]="TCP_RESTART",s[s.RELAY_RESTART=2]="RELAY_RESTART",s[s.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",s[s.OLD_RESTART=11]="OLD_RESTART",s[s.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(Bs||(Bs={})),function(s){s.LocalVideoTrack="videoTrack",s.LocalAudioTrack="audioTrack",s.LocalVideoLowTrack="videoLowTrack"}(re||(re={})),function(s){s.New="new",s.Connected="connected",s.Reconnecting="reconnecting",s.Disconnected="disconnected"}(Dt||(Dt={})),function(s){s.StateChange="stateChange",s.IceConnectionStateChange="iceConnectionStateChange",s.RequestMuteLocal="requestMuteLocal",s.RequestUnmuteLocal="requestUnmuteLocal",s.RequestRePublish="requestRePublish",s.RequestRePublishDataChannel="requestRePublishDataChannel",s.RequestReSubscribe="requestReSubscribe",s.RequestUploadStats="requestUploadStats",s.RequestUpload="requestUpload",s.MediaReconnectStart="MediaReconnectStart",s.MediaReconnectEnd="MediaReconnectEnd",s.NeedSignalRTT="NeedSignalRTT",s.RequestRestartICE="RequestRestartIce",s.PeerConnectionStateChange="PeerConnectionStateChange",s.RequestReconnect="RequestReconnect",s.RequestReconnectPC="RequestReconnectPC",s.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",s.P2PLost="P2PLost",s.UpdateVideoEncoder="UpdateVideoEncoder",s.ConnectionTypeChange="ConnectionTypeChange",s.RequestLowStreamParameter="RequestLowStreamParameter",s.QueryClientConnectionState="QueryClientConnectionState",s.LocalCandidate="LocalCandidate",s.RequestP2PMuteLocal="requestP2PMuteLocal",s.RequestP2PUnPublish="RequestP2PUnPublish",s.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",s.RequestP2PMuteRemote="RequestP2PMuteRemote",s.RequestP2PRestartICE="RequestP2PRestartICE"}(Oe||(Oe={})),function(s){s.MUTE_LOCAL_VIDEO="mute_local_video",s.MUTE_LOCAL_AUDIO="mute_local_audio",s.UNMUTE_LOCAL_VIDEO="unmute_local_video",s.UNMUTE_LOCAL_AUDIO="unmute_local_audio",s.MUTE_REMOTE_VIDEO="mute_remote_video",s.MUTE_REMOTE_AUDIO="mute_remote_audio",s.UNMUTE_REMOTE_VIDEO="unmute_remote_video",s.UNMUTE_REMOTE_AUDIO="unmute_remote_audio"}(hp||(hp={})),function(s){s.CONNECTING="CONNECTING",s.RECONNECTING="RECONNECTING",s.CONNECTED="CONNECTED",s.CLOSED="CLOSED"}(Do||(Do={})),function(s){s[s.CONNECT_AP=0]="CONNECT_AP",s[s.AP_CONNECTED=1]="AP_CONNECTED",s[s.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",s[s.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",s[s.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",s[s.CONNECT_WORKER=5]="CONNECT_WORKER",s[s.WORKER_CONNECTED=6]="WORKER_CONNECTED",s[s.CLOSED=7]="CLOSED"}(Oo||(Oo={})),function(s){s.CONNECTION_STATE_CHANGE="connection-state-change",s.STATE_CHANGE="state-change",s.INSPECT_RESULT="inspect-result",s.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",s.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(ni||(ni={})),function(s){s.NETWORK_ERROR="NETWORK_ERROR",s.SERVER_ERROR="SERVER_ERROR",s.MULTI_IP="MULTI_IP",s.TIMEOUT="TIMEOUT",s.OFFLINE="OFFLINE",s.LEAVE="LEAVE",s.P2P_FAILED="P2P_FAILED",s.FALLBACK="FALLBACK"}(la||(la={})),function(s){s.CONNECTED="transmitter:connected",s.RECONNECTING="transmitter:reconnecting",s.WILL_RECONNECT="transmitter:will_reconnect",s.CLOSED="transmitter:closed",s.FAILED="transmitter:failed",s.ON_MESSAGE="transmitter:on_message",s.REQUEST_NEW_URLS="transmitter:request_new_urls",s.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",s.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",s.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",s.FAILBACK="transmitter:failback"}(pn||(pn={})),function(s){s.CAMERA_CHANGED="camera-changed",s.MICROPHONE_CHANGED="microphone-changed",s.PLAYBACK_DEVICE_CHANGED="playback-device-changed",s.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",s.AUTOPLAY_FAILED="autoplay-failed",s.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",s.SECURITY_POLICY_VIOLATION="security-policy-violation"}(ds||(ds={})),function(s){s[s.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",s[s.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",s[s.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",s[s.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",s[s.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",s[s.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",s[s.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",s[s.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",s[s.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",s[s.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",s[s.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",s[s.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",s[s.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",s[s.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",s[s.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",s[s.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",s[s.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",s[s.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",s[s.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",s[s.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(KO||(KO={})),function(s){s.CONNECTING="CONNECTING",s.RECONNECTING="RECONNECTING",s.CONNECTED="CONNECTED",s.CLOSED="CLOSED"}(qr||(qr={})),function(s){s.CONNECTION_STATE_CHANGE="connection-state-change",s.STATE_CHANGE="state-change",s.INSPECT_RESULT="inspect-result",s.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",s.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(ls||(ls={})),function(s){s[s.CONNECT_AP=0]="CONNECT_AP",s[s.AP_CONNECTED=1]="AP_CONNECTED",s[s.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",s[s.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",s[s.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",s[s.CONNECT_WORKER=5]="CONNECT_WORKER",s[s.WORKER_CONNECTED=6]="WORKER_CONNECTED",s[s.CLOSED=7]="CLOSED"}(Vd||(Vd={})),function(s){s.CALL="call",s.CANDIDATE="candidate",s.PUBLISH="publish",s.UNPUBLISH="unpublish",s.CONTROL="control",s.RESTART_ICE="restart_ice",s.ACK="ack",s.RESPONSE="response",s.JOIN="join",s.CHECK="check"}(fn||(fn={})),function(s){s.ABORT="abort"}(su||(su={})),function(s){s.MUTE_LOCAL_AUDIO="mute_local_audio",s.MUTE_LOCAL_VIDEO="mute_local_video",s.UNMUTE_LOCAL_AUDIO="unmute_local_audio",s.UNMUTE_LOCAL_VIDEO="unmute_local_video"}(Vc||(Vc={})),function(s){s[s.SUCCESS=1]="SUCCESS",s[s.FAILED=0]="FAILED"}(QL||(QL={})),function(s){s.P2P_TOKEN_TIMEOUT="p2p_token_timeout",s.P2P_TOKEN_CHANGED="p2p_token_changed"}(Sv||(Sv={}));const ZL={[lp.ACCESS_POINT]:{[Ji.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ji.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ji.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ji.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Ji.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Ji.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[lp.UNILBS]:{[zr.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[zr.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[zr.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[zr.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[zr.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[zr.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[zr.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[zr.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[zr.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[zr.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[zr.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[zr.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[lp.STRING_UID_ALLOCATOR]:{[Rm.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Rm.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Rm.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Mm(s){const i=ZL[Math.floor(s/1e4)];if(!i)return{desc:"unkonw error",retry:!1};const r=i[s%1e4];if(!r){if(Math.floor(s/1e4)===lp.ACCESS_POINT){const a=s%1e4;if("1"===a.toString()[0])return{desc:s.toString(),retry:!1};if("2"===a.toString()[0])return{desc:s.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return r}const xm={[oe.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[oe.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[oe.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[oe.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[oe.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[oe.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[oe.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[oe.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[oe.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[oe.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[oe.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[oe.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[oe.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[oe.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[oe.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[oe.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[oe.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[oe.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[oe.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[oe.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[oe.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[oe.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[oe.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[oe.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[oe.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[oe.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[oe.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[oe.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[oe.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[oe.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[oe.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[oe.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[oe.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[oe.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[oe.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[oe.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[oe.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[oe.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[oe.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[oe.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[oe.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[oe.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[oe.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[oe.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[oe.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[oe.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[oe.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[oe.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[oe.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[oe.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[oe.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[oe.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[oe.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[oe.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[oe.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[oe.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[oe.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[oe.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[oe.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[oe.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[oe.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[oe.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[oe.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function au(s){return xm[s]||{desc:"UNKNOW_ERROR_".concat(s),action:"failed"}}function YO(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function bT(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?YO(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):YO(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function $O(s){return s.every(i=>i.readyState===WebSocket.CLOSED||i.readyState===WebSocket.CLOSING)}function e2(s,i){if("string"==typeof s)return s;const{proxy:r,host:a,port:d}=s;if(i){const l=B("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===l?"wss://".concat(a,"/ws/?p=").concat(Number(d)+150):"wss://".concat(a,":").concat(l,"/ws/?p=").concat(Number(d)+150)}return r?"wss://".concat(r,"/ws/?h=").concat(a,"&p=").concat(d):"wss://".concat(a,":").concat(d)}const t2=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,XO=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,n2=/wss:\/\/(.+):([0-9]+)\/?/,r2=/wss:\/\/(.[^\/]+)\/?/;let km=0;class o2{constructor(i,r){C(this,"id",0),C(this,"store",void 0),C(this,"recordIndex",void 0),C(this,"websockets",[]),C(this,"try443PortDuration",2e3),C(this,"forceCloseWSDuration",5e3),C(this,"try443PortTimeout",null),C(this,"forceCloseTimeout",null),C(this,"isTry443PortFailed",!1),C(this,"isNormalPortFailed",!1),C(this,"useDoubleDomain",!1),C(this,"useProxy",!1),C(this,"startTime",Date.now()),this.id=++km,this.try443PortDuration=B("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=i||5e3,this.store=r}closeAllWebsockets(){this.websockets.forEach(i=>{i.onopen=null,i.onclose=null,i.onmessage=null,i.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var i;const r=Date.now()-this.startTime;for(var a=arguments.length,d=new Array(a),l=0;l<a;l++)d[l]=arguments[l];I.debug("[choose-best-ws ".concat(null===(i=this.store)||void 0===i?void 0:i.clientId," ").concat(this.id,"] ").concat(r,"ms:"),...d)}createWebSocket(i,r,a){this.logger("createWebSocket:",i,{isTry443Port:r,hasTimeoutDetection:a});const d=B("GATEWAY_DOMAINS"),l=Date.now(),h=[],f=d.find(v=>{var b;return ye(b=i.host).call(b,v)});f||(this.useDoubleDomain=!1);const _=[];if(this.useDoubleDomain)d.forEach(v=>{_.push(e2(bT(bT({},i),{},{host:i.host.replace(f,v)}),r))});else{const v=bT({},i);if(r&&f){const b=d.find(y=>y!==f);b&&(v.host=v.host.replace(f,b))}_.push(e2(v,r))}try{_.forEach(v=>{const b=new WebSocket(v);b.binaryType="arraybuffer",h.push(b),this.logger("ws is connecting:",b.url)})}catch(v){if(this.logger("ws create failed"),h.forEach(b=>b.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(i,r,a);if(!r&&443!==Number(i.port))return this.createWebSocket(i,!0,a);throw new W(k.WS_ERR,"init websocket failed! Error: ".concat(v.toString()))}const g=dm();return this.store&&this.store.recordJoinChannelService({urls:h.map(v=>v.url),service:"gateway"},this.recordIndex),h.forEach(v=>{v.onopen=()=>{this.logger("onopen: ws ".concat(v.url," open cost ").concat(Date.now()-l,"ms")),this.websockets.forEach(b=>{b!==v&&(b.onopen=null,b.onclose=null,b.onmessage=null,b.close(),this.logger("close backup websocket: ".concat(b.url)))}),this.websockets.length=0,g.resolve(v)},v.onclose=b=>{this.logger("onclose: ws ".concat(v.url," closed cost ").concat(Date.now()-l,"ms state: ").concat(v.readyState)),r?this.isTry443PortFailed=$O(h):this.isNormalPortFailed=$O(h),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(r&&this.isTry443PortFailed||!r&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(b.reason)),g.reject({code:b.code,reason:Ud.A_ROUND_WS_FAILED}))},v.onmessage=b=>this.logger("".concat(v.url," onmessage: ").concat(b.data))}),this.websockets.push(...h),a||(()=>{const v=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",g.isResolved),this.websockets.forEach(b=>b.readyState!==WebSocket.OPEN&&b.close())};if(r||this.useProxy)return this.logger("add 5s timeout at ".concat(r?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(v,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",g.isResolved),g.isResolved)return v();lt().os===Zn.MAC_OS&&Pt()&&v(),this.createWebSocket(i,!0,!0).then(b=>g.resolve(b)).catch(b=>{this.isNormalPortFailed&&g.reject(b),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(v,this.forceCloseWSDuration)},this.try443PortDuration)})(),g.promise}chooseBestWebsocket(i,r,a,d){return this.useDoubleDomain=!!r,"string"==typeof i&&(i=function(l){let h,f,_;return[,h,f,_]=l.match(t2)||[],h||([,f,_]=l.match(XO)||[]),f&&_||([,f,_]=l.match(n2)||[]),f&&_||([,f]=l.match(r2)||[]),f||I.warning("un-destructible url: ",l),{proxy:h,host:f,port:_||"443"}}(i)),this.recordIndex=d,this.useProxy=!!i.proxy,a&&this.useProxy&&(I.warn("cannot use 443 only when use proxy"),a=!1),this.createWebSocket(i,!!a,!1).finally(()=>this.clearTimeout())}}function yT(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}class JO extends jt{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(i){var r;ye(r=["tryNext","recover"]).call(r,i)&&this.resetReconnectCount(i),this._reconnectMode=i}get state(){return this._state}set state(i){i!==this._state&&(this._state=i,"reconnecting"===this._state?this.emit(Me.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(Me.CONNECTED):"closed"===this._state?this.emit(Me.CLOSED):"failed"===this._state&&this.emit(Me.FAILED))}resetReconnectCount(i){I.debug("websocket reset reconnect count, reason: "+i),this.reconnectCount=0}constructor(i,r){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),C(this,"connectionID",0),C(this,"currentURLIndex",0),C(this,"urls",[]),C(this,"_reconnectMode","tryNext"),C(this,"reconnectReason",void 0),C(this,"_initMutex",new gi("websocket")),C(this,"name",void 0),C(this,"_state","closed"),C(this,"reconnectInterrupter",void 0),C(this,"websocket",void 0),C(this,"retryConfig",void 0),C(this,"reconnectCount",0),C(this,"forceCloseTimeout",5e3),C(this,"onlineReconnectListener",void 0),C(this,"useCompress",void 0),C(this,"tryDoubleDomain",!1),C(this,"use443PortOnly",!1),C(this,"wsInflateLength",0),C(this,"wsDeflateLength",0),C(this,"closeEstablishingWs",()=>{}),C(this,"store",void 0),C(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=i,this.retryConfig=function(b){for(var y=1;y<arguments.length;y++){var T=null!=arguments[y]?arguments[y]:{};y%2?yT(Object(T),!0).forEach(function(M){C(b,M,T[M])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(T)):yT(Object(T)).forEach(function(M){Object.defineProperty(b,M,Object.getOwnPropertyDescriptor(T,M))})}return b}({},r),this.useCompress=a,this.tryDoubleDomain=d,this.use443PortOnly=l;const{timeout:f,timeoutFactor:_}=r,g=Math.max(300,Math.floor(3*f/5)),v=Math.max(1.2,Math.floor(8*_)/10);$i.ONLINE&&(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=v),Fn.on(Ac.NETWORK_STATE_CHANGE,(b,y)=>{b!==y&&(this.resetReconnectCount("network state change: ".concat(y," -> ").concat(b)),b===$i.ONLINE?(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=v):(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=_))})}getConnection(){return this.websocket||void 0}init(i){var r=arguments,a=this;return L(function*(){let d=r.length>1&&void 0!==r[1]?r[1]:5e3;const l=yield a._initMutex.lock();a.forceCloseTimeout=d,a.urls=i,a.state="connecting";try{const h=dm();a.createWebSocketConnection(a.urls[a.currentURLIndex]).then(h.resolve).catch(h.reject),a.once(Me.CLOSED,()=>{h.reject(new ee(k.WS_DISCONNECT))}),a.once(Me.CONNECTED,h.resolve),yield h.promise}catch{}finally{l()}})()}close(i,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const a=this.websocket;r?setTimeout(()=>a.close(),500):a.close(),this.websocket=void 0}this.state=i?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(i,r){if(!this.websocket)return void I.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==i&&(this.reconnectMode=i),I.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(r)]},this.joinGatewayRecordIndex);const a=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),a&&a.bind(this.websocket)({code:9999,reason:r})}sendMessage(i){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new ee(k.WS_ABORT,"websocket is not ready");try{r||(i=JSON.stringify(i)),this.websocket.send(i)}catch(a){throw new ee(k.WS_ERR,"send websocket message error"+a.toString())}}setWsInflateData(i){this.wsDeflateLength=this.wsDeflateLength+i.originLength,this.wsInflateLength=this.wsInflateLength+i.compressedLength}getWsInflateData(){const i=this.wsInflateLength,r=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:i,wsDeflateLength:r}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}createWebSocketConnection(i){var r=this;return L(function*(){var a;const d=dm();r.connectionID+=1,r.joinGatewayRecordIndex=void 0;const l=b=>{var y;null===(y=r.store)||void 0===y||y.signalChannelOpen(),I.debug("[".concat(r.name,"] websocket opened:"),b),r.reconnectMode="retry",r.state="connected",r.resetReconnectCount("opened"),d.resolve()},h=function(){var b=L(function*(y){var T;if(I.debug("[".concat(r.name,"] websocket close ").concat(null===(T=r.websocket)||void 0===T?void 0:T.url,", code: ").concat(y.code,", reason: ").concat(y.reason,", current mode: ").concat(r.reconnectMode)),r.reconnectCount>=r.retryConfig.maxRetryCount)d.reject(new ee(k.WS_DISCONNECT,"websocket close: ".concat(y.code))),r.close();else{"connected"===r.state&&(r.reconnectReason=y.reason,r.state="reconnecting");const M=Mr(r,Me.WILL_RECONNECT,r.reconnectMode,y.reason)||r.reconnectMode,O=yield r.reconnectWithAction(M);if("closed"===r.state)return void I.debug("[".concat(r.connectionID,"] ws is closed, no need to reconnect"));if(!O)return d.reject(new ee(k.WS_DISCONNECT,"websocket reconnect failed: ".concat(y.code))),r.close(!0);d.resolve()}});return function(T){return b.apply(this,arguments)}}(),f=b=>{r.emit(Me.ON_MESSAGE,b)},_=b=>{I.warn("[".concat(r.connectionID,"] ws open error ").concat(b))};r.websocket&&(r.websocket.onclose=null,r.websocket.close()),B("GATEWAY_WSS_ADDRESS")&&r.name.startsWith("gateway")&&(i=B("GATEWAY_WSS_ADDRESS")),I.debug("[".concat(r.name,"] start connect, url:"),i);const g=null===(a=r.store)||void 0===a?void 0:a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var v;const b=yield r.chooseBestWebsocketConnection(i);r.websocket=b,l&&l(r.websocket.url),r.websocket.onclose=h,r.websocket.onmessage=f,r.websocket.onerror=_,null===(v=r.store)||void 0===v||v.recordJoinChannelService({endTs:Date.now(),status:"success"},g),r.joinGatewayRecordIndex=g}catch(b){const y="closed"===r.state,T=b instanceof ee,M=T&&b.code===k.WS_ABORT,O=T&&b.code===k.WS_ERR,D=T?b.message:b&&(b.reason||b.toString());I.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(D)),r.store&&r.store.recordJoinChannelService({endTs:Date.now(),status:M?"aborted":"error",errors:[b]},g),y||O?(d.reject(y?new ee(k.WS_DISCONNECT,"websocket is closed: ".concat(D)):new ee(k.WS_ERR,"init websocket failed: ".concat(D))),O&&I.error("[".concat(r.name,"] init websocket failed: ").concat(D))):h&&h(b)}return d.promise})()}reconnectWithAction(i){var r=arguments,a=this;return L(function*(){let d=!(r.length>1&&void 0!==r[1])||r[1];if(a.reconnectCount>=a.retryConfig.maxRetryCount||0===a.urls.length||"closed"===a.state)return!1;I.warning("[choose-best-ws] action: =>",i),a.onlineReconnectListener||Fn.isOnline||!Fn.onlineWaiter||(a.onlineReconnectListener=Fn.onlineWaiter.then(()=>{a.onlineReconnectListener=void 0}));let l=!0;if(a.reconnectInterrupter=()=>l=!1,d){const _=ev(a.reconnectCount,a.retryConfig);I.debug("[".concat(a.name,"] wait ").concat(_,"ms to reconnect websocket, mode: ").concat(i)),yield X.race([Un(_),a.onlineReconnectListener||new X(()=>{})])}if("closed"===a._state||!l)return!1;a.reconnectCount+=1;const h=function(){var _=L(function*(g,v){a.emit(Me.RECONNECT_CREATE_CONNECTION,v),yield a.createWebSocketConnection(g)});return function(v,b){return _.apply(this,arguments)}}();try{if("retry"===i)a.emit(Me.RECONNECT_WAITTING_FINISH,i),yield h(a.urls[a.currentURLIndex],i);else if("tryNext"===i){if(a.currentURLIndex+=1,a.currentURLIndex>=a.urls.length)return a.reconnectWithAction("recover",!1);I.debug("[".concat(a.name,"] websocket url length: ").concat(a.urls.length," current index: ").concat(a.currentURLIndex)),a.emit(Me.RECONNECT_WAITTING_FINISH,i),yield h(a.urls[a.currentURLIndex],i)}else"recover"===i&&(I.debug("[".concat(a.name,"] request new urls")),a.resetReconnectCount("recover mode"),a.emit(Me.RECONNECT_WAITTING_FINISH,i),a.urls=yield nn(a,Me.REQUEST_NEW_URLS),a.currentURLIndex=0,yield h(a.urls[a.currentURLIndex],i))}catch(_){var f;I.error("[".concat(a.name,"] reconnect failed ").concat(_&&_.toString()));const g=null==_||null===(f=_.data)||void 0===f?void 0:f.desc;return Array.isArray(g)&&ye(g).call(g,"dynamic key expired")?(a.emit(Me.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):a.reconnectWithAction(i,d)}return!0})()}}class pp extends JO{constructor(i,r){super(i,r,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(i,r){var a=this;return L(function*(){const d=dm(),l=new o2(a.forceCloseTimeout,a.store);a.closeEstablishingWs=()=>{I.debug("[choose-best-ws] close establishing websockets"),l.closeAllWebsockets(),d.reject(new ee(k.WS_ABORT,"choose best websocket aborted"))};const h=B("GATEWAY_DOMAINS");return I.debug("[choose-best-ws] currentDomain: ",i,", domains: ",h,"total: ".concat(a.urls.length),"current: ".concat(a.currentURLIndex+1)),l.chooseBestWebsocket(i,a.tryDoubleDomain,a.use443PortOnly,r).then(d.resolve).catch(d.reject),d.promise.finally(()=>{a.closeEstablishingWs=void 0})})()}}class Lm extends JO{constructor(i,r){super(i,r,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(i,r){var a=this;return L(function*(){return new X((d,l)=>{let h=!1;const f=[];a.closeEstablishingWs=()=>{I.debug("[choose-best-ws] close establishing websockets"),f.forEach(O=>{O.onclose=null,O.onopen=null,O.onmessage=null,O.close()}),l(new ee(k.WS_ABORT,"choose best websocket aborted"))};const _=B("GATEWAY_DOMAINS");let g;const v=i.indexOf("?h="),b=_.find(O=>-1!==v?ye(i).call(i,O,v):ye(i).call(i,O));I.debug("[choose-best-ws] currentDomain: ",b,", domains: ",_);let y=!a.tryDoubleDomain||!b;if(!y&&b){var T;const O=Date.now();try{_.forEach(D=>{const x=-1===v?i.replace(b,D):i.substr(0,v)+i.substr(v).replace(b,D),F=new WebSocket(x);F.binaryType="arraybuffer",f.push(F),I.debug("[choose-best-ws] ws is connecting:",F.url)})}catch{for(I.debug("[choose-best-ws] ws create failed, fallback to single url"),f.forEach(x=>x.close());f.length;)f.pop();y=!0}null===(T=a.store)||void 0===T||T.recordJoinChannelService({urls:f.map(D=>D.url),service:"gateway"},r),f.forEach(D=>{D.onopen=()=>{if(h)return;const x=Date.now()-O;I.debug("[choose-best-ws] ws open cost ".concat(x,"ms")),f.filter(F=>F!==D).forEach(F=>{I.debug("[choose-best-ws]close backup websocket: ".concat(F.url)),F.close()}),h=!0,d(D)},D.onclose=x=>{g=x,!h&&(f.find(F=>!(F.readyState===WebSocket.CLOSED||F.readyState===WebSocket.CLOSING))||(I.debug("[choose-best-ws] all websocket is closed"),h=!0,l(g)))},D.onmessage=x=>{I.debug("[choose-best-ws]".concat(D.url," onmessage: ").concat(x.data))}}),Un(a.forceCloseTimeout).then(()=>{f.forEach(D=>{D.readyState!==WebSocket.OPEN&&D.close()})})}if(y){var M;let O;I.debug("[choose-best-ws] use single url: ",i),null===(M=a.store)||void 0===M||M.recordJoinChannelService({urls:[i],service:"gateway"},r);try{O=new WebSocket(i),f.push(O),O.binaryType="arraybuffer"}catch(D){const x=new ee(k.WS_ERR,"init websocket failed! Error: ".concat(D.toString()));return I.error("[".concat(a.name,"]").concat(x)),void l(x)}O.onopen=()=>{d(O)},O.onclose=D=>{l(D)},O.onmessage=D=>{I.debug("[choose-best-ws]".concat(O.url," onmessage: ").concat(D.data))},Un(a.forceCloseTimeout).then(()=>{O&&O.readyState!==WebSocket.OPEN&&O.close()})}}).then(d=>(a.closeEstablishingWs=void 0,d)).catch(d=>{throw a.closeEstablishingWs=void 0,d})})()}}class ST extends jt{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===Ee.CONNECTED?this.emit(de.WS_CONNECTED):i===Ee.RECONNECTING?this.emit(de.WS_RECONNECTING,this._websocketReconnectReason):i===Ee.CLOSED&&this.emit(de.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(i,r){super(),C(this,"_disconnectedReason",void 0),C(this,"_websocketReconnectReason",void 0),C(this,"_connectionState",Ee.CLOSED),C(this,"reconnectToken",void 0),C(this,"websocket",void 0),C(this,"openConnectionTime",void 0),C(this,"clientId",void 0),C(this,"lastMsgTime",Date.now()),C(this,"uploadCache",[]),C(this,"uploadCacheInterval",void 0),C(this,"rttRolling",new Oc(5)),C(this,"pingpongTimer",void 0),C(this,"wsInflateDataTimer",void 0),C(this,"pingpongTimeoutCount",0),C(this,"joinResponse",void 0),C(this,"multiIpOption",void 0),C(this,"initError",void 0),C(this,"spec",void 0),C(this,"store",void 0),C(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(de.ON_BINARY_DATA,a.data);const d=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(d,"_id")){const l="res-@".concat(d._id);this.emit(l,d._result,d._message)}else if(Object.prototype.hasOwnProperty.call(d,"_type")){if(this.emit(d._type,d._message),d._type===xe.ON_NOTIFICATION&&this.handleNotification(d._message),d._type===xe.ON_USER_BANNED)switch(d._message.error_code){case 14:this.close(ze.UID_BANNED);break;case 15:this.close(ze.IP_BANNED);break;case 16:this.close(ze.CHANNEL_BANNED)}if(d._type===xe.ON_USER_LICENSE_BANNED)switch(d._message.error_code){case oe.ERR_LICENSE_MISSING:this.close(ze.LICENSE_MISSING);break;case oe.ERR_LICENSE_EXPIRED:this.close(ze.LICENSE_EXPIRED);break;case oe.ERR_LICENSE_MINUTES_EXCEEDED:this.close(ze.LICENSE_MINUTES_EXCEEDED);break;case oe.ERR_LICENSE_PERIOD_INVALID:this.close(ze.LICENSE_PERIOD_INVALID);break;case oe.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(ze.LICENSE_MULTIPLE_SDK_SERVICE);break;case oe.ERR_LICENSE_ILLEGAL:this.close(ze.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=i.clientId,this.spec=i,this.store=r,this.websocket=new pp("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ee.CONNECTED&&this.reconnect("retry",_i.OFFLINE)})}request(i,r,a,d){var l=this;return L(function*(){const h=qe(6,""),f={_id:h,_type:i,_message:r},_=l.websocket.connectionID,g=()=>new X((O,D)=>{if(l.connectionState===Ee.CONNECTED)return O();const x=()=>{l.off(de.WS_CLOSED,F),O()},F=()=>{l.off(de.WS_CONNECTED,x),D(new W(k.WS_ABORT))};l.once(de.WS_CONNECTED,x),l.once(de.WS_CLOSED,F),i!==Ae.PUBLISH&&i!==Ae.SUBSCRIBE&&i!==Ae.UNSUBSCRIBE&&i!==Ae.UNPUBLISH&&i!==Ae.CONTROL&&i!==Ae.RESTART_ICE||l.once(de.DISCONNECT_P2P,()=>{D(new W(k.DISCONNECT_P2P))}),i!==Ae.PUBLISH&&i!==Ae.RESTART_ICE||l.once(de.ABORT_P2P_EXECUTION,()=>{D(new W(k.DISCONNECT_P2P))})});if(l.connectionState!==Ee.CONNECTING&&l.connectionState!==Ee.RECONNECTING||i===Ae.JOIN||i===Ae.REJOIN||(yield g()),l.websocket.sendMessage(f,!0),d)return;const v=new X((O,D)=>{let x=!1;const F=(Y,te)=>{x=!0,O({isSuccess:"success"===Y,message:te||{}}),l.off(de.WS_CLOSED,j),l.off(de.WS_RECONNECTING,j),l.emit(de.REQUEST_SUCCESS,i,r)};l.once("res-@".concat(h),F);const j=()=>{D(new W(k.WS_ABORT,"type: ".concat(i))),l.off(de.WS_CLOSED,j),l.off(de.WS_RECONNECTING,j),l.off("res-@".concat(h),F)};l.once(de.WS_CLOSED,j),l.once(de.WS_RECONNECTING,j),Un(B("SIGNAL_REQUEST_TIMEOUT")).then(()=>{l.websocket.connectionID!==_||x||(I.warning("[".concat(l.clientId,"] ws request timeout, type: ").concat(i)),l.emit(de.REQUEST_TIMEOUT,i,r))})});let b=null;try{b=yield v}catch(O){if(l.connectionState===Ee.CLOSED||i===Ae.LEAVE)throw new W(k.WS_ABORT);return!l.spec.forceWaitGatewayResponse||a?O.throw():i===Ae.JOIN||i===Ae.REJOIN?null:(yield g(),yield l.request(i,r))}if(b.isSuccess)return b.message;const y=Number(b.message.error_code||b.message.code),T=au(y),M=new W(k.UNEXPECTED_RESPONSE,"".concat(T.desc,": ").concat(b.message.error_str),{code:y,data:b.message});return"success"===T.action?b.message:(I.warning("[".concat(l.clientId,"] [").concat(l.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(y,", message: ").concat(T.desc,", action: ").concat(T.action)),y===oe.ERR_TOO_MANY_BROADCASTERS?((i===Ae.JOIN||i===Ae.REJOIN)&&(l.initError=M,l.close()),M.throw()):"failed"===T.action?M.throw():"quit"===T.action?(l.initError=M,l.close(),M.throw()):(y===oe.ERR_JOIN_BY_MULTI_IP?(l.multiIpOption=b.message.option,I.warning("[".concat(l.clientId,"] detect multi ip, recover")),l.reconnect("recover",_i.MULTI_IP)):l.reconnect(T.action,_i.SERVER_ERROR),i===Ae.JOIN||i===Ae.REJOIN?null:yield l.request(i,r)))})()}waitMessage(i,r){return new X(a=>{const d=l=>{(!r||r(l))&&(this.off(i,d),a(l))};this.on(i,d)})}uploadWRTCStats(i){if(!this.store.sessionId)return void I.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:i};this.upload(kc.WRTC_STATS,r)}upload(i,r){const a={_type:i,_message:r};try{this.websocket.sendMessage(a)}catch{const l=B("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ee.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},B("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,r){this.websocket.sendMessage({_type:i,_message:r})}init(i,r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new X((a,d)=>{this.once(de.WS_CONNECTED,()=>a(this.joinResponse)),this.once(de.WS_CLOSED,()=>d(this.initError||new W(k.WS_ABORT))),this.connectionState=Ee.CONNECTING,this.websocket.init(i).catch(d),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=i||ze.LEAVE,this.connectionState=Ee.CLOSED,I.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),i===ze.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new pp("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}join(){var i=this;return L(function*(){if(!i.joinResponse){i.emit(de.ABORT_P2P_EXECUTION);const r=yield nn(i,de.REQUEST_JOIN_INFO),a=yield i.request(Ae.JOIN,r);if(!a)return i.emit(de.REPORT_JOIN_GATEWAY,Ud.TIMEOUT,i.url||""),!1;i.joinResponse=a,i.emit(de.JOIN_RESPONSE,i.joinResponse),i.reconnectToken=i.joinResponse.rejoin_token}return i.connectionState=Ee.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),!0})()}rejoin(){var i=this;return L(function*(){if(!i.reconnectToken)throw new W(k.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=mr(i,de.REQUEST_REJOIN_INFO);r.token=i.reconnectToken;const a=yield i.request(Ae.REJOIN,r);return!!a&&(i.connectionState=Ee.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),a.peers&&a.peers.forEach(d=>{i.emit(xe.ON_USER_ONLINE,{uid:d.uid}),d.audio&&i.emit(xe.ON_ADD_AUDIO_STREAM,{uid:d.uid,uint_id:d.uint_id,audio:!0,ssrcId:d.audio_ssrc}),d.video&&i.emit(xe.ON_ADD_VIDEO_STREAM,{uid:d.uid,uint_id:d.uint_id,video:!0,ssrcId:d.video_ssrc}),i.emit(d.audio_mute?xe.MUTE_AUDIO:xe.UNMUTE_AUDIO,{uid:d.uid}),i.emit(d.video_mute?xe.MUTE_VIDEO:xe.UNMUTE_VIDEO,{uid:d.uid}),i.emit(d.audio_enable_local?xe.ENABLE_LOCAL_AUDIO:xe.DISABLE_LOCAL_AUDIO,{uid:d.uid}),i.emit(d.video_enable_local?xe.ENABLE_LOCAL_VIDEO:xe.DISABLE_LOCAL_VIDEO,{uid:d.uid}),d.audio||d.video||i.emit(xe.ON_REMOVE_STREAM,{uid:d.uid,uint_id:d.uint_id})}),!0)})()}reconnect(i,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,r)}handleNotification(i){I.debug("[".concat(this.clientId,"] receive notification: "),i);const r=au(i.code);if("success"!==r.action){if("failed"!==r.action)return"quit"===r.action?("ERR_REPEAT_JOIN_CHANNEL"===r.desc&&this.close(ze.UID_BANNED),void this.close()):void this.reconnect(r.action,_i.SERVER_ERROR);I.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=B("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=i&&(I.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>B("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",_i.TIMEOUT):this.request(Ae.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-r;this.rttRolling.add(a),B("REPORT_STATS")&&this.send(Ae.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWsInflateData(){const{wsInflateLength:i,wsDeflateLength:r}=this.websocket.getWsInflateData();0!==i&&0!==r&&this.upload(kc.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:i})}handleWebsocketEvents(){this.websocket.on(Me.RECONNECT_WAITTING_FINISH,i=>{this.emit(de.WS_RECONNECT_WAITTING_FINISH,i)}),this.websocket.on(Me.RECONNECT_CREATE_CONNECTION,i=>{this.emit(de.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(Me.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Me.CLOSED,()=>{this.connectionState=Ee.CLOSED}),this.websocket.on(Me.FAILED,()=>{this._disconnectedReason=ze.NETWORK_ERROR,this.connectionState=Ee.CLOSED}),this.websocket.on(Me.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState=this.connectionState===Ee.CONNECTED?Ee.RECONNECTING:Ee.CONNECTING}),this.websocket.on(Me.WILL_RECONNECT,(i,r,a)=>{const d=mr(this,de.IS_P2P_DISCONNECTED),l=d||"retry"!==i;d&&"retry"===i&&(I.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),i="tryNext",r=Ud.P2P_DISCONNECTED),l&&(I.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(i)),this.emit(de.REPORT_JOIN_GATEWAY,r||Ud.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION),this.emit(de.DISCONNECT_P2P)),a(i)}),this.websocket.on(Me.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(i=>{I.warning("[".concat(this.clientId,"] rejoin failed ").concat(i)),this.reconnect("tryNext",_i.SERVER_ERROR)}):this.join().catch(i=>{if(this.emit(de.REPORT_JOIN_GATEWAY,i.message||i.code||Ud.UNKNOWN_REASON,this.url||""),i instanceof W&&i.code===k.UNEXPECTED_RESPONSE&&i.data.code===oe.ERR_NO_AUTHORIZED)return I.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",_i.SERVER_ERROR);I.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",_i.SERVER_ERROR):(this.initError=i,this.close())})}),this.websocket.on(Me.REQUEST_NEW_URLS,(i,r)=>{nn(this,de.REQUEST_RECOVER,this.multiIpOption).then(i).catch(r)}),this.websocket.on(Me.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(xe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var QO="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",CT=gl,s2=pc,Tv=QO,TT=Ri("".replace),a2=RegExp("^["+Tv+"]+"),c2=RegExp("(^|[^"+Tv+"])["+Tv+"]+$"),IT=function(s){return function(i){var r=s2(CT(i));return 1&s&&(r=TT(r,a2,"")),2&s&&(r=TT(r,c2,"$1")),r}},wT={start:IT(1),end:IT(2),trim:IT(3)},d2=M1.PROPER,ZO=an,eN=QO,l2=wT.trim;Bt({target:"String",proto:!0,forced:function(s){return ZO(function(){return!!eN[s]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[s]()||d2&&eN[s].name!==s})}("trim")},{trim:function(){return l2(this)}});var bi,us,u2=hc("String").trim,h2=Ds,p2=u2,RT=String.prototype,Iv=Rt(function(s){var i=s.trim;return"string"==typeof s||s===RT||h2(RT,s)&&i===RT.trim?p2:i});function AT(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function wv(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?AT(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):AT(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function Bd(s){return s.match(/^[\.\:\d]+$/)?"".concat(s.replace(/[^\d]/g,"-"),".").concat(B("TURN_DOMAIN")):(I.info("Unidentified as ip: ".concat(s,", use as host")),s)}function DT(s,i){s.addresses||(s.addresses=[]);const r=function(l,h){if(B("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return l.map(g=>{let{ip:v,port:b}=g;return{address:"".concat(v,":").concat(b)}});const f=B("GATEWAY_DOMAINS");let _=f[1]&&ye(h).call(h,f[1])?1:0;return l.map(g=>{let{domain_prefix:v,port:b,ip:y}=g;if(v)return{address:"".concat(v,".").concat(f[_++%f.length],":").concat(b)};const T=/^[\.\:\d]+$/.test(y),M=T?"".concat(y.replace(/[^\d]/g,"-"),".").concat(f[_++%f.length],":").concat(b):"".concat(y,":").concat(b);return T||I.info("Unidentified as ip: ".concat(y,", use as host")),{ip:y,port:b,address:M}})}(s.addresses,i),a=Array.isArray(s.detail)&&s.detail[18];if(a&&"string"==typeof a){const l=a.split(";");for(let h=0;h<l.length;h++){var d;const f=Iv(d=l[h]).call(d);r[h]&&f&&(r[h].ip6=f)}}return{gatewayAddrs:r,uid:s.uid,cid:s.cid,cert:s.cert,vid:s.detail&&s.detail[8],uni_lbs_ip:s.detail&&s.detail[1],res:s,csIp:s.detail&&s.detail[502]}}function No(s){return"number"==typeof s?s:s.exact||s.ideal||s.max||s.min||0}function tN(s){const i=s._encoderConfig;if(!i)return{};const r={resolution:i.width&&i.height?"".concat(No(i.width),"x").concat(No(i.height)):void 0,maxVideoBW:i.bitrateMax,minVideoBW:i.bitrateMin};return"number"==typeof i.frameRate?(r.maxFrameRate=i.frameRate,r.minFrameRate=i.frameRate):i.frameRate&&(r.maxFrameRate=i.frameRate.max||i.frameRate.ideal||i.frameRate.exact||i.frameRate.min,r.minFrameRate=i.frameRate.min||i.frameRate.ideal||i.frameRate.exact||i.frameRate.max),r}function fp(s){return s>=0&&s<.17?1:s>=.17&&s<.36?2:s>=.36&&s<.59?3:s>=.59&&s<=1?4:s>1?5:0}function Rv(s,i){let r,a,d;switch(i){case bi.CHOOSE_SERVER:a=4096,d="choose server";break;case bi.CLOUD_PROXY:a=1048576,d="proxy";break;case bi.CLOUD_PROXY_5:a=4194304,d="proxy5";break;case bi.CLOUD_PROXY_FALLBACK:a=4194310,d="proxy fallback";break;default:throw new W(k.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:s.detail&&s.detail[502],retry:!1})}if(s.response_body.forEach(l=>{l.buffer&&l.buffer.flag===a&&(r={code:l.buffer.code,addresses:(l.buffer.edges_services||[]).map(h=>wv(wv({},h),{},{ticket:l.buffer.cert})),server_ts:s.enter_ts,uid:l.buffer.uid,cid:l.buffer.cid,cname:l.buffer.cname,detail:wv(wv({},l.buffer.detail),s.detail),flag:l.buffer.flag,opid:s.opid,cert:l.buffer.cert})}),!r)throw new W(k.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(d," from multi unilbs response"),{csIp:s.detail&&s.detail[502]});return r}function mn(s,i){return Av.apply(this,arguments)}function Av(){return Av=L(function*(s,i){return yield X.all(s.addresses.map(function(){var r=L(function*(a){return{address:Bd(a.ip),tcpport:a.port,udpport:a.port,username:i&&B("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?i.toString():Er.username,password:i&&B("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?yield $h(i.toString()):Er.password}});return function(a){return r.apply(this,arguments)}}()))}),Av.apply(this,arguments)}function OT(s,i){const r=i._videoHeight||i.getMediaStreamTrack(!0).getSettings().height;return r?Math.max(r/No(s.height),1):(I.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Bc(s){let{candidateType:i,relayProtocol:r,type:a,address:d,port:l,protocol:h}=s;return"local-candidate"===a?{candidateType:i,relayProtocol:r,protocol:h}:{candidateType:i,relayProtocol:r,address:d,port:l,protocol:h}}function NT(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}!function(s){s[s.CHOOSE_SERVER=11]="CHOOSE_SERVER",s[s.CLOUD_PROXY=18]="CLOUD_PROXY",s[s.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",s[s.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"}(bi||(bi={}));class nN extends jt{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(i){var r;ye(r=["tryNext","recover"]).call(r,i)&&this.resetReconnectCount(i),this._reconnectMode=i}get state(){return this._state}set state(i){i!==this._state&&(this._state=i,"reconnecting"===this._state?this.emit(pn.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(pn.CONNECTED):"closed"===this._state?this.emit(pn.CLOSED):"failed"===this._state&&this.emit(pn.FAILED))}constructor(i,r,a,d){super(),C(this,"connectionID",0),C(this,"currentURLIndex",0),C(this,"reconnectReason",void 0),C(this,"_reconnectMode","tryNext"),C(this,"_name",void 0),C(this,"_state","closed"),C(this,"_retryConfig",void 0),C(this,"_reconnectCount",0),C(this,"_forceCloseTimeout",5e3),C(this,"_onlineReconnectListener",void 0),C(this,"_closeEstablishingTransmitter",()=>{}),C(this,"_store",void 0),C(this,"_joinChannelServiceRecordIndex",void 0),C(this,"_useCompress",void 0),C(this,"_inflateLength",0),C(this,"_deflateLength",0),this._store=d,this._name=i,this._retryConfig=function(l){for(var h=1;h<arguments.length;h++){var f=null!=arguments[h]?arguments[h]:{};h%2?NT(Object(f),!0).forEach(function(_){C(l,_,f[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(f)):NT(Object(f)).forEach(function(_){Object.defineProperty(l,_,Object.getOwnPropertyDescriptor(f,_))})}return l}({},r),this._useCompress=a}resetReconnectCount(i){I.debug("".concat(this._name," reset reconnect count, reason: ").concat(i)),this._reconnectCount=0}close(i,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const a=this._transmitter;r?setTimeout(()=>a.close(),500):a.close(),this._transmitter=void 0}this.state=i?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(i,r){if(!this._transmitter)return void I.warning("[".concat(this._name,"] can not reconnect, no websocket"));var a;void 0!==i&&(this.reconnectMode=i),I.debug("[".concat(this._name,"] reconnect is triggered initiative")),"number"==typeof this._joinChannelServiceRecordIndex&&(null===(a=this._store)||void 0===a||a.recordJoinChannelService({status:"error",errors:[new Error(r)]},this._joinChannelServiceRecordIndex));const d=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),d&&d.bind(this._transmitter)({code:9999,reason:r})}getInflateData(){const i=this._inflateLength,r=this._deflateLength;return this.clearInflateData(),{inflateLength:i,deflateLength:r}}setInflateData(i){this._deflateLength=this._deflateLength+i.originLength,this._inflateLength=this._inflateLength+i.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}!function(s){s[s.Default=0]="Default",s[s.Ack=1]="Ack"}(us||(us={}));class _n{constructor(i,r,a){C(this,"version",1),C(this,"initialRTO",void 0),C(this,"maxBatchAckCount",void 0),C(this,"maxRTO",void 0),C(this,"initialRTT",void 0),C(this,"ID",void 0),C(this,"rtt",void 0),C(this,"packetNumber",1),C(this,"rtoRatioMap",new Map),C(this,"timeoutMap",new Map),C(this,"unorderedPacketQueue",[]),C(this,"batchAckPacketQueue",[]),C(this,"lastOrderedPacketNumber",0),C(this,"batchAckTimer",void 0),C(this,"sendImpl",void 0),C(this,"receiveImpl",void 0),this.sendImpl=i,this.receiveImpl=r,this.ID=qe(7,"transmitter-"),this.initialRTO=void 0!==a?.initialRTO?a.initialRTO:B("TRANSMITTER_INITIAL_RTO"),this.initialRTT=void 0!==a?.initialRTT?a.initialRTT:B("TRANSMITTER_INITIAL_RTT"),this.rtt=void 0!==a?.initialRTT?a.initialRTT:B("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=void 0!==a?.maxBatchAckCount?a.maxBatchAckCount:B("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=void 0!==a?.maxRTO?a.maxRTO:B("TRANSMITTER_MAX_RTO")}packetize(i,r){return{type:us.Default,version:this.version,packetNumber:r,payload:i}}serialize(i){switch(i.type){case us.Default:{let r;r="string"==typeof i.payload?(new TextEncoder).encode(i.payload):i.payload;const a=new ArrayBuffer(r.length+15),d=new DataView(a);return d.setUint16(0,i.version),d.setUint8(2,i.type),d.setUint32(3,i.packetNumber),xD(d,7,BigInt(i.sendTs)),new Uint8Array(d.buffer).set(r,15),a}case us.Ack:{const r=new ArrayBuffer(16),a=new DataView(r);return a.setUint16(0,i.version),a.setUint8(2,i.type),a.setUint32(3,i.maxAckPacketNumber),a.setUint8(7,i.shift),xD(a,8,BigInt(i.ackSendTs)),r}}}deserialize(i){const r=new DataView(i),a=r.getUint16(0),d=r.getUint8(2);switch(d){case us.Default:{const l=r.getUint32(3),h=pm(r,7),f=i.slice(15),_=(new TextDecoder).decode(f);return{version:a,type:d,packetNumber:l,sendTs:Number(h),payload:_}}case us.Ack:{const l=r.getUint32(3),h=r.getUint8(7),f=pm(r,8);return{version:a,type:d,maxAckPacketNumber:l,shift:h,ackSendTs:Number(f)}}default:throw I.error("[".concat(this.ID,"] Unrecognized packet type ").concat(d)),new Error("Unrecognized packet type ".concat(d))}}sendMessage(i){const r=this.packetize(i,this.packetNumber);this.packetNumber=4294967295===this.packetNumber?1:this.packetNumber+1;const a=this.calculateRTO(r),d=window.setTimeout(()=>{this.resendMessage(r)},a);this.timeoutMap.set(r.packetNumber,d),this.sendPacket(r)}onData(i){const r=this.deserialize(i);r.type===us.Default?this.ack(r):r.type===us.Ack&&(this.updateRTT(r,Math.round(performance.now())),this.clearRTO(r))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(i=>{let[r,a]=i;window.clearTimeout(a)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,void 0!==this.batchAckTimer&&window.clearTimeout(this.batchAckTimer)}resendMessage(i){const r=this.calculateRTO(i),a=window.setTimeout(()=>{this.resendMessage(i)},r);this.timeoutMap.set(i.packetNumber,a),this.sendPacket(i)}calculateRTO(i){const r=this.rtoRatioMap.get(i.packetNumber);if(void 0===r)return this.rtoRatioMap.set(i.packetNumber,1),this.initialRTO;{const a=9*this.rtt/8*r;return this.rtoRatioMap.set(i.packetNumber,r+1),a>this.maxRTO?this.maxRTO:a}}updateRTT(i,r){this.rtt=this.rtt*(7/8)+(r-i.ackSendTs-this.rtt)/8}ack(i){if(i.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(i):(this.batchAckPacketQueue.push(i),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(i.payload);;){const r=this.unorderedPacketQueue[0];if(!r){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(r.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else i.packetNumber<=this.lastOrderedPacketNumber?this.sendPacket({ackSendTs:i.sendTs,maxAckPacketNumber:i.packetNumber,shift:0,type:us.Ack,version:this.version}):i.packetNumber>this.lastOrderedPacketNumber&&(this.unorderedPacketQueue[i.packetNumber-this.lastOrderedPacketNumber-2]=i,this.sendPacket({ackSendTs:i.sendTs,maxAckPacketNumber:i.packetNumber,shift:0,type:us.Ack,version:this.version}))}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0,this.sendPacket({ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:us.Ack,version:this.version}),this.batchAckPacketQueue=[]}sendPacket(i){i.type===us.Default&&(i.sendTs=Math.round(performance.now()));const r=this.serialize(i);this.sendImpl(r)}clearRTO(i){for(let r=i.maxAckPacketNumber-i.shift;r<=i.maxAckPacketNumber;r++){const a=this.timeoutMap.get(r);void 0!==a&&window.clearTimeout(a),this.timeoutMap.delete(r),this.rtoRatioMap.delete(r)}}}class iN extends nN{constructor(i,r){super(i,r,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3?arguments[3]:void 0),C(this,"_initMutex",void 0),C(this,"_reconnectInterrupter",void 0),C(this,"_url",void 0),C(this,"_transmitter",void 0),C(this,"_addresses",void 0),C(this,"_reliableTransmission",void 0),this._initMutex=new gi("datachannel");const{timeout:a,timeoutFactor:d}=r,l=Math.max(300,Math.floor(3*a/5)),h=Math.max(1.2,Math.floor(8*d)/10);$i.ONLINE&&(this._retryConfig.timeout=l,this._retryConfig.timeoutFactor=h),Fn.on(Ac.NETWORK_STATE_CHANGE,(f,_)=>{f!==_&&(this.resetReconnectCount("network state change: ".concat(_," -> ").concat(f)),f===$i.ONLINE?(this._retryConfig.timeout=l,this._retryConfig.timeoutFactor=h):(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=d))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}init(i){var r=arguments,a=this;return L(function*(){a._forceCloseTimeout=r.length>1&&void 0!==r[1]?r[1]:5e3;return a._initMutex.lock().then(h=>new X((f,_)=>{((h,f)=>{a._addresses=i,a.currentURLIndex=a._addresses.findIndex(g=>g.fingerprint||B("FINGERPRINT"));const _=a._addresses[a.currentURLIndex];a.state="connecting",a.createTransmitterConnection(_).then(h).catch(f),a.once(pn.CLOSED,()=>f(new W(k.WS_DISCONNECT))),a.once(pn.CONNECTED,()=>h())})(f,_)}).then(()=>{h()}).catch(()=>{h()}))})()}sendMessage(i){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new W(k.WS_ABORT,"datachannel is not ready");try{r||(i=JSON.stringify(i)),this._reliableTransmission.sendMessage(i)}catch(a){throw new W(k.WS_ERR,"send datachannel signal message error"+a.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(i){const r=JSON.stringify(i);return{compressed:r,compressedLength:r.length,origin:i}}sendMessageWithUint8Array(i){return{compressed:i,compressedLength:i.byteLength,origin:i}}createTransmitterConnection(i){var r=this;return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(i.ip,":").concat(i.port),new X((a,d)=>{var l;const h=()=>{I.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),a()},f=function(){var b=L(function*(y){var T;if(null===(T=r._closeEstablishingTransmitter)||void 0===T||T.call(r),I.debug("[".concat(r._name,"] datachannel close ").concat(r._url,", code: ").concat(y.code,", reason: ").concat(y.reason,", current mode: ").concat(r.reconnectMode)),r._reconnectCount<r._retryConfig.maxRetryCount){"connected"===r.state&&(r.reconnectReason=y.reason,r.state="reconnecting");const M=Mr(r,pn.WILL_RECONNECT,r.reconnectMode)||r.reconnectMode,O=yield r.reconnectWithAction(M);if("closed"===r.state)return void I.debug("[".concat(r.connectionID,"] dc is closed, no need to reconnect"));if(!O)return d(new W(k.WS_DISCONNECT,"datachannel reconnect failed: ".concat(y.code))),void r.close(!0);a()}else d(new W(k.WS_DISCONNECT,"datachannel close: ".concat(y.code))),r.close()});return function(T){return b.apply(this,arguments)}}(),_=b=>{var y;null===(y=this._reliableTransmission)||void 0===y||y.onData(b.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),I.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(i)));const g=null===(l=this._store)||void 0===l?void 0:l.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),v=Date.now();nn(this,pn.TO_CONNECT_DATACHANNEL,i).then(b=>{var y,T;if(!b)throw new Error("transmissonInfo not exist yet");const{transmitter:M,close:O}=b;this._transmitter=M,null===(y=this._store)||void 0===y||y.signalChannelOpen();const D=Date.now()-v;I.debug("[choose dc] dc open cost ".concat(D,"ms")),this._reliableTransmission=new _n(x=>{var F;this._transmitter&&"open"===this._transmitter.readyState&&(null===(F=this._transmitter)||void 0===F||F.send(x))},x=>{"string"==typeof x&&this.emit(pn.ON_MESSAGE,x)}),this._closeEstablishingTransmitter=()=>{var x;null===(x=this._reliableTransmission)||void 0===x||x.close(),this._reliableTransmission=void 0,O()},h&&h(),M.onclose=f,M.onmessage=_,null===(T=this._store)||void 0===T||T.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this._joinChannelServiceRecordIndex=g}).catch(b=>{var y;if(null===(y=this._store)||void 0===y||y.recordJoinChannelService({endTs:Date.now(),status:b instanceof W&&b.code===k.WS_ABORT?"aborted":"error",errors:[b]},g),"closed"!==this.state){if(b instanceof W&&b.code===k.WS_ERR){const T=new W(k.WS_ERR,"init datachannel failed! Error: ".concat(b.toString()));return I.error("[".concat(this._name,"]").concat(T)),void d(T)}f&&f(b)}else d(new W(k.WS_DISCONNECT,"datachannel is closed: ".concat(b.toString())))})})}reconnectWithAction(i){var r=arguments,a=this;return L(function*(){let d=!(r.length>1&&void 0!==r[1])||r[1];if(a._reconnectCount>=a._retryConfig.maxRetryCount||!a._addresses||"closed"===a.state)return!1;a._onlineReconnectListener||Fn.networkState!==$i.OFFLINE||(a._onlineReconnectListener=Fn.onlineWaiter&&Fn.onlineWaiter.then(()=>{a._onlineReconnectListener=void 0}));let l=!0;if(a._reconnectInterrupter=()=>{l=!1},d){const g=ev(a._reconnectCount,a._retryConfig);I.debug("[".concat(a._name,"] wait ").concat(g,"ms to reconnect datachannel, mode: ").concat(i)),yield X.race([Un(g),a._onlineReconnectListener||new X(()=>{})])}if("closed"===a.state||!l)return!1;a._reconnectCount+=1;const h=function(){var g=L(function*(v,b){a.emit(pn.RECONNECT_CREATE_CONNECTION,b),yield a.createTransmitterConnection(v)});return function(b,y){return g.apply(this,arguments)}}();try{if("retry"===i){const g=a._addresses[a.currentURLIndex];a.emit(pn.RECONNECT_WAITTING_FINISH,i),yield h(g,i)}else if("tryNext"===i){a.currentURLIndex+=1;for(let v=a.currentURLIndex;v<a._addresses.length;v++){if(a._addresses[v].fingerprint||B("FINGERPRINT")){a.currentURLIndex=v;break}a.currentURLIndex+=1}if(a.currentURLIndex>=a._addresses.length)return I.debug("[".concat(a._name,"] the available addresses are exhausted, change to recover")),yield a.reconnectWithAction("recover",!1);I.debug("[".concat(a._name,"] datachannel url length: ").concat(a._addresses.length," current index: ").concat(a.currentURLIndex));const g=a._addresses[a.currentURLIndex];a.emit(pn.RECONNECT_WAITTING_FINISH,i),yield h(g,i)}else"recover"===i&&(I.debug("[".concat(a._name,"] start to failback to websocket")),a.resetReconnectCount("recover mode"),a.emit(pn.RECONNECT_WAITTING_FINISH,i),a.emit(pn.FAILBACK));return!0}catch(g){var f,_;return I.error("[".concat(a._name,"] reconnect failed"),g.toString()),null!=g&&null!==(f=g.data)&&void 0!==f&&f.desc&&Array.isArray(g.data.desc)&&g.data.desc.length&&ye(_=g.data.desc).call(_,"dynamic key expired")?(a.emit(pn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):yield a.reconnectWithAction(i,d)}})()}}class Po extends jt{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===Ee.CONNECTED?this.emit(de.WS_CONNECTED):i===Ee.RECONNECTING?this.emit(de.WS_RECONNECTING,this._websocketReconnectReason):i===Ee.CLOSED&&this.emit(de.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(i,r){super(),C(this,"_disconnectedReason",void 0),C(this,"_websocketReconnectReason",void 0),C(this,"_connectionState",Ee.CLOSED),C(this,"reconnectToken",void 0),C(this,"websocket",void 0),C(this,"openConnectionTime",void 0),C(this,"clientId",void 0),C(this,"lastMsgTime",Date.now()),C(this,"uploadCache",[]),C(this,"uploadCacheInterval",void 0),C(this,"rttRolling",new Oc(5)),C(this,"pingpongTimer",void 0),C(this,"inflateDataTimer",void 0),C(this,"pingpongTimeoutCount",0),C(this,"joinResponse",void 0),C(this,"multiIpOption",void 0),C(this,"initError",void 0),C(this,"spec",void 0),C(this,"store",void 0),C(this,"onWebsocketMessage",a=>{if(a instanceof ArrayBuffer)return void this.emit(de.ON_BINARY_DATA,a);const d=JSON.parse(a);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(d,"_id")){const l="res-@".concat(d._id);this.emit(l,d._result,d._message)}else if(Object.prototype.hasOwnProperty.call(d,"_type")&&(this.emit(d._type,d._message),d._type===xe.ON_NOTIFICATION&&this.handleNotification(d._message),d._type===xe.ON_USER_BANNED))switch(d._message.error_code){case 14:this.close(ze.UID_BANNED);break;case 15:this.close(ze.IP_BANNED);break;case 16:this.close(ze.CHANNEL_BANNED)}}),this.clientId=i.clientId,this.spec=i,this.store=r,this.websocket=new iN("gateway-".concat(this.clientId),this.spec.retryConfig,!0,r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ee.CONNECTED&&this.reconnect("retry",la.OFFLINE)})}request(i,r,a,d){var l=this;return L(function*(){const h=qe(6,""),f={_id:h,_type:i,_message:r},_=l.websocket.connectionID,g=()=>new X((O,D)=>{if(l.connectionState===Ee.CONNECTED)return O();const x=()=>{l.off(de.WS_CLOSED,F),O()},F=()=>{l.off(de.WS_CONNECTED,x),D(new W(k.WS_ABORT))};l.once(de.WS_CONNECTED,x),l.once(de.WS_CLOSED,F),i!==Ae.PUBLISH&&i!==Ae.SUBSCRIBE&&i!==Ae.UNSUBSCRIBE&&i!==Ae.UNPUBLISH&&i!==Ae.CONTROL&&i!==Ae.RESTART_ICE||l.once(de.DISCONNECT_P2P,()=>{D(new W(k.DISCONNECT_P2P))}),i!==Ae.PUBLISH&&i!==Ae.RESTART_ICE||l.once(de.ABORT_P2P_EXECUTION,()=>{D(new W(k.DISCONNECT_P2P))})});if(l.connectionState!==Ee.CONNECTING&&l.connectionState!==Ee.RECONNECTING||i===Ae.JOIN||i===Ae.REJOIN||(yield g()),i===Ae.LEAVE&&(l.websocket.unbindDcCloseEventListener(),d=!0),l.websocket.sendMessage(f,!0,!1),d)return;const v=new X((O,D)=>{let x=!1;const F=(Y,te)=>{x=!0,O({isSuccess:"success"===Y,message:te||{}}),l.off(de.WS_CLOSED,j),l.off(de.WS_RECONNECTING,j),l.emit(de.REQUEST_SUCCESS,i,r)};l.once("res-@".concat(h),F);const j=()=>{D(new W(k.WS_ABORT,"type: ".concat(i))),l.off(de.WS_CLOSED,j),l.off(de.WS_RECONNECTING,j),l.off("res-@".concat(h),F)};l.once(de.WS_CLOSED,j),l.once(de.WS_RECONNECTING,j),Un(B("SIGNAL_REQUEST_TIMEOUT")).then(()=>{l.websocket.connectionID!==_||x||(I.warning("dc request timeout, type: ".concat(i)),l.emit(de.REQUEST_TIMEOUT,i,r))})});let b=null;try{b=yield v}catch(O){if(l.connectionState===Ee.CLOSED||i===Ae.LEAVE)throw new W(k.WS_ABORT);return!l.spec.forceWaitGatewayResponse||a?O.throw():i===Ae.JOIN||i===Ae.REJOIN?null:(yield g(),yield l.request(i,r))}if(b.isSuccess)return b.message;const y=Number(b.message.error_code||b.message.code),T=au(y),M=new W(k.UNEXPECTED_RESPONSE,"".concat(T.desc,": ").concat(b.message.error_str),{code:y,data:b.message});return"success"===T.action?b.message:(I.warning("[".concat(l.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(y,", message: ").concat(T.desc,", action: ").concat(T.action)),y===oe.ERR_TOO_MANY_BROADCASTERS?((i===Ae.JOIN||i===Ae.REJOIN)&&(l.initError=M,l.close()),M.throw()):"failed"===T.action?M.throw():"quit"===T.action?(l.initError=M,l.close(),M.throw()):(y===oe.ERR_JOIN_BY_MULTI_IP?(l.multiIpOption=b.message.option,I.warning("[".concat(l.clientId,"] detect multi ip, recover")),l.reconnect("recover",la.MULTI_IP)):l.reconnect(T.action,la.SERVER_ERROR),i===Ae.JOIN||i===Ae.REJOIN?null:yield l.request(i,r)))})()}waitMessage(i,r){return new X(a=>{const d=l=>{(!r||r(l))&&(this.off(i,d),a(l))};this.on(i,d)})}uploadWRTCStats(i){if(!this.store.sessionId)return void I.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:i};this.upload(kc.WRTC_STATS,r)}upload(i,r){const a={_type:i,_message:r};try{this.websocket.sendMessage(a)}catch{const l=B("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ee.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},B("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,r){this.websocket.sendMessage({_type:i,_message:r})}init(i,r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new X((a,d)=>{this.once(de.WS_CONNECTED,()=>a(this.joinResponse)),this.once(de.WS_CLOSED,()=>d(this.initError||new W(k.WS_ABORT))),this.connectionState=Ee.CONNECTING,this.websocket.init(i).catch(d),this.websocket.once(pn.FAILBACK,()=>{void 0===this.openConnectionTime&&d(new W(k.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{r&&void 0===this.openConnectionTime&&(I.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),d(new W(k.INIT_DATACHANNEL_TIMEOUT)))},B("DC_JOIN_WITH_FAILBACK"))})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=i||ze.LEAVE,this.connectionState=Ee.CLOSED,I.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),i===ze.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new iN("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}join(){var i=this;return L(function*(){if(!i.joinResponse){i.emit(de.ABORT_P2P_EXECUTION);const r=yield nn(i,de.DATACHANNEL_CONNECTING),a=yield i.request(Ae.JOIN,r);if(!a)return i.emit(de.REPORT_JOIN_GATEWAY,k.TIMEOUT,i.url||""),!1;i.joinResponse=a,i.emit(de.JOIN_RESPONSE,i.joinResponse),i.reconnectToken=i.joinResponse.rejoin_token}return i.connectionState=Ee.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),!0})()}rejoin(){var i=this;return L(function*(){if(!i.reconnectToken)throw new W(k.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=mr(i,de.REQUEST_REJOIN_INFO);r.token=i.reconnectToken;const a=yield i.request(Ae.REJOIN,r);return!!a&&(i.connectionState=Ee.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),a.peers&&a.peers.forEach(d=>{i.emit(xe.ON_USER_ONLINE,{uid:d.uid}),d.audio&&i.emit(xe.ON_ADD_AUDIO_STREAM,{uid:d.uid,uint_id:d.uint_id,audio:!0,ssrcId:d.audio_ssrc}),d.video&&i.emit(xe.ON_ADD_VIDEO_STREAM,{uid:d.uid,uint_id:d.uint_id,video:!0,ssrcId:d.video_ssrc}),i.emit(d.audio_mute?xe.MUTE_AUDIO:xe.UNMUTE_AUDIO,{uid:d.uid}),i.emit(d.video_mute?xe.MUTE_VIDEO:xe.UNMUTE_VIDEO,{uid:d.uid}),i.emit(d.audio_enable_local?xe.ENABLE_LOCAL_AUDIO:xe.DISABLE_LOCAL_AUDIO,{uid:d.uid}),i.emit(d.video_enable_local?xe.ENABLE_LOCAL_VIDEO:xe.DISABLE_LOCAL_VIDEO,{uid:d.uid}),d.audio||d.video||i.emit(xe.ON_REMOVE_STREAM,{uid:d.uid,uint_id:d.uint_id})}),!0)})()}reconnect(i,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,r)}handleNotification(i){I.debug("[".concat(this.clientId,"] receive notification: "),i);const r=au(i.code);if("success"!==r.action){if("failed"!==r.action)return"quit"===r.action?("ERR_REPEAT_JOIN_CHANNEL"===r.desc&&this.close(ze.UID_BANNED),void this.close()):void this.reconnect(r.action,la.SERVER_ERROR);I.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=B("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=i&&(I.warning("PINGPONG Timeout. Last Socket Message: ".concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>B("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",la.TIMEOUT):this.request(Ae.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-r;this.rttRolling.add(a),B("REPORT_STATS")&&this.send(Ae.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleInflateData(){const{inflateLength:i,deflateLength:r}=this.websocket.getInflateData();0!==i&&0!==r&&this.upload(kc.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:i})}handleWebsocketEvents(){var i=this;this.websocket.on(pn.RECONNECT_WAITTING_FINISH,r=>{this.emit(de.WS_RECONNECT_WAITTING_FINISH,r)}),this.websocket.on(pn.RECONNECT_CREATE_CONNECTION,r=>{this.emit(de.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(pn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(pn.CLOSED,()=>{this.connectionState=Ee.CLOSED}),this.websocket.on(pn.FAILED,()=>{this._disconnectedReason=ze.NETWORK_ERROR,this.connectionState=Ee.CLOSED}),this.websocket.on(pn.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState=this.connectionState===Ee.CONNECTED?Ee.RECONNECTING:Ee.CONNECTING}),this.websocket.on(pn.WILL_RECONNECT,(r,a)=>{if(mr(this,de.IS_P2P_DISCONNECTED)&&"retry"===r)return I.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION),this.emit(de.DISCONNECT_P2P),a("tryNext");"retry"!==r&&(I.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION),this.emit(de.DISCONNECT_P2P)),a(r)}),this.websocket.on(pn.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{I.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",la.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(de.REPORT_JOIN_GATEWAY,r.message||r.code,this.url||""),r instanceof W&&r.code===k.UNEXPECTED_RESPONSE&&r.data.code===oe.ERR_NO_AUTHORIZED)return I.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",la.SERVER_ERROR);I.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",la.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(pn.REQUEST_NEW_URLS,(r,a)=>{nn(this,de.REQUEST_RECOVER,this.multiIpOption).then(r).catch(a)}),this.websocket.on(pn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(xe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(pn.TO_CONNECT_DATACHANNEL,function(){var r=L(function*(a,d,l){return nn(i,de.DATACHANNEL_PRECONNECT,a).then(d).catch(l)});return function(a,d,l){return r.apply(this,arguments)}}()),this.websocket.on(pn.FAILBACK,()=>{void 0!==this.openConnectionTime&&this.emit(de.DATACHANNEL_FAILBACK)})}}class xi extends jt{constructor(i,r){super(),C(this,"signal",void 0),C(this,"token",void 0),C(this,"tokenTimeout",void 0),C(this,"tokenInterval",void 0),C(this,"_sequence",0),C(this,"userMap",new Map),C(this,"encoder",new TextEncoder),this.signal=i,this.token=r;const a=()=>{this.signal.connectionState===Ee.CONNECTED&&this.check(),this.tokenInterval=0===this.userMap.size?window.setTimeout(a,1e3):window.setTimeout(a,3*B("P2P_TOKEN_INTERVAL"))};a()}send(i,r,a,d,l){var h=this;return L(function*(){var f,_,g;if(0===h.userMap.size)return;const v=Array.from(ca(f=h.userMap).call(f))[0].token;"string"!=typeof r&&(r=JSON.stringify(r)),d=null!==(_=d)&&void 0!==_?_:qe(6,""),l=null!==(g=l)&&void 0!==g?g:h._sequence++;const b={_id:d,_type:i,_seq:l,_message:r,token:"".concat(h.token,"_").concat(v)};B("SHOW_P2P_LOG")&&I.debug("send message",b,"noNeedResponse : ".concat(a)),h.splitMessage(JSON.stringify(b)).forEach(T=>{h.signal.request(Ae.DATA_STREAM,{payload:Qh(h.encoder.encode(T))})});const y=new X((T,M)=>{const O=window.setTimeout(()=>{h.off("res-@".concat(d,"_ack"),D),h.off("res-@".concat(d),F),h.off(su.ABORT,x),I.debug("[external-signal] request timeout, type: ".concat(i,", requestId: ").concat(d)),M(new ee(0===h.userMap.size?k.INVALID_REMOTE_USER:k.TIMEOUT))},B("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),D=()=>{O&&window.clearTimeout(O),h.off(su.ABORT,x),a&&T()},x=()=>{O&&window.clearTimeout(O),h.off("res-@".concat(d,"_ack"),D),h.off("res-@".concat(d),F),M(new ee(k.EXTERNAL_SIGNAL_ABORT,"type: ".concat(i,", requestId: ").concat(d)))};h.once(su.ABORT,x),h.once("res-@".concat(d,"_ack"),D);const F=(Y,te)=>{j=!0,O&&window.clearTimeout(O),h.off("res-@".concat(d,"_ack"),D),h.off(su.ABORT,x),"success"===Y?T(te):M(new ee(k.P2P_MESSAGE_FAILED,"request ".concat(i," failed, requestId: ").concat(d)))};let j=!1;a||(h.once("res-@".concat(d),F),Un(B("SIGNAL_REQUEST_TIMEOUT")).then(()=>{j||I.warning("external_signal request timeout, type: ".concat(i,", requestId: ").concat(d,", ").concat(b))}))});try{return yield y}catch(T){if(T.code===k.TIMEOUT)return yield h.send(i,r,a,d,l);throw T}})()}onMessage(i){var r;const{_uid:a}=i;let d,l=this.userMap.get(a);if(l)d=l.splitMessageMap;else{if(this.userMap.size>0||!("_type"in i)||i._type!==fn.CHECK)return;const{token:g}=i;d=new Map,l={uid:a,isStart:!0,token:g,splitMessageMap:d,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(a,l),this.signal.emit(xe.ON_USER_ONLINE,{uid:a}),this.handleUserOnline()}if("id"in i&&"total"in i){var h;const{id:g,total:v}=i,b=null!==(h=d.get(g))&&void 0!==h?h:[];if(b.push(i),d.has(g)||d.set(g,b),b.length!==v)return;{const y=bE(b).call(b,(T,M)=>T.index-M.index).map(T=>T.payload).join("");d.delete(g),(i=JSON.parse(y))._uid=a}}const{_type:f,token:_}=i;if(ye(r=[fn.ACK,fn.CHECK]).call(r,f))return f===fn.CHECK&&this.handleCheckToken(l,_),void this.receiveMessage(i);_==="".concat(l.token,"_").concat(this.token)?this.handleReceivedMessage(i):I.debug('Receive unexpected message", '.concat(_,", cur_token: ").concat(l.token,"_").concat(this.token),i)}check(){const i={_id:qe(6,""),token:this.token,_type:fn.CHECK};B("SHOW_P2P_LOG")&&I.debug("send message",i),this.signal.request(Ae.DATA_STREAM,{payload:Qh(this.encoder.encode(JSON.stringify(i)))})}ack(i){const r={_id:i,_type:fn.ACK,token:this.token};B("SHOW_P2P_LOG")&&I.debug("send message",r),this.signal.request(Ae.DATA_STREAM,{payload:Qh(this.encoder.encode(JSON.stringify(r)))})}response(i,r,a){this.send(fn.RESPONSE,JSON.stringify({success:!a,message:r}),!0,i)}handleReceivedMessage(i){const r=()=>{this.userMap.forEach(g=>{const{receivedMessagesMap:v,nextExpectedSequenceNumber:b}=g;for(;v.has(b);){const y=v.get(b);v.delete(b),this.receiveMessage(y),g.nextExpectedSequenceNumber++}})};if(!i)return void r();const{_uid:a,_seq:d}=i,l=this.userMap.get(a),{receivedMessagesMap:h,isStart:f,nextExpectedSequenceNumber:_}=l;if(d<_)return this.ack(i._id),void I.debug("[external-signal] receive old message, seq: ".concat(d,", ").concat(i._message));h.set(d,i),f&&d===_&&(this.receiveMessage(i),h.delete(_),l.nextExpectedSequenceNumber++,r())}receiveMessage(i){const{_id:r,_type:a,_message:d,_uid:l}=i;if(B("SHOW_P2P_LOG")&&I.debug("receive message",i),r){let h;switch(i._type!==fn.ACK&&(d&&(h=JSON.parse(d)),this.ack(i._id)),i._type){case fn.CANDIDATE:case fn.CONTROL:this.signal.emit(a,h,l);break;case fn.PUBLISH:case fn.UNPUBLISH:case fn.RESTART_ICE:case fn.CALL:h.uid=l,nn(this.signal,a,h).then(f=>{this.response(i._id,f)}).catch(()=>{this.response(i._id,void 0,!0)});break;case fn.ACK:this.getListeners("res-@".concat(r,"_ack")).length>0&&this.emit("res-@".concat(r,"_ack"));break;case fn.RESPONSE:{const{success:f,message:_}=h;this.emit("res-@".concat(r),f?"success":"failed",_);break}}}}splitMessage(i){if(i.length<xi.MAX_MESSAGE_SIZE)return[i];const r=[],{remoteToken:a}=JSON.parse(i),d=qe(6,"");let l=0,h=800;const f=Math.ceil(i.length/h);for(;i.length>0;){l++;const _={id:d,index:l,total:f,payload:i.slice(0,h),token:"".concat(this.token,"_").concat(a)};JSON.stringify(_).length>xi.MAX_MESSAGE_SIZE?h-=50:(r.push(_),i=i.slice(h))}return r.map(_=>JSON.stringify(_))}handleCheckToken(i,r){return i.token!==r?(I.debug("token changed, from ".concat(i.token," to ").concat(r)),this.reset(i.uid,r),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{I.debug("token timeout, ".concat(r)),this.reset(i.uid)},B("MAX_P2P_TIMEOUT")),!0)}handleUserOnline(){var i=this;return L(function*(){const r=yield nn(i.signal,fn.CALL,void 0),a=yield i.send(fn.CALL,r);i.signal.emit(de.P2P_CONNECTION,a,!0)})()}reset(i,r){var a=this;return L(function*(){const d=a.userMap.get(i);d&&(a.emit(su.ABORT),a.signal.emit(xe.ON_USER_OFFLINE,{uid:d.uid,reason:Sv.P2P_TOKEN_CHANGED}),a._sequence=0,a.userMap.clear(),r||(I.debug("change local token from ".concat(r," to ").concat(r)),a.token=qe(6,"")))})()}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(su.ABORT)}}C(xi,"MAX_SIZE",1),C(xi,"MAX_MESSAGE_SIZE",1024);class PT extends jt{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===Ee.CONNECTED?this.emit(de.WS_CONNECTED):i===Ee.RECONNECTING?this.emit(de.WS_RECONNECTING,this._websocketReconnectReason):i===Ee.CLOSED&&this.emit(de.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(i,r){super(),C(this,"_disconnectedReason",void 0),C(this,"_websocketReconnectReason",void 0),C(this,"_connectionState",Ee.CLOSED),C(this,"reconnectToken",void 0),C(this,"p2pToken",void 0),C(this,"websocket",void 0),C(this,"openConnectionTime",void 0),C(this,"clientId",void 0),C(this,"lastMsgTime",Date.now()),C(this,"uploadCache",[]),C(this,"uploadCacheInterval",void 0),C(this,"rttRolling",new Oc(5)),C(this,"pingpongTimer",void 0),C(this,"pingpongTimeoutCount",0),C(this,"joinResponse",void 0),C(this,"multiIpOption",void 0),C(this,"initError",void 0),C(this,"spec",void 0),C(this,"store",void 0),C(this,"_external_signal",void 0),C(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(de.ON_BINARY_DATA,a.data);const d=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(d,"_id")){const l="res-@".concat(d._id);this.emit(l,d._result,d._message)}else if(Object.prototype.hasOwnProperty.call(d,"_type")){switch(d._type){case xe.ON_DATA_STREAM:return void this.handleDataStream(d._message);case xe.MUTE_AUDIO:case xe.MUTE_VIDEO:case xe.ON_P2P_LOST:case xe.ON_USER_ONLINE:return;case xe.ON_USER_OFFLINE:const{uid:l}=d._message;return I.debug("[".concat(this.clientId,"] user-offline uid: ").concat(l)),void this._external_signal.reset(l)}if(this.emit(d._type,d._message),d._type===xe.ON_NOTIFICATION&&this.handleNotification(d._message),d._type===xe.ON_USER_BANNED)switch(d._message.error_code){case 14:this.close(ze.UID_BANNED);break;case 15:this.close(ze.IP_BANNED);break;case 16:this.close(ze.CHANNEL_BANNED)}if(d._type===xe.ON_USER_LICENSE_BANNED)switch(d._message.error_code){case oe.ERR_LICENSE_MISSING:this.close(ze.LICENSE_MISSING);break;case oe.ERR_LICENSE_EXPIRED:this.close(ze.LICENSE_EXPIRED);break;case oe.ERR_LICENSE_MINUTES_EXCEEDED:this.close(ze.LICENSE_MINUTES_EXCEEDED);break;case oe.ERR_LICENSE_PERIOD_INVALID:this.close(ze.LICENSE_PERIOD_INVALID);break;case oe.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(ze.LICENSE_MULTIPLE_SDK_SERVICE);break;case oe.ERR_LICENSE_ILLEGAL:this.close(ze.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=i.clientId,this.spec=i,this.store=r,this.websocket=new pp("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ee.CONNECTED&&this.reconnect("retry",_i.OFFLINE)}),this.p2pToken=qe(6,""),this._external_signal=new xi(this,this.p2pToken)}request(i,r,a,d){var l=this;return L(function*(){const h=qe(6,""),f={_id:h,_type:i,_message:r},_=l.websocket.connectionID,g=()=>new X((O,D)=>{if(l.connectionState===Ee.CONNECTED)return O();const x=()=>{l.off(de.WS_CLOSED,F),O()},F=()=>{l.off(de.WS_CONNECTED,x),D(new ee(k.WS_ABORT))};l.once(de.WS_CONNECTED,x),l.once(de.WS_CLOSED,F)});if(l.connectionState!==Ee.CONNECTING&&l.connectionState!==Ee.RECONNECTING||i===Ae.JOIN||i===Ae.REJOIN||(yield g()),l.websocket.sendMessage(f,!0),d)return;const v=new X((O,D)=>{let x=!1;const F=(Y,te)=>{x=!0,O({isSuccess:"success"===Y,message:te||{}}),l.off(de.WS_CLOSED,j),l.off(de.WS_RECONNECTING,j),l.emit(de.REQUEST_SUCCESS,i,r)};l.once("res-@".concat(h),F);const j=()=>{D(new ee(k.WS_ABORT,"type: ".concat(i))),l.off(de.WS_CLOSED,j),l.off(de.WS_RECONNECTING,j),l.off("res-@".concat(h),F)};l.once(de.WS_CLOSED,j),l.once(de.WS_RECONNECTING,j),Un(B("SIGNAL_REQUEST_TIMEOUT")).then(()=>{l.websocket.connectionID!==_||x||(I.warning("[".concat(l.clientId,"] ws request timeout, type: ").concat(i)),l.emit(de.REQUEST_TIMEOUT,i,r))})});let b=null;try{b=yield v}catch(O){if(l.connectionState===Ee.CLOSED||i===Ae.LEAVE)throw new ee(k.WS_ABORT);return!l.spec.forceWaitGatewayResponse||a?O.throw():i===Ae.JOIN||i===Ae.REJOIN?null:(yield g(),yield l.request(i,r))}if(b.isSuccess)return b.message;const y=Number(b.message.error_code||b.message.code),T=au(y),M=new ee(k.UNEXPECTED_RESPONSE,"".concat(T.desc,": ").concat(b.message.error_str),{code:y,data:b.message});return"success"===T.action?b.message:(I.warning("[".concat(l.clientId,"] [").concat(l.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(y,", message: ").concat(T.desc,", action: ").concat(T.action)),y===oe.ERR_TOO_MANY_BROADCASTERS?((i===Ae.JOIN||i===Ae.REJOIN)&&(l.initError=M,l.close()),M.throw()):"failed"===T.action?M.throw():"quit"===T.action?(l.initError=M,l.close(),M.throw()):(y===oe.ERR_JOIN_BY_MULTI_IP?(l.multiIpOption=b.message.option,I.warning("[".concat(l.clientId,"] detect multi ip, recover")),l.reconnect("recover",_i.MULTI_IP)):l.reconnect(T.action,_i.SERVER_ERROR),i===Ae.JOIN||i===Ae.REJOIN?null:yield l.request(i,r)))})()}waitMessage(i,r){return new X(a=>{const d=l=>{(!r||r(l))&&(this.off(i,d),a(l))};this.on(i,d)})}uploadWRTCStats(i){if(!this.store.sessionId)return void I.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:i};this.upload(kc.WRTC_STATS,r)}upload(i,r){const a={_type:i,_message:r};try{this.websocket.sendMessage(a)}catch{const l=B("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ee.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},B("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,r){this.websocket.sendMessage({_type:i,_message:r})}sendExtensionMessage(i,r,a){var d=this;return L(function*(){return yield d._external_signal.send(i,r,a)})()}init(i){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new X((r,a)=>{this.once(de.WS_CONNECTED,()=>r(this.joinResponse)),this.once(de.WS_CLOSED,()=>a(this.initError||new ee(k.WS_ABORT))),this.connectionState=Ee.CONNECTING,this.websocket.init(i).catch(a)})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=i||ze.LEAVE,this.connectionState=Ee.CLOSED,I.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),i===ze.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new pp("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents()),this.p2pToken=qe(6,""),this._external_signal.clear(),this._external_signal=new xi(this,this.p2pToken)}join(){var i=this;return L(function*(){if(!i.joinResponse){i.emit(de.ABORT_P2P_EXECUTION);const r=yield nn(i,de.REQUEST_JOIN_INFO),a=yield i.request(Ae.JOIN,r);if(!a)return i.emit(de.REPORT_JOIN_GATEWAY,k.TIMEOUT,i.url||""),!1;i.joinResponse=a,i.emit(de.JOIN_RESPONSE,i.joinResponse),i.reconnectToken=i.joinResponse.rejoin_token}return i.connectionState=Ee.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),!0})()}reconnect(i,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,r)}handleDataStream(i){try{var r;const a=gm(i.payload),d=(new TextDecoder).decode(a),l=JSON.parse(d);"total"in l&&"id"in l||ye(r=Object.values(fn)).call(r,l._type)?(l._uid=i.uid,this._external_signal.onMessage(l)):this.emit(xe.ON_DATA_STREAM,i)}catch{this.emit(xe.ON_DATA_STREAM,i)}}handleNotification(i){I.debug("[".concat(this.clientId,"] receive notification: "),i);const r=au(i.code);if("success"!==r.action){if("failed"!==r.action)return"quit"===r.action?("ERR_REPEAT_JOIN_CHANNEL"===r.desc&&this.close(ze.UID_BANNED),void this.close()):void this.reconnect(r.action,_i.SERVER_ERROR);I.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=B("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=i&&(I.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>B("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",_i.TIMEOUT):this.request(Ae.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-r;this.rttRolling.add(a),B("REPORT_STATS")&&this.send(Ae.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWebsocketEvents(){this.websocket.on(Me.RECONNECT_WAITTING_FINISH,i=>{this.emit(de.WS_RECONNECT_WAITTING_FINISH,i)}),this.websocket.on(Me.RECONNECT_CREATE_CONNECTION,i=>{this.emit(de.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(Me.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Me.CLOSED,()=>{this.connectionState=Ee.CLOSED}),this.websocket.on(Me.FAILED,()=>{this._disconnectedReason=ze.NETWORK_ERROR,this.connectionState=Ee.CLOSED}),this.websocket.on(Me.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState=this.connectionState===Ee.CONNECTED?Ee.RECONNECTING:Ee.CONNECTING}),this.websocket.on(Me.WILL_RECONNECT,(i,r,a)=>{"retry"!==i?(I.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(i)),this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION)):I.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),a(i)}),this.websocket.on(Me.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(i=>{if(this.emit(de.REPORT_JOIN_GATEWAY,i.message||i.code,this.url||""),i instanceof ee&&i.code===k.UNEXPECTED_RESPONSE&&i.data.code===oe.ERR_NO_AUTHORIZED)return I.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",_i.SERVER_ERROR);I.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",_i.SERVER_ERROR):(this.initError=i,this.close())})}),this.websocket.on(Me.REQUEST_NEW_URLS,(i,r)=>{nn(this,de.REQUEST_RECOVER,this.multiIpOption).then(i).catch(r)}),this.websocket.on(Me.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(xe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}function Dv(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function hs(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?Dv(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Dv(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}const Ov=new Map;class rN extends jt{get state(){return this._state}set state(i){if(i===this._state)return;const r=this._state;this._state=i,"DISCONNECTED"===i&&this._disconnectedReason?this.emit(rn.CONNECTION_STATE_CHANGE,i,r,this._disconnectedReason):this.emit(rn.CONNECTION_STATE_CHANGE,i,r)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(i){I.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(i)),this._joinGatewayStartTime=i}constructor(i,r){super(),C(this,"store",void 0),C(this,"joinInfo",void 0),C(this,"key",void 0),C(this,"ntpOffset",0),C(this,"signal",void 0),C(this,"role",void 0),C(this,"inChannelInfo",{joinAt:null,duration:0}),C(this,"spec",void 0),C(this,"_state","DISCONNECTED"),C(this,"_statsCollector",void 0),C(this,"_disconnectedReason",void 0),C(this,"isSignalRecover",!1),C(this,"hasChangeBGPAddress",!1),C(this,"trafficStatsInterval",void 0),C(this,"networkQualityInterval",void 0),C(this,"_joinGatewayStartTime",0),C(this,"_signalTimeout",!1),C(this,"_clientRoleOptions",void 0),C(this,"_isProactiveJoin",!1),this.store=i,this.spec=r,this.signal=this.store.useP2P?new PT(hs(hs({},r),{},{retryConfig:r.websocketRetryConfig}),i):this.store.useDataChannel?new Po(hs(hs({},r),{},{retryConfig:r.websocketRetryConfig}),i):new ST(hs(hs({},r),{},{retryConfig:r.websocketRetryConfig}),i),this._statsCollector=r.statsCollector,this.role=r.role||"audience",this._clientRoleOptions=r.clientRoleOptions,this.handleSignalEvents()}join(i,r,a){var d=this;return L(function*(){if(d.signal instanceof Po){let g=!1;"disabled"!==i.cloudProxyServer?(I.debug("[".concat(d.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(i.cloudProxyServer,")")),g=!0):"".concat(i.apResponse.cid,"_").concat(i.apResponse.cert).length>255||"".concat(i.apResponse.cid,"_").concat(i.apResponse.cert).length<22?(I.debug("[".concat(d.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),g=!0):i.apResponse.addresses.some(v=>v.fingerprint)||B("FINGERPRINT")||(I.debug("[".concat(d.store.clientId,"] Dc is not supported, because fingerprint does not exist")),g=!0),g&&d.resetSignal()}d.store.joinGatewayStart(),"disabled"!==i.cloudProxyServer&&(d.hasChangeBGPAddress=!0);const l=Date.now();let h=Ov.get(i.cname);if(h||(h=new Map,Ov.set(i.cname,h)),d._isProactiveJoin=!0,h.has(i.uid)){const g=new W(k.UID_CONFLICT);throw Ie.joinGateway(i.sid,{lts:l,succ:!1,ec:g.message,addr:null,uid:i.uid,cid:i.cid,firstSuccess:d._isProactiveJoin,avoidJoinStartTime:d.store.avoidJoinStart,isProxy:!!i.proxyServer,signalChannel:d.signal instanceof Po?"1":"0"}),d._isProactiveJoin=!1,g}h.set(i.uid,!0),d.joinInfo=i,d.key=r;let f=0;d.joinGatewayStartTime=l;const _=i.proxyServer;try{let g;if(I.debug("[".concat(d.store.clientId,"] use ").concat(d.signal instanceof Po?"datachannel":"websocket"," join uid ").concat(f)),d.signal instanceof Po)g=yield d.signal.init(i.apResponse.addresses,a);else{const v=i.gatewayAddrs.map(b=>{let{address:y}=b;const[T,M]=y.split(":"),O={host:T,port:M};return i.proxyServer&&(O.proxy=i.proxyServer),O});g=yield d.signal.init(v,a)}f=g.uid,I.debug("[".concat(d.store.clientId,"] ").concat(d.signal instanceof Po?"datachannel":"websocket"," join uid ").concat(f," cost ").concat(Date.now()-d.joinGatewayStartTime))}catch(g){throw g&&g.code===k.INIT_WEBSOCKET_TIMEOUT?(I.warning("[".concat(d.store.clientId,"] User join failed"),g.toString()),g):g&&g.code===k.INIT_DATACHANNEL_TIMEOUT?(I.warning("[".concat(d.store.clientId,"] User join datachannel failed"),g.toString()),d.resetSignal(),g):(I.error("[".concat(d.store.clientId,"] User join failed"),g.toString()),Ie.joinGateway(i.sid,{lts:l,succ:!1,ec:g.message,addr:d.signal.url,uid:i.uid,cid:i.cid,firstSuccess:d._isProactiveJoin,avoidJoinStartTime:d.store.avoidJoinStart,isProxy:!!_,signalChannel:d.signal instanceof Po?"1":"0"}),d._isProactiveJoin=!1,h.delete(i.uid),d.signal.close(),g)}return d.state="CONNECTED",d.inChannelInfo.joinAt=Date.now(),I.debug("[".concat(d.store.clientId,"] Connected to gateway server")),d.trafficStatsInterval=window.setInterval(()=>{d.updateTrafficStats().catch(g=>{I.warning("[".concat(d.store.clientId,"] get traffic stats error"),g.toString())})},3e3),d.networkQualityInterval=window.setInterval(()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?d.emit(rn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):d.emit(rn.NETWORK_QUALITY,d._signalTimeout?{downlinkNetworkQuality:5,uplinkNetworkQuality:5}:"CONNECTED"===d.state&&d._statsCollector.trafficStats?{uplinkNetworkQuality:fp(d._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:fp(d._statsCollector.trafficStats.B_dnq)}:{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),d.store.joinGatewayEnd(),f})()}leave(){var i=arguments,r=this;return L(function*(){let a=i.length>0&&void 0!==i[0]&&i[0],d=i.length>1?i[1]:void 0;if("DISCONNECTED"!==r.state){d!==ze.FALLBACK&&(r.state="DISCONNECTING");try{a||r.signal.connectionState!==Ee.CONNECTED||(yield(l=r.signal.request(Ae.LEAVE,void 0,!0),3e3,X.race([l,Va(3e3)])))}catch(l){I.warning("[".concat(r.store.clientId,"] leave request failed, ignore"),l)}r.signal.close(d),d!==ze.FALLBACK&&(r.state="DISCONNECTED"),r.reset()}var l})()}publish(i,r,a){var d=this;return L(function*(){if("CONNECTED"!==d.state&&"RECONNECTING"!==d.state)throw new W(k.INVALID_OPERATION,"can not publish when connection state is ".concat(d.state));const l={state:"offer",p2p_id:d.store.p2pId,ortc:r,mode:d.spec.mode,extend:B("PUB_EXTEND"),twcc:!!B("PUBLISH_TWCC"),rtx:!!B("USE_PUB_RTX")};try{return(yield d.signal.request(Ae.PUBLISH,l,!0))._message}catch(h){if(a&&h.data&&h.data.code===oe.ERR_PUBLISH_REQUEST_INVALID)return I.warning("[".concat(d.store.clientId,"] receive publish error code, retry"),h.toString()),yield d.tryUnpubBeforeRepub(i,r),d.publish(i,r,!1);throw h}})()}publishDataChannel(i,r,a){var d=this;return L(function*(){var l;if("CONNECTED"!==d.state&&"RECONNECTING"!==d.state)throw new W(k.INVALID_OPERATION,"can not publish when connection state is ".concat(d.state));const h={stream_id:r.streamId,ordered:r.ordered?1:0,max_retrans_times:null!==(l=r.maxRetransmits)&&void 0!==l?l:10,channel_id:r.channelId,metadata:r.metadata};try{yield d.signal.request(Ae.PUBLISH_DATASTREAM,h,!0)}catch(f){if(a&&f.data&&f.data.code===oe.ERR_PUBLISH_REQUEST_INVALID)return I.warning("[".concat(d.store.clientId,"] receive publish datachannels error code, retry"),f.toString()),yield d.tryUnpubDataChannelBeforeRepub(i,r),d.publishDataChannel(i,r,!1);throw f}})()}unpublish(i,r){var a=this;return L(function*(){try{if("CONNECTED"!==a.state&&"RECONNECTING"!==a.state)throw new W(k.INVALID_OPERATION,"can not publish when connection state is ".concat(a.state));yield a.signal.request(Ae.UNPUBLISH,{stream_id:r,ortc:i},!0)}catch(d){I.warning("[".concat(a.store.clientId,"] unpublish warning: "),d)}})()}unpublishDataChannel(i){var r=this;return L(function*(){try{if("CONNECTED"!==r.state&&"RECONNECTING"!==r.state)throw new W(k.INVALID_OPERATION,"can not publish when connection state is ".concat(r.state));yield X.all(i.map(a=>r.signal.request(Ae.UNPUBLISH_DATASTREAM,{channel_id:a},!0)))}catch(a){I.warning("unpublish datachannels warning: ",a)}})()}presubscribe(i,r,a){var d=this;return L(function*(){if("CONNECTED"!==d.state&&"RECONNECTING"!==d.state)throw new W(k.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(d.state));const l={stream_id:i,stream_type:r,mode:d.spec.mode,codec:d.spec.codec,p2p_id:d.store.p2pId,twcc:!!B("SUBSCRIBE_TWCC"),rtx:!!B("USE_SUB_RTX")||void 0,extend:B("SUB_EXTEND"),svc:Array.isArray(B("SVC"))&&0!==B("SVC").length?B("SVC"):void 0};try{return yield d.signal.request(Ae.PRE_SUBSCRIBE,l,!0)}catch(h){if(a&&h.data&&h.data.code===oe.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(d.store.clientId,"] pre-subscribe error, retry"),h.toString()),d.presubscribe(i,r,!1);throw h}})()}subscribe(i,r,a){var d=this;return L(function*(){if("CONNECTED"!==d.state&&"RECONNECTING"!==d.state)throw new W(k.INVALID_OPERATION,"can not subscribe when connection state is ".concat(d.state));const l={stream_id:i,stream_type:r.stream_type,mode:d.spec.mode,codec:d.spec.codec,p2p_id:d.store.p2pId,twcc:!!B("SUBSCRIBE_TWCC"),rtx:!!B("USE_SUB_RTX"),extend:B("SUB_EXTEND"),ssrcId:r.ssrcId,svc:Array.isArray(B("SVC"))&&0!==B("SVC").length?B("SVC"):void 0};try{return(yield d.signal.request(Ae.SUBSCRIBE,l,!0))._message}catch(h){if(a&&h.data&&h.data.code===oe.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(d.store.clientId,"] receiver subscribe error code, retry"),h.toString()),yield d.tryUnsubBeforeResub(i,r),yield d.subscribe(i,r,!1);throw h}})()}subscribeDataChannel(i,r,a){var d=this;return L(function*(){if("CONNECTED"!==d.state&&"RECONNECTING"!==d.state)throw new W(k.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(d.state));const l={uid:i,stream_id:r.id,channel_id:r.datachannelId};try{return void(yield d.signal.request(Ae.SUBSCRIBE_DATASTREAM,l,!0))}catch(h){if(a&&h.data&&h.data.code===oe.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(d.store.clientId,"] receiver subscribe datachannel error code, retry"),h.toString()),yield d.tryUnsubDataChannelBeforeResub(i,r),yield d.subscribeDataChannel(i,r,!1);throw h}})()}subscribeAll(i,r){var a=this;return L(function*(){if("CONNECTED"!==a.state&&"RECONNECTING"!==a.state)throw new W(k.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(a.state));const d={p2p_id:a.store.p2pId,users:i,dtx:!1,rtx:!!B("USE_SUB_RTX")};try{return yield a.signal.request(Ae.SUBSCRIBE_STREAMS,d,!0)}catch(l){if(r&&l.data&&l.data.code===oe.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(a.store.clientId,"] receiver massSubscribe error code, retry"),l.toString()),yield a.tryMassUnsubBeforeResub(i),yield a.subscribeAll(i,!1);throw l}})()}setVideoProfile(i){var r=this;return L(function*(){const a=function(d){if(!(d.bitrateMax&&d.bitrateMin&&d.frameRate&&d.height&&d.width))return;let l=d.frameRate,h=d.width,f=d.height,_=!0;return"number"!=typeof l&&(l=l.exact||l.ideal||l.max||l.min||0,l||(_=!1)),"number"!=typeof h&&(h=h.exact||h.ideal||h.max||h.min||0,h||(_=!1)),"number"!=typeof f&&(f=f.exact||f.ideal||f.max||f.min||0,l||(_=!1)),_?{stream_type:0,width:h,height:f,fps:l,start_bps:1e3*d.bitrateMax,min_bps:1e3*d.bitrateMin,target_bps:1e3*d.bitrateMax}:void 0}(i);if(a)return r.signal.request(Ae.SET_VIDEO_PROFILE,a);I.debug("[".concat(r.store.clientId,"] encoder config is not complete, do not report to gateway"))})()}unsubscribe(i,r){var a=this;return L(function*(){try{yield a.signal.request(Ae.UNSUBSCRIBE,{p2p_id:a.store.p2pId,ortc:i,stream_id:r},!0)}catch(d){I.warning("[".concat(a.store.clientId,"] unsubscribe warning: "),d)}})()}unsubscribeDataChannel(i,r){var a=this;return L(function*(){try{if("CONNECTED"!==a.state&&"RECONNECTING"!==a.state)throw new W(k.INVALID_OPERATION,"can not publish when connection state is ".concat(a.state));yield X.all(i.map(d=>a.signal.request(Ae.UNSUBSCRIBE_DATASTREAM,{stream_id:d,uid:r},!0)))}catch(d){I.warning("unsubscribeDataChannel warning: ",d)}})()}massUnsubscribe(i){var r=this;return L(function*(){try{yield r.signal.request(Ae.UNSUBSCRIBE_STREAMS,i,!0)}catch(a){I.warning("[".concat(r.store.clientId,"] massUnsubscribeAll warning: "),a)}})()}reconnectPC(i){var r=this;return L(function*(){const{iceParameters:a,dtlsParameters:d,rtpCapabilities:l}=i;return{gatewayEstablishParams:yield r.signal.request(Ae.CONNECT_PC,{p2p_id:r.store.p2pId,stream_id:r.store.uid,ortc:{iceParameters:a,dtlsParameters:d,rtpCapabilities:l}},!0),gatewayAddress:r.getCurrentGatewayAddress()}})()}getGatewayInfo(){return this.signal.request(Ae.GATEWAY_INFO)}renewToken(i){var r=this;return L(function*(){yield r.signal.request(Ae.RENEW_TOKEN,i),r.key=i.token})()}setClientRole(i,r){var a=this;return L(function*(){if(r&&(a._clientRoleOptions=Object.assign({},r)),"CONNECTED"!==a.state)return void(a.role=i);let d,l=0;"audience"===i?a._clientRoleOptions&&a._clientRoleOptions.delay?(d=a._clientRoleOptions.delay,l=1):l=a._clientRoleOptions&&a._clientRoleOptions.level?a._clientRoleOptions.level:2:l=0,yield a.signal.request(Ae.SET_CLIENT_ROLE,{role:i,level:l,delay:d,client_ts:Date.now()}),a.role=i})()}setRemoteVideoStreamType(i,r){var a=this;return L(function*(){yield a.signal.request(Ae.SWITCH_VIDEO_STREAM,{stream_id:i,stream_type:r})})()}setDefaultRemoteVideoStreamType(i){var r=this;return L(function*(){yield r.signal.request(Ae.DEFAULT_VIDEO_STREAM,{stream_type:i})})()}setStreamFallbackOption(i,r){var a=this;return L(function*(){yield a.signal.request(Ae.SET_FALLBACK_OPTION,{stream_id:i,fallback_type:r})})()}pickSVCLayer(i,r){var a=this;return L(function*(){yield a.signal.request(Ae.PICK_SVC_LAYER,{stream_id:i,spatial_layer:r.spatialLayer,temporal_layer:r.temporalLayer})})()}setRTM2Flag(i){var r=this;return L(function*(){yield r.signal.request(Ae.SET_RTM2_FLAG,{rtm2_flag:i})})()}sendExtensionMessage(i,r,a){var d=this;return L(function*(){if(d.signal instanceof PT)return d.signal.sendExtensionMessage(i,r,a)})()}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),hs({},this.inChannelInfo)}getGatewayVersion(){var i=this;return L(function*(){return(yield i.signal.request(Ae.GATEWAY_INFO)).version})()}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const i=Ov.get(this.joinInfo.cname);i&&i.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const i=function(r){let a;return a=r.startsWith("dc")?r.match(/(dc\:\/\/)?([^:]+):(\d+)/):r.match(/(wss\:\/\/)?([^:]+):(\d+)/),a?{username:Er.username,password:Er.password,turnServerURL:a[2],tcpport:parseInt(a[3])+30,udpport:parseInt(a[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],i&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(hs(hs({},Er),{},{turnServerURL:i.turnServerURL,tcpport:i.tcpport,udpport:i.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}updateTrafficStats(){var i=this;return L(function*(){if("CONNECTED"!==i.state)return;const r=yield i.signal.request(Ae.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),null!=r.ntp_offset&&(i.ntpOffset=r.ntp_offset),r.peer_delay.forEach(a=>{const d=i._statsCollector.trafficStats&&i._statsCollector.trafficStats.peer_delay.find(l=>l.peer_uid===a.peer_uid);d&&d.B_st!==a.B_st&&_m(()=>{i.emit(rn.STREAM_TYPE_CHANGE,a.peer_uid,a.B_st)})}),i._statsCollector.updateTrafficStats(r)})()}getJoinMessage(i){if(!this.joinInfo||!this.key)throw new W(k.UNEXPECTED_ERROR,"can not generate join message, no join info");const r=Object.assign({},this.joinInfo.apResponse);let a=B("REPORT_APP_SCENARIO");if("string"!=typeof a)try{a=JSON.stringify(a)}catch{a=void 0}a&&a.length>128&&(a=void 0);const d=hs({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Ao,browser:navigator.userAgent,process_id:B("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:r,extend:B("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:a,attributes:{userAttributes:{enablePublishedUserList:B("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:B("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:"number"==typeof B("SUBSCRIBE_AUDIO_FILTER_TOPN")?B("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:"boolean"==typeof B("ENABLE_PUBLISH_AUDIO_FILTER")?B("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:"boolean"==typeof B("ENABLE_USER_LICENSE_CHECK")?B("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:!0===B("USE_PUB_RTX")||!0===B("USE_SUB_RTX")||void 0,disableFEC:B("DISABLE_FEC"),enableNTPReport:!!B("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!B("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:"boolean"==typeof B("ENABLE_DATASTREAM_2")?B("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:"number"==typeof this.joinInfo.rtmFlag?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!B("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:"boolean"==typeof B("USE_XR")?B("USE_XR"):void 0}},join_ts:this.joinGatewayStartTime},i);return this.joinInfo.stringUid&&(d.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(d.aes_mode=this.joinInfo.aesmode,B("ENCRYPT_AES")?(d.aes_secret=this.joinInfo.aespassword,d.aes_encrypt=!0):d.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(d.aes_salt=this.joinInfo.aessalt)),r.addresses[this.signal.websocket.currentURLIndex]&&(d.ap_response.ticket=r.addresses[this.signal.websocket.currentURLIndex].ticket,delete r.addresses),void 0!==this.joinInfo.defaultVideoStream&&(d.default_video_stream=this.joinInfo.defaultVideoStream),d}getRejoinMessage(){if(!this.joinInfo)throw new W(k.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){var i=this;this.signal.on(de.WS_RECONNECT_WAITTING_FINISH,r=>{var a;ye(a=["tryNext","recover"]).call(a,r)&&this.joinInfo&&Ie.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(de.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(de.WS_RECONNECTING,r=>{this.joinInfo&&Ie.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||_i.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Ie.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:"live"===this.spec.mode?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:"audience"===this.role?2:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(de.WS_CLOSED,r=>{let a;switch(r){case ze.LEAVE:a=_i.LEAVE;break;case ze.UID_BANNED:case ze.IP_BANNED:case ze.CHANNEL_BANNED:case ze.SERVER_ERROR:a=_i.SERVER_ERROR;break;case ze.FALLBACK:a=_i.FALLBACK;break;case ze.LICENSE_MISSING:case ze.LICENSE_EXPIRED:case ze.LICENSE_MINUTES_EXCEEDED:case ze.LICENSE_PERIOD_INVALID:case ze.LICENSE_MULTIPLE_SDK_SERVICE:case ze.LICENSE_ILLEGAL:case ze.TOKEN_EXPIRE:a=r;break;default:a=_i.NETWORK_ERROR}I.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(a||"undefined -> "+_i.NETWORK_ERROR)),this.joinInfo&&Ie.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===ze.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:a}),this._disconnectedReason=r,r!==ze.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(de.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&("audience"===this.role&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(I.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),Ie.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof Po?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion)){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void I.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));It("EVENT_REPORT_DOMAIN",r[1]),It("EVENT_REPORT_BACKUP_DOMAIN",r[1]),It("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}),this.signal.on(xe.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(de.REQUEST_RECOVER,(r,a,d)=>{if(!this.joinInfo)return d(new W(k.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,nn(this,rn.REQUEST_NEW_GATEWAY_LIST).then(a).catch(d)}),this.signal.on(de.REQUEST_JOIN_INFO,function(){var r=L(function*(a){var d;if(i.updateTurnConfigFromSignal(),i.store.useP2P)return void a(i.getJoinMessage({ortc:{}}));const{iceParameters:l,dtlsParameters:h,rtpCapabilities:f}=yield nn(i,rn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:null===(d=i.joinInfo)||void 0===d?void 0:d.turnServer});a(i.getJoinMessage({ortc:{iceParameters:l,dtlsParameters:h,rtpCapabilities:f,version:"2"}}))});return function(a){return r.apply(this,arguments)}}()),this.signal.on(de.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(de.REPORT_JOIN_GATEWAY,(r,a)=>{this.joinInfo&&(Ie.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,addr:a,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof Po?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(de.IS_P2P_DISCONNECTED,r=>{r(mr(this,rn.IS_P2P_DISCONNECTED))}),this.signal.on(de.DISCONNECT_P2P,()=>{this.emit(rn.DISCONNECT_P2P)}),this.signal.on(de.NEED_RENEW_SESSION,()=>{this.emit(rn.NEED_RENEW_SESSION)}),this.signal.on(de.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(de.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(de.JOIN_RESPONSE,r=>{const a=this.getCurrentGatewayAddress();this.emit(rn.JOIN_RESPONSE,r,a)}),this.signal.on(de.DATACHANNEL_PRECONNECT,function(){var r=L(function*(a,d,l){i.updateTurnConfigFromSignal();const h=i.getCurrentGatewayAddress();return nn(i,rn.DATACHANNEL_PRECONNECT,a,h).then(d).catch(l)});return function(a,d,l){return r.apply(this,arguments)}}()),this.signal.on(de.DATACHANNEL_CONNECTING,function(){var r=L(function*(a){const{iceParameters:d,dtlsParameters:l,rtpCapabilities:h}=yield nn(i,rn.REQUEST_DC_CONNECTION_PARAMS);a(i.getJoinMessage({ortc:{iceParameters:d,dtlsParameters:l,rtpCapabilities:h,version:"2"}}))});return function(a){return r.apply(this,arguments)}}()),this.signal.on(de.DATACHANNEL_FAILBACK,()=>{I.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(rn.DATACHANNEL_FAILBACK)})}tryUnsubBeforeResub(i,r){var a=this;return L(function*(){try{yield a.signal.request(Ae.UNSUBSCRIBE,{p2p_id:a.store.p2pId,stream_id:i,ortc:[r]},!0)}catch(d){throw I.warning("[".concat(a.store.clientId,"] tryUnsubBeforeResub warning"),d),d}})()}tryUnsubDataChannelBeforeResub(i,r){var a=this;return L(function*(){try{yield a.signal.request(Ae.UNSUBSCRIBE,{stream_id:r.id},!0)}catch(d){throw I.warning("unsubscribe datachannel warning",d),d}})()}tryUnpubBeforeRepub(i,r){var a=this;return L(function*(){try{yield a.signal.request(Ae.UNPUBLISH,{stream_id:i,ortc:r},!0)}catch(d){throw I.warning("[".concat(a.store.clientId,"] tryUnpubBeforeRepub warning: "),d),d}})()}tryUnpubDataChannelBeforeRepub(i,r){var a=this;return L(function*(){try{yield a.signal.request(Ae.UNPUBLISH_DATASTREAM,{channnel_id:r.channelId},!0)}catch(d){throw I.warning("unpublish datastream warning: ",d),d}})()}tryMassUnsubBeforeResub(i){var r=this;return L(function*(){const a={users:i.map(d=>({stream_id:d.stream_id,stream_type:d.stream_type}))};try{yield r.signal.request(Ae.UNSUBSCRIBE_STREAMS,a,!0)}catch(d){throw I.warning("[".concat(r.store.clientId,"] tryMassUnsubBeforeResub warning"),d),d}})()}muteLocal(i,r){var a=this;return L(function*(){const d={action:i.find(l=>l.stream_type===ut.Audio)?"mute_local_audio":"mute_local_video",p2p_id:a.store.p2pId,ortc:i,stream_id:r};try{yield a.signal.request(Ae.CONTROL,d,!0,!0)}catch(l){throw I.warning("[".concat(a.store.clientId,"] gateway muteLocal warning: "),l),l}})()}unmuteLocal(i,r){var a=this;return L(function*(){const d={action:i.find(l=>l.stream_type===ut.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:a.store.p2pId,ortc:i,stream_id:r};try{yield a.signal.request(Ae.CONTROL,d,!0,!0)}catch(l){throw I.warning("[".concat(a.store.clientId,"] gateway unmuteLocal warning: "),l),l}})()}muteRemote(i,r){var a=this;return L(function*(){const d={action:i===Se.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:a.store.p2pId,stream_id:r};try{yield a.signal.request(Ae.CONTROL,d,!0,!0)}catch(l){throw I.warning("[".concat(a.store.clientId,"] gateway muteRemote warning: "),l),l}})()}unmuteRemote(i,r){var a=this;return L(function*(){const d={action:i===Se.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:a.store.p2pId,stream_id:r};try{yield a.signal.request(Ae.CONTROL,d,!0,!0)}catch(l){throw I.warning("[".concat(a.store.clientId,"] gateway unmuteRemote warning: "),l),l}})()}uploadWRTCStats(i){this.signal.uploadWRTCStats(i)}upload(i,r){this.signal.upload(i,r)}getSignalRTT(){return this.signal.rtt}restartICE(i){var r=this;return L(function*(){const a={p2p_id:r.store.p2pId,stream_id:r.store.uid,ortc:i};try{return yield r.signal.request(Ae.RESTART_ICE,a,!0)}catch(d){throw I.warning("[".concat(r.store.clientId,"] P2PChannel.restartICE warning: "),d),d}})()}reconnect(){"CONNECTED"===this.state&&this.signal.reconnect(void 0,_i.P2P_FAILED)}getCurrentGatewayAddress(){var i;if(!B("GATEWAY_WSS_ADDRESS"))return null!==(i=this.joinInfo)&&void 0!==i&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}setPublishAudioFilterEnabled(i){var r=this;return L(function*(){yield r.signal.request(Ae.SET_PARAMETER,{enablePublishAudioFilter:i})})()}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(ze.FALLBACK)),this.store.useDataChannel=!1,this.signal=new ST(hs(hs({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(rn.RESET_SIGNAL,Om.websocket)}}let Fm=0,Nv=0;function Ga(s,i,r,a){return new X((d,l)=>{i.timeout=i.timeout||B("HTTP_CONNECT_TIMEOUT"),i.responseType=i.responseType||"json",i.data&&!r?(i.data=JSON.stringify(i.data),Fm+=Ua(i.data)):r&&(i.data.size?Fm+=i.data.size:i.data instanceof FormData?Fm+=VD(i.data):Fm+=Ua(JSON.stringify(i.data))),i.headers=i.headers||{},i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json",i.method="POST",i.url=s,Ze.request(i).then(h=>{"string"==typeof h.data?Nv+=Ua(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?Nv+=h.data.byteLength:Nv+=Ua(JSON.stringify(h.data)),a&&d({data:h.data,headers:h.headers}),d(h.data)}).catch(h=>{Ze.isCancel(h)?l(new W(k.OPERATION_ABORTED,"cancel token canceled")):l("ECONNABORTED"===h.code?new W(k.NETWORK_TIMEOUT,h.message):h.response?new W(k.NETWORK_RESPONSE_ERROR,h.response.status):new W(k.NETWORK_ERROR,h.message))})})}!function(){var s;function i(ie){var ue=0;return function(){return ue<ie.length?{done:!1,value:ie[ue++]}:{done:!0}}}var a,r="function"==typeof Object.defineProperties?Object.defineProperty:function(ie,ue,Ce){return ie==Array.prototype||ie==Object.prototype||(ie[ue]=Ce.value),ie},d=function(ie){ie=["object"==typeof globalThis&&globalThis,ie,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Ys&&Ys];for(var ue=0;ue<ie.length;++ue){var Ce=ie[ue];if(Ce&&Ce.Math==Math)return Ce}throw Error("Cannot find global object")}(this);function l(ie,ue){if(ue)e:{var Ce=d;ie=ie.split(".");for(var ke=0;ke<ie.length-1;ke++){var ht=ie[ke];if(!(ht in Ce))break e;Ce=Ce[ht]}(ue=ue(ke=Ce[ie=ie[ie.length-1]]))!=ke&&null!=ue&&r(Ce,ie,{configurable:!0,writable:!0,value:ue})}}function h(ie){return(ie={next:ie})[Symbol.iterator]=function(){return this},ie}function f(ie){var ue=typeof Symbol<"u"&&Symbol.iterator&&ie[Symbol.iterator];return ue?ue.call(ie):{next:i(ie)}}if(l("Symbol",function(ie){function ue(ht,fe){this.A=ht,r(this,"description",{configurable:!0,writable:!0,value:fe})}if(ie)return ie;ue.prototype.toString=function(){return this.A};var Ce="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ke=0;return function ht(fe){if(this instanceof ht)throw new TypeError("Symbol is not a constructor");return new ue(Ce+(fe||"")+"_"+ke++,fe)}}),l("Symbol.iterator",function(ie){if(ie)return ie;ie=Symbol("Symbol.iterator");for(var ue="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Ce=0;Ce<ue.length;Ce++){var ke=d[ue[Ce]];"function"==typeof ke&&"function"!=typeof ke.prototype[ie]&&r(ke.prototype,ie,{configurable:!0,writable:!0,value:function(){return h(i(this))}})}return ie}),"function"==typeof Object.setPrototypeOf)a=Object.setPrototypeOf;else{var _;e:{var g={};try{g.__proto__={a:!0},_=g.a;break e}catch{}_=!1}a=_?function(ie,ue){if(ie.__proto__=ue,ie.__proto__!==ue)throw new TypeError(ie+" is not extensible");return ie}:null}var v=a;function b(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function y(ie){if(ie.m)throw new TypeError("Generator is already running");ie.m=!0}function T(ie,ue){return ie.h=3,{value:ue}}function M(ie){this.g=new b,this.G=ie}function O(ie,ue,Ce,ke){try{var ht=ue.call(ie.g.j,Ce);if(!(ht instanceof Object))throw new TypeError("Iterator result "+ht+" is not an object");if(!ht.done)return ie.g.m=!1,ht;var fe=ht.value}catch(R){return ie.g.j=null,ie.g.s(R),D(ie)}return ie.g.j=null,ke.call(ie.g,fe),D(ie)}function D(ie){for(;ie.g.h;)try{var ue=ie.G(ie.g);if(ue)return ie.g.m=!1,{value:ue.value,done:!1}}catch(Ce){ie.g.v=void 0,ie.g.s(Ce)}if(ie.g.m=!1,ie.g.l){if(ue=ie.g.l,ie.g.l=null,ue.F)throw ue.D;return{value:ue.return,done:!0}}return{value:void 0,done:!0}}function x(ie){this.next=function(ue){return ie.o(ue)},this.throw=function(ue){return ie.s(ue)},this.return=function(ue){return function(Ce,ke){y(Ce.g);var ht=Ce.g.j;return ht?O(Ce,"return"in ht?ht.return:function(fe){return{value:fe,done:!0}},ke,Ce.g.return):(Ce.g.return(ke),D(Ce))}(ie,ue)},this[Symbol.iterator]=function(){return this}}function F(ie,ue){return ue=new x(new M(ue)),v&&ie.prototype&&v(ue,ie.prototype),ue}if(b.prototype.o=function(ie){this.v=ie},b.prototype.s=function(ie){this.l={D:ie,F:!0},this.h=this.C||this.u},b.prototype.return=function(ie){this.l={return:ie},this.h=this.u},M.prototype.o=function(ie){return y(this.g),this.g.j?O(this,this.g.j.next,ie,this.g.o):(this.g.o(ie),D(this))},M.prototype.s=function(ie){return y(this.g),this.g.j?O(this,this.g.j.throw,ie,this.g.o):(this.g.s(ie),D(this))},l("Array.prototype.entries",function(ie){return ie||function(){return function(ue,Ce){ue instanceof String&&(ue+="");var ke=0,ht=!1,fe={next:function(){if(!ht&&ke<ue.length){var R=ke++;return{value:Ce(R,ue[R]),done:!1}}return ht=!0,{done:!0,value:void 0}}};return fe[Symbol.iterator]=function(){return fe},fe}(this,function(ue,Ce){return[ue,Ce]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var j=function(ie,ue){for(var Ce=0;Ce<ie.length;Ce++)ue(ie[Ce])},Y=function(ie){return ie.replace(/\r?\n|\r/g,"\r\n")},te=function(ie,ue,Ce){return ue instanceof Blob?(ue.name===(Ce=void 0!==Ce?Ce+"":"string"==typeof ue.name?ue.name:"blob")&&"[object Blob]"!==Object.prototype.toString.call(ue)||(ue=new File([ue],Ce)),[String(ie),ue]):[String(ie),String(ue)]},K=function(ie,ue){if(ie.length<ue)throw new TypeError(ue+" argument required, but only "+ie.length+" present.")},Q="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,$=Q.FormData,q=Q.XMLHttpRequest&&Q.XMLHttpRequest.prototype.send,ge=Q.Request&&Q.fetch,_e=Q.navigator&&Q.navigator.sendBeacon,Fe=Q.Element&&Q.Element.prototype,rt=Q.Symbol&&Symbol.toStringTag;rt&&(Blob.prototype[rt]||(Blob.prototype[rt]="Blob"),"File"in Q&&!File.prototype[rt]&&(File.prototype[rt]="File"));try{new File([],"")}catch{Q.File=function(ue,Ce,ke){return ue=new Blob(ue,ke||{}),Object.defineProperties(ue,{name:{value:Ce},lastModified:{value:+(ke&&void 0!==ke.lastModified?new Date(ke.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),rt&&Object.defineProperty(ue,rt,{value:"File"}),ue}}var ai=function(ie){return ie.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Qt=function(ie){this.i=[];var ue=this;ie&&j(ie.elements,function(Ce){if(Ce.name&&!Ce.disabled&&"submit"!==Ce.type&&"button"!==Ce.type&&!Ce.matches("form fieldset[disabled] *"))if("file"===Ce.type){var ke=Ce.files&&Ce.files.length?Ce.files:[new File([],"",{type:"application/octet-stream"})];j(ke,function(ht){ue.append(Ce.name,ht)})}else"select-multiple"===Ce.type||"select-one"===Ce.type?j(Ce.options,function(ht){!ht.disabled&&ht.selected&&ue.append(Ce.name,ht.value)}):"checkbox"===Ce.type||"radio"===Ce.type?Ce.checked&&ue.append(Ce.name,Ce.value):(ke="textarea"===Ce.type?Y(Ce.value):Ce.value,ue.append(Ce.name,ke))})};if((s=Qt.prototype).append=function(ie,ue,Ce){K(arguments,2),this.i.push(te(ie,ue,Ce))},s.delete=function(ie){K(arguments,1);var ue=[];ie=String(ie),j(this.i,function(Ce){Ce[0]!==ie&&ue.push(Ce)}),this.i=ue},s.entries=function ie(){var ue,Ce=this;return F(ie,function(ke){if(1==ke.h&&(ue=0),3!=ke.h)return ue<Ce.i.length?ke=T(ke,Ce.i[ue]):(ke.h=0,ke=void 0),ke;ue++,ke.h=2})},s.forEach=function(ie,ue){K(arguments,1);for(var Ce=f(this),ke=Ce.next();!ke.done;ke=Ce.next()){var ht=f(ke.value);ke=ht.next().value,ht=ht.next().value,ie.call(ue,ht,ke,this)}},s.get=function(ie){K(arguments,1);var ue=this.i;ie=String(ie);for(var Ce=0;Ce<ue.length;Ce++)if(ue[Ce][0]===ie)return ue[Ce][1];return null},s.getAll=function(ie){K(arguments,1);var ue=[];return ie=String(ie),j(this.i,function(Ce){Ce[0]===ie&&ue.push(Ce[1])}),ue},s.has=function(ie){K(arguments,1),ie=String(ie);for(var ue=0;ue<this.i.length;ue++)if(this.i[ue][0]===ie)return!0;return!1},s.keys=function ie(){var ue,Ce,fe=this;return F(ie,function(R){if(1==R.h&&(ue=f(fe),Ce=ue.next()),3!=R.h)return Ce.done?void(R.h=0):T(R,f(Ce.value).next().value);Ce=ue.next(),R.h=2})},s.set=function(ie,ue,Ce){K(arguments,2),ie=String(ie);var ke=[],ht=te(ie,ue,Ce),fe=!0;j(this.i,function(R){R[0]===ie?fe&&(fe=!ke.push(ht)):ke.push(R)}),fe&&ke.push(ht),this.i=ke},s.values=function ie(){var ue,Ce,ht,fe=this;return F(ie,function(R){if(1==R.h&&(ue=f(fe),Ce=ue.next()),3!=R.h)return Ce.done?void(R.h=0):((ht=f(Ce.value)).next(),T(R,ht.next().value));Ce=ue.next(),R.h=2})},Qt.prototype._asNative=function(){for(var ie=new $,ue=f(this),Ce=ue.next();!Ce.done;Ce=ue.next()){var ke=f(Ce.value);Ce=ke.next().value,ke=ke.next().value,ie.append(Ce,ke)}return ie},Qt.prototype._blob=function(){var ie="----formdata-polyfill-"+Math.random(),ue=[],Ce="--"+ie+'\r\nContent-Disposition: form-data; name="';return this.forEach(function(ke,ht){return"string"==typeof ke?ue.push(Ce+ai(Y(ht))+'"\r\n\r\n'+Y(ke)+"\r\n"):ue.push(Ce+ai(Y(ht))+'"; filename="'+ai(ke.name)+'"\r\nContent-Type: '+(ke.type||"application/octet-stream")+"\r\n\r\n",ke,"\r\n")}),ue.push("--"+ie+"--"),new Blob(ue,{type:"multipart/form-data; boundary="+ie})},Qt.prototype[Symbol.iterator]=function(){return this.entries()},Qt.prototype.toString=function(){return"[object FormData]"},Fe&&!Fe.matches&&(Fe.matches=Fe.matchesSelector||Fe.mozMatchesSelector||Fe.msMatchesSelector||Fe.oMatchesSelector||Fe.webkitMatchesSelector||function(ie){for(var ue=(ie=(this.document||this.ownerDocument).querySelectorAll(ie)).length;0<=--ue&&ie.item(ue)!==this;);return-1<ue}),rt&&(Qt.prototype[rt]="FormData"),q){var Fi=Q.XMLHttpRequest.prototype.setRequestHeader;Q.XMLHttpRequest.prototype.setRequestHeader=function(ie,ue){Fi.call(this,ie,ue),"content-type"===ie.toLowerCase()&&(this.B=!0)},Q.XMLHttpRequest.prototype.send=function(ie){ie instanceof Qt?(ie=ie._blob(),this.B||this.setRequestHeader("Content-Type",ie.type),q.call(this,ie)):q.call(this,ie)}}ge&&(Q.fetch=function(ie,ue){return ue&&ue.body&&ue.body instanceof Qt&&(ue.body=ue.body._blob()),ge.call(this,ie,ue)}),_e&&(Q.navigator.sendBeacon=function(ie,ue){return ue instanceof Qt&&(ue=ue._asNative()),_e.call(this,ie,ue)}),Q.FormData=Qt}}();const Um=()=>{const s=B("AREAS");return 0===s.length&&s.push(st.GLOBAL),Ba(s).call(s,(i,r,a)=>{const d=MT(r);return d?0===a?d:"".concat(i,",").concat(d):i},"")},MT=s=>s===st.OVERSEA?"".concat(Yn.ASIA,",").concat(Yn.EUROPE,",").concat(Yn.AFRICA,",").concat(Yn.NORTH_AMERICA,",").concat(Yn.SOUTH_AMERICA,",").concat(Yn.OCEANIA):Yn[s],f2=s=>{const i={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return s.map(r=>{const a=yv[r],d=Object.keys(a);d&&d.map(l=>{"CODE"!==l&&(i[l]=i[l].concat(a[l]))})}),i},mp={GLOBAL:{ASIA:[st.CHINA,st.JAPAN,st.INDIA,st.KOREA,st.HKMC],EUROPE:[],NORTH_AMERICA:[st.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},js=Object.keys(mp[st.GLOBAL]),xT=[st.CHINA,st.NORTH_AMERICA,st.EUROPE,st.ASIA,st.JAPAN,st.INDIA,st.OCEANIA,st.SOUTH_AMERICA,st.AFRICA,st.KOREA,st.HKMC,st.US],m2=function(s,i){let r=[];if(ye(s).call(s,st.GLOBAL)){const l=[st.GLOBAL,st.OVERSEA],h=Object.keys(yv);if(i===st.GLOBAL)throw new W(k.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(i===st.CHINA)r=[st.OVERSEA];else if(d=i,ye(js).call(js,d)){const f=mp[st.GLOBAL][i]||[],_=[...l,i,...f];r=h.filter(g=>!ye(_).call(_,g))}else if(function(f){let _=!1;return js.forEach(g=>{var v;ye(v=mp[st.GLOBAL][g]).call(v,f)&&(_=!0)}),_}(i)){const f=function(g){let v;return js.forEach(b=>{var y;ye(y=mp[st.GLOBAL][b]).call(y,g)&&(v=b)}),v}(i),_=[...l,f,i];r=h.filter(g=>!ye(_).call(_,g))}else r=s;r=function(f){const _=[];return xT.forEach(g=>{ye(f).call(f,g)&&_.push(g)}),_.concat(f.filter(g=>!ye(xT).call(xT,g)))}(r)}else r=s;var d;return r};function oN(s){var i,r;if(!s&&ye(i=B("AREAS")).call(i,st.EXTENSIONS))return I.debug("update area from ap : reset"),void _p(qL,!0);if(!ye(r=B("AREAS")).call(r,st.GLOBAL)||!s)return;let a=yv.EXTENSIONS;a&&(a={CODE:MT(st.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(s,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(s,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(s,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(s,".agora.io"),"cds-ap-web-2-".concat(s,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(s,".agora.io"),"sua-ap-web-2-".concat(s,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(s,".agora.io"),"uap-ap-web-2-".concat(s,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(s,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(s,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(s,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(s,".agora.io")]},I.debug("update area from ap success: ".concat(s,",config is "),a),It("AREAS",[st.EXTENSIONS],!0),Object.keys(a).map(d=>{It(d,"LOG_UPLOAD_SERVER"===d||"EVENT_REPORT_DOMAIN"===d||"EVENT_REPORT_BACKUP_DOMAIN"===d||"PROXY_SERVER_TYPE3"===d?a[d][0]:a[d])}))}function _p(s){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=Ie.reportApiInvoke(null,{name:qn.SET_AREA,options:s,tag:Kt.TRACER});try{let a=[];if("string"==typeof s&&(a=[s]),Array.isArray(s)&&(s.forEach(l=>{if(!ye(zO).call(zO,l))throw new W(k.INVALID_PARAMS,"invalid area code")}),a=s),"[object Object]"===Object.prototype.toString.call(s)){const{areaCode:l,excludedArea:h}=s;if(!l)throw new W(k.INVALID_PARAMS,"area code is needed");let f=l;"string"==typeof l&&(f=[l]),a=h?m2(f,h):f}if(!i){if(Ld.AREAS){const l=new W(k.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r.onError(l),void I.warning("setArea is prohibited because of config-distribute")}if(ye(a).call(a,st.GLOBAL)&&B("AREAS")===st.EXTENSIONS){const l=new W(k.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r.onError(l),void I.warning("setArea is prohibited because of ap extensions")}}It("AREAS",a,i);const d=f2(a);Object.keys(d).map(l=>{It(l,"LOG_UPLOAD_SERVER"===l||"EVENT_REPORT_DOMAIN"===l||"EVENT_REPORT_BACKUP_DOMAIN"===l||"PROXY_SERVER_TYPE3"===l?d[l][0]:d[l])}),I.debug("set area success:",a.join(","))}catch(a){throw r.onError(a),a}r.onSuccess()}function Pv(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Vm(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?Pv(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Pv(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}let Mv=1;let Bm=1;function sN(s,i,r,a){let{url:d,areaCode:l}=s;const h=Date.now();let f;const[_,g]=xv(i,l,[bi.CHOOSE_SERVER]);let v=Fn.networkState;return In(L(function*(){v&&Fn.networkState===$i.OFFLINE&&Fn.onlineWaiter&&(yield X.race([Fn.onlineWaiter,Un(a&&a.maxRetryTimeout||Pn.maxRetryTimeout)])),v=Fn.networkState;const{data:b,headers:y}=yield Ga(d,{data:_,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);f="1"===y.http3?1:-1,Ie.reportResourceTiming(d,i.sid),cN(b,d,i,h,[bi.CHOOSE_SERVER],f);const T=Rv(b,bi.CHOOSE_SERVER);return dN(T),DT(T,d)}),b=>(b&&Ie.joinChooseServer(i.sid,{lts:h,succ:!0,csAddr:d,opid:g,serverList:b.gatewayAddrs.map(y=>y.address),ec:null,cid:b.cid.toString(),uid:b.uid.toString(),csIp:b.csIp,unilbsServerIds:[bi.CHOOSE_SERVER].toString(),isHttp3:f}),!1),b=>b.code!==k.OPERATION_ABORTED&&(b.code===k.CAN_NOT_GET_GATEWAY_SERVER?b.data.retry:(Ie.joinChooseServer(i.sid,{lts:h,succ:!1,csAddr:d,serverList:null,opid:g,ec:b.code,csIp:b.data&&b.data.csIp,unilbsServerIds:[bi.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:v}),isHttp3:f}),I.warning("[".concat(i.clientId,"] Choose server network error, retry"),b),!0)),a)}function aN(s,i,r,a){let d,{url:l,areaCode:h,serviceIds:f}=s;const _=Date.now(),[g,v]=xv(i,h,f);let b;return In(L(function*(){b&&Fn.networkState===$i.OFFLINE&&Fn.onlineWaiter&&(yield X.race([Fn.onlineWaiter,Un(a&&a.maxRetryTimeout||Pn.maxRetryTimeout)])),b=Fn.networkState;const{data:y,headers:T}=yield Ga(l,{data:g,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);d="1"===T.http3?1:-1,Ie.reportResourceTiming(l,i.sid),cN(y,l,i,_,f,d);const M=Rv(y,bi.CHOOSE_SERVER),O=Rv(y,"proxy5"===i.cloudProxyServer?bi.CLOUD_PROXY_5:"proxy3"===i.cloudProxyServer||"proxy4"===i.cloudProxyServer?bi.CLOUD_PROXY:bi.CLOUD_PROXY_FALLBACK);return dN(M),{gatewayInfo:DT(M,l),proxyInfo:O,url:l}}),y=>(y.gatewayInfo&&Ie.joinChooseServer(i.sid,{lts:_,succ:!0,csAddr:l,serverList:y.gatewayInfo.gatewayAddrs.map(T=>T.address),ec:null,opid:v,cid:y.gatewayInfo.cid.toString(),uid:y.gatewayInfo.uid.toString(),csIp:y.gatewayInfo.csIp,unilbsServerIds:f.toString(),isHttp3:d}),y.proxyInfo&&Ie.joinWebProxyAP(i.sid,{lts:_,sucess:1,apServerAddr:l,turnServerAddrList:y.proxyInfo.addresses.map(T=>T.ip).join(","),errorCode:null,eventType:i.cloudProxyServer,unilbsServerIds:f.toString()}),!1),y=>y.code!==k.OPERATION_ABORTED&&(y.code===k.CAN_NOT_GET_GATEWAY_SERVER?y.data.retry:(Ie.joinWebProxyAP(i.sid,{lts:_,sucess:0,apServerAddr:l,turnServerAddrList:null,errorCode:y.code,eventType:i.cloudProxyServer,unilbsServerIds:f.toString(),extend:JSON.stringify({networkState:b})}),I.warning("[".concat(i.clientId,"] multi unilbs network error, retry"),y),!0)),a)}const cN=(s,i,r,a,d,l)=>{const h=[],f=_=>{4096===_.flag?Ie.joinChooseServer(r.sid,{lts:a,succ:!1,csAddr:i,opid:s.opid,serverList:null,ec:_.error.message,csIp:_.error.data&&_.error.data.csIp,unilbsServerIds:d.toString(),isHttp3:l}):1048576!==_.flag&&4194304!==_.flag&&4194310!==_.flag||Ie.joinWebProxyAP(r.sid,{lts:a,sucess:0,apServerAddr:i,turnServerAddrList:null,errorCode:_.error.code,eventType:r.cloudProxyServer,unilbsServerIds:d.toString()})};if(s.response_body.forEach(_=>{const g=_.buffer.code;if(23===_.uri&&0===g&&!_.buffer.edges_services)if(4194310===_.buffer.flag)I.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),_.buffer.edges_services=[];else{const v={error:new W(k.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:s.detail[502]}),flag:_.buffer.flag};h.push(v),f(v)}if(0!==g){const v=Mm(g),b={error:new W(k.CAN_NOT_GET_GATEWAY_SERVER,v.desc,{desc:v.desc,retry:v.retry,csIp:s.detail[502]}),flag:_.buffer.flag};4194310===_.buffer.flag?I.warning(b.error.toString()):h.push(b),f(b)}}),h.length)throw I.warning("[".concat(r.clientId,"] multi unilbs ").concat(i," failed, ").concat(h.map(_=>"flag: ".concat(_.flag,", message: ").concat(_.error.message,", retry: ").concat(_.error.data.retry)).join(" | "))),new W(k.CAN_NOT_GET_GATEWAY_SERVER,h.map(_=>"flag: ".concat(_.flag,", message: ").concat(_.error.message)).join(" | "),{retry:!!h.find(_=>_.error.data.retry),csIp:s.detail[502],desc:[...new Set(h.map(_=>{var g;return null==_||null===(g=_.error)||void 0===g||null===(g=g.data)||void 0===g?void 0:g.desc}).filter(_=>!!_))]})},dN=s=>{var i,r,a,d;if(s.addresses&&0===s.addresses.length&&0===s.code)throw new W(k.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:s.detail&&s.detail[502]});if(B("AP_AREA")&&(null!==(a=s.detail)&&void 0!==a&&a[23]&&"string"==typeof(null===(d=s.detail)||void 0===d?void 0:d[23])?oN(s.detail[23].toLowerCase()):oN()),null!==(i=s.detail)&&void 0!==i&&i[19]&&"string"==typeof(null===(r=s.detail)||void 0===r?void 0:r[19])){const h=s.detail[19],f=h?.split(";");for(let _=0;_<f.length;_++){var l;const g=Iv(l=f[_]).call(l);s.addresses[_]&&f&&(s.addresses[_].fingerprint=g)}}if(B("GATEWAY_ADDRESS")&&B("GATEWAY_ADDRESS").length>0){I.debug("assign gateway address to",B("GATEWAY_ADDRESS"));const h=B("GATEWAY_ADDRESS").map(f=>{var _,g;const v=null!==(_=null===(g=s.addresses.find(b=>b.ip===f.ip&&b.port===f.port))||void 0===g?void 0:g.fingerprint)&&void 0!==_?_:"";return{ip:f.ip,port:f.port,ticket:s.addresses[0]&&s.addresses[0].ticket,fingerprint:v}});s.addresses=h}},lN=(s,i)=>{if(s.response_body&&s.response_body.length){const r=s.response_body[0];if(0!==r.buffer.code){const a=Mm(r.buffer.code);throw new W(k.UPDATE_TICKET_FAILED,"[".concat(r.buffer.code,"]: ").concat(a.desc),{retry:a.retry})}return r.buffer.ticket}throw I.debug("update ticket request received ap response without response body:",i),new W(k.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},xv=(s,i,r)=>{const a=Math.floor(1e12*Math.random()),d={appid:s.appId,client_ts:Date.now(),opid:a,sid:s.sid,request_bodies:[{uri:22,buffer:{cname:s.cname,detail:Vm({6:s.stringUid,11:i,12:B("USE_NEW_TOKEN")?"1":void 0,22:i},s.apRTM?{26:"RTM2"}:{}),key:s.token,service_ids:r,uid:s.uid||0}}]};d.request_bodies.forEach(h=>{s.multiIP&&s.multiIP.gateway_ip&&(h.buffer.detail[5]=JSON.stringify({vocs_ip:[s.multiIP.uni_lbs_ip],vos_ip:[s.multiIP.gateway_ip]}))});const l=new FormData;return l.append("request",JSON.stringify(d)),[l,a]},_2=(s,i)=>{const r=Math.floor(1e12*Math.random()),a={appid:s.appId,client_ts:Date.now(),opid:r,sid:s.sid,request_bodies:[{uri:28,buffer:{cname:s.cname,detail:{1:"",6:s.stringUid,12:"1"},token:s.token,service_ids:i,uid:s.uid||0,edges_services:s.apResponse.addresses.map(l=>({ip:l.ip,port:l.port}))}}]},d=new FormData;return d.append("request",JSON.stringify(a)),[d,r]};let cu=0;function du(s){return X.all(s.map(i=>i.then(r=>{throw r},r=>r))).then(i=>{throw i},i=>i)}const jm=function(){var s=L(function*(i){let{fragementLength:r,referenceList:a,asyncMapHandler:d,allFailedhandler:l,promisesCollector:h}=i,f=0;const _=r;let g,v=0;const b=function(){var y=L(function*(){const T=(()=>{const M=f*_;return a.slice(M,M+_).map(d)})();h&&h.push(...T);try{g=yield du(T)}catch(M){if(v+=_,f++,!(v>=a.length))return void(yield b());l(M)}T.forEach(M=>M.cancel())});return function(){return y.apply(this,arguments)}}();return yield b(),g});return function(r){return s.apply(this,arguments)}}();function kv(s,i,r,a){return ua.apply(this,arguments)}function ua(){return ua=L(function*(s,i,r,a){return{gatewayInfo:yield(l=L(function*(h,f,_,g){let v=null;const b=[],y=function(){var M=L(function*(){const O=B("WEBCS_DOMAIN").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(F=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(F+"/api/v2/transpond/webrtc?v=2"):"https://".concat(F,"/api/v2/transpond/webrtc?v=2"),areaCode:Um()})),D=g.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(F=>F.url)}),x=yield jm({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:F=>(I.debug("[".concat(h.clientId,"] Connect to choose_server:"),F.url),sN(F,h,f,_)),allFailedhandler:F=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:F},D),F[0]},promisesCollector:b});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},D),x});return function(){return M.apply(this,arguments)}}(),T=function(){var M=L(function*(){if(yield Un(1e3),null!==v)return v;const O=B("WEBCS_DOMAIN_BACKUP_LIST").map(F=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(F+"/api/v2/transpond/webrtc?v=2"):"https://".concat(F,"/api/v2/transpond/webrtc?v=2"),areaCode:Um()})),D=g.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(F=>F.url)}),x=yield jm({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:F=>(I.debug("[".concat(h.clientId,"] Connect to backup choose_server:"),F.url),sN(F,h,f,_)),allFailedhandler:F=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:F},D),F[0]},promisesCollector:b});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},D),x});return function(){return M.apply(this,arguments)}}();try{return v=yield du([y(),T()]),b.length&&b.forEach(M=>M.cancel&&"function"==typeof M.cancel&&M.cancel()),v}catch(M){throw M[0]}}),function(h,f,_,g){return l.apply(this,arguments)})(s,i,r,a)};var l}),ua.apply(this,arguments)}function ha(s,i,r,a,d){return Qi.apply(this,arguments)}function Qi(){return Qi=L(function*(s,i,r,a,d){const l=s.cloudProxyServer;if("disabled"===l){if(!a)return;if(s.useLocalAccessPoint)return yield kv(s,i,r,d);if(B("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:y,proxyInfo:T}=yield uN(s,i,r,d);if(s.turnServer&&"auto"!==s.turnServer.mode)return{gatewayInfo:y};const M=T.map(O=>({turnServerURL:O.address,tcpport:O.tcpport||Er.tcpport,udpport:O.udpport||Er.udpport,username:O.username||Er.username,password:O.password||Er.password,forceturn:!1,security:!0}));if(d.useP2P){var h;const O=null!==(h=s.uid)&&void 0!==h?h:y.uid,D="glb:".concat(O.toString()),x=yield $h(D),F=T.map(j=>({turnServerURL:j.address,tcpport:j.tcpport||Er.tcpport,udpport:j.udpport||Er.udpport,username:D,password:x,forceturn:!1,security:!0}));M.push(...F)}return s.turnServer={mode:"manual",servers:M},{gatewayInfo:y}}return yield kv(s,i,r,d)}const{proxyInfo:f,gatewayInfo:_}=yield uN(s,i,r,d),g={gatewayInfo:_},v=f.map(y=>({turnServerURL:y.address,tcpport:"proxy3"===l?void 0:y.tcpport?y.tcpport:Er.tcpport,udpport:"proxy4"===l?void 0:y.udpport?y.udpport:Er.udpport,username:y.username||Er.username,password:y.password||Er.password,forceturn:"proxy4"!==l,security:"proxy5"===l}));if(d.useP2P){var b;const y=null!==(b=s.uid)&&void 0!==b?b:_.uid,T="glb:".concat(y.toString()),M=yield $h(T),O=f.map(D=>({turnServerURL:D.address,tcpport:"proxy3"===l?void 0:D.tcpport||Er.tcpport,udpport:"proxy4"===l?void 0:D.udpport||Er.udpport,username:T,password:M,forceturn:"proxy4"!==l,security:"proxy5"===l}));v.push(...O)}return s.turnServer={mode:"manual",servers:v},I.debug("[".concat(s.clientId,"] set proxy server: ").concat(s.proxyServer,", mode: ").concat(l)),g}),Qi.apply(this,arguments)}function ar(s,i,r,a,d){return LT.apply(this,arguments)}function LT(){return LT=L(function*(s,i,r,a,d){let h=[];h=B("ACCOUNT_REGISTER").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(i.proxyServer?_=>"https://".concat(i.proxyServer,"/ap/?url=").concat(_+"/api/v1"):_=>"https://".concat(_,"/api/v1"));const f=d?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const _=yield(g=L(function*(v,b,y,T,M){const O=Date.now(),D={sid:y.sid,opid:10,appid:y.appId,string_uid:b};let x=v[0];const F=yield In(()=>Ga(x+"".concat(-1===x.indexOf("?")?"?":"&","action=stringuid"),{data:D,cancelToken:T,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(j,Y)=>{if(0===j.code){if(j.uid<=0||j.uid>=Math.pow(2,32))throw I.error("Invalid Uint Uid ".concat(b," => ").concat(j.uid),j),Ie.reqUserAccount(D.sid,{lts:O,success:!1,serverAddr:x,stringUid:D.string_uid,uid:j.uid,errorCode:k.INVALID_UINT_UID_FROM_STRING_UID,extend:D}),new W(k.INVALID_UINT_UID_FROM_STRING_UID);return Ie.reqUserAccount(D.sid,{lts:O,success:!0,serverAddr:x,stringUid:D.string_uid,uid:j.uid,errorCode:null,extend:D}),!1}const te=Mm(j.code);return te.retry&&(x=v[(Y+1)%v.length]),Ie.reqUserAccount(D.sid,{lts:O,success:!1,serverAddr:x,stringUid:D.string_uid,uid:j.uid,errorCode:te.desc,extend:D}),te.retry},(j,Y)=>j.code!==k.OPERATION_ABORTED&&(Ie.reqUserAccount(D.sid,{lts:O,success:!1,serverAddr:x,stringUid:D.string_uid,uid:null,errorCode:j.code,extend:D}),x=v[(Y+1)%v.length],!0),M);if(0!==F.code){const j=Mm(F.code);throw new W(k.UNEXPECTED_RESPONSE,j.desc)}return F}),function(v,b,y,T,M){return g.apply(this,arguments)})(h,s,i,r,a);return d?.recordJoinChannelService({status:"success",endTs:Date.now()},f),_.uid}catch(_){throw d?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[_]},f),_}var g}),LT.apply(this,arguments)}function FT(){return FT=L(function*(s,i,r){const a=B("CDS_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(f=>s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(f+"/api/v1"):"https://".concat(f,"/api/v1?action=config")).map(f=>function(_,g,v,b){const y=lt(),T={flag:64,cipher_method:0,features:{device:y.name,system:y.os,system_general:navigator.userAgent,vendor:g.appId,version:Ao,cname:g.cname,sid:g.sid,session_id:g.sid,detail:"",proxyServer:g.proxyServer}};return In(()=>Ga(_,{data:T,timeout:1e3,cancelToken:v,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,M=>M.code!==k.OPERATION_ABORTED,b)}(f,s,i,r));let d=null,l=null,h={};try{d=yield du(a)}catch(f){if(f.code===k.OPERATION_ABORTED)throw f;l=f}if(a.forEach(f=>f.cancel()),Ie.reportApiInvoke(s.sid,{name:qn.REQUEST_CONFIG_DISTRIBUTE,options:{error:l,res:d}}).onSuccess(),d&&d.test_tags)try{h=function(f){if(!f.test_tags)return{};const _=f.test_tags,g=Object.keys(_),v={};return g.forEach(b=>{var y;const T=Iv(y=b.slice(4)).call(y),M=JSON.parse(_[b])[1];v[T]=M}),v}(d)}catch{}return h}),FT.apply(this,arguments)}function uN(s,i,r,a){return UT.apply(this,arguments)}function UT(){return UT=L(function*(s,i,r,a){const d=B("PROXY_SERVER_TYPE3"),l=(T,M,O)=>{let D=O||d;return Array.isArray(D)&&(D=M%2==0?d[1]:d[0]),"https://".concat(D,"/ap/?url=").concat(T)};let h=null;const f=[],_=function(){var T=L(function*(){const M=B("WEBCS_DOMAIN").slice(0,B("AJAX_REQUEST_CONCURRENT")).map((x,F)=>{let j;return j="disabled"===s.cloudProxyServer&&s.proxyServer?l("".concat(x,"/api/v2/transpond/webrtc?v=2"),F,s.proxyServer):"disabled"===s.cloudProxyServer||"fallback"===s.cloudProxyServer?"https://".concat(x,"/api/v2/transpond/webrtc?v=2"):l("".concat(x,"/api/v2/transpond/webrtc?v=2"),F),{url:j,areaCode:Um(),serviceIds:[bi.CHOOSE_SERVER,"proxy5"===s.cloudProxyServer?bi.CLOUD_PROXY_5:"proxy3"===s.cloudProxyServer||"proxy4"===s.cloudProxyServer?bi.CLOUD_PROXY:bi.CLOUD_PROXY_FALLBACK]}}),O=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:M.map(x=>x.url)}),D=yield jm({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:M,asyncMapHandler:x=>(I.debug("[".concat(s.clientId,"] Connect to choose_server:"),x.url),aN(x,s,i,r)),allFailedhandler:x=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:x},O),x[0]},promisesCollector:f});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},O),D});return function(){return T.apply(this,arguments)}}(),g=function(){var T=L(function*(){if(yield Un(1e3),null!==h)return h;const M=B("WEBCS_DOMAIN_BACKUP_LIST").map((x,F)=>{let j;return j="disabled"===s.cloudProxyServer&&s.proxyServer?l("".concat(x,"/api/v2/transpond/webrtc?v=2"),F,s.proxyServer):"disabled"===s.cloudProxyServer||"fallback"===s.cloudProxyServer?"https://".concat(x,"/api/v2/transpond/webrtc?v=2"):l("".concat(x,"/api/v2/transpond/webrtc?v=2"),F),{url:j,areaCode:Um(),serviceIds:[bi.CHOOSE_SERVER,"proxy5"===s.cloudProxyServer?bi.CLOUD_PROXY_5:"proxy3"===s.cloudProxyServer||"proxy4"===s.cloudProxyServer?bi.CLOUD_PROXY:bi.CLOUD_PROXY_FALLBACK]}}),O=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:M.map(x=>x.url)}),D=yield jm({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:M,asyncMapHandler:x=>(I.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),x.url),aN(x,s,i,r)),allFailedhandler:x=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:x},O),x[0]},promisesCollector:f});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},O),D});return function(){return T.apply(this,arguments)}}();let v,b,y;try{({gatewayInfo:v,proxyInfo:b,url:y}=yield du([_(),g()]))}catch(T){throw T[0]}if(f.length&&f.forEach(T=>T.cancel&&"function"==typeof T.cancel&&T.cancel()),!v||!b)throw new W(k.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(s.apUrl=y,"disabled"!==s.cloudProxyServer&&Array.isArray(d)&&y){const T=/^https?:\/\/(.+?)(\/.*)?$/.exec(y)[1];ye(d).call(d,T)&&(s.proxyServer=T,I.setProxyServer(T),Ie.setProxyServer(T))}return h={gatewayInfo:v,proxyInfo:yield mn(b,v.uid)},h}),UT.apply(this,arguments)}function hN(s,i,r,a){return VT.apply(this,arguments)}function VT(){return VT=L(function*(s,i,r,a){const d=B("UAP_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(l=>i.proxyServer?"https://".concat(i.proxyServer,"/ap/?url=").concat(l+"/api/v1?action=uap"):"https://".concat(l,"/api/v1?action=uap"));return yield function kT(s,i,r,a,d){Mv+=1;const l={sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(Date.now()/1e3),seq:Mv,requestId:Mv,version:Ao,cname:r.cname},h={service_name:i,json_body:JSON.stringify(l)};let f,_,g=s[0];return In(L(function*(){f=Date.now();const v=yield Ga(g,{data:h,cancelToken:a,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(_=Date.now()-f,0!==v.code){const T=new W(k.UNEXPECTED_RESPONSE,"live streaming ap error, code"+v.code,{retry:!0,responseTime:_});throw I.error(T.toString()),T}const b=JSON.parse(v.json_body);if(200!==b.code){const T=new W(k.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(b.code,", reason: ").concat(b.reason),{code:b.code,responseTime:_});throw I.error(T.toString()),T}if(!b.servers||0===b.servers.length){const T=new W(k.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:b.code,responseTime:_});throw I.error(T.toString()),T}const y=(M=i,{addressList:(T=b).servers.map(O=>"wss://".concat(O.address.replace(/\./g,"-"),".").concat(B("WORKER_DOMAIN"),":").concat(O.wss,"?serviceName=").concat(encodeURIComponent(M))),workerToken:T.workerToken,vid:T.vid});var T,M;return B("LIVE_STREAMING_ADDRESS")&&(y.addressList=B("LIVE_STREAMING_ADDRESS")instanceof Array?B("LIVE_STREAMING_ADDRESS"):[B("LIVE_STREAMING_ADDRESS")]),Vm(Vm({},y),{},{responseTime:_})}),(v,b)=>(Ie.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:i,responseDetail:JSON.stringify(v.addressList),firstSuccess:0===b,responseTime:_,serverIp:s[b%s.length]}),!1),(v,b)=>(Ie.apworkerEvent(r.sid,{success:!1,sc:v.data&&v.data.code||200,serviceName:i,responseTime:_,serverIp:s[b%s.length]}),!!(v.code!==k.OPERATION_ABORTED&&v.code!==k.UNEXPECTED_RESPONSE||v.data&&v.data.retry)&&(g=s[(b+1)%s.length],!0)),d)}(d,s,i,r,a)}),VT.apply(this,arguments)}function BT(){return BT=L(function*(s,i,r){const a=B("UAP_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(d=>s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap")).map(d=>function(l,h,f,_){const g={command:"convergeAllocateEdge",sid:h.sid,appId:h.appId,token:h.token,ts:Date.now(),version:Ao,cname:h.cname,uid:h.uid.toString(),requestId:Bm,seq:Bm};Bm+=1;const v={service_name:"tele_channel",json_body:JSON.stringify(g)};return In(L(function*(){const b=yield Ga(l,{data:v,cancelToken:f,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==b.code){const T=new W(k.UNEXPECTED_RESPONSE,"cross channel ap error, code"+b.code,{retry:!0});throw I.error(T.toString()),T}const y=JSON.parse(b.json_body);if(200!==y.code){const T=new W(k.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(y.code,", reason: ").concat(y.reason));throw I.error(T.toString()),T}if(!y.servers||0===y.servers.length){const T=new W(k.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw I.error(T.toString()),T}return{vid:y.vid,workerToken:y.workerToken,addressList:(B("CHANNEL_MEDIA_RELAY_SERVERS")||y.servers).map(T=>"wss://".concat(T.address.replace(/\./g,"-"),".").concat(B("WORKER_DOMAIN"),":").concat(T.wss))}}),void 0,b=>!!(b.code!==k.OPERATION_ABORTED&&b.code!==k.UNEXPECTED_RESPONSE||b.data&&b.data.retry),_)}(d,s,i,r));try{const d=yield du(a);return a.forEach(l=>l.cancel()),d}catch(d){throw d[0]}}),BT.apply(this,arguments)}function jT(){return jT=L(function*(s,i,r){let a=null;const d=[],l=function(){var h=L(function*(f){const _=B(f?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(g=>s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(g+"/api/v2/transpond/webrtc?v=2"):"https://".concat(g,"/api/v2/transpond/webrtc?v=2"));return f&&(yield Un(1e3),null!==a)?a:yield jm({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:_,asyncMapHandler:g=>(I.debug("[".concat(s.clientId,"] update ticket, Connect to ").concat(f?"backup":""," choose_server:"),g),function(v,b,y,T){const[M]=_2(b,[bi.CHOOSE_SERVER]);let O=Fn.networkState;return In(L(function*(){O&&Fn.networkState===$i.OFFLINE&&Fn.onlineWaiter&&(yield X.race([Fn.onlineWaiter,Un(T&&T.maxRetryTimeout||Pn.maxRetryTimeout)])),O=Fn.networkState;const D=yield Ga(v,{data:M,cancelToken:y,headers:{"Content-Type":"multipart/form-data;"}},!0);return lN(D,v)}),()=>!1,D=>D.code!==k.OPERATION_ABORTED&&(D.code===k.UPDATE_TICKET_FAILED?D.data.retry:(I.warning("[".concat(b.clientId,"] update ticket network error, retry"),D),!0)),T)}(g,s,i,r)),allFailedhandler:g=>{throw g[0]},promisesCollector:d})});return function(_){return h.apply(this,arguments)}}();try{return a=yield du([l(!1),l(!0)]),d.length&&d.forEach(h=>h.cancel&&"function"==typeof h.cancel&&h.cancel()),a}catch(h){throw h[0]}}),jT.apply(this,arguments)}function HT(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function GT(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?HT(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):HT(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class pN extends jt{get isSuccess(){return!!this.configs}constructor(){super(),C(this,"configs",void 0),C(this,"joinInfo",void 0),C(this,"cancelToken",void 0),C(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),C(this,"interval",void 0),C(this,"mutex",new gi("config-distribute")),C(this,"mutableParamsRead",!1)}startGetConfigDistribute(i,r){this.joinInfo=i,this.cancelToken=r,this.interval&&this.stopGetConfigDistribute(),B("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},B("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}awaitConfigDistributeComplete(){var i=this;return L(function*(){i.mutex.isLocked&&(yield i.mutex.lock())()})()}updateConfigDistribute(){var i=this;return L(function*(){if(i.mutableParamsRead||(i.mutableParamsRead=!0,Ie.reportApiInvoke(null,{options:void 0,name:qn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Kt.TRACER}).onSuccess(JSON.stringify(Ld))),!i.joinInfo||!i.cancelToken||!i.retryConfig)return void I.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const a=yield i.mutex.lock();try{r=yield function Hm(s,i,r){return FT.apply(this,arguments)}(i.joinInfo,i.cancelToken,i.retryConfig),I.debug("[config-distribute] get config distribute",JSON.stringify(r)),r.limit_bitrate&&i.handleBitrateLimit(r.limit_bitrate),i.cacheGlobalParameterConfig(r),i.configs=r}catch(d){const l=new W(k.NETWORK_RESPONSE_ERROR,d);I.warning("[config-distribute] ".concat(l.toString()))}finally{a()}})()}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(i){var r;(r=i)&&r.uplink&&r.id&&void 0!==r.uplink.max_bitrate&&void 0!==r.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==i.id&&this.emit(Nm.UPDATE_BITRATE_LIMIT,i):this.emit(Nm.UPDATE_BITRATE_LIMIT,i))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&GT({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(i){var r;const a=bE(r=Object.keys(i).filter(l=>/^webrtc_ng_global_parameter/.test(l))).call(r);for(let l=0;l<a.length;l++)for(let h=a.length-1;h>l;h--){const f=a[h];if("number"==typeof i[f].__priority){const g=a[h-1];if("number"==typeof i[g].__priority){if(!(i[f].__priority>i[g].__priority))continue;{const v=f;a[h]=a[h-1],a[h-1]=v}}else{const v=f;a[h]=a[h-1],a[h-1]=v}}}const d={};a.forEach(l=>{const h=i[l],f=h.__expires;Object.keys(h).forEach(_=>{"__priority"===_||"__expires"===_||Object.prototype.hasOwnProperty.call(d,_)||(d[_]=GT({value:h[_]},f&&{expires:f}))})});try{!function(f){try{const _=Date.now();Object.keys(f).forEach(g=>{switch(g){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":if(Object.prototype.hasOwnProperty.call(gr,g)){const{value:v,expires:b}=f[g];if(b&&b<=_)return;Ld[g]=v,gr[g]=v,I.debug("Update global parameters from config distribute",g,v)}}})}catch(_){I.error("Error update config immediately: ".concat(f),_.message)}}(d);const l=JSON.stringify(d),h=window.btoa(l);window.localStorage.setItem("websdk_ng_global_parameter",h),I.debug("Caching global parameters ".concat(l))}catch(l){I.error("Error caching global parameters:",l.message)}}}const Ui={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1};function Ot(){return Ui}var ii;function lu(s,i,r){return{sampleRate:s,stereo:i,bitrate:r}}function tt(s,i,r,a,d){return{width:s,height:i,frameRate:r,bitrateMin:a,bitrateMax:d}}function ps(s,i,r,a,d){return{width:{max:s},height:{max:i},frameRate:r,bitrateMin:a,bitrateMax:d}}function br(s,i){return{numSpatialLayers:s,numTemporalLayers:i}}!function(s){s.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",s.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",s.IOS_INTERRUPTION_START="ios-interruption-start",s.IOS_INTERRUPTION_END="ios-interruption-end",s.STATE_CHANGE="state-change"}(ii||(ii={}));const fN={"90p":tt(160,90),"90p_1":tt(160,90),"120p":tt(160,120,15,30,65),"120p_1":tt(160,120,15,30,65),"120p_3":tt(120,120,15,30,50),"120p_4":tt(212,120),"180p":tt(320,180,15,30,140),"180p_1":tt(320,180,15,30,140),"180p_3":tt(180,180,15,30,100),"180p_4":tt(240,180,15,30,120),"240p":tt(320,240,15,40,200),"240p_1":tt(320,240,15,40,200),"240p_3":tt(240,240,15,40,140),"240p_4":tt(424,240,15,40,220),"360p":tt(640,360,15,80,400),"360p_1":tt(640,360,15,80,400),"360p_3":tt(360,360,15,80,260),"360p_4":tt(640,360,30,80,600),"360p_6":tt(360,360,30,80,400),"360p_7":tt(480,360,15,80,320),"360p_8":tt(480,360,30,80,490),"360p_9":tt(640,360,15,80,800),"360p_10":tt(640,360,24,80,800),"360p_11":tt(640,360,24,80,1e3),"480p":tt(640,480,15,100,500),"480p_1":tt(640,480,15,100,500),"480p_2":tt(640,480,30,100,1e3),"480p_3":tt(480,480,15,100,400),"480p_4":tt(640,480,30,100,750),"480p_6":tt(480,480,30,100,600),"480p_8":tt(848,480,15,100,610),"480p_9":tt(848,480,30,100,930),"480p_10":tt(640,480,10,100,400),"720p":tt(1280,720,15,120,1130),"720p_auto":tt(1280,720,30,900,3e3),"720p_1":tt(1280,720,15,120,1130),"720p_2":tt(1280,720,30,120,2e3),"720p_3":tt(1280,720,30,120,1710),"720p_5":tt(960,720,15,120,910),"720p_6":tt(960,720,30,120,1380),"1080p":tt(1920,1080,15,120,2080),"1080p_1":tt(1920,1080,15,120,2080),"1080p_2":tt(1920,1080,30,120,3e3),"1080p_3":tt(1920,1080,30,120,3150),"1080p_5":tt(1920,1080,60,120,4780),"1440p":tt(2560,1440,30,120,4850),"1440p_1":tt(2560,1440,30,120,4850),"1440p_2":tt(2560,1440,60,120,7350),"4k":tt(3840,2160,30,120,8910),"4k_1":tt(3840,2160,30,120,8910),"4k_3":tt(3840,2160,60,120,13500)},Lv=[{scaleResolutionDownBy:2,width:1280,height:720,frameRate:30,bitrateMin:300,bitrateMax:900},{scaleResolutionDownBy:1.333333,width:1280,height:720,frameRate:30,bitrateMin:600,bitrateMax:2e3},{scaleResolutionDownBy:1,width:1280,height:720,frameRate:30,bitrateMin:900,bitrateMax:3e3}],v2={"480p":ps(640,480,5),"480p_1":ps(640,480,5),"480p_2":ps(640,480,30),"480p_3":ps(640,480,15),"720p":ps(1280,720,5),"720p_auto":tt(1280,720,30,900,3e3),"720p_1":ps(1280,720,5),"720p_2":ps(1280,720,30),"720p_3":ps(1280,720,15),"1080p":ps(1920,1080,5),"1080p_1":ps(1920,1080,5),"1080p_2":ps(1920,1080,30),"1080p_3":ps(1920,1080,15)},uu={"1SL1TL":br(1,1),"3SL3TL":br(3,3),"2SL3TL":br(2,3)};function Mo(s){return s||(s="480p_1"),"string"==typeof s?Object.assign({},fN[s]):s}function Fv(s){return"string"==typeof s?Object.assign({},v2[s]):s}function Gm(s){return"string"==typeof s?Object.assign({},uu[s]):s}const mN={speech_low_quality:lu(16e3,!1),speech_standard:lu(32e3,!1,18),music_standard:lu(48e3,!1),standard_stereo:lu(48e3,!0,56),high_quality:lu(48e3,!1,128),high_quality_stereo:lu(48e3,!0,192)};function Wm(s){return"string"==typeof s?Object.assign({},mN[s]):s}const hu=[];function WT(s){return Cn(s,"mediaSource",["screen","window","application"]),!0}var ve,kt,jd,zm,qm,pu,Wa,fu,Kr,gp;(function(s){s.NEED_RENEGOTIATE="@need_renegotiate",s.NEED_REPLACE_TRACK="@need_replace_track",s.NEED_CLOSE="@need_close",s.NEED_ENABLE_TRACK="@need_enable_track",s.NEED_DISABLE_TRACK="@need_disable_track",s.NEED_SESSION_ID="@need_sid",s.SET_OPTIMIZATION_MODE="@set_optimization_mode",s.GET_STATS="@get_stats",s.GET_RTC_STATS="@get_rtc_stats",s.GET_LOW_VIDEO_TRACK="@get_low_video_track",s.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",s.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",s.NEED_MUTE_TRACK="@need_mute_track",s.NEED_UNMUTE_TRACK="@need_unmute_track"})(ve||(ve={})),function(s){s.SCREEN_TRACK="screen_track",s.CUSTOM_TRACK="custome_track",s.LOW_STREAM="low_stream"}(kt||(kt={})),function(s){s[s.HIGH_STREAM=0]="HIGH_STREAM",s[s.LOW_STREAM=1]="LOW_STREAM"}(jd||(jd={})),function(s){s[s.HIGH_STREAM=0]="HIGH_STREAM",s[s.LOW_STREAM=1]="LOW_STREAM"}(zm||(zm={})),function(s){s[s.DISABLE=0]="DISABLE",s[s.LOW_STREAM=1]="LOW_STREAM",s[s.AUDIO_ONLY=2]="AUDIO_ONLY"}(qm||(qm={})),function(s){s.TRANSCEIVER_UPDATED="transceiver-updated"}(pu||(pu={})),function(s){s.SOURCE_STATE_CHANGE="source-state-change",s.TRACK_ENDED="track-ended",s.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",s.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",s.CLOSED="closed"}(Wa||(Wa={})),function(s){s.FIRST_FRAME_DECODED="first-frame-decoded",s.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(fu||(fu={})),function(s){s.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",s.RECEIVE_TRACK_BUFFER="receive_track_buffer",s.ON_AUDIO_BUFFER="on_audio_buffer",s.UPDATE_SOURCE="update_source"}(Kr||(Kr={})),function(s){s.UPDATE_TRACK_SOURCE="update-track-source"}(gp||(gp={}));const zT={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},wn={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Hd={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},_N={uplinkNetworkQuality:0,downlinkNetworkQuality:0},gN={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var cr,yr,jc,Hc,Vi;(function(s){s.ON_TRACK="on_track",s.ON_NODE="on_node"})(cr||(cr={})),function(s){s.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",s.REQUEST_CONSTRAINTS="request_constraints"}(yr||(yr={})),function(s){s.IDLE="IDLE",s.INITING="INITING",s.INITEND="INITEND"}(jc||(jc={})),function(s){s.STATE_CHANGE="state_change",s.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",s.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",s.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(Hc||(Hc={})),function(s){s.NONE="none",s.INIT="init",s.CANPLAY="canplay",s.PLAYING="playing",s.PAUSED="paused",s.SUSPEND="suspend",s.STALLED="stalled",s.WAITING="waiting",s.ERROR="error",s.DESTROYED="destroyed",s.ABORT="abort",s.ENDED="ended",s.EMPTIED="emptied",s.LOADEDDATA="loadeddata"}(Vi||(Vi={}));const Km={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};var Ep;!function(s){s.OPEN="open",s.MESSAGE="message",s.CLOSE="close",s.CLOSING="closing",s.ERROR="error"}(Ep||(Ep={}));class Gc extends jt{constructor(i,r){super(),C(this,"_ID",void 0),C(this,"_rtpTransceiver",void 0),C(this,"_lowRtpTransceiver",void 0),C(this,"_hints",[]),C(this,"_isClosed",!1),C(this,"_originMediaStreamTrack",void 0),C(this,"_mediaStreamTrack",void 0),C(this,"_external",{}),this._ID=r||qe(8,"track-"),this._originMediaStreamTrack=i,this._mediaStreamTrack=i,ye(hu).call(hu,this)||hu.push(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(i){if(!i){Ie.reportApiInvoke(null,{name:qn.GET_MEDIA_STREAM_TRACK,options:[],tag:Kt.TRACER}).onSuccess(this._mediaStreamTrack&&"string"==typeof this._mediaStreamTrack.label?this._mediaStreamTrack.label:"")}return this._mediaStreamTrack}getRTCRtpTransceiver(i){return i===jd.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(i){const r=hu.indexOf(i);-1!==r&&hu.splice(r,1)}(this),this.emit(Wa.CLOSED)}_updateRtpTransceiver(i,r){if(r===jd.LOW_STREAM){if(this._lowRtpTransceiver===i)return;this._lowRtpTransceiver=i}else{if(this._rtpTransceiver===i)return;this._rtpTransceiver=i}this.emit(pu.TRANSCEIVER_UPDATED,i,r)}}class Bi extends Gc{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(i){this._processorContext=i}constructor(i,r){super(i,r),C(this,"_enabled",!0),C(this,"_muted",!1),C(this,"_isExternalTrack",!1),C(this,"_isClosed",!1),C(this,"_enabledMutex",void 0),C(this,"processor",void 0),C(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new gi("".concat(this.getTrackId())),i.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var i,r;return null!==(i=null===(r=this._originMediaStreamTrack)||void 0===r?void 0:r.label)&&void 0!==i?i:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,I.debug("[".concat(this.getTrackId(),"] close")),this.emit(ve.NEED_CLOSE),super.close())}_updateOriginMediaStreamTrack(i,r){var a=arguments,d=this;return L(function*(){d._isExternalTrack=a.length>2&&void 0!==a[2]&&a[2],i!==d._originMediaStreamTrack&&(d._originMediaStreamTrack&&(d._originMediaStreamTrack.removeEventListener("ended",d._handleTrackEnded),r&&d._originMediaStreamTrack.stop()),i.addEventListener("ended",d._handleTrackEnded),d._originMediaStreamTrack=i,d._muted&&(d._originMediaStreamTrack.enabled=!1),d._mediaStreamTrack=d._originMediaStreamTrack,d._updatePlayerSource(),yield Tt(d,ve.NEED_REPLACE_TRACK,d),d.processor&&d.processor.updateInput({track:d._originMediaStreamTrack,context:d.processorContext}))})()}_getDefaultPlayerConfig(){return{}}onTrackEnded(){I.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Wa.TRACK_ENDED)}stateCheck(i,r){if(I.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(i,": ").concat(r,"]")),Rc(r,i),this._enabled&&this._muted&&"enabled"===i&&!1===r)throw new ee(k.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",I);if(!this._enabled&&!this._muted&&"muted"===i&&!0===r)throw new ee(k.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",I)}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function EN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}const Ym=window.AudioContext||window.webkitAudioContext;let lo=null;const Ct=new class extends jt{constructor(){var s;super(...arguments),s=this,C(this,"prevState",void 0),C(this,"curState",void 0),C(this,"currentTime",void 0),C(this,"currentTimeStuckAt",void 0),C(this,"interruptDetectorTrack",void 0),C(this,"onLocalAudioTrackMute",()=>{I.info("ios15-interruption-start"),this.emit(ii.IOS_15_16_INTERRUPTION_START)}),C(this,"onLocalAudioTrackUnmute",L(function*(){I.info("ios15-interruption-end"),"running"!==s.curState||s.duringInterruption?I.info("ios15-interruption-end-canceled"):(lo&&(yield lo.suspend()),s.emit(ii.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(s){I.debug("webaudio bindInterruptDetectorTrack ".concat(s.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=s,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(s){I.debug("webaudio unbindInterruptDetectorTrack ".concat(s.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===s&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function mu(){if(!lo){if(function vN(){if(!Ym)return void I.error("your browser is not support web audio");I.info("create audio context");const s=function(i){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?EN(Object(a),!0).forEach(function(d){C(i,d,a[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):EN(Object(a)).forEach(function(d){Object.defineProperty(i,d,Object.getOwnPropertyDescriptor(a,d))})}return i}({},B("WEBAUDIO_INIT_OPTIONS"));var i;I.debug("audio context init option:",JSON.stringify(s)),lo=new Ym(s),Ct.curState=lo.state,lo.onstatechange=()=>{Ct.prevState=Ct.curState,Ct.curState=lo?lo.state:void 0;const{prevState:i,curState:r}=Ct,a="running"===r,d="interrupted"===r,l="running"===i,h="suspended"===i,f="interrupted"===i,_=lt().osVersion;(Pi()||Ic())&&l&&d&&(I.info("ios".concat(_,"-interruption-start")),Ct.emit(ii.IOS_INTERRUPTION_START)),(Pi()||Ic())&&(h||f)&&a&&(I.info("ios".concat(_,"-interruption-end")),Ct.emit(ii.IOS_INTERRUPTION_END)),i!==r&&Ct.emit(ii.STATE_CHANGE,r,i)},setInterval(()=>{var i;const r=null===(i=lo)||void 0===i?void 0:i.currentTime;Ct.currentTime!==r?(Ct.currentTimeStuckAt&&(I.debug("AudioContext current time resume at ".concat(r)),Ct.currentTimeStuckAt=void 0),Ct.currentTime=r):(r!==Ct.currentTimeStuckAt&&(Ie.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:r},tag:Kt.TRACER}).onSuccess(),I.warning("AudioContext current time stuck at ".concat(r))),Ct.currentTimeStuckAt=r)},5e3),(i=L(function*(r){const a=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let d,l=!1,h=!1,f=!1;function _(x){"running"===r.state?g(!1):Pi()||Ic()?"suspended"===r.state&&(g(!0),x&&r.resume().then(b,b)):"closed"!==r.state&&(g(!0),x&&r.resume().then(b,b))}function g(x){if(l!==x){l=x;for(let F=0,j=a;F<j.length;F+=1){const Y=j[F];x?window.addEventListener(Y,y,{capture:!0,passive:!0}):window.removeEventListener(Y,y,{capture:!0,passive:!0})}}}function b(){_(!1)}function y(){_(!0)}function T(x){if(!f)if(d.paused)if(x){let F;M(!1),f=!0;try{F=d.play(),F?F.then(O,O):(d.addEventListener("playing",O),d.addEventListener("abort",O),d.addEventListener("error",O))}catch{O()}}else M(!0);else M(!1)}function M(x){if(h!==x){h=x;for(let F=0,j=a;F<j.length;F++){const Y=j[F];x?window.addEventListener(Y,D,{capture:!0,passive:!0}):window.removeEventListener(Y,D,{capture:!0,passive:!0})}}}function O(){d.removeEventListener("playing",O),d.removeEventListener("abort",O),d.removeEventListener("error",O),f=!1,T(!1)}function D(){T(!0)}if(Pi()){const x=r.createMediaStreamDestination(),F=document.createElement("div");F.innerHTML="<audio x-webkit-airplay='deny'></audio>",d=F.children.item(0),d.controls=!1,d.disableRemotePlayback=!0,d.preload="auto",d.srcObject=x.stream,T(!0)}Ct.on(ii.STATE_CHANGE,function v(){_(!0)}),_(!1)}),function(r){return i.apply(this,arguments)})(lo)}(),!lo)throw new ee(k.NOT_SUPPORTED,"can not create audio context");return lo}return lo}function qT(){return!!lo}function Gd(s){if(function(){if(null!==KT)return KT;const a=mu(),d=a.createBufferSource(),l=a.createGain(),h=a.createGain();d.connect(l),d.connect(h),d.disconnect(l);let f=!1;try{d.disconnect(l)}catch{f=!0}return d.disconnect(),KT=f,f}())return;const i=s.connect,r=s.disconnect;s.connect=(a,d,l)=>{var h;return s._inputNodes||(s._inputNodes=[]),ye(h=s._inputNodes).call(h,a)||(a instanceof AudioNode?(s._inputNodes.push(a),i.call(s,a,d,l)):i.call(s,a,d)),s},s.disconnect=(a,d,l)=>{r.call(s),a?mm(s._inputNodes,a):s._inputNodes=[];for(const h of s._inputNodes)i.call(s,h)}}let KT=null;function YT(s,i){let r=!1;const a=1/i;if(B("DISABLE_WEBAUDIO")){const d=window.setInterval(()=>{r?window.clearInterval(d):s(performance.now()/1e3)},1e3*a)}else{const d=mu();let l=d.createGain();l.gain.value=0,l.connect(d.destination);const h=()=>{if(r)return void(l=null);const f=d.createOscillator();f.onended=h,f.connect(l),f.start(0),f.stop(d.currentTime+a),s(d.currentTime)};h()}return()=>{r=!0}}class bN{constructor(){C(this,"context",void 0),C(this,"analyserNode",void 0),C(this,"sourceNode",void 0),this.context=mu(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(i){if(i!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=i,i?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Pi()||Ic()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode))return 0;const i=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(i);else{const a=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(a);for(let d=0;d<i.length;++d)i[d]=a[d]/128-1}const r=Ba(i).call(i,(a,d)=>a+d*d,0)/i.length;return Math.max(10*Math.log10(r)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var i,r;null===(i=this.sourceNode)||void 0===i||i.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(r=this.sourceNode)||void 0===r||r.connect(this.analyserNode)}catch{I.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class yN extends jt{get processSourceNode(){return this.sourceNode}set processedNode(i){var r;if(!this.isDestroyed&&this._processedNode!==i){try{var a;null===(a=this.sourceNode)||void 0===a||a.disconnect(this.outputNode)}catch{}null===(r=this._processedNode)||void 0===r||r.disconnect(),this._processedNode=i,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),C(this,"outputNode",void 0),C(this,"outputTrack",void 0),C(this,"isPlayed",!1),C(this,"context",void 0),C(this,"audioBufferNode",void 0),C(this,"destNode",void 0),C(this,"audioOutputLevel",0),C(this,"volumeLevelAnalyser",void 0),C(this,"_processedNode",void 0),C(this,"playNode",void 0),C(this,"isDestroyed",!1),C(this,"onNoAudioInput",void 0),C(this,"isNoAudioInput",!1),C(this,"_noAudioInputCount",0),this.context=mu(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Gd(this.outputNode),this.volumeLevelAnalyser=new bN}startGetAudioBuffer(i){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(i),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=r=>{this.emit(Kr.ON_AUDIO_BUFFER,function(a){for(let d=0;d<a.outputBuffer.numberOfChannels;d+=1){const l=a.outputBuffer.getChannelData(d);for(let h=0;h<l.length;h+=1)l[h]=0}return a.inputBuffer}(r))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ot().webAudioMediaStreamDest)throw new ee(k.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(i){"running"!==this.context.state&&_m(()=>{Ct.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=i||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}checkHasAudioInput(){var i=arguments,r=this;return L(function*(){let a=i.length>0&&void 0!==i[0]?i[0]:0;if(a>5)return r.isNoAudioInput=!0,r.onNoAudioInput&&r.onNoAudioInput(),!1;Pi()||Ic()?"suspended"===r.context.state&&r.context.resume():"running"!==r.context.state&&r.context.resume();const d=r.volumeLevelAnalyser.getAnalyserNode();let l;d.getFloatTimeDomainData?(l=new Float32Array(d.fftSize),d.getFloatTimeDomainData(l)):(l=new Uint8Array(d.fftSize),d.getByteTimeDomainData(l));let h=!1;for(let f=0;f<l.length;f++)0!==l[f]&&(h=!0);return h?(r.isNoAudioInput=!1,!0):(yield Un(200),(yield r.checkHasAudioInput(a?a+1:1))&&h)})()}getAudioVolume(){return this.outputNode.gain.value}setVolume(i){this.outputNode.gain.setValueAtTime(i,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var i,r;null===(i=this.processedNode)||void 0===i||i.disconnect(),null===(r=this.sourceNode)||void 0===r||r.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var i;this.processedNode?null===(i=this.processedNode)||void 0===i||i.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class Uv extends yN{get isFreeze(){return!1}constructor(i,r,a){var d,l;if(super(),d=this,C(this,"sourceNode",void 0),C(this,"track",void 0),C(this,"clonedTrack",void 0),C(this,"audioElement",void 0),C(this,"isCurrentTrackCloned",!1),C(this,"isRemoteTrack",!1),C(this,"originVolumeLevelAnalyser",void 0),C(this,"rebuildWebAudio",L(function*(){if(I.debug("ready to rebuild web audio, state:",d.context.state),d.isNoAudioInput&&(yield d.checkHasAudioInput()),!d.isNoAudioInput||d.isDestroyed)return document.body.removeEventListener("click",d.rebuildWebAudio,!0),void I.debug("rebuild web audio success, current volume status",d.getAccurateVolumeLevel());d.context.resume().then(()=>I.info("resume success")),I.debug("rebuild web audio because of ios 12 bugs"),d.disconnect();const _=d.track;d.track=d.track.clone(),d.isCurrentTrackCloned?_.stop():d.isCurrentTrackCloned=!0;const g=new MediaStream([d.track]);d.sourceNode=d.context.createMediaStreamSource(g),Gd(d.sourceNode),d.volumeLevelAnalyser.rebuildAnalyser();const v=d.outputNode.gain.value;d.outputNode=d.context.createGain(),d.outputNode.gain.setValueAtTime(v,d.context.currentTime),Gd(d.outputNode),d.emit(Kr.UPDATE_SOURCE),d.connect(),d.audioElement.srcObject=g,d.isPlayed&&d.play(d.playNode),d.checkHasAudioInput()})),"audio"!==i.kind)throw new ee(k.UNEXPECTED_ERROR);this.track=i;const h=new MediaStream([this.track]);if(this.isRemoteTrack=!!r,this.sourceNode=this.context.createMediaStreamSource(h),Gd(this.sourceNode),a){const _=a.clone();_.enabled=!0,this.clonedTrack=_,I.debug("create an unmuted track ".concat(_.id," from the original track ").concat(a.id," to get the volume"));const g=this.context.createMediaStreamSource(new MediaStream([_]));Gd(g),this.originVolumeLevelAnalyser=new bN,this.originVolumeLevelAnalyser.updateSource(g)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=h;const f=lt();r&&f.os===Zn.IOS&&Number(null===(l=f.osVersion)||void 0===l?void 0:l.split(".")[0])<15&&(Ct.on(ii.STATE_CHANGE,()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(_=>{_||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(i){this.sourceNode.disconnect(),this.track=i,this.isCurrentTrackCloned=!1;const r=new MediaStream([i]);this.sourceNode=this.context.createMediaStreamSource(r),Gd(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Kr.UPDATE_SOURCE),this.audioElement.srcObject=r}destroy(){var i;this.audioElement.srcObject=null,this.audioElement.remove(),Ct.off("state-change",this.rebuildWebAudio),null===(i=this.originVolumeLevelAnalyser)||void 0===i||i.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(i){return this.context.createMediaStreamSource(new MediaStream([i]))}updateOriginTrack(i){const r=i.clone();r.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=r),I.debug("create an unmuted track ".concat(r.id," from the original track ").concat(i.id," to get the volume"));const a=this.context.createMediaStreamSource(new MediaStream([r]));Gd(a),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(a)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}function b2(s,i,r){return Vv.apply(this,arguments)}function Vv(){return Vv=L(function*(s,i,r){const a=(l,h)=>l?"number"!=typeof l?l.max||l.exact||l.ideal||l.min||h:l:h,d={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxHeight:a(i.height,1080),maxWidth:a(i.width,1920)}}};return i.frameRate&&"number"!=typeof i.frameRate?(d.video.mandatory.maxFrameRate=i.frameRate.max,d.video.mandatory.minFrameRate=i.frameRate.min):"number"==typeof i.frameRate&&(d.video.mandatory.maxFrameRate=i.frameRate),yield navigator.mediaDevices.getUserMedia(d)}),Vv.apply(this,arguments)}function $T(){return $T=L(function*(s,i){const r=yield S2(s.mediaSource),{sourceId:a,audio:d}=yield function(l){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new X((f,_)=>{const g=document.createElement("div");g.innerText="share screen",g.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const v=document.createElement("div");v.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const b=document.createElement("div");b.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",b.setAttribute("style","height: 12%;");const y=document.createElement("div");y.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const T=document.createElement("div");T.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const M=document.createElement("button");M.innerHTML="cancel",M.setAttribute("style","width: 85px;"),M.onclick=()=>{document.body.removeChild(x);const F=new Error("NotAllowedError");F.name="NotAllowedError",_(F)};let O=h;const D=document.createElement("div");if(h){const F=document.createElement("input");F.setAttribute("type","checkbox");const j=document.createElement("span");F.setAttribute("style","margin-right: 6px;"),j.innerText="Share audio",F.checked=O,F.onchange=()=>{O=F.checked},D.appendChild(F),D.appendChild(j)}T.appendChild(D),T.appendChild(M),v.appendChild(b),v.appendChild(y),v.appendChild(T);const x=document.createElement("div");x.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),x.appendChild(g),x.appendChild(v),document.body.appendChild(x),l.map(F=>{if(F.id){const j=document.createElement("div");j.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Y=F.thumbnail;try{const{width:te}=Y.getSize();te>1920&&(Y=Y.resize({width:1920}))}catch(te){throw te&&te.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),te}j.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Y.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+F.name.replace(/[\u00A0-\u9999<>\&]/g,function(te){return"&#"+te.charCodeAt(0)+";"})+"</span>",j.onclick=()=>{document.body.removeChild(x),f({sourceId:F.id,audio:O})},y.appendChild(j)}})})}(r,i);return yield b2(a,s,d)}),$T.apply(this,arguments)}function S2(s){return XT.apply(this,arguments)}function XT(){return XT=L(function*(s){let i=["window","screen"];"application"!==s&&"window"!==s||(i=["window"]),"screen"===s&&(i=["screen"]);const r=LD();if(!r)throw console.error("failed to fetch electron, please mount it to window"),new ee(k.ELECTRON_IS_NULL);let a=null;try{var d;a=(null===(d=r.desktopCapturer)||void 0===d?void 0:d.getSources({types:i}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:i})}catch{a=null}a&&a.then||(a=new X((l,h)=>{r.desktopCapturer.getSources({types:i},(f,_)=>{f?h(f):l(_)})}));try{return yield a}catch(l){throw new ee(k.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,l.toString())}}),XT.apply(this,arguments)}function JT(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}const vp=new gi("safari");let C2=!1,T2=!1;function xo(s,i){return QT.apply(this,arguments)}function QT(){return QT=L(function*(s,i){let r=0,a=null;for(;r<2;)try{a=yield I2(s,i,r>0);break}catch(d){if(d instanceof ee)throw I.error("[".concat(i,"] ").concat(d.toString())),d;const l=Bv(d.name||d.code||d,d.message);if(l.code===k.MEDIA_OPTION_INVALID){I.debug("[".concat(i,"] detect media option invalid, retry")),r+=1,yield Un(500);continue}throw I.error("[".concat(i,"] ").concat(l.toString())),l}if(!a)throw new ee(k.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return a}),QT.apply(this,arguments)}function I2(s,i,r){return ZT.apply(this,arguments)}function ZT(){return ZT=L(function*(s,i,r){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new ee(k.NOT_SUPPORTED,"can not find getUserMedia");r&&(s.video&&(delete s.video.width,delete s.video.height),s.screen&&(delete s.screen.width,delete s.screen.height));const a=Ot(),d=new MediaStream;if(s.audioSource&&d.addTrack(s.audioSource),s.videoSource&&d.addTrack(s.videoSource),!s.audio&&!s.video&&!s.screen)return I.debug("Using Video Source/ Audio Source"),d;if(s.screen)if(LD())_u(d,s.screen.sourceId?yield b2(s.screen.sourceId,s.screen,s.screenAudio):yield function y2(s,i){return $T.apply(this,arguments)}(s.screen,s.screenAudio));else if(um()&&s.screen.extensionId&&s.screen.mandatory){if(!a.getStreamFromExtension)throw new ee(k.NOT_SUPPORTED,"This browser does not support screen sharing");I.debug("[".concat(i,'] Screen access on chrome stable, looking for extension"'));const y=yield(h=s.screen.extensionId,f=i,new X((T,M)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},O=>{if(!O||!O.streamId)return I.error("[".concat(f,"] No response from Chrome Plugin. Plugin not installed properly"),O),void M(new ee(k.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));T(O.streamId)})}catch(O){I.error("[".concat(f,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),O.toString()),M(new ee(k.CHROME_PLUGIN_NOT_INSTALL))}}));s.screen.mandatory.chromeMediaSourceId=y,_u(d,yield navigator.mediaDevices.getUserMedia({video:{mandatory:s.screen.mandatory}}))}else if(a.getDisplayMedia){var l;s.screen.mediaSource&&WT(s.screen.mediaSource);const y={width:s.screen.width,height:s.screen.height,frameRate:s.screen.frameRate,displaySurface:null!==(l=s.screen.displaySurface)&&void 0!==l?l:"screen"===s.screen.mediaSource?"monitor":s.screen.mediaSource},{selfBrowserSurface:T,surfaceSwitching:M,systemAudio:O}=s.screen,D={selfBrowserSurface:T,surfaceSwitching:M,systemAudio:O};!T&&delete D.selfBrowserSurface,!M&&delete D.surfaceSwitching,!O&&delete D.systemAudio,I.debug("[".concat(i,"] getDisplayMedia:"),JSON.stringify({video:y,audio:!!s.screenAudio,controls:D}));const x=yield navigator.mediaDevices.getDisplayMedia(function(F){for(var j=1;j<arguments.length;j++){var Y=null!=arguments[j]?arguments[j]:{};j%2?JT(Object(Y),!0).forEach(function(te){C(F,te,Y[te])}):Object.getOwnPropertyDescriptors?Object.defineProperties(F,Object.getOwnPropertyDescriptors(Y)):JT(Object(Y)).forEach(function(te){Object.defineProperty(F,te,Object.getOwnPropertyDescriptor(Y,te))})}return F}({video:y,audio:!!s.screenAudio},D));_u(d,x)}else{if(!Pt())throw I.error("[".concat(i,"] This browser does not support screenSharing")),new ee(k.NOT_SUPPORTED,"This browser does not support screen sharing");{s.screen.mediaSource&&WT(s.screen.mediaSource);const y={video:{mediaSource:s.screen.mediaSource,width:s.screen.width,height:s.screen.height,frameRate:s.screen.frameRate}};I.debug("[".concat(i,"] getUserMedia: ").concat(JSON.stringify(y))),_u(d,yield navigator.mediaDevices.getUserMedia(y))}}var h,f;if(!s.video&&!s.audio)return d;let _={video:s.video,audio:s.audio},g=B("MEDIA_DEVICE_CONSTRAINTS");if(g)try{"string"==typeof g&&(g=JSON.parse(g)),_=QE(_,g)}catch{}I.debug("[".concat(i,"] GetUserMedia"),JSON.stringify(_)),lt();let v,b=null;(fr()||Pi()||KE())&&(b=yield vp.lock());try{v=yield navigator.mediaDevices.getUserMedia(_)}catch(y){throw b&&b(),y}return _.audio&&(C2=!0),_.video&&(T2=!0),_u(d,v),b&&b(),d}),ZT.apply(this,arguments)}function Bv(s,i){switch(s){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new ee(k.MEDIA_OPTION_INVALID,"".concat(s,": ").concat(i));case"NotFoundError":case"DevicesNotFoundError":return new ee(k.DEVICE_NOT_FOUND,"".concat(s,": ").concat(i));case"NotSupportedError":return new ee(k.NOT_SUPPORTED,"".concat(s,": ").concat(i));case"NotReadableError":return new ee(k.NOT_READABLE,"".concat(s,": ").concat(i));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new ee(k.PERMISSION_DENIED,"".concat(s,": ").concat(i));case"ConstraintNotSatisfiedError":return new ee(k.CONSTRAINT_NOT_SATISFIED,"".concat(s,": ").concat(i));default:return I.error("getUserMedia unexpected error",s),new ee(k.UNEXPECTED_ERROR,"".concat(s,": ").concat(i))}}function _u(s,i){const r=s.getVideoTracks()[0],a=s.getAudioTracks()[0],d=i.getVideoTracks()[0],l=i.getAudioTracks()[0];l&&(a&&s.removeTrack(a),s.addTrack(l)),d&&(r&&s.removeTrack(r),s.addTrack(d))}const ko=new class extends jt{get state(){return this._state}set state(s){s!==this._state&&(this.emit(Hc.STATE_CHANGE,s),this._state=s)}constructor(){super(),C(this,"_state",jc.IDLE),C(this,"isAccessMicrophonePermission",!1),C(this,"isAccessCameraPermission",!1),C(this,"lastAccessMicrophonePermission",!1),C(this,"lastAccessCameraPermission",!1),C(this,"checkdeviceMatched",!1),C(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(B("ENUMERATE_DEVICES_INTERVAL")||(Kh()||qE()===Zn.HARMONY_OS)&&Rd())&&this.updateDevicesInfo()},B("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(s=>I.error(s.toString()))}enumerateDevices(s,i){var r=arguments,a=this;return L(function*(){let d=r.length>2&&void 0!==r[2]&&r[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new ee(k.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const l=yield navigator.mediaDevices.enumerateDevices(),h=a.checkMediaDeviceInfoIsOk(l);let f=!a.isAccessMicrophonePermission&&s,_=!a.isAccessCameraPermission&&i;h.audio&&(f=!1),h.video&&(_=!1);let g=null,v=null,b=null;if(!d&&(f||_)){if(vp.isLocked&&(I.debug("[device manager] wait GUM lock"),(yield vp.lock())(),I.debug("[device manager] GUM unlock")),C2&&(f=!1,a.isAccessMicrophonePermission=!0),T2&&(_=!1,a.isAccessCameraPermission=!0),I.debug("[device manager] check media device permissions",s,i,f,_),f&&_){try{b=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(y){const T=Bv(y.name||y.code||y,y.message);if(T.code===k.PERMISSION_DENIED)throw T;I.warning("getUserMedia failed in getDevices",T)}a.isAccessCameraPermission=!0,a.isAccessMicrophonePermission=!0}else if(f){try{g=yield navigator.mediaDevices.getUserMedia({audio:s})}catch(y){const T=Bv(y.name||y.code||y,y.message);if(T.code===k.PERMISSION_DENIED)throw T;I.warning("getUserMedia failed in getDevices",T)}a.isAccessMicrophonePermission=!0}else if(_){try{v=yield navigator.mediaDevices.getUserMedia({video:i})}catch(y){const T=Bv(y.name||y.code||y,y.message);if(T.code===k.PERMISSION_DENIED)throw T;I.warning("getUserMedia failed in getDevices",T)}a.isAccessCameraPermission=!0}I.debug("[device manager] mic permission",s,"cam permission",i)}try{const y=yield navigator.mediaDevices.enumerateDevices();return g&&g.getTracks().forEach(T=>T.stop()),v&&v.getTracks().forEach(T=>T.stop()),b&&b.getTracks().forEach(T=>T.stop()),g=null,v=null,b=null,y}catch(y){return g&&g.getTracks().forEach(T=>T.stop()),v&&v.getTracks().forEach(T=>T.stop()),b&&b.getTracks().forEach(T=>T.stop()),g=null,v=null,b=null,new ee(k.ENUMERATE_DEVICES_FAILED,y.toString()).throw()}})()}getRecordingDevices(){var s=arguments,i=this;return L(function*(){let r=s.length>0&&void 0!==s[0]&&s[0];return(yield i.enumerateDevices(!0,!1,r)).filter(a=>"audioinput"===a.kind)})()}getCamerasDevices(){var s=arguments,i=this;return L(function*(){let r=s.length>0&&void 0!==s[0]&&s[0];return(yield i.enumerateDevices(!1,!0,r)).filter(a=>"videoinput"===a.kind)})()}getSpeakers(){var s=arguments,i=this;return L(function*(){let r=s.length>0&&void 0!==s[0]&&s[0];return(yield i.enumerateDevices(!0,!1,r)).filter(a=>"audiooutput"===a.kind)})()}searchDeviceIdByName(s){let i=null;return this.deviceInfoMap.forEach(r=>{r.device.label===s&&(i=r.device.deviceId)}),i}getDeviceById(s){var i=this;return L(function*(){const r=(yield i.enumerateDevices(!0,!0,!0)).find(a=>a.deviceId===s);if(!r)throw new ee(k.DEVICE_NOT_FOUND,"deviceId: ".concat(s));return r})()}init(){var s=this;return L(function*(){s.state=jc.INITING;try{yield s.updateDevicesInfo(),s.state=jc.INITEND}catch(i){throw I.warning("Device Detection functionality cannot start properly.",i.toString()),s.state=jc.IDLE,!("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)&&new ee(k.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),i}})()}updateDevicesInfo(){var s=this;return L(function*(){const i=yield s.enumerateDevices(!0,!0,!0),r=Date.now(),a=[];if(i[0]&&i[0].label&&!1===s.checkdeviceMatched){s.checkdeviceMatched=!0;const l=i.find(f=>"audioinput"===f.kind&&"default"===f.deviceId),h=i.find(f=>"audiooutput"===f.kind&&"default"===f.deviceId);l&&h?h.groupId===l.groupId?I.debug("[device-check] default input ".concat(l.label," and output ").concat(h.label," is the same group")):I.warning("[device-check] default input ".concat(l.label," and output ").concat(h.label," is not the same group")):I.debug("[device-check] default input or output not found")}const d=s.checkMediaDeviceInfoIsOk(i);if(i.forEach(l=>{if(!l.deviceId)return;const h=s.deviceInfoMap.get("".concat(l.kind,"_").concat(l.deviceId));if("ACTIVE"!==(h?h.state:"INACTIVE")){const f={initAt:r,updateAt:r,device:l,state:"ACTIVE"};s.deviceInfoMap.set("".concat(l.kind,"_").concat(l.deviceId),f),a.push(f)}h&&(h.updateAt=r)}),s.deviceInfoMap.forEach((l,h)=>{"ACTIVE"===l.state&&l.updateAt!==r&&(l.state="INACTIVE",a.push(l))}),s.state!==jc.INITEND)return d.audio&&(s.lastAccessMicrophonePermission=!0,s.isAccessMicrophonePermission=!0),void(d.video&&(s.lastAccessCameraPermission=!0,s.isAccessCameraPermission=!0));a.forEach(l=>{switch(l.device.kind){case"audioinput":s.lastAccessMicrophonePermission&&s.isAccessMicrophonePermission&&s.emit(Hc.RECORDING_DEVICE_CHANGED,l);break;case"videoinput":s.lastAccessCameraPermission&&s.isAccessCameraPermission&&s.emit(Hc.CAMERA_DEVICE_CHANGED,l);break;case"audiooutput":s.lastAccessMicrophonePermission&&s.isAccessMicrophonePermission&&s.emit(Hc.PLAYOUT_DEVICE_CHANGED,l)}}),d.audio&&(s.lastAccessMicrophonePermission=!0,s.isAccessMicrophonePermission=!0),d.video&&(s.lastAccessCameraPermission=!0,s.isAccessCameraPermission=!0)})()}checkMediaDeviceInfoIsOk(s){const i=s.filter(d=>"audioinput"===d.kind),r=s.filter(d=>"videoinput"===d.kind),a={audio:!1,video:!1};for(const d of i)if(d.label&&d.deviceId){a.audio=!0;break}for(const d of r)if(d.label&&d.deviceId){a.video=!0;break}return a}};let e0=!1;const Lo=new class extends jt{constructor(){super(...arguments),C(this,"onAutoplayFailed",void 0),C(this,"onAudioAutoplayFailed",void 0)}};function SN(){if(lt(),!e0){const s=i=>{i.preventDefault(),e0=!1,wc()?document.body.removeEventListener("click",s,!0):(document.body.removeEventListener("touchstart",s,!0),document.body.removeEventListener("mousedown",s,!0))};e0=!0,wc()?document.body.addEventListener("click",s,!0):(document.body.addEventListener("touchstart",s,!0),document.body.addEventListener("mousedown",s,!0)),I.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Lo.onAutoplayFailed?Lo.onAutoplayFailed():I.warning(Lo.onAudioAutoplayFailed?"AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .":"We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),Lo.emit("autoplay-failed")}}function CN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function bp(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?CN(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):CN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function t0(s,i,r,a){if(!s)return;const d=Ie.getBaseInfoBySessionId(s);if(!d)return;const l=d.info,h=Date.now(),f=bp(bp({},l),{},{vid:void 0===l.vid?0:Number(l.vid),lts:h,elapse:h-d.startTime,cbRegistered:Lo.onAutoplayFailed||Lo.onAudioAutoplayFailed?1:-1,errorMsg:r,mediaType:i,trackId:a,extend:void 0});Ie.send({type:Gt.AUTOPLAY_FAILED,data:f},!0)}const TN=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],xr=new class{constructor(){C(this,"onAutoplayFailed",void 0),C(this,"elementMap",new Map),C(this,"elementStateMap",new Map),C(this,"elementsNeedToResume",[]),C(this,"sinkIdMap",new Map),C(this,"autoResumeAfterInterruption",s=>{Array.from(this.elementMap.entries()).forEach(i=>{let[r,a]=i;const d=this.elementStateMap.get(r),l=a.srcObject.getAudioTracks()[0],h=l&&l.readyState;if(I.debug("resume after interrupted, ele: ".concat(d," audio: ").concat(h," ").concat(s)),"live"===h){if(s)return a.pause(),void a.play();if("running"===Ct.curState)return qh()?(a.pause(),void a.play()):void(d&&"paused"===d&&a.play())}})}),C(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(s=>{let[i,r]=s;const a=r.srcObject.getAudioTracks()[0];a&&"live"===a.readyState&&(I.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r.pause(),r.play())})}),this.autoResumeAudioElement(),Ct.on(ii.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ct.on(ii.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Ct.on(ii.STATE_CHANGE,()=>{Pi()&&"suspended"===Ct.prevState&&"running"===Ct.curState&&this.autoResumeAfterInterruption()})}setSinkID(s,i){var r=this;return L(function*(){const a=r.elementMap.get(s);if(r.sinkIdMap.set(s,i),a)try{yield a.setSinkId(i)}catch(d){throw new ee(k.PERMISSION_DENIED,"can not set sink id: "+d.toString())}})()}play(s,i,r,a){if(this.elementMap.has(i))return;const d=document.createElement("audio");d.autoplay=!0,d.srcObject=new MediaStream([s]),this.bindAudioElementEvents(i,d),this.elementMap.set(i,d),this.elementStateMap.set(i,Vi.INIT),this.setVolume(i,r);const l=this.sinkIdMap.get(i);if(l)try{d.setSinkId(l).catch(f=>{I.warning("[".concat(i,"] set sink id failed"),f.toString())})}catch(f){I.warning("[".concat(i,"] set sink id failed"),f.toString())}const h=d.play();h&&h.then&&h.catch(f=>{a&&t0(a,"audio",f.message,i),I.warning("audio element play warning",f.toString()),this.elementMap.has(i)&&"NotAllowedError"===f.name&&(I.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(d),_m(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),SN()}))})}updateTrack(s,i){const r=this.elementMap.get(s);r&&(r.srcObject=new MediaStream([i]))}isPlaying(s){return this.elementMap.has(s)&&"playing"===this.elementStateMap.get(s)}setVolume(s,i){const r=this.elementMap.get(s);r&&(i=Math.max(0,Math.min(100,i)),r.volume=i/100)}stop(s){const i=this.elementMap.get(s);if(this.sinkIdMap.delete(s),!i)return;const r=this.elementsNeedToResume.indexOf(i);this.elementsNeedToResume.splice(r,1),i.srcObject=null,i.remove(),this.elementMap.delete(s),this.elementStateMap.delete(s)}bindAudioElementEvents(s,i){TN.forEach(r=>{i.addEventListener(r,a=>{const d=this.elementStateMap.get(s),l="pause"===a.type?"paused":a.type;if(I.debug("[".concat(s,"] audio-element-status change ").concat(d," => ").concat(l)),"error"===a.type){const h=i?.error;h&&I.error("[".concat(s,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(s,l)})})}getPlayerState(s){return this.elementStateMap.get(s)||"uninit"}autoResumeAudioElement(){const s=()=>{this.elementsNeedToResume.forEach(i=>{i.play().then(r=>{I.debug("Auto resume audio element success")}).catch(r=>{I.warning("Auto resume audio element failed!",r)})}),this.elementsNeedToResume=[]};new X(i=>{document.body?i():window.addEventListener("load",()=>i())}).then(()=>{wc()?document.body.addEventListener("click",s,!0):(document.body.addEventListener("touchstart",s,!0),document.body.addEventListener("mousedown",s,!0))})}};function gn(){return function(s,i,r){const a=r.value;return"function"==typeof a&&(r.value=function(){this._isClosed&&new ee(k.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",I);for(var d=arguments.length,l=new Array(d),h=0;h<d;h++)l[h]=arguments[h];const f=a.apply(this,l);return f instanceof X?new X((_,g)=>{f.then(_).catch(g)}):f}),r}}function n0(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function gu(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?n0(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):n0(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class IN extends jt{constructor(i){super(),C(this,"name","VideoProcessorDestination"),C(this,"ID","0"),C(this,"_source",void 0),C(this,"videoContext",void 0),C(this,"inputTrack",void 0),this.videoContext=i}get kind(){return"video"}get enabled(){return!0}pipe(){throw new ee(k.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new ee(k.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(i){if(i.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");i.track&&i.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=i.track,this.emit(cr.ON_TRACK,i.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(cr.ON_TRACK,void 0)}}class w2 extends jt{set chained(i){this._chained=i}get chained(){return this._chained}constructor(i,r){super(),C(this,"constraintsMap",new Map),C(this,"statsRegistry",[]),C(this,"usageRegistry",[]),C(this,"trackId",void 0),C(this,"direction",void 0),C(this,"_chained",!1),this.trackId=i,this.direction=r}getConstraints(){var i=this;return L(function*(){return yield nn(i,yr.REQUEST_CONSTRAINTS)})()}requestApplyConstraints(i,r){var a=this;return L(function*(){var d;return I.info("processor ".concat(r.name," requestApplyConstraints for ").concat(a.trackId)),i&&a.constraintsMap.set(r,i),Tt(a,yr.REQUEST_UPDATE_CONSTRAINTS,Array.from(ca(d=a.constraintsMap).call(d)))})()}requestRevertConstraints(i){var r=this;return L(function*(){var a;if(r.constraintsMap.has(i))return I.info("processor ".concat(i.name," requestRevertConstraints for ").concat(r.trackId)),r.constraintsMap.delete(i),Tt(r,yr.REQUEST_UPDATE_CONSTRAINTS,Array.from(ca(a=r.constraintsMap).call(a)))})()}registerStats(i,r,a){this.statsRegistry.find(d=>d.processorID===i.ID&&d.processorName===i.name&&d.type===r)||this.statsRegistry.push({processorName:i.name,processorID:i.ID,type:r,cb:a})}unregisterStats(i,r){const a=this.statsRegistry.findIndex(d=>d.processorID===i.ID&&d.processorName===i.name&&d.type===r);-1!==a&&this.statsRegistry.splice(a,1)}gatherStats(){const i=[];for(const{processorID:r,processorName:a,type:d,cb:l}of this.statsRegistry)try{const h=l();i.push({processorID:r,processorName:a,type:d,stats:h})}catch(h){I.error(new ee(k.UNEXPECTED_ERROR,h.message))}return i}registerUsage(i,r){this.usageRegistry.find(a=>a.processorID===i.ID&&a.processorName===i.name)||this.usageRegistry.push({processorID:i.ID,processorName:i.name,cb:r})}unregisterUsage(i){const r=this.usageRegistry.findIndex(a=>a.processorID===i.ID&&a.processorName===i.name);-1!==r&&this.usageRegistry.splice(r,1)}gatherUsage(){var i=this;return L(function*(){const r=[];if(!i.chained)return[];for(const{cb:a}of i.usageRegistry)try{let d=a();d instanceof X&&(d=yield d),r.push(gu(gu({},d),{},{direction:i.direction}))}catch(d){I.error("gather extension usage error",d)}return r})()}getDirection(){return this.direction}}class r0 extends jt{constructor(i){super(),C(this,"name","AudioProcessorDestination"),C(this,"ID","0"),C(this,"inputTrack",void 0),C(this,"inputNode",void 0),C(this,"audioProcessorContext",void 0),C(this,"_source",void 0),this.audioProcessorContext=i}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new ee(k.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new ee(k.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(cr.ON_TRACK,void 0),this.emit(cr.ON_NODE,void 0)}updateInput(i){if(i.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");i.track&&this.inputTrack!==i.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=i.track,this.emit(cr.ON_TRACK,this.inputTrack)),i.node&&this.inputNode!==i.node&&(this.audioProcessorContext.chained=!0,this.inputNode=i.node,this.emit(cr.ON_NODE,this.inputNode))}}class Eu extends jt{set chained(i){this._chained=i}get chained(){return this._chained}constructor(i,r,a){super(),C(this,"constraintsMap",new Map),C(this,"statsRegistry",[]),C(this,"audioContext",void 0),C(this,"trackId",void 0),C(this,"direction",void 0),C(this,"usageRegistry",[]),C(this,"_chained",!1),this.audioContext=i,this.trackId=r,this.direction=a}getConstraints(){var i=this;return L(function*(){return nn(i,yr.REQUEST_CONSTRAINTS)})()}getAudioContext(){return this.audioContext}requestApplyConstraints(i,r){var a=this;return L(function*(){var d;return I.info("processor ".concat(r.name," requestApplyConstraints for ").concat(a.trackId)),i&&a.constraintsMap.set(r,i),Tt(a,yr.REQUEST_UPDATE_CONSTRAINTS,Array.from(ca(d=a.constraintsMap).call(d)))})()}requestRevertConstraints(i){var r=this;return L(function*(){var a;if(r.constraintsMap.has(i))return r.constraintsMap.delete(i),Tt(r,yr.REQUEST_UPDATE_CONSTRAINTS,Array.from(ca(a=r.constraintsMap).call(a)))})()}registerStats(i,r,a){this.statsRegistry.find(d=>d.processorID===i.ID&&d.processorName===i.name&&d.type===r)||this.statsRegistry.push({processorName:i.name,processorID:i.ID,type:r,cb:a})}unregisterStats(i,r){const a=this.statsRegistry.findIndex(d=>d.processorID===i.ID&&d.processorName===i.name&&d.type===r);-1!==a&&this.statsRegistry.splice(a,1)}gatherStats(){const i=[];for(const{processorID:r,processorName:a,type:d,cb:l}of this.statsRegistry)try{const h=l();i.push({processorID:r,processorName:a,type:d,stats:h})}catch(h){I.error(new ee(k.UNEXPECTED_ERROR,h.message))}return i}registerUsage(i,r){this.usageRegistry.find(a=>a.processorID===i.ID&&a.processorName===i.name)||this.usageRegistry.push({processorID:i.ID,processorName:i.name,cb:r})}unregisterUsage(i){const r=this.usageRegistry.findIndex(a=>a.processorID===i.ID&&a.processorName===i.name);-1!==r&&this.usageRegistry.splice(r,1)}gatherUsage(){var i=this;return L(function*(){const r=[];if(!i.chained)return[];for(const{cb:a}of i.usageRegistry)try{let d=a();d instanceof X&&(d=yield d),r.push(gu(gu({},d),{},{direction:i.direction}))}catch(d){I.error("gather extension usage error",d)}return r})()}getDirection(){return this.direction}}class o0 extends jt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),C(this,"context",void 0),C(this,"processSourceNode",void 0),C(this,"outputTrack",void 0),C(this,"processedNode",void 0),C(this,"clonedTrack",void 0),C(this,"outputNode",void 0),this.outputNode=new R2}setVolume(){}createOutputTrack(){throw new ee(k.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class R2{disconnect(){}connect(){}}let yp=null;class A2{constructor(){C(this,"state","open"),C(this,"trigger",void 0),C(this,"tasks",[]),I.debug("[macro-task-queue] is created."),this.trigger=window.setTimeout(()=>{this.state="closed",I.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map(i=>i.key),"]")),this.trigger=void 0,this.tasks.forEach(i=>{let{func:r}=i;return r()}),this.tasks.length=0,I.debug("[macro-task-queue] is closed.")})}enqueue(i,r){"closed"!==this.state&&(this.tasks.push({key:i,func:r}),I.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof i?i:"")))}runTask(i){if("closed"===this.state)return;const r=this.tasks.findIndex(a=>a.key===i);if(-1!==r){const a=this.tasks.splice(r,1);I.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof i?i:"")),a[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,I.debug("[macro-task-queue] is closed."))}}function vu(s){return function(i,r,a){var d;const l=null!==(d=a.value)&&void 0!==d?d:a.get,h=function(){yp&&"open"===yp.state&&yp.runTask(s);for(var f=arguments.length,_=new Array(f),g=0;g<f;g++)_[g]=arguments[g];return l?.apply(this,..._)};return a.value?a.value=h:a.get=h,a}}function jv(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function s0(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?jv(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):jv(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class Et extends Bi{get _source(){return this._trackSource}set _source(i){this._trackSource=i}get processorContext(){return this._processorContext}set processorContext(i){this._processorContext=i}get processorDestination(){return this._processorDestination}set processorDestination(i){this._processorDestination=i}get isPlaying(){return this._useAudioElement?xr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(i,r,a,d,l){super(i,a),C(this,"trackMediaType","audio"),C(this,"_encoderConfig",void 0),C(this,"_trackSource",void 0),C(this,"_enabled",!0),C(this,"_volume",100),C(this,"_useAudioElement",!1),C(this,"_bypassWebAudio",!1),C(this,"processor",void 0),C(this,"_processorContext",void 0),C(this,"_processorDestination",void 0),C(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!d;const h=()=>{this.processorContext=new Eu(this._source.context,this.getTrackId(),"local"),this.processorDestination=new r0(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Kr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})},f=l&&fr()&&!qT();B("DISABLE_WEBAUDIO")?(this._source=new o0,this._useAudioElement=!0,this._bypassWebAudio=!0):f?this._source=new o0:(this._source=new Uv(i,!1,this._getOriginVolumeLevel?i:void 0),B("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),h(),!B("DISABLE_WEBAUDIO")&&f&&(yp||(yp=new A2),yp).enqueue("INIT_WEBAUDIO",()=>{this._source=new Uv(i,!1,this._getOriginVolumeLevel?i:void 0),B("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),h(),this.emit(gp.UPDATE_TRACK_SOURCE)})}setVolume(i){At(i,"volume",0,1e3),this._volume=i,this._source.setVolume(i/100),this._useAudioElement&&xr.setVolume(this.getTrackId(),i);try{if(this._bypassWebAudio)return void I.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,Tt(this,ve.NEED_REPLACE_TRACK,this).then(()=>{I.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(a=>{I.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),a)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}setPlaybackDevice(i){var r=this;return L(function*(){if(!r._useAudioElement||!um()&&B("RESTRICTION_SET_PLAYBACK_DEVICE"))throw new ee(k.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield xr.setSinkID(r.getTrackId(),i)})()}setEnabled(i,r,a){var d=this;return L(function*(){return d._setEnabled(i,r,a)})()}_setEnabled(i,r,a){var d=this;return L(function*(){if(!a){if(i===d._enabled)return;d.stateCheck("enabled",i)}if(I.info("[".concat(d.getTrackId(),"] start setEnabled"),i),i){d._originMediaStreamTrack.enabled=!0;try{a||(d._enabled=!0),yield Tt(d,ve.NEED_ENABLE_TRACK,d),I.info("[".concat(d.getTrackId(),"] setEnabled to ").concat(i," success"))}catch(l){throw a||(d._enabled=!1),I.error("[".concat(d.getTrackId(),"] setEnabled to true error"),l.toString()),l}}else{d._originMediaStreamTrack.enabled=!1,a||(d._enabled=!1);try{yield Tt(d,ve.NEED_DISABLE_TRACK,d)}catch(l){throw a||(d._enabled=!0),I.error("[".concat(d.getTrackId(),"] setEnabled to false error"),l.toString()),l}}})()}setMuted(i){var r=this;return L(function*(){i!==r._muted&&(r.stateCheck("muted",i),r._muted=i,r._originMediaStreamTrack.enabled=!i,I.debug("[".concat(r.getTrackId(),"] start set muted: ").concat(i)),i?yield Tt(r,ve.NEED_MUTE_TRACK,r):yield Tt(r,ve.NEED_UNMUTE_TRACK,r))})()}getStats(){return Jh(()=>{I.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Mr(this,ve.GET_STATS)||s0({},zT)}setAudioFrameCallback(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!i)return this._source.removeAllListeners(Kr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Kr.ON_AUDIO_BUFFER),this._source.on(Kr.ON_AUDIO_BUFFER,a=>i(a))}play(){I.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(I.debug("[".concat(this.getTrackId(),"] start audio playback in element")),xr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){I.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?xr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];I.debug("[".concat(this.getTrackId(),"] update player source track")),i&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&xr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}_updateOriginMediaStreamTrack(i,r){var a=this;return L(function*(){a._originMediaStreamTrack!==i&&(a._originMediaStreamTrack&&(a._originMediaStreamTrack.removeEventListener("ended",a._handleTrackEnded),r&&a._originMediaStreamTrack.stop()),i.addEventListener("ended",a._handleTrackEnded),a._originMediaStreamTrack=i,a._muted&&(a._originMediaStreamTrack.enabled=!1),a.processor&&a.processor.updateInput({track:i,context:a.processorContext}),a._mediaStreamTrack!==a._source.outputTrack?(a._mediaStreamTrack=a._originMediaStreamTrack,a._updatePlayerSource(),yield Tt(a,ve.NEED_REPLACE_TRACK,a)):a._source.updateTrack(a._originMediaStreamTrack),a._getOriginVolumeLevel&&a._source.updateOriginTrack(i))})()}renewMediaStreamTrack(i){return X.resolve(void 0)}pipe(i){if(this._bypassWebAudio)throw new ee(k.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===i)return i;if(i._source)throw new ee(k.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),i}unpipe(){var i;if(!this.processor)return;const r=this.processor;null===(i=this._source.processSourceNode)||void 0===i||i.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){var i=this;this.processorDestination.on(cr.ON_TRACK,function(){var r=L(function*(a){a?a!==i._mediaStreamTrack&&(i._mediaStreamTrack=a,i._updatePlayerSource(!1),i._source.processedNode=i._source.createMediaStreamSourceNode(a),yield Tt(i,ve.NEED_REPLACE_TRACK,i)):i._mediaStreamTrack!==i._originMediaStreamTrack&&(i._mediaStreamTrack=i._originMediaStreamTrack,i._updatePlayerSource(),yield Tt(i,ve.NEED_REPLACE_TRACK,i))});return function(a){return r.apply(this,arguments)}}()),this.processorDestination.on(cr.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(cr.ON_TRACK),this.processorDestination.removeAllListeners(cr.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(yr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(yr.REQUEST_CONSTRAINTS)}}ne([vu("INIT_WEBAUDIO"),N("design:type",Object),N("design:paramtypes",[Object])],Et.prototype,"_source",null),ne([vu("INIT_WEBAUDIO"),N("design:type",Eu),N("design:paramtypes",[Eu])],Et.prototype,"processorContext",null),ne([vu("INIT_WEBAUDIO"),N("design:type",r0),N("design:paramtypes",[r0])],Et.prototype,"processorDestination",null),ne([we({argsMap:(s,i)=>[s.getTrackId(),i],throttleTime:300}),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],Et.prototype,"setVolume",null),ne([we({argsMap:(s,i)=>[s.getTrackId(),i]}),gn(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],Et.prototype,"setPlaybackDevice",null),ne([ei("LocalAudioTrack","_enabledMutex"),we({argsMap:(s,i)=>[s.getTrackId(),i]}),gn(),N("design:type",Function),N("design:paramtypes",[Boolean,Object,Boolean]),N("design:returntype",X)],Et.prototype,"setEnabled",null),ne([ei("LocalAudioTrack","_enabledMutex"),we({argsMap:(s,i)=>[s.getTrackId(),i]}),gn(),N("design:type",Function),N("design:paramtypes",[Boolean]),N("design:returntype",X)],Et.prototype,"setMuted",null),ne([gn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",Object)],Et.prototype,"getStats",null),ne([gn(),N("design:type",Function),N("design:paramtypes",[Object,Number]),N("design:returntype",void 0)],Et.prototype,"setAudioFrameCallback",null),ne([we({argsMap:s=>[s.getTrackId()]}),gn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Et.prototype,"play",null),ne([we({argsMap:s=>[s.getTrackId()]}),gn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Et.prototype,"stop",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Et.prototype,"close",null),ne([we({argsMap:(s,i)=>[s.getTrackId(),i.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],Et.prototype,"pipe",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Et.prototype,"unpipe",null);class ji extends Et{get __className__(){return"MicrophoneAudioTrack"}constructor(i,r,a,d){super(i,r.encoderConfig?Wm(r.encoderConfig):{},d,B("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),C(this,"_config",void 0),C(this,"_deviceName","default"),C(this,"_constraints",void 0),C(this,"_originalConstraints",void 0),C(this,"_enabled",!0),this._config=r,this._constraints=a,this._originalConstraints=a,this._deviceName=i.label,"boolean"==typeof r.bypassWebAudio&&(this._bypassWebAudio=r.bypassWebAudio),(qh()||OD())&&Ct.bindInterruptDetectorTrack(this),this.on(gp.UPDATE_TRACK_SOURCE,()=>{this.bindProcessorContextEvents()}),qT()&&this.bindProcessorContextEvents()}setDevice(i){var r=this;return L(function*(){if(I.info("[".concat(r.getTrackId(),"] start set device to ").concat(i)),r._enabled)try{const a=yield ko.getDeviceById(i),d={};d.audio=s0({},r._constraints),d.audio.deviceId={exact:i},r._originMediaStreamTrack.stop();let l=null;try{l=yield xo(d,r.getTrackId())}catch(h){throw I.error("[".concat(r.getTrackId(),"] setDevice failed"),h.toString()),l=yield xo({audio:r._constraints},r.getTrackId()),yield r._updateOriginMediaStreamTrack(l.getAudioTracks()[0],!1),h}yield r._updateOriginMediaStreamTrack(l.getAudioTracks()[0],!1),r._deviceName=a.label,r._config.microphoneId=i,r._constraints.deviceId={exact:i}}catch(a){throw I.error("[".concat(r.getTrackId(),"] setDevice error"),a.toString()),a}else try{const a=yield ko.getDeviceById(i);r._deviceName=a.label,r._config.microphoneId=i,r._constraints.deviceId={exact:i}}catch(a){throw I.error("[".concat(r.getTrackId(),"] setDevice error"),a.toString()),a}I.info("[".concat(r.getTrackId(),"] set device to ").concat(i," success"))})()}setEnabled(i,r,a){var d=()=>super._setEnabled,l=this;return L(function*(){if(r)return I.debug("[".concat(l.getTrackId(),"] setEnabled false (do not close microphone)")),yield d().call(l,i);if(!a){if(i===l._enabled)return;l.stateCheck("enabled",i)}if(I.info("[".concat(l.getTrackId(),"] start setEnabled"),i),!i){var h;l._originMediaStreamTrack.onended=null,l._originMediaStreamTrack.stop(),null===(h=l._source.clonedTrack)||void 0===h||h.stop(),a||(l._enabled=!1);try{yield Tt(l,ve.NEED_DISABLE_TRACK,l)}catch(g){throw I.error("[".concat(l.getTrackId(),"] setEnabled false failed"),g.toString()),g}return}const f=s0({},l._constraints),_=ko.searchDeviceIdByName(l._deviceName);_&&!f.deviceId&&(f.deviceId=_);try{a||(l._enabled=!0);const g=yield xo({audio:l._constraints},l.getTrackId());yield l._updateOriginMediaStreamTrack(g.getAudioTracks()[0],!1),yield Tt(l,ve.NEED_ENABLE_TRACK,l)}catch(g){throw a||(l._enabled=!1),I.error("[".concat(l.getTrackId(),"] setEnabled true failed"),g.toString()),g}I.info("[".concat(l.getTrackId(),"] setEnabled success"))})()}close(){super.close(),(qh()||OD())&&Ct.unbindInterruptDetectorTrack(this)}onTrackEnded(){var i=this;if((Pi()||Ic())&&this._enabled&&!this._isClosed&&Ct.duringInterruption){const r=function(){var a=L(function*(){Ct.off(ii.IOS_INTERRUPTION_END,r),i._enabled&&!i._isClosed&&(I.debug("[".concat(i.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),yield i.setEnabled(!1),yield i.setEnabled(!0))});return function(){return a.apply(this,arguments)}}();Ct.on(ii.IOS_INTERRUPTION_END,r)}else I.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Wa.TRACK_ENDED)}renewMediaStreamTrack(i){var r=this;return L(function*(){const a=i||r._constraints,d=ko.searchDeviceIdByName(r._deviceName);if(d&&!a.deviceId&&(a.deviceId=d),r._constraints=a,r._enabled){r._originMediaStreamTrack.stop();const l=yield xo({audio:r._constraints},r.getTrackId());yield r._updateOriginMediaStreamTrack(l.getAudioTracks()[0],!0)}})()}bindProcessorContextEvents(){var i=this;this.processorContext.on(yr.REQUEST_UPDATE_CONSTRAINTS,function(){var r=L(function*(a,d,l){try{const h=Object.assign({},i._originalConstraints,...a);yield i.renewMediaStreamTrack(h),d()}catch(h){l(h)}});return function(a,d,l){return r.apply(this,arguments)}}()),this.processorContext.on(yr.REQUEST_CONSTRAINTS,function(){var r=L(function*(a){a(i._originMediaStreamTrack.getSettings())});return function(a){return r.apply(this,arguments)}}())}}ne([we({argsMap:(s,i)=>[s.getTrackId(),i]}),gn(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],ji.prototype,"setDevice",null),ne([ei("MicrophoneAudioTrack","_enabledMutex"),we({argsMap:(s,i,r)=>[s.getTrackId(),i,r]}),gn(),N("design:type",Function),N("design:paramtypes",[Boolean,Boolean,Boolean]),N("design:returntype",X)],ji.prototype,"setEnabled",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],ji.prototype,"close",null);class fs extends Et{get __className__(){return"BufferSourceAudioTrack"}constructor(i,r,a,d){super(r.createOutputTrack(),a,d),C(this,"source",void 0),C(this,"_bufferSource",void 0),this.source=i,this._bufferSource=r,this._bufferSource.on(Kr.AUDIO_SOURCE_STATE_CHANGE,l=>{this.safeEmit(Wa.SOURCE_STATE_CHANGE,l)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(i){i&&this._bufferSource.updateOptions(i),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(i){this._bufferSource.seekAudioBuffer(i)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(i){At(i,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(i)}}ne([we({argsMap:(s,i)=>[s.getTrackId(),i,s.duration]}),gn(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],fs.prototype,"startProcessAudioBuffer",null),ne([we({argsMap:s=>[s.getTrackId()]}),gn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],fs.prototype,"pauseProcessAudioBuffer",null),ne([we({argsMap:s=>[s.getTrackId()]}),gn(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],fs.prototype,"seekAudioBuffer",null),ne([we({argsMap:s=>[s.getTrackId()]}),gn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],fs.prototype,"resumeProcessAudioBuffer",null),ne([we({argsMap:s=>[s.getTrackId()]}),gn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],fs.prototype,"stopProcessAudioBuffer",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],fs.prototype,"close",null),ne([we({argsMap:s=>[s.getTrackId()]}),gn(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],fs.prototype,"setAudioBufferPlaybackSpeed",null);class jn extends Et{get __className__(){return"MixingAudioTrack"}get isActive(){for(const i of this.trackList)if(i._enabled&&!i._isClosed&&!i.muted)return!0;return!1}constructor(){const i=mu().createMediaStreamDestination();super(i.stream.getAudioTracks()[0],void 0,qe(8,"track-mix-")),C(this,"trackList",void 0),C(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=i,this.trackList=[]}hasAudioTrack(i){return-1!==this.trackList.indexOf(i)}addAudioTrack(i){-1===this.trackList.indexOf(i)?(I.debug("add ".concat(i.getTrackId()," to mixing track")),i._source.outputNode.connect(this.destNode),this.trackList.push(i),this.updateEncoderConfig()):I.debug("track ".concat(i.getTrackId()," is already added"))}removeAudioTrack(i){if(-1!==this.trackList.indexOf(i)){I.debug("remove ".concat(i.getTrackId()," from mixing track"));try{i._source.outputNode.disconnect(this.destNode)}catch{}mm(this.trackList,i),this.updateEncoderConfig()}}updateEncoderConfig(){const i={};this.trackList.forEach(r=>{r._encoderConfig&&((r._encoderConfig.bitrate||0)>(i.bitrate||0)&&(i.bitrate=r._encoderConfig.bitrate),(r._encoderConfig.sampleRate||0)>(i.sampleRate||0)&&(i.sampleRate=r._encoderConfig.sampleRate),(r._encoderConfig.sampleSize||0)>(i.sampleSize||0)&&(i.sampleSize=r._encoderConfig.sampleSize),r._encoderConfig.stereo&&(i.stereo=!0))}),this._encoderConfig=i}_updateRtpTransceiver(i){this._rtpTransceiver!==i&&(this._rtpTransceiver=i,this.trackList.forEach(r=>{r instanceof jn?r.emit(pu.TRANSCEIVER_UPDATED,i):r._updateRtpTransceiver(i)}))}}function Hv(s){const i={};s.facingMode&&(i.facingMode=s.facingMode),s.cameraId&&(i.deviceId={exact:s.cameraId});const r=Mo(s.encoderConfig);return null!=r.width&&(i.width=r.width),null!=r.height&&(i.height=r.height),!MD()&&r.frameRate&&(i.frameRate=r.frameRate),lt().name===gt.EDGE&&"object"==typeof i.frameRate&&(i.frameRate.max=60),Pt()&&(i.frameRate={ideal:30,max:30}),i}function D2(s){const i={};if(MD()||(void 0!==s.AGC&&(i.autoGainControl=s.AGC),void 0!==s.AEC&&(i.echoCancellation=s.AEC),void 0!==s.ANS&&(i.noiseSuppression=s.ANS,um()&&s.ANS&&(i.googHighpassFilter=s.ANS))),s.encoderConfig){const r=Wm(s.encoderConfig);i.channelCount=r.stereo?2:1,i.sampleRate=r.sampleRate,i.sampleSize=r.sampleSize}return s.microphoneId&&(i.deviceId={exact:s.microphoneId}),Kh()&&(i.sampleRate=void 0),i}class FB extends yN{set currentState(i){i!==this._currentState&&(this._currentState=i,this.safeEmit(Kr.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),C(this,"audioBuffer",void 0),C(this,"sourceNode",void 0),C(this,"startPlayTime",0),C(this,"startPlayOffset",0),C(this,"pausePlayTime",0),C(this,"options",void 0),C(this,"currentLoopCount",0),C(this,"currentPlaybackSpeed",100),C(this,"_currentState","stopped"),this.audioBuffer=i,this.options=r,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:(this.playbackSpeed/100*(this.context.currentTime-this.startPlayTime)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(i){"stopped"===this.currentState?(this.options=i,this.startPlayOffset=this.options.startPlayTime||0):I.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(i){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=i,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=i))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(i){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=i/100),this.currentPlaybackSpeed=i}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const i=this.context.createBufferSource();return i.buffer=this.audioBuffer,i.loop=!!this.options.loop,i.connect(this.outputNode),i.playbackRate.value=this.currentPlaybackSpeed/100,i}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const Sp=new Map;function $m(){return $m=L(function*(s,i){let r=null;if("string"==typeof s){const d=Sp.get(s);if(d)return I.debug("use cached audio resource: ",s),d;try{r=(yield In(()=>Ze.get(s,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(l){throw new ee(k.FETCH_AUDIO_FILE_FAILED,l.toString())}}else r=yield new X((l,h)=>{const f=new FileReader;f.onload=_=>{_.target?l(_.target.result):h(new ee(k.READ_LOCAL_AUDIO_FILE_ERROR))},f.onerror=()=>{h(new ee(k.READ_LOCAL_AUDIO_FILE_ERROR))},f.readAsArrayBuffer(s)});const a=yield function(d){const l=mu();return new X((h,f)=>{l.decodeAudioData(d,_=>{h(_)},_=>{f(new ee(k.DECODE_AUDIO_FILE_FAILED,_.toString()))})})}(r);return"string"==typeof s&&i&&Sp.set(s,a),a}),$m.apply(this,arguments)}const a0=s=>{const i=document.createElement("canvas");return i.width=2,i.height=2,new X((r,a)=>{i.toBlob(function(){var d=L(function*(l){if(i.remove(),l){const h=yield c0(l);r({buffer:h,width:i.width,height:i.height})}else a(new ee(k.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(l){return d.apply(this,arguments)}}(),s,1)})},c0=function(){var s=L(function*(i){const r=yield i.arrayBuffer();return new Uint8Array(r)});return function(r){return s.apply(this,arguments)}}(),Wc=new class extends jt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),C(this,"_lastHiddenTime",0),C(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),I.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};function wN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function RN(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?wN(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):wN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class Xm{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(i){i!==this._videoElementStatus&&(I.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(i)),this._videoElementStatus=i)}constructor(i){C(this,"trackId",void 0),C(this,"config",void 0),C(this,"onFirstVideoFrameDecoded",void 0),C(this,"freezeTimeCounterList",[]),C(this,"renderFreezeAccTime",0),C(this,"isKeepLastFrame",!1),C(this,"timeUpdatedCount",0),C(this,"freezeTime",0),C(this,"playbackTime",0),C(this,"lastTimeUpdatedTime",0),C(this,"autoplayFailed",!1),C(this,"videoTrack",void 0),C(this,"videoElement",void 0),C(this,"cacheVideoElement",void 0),C(this,"videoElementCheckInterval",void 0),C(this,"_videoElementStatus",Vi.NONE),C(this,"isGettingVideoDimensions",!1),C(this,"startGetVideoDimensions",()=>{const r=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return I.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(r,500)};!this.isGettingVideoDimensions&&r()}),C(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===Ct.curState&&(I.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(ID())),ND()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),C(this,"handleVideoEvents",r=>{switch(r.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Vi.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Vi.CANPLAY;break;case"stalled":this.videoElementStatus=Vi.STALLED;break;case"suspend":this.videoElementStatus=Vi.SUSPEND;break;case"pause":this.videoElementStatus=Vi.PAUSED,Pi()||Ic()||fr()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(I.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Vi.WAITING;break;case"abort":this.videoElementStatus=Vi.ABORT;break;case"ended":this.videoElementStatus=Vi.ENDED;break;case"emptied":this.videoElementStatus=Vi.EMPTIED;break;case"error":{this.videoElementStatus=Vi.ERROR;const a=this.videoElement.error;a&&I.error("[".concat(this.trackId,"] media error, code: ").concat(a.code,", message: ").concat(a.message));break}case"timeupdate":{const a=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=a);const d=a-this.lastTimeUpdatedTime,l=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=a,Wc.lastVisibleTime<Wc.lastHiddenTime||l<Wc.lastHiddenTime||l<Wc.lastVisibleTime)return;for(d>B("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=d),this.playbackTime+=d;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),C(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(I.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(ID())),ND()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=i.trackId,this.config=i,this.videoElement=i.element instanceof HTMLVideoElement?i.element:document.createElement("video"),Ct.on(ii.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ct.on(ii.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var i;return null!==(i=this.videoElement.parentElement)&&void 0!==i?i:void 0}updateConfig(i){this.config=i,this.trackId=i.trackId,i.element!==this.videoElement&&(this.destroy(),this.videoElement=i.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(i){this.videoTrack!==i&&(this.videoTrack=i,this.initVideoElement())}play(i){const r=this.videoElement.play();r&&r.catch&&r.catch(d=>{i&&t0(i,"video",d.message,this.trackId),"NotAllowedError"===d.name?(I.warning("detected video element autoplay failed",d),this.autoplayFailed=!0,this.handleAutoPlayFailed()):I.warning("[".concat(this.trackId,"] play warning: "),d)});const a=lt();if(("Safari"===a.name&&15===Number(a.version)||qh())&&r&&r.then){const d=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};r.then(d).catch(d)}}getCurrentFrame(){const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const r=i.getContext("2d");if(!r)return I.error("create canvas context failed!"),new ImageData(2,2);r.drawImage(this.videoElement,0,0,i.width,i.height);const a=r.getImageData(0,0,i.width,i.height);return i.remove(),a}getCurrentFrameToUint8Array(i){var r=arguments,a=this;return L(function*(){let d=r.length>1&&void 0!==r[1]?r[1]:1;const l=document.createElement("canvas");l.width=a.videoElement.videoWidth,l.height=a.videoElement.videoHeight;const h=l.getContext("2d");return h?(h.drawImage(a.videoElement,0,0,l.width,l.height),new X((f,_)=>{l.toBlob(function(){var g=L(function*(v){if(l.remove(),v){const b=yield c0(v);f({buffer:b,width:l.width,height:l.height})}else _(new ee(k.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(v){return g.apply(this,arguments)}}(),i,d<0?.1:d>1?1:d)})):yield a0(i)})()}destroy(){Ct.off(ii.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ct.off(ii.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=Vi.INIT,!this.videoElementCheckInterval&&(d0.forEach(l=>{this.videoElement.addEventListener(l,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{var l;(l=this.videoElement)!==document.body&&document.body.contains(l)||(this.videoElementStatus=Vi.DESTROYED)},1e3),B("ENABLE_VIDEO_FRAME_CALLBACK"))){var i,r;let l;const h=(f,_)=>{if(this.videoElementStatus===Vi.PLAYING){if(l){const b=_.presentationTime-l.presentationTime;b>B("VIDEO_FREEZE_DURATION")&&Wc.lastVisibleTime>=Wc.lastHiddenTime&&l.timestamp>Wc.lastVisibleTime&&l.timestamp>Wc.lastHiddenTime&&(this.renderFreezeAccTime+=b)}l=RN(RN({},_),{},{timestamp:f})}var g,v;B("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(g=(v=this.videoElement).requestVideoFrameCallback)||void 0===g||g.call(v,h))};null===(i=(r=this.videoElement).requestVideoFrameCallback)||void 0===i||i.call(r,h)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Kh()&&(this.videoElement.poster="noposter");const a=lt();"Safari"===a.name&&15===Number(a.version)||qh()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.videoElement.style.objectFit=this.config.fit?this.config.fit:"cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Pt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Pt()&&this.videoElement.load());const d=this.videoElement.play();void 0!==d&&d.catch(l=>{I.debug("[".concat(this.trackId,"] playback interrupted"),l.toString())})}resetVideoElement(){d0.forEach(i=>{this.videoElement&&this.videoElement.removeEventListener(i,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Vi.NONE}handleAutoPlayFailed(){const i=r=>{r.preventDefault(),this.videoElement.play().then(()=>{I.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(a=>{I.error(a)}),this.autoplayFailed=!1,wc()?document.body.removeEventListener("click",i,!0):(document.body.removeEventListener("touchstart",i,!0),document.body.removeEventListener("mousedown",i,!0))};wc()?document.body.addEventListener("click",i,!0):(document.body.addEventListener("touchstart",i,!0),document.body.addEventListener("mousedown",i,!0)),SN()}}const d0=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class AN extends Xm{constructor(i){super(i),C(this,"container",void 0),C(this,"slot",void 0),this.slot=i.element,this.updateConfig(i)}updateConfig(i){this.config=i,this.trackId=i.trackId;const r=i.element;r!==this.slot&&(this.destroy(),this.slot=r),this.createElements()}updateVideoTrack(i){this.videoTrack!==i&&(this.videoTrack=i,this.createElements())}play(i){var r;null!==(r=this.container)&&void 0!==r&&r.contains(this.videoElement)&&super.play(i)}getCurrentFrame(){var i;return null!==(i=this.container)&&void 0!==i&&i.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}getCurrentFrameToUint8Array(i){var r=arguments,a=()=>super.getCurrentFrameToUint8Array,d=this;return L(function*(){var l;let h=r.length>1&&void 0!==r[1]?r[1]:1;return null!==(l=d.container)&&void 0!==l&&l.contains(d.videoElement)?yield a().call(d,i,h):yield a0(i)})()}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",B("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var i;!this.container||null!==(i=this.container)&&void 0!==i&&i.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var i;if(null!==(i=this.container)&&void 0!==i&&i.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var i;null!==(i=this.container)&&void 0!==i&&i.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function Jm(s){return new X((i,r)=>{let a=!1;const d=document.createElement("video");d.setAttribute("autoplay",""),d.setAttribute("muted",""),d.muted=!0,d.autoplay=!0,d.setAttribute("playsinline",""),d.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(d);const l=Pi()?"canplay":"playing";d.addEventListener(l,()=>{const h=d.videoWidth,f=d.videoHeight;!h&&Pt()||(a=!0,d.srcObject=null,d.remove(),i([h,f]))}),d.srcObject=new MediaStream([s]),d.play().catch(Jl),setTimeout(()=>{a||(d.srcObject=null,d.remove(),i([d.videoWidth,d.videoHeight]))},4e3)})}const l0=function(){var s=L(function*(i,r,a){const d=function(f){const _=[];for(let g=0;g<f.length;g+=2)_.push(parseInt(f.slice(g,g+2),16));return Uint8Array.from(_)}(function(f){const _="0123456789abcdef";function g(ge){let _e,Fe="";for(_e=0;_e<=3;_e++)Fe+=_.charAt(ge>>8*_e+4&15)+_.charAt(ge>>8*_e&15);return Fe}function v(ge,_e){const Fe=(65535&ge)+(65535&_e);return(ge>>16)+(_e>>16)+(Fe>>16)<<16|65535&Fe}function b(ge,_e,Fe,rt,ai,Qt){return v((Fi=v(v(_e,ge),v(rt,Qt)))<<(ie=ai)|Fi>>>32-ie,Fe);var Fi,ie}function y(ge,_e,Fe,rt,ai,Qt,Fi){return b(_e&Fe|~_e&rt,ge,_e,ai,Qt,Fi)}function T(ge,_e,Fe,rt,ai,Qt,Fi){return b(_e&rt|Fe&~rt,ge,_e,ai,Qt,Fi)}function M(ge,_e,Fe,rt,ai,Qt,Fi){return b(_e^Fe^rt,ge,_e,ai,Qt,Fi)}function O(ge,_e,Fe,rt,ai,Qt,Fi){return b(Fe^(_e|~rt),ge,_e,ai,Qt,Fi)}const D=function(ge){let _e;const Fe=1+(ge.length+8>>6),rt=new Array(16*Fe);for(_e=0;_e<16*Fe;_e++)rt[_e]=0;for(_e=0;_e<ge.length;_e++)rt[_e>>2]|=ge.charCodeAt(_e)<<_e%4*8;return rt[_e>>2]|=128<<_e%4*8,rt[16*Fe-2]=8*ge.length,rt}(f);let x,F,j,Y,te,K=1732584193,Q=-271733879,$=-1732584194,q=271733878;for(x=0;x<D.length;x+=16)F=K,j=Q,Y=$,te=q,K=y(K,Q,$,q,D[x+0],7,-680876936),q=y(q,K,Q,$,D[x+1],12,-389564586),$=y($,q,K,Q,D[x+2],17,606105819),Q=y(Q,$,q,K,D[x+3],22,-1044525330),K=y(K,Q,$,q,D[x+4],7,-176418897),q=y(q,K,Q,$,D[x+5],12,1200080426),$=y($,q,K,Q,D[x+6],17,-1473231341),Q=y(Q,$,q,K,D[x+7],22,-45705983),K=y(K,Q,$,q,D[x+8],7,1770035416),q=y(q,K,Q,$,D[x+9],12,-1958414417),$=y($,q,K,Q,D[x+10],17,-42063),Q=y(Q,$,q,K,D[x+11],22,-1990404162),K=y(K,Q,$,q,D[x+12],7,1804603682),q=y(q,K,Q,$,D[x+13],12,-40341101),$=y($,q,K,Q,D[x+14],17,-1502002290),Q=y(Q,$,q,K,D[x+15],22,1236535329),K=T(K,Q,$,q,D[x+1],5,-165796510),q=T(q,K,Q,$,D[x+6],9,-1069501632),$=T($,q,K,Q,D[x+11],14,643717713),Q=T(Q,$,q,K,D[x+0],20,-373897302),K=T(K,Q,$,q,D[x+5],5,-701558691),q=T(q,K,Q,$,D[x+10],9,38016083),$=T($,q,K,Q,D[x+15],14,-660478335),Q=T(Q,$,q,K,D[x+4],20,-405537848),K=T(K,Q,$,q,D[x+9],5,568446438),q=T(q,K,Q,$,D[x+14],9,-1019803690),$=T($,q,K,Q,D[x+3],14,-187363961),Q=T(Q,$,q,K,D[x+8],20,1163531501),K=T(K,Q,$,q,D[x+13],5,-1444681467),q=T(q,K,Q,$,D[x+2],9,-51403784),$=T($,q,K,Q,D[x+7],14,1735328473),Q=T(Q,$,q,K,D[x+12],20,-1926607734),K=M(K,Q,$,q,D[x+5],4,-378558),q=M(q,K,Q,$,D[x+8],11,-2022574463),$=M($,q,K,Q,D[x+11],16,1839030562),Q=M(Q,$,q,K,D[x+14],23,-35309556),K=M(K,Q,$,q,D[x+1],4,-1530992060),q=M(q,K,Q,$,D[x+4],11,1272893353),$=M($,q,K,Q,D[x+7],16,-155497632),Q=M(Q,$,q,K,D[x+10],23,-1094730640),K=M(K,Q,$,q,D[x+13],4,681279174),q=M(q,K,Q,$,D[x+0],11,-358537222),$=M($,q,K,Q,D[x+3],16,-722521979),Q=M(Q,$,q,K,D[x+6],23,76029189),K=M(K,Q,$,q,D[x+9],4,-640364487),q=M(q,K,Q,$,D[x+12],11,-421815835),$=M($,q,K,Q,D[x+15],16,530742520),Q=M(Q,$,q,K,D[x+2],23,-995338651),K=O(K,Q,$,q,D[x+0],6,-198630844),q=O(q,K,Q,$,D[x+7],10,1126891415),$=O($,q,K,Q,D[x+14],15,-1416354905),Q=O(Q,$,q,K,D[x+5],21,-57434055),K=O(K,Q,$,q,D[x+12],6,1700485571),q=O(q,K,Q,$,D[x+3],10,-1894986606),$=O($,q,K,Q,D[x+10],15,-1051523),Q=O(Q,$,q,K,D[x+1],21,-2054922799),K=O(K,Q,$,q,D[x+8],6,1873313359),q=O(q,K,Q,$,D[x+15],10,-30611744),$=O($,q,K,Q,D[x+6],15,-1560198380),Q=O(Q,$,q,K,D[x+13],21,1309151649),K=O(K,Q,$,q,D[x+4],6,-145523070),q=O(q,K,Q,$,D[x+11],10,-1120210379),$=O($,q,K,Q,D[x+2],15,718787259),Q=O(Q,$,q,K,D[x+9],21,-343485551),K=v(K,F),Q=v(Q,j),$=v($,Y),q=v(q,te);return g(K)+g(Q)+g($)+g(q)}(""+r+a)).slice(0,16),l=d.slice(0,12),h=yield window.crypto.subtle.importKey("raw",d,"AES-GCM",!0,["encrypt"]);return new Uint8Array(yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:l},h,i))});return function(r,a,d){return s.apply(this,arguments)}}(),N2=function(){var s=L(function*(i,r,a){return yield l0(i.buffer,r,a)});return function(r,a,d){return s.apply(this,arguments)}}();function u0(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Fo(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?u0(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):u0(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class je extends Bi{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Vi.PLAYING)}get processorContext(){return this._processorContext}set processorContext(i){this._processorContext=i}get __className__(){return"LocalVideoTrack"}constructor(i,r,a,d,l,h){if(super(i,l),C(this,"trackMediaType","video"),C(this,"_player",void 0),C(this,"isUseScaleResolutionDownBy",!1),C(this,"_videoVisibleTimer",null),C(this,"_statsTimer",null),C(this,"_previousVideoVisibleStatus",void 0),C(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),C(this,"_encoderConfig",void 0),C(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),C(this,"_optimizationMode",void 0),C(this,"_videoHeight",void 0),C(this,"_videoWidth",void 0),C(this,"_forceBitrateLimit",void 0),C(this,"_enabled",!0),C(this,"processorDestination",void 0),C(this,"_processorContext",void 0),fr()){const{width:f,height:_}=i.getSettings();this._videoWidth=f,this._videoHeight=_}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=r,this._scalabilityMode=a,this._optimizationMode=d,this._hints=h||[],-1===this._hints.indexOf(kt.SCREEN_TRACK))this.updateBitrateFromProfile();else if(function(f,_,g){const v=lt();return!(v.name!==f||!v.osVersion)&&115===Number(v.version)}(gt.CHROME)&&-1!==qE().indexOf("Windows")){const f=function(_,g){if("VideoFrame"in window&&"TransformStream"in window&&Ot().supportWebRTCInsertableStream){const v=new MediaStreamTrackProcessor(_),b=new MediaStreamTrackGenerator({kind:"video"});let y,T,M=Date.now();const O=()=>{D&&(clearInterval(D),D=void 0),y&&(y.close(),y=void 0),_.stop(),T=void 0,b.removeEventListener("ended",O)};let D=window.setInterval(()=>{if(T&&y&&Date.now()-M>1e3)try{"live"===b.readyState?T.enqueue(y.clone()):O()}catch{O()}},1e3);const x=new TransformStream({transform:(F,j)=>{"live"===b.readyState?(T=j,M=Date.now(),void 0===y?(y=F,j.enqueue(F.clone())):(j.enqueue(y),y=F)):F.close()}});return b.addEventListener("ended",O),v.readable.pipeThrough(x).pipeTo(b.writable),b}}(i);f&&(I.info("local screen video track begin to inject frame"),this._mediaStreamTrack=f)}r&&-1!==this._hints.indexOf(kt.CUSTOM_TRACK)&&this.setEncoderConfiguration(r),this.processorContext=new w2(this.getTrackId(),"local"),this.processorDestination=new IN(this.processorContext),this.bindProcessorDestinationEvents()}play(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof i){const d=document.getElementById(i);d?i=d:(I.warning("[".concat(this.getTrackId(),'] can not find "#').concat(i,'" element, use document.body')),i=document.body)}I.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const a=Fo(Fo(Fo({},this._getDefaultPlayerConfig()),r),{},{trackId:this.getTrackId(),element:i});this._player?this._player.updateConfig(a):(this._player=i instanceof HTMLVideoElement?new Xm(a):new AN(a),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const d=this.getVideoElementVisibleStatus();this.safeEmit(Wa.VIDEO_ELEMENT_VISIBLE_STATUS,d)}catch{}},B("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._statsTimer&&(this.isUseScaleResolutionDownBy=!1,window.clearInterval(this._statsTimer),this._statsTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,I.debug("[".concat(this.getTrackId(),"] stop video playback")))}setEnabled(i,r){var a=this;return L(function*(){if(!r){if(i===a._enabled)return;a.stateCheck("enabled",i)}if(I.info("[".concat(a.getTrackId(),"] start setEnabled"),i),!i){a._originMediaStreamTrack.enabled=!1;try{yield Tt(a,ve.NEED_DISABLE_TRACK,a)}catch(d){throw I.error("[".concat(a.getTrackId(),"] setEnabled to false error"),d.toString()),d}return r||(a._enabled=!1),void I.info("[".concat(a.getTrackId(),"] setEnabled to false success"))}a._originMediaStreamTrack.enabled=!0;try{yield Tt(a,ve.NEED_ENABLE_TRACK,a)}catch(d){throw I.error("[".concat(a.getTrackId(),"] setEnabled to true error"),d.toString()),d}I.info("[".concat(a.getTrackId(),"] setEnabled to true success")),r||(a._enabled=!0)})()}setMuted(i){var r=this;return L(function*(){i!==r._muted&&(r.stateCheck("muted",i),r._muted=i,r._originMediaStreamTrack.enabled=!i,I.debug("[".concat(r.getTrackId(),"] start set muted: ").concat(i)),i?yield Tt(r,ve.NEED_MUTE_TRACK,r):yield Tt(r,ve.NEED_UNMUTE_TRACK,r))})()}setEncoderConfiguration(i,r){var a=this;return L(function*(){if(!a._enabled)throw new ee(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if("720p_auto"===i?a.startMonitorStats():a._statsTimer&&(window.clearInterval(a._statsTimer),a._statsTimer=null),i=Mo(i),a._forceBitrateLimit&&(i.bitrateMax=a._forceBitrateLimit.max_bitrate?a._forceBitrateLimit.max_bitrate:i.bitrateMax,i.bitrateMin=a._forceBitrateLimit.min_bitrate?a._forceBitrateLimit.min_bitrate:i.bitrateMin),i.width||i.height||i.frameRate){const d=Hv({encoderConfig:i});(fr()||Pi()||Ic())&&(d.deviceId=void 0),I.debug("[".concat(a.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(i),JSON.stringify(d));try{yield a._originMediaStreamTrack.applyConstraints(d),a.updateMediaStreamTrackResolution()}catch(l){const h=new ee(k.UNEXPECTED_ERROR,l.toString());throw I.error("[".concat(a.getTrackId(),"] applyConstraints error"),h.toString()),h}}a._encoderConfig=i,-1===a._hints.indexOf(kt.SCREEN_TRACK)&&a.updateBitrateFromProfile();try{yield Tt(a,ve.NEED_UPDATE_VIDEO_ENCODER,a)}catch(d){return d.throw(I)}})()}getStats(){return Jh(()=>{I.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Mr(this,ve.GET_STATS)||Fo({},wn)}setBeautyEffect(i){return L(function*(){I.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")})()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}getCurrentFrameImage(i){var r=arguments,a=this;return L(function*(){return a._player?a._player.getCurrentFrameToUint8Array(i,r.length>1&&void 0!==r[1]?r[1]:1):yield a0(i)})()}setBitrateLimit(i){var r=this;return L(function*(){if(I.debug("[".concat(r.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(i))),i){r._forceBitrateLimit=i,r._encoderConfig&&(r._encoderConfig.bitrateMax=r._encoderConfig.bitrateMax&&r._encoderConfig.bitrateMax<i.max_bitrate?r._encoderConfig.bitrateMax:i.max_bitrate,r._encoderConfig.bitrateMin=i.min_bitrate);try{yield Tt(r,ve.NEED_UPDATE_VIDEO_ENCODER,r)}catch(a){return a.throw(I)}}})()}setOptimizationMode(i){var r=this;return L(function*(){if("motion"!==i&&"detail"!==i&&"balanced"!==i)return void I.error(k.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const a=r._optimizationMode;try{r._optimizationMode=i,yield Tt(r,ve.SET_OPTIMIZATION_MODE,r)}catch(d){throw r._optimizationMode=a,I.error("[".concat(r.getTrackId(),"] set optimization mode failed"),d.toString()),d}I.info("[".concat(r.getTrackId(),"] set optimization mode success (").concat(i,")"))})()}setScalabiltyMode(i){if(1===i.numSpatialLayers&&1!==i.numTemporalLayers)return I.error(k.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=i,I.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(i,")"))}updateMediaStreamTrackResolution(){Jm(this._originMediaStreamTrack).then(i=>{let[r,a]=i;this._videoHeight=a,this._videoWidth=r}).catch(Jl)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}setSenderConfiguration(i){var r=this;return L(function*(){if(!r._enabled)throw new ee(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");I.debug("[".concat(r.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(i)),i=Mo(i),r._forceBitrateLimit&&(i.bitrateMax=r._forceBitrateLimit.max_bitrate?r._forceBitrateLimit.max_bitrate:i.bitrateMax,i.bitrateMin=r._forceBitrateLimit.min_bitrate?r._forceBitrateLimit.min_bitrate:i.bitrateMin),r._encoderConfig=i,-1===r._hints.indexOf(kt.SCREEN_TRACK)&&r.updateBitrateFromProfile();try{yield Tt(r,ve.NEED_UPDATE_VIDEO_ENCODER,r)}catch(a){return a.throw(I)}})()}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:i,height:r,frameRate:a}=this.getMediaStreamTrackSettings();if(!i||!r||!a)return;const[d,l]=function(h,f,_,g){let v;const b=200*Math.pow(_/15,.6)*Math.pow(h*f/640/360,.75),y=b;if("STANDARD_BITRATE"===g)v=4*b;else{if("COMPATIABLE_BITRATE"!==g)return;v=2*b}return[Math.floor(v),Math.floor(y)]}(i,r,a,B("BITRATE_ADAPTER_TYPE"))||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=l,this._encoderConfig.bitrateMax=d,I.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(i,", h: ").concat(r,", fps: ").concat(a,"] => [brMax: ").concat(d,", brMin: ").concat(l,"]")))}getVideoElementVisibleStatus(){try{var i,r;const a=null==this||null===(i=this._player)||void 0===i?void 0:i.getContainerElement(),d={track:this,element:null==this||null===(r=this._player)||void 0===r?void 0:r.getVideoElement(),slot:a?.parentElement},{element:l,slot:h}=d;if(this.isPlaying&&l instanceof HTMLVideoElement&&h instanceof HTMLElement){const f=kD.checkOneElementVisible(l),_=Object.assign({},f);if(_.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=_.visible;Ie.reportApiInvoke(null,{tag:Kt.TRACER,name:qn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(_.visible?"Video is visible":"Invisible because of ".concat(_.reason))}return _}return}catch(a){throw new ee(k.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}renewMediaStreamTrack(i){return L(function*(){})()}pipe(i){if(this.processor===i)return i;if(i._source)throw new ee(k.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),i}unpipe(){if(!this.processor)return;const i=this.processor;this.processor._source=void 0,this.processor=void 0,i.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(i){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this._encoderConfig;i&&(a=Fo(Fo({},a),Mo(i))),a=Od(a);const d=qe(8,"track-video-cloned-"),l=new je(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,a,Od(this._scalabilityMode),this._optimizationMode,d,Od(this._hints));return i&&a&&l.setEncoderConfiguration(a),I.debug("clone video track from ".concat(this.getTrackId()," to ").concat(d,", clone ").concat(r)),l}replaceTrack(i,r){var a=this;return L(function*(){if(!(i instanceof MediaStreamTrack))throw new ee(k.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==i.kind)throw new ee(k.INVALID_PARAMS,"track should be a video MediaStreamTrack");yield a._updateOriginMediaStreamTrack(i,r,!0),a.updateMediaStreamTrackResolution()})()}startMonitorStats(){if(!fr()&&!Pi())return;this._statsTimer&&window.clearInterval(this._statsTimer);let i=2,r=Lv[i],a=-1,d=Date.now();const l=h=>{h>2||h<0||(d=Date.now(),r=Lv[h],this.setSenderConfiguration(r))};this.isUseScaleResolutionDownBy=!0,this._statsTimer=window.setInterval(()=>{const h=this.getStats(),f=Mr(this,ve.GET_RTC_STATS);if(h.sendPackets>0&&f){-1===a&&(a=Date.now());const _=Date.now();if(_-a<1e3||_-d<B("PROFILE_SWITCH_INTERVAL"))return;const g=h.sendFrameRate,b=.9*r.frameRate;"number"==typeof g&&g>0&&g<.6*r.frameRate?i>0&&(i--,l(i),I.debug("[".concat(this.getTrackId(),"] step down for fps ").concat(g,", switchProfile to ").concat(i))):f.OutgoingAvailableBandwidth<r.bitrateMin?i>0&&(i--,l(i),I.debug("[".concat(this.getTrackId(),"] step down for OutgoingAvailableBandwidth ").concat(f.OutgoingAvailableBandwidth,", bitrateMin ").concat(r.bitrateMin,", switchProfile to ").concat(i))):"number"==typeof g&&g>b&&i<Lv.length-1&&f.OutgoingAvailableBandwidth>1.2*Lv[i+1].bitrateMin&&(i++,l(i),I.debug("[".concat(this.getTrackId(),"] step up for fps ").concat(g,", OutgoingAvailableBandwidth ").concat(f.OutgoingAvailableBandwidth,", switchProfile to ").concat(i)))}},B("CHECK_LOCAL_STATS_INTERVAL"))}bindProcessorDestinationEvents(){var i=this;this.processorDestination.on(cr.ON_TRACK,function(){var r=L(function*(a){a?a!==i._mediaStreamTrack&&(i._mediaStreamTrack=a,i._updatePlayerSource(),yield Tt(i,ve.NEED_REPLACE_TRACK,i)):i._mediaStreamTrack!==i._originMediaStreamTrack&&(i._mediaStreamTrack=i._originMediaStreamTrack,i._updatePlayerSource(),yield Tt(i,ve.NEED_REPLACE_TRACK,i))});return function(a){return r.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(cr.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(yr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(yr.REQUEST_CONSTRAINTS)}}ne([we({argsMap:(s,i,r)=>[s.getTrackId(),"string"==typeof i?i:i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),gn(),N("design:type",Function),N("design:paramtypes",[Object,Object]),N("design:returntype",void 0)],je.prototype,"play",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],je.prototype,"stop",null),ne([ei("LocalVideoTrack","_enabledMutex"),we({argsMap:(s,i)=>[s.getTrackId(),i]}),gn(),N("design:type",Function),N("design:paramtypes",[Boolean,Boolean]),N("design:returntype",X)],je.prototype,"setEnabled",null),ne([ei("LocalVideoTrack","_enabledMutex"),we({argsMap:(s,i)=>[s.getTrackId(),i]}),gn(),N("design:type",Function),N("design:paramtypes",[Boolean]),N("design:returntype",X)],je.prototype,"setMuted",null),ne([we({argsMap:(s,i)=>[s.getTrackId(),i]}),gn(),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",X)],je.prototype,"setEncoderConfiguration",null),ne([gn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",Object)],je.prototype,"getStats",null),ne([we({argsMap:(s,i,r)=>[s.getTrackId(),i,r]}),gn(),N("design:type",Function),N("design:paramtypes",[Boolean,Object]),N("design:returntype",X)],je.prototype,"setBeautyEffect",null),ne([gn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",ImageData)],je.prototype,"getCurrentFrameData",null),ne([gn(),N("design:type",Function),N("design:paramtypes",[String,Number]),N("design:returntype",X)],je.prototype,"getCurrentFrameImage",null),ne([gn(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],je.prototype,"setBitrateLimit",null),ne([gn(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],je.prototype,"setOptimizationMode",null),ne([gn(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],je.prototype,"setScalabiltyMode",null),ne([gn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],je.prototype,"updateMediaStreamTrackResolution",null),ne([we({argsMap:(s,i)=>[s.getTrackId(),i.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],je.prototype,"pipe",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],je.prototype,"unpipe",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],je.prototype,"close",null),ne([we({argsMap:(s,i,r)=>[s.getTrackId(),i.label,r]}),N("design:type",Function),N("design:paramtypes",[MediaStreamTrack,Boolean]),N("design:returntype",X)],je.prototype,"replaceTrack",null),ne([we(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],je.prototype,"startMonitorStats",null);class ms extends je{get __className__(){return"CameraVideoTrack"}constructor(i,r,a,d,l,h){var f;super(i,Mo(r.encoderConfig),d,l,h),f=this,C(this,"_config",void 0),C(this,"_originalConstraints",void 0),C(this,"_constraints",void 0),C(this,"_enabled",!0),C(this,"_deviceName","default"),C(this,"tryResumeVideoForIOS15_16WeChat",L(function*(){(qh()||OD())&&!function(){const _=lt();if(_.os!==Zn.IOS||!_.osVersion)return!1;const g=_.osVersion.split(".");return 15===Number(g[0])&&Number(g[1])>=2}()&&PD()&&f._enabled&&!f._isClosed&&(I.debug("[".concat(f.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),yield f.renewMediaStreamTrack())})),this._config=r,this._originalConstraints=a,this._constraints=a,this._deviceName=i.label,this._encoderConfig=Mo(this._config.encoderConfig),Ct.on(ii.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Ct.on(ii.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}setDevice(i){var r=this;return L(function*(){return"string"==typeof i?r._setDeviceById(i):i.deviceId?r._setDeviceById(i.deviceId):i.facingMode?r._setDeviceByFacingModel(i.facingMode):void 0})()}_setDeviceById(i){var r=this;return L(function*(){if(I.info("[".concat(r.getTrackId(),"] set device to ").concat(i)),r._enabled)try{const a=yield ko.getDeviceById(i),d={};d.video=Fo({},r._constraints),d.video.deviceId={exact:i},d.video.facingMode=void 0,r._originMediaStreamTrack.stop();let l=null;try{l=yield xo(d,r.getTrackId())}catch(h){throw I.error("[".concat(r.getTrackId(),"] setDevice failed"),h.toString()),l=yield xo({video:r._constraints},r.getTrackId()),yield r._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1),h}yield r._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1),r.updateMediaStreamTrackResolution(),r._deviceName=a.label,r._config.cameraId=i,r._constraints.deviceId={exact:i}}catch(a){throw I.error("[".concat(r.getTrackId(),"] setDevice error"),a.toString()),a}else try{const a=yield ko.getDeviceById(i);r._deviceName=a.label,r._config.cameraId=i,r._constraints.deviceId={exact:i}}catch(a){throw I.error("[".concat(r.getTrackId(),"] setDevice error"),a.toString()),a}I.info("[".concat(r.getTrackId(),"] setDevice success"))})()}_setDeviceByFacingModel(i){var r=this;return L(function*(){I.info("[".concat(r.getTrackId(),"] set facingMode ").concat(i));const a={video:Fo(Fo({},r._constraints),{},{deviceId:void 0,facingMode:{exact:i}})};if(r._enabled){r._originMediaStreamTrack.stop();let d=null;try{d=yield xo(a,r.getTrackId())}catch(l){throw I.error("[".concat(r.getTrackId(),"] setDeviceByFacingModel failed"),l.toString()),d=yield xo({video:r._constraints},r.getTrackId()),yield r._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),l}yield r._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),r.updateMediaStreamTrackResolution()}r._deviceName="",r._config.facingMode=i,r._config.cameraId=void 0,r._constraints=Fo({},a.video),I.info("[".concat(r.getTrackId(),"] setDeviceByFacingModel success"))})()}setEnabled(i,r){var a=this;return L(function*(){if(!r){if(i===a._enabled)return;a.stateCheck("enabled",i)}if(I.info("[".concat(a.getTrackId(),"] start setEnabled"),i),i){try{if(a.isExternalTrack)a._originMediaStreamTrack.enabled=!0;else{const d=yield xo({video:a._constraints},a.getTrackId());yield a._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1)}yield Tt(a,ve.NEED_ENABLE_TRACK,a)}catch(d){throw I.error("[".concat(a.getTrackId(),"] setEnabled true error"),d.toString()),d}a.updateMediaStreamTrackResolution(),I.info("[".concat(a.getTrackId(),"] setEnabled to true success")),r||(a._enabled=!0)}else{a.isExternalTrack?a._originMediaStreamTrack.enabled=!1:(a._originMediaStreamTrack.onended=null,a._originMediaStreamTrack.stop()),r||(a._enabled=!1);try{yield Tt(a,ve.NEED_DISABLE_TRACK,a)}catch(d){throw I.error("[".concat(a.getTrackId(),"] setEnabled to false error"),d.toString()),d}I.info("[".concat(a.getTrackId(),"] setEnabled to false success"))}})()}setEncoderConfiguration(i,r){var a=this;return L(function*(){if(!a._enabled)throw new ee(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");"720p_auto"===i?a.startMonitorStats():a._statsTimer&&(window.clearInterval(a._statsTimer),a._statsTimer=null),i=Mo(i),a._forceBitrateLimit&&(i.bitrateMax=a._forceBitrateLimit.max_bitrate?a._forceBitrateLimit.max_bitrate:i.bitrateMax,i.bitrateMin=a._forceBitrateLimit.min_bitrate?a._forceBitrateLimit.min_bitrate:i.bitrateMin);const d=Ft(a._config);d.encoderConfig=i;const l=Hv(d);(fr()||Pi()||Ic())&&(l.deviceId=void 0),I.debug("[".concat(a.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(i),JSON.stringify(l));try{yield a._originMediaStreamTrack.applyConstraints(l),a.updateMediaStreamTrackResolution()}catch(h){const f=new ee(k.UNEXPECTED_ERROR,h.toString());throw I.error("[".concat(a.getTrackId(),"] applyConstraints error"),f.toString()),f}a._config=d,a._constraints=l,a._originalConstraints=l,a._encoderConfig=i,-1===a._hints.indexOf(kt.SCREEN_TRACK)&&a.updateBitrateFromProfile();try{yield Tt(a,ve.NEED_UPDATE_VIDEO_ENCODER,a)}catch(h){return h.throw(I)}})()}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){var i=this;if((Pi()||Ic())&&this._enabled&&!this._isClosed&&Ct.duringInterruption){const r=function(){var a=L(function*(){Ct.off(ii.IOS_INTERRUPTION_END,r),i._enabled&&!i._isClosed&&(I.debug("[".concat(i.getTrackId(),"] try capture camera media device for interrupted iOS device.")),yield i.setEnabled(!1),yield i.setEnabled(!0))});return function(){return a.apply(this,arguments)}}();Ct.on(ii.IOS_INTERRUPTION_END,r)}else I.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Wa.TRACK_ENDED)}renewMediaStreamTrack(i){var r=this;return L(function*(){const a=i||r._constraints,d=ko.searchDeviceIdByName(r._deviceName);if(d&&!a.deviceId&&(a.deviceId={exact:d}),r._enabled){const l=yield xo({video:a},r.getTrackId());r._constraints=a,yield r._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!0),r.updateMediaStreamTrackResolution()}})()}close(){super.close(),Ct.off(ii.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Ct.off(ii.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(i){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this._encoderConfig;i&&(a=Fo(Fo({},a),Mo(i))),a=Od(a);const d=qe(8,"track-cam-cloned-"),l=new ms(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,Od(Fo(Fo({},this._config),{},{encoderConfig:a})),Od(this._constraints),Od(this._scalabilityMode),this._optimizationMode,d);return i&&a&&l.setEncoderConfiguration(a),I.debug("clone track from ".concat(this.getTrackId()," to ").concat(d,", clone ").concat(r)),l}bindProcessorContextEvents(){var i=this;this.processorContext.on(yr.REQUEST_UPDATE_CONSTRAINTS,function(){var r=L(function*(a,d,l){try{const h=Object.assign({},i._originalConstraints,...a);yield i.renewMediaStreamTrack(h),d()}catch(h){l(h)}});return function(a,d,l){return r.apply(this,arguments)}}()),this.processorContext.on(yr.REQUEST_CONSTRAINTS,function(){var r=L(function*(a){a(i._originMediaStreamTrack.getSettings())});return function(a){return r.apply(this,arguments)}}())}}function DN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Qm(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?DN(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):DN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function Zm(s,i,r,a){r.optimizationMode&&(a&&a.width&&a.height?(r.encoderConfig=Qm(Qm({},a),{},{bitrateMin:a.bitrateMin,bitrateMax:a.bitrateMax}),"motion"!==r.optimizationMode&&"detail"!==r.optimizationMode||(i.contentHint=r.optimizationMode,i.contentHint===r.optimizationMode?I.debug("[".concat(s,"] set content hint to"),r.optimizationMode):I.debug("[".concat(s,"] set content hint failed")))):I.warning("[".concat(s,"] can not apply optimization mode bitrate config, no encoderConfig")))}function P2(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Gv(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?P2(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):P2(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}ne([we({argsMap:(s,i)=>[s.getTrackId(),i]}),gn(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],ms.prototype,"setDevice",null),ne([ei("CameraVideoTrack","_enabledMutex"),we({argsMap:(s,i)=>[s.getTrackId(),i]}),gn(),N("design:type",Function),N("design:paramtypes",[Boolean,Boolean]),N("design:returntype",X)],ms.prototype,"setEnabled",null),ne([we({argsMap:(s,i)=>[s.getTrackId(),i]}),gn(),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",X)],ms.prototype,"setEncoderConfiguration",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],ms.prototype,"close",null);class ON extends Gc{getUserId(){return this._userId}constructor(i,r,a,d){super(i,"track-".concat(i.kind,"-").concat(r,"-").concat(d.clientId,"_").concat(qe(5,""))),C(this,"_userId",void 0),C(this,"_uintId",void 0),C(this,"_isDestroyed",!1),C(this,"store",void 0),C(this,"processor",void 0),this._userId=r,this._uintId=a,this.store=d}_updateOriginMediaStreamTrack(i){this._originMediaStreamTrack=i,this._mediaStreamTrack=i,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,I.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}class za extends ON{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Vi.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(i,r,a,d){super(i,r,a,d),C(this,"_videoVisibleTimer",null),C(this,"_previousVideoVisibleStatus",void 0),C(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),C(this,"trackMediaType","video"),C(this,"_videoWidth",void 0),C(this,"_videoHeight",void 0),C(this,"_player",void 0),C(this,"processorDestination",void 0),C(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new w2(this.getTrackId(),"remote"),this.processorDestination=new IN(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Jh(()=>{I.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Mr(this,ve.GET_STATS)||Gv({},gN)}play(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof i){const d=document.getElementById(i);d?i=d:(I.warning("[".concat(this.getTrackId(),'] can not find "#').concat(i,'" element, use document.body')),i=document.body)}I.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const a=Gv(Gv({fit:"cover"},r),{},{trackId:this.getTrackId(),element:i});this._player?this._player.updateConfig(a):(this._player=i instanceof HTMLVideoElement?new Xm(a):new AN(a),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(fu.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const d=this.getVideoElementVisibleStatus();this.safeEmit(fu.VIDEO_ELEMENT_VISIBLE_STATUS,d)}catch{}},B("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,I.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Jm(this._originMediaStreamTrack).then(i=>{let[r,a]=i;this._videoHeight=a,this._videoWidth=r}).catch(Jl)}_updatePlayerSource(){I.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var i,r;const a=null==this||null===(i=this._player)||void 0===i?void 0:i.getContainerElement(),d={track:this,element:null==this||null===(r=this._player)||void 0===r?void 0:r.getVideoElement(),slot:a?.parentElement},{element:l,slot:h}=d;if(this.isPlaying&&l instanceof HTMLVideoElement&&h instanceof HTMLElement){const f=kD.checkOneElementVisible(l),_=Object.assign({},f);if(_.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=_.visible;Ie.reportApiInvoke(null,{tag:Kt.TRACER,name:qn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(_.visible?"Video is visible":"Invisible because of ".concat(_.reason))}return _}return}catch(a){throw new ee(k.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}pipe(i){if(this.processor===i)return i;if(i._source)throw new ee(k.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),i}unpipe(){if(!this.processor)return;const i=this.processor;this.processor._source=void 0,this.processor=void 0,i.reset()}bindProcessorDestinationEvents(){var i=this;this.processorDestination.on(cr.ON_TRACK,function(){var r=L(function*(a){a?a!==i._mediaStreamTrack&&(i._mediaStreamTrack=a,i._updatePlayerSource()):i._mediaStreamTrack!==i._originMediaStreamTrack&&(i._mediaStreamTrack=i._originMediaStreamTrack,i._updatePlayerSource())});return function(a){return r.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(cr.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}ne([we({argsMap:(s,i,r)=>[s.getTrackId(),"string"==typeof i?i:i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),N("design:type",Function),N("design:paramtypes",[Object,Object]),N("design:returntype",void 0)],za.prototype,"play",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],za.prototype,"stop",null),ne([we({argsMap:(s,i)=>[s.getTrackId(),i.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],za.prototype,"pipe",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],za.prototype,"unpipe",null);class _s extends ON{get isPlaying(){return this._useAudioElement?xr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(i,r,a,d){super(i,r,a,d),C(this,"trackMediaType","audio"),C(this,"_source",void 0),C(this,"_useAudioElement",!0),C(this,"_volume",100),C(this,"processorContext",void 0),C(this,"processorDestination",void 0),C(this,"_played",!1),C(this,"_bypassWebAudio",!1),B("DISABLE_WEBAUDIO")?(this._source=new o0,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new Uv(i,!0),B("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Kr.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(fu.FIRST_FRAME_DECODED)}),this.processorContext=new Eu(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new r0(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Kr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!i)return this._source.removeAllListeners(Kr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Kr.ON_AUDIO_BUFFER),this._source.on(Kr.ON_AUDIO_BUFFER,a=>i(a))}setVolume(i){this._volume=i,this._useAudioElement?xr.setVolume(this.getTrackId(),i):this._source.setVolume(i/100)}setPlaybackDevice(i){var r=this;return L(function*(){if(!r._useAudioElement||!um()&&B("RESTRICTION_SET_PLAYBACK_DEVICE"))throw new ee(k.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield xr.setSinkID(r.getTrackId(),i)})()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Jh(()=>{I.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Mr(this,ve.GET_STATS)||Gv({},Hd)}play(){I.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(I.debug("[".concat(this.getTrackId(),"] use audio element to play")),xr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){I.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?xr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];I.debug("[".concat(this.getTrackId(),"] update player source track")),i&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&xr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(i){if(this._bypassWebAudio)throw new ee(k.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===i)return i;if(i._source)throw new ee(k.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),i}unpipe(){var i;if(this._bypassWebAudio)throw new ee(k.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;null===(i=this._source.processSourceNode)||void 0===i||i.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){var i=this;this.processorDestination.on(cr.ON_TRACK,function(){var r=L(function*(a){a?a!==i._mediaStreamTrack&&(i._mediaStreamTrack=a,i._updatePlayerSource(!1),i._source.processedNode=i._source.createMediaStreamSourceNode(a)):i._mediaStreamTrack!==i._originMediaStreamTrack&&(i._mediaStreamTrack=i._originMediaStreamTrack,i._updatePlayerSource())});return function(a){return r.apply(this,arguments)}}()),this.processorDestination.on(cr.ON_NODE,r=>{this._source.processedNode=r;const a=!r;this._useAudioElement!==a&&(this._played?(this.stop(),this._useAudioElement=a,this.play()):this._useAudioElement=a)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(cr.ON_TRACK),this.processorDestination.removeAllListeners(cr.ON_NODE)}}function bu(s){let i=s.length;for(;--i>=0;)s[i]=0}ne([we({argsMap:(s,i)=>[s.getTrackId(),i],throttleTime:300}),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],_s.prototype,"setVolume",null),ne([we({argsMap:(s,i)=>[s.getTrackId(),i]}),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],_s.prototype,"setPlaybackDevice",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],_s.prototype,"play",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],_s.prototype,"stop",null),ne([we({argsMap:(s,i)=>[s.getTrackId(),i.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],_s.prototype,"pipe",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],_s.prototype,"unpipe",null);const f0=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),t_=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),M2=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),m0=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),qa=new Array(576);bu(qa);const Tp=new Array(60);bu(Tp);const Ip=new Array(512);bu(Ip);const n_=new Array(256);bu(n_);const _0=new Array(29);bu(_0);const g0=new Array(30);function Wv(s,i,r,a,d){this.static_tree=s,this.extra_bits=i,this.extra_base=r,this.elems=a,this.max_length=d,this.has_stree=s&&s.length}let x2,k2,L2;function NN(s,i){this.dyn_tree=s,this.max_code=0,this.stat_desc=i}bu(g0);const F2=s=>s<256?Ip[s]:Ip[256+(s>>>7)],zv=(s,i)=>{s.pending_buf[s.pending++]=255&i,s.pending_buf[s.pending++]=i>>>8&255},gs=(s,i,r)=>{s.bi_valid>16-r?(s.bi_buf|=i<<s.bi_valid&65535,zv(s,s.bi_buf),s.bi_buf=i>>16-s.bi_valid,s.bi_valid+=r-16):(s.bi_buf|=i<<s.bi_valid&65535,s.bi_valid+=r)},zc=(s,i,r)=>{gs(s,r[2*i],r[2*i+1])},Wd=(s,i)=>{let r=0;do{r|=1&s,s>>>=1,r<<=1}while(--i>0);return r>>>1},U2=(s,i,r)=>{const a=new Array(16);let d,l,h=0;for(d=1;d<=15;d++)h=h+r[d-1]<<1,a[d]=h;for(l=0;l<=i;l++){let f=s[2*l+1];0!==f&&(s[2*l]=Wd(a[f]++,f))}},V2=s=>{let i;for(i=0;i<286;i++)s.dyn_ltree[2*i]=0;for(i=0;i<30;i++)s.dyn_dtree[2*i]=0;for(i=0;i<19;i++)s.bl_tree[2*i]=0;s.dyn_ltree[512]=1,s.opt_len=s.static_len=0,s.sym_next=s.matches=0},E0=s=>{s.bi_valid>8?zv(s,s.bi_buf):s.bi_valid>0&&(s.pending_buf[s.pending++]=s.bi_buf),s.bi_buf=0,s.bi_valid=0},PN=(s,i,r,a)=>{const d=2*i,l=2*r;return s[d]<s[l]||s[d]===s[l]&&a[i]<=a[r]},qv=(s,i,r)=>{const a=s.heap[r];let d=r<<1;for(;d<=s.heap_len&&(d<s.heap_len&&PN(i,s.heap[d+1],s.heap[d],s.depth)&&d++,!PN(i,a,s.heap[d],s.depth));)s.heap[r]=s.heap[d],r=d,d<<=1;s.heap[r]=a},MN=(s,i,r)=>{let a,d,l,h,f=0;if(0!==s.sym_next)do{a=255&s.pending_buf[s.sym_buf+f++],a+=(255&s.pending_buf[s.sym_buf+f++])<<8,d=s.pending_buf[s.sym_buf+f++],0===a?zc(s,d,i):(l=n_[d],zc(s,l+256+1,i),h=f0[l],0!==h&&(d-=_0[l],gs(s,d,h)),a--,l=F2(a),zc(s,l,r),h=t_[l],0!==h&&(a-=g0[l],gs(s,a,h)))}while(f<s.sym_next);zc(s,256,i)},xN=(s,i)=>{const r=i.dyn_tree,a=i.stat_desc.static_tree,d=i.stat_desc.has_stree,l=i.stat_desc.elems;let h,f,_,g=-1;for(s.heap_len=0,s.heap_max=573,h=0;h<l;h++)0!==r[2*h]?(s.heap[++s.heap_len]=g=h,s.depth[h]=0):r[2*h+1]=0;for(;s.heap_len<2;)_=s.heap[++s.heap_len]=g<2?++g:0,r[2*_]=1,s.depth[_]=0,s.opt_len--,d&&(s.static_len-=a[2*_+1]);for(i.max_code=g,h=s.heap_len>>1;h>=1;h--)qv(s,r,h);_=l;do{h=s.heap[1],s.heap[1]=s.heap[s.heap_len--],qv(s,r,1),f=s.heap[1],s.heap[--s.heap_max]=h,s.heap[--s.heap_max]=f,r[2*_]=r[2*h]+r[2*f],s.depth[_]=(s.depth[h]>=s.depth[f]?s.depth[h]:s.depth[f])+1,r[2*h+1]=r[2*f+1]=_,s.heap[1]=_++,qv(s,r,1)}while(s.heap_len>=2);s.heap[--s.heap_max]=s.heap[1],((v,b)=>{const y=b.dyn_tree,T=b.max_code,M=b.stat_desc.static_tree,O=b.stat_desc.has_stree,D=b.stat_desc.extra_bits,x=b.stat_desc.extra_base,F=b.stat_desc.max_length;let j,Y,te,K,Q,$,q=0;for(K=0;K<=15;K++)v.bl_count[K]=0;for(y[2*v.heap[v.heap_max]+1]=0,j=v.heap_max+1;j<573;j++)Y=v.heap[j],K=y[2*y[2*Y+1]+1]+1,K>F&&(K=F,q++),y[2*Y+1]=K,Y>T||(v.bl_count[K]++,Q=0,Y>=x&&(Q=D[Y-x]),$=y[2*Y],v.opt_len+=$*(K+Q),O&&(v.static_len+=$*(M[2*Y+1]+Q)));if(0!==q){do{for(K=F-1;0===v.bl_count[K];)K--;v.bl_count[K]--,v.bl_count[K+1]+=2,v.bl_count[F]--,q-=2}while(q>0);for(K=F;0!==K;K--)for(Y=v.bl_count[K];0!==Y;)te=v.heap[--j],te>T||(y[2*te+1]!==K&&(v.opt_len+=(K-y[2*te+1])*y[2*te],y[2*te+1]=K),Y--)}})(s,i),U2(r,g,s.bl_count)},i_=(s,i,r)=>{let a,d,l=-1,h=i[1],f=0,_=7,g=4;for(0===h&&(_=138,g=3),i[2*(r+1)+1]=65535,a=0;a<=r;a++)d=h,h=i[2*(a+1)+1],++f<_&&d===h||(f<g?s.bl_tree[2*d]+=f:0!==d?(d!==l&&s.bl_tree[2*d]++,s.bl_tree[32]++):f<=10?s.bl_tree[34]++:s.bl_tree[36]++,f=0,l=d,0===h?(_=138,g=3):d===h?(_=6,g=3):(_=7,g=4))},kN=(s,i,r)=>{let a,d,l=-1,h=i[1],f=0,_=7,g=4;for(0===h&&(_=138,g=3),a=0;a<=r;a++)if(d=h,h=i[2*(a+1)+1],!(++f<_&&d===h)){if(f<g)do{zc(s,d,s.bl_tree)}while(0!=--f);else 0!==d?(d!==l&&(zc(s,d,s.bl_tree),f--),zc(s,16,s.bl_tree),gs(s,f-3,2)):f<=10?(zc(s,17,s.bl_tree),gs(s,f-3,3)):(zc(s,18,s.bl_tree),gs(s,f-11,7));f=0,l=d,0===h?(_=138,g=3):d===h?(_=6,g=3):(_=7,g=4)}};let wp=!1;const r_=(s,i,r,a)=>{gs(s,0+(a?1:0),3),E0(s),zv(s,r),zv(s,~r),r&&s.pending_buf.set(s.window.subarray(i,i+r),s.pending),s.pending+=r};var G2={_tr_init:s=>{wp||((()=>{let i,r,a,d,l;const h=new Array(16);for(a=0,d=0;d<28;d++)for(_0[d]=a,i=0;i<1<<f0[d];i++)n_[a++]=d;for(n_[a-1]=d,l=0,d=0;d<16;d++)for(g0[d]=l,i=0;i<1<<t_[d];i++)Ip[l++]=d;for(l>>=7;d<30;d++)for(g0[d]=l<<7,i=0;i<1<<t_[d]-7;i++)Ip[256+l++]=d;for(r=0;r<=15;r++)h[r]=0;for(i=0;i<=143;)qa[2*i+1]=8,i++,h[8]++;for(;i<=255;)qa[2*i+1]=9,i++,h[9]++;for(;i<=279;)qa[2*i+1]=7,i++,h[7]++;for(;i<=287;)qa[2*i+1]=8,i++,h[8]++;for(U2(qa,287,h),i=0;i<30;i++)Tp[2*i+1]=5,Tp[2*i]=Wd(i,5);x2=new Wv(qa,f0,257,286,15),k2=new Wv(Tp,t_,0,30,15),L2=new Wv(new Array(0),M2,0,19,7)})(),wp=!0),s.l_desc=new NN(s.dyn_ltree,x2),s.d_desc=new NN(s.dyn_dtree,k2),s.bl_desc=new NN(s.bl_tree,L2),s.bi_buf=0,s.bi_valid=0,V2(s)},_tr_stored_block:r_,_tr_flush_block:(s,i,r,a)=>{let d,l,h=0;s.level>0?(2===s.strm.data_type&&(s.strm.data_type=(f=>{let _,g=4093624447;for(_=0;_<=31;_++,g>>>=1)if(1&g&&0!==f.dyn_ltree[2*_])return 0;if(0!==f.dyn_ltree[18]||0!==f.dyn_ltree[20]||0!==f.dyn_ltree[26])return 1;for(_=32;_<256;_++)if(0!==f.dyn_ltree[2*_])return 1;return 0})(s)),xN(s,s.l_desc),xN(s,s.d_desc),h=(f=>{let _;for(i_(f,f.dyn_ltree,f.l_desc.max_code),i_(f,f.dyn_dtree,f.d_desc.max_code),xN(f,f.bl_desc),_=18;_>=3&&0===f.bl_tree[2*m0[_]+1];_--);return f.opt_len+=3*(_+1)+5+5+4,_})(s),d=s.opt_len+3+7>>>3,l=s.static_len+3+7>>>3,l<=d&&(d=l)):d=l=r+5,r+4<=d&&-1!==i?r_(s,i,r,a):4===s.strategy||l===d?(gs(s,2+(a?1:0),3),MN(s,qa,Tp)):(gs(s,4+(a?1:0),3),((f,_,g,v)=>{let b;for(gs(f,_-257,5),gs(f,g-1,5),gs(f,v-4,4),b=0;b<v;b++)gs(f,f.bl_tree[2*m0[b]+1],3);kN(f,f.dyn_ltree,_-1),kN(f,f.dyn_dtree,g-1)})(s,s.l_desc.max_code+1,s.d_desc.max_code+1,h+1),MN(s,s.dyn_ltree,s.dyn_dtree)),V2(s),a&&E0(s)},_tr_tally:(s,i,r)=>(s.pending_buf[s.sym_buf+s.sym_next++]=i,s.pending_buf[s.sym_buf+s.sym_next++]=i>>8,s.pending_buf[s.sym_buf+s.sym_next++]=r,0===i?s.dyn_ltree[2*r]++:(s.matches++,i--,s.dyn_ltree[2*(n_[r]+256+1)]++,s.dyn_dtree[2*F2(i)]++),s.sym_next===s.sym_end),_tr_align:s=>{var i;gs(s,2,3),zc(s,256,qa),16===(i=s).bi_valid?(zv(i,i.bi_buf),i.bi_buf=0,i.bi_valid=0):i.bi_valid>=8&&(i.pending_buf[i.pending++]=255&i.bi_buf,i.bi_buf>>=8,i.bi_valid-=8)}},o_=(s,i,r,a)=>{let d=65535&s|0,l=s>>>16&65535|0,h=0;for(;0!==r;){h=r>2e3?2e3:r,r-=h;do{d=d+i[a++]|0,l=l+d|0}while(--h);d%=65521,l%=65521}return d|l<<16|0};const W2=new Uint32Array((()=>{let s,i=[];for(var r=0;r<256;r++){s=r;for(var a=0;a<8;a++)s=1&s?3988292384^s>>>1:s>>>1;i[r]=s}return i})());var Sr=(s,i,r,a)=>{const d=W2,l=a+r;s^=-1;for(let h=a;h<l;h++)s=s>>>8^d[255&(s^i[h])];return-1^s},zd={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Rp={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:z2,_tr_stored_block:v0,_tr_flush_block:q2,_tr_tally:qd,_tr_align:K2}=G2,{Z_NO_FLUSH:Kd,Z_PARTIAL_FLUSH:Y2,Z_FULL_FLUSH:$2,Z_FINISH:Hs,Z_BLOCK:LN,Z_OK:kr,Z_STREAM_END:FN,Z_STREAM_ERROR:pa,Z_DATA_ERROR:b0,Z_BUF_ERROR:y0,Z_DEFAULT_COMPRESSION:X2,Z_FILTERED:UN,Z_HUFFMAN_ONLY:Kv,Z_RLE:VN,Z_FIXED:UB,Z_DEFAULT_STRATEGY:J2,Z_UNKNOWN:BN,Z_DEFLATED:yu}=Rp,Gs=262,Su=(s,i)=>(s.msg=zd[i],i),Z2=s=>2*s-(s>4?9:0),Kc=s=>{let i=s.length;for(;--i>=0;)s[i]=0},jN=s=>{let i,r,a,d=s.w_size;i=s.hash_size,a=i;do{r=s.head[--a],s.head[a]=r>=d?r-d:0}while(--i);i=d,a=i;do{r=s.prev[--a],s.prev[a]=r>=d?r-d:0}while(--i)};let Yr=(s,i,r)=>(i<<s.hash_shift^r)&s.hash_mask;const $r=s=>{const i=s.state;let r=i.pending;r>s.avail_out&&(r=s.avail_out),0!==r&&(s.output.set(i.pending_buf.subarray(i.pending_out,i.pending_out+r),s.next_out),s.next_out+=r,i.pending_out+=r,s.total_out+=r,s.avail_out-=r,i.pending-=r,0===i.pending&&(i.pending_out=0))},Uo=(s,i)=>{q2(s,s.block_start>=0?s.block_start:-1,s.strstart-s.block_start,i),s.block_start=s.strstart,$r(s.strm)},$t=(s,i)=>{s.pending_buf[s.pending++]=i},a_=(s,i)=>{s.pending_buf[s.pending++]=i>>>8&255,s.pending_buf[s.pending++]=255&i},I0=(s,i,r,a)=>{let d=s.avail_in;return d>a&&(d=a),0===d?0:(s.avail_in-=d,i.set(s.input.subarray(s.next_in,s.next_in+d),r),1===s.state.wrap?s.adler=o_(s.adler,i,d,r):2===s.state.wrap&&(s.adler=Sr(s.adler,i,d,r)),s.next_in+=d,s.total_in+=d,d)},eF=(s,i)=>{let r,a,d=s.max_chain_length,l=s.strstart,h=s.prev_length,f=s.nice_match;const _=s.strstart>s.w_size-Gs?s.strstart-(s.w_size-Gs):0,g=s.window,v=s.w_mask,b=s.prev,y=s.strstart+258;let T=g[l+h-1],M=g[l+h];s.prev_length>=s.good_match&&(d>>=2),f>s.lookahead&&(f=s.lookahead);do{if(r=i,g[r+h]===M&&g[r+h-1]===T&&g[r]===g[l]&&g[++r]===g[l+1]){l+=2,r++;do{}while(g[++l]===g[++r]&&g[++l]===g[++r]&&g[++l]===g[++r]&&g[++l]===g[++r]&&g[++l]===g[++r]&&g[++l]===g[++r]&&g[++l]===g[++r]&&g[++l]===g[++r]&&l<y);if(a=258-(y-l),l=y-258,a>h){if(s.match_start=i,h=a,a>=f)break;T=g[l+h-1],M=g[l+h]}}}while((i=b[i&v])>_&&0!=--d);return h<=s.lookahead?h:s.lookahead},Cu=s=>{const i=s.w_size;let r,a,d;do{if(a=s.window_size-s.lookahead-s.strstart,s.strstart>=i+(i-Gs)&&(s.window.set(s.window.subarray(i,i+i-a),0),s.match_start-=i,s.strstart-=i,s.block_start-=i,s.insert>s.strstart&&(s.insert=s.strstart),jN(s),a+=i),0===s.strm.avail_in)break;if(r=I0(s.strm,s.window,s.strstart+s.lookahead,a),s.lookahead+=r,s.lookahead+s.insert>=3)for(d=s.strstart-s.insert,s.ins_h=s.window[d],s.ins_h=Yr(s,s.ins_h,s.window[d+1]);s.insert&&(s.ins_h=Yr(s,s.ins_h,s.window[d+3-1]),s.prev[d&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=d,d++,s.insert--,!(s.lookahead+s.insert<3)););}while(s.lookahead<Gs&&0!==s.strm.avail_in)},HN=(s,i)=>{let r,a,d,l=s.pending_buf_size-5>s.w_size?s.w_size:s.pending_buf_size-5,h=0,f=s.strm.avail_in;do{if(r=65535,d=s.bi_valid+42>>3,s.strm.avail_out<d||(d=s.strm.avail_out-d,a=s.strstart-s.block_start,r>a+s.strm.avail_in&&(r=a+s.strm.avail_in),r>d&&(r=d),r<l&&(0===r&&i!==Hs||i===Kd||r!==a+s.strm.avail_in)))break;h=i===Hs&&r===a+s.strm.avail_in?1:0,v0(s,0,0,h),s.pending_buf[s.pending-4]=r,s.pending_buf[s.pending-3]=r>>8,s.pending_buf[s.pending-2]=~r,s.pending_buf[s.pending-1]=~r>>8,$r(s.strm),a&&(a>r&&(a=r),s.strm.output.set(s.window.subarray(s.block_start,s.block_start+a),s.strm.next_out),s.strm.next_out+=a,s.strm.avail_out-=a,s.strm.total_out+=a,s.block_start+=a,r-=a),r&&(I0(s.strm,s.strm.output,s.strm.next_out,r),s.strm.next_out+=r,s.strm.avail_out-=r,s.strm.total_out+=r)}while(0===h);return f-=s.strm.avail_in,f&&(f>=s.w_size?(s.matches=2,s.window.set(s.strm.input.subarray(s.strm.next_in-s.w_size,s.strm.next_in),0),s.strstart=s.w_size,s.insert=s.strstart):(s.window_size-s.strstart<=f&&(s.strstart-=s.w_size,s.window.set(s.window.subarray(s.w_size,s.w_size+s.strstart),0),s.matches<2&&s.matches++,s.insert>s.strstart&&(s.insert=s.strstart)),s.window.set(s.strm.input.subarray(s.strm.next_in-f,s.strm.next_in),s.strstart),s.strstart+=f,s.insert+=f>s.w_size-s.insert?s.w_size-s.insert:f),s.block_start=s.strstart),s.high_water<s.strstart&&(s.high_water=s.strstart),h?4:i!==Kd&&i!==Hs&&0===s.strm.avail_in&&s.strstart===s.block_start?2:(d=s.window_size-s.strstart,s.strm.avail_in>d&&s.block_start>=s.w_size&&(s.block_start-=s.w_size,s.strstart-=s.w_size,s.window.set(s.window.subarray(s.w_size,s.w_size+s.strstart),0),s.matches<2&&s.matches++,d+=s.w_size,s.insert>s.strstart&&(s.insert=s.strstart)),d>s.strm.avail_in&&(d=s.strm.avail_in),d&&(I0(s.strm,s.window,s.strstart,d),s.strstart+=d,s.insert+=d>s.w_size-s.insert?s.w_size-s.insert:d),s.high_water<s.strstart&&(s.high_water=s.strstart),d=s.bi_valid+42>>3,d=s.pending_buf_size-d>65535?65535:s.pending_buf_size-d,l=d>s.w_size?s.w_size:d,a=s.strstart-s.block_start,(a>=l||(a||i===Hs)&&i!==Kd&&0===s.strm.avail_in&&a<=d)&&(r=a>d?d:a,h=i===Hs&&0===s.strm.avail_in&&r===a?1:0,v0(s,s.block_start,r,h),s.block_start+=r,$r(s.strm)),h?3:1)},w0=(s,i)=>{let r,a;for(;;){if(s.lookahead<Gs){if(Cu(s),s.lookahead<Gs&&i===Kd)return 1;if(0===s.lookahead)break}if(r=0,s.lookahead>=3&&(s.ins_h=Yr(s,s.ins_h,s.window[s.strstart+3-1]),r=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),0!==r&&s.strstart-r<=s.w_size-Gs&&(s.match_length=eF(s,r)),s.match_length>=3)if(a=qd(s,s.strstart-s.match_start,s.match_length-3),s.lookahead-=s.match_length,s.match_length<=s.max_lazy_match&&s.lookahead>=3){s.match_length--;do{s.strstart++,s.ins_h=Yr(s,s.ins_h,s.window[s.strstart+3-1]),r=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart}while(0!=--s.match_length);s.strstart++}else s.strstart+=s.match_length,s.match_length=0,s.ins_h=s.window[s.strstart],s.ins_h=Yr(s,s.ins_h,s.window[s.strstart+1]);else a=qd(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++;if(a&&(Uo(s,!1),0===s.strm.avail_out))return 1}return s.insert=s.strstart<2?s.strstart:2,i===Hs?(Uo(s,!0),0===s.strm.avail_out?3:4):s.sym_next&&(Uo(s,!1),0===s.strm.avail_out)?1:2},Tu=(s,i)=>{let r,a,d;for(;;){if(s.lookahead<Gs){if(Cu(s),s.lookahead<Gs&&i===Kd)return 1;if(0===s.lookahead)break}if(r=0,s.lookahead>=3&&(s.ins_h=Yr(s,s.ins_h,s.window[s.strstart+3-1]),r=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),s.prev_length=s.match_length,s.prev_match=s.match_start,s.match_length=2,0!==r&&s.prev_length<s.max_lazy_match&&s.strstart-r<=s.w_size-Gs&&(s.match_length=eF(s,r),s.match_length<=5&&(s.strategy===UN||3===s.match_length&&s.strstart-s.match_start>4096)&&(s.match_length=2)),s.prev_length>=3&&s.match_length<=s.prev_length){d=s.strstart+s.lookahead-3,a=qd(s,s.strstart-1-s.prev_match,s.prev_length-3),s.lookahead-=s.prev_length-1,s.prev_length-=2;do{++s.strstart<=d&&(s.ins_h=Yr(s,s.ins_h,s.window[s.strstart+3-1]),r=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart)}while(0!=--s.prev_length);if(s.match_available=0,s.match_length=2,s.strstart++,a&&(Uo(s,!1),0===s.strm.avail_out))return 1}else if(s.match_available){if(a=qd(s,0,s.window[s.strstart-1]),a&&Uo(s,!1),s.strstart++,s.lookahead--,0===s.strm.avail_out)return 1}else s.match_available=1,s.strstart++,s.lookahead--}return s.match_available&&(a=qd(s,0,s.window[s.strstart-1]),s.match_available=0),s.insert=s.strstart<2?s.strstart:2,i===Hs?(Uo(s,!0),0===s.strm.avail_out?3:4):s.sym_next&&(Uo(s,!1),0===s.strm.avail_out)?1:2};function Ka(s,i,r,a,d){this.good_length=s,this.max_lazy=i,this.nice_length=r,this.max_chain=a,this.func=d}const c_=[new Ka(0,0,0,0,HN),new Ka(4,4,8,4,w0),new Ka(4,5,16,8,w0),new Ka(4,6,32,32,w0),new Ka(4,4,16,16,Tu),new Ka(8,16,32,32,Tu),new Ka(8,16,128,128,Tu),new Ka(8,32,128,256,Tu),new Ka(32,128,258,1024,Tu),new Ka(32,258,258,4096,Tu)];function Ya(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=yu,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Kc(this.dyn_ltree),Kc(this.dyn_dtree),Kc(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Kc(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Kc(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const d_=s=>{if(!s)return 1;const i=s.state;return!i||i.strm!==s||42!==i.status&&57!==i.status&&69!==i.status&&73!==i.status&&91!==i.status&&103!==i.status&&113!==i.status&&666!==i.status?1:0},tF=s=>{if(d_(s))return Su(s,pa);s.total_in=s.total_out=0,s.data_type=BN;const i=s.state;return i.pending=0,i.pending_out=0,i.wrap<0&&(i.wrap=-i.wrap),i.status=2===i.wrap?57:i.wrap?42:113,s.adler=2===i.wrap?0:1,i.last_flush=-2,z2(i),kr},nF=s=>{const i=tF(s);var r;return i===kr&&((r=s.state).window_size=2*r.w_size,Kc(r.head),r.max_lazy_match=c_[r.level].max_lazy,r.good_match=c_[r.level].good_length,r.nice_match=c_[r.level].nice_length,r.max_chain_length=c_[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0),i},GN=(s,i,r,a,d,l)=>{if(!s)return pa;let h=1;if(i===X2&&(i=6),a<0?(h=0,a=-a):a>15&&(h=2,a-=16),d<1||d>9||r!==yu||a<8||a>15||i<0||i>9||l<0||l>UB||8===a&&1!==h)return Su(s,pa);8===a&&(a=9);const f=new Ya;return s.state=f,f.strm=s,f.status=42,f.wrap=h,f.gzhead=null,f.w_bits=a,f.w_size=1<<f.w_bits,f.w_mask=f.w_size-1,f.hash_bits=d+7,f.hash_size=1<<f.hash_bits,f.hash_mask=f.hash_size-1,f.hash_shift=~~((f.hash_bits+3-1)/3),f.window=new Uint8Array(2*f.w_size),f.head=new Uint16Array(f.hash_size),f.prev=new Uint16Array(f.w_size),f.lit_bufsize=1<<d+6,f.pending_buf_size=4*f.lit_bufsize,f.pending_buf=new Uint8Array(f.pending_buf_size),f.sym_buf=f.lit_bufsize,f.sym_end=3*(f.lit_bufsize-1),f.level=i,f.strategy=l,f.method=r,nF(s)};var Ws={deflateInit:(s,i)=>GN(s,i,yu,15,8,J2),deflateInit2:GN,deflateReset:nF,deflateResetKeep:tF,deflateSetHeader:(s,i)=>d_(s)||2!==s.state.wrap?pa:(s.state.gzhead=i,kr),deflate:(s,i)=>{if(d_(s)||i>LN||i<0)return s?Su(s,pa):pa;const r=s.state;if(!s.output||0!==s.avail_in&&!s.input||666===r.status&&i!==Hs)return Su(s,0===s.avail_out?y0:pa);const a=r.last_flush;if(r.last_flush=i,0!==r.pending){if($r(s),0===s.avail_out)return r.last_flush=-1,kr}else if(0===s.avail_in&&Z2(i)<=Z2(a)&&i!==Hs)return Su(s,y0);if(666===r.status&&0!==s.avail_in)return Su(s,y0);if(42===r.status&&0===r.wrap&&(r.status=113),42===r.status){let d=yu+(r.w_bits-8<<4)<<8,l=-1;if(l=r.strategy>=Kv||r.level<2?0:r.level<6?1:6===r.level?2:3,d|=l<<6,0!==r.strstart&&(d|=32),d+=31-d%31,a_(r,d),0!==r.strstart&&(a_(r,s.adler>>>16),a_(r,65535&s.adler)),s.adler=1,r.status=113,$r(s),0!==r.pending)return r.last_flush=-1,kr}if(57===r.status)if(s.adler=0,$t(r,31),$t(r,139),$t(r,8),r.gzhead)$t(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),$t(r,255&r.gzhead.time),$t(r,r.gzhead.time>>8&255),$t(r,r.gzhead.time>>16&255),$t(r,r.gzhead.time>>24&255),$t(r,9===r.level?2:r.strategy>=Kv||r.level<2?4:0),$t(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&($t(r,255&r.gzhead.extra.length),$t(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(s.adler=Sr(s.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if($t(r,0),$t(r,0),$t(r,0),$t(r,0),$t(r,0),$t(r,9===r.level?2:r.strategy>=Kv||r.level<2?4:0),$t(r,3),r.status=113,$r(s),0!==r.pending)return r.last_flush=-1,kr;if(69===r.status){if(r.gzhead.extra){let d=r.pending,l=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+l>r.pending_buf_size;){let f=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+f),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>d&&(s.adler=Sr(s.adler,r.pending_buf,r.pending-d,d)),r.gzindex+=f,$r(s),0!==r.pending)return r.last_flush=-1,kr;d=0,l-=f}let h=new Uint8Array(r.gzhead.extra);r.pending_buf.set(h.subarray(r.gzindex,r.gzindex+l),r.pending),r.pending+=l,r.gzhead.hcrc&&r.pending>d&&(s.adler=Sr(s.adler,r.pending_buf,r.pending-d,d)),r.gzindex=0}r.status=73}if(73===r.status){if(r.gzhead.name){let d,l=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>l&&(s.adler=Sr(s.adler,r.pending_buf,r.pending-l,l)),$r(s),0!==r.pending)return r.last_flush=-1,kr;l=0}d=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,$t(r,d)}while(0!==d);r.gzhead.hcrc&&r.pending>l&&(s.adler=Sr(s.adler,r.pending_buf,r.pending-l,l)),r.gzindex=0}r.status=91}if(91===r.status){if(r.gzhead.comment){let d,l=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>l&&(s.adler=Sr(s.adler,r.pending_buf,r.pending-l,l)),$r(s),0!==r.pending)return r.last_flush=-1,kr;l=0}d=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,$t(r,d)}while(0!==d);r.gzhead.hcrc&&r.pending>l&&(s.adler=Sr(s.adler,r.pending_buf,r.pending-l,l))}r.status=103}if(103===r.status){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&($r(s),0!==r.pending))return r.last_flush=-1,kr;$t(r,255&s.adler),$t(r,s.adler>>8&255),s.adler=0}if(r.status=113,$r(s),0!==r.pending)return r.last_flush=-1,kr}if(0!==s.avail_in||0!==r.lookahead||i!==Kd&&666!==r.status){let d=0===r.level?HN(r,i):r.strategy===Kv?((l,h)=>{let f;for(;;){if(0===l.lookahead&&(Cu(l),0===l.lookahead)){if(h===Kd)return 1;break}if(l.match_length=0,f=qd(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++,f&&(Uo(l,!1),0===l.strm.avail_out))return 1}return l.insert=0,h===Hs?(Uo(l,!0),0===l.strm.avail_out?3:4):l.sym_next&&(Uo(l,!1),0===l.strm.avail_out)?1:2})(r,i):r.strategy===VN?((l,h)=>{let f,_,g,v;const b=l.window;for(;;){if(l.lookahead<=258){if(Cu(l),l.lookahead<=258&&h===Kd)return 1;if(0===l.lookahead)break}if(l.match_length=0,l.lookahead>=3&&l.strstart>0&&(g=l.strstart-1,_=b[g],_===b[++g]&&_===b[++g]&&_===b[++g])){v=l.strstart+258;do{}while(_===b[++g]&&_===b[++g]&&_===b[++g]&&_===b[++g]&&_===b[++g]&&_===b[++g]&&_===b[++g]&&_===b[++g]&&g<v);l.match_length=258-(v-g),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=3?(f=qd(l,1,l.match_length-3),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(f=qd(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),f&&(Uo(l,!1),0===l.strm.avail_out))return 1}return l.insert=0,h===Hs?(Uo(l,!0),0===l.strm.avail_out?3:4):l.sym_next&&(Uo(l,!1),0===l.strm.avail_out)?1:2})(r,i):c_[r.level].func(r,i);if(3!==d&&4!==d||(r.status=666),1===d||3===d)return 0===s.avail_out&&(r.last_flush=-1),kr;if(2===d&&(i===Y2?K2(r):i!==LN&&(v0(r,0,0,!1),i===$2&&(Kc(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),$r(s),0===s.avail_out))return r.last_flush=-1,kr}return i!==Hs?kr:r.wrap<=0?FN:(2===r.wrap?($t(r,255&s.adler),$t(r,s.adler>>8&255),$t(r,s.adler>>16&255),$t(r,s.adler>>24&255),$t(r,255&s.total_in),$t(r,s.total_in>>8&255),$t(r,s.total_in>>16&255),$t(r,s.total_in>>24&255)):(a_(r,s.adler>>>16),a_(r,65535&s.adler)),$r(s),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?kr:FN)},deflateEnd:s=>{if(d_(s))return pa;const i=s.state.status;return s.state=null,113===i?Su(s,b0):kr},deflateSetDictionary:(s,i)=>{let r=i.length;if(d_(s))return pa;const a=s.state,d=a.wrap;if(2===d||1===d&&42!==a.status||a.lookahead)return pa;if(1===d&&(s.adler=o_(s.adler,i,r,0)),a.wrap=0,r>=a.w_size){0===d&&(Kc(a.head),a.strstart=0,a.block_start=0,a.insert=0);let _=new Uint8Array(a.w_size);_.set(i.subarray(r-a.w_size,r),0),i=_,r=a.w_size}const l=s.avail_in,h=s.next_in,f=s.input;for(s.avail_in=r,s.next_in=0,s.input=i,Cu(a);a.lookahead>=3;){let _=a.strstart,g=a.lookahead-2;do{a.ins_h=Yr(a,a.ins_h,a.window[_+3-1]),a.prev[_&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=_,_++}while(--g);a.strstart=_,a.lookahead=2,Cu(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,s.next_in=h,s.input=f,s.avail_in=l,a.wrap=d,kr},deflateInfo:"pako deflate (from Nodeca project)"};const zN=(s,i)=>Object.prototype.hasOwnProperty.call(s,i);var Yv={assign:function(s){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const r=i.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const a in r)zN(r,a)&&(s[a]=r[a])}}return s},flattenChunks:s=>{let i=0;for(let a=0,d=s.length;a<d;a++)i+=s[a].length;const r=new Uint8Array(i);for(let a=0,d=0,l=s.length;a<l;a++){let h=s[a];r.set(h,d),d+=h.length}return r}};let A0=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{A0=!1}const Np=new Uint8Array(256);for(let s=0;s<256;s++)Np[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;Np[254]=Np[254]=1;var l_={string2buf:s=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(s);let i,r,a,d,l,h=s.length,f=0;for(d=0;d<h;d++)r=s.charCodeAt(d),55296==(64512&r)&&d+1<h&&(a=s.charCodeAt(d+1),56320==(64512&a)&&(r=65536+(r-55296<<10)+(a-56320),d++)),f+=r<128?1:r<2048?2:r<65536?3:4;for(i=new Uint8Array(f),l=0,d=0;l<f;d++)r=s.charCodeAt(d),55296==(64512&r)&&d+1<h&&(a=s.charCodeAt(d+1),56320==(64512&a)&&(r=65536+(r-55296<<10)+(a-56320),d++)),r<128?i[l++]=r:r<2048?(i[l++]=192|r>>>6,i[l++]=128|63&r):r<65536?(i[l++]=224|r>>>12,i[l++]=128|r>>>6&63,i[l++]=128|63&r):(i[l++]=240|r>>>18,i[l++]=128|r>>>12&63,i[l++]=128|r>>>6&63,i[l++]=128|63&r);return i},buf2string:(s,i)=>{const r=i||s.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(s.subarray(0,i));let a,d;const l=new Array(2*r);for(d=0,a=0;a<r;){let h=s[a++];if(h<128){l[d++]=h;continue}let f=Np[h];if(f>4)l[d++]=65533,a+=f-1;else{for(h&=2===f?31:3===f?15:7;f>1&&a<r;)h=h<<6|63&s[a++],f--;f>1?l[d++]=65533:h<65536?l[d++]=h:(h-=65536,l[d++]=55296|h>>10&1023,l[d++]=56320|1023&h)}}return((h,f)=>{if(f<65534&&h.subarray&&A0)return String.fromCharCode.apply(null,h.length===f?h:h.subarray(0,f));let _="";for(let g=0;g<f;g++)_+=String.fromCharCode(h[g]);return _})(l,d)},utf8border:(s,i)=>{(i=i||s.length)>s.length&&(i=s.length);let r=i-1;for(;r>=0&&128==(192&s[r]);)r--;return r<0||0===r?i:r+Np[s[r]]>i?r:i}},$v=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const iF=Object.prototype.toString,{Z_NO_FLUSH:rF,Z_SYNC_FLUSH:qN,Z_FULL_FLUSH:VB,Z_FINISH:BB,Z_OK:D0,Z_STREAM_END:jB,Z_DEFAULT_COMPRESSION:KN,Z_DEFAULT_STRATEGY:HB,Z_DEFLATED:GB}=Rp;function Xv(s){this.options=Yv.assign({level:KN,method:GB,chunkSize:16384,windowBits:15,memLevel:8,strategy:HB},s||{});let i=this.options;i.raw&&i.windowBits>0?i.windowBits=-i.windowBits:i.gzip&&i.windowBits>0&&i.windowBits<16&&(i.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $v,this.strm.avail_out=0;let r=Ws.deflateInit2(this.strm,i.level,i.method,i.windowBits,i.memLevel,i.strategy);if(r!==D0)throw new Error(zd[r]);if(i.header&&Ws.deflateSetHeader(this.strm,i.header),i.dictionary){let a;if(a="string"==typeof i.dictionary?l_.string2buf(i.dictionary):"[object ArrayBuffer]"===iF.call(i.dictionary)?new Uint8Array(i.dictionary):i.dictionary,r=Ws.deflateSetDictionary(this.strm,a),r!==D0)throw new Error(zd[r]);this._dict_set=!0}}function YN(s,i){const r=new Xv(i);if(r.push(s,!0),r.err)throw r.msg||zd[r.err];return r.result}Xv.prototype.push=function(s,i){const r=this.strm,a=this.options.chunkSize;let d,l;if(this.ended)return!1;for(l=i===~~i?i:!0===i?BB:rF,r.input="string"==typeof s?l_.string2buf(s):"[object ArrayBuffer]"===iF.call(s)?new Uint8Array(s):s,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(a),r.next_out=0,r.avail_out=a),(l===qN||l===VB)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(d=Ws.deflate(r,l),d===jB)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),d=Ws.deflateEnd(this.strm),this.onEnd(d),this.ended=!0,d===D0;if(0!==r.avail_out){if(l>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},Xv.prototype.onData=function(s){this.chunks.push(s)},Xv.prototype.onEnd=function(s){s===D0&&(this.result=Yv.flattenChunks(this.chunks)),this.chunks=[],this.err=s,this.msg=this.strm.msg};var WB={Deflate:Xv,deflate:YN,deflateRaw:function(s,i){return(i=i||{}).raw=!0,YN(s,i)},gzip:function(s,i){return(i=i||{}).gzip=!0,YN(s,i)},constants:Rp};const Jv=16209;var Qv=function(s,i){let r,a,d,l,h,f,_,g,v,b,y,T,M,O,D,x,F,j,Y,te,K,Q,$,q;const ge=s.state;r=s.next_in,$=s.input,a=r+(s.avail_in-5),d=s.next_out,q=s.output,l=d-(i-s.avail_out),h=d+(s.avail_out-257),f=ge.dmax,_=ge.wsize,g=ge.whave,v=ge.wnext,b=ge.window,y=ge.hold,T=ge.bits,M=ge.lencode,O=ge.distcode,D=(1<<ge.lenbits)-1,x=(1<<ge.distbits)-1;e:do{T<15&&(y+=$[r++]<<T,T+=8,y+=$[r++]<<T,T+=8),F=M[y&D];t:for(;;){if(j=F>>>24,y>>>=j,T-=j,j=F>>>16&255,0===j)q[d++]=65535&F;else{if(!(16&j)){if(!(64&j)){F=M[(65535&F)+(y&(1<<j)-1)];continue t}if(32&j){ge.mode=16191;break e}s.msg="invalid literal/length code",ge.mode=Jv;break e}Y=65535&F,j&=15,j&&(T<j&&(y+=$[r++]<<T,T+=8),Y+=y&(1<<j)-1,y>>>=j,T-=j),T<15&&(y+=$[r++]<<T,T+=8,y+=$[r++]<<T,T+=8),F=O[y&x];n:for(;;){if(j=F>>>24,y>>>=j,T-=j,j=F>>>16&255,!(16&j)){if(!(64&j)){F=O[(65535&F)+(y&(1<<j)-1)];continue n}s.msg="invalid distance code",ge.mode=Jv;break e}if(te=65535&F,j&=15,T<j&&(y+=$[r++]<<T,T+=8,T<j&&(y+=$[r++]<<T,T+=8)),te+=y&(1<<j)-1,te>f){s.msg="invalid distance too far back",ge.mode=Jv;break e}if(y>>>=j,T-=j,j=d-l,te>j){if(j=te-j,j>g&&ge.sane){s.msg="invalid distance too far back",ge.mode=Jv;break e}if(K=0,Q=b,0===v){if(K+=_-j,j<Y){Y-=j;do{q[d++]=b[K++]}while(--j);K=d-te,Q=q}}else if(v<j){if(K+=_+v-j,j-=v,j<Y){Y-=j;do{q[d++]=b[K++]}while(--j);if(K=0,v<Y){j=v,Y-=j;do{q[d++]=b[K++]}while(--j);K=d-te,Q=q}}}else if(K+=v-j,j<Y){Y-=j;do{q[d++]=b[K++]}while(--j);K=d-te,Q=q}for(;Y>2;)q[d++]=Q[K++],q[d++]=Q[K++],q[d++]=Q[K++],Y-=3;Y&&(q[d++]=Q[K++],Y>1&&(q[d++]=Q[K++]))}else{K=d-te;do{q[d++]=q[K++],q[d++]=q[K++],q[d++]=q[K++],Y-=3}while(Y>2);Y&&(q[d++]=q[K++],Y>1&&(q[d++]=q[K++]))}break}}break}}while(r<a&&d<h);Y=T>>3,r-=Y,T-=Y<<3,y&=(1<<T)-1,s.next_in=r,s.next_out=d,s.avail_in=r<a?a-r+5:5-(r-a),s.avail_out=d<h?h-d+257:257-(d-h),ge.hold=y,ge.bits=T};const oF=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),$N=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Iu=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),XN=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var wu=(s,i,r,a,d,l,h,f)=>{const _=f.bits;let g,v,b,y,T,M,O=0,D=0,x=0,F=0,j=0,Y=0,te=0,K=0,Q=0,$=0,q=null;const ge=new Uint16Array(16),_e=new Uint16Array(16);let Fe,rt,ai,Qt=null;for(O=0;O<=15;O++)ge[O]=0;for(D=0;D<a;D++)ge[i[r+D]]++;for(j=_,F=15;F>=1&&0===ge[F];F--);if(j>F&&(j=F),0===F)return d[l++]=20971520,d[l++]=20971520,f.bits=1,0;for(x=1;x<F&&0===ge[x];x++);for(j<x&&(j=x),K=1,O=1;O<=15;O++)if(K<<=1,K-=ge[O],K<0)return-1;if(K>0&&(0===s||1!==F))return-1;for(_e[1]=0,O=1;O<15;O++)_e[O+1]=_e[O]+ge[O];for(D=0;D<a;D++)0!==i[r+D]&&(h[_e[i[r+D]]++]=D);if(0===s?(q=Qt=h,M=20):1===s?(q=oF,Qt=$N,M=257):(q=Iu,Qt=XN,M=0),$=0,D=0,O=x,T=l,Y=j,te=0,b=-1,Q=1<<j,y=Q-1,1===s&&Q>852||2===s&&Q>592)return 1;for(;;){Fe=O-te,h[D]+1<M?(rt=0,ai=h[D]):h[D]>=M?(rt=Qt[h[D]-M],ai=q[h[D]-M]):(rt=96,ai=0),g=1<<O-te,v=1<<Y,x=v;do{v-=g,d[T+($>>te)+v]=Fe<<24|rt<<16|ai|0}while(0!==v);for(g=1<<O-1;$&g;)g>>=1;if(0!==g?($&=g-1,$+=g):$=0,D++,0==--ge[O]){if(O===F)break;O=i[r+h[D]]}if(O>j&&($&y)!==b){for(0===te&&(te=j),T+=x,Y=O-te,K=1<<Y;Y+te<F&&(K-=ge[Y+te],!(K<=0));)Y++,K<<=1;if(Q+=1<<Y,1===s&&Q>852||2===s&&Q>592)return 1;b=$&y,d[b]=j<<24|Y<<16|T-l|0}}return 0!==$&&(d[T+$]=O-te<<24|64<<16|0),f.bits=j,0};const{Z_FINISH:eb,Z_BLOCK:sF,Z_TREES:Pp,Z_OK:Yc,Z_STREAM_END:tb,Z_NEED_DICT:zB,Z_STREAM_ERROR:fa,Z_DATA_ERROR:aF,Z_MEM_ERROR:JN,Z_BUF_ERROR:cF,Z_DEFLATED:dF}=Rp,ki=16180,Yd=16190,zs=16191,O0=16199,ib=16200,Ti=16209,rb=s=>(s>>>24&255)+(s>>>8&65280)+((65280&s)<<8)+((255&s)<<24);function lF(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const $d=s=>{if(!s)return 1;const i=s.state;return!i||i.strm!==s||i.mode<ki||i.mode>16211?1:0},N0=s=>{if($d(s))return fa;const i=s.state;return s.total_in=s.total_out=i.total=0,s.msg="",i.wrap&&(s.adler=1&i.wrap),i.mode=ki,i.last=0,i.havedict=0,i.flags=-1,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Int32Array(852),i.distcode=i.distdyn=new Int32Array(592),i.sane=1,i.back=-1,Yc},P0=s=>{if($d(s))return fa;const i=s.state;return i.wsize=0,i.whave=0,i.wnext=0,N0(s)},M0=(s,i)=>{let r;if($d(s))return fa;const a=s.state;return i<0?(r=0,i=-i):(r=5+(i>>4),i<48&&(i&=15)),i&&(i<8||i>15)?fa:(null!==a.window&&a.wbits!==i&&(a.window=null),a.wrap=r,a.wbits=i,P0(s))},ZN=(s,i)=>{if(!s)return fa;const r=new lF;s.state=r,r.strm=s,r.window=null,r.mode=ki;const a=M0(s,i);return a!==Yc&&(s.state=null),a};let x0,ob,eP=!0;const tP=s=>{if(eP){x0=new Int32Array(512),ob=new Int32Array(32);let i=0;for(;i<144;)s.lens[i++]=8;for(;i<256;)s.lens[i++]=9;for(;i<280;)s.lens[i++]=7;for(;i<288;)s.lens[i++]=8;for(wu(1,s.lens,0,288,x0,0,s.work,{bits:9}),i=0;i<32;)s.lens[i++]=5;wu(2,s.lens,0,32,ob,0,s.work,{bits:5}),eP=!1}s.lencode=x0,s.lenbits=9,s.distcode=ob,s.distbits=5},u_=(s,i,r,a)=>{let d;const l=s.state;return null===l.window&&(l.wsize=1<<l.wbits,l.wnext=0,l.whave=0,l.window=new Uint8Array(l.wsize)),a>=l.wsize?(l.window.set(i.subarray(r-l.wsize,r),0),l.wnext=0,l.whave=l.wsize):(d=l.wsize-l.wnext,d>a&&(d=a),l.window.set(i.subarray(r-a,r-a+d),l.wnext),(a-=d)?(l.window.set(i.subarray(r-a,r),0),l.wnext=a,l.whave=l.wsize):(l.wnext+=d,l.wnext===l.wsize&&(l.wnext=0),l.whave<l.wsize&&(l.whave+=d))),0};var Vo={inflateReset:P0,inflateReset2:M0,inflateResetKeep:N0,inflateInit:s=>ZN(s,15),inflateInit2:ZN,inflate:(s,i)=>{let r,a,d,l,h,f,_,g,v,b,y,T,M,O,D,x,F,j,Y,te,K,Q,$=0;const q=new Uint8Array(4);let ge,_e;const Fe=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if($d(s)||!s.output||!s.input&&0!==s.avail_in)return fa;r=s.state,r.mode===zs&&(r.mode=16192),h=s.next_out,d=s.output,_=s.avail_out,l=s.next_in,a=s.input,f=s.avail_in,g=r.hold,v=r.bits,b=f,y=_,Q=Yc;e:for(;;)switch(r.mode){case ki:if(0===r.wrap){r.mode=16192;break}for(;v<16;){if(0===f)break e;f--,g+=a[l++]<<v,v+=8}if(2&r.wrap&&35615===g){0===r.wbits&&(r.wbits=15),r.check=0,q[0]=255&g,q[1]=g>>>8&255,r.check=Sr(r.check,q,2,0),g=0,v=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&g)<<8)+(g>>8))%31){s.msg="incorrect header check",r.mode=Ti;break}if((15&g)!==dF){s.msg="unknown compression method",r.mode=Ti;break}if(g>>>=4,v-=4,K=8+(15&g),0===r.wbits&&(r.wbits=K),K>15||K>r.wbits){s.msg="invalid window size",r.mode=Ti;break}r.dmax=1<<r.wbits,r.flags=0,s.adler=r.check=1,r.mode=512&g?16189:zs,g=0,v=0;break;case 16181:for(;v<16;){if(0===f)break e;f--,g+=a[l++]<<v,v+=8}if(r.flags=g,(255&r.flags)!==dF){s.msg="unknown compression method",r.mode=Ti;break}if(57344&r.flags){s.msg="unknown header flags set",r.mode=Ti;break}r.head&&(r.head.text=g>>8&1),512&r.flags&&4&r.wrap&&(q[0]=255&g,q[1]=g>>>8&255,r.check=Sr(r.check,q,2,0)),g=0,v=0,r.mode=16182;case 16182:for(;v<32;){if(0===f)break e;f--,g+=a[l++]<<v,v+=8}r.head&&(r.head.time=g),512&r.flags&&4&r.wrap&&(q[0]=255&g,q[1]=g>>>8&255,q[2]=g>>>16&255,q[3]=g>>>24&255,r.check=Sr(r.check,q,4,0)),g=0,v=0,r.mode=16183;case 16183:for(;v<16;){if(0===f)break e;f--,g+=a[l++]<<v,v+=8}r.head&&(r.head.xflags=255&g,r.head.os=g>>8),512&r.flags&&4&r.wrap&&(q[0]=255&g,q[1]=g>>>8&255,r.check=Sr(r.check,q,2,0)),g=0,v=0,r.mode=16184;case 16184:if(1024&r.flags){for(;v<16;){if(0===f)break e;f--,g+=a[l++]<<v,v+=8}r.length=g,r.head&&(r.head.extra_len=g),512&r.flags&&4&r.wrap&&(q[0]=255&g,q[1]=g>>>8&255,r.check=Sr(r.check,q,2,0)),g=0,v=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&r.flags&&(T=r.length,T>f&&(T=f),T&&(r.head&&(K=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(a.subarray(l,l+T),K)),512&r.flags&&4&r.wrap&&(r.check=Sr(r.check,a,T,l)),f-=T,l+=T,r.length-=T),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&r.flags){if(0===f)break e;T=0;do{K=a[l+T++],r.head&&K&&r.length<65536&&(r.head.name+=String.fromCharCode(K))}while(K&&T<f);if(512&r.flags&&4&r.wrap&&(r.check=Sr(r.check,a,T,l)),f-=T,l+=T,K)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&r.flags){if(0===f)break e;T=0;do{K=a[l+T++],r.head&&K&&r.length<65536&&(r.head.comment+=String.fromCharCode(K))}while(K&&T<f);if(512&r.flags&&4&r.wrap&&(r.check=Sr(r.check,a,T,l)),f-=T,l+=T,K)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&r.flags){for(;v<16;){if(0===f)break e;f--,g+=a[l++]<<v,v+=8}if(4&r.wrap&&g!==(65535&r.check)){s.msg="header crc mismatch",r.mode=Ti;break}g=0,v=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),s.adler=r.check=0,r.mode=zs;break;case 16189:for(;v<32;){if(0===f)break e;f--,g+=a[l++]<<v,v+=8}s.adler=r.check=rb(g),g=0,v=0,r.mode=Yd;case Yd:if(0===r.havedict)return s.next_out=h,s.avail_out=_,s.next_in=l,s.avail_in=f,r.hold=g,r.bits=v,zB;s.adler=r.check=1,r.mode=zs;case zs:if(i===sF||i===Pp)break e;case 16192:if(r.last){g>>>=7&v,v-=7&v,r.mode=16206;break}for(;v<3;){if(0===f)break e;f--,g+=a[l++]<<v,v+=8}switch(r.last=1&g,g>>>=1,v-=1,3&g){case 0:r.mode=16193;break;case 1:if(tP(r),r.mode=O0,i===Pp){g>>>=2,v-=2;break e}break;case 2:r.mode=16196;break;case 3:s.msg="invalid block type",r.mode=Ti}g>>>=2,v-=2;break;case 16193:for(g>>>=7&v,v-=7&v;v<32;){if(0===f)break e;f--,g+=a[l++]<<v,v+=8}if((65535&g)!=(g>>>16^65535)){s.msg="invalid stored block lengths",r.mode=Ti;break}if(r.length=65535&g,g=0,v=0,r.mode=16194,i===Pp)break e;case 16194:r.mode=16195;case 16195:if(T=r.length,T){if(T>f&&(T=f),T>_&&(T=_),0===T)break e;d.set(a.subarray(l,l+T),h),f-=T,l+=T,_-=T,h+=T,r.length-=T;break}r.mode=zs;break;case 16196:for(;v<14;){if(0===f)break e;f--,g+=a[l++]<<v,v+=8}if(r.nlen=257+(31&g),g>>>=5,v-=5,r.ndist=1+(31&g),g>>>=5,v-=5,r.ncode=4+(15&g),g>>>=4,v-=4,r.nlen>286||r.ndist>30){s.msg="too many length or distance symbols",r.mode=Ti;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;v<3;){if(0===f)break e;f--,g+=a[l++]<<v,v+=8}r.lens[Fe[r.have++]]=7&g,g>>>=3,v-=3}for(;r.have<19;)r.lens[Fe[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,ge={bits:r.lenbits},Q=wu(0,r.lens,0,19,r.lencode,0,r.work,ge),r.lenbits=ge.bits,Q){s.msg="invalid code lengths set",r.mode=Ti;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;$=r.lencode[g&(1<<r.lenbits)-1],D=$>>>24,x=$>>>16&255,F=65535&$,!(D<=v);){if(0===f)break e;f--,g+=a[l++]<<v,v+=8}if(F<16)g>>>=D,v-=D,r.lens[r.have++]=F;else{if(16===F){for(_e=D+2;v<_e;){if(0===f)break e;f--,g+=a[l++]<<v,v+=8}if(g>>>=D,v-=D,0===r.have){s.msg="invalid bit length repeat",r.mode=Ti;break}K=r.lens[r.have-1],T=3+(3&g),g>>>=2,v-=2}else if(17===F){for(_e=D+3;v<_e;){if(0===f)break e;f--,g+=a[l++]<<v,v+=8}g>>>=D,v-=D,K=0,T=3+(7&g),g>>>=3,v-=3}else{for(_e=D+7;v<_e;){if(0===f)break e;f--,g+=a[l++]<<v,v+=8}g>>>=D,v-=D,K=0,T=11+(127&g),g>>>=7,v-=7}if(r.have+T>r.nlen+r.ndist){s.msg="invalid bit length repeat",r.mode=Ti;break}for(;T--;)r.lens[r.have++]=K}}if(r.mode===Ti)break;if(0===r.lens[256]){s.msg="invalid code -- missing end-of-block",r.mode=Ti;break}if(r.lenbits=9,ge={bits:r.lenbits},Q=wu(1,r.lens,0,r.nlen,r.lencode,0,r.work,ge),r.lenbits=ge.bits,Q){s.msg="invalid literal/lengths set",r.mode=Ti;break}if(r.distbits=6,r.distcode=r.distdyn,ge={bits:r.distbits},Q=wu(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,ge),r.distbits=ge.bits,Q){s.msg="invalid distances set",r.mode=Ti;break}if(r.mode=O0,i===Pp)break e;case O0:r.mode=ib;case ib:if(f>=6&&_>=258){s.next_out=h,s.avail_out=_,s.next_in=l,s.avail_in=f,r.hold=g,r.bits=v,Qv(s,y),h=s.next_out,d=s.output,_=s.avail_out,l=s.next_in,a=s.input,f=s.avail_in,g=r.hold,v=r.bits,r.mode===zs&&(r.back=-1);break}for(r.back=0;$=r.lencode[g&(1<<r.lenbits)-1],D=$>>>24,x=$>>>16&255,F=65535&$,!(D<=v);){if(0===f)break e;f--,g+=a[l++]<<v,v+=8}if(x&&!(240&x)){for(j=D,Y=x,te=F;$=r.lencode[te+((g&(1<<j+Y)-1)>>j)],D=$>>>24,x=$>>>16&255,F=65535&$,!(j+D<=v);){if(0===f)break e;f--,g+=a[l++]<<v,v+=8}g>>>=j,v-=j,r.back+=j}if(g>>>=D,v-=D,r.back+=D,r.length=F,0===x){r.mode=16205;break}if(32&x){r.back=-1,r.mode=zs;break}if(64&x){s.msg="invalid literal/length code",r.mode=Ti;break}r.extra=15&x,r.mode=16201;case 16201:if(r.extra){for(_e=r.extra;v<_e;){if(0===f)break e;f--,g+=a[l++]<<v,v+=8}r.length+=g&(1<<r.extra)-1,g>>>=r.extra,v-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;$=r.distcode[g&(1<<r.distbits)-1],D=$>>>24,x=$>>>16&255,F=65535&$,!(D<=v);){if(0===f)break e;f--,g+=a[l++]<<v,v+=8}if(!(240&x)){for(j=D,Y=x,te=F;$=r.distcode[te+((g&(1<<j+Y)-1)>>j)],D=$>>>24,x=$>>>16&255,F=65535&$,!(j+D<=v);){if(0===f)break e;f--,g+=a[l++]<<v,v+=8}g>>>=j,v-=j,r.back+=j}if(g>>>=D,v-=D,r.back+=D,64&x){s.msg="invalid distance code",r.mode=Ti;break}r.offset=F,r.extra=15&x,r.mode=16203;case 16203:if(r.extra){for(_e=r.extra;v<_e;){if(0===f)break e;f--,g+=a[l++]<<v,v+=8}r.offset+=g&(1<<r.extra)-1,g>>>=r.extra,v-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){s.msg="invalid distance too far back",r.mode=Ti;break}r.mode=16204;case 16204:if(0===_)break e;if(T=y-_,r.offset>T){if(T=r.offset-T,T>r.whave&&r.sane){s.msg="invalid distance too far back",r.mode=Ti;break}T>r.wnext?(T-=r.wnext,M=r.wsize-T):M=r.wnext-T,T>r.length&&(T=r.length),O=r.window}else O=d,M=h-r.offset,T=r.length;T>_&&(T=_),_-=T,r.length-=T;do{d[h++]=O[M++]}while(--T);0===r.length&&(r.mode=ib);break;case 16205:if(0===_)break e;d[h++]=r.length,_--,r.mode=ib;break;case 16206:if(r.wrap){for(;v<32;){if(0===f)break e;f--,g|=a[l++]<<v,v+=8}if(y-=_,s.total_out+=y,r.total+=y,4&r.wrap&&y&&(s.adler=r.check=r.flags?Sr(r.check,d,y,h-y):o_(r.check,d,y,h-y)),y=_,4&r.wrap&&(r.flags?g:rb(g))!==r.check){s.msg="incorrect data check",r.mode=Ti;break}g=0,v=0}r.mode=16207;case 16207:if(r.wrap&&r.flags){for(;v<32;){if(0===f)break e;f--,g+=a[l++]<<v,v+=8}if(4&r.wrap&&g!==(4294967295&r.total)){s.msg="incorrect length check",r.mode=Ti;break}g=0,v=0}r.mode=16208;case 16208:Q=tb;break e;case Ti:Q=aF;break e;case 16210:return JN;default:return fa}return s.next_out=h,s.avail_out=_,s.next_in=l,s.avail_in=f,r.hold=g,r.bits=v,(r.wsize||y!==s.avail_out&&r.mode<Ti&&(r.mode<16206||i!==eb))&&u_(s,s.output,s.next_out,y-s.avail_out),b-=s.avail_in,y-=s.avail_out,s.total_in+=b,s.total_out+=y,r.total+=y,4&r.wrap&&y&&(s.adler=r.check=r.flags?Sr(r.check,d,y,s.next_out-y):o_(r.check,d,y,s.next_out-y)),s.data_type=r.bits+(r.last?64:0)+(r.mode===zs?128:0)+(r.mode===O0||16194===r.mode?256:0),(0===b&&0===y||i===eb)&&Q===Yc&&(Q=cF),Q},inflateEnd:s=>{if($d(s))return fa;let i=s.state;return i.window&&(i.window=null),s.state=null,Yc},inflateGetHeader:(s,i)=>{if($d(s))return fa;const r=s.state;return 2&r.wrap?(r.head=i,i.done=!1,Yc):fa},inflateSetDictionary:(s,i)=>{const r=i.length;let a,d,l;return $d(s)?fa:(a=s.state,0!==a.wrap&&a.mode!==Yd?fa:a.mode===Yd&&(d=1,d=o_(d,i,r,0),d!==a.check)?aF:(l=u_(s,i,r,r),l?(a.mode=16210,JN):(a.havedict=1,Yc)))},inflateInfo:"pako inflate (from Nodeca project)"},nP=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const uF=Object.prototype.toString,{Z_NO_FLUSH:qB,Z_FINISH:KB,Z_OK:p_,Z_STREAM_END:k0,Z_NEED_DICT:iP,Z_STREAM_ERROR:rP,Z_DATA_ERROR:L0,Z_MEM_ERROR:YB}=Rp;function Ru(s){this.options=Yv.assign({chunkSize:65536,windowBits:15,to:""},s||{});const i=this.options;i.raw&&i.windowBits>=0&&i.windowBits<16&&(i.windowBits=-i.windowBits,0===i.windowBits&&(i.windowBits=-15)),!(i.windowBits>=0&&i.windowBits<16)||s&&s.windowBits||(i.windowBits+=32),i.windowBits>15&&i.windowBits<48&&!(15&i.windowBits)&&(i.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $v,this.strm.avail_out=0;let r=Vo.inflateInit2(this.strm,i.windowBits);if(r!==p_)throw new Error(zd[r]);if(this.header=new nP,Vo.inflateGetHeader(this.strm,this.header),i.dictionary&&("string"==typeof i.dictionary?i.dictionary=l_.string2buf(i.dictionary):"[object ArrayBuffer]"===uF.call(i.dictionary)&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw&&(r=Vo.inflateSetDictionary(this.strm,i.dictionary),r!==p_)))throw new Error(zd[r])}function oP(s,i){const r=new Ru(i);if(r.push(s),r.err)throw r.msg||zd[r.err];return r.result}Ru.prototype.push=function(s,i){const r=this.strm,a=this.options.chunkSize,d=this.options.dictionary;let l,h,f;if(this.ended)return!1;for(h=i===~~i?i:!0===i?KB:qB,r.input="[object ArrayBuffer]"===uF.call(s)?new Uint8Array(s):s,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(a),r.next_out=0,r.avail_out=a),l=Vo.inflate(r,h),l===iP&&d&&(l=Vo.inflateSetDictionary(r,d),l===p_?l=Vo.inflate(r,h):l===L0&&(l=iP));r.avail_in>0&&l===k0&&r.state.wrap>0&&0!==s[r.next_in];)Vo.inflateReset(r),l=Vo.inflate(r,h);switch(l){case rP:case L0:case iP:case YB:return this.onEnd(l),this.ended=!0,!1}if(f=r.avail_out,r.next_out&&(0===r.avail_out||l===k0))if("string"===this.options.to){let _=l_.utf8border(r.output,r.next_out),g=r.next_out-_,v=l_.buf2string(r.output,_);r.next_out=g,r.avail_out=a-g,g&&r.output.set(r.output.subarray(_,_+g),0),this.onData(v)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(l!==p_||0!==f){if(l===k0)return l=Vo.inflateEnd(this.strm),this.onEnd(l),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},Ru.prototype.onData=function(s){this.chunks.push(s)},Ru.prototype.onEnd=function(s){s===p_&&(this.result="string"===this.options.to?this.chunks.join(""):Yv.flattenChunks(this.chunks)),this.chunks=[],this.err=s,this.msg=this.strm.msg};var $B={Inflate:Ru,inflate:oP,inflateRaw:function(s,i){return(i=i||{}).raw=!0,oP(s,i)},ungzip:oP,constants:Rp};const{deflate:hF}=WB,{inflate:QB}=$B;var sP,fF=hF,aP=QB;!function(s){s[s.ONE_BYTE=0]="ONE_BYTE",s[s.TWO_BYTE=1]="TWO_BYTE"}(sP||(sP={}));class ej{constructor(){C(this,"_sequence",0),C(this,"_startTime",Date.now()),C(this,"isUseOneByte",!0)}get startTime(){const i=Date.now()-this._startTime;return i<Math.pow(2,16)?i:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(i){const r={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:i};if(i.byteLength>128){const f=new Uint8Array(4);f.set([1,0,0,0]);const g={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[{id:0,length:4,data:f.buffer}]};r.commonPacketHeader.extension=1,r.extension=g,r.payload=this.compress(i),r.commonPacketHeader.length=8+(r.extension.length+2)+r.payload.byteLength}else r.commonPacketHeader.length=8+r.payload.byteLength;B("SHOW_DATASTREAM2_LOG")&&I.debug("send data header: ".concat(JSON.stringify(r.commonPacketHeader)));const a=new ArrayBuffer(r.commonPacketHeader.length),d=new Uint8Array(a),l=new DataView(a);let h=0;if(l.setUint16(h,r.commonPacketHeader.extension<<15|r.commonPacketHeader.reserved<<14|r.commonPacketHeader.length,!0),h+=2,l.setUint32(h,r.commonPacketHeader.sequence,!0),h+=4,l.setUint16(h,r.commonStreamHeader,!0),h+=2,r.extension){const f=this.serializeExtension(r.extension);d.set(new Uint8Array(f),h),h+=f.byteLength}if(d.set(new Uint8Array(r.payload),h),h+=r.payload.byteLength,h!==r.commonPacketHeader.length)throw Error("serialize error!");return a}deserialize(i){if(i.byteLength<4)return new ArrayBuffer(0);const r=new DataView(i);let a=0;const d=r.getUint16(a,!0);a+=2;const l={length:16383&d,reserved:(16384&d)>>14,extension:(32768&d)>>15,sequence:r.getUint16(a+2,!0)<<16|r.getUint16(a,!0)};let h,f;if(a+=4,B("SHOW_DATASTREAM2_LOG")&&I.debug("receive data header: ".concat(JSON.stringify(l))),r.getUint16(a,!0),a+=2,l.extension){f=this.deserializeExtension(i.slice(a)),a+=2+f.length,h=i.slice(a);let _=!1;if(f.datas.length>0){const g=f.datas.find(v=>0===v.id);g&&(_=1==(1&new DataView(g.data).getUint32(0,!0)))}h=_?this.decompress(h):h}else h=i.slice(8);return h}serializeExtension(i){const{profile:r,length:a,datas:d}=i,l=new ArrayBuffer(a+2),h=new Uint8Array(l),f=new DataView(l);let _=0;if(f.setUint8(_++,r),f.setUint8(_++,a),d.forEach(g=>{r?(f.setUint8(_++,g.id),f.setUint8(_++,g.length),h.set(new Uint8Array(g.data),_),_+=g.data.byteLength):(f.setUint8(_++,g.id|g.length<<4),h.set(new Uint8Array(g.data),_),_+=g.data.byteLength)}),_!==a+2)throw Error("serialize extension error, is ".concat(_,"!==").concat(a+2));return l}deserializeExtension(i){const r=new DataView(i);let a=0;const d=r.getUint8(a);a++;const l=r.getUint8(a);a++;const h=d===sP.TWO_BYTE,f=[],_=new DataView(i,2);let g=0;for(;g<l;){let v=0,b=0,y=new ArrayBuffer(0);h?(v=_.getUint8(g),g++,b=_.getUint8(g),g++):(v=15&_.getUint8(g),b=_.getUint8(g)>>4,g++),b>0&&(y=_.buffer.slice(g+2,g+2+b),g+=y.byteLength),f.push({id:v,length:b,data:y})}if(g!==l)throw Error("parse error");return{profile:d,length:l,datas:f}}decompress(i){return aP(new Uint8Array(i))}compress(i){return fF(new Uint8Array(i))}}class cP extends jt{constructor(i,r){super(),C(this,"_version",1),C(this,"_type",3),C(this,"_config",void 0),C(this,"_originDataChannel",void 0),C(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),C(this,"_dataStreamPacketHandler",void 0),C(this,"_datachannelEventMap",new Map),this._config=i,r&&(this._originDataChannel=r,this._bandDataChannelEvents(r)),this._initPacketHeader(),this._dataStreamPacketHandler=new ej}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return B("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var i,r;return null!==(i=null===(r=this._originDataChannel)||void 0===r?void 0:r.readyState)&&void 0!==i?i:"connecting"}get _originDataChannelId(){var i,r;return null!==(i=null===(r=this._originDataChannel)||void 0===r?void 0:r.id)&&void 0!==i?i:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}_waitTillOpen(){var i=this;return L(function*(){return new X((r,a)=>{if(i._originDataChannel){"open"===i._originDataChannel.readyState&&r();const d=setTimeout(()=>{var l;a(new ee(k.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(l=i._originDataChannel)||void 0===l?void 0:l.id)))},1e4);i._originDataChannel.onopen=()=>{clearTimeout(d),i._originDataChannel&&i._bandDataChannelEvents(i._originDataChannel),r()},i._originDataChannel.onerror=()=>{throw clearTimeout(d),new ee(k.DATACHANNEL_CONNECTION_TIMEOUT)}}else a(new ee(k.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})})()}_updateOriginDataChannel(i){this._originDataChannel=i,this._bandDataChannelEvents(i)}_initPacketHeader(){const i=new DataView(this._dataStreamPacketHeader);i.setUint16(0,this._version),i.setUint8(2,this._type),i.setUint8(3,this._config.id)}_bandDataChannelEvents(i){this._unbindDataChannelEvents(i),[Ep.OPEN,Ep.CLOSE,Ep.ERROR].forEach(r=>{const a=()=>{this.emit(r)};this._datachannelEventMap.set(r,a),i.addEventListener(r,a)})}_unbindDataChannelEvents(i){Array.from(this._datachannelEventMap.entries()).forEach(r=>{let[a,d]=r;i.removeEventListener(a,d)}),this._datachannelEventMap.clear()}}class mF extends cP{constructor(i){super(i),C(this,"_messageListener",void 0),this._messageListener=r=>{if(r.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const a=r.data.slice(0,this._dataStreamPacketHeader.byteLength),d=new DataView(a).getUint8(3);if(d!==this.id)return void(B("SHOW_DATASTREAM2_LOG")&&I.debug("invalid datachannel id: ".concat(d," !== ").concat(this.id)));let l=r.data.slice(this._dataStreamPacketHeader.byteLength);l=this._dataStreamPacketHandler.deserialize(l),this.emit(Ep.MESSAGE,l)}}_updateOriginDataChannel(i){super._updateOriginDataChannel(i),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class _F extends cP{send(i){if(this._originDataChannel){let r=i;r=this._dataStreamPacketHandler.serialize(i);const a=new Uint8Array(this._dataStreamPacketHeader.byteLength+r.byteLength);a.set(new Uint8Array(this._dataStreamPacketHeader),0),a.set(new Uint8Array(r),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(a.buffer)}}}!function(){const s=lt();Ui.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Ui.getStreamFromExtension=s.name===gt.CHROME&&Number(s.version)>34,Ui.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const i=new RTCPeerConnection;let r=!1;try{i.addTransceiver("audio"),r=!0}catch{}return i.close(),r}(),Ui.supportMinBitrate=s.name===gt.CHROME||s.name===gt.EDGE,Ui.supportSetRtpSenderParameters=function(){const i=lt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Rd()||!(!fr()&&!KE())||i.name===gt.FIREFOX&&Number(i.version)>=64)}(),s.name===gt.SAFARI&&(Ui.supportDualStream=Number(s.version)>=14),Ui.webAudioMediaStreamDest=function(){const i=lt();return!(i.name===gt.SAFARI&&Number(i.version)<12)}(),Ui.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,Ui.supportWebGL=typeof WebGLRenderingContext<"u",Ui.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Rd()||(Ui.webAudioWithAEC=!0),Ui.supportShareAudio=function(){const i=lt();return(i.os===Zn.WIN_10||i.os===Zn.WIN_81||i.os===Zn.WIN_7||i.os===Zn.LINUX||i.os===Zn.MAC_OS||i.os===Zn.CHROMIUM_OS)&&i.name===gt.CHROME&&Number(i.version)>=74}(),Ui.supportDataChannel=!!(hm(76)||function(i){const r=lt();return!(r.name!==gt.FIREFOX||!r.osVersion)&&Number(r.version)>=68}()||function(i){const r=lt();return!(r.name!==gt.SAFARI||!r.osVersion)&&Number(r.version)>=14}()),Ui.supportPCSetConfiguration=function(){const i=window.RTCPeerConnection;return!Pt()&&!!i&&i.prototype.setConfiguration instanceof Function}(),Ui.supportWebRTCEncodedTransform=function(){const i=lt();return"Chrome"===i.name&&Number(i.version)>=86}(),Ui.supportWebRTCInsertableStream=function(){const i=lt();return(i.name===gt.CHROME||i.name===gt.EDGE)&&Number(i.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),_m(()=>{Ui.supportDualStreamEncoding=function(){const i=lt();return!!B("DISABLE_WEBAUDIO")||"Safari"===i.name&&Number(i.version)>=14||!!("Chrome"===i.name&&/Windows/i.test(i.os||"")&&Number(i.version)>=100&&B("CHROME_DUAL_STREAM_USE_ENCODING"))}(),I.info("browser compatibility",JSON.stringify(Ui),JSON.stringify(s))})}();class gF extends jt{constructor(){super(...arguments),C(this,"resultStorage",new Map)}setLocalAudioStats(i,r,a){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",i,this.checkAudioInputLevel(a,r)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",i,this.checkSendAudioBitrate(a,r))}setLocalVideoStats(i,r,a){this.record("SEND_VIDEO_BITRATE_TOO_LOW",i,this.checkSendVideoBitrate(a,r)),this.record("FRAMERATE_INPUT_TOO_LOW",i,this.checkFramerateInput(a,r)),this.record("FRAMERATE_SENT_TOO_LOW",i,this.checkFramerateSent(a))}setRemoteAudioStats(i,r){const a=i.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",a,this.checkAudioOutputLevel(r))}setRemoteVideoStats(i,r){const a=i.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",a,this.checkVideoDecode(r))}record(i,r,a){if(B("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(i)||this.resultStorage.set(i,{result:[],isPrevNormal:!0});const d=this.resultStorage.get(i);if(d&&(d.result.push(a),d.result.length>=5)){var l;const h=ye(l=d.result).call(l,!0);d.isPrevNormal&&!h&&this.emit("exception",EF[i],i,r),!d.isPrevNormal&&h&&this.emit("exception",EF[i]+2e3,i+"_RECOVER",r),d.isPrevNormal=h,d.result=[]}}checkAudioOutputLevel(i){return!(i.receiveBitrate>0&&0===i.receiveLevel)}checkAudioInputLevel(i,r){return r instanceof jn&&!r.isActive||!!r.muted||0!==i.sendVolumeLevel}checkFramerateInput(i,r){let a=null;r._encoderConfig&&r._encoderConfig.frameRate&&(a=No(r._encoderConfig.frameRate));const d=i.captureFrameRate;return!a||!d||!(a>10&&d<5||a<10&&a>=5&&d<=1)}checkFramerateSent(i){return!(i.captureFrameRate&&i.sendFrameRate&&i.captureFrameRate>5&&i.sendFrameRate<=1)}checkSendVideoBitrate(i,r){return!!r.muted||0!==i.sendBitrate}checkSendAudioBitrate(i,r){return r instanceof jn&&!r.isActive||!!r.muted||0!==i.sendBitrate}checkVideoDecode(i){return 0===i.receiveBitrate||0!==i.decodeFrameRate}}const EF={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Li=new class{markSubscribeStart(s,i){performance.mark("agora-web-sdk/".concat(s,"/subscribe-").concat(i))}markPublishStart(s,i){performance.mark("agora-web-sdk/".concat(s,"/publish-").concat(i))}measureFromSubscribeStart(s,i){const r=performance.getEntriesByName("agora-web-sdk/".concat(s,"/subscribe-").concat(i));if(r.length>0){const a=r[r.length-1];return Math.round(performance.now()-a.startTime)}return 0}measureFromPublishStart(s,i){const r=performance.getEntriesByName("agora-web-sdk/".concat(s,"/publish-").concat(i));if(r.length>0){const a=r[r.length-1];return Math.round(performance.now()-a.startTime)}return 0}};function F0(s,i){this.v=s,this.k=i}function Be(s){return new F0(s,0)}var dP=TD,lP=Ni;Bt({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var s=lP.f(this);return{promise:s.promise,resolve:s.resolve,reject:s.reject}}});var vF=Ni,uP=La;Bt({target:"Promise",stat:!0,forced:!0},{try:function(s){var i=vF.f(this),r=uP(s);return(r.error?i.reject:i.resolve)(r.value),i.promise}});var sb=Rt(dP),bF=ta.f("asyncIterator"),yF=Rt(bF);function Xd(s){var i,r;function a(l,h){try{var f=s[l](h),_=f.value,g=_ instanceof F0;sb.resolve(g?_.v:_).then(function(v){if(g){var b="return"===l?"return":"next";if(!_.k||v.done)return a(b,v);v=s[b](v).value}d(f.done?"return":"normal",v)},function(v){a("throw",v)})}catch(v){d("throw",v)}}function d(l,h){switch(l){case"return":i.resolve({value:h,done:!0});break;case"throw":i.reject(h);break;default:i.resolve({value:h,done:!1})}(i=i.next)?a(i.key,i.arg):r=null}this._invoke=function(l,h){return new sb(function(f,_){var g={key:l,arg:h,resolve:f,reject:_,next:null};r?r=r.next=g:(i=r=g,a(l,h))})},"function"!=typeof s.return&&(this.return=void 0)}function Xr(s){return function(){return new Xd(s.apply(this,arguments))}}Xd.prototype["function"==typeof Ls&&yF||"@@asyncIterator"]=function(){return this},Xd.prototype.next=function(s){return this._invoke("next",s)},Xd.prototype.throw=function(s){return this._invoke("throw",s)},Xd.prototype.return=function(s){return this._invoke("return",s)};var U0=Rt(Os.Object.getOwnPropertySymbols),SF=Bt,CF=lg.indexOf,ab=EE,V0=dc([].indexOf),hP=!!V0&&1/V0([1],1,-0)<0;SF({target:"Array",proto:!0,forced:hP||!ab("indexOf")},{indexOf:function(s){var i=arguments.length>1?arguments[1]:void 0;return hP?V0(this,s,i)||0:CF(this,s,i)}});var pP=hc("Array").indexOf,tj=Ds,TF=pP,fP=Array.prototype,mP=Rt(function(s){var i=s.indexOf;return s===fP||tj(fP,s)&&i===fP.indexOf?TF:i}),nj=bl,IF=yf;Bt({target:"Object",stat:!0,forced:an(function(){IF(1)})},{keys:function(s){return IF(nj(s))}});var wF=Rt(Os.Object.keys);var _P={exports:{}};!function(s,i){s.exports=(()=>{var r={8:(l,h,f)=>{f.r(h),f.d(h,{Parser:()=>_e,Printer:()=>Fi,parse:()=>ke,print:()=>ht});const _="\n",g="".concat("\r").concat(_),v=" ";let b;function y(fe){return fe>="0"&&fe<="9"}function T(fe){return fe>="!"&&fe<="~"}function M(fe){return T(fe)||fe>="\x80"&&fe<="\xff"}function O(fe){return"!"===fe||fe>="#"&&fe<="'"||fe>="*"&&fe<="+"||fe>="-"&&fe<="."||fe>="0"&&fe<="9"||fe>="A"&&fe<="Z"||fe>="^"&&fe<="~"}function D(fe){return fe>="1"&&fe<="9"}function x(fe){return fe>="A"&&fe<="Z"||fe>="a"&&fe<="z"}function F(fe){return"d"===fe||"h"===fe||"m"===fe||"s"===fe}function j(fe){return fe>"\x01"&&fe<"\t"||fe>"\v"&&fe<"\f"||fe>"\x0e"&&fe<"\xff"}function Y(fe){return x(fe)||y(fe)||"+"===fe||"/"===fe}function te(fe){return y(fe)||x(fe)||"+"===fe||"/"===fe||"-"===fe||"_"===fe}function K(fe){return x(fe)||y(fe)||"+"===fe||"/"===fe}function Q(fe,R){var U=Object.keys(fe);if(Object.getOwnPropertySymbols){var G=Object.getOwnPropertySymbols(fe);R&&(G=G.filter(function(se){return Object.getOwnPropertyDescriptor(fe,se).enumerable})),U.push.apply(U,G)}return U}function $(fe){for(var R=1;R<arguments.length;R++){var U=null!=arguments[R]?arguments[R]:{};R%2?Q(Object(U),!0).forEach(function(G){q(fe,G,U[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(fe,Object.getOwnPropertyDescriptors(U)):Q(Object(U)).forEach(function(G){Object.defineProperty(fe,G,Object.getOwnPropertyDescriptor(U,G))})}return fe}function q(fe,R,U){return R in fe?Object.defineProperty(fe,R,{value:U,enumerable:!0,configurable:!0,writable:!0}):fe[R]=U,fe}var fe;(fe=b||(b={})).VERSION="v",fe.ORIGIN="o",fe.SESSION_NAME="s",fe.INFORMATION="i",fe.URI="u",fe.EMAIL="e",fe.PHONE="p",fe.CONNECTION="c",fe.BANDWIDTH="b",fe.TIME="t",fe.REPEAT="r",fe.ZONE_ADJUSTMENTS="z",fe.KEY="k",fe.ATTRIBUTE="a",fe.MEDIA="m";class ge{consumeText(R,U){let G=U;for(;G<R.length;){const se=R[G];if("\0"===se||"\r"===se||se===_)break;G+=1}if(G-U==0)throw new Error("Invalid text, at ".concat(R));return G}consumeUnicastAddress(R,U,G){return this.consumeTill(R,U,v)}consumeOneOrMore(R,U,G){let se=U;for(;G(R[se]);)se++;if(se-U==0)throw new Error("Invalid rule at ".concat(U,"."));return se}consumeSpace(R,U){if(R[U]===v)return U+1;throw new Error("Invalid space at ".concat(U,"."))}consumeIP4Address(R,U){let G=U;for(let se=0;se<4;se++)if(G=this.consumeDecimalUChar(R,G),3!==se){if("."!==R[G])throw new Error("Invalid IP4 address.");G++}return G}consumeDecimalUChar(R,U){let G=U;for(let Ue=0;Ue<3&&y(R[G]);Ue++,G++);if(G-U==0)throw new Error("Invalid decimal uchar.");const se=parseInt(R.slice(U,G));if(se>=0&&se<=255)return G;throw new Error("Invalid decimal uchar")}consumeIP6Address(R,U){let G=this.consumeHexpart(R,U);return":"===R[G]&&(G+=1,G=this.consumeIP4Address(R,G)),G}consumeHexpart(R,U){let G=U;if(":"===R[G]&&":"===R[G+1]){G+=2;try{G=this.consumeHexseq(R,G)}catch{}return G}if(G=this.consumeHexseq(R,G),":"===R[G]&&":"===R[G+1]){G+=2;try{G=this.consumeHexseq(R,G)}catch{}return G}return G}consumeHexseq(R,U){let G=U;for(;G=this.consumeHex4(R,G),":"===R[G]&&":"!==R[G+1];)G+=1;return G}consumeHex4(R,U){let G=0;for(;G<4;G++)if(!((se=R[U+G])>="0"&&se<="9"||se>="a"&&se<="f"||se>="A"&&se<="F")){if(0===G)throw new Error("Invalid hex 4");break}var se;return U+G}consumeFQDN(R,U){let G=U;for(;y(R[G])||x(R[G])||"-"===R[G]||"."===R[G];)G+=1;if(G-U<4)throw new Error("Invalid FQDN");return G}consumeExtnAddr(R,U){return this.consumeOneOrMore(R,U,M)}consumeMulticastAddress(R,U,G){switch(G){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(R,U);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(R,U);default:try{return this.consumeFQDN(R,U)}catch{return this.consumeExtnAddr(R,U)}}}consumeIP6MulticastAddress(R,U){const G=this.consumeHexpart(R,U);return"/"===R[G]?this.consumeInteger(R,G+1):G}consumeIP4MulticastAddress(R,U){let G=U+3;const se=R.slice(U,G),Ue=parseInt(se);if(Ue<224||Ue>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Wt=0;Wt<3;Wt++){if("."!==R[G])throw new Error("Invalid IP4 multicast address.");G+=1,G=this.consumeDecimalUChar(R,G)}return"/"===R[G]&&(G+=1),G=this.consumeTTL(R,G),"/"===R[G]&&(G=this.consumeInteger(R,G)),G}consumeInteger(R,U){if(!D(R[U]))throw new Error("Invalid integer.");for(U+=1;y(R[U]);)U+=1;return U}consumeTTL(R,U){if("0"===R[U])return U+1;if(!D(R[U]))throw new Error("Invalid TTL.");U+=1;for(let G=0;G<2&&y(R[U]);G++)U+=1;return U}consumeToken(R,U){return this.consumeOneOrMore(R,U,O)}consumeTime(R,U){let G=U;if("0"===R[G])return G+1;for(D(R[G])&&(G+=1);y(R[G]);)G++;if(G-U<10)throw new Error("Invalid time");return G}consumeAddress(R,U){return this.consumeTill(R,U,v)}consumeTypedTime(R,U){let G=U;return G=this.consumeOneOrMore(R,G,y),F(R[G])?G+1:G}consumeRepeatInterval(R,U){if(!D(R[U]))throw new Error("Invalid repeat interval");for(U+=1;y(R[U]);)U+=1;return F(R[U])&&(U+=1),U}consumePort(R,U){return this.consumeOneOrMore(R,U,y)}consume(R,U,G){for(let se=0;se<G.length;se++){if(U+se>=R.length)throw new Error("consume exceeding value length");if(R[U+se]!==G[se])throw new Error("consume ".concat(G," failed at ").concat(se))}return U+G.length}consumeTill(R,U,G){let se=U;for(;se<R.length&&("string"!=typeof G||R[se]!==G)&&("function"!=typeof G||!G(R[se]));)se++;return se}}class _e extends ge{constructor(){super(),q(this,"records",[]),q(this,"currentLine",0)}parse(R){const U=this.probeEOL(R);this.records=R.split(U).filter(En=>!!En.trim()).map(this.parseLine),this.currentLine=0;const G=this.parseVersion(),se=this.parseOrigin(),Ue=this.parseSessionName(),Wt=this.parseInformation(),er=this.parseUri(),Ho=this.parseEmail(),sl=this.parsePhone(),dI=this.parseConnection(),lI=this.parseBandWidth(),eo=this.parseTimeFields(),Lu=this.parseKey(),Up=this.parseSessionAttribute(),un=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:G,origin:se,sessionName:Ue,information:Wt,uri:er,emails:Ho,phones:sl,connection:dI,bandwidths:lI,timeFields:eo,key:Lu,attributes:Up,mediaDescriptions:un}}getCurrentRecord(){const R=this.records[this.currentLine];if(!R)throw new Error("Record doesn't exit.");return R}probeEOL(R){for(let U=0;U<R.length;U++)if(R[U]===_)return"\r"===R[U-1]?g:_;throw new Error("Invalid newline character.")}parseLine(R,U){if(R.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const G=R[0];if("="!==R[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:G,value:R.slice(2),line:U,cur:0}}parseSessionAttribute(){const R=new rt;for(;this.currentLine<this.records.length;){const U=this.getCurrentRecord();if(U.type!==b.ATTRIBUTE)break;const G={attField:this.extractOneOrMore(U,se=>O(se)&&":"!==se),_cur:0};":"===U.value[U.cur]&&(U.cur+=1,G.attValue=this.extractOneOrMore(U,j)),R.parse(G),this.currentLine++}return R.digest()}parseMediaAttributes(R){const U=new ai(R);for(;this.currentLine<this.records.length;){const G=this.getCurrentRecord();if(G.type!==b.ATTRIBUTE)break;const se={attField:this.extractOneOrMore(G,Ue=>O(Ue)&&":"!==Ue),_cur:0};":"===G.value[G.cur]&&(G.cur+=1,se.attValue=this.extractOneOrMore(G,j)),U.parse(se),this.currentLine++}return U.digest()}parseKey(){const R=this.getCurrentRecord();if(R.type===b.KEY){if("prompt"===R.value||"clear:"===R.value||"base64:"===R.value||"uri:"===R.value)return R.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const R=this.getCurrentRecord();if(R.type===b.ZONE_ADJUSTMENTS){const U=[];for(;;)try{const G=this.extract(R,this.consumeTime);this.consumeSpaceForRecord(R);let se=!1;"-"===R.value[R.cur]&&(se=!0,R.cur+=1);const Ue=this.extract(R,this.consumeTypedTime);U.push({time:G,typedTime:Ue,back:se})}catch{break}if(0===U.length)throw new Error("Invalid zone adjustments");return this.currentLine++,U}return[]}parseRepeat(){const R=[];for(;;){const U=this.getCurrentRecord();if(U.type!==b.REPEAT)break;{const G=this.extract(U,this.consumeRepeatInterval),se=this.parseTypedTime(U);R.push({repeatInterval:G,typedTimes:se}),this.currentLine++}}return R}parseTypedTime(R){const U=[];for(;;)try{this.consumeSpaceForRecord(R),U.push(this.extract(R,this.consumeTypedTime))}catch{break}if(0===U.length)throw new Error("Invalid typed time.");return U}parseTime(){const R=this.getCurrentRecord(),U=this.extract(R,this.consumeTime);this.consumeSpaceForRecord(R);const G=this.extract(R,this.consumeTime);return this.currentLine++,{startTime:U,stopTime:G}}parseBandWidth(){const R=[];for(;this.currentLine<this.records.length;){const U=this.getCurrentRecord();if(U.type!==b.BANDWIDTH)break;{const G=this.extractOneOrMore(U,O);if(":"!==U.value[U.cur])throw new Error("Invalid bandwidth field.");U.cur++;const se=this.extractOneOrMore(U,y);R.push({bwtype:G,bandwidth:se}),this.currentLine++}}return R}parseVersion(){const R=this.getCurrentRecord();if(R.type!==b.VERSION)throw new Error("first sdp record must be version");const U=R.value.slice(0,this.consumeOneOrMore(R.value,0,y));if(U.length!==R.value.length)throw new Error('invalid proto version, "v='.concat(R.value,'"'));return this.currentLine++,U}parseOrigin(){const R=this.getCurrentRecord();if(R.type!==b.ORIGIN)throw new Error("second line of sdp must be origin");const U=this.extractOneOrMore(R,M);this.consumeSpaceForRecord(R);const G=this.extractOneOrMore(R,y);this.consumeSpaceForRecord(R);const se=this.extractOneOrMore(R,y);this.consumeSpaceForRecord(R);const Ue=this.extractOneOrMore(R,O);this.consumeSpaceForRecord(R);const Wt=this.extractOneOrMore(R,O);this.consumeSpaceForRecord(R);const er=this.extract(R,this.consumeUnicastAddress);return this.currentLine++,{username:U,sessId:G,sessVersion:se,nettype:Ue,addrtype:Wt,unicastAddress:er}}parseSessionName(){const R=this.getCurrentRecord();if(R.type===b.SESSION_NAME){const U=this.extract(R,this.consumeText);return this.currentLine++,U}}parseInformation(){const R=this.getCurrentRecord();if(R.type!==b.INFORMATION)return;const U=this.extract(R,this.consumeText);return this.currentLine++,U}parseUri(){const R=this.getCurrentRecord();if(R.type===b.URI)return this.currentLine++,R.value}parseEmail(){const R=[];for(;;){const U=this.getCurrentRecord();if(U.type!==b.EMAIL)break;R.push(U.value),this.currentLine++}return R}parsePhone(){const R=[];for(;;){const U=this.getCurrentRecord();if(U.type!==b.PHONE)break;R.push(U.value),this.currentLine++}return R}parseConnection(){const R=this.getCurrentRecord();if(R.type===b.CONNECTION){const U=this.extractOneOrMore(R,O);this.consumeSpaceForRecord(R);const G=this.extractOneOrMore(R,O);this.consumeSpaceForRecord(R);const se=this.extract(R,this.consumeAddress);return this.currentLine++,{nettype:U,addrtype:G,address:se}}}parseMedia(){const R=this.getCurrentRecord(),U=this.extract(R,this.consumeToken);this.consumeSpaceForRecord(R);let G=this.extract(R,this.consumePort);"/"===R.value[R.cur]&&(R.cur+=1,G+=this.extract(R,this.consumeInteger)),this.consumeSpaceForRecord(R);const se=[];for(se.push(this.extract(R,this.consumeToken));"/"===R.value[R.cur];)R.cur+=1,se.push(this.extract(R,this.consumeToken));if(0===se.length)throw new Error("Invalid proto");const Ue=this.parseFmt(R);return this.currentLine++,{mediaType:U,port:G,protos:se,fmts:Ue}}parseTimeFields(){const R=[];for(;this.getCurrentRecord().type===b.TIME;){const U=this.parseTime(),G=this.parseRepeat(),se=this.parseZone();R.push({time:U,repeats:G,zones:se})}return R}parseMediaDescription(){const R=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===b.MEDIA;){const U=this.parseMedia(),G=this.parseInformation(),se=this.parseConnections(),Ue=this.parseBandWidth(),Wt=this.parseKey(),er=this.parseMediaAttributes(U);R.push({media:U,information:G,connections:se,bandwidths:Ue,key:Wt,attributes:er})}return R}parseConnections(){const R=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===b.CONNECTION;)R.push(this.parseConnection());return R}parseFmt(R){const U=[];for(;;)try{this.consumeSpaceForRecord(R),U.push(this.extract(R,this.consumeToken))}catch{break}if(0===U.length)throw new Error("Invalid fmts");return U}extract(R,U,...G){const se=U.call(this,R.value,R.cur,...G),Ue=R.value.slice(R.cur,se);return R.cur=se,Ue}extractOneOrMore(R,U){const G=this.consumeOneOrMore(R.value,R.cur,U),se=R.value.slice(R.cur,G);return R.cur=G,se}consumeSpaceForRecord(R){if(R.value[R.cur]!==v)throw new Error("Invalid space at ".concat(R.cur,"."));R.cur+=1}}class Fe extends ge{constructor(...R){super(...R),q(this,"attributes",void 0),q(this,"digested",!1)}extractOneOrMore(R,U,G){const se=this.consumeOneOrMore(R.attValue,R._cur,U),Ue=R.attValue.slice(R._cur,se),[Wt,er]=G||[];if("number"==typeof Wt&&Ue.length<Wt)throw new Error("error in length, should be more or equal than ".concat(Wt," characters."));if("number"==typeof er&&Ue.length>er)throw new Error("error in length, should be less or equal than ".concat(er," characters."));return R._cur=se,Ue}consumeAttributeSpace(R){if(R.attValue[R._cur]!==v)throw new Error("Invalid space at ".concat(R._cur,"."));R._cur+=1}extract(R,U,...G){if(!R.attValue)throw new Error("Nothing to extract from attValue.");const se=U.call(this,R.attValue,R._cur,...G),Ue=R.attValue.slice(R._cur,se);return R._cur=se,Ue}atEnd(R){if(!R.attValue)throw new Error;return R._cur>=R.attValue.length}peekChar(R){if(!R.attValue)throw new Error;return R.attValue[R._cur]}peek(R,U){if(!R.attValue)throw new Error;for(let G=0;G<U.length;G++)if(U[G]!==R.attValue[R._cur+G])return!1;return!0}parseIceUfrag(R){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(R,Y,[4,256])}parseIcePwd(R){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(R,Y,[22,256])}parseIceOptions(R){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const U=[];for(;!this.atEnd(R);){U.push(this.extractOneOrMore(R,Y));try{this.consumeAttributeSpace(R)}catch(G){if(this.atEnd(R))break;throw G}}this.attributes.iceOptions=U}parseFingerprint(R){const U=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const G=this.extract(R,this.consumeTill);this.attributes.fingerprints.push({hashFunction:U,fingerprint:G})}parseExtmap(R){const U=this.extractOneOrMore(R,y);let G;"/"===this.peekChar(R)&&(this.extract(R,this.consume,"/"),G=this.extract(R,this.consumeToken)),this.consumeAttributeSpace(R);const se=this.extract(R,this.consumeTill,v),Ue=$($({entry:parseInt(U,10)},G&&{direction:G}),{},{extensionName:se});this.peekChar(R)===v&&(this.consumeAttributeSpace(R),Ue.extensionAttributes=this.extract(R,this.consumeTill)),this.attributes.extmaps.push(Ue)}parseSetup(R){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const U=this.extract(R,this.consumeTill);if("active"!==U&&"passive"!==U&&"actpass"!==U&&"holdconn"!==U)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=U}}class rt extends Fe{constructor(...R){super(...R),q(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(R){if(this.digested)throw new Error("already digested");try{switch(R.attField){case"group":this.parseGroup(R);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(R);break;case"ice-pwd":this.parseIcePwd(R);break;case"ice-options":this.parseIceOptions(R);break;case"fingerprint":this.parseFingerprint(R);break;case"setup":this.parseSetup(R);break;case"tls-id":this.parseTlsId(R);break;case"identity":this.parseIdentity(R);break;case"extmap":this.parseExtmap(R);break;case"msid-semantic":this.parseMsidSemantic(R);break;default:R.ignored=!0,this.attributes.unrecognized.push(R)}}catch(U){throw console.error("parsing session attribute ".concat(R.attField,' error, "a=').concat(R.attField,":").concat(R.attValue,'"')),U}if(!R.ignored&&R.attValue&&!this.atEnd(R))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(R){const U=this.extract(R,this.consumeToken),G=[];for(;!this.atEnd(R)&&this.peekChar(R)===v;)this.consumeAttributeSpace(R),G.push(this.extract(R,this.consumeToken));this.attributes.groups.push({semantic:U,identificationTag:G})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(R){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(R,te)}parseIdentity(R){const U=this.extractOneOrMore(R,K),G=[];for(;!this.atEnd(R)&&this.peekChar(R)===v;){this.consumeAttributeSpace(R);const se=this.extract(R,this.consumeToken);this.extract(R,this.consume,"=");const Ue=this.extractOneOrMore(R,Wt=>Wt!==v&&j(Wt));G.push({name:se,value:Ue})}this.attributes.identities.push({assertionValue:U,extensions:G})}parseMsidSemantic(R){this.peekChar(R)===v&&this.consumeAttributeSpace(R);const U={semantic:this.extract(R,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(R)}catch{break}if("*"===this.peekChar(R)){this.extract(R,this.consume,"*"),U.applyForAll=!0;break}{const G=this.extract(R,this.consumeTill,v);U.identifierList.push(G)}}this.attributes.msidSemantic=U}}class ai extends Fe{constructor(R){super(),q(this,"attributes",void 0),-1!==R.protos.indexOf("RTP")||R.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(R){if(this.digested)throw new Error("already digested");try{switch(R.attField){case"extmap":this.parseExtmap(R);break;case"setup":this.parseSetup(R);break;case"ice-ufrag":this.parseIceUfrag(R);break;case"ice-pwd":this.parseIcePwd(R);break;case"ice-options":this.parseIceOptions(R);break;case"candidate":this.parseCandidate(R);break;case"remote-candidate":this.parseRemoteCandidate(R);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(R);break;case"rtpmap":this.parseRtpmap(R);break;case"ptime":this.parsePtime(R);break;case"maxptime":this.parseMaxPtime(R);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(R);break;case"ssrc":this.parseSSRC(R);break;case"fmtp":this.parseFmtp(R);break;case"rtcp-fb":this.parseRtcpFb(R);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(R);break;case"mid":this.parseMid(R);break;case"msid":this.parseMsid(R);break;case"imageattr":this.parseImageAttr(R);break;case"rid":this.parseRid(R);break;case"simulcast":this.parseSimulcast(R);break;case"sctp-port":this.parseSctpPort(R);break;case"max-message-size":this.parseMaxMessageSize(R);break;case"ssrc-group":this.parseSSRCGroup(R);break;default:R.ignored=!0,this.attributes.unrecognized.push(R)}}catch(U){throw console.error("parsing media attribute ".concat(R.attField,' error, "a=').concat(R.attField,":").concat(R.attValue,'"')),U}if(!R.ignored&&R.attValue&&!this.atEnd(R))throw new Error("attribute parsing error")}parseCandidate(R){const U=this.extractOneOrMore(R,Y,[1,32]);this.consumeAttributeSpace(R);const G=this.extractOneOrMore(R,y,[1,5]);this.consumeAttributeSpace(R);const se=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const Ue=this.extractOneOrMore(R,y,[1,10]);this.consumeAttributeSpace(R);const Wt=this.extract(R,this.consumeAddress);this.consumeAttributeSpace(R);const er=this.extract(R,this.consumePort);this.consumeAttributeSpace(R),this.extract(R,this.consume,"typ"),this.consumeAttributeSpace(R);const Ho={foundation:U,componentId:G,transport:se,priority:Ue,connectionAddress:Wt,port:er,type:this.extract(R,this.consumeToken),extension:{}};for(this.peek(R," raddr")&&(this.extract(R,this.consume," raddr"),this.consumeAttributeSpace(R),Ho.relAddr=this.extract(R,this.consumeAddress)),this.peek(R," rport")&&(this.extract(R,this.consume," rport"),this.consumeAttributeSpace(R),Ho.relPort=this.extract(R,this.consumePort));this.peekChar(R)===v;){this.consumeAttributeSpace(R);const sl=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R),Ho.extension[sl]=this.extractOneOrMore(R,T)}this.attributes.candidates.push(Ho)}parseRemoteCandidate(R){const U=[];for(;;){const G=this.extractOneOrMore(R,y,[1,5]);this.consumeAttributeSpace(R);const se=this.extract(R,this.consumeAddress);this.consumeAttributeSpace(R);const Ue=this.extract(R,this.consumePort);U.push({componentId:G,connectionAddress:se,port:Ue});try{this.consumeAttributeSpace(R)}catch{break}}this.attributes.remoteCandidatesList.push(U)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(R){const U=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const G=this.extract(R,this.consumeTill,"/");this.extract(R,this.consume,"/");const se={encodingName:G,clockRate:this.extractOneOrMore(R,y)};this.atEnd(R)||"/"!==this.peekChar(R)||(this.extract(R,this.consume,"/"),se.encodingParameters=parseInt(this.extract(R,this.consumeTill),10));const Ue=this.attributes.payloads.find(Wt=>Wt.payloadType===parseInt(U,10));Ue?Ue.rtpMap=se:this.attributes.payloads.push({payloadType:parseInt(U,10),rtpMap:se,rtcpFeedbacks:[]})}parsePtime(R){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(R,this.consumeTill)}parseMaxPtime(R){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(R,this.consumeTill)}parseDirection(R){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=R.attField}parseSSRC(R){const U=this.extractOneOrMore(R,y);this.consumeAttributeSpace(R);const G=this.extract(R,this.consumeTill,":");let se;":"===this.peekChar(R)&&(this.extract(R,this.consume,":"),se=this.extract(R,this.consumeTill));const Ue=this.attributes.ssrcs.find(Wt=>Wt.ssrcId===parseInt(U,10));Ue?Ue.attributes[G]=se:this.attributes.ssrcs.push({ssrcId:parseInt(U,10),attributes:{[G]:se}})}parseFmtp(R){const U=this.extract(R,this.consumeTill,v);this.consumeAttributeSpace(R);const G=this.extract(R,this.consumeTill),se={};G.split(";").forEach(Wt=>{let[er,Ho]=Wt.split("=");er=er.trim();const sl="string"==typeof Ho?Ho.trim():null;"string"==typeof er&&er.length>0&&(se[er]=sl)});const Ue=this.attributes.payloads.find(Wt=>Wt.payloadType===parseInt(U,10));Ue?Ue.fmtp={parameters:se}:this.attributes.payloads.push({payloadType:parseInt(U,10),rtcpFeedbacks:[],fmtp:{parameters:se}})}parseFmtParameters(R){const U={},G=this.extract(R,this.consumeTill,"=");R._cur++;const se=this.extract(R,this.consumeTill,";");for(U[G]=se;";"===R.attValue[R._cur];){const Ue=this.extract(R,this.consumeTill,"=");R._cur++;const Wt=this.extract(R,this.consumeTill,";");U[Ue]=Wt}return U}parseRtcpFb(R){let U="";U="*"===this.peekChar(R)?this.extract(R,this.consume,"*"):this.extract(R,this.consumeTill,v),this.consumeAttributeSpace(R);const G=this.extract(R,this.consumeTill,v);let se;if("trr-int"===G)se={type:G,interval:this.extract(R,this.consumeTill)};else{const Ue={type:G};this.peekChar(R)===v&&(this.consumeAttributeSpace(R),Ue.parameter=this.extract(R,this.consumeToken),this.peekChar(R)===v&&(Ue.additional=this.extract(R,this.consumeTill))),se=Ue}if("*"===U)this.attributes.rtcpFeedbackWildcards.push(se);else{const Ue=this.attributes.payloads.find(Wt=>Wt.payloadType===parseInt(U,10));Ue?Ue.rtcpFeedbacks.push(se):this.attributes.payloads.push({payloadType:parseInt(U,10),rtcpFeedbacks:[se]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(R){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const U={port:this.extract(R,this.consumePort)};this.peekChar(R)===v&&(this.consumeAttributeSpace(R),U.netType=this.extractOneOrMore(R,O),this.consumeAttributeSpace(R),U.addressType=this.extractOneOrMore(R,O),this.consumeAttributeSpace(R),U.address=this.extract(R,this.consumeAddress)),this.attributes.rtcp=U}parseMsid(R){const U={id:this.extractOneOrMore(R,O,[1,64])};this.peekChar(R)===v&&(this.consumeAttributeSpace(R),U.appdata=this.extractOneOrMore(R,O,[1,64])),this.attributes.msids.push(U)}parseImageAttr(R){this.attributes.imageattr.push(R.attValue)}parseRid(R){const U=this.extractOneOrMore(R,se=>x(se)||y(se)||"_"===se||"-"===se);this.consumeAttributeSpace(R);const G={id:U,direction:this.extract(R,this.consumeToken),params:[]};if(this.peekChar(R)===v){if(this.consumeAttributeSpace(R),this.peek(R,"pt=")){this.extract(R,this.consume,"pt=");const se=[];for(;;){const Ue=this.extract(R,this.consumeToken);se.push(Ue);try{this.extract(R,this.consume,",")}catch{break}}G.payloads=se,this.peekChar(R)===v&&this.extract(R,this.consume,v)}for(;;){const se=this.extract(R,this.consumeToken);switch(se){case"depend":{const Ue={type:se,rids:this.extract(R,this.consume,"=").split(",")};G.params.push(Ue);break}default:{const Ue={type:se};"="===this.peekChar(R)&&(this.extract(R,this.consume,"="),Ue.val=this.extract(R,this.consumeTill,";")),G.params.push(Ue)}}try{this.extract(R,this.consume,";")}catch{break}}}this.attributes.rids.push(G)}parseSimulcast(R){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=R.attValue,this.extract(R,this.consumeTill)}parseSctpPort(R){this.attributes.sctpPort=this.extractOneOrMore(R,y,[1,5])}parseMaxMessageSize(R){this.attributes.maxMessageSize=this.extractOneOrMore(R,y,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(R){this.attributes.mid=this.extract(R,this.consumeToken)}parseSSRCGroup(R){const U=this.extract(R,this.consumeToken),G=[];for(;;)try{this.consumeAttributeSpace(R);const se=this.extract(R,this.consumeInteger);G.push(parseInt(se,10))}catch{break}this.attributes.ssrcGroups.push({semantic:U,ssrcIds:G})}}function Qt(fe,R,U){return R in fe?Object.defineProperty(fe,R,{value:U,enumerable:!0,configurable:!0,writable:!0}):fe[R]=U,fe}class Fi{constructor(){Qt(this,"eol",g)}print(R,U){let G="";return U&&(this.eol=U),G+=this.printVersion(R.version),G+=this.printOrigin(R.origin),G+=this.printSessionName(R.sessionName),G+=this.printInformation(R.information),G+=this.printUri(R.uri),G+=this.printEmail(R.emails),G+=this.printPhone(R.phones),G+=this.printConnection(R.connection),G+=this.printBandwidth(R.bandwidths),G+=this.printTimeFields(R.timeFields),G+=this.printKey(R.key),G+=this.printSessionAttributes(R.attributes),G+=this.printMediaDescription(R.mediaDescriptions),G}printVersion(R){return"v=".concat(R).concat(this.eol)}printOrigin(R){return"o=".concat(R.username," ").concat(R.sessId," ").concat(R.sessVersion," ").concat(R.nettype," ").concat(R.addrtype," ").concat(R.unicastAddress).concat(this.eol)}printSessionName(R){return R?"s=".concat(R).concat(this.eol):""}printInformation(R){return R?"i=".concat(R).concat(this.eol):""}printUri(R){return R?"u=".concat(R).concat(this.eol):""}printEmail(R){let U="";for(const G of R)U+="e=".concat(G).concat(this.eol);return U}printPhone(R){let U="";for(const G of R)U+="e=".concat(G).concat(this.eol);return U}printConnection(R){return R?"c=".concat(R.nettype," ").concat(R.addrtype," ").concat(R.address).concat(this.eol):""}printBandwidth(R){let U="";for(const G of R)U+="b=".concat(G.bwtype,":").concat(G.bandwidth).concat(this.eol);return U}printTimeFields(R){let U="";for(const G of R){U+="t=".concat(G.time.startTime," ").concat(G.time.startTime).concat(this.eol);for(const se of G.repeats)U+="r=".concat(se.repeatInterval," ").concat(se.typedTimes.join(" ")).concat(this.eol);G.zoneAdjustments&&(U+="z=",U+="z=".concat(G.zoneAdjustments.map(se=>"".concat(se.time," ").concat(se.back?"-":""," ").concat(se.typedTime)).join(" ")).concat(this.eol),U+=this.eol)}return U}printKey(R){return R?"k=".concat(R).concat(this.eol):""}printAttributes(R){let U="";for(const G of R)U+="a=".concat(G.attField).concat(G.attValue?":".concat(G.attValue):"").concat(this.eol);return U}printMediaDescription(R){let U="";for(const G of R)U+=this.printMedia(G.media),U+=this.printInformation(G.information),U+=this.printConnections(G.connections),U+=this.printBandwidth(G.bandwidths),U+=this.printKey(G.key),U+=this.printMediaAttributes(G);return U}printConnections(R){let U="";for(const G of R)U+=this.printConnection(G);return U}printMedia(R){return"m=".concat(R.mediaType," ").concat(R.port," ").concat(R.protos.join("/")," ").concat(R.fmts.join(" ")).concat(this.eol)}printSessionAttributes(R){return new ue(this.eol).print(R)}printMediaAttributes(R){return new Ce(this.eol).print(R)}}class ie{constructor(R){Qt(this,"eol",void 0),this.eol=R}printIceUfrag(R){return void 0===R?"":"a=ice-ufrag:".concat(R).concat(this.eol)}printIcePwd(R){return void 0===R?"":"a=ice-pwd:".concat(R).concat(this.eol)}printIceOptions(R){return void 0===R?"":"a=ice-options:".concat(R.join(v)).concat(this.eol)}printFingerprints(R){return R.length>0?R.map(U=>"a=fingerprint:".concat(U.hashFunction).concat(v).concat(U.fingerprint)).join(this.eol)+this.eol:""}printExtmap(R){return R.map(U=>"a=extmap:".concat(U.entry).concat(U.direction?"/".concat(U.direction):"").concat(v).concat(U.extensionName).concat(U.extensionAttributes?"".concat(v).concat(U.extensionAttributes):"").concat(this.eol)).join("")}printSetup(R){return void 0===R?"":"a=setup:".concat(R).concat(this.eol)}printUnrecognized(R){return R.map(U=>"a=".concat(U.attField).concat(U.attValue?":".concat(U.attValue):"").concat(this.eol)).join("")}}class ue extends ie{print(R){let U="";return U+=this.printGroups(R.groups),U+=this.printMsidSemantic(R.msidSemantic),U+=this.printIceLite(R.iceLite),U+=this.printIceUfrag(R.iceUfrag),U+=this.printIcePwd(R.icePwd),U+=this.printIceOptions(R.iceOptions),U+=this.printFingerprints(R.fingerprints),U+=this.printSetup(R.setup),U+=this.printTlsId(R.tlsId),U+=this.printIdentity(R.identities),U+=this.printExtmap(R.extmaps),U+=this.printUnrecognized(R.unrecognized),U}printGroups(R){let U="";return R.length>0&&(U+=R.map(G=>"a=group:".concat(G.semantic).concat(G.identificationTag.map(se=>"".concat(v).concat(se)).join("")).concat(this.eol)).join("")),U}printIceLite(R){return void 0===R?"":"a=ice-lite"+this.eol}printTlsId(R){return R?"a=tls-id:".concat(R).concat(this.eol):""}printIdentity(R){return 0===R.length?"":R.map(U=>"a=identity:".concat(U.assertionValue).concat(U.extensions.map(G=>"".concat(v).concat(G.name).concat(G.value?"=".concat(G.value):"")))).join(this.eol)+this.eol}printMsidSemantic(R){if(!R)return"";let U="a=msid-semantic:".concat(R.semantic);return R.applyForAll?U+="".concat(v,"*"):R.identifierList.length>0&&(U+=R.identifierList.map(G=>"".concat(v).concat(G))),U+this.eol}}class Ce extends ie{print(R){const U=R.attributes;let G="";return G+=this.printRTCP(U.rtcp),G+=this.printIceUfrag(U.iceUfrag),G+=this.printIcePwd(U.icePwd),G+=this.printIceOptions(U.iceOptions),G+=this.printCandidates(U.candidates),G+=this.printRemoteCandidatesList(U.remoteCandidatesList),G+=this.printEndOfCandidates(U.endOfCandidates),G+=this.printFingerprints(U.fingerprints),G+=this.printSetup(U.setup),G+=this.printMid(U.mid),G+=this.printExtmap(U.extmaps),G+=this.printRTPRelated(U),G+=this.printPtime(U.ptime),G+=this.printMaxPtime(U.maxPtime),G+=this.printDirection(U.direction),G+=this.printSSRCGroups(U.ssrcGroups),G+=this.printSSRC(U.ssrcs),G+=this.printRTCPMux(U.rtcpMux),G+=this.printRTCPMuxOnly(U.rtcpMuxOnly),G+=this.printRTCPRsize(U.rtcpRsize),G+=this.printMSId(U.msids),G+=this.printImageattr(U.imageattr),G+=this.printRid(U.rids),G+=this.printSimulcast(U.simulcast),G+=this.printSCTPPort(U.sctpPort),G+=this.printMaxMessageSize(U.maxMessageSize),G+=this.printUnrecognized(U.unrecognized),G}printCandidates(R){return R.map(U=>"a=candidate:".concat(U.foundation).concat(v).concat(U.componentId).concat(v).concat(U.transport).concat(v).concat(U.priority).concat(v).concat(U.connectionAddress).concat(v).concat(U.port).concat(v,"typ").concat(v).concat(U.type).concat(U.relAddr?"".concat(v,"raddr").concat(v).concat(U.relAddr):"").concat(U.relPort?"".concat(v,"rport").concat(v).concat(U.relPort):"").concat(Object.keys(U.extension).map(G=>"".concat(v).concat(G).concat(v).concat(U.extension[G])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(R){return R.map(U=>"a=remote-candidates:".concat(U.join(v)).concat(this.eol)).join("")}printEndOfCandidates(R){return void 0===R?"":"a=end-of-candidates"+this.eol}printRTPRelated(R){if(!R.payloads)return"";const U=R.payloads;let G="";G+=R.rtcpFeedbackWildcards.map(se=>this.printRTCPFeedback("*",se)).join("");for(const se of U)G+=this.printRtpMap(se.payloadType,se.rtpMap),G+=this.printFmtp(se.payloadType,se.fmtp),G+=se.rtcpFeedbacks.map(Ue=>this.printRTCPFeedback(se.payloadType,Ue)).join("");return G}printFmtp(R,U){if(!U)return"";const G=Object.keys(U.parameters);return 1===G.length&&null===U.parameters[G[0]]?"a=fmtp:".concat(R).concat(v).concat(G[0]).concat(this.eol):"a=fmtp:".concat(R).concat(v).concat(Object.keys(U.parameters).map(se=>"".concat(se,"=").concat(U.parameters[se])).join(";")).concat(this.eol)}printRtpMap(R,U){return U?"a=rtpmap:".concat(R).concat(v).concat(U.encodingName,"/").concat(U.clockRate).concat(U.encodingParameters?"/".concat(U.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(R,U){let G="a=rtcp-fb:".concat(R).concat(v),se=U;return"trr-int"===se.type?G+="ttr-int".concat(v).concat(se.interval):(G+="".concat(se.type),se.parameter&&(G+="".concat(v).concat(se.parameter),se.additional&&(G+="".concat(v).concat(se.additional)))),G+this.eol}printPtime(R){return void 0===R?"":"a=ptime:".concat(R).concat(this.eol)}printMaxPtime(R){return void 0===R?"":"a=maxptime:".concat(R).concat(this.eol)}printDirection(R){return void 0===R?"":"a=".concat(R).concat(this.eol)}printSSRC(R){return R.map(U=>Object.keys(U.attributes).map(G=>"a=ssrc:".concat(U.ssrcId.toString(10)).concat(v).concat(G).concat(U.attributes[G]?":".concat(U.attributes[G]):"").concat(this.eol)).join("")).join("")}printRTCPMux(R){return void 0===R?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(R){return void 0===R?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(R){return void 0===R?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(R){if(void 0===R)return"";let U="a=rtcp:".concat(R.port);return R.netType&&(U+="".concat(v).concat(R.netType)),R.addressType&&(U+="".concat(v).concat(R.addressType)),R.address&&(U+="".concat(v).concat(R.address)),U+this.eol}printMSId(R){return R.map(U=>"a=msid:".concat(U.id).concat(U.appdata?"".concat(v).concat(U.appdata):"").concat(this.eol)).join("")}printImageattr(R){return R.map(U=>"a=imageattr:".concat(U).concat(this.eol)).join("")}printRid(R){return R.map(U=>{let G="a=rid:".concat(U.id).concat(v).concat(U.direction);return U.payloads&&(G+="".concat(v,"pt=").concat(U.payloads.join(","))),U.params.length>0&&(G+="".concat(v).concat(U.params.map(se=>"depend"===se.type?"depend=".concat(se.rids.join(",")):"".concat(se.type,"=").concat(se.val)).join(";"))),G+this.eol}).join("")}printSimulcast(R){return void 0===R?"":"a=simulcast:".concat(R).concat(this.eol)}printSCTPPort(R){return void 0===R?"":"a=sctp-port:".concat(R).concat(this.eol)}printMaxMessageSize(R){return void 0===R?"":"a=max-message-size:".concat(R).concat(this.eol)}printMid(R){return void 0===R?"":"a=mid:".concat(R).concat(this.eol)}printSSRCGroups(R){return R.map(U=>"a=ssrc-group:".concat(U.semantic).concat(U.ssrcIds.map(G=>"".concat(v).concat(G.toString(10))).join("")).concat(this.eol)).join("")}}function ke(fe){return(new _e).parse(fe)}function ht(fe,R){return(new Fi).print(fe,R)}}},a={};function d(l){if(a[l])return a[l].exports;var h=a[l]={exports:{}};return r[l](h,h.exports,d),h.exports}return d.d=(l,h)=>{for(var f in h)d.o(h,f)&&!d.o(l,f)&&Object.defineProperty(l,f,{enumerable:!0,get:h[f]})},d.o=(l,h)=>Object.prototype.hasOwnProperty.call(l,h),d.r=l=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},d(8)})()}(_P);var Xt=_P.exports;function ma(s){if(Array.isArray(s))return s.map(r=>r);if(!RF(s))return s;const i={};for(const r in s){const a=s[r];i[r]=RF(a)||Array.isArray(a)?ma(a):a}return i}function RF(s){return!("object"!=typeof s||Array.isArray(s)||!s)}class gP{constructor(i){C(this,"input",[]),C(this,"size",void 0),this.size=i}add(i){this.input.push(i),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const $a={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},cb={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:$a,remoteCandidate:$a}},AF={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},DF={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},OF={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},NF={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function EP(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function PF(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?EP(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):EP(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class db{constructor(i,r){var a=this;C(this,"onFirstVideoReceived",void 0),C(this,"onFirstVideoDecoded",void 0),C(this,"onFirstAudioReceived",void 0),C(this,"onFirstVideoDecodedTimeout",void 0),C(this,"onFirstAudioDecoded",void 0),C(this,"onSelectedLocalCandidateChanged",void 0),C(this,"onSelectedRemoteCandidateChanged",void 0),C(this,"videoIsReady",!1),C(this,"videoIsReady2",{}),C(this,"pc",void 0),C(this,"options",void 0),C(this,"intervalTimer",void 0),C(this,"stats",ma(cb)),C(this,"isFirstVideoReceived",{}),C(this,"isFirstVideoDecoded",{}),C(this,"isFirstAudioReceived",{}),C(this,"isFirstAudioDecoded",{}),C(this,"isFirstVideoDecodedTimeout",{}),C(this,"lossRateWindowStats",[]),this.pc=i,this.options=r,this.intervalTimer=window.setInterval(L(function*(){a.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new X(i=>{i({local:PF({},$a),remote:PF({},$a)})})}setVideoIsReady(i){this.videoIsReady=i}setVideoIsReady2(i,r){this.videoIsReady2[i]=r}getVideoIsReady(i){return this.videoIsReady2[i]||!1}setIsFirstAudioDecoded(i){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(i){this.lossRateWindowStats.push(i),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,a=["videoSend","audioSend","videoRecv","audioRecv"];let d=0,l=0,h=0,f=0;for(const _ of a)i[_].forEach((g,v)=>{if(!this.lossRateWindowStats[r-1][_][v]||!this.lossRateWindowStats[0][_][v])return;const b=this.lossRateWindowStats[r-1][_][v].packets-this.lossRateWindowStats[0][_][v].packets,y=this.lossRateWindowStats[r-1][_][v].packetsLost-this.lossRateWindowStats[0][_][v].packetsLost;"videoSend"===_||"audioSend"===_?(d+=b,h+=y):(l+=b,f+=y),g.packetLostRate=Number.isNaN(b)||Number.isNaN(b)||b<=0||y<=0?0:y/(b+y)});i.sendPacketLossRate=d<=0||h<=0?0:h/(d+h),i.recvPacketLossRate=l<=0||f<=0?0:f/(l+f)}}function $c(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function MF(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?$c(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):$c(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class xF extends db{constructor(){super(...arguments),C(this,"_stats",cb),C(this,"lastDecodeVideoReceiverStats",new Map)}updateStats(){var i=this;return L(function*(){const r=yield i._getStats(),a=i.statsResponsesToObjects(r);i._stats=ma(cb);const d=a.filter(h=>"ssrc"===h.type);i.processSSRCStats(d);const l=a.find(h=>"VideoBwe"===h.type);l&&i.processBandwidthStats(l),i._stats.timestamp=Date.now(),i.calcLossRate(i._stats),i.stats=i._stats})()}processBandwidthStats(i){this._stats.bitrate={actualEncoded:Number(i.googActualEncBitrate),targetEncoded:Number(i.googTargetEncBitrate),retransmit:Number(i.googRetransmitBitrate),transmit:Number(i.googTransmitBitrate)},this._stats.sendBandwidth=Number(i.googAvailableSendBandwidth)}processSSRCStats(i){i.forEach(r=>{var a;const d=ye(a=r.id).call(a,"send");switch("".concat(r.mediaType,"_").concat(d?"send":"recv")){case"video_send":{const l=ma(DF);l.codec=r.googCodecName,l.adaptionChangeReason="none",r.googCpuLimitedResolution&&(l.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(l.adaptionChangeReason="bandwidth"),l.avgEncodeMs=Number(r.googAvgEncodeMs),l.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},l.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},l.firsCount=Number(r.googFirReceived),l.nacksCount=Number(r.googNacksReceived),l.plisCount=Number(r.googPlisReceived),l.frameCount=Number(r.framesEncoded),l.bytes=Number(r.bytesSent),l.packets=Number(r.packetsSent),l.packetsLost=Number(r.packetsLost),l.ssrc=Number(r.ssrc),l.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(l),this._stats.rtt=l.rttMs;break}case"video_recv":{const l=ma(AF),h=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(l.codec=r.googCodecName,l.targetDelayMs=Number(r.googTargetDelayMs),l.renderDelayMs=Number(r.googRenderDelayMs),l.currentDelayMs=Number(r.googCurrentDelayMs),l.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),l.decodeMs=Number(r.googDecodeMs),l.maxDecodeMs=Number(r.googMaxDecodeMs),l.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},l.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},l.decodeFrameRate=Number(r.googFrameRateDecoded),l.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},l.jitterBufferMs=Number(r.googJitterBufferMs),l.firsCount=Number(r.googFirsSent),l.nacksCount=Number(r.googNacksSent),l.plisCount=Number(r.googPlisSent),l.framesDecodeCount=Number(r.framesDecoded),l.bytes=Number(r.bytesReceived),l.packets=Number(r.packetsReceived),l.packetsLost=Number(r.packetsLost),l.ssrc=Number(r.ssrc),l.packets>0&&!this.isFirstVideoReceived[l.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(l.ssrc),this.isFirstVideoReceived[l.ssrc]=!0),l.framesDecodeCount>0&&!this.isFirstVideoDecoded[l.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(l.ssrc,l.decodedFrame.width,l.decodedFrame.height),this.isFirstVideoDecoded[l.ssrc]=!0),h){const f=h.stats,_=Date.now()-h.lts;l.framesDecodeFreezeTime=f.framesDecodeFreezeTime,l.framesDecodeInterval=f.framesDecodeInterval,l.framesDecodeCount>f.framesDecodeCount&&this.isFirstVideoDecoded[l.ssrc]?(h.lts=Date.now(),l.framesDecodeInterval=_,l.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?l.framesDecodeFreezeTime+=l.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):l.framesDecodeCount<h.stats.framesDecodeCount&&(l.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(l.ssrc,{stats:MF({},l),lts:Date.now()}),this._stats.videoRecv.push(l);break}case"audio_recv":{const l=ma(NF);l.codec=r.googCodecName,l.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,l.decodingCNG=Number(r.googDecodingCNG),l.decodingCTN=Number(r.googDecodingCTN),l.decodingCTSG=Number(r.googDecodingCTSG),l.decodingNormal=Number(r.googDecodingNormal),l.decodingPLC=Number(r.googDecodingPLC),l.decodingPLCCNG=Number(r.googDecodingPLCCNG),l.expandRate=Number(r.googExpandRate),l.accelerateRate=Number(r.googAccelerateRate),l.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),l.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),l.speechExpandRate=Number(r.googSpeechExpandRate),l.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),l.jitterBufferMs=Number(r.googJitterBufferMs),l.jitterMs=Number(r.googJitterReceived),l.bytes=Number(r.bytesReceived),l.packets=Number(r.packetsReceived),l.packetsLost=Number(r.packetsLost),l.ssrc=Number(r.ssrc),l.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),l.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),l.receivedFrames>0&&!this.isFirstAudioReceived[l.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(l.ssrc),this.isFirstAudioReceived[l.ssrc]=!0),l.decodingNormal>0&&!this.isFirstAudioDecoded[l.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(l.ssrc),this.isFirstAudioDecoded[l.ssrc]=!0),this._stats.audioRecv.push(l);break}case"audio_send":{const l=ma(OF);l.codec=r.googCodecName,l.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,l.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),l.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),l.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),l.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),l.bytes=Number(r.bytesSent),l.packets=Number(r.packetsSent),l.packetsLost=Number(r.packetsLost),l.ssrc=Number(r.ssrc),l.rttMs=Number(r.googRtt||0),this._stats.rtt=l.rttMs,this._stats.audioSend.push(l);break}}})}_getStats(){return new X((i,r)=>{this.pc.getStats(i,r)})}statsResponsesToObjects(i){const r=[];return i.result().forEach(a=>{const d={id:a.id,timestamp:a.timestamp.valueOf().toString(),type:a.type};a.names().forEach(l=>{d[l]=a.stat(l)}),r.push(d)}),r}}function on(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Xc(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?on(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):on(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class vP extends db{constructor(){super(...arguments),C(this,"_stats",cb),C(this,"report",void 0),C(this,"lastDecodeVideoReceiverStats",new Map),C(this,"lastVideoFramesRecv",new Map),C(this,"lastVideoFramesSent",new Map),C(this,"lastVideoFramesDecode",new Map),C(this,"lastVideoJBDelay",new Map),C(this,"lastAudioJBDelay",new Map),C(this,"mediaBytesSent",new Map),C(this,"mediaBytesRetransmit",new Map),C(this,"mediaBytesTargetEncode",new Map),C(this,"lastEncoderMs",new Map)}updateStats(){var i=this;return L(function*(){i.report=yield i.pc.getStats(),i._stats=ma(cb),i.report.forEach(r=>{switch(r.type){case vr.OUTBOUND:case vr.INBOUND:{const a=r.mediaType||r.kind,d=!a&&"frameWidth"in r,l=!a&&!("frameWidth"in r);r.type===vr.OUTBOUND?"audio"===a||l?i.processAudioOutboundStats(r):("video"===a||d)&&i.processVideoOutboundStats(r):r.type===vr.INBOUND&&("audio"===a||l?i.processAudioInboundStats(r):("video"===a||d)&&i.processVideoInboundStats(r));break}case vr.TRANSPORT:{const a=i.report.get(r.selectedCandidatePairId);a&&i.processCandidatePairStats(a);break}case vr.CANDIDATE_PAIR:r.selected&&i.processCandidatePairStats(r)}}),i.updateSendBitrate(),i._stats.timestamp=Date.now(),i.calcLossRate(i._stats),i.stats=i._stats})()}getSelectedCandidatePair(){var i=this;return L(function*(){const r=yield i.pc.getStats(),a={local:Xc({},$a),remote:Xc({},$a)};return r.forEach(d=>{let l;if(d.type===vr.TRANSPORT&&(l=r.get(d.selectedCandidatePairId)),d.type===vr.CANDIDATE_PAIR&&d.selected&&(l=d),l){const h=(f,_)=>{f.type=_.type,f.id=_.id,_.address&&(f.address=_.address),_.candidateType&&(f.candidateType=_.candidateType),_.port&&(f.port=_.port),_.priority&&(f.priority=_.priority),_.protocol&&(f.protocol=_.protocol),_.relayProtocol&&(f.relayProtocol=_.relayProtocol)};if(l.localCandidateId){const f=r.get(l.localCandidateId);f&&h(a.local,f)}if(l.remoteCandidateId){const f=r.get(l.remoteCandidateId);f&&h(a.remote,f)}}}),a})()}processCandidatePairStats(i){if(this._stats.sendBandwidth=i.availableOutgoingBitrate||0,i.currentRoundTripTime&&(this._stats.rtt=1e3*i.currentRoundTripTime),this._stats.videoSend.forEach(r=>{i.currentRoundTripTime&&(r.rttMs=1e3*i.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{i.currentRoundTripTime&&(r.rttMs=1e3*i.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=i.id,i.localCandidateId){const r=this.report.get(i.localCandidateId);r&&this.processCandidateStats(r)}if(i.remoteCandidateId){const r=this.report.get(i.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(i){let r;i.type===vr.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),i.type===vr.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=i.type,r.id=i.id,i.address&&(r.address=i.address),i.candidateType&&(r.candidateType=i.candidateType),i.port&&(r.port=i.port),i.priority&&(r.priority=i.priority),i.protocol&&(r.protocol=i.protocol),i.relayProtocol&&(r.relayProtocol=i.relayProtocol),i.type===vr.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Xc({},r),Xc({},this.stats.selectedCandidatePair.localCandidate)),i.type===vr.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Xc({},r),Xc({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(i){let r=this._stats.audioRecv.find(a=>a.ssrc===i.ssrc);r||(r=ma(NF),this._stats.audioRecv.push(r)),r.ssrc=i.ssrc,r.packets=i.packetsReceived,r.packetsLost=i.packetsLost,r.bytes=i.bytesReceived,r.jitterMs=1e3*i.jitter,this.processAudioTrackReceiverStats(i,i.trackId,r),i.codecId&&(r.codec=this.getCodecFromCodecStats(i.codecId)),r.receivedFrames||(r.receivedFrames=i.packetsReceived),r.droppedFrames||(r.droppedFrames=i.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),"number"==typeof i.concealedSamples&&(r.concealedSamples=i.concealedSamples)}processVideoInboundStats(i){let r=this._stats.videoRecv.find(h=>h.ssrc===i.ssrc);r||(r=ma(AF),this._stats.videoRecv.push(r)),r.ssrc=i.ssrc,r.packets=i.packetsReceived,r.packetsLost=i.packetsLost,r.bytes=i.bytesReceived,r.firsCount=i.firCount,r.nacksCount=i.nackCount,r.plisCount=i.pliCount,r.framesDecodeCount=i.framesDecoded,r.totalInterFrameDelay=i.totalInterFrameDelay,r.totalSquaredInterFrameDelay=i.totalSquaredInterFrameDelay;const a=this.lastDecodeVideoReceiverStats.get(r.ssrc),d=this.lastVideoFramesDecode.get(r.ssrc),l=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,r.decodedFrame?r.decodedFrame.width:0,r.decodedFrame?r.decodedFrame.height:0),this.isFirstVideoDecoded[r.ssrc]=!0),a){const h=a.stats,f=l-a.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&f>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(a.lts=Date.now(),r.framesDecodeInterval=f,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(i.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(i.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),i.framesDecoded&&i.qpSum&&(r.qpSumPerFrame=a.stats.framesDecodeCount>i.framesDecoded?i.qpSum/i.framesDecoded:(i.qpSum-a.qpSum)/(i.framesDecoded-a.stats.framesDecodeCount))}d&&l-d.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-d.count)/((l-d.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:l,rate:r.decodeFrameRate})):d?r.decodeFrameRate=d.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:l,rate:0}),i.totalDecodeTime&&(r.decodeMs=1e3*i.totalDecodeTime),this.processVideoTrackReceiverStats(i,i.trackId,r),i.codecId&&(r.codec=this.getCodecFromCodecStats(i.codecId)),i.framerateMean&&(r.framesRateFirefox=i.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:Xc({},r),lts:a?a.lts:Date.now(),qpSum:i.qpSum})}processVideoOutboundStats(i){let r=this._stats.videoSend.find(d=>d.ssrc===i.ssrc);r||(r=ma(DF),this._stats.videoSend.push(r));const a=this.mediaBytesSent.get(i.ssrc);if(a)a.add(i.bytesSent);else{const d=new gP(10);d.add(i.bytesSent),this.mediaBytesSent.set(i.ssrc,d)}if(void 0!==i.retransmittedBytesSent){const d=this.mediaBytesRetransmit.get(i.ssrc);if(d)d.add(i.retransmittedBytesSent);else{const l=new gP(10);l.add(i.retransmittedBytesSent),this.mediaBytesRetransmit.set(i.ssrc,l)}}if(i.totalEncodedBytesTarget){const d=this.mediaBytesTargetEncode.get(i.ssrc);if(d)d.add(i.totalEncodedBytesTarget);else{const l=new gP(10);l.add(i.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(i.ssrc,l)}}if(r.ssrc=i.ssrc,r.bytes=i.bytesSent,r.packets=i.packetsSent,r.firsCount=i.firCount,r.nacksCount=i.nackCount,r.plisCount=i.pliCount,r.frameCount=i.framesEncoded,r.adaptionChangeReason=i.qualityLimitationReason,r.scalabilityMode=i.scalabilityMode,i.totalEncodeTime&&i.framesEncoded){const d=this.lastEncoderMs.get(i.ssrc);r.avgEncodeMs=!d||d.lastFrameCount>i.framesEncoded?1e3*i.totalEncodeTime/i.framesEncoded:1e3*(i.totalEncodeTime-d.lastEncoderTime)/(i.framesEncoded-d.lastFrameCount)}if(i.framesEncoded&&i.qpSum){const d=this.lastEncoderMs.get(i.ssrc);r.qpSumPerFrame=!d||d.lastFrameCount>i.framesEncoded?i.qpSum/i.framesEncoded:(i.qpSum-d.lastQpSum)/(i.framesEncoded-d.lastFrameCount)}if(this.lastEncoderMs.set(i.ssrc,{lastFrameCount:i.framesEncoded,lastEncoderTime:i.totalEncodeTime,lastQpSum:i.qpSum,lts:Date.now()}),i.codecId&&(r.codec=this.getCodecFromCodecStats(i.codecId)),i.mediaSourceId&&this.processVideoMediaSource(i.mediaSourceId,r),this.processVideoTrackSenderStats(i,i.trackId,r),i.remoteId)this.processRemoteInboundStats(i.remoteId,r);else{const d=this.findRemoteStatsId(i.ssrc,vr.REMOTE_INBOUND);d&&this.processRemoteInboundStats(d,r)}}processAudioOutboundStats(i){let r=this._stats.audioSend.find(a=>a.ssrc===i.ssrc);if(r||(r=ma(OF),this._stats.audioSend.push(r)),r.ssrc=i.ssrc,r.packets=i.packetsSent,r.bytes=i.bytesSent,i.mediaSourceId&&this.processAudioMediaSource(i.mediaSourceId,r),i.codecId&&(r.codec=this.getCodecFromCodecStats(i.codecId)),this.processAudioTrackSenderStats(i,i.trackId,r),i.remoteId)this.processRemoteInboundStats(i.remoteId,r);else{const a=this.findRemoteStatsId(i.ssrc,vr.REMOTE_INBOUND);a&&this.processRemoteInboundStats(a,r)}}findRemoteStatsId(i,r){var a;const d=Array.from(ca(a=this.report).call(a)).find(l=>l.type===r&&l.ssrc===i);return d?d.id:null}processVideoMediaSource(i,r){const a=this.report.get(i);a&&a.width&&a.height&&a.framesPerSecond&&(r.inputFrame={width:a.width,height:a.height,frameRate:a.framesPerSecond})}processAudioMediaSource(i,r){const a=this.report.get(i);a&&(r.inputLevel=a.audioLevel)}processVideoTrackSenderStats(i,r,a){var d,l,h,f;const _=r?this.report.get(r):void 0,g=null!==(d=_?.framesSent)&&void 0!==d?d:i.framesSent;if("number"!=typeof g)return;let v=null!==(l=_?.frameWidth)&&void 0!==l?l:i.frameWidth,b=null!==(h=_?.frameHeight)&&void 0!==h?h:i.frameHeight,y=null!==(f=_?.framesPerSecond)&&void 0!==f?f:i.framesPerSecond;if("number"==typeof v&&"number"==typeof b||(v=0,b=0),null==y){const T=Date.now(),M=this.lastVideoFramesSent.get(a.ssrc);M&&T-M.lts>=800?(y=Math.round((g-M.count)/((T-M.lts)/1e3)),this.lastVideoFramesSent.set(a.ssrc,{count:g,lts:T,rate:y})):M?y=M.rate:this.lastVideoFramesSent.set(a.ssrc,{count:g,lts:T,rate:0})}a.sentFrame={width:v,height:b,frameRate:Math.max(0,y)}}processVideoTrackReceiverStats(i,r,a){var d,l,h,f,_;const g=r?this.report.get(r):void 0,v=null!==(d=g?.framesReceived)&&void 0!==d?d:i.framesReceived,b=null!==(l=g?.frameWidth)&&void 0!==l?l:i.frameWidth,y=null!==(h=g?.frameHeight)&&void 0!==h?h:i.frameHeight,T=null!==(f=g?.jitterBufferDelay)&&void 0!==f?f:i.jitterBufferDelay,M=null!==(_=g?.jitterBufferEmittedCount)&&void 0!==_?_:i.jitterBufferEmittedCount;if("number"==typeof v){const O=this.lastVideoFramesRecv.get(a.ssrc),D=Date.now();a.framesReceivedCount=v;let x=0;O&&D-O.lts>=800?(x=Math.round((v-O.count)/((D-O.lts)/1e3)),this.lastVideoFramesRecv.set(a.ssrc,{count:v,lts:D,rate:x})):O?x=O.rate:this.lastVideoFramesRecv.set(a.ssrc,{count:v,lts:D,rate:0}),a.receivedFrame={width:b||0,height:y||0,frameRate:x||0},a.decodedFrame={width:b||0,height:y||0,frameRate:a.decodeFrameRate||0},a.outputFrame={width:b||0,height:y||0,frameRate:a.decodeFrameRate||0}}if(T&&M){const O=this.lastVideoJBDelay.get(a.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let D=O.jitterBufferMs;const x=M-O.jitterBufferEmittedCount;x>0&&(D=1e3*(T-O.jitterBufferDelay)/x),a.jitterBufferMs=D,a.currentDelayMs=Math.round(D),this.lastVideoJBDelay.set(a.ssrc,{jitterBufferDelay:T,jitterBufferEmittedCount:M,jitterBufferMs:a.currentDelayMs})}}processAudioTrackSenderStats(i,r,a){var d,l,h,f;const _=r?this.report.get(r):void 0,g=null!==(d=null!==(l=_?.echoReturnLoss)&&void 0!==l?l:i.echoReturnLoss)&&void 0!==d?d:0,v=null!==(h=null!==(f=_?.echoReturnLossEnhancement)&&void 0!==f?f:i.echoReturnLossEnhancement)&&void 0!==h?h:0;a.aecReturnLoss=g,a.aecReturnLossEnhancement=v}processAudioTrackReceiverStats(i,r,a){var d,l,h,f,_,g,v;const b=r?this.report.get(r):void 0,y=null!==(d=b?.removedSamplesForAcceleration)&&void 0!==d?d:i.removedSamplesForAcceleration,T=null!==(l=b?.totalSamplesReceived)&&void 0!==l?l:i.totalSamplesReceived,M=null!==(h=b?.jitterBufferDelay)&&void 0!==h?h:i.jitterBufferDelay,O=null!==(f=b?.jitterBufferEmittedCount)&&void 0!==f?f:i.jitterBufferEmittedCount,D=null!==(_=b?.audioLevel)&&void 0!==_?_:i?.audioLevel,x=null!==(g=b?.totalSamplesDuration)&&void 0!==g?g:i?.totalSamplesDuration,F=null!==(v=b?.concealedSamples)&&void 0!==v?v:i.concealedSamples;if(y&&T&&(a.accelerateRate=y/T),M&&O){const Y=this.lastAudioJBDelay.get(a.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let te=Y.jitterBufferMs;const K=O-Y.jitterBufferEmittedCount;K>0&&(te=1e3*(M-Y.jitterBufferDelay)/K),a.jitterBufferMs=Math.round(te),this.lastAudioJBDelay.set(a.ssrc,{jitterBufferDelay:M,jitterBufferEmittedCount:O,jitterBufferMs:a.jitterBufferMs})}a.outputLevel=D;let j=1920;x&&T&&(j=T/x/50,a.receivedFrames=Math.round(T/j)),F&&(a.droppedFrames=Math.round(F/j))}processRemoteInboundStats(i,r){const a=this.report.get(i);a&&(r.packetsLost=a.packetsLost,a.roundTripTime&&(r.rttMs=1e3*a.roundTripTime),a.jitter&&(r.jitterMs=1e3*a.jitter),a.timestamp&&(r.timestamp=a.timestamp))}getCodecFromCodecStats(i){const r=this.report.get(i);if(!r)return"";const a=r.mimeType.match(/\/(.*)$/);return a&&a[1]?a[1]:""}updateSendBitrate(){let i=0,r=null,a=null;this.mediaBytesSent.forEach(l=>{i+=l.diffMean()}),this.mediaBytesRetransmit.forEach(l=>{r=null===r?l.diffMean():r+l.diffMean()}),this.mediaBytesTargetEncode.forEach(l=>{a=null===a?l.diffMean():a+l.diffMean()}),this._stats.bitrate={actualEncoded:8*(null!==r?i-r:i)/(this.options.updateInterval/1e3),transmit:8*i/(this.options.updateInterval/1e3)},null!==r&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),null!==a&&(this._stats.bitrate.targetEncoded=8*a/(this.options.updateInterval/1e3))}}class kF extends db{updateStats(){return X.resolve()}}function xp(s){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const l=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return l?l<76?new xF(s,{updateInterval:i,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:d}):new vP(s,{updateInterval:i,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:d}):window.RTCStatsReport&&s.getStats()instanceof X?new vP(s,{updateInterval:i,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:d}):new kF(s,{updateInterval:i,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:d})}function B0(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Xa(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?B0(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):B0(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function _a(s){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;const{filterRTX:d,filterVideoFec:l,filterAudioFec:h,filterAudioCodec:f,filterVideoCodec:_}=i,{useXR:g}=r;let v=[],b=[],y=[],T=[],M=!1,O=!1;if(Xt.parse(s).mediaDescriptions.forEach(x=>{a&&a!==x.attributes.direction||("video"!==x.media.mediaType||M||(b=x.attributes.payloads,T=x.attributes.extmaps,M=!0),"audio"!==x.media.mediaType||O||(v=x.attributes.payloads,y=x.attributes.extmaps,O=!0))}),!T||0===b.length)throw new Error("Cannot get video capabilities from SDP.");if(!y||0===v.length)throw new Error("Cannot get audio capabilities from SDP.");b.forEach(x=>{var F;null!==(F=x.rtpMap)&&void 0!==F&&F.clockRate&&(x.rtpMap.clockRate=parseInt(x.rtpMap.clockRate)),g&&x.rtcpFeedbacks.push({type:"rrtr"})}),v.forEach(x=>{var F;null!==(F=x.rtpMap)&&void 0!==F&&F.clockRate&&(x.rtpMap.clockRate=parseInt(x.rtpMap.clockRate)),g&&x.rtcpFeedbacks.push({type:"rrtr"})}),d&&(v=v.filter(x=>{var F;return"rtx"!==(null===(F=x.rtpMap)||void 0===F?void 0:F.encodingName.toLowerCase())}),b=b.filter(x=>{var F;return"rtx"!==(null===(F=x.rtpMap)||void 0===F?void 0:F.encodingName.toLowerCase())})),l&&(b=b.filter(x=>{var F;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(F=x.rtpMap)||void 0===F?void 0:F.encodingName)||"")})),h&&(v=v.filter(x=>{var F;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(F=x.rtpMap)||void 0===F?void 0:F.encodingName)||"")})),f&&f?.length>0&&(v=v.filter(x=>{var F;return ye(f).call(f,(null===(F=x.rtpMap)||void 0===F?void 0:F.encodingName.toLowerCase())||"")})),_&&_?.length>0&&(b=b.filter(x=>{var F;return ye(_).call(_,(null===(F=x.rtpMap)||void 0===F?void 0:F.encodingName.toLowerCase())||"")}));const D=B("UNSUPPORTED_VIDEO_CODEC");return D&&D.length>0&&(b=b.filter(x=>!(x.rtpMap&&ye(D).call(D,x.rtpMap.encodingName.toLowerCase())))),{audioCodecs:v,videoCodecs:b,audioExtensions:y,videoExtensions:T}}function qs(s){const i=Xt.parse(s);let r,a;for(const d of i.mediaDescriptions){if(!r){const l=d.attributes.iceUfrag,h=d.attributes.icePwd;if(!l||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");r={iceUfrag:l,icePwd:h}}if(!a){const l=d.attributes.fingerprints;l.length>0&&(a={fingerprints:l})}}if(!a&&i.attributes.fingerprints.length>0&&(a={fingerprints:i.attributes.fingerprints}),!a||!r)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:r,dtlsParameters:a}}function lb(s,i){const r=[],a=s.attributes.ssrcGroups.filter(h=>"FID"===h.semantic),d=s.attributes.ssrcGroups.find(h=>"SIM"===h.semantic),l=s.attributes.ssrcs;if(d)d.ssrcIds.forEach(h=>{var f;const _=null===(f=a.find(g=>g.ssrcIds[0]===h))||void 0===f?void 0:f.ssrcIds[1];r.push({ssrcId:h,rtx:i?_:void 0})});else if(a.length>0)r.push({ssrcId:a[0].ssrcIds[0],rtx:i?a[0].ssrcIds[1]:void 0});else{if(0===l.length)throw new Error("No ssrcs found on local media description.");r.push({ssrcId:l[0].ssrcId})}return r}function bP(s,i){const{cname:r}=s;let a;i&&i.ip&&"number"==typeof i.port?(a=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:i.ip,port:i.port.toString(),type:"host",extension:{}}],I.debug("Using remote candidate from AP ".concat(i.ip,":").concat(i.port)),i.ip6&&(a.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:i.ip6,port:i.port.toString(),type:"host",extension:{}}),I.debug("Using IPV6 remote candidate from AP ".concat(i.ip6,":").concat(i.port)))):a=s.iceParameters.candidates.map(f=>({foundation:f.foundation,componentId:"1",transport:f.protocol,priority:f.priority.toString(),connectionAddress:f.ip,port:f.port.toString(),type:f.type,extension:{}}));const d={fingerprints:s.dtlsParameters.fingerprints.map(f=>({hashFunction:f.algorithm,fingerprint:f.fingerprint}))},l={iceUfrag:s.iceParameters.iceUfrag,icePwd:s.iceParameters.icePwd};let h;switch(s.dtlsParameters.role){case"server":h="passive";break;case"client":h="active";break;case"auto":h="actpass"}return{dtlsParameters:d,iceParameters:l,candidates:a,rtpCapabilities:ri(s.rtpCapabilities),setup:h,cname:r}}function Hi(s,i,r){const a=[],d=[];return s.forEach(l=>{let{ssrcId:h,rtx:f}=l;const _=qe(8,"track-"),g={ssrcId:h,attributes:Xa({label:_,mslabel:r=r||qe(10,""),msid:"".concat(r," ").concat(_)},i&&{cname:i})};if(a.push(g),void 0!==f){const v={ssrcId:f,attributes:Xa({label:_,mslabel:r,msid:"".concat(r," ").concat(_)},i&&{cname:i})};a.push(v),d.push({semantic:"FID",ssrcIds:[h,f]})}}),s.length>1&&d.push({semantic:"SIM",ssrcIds:s.map(l=>{let{ssrcId:h}=l;return h})}),{ssrcs:a,ssrcGroups:d}}function Jd(s,i){i instanceof Et&&s.attributes.payloads.forEach(r=>{var a;const d=null===(a=r.rtpMap)||void 0===a?void 0:a.encodingName.toLowerCase();if(!d||-1===["opus","pcmu","pcma","g722"].indexOf(d))return;r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.minptime="10",r.fmtp.parameters.useinbandfec="1";const l=i._encoderConfig;l&&"pcmu"!==d&&"pcma"!==d&&"g722"!==d&&(l.bitrate&&!Pt()&&(r.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*l.bitrate))),l.sampleRate&&(r.fmtp.parameters.maxplaybackrate="".concat(l.sampleRate),r.fmtp.parameters["sprop-maxcapturerate"]="".concat(l.sampleRate)),l.stereo&&(r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"))})}function ub(s){const i=s.attributes.unrecognized.findIndex(r=>"x-google-flag"===r.attField&&"conference"===r.attValue);-1!==i&&s.attributes.unrecognized.splice(i,1)}function f_(s,i){var r;if(!(i instanceof je&&i._encoderConfig&&-1===i._hints.indexOf(kt.SCREEN_TRACK)))return;const a=i._encoderConfig;Ot().supportMinBitrate&&a.bitrateMin&&s.attributes.payloads.forEach(d=>{var l,h;ye(l=["h264","h265","vp8","vp9","av1"]).call(l,(null===(h=d.rtpMap)||void 0===h?void 0:h.encodingName.toLowerCase())||"")&&(d.fmtp||(d.fmtp={parameters:{}}),d.fmtp.parameters["x-google-min-bitrate"]="".concat(a.bitrateMin))}),Ot().supportMinBitrate&&!ye(r=i._hints).call(r,kt.LOW_STREAM)&&a.bitrateMax&&s.attributes.payloads.forEach(d=>{var l,h;ye(l=["h264","h265","vp8","vp9","av1"]).call(l,(null===(h=d.rtpMap)||void 0===h?void 0:h.encodingName.toLowerCase())||"")&&(d.fmtp||(d.fmtp={parameters:{}}),d.fmtp.parameters["x-google-start-bitrate"]="".concat(B("X_GOOGLE_START_BITRATE")||Math.floor(a.bitrateMax)))})}function j0(s){if("video"!==s.media.mediaType)return;const i=lt();if(i.name!==gt.SAFARI&&i.os!==Zn.IOS)return;const r=s.attributes.extmaps.findIndex(a=>/video-orientation/g.test(a.extensionName));-1!==r&&s.attributes.extmaps.splice(r,1)}function Au(s,i,r){if(!i)return;let a,d;if("video"===s.media.mediaType?(a=r.videoExtensions,d=r.videoCodecs):(a=r.audioExtensions,d=r.audioCodecs),!0===i.twcc){const l=a.find(h=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===h.extensionName);l&&(s.attributes.extmaps.find(f=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===f.extensionName)||s.attributes.extmaps.push({entry:l.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),(f=d,_=s.attributes.payloads,_.filter(g=>!!f.find(v=>v.payloadType===g.payloadType&&!!v.rtcpFeedbacks.find(b=>"transport-cc"===b.type)))).forEach(f=>{f.rtcpFeedbacks.find(_=>"transport-cc"===_.type)||f.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(!1===i.twcc){const l=s.attributes.extmaps.findIndex(h=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===h.extensionName);-1!==l&&s.attributes.extmaps.splice(l,1),s.attributes.payloads.forEach(h=>{const f=h.rtcpFeedbacks.findIndex(_=>"transport-cc"===_.type);-1!==f&&h.rtcpFeedbacks.splice(f,1)})}var f,_;if(!0===i.remb){const l=a.find(h=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===h.extensionName);l&&(s.attributes.extmaps.find(f=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===f.extensionName)||s.attributes.extmaps.push({entry:l.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(f,_){return _.filter(g=>!!f.find(v=>v.payloadType===g.payloadType&&!!v.rtcpFeedbacks.find(b=>"goog-remb"===b.type)))}(d,s.attributes.payloads).forEach(f=>{f.rtcpFeedbacks.find(_=>"goog-remb"===_.type)||f.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(!1===i.remb){const l=s.attributes.extmaps.findIndex(h=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===h.extensionName);-1!==l&&s.attributes.extmaps.splice(l,1),s.attributes.payloads.forEach(h=>{const f=h.rtcpFeedbacks.findIndex(_=>"goog-remb"===_.type);-1!==f&&h.rtcpFeedbacks.splice(f,1)})}}function kp(s,i,r){if(Pt()||"video"!==s.media.mediaType||!(i instanceof je)||"vp9"!==r&&"vp8"!==r||"vp8"===r&&!B("SIMULCAST")||void 0===i._scalabilityMode||i._scalabilityMode.numSpatialLayers<=1)return;const a="vp8"===r?2:i._scalabilityMode.numSpatialLayers,d=s.attributes.ssrcs[0],l=s.attributes.ssrcGroups.find(f=>"FID"===f.semantic&&f.ssrcIds[0]===d.ssrcId),h={semantic:"SIM",ssrcIds:[d.ssrcId]};for(let f=1;f<a;f++)s.attributes.ssrcs.push({ssrcId:d.ssrcId+f,attributes:Ft(d.attributes)}),h.ssrcIds.push(d.ssrcId+f),l&&(s.attributes.ssrcs.push({ssrcId:l.ssrcIds[1]+f,attributes:Ft(d.attributes)}),s.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[d.ssrcId+f,l.ssrcIds[1]+f]}));s.attributes.ssrcGroups.unshift(h)}function Qd(){return Lr.apply(this,arguments)}function Lr(){return Lr=L(function*(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=new RTCPeerConnection;r.addTransceiver("video",{direction:"sendonly"}),r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});const a=(yield r.createOffer()).sdp,{send:d,recv:l,sendrecv:h}=function(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=arguments.length>2?arguments[2]:void 0;const v=_a(g,f,_,"sendonly"),b=_a(g,f,_,"recvonly"),y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},M={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(yi(v,b,"videoExtensions",y,T,M),yi(v,b,"videoCodecs",y,T,M),yi(v,b,"audioExtensions",y,T,M),yi(v,b,"audioCodecs",y,T,M),B("RAISE_H264_BASELINE_PRIORITY")){const O=M.videoCodecs.findIndex(D=>{var x,F;return"h264"===(null===(x=D.rtpMap)||void 0===x?void 0:x.encodingName.toLocaleLowerCase())&&"42001f"===(null===(F=D.fmtp)||void 0===F?void 0:F.parameters["profile-level-id"])});if(-1!==O){const D=M.videoCodecs.findIndex(x=>{var F;return"h264"===(null===(F=x.rtpMap)||void 0===F?void 0:F.encodingName.toLocaleLowerCase())});if(D<O){I.debug("raising H264 baseline profile priority");const x=M.videoCodecs[O];M.videoCodecs.splice(O,1),M.videoCodecs.splice(D,0,x)}-1!==D&&(T.videoCodecs=T.videoCodecs.filter(x=>{var F,j;return!("h264"===(null===(F=x.rtpMap)||void 0===F?void 0:F.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(j=x.fmtp)||void 0===j?void 0:j.parameters["profile-level-id"]))})),-1!==D&&B("FILTER_SEND_H264_BASELINE")&&(y.videoCodecs=y.videoCodecs.filter(x=>{var F,j;return!("h264"===(null===(F=x.rtpMap)||void 0===F?void 0:F.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(j=x.fmtp)||void 0===j?void 0:j.parameters["profile-level-id"]))}))}}return{send:y,recv:T,sendrecv:M}}(s,i,a);try{r.close()}catch{}return{send:d,recv:l,sendrecv:h}}),Lr.apply(this,arguments)}function Hn(){const s={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},i=_a(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"recvonly"),r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(yi(s,i,"videoExtensions",r,a,d),yi(s,i,"videoCodecs",r,a,d),yi(s,i,"audioExtensions",r,a,d),yi(s,i,"audioCodecs",r,a,d),B("RAISE_H264_BASELINE_PRIORITY")){const l=d.videoCodecs.findIndex(h=>h.rtpMap&&"h264"===h.rtpMap.encodingName.toLocaleLowerCase()&&h.fmtp&&"42001f"===h.fmtp.parameters["profile-level-id"]);if(-1!==l){const h=d.videoCodecs.findIndex(f=>f.rtpMap&&"h264"===f.rtpMap.encodingName.toLocaleLowerCase());if(h<l){I.debug("raising H264 baseline profile priority");const f=d.videoCodecs[l];d.videoCodecs.splice(l,1),d.videoCodecs.splice(h,0,f)}-1!==h&&(a.videoCodecs=a.videoCodecs.filter(f=>!(f.rtpMap&&"h264"===f.rtpMap.encodingName.toLocaleLowerCase()&&f.fmtp&&"42001f"!==f.fmtp.parameters["profile-level-id"])))}}return{send:r,recv:a,sendrecv:d}}function yi(s,i,r,a,d,l){if("videoExtensions"===r||"audioExtensions"===r){const h=[];return s[r].forEach(f=>{i[r].some((_,g)=>{if(f.entry===_.entry&&f.extensionName===_.extensionName)return h.push(g),!0})?l[r].push(f):a[r].push(f)}),void i[r].forEach((f,_)=>{-1===h.indexOf(_)&&d[r].push(f)})}if("videoCodecs"===r||"audioCodecs"===r){const h=[];return s[r].forEach(f=>{i[r].some((_,g)=>{if(f.payloadType===_.payloadType&&JSON.stringify(f)===JSON.stringify(_))return h.push(g),!0})?l[r].push(f):a[r].push(f)}),void i[r].forEach((f,_)=>{-1===h.indexOf(_)&&d[r].push(f)})}}function ri(s){const{send:i,recv:r,sendrecv:a}=s;if(!a){if(!i||!r)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:i,recv:r}}let d,l;return i?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...i.audioCodecs,...a.audioCodecs],d.videoCodecs=[...i.videoCodecs,...a.videoCodecs],d.audioExtensions=[...i.audioExtensions,...a.audioExtensions],d.videoExtensions=[...i.videoExtensions,...a.videoExtensions]):d=a,r?(l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},l.audioCodecs=[...r.audioCodecs,...a.audioCodecs],l.videoCodecs=[...r.videoCodecs,...a.videoCodecs],l.audioExtensions=[...r.audioExtensions,...a.audioExtensions],l.videoExtensions=[...r.videoExtensions,...a.videoExtensions]):l=a,{send:d,recv:l}}function ga(s){"audio"===s.media.mediaType&&s.attributes.payloads.filter(i=>{var r;return"opus"===(null===(r=i.rtpMap)||void 0===r?void 0:r.encodingName.toLowerCase())}).forEach(i=>{i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"})}function m_(s){s.mediaDescriptions.forEach(i=>{"video"!==i.media.mediaType&&"audio"!==i.media.mediaType||i.attributes.payloads.forEach(r=>{-1===r.rtcpFeedbacks.findIndex(a=>"rrtr"===a.type)&&r.rtcpFeedbacks.push({type:"rrtr"})})})}function Du(s,i,r,a){let d=[];if(s===Se.VIDEO){if(B("H264_PROFILE_LEVEL_ID")&&"h264"===a&&(d=i.videoCodecs.filter(l=>{var h;return ye(h=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(h,a)&&l&&l.fmtp&&l.fmtp.parameters["profile-level-id"]===B("H264_PROFILE_LEVEL_ID")})),!Array.isArray(d)||0===d.length){let l=[];const h=[],f=[];r.videoCodecs.forEach(_=>{var g,v,b;ye(g=_.rtpMap&&_.rtpMap.encodingName.toLowerCase()||"").call(g,a)&&l.push(_),ye(v=_.rtpMap&&_.rtpMap.encodingName.toLowerCase()||"").call(v,"vp8")&&h.push(_),ye(b=_.rtpMap&&_.rtpMap.encodingName.toLowerCase()||"").call(b,"h264")&&f.push(_)}),0===l.length&&(0!==h.length?(l=h,I.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: vp8"))):0!==f.length&&(l=f,I.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: h264")))),0!==l.length&&(d=i.videoCodecs.filter(_=>l.some(g=>g.payloadType===_.payloadType)))}if(B("USE_PUB_RTX")){const l=d.map(f=>f.payloadType.toString()),h=i.videoCodecs.filter(f=>f.rtpMap&&"rtx"===f.rtpMap.encodingName&&ye(l).call(l,f.fmtp&&f.fmtp.parameters.apt||""));d=[...d,...h]}0===d.length&&(I.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(i.videoCodecs[0].rtpMap&&i.videoCodecs[0].rtpMap.encodingName)),d=i.videoCodecs)}else d=i.audioCodecs.filter(l=>{var h;return ye(h=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(h,a)}),0===d.length&&(I.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),d=i.audioCodecs.filter(l=>{var h;return ye(h=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return d}let yP=class{get localCapabilities(){return Ft(this._localCapabilities)}get rtpCapabilities(){return Ft(this._rtpCapabilities)}get candidates(){return Ft(this._candidates)}get iceParameters(){return Ft(this._iceParameters)}get dtlsParameters(){return Ft(this._dtlsParameters)}constructor(s){C(this,"sessionDesc",void 0),C(this,"_localCapabilities",void 0),C(this,"_rtpCapabilities",void 0),C(this,"_candidates",void 0),C(this,"_iceParameters",void 0),C(this,"_dtlsParameters",void 0),C(this,"setup",void 0),C(this,"currentMidIndex",void 0),C(this,"cname","o/i14u9pJrxRKAsu"),C(this,"firefoxSsrcMidMap",new Map),s=Ft(s);const{remoteIceParameters:i,remoteDtlsParameters:r,candidates:a,remoteRTPCapabilities:d,localCapabilities:l,direction:h,setup:f,videoCodec:_,audioCodec:g}=s;let v;this.setup=f,v=Xt.parse(h===Ei.RECEIVE_ONLY?"v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n":"v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"),this._rtpCapabilities=d,this._candidates=a,this._iceParameters=i,this._dtlsParameters=r,this._localCapabilities=l;const b=h===Ei.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,y=h===Ei.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,T=h===Ei.RECEIVE_ONLY?d.send.videoCodecs:Du(Se.VIDEO,b,y,_),M=h===Ei.RECEIVE_ONLY?d.send.audioCodecs:Du(Se.AUDIO,b,y,g);for(const O of v.mediaDescriptions){if(O.attributes.iceUfrag=i.iceUfrag,O.attributes.icePwd=i.icePwd,O.attributes.fingerprints=r.fingerprints,O.attributes.candidates=a,O.attributes.setup=this.setup,"application"===O.media.mediaType&&(O.attributes.sctpPort="5000"),"video"===O.media.mediaType&&(O.media.fmts=T.map(D=>D.payloadType.toString(10)),O.attributes.payloads=T,O.attributes.extmaps=b.videoExtensions,B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:D,ssrcGroups:x}=Hi([{ssrcId:4e4,rtx:B("USE_SUB_RTX")?40001:void 0}],this.cname);O.attributes.ssrcs=D,O.attributes.ssrcGroups=x}if("audio"===O.media.mediaType&&(O.media.fmts=M.map(D=>D.payloadType.toString(10)),O.attributes.payloads=M,O.attributes.extmaps=b.audioExtensions,ga(O),B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:D,ssrcGroups:x}=Hi([{ssrcId:2e4}],this.cname);O.attributes.ssrcs=D,O.attributes.ssrcGroups=x}}this.sessionDesc=v,this.currentMidIndex=v.mediaDescriptions.length-1}toString(){return Xt.print(this.sessionDesc)}hasMid(s){return Array.isArray(s)?s.every(i=>this.hasMid(i)):this.sessionDesc.mediaDescriptions.some(i=>i.attributes.mid===s)}send(s,i,r,a,d){r=r.replace(/ /g,"-");const{ssrcs:l,ssrcGroups:h}=Hi(i,this.cname,B("SYNC_GROUP")?r:void 0),f=this.findPreloadMediaDesc(l);if(f){if(Pt()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,f.attributes.mid),d&&(d.twcc||d.remb)){const _=this.sessionDesc.mediaDescriptions.indexOf(f);return this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(f,d),{mid:f.attributes.mid,needExchangeSDP:!0}}return{mid:f.attributes.mid,needExchangeSDP:!1}}{const _=this.findAvailableMediaIndex(s,l,a);let g;return-1===_?(g=this.createOrRecycleSendMedia(s,l,h,"sendonly",a,d),this.updateBundleMids()):(g=Ft(this.sessionDesc.mediaDescriptions[_]),g.attributes.direction="sendonly",g.attributes.ssrcs=l,g.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(g,d)),Pt()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,g.attributes.mid),{needExchangeSDP:!0,mid:g.attributes.mid}}}stopSending(s){const i=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&-1!==s.indexOf(r.attributes.mid));if(i.length!==s.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");i.forEach(r=>{r.attributes.ssrcs=[]}),this.updateBundleMids()}receive(s,i,r){const a=[];return s.forEach(d=>{const h=this.findAvailableRecvMediaIndex(d._mediaStreamTrack.kind);let f,_=!1;-1===h?(_=!0,f=this.createOrRecycleRecvMedia(d,[],"recvonly",i,r),this.updateBundleMids()):(f=Ft(this.sessionDesc.mediaDescriptions[h]),f.attributes.direction="recvonly"),a.push({mid:f.attributes.mid,needCreateTransceiver:_})}),a}stopReceiving(s){const i=this.sessionDesc.mediaDescriptions.filter(r=>-1!==s.indexOf(r.attributes.mid));if(i.length!==s.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");i.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(s){const{foundation:i,protocol:r,address:a,port:d,type:l,relatedAddress:h,relatedPort:f,priority:_}=new RTCIceCandidate(s),g={foundation:i??"",componentId:"1",transport:r??"",priority:_?_+"":"",connectionAddress:a??"",port:d?d+"":"",type:l?l+"":"",relAddr:h??"",relPort:f?f+"":"",extension:{}};this.candidates.some(v=>v.priority===g.priority&&v.connectionAddress===g.connectionAddress&&v.port===g.port)||(this._candidates.push(g),this.sessionDesc.mediaDescriptions.forEach(v=>{v.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(s,i,r,a,d){const l=s._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,f=Du(l,h,this.localCapabilities.send,l===Se.AUDIO?d:a),_=l===Se.VIDEO?h.videoExtensions:h.audioExtensions,g="".concat(++this.currentMidIndex);let v={media:{mediaType:l,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};v=this.mungRecvMediaDsec(v,s);const b=this.findFirstClosedMedia(l);if(b){const y=this.sessionDesc.mediaDescriptions.indexOf(b);this.sessionDesc.mediaDescriptions[y]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}muteRemote(s){const i=this.sessionDesc.mediaDescriptions.filter(r=>ye(s).call(s,r.attributes.mid||""));if(i.length!==s.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(s){const i=this.sessionDesc.mediaDescriptions.filter(r=>ye(s).call(s,r.attributes.mid||""));if(i.length!==s.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(r=>{r.attributes.direction="recvonly"})}findAvailableMediaIndex(s,i,r){return this.sessionDesc.mediaDescriptions.findIndex(a=>{const d=a.media.mediaType===s&&"0"!==a.media.port&&("sendonly"===a.attributes.direction||"sendrecv"===a.attributes.direction)&&0===a.attributes.ssrcs.length;if(Pt()){if(d){const l=this.firefoxSsrcMidMap.get(i[0].ssrcId);return!(l||"0"!==a.attributes.mid&&"1"!==a.attributes.mid)||!(!l||l!==a.attributes.mid)}return!1}return d&&a.attributes.mid===r})}findAvailableRecvMediaIndex(s){return this.sessionDesc.mediaDescriptions.findIndex(i=>"0"!==i.attributes.mid&&"1"!==i.attributes.mid&&i.media.mediaType===s&&"0"!==i.media.port&&("recvonly"===i.attributes.direction||"sendrecv"===i.attributes.direction))}predictReceivingMids(s){const i=[];for(let r=0;r<s;r++)i.push((this.currentMidIndex+r+1).toString(10));return i}restartICE(s){s=Ft(s),this._iceParameters=s,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=s.iceUfrag,i.attributes.icePwd=s.icePwd})}createOrRecycleSendMedia(s,i,r,a,d,l){const h=this.rtpCapabilities.send,f=s===Se.VIDEO?h.videoCodecs:h.audioCodecs,_=s===Se.VIDEO?h.videoExtensions:h.audioExtensions;Pt()&&(d="".concat(++this.currentMidIndex));let g={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:d}};g=this.mungSendMediaDesc(g,l);const v=this.findFirstClosedMedia(s);if(v){const b=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[b]=g}else this.sessionDesc.mediaDescriptions.push(g);return g}mungRecvMediaDsec(s,i,r){const a=Ft(s);return ub(a),Jd(a,i),f_(a,i),j0(a),Au(a,r,this.localCapabilities.send),a}mungSendMediaDesc(s,i){const r=Ft(s);return Au(r,i,this.localCapabilities.recv),ga(r),r}updateRecvMedia(s,i){const r=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===s);if(-1!==r){const a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],i);this.sessionDesc.mediaDescriptions[r]=a}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(s=>"0"!==s.media.port).map(s=>s.attributes.mid)}findPreloadMediaDesc(s){return this.sessionDesc.mediaDescriptions.find(i=>{var r;return(null===(r=i.attributes)||void 0===r||null===(r=r.ssrcs[0])||void 0===r?void 0:r.ssrcId)===s[0].ssrcId})}findFirstClosedMedia(s){return this.sessionDesc.mediaDescriptions.find(i=>Pt()?"0"===i.media.port&&i.media.mediaType===s:"0"===i.media.port)}};const LF=["sdp"];function SP(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Ou(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?SP(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):SP(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}let Es=class Xb extends Pm{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var i,r;return null!==(i=null===(r=this.peerConnection.getReceivers()[0])||void 0===r||null===(r=r.transport)||void 0===r?void 0:r.state)&&void 0!==i?i:null}get localCodecs(){return[]}set isInRestartIce(i){this._isInRestartIce=i}get isInRestartIce(){return this._isInRestartIce}constructor(i,r,a){super(i,r),C(this,"direction",void 0),C(this,"name",void 0),C(this,"store",void 0),C(this,"spec",void 0),C(this,"peerConnection",void 0),C(this,"initialOffer",void 0),C(this,"transport",void 0),C(this,"statsFilter",void 0),C(this,"localCandidateCount",0),C(this,"allCandidatesReceived",!1),C(this,"localCandidateAddress",null),C(this,"useXR",B("USE_XR")),C(this,"filter",{filterRTX:!B("USE_PUB_RTX")&&!B("USE_SUB_RTX"),filterVideoFec:B("FILTER_VIDEO_FEC"),filterAudioFec:B("FILTER_AUDIO_FEC")}),C(this,"extension",{useXR:this.useXR}),C(this,"_isInRestartIce",!1),C(this,"mutex",new gi("P2PConnection-mutex")),C(this,"onLocalCandidate",void 0),C(this,"remoteSDP",void 0),C(this,"pendingCandidates",[]),C(this,"localCapabilities",void 0),C(this,"isReady",!1),C(this,"restartCnt",0),C(this,"curTurnServerIndex",0),this.store=r,this.spec=i,this.peerConnection=new RTCPeerConnection(Xb.resolvePCConfiguration(i,r.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=a??Ei.SEND_ONLY,this.name=this.direction===Ei.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=xp(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,Pt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}establish(i){var r=this;return L(function*(){try{const a=yield Qd(r.filter,r.extension);if(r.localCapabilities=ri(a),i){const{sdp:d}=i,l=function uo(s,i){if(null==s)return{};var r,a,d=function(h,f){if(null==h)return{};var _,g,v={},b=wF(h);for(g=0;g<b.length;g++)_=b[g],mP(f).call(f,_)>=0||(v[_]=h[_]);return v}(s,i);if(U0){var l=U0(s);for(a=0;a<l.length;a++)r=l[a],mP(i).call(i,r)>=0||Object.prototype.propertyIsEnumerable.call(s,r)&&(d[r]=s[r])}return d}(i,LF),h=function(){const b={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},y=_a(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"sendonly"),T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},M={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(yi(y,b,"videoExtensions",T,M,O),yi(y,b,"videoCodecs",T,M,O),yi(y,b,"audioExtensions",T,M,O),yi(y,b,"audioCodecs",T,M,O),B("RAISE_H264_BASELINE_PRIORITY")){const D=O.videoCodecs.findIndex(x=>x.rtpMap&&"h264"===x.rtpMap.encodingName.toLocaleLowerCase()&&x.fmtp&&"42001f"===x.fmtp.parameters["profile-level-id"]);if(-1!==D){const x=O.videoCodecs.findIndex(F=>F.rtpMap&&"h264"===F.rtpMap.encodingName.toLocaleLowerCase());if(x<D){I.debug("raising H264 baseline profile priority");const F=O.videoCodecs[D];O.videoCodecs.splice(D,1),O.videoCodecs.splice(x,0,F)}-1!==x&&B("FILTER_SEND_H264_BASELINE")&&(T.videoCodecs=T.videoCodecs.filter(F=>!(F.rtpMap&&"h264"===F.rtpMap.encodingName.toLocaleLowerCase()&&F.fmtp&&"42001f"!==F.fmtp.parameters["profile-level-id"])))}}return{send:T,recv:M,sendrecv:O}}(r.filter,r.extension,d);r.remoteSDP=new yP({remoteIceParameters:l.iceParameters,remoteDtlsParameters:l.dtlsParameters,candidates:[],remoteRTPCapabilities:h,localCapabilities:r.localCapabilities,direction:r.direction,setup:"actpass",videoCodec:r.store.codec,audioCodec:r.store.audioCodec}),yield r.setRemoteDescription({type:"offer",sdp:r.remoteSDP.toString()}),r.isReady=!0;const f=yield r.peerConnection.createAnswer();if(!f.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const _=qs(f.sdp);yield r.peerConnection.setLocalDescription(f);const g=yield Hn(r.filter,r.extension,f.sdp);r.localCapabilities=ri(g);const v=r.peerConnection.getTransceivers()[0];return null!=v&&v.receiver&&v.receiver.transport&&r.tryBindTransportEvents(v.receiver.transport),Ou(Ou({},_),{},{sdp:f.sdp})}{r.peerConnection.addTransceiver("video",{direction:"sendonly"}),r.peerConnection.addTransceiver("audio",{direction:"sendonly"});const d=yield r.peerConnection.createOffer();if(!d.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const l=qs(d.sdp);return r.initialOffer=d,Ou(Ou({},l),{},{sdp:d.sdp})}}catch(a){throw new ee(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}})()}connect(i){var r=this;return L(function*(){try{if(!r.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");yield r.peerConnection.setLocalDescription(r.initialOffer);const{sdp:a,iceParameters:d,dtlsParameters:l}=i,h=yield Hn(r.filter,r.extension,a);r.remoteSDP=new yP({remoteIceParameters:d,remoteDtlsParameters:l,candidates:[],remoteRTPCapabilities:h,localCapabilities:r.localCapabilities,direction:r.direction,setup:"active",videoCodec:r.store.codec,audioCodec:r.store.audioCodec}),yield r.setRemoteDescription({type:"answer",sdp:r.remoteSDP.toString()});const f=r.peerConnection.getTransceivers()[0];null!=f&&f.sender&&f.sender.transport&&r.tryBindTransportEvents(f.sender.transport)}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(a.toString()))}})()}addRemoteCandidate(i){var r=this;return L(function*(){try{i&&r.pendingCandidates.push(i),r.peerConnection.remoteDescription&&r.isReady&&(r.pendingCandidates.forEach(a=>{r.peerConnection.addIceCandidate(a)}),r.pendingCandidates=[])}catch(a){throw new ee(k.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(a.toString()))}})()}send(i,r,a){var d=this;return Xr(function*(){const l=yield Be(d.mutex.lock("From P2PConnection.send"));try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],f=d.remoteSDP.receive(i,r,a);i.forEach((D,x)=>{if(f[x].needCreateTransceiver){const F=d.peerConnection.addTransceiver(D._mediaStreamTrack,{direction:"sendonly"});h.push(F),D._updateRtpTransceiver(F)}else{const F=d.peerConnection.getTransceivers().find(j=>j.mid===f[x].mid);if(!F)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(f[x].mid));h.push(F),D._updateRtpTransceiver(F)}}),Pt()&&!0===B("SIMULCAST")&&(yield Be(d.applySimulcastForFirefox(h,i)));const _=f.map(D=>D.mid),g=yield Be(d.peerConnection.createOffer()),v=d.mungSendOfferSDP(g.sdp,i,_),b=Xt.parse(v),y=_.map(D=>{const x=b.mediaDescriptions.find(F=>F.attributes.mid===D);if(!x)throw new Error("Cannot extract ssrc from mediaDescription.");return lb(x,B("USE_PUB_RTX"))}),T=h.map((D,x)=>({localSSRC:y[x],id:_[x]}));yield Be(d.peerConnection.setLocalDescription({type:"offer",sdp:v}));try{yield T}catch(D){const x=d.remoteSDP.toString();throw yield Be(d.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Be(d.peerConnection.setRemoteDescription({type:"answer",sdp:x})),yield Be(d.stopSending(_,!0)),D}yield Be(d.applySimulcastEncodings(h,i)),yield Be(d.applySendEncodings(h,i));const M=d.remoteSDP.toString(),O=d.logSDPExchange(v,"offer","local","send");return O?.(M),yield Be(d.setRemoteDescription({type:"answer",sdp:M})),h.map((D,x)=>({localSSRC:y[x],id:_[x]}))}catch(h){throw h instanceof ee?h:new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{l()}})()}stopSending(i,r){var a=this;return L(function*(){const d=r?void 0:yield a.mutex.lock("From P2PConnection.stopSending");try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const l=a.peerConnection.getTransceivers().filter(g=>-1!==i.indexOf(g.mid));if(l.length!==i.length)throw new Error("Transceivers' length (".concat(l.length,") doesn't match mids' length (").concat(i.length,") when trying to call P2PConnection.stopSending."));l.map(g=>{var v;g.direction="inactive",null===(v=g.stop)||void 0===v||v.call(g)});const h=yield a.peerConnection.createOffer(),f=a.logSDPExchange(h.sdp||"","offer","local","stopSending");yield a.peerConnection.setLocalDescription(h),a.remoteSDP.stopReceiving(i);const _=a.remoteSDP.toString();f?.(_),yield a.setRemoteDescription({type:"answer",sdp:_})}catch(l){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(l.toString()))}finally{d&&d()}})()}receive(i,r,a,d){var l=this;return L(function*(){try{if(!l.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{mid:h,needExchangeSDP:f}=l.remoteSDP.send(i,r,a,d);if(f){const g=l.remoteSDP.toString(),v=l.logSDPExchange(g,"offer","remote","receive");yield l.setRemoteDescription({type:"offer",sdp:g});const b=yield l.peerConnection.createAnswer(),y=l.mungReceiveAnswerSDP(b.sdp,h,i);v?.(y||""),yield l.peerConnection.setLocalDescription({type:"answer",sdp:y}),I.debug("[".concat(l.store.clientId,"] [P2PConnection] receive ").concat(i," by exchanging SDP."))}else I.debug("[".concat(l.store.clientId,"] [P2PConnection] receive ").concat(i," no need to exchange SDP."));const _=l.peerConnection.getTransceivers().find(g=>g.mid===h);if(!_||null===_.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:_.receiver.track,mid:_.mid,transceiver:_}}catch(h){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}mockReceive(i,r,a,d){var l=this;return L(function*(){try{if(!l.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{mid:h,needExchangeSDP:f}=l.remoteSDP.send(i,r,a,d);if(f){const _=l.remoteSDP.toString(),g=l.logSDPExchange(_,"offer","remote","receive");yield l.setRemoteDescription({type:"offer",sdp:_});const v=yield l.peerConnection.createAnswer(),b=l.mungReceiveAnswerSDP(v.sdp,h,i);g?.(b||""),yield l.peerConnection.setLocalDescription({type:"answer",sdp:b}),I.debug("[".concat(l.store.clientId,"] [P2PConnection] receive ").concat(i," by exchanging SDP."))}else I.debug("[".concat(l.store.clientId,"] [P2PConnection] receive ").concat(i," no need to exchange SDP."))}catch(h){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}stopReceiving(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.remoteSDP.stopSending(i);const a=r.remoteSDP.toString(),d=r.logSDPExchange(a,"offer","remote","stopReceiving");yield r.setRemoteDescription({type:"offer",sdp:a});const l=yield r.peerConnection.createAnswer();d?.(l.sdp||""),yield r.peerConnection.setLocalDescription(l)}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}})()}restartICE(i){var r=this;return L(function*(){try{if(r.store.p2pTransport===Mc.Auto&&(r.store.p2pTransport=Mc.SdRtn,Ot().supportPCSetConfiguration&&r.peerConnection.setConfiguration(Xb.resolvePCConfiguration(r.spec,r.store.p2pTransport))),r.restartCnt>3&&(r.restartCnt=0,Ot().supportPCSetConfiguration&&r.peerConnection.setConfiguration(Xb.resolvePCConfiguration(r.spec,r.store.p2pTransport,++r.curTurnServerIndex))),!i){r.restartCnt++,r.isReady=!1;const a=yield r.peerConnection.createOffer({iceRestart:!0});if(!a.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:d}=qs(a.sdp);return r.store.descriptionStart(),r.direction===Ei.SEND_ONLY&&(yield r.peerConnection.setLocalDescription(a)),d}if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(r.remoteSDP.restartICE(i),r.store.descriptionStart(),r.direction===Ei.RECEIVE_ONLY){r.restartCnt++,yield r.setRemoteDescription({type:"offer",sdp:r.remoteSDP.toString()});const a=yield r.peerConnection.createAnswer();if(!a.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:d}=qs(a.sdp);return yield r.peerConnection.setLocalDescription(a),d}yield r.setRemoteDescription({type:"answer",sdp:r.remoteSDP.toString()}),r.isReady=!0}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}})()}close(){var i;this.peerConnection.close(),this.peerConnection.onicecandidate=null,null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}updateEncoderConfig(i,r){var a=this;return L(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const d=yield a.peerConnection.createOffer(),l=a.mungSendOfferSDP(d.sdp,[r],[i]);a.remoteSDP.updateRecvMedia(i,r);const h=a.remoteSDP.toString(),f=a.logSDPExchange(l,"offer","local","updateEncoderConfig");yield a.peerConnection.setLocalDescription({type:"offer",sdp:l}),f?.(h),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(d){throw new ee(k.EXCHANGE_SDP_FAILED,d.toString())}})()}updateSendParameters(i,r){var a=this;return L(function*(){const d=a.peerConnection.getTransceivers().filter(l=>l.mid===i);1===d.length&&(a.isVP8Simulcast(r)?Pt()||(yield a.applySimulcastEncodings(d,[r])):yield a.applySendEncodings(d,[r]))})()}setStatsRemoteVideoIsReady(i,r){this.statsFilter.setVideoIsReady2(i,r)}replaceTrack(i,r){var a=this;return L(function*(){const d=a.peerConnection.getTransceivers().find(l=>l.mid===r);d&&(yield d.sender.replaceTrack(i._mediaStreamTrack))})()}getSelectedCandidatePair(){var i=this;return L(function*(){const r=i.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const a=r[0].transport.iceTransport,{local:d,remote:l}=a.getSelectedCandidatePair();return{local:Ou(Ou({},$a),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port}),remote:Ou(Ou({},$a),{},{candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port})}}return i.statsFilter.getSelectedCandidatePair()})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i,r;ye(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)&&(this.isReady=!1),null===(r=this.onICEConnectionStateChange)||void 0===r||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;"connected"===this.peerConnection.connectionState&&(this.restartCnt=0),null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=i=>{var r;i.candidate?(i.candidate.candidate&&(this.localCandidateAddress=i.candidate.address,null===(r=this.onLocalCandidate)||void 0===r||r.call(this,i.candidate.toJSON())),this.localCandidateCount+=1):(this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i,r){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const d={iceServers:[]};var l;return i.iceServers?d.iceServers=i.iceServers:i.turnServer&&"off"!==i.turnServer.mode&&(oa(i.turnServer.servers)?d.iceServers=i.turnServer.servers:(d.iceServers&&d.iceServers.push(...Xb.turnServerConfigToIceServers(i.turnServer.servers,r,a)),B("USE_TURN_SERVER_OF_GATEWAY")&&d.iceServers&&i.turnServer.serversFromGateway&&d.iceServers.push(...Xb.turnServerConfigToIceServers(i.turnServer.serversFromGateway,r,a)),ye(l=[Mc.Relay,Mc.SdRtn]).call(l,r)&&(d.iceTransportPolicy="relay"),B("FORCE_TURN_TCP")?d.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(d.iceTransportPolicy="relay")}))),B("ENABLE_ENCODED_TRANSFORM")&&Ot().supportWebRTCEncodedTransform&&(d.encodedInsertableStreams=!0),I.debug("P2PConnection p2pTransport is ".concat(r)),d}static turnServerConfigToIceServers(i,r){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const d=[],l=i.filter(f=>f.tcpport);I.debug("P2PConnection turnServers is ".concat(l,", current index is ").concat(a));const h=l.length>a?l[a]:l[0];switch(r){case Mc.SdRtn:const f=i.filter(g=>{var v;return ye(v=g.username).call(v,"glb:")&&g.turnServerURL==g.turnServerURL}),_=f.length>a?f[a]:f[0];_&&(d.push({username:_.username,credential:_.password,credentialType:"password",urls:"turn:".concat(Bd(_.turnServerURL),":").concat(_.tcpport,"?transport=udp")}),d.push({username:_.username,credential:_.password,credentialType:"password",urls:"turns:".concat(Bd(_.turnServerURL),":").concat(_.tcpport,"?transport=tcp")}));break;case Mc.Relay:h&&(d.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),d.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Bd(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(d.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),d.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Bd(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),d.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return d}tryBindTransportEvents(i){if(i){this.transport=i,i.onstatechange=()=>{var a;null!=i&&i.state&&(null===(a=this.onDTLSTransportStateChange)||void 0===a||a.call(this,i.state))},i.onerror=a=>{var d;null===(d=this.onDTLSTransportError)||void 0===d||d.call(this,"error"in a?a.error:a)};const r=i.iceTransport;r&&(r.onstatechange=()=>{const a=i?.iceTransport.state;var d;a&&(null===(d=this.onICETransportStateChange)||void 0===d||d.call(this,a))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:a,remote:d}=r.getSelectedCandidatePair();I.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol}),", remote ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(i,r){var a=this;return L(function*(){var d;if(r||(r=a.peerConnection.getSenders().find(b=>b.track===i._mediaStreamTrack)),!r)return I.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(a.isVP8Simulcast(i))return I.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ot().supportSetRtpSenderParameters)return I.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const l={},h={};switch(i._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;default:l.degradationPreference="balanced"}if(i._encoderConfig){var f;const{bitrateMax:b,frameRate:y,scaleResolutionDownBy:T}=i._encoderConfig;b&&(h.maxBitrate=1e3*b),ye(f=i._hints).call(f,kt.LOW_STREAM)&&(y&&(h.maxFramerate=No(y)),T&&T>=1&&(h.scaleResolutionDownBy=T))}if(B("DSCP_TYPE")&&Rd()){var _;const b=B("DSCP_TYPE");ye(_=["very-low","low","medium","high"]).call(_,b)&&(h.networkPriority=b)}const g=r.getParameters(),v=null===(d=g.encodings)||void 0===d?void 0:d[0];Pt()&&!v&&(l.encodings=[h]),v&&Object.assign(v,h),Object.assign(g,l),I.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),yield r.setParameters(g)})()}applySendEncodings(i,r){var a=this;return L(function*(){try{if(!Ot().supportSetRtpSenderParameters||i.length!==r.length)return;for(let d=0;d<i.length;d++){const l=i[d],h=r[d];h instanceof je&&!a.isVP8Simulcast(h)&&(yield a.updateRtpSenderEncodings(h,l.sender))}}catch{I.debug("[".concat(a.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(i,r,a){const d=Xt.parse(i);return r.forEach((l,h)=>{const f=a[h],_=d.mediaDescriptions.find(g=>g.attributes.mid===f);_&&(Jd(_,l),kp(_,l,this.store.codec))}),Xt.print(d)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,r,a)=>{var d;null===(d=this.onFirstVideoDecoded)||void 0===d||d.call(this,i,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var r;null===(r=this.onFirstVideoDecodedTimeout)||void 0===r||r.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(i,r){var a=this;return L(function*(){if(i.length===r.length)for(let g=0;g<i.length;g++){var d,l,h,f,_;const v=i[g],b=r[g];if(b instanceof je&&!ye(d=b._hints).call(d,kt.LOW_STREAM)&&null!==(l=b._encoderConfig)&&void 0!==l&&l.bitrateMax&&(null===(h=b._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(f=b._scalabilityMode)&&void 0!==f&&f.numSpatialLayers&&(null===(_=b._scalabilityMode)||void 0===_?void 0:_.numSpatialLayers)>1&&"vp8"===a.store.codec){const y={},T={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};y.encodings=[{rid:"m",active:!0,maxBitrate:T.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:T.high}];const M=v.sender.getParameters();yield v.sender.setParameters(Object.assign(M,y))}}})()}applySimulcastEncodings(i,r){var a=this;return L(function*(){if(!Pt()&&i.length===r.length)for(let d=0;d<i.length;d++){const l=r[d];if(l instanceof je&&a.isVP8Simulcast(l)){const h=i[d],f={},_={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:_.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:_.medium,scaleResolutionDownBy:4}];const g=h.sender.getParameters();yield h.sender.setParameters(Object.assign(g,f))}}})()}isVP8Simulcast(i){var r,a,d,l,h;return!!(i instanceof je&&B("SIMULCAST")&&"vp8"===this.store.codec&&!ye(r=i._hints).call(r,kt.LOW_STREAM)&&null!==(a=i._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(d=i._encoderConfig)||void 0===d?void 0:d.bitrateMax)>200&&null!==(l=i._scalabilityMode)&&void 0!==l&&l.numSpatialLayers&&(null===(h=i._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(i,r,a,d){if(B("SDP_LOGGING"))return I.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(r," SDP during P2PConnection.").concat(d,"\n"),i),"offer"===r?l=>{this.logSDPExchange(l,"answer","local"===a?"remote":"local",d)}:void 0}muteLocal(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(f=>f.mid&&-1!==i.indexOf(f.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(f=>{f.direction="inactive"});const d=yield r.peerConnection.createOffer(),l=r.logSDPExchange(d.sdp||"","offer","local","muteLocal");yield r.peerConnection.setLocalDescription(d),r.remoteSDP.muteRemote(i);const h=r.remoteSDP.toString();l?.(h),yield r.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(a.toString()))}})()}unmuteLocal(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(f=>f.mid&&-1!==i.indexOf(f.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(function(){var f=L(function*(_){_.direction="sendonly"});return function(_){return f.apply(this,arguments)}}());const d=yield r.peerConnection.createOffer(),l=r.logSDPExchange(d.sdp||"","offer","local","unmuteLocal");yield r.peerConnection.setLocalDescription(d),r.remoteSDP.unmuteRemote(i);const h=r.remoteSDP.toString();l?.(h),yield r.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(a.toString()))}})()}getRemoteSSRC(i,r){var a=this;return L(function*(){var d,l;if(r=null!==(d=r)&&void 0!==d?d:null===(l=a.currentRemoteDescription)||void 0===l?void 0:l.sdp){var h;const f=null===(h=Xt.parse(r).mediaDescriptions.find(_=>_.attributes.mid===i))||void 0===h?void 0:h.attributes.ssrcs;return f?.[0].ssrcId}})()}setRemoteDescription(i){var r=this;return L(function*(){var a;yield r.peerConnection.setRemoteDescription(i),ye(a=["connected","completed"]).call(a,r.peerConnection.iceConnectionState)||(r.isReady=!0,r.addRemoteCandidate())})()}mungReceiveAnswerSDP(i,r,a){const d=Xt.parse(i),l=d.mediaDescriptions.find(h=>h.attributes.mid===r);return l&&(a===Se.AUDIO&&"audio"===l.media.mediaType&&ga(l),this.useXR&&m_(d)),Xt.print(d)}};function ho(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=L(function*(){const d=this.mutex,l=yield d.lock("From P2PConnection.".concat(i));try{for(var h=arguments.length,f=new Array(h),_=0;_<h;_++)f[_]=arguments[_];return yield a.apply(this,f)}finally{l()}}),r}function Lp(s,i){let r=document.createElement("video"),a=document.createElement("canvas");r.setAttribute("style","display:none"),a.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),a.width=No(i.width),a.height=No(i.height);const d=No(i.framerate||15);document.body.append(r),document.body.append(a);let l=s._mediaStreamTrack;r.srcObject=new MediaStream([l]),r.play();const h=a.getContext("2d");if(!h)throw new W(k.UNEXPECTED_ERROR,"can not get canvas context");const f=Ot(),_=a.captureStream(f.supportRequestFrame?0:d).getVideoTracks()[0];_.canvas||(_.canvas=a),a.startCapture=()=>{if(!r)return a.stopCapture&&a.stopCapture();if(r.paused&&r.play(),r.videoHeight>2&&r.videoWidth>2){const y=a.width*(r.videoHeight/r.videoWidth);Math.abs(y-a.height)>=2&&(I.debug("adjust low stream resolution","".concat(a.width,"x").concat(a.height," -> ").concat(a.width,"x").concat(y)),a.height=y)}h.drawImage(r,0,0,a.width,a.height),_.requestFrame&&_.requestFrame(),l!==s._mediaStreamTrack&&(l=s._mediaStreamTrack,r.srcObject=new MediaStream([l]))},a.stopCapture=YT(()=>a.startCapture&&a.startCapture(),d);const g=_.stop;return _.stop=()=>{g.call(_),r&&(r.remove(),r.srcObject=null,r=null),a&&(a.width=0,a.remove(),a.stopCapture&&a.stopCapture(),a.startCapture=void 0,a.stopCapture=void 0,a=null),I.debug("clean low stream renderer")},_}var Zd,vs,$n,Nu,Zi,__,H0,Jc,Bo,G0,jo;ne([ho,N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],Es.prototype,"establish",null),ne([ho,N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],Es.prototype,"connect",null),ne([ho,N("design:type",Function),N("design:paramtypes",[String,Array,String,String]),N("design:returntype",X)],Es.prototype,"receive",null),ne([ho,N("design:type",Function),N("design:paramtypes",[String,Array,String,String]),N("design:returntype",X)],Es.prototype,"mockReceive",null),ne([ho,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],Es.prototype,"stopReceiving",null),ne([ho,N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],Es.prototype,"restartICE",null),ne([ho,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Es.prototype,"close",null),ne([ho,N("design:type",Function),N("design:paramtypes",[String,Bi]),N("design:returntype",X)],Es.prototype,"updateEncoderConfig",null),ne([ho,N("design:type",Function),N("design:paramtypes",[String,Bi]),N("design:returntype",X)],Es.prototype,"updateSendParameters",null),ne([ho,N("design:type",Function),N("design:paramtypes",[Bi,String]),N("design:returntype",X)],Es.prototype,"replaceTrack",null),ne([ho,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],Es.prototype,"muteLocal",null),ne([ho,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],Es.prototype,"unmuteLocal",null),function(s){s[s.HEIGHT=2033]="HEIGHT",s[s.FRAME_RATE=2034]="FRAME_RATE",s[s.WIDTH=2035]="WIDTH"}(Zd||(Zd={})),function(s){s[s.HEIGHT=2072]="HEIGHT",s[s.FRAME_RATE=2074]="FRAME_RATE",s[s.WIDTH=2076]="WIDTH"}(vs||(vs={})),function(s){s[s.FRAME_RATE=2002]="FRAME_RATE",s[s.WIDTH=2003]="WIDTH",s[s.HEIGHT=2004]="HEIGHT",s[s.PACKAGE_LOST=2005]="PACKAGE_LOST",s[s.AVG_ENCODE=2007]="AVG_ENCODE",s[s.NACKS=2009]="NACKS",s[s.PLIS=2010]="PLIS",s[s.FIRS=2011]="FIRS",s[s.BITRATE=2012]="BITRATE",s[s.PACKAGE_RATE=2031]="PACKAGE_RATE",s[s.ADAPTATION=2032]="ADAPTATION",s[s.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",s[s.BANDWIDTH=2061]="BANDWIDTH",s[s.RETRANSMIT=2062]="RETRANSMIT",s[s.TARGET_ENCODED=2064]="TARGET_ENCODED",s[s.TRANSMIT=2066]="TRANSMIT",s[s.FREEZE=2082]="FREEZE",s[s.DISABLED=2095]="DISABLED",s[s.PLAYER_STATUS=2128]="PLAYER_STATUS",s[s.QP_SUM=2143]="QP_SUM"}($n||($n={})),function(s){s[s.BITRATE=2069]="BITRATE",s[s.PACKAGE_LOST=2070]="PACKAGE_LOST",s[s.PACKAGE_RATE=2071]="PACKAGE_RATE",s[s.HEIGHT=2073]="HEIGHT",s[s.FRAME_RATE=2075]="FRAME_RATE",s[s.WIDTH=2077]="WIDTH"}(Nu||(Nu={})),function(s){s[s.JITTER=-1]="JITTER",s[s.PACKAGE_LOST=2014]="PACKAGE_LOST",s[s.WIDTH=2018]="WIDTH",s[s.HEIGHT=2019]="HEIGHT",s[s.FRAME_RATE=2020]="FRAME_RATE",s[s.JITTER_BUFFER=2023]="JITTER_BUFFER",s[s.CURRENT_DELAY=2024]="CURRENT_DELAY",s[s.NACKS=2026]="NACKS",s[s.PLIS=2027]="PLIS",s[s.FIRS=2028]="FIRS",s[s.BITRATE=2029]="BITRATE",s[s.PACKAGE_RATE=2078]="PACKAGE_RATE",s[s.FREEZE=2084]="FREEZE",s[s.DISABLED=2101]="DISABLED",s[s.PLAYER_STATUS=2129]="PLAYER_STATUS",s[s.QP_SUM=2144]="QP_SUM",s[s.I_FRAME_DELAY=2149]="I_FRAME_DELAY"}(Zi||(Zi={})),function(s){s[s.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",s[s.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",s[s.FREEZE_TIME=2109]="FREEZE_TIME",s[s.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER"}(__||(__={})),function(s){s[s.PCM_LEVEL=2104]="PCM_LEVEL"}(H0||(H0={})),function(s){s[s.PACKAGE_LOST=-1]="PACKAGE_LOST",s[s.LEVEL=2038]="LEVEL",s[s.BITRATE=2039]="BITRATE",s[s.PACKAGE_RATE=2040]="PACKAGE_RATE",s[s.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",s[s.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",s[s.FREEZE=2081]="FREEZE",s[s.DISABLED=2096]="DISABLED"}(Jc||(Jc={})),function(s){s[s.BITRATE=2044]="BITRATE",s[s.PACKAGE_LOST=2045]="PACKAGE_LOST",s[s.PACKAGE_RATE=2046]="PACKAGE_RATE",s[s.CURRENT_DELAY=2047]="CURRENT_DELAY",s[s.JITTER_BUFFER=2054]="JITTER_BUFFER",s[s.JITTER=2055]="JITTER",s[s.FREEZE=2083]="FREEZE",s[s.DISABLED=2102]="DISABLED",s[s.PCM_LEVEL=2105]="PCM_LEVEL",s[s.PLAYER_STATUS=2130]="PLAYER_STATUS",s[s.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES"}(Bo||(Bo={})),function(s){s[s.FREEZE_TIME=-1]="FREEZE_TIME",s[s.LEVEL=2043]="LEVEL"}(G0||(G0={})),function(s){s[s.RTT=2006]="RTT",s[s.CONN_TYPE=801]="CONN_TYPE"}(jo||(jo={}));const el=1e3;function Ge(s,i,r){null!=r&&Number.isFinite(r)&&(s[i]=Math.round(Math.max(0,r)))}function CP(s){const i={[jo.CONN_TYPE]:0,[jo.RTT]:s.rtt};switch(s.selectedCandidatePair.localCandidate.candidateType){case"relay":{const r=s.selectedCandidatePair.localCandidate.relayProtocol;"udp"===r&&(i[jo.CONN_TYPE]=1),"tcp"===r&&(i[jo.CONN_TYPE]=3),"tls"===r&&(i[jo.CONN_TYPE]=4);break}case"srflx":i[jo.CONN_TYPE]=2}return i}class TP extends jt{constructor(i){super(),C(this,"store",void 0),C(this,"uploadWRTCStatsTimer",void 0),C(this,"uploadOutboundDenoiserStatsTimer",void 0),C(this,"uploadExtStatsTimer",void 0),C(this,"uploadExtUsageStatsTimer",void 0),C(this,"uploadInboundExtStatsTimer",void 0),C(this,"requestStats",void 0),C(this,"requestTransportStats",void 0),C(this,"requestLocalMedia",void 0),C(this,"requestRemoteMedia",void 0),C(this,"requestAllTracks",void 0),C(this,"requestVideoIsReady",void 0),C(this,"requestUploadStats",void 0),C(this,"requestUpload",void 0),C(this,"uploadOutboundStarted",!1),C(this,"uploadInboundStarted",!1),C(this,"uploadTransportStarted",!1),C(this,"uploadExtensionUsageStarted",!1),C(this,"lastRecvStats",void 0),C(this,"lastSendStats",void 0),C(this,"lastFullRecvStats",void 0),C(this,"lastFullSendStats",void 0),C(this,"needUploadRenderFreezeTime",!0),this.store=i}uploadWRTCStats(i){if(!this.requestStats||!this.requestUploadStats)return;let r,a;if(this.uploadTransportStarted&&(r=this.requestStats(),this.store.useP2P&&(a=this.requestStats(!0))),!r&&this.uploadOutboundStarted&&(r=this.requestStats()),!a&&this.uploadInboundStarted&&(a=this.requestStats(!0)),r||a){const d={};if(this.uploadTransportStarted&&r){const l=this.getTransportStats(r,a,i);l&&(d.misc=[l])}if(this.uploadOutboundStarted&&r){const l=this.getOutboundStats(r,i?this.lastSendStats:this.lastFullSendStats,i);l&&(d.outbound=[l])}if(this.uploadInboundStarted&&a){const l=this.getInboundStats(a,i?this.lastRecvStats:this.lastFullRecvStats,i);l&&(d.inbound=l)}this.requestUploadStats(d)}this.lastRecvStats=a,this.lastSendStats=r,i||(this.lastFullRecvStats=a,this.lastFullSendStats=r)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let i=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(3!==i),4==++i&&(i=1)},el)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(i,r,a){if(!this.requestStats)return;if(a)return null==i.rtt?void 0:{addition:{[jo.RTT]:i.rtt,[jo.CONN_TYPE]:void 0}};const d=CP(i);if(this.store.useP2P){if(r){const l=CP(r);d[jo.CONN_TYPE]+=l[jo.CONN_TYPE]<<3}d[jo.CONN_TYPE]+=110}else d[jo.CONN_TYPE]+=100;return{addition:d}}getOutboundStats(i,r,a){if(!this.requestUploadStats||!this.requestLocalMedia)return;const d=this.requestLocalMedia();if(!d||0===d.length)return;let l,h,f;return d.forEach(_=>{let[g,{track:v,ssrcs:b}]=_;switch(g){case re.LocalVideoLowTrack:case re.LocalVideoTrack:if(g===re.LocalVideoTrack){const y=function(O,D,x,F,j){const Y=D.videoSend.find(q=>q.ssrc===O);if(!Y)return;const te={},{sentFrame:K,inputFrame:Q}=Y;if(Q&&K&&(te[$n.FREEZE]=function(_e,Fe){let rt=!0;return rt=!(_e<=5)&&(_e<=10?Fe<3:_e<=20?Fe<4:Fe<5),rt}(Q.frameRate,K.frameRate)?1:0),Ge(te,$n.QP_SUM,Y.qpSumPerFrame),j)return te;switch(K&&(Ge(te,$n.HEIGHT,K.height),Ge(te,$n.WIDTH,K.width),Ge(te,$n.FRAME_RATE,K.frameRate)),te[$n.DISABLED]=F._originMediaStreamTrack&&!F._originMediaStreamTrack.enabled||F._mediaStreamTrack&&!F._mediaStreamTrack.enabled?1:0,Y.adaptionChangeReason){case"none":te[$n.ADAPTATION]=0;break;case"cpu":te[$n.ADAPTATION]=1;break;case"bandwidth":te[$n.ADAPTATION]=2;break;case"other":te[$n.ADAPTATION]=3}te[$n.PLAYER_STATUS]=Km[F._player?F._player.videoElementStatus:"uninit"],Ge(te,$n.NACKS,Y.nacksCount),Ge(te,$n.PLIS,Y.plisCount),Ge(te,$n.FIRS,Y.firsCount),Ge(te,$n.AVG_ENCODE,Y.avgEncodeMs);const $=x&&x.videoSend.find(q=>q.ssrc===O);if($){let q=j?el:3e3;$.timestamp&&Y.timestamp&&(q=Y.timestamp-$.timestamp),null!=$.packets&&null!=Y.packets&&Ge(te,$n.PACKAGE_RATE,1e3*(Y.packets-$.packets)/q),null!=Y.packetsLost&&null!=$.packetsLost&&Ge(te,$n.PACKAGE_LOST,Y.packetsLost-$.packetsLost),null!=$.bytes&&null!=Y.bytes&&Ge(te,$n.BITRATE,8*(Y.bytes-$.bytes)/q)}return te}(b[0].ssrcId,i,r,v,a),T=a?null:function(O,D,x){const F=D.videoSend.find($=>$.ssrc===O);if(!F)return null;const j={},Y=F.inputFrame,K=Y&&Y.width||x&&x._videoWidth||0,Q=Y&&Y.frameRate||0;return Ge(j,Zd.HEIGHT,Y&&Y.height||x&&x._videoHeight||0),Ge(j,Zd.WIDTH,K),Ge(j,Zd.FRAME_RATE,Q),j}(b[0].ssrcId,i,v),M=a?null:function(O){const D={};return Ge(D,$n.RETRANSMIT,O.bitrate.retransmit),Ge(D,$n.TARGET_ENCODED,O.bitrate.targetEncoded),Ge(D,$n.ACTUAL_ENCODED,O.bitrate.actualEncoded),Ge(D,$n.TRANSMIT,O.bitrate.transmit),Ge(D,$n.BANDWIDTH,O.sendBandwidth),D}(i);h=Object.assign({},y,T,M)}else f=a?void 0:function(y,T,M){const O=T.videoSend.find(F=>F.ssrc===y);if(!O)return;const D={},x=O.sentFrame;if(x&&(Ge(D,Nu.HEIGHT,x.height),Ge(D,Nu.WIDTH,x.width),Ge(D,Nu.FRAME_RATE,x.frameRate)),M){const F=M.videoSend.find(j=>j.ssrc===y);if(F){let j=3e3;F.timestamp&&O.timestamp&&(j=O.timestamp-F.timestamp),null!=F.packets&&null!=O.packets&&Ge(D,Nu.PACKAGE_RATE,1e3*(O.packets-F.packets)/j),null!=O.packetsLost&&null!=F.packetsLost&&Ge(D,Nu.PACKAGE_LOST,O.packetsLost-F.packetsLost),null!=F.bytes&&null!=O.bytes&&Ge(D,Nu.BITRATE,8*(O.bytes-F.bytes)/j)}}return D}(b[0].ssrcId,i,r);break;case re.LocalAudioTrack:l=a?void 0:function(y,T,M,O){const D=T.audioSend.find(te=>te.ssrc===y);if(!D)return;const x={};x[Jc.DISABLED]=O._originMediaStreamTrack&&!O._originMediaStreamTrack.enabled||O._mediaStreamTrack&&!O._mediaStreamTrack.enabled?1:0;const F=O._source.getAccurateVolumeLevel();Ge(x,Jc.LEVEL,100*(D.inputLevel??F)),Ge(x,H0.PCM_LEVEL,100*F),Ge(x,Jc.AEC_RETURN_LOSS,D.aecReturnLoss),Ge(x,Jc.AEC_RETURN_LOSS_ENH,D.aecReturnLossEnhancement),x[Jc.FREEZE]=0;const Y=M&&M.audioSend.find(te=>te.ssrc===y);if(Y){let te=3e3;Y.timestamp&&D.timestamp&&(te=D.timestamp-Y.timestamp),null!=Y.bytes&&null!=D.bytes&&Ge(x,Jc.BITRATE,8*(D.bytes-Y.bytes)/te),null!=Y.packets&&null!=D.packets&&Ge(x,Jc.PACKAGE_RATE,1e3*(D.packets-Y.packets)/te)}return x}(b[0].ssrcId,i,r,v)}}),{high:h,low:f,audio:l}}getInboundStats(i,r,a){if(!this.requestRemoteMedia)return;const d=this.requestRemoteMedia()||[],l=[];return d.forEach(h=>{let[f,_]=h;const g={peer:f.uid};if(_.has(Se.VIDEO)&&f.videoTrack){const v=f._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(f._videoSSRC)||!1,b=f.videoTrack?function(y,T,M,O,D,x,F){const j=T.videoRecv.find(q=>q.ssrc===y);if(!j)return;const Y={},{receivedFrame:te,outputFrame:K,decodeFrameRate:Q}=j,$=M&&M.videoRecv.find(q=>q.ssrc===y);if(Y[Zi.FREEZE]=D&&ys.isRemoteVideoFreeze(O,j,$)?1:0,Ge(Y,__.FRAME_RATE_DECODE,Q),Ge(Y,Zi.QP_SUM,j.qpSumPerFrame),j.framesRateFirefox&&Ge(Y,Zi.FRAME_RATE,j.framesRateFirefox),te&&Ge(Y,Zi.FRAME_RATE,te.frameRate),$){const q=T.timestamp-M.timestamp||(F?el:3e3);null!=j.packetsLost&&null!=$.packetsLost&&Ge(Y,Zi.PACKAGE_LOST,j.packetsLost-$.packetsLost),null!=$.bytes&&null!=j.bytes&&Ge(Y,Zi.BITRATE,8*(j.bytes-$.bytes)/q),null!=$.packets&&null!=j.packets&&Ge(Y,Zi.PACKAGE_RATE,1e3*(j.packets-$.packets)/q)}if(F)return Y;if(te?(Ge(Y,Zi.HEIGHT,te.height),Ge(Y,Zi.WIDTH,te.width)):O&&(Ge(Y,Zi.HEIGHT,O._videoHeight||0),Ge(Y,Zi.WIDTH,O._videoWidth||0)),K&&Ge(Y,__.FRAME_RATE_RENDER,K.frameRate),Ge(Y,Zi.JITTER_BUFFER,j.jitterBufferMs),Ge(Y,Zi.CURRENT_DELAY,j.currentDelayMs),Ge(Y,Zi.FIRS,j.firsCount),Ge(Y,Zi.NACKS,j.nacksCount),Ge(Y,Zi.PLIS,j.plisCount),O){Y[Zi.DISABLED]=O._originMediaStreamTrack.enabled&&O._mediaStreamTrack.enabled?0:1;const q=O._player;if(q){const{freezeTimeCounterList:ge,renderFreezeAccTime:_e}=q;if(ge&&ge.length>0&&Ge(Y,__.FREEZE_TIME,ge.splice(0,1)[0]),x&&"visible"===Wc.visibility){const Fe=Math.min(6e3,_e);q.renderFreezeAccTime=Math.max(0,_e-Fe),Ge(Y,__.FREEZE_TIME_RENDER,Fe)}}}if(Y[Zi.PLAYER_STATUS]=Km[O._player?O._player.videoElementStatus:"uninit"],$&&void 0!==j.totalInterFrameDelay&&void 0!==j.totalSquaredInterFrameDelay&&void 0!==$.totalInterFrameDelay&&void 0!==$.totalSquaredInterFrameDelay){const q=j.totalInterFrameDelay-$.totalInterFrameDelay,_e=j.framesDecodeCount-$.framesDecodeCount,Fe=q/_e*1e3,rt=Math.round(1e3*Math.sqrt((j.totalSquaredInterFrameDelay-$.totalSquaredInterFrameDelay-Math.pow(q,2)/_e)/_e));!isNaN(rt)&&Fe+rt>Math.max(3*Fe,Fe+150)&&(Y[Zi.I_FRAME_DELAY]=rt)}return Y}(f._videoSSRC,i,r,f.videoTrack,!0===v,this.needUploadRenderFreezeTime,a):void 0;b&&(g.video=b)}if(_.has(Se.AUDIO)&&f.audioTrack){const v=f.audioTrack?function(b,y,T,M,O){const D=y.audioRecv.find(q=>q.ssrc===b);if(!D)return;const x={},F=T&&T.audioRecv.find(q=>q.ssrc===b),{receivedFrames:j,droppedFrames:Y}=D;var te;if(Ge(x,Bo.JITTER,D.jitterMs),null!=j&&null!=Y&&(x[Bo.FREEZE]=0===(te=j)||100*Y/te>20?1:0),F){const q=y.timestamp-T.timestamp||(O?el:3e3);null!=D.packets&&null!=F.packets&&Ge(x,Bo.PACKAGE_RATE,1e3*(D.packets-F.packets)/q),null!=F.bytes&&null!=D.bytes&&Ge(x,Bo.BITRATE,8*(D.bytes-F.bytes)/q),null!=D.packetsLost&&null!=F.packetsLost&&Ge(x,Bo.PACKAGE_LOST,D.packetsLost-F.packetsLost)}if(O)return x;const Q=M._source.getAccurateVolumeLevel();if(Ge(x,G0.LEVEL,100*(D.outputLevel??Q)),Ge(x,Bo.PCM_LEVEL,100*Q),M&&(x[Bo.DISABLED]=M._originMediaStreamTrack.enabled&&M._mediaStreamTrack.enabled?0:1),Ge(x,Bo.JITTER_BUFFER,D.jitterBufferMs),Ge(x,Bo.CURRENT_DELAY,D.jitterBufferMs),x[Bo.PLAYER_STATUS]=Km[xr.getPlayerState(M.getTrackId())],F){const q=D.concealedSamples-F.concealedSamples;q>0&&Ge(x,Bo.CONCEALED_SAMPLES,q)}return x}(f._audioSSRC,i,r,f.audioTrack,a):void 0;v&&(g.audio=v)}(g.video||g.audio)&&l.push(g)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,l}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const i=(this.requestAllTracks()||[]).find(r=>r instanceof ji);if(i&&i._external.getDenoiserStats){const r=i._external.getDenoiserStats();r&&this.requestUpload(kc.DENOISER_STATS,r)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(i=>{i.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(i=>{let[r,a]=i;a.has(Se.VIDEO)&&r.videoTrack&&r.videoTrack.getProcessorStats().forEach(d=>{this.requestUpload&&this.requestUpload(d.type,d.stats)}),a.has(Se.AUDIO)&&r.audioTrack&&r.audioTrack.getProcessorStats().forEach(d=>{this.requestUpload&&this.requestUpload(d.type,d.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){var i=this;if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(L(function*(){const a=Date.now(),d={connectionInterval:B("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:a};let l=[];const h=i.requestAllTracks&&i.requestAllTracks()||[];for(const v of h)!v.muted&&v.enabled&&(l=l.concat(yield v.getProcessorUsage()));const f=i.requestRemoteMedia&&i.requestRemoteMedia()||[];for(const[v,b]of f)b.has(Se.VIDEO)&&v.videoTrack&&(l=l.concat(yield v.videoTrack.getProcessorUsage())),b.has(Se.AUDIO)&&v.audioTrack&&(l=l.concat(yield v.audioTrack.getProcessorUsage()));if(0===l.length)return;d.details=function(v,b){const y={};for(const{id:D,value:x,level:F,direction:j}of v){var T;const Y=null!==(T=b.get(D))&&void 0!==T?T:0,te=2===x?Y+B("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:Y;var M,O;b.set(D,te),y[D]?(2===x&&(y[D].value=x),F>y[D].level&&(y[D].level=F),"remote"===j&&(y[D].remoteUidCount+=1),y[D].totalTs=null!==(M=b.get(D))&&void 0!==M?M:0):y[D]={value:x,level:F,remoteUidCount:"local"===j?0:1,totalTs:null!==(O=b.get(D))&&void 0!==O?O:0}}return Object.keys(y).map(D=>{const{level:x,value:F,totalTs:j}=y[D];return{id:D,level:x,value:F,totalTs:j}})}(l,r);const _=Date.now();i.requestUpload&&i.requestUpload(kc.EXTENSION_USAGE_STATS,{usageStats:d,sendTs:_>a?_:a+1})}),B("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}}class Ii{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(i,r){C(this,"uid",void 0),C(this,"_uintid",void 0),C(this,"_trust_in_room_",!0),C(this,"_trust_audio_enabled_state_",!0),C(this,"_trust_video_enabled_state_",!0),C(this,"_trust_audio_mute_state_",!0),C(this,"_trust_video_mute_state_",!0),C(this,"_audio_muted_",!1),C(this,"_video_muted_",!1),C(this,"_audio_enabled_",!0),C(this,"_video_enabled_",!0),C(this,"_audio_added_",!1),C(this,"_video_added_",!1),C(this,"_is_pre_created",!1),C(this,"_video_pre_subscribed",!1),C(this,"_audio_pre_subscribed",!1),C(this,"_trust_video_stream_added_state_",!0),C(this,"_trust_audio_stream_added_state_",!0),C(this,"_audioTrack",void 0),C(this,"_videoTrack",void 0),C(this,"_dataChannels",[]),C(this,"_audioSSRC",void 0),C(this,"_videoSSRC",void 0),C(this,"_audioOrtc",void 0),C(this,"_videoOrtc",void 0),C(this,"_cname",void 0),C(this,"_rtxSsrcId",void 0),C(this,"_videoMid",void 0),C(this,"_audioMid",void 0),this.uid=i,this._uintid=r}}var bs;function hb(s,i){var r;let a;switch(i){case re.LocalAudioTrack:a=ut.Audio;break;case re.LocalVideoTrack:a=ye(r=s._hints).call(r,kt.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalVideoLowTrack:a=ut.Low}return a}function IP(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Ks(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?IP(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):IP(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}!function(s){s.SEND_ONLY="SEND_ONLY",s.RECEIVE_ONLY="RECEIVE_ONLY"}(bs||(bs={}));class Je extends jt{get state(){return this._state}set state(i){const r=this._state;this._state=i,this.emit(Oe.StateChange,r,this._state)}constructor(i,r){var a;super(),a=this,C(this,"store",void 0),C(this,"statsUploader",void 0),C(this,"sendConnection",void 0),C(this,"recvConnection",void 0),C(this,"localTrackMap",new Map),C(this,"remoteUserMap",new Map),C(this,"localDataChannels",[]),C(this,"pendingLocalTracks",[]),C(this,"pendingRemoteTracks",[]),C(this,"statsCollector",void 0),C(this,"dtlsFailedCount",0),C(this,"sendMutex",new gi("P2PChannel2-send-mutex")),C(this,"recvMutex",new gi("P2PChannel2-recv-mutex")),C(this,"_state",Dt.Disconnected),C(this,"_restartStates",["disconnected","failed"]),C(this,"reconnectInterval",void 0),C(this,"uploadUnplinkStarted",!1),C(this,"uploadDownlinkStarted",!1),C(this,"uplinkStateUploadInterval",void 0),C(this,"downlinkStatsUploadInterval",void 0),C(this,"handleMuteLocalTrack",function(){var d=L(function*(l,h,f){const _=yield a.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!a.sendConnection||a.state!==Dt.Connected)return void f(new ee(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const b=a.filterTobeMutedTracks(l);if(0===b.length)return void h();const y=b.find(D=>"videoLowTrack"===D[0]);y&&y[1].track._originMediaStreamTrack.stop(),yield a.sendConnection.muteLocal(b.map(D=>{let[,{id:x}]=D;return x}));let T=!1;var g,v;T="video"===l.trackMediaType?!(null===(g=a.localTrackMap.get(re.LocalAudioTrack))||void 0===g||!g.track._muted):void 0===(null===(v=a.localTrackMap.get(re.LocalVideoTrack))||void 0===v?void 0:v.id);const M=a.createMuteMessage(b);yield Tt(a,Oe.RequestMuteLocal,M);const O="video"===l.trackMediaType?Vc.MUTE_LOCAL_VIDEO:Vc.MUTE_LOCAL_AUDIO;yield Tt(a,Oe.RequestP2PMuteLocal,{action:O,message:M,isMuteAll:T}),h()}catch(b){f(b)}finally{_()}});return function(l,h,f){return d.apply(this,arguments)}}()),C(this,"handleUnmuteLocalTrack",function(){var d=L(function*(l,h,f){const _=yield a.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!a.sendConnection||a.state!==Dt.Connected)return void f(new ee(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const g=a.filterTobeUnmutedTracks(l);if(0===g.length)return void h();yield a.sendConnection.unmuteLocal(g.map(y=>{let[,{id:T}]=y;return T}));const v=a.createUnmuteMessage(g),b="video"===l.trackMediaType?Vc.UNMUTE_LOCAL_VIDEO:Vc.UNMUTE_LOCAL_AUDIO;yield Tt(a,Oe.RequestP2PMuteLocal,{action:b,message:v}),h()}catch(g){f(g)}finally{_()}});return function(l,h,f){return d.apply(this,arguments)}}()),C(this,"handleUpdateVideoEncoder",function(){var d=L(function*(l,h,f){const _=yield a.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const g=a.localTrackMap.get(re.LocalVideoTrack);if(!a.sendConnection||!g||g.track!==l||a.state!==Dt.Connected)return void h();const{id:v,track:b}=g;v&&(yield a.sendConnection.updateSendParameters(v,b),yield a.sendConnection.updateEncoderConfig(v,b),a.emit(Oe.UpdateVideoEncoder,b)),h()}catch(g){f(g)}finally{_()}});return function(l,h,f){return d.apply(this,arguments)}}()),C(this,"handleSetOptimizationMode",function(){var d=L(function*(l,h,f){const _=yield a.sendMutex.lock("Locking from P2PChannel2.handleSetOptimizationMode");try{const g=a.localTrackMap.get(re.LocalVideoTrack);if(!a.sendConnection||!g||g.track!==l||a.state!==Dt.Connected)return;const{id:v,track:b}=g;v&&(yield a.sendConnection.updateSendParameters(v,b)),h()}catch(g){f(g)}finally{_()}});return function(l,h,f){return d.apply(this,arguments)}}()),C(this,"handleReplaceTrack",function(){var d=L(function*(l,h,f,_){let g;I.debug("[".concat(a.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(l.getTrackId(),"]")),"boolean"==typeof _&&_||(g=yield a.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var v;const y=Array.from(a.localTrackMap.entries()).find(T=>{let[,{track:M}]=T;return l===M});if(!a.sendConnection||!y||void 0===y[1].id||a.state!==Dt.Connected)return void h();if(yield null===(v=a.sendConnection)||void 0===v?void 0:v.replaceTrack(l,y[1].id),y[0]===re.LocalVideoTrack&&Ot().supportDualStreamEncoding){const T=a.localTrackMap.get(re.LocalVideoLowTrack);if(T){const M=l._mediaStreamTrack.clone();T.track._originMediaStreamTrack.stop(),T.track._mediaStreamTrack=M,T.track._originMediaStreamTrack=M,yield new X((O,D)=>{a.handleReplaceTrack(T.track,O,D,!0)})}}h()}catch(y){f(y)}finally{var b;null===(b=g)||void 0===b||b()}});return function(l,h,f,_){return d.apply(this,arguments)}}()),C(this,"handleGetLocalVideoStats",d=>{d(this.statsCollector.getLocalVideoTrackStats())}),C(this,"handleGetLocalAudioStats",d=>{d(this.statsCollector.getLocalAudioTrackStats())}),C(this,"handleGetRemoteVideoStats",d=>this.statsCollector.getRemoteVideoTrackStats(d.uid)[d.uid]),C(this,"handleGetRemoteAudioStats",d=>this.statsCollector.getRemoteAudioTrackStats(d.uid)[d.uid]),this.store=i,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new TP(i),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(d=>{d&&("disconnected"!==d.iceConnectionState&&"failed"!==d.iceConnectionState||this.handleDisconnect(d.direction))})},B("ICE_RESTART_INTERVAL"))}startP2PConnection(i,r){return L(function*(){throw new ee(k.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")})()}connect(i,r,a,d,l,h){return L(function*(){throw new ee(k.NOT_SUPPORTED,"p2p mode does not support connect.")})()}startP2P(i,r){var a=this;return L(function*(){let d;try{if(r){a.recvConnection&&(I.warning("[".concat(a.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),a.recvConnection.close(),a.unbindConnectionEvents(a.recvConnection)),d=yield a.recvMutex.lock("From P2PChannel.startP2P"),a.recvConnection=new Es(i,a.store,Ei.RECEIVE_ONLY),a.bindConnectionEvents(a.recvConnection);const l=yield a.recvConnection.establish(r);return{iceParameters:l.iceParameters,dtlsParameters:l.dtlsParameters,sdp:l.sdp}}{a.state=Dt.New,a.sendConnection&&(I.warning("[".concat(a.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),a.sendConnection.close(),a.unbindConnectionEvents(a.sendConnection)),d=yield a.sendMutex.lock("From P2PChannel.startP2P"),a.sendConnection=new Es(i,a.store),a.store.peerConnectionStart(),a.bindConnectionEvents(a.sendConnection);const l=yield a.sendConnection.establish();return{iceParameters:l.iceParameters,dtlsParameters:l.dtlsParameters,sdp:l.sdp}}}finally{d&&d()}})()}p2pConnect(i){var r=this;return L(function*(){if(!r.sendConnection)throw new ee(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");r.store.peerConnectionStart(),yield r.sendConnection.connect(i),r.statsUploader.startUploadTransportStats(),r.statsUploader.startUploadExtensionUsageStats(),r.state=Dt.Connected})()}addRemoteCandidate(i,r){var a=this;return L(function*(){if(r===Ei.RECEIVE_ONLY){if(!a.sendConnection)throw new ee(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");yield a.sendConnection.addRemoteCandidate(i)}else{if(!a.recvConnection)throw new ee(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");yield a.recvConnection.addRemoteCandidate(i)}})()}publish(i,r,a){var d=this;return Xr(function*(){const l=yield Be(d.sendMutex.lock("From P2PChannel.publish"));try{if(!d.sendConnection||d.state!==Dt.Connected){d.throwIfTrackTypeNotMatch(i);const v=i.filter(b=>-1===d.pendingLocalTracks.indexOf(b));return void(d.pendingLocalTracks=d.pendingLocalTracks.concat(v))}d.store.pubId=d.store.pubId+1,Li.markPublishStart(d.store.clientId,d.store.pubId);const h=d.filterTobePublishedTracks(i,r,a);if(0===h.length)return void(yield Be(d.tryToUnmuteAudio(i)));h.forEach(v=>{let{track:b,type:y}=v;const T=Date.now();d.store.publish(b.getTrackId(),y===re.LocalAudioTrack?"audio":"video",T)}),d.bindLocalTrackEvents(h);const f=yield Be(d.sendConnection.send(h.map(v=>{let{track:b}=v;return b}),d.store.codec,d.store.audioCodec)),_=(yield Be(f.next())).value,g=d.createGatewayPublishMessage(h,_);try{yield g}catch(v){throw f.throw(v),v?.code===k.WS_ABORT&&h.forEach(b=>{let{track:y}=b;-1===d.pendingLocalTracks.indexOf(y)&&d.pendingLocalTracks.push(y)}),d.unbindLocalTrackEvents(h),v}yield Be(f.next()),h.forEach(v=>{let{type:b}=v;d.statsCollector.addLocalStats(b)}),d.statsUploader.startUploadOutboundStats(),d.assignLocalTracks(h,_),h.forEach(v=>{let{track:b,type:y}=v;const T=Date.now();d.store.publish(b.getTrackId(),y===re.LocalAudioTrack?"audio":"video",void 0,T)}),d.startUploadUplinkState()}finally{l()}})()}unpublish(i){var r=this;return L(function*(){if(!r.sendConnection||r.state!==Dt.Connected)return void(0===i.length?r.pendingLocalTracks.length=0:r.pendingLocalTracks=r.pendingLocalTracks.filter(h=>!ye(i).call(i,h)));const a=r.filterTobeUnpublishedTracks(i);if(0===a.length)return;const d=a.find(h=>"videoLowTrack"===h[0]);d&&d[1].track.close();const l=r.createGatewayUnpublishMessage(a);if(yield r.sendConnection.stopSending(a.map(h=>{let[,{id:f}]=h;return f})),r.withdrawLocalTracks(a),r.unbindLocalTrackEvents(a.map(h=>{let[f,{track:_}]=h;return{type:f,track:_}})),a.forEach(h=>{let[f]=h;r.statsCollector.removeLocalStats(f)}),0===r.localTrackMap.size&&(r.statsUploader.stopUploadOutboundStats(),r.stopUploadUplinkState()),r.sendConnection&&r.state===Dt.Connected)return d&&d[1].track.close(),l;i.forEach(h=>{const f=r.pendingLocalTracks.indexOf(h);-1!==f&&r.pendingLocalTracks.splice(f,1)})})()}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const i=()=>{const r=[],a=[];Array.from(this.localTrackMap.entries()).forEach(d=>{let[l,{track:h,ssrcs:f}]=d;const _={stream_type:hb(h,l),ssrcs:f};h._muted||!h._enabled?r.push(_):a.push(_)}),r.length>0&&r.forEach(d=>{Tt(this,Oe.RequestMuteLocal,[d])}),a.length>0&&a.forEach(d=>{Tt(this,Oe.RequestUnmuteLocal,[d])})};i(),this.uplinkStateUploadInterval=window.setInterval(()=>{i()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(i){return Xr(function*(){throw new ee(k.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}republish(){var i=this;return L(function*(){i.pendingLocalTracks.length>0&&(I.debug("[".concat(i.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield nn(i,Oe.RequestRePublish,i.pendingLocalTracks),i.emit(Oe.MediaReconnectEnd,i.store.uid),i.pendingLocalTracks=[])})()}unpublishLowStream(){return L(function*(){throw new ee(k.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")})()}subscribe(i,r,a,d){var l=this;return L(function*(){var h;if(!l.recvConnection)throw new ee(k.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(h=l.remoteUserMap.get(i))&&void 0!==h&&h.has(r))return;const{track:f,mid:_,transceiver:g}=yield l.recvConnection.receive(r,[{ssrcId:a}],String(i.uid),d);r===Se.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(f):(i._audioTrack=new _s(f,i.uid,i._uintid,l.store),I.info("[".concat(l.store.clientId,"] [").concat(l.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),g&&i._audioTrack._updateRtpTransceiver(g),l.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoSSRC=a,i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(f):(i._videoTrack=new za(f,i.uid,i._uintid,l.store),I.info("[".concat(l.store.clientId,"] [").concat(l.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),g&&i._videoTrack._updateRtpTransceiver(g),l.bindRemoteTrackEvents(i,i._videoTrack));const v=l.remoteUserMap.get(i);v?v.set(r,_):l.remoteUserMap.set(i,new Map([[r,_]])),l.statsCollector.addRemoteStats(i.uid),l.statsUploader.startUploadInboundStats(),l.startUploadDownlinkState();const b=l.pendingRemoteTracks.findIndex(y=>{let{user:T,kind:M}=y;return T.uid===i.uid&&r===M});-1!==b&&(l.pendingRemoteTracks.splice(b,1),l.emit(Oe.MediaReconnectEnd,i.uid))})()}mockSubscribe(i,r,a,d){var l=this;return L(function*(){if(!l.recvConnection)throw new ee(k.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");yield l.recvConnection.mockReceive(r,[{ssrcId:a}],String(i.uid),d)})()}unsubscribe(i,r,a){var d=this;return L(function*(){const l=d.pendingRemoteTracks.filter(f=>{let{user:_,kind:g}=f;return void 0!==r?_.uid===i.uid&&r===g:_.uid===i.uid});if(l.forEach(f=>{const _=d.pendingRemoteTracks.indexOf(f);d.pendingRemoteTracks.splice(_,1)}),d.recvConnection||a||l.forEach(f=>{let{kind:_}=f;var g;if(_===Se.AUDIO)null===(g=i._audioTrack)||void 0===g||g._destroy(),i._audioTrack=void 0;else if(_===Se.VIDEO){var v;null===(v=i._videoTrack)||void 0===v||v._destroy(),i._videoTrack=void 0}}),!d.recvConnection)return;const h=d.filterTobeUnSubscribedTracks(i,r);0!==h.length&&(yield d.recvConnection.stopReceiving(h.map(f=>{let[,{id:_}]=f;return _})),d.withdrawRemoteTracks(h),0===d.remoteUserMap.size&&(d.statsUploader.stopUploadInboundStats(),d.stopUploadDownlinkState()),h.forEach(f=>{let[_,{kind:g}]=f;var v,b;if(g===Se.VIDEO&&_._videoSSRC&&(null===(v=d.recvConnection)||void 0===v||v.setStatsRemoteVideoIsReady(_._videoSSRC,!1)),g===Se.VIDEO)d.unbindRemoteTrackEvents(_._videoTrack),a||(null===(b=_._videoTrack)||void 0===b||b._destroy(),_._videoTrack=void 0);else if(g===Se.AUDIO){var y;d.unbindRemoteTrackEvents(_._audioTrack),!a&&(null===(y=_._audioTrack)||void 0===y||y._destroy(),_._audioTrack=void 0)}}),h.forEach(f=>{let[,{kind:_}]=f;Tt(d,Oe.RequestP2PMuteRemote,_)}))})()}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const i=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,a]=r;[Se.VIDEO,Se.AUDIO].forEach(d=>{a.has(d)?Tt(this,Oe.RequestP2PUnmuteRemote,d):Tt(this,Oe.RequestP2PMuteRemote,d)})});i(),this.downlinkStatsUploadInterval=window.setInterval(()=>{i()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}massSubscribe(i){return L(function*(){throw new ee(k.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")})()}massSubscribeNoLock(i){return L(function*(){throw new ee(k.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")})()}massUnsubscribe(i){return L(function*(){throw new ee(k.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")})()}massUnsubscribeNoLock(i){return L(function*(){throw new ee(k.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")})()}muteRemote(i,r){var a=this;return L(function*(){if(!a.recvConnection)return;const d=a.remoteUserMap.get(i);if(!d)return void I.warning("[".concat(a.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(i.uid,"."));if(!d.get(r))return void I.warning("[".concat(a.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(i.uid," media type ").concat(r,"."));const l=r===Se.VIDEO?i._videoSSRC:i._audioSSRC;void 0!==l&&a.recvConnection.setStatsRemoteVideoIsReady(l,!1)})()}unmuteRemote(i,r){var a=this;return L(function*(){return a.unmuteRemoteNoLock(i,r)})()}unmuteRemoteNoLock(i,r){var a=this;return L(function*(){if(!a.recvConnection)return;const d=a.remoteUserMap.get(i);d?d.get(r)||I.warning("[".concat(a.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(i.uid," media type ").concat(r,".")):I.warning("[".concat(a.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(i.uid,"."))})()}getAllTracks(i){const r=this.localTrackMap.get(re.LocalAudioTrack);if(r?.track instanceof jn){const a=r.track;return Array.from(this.localTrackMap.entries()).filter(d=>{let[l]=d;return l!==re.LocalAudioTrack}).filter(d=>{let[l]=d;return!(i&&l===re.LocalVideoLowTrack)}).map(d=>{let[,{track:l}]=d;return l}).concat(a.trackList)}return Array.from(this.localTrackMap.entries()).filter(a=>{let[d]=a;return!(i&&d===re.LocalVideoLowTrack)}).map(a=>{let[,{track:d}]=a;return d})}reportPublishEvent(i,r,a,d,l){if(i){const f=this.localTrackMap.get(re.LocalAudioTrack),_=this.localTrackMap.get(d?re.LocalVideoLowTrack:re.LocalVideoTrack);Ie.publish(this.store.sessionId,{eventElapse:Li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:i,ec:r,audioName:f?.track.getTrackLabel(),videoName:_?.track.getTrackLabel(),screenshare:-1!==_?.track._hints.indexOf(kt.SCREEN_TRACK),audio:!!f,video:!!_,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:l})}else{var h;a||(a=[]);const f=a.find(g=>g instanceof Et),_=d?null===(h=this.localTrackMap.get(re.LocalVideoTrack))||void 0===h?void 0:h.track:a.find(g=>g instanceof je);Ie.publish(this.store.sessionId,{eventElapse:Li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:i,ec:r,audioName:f?.getTrackLabel(),videoName:_?.getTrackLabel(),screenshare:-1!==_?._hints.indexOf(kt.SCREEN_TRACK),audio:!!f,video:!!_,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:l})}}reportSubscribeEvent(i,r,a,d){const l=d===Se.VIDEO?a._videoSSRC:a._audioSSRC;l&&Ie.subscribe(this.store.sessionId,{succ:i,ec:r,video:d===Se.VIDEO,audio:d===Se.AUDIO,peerid:a.uid,subscribeRequestid:d===Se.VIDEO?a._videoSSRC:a._audioSSRC,p2pid:this.store.p2pId,eventElapse:Li.measureFromSubscribeStart(this.store.clientId,l)})}reset(){I.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new gi("P2PChannel2-send-mutex"),this.sendMutex=new gi("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const i=this.localTrackMap.get(re.LocalAudioTrack);if(i?.track instanceof jn){if(i.track.trackList.length>0){const r=i.track;i.track.trackList.forEach(a=>{r.removeAudioTrack(a)})}i.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Dt.Disconnected}getStats(i){var r,a;return i?null===(a=this.recvConnection)||void 0===a?void 0:a.getStats():null===(r=this.sendConnection)||void 0===r?void 0:r.getStats()}getRemoteVideoIsReady(i){var r;return(null===(r=this.recvConnection)||void 0===r?void 0:r.getRemoteVideoIsReady(i))||!1}getLocalAudioVolume(){const i=this.localTrackMap.get(re.LocalAudioTrack);if(i)return i.track.getVolumeLevel()}getLocalVideoSize(){const i=this.localTrackMap.get(re.LocalVideoTrack);if(i)return{width:i.track._videoWidth||0,height:i.track._videoHeight||0}}getEncoderConfig(i){const r=this.localTrackMap.get(i);return r&&r.track instanceof je||r&&r.track instanceof Et?r.track._encoderConfig:void 0}getLocalMedia(i){return this.localTrackMap.get(i)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(i,r){if(!i)return this.remoteUserMap.size>0;const a=this.remoteUserMap.get(i);return!!a&&(!r||a.has(r))}hasRemoteMediaWithLock(i,r){var a=this;return L(function*(){if(!i)return a.remoteUserMap.size>0;const d=a.remoteUserMap.get(i);return!!d&&(!r||d.has(r))})()}getRemoteMedia(i){var r;const a=Array.from(ir(r=this.remoteUserMap).call(r)).find(d=>d.uid===i);return a?{audioTrack:a.audioTrack,audioSSRC:a._audioSSRC,videoTrack:a.videoTrack,videoSSRC:a._videoSSRC}:{}}getAudioLevels(){let i=Array.from(this.remoteUserMap.entries()).map(a=>{let[d]=a;return{uid:d.uid,level:d.audioTrack?100*d.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(re.LocalAudioTrack);return r&&i.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),i=bE(i).call(i,(a,d)=>a.level-d.level),i}disconnectForReconnect(){var i=this;return L(function*(){i.sendConnection&&i.recvConnection&&(I.debug("[".concat(i.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),i.state=Dt.Reconnecting,B("KEEP_LAST_FRAME")&&0!==i.remoteUserMap.size&&Array.from(i.remoteUserMap.entries()).forEach(r=>{let[a]=r;var d;a._videoTrack&&a._videoTrack._player&&(null===(d=a._videoTrack._player.getVideoElement())||void 0===d||d.pause(),a._videoTrack._player.isKeepLastFrame=!0,a._videoTrack._originMediaStreamTrack.stop())}),i.sendConnection.close(),i.unbindConnectionEvents(i.sendConnection),i.sendConnection=void 0,i.recvConnection.close(),i.unbindConnectionEvents(i.recvConnection),i.recvConnection=void 0,0!==i.localTrackMap.size&&(Array.from(i.localTrackMap.entries()).forEach(r=>{var a;let[d,{track:l}]=r;switch(d){case re.LocalVideoTrack:ye(a=l._hints).call(a,kt.LOW_STREAM)?l.close():i.pendingLocalTracks.push(l);break;case re.LocalAudioTrack:l instanceof jn?i.pendingLocalTracks=i.pendingLocalTracks.concat(l.trackList):i.pendingLocalTracks.push(l)}}),i.emit(Oe.MediaReconnectStart,i.store.uid)),i.unbindLocalTrackEvents(),i.localTrackMap.clear(),0!==i.remoteUserMap.size&&Array.from(i.remoteUserMap.entries()).forEach(r=>{let[a,d]=r;Array.from(ir(d).call(d)).forEach(l=>{i.setPendingRemoteMedia(a,l)}),i.emit(Oe.MediaReconnectStart,a.uid)}),i.unbindAllRemoteTrackEvents(),i.remoteUserMap.clear(),i.stopUploadUplinkState(),i.stopUploadDownlinkState(),i.statsUploader.stopUploadOutboundStats(),i.statsUploader.stopUploadInboundStats(),i.statsUploader.stopUploadTransportStats(),I.debug("[".concat(i.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))})()}hasPendingRemoteMedia(i,r){for(const a of this.pendingRemoteTracks){const{user:d,kind:l}=a;if((i instanceof Ii?i.uid:i)===d.uid&&r===l)return!0}return!1}setPendingRemoteMedia(i,r){this.hasPendingRemoteMedia(i,r)||this.pendingRemoteTracks.push({user:i,kind:r})}restartICE(i,r){var a=this;return L(function*(){let d,l;if(i===Ei.SEND_ONLY){if(!a.sendConnection)throw new ee(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");d=yield a.sendMutex.lock("From P2PChannel.restartICE"),l=a.sendConnection}else{if(!a.recvConnection)throw new ee(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");d=yield a.recvMutex.lock("From P2PChannel.restartICE"),l=a.recvConnection}try{if(r){const h=yield l.restartICE(r);return l.isInRestartIce=!1,h}{const h=yield l.restartICE();if(h){const f=yield nn(a,Oe.RequestP2PRestartICE,{direction:Ei.RECEIVE_ONLY,iceParameter:h});yield l.restartICE(f),l.isInRestartIce=!1}}}finally{d()}})()}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const i=this.sendConnection.getStats(),r=this.localTrackMap.get(re.LocalVideoTrack),a=this.localTrackMap.get(re.LocalAudioTrack),d=i.videoSend.find(M=>{var O;return M.ssrc===(null==r||null===(O=r.ssrcs)||void 0===O?void 0:O[0].ssrcId)}),l=i.audioSend.find(M=>{var O;return M.ssrc===(null==a||null===(O=a.ssrcs)||void 0===O?void 0:O[0].ssrcId)});if(!d||!l)return 1;const h=Mr(this,Oe.NeedSignalRTT),f=d?d.rttMs:void 0,_=l?l.rttMs:void 0,g=f&&_?(f+_)/2:f||_,b=100*i.sendPacketLossRate*.7/50+.3*((g&&h?(g+h)/2:g||h)||0)/1500,y=b<.17?1:b<.36?2:b<.59?3:b<.1?4:5,T=r?.track;if(T&&T._encoderConfig&&-1===T._hints.indexOf(kt.SCREEN_TRACK)){const M=T._encoderConfig.bitrateMax,O=i.bitrate.actualEncoded;if(M&&O){const D=(1e3*M-O)/(1e3*M);return UO[D<.15?0:D<.3?1:D<.45?2:D<.6?3:4][y]}}return y}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const i=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(a=>{let[d]=a;const l=d._audioSSRC,h=d._videoSSRC,f=i.audioRecv.find(O=>O.ssrc===l),_=i.videoRecv.find(O=>O.ssrc===h);if(!f&&!_)return void(r+=1);const g=Mr(this,Oe.NeedSignalRTT),v=i.rtt,b=(v&&g?(v+g)/2:v||g)||0,y=f?f.jitterMs:void 0,T=i.recvPacketLossRate;let M=.7*T*100/50+.3*b/1500;y&&(M=.6*T*100/50+.2*b/1500+.2*y/400),r+=M<.1?1:M<.17?2:M<.36?3:M<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}muteLocalTrack(i){var r=this;return L(function*(){return new X((a,d)=>{r.handleMuteLocalTrack(i,a,d)})})()}filterTobePublishedTracks(i,r,a){const d=[],l=Ot(),h=this.getAllTracks();i=Dd(i=i.filter(g=>-1===h.indexOf(g)));let f=!1,_=!1;for(const g of i){if(g instanceof je&&(this.localTrackMap.has(re.LocalVideoTrack)||f?new ee(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(d.push({track:g,type:re.LocalVideoTrack}),f=!0),r)){const v=this.getLowVideoTrack(g,a);d.push({track:v,type:re.LocalVideoLowTrack})}if(g instanceof Et){const v=this.localTrackMap.get(re.LocalAudioTrack);if(v){if(!(v.track instanceof jn))throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0)}else if(_){const b=d.find(y=>{let{type:T}=y;return T===re.LocalAudioTrack});if(!(b.track instanceof jn))throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");b.track.addAudioTrack(g)}else{if(!l.webAudioMediaStreamDest||g instanceof jn||g._bypassWebAudio)d.push({track:g,type:re.LocalAudioTrack});else{const b=new jn;b.addAudioTrack(g),d.push({track:b,type:re.LocalAudioTrack})}_=!0}}}return d}filterTobeUnpublishedTracks(i){const r=[],a=this.getAllTracks();i=Dd(i=i.filter(d=>-1!==a.indexOf(d)));for(const d of i){if(d instanceof Et){const l=this.localTrackMap.get(re.LocalAudioTrack);if(!l)continue;l.track instanceof jn?(l.track.removeAudioTrack(d),this.unbindLocalAudioTrackEvents(d),0===l.track.trackList.length&&(r.push([re.LocalAudioTrack,l]),l.track.close())):r.push([re.LocalAudioTrack,l])}if(d instanceof je){const l=this.localTrackMap.get(re.LocalVideoTrack);if(!l)continue;r.push([re.LocalVideoTrack,l]);const h=this.localTrackMap.get(re.LocalVideoLowTrack);h&&r.push([re.LocalVideoLowTrack,h])}}return r}bindLocalTrackEvents(i){i.forEach(r=>{let{track:a,type:d}=r;switch(d){case re.LocalVideoTrack:a.addListener(ve.GET_STATS,this.handleGetLocalVideoStats),a.addListener(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.addListener(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.addListener(ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),a.addListener(ve.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),a.addListener(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),a.addListener(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.addListener(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case re.LocalAudioTrack:this.bindLocalAudioTrackEvents(a)}})}bindLocalAudioTrackEvents(i,r){i instanceof jn?i.trackList.forEach(a=>{a.addListener(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.addListener(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.addListener(ve.GET_STATS,this.handleGetLocalAudioStats),a.addListener(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.addListener(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(i.addListener(ve.GET_STATS,this.handleGetLocalAudioStats),i.addListener(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||i.addListener(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(i){i||(i=Array.from(this.localTrackMap.entries()).map(r=>{let[a,{track:d}]=r;return{track:d,type:a}})),i.forEach(r=>{let{track:a,type:d}=r;switch(d){case re.LocalVideoTrack:a.off(ve.GET_STATS,this.handleGetLocalVideoStats),a.off(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.off(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.off(ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),a.off(ve.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),a.off(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),a.off(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.off(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case re.LocalAudioTrack:this.unbindLocalAudioTrackEvents(a)}})}unbindLocalAudioTrackEvents(i){i instanceof jn?i.trackList.forEach(r=>{r.off(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(ve.GET_STATS,this.handleGetLocalAudioStats),r.off(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(i.off(ve.GET_STATS,this.handleGetLocalAudioStats),i.off(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(i,r){r instanceof za&&r.addListener(ve.GET_STATS,a=>{a(this.handleGetRemoteVideoStats(i))}),r instanceof _s&&r.addListener(ve.GET_STATS,a=>{a(this.handleGetRemoteAudioStats(i))})}unbindRemoteTrackEvents(i){i&&i.removeAllListeners(ve.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(i=>{let[r,a]=i;a.has(Se.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),a.has(Se.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(i,r){return i.map((a,d)=>{var l;let h,{track:f,type:_}=a;switch(_){case re.LocalAudioTrack:h=ut.Audio;break;case re.LocalVideoTrack:h=ye(l=f._hints).call(l,kt.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalVideoLowTrack:h=ut.Low}return{kind:_===re.LocalAudioTrack?Se.AUDIO:Se.VIDEO,stream_type:h,mid:r[d].id,ssrcs:r[d].localSSRC,isMuted:f.muted||!f.enabled}})}createGatewayUnpublishMessage(i){return i.map(r=>{var a;let d,[l,{track:h,ssrcs:f,id:_}]=r;switch(l){case re.LocalVideoTrack:d=ye(a=h._hints).call(a,kt.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalAudioTrack:d=ut.Audio;break;case re.LocalVideoLowTrack:d=ut.Low}return{stream_type:d,ssrcs:f,mid:_}})}assignLocalTracks(i,r){i.forEach((a,d)=>{let{track:l,type:h}=a;this.localTrackMap.set(h,{track:l,id:r[d].id,ssrcs:r[d].localSSRC})})}withdrawLocalTracks(i){i.forEach(r=>{let[a]=r;this.localTrackMap.delete(a)})}bindConnectionEvents(i){var r=this;i.onConnectionStateChange=function(){var a=L(function*(d){var l;I.info("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: ").concat(i.name,".onConnectionStateChange(").concat(d,")")),r.emit(Oe.PeerConnectionStateChange,d),"connected"!==d||r.store.keyMetrics.peerConnectionEnd||r.store.peerConnectionEnd(),"connected"===d&&(i.isInRestartIce=!1),ye(l=r._restartStates).call(l,d)&&!i.isInRestartIce&&("disconnected"===d&&(yield Un(800)),"disconnected"!==i.iceConnectionState&&"failed"!==i.iceConnectionState||r.handleDisconnect(i.direction))});return function(d){return a.apply(this,arguments)}}(),i.onICEConnectionStateChange=a=>{"connected"!==a||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(a,")")),Ie.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:a,tag:Kt.TRACER}).onSuccess(),this.emit(Oe.IceConnectionStateChange,a)},i.onICETransportStateChange=a=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(a,")"))},i.onDTLSTransportStateChange=a=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(a,")"))},i.onDTLSTransportError=a=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(a,")"))},i.onFirstAudioDecoded=a=>{var d;const l=Array.from(ir(d=this.remoteUserMap).call(d)).find(f=>f._audioSSRC===a);var h;l&&(this.store.subscribe(l.uid,"audio",void 0,void 0,void 0,Date.now()),null===(h=l.audioTrack)||void 0===h||h.emit(fu.FIRST_FRAME_DECODED),Ie.firstRemoteFrame(this.store.sessionId,ti.FIRST_AUDIO_DECODE,Gt.FIRST_AUDIO_DECODE,{peer:l._uintid,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId}))},i.onFirstAudioReceived=a=>{var d;const l=Array.from(ir(d=this.remoteUserMap).call(d)).find(h=>h._audioSSRC===a);l&&Ie.firstRemoteFrame(this.store.sessionId,ti.FIRST_AUDIO_RECEIVED,Gt.FIRST_AUDIO_RECEIVED,{peer:l._uintid,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId})},i.onFirstVideoDecoded=(a,d,l)=>{this.reportVideoFirstFrameDecoded(a,d,l)},i.onFirstVideoReceived=a=>{var d;const l=Array.from(ir(d=this.remoteUserMap).call(d)).find(h=>h._videoSSRC===a);l&&Ie.firstRemoteFrame(this.store.sessionId,ti.FIRST_VIDEO_RECEIVED,Gt.FIRST_VIDEO_RECEIVED,{peer:l._uintid,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId})},i.onSelectedLocalCandidateChanged=(a,d)=>{const l="relay"===a.candidateType;"unknown"!==d.candidateType&&l===("relay"===d.candidateType)||this.emit(Oe.ConnectionTypeChange,l),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Bc(d))," -> ").concat(JSON.stringify(Bc(a)),")"))},i.onSelectedRemoteCandidateChanged=(a,d)=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Bc(d))," -> ").concat(JSON.stringify(Bc(a)),")"))},i.onFirstVideoDecodedTimeout=a=>{this.reportVideoFirstFrameDecoded(a,void 0,void 0,!0)},i.onLocalCandidate=a=>{this.emit(Oe.LocalCandidate,{candidate:a,direction:i.direction})}}unbindConnectionEvents(i){i.onConnectionStateChange=void 0,i.onICEConnectionStateChange=void 0,i.onICETransportStateChange=void 0,i.onDTLSTransportStateChange=void 0,i.onDTLSTransportError=void 0,i.onFirstAudioDecoded=void 0,i.onFirstAudioReceived=void 0,i.onFirstVideoDecoded=void 0,i.onFirstVideoReceived=void 0,i.onSelectedLocalCandidateChanged=void 0,i.onSelectedRemoteCandidateChanged=void 0,i.onFirstVideoDecodedTimeout=void 0,i.onLocalCandidate=void 0}handleDisconnect(i){var r=this;return L(function*(){const a=i===Ei.SEND_ONLY?r.sendConnection:r.recvConnection;a&&!a.isInRestartIce&&(a.isInRestartIce=!0,I.debug("[".concat(r.store.clientId,"] [P2PChannel-").concat(a.name,"] start use restartICE")),i===Ei.SEND_ONLY?r.restartICE(i):nn(r,Oe.RequestP2PRestartICE,{direction:Ei.SEND_ONLY}))})()}filterTobeMutedTracks(i){const r=[];if(-1===this.getAllTracks().indexOf(i))return r;const a=this.localTrackMap.get(re.LocalAudioTrack);if(i instanceof Et&&a?.track instanceof jn)return a.track.isActive||r.push([re.LocalAudioTrack,a]),r;const d=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:h}]=l;return i===h});if(d&&(r.push(d),d[0]===re.LocalVideoTrack)){const l=this.localTrackMap.get(re.LocalVideoLowTrack);l&&r.push([re.LocalVideoLowTrack,l])}return r}filterTobeUnmutedTracks(i){const r=[],a=this.localTrackMap.get(re.LocalAudioTrack);if(i instanceof Et&&a?.track instanceof jn)return a.track.isActive&&r.push([re.LocalAudioTrack,a]),r;const d=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:h}]=l;return i===h});if(d)if(d[0]===re.LocalVideoTrack){r.push(d);const l=this.localTrackMap.get(re.LocalVideoLowTrack);l&&r.push([re.LocalVideoLowTrack,l])}else r.push(d);return r}createMuteMessage(i){return i.map(r=>{var a;let d,[l,{track:h,ssrcs:f,id:_}]=r;switch(l){case re.LocalAudioTrack:d=ut.Audio;break;case re.LocalVideoTrack:d=ye(a=h._hints).call(a,kt.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalVideoLowTrack:d=ut.Low}return{stream_type:d,ssrcs:f,mid:_}})}createUnmuteMessage(i){return i.map(r=>{var a;let d,[l,{track:h,ssrcs:f,id:_}]=r;switch(l){case re.LocalAudioTrack:d=ut.Audio;break;case re.LocalVideoTrack:d=ye(a=h._hints).call(a,kt.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalVideoLowTrack:d=ut.Low}return{stream_type:d,ssrcs:f,mid:_}})}filterTobeUnSubscribedTracks(i,r){const a=[],d=this.remoteUserMap.get(i);if(!d)return a;if(r){const l=d.get(r);if(!l)return a;a.push([i,{kind:r,id:l}])}else Array.from(d.entries()).forEach(l=>{let[h,f]=l;a.push([i,{kind:h,id:f}])});return a}createUnsubscribeMessage(i){const r=[];return i.forEach(a=>{let[d,{kind:l}]=a;switch(l){case Se.VIDEO:return void(d._videoSSRC&&r.push({stream_type:Se.VIDEO,ssrcId:d._videoSSRC}));case Se.AUDIO:return void(d._audioSSRC&&r.push({stream_type:Se.AUDIO,ssrcId:d._audioSSRC}))}}),r}withdrawRemoteTracks(i){i.forEach(r=>{let[a,{kind:d}]=r;const l=this.remoteUserMap.get(a);l&&(l.delete(d),0===Array.from(l.entries()).length&&this.remoteUserMap.delete(a))})}updateBitrateLimit(i){var r=this;return L(function*(){const a=r.localTrackMap.get(re.LocalVideoTrack),d=r.localTrackMap.get(re.LocalVideoLowTrack);a&&(yield a.track.setBitrateLimit(i.uplink)),d&&i.low_stream_uplink&&(yield d.track.setBitrateLimit({max_bitrate:i.low_stream_uplink.bitrate,min_bitrate:i.low_stream_uplink.bitrate||0}))})()}isP2PDisconnected(){return!this.sendConnection||!this.recvConnection||"connected"!==this.sendConnection.peerConnectionState&&"connected"!==this.recvConnection.peerConnectionState}tryToUnmuteAudio(i){var r=this;return L(function*(){for(let a=0;a<i.length;a++)if(i[a]instanceof Et){const d=r.filterTobeUnmutedTracks(i[a]);if(0===d.length)continue;const l=r.createUnmuteMessage(d);return void(yield Tt(r,Oe.RequestUnmuteLocal,l))}})()}bindStatsUploaderEvents(){this.statsUploader.requestStats=i=>this.getStats(i),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(i=>{let[,{ssrcs:r}]=i;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=i=>{var r;return!(null===(r=this.recvConnection)||void 0===r||!r.getRemoteVideoIsReady(i))},this.statsUploader.requestUpload=(i,r)=>this.emit(Oe.RequestUpload,i,r),this.statsUploader.requestUploadStats=i=>this.emit(Oe.RequestUploadStats,i),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){var i=this;return L(function*(){i.dtlsFailedCount+=1,yield Un(ev(i.dtlsFailedCount,Pn)),i.emit(Oe.RequestReconnect)})()}reconnectP2P(){return L(function*(){})()}canPublishLowStream(){return this.localTrackMap.has(re.LocalVideoTrack)||this.pendingLocalTracks.some(i=>i instanceof je)}throwIfTrackTypeNotMatch(i){if(i.filter(r=>r instanceof je).length>1)throw new ee(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(i.filter(r=>r instanceof Et).length>1&&(i.some(r=>r instanceof Et&&r._bypassWebAudio)||!Ot().webAudioMediaStreamDest))throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of i){if(r instanceof je&&this.pendingLocalTracks.some(a=>a instanceof je))throw new ee(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Et&&this.pendingLocalTracks.some(a=>a instanceof Et)&&(!Ot().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(a=>a instanceof Et&&a._bypassWebAudio)))throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(i,r){const a=!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ot().supportDualStreamEncoding,d=Ks(Ks({},{width:160,height:120,framerate:15,bitrate:50}),r);let l;l=a?i._mediaStreamTrack.clone():Lp(i,d);const h=qe(8,"track-low-"),f=new je(l,Ks(Ks({},a&&{scaleResolutionDownBy:OT(d,i)}),{},{frameRate:d.framerate,bitrateMax:d.bitrate,bitrateMin:d.bitrate}),void 0,void 0,h);return f.on(pu.TRANSCEIVER_UPDATED,_=>{i._updateRtpTransceiver(_,jd.LOW_STREAM)}),f._hints.push(kt.LOW_STREAM),i.addListener(ve.NEED_CLOSE,()=>{f.close()}),f}globalLock(){var i=this;return L(function*(){return i.recvMutex.lock("From P2PChannel2.globalLock")})()}reportVideoFirstFrameDecoded(i,r,a,d){var l;const h=Array.from(ir(l=this.remoteUserMap).call(l)).find(f=>f._videoSSRC===i);if(h){d||this.store.subscribe(h.uid,"video",void 0,void 0,void 0,void 0,Date.now());const f=this.store.keyMetrics,_=f.subscribe.find(g=>g.userId===h.uid&&"video"===g.type);Ie.firstRemoteVideoDecode(this.store.sessionId,ti.FIRST_VIDEO_DECODE,Gt.FIRST_VIDEO_DECODE,{peer:h._uintid,videowidth:r,videoheight:a,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId,apEnd:f.requestAPEnd||0,apStart:f.requestAPStart||0,joinGwEnd:f.joinGatewayEnd||0,joinGwStart:f.joinGatewayStart||0,pcEnd:f.peerConnectionEnd||0,pcStart:f.peerConnectionStart||0,subscriberEnd:_?.subscribeEnd||0,subscriberStart:_?.subscribeStart||0,videoAddNotify:_?.streamAdded||0,state:d?1:0})}}remoteMediaSsrcChanged(i,r,a){var d=this;return L(function*(){if(!d.recvConnection)return!1;const l=d.remoteUserMap.get(i);if(!l)return!1;const h=l.get(r);if(!h)return!1;const f=yield d.recvConnection.getRemoteSSRC(h);return void 0!==f&&f!==a})()}resetConnection(i){I.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(i)),this.state===Dt.Connected?(I.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}publishDataChannel(i){return L(function*(){throw new ee(k.NOT_SUPPORTED)})()}unpublishDataChannel(i){return L(function*(){throw new ee(k.NOT_SUPPORTED)})()}subscribeDataChannel(i,r){return L(function*(){throw new ee(k.NOT_SUPPORTED)})()}unsubscribeDataChannel(i,r){return L(function*(){throw new ee(k.NOT_SUPPORTED)})()}hasPendingRemoteDataChannel(i,r){throw new ee(k.NOT_SUPPORTED)}setPendingRemoteDataChannel(i,r){throw new ee(k.NOT_SUPPORTED)}preConnect(i,r,a,d,l,h){return L(function*(){throw new ee(k.NOT_SUPPORTED)})()}getEstablishParams(){throw new ee(k.NOT_SUPPORTED)}reSubscribe(i){return L(function*(){throw new ee(k.NOT_SUPPORTED)})()}updateVideoStreamParameter(i,r){return L(function*(){throw new ee(k.NOT_SUPPORTED)})()}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(i=>{let[r,{track:a}]=i;r===re.LocalVideoLowTrack?a._updateRtpTransceiver(void 0,jd.LOW_STREAM):a._updateRtpTransceiver(void 0)})}}function xt(s){return function(i,r,a){const d=i[r];if("function"!=typeof d)throw new Error("Cannot use mutex on object property.");return a.value=L(function*(){for(var l=arguments.length,h=new Array(l),f=0;f<l;f++)h[f]=arguments[f];switch(s){case bs.SEND_ONLY:{const _=yield this.sendMutex.lock("From P2PChannel2.".concat(r));try{return yield d.apply(this,h)}finally{_()}}case bs.RECEIVE_ONLY:{const _=yield this.recvMutex.lock("From P2PChannel2.".concat(r));try{return yield d.apply(this,h)}finally{_()}}default:{const _=yield this.sendMutex.lock("From P2PChannel2.".concat(r)),g=yield this.recvMutex.lock("From P2PChannel2.".concat(r));try{return yield d.apply(this,h)}finally{_(),g()}}}}),a}}function wP(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Ja(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?wP(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):wP(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}ne([xt(bs.SEND_ONLY),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],Je.prototype,"p2pConnect",null),ne([xt(bs.SEND_ONLY),N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],Je.prototype,"unpublish",null),ne([xt(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",X)],Je.prototype,"unpublishLowStream",null),ne([xt(bs.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Ii,String,Number,String]),N("design:returntype",X)],Je.prototype,"subscribe",null),ne([xt(bs.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Ii,String,Number,String]),N("design:returntype",X)],Je.prototype,"mockSubscribe",null),ne([xt(bs.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Ii,String,Boolean]),N("design:returntype",X)],Je.prototype,"unsubscribe",null),ne([xt(bs.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Ii,String]),N("design:returntype",X)],Je.prototype,"muteRemote",null),ne([xt(bs.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Ii,String]),N("design:returntype",X)],Je.prototype,"unmuteRemote",null),ne([xt(bs.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Ii,String]),N("design:returntype",X)],Je.prototype,"hasRemoteMediaWithLock",null),ne([xt(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",X)],Je.prototype,"disconnectForReconnect",null),ne([xt(bs.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Ii,String,Number]),N("design:returntype",X)],Je.prototype,"remoteMediaSsrcChanged",null);class ys{constructor(i){C(this,"store",void 0),C(this,"onStatsException",void 0),C(this,"onUploadPublishDuration",void 0),C(this,"onStatsChanged",void 0),C(this,"localStats",new Map),C(this,"remoteStats",new Map),C(this,"updateStatsInterval",void 0),C(this,"trafficStats",void 0),C(this,"trafficStatsPeerList",[]),C(this,"uplinkStats",void 0),C(this,"exceptionMonitor",void 0),C(this,"p2pChannel",void 0),C(this,"scalabilityMode",vT.L1T1),C(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=i,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new gF,this.exceptionMonitor.on("exception",(r,a,d)=>{this.onStatsException&&this.onStatsException(r,a,d)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(re.LocalAudioTrack)||Ja({},zT)}getLocalVideoTrackStats(){return this.localStats.get(re.LocalVideoTrack)||Ja({},wn)}getRemoteAudioTrackStats(i){const r=(l,h)=>{if(!this.trafficStats)return h;const f=this.trafficStats.peer_delay.find(_=>_.peer_uid===l);return f&&(h.publishDuration=f.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},a={};if(i){var d;const l=null===(d=this.remoteStats.get(i))||void 0===d?void 0:d.audioStats;l&&(a[i]=r(i,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[h,{audioStats:f}]=l;f&&(a[h]=r(h,f))});return a}getRemoteNetworkQualityStats(i){const r={};if(i){var a;const d=null===(a=this.remoteStats.get(i))||void 0===a?void 0:a.networkStats;d&&(r[i]=d)}else Array.from(this.remoteStats.entries()).forEach(d=>{let[l,{networkStats:h}]=d;h&&(r[l]=h)});return r}getRemoteVideoTrackStats(i){const r=(l,h)=>{if(!this.trafficStats)return h;const f=this.trafficStats.peer_delay.find(_=>_.peer_uid===l);return f&&(h.publishDuration=f.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},a={};if(i){var d;const l=null===(d=this.remoteStats.get(i))||void 0===d?void 0:d.videoStats;l&&(a[i]=r(i,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[h,{videoStats:f}]=l;f&&(a[h]=r(h,f))});return a}getRTCStats(){let i=0,r=0,a=0,d=0;const l=this.localStats.get(re.LocalAudioTrack);l&&(i+=l.sendBytes,r+=l.sendBitrate);const h=this.localStats.get(re.LocalVideoTrack);h&&(i+=h.sendBytes,r+=h.sendBitrate);const f=this.localStats.get(re.LocalVideoLowTrack);f&&(i+=f.sendBytes,r+=f.sendBitrate),this.remoteStats.forEach(g=>{let{audioStats:v,videoStats:b}=g;v&&(a+=v.receiveBytes,d+=v.receiveBitrate),b&&(a+=b.receiveBytes,d+=b.receiveBitrate)});let _=1;return this.trafficStats&&(_+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:_,SendBitrate:r,SendBytes:i,RecvBytes:a,RecvBitrate:d,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(i){this.localStats.set(i,void 0)}removeLocalStats(i){i?this.localStats.delete(i):this.localStats.clear()}addRemoteStats(i){this.remoteStats.set(i,{})}removeRemoteStats(i){i?this.remoteStats.delete(i):this.remoteStats.clear()}addP2PChannel(i){this.p2pChannel=i}updateTrafficStats(i){i.peer_delay=i.peer_delay.filter(r=>void 0!==r.B_ppad||void 0!==r.B_ppvd),i.peer_delay.filter(r=>-1===this.trafficStatsPeerList.indexOf(r.peer_uid)).forEach(r=>{var a;const d=null===(a=this.p2pChannel)||void 0===a?void 0:a.getRemoteMedia(r.peer_uid),l=null!=d&&d.videoSSRC?Li.measureFromSubscribeStart(this.store.clientId,d.videoSSRC):0,h=null!=d&&d.audioSSRC?Li.measureFromSubscribeStart(this.store.clientId,d.audioSSRC):0;void 0!==r.B_ppad&&void 0!==r.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(r.peer_uid,r.B_ppad,r.B_ppvd,l>h?l:h),this.trafficStatsPeerList.push(r.peer_uid))}),this.trafficStats=i}updateUplinkStats(i){this.uplinkStats&&this.uplinkStats.B_fir!==i.B_fir&&I.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(i.B_fir)),this.uplinkStats=i}static isRemoteVideoFreeze(i,r,a){return!!i&&(!!a&&r.framesDecodeFreezeTime>a.framesDecodeFreezeTime||!(!a||r.framesDecodeCount>a.framesDecodeCount))}static isRemoteAudioFreeze(i){return!!i&&i._isFreeze()}isLocalVideoFreeze(i){return!(!i.inputFrame||!i.sentFrame)&&i.inputFrame.frameRate>5&&i.sentFrame.frameRate<3}updateLocalStats(i){Array.from(this.localStats.entries()).forEach(r=>{let[a,d]=r;switch(a){case re.LocalVideoTrack:case re.LocalVideoLowTrack:{const h=d,f=Ja({},wn),_=i.getStats(),g=i.getLocalMedia(a);if(_){const v=_.videoSend.find(b=>b.ssrc===g?.ssrcs[0].ssrcId);if(v){const b=i.getLocalVideoSize(),y=i.getEncoderConfig(re.LocalVideoTrack);"H264"!==v.codec&&"H265"!==v.codec&&"VP8"!==v.codec&&"VP9"!==v.codec&&"AV1X"!==v.codec&&"AV1"!==v.codec||(f.codecType=v.codec),f.sendBytes=v.bytes,f.sendBitrate=h?8*Math.max(0,f.sendBytes-h.sendBytes):0,v.inputFrame?(f.captureFrameRate=v.inputFrame.frameRate,f.captureResolutionHeight=v.inputFrame.height,f.captureResolutionWidth=v.inputFrame.width):b&&(f.captureResolutionWidth=b.width,f.captureResolutionHeight=b.height),v.sentFrame?(f.sendFrameRate=v.sentFrame.frameRate,f.sendResolutionHeight=v.sentFrame.height,f.sendResolutionWidth=v.sentFrame.width):b&&(f.sendResolutionWidth=b.width,f.sendResolutionHeight=b.height),v.avgEncodeMs&&(f.encodeDelay=v.avgEncodeMs),y&&y.bitrateMax&&(f.targetSendBitrate=1e3*y.bitrateMax),f.sendPackets=v.packets,f.sendPacketsLost=v.packetsLost,f.sendJitterMs=v.jitterMs,f.sendRttMs=v.rttMs,f.totalDuration=h?h.totalDuration+1:1,f.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(v)&&(f.totalFreezeTime+=1),v.scalabilityMode&&this.scalabilityMode!==v.scalabilityMode&&(I.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(v.scalabilityMode)),this.scalabilityMode=v.scalabilityMode)}this.trafficStats&&(f.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var l;this.localStats.set(a,f),(h?.sendResolutionWidth!==f.sendResolutionWidth||h?.sendResolutionHeight!==f.sendResolutionHeight)&&(null===(l=this.onStatsChanged)||void 0===l||l.call(this,"resolution",{width:f.sendResolutionWidth,height:f.sendResolutionHeight})),f&&g&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,g.track,f);break}case re.LocalAudioTrack:{const h=d,f=Ja({},zT),_=i.getStats(),g=i.getLocalMedia(a);if(_){const v=_.audioSend.find(b=>b.ssrc===g?.ssrcs[0].ssrcId);if(v){if("opus"!==v.codec&&"aac"!==v.codec&&"PCMU"!==v.codec&&"PCMA"!==v.codec&&"G722"!==v.codec||(f.codecType=v.codec),v.inputLevel)f.sendVolumeLevel=Math.round(32767*v.inputLevel);else{const b=i.getLocalAudioVolume();b&&(f.sendVolumeLevel=Math.round(32767*b))}f.sendBytes=v.bytes,f.sendPackets=v.packets,f.sendPacketsLost=v.packetsLost,f.sendJitterMs=v.jitterMs,f.sendRttMs=v.rttMs,f.sendBitrate=h?8*Math.max(0,f.sendBytes-h.sendBytes):0}}this.trafficStats&&(f.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(re.LocalAudioTrack,f),f&&g&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,g.track,f);break}}})}updateRemoteStats(i){Array.from(this.remoteStats.entries()).forEach(r=>{var a,d;let[l,{videoStats:h,audioStats:f,videoPcStats:_}]=r;const g=f,v=h,b=_,y=Ja({},Hd),T=Ja({},gN),M=Ja({},_N),{audioTrack:O,videoTrack:D,audioSSRC:x,videoSSRC:F}=i.getRemoteMedia(l);let j;j=i instanceof Je?i.getStats(!0):i.getStats();const Y=null===(a=j)||void 0===a?void 0:a.audioRecv.find(Q=>Q.ssrc===x),te=null===(d=j)||void 0===d?void 0:d.videoRecv.find(Q=>Q.ssrc===F),K=this.trafficStats&&this.trafficStats.peer_delay.find(Q=>Q.peer_uid===l);if(Y&&("opus"!==Y.codec&&"aac"!==Y.codec&&"PCMU"!==Y.codec&&"PCMA"!==Y.codec&&"G722"!==Y.codec||(y.codecType=Y.codec),Y.outputLevel?y.receiveLevel=Math.round(32767*Y.outputLevel):O&&(y.receiveLevel=Math.round(32767*O.getVolumeLevel())),y.receiveBytes=Y.bytes,y.receivePackets=Y.packets,y.receivePacketsLost=Y.packetsLost,y.packetLossRate=y.receivePacketsLost/(y.receivePackets+y.receivePacketsLost),y.receiveBitrate=g?8*Math.max(0,y.receiveBytes-g.receiveBytes):0,y.totalDuration=g?g.totalDuration+1:1,y.totalFreezeTime=g?g.totalFreezeTime:0,y.freezeRate=y.totalFreezeTime/y.totalDuration,y.receiveDelay=Y.jitterBufferMs,y.totalDuration>10&&ys.isRemoteAudioFreeze(O)&&(y.totalFreezeTime+=1)),te){"H264"!==te.codec&&"H265"!==te.codec&&"VP8"!==te.codec&&"VP9"!==te.codec&&"AV1X"!==te.codec&&"AV1"!==te.codec||(T.codecType=te.codec),T.receiveBytes=te.bytes,T.receiveBitrate=v?8*Math.max(0,T.receiveBytes-v.receiveBytes):0,T.decodeFrameRate=te.decodeFrameRate<0?0:te.decodeFrameRate,T.renderFrameRate=te.decodeFrameRate<0?0:te.decodeFrameRate,te.outputFrame&&(T.renderFrameRate=te.outputFrame.frameRate),te.receivedFrame?(T.receiveFrameRate=te.receivedFrame.frameRate,T.receiveResolutionHeight=te.receivedFrame.height,T.receiveResolutionWidth=te.receivedFrame.width):D&&(T.receiveResolutionHeight=D._videoHeight||0,T.receiveResolutionWidth=D._videoWidth||0),void 0!==te.framesRateFirefox&&(T.receiveFrameRate=Math.round(te.framesRateFirefox)),T.receivePackets=te.packets,T.receivePacketsLost=te.packetsLost,T.packetLossRate=T.receivePacketsLost/(T.receivePackets+T.receivePacketsLost),T.totalDuration=v?v.totalDuration+1:1,T.totalFreezeTime=v?v.totalFreezeTime:0,T.receiveDelay=te.jitterBufferMs||0;const Q=!!F&&i.getRemoteVideoIsReady(F);D&&Q&&ys.isRemoteVideoFreeze(D,te,b)&&(T.totalFreezeTime+=1),T.freezeRate=T.totalFreezeTime/T.totalDuration}K&&(y.end2EndDelay=K.B_ad,T.end2EndDelay=K.B_vd,y.transportDelay=K.B_ed,T.transportDelay=K.B_ed,y.currentPacketLossRate=K.B_ealr4/100,T.currentPacketLossRate=K.B_evlr4/100,M.uplinkNetworkQuality=K.B_punq?K.B_punq:0,M.downlinkNetworkQuality=K.B_pdnq?K.B_pdnq:0),this.remoteStats.set(l,{audioStats:y,videoStats:T,videoPcStats:te,networkStats:M}),O&&this.exceptionMonitor.setRemoteAudioStats(O,y),D&&this.exceptionMonitor.setRemoteVideoStats(D,T)})}}function g_(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function po(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?g_(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):g_(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class FF extends jt{constructor(i,r,a,d){super(),C(this,"spec",void 0),C(this,"token",void 0),C(this,"websocket",void 0),C(this,"pingpongTimer",void 0),C(this,"reconnectMode","retry"),C(this,"serviceMode",void 0),C(this,"reqId",0),C(this,"commandReqId",0),C(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),C(this,"handleWebSocketMessage",l=>{if(!l.data)return;const h=JSON.parse(l.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):this.serviceMode===Kn.INJECT?this.emit(Vs.INJECT_STREAM_STATUS,h):(Ie.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===Kn.TRANSCODE?1:2}),this.emit(Vs.PUBLISH_STREAM_STATUS,h))}),this.spec=r,this.token=i,this.serviceMode=d,this.websocket=new Lm("live-streaming",a),this.websocket.on(Me.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Me.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Me.REQUEST_NEW_URLS,(l,h)=>{nn(this,Vs.REQUEST_NEW_ADDRESS).then(l).catch(h)}),this.websocket.on(Me.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(i){return this.websocket.init(i)}request(i,r,a,d){var l=this;return L(function*(){l.reqId+=1,"request"===i&&(l.commandReqId+=1);const h=l.commandReqId,f=l.reqId;if(!f||!l.websocket)throw new W(k.UNEXPECTED_ERROR);const _=po({command:i,sdkVersion:"4.20.0"===Ao?"0.0.1":Ao,seq:f,requestId:f,allocate:a,cname:l.spec.cname,appId:l.spec.appId,sid:l.spec.sid,uid:l.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},r);if("closed"===l.websocket.state)throw new W(k.WS_DISCONNECT);const g=()=>new X((T,M)=>{l.websocket.once(Me.CLOSED,()=>M(new W(k.WS_ABORT))),l.websocket.once(Me.CONNECTED,T)});"connected"!==l.websocket.state&&(yield g()),_.clientRequest&&(_.clientRequest.workerToken=l.token);const v=new X((T,M)=>{const O=()=>{M(new W(k.WS_ABORT))};l.websocket.once(Me.RECONNECTING,O),l.websocket.once(Me.CLOSED,O),l.once("@".concat(f,"-").concat(l.spec.sid),D=>{T(D)})});d&&Ie.workerEvent(l.spec.sid,po(po({},d),{},{requestId:h,actionType:"request",payload:JSON.stringify(r.clientRequest),serverCode:0,code:0}));const b=Date.now();l.websocket.sendMessage(_);let y=null;try{y=yield v}catch(T){if("closed"===l.websocket.state)throw T;return yield g(),yield l.request(i,r,a)}return d&&Ie.workerEvent(l.spec.sid,po(po({},d),{},{requestId:h,actionType:"response",payload:JSON.stringify(y.serverResponse),serverCode:y.code,success:200===y.code,responseTime:Date.now()-b})),200!==y.code&&l.handleResponseError(y),y})()}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const i="4.20.0"===Ao?"0.0.1":Ao;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:i,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(i){switch(i.code){case Mn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void I.warning("live stream response already exists stream");case Mn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Mn.LIVE_STREAM_RESPONSE_BAD_STREAM:case Mn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new W(k.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:i.code}).throw();case Mn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===i.serverResponse.command||"UninjectStream"===i.serverResponse.command)return;throw new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Mn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new W(k.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:i.code}).throw();case Mn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const r=new W(k.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Vs.WARNING,r,i.serverResponse.url)}case Mn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const r=new W(k.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Vs.WARNING,r,i.serverResponse.url)}case Mn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Mn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new W(k.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:i.code}).throw();case Mn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const r=new W(k.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Vs.WARNING,r,i.serverResponse.url)}case Mn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:i.code}).throw();case Mn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Mn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Mn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===i.serverResponse.command||"UninjectStream"===i.serverResponse.command)return;throw new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Mn.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===i.serverResponse.command||"UninjectStream"===i.serverResponse.command)return;if("UpdateTranscoding"===i.serverResponse.command||"ControlStream"===i.serverResponse.command)return new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:i.code}).throw();throw new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Mn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Mn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Mn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Mn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new W(k.LIVE_STREAMING_CDN_ERROR,"",{code:i.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(Jl)},6e3)}}function Gi(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Fr(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?Gi(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Gi(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class oi extends jt{constructor(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Pn,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Pn;super(),C(this,"onLiveStreamWarning",void 0),C(this,"onLiveStreamError",void 0),C(this,"onInjectStatusChange",void 0),C(this,"spec",void 0),C(this,"retryTimeout",1e4),C(this,"connection",void 0),C(this,"httpRetryConfig",void 0),C(this,"wsRetryConfig",void 0),C(this,"streamingTasks",new Map),C(this,"isStartingStreamingTask",!1),C(this,"taskMutex",new gi("live-streaming")),C(this,"cancelToken",Ze.CancelToken.source()),C(this,"transcodingConfig",void 0),C(this,"injectConfig",Fr({},JL)),C(this,"injectLoopTimes",0),C(this,"uapResponse",void 0),C(this,"lastTaskId",1),C(this,"statusError",new Map),this.spec=i,this.httpRetryConfig=a,this.wsRetryConfig=r}setTranscodingConfig(i){var r=this;return L(function*(){const a=Fr(Fr({},XL),i);var f;66!==a.videoCodecProfile&&77!==a.videoCodecProfile&&100!==a.videoCodecProfile&&(I.debug("[".concat(r.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(a.videoCodecProfile," -> 100")),a.videoCodecProfile=100),a.transcodingUsers||(a.transcodingUsers=a.userConfigs),a.transcodingUsers&&(a.transcodingUsers=a.transcodingUsers.map(f=>Fr(Fr(Fr({},HO),f),{},{zOrder:f.zOrder?f.zOrder+1:1}))),tn((f=a).width)||At(f.width,"config.width",0,1e4),tn(f.height)||At(f.height,"config.height",0,1e4),tn(f.videoBitrate)||At(f.videoBitrate,"config.videoBitrate",1,1e6),tn(f.videoFrameRate)||At(f.videoFrameRate,"config.videoFrameRate"),tn(f.lowLatency)||Rc(f.lowLatency,"config.lowLatency"),tn(f.audioSampleRate)||Cn(f.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),tn(f.audioBitrate)||At(f.audioBitrate,"config.audioBitrate",1,128),tn(f.audioChannels)||Cn(f.audioChannels,"config.audioChannels",[1,2,3,4,5]),tn(f.videoGop)||At(f.videoGop,"config.videoGop"),tn(f.videoCodecProfile)||Cn(f.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),tn(f.userCount)||At(f.userCount,"config.userCount",0,17),tn(f.backgroundColor)||At(f.backgroundColor,"config.backgroundColor",0,16777215),tn(f.userConfigExtraInfo)||hi(f.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),f.transcodingUsers&&!tn(f.transcodingUsers)&&(Fa(f.transcodingUsers,"config.transcodingUsers"),f.transcodingUsers.forEach((_,g)=>{bv(_.uid),tn(_.x)||At(_.x,"transcodingUser[".concat(g,"].x"),0,1e4),tn(_.y)||At(_.y,"transcodingUser[".concat(g,"].y"),0,1e4),tn(_.width)||At(_.width,"transcodingUser[".concat(g,"].width"),0,1e4),tn(_.height)||At(_.height,"transcodingUser[".concat(g,"].height"),0,1e4),tn(_.zOrder)||At(_.zOrder-1,"transcodingUser[".concat(g,"].zOrder"),0,100),tn(_.alpha)||At(_.alpha,"transcodingUser[".concat(g,"].alpha"),0,1,!1)})),tn(f.watermark)||Vn(f.watermark,"watermark"),tn(f.backgroundImage)||Vn(f.backgroundImage,"backgroundImage"),f.images&&!tn(f.images)&&(Fa(f.images,"config.images"),f.images.forEach((_,g)=>{Vn(_,"images[".concat(g,"]"))}));const d=[];a.images&&d.push(...a.images.map(f=>Fr(Fr(Fr({},GO),f),{},{zOrder:255}))),a.backgroundImage&&(d.push(Fr(Fr(Fr({},GO),a.backgroundImage),{},{zOrder:0})),delete a.backgroundImage),a.watermark&&(d.push(Fr(Fr(Fr({},GO),a.watermark),{},{zOrder:255})),delete a.watermark),a.images=d,a.transcodingUsers&&(a.userConfigs=a.transcodingUsers.map(f=>Fr({},f)),a.userCount=a.transcodingUsers.length,delete a.transcodingUsers);const l=(a.userConfigs||[]).map(f=>"number"==typeof f.uid?X.resolve(f.uid):ar(f.uid,r.spec,r.cancelToken.token,r.httpRetryConfig));if((yield X.all(l)).forEach((f,_)=>{a.userConfigs&&a.userConfigs[_]&&(a.userConfigs[_].uid=f)}),r.transcodingConfig=a,r.connection)try{var h;const f=yield r.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:r.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(ca(h=r.streamingTasks).call(h)).map(_=>_.taskId).join("#")});I.debug("[".concat(r.spec.clientId,"] update live transcoding config success, code: ").concat(f.code,", config:"),JSON.stringify(r.transcodingConfig))}catch(f){if(!f.data||!f.data.retry)throw f;f.data.changeAddress&&r.connection.tryNextAddress(),r.streamingTasks.forEach(_=>{I.warning("[".concat(r.spec.clientId,"] live streaming receive error"),f.toString(),"try to republish",_.url),r.startLiveStreamingTask(_.url,_.mode,f).then(()=>{I.debug("[".concat(r.spec.clientId,"] live streaming republish ").concat(_.url," success"))}).catch(g=>{I.error("[".concat(r.spec.clientId,"] live streaming republish failed"),_.url,g.toString()),r.onLiveStreamError&&r.onLiveStreamError(_.url,g)})})}})()}setInjectStreamConfig(i,r){this.injectConfig=Object.assign({},this.injectConfig,i),this.injectLoopTimes=r}startLiveStreamingTask(i,r,a){var d=this;return L(function*(){var l;if(Array.from(ca(l=d.streamingTasks).call(l)).find(g=>g.mode===Kn.INJECT)&&r===Kn.INJECT)return new W(k.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!d.transcodingConfig&&r===Kn.TRANSCODE)throw new W(k.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let h={command:"PublishStream",ts:Date.now(),url:i,uid:d.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};I.debug("[".concat(d.spec.clientId,"] start live streaming ").concat(i,", mode: ").concat(r));const f=yield d.taskMutex.lock();if(!d.connection&&a)return void f();if(d.streamingTasks.get(i)&&!a)return f(),new W(k.LIVE_STREAMING_TASK_CONFLICT).throw();try{d.connection||(d.connection=yield d.connect(r))}catch(g){throw f(),g}switch(r){case Kn.TRANSCODE:h.transcodingConfig=Fr({},d.transcodingConfig);break;case Kn.RAW:break;case Kn.INJECT:h={cname:d.spec.cname,command:"InjectStream",sid:d.spec.sid,transcodingConfig:d.injectConfig,ts:Date.now(),url:i,loopTimes:d.injectLoopTimes}}d.uapResponse&&d.uapResponse.vid&&(h.vid=d.uapResponse.vid),d.isStartingStreamingTask=!0;const _=d.lastTaskId++;try{const g=new X((b,y)=>{Un(d.retryTimeout).then(()=>{if(a)return y(a);const T=d.statusError.get(i);return T?(d.statusError.delete(i),y(T)):void 0})}),v=yield X.race([d.connection.request("request",{clientRequest:h},!0,{url:i,command:"PublishStream",workerType:r===Kn.TRANSCODE?1:2,requestByUser:!a,tid:_.toString()}),g]);d.isStartingStreamingTask=!1,I.debug("[".concat(d.spec.clientId,"] live streaming started, code: ").concat(v.code)),d.streamingTasks.set(i,{clientRequest:h,mode:r,url:i,taskId:_}),f()}catch(g){if(f(),d.isStartingStreamingTask=!1,!g.data||!g.data.retry||a)throw g;return g.data.changeAddress?(d.connection.tryNextAddress(),yield d.startLiveStreamingTask(i,r,g)):yield d.startLiveStreamingTask(i,r,g)}})()}stopLiveStreamingTask(i){return new X((r,a)=>{const d=this.streamingTasks.get(i);if(!d||!this.connection)return new W(k.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const l=d.mode;d.abortTask=()=>{I.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(i),r()},this.connection.request("request",{clientRequest:{command:l===Kn.INJECT?"UninjectStream":"UnpublishStream",url:d.url}},!1,{url:i,command:"UnPublishStream",workerType:l===Kn.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{I.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(i),0===this.streamingTasks.size&&l!==Kn.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),r(),l===Kn.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(Lc.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,i)}).catch(a)})}controlInjectStream(i,r,a,d){var l=this;return L(function*(){const h=l.streamingTasks.get(i);if(!h||!l.connection||h.mode!==Kn.INJECT)throw new W(k.INVALID_OPERATION,"can not find inject stream task to control");return(yield l.connection.request("request",{clientRequest:{command:"ControlStream",url:i,control:r,audioVolume:a,position:d}})).serverResponse})()}resetAllTask(){var i;const r=Array.from(ca(i=this.streamingTasks).call(i));this.terminate();for(const a of r)this.startLiveStreamingTask(a.url,a.mode).catch(d=>{this.onLiveStreamError&&this.onLiveStreamError(a.url,d)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Ze.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}connect(i){var r=this;return L(function*(){if(r.connection)throw new W(k.UNEXPECTED_ERROR,"live streaming connection has already connected");const a=yield nn(r,da.REQUEST_WORKER_MANAGER_LIST,i);return r.uapResponse=a,r.connection=new FF(a.workerToken,r.spec,r.wsRetryConfig,i),r.connection.on(Vs.WARNING,(d,l)=>r.onLiveStreamWarning&&r.onLiveStreamWarning(l,d)),r.connection.on(Vs.PUBLISH_STREAM_STATUS,d=>r.handlePublishStreamServer(d)),r.connection.on(Vs.INJECT_STREAM_STATUS,d=>r.handleInjectStreamServerStatus(d)),r.connection.on(Vs.REQUEST_NEW_ADDRESS,(d,l)=>{if(!r.connection)return l(new W(k.UNEXPECTED_ERROR,"can not get new live streaming address list"));nn(r,da.REQUEST_WORKER_MANAGER_LIST,i).then(h=>{r.uapResponse=h,d(h.addressList)}).catch(l)}),yield r.connection.init(a.addressList),r.connection})()}handlePublishStreamServer(i){const r=i.serverStatus&&i.serverStatus.url||"empty_url",a=this.streamingTasks.get(r),d=i.reason;switch(i.code){case Mn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Mn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Mn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Mn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new W(k.LIVE_STREAMING_CDN_ERROR,"",{code:i.code});if(a)return I.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(r,h);if(!this.isStartingStreamingTask)return;this.statusError.set(r,h)}case Mn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new W(k.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,d);return this.onLiveStreamWarning&&this.onLiveStreamWarning(r,h)}case Mn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Mn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var l;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(ca(l=this.streamingTasks).call(l));for(const f of h)f.abortTask?f.abortTask():(I.warning("[".concat(this.spec.clientId,"] publish stream status code"),i.code,"try to republish",f.url),this.startLiveStreamingTask(f.url,f.mode,new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:i.code})).then(()=>{I.debug("[".concat(this.spec.clientId,"] republish live stream success"),f.url)}).catch(_=>{I.error(_.toString()),this.onLiveStreamError&&this.onLiveStreamError(f.url,_)}));return}}}handleInjectStreamServerStatus(i){const r=Number(i.uid),a=i.serverStatus&&i.serverStatus.url;switch(i.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(Lc.INJECT_STREAM_STATUS_START_SUCCESS,r,a));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(Lc.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,r,a),void this.streamingTasks.delete(a);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(Lc.INJECT_STREAM_STATUS_START_UNAUTHORIZED,r,a),void this.streamingTasks.delete(a);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(Lc.INJECT_STREAM_STATUS_BROKEN,r,a),void this.streamingTasks.delete(a);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(Lc.INJECT_STREAM_STATUS_START_TIMEOUT,r,a),void this.streamingTasks.delete(a);default:return void I.debug("inject stream server status",i)}}hasUrl(i){return this.streamingTasks.has(i)}}class pb{constructor(){C(this,"destChannelMediaInfos",new Map),C(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(i){WO(i),this.srcChannelMediaInfo=i}addDestChannelInfo(i){WO(i),this.destChannelMediaInfos.set(i.channelName,i)}removeDestChannelInfo(i){jO(i),this.destChannelMediaInfos.delete(i)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function E_(s){if(!(s instanceof pb))return new W(k.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const i=s.getSrcChannelMediaInfo(),r=s.getDestChannelMediaInfo();return i?0===r.size?new W(k.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new W(k.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class UF extends jt{constructor(i,r,a){super(),C(this,"ws",void 0),C(this,"requestId",1),C(this,"heartBeatTimer",void 0),C(this,"joinInfo",void 0),C(this,"clientId",void 0),C(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),C(this,"onClose",d=>{this.emit("close"),this.dispose()}),C(this,"onMessage",d=>{const l=JSON.parse(d.data);if(!l||"serverResponse"!==l.command||!l.requestId)return l&&"serverStatus"===l.command&&l.serverStatus&&l.serverStatus.command?(this.emit("status",l.serverStatus),void this.emit(l.serverStatus.command,l.serverStatus)):void 0;this.emit("req_".concat(l.requestId),l)}),this.joinInfo=i,this.clientId=r,this.ws=new Lm("cross-channel-".concat(this.clientId),a),this.ws.on(Me.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Me.CONNECTED,this.onOpen),this.ws.on(Me.ON_MESSAGE,this.onMessage),this.ws.on(Me.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(i){const r=this.requestId++;return i.requestId=r,i.seq=r,this.ws.sendMessage(i),r}waitStatus(i){return new X((r,a)=>{const d=window.setTimeout(()=>{a(new W(k.TIMEOUT,"wait status timeout, status: ".concat(i)))},5e3);this.once(i,l=>{window.clearTimeout(d),l.state&&0!==l.state?a(new W(k.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(i))):r(void 0)}),this.once("dispose",()=>{window.clearTimeout(d),a(new W(k.WS_ABORT))})})}request(i){var r=this;return L(function*(){if("closed"===r.ws.state)throw new W(k.WS_DISCONNECT);"connected"!==r.ws.state&&(yield new X((f,_)=>{r.ws.once(Me.CLOSED,()=>_(new W(k.WS_ABORT))),r.ws.once(Me.CONNECTED,f)}));const d=r.sendMessage(i),l=new X((f,_)=>{const g=()=>{_(new W(k.WS_ABORT))};r.ws.once(Me.RECONNECTING,g),r.ws.once(Me.CLOSED,g),r.once("req_".concat(d),f),Un(3e3).then(()=>{r.removeAllListeners("req_".concat(d)),r.ws.off(Me.RECONNECTING,g),r.ws.off(Me.CLOSED,g),_(new W(k.TIMEOUT,"cross channel ws request timeout"))})}),h=yield l;if(!h||200!==h.code)throw new W(k.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(h)));return h})()}connect(i){var r=this;return L(function*(){r.ws.removeAllListeners(Me.REQUEST_NEW_URLS),r.ws.on(Me.REQUEST_NEW_URLS,a=>{a(i)}),yield r.ws.init(i)})()}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(i){const r=this.requestId++;return i.requestId=r,this.ws.sendMessage(i),r}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class fb extends jt{set state(i){i!==this._state&&(i!==sr.RELAY_STATE_FAILURE&&(this.errorCode=Uc.RELAY_OK),this.emit("state",i,this.errorCode),this._state=i)}get state(){return this._state}constructor(i,r,a,d,l){var h;super(),h=this,C(this,"joinInfo",void 0),C(this,"sid",void 0),C(this,"clientId",void 0),C(this,"cancelToken",Ze.CancelToken.source()),C(this,"workerToken",void 0),C(this,"requestId",0),C(this,"signal",void 0),C(this,"prevChannelMediaConfig",void 0),C(this,"httpRetryConfig",void 0),C(this,"_resolution",void 0),C(this,"_state",sr.RELAY_STATE_IDLE),C(this,"errorCode",Uc.RELAY_OK),C(this,"onStatus",f=>{I.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(f))),f&&f.command&&("onAudioPacketReceived"===f.command&&this.emit("event",vi.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===f.command&&this.emit("event",vi.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===f.command&&(this.errorCode=Uc.SRC_TOKEN_EXPIRED,this.state=sr.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===f.command&&(this.errorCode=Uc.DEST_TOKEN_EXPIRED,this.state=sr.RELAY_STATE_FAILURE))}),C(this,"onReconnect",L(function*(){I.debug("[".concat(h.clientId,"] ChannelMediaSocket disconnect, reconnecting")),h.emit("event",vi.NETWORK_DISCONNECTED),h.state=sr.RELAY_STATE_IDLE,h.prevChannelMediaConfig&&h.sendStartRelayMessage(h.prevChannelMediaConfig).catch(f=>{h.state!==sr.RELAY_STATE_IDLE&&(I.error("auto restart channel media relay failed",f.toString()),h.errorCode=Uc.SERVER_CONNECTION_LOST,h.state=sr.RELAY_STATE_FAILURE)})})),this.joinInfo=i,this.clientId=r,this.sid=Dc(),this.signal=new UF(this.joinInfo,this.clientId,a),this.httpRetryConfig=d,this._resolution=l}startChannelMediaRelay(i){var r=this;return L(function*(){if(r.state!==sr.RELAY_STATE_IDLE)throw new W(k.INVALID_OPERATION);r.state=sr.RELAY_STATE_CONNECTING,yield r.connect(),I.debug("[".concat(r.clientId,"] startChannelMediaRelay: connect success"));try{yield r.sendStartRelayMessage(i)}catch(a){throw a.data&&a.data.serverResponse&&"SetSourceChannel"===a.data.serverResponse.command?new W(k.CROSS_CHANNEL_FAILED_JOIN_SRC):a.data&&a.data.serverResponse&&"SetDestChannelStatus"===a.serverResponse.command?new W(k.CROSS_CHANNEL_FAILED_JOIN_DEST):a.data&&a.data.serverResponse&&"StartPacketTransfer"===a.serverResponse.command?new W(k.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):a}r.prevChannelMediaConfig=i})()}updateChannelMediaRelay(i){var r=this;return L(function*(){if(r.state!==sr.RELAY_STATE_RUNNING)throw new W(k.INVALID_OPERATION);yield r.sendUpdateMessage(i),r.prevChannelMediaConfig=i})()}setVideoProfile(i){var r=this;return L(function*(){if(r._resolution=i,r.state!==sr.RELAY_STATE_RUNNING)throw new W(k.INVALID_OPERATION);const a=r.genMessage(Ci.SetVideoProfile);yield r.signal.request(a),I.debug("[".concat(r.clientId,"] startChannelMediaRelay: setVideoProfile success"))})()}stopChannelMediaRelay(){var i=this;return L(function*(){yield i.sendStopRelayMessage(),I.debug("[".concat(i.clientId,"] stopChannelMediaRelay: send stop message success")),i.state=sr.RELAY_STATE_IDLE,i.dispose()})()}dispose(){I.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Ze.CancelToken.source(),this.state=sr.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}connect(){var i=this;return L(function*(){const r=yield function g2(s,i,r){return BT.apply(this,arguments)}(i.joinInfo,i.cancelToken.token,i.httpRetryConfig);i.workerToken=r.workerToken,yield i.signal.connect(r.addressList),i.emit("event",vi.NETWORK_CONNECTED),i.signal.on("status",i.onStatus),i.signal.on("reconnecting",i.onReconnect)})()}sendStartRelayMessage(i){var r=this;return L(function*(){const a=r.genMessage(Ci.StopPacketTransfer);yield r.signal.request(a),yield r.signal.waitStatus("Normal Quit"),I.debug("[".concat(r.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const d=r.genMessage(Ci.SetSdkProfile,i);yield r.signal.request(d),I.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const l=r.genMessage(Ci.SetSourceChannel,i);yield r.signal.request(l),yield r.signal.waitStatus("SetSourceChannelStatus"),r.emit("event",vi.PACKET_JOINED_SRC_CHANNEL),I.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const h=r.genMessage(Ci.SetSourceUserId,i);yield r.signal.request(h),I.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const f=r.genMessage(Ci.SetDestChannel,i);yield r.signal.request(f),yield r.signal.waitStatus("SetDestChannelStatus"),r.emit("event",vi.PACKET_JOINED_DEST_CHANNEL),I.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetDestChannel success"));const _=r.genMessage(Ci.StartPacketTransfer,i);yield r.signal.request(_),r.emit("event",vi.PACKET_SENT_TO_DEST_CHANNEL),r.state=sr.RELAY_STATE_RUNNING,I.debug("[".concat(r.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),r.setVideoProfile(r._resolution)})()}sendUpdateMessage(i){var r=this;return L(function*(){const a=r.genMessage(Ci.UpdateDestChannel,i);yield r.signal.request(a),r.emit("event",vi.PACKET_UPDATE_DEST_CHANNEL),I.debug("[".concat(r.clientId,"] sendUpdateMessage: UpdateDestChannel success"))})()}sendStopRelayMessage(){var i=this;return L(function*(){const r=i.genMessage(Ci.StopPacketTransfer);yield i.signal.request(r),I.debug("[".concat(i.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))})()}genMessage(i,r){const a=[],d=[],l=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Ao,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.20.0"===h.sdkVersion&&(h.sdkVersion="0.0.1");let f=null,_=null;switch(i){case Ci.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case Ci.SetSourceChannel:if(_=r&&r.getSrcChannelMediaInfo(),!_)throw new W(k.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:_.channelName,token:_.token||this.joinInfo.appId},h;case Ci.SetSourceUserId:if(_=r&&r.getSrcChannelMediaInfo(),!_)throw new W(k.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:_.uid+""},h;case Ci.SetDestChannel:if(f=r&&r.getDestChannelMediaInfo(),!f)throw new W(k.UNEXPECTED_ERROR,"can not find dest config");return f.forEach(g=>{a.push(g.channelName),d.push(g.uid+""),l.push(g.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:a,uid:d,token:l},h;case Ci.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case Ci.Reconnect:return h.clientRequest={command:"Reconnect"},h;case Ci.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case Ci.UpdateDestChannel:if(f=r&&r.getDestChannelMediaInfo(),!f)throw new W(k.UNEXPECTED_ERROR,"can not find dest config");return f.forEach(g=>{a.push(g.channelName),d.push(g.uid+""),l.push(g.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:a,uid:d,token:l},h;case Ci.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}function mb(s){var i={},r=!1;function a(d,l){return r=!0,{done:!1,value:new F0(l=new sb(function(h){h(s[d](l))}),1)}}return i[void 0!==Ls&&jS||"@@iterator"]=function(){return this},i.next=function(d){return r?(r=!1,d):a("next",d)},"function"==typeof s.throw&&(i.throw=function(d){if(r)throw r=!1,d;return a("throw",d)}),"function"==typeof s.return&&(i.return=function(d){return r?(r=!1,d):a("return",d)}),i}var W0=Rt(bF);function _b(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function v_(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?_b(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):_b(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function gb(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function RP(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?gb(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):gb(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class pi extends Cv{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(i=>i.rtpMap&&i.rtpMap.encodingName.toLowerCase()||"").filter(i=>{var r;return ye(r=Object.keys(xc)).call(r,i)}))]}constructor(i,r){super(i,r),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"remoteSDP",void 0),C(this,"initialOffer",void 0),C(this,"statsFilter",void 0),C(this,"useRTX",!1),C(this,"localCapabilities",void 0),C(this,"localCandidateCount",0),C(this,"allCandidatesReceived",!1),C(this,"establishPromise",void 0),C(this,"mutex",new gi("P2PConnection-mutex")),this.store=r,this.peerConnection=new RTCPeerConnection(pi.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.statsFilter=xp(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,Pt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(){var i=this;return L(function*(){try{const r=yield i.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=qs(r.sdp),d=_a(r.sdp,{filterRTX:!i.useRTX,filterVideoFec:B("FILTER_VIDEO_FEC"),filterAudioFec:B("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return i.localCapabilities=d,i.initialOffer=r,RP(RP({},a),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:d},offerSDP:r.sdp})}catch(r){throw new ee(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}})()}connect(i,r,a,d,l,h){var f=this;return L(function*(){try{if(!f.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");f.remoteSDP=new class{constructor(g){C(this,"sessionDesc",void 0),C(this,"localCapabilities",void 0),C(this,"rtpCapabilities",void 0),C(this,"candidates",void 0),C(this,"iceParameters",void 0),C(this,"dtlsParameters",void 0),C(this,"setup",void 0),C(this,"currentMidIndex",void 0),C(this,"cname",void 0),g=Ft(g);const{remoteIceParameters:v,remoteDtlsParameters:b,candidates:y,remoteRTPCapabilities:T,remoteSetup:M,localCapabilities:O,sdkCodec:D,cname:x}=g,F=Xt.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=T,this.candidates=y,this.iceParameters=v,this.dtlsParameters=b,this.setup=M,this.localCapabilities=O,this.cname=x;for(let j=0;j<F.mediaDescriptions.length;j++){const Y=F.mediaDescriptions[j];if(Y.attributes.iceUfrag=v.iceUfrag,Y.attributes.icePwd=v.icePwd,Y.attributes.fingerprints=b.fingerprints,Y.attributes.candidates=y,Y.attributes.setup=M,"video"===Y.media.mediaType){Y.media.fmts=T.videoCodecs.map(K=>K.payloadType.toString(10));let te=T.videoCodecs.filter(K=>{var Q,$;return null===(Q=K.rtpMap)||void 0===Q?void 0:ye($=Q.encodingName.toLowerCase()).call($,D)});0===te.length&&(te=T.videoCodecs),Y.attributes.payloads=te,Y.attributes.extmaps=T.videoExtensions}"audio"===Y.media.mediaType&&(Y.media.fmts=T.audioCodecs.map(te=>te.payloadType.toString(10)),Y.attributes.payloads=T.audioCodecs,Y.attributes.extmaps=T.audioExtensions),F.mediaDescriptions[j]=this.mungMediaDesc(Y)}this.sessionDesc=F,this.currentMidIndex=F.mediaDescriptions.length-1}toString(){return Xt.print(this.sessionDesc)}send(g,v,b){const{ssrcs:y,ssrcGroups:T}=Hi(v,this.cname),M=this.sessionDesc.mediaDescriptions.find(x=>g===Se.VIDEO?"video"===x.media.mediaType:"audio"===x.media.mediaType),O=y[0].attributes.label,D=y[0].attributes.mslabel;return M.attributes.ssrcs=M.attributes.ssrcs.concat(y),M.attributes.ssrcGroups=M.attributes.ssrcGroups.concat(T),{id:O,mslabel:D}}batchSend(g){return g.map(v=>{let{kind:b,ssrcMsg:y}=v;return this.send(b,y,void 0)})}stopSending(g){this.sessionDesc.mediaDescriptions.forEach(v=>{const b=[],y=[],T=[];v.attributes.ssrcs.forEach(M=>{ye(g).call(g,M.attributes.label||"")?T.push(M):b.push(M)}),v.attributes.ssrcGroups.forEach(M=>{var O;ye(O=T.map(D=>D.ssrcId)).call(O,M.ssrcIds[0])||y.push(M)}),v.attributes.ssrcs=b,v.attributes.ssrcGroups=y})}mute(g){const v=this.sessionDesc.mediaDescriptions.find(b=>b.attributes.mid===g);if(!v)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.mute."));v.attributes.direction="inactive"}unmute(g){const v=this.sessionDesc.mediaDescriptions.find(b=>b.attributes.mid===g);if(!v)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.unmute."));v.attributes.direction="sendonly"}receive(g,v,b){g.forEach((y,T)=>{const M=y._mediaStreamTrack,O=this.sessionDesc.mediaDescriptions.findIndex(x=>x.attributes.mid===M.kind),D=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[O],y);this.sessionDesc.mediaDescriptions[O]=D})}stopReceiving(g){}updateCandidates(g){g===Mi.TCP?this.candidates.forEach(v=>{-1===this.candidates.findIndex(b=>"tcp"===b.transport&&b.connectionAddress===v.connectionAddress&&b.port===v.port)&&this.candidates.push(v_(v_({},v),{},{foundation:"tcpcandidate",priority:Number(v.priority)-1+"",transport:"tcp",port:Number(v.port)+90+""}))}):this.candidates=this.candidates.filter(v=>"tcp"!==v.transport);for(const v of this.sessionDesc.mediaDescriptions)v.attributes.candidates=this.candidates}restartICE(g){g=Ft(g),this.iceParameters=g,this.sessionDesc.mediaDescriptions.forEach(v=>{v.attributes.iceUfrag=g.iceUfrag,v.attributes.icePwd=g.icePwd})}predictReceivingMids(g){const v=[];for(let b=0;b<g;b++)v.push((this.currentMidIndex+b+1).toString(10));return v}mungRecvMediaDsec(g,v){const b=Ft(g);return Jd(b,v),f_(b,v),b}updateRecvMedia(g,v){const b=this.sessionDesc.mediaDescriptions.findIndex(y=>y.attributes.mid===g);if(-1!==b){const y=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[b],v);this.sessionDesc.mediaDescriptions[b]=y}}bumpMid(g){this.currentMidIndex+=g}updateTrackLabel(g,v,b){const y=this.sessionDesc.mediaDescriptions.find(M=>g===Se.VIDEO?"video"===M.attributes.mid:"audio"===M.attributes.mid);if(y){const M=y.attributes.ssrcs.find(O=>O.attributes.label===v);var T;M&&(M.attributes.label=b,null===(T=M.attributes.msid)||void 0===T||T.replace(v,b))}}mungMediaDesc(g){const v=Ft(g);return ub(v),function(b){const y=b.attributes.extmaps.find(T=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===T.extensionName);y&&b.attributes.extmaps.splice(b.attributes.extmaps.indexOf(y),1),b.attributes.payloads.forEach(T=>{const M=T.rtcpFeedbacks.findIndex(O=>"transport-cc"===O.type);-1!==M&&T.rtcpFeedbacks.splice(M,1)})}(v),v}getSSRC(g){for(const v of this.sessionDesc.mediaDescriptions)for(const b of v.attributes.ssrcs)if(b.attributes.label===g)return[b]}}({remoteIceParameters:i,remoteDtlsParameters:r,candidates:a,remoteRTPCapabilities:d.send,remoteSetup:l,localCapabilities:f.localCapabilities,sdkCodec:f.store.codec,cname:h});const _=f.remoteSDP.toString();yield f.peerConnection.setLocalDescription(f.initialOffer),yield f.peerConnection.setRemoteDescription({type:"answer",sdp:_})}catch(_){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(_.toString()))}})()}updateRemoteRTPCapabilities(i,r){return L(function*(){throw new ee(k.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")})()}send(i,r){var a=this;return Xr(function*(){const d=yield Be(a.mutex.lock());try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const l=i.map(y=>a.peerConnection.addTrack(y._mediaStreamTrack)),h=yield Be(a.peerConnection.createOffer()),f=Xt.parse(h.sdp),_=i.map(y=>{const T=y._mediaStreamTrack,M=f.mediaDescriptions.find(O=>O.attributes.mid===T.kind);if(!M)throw new Error("Cannot extract ssrc from mediaDescription.");return function(O,D,x){const F=O.attributes.ssrcs.filter(Y=>Y.attributes.label===D),j=O.attributes.ssrcGroups;if(0===F.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(j&&F.length>1){const Y=j.find(te=>-1!==te.ssrcIds.indexOf(F[0].ssrcId));return Y?[{ssrcId:Y.ssrcIds[0],rtx:x?Y.ssrcIds[1]:void 0}]:[{ssrcId:F[0].ssrcId}]}return[{ssrcId:F[0].ssrcId}]}(M,T.id,a.useRTX)});let g;try{g=yield _}catch(y){throw l.forEach(T=>{fr()&&T.replaceTrack(null),a.peerConnection.removeTrack(T)}),y}const v=a.mungSendOfferSDP(h.sdp,i);a.remoteSDP.receive(i,r,g);const b=a.remoteSDP.toString();return yield Be(a.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Be(a.applySendEncodings(l,i)),yield Be(a.peerConnection.setRemoteDescription({type:"answer",sdp:b})),i.map((y,T)=>({localSSRC:_[T],id:y._mediaStreamTrack.id}))}catch(l){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{d()}})()}stopSending(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const a=r.peerConnection.getSenders().filter(h=>{var f;return-1!==i.indexOf((null===(f=h.track)||void 0===f?void 0:f.id)||"")});if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");a.map(h=>{fr()&&h.replaceTrack(null),r.peerConnection.removeTrack(h)});const d=yield r.peerConnection.createOffer();yield r.peerConnection.setLocalDescription(d),r.remoteSDP.stopReceiving(i);const l=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(a.toString()))}})()}receive(i,r,a,d){var l=this;return L(function*(){try{if(!l.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{id:h,mslabel:f}=l.remoteSDP.send(i,r,d),_=new X((b,y)=>{const T=setTimeout(()=>{y(new Error("Cannot receive track, id: ".concat(h)))},1e4),M=O=>{const D=lt();if(("Safari"===D.name&&11===Number(D.version)||Pi())&&O.track.id!==h&&O.streams[0].id===f){var x;const F=O.streams[0].getTracks()[0];return null===(x=l.remoteSDP)||void 0===x||x.updateTrackLabel(i,h,O.track.id),l.peerConnection.removeEventListener("track",M),clearTimeout(T),void b(F)}if(O.track.id===h)return l.peerConnection.removeEventListener("track",M),clearTimeout(T),void b(O.track)};l.peerConnection.addEventListener("track",M)}),g=l.remoteSDP.toString();yield l.peerConnection.setRemoteDescription({type:"offer",sdp:g});const v=yield l.peerConnection.createAnswer();return yield l.peerConnection.setLocalDescription(v),{track:yield _,id:h}}catch(h){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}stopReceiving(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.remoteSDP.stopSending(i);const a=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield r.peerConnection.createAnswer();yield r.peerConnection.setLocalDescription(d)}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}})()}muteRemote(i){return L(function*(){})()}unmuteRemote(i){return L(function*(){})()}muteLocal(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const a=r.peerConnection.getSenders().filter(d=>{var l;return-1!==i.indexOf((null===(l=d.track)||void 0===l?void 0:l.id)||"")});if(a.length!==i.length)throw new Error("sender' length doesn't match mids' length.");a.map(d=>{if(fr()&&d.track)d.track.enabled=!1;else{const l=d.getParameters();l.encodings.forEach(h=>h.active=!1),d.setParameters(l)}})}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(a.toString()))}})()}unmuteLocal(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const a=r.peerConnection.getSenders().filter(h=>{var f;return-1!==i.indexOf((null===(f=h.track)||void 0===f?void 0:f.id)||"")});if(a.length!==i.length)throw new Error("Senders' length doesn't match mids' length.");a.map(function(){var h=L(function*(f){if(fr()&&f.track)f.track.enabled=!0;else{const _=f.getParameters();_.encodings.forEach(g=>g.active=!0),yield f.setParameters(_)}});return function(f){return h.apply(this,arguments)}}());const d=yield r.peerConnection.createOffer();yield r.peerConnection.setLocalDescription(d);const l=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(a.toString()))}})()}restartICE(i){var r=this;return Xr(function*(){const a=yield Be(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ot().supportPCSetConfiguration){const _=r.peerConnection.getConfiguration(),g=i===Mi.RELAY?"relay":"all";_.iceTransportPolicy!==g&&(I.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_.iceTransportPolicy,"] to [").concat(g,"]")),_.iceTransportPolicy=g,r.peerConnection.setConfiguration(_))}else if(i===Mi.RELAY)return;i!==Mi.RELAY&&r.remoteSDP.updateCandidates(i);const d=yield Be(r.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const l=qs(d.sdp),{remoteIceParameters:h}=yield l.iceParameters;r.remoteSDP.restartICE(h);const f=r.remoteSDP.toString();yield Be(r.peerConnection.setLocalDescription(d)),yield Be(r.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(d){I.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),d)}finally{a()}})()}close(){var i;this.peerConnection.close(),null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}updateEncoderConfig(i,r){var a=this;return L(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const d=yield a.peerConnection.createOffer(),l=a.mungSendOfferSDP(d.sdp,[r]);a.remoteSDP.updateRecvMedia(r._mediaStreamTrack.kind,r);const h=a.remoteSDP.toString();yield a.peerConnection.setLocalDescription({type:"offer",sdp:l}),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(d){throw new ee(k.EXCHANGE_SDP_FAILED,d.toString())}})()}updateSendParameters(i,r){var a=this;return L(function*(){const d=a.peerConnection.getSenders().filter(l=>{var h;return(null===(h=l.track)||void 0===h?void 0:h.id)===i});1===d.length&&(yield a.applySendEncodings(d,[r]))})()}setStatsRemoteVideoIsReady(i,r){this.statsFilter.setVideoIsReady2(i,r)}replaceTrack(i,r){var a=this;return L(function*(){const d=a.peerConnection.getSenders().find(l=>{var h;return(null===(h=l.track)||void 0===h?void 0:h.id)===r});d&&(yield d.replaceTrack(i._mediaStreamTrack))})()}createDataChannels(i,r){throw new ee(k.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(i){throw new ee(k.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;null===(i=this.onICEConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},B("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const r={iceServers:[],sdpSemantics:"plan-b"};return i.iceServers?r.iceServers=i.iceServers:i.turnServer&&"off"!==i.turnServer.mode&&(oa(i.turnServer.servers)?r.iceServers=i.turnServer.servers:(r.iceServers&&r.iceServers.push(...pi.turnServerConfigToIceServers(i.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&i.turnServer.serversFromGateway&&r.iceServers.push(...pi.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(i){const r=[];return i.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}updateRtpSenderEncodings(i,r){var a=this;return L(function*(){var d;if(r||(r=a.peerConnection.getSenders().find(v=>{var b;return(null===(b=v.track)||void 0===b?void 0:b.id)===i._mediaStreamTrack.id})),!r)return I.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(!Ot().supportSetRtpSenderParameters)return I.warn("Browser not support set rtp-sender parameters");const l={},h={};if(i instanceof je)switch(i._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;default:l.degradationPreference="balanced"}if(B("DSCP_TYPE")&&Rd()){var f;const v=B("DSCP_TYPE");ye(f=["very-low","low","medium","high"]).call(f,v)&&(h.networkPriority=v)}const _=r.getParameters(),g=null===(d=_.encodings)||void 0===d?void 0:d[0];g&&Object.assign(g,h),Object.assign(_,l),I.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),yield r.setParameters(_)})()}applySendEncodings(i,r){var a=this;return L(function*(){try{if(!Ot().supportSetRtpSenderParameters||i.length!==r.length)return;for(let d=0;d<i.length;d++){const l=i[d],h=r[d];l&&h&&(yield a.updateRtpSenderEncodings(h,l))}}catch{I.debug("[".concat(a.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(i,r){const a=Xt.parse(i);return r.forEach((d,l)=>{const h=d._mediaStreamTrack,f=a.mediaDescriptions.find(_=>_.attributes.mid===h.kind);f&&Jd(f,d)}),Xt.print(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,r,a)=>{var d;null===(d=this.onFirstVideoDecoded)||void 0===d||d.call(this,i,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,i,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}batchReceive(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const a=r.remoteSDP.batchSend(i).map((h,f)=>{let{id:_,mslabel:g}=h;const{kind:v}=i[f];return new X((b,y)=>{const T=setTimeout(()=>{y(new Error("Cannot receive track, id: ".concat(_)))},1e4),M=O=>{const D=lt();if("Safari"===D.name&&11===Number(D.version)&&O.track.id!==_&&O.streams[0].id===g){var x;const F=O.streams[0].getTracks()[0];return null===(x=r.remoteSDP)||void 0===x||x.updateTrackLabel(v,_,O.track.id),r.peerConnection.removeEventListener("track",M),clearTimeout(T),void b({track:F,id:_})}if(O.track.id===_)return r.peerConnection.removeEventListener("track",M),clearTimeout(T),void b({track:O.track,id:_})};r.peerConnection.addEventListener("track",M)})}),d=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"offer",sdp:d});const l=yield r.peerConnection.createAnswer();return yield r.peerConnection.setLocalDescription(l),yield X.all(a)}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}})()}getRemoteSSRC(i){var r=this;return L(function*(){if(!r.remoteSDP)return;const a=r.remoteSDP.getSSRC(i);return a?.[0].ssrcId})()}setConfiguration(i){if(Ot().supportPCSetConfiguration){const r=pi.resolvePCConfiguration(i);this.peerConnection.setConfiguration(r)}}}function Ss(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=L(function*(){const d=this.mutex,l=yield d.lock("Locking from P2PConnection.".concat(i));try{for(var h=arguments.length,f=new Array(h),_=0;_<h;_++)f[_]=arguments[_];return yield a.apply(this,f)}finally{l()}}),r}function AP(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function tl(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?AP(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):AP(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}ne([Ss,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",X)],pi.prototype,"connect",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],pi.prototype,"stopSending",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",X)],pi.prototype,"receive",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],pi.prototype,"stopReceiving",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],pi.prototype,"muteRemote",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],pi.prototype,"unmuteRemote",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],pi.prototype,"muteLocal",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],pi.prototype,"unmuteLocal",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],pi.prototype,"close",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[String,Bi]),N("design:returntype",X)],pi.prototype,"updateEncoderConfig",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[String,Bi]),N("design:returntype",X)],pi.prototype,"updateSendParameters",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[Bi,String]),N("design:returntype",X)],pi.prototype,"replaceTrack",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],pi.prototype,"getRemoteSSRC",null);function DP(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Pu(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?DP(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):DP(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class Jt extends Cv{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var i,r;return null!==(i=null===(r=this.peerConnection.getReceivers()[0])||void 0===r||null===(r=r.transport)||void 0===r?void 0:r.state)&&void 0!==i?i:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(i=>i.rtpMap&&i.rtpMap.encodingName.toLowerCase()||"").filter(i=>{var r;return ye(r=Object.keys(xc)).call(r,i)}))]}constructor(i,r){super(i,r),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"remoteSDP",void 0),C(this,"initialOffer",void 0),C(this,"transportEventReceiver",void 0),C(this,"statsFilter",void 0),C(this,"useXR",B("USE_XR")),C(this,"localCapabilities",void 0),C(this,"remoteCodecs",void 0),C(this,"localCandidateCount",0),C(this,"allCandidatesReceived",!1),C(this,"dataStreamChannelMap",new Map),C(this,"establishPromise",void 0),C(this,"mutex",new gi("P2PConnection-mutex")),this.store=r,this.peerConnection=new RTCPeerConnection(Jt.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.statsFilter=xp(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,Pt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}updateRemoteRTPCapabilities(i,r){var a=this;return L(function*(){if(a.remoteCodecs=r,a.remoteSDP)if(a.remoteSDP.updateRemoteCodec(i,r,a.store.codec)){const d=yield a.peerConnection.createOffer(),l=a.logSDPExchange(d.sdp||"","offer","local","muteLocal");yield a.peerConnection.setLocalDescription(d);const h=a.remoteSDP.toString();l?.(h),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}else I.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else I.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(a.localCodecs,", codecs: ").concat(r))})()}establish(){var i=this;return L(function*(){try{i.peerConnection.addTransceiver("video",{direction:"recvonly"}),i.peerConnection.addTransceiver("audio",{direction:"recvonly"});const r=yield i.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=qs(r.sdp),d=yield Qd({filterRTX:!B("USE_PUB_RTX")&&!B("USE_SUB_RTX"),filterVideoFec:B("FILTER_VIDEO_FEC"),filterAudioFec:B("FILTER_AUDIO_FEC"),filterVideoCodec:B("FILTER_VIDEO_CODEC")},{useXR:i.useXR});return i.localCapabilities=ri(d),i.initialOffer=r,Pu(Pu({},a),{},{rtpCapabilities:d,offerSDP:r.sdp})}catch(r){throw new ee(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}})()}connect(i,r,a,d,l,h){var f=this;return L(function*(){try{if(!f.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");f.remoteSDP=new class{get localCapabilities(){return Ft(this._localCapabilities)}get rtpCapabilities(){return Ft(this._rtpCapabilities)}get candidates(){return Ft(this._candidates)}get iceParameters(){return Ft(this._iceParameters)}get dtlsParameters(){return Ft(this._dtlsParameters)}constructor(M){C(this,"sessionDesc",void 0),C(this,"_localCapabilities",void 0),C(this,"_rtpCapabilities",void 0),C(this,"_candidates",void 0),C(this,"_iceParameters",void 0),C(this,"_dtlsParameters",void 0),C(this,"setup",void 0),C(this,"currentMidIndex",void 0),C(this,"cname",void 0),C(this,"firefoxSsrcMidMap",new Map),M=Ft(M);const{remoteIceParameters:O,remoteDtlsParameters:D,candidates:x,remoteRTPCapabilities:F,remoteSetup:j,localCapabilities:Y,cname:te}=M,K=Xt.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n");this._rtpCapabilities=F,this._candidates=x,this._iceParameters=O,this._dtlsParameters=D,this._localCapabilities=Y,this.setup=j,this.cname=te;const Q=this.rtpCapabilities.send;for(const $ of K.mediaDescriptions){if($.attributes.iceUfrag=O.iceUfrag,$.attributes.icePwd=O.icePwd,$.attributes.fingerprints=D.fingerprints,$.attributes.candidates=x,$.attributes.setup=j,"video"===$.media.mediaType&&($.media.fmts=Q.videoCodecs.map(q=>q.payloadType.toString(10)),$.attributes.payloads=Q.videoCodecs,$.attributes.extmaps=Q.videoExtensions,B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:q,ssrcGroups:ge}=Hi([{ssrcId:4e4,rtx:B("USE_SUB_RTX")?40001:void 0}],this.cname);$.attributes.ssrcs=q,$.attributes.ssrcGroups=ge}if("audio"===$.media.mediaType&&($.media.fmts=Q.audioCodecs.map(q=>q.payloadType.toString(10)),$.attributes.payloads=Q.audioCodecs,$.attributes.extmaps=Q.audioExtensions,ga($),B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:q,ssrcGroups:ge}=Hi([{ssrcId:2e4}],this.cname);$.attributes.ssrcs=q,$.attributes.ssrcGroups=ge}}this.sessionDesc=K,this.currentMidIndex=K.mediaDescriptions.length-1}preloadRemoteMedia(){const M=B("PRELOAD_MEDIA_COUNT"),O=this.candidates,D=this.dtlsParameters,x=this.iceParameters,F=this.rtpCapabilities.send;for(let j=1;j<M;j++){const Y=2*j+2e4,te=2*j+4e4,{ssrcs:K,ssrcGroups:Q}=Hi([{ssrcId:Y}],this.cname),{ssrcs:$,ssrcGroups:q}=Hi([{ssrcId:te,rtx:B("USE_SUB_RTX")?te+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:F.videoCodecs.map(ge=>ge.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:x.iceUfrag,icePwd:x.icePwd,unrecognized:[],candidates:O,extmaps:F.videoExtensions,fingerprints:D.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:$,ssrcGroups:q,rtcpFeedbackWildcards:[],payloads:F.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*j)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:F.audioCodecs.map(ge=>ge.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:x.iceUfrag,icePwd:x.icePwd,unrecognized:[],candidates:O,extmaps:F.audioExtensions,fingerprints:D.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:K,ssrcGroups:Q,rtcpFeedbackWildcards:[],payloads:F.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*j+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Xt.print(this.sessionDesc)}send(M,O,D,x){const{ssrcs:F,ssrcGroups:j}=Hi(O,this.cname,B("SYNC_GROUP")?D:void 0),Y=this.findPreloadMediaDesc(F);if(Y){if(Pt()&&this.firefoxSsrcMidMap.set(F[0].ssrcId,Y.attributes.mid),x&&(x.twcc||x.remb)){const te=this.sessionDesc.mediaDescriptions.indexOf(Y);return this.sessionDesc.mediaDescriptions[te]=this.mungSendMediaDesc(Y,x),{mid:Y.attributes.mid,needExchangeSDP:!0}}return{mid:Y.attributes.mid,needExchangeSDP:!1}}{const te=this.findAvailableMediaIndex(M,F);let K;return-1===te||1===te&&(fr()||FL())||0===te&&B("USE_SUB_RTX")||DD()?(K=this.createOrRecycleSendMedia(M,F,j,"sendonly",x),this.updateBundleMids()):(K=Ft(this.sessionDesc.mediaDescriptions[te]),K.attributes.direction="sendonly",K.attributes.ssrcs=F,K.attributes.ssrcGroups=j,this.sessionDesc.mediaDescriptions[te]=this.mungSendMediaDesc(K,x)),Pt()&&this.firefoxSsrcMidMap.set(F[0].ssrcId,K.attributes.mid),{mid:K.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:M,needExchangeSDP:O}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:M.attributes.mid,needExchangeSDP:O}}batchSend(M){const O=M.map(F=>{let{kind:j,ssrcMsg:Y,mslabel:te}=F;return this.send(j,Y,te)}),D=[];let x=!1;return O.forEach(F=>{let{mid:j,needExchangeSDP:Y}=F;Y&&(x=!0),D.push(j)}),{mids:D,needExchangeSDP:x}}stopSending(M){const O=this.sessionDesc.mediaDescriptions.filter(D=>D.attributes.mid&&-1!==M.indexOf(D.attributes.mid));if(O.length!==M.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");O.forEach(D=>{"0"===D.attributes.mid||Pt()||DD()?D.attributes.ssrcs=[]:(D.attributes.ssrcs=[],D.attributes.direction="inactive",D.media.port="0")}),this.updateBundleMids()}mute(M){const O=this.sessionDesc.mediaDescriptions.find(D=>D.attributes.mid===M);if(!O)throw new Error("mediaDescription not found with ".concat(M," in remote SDP when calling RemoteSDP.mute."));O.attributes.direction="inactive"}unmute(M){const O=this.sessionDesc.mediaDescriptions.find(D=>D.attributes.mid===M);if(!O)throw new Error("mediaDescription not found with ".concat(M," in remote SDP when calling RemoteSDP.unmute."));O.attributes.direction="sendonly"}muteRemote(M){const O=this.sessionDesc.mediaDescriptions.filter(D=>ye(M).call(M,D.attributes.mid||""));if(O.length!==M.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");O.forEach(D=>{D.attributes.direction="inactive"})}unmuteRemote(M){const O=this.sessionDesc.mediaDescriptions.filter(D=>ye(M).call(M,D.attributes.mid||""));if(O.length!==M.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");O.forEach(D=>{D.attributes.direction="recvonly"})}receive(M,O,D,x){M.forEach((F,j)=>{this.createOrRecycleRecvMedia(F,[],"recvonly",O,D,x[j])}),this.updateBundleMids()}stopReceiving(M){const O=this.sessionDesc.mediaDescriptions.filter(D=>-1!==M.indexOf(D.attributes.mid));if(O.length!==M.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");O.forEach(D=>{D.media.port="0",D.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(M){const O=this._candidates.filter(D=>"udp"===D.transport);if(M===Mi.TCP){if(0===O.length)return;if(B("TCP_CANDIDATE_ONLY")){const D=this._candidates.filter(x=>"tcp"===x.transport);O.forEach(x=>{-1===D.findIndex(F=>F.connectionAddress===x.connectionAddress)&&D.push(tl(tl({},x),{},{foundation:"tcpcandidate",priority:Number(x.priority)-1+"",transport:"tcp",port:Number(x.port)+90+""}))}),this._candidates=D}else{const D=[];O.forEach(x=>{D.push(tl(tl({},x),{},{foundation:"tcpcandidate",priority:Number(x.priority)-1+"",transport:"tcp",port:Number(x.port)+90+""}))}),this._candidates=[...O,...D]}}else if(M===Mi.RELAY){if(0!==O.length)return;{const D=this._candidates.filter(x=>"tcp"===x.transport);D.forEach(x=>{O.push(tl(tl({},x),{},{foundation:"udpcandidate",priority:Number(x.priority)+1+"",transport:"udp",port:Number(x.port)-90+""}))}),this._candidates=[...O,...D]}}else 0===O.length?(this._candidates.filter(D=>"tcp"===D.transport).forEach(D=>{O.push(tl(tl({},D),{},{foundation:"udpcandidate",priority:Number(D.priority)+1+"",transport:"udp",port:Number(D.port)-90+""}))}),this._candidates=O):this._candidates=this._candidates.filter(D=>"tcp"!==D.transport);for(const D of this.sessionDesc.mediaDescriptions)D.attributes.candidates=this.candidates}restartICE(M){M=Ft(M),this._iceParameters=M,this.sessionDesc.mediaDescriptions.forEach(O=>{O.attributes.iceUfrag=M.iceUfrag,O.attributes.icePwd=M.icePwd})}predictReceivingMids(M){const O=[];for(let D=0;D<M;D++)O.push((this.currentMidIndex+D+1).toString(10));return O}findAvailableMediaIndex(M,O){return this.sessionDesc.mediaDescriptions.findIndex(D=>{const x=D.media.mediaType===M&&"0"!==D.media.port&&("sendonly"===D.attributes.direction||"sendrecv"===D.attributes.direction)&&0===D.attributes.ssrcs.length;if(Pt()){if(x){const F=this.firefoxSsrcMidMap.get(O[0].ssrcId);return!(F||"0"!==D.attributes.mid&&"1"!==D.attributes.mid)||!(!F||F!==D.attributes.mid)}return!1}return x})}createOrRecycleDataChannel(){for(const D of this.sessionDesc.mediaDescriptions)if("application"===D.media.mediaType)return{mediaDesc:D,needExchangeSDP:!1};this.currentMidIndex+=1;const M="".concat(this.currentMidIndex),O={media:{mediaType:"application",port:"9",protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(M),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(O),{mediaDesc:O,needExchangeSDP:!0}}createOrRecycleRecvMedia(M,O,D,x,F,j){const Y=M._mediaStreamTrack.kind,te=this.rtpCapabilities.recv,K=Du(Y,te,this.localCapabilities.send,Y===Se.VIDEO?x:F),Q=Y===Se.VIDEO?te.videoExtensions:te.audioExtensions;this.currentMidIndex+=1;const $="".concat(this.currentMidIndex);let q={media:{mediaType:Y,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:K.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Q,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:O,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:K,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:D,rtcpMux:!0,rtcpRsize:!0,mid:"".concat($)}};q=this.mungRecvMediaDsec(q,M,j);const ge=this.findFirstClosedMedia(Y);if(ge){const _e=this.sessionDesc.mediaDescriptions.indexOf(ge);this.sessionDesc.mediaDescriptions[_e]=q}else this.sessionDesc.mediaDescriptions.push(q);return q}updateRemoteCodec(M,O,D){const x=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(q=>q.rtpMap&&q.rtpMap.encodingName.toLowerCase()||"").filter(q=>{var ge;return ye(ge=Object.keys(xc)).call(ge,q)}))],F=new Set(O);if(x.every(q=>F.has(q)))return I.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(O)),!1;const j=this._rtpCapabilities.recv.videoCodecs.filter(q=>O.some(ge=>{var _e;return ye(_e=q.rtpMap&&q.rtpMap.encodingName.toLowerCase()||"").call(_e,ge)}));if(0===j.length)return I.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(x," codecs: ").concat(O)),!1;const Y=[...new Set(j.map(q=>q.rtpMap&&q.rtpMap.encodingName.toLowerCase()||""))];let te;if(I.debug("updateRemoteCodec, from ".concat(x," to ").concat(Y)),0===M.length)te=this.sessionDesc.mediaDescriptions.filter(q=>"video"===q.media.mediaType&&"recvonly"===q.attributes.direction);else if(te=this.sessionDesc.mediaDescriptions.filter(q=>q.attributes.mid&&ye(M).call(M,q.attributes.mid)&&"recvonly"===q.attributes.direction),te.length!==M.length)return I.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(M,", codecs: ").concat(O)),!1;this._rtpCapabilities.recv.videoCodecs=j;const $=Du(Se.VIDEO,this.rtpCapabilities.recv,this.localCapabilities.send,D);return te.forEach(q=>{const ge=$.map(_e=>_e.payloadType.toString(10));I.debug("updateRemoteCodec mid: ".concat(q.attributes.mid,", from ").concat(q.attributes.payloads," to ").concat($)),q.attributes.payloads=$,q.media.fmts=ge}),!0}createOrRecycleSendMedia(M,O,D,x,F){const j=this.rtpCapabilities.send,Y=M===Se.VIDEO?j.videoCodecs:j.audioCodecs,te=M===Se.VIDEO?j.videoExtensions:j.audioExtensions;this.currentMidIndex+=1;const K="".concat(this.currentMidIndex);let Q={media:{mediaType:M,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:Y.map(q=>q.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:te,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:O,ssrcGroups:D,rtcpFeedbackWildcards:[],payloads:Y,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:x,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(K)}};Q=this.mungSendMediaDesc(Q,F);const $=this.findFirstClosedMedia(M);if($){const q=this.sessionDesc.mediaDescriptions.indexOf($);this.sessionDesc.mediaDescriptions[q]=Q}else this.sessionDesc.mediaDescriptions.push(Q);return Q}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(M=>"0"!==M.media.port).map(M=>M.attributes.mid)}mungRecvMediaDsec(M,O,D){const x=Ft(M);return ub(x),Jd(x,O),f_(x,O),j0(x),Au(x,D,this.localCapabilities.send),x}mungSendMediaDesc(M,O){const D=Ft(M);return Au(D,O,this.localCapabilities.recv),ga(D),D}updateRecvMedia(M,O){const D=this.sessionDesc.mediaDescriptions.findIndex(x=>x.attributes.mid===M);if(-1!==D){const x=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[D],O);this.sessionDesc.mediaDescriptions[D]=x}}bumpMid(M){this.currentMidIndex+=M}findFirstClosedMedia(M){return this.sessionDesc.mediaDescriptions.find(O=>Pt()?"0"===O.media.port&&O.media.mediaType===M:"0"===O.media.port)}findPreloadMediaDesc(M){return this.sessionDesc.mediaDescriptions.find(O=>{var D;return(null===(D=O.attributes)||void 0===D||null===(D=D.ssrcs[0])||void 0===D?void 0:D.ssrcId)===M[0].ssrcId})}getSSRC(M){var O;return null===(O=this.sessionDesc.mediaDescriptions.find(D=>D.attributes.mid===M))||void 0===O?void 0:O.attributes.ssrcs}}({remoteIceParameters:i,remoteDtlsParameters:r,candidates:a,remoteRTPCapabilities:d,remoteSetup:l,localCapabilities:f.localCapabilities,cname:h}),Array.isArray(f.remoteCodecs)&&f.remoteCodecs.length>0&&f.remoteSDP.updateRemoteCodec([],f.remoteCodecs,f.store.codec);const _=f.remoteSDP.toString(),g=Xt.parse(f.initialOffer.sdp),v=g.mediaDescriptions.find(M=>"audio"===M.media.mediaType);v&&ga(v),f.useXR&&m_(g);const b=Xt.print(g),y=f.logSDPExchange(b||"","offer","local","connect");f.store.descriptionStart(),yield f.peerConnection.setLocalDescription({type:"offer",sdp:b}),y?.(_),yield f.peerConnection.setRemoteDescription({type:"answer",sdp:_});const T=f.peerConnection.getTransceivers()[0];if(null!=T&&T.receiver&&f.tryBindTransportEvents(T.receiver),B("PRELOAD_MEDIA_COUNT")>0){f.remoteSDP.preloadRemoteMedia();const M=f.remoteSDP.toString();yield f.peerConnection.setRemoteDescription({type:"offer",sdp:M});const O=yield f.peerConnection.createAnswer();yield f.peerConnection.setLocalDescription(O)}}catch(_){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(_.toString()))}})()}send(i,r,a){var d=this;return Xr(function*(){const l=yield Be(d.mutex.lock("From P2PConnection.send"));try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[];i.forEach(O=>{const D=d.peerConnection.addTransceiver(O._mediaStreamTrack,{direction:"sendonly"});h.push(D),O._updateRtpTransceiver(D)}),Pt()&&!0===B("SIMULCAST")&&(yield Be(d.applySimulcastForFirefox(h,i)));const f=yield Be(d.peerConnection.createOffer()),_=d.remoteSDP.predictReceivingMids(i.length),g=d.mungSendOfferSDP(f.sdp,i,_),v=Xt.parse(g),b=_.map(O=>{const D=v.mediaDescriptions.find(x=>x.attributes.mid===O);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return lb(D,B("USE_PUB_RTX"))});let y;try{y=yield b}catch(O){y=[],d.remoteSDP.receive(i,r,a,y);const D=d.remoteSDP.toString();throw yield Be(d.peerConnection.setLocalDescription({type:"offer",sdp:g})),yield Be(d.peerConnection.setRemoteDescription({type:"answer",sdp:D})),yield Be(d.stopSending(_,!0)),O}d.remoteSDP.receive(i,r,a,y);const T=d.remoteSDP.toString(),M=d.logSDPExchange(g,"offer","local","send");return yield Be(d.peerConnection.setLocalDescription({type:"offer",sdp:g})),yield Be(d.applySimulcastEncodings(h,i)),yield Be(d.applySendEncodings(h,i)),M?.(T),yield Be(d.peerConnection.setRemoteDescription({type:"answer",sdp:T})),h.map((O,D)=>({localSSRC:b[D],id:_[D],transceiver:O}))}catch(h){throw h instanceof ee?h:new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{l()}})()}createDataChannels(i,r){var a=this;return L(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let d=a.dataStreamChannelMap.get(i);d&&"open"===d.readyState?I.debug("[P2PConnection] Channels are already available and can be reused directly."):(d=a.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:B("DATASTREAM_MAX_RETRANSMITS")}),d.binaryType="arraybuffer",a.dataStreamChannelMap.set(i,d)),r.forEach(h=>{h._updateOriginDataChannel(d)});const{needExchangeSDP:l}=a.remoteSDP.sendDataChannel();if(l){const h=a.remoteSDP.toString();yield a.peerConnection.setRemoteDescription({type:"offer",sdp:h});const f=yield a.peerConnection.createAnswer();yield a.peerConnection.setLocalDescription(f),I.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else I.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(d){throw d instanceof ee?d:new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(d.toString()))}})()}stopDataChannels(i){var r=this;return L(function*(){try{const a=r.dataStreamChannelMap.get(i);return a?.close(),void r.dataStreamChannelMap.delete(i)}catch(a){throw a instanceof ee?a:new ee(k.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(a.toString()))}})()}stopSending(i,r){var a=this;return L(function*(){const d=r?void 0:yield a.mutex.lock("From P2PConnection.stopSending");try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const l=a.peerConnection.getTransceivers().filter(g=>-1!==i.indexOf(g.mid));if(l.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");l.map(g=>{var v;g.direction="inactive",null===(v=g.stop)||void 0===v||v.call(g)});const h=yield a.peerConnection.createOffer(),f=a.logSDPExchange(h.sdp||"","offer","local","stopSending");yield a.peerConnection.setLocalDescription(h),a.remoteSDP.stopReceiving(i);const _=a.remoteSDP.toString();f?.(_),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:_})}catch(l){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(l.toString()))}finally{d&&d()}})()}receive(i,r,a,d){var l=this;return L(function*(){try{if(!l.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{mid:h,needExchangeSDP:f}=l.remoteSDP.send(i,r,a,d);if(f){const g=l.remoteSDP.toString(),v=l.logSDPExchange(g,"offer","remote","receive");yield l.peerConnection.setRemoteDescription({type:"offer",sdp:g});const b=yield l.peerConnection.createAnswer(),y=l.mungReceiveAnswerSDP(b.sdp,h,i);v?.(y||""),yield l.peerConnection.setLocalDescription({type:"answer",sdp:y}),I.debug("[".concat(l.store.clientId,"] [P2PConnection] receive ").concat(i," by exchanging SDP."))}else I.debug("[".concat(l.store.clientId,"] [P2PConnection] receive ").concat(i," no need to exchange SDP."));const _=l.peerConnection.getTransceivers().find(g=>g.mid===h);if(!_)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:_.receiver.track,id:h,transceiver:_}}catch(h){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}batchReceive(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:a,needExchangeSDP:d}=r.remoteSDP.batchSend(i);if(d){const l=r.remoteSDP.toString(),h=r.logSDPExchange(l,"offer","remote","receive");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:l});const f=yield r.peerConnection.createAnswer();h?.(f.sdp||""),yield r.peerConnection.setLocalDescription(f),I.debug("[".concat(r.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else I.debug("[".concat(r.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return a.map(l=>{const h=r.peerConnection.getTransceivers().find(f=>f.mid===l);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:l,transceiver:h}})}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}})()}stopReceiving(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.remoteSDP.stopSending(i);const a=r.remoteSDP.toString(),d=r.logSDPExchange(a,"offer","remote","stopReceiving");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const l=yield r.peerConnection.createAnswer();d?.(l.sdp||""),yield r.peerConnection.setLocalDescription(l)}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}})()}muteRemote(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(i," before remote SDP created."));r.remoteSDP.mute(i);const a=r.remoteSDP.toString(),d=r.logSDPExchange(a,"offer","remote","muteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const l=yield r.peerConnection.createAnswer();d?.(l.sdp||""),yield r.peerConnection.setLocalDescription(l)}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(a.toString()))}})()}unmuteRemote(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(i," before remote SDP created."));r.remoteSDP.unmute(i);const a=r.remoteSDP.toString(),d=r.logSDPExchange(a,"offer","remote","unmuteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const l=yield r.peerConnection.createAnswer();d?.(l.sdp||""),yield r.peerConnection.setLocalDescription(l)}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(a.toString()))}})()}muteLocal(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(f=>f.mid&&-1!==i.indexOf(f.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(f=>{f.direction="inactive"});const d=yield r.peerConnection.createOffer(),l=r.logSDPExchange(d.sdp||"","offer","local","muteLocal");yield r.peerConnection.setLocalDescription(d),r.remoteSDP.muteRemote(i);const h=r.remoteSDP.toString();l?.(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(a.toString()))}})()}unmuteLocal(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(f=>f.mid&&-1!==i.indexOf(f.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(function(){var f=L(function*(_,g){_.direction="sendonly"});return function(_,g){return f.apply(this,arguments)}}());const d=yield r.peerConnection.createOffer(),l=r.logSDPExchange(d.sdp||"","offer","local","unmuteLocal");yield r.peerConnection.setLocalDescription(d),r.remoteSDP.unmuteRemote(i);const h=r.remoteSDP.toString();l?.(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(a.toString()))}})()}restartICE(i){var r=this;return Xr(function*(){const a=yield Be(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ot().supportPCSetConfiguration){const g=r.peerConnection.getConfiguration(),v=i===Mi.RELAY?"relay":"all";g.iceTransportPolicy!==v&&(I.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(g.iceTransportPolicy,"] to [").concat(v,"]")),g.iceTransportPolicy=v,r.peerConnection.setConfiguration(g))}else if(i===Mi.RELAY)return;r.remoteSDP.updateCandidates(i);const d=yield Be(r.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const l=qs(d.sdp),{remoteIceParameters:h}=yield l.iceParameters;r.remoteSDP.restartICE(h);const f=r.remoteSDP.toString(),_=r.logSDPExchange(d.sdp||"","offer","local","restartICE");r.store.descriptionStart(),yield Be(r.peerConnection.setLocalDescription(d)),_?.(f),yield Be(r.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(d){I.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),d)}finally{a()}})()}close(){var i;this.peerConnection.close(),null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}updateEncoderConfig(i,r){var a=this;return L(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const d=yield a.peerConnection.createOffer(),l=a.mungSendOfferSDP(d.sdp,[r],[i]);a.remoteSDP.updateRecvMedia(i,r);const h=a.remoteSDP.toString(),f=a.logSDPExchange(l,"offer","local","updateEncoderConfig");yield a.peerConnection.setLocalDescription({type:"offer",sdp:l}),f?.(h),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(d){throw new ee(k.EXCHANGE_SDP_FAILED,d.toString())}})()}updateSendParameters(i,r){var a=this;return L(function*(){const d=a.peerConnection.getTransceivers().filter(l=>l.mid===i);1===d.length&&(a.isVP8Simulcast(r)?Pt()||(yield a.applySimulcastEncodings(d,[r])):yield a.applySendEncodings(d,[r]))})()}setStatsRemoteVideoIsReady(i,r){this.statsFilter.setVideoIsReady2(i,r)}replaceTrack(i,r){var a=this;return L(function*(){const d=a.peerConnection.getTransceivers().find(l=>l.mid===r);d&&(yield d.sender.replaceTrack(i._mediaStreamTrack))})()}getSelectedCandidatePair(){var i=this;return L(function*(){const r=i.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const a=r[0].transport.iceTransport,{local:d,remote:l}=a.getSelectedCandidatePair();return{local:Pu(Pu({},$a),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port}),remote:Pu(Pu({},$a),{},{candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port})}}return i.statsFilter.getSelectedCandidatePair()})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;null===(i=this.onICEConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},B("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const r={iceServers:[]};return i.iceServers?r.iceServers=i.iceServers:i.turnServer&&"off"!==i.turnServer.mode&&(oa(i.turnServer.servers)?r.iceServers=i.turnServer.servers:(r.iceServers&&r.iceServers.push(...Jt.turnServerConfigToIceServers(i.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&i.turnServer.serversFromGateway&&r.iceServers.push(...Jt.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),B("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),B("ENABLE_ENCODED_TRANSFORM")&&Ot().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(i){const r=[];return i.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Bd(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!B("FORCE_TURN_TCP")&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}tryBindTransportEvents(i){const r=i.transport;if(r){this.transportEventReceiver=i,r.onstatechange=()=>{var d;null!=r&&r.state&&(null===(d=this.onDTLSTransportStateChange)||void 0===d||d.call(this,r.state))},r.onerror=d=>{var l;null===(l=this.onDTLSTransportError)||void 0===l||l.call(this,"error"in d?d.error:d)};const a=r.iceTransport;a&&(a.onstatechange=()=>{const d=r?.iceTransport.state;var l;d&&(null===(l=this.onICETransportStateChange)||void 0===l||l.call(this,d))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){const{local:d,remote:l}=a.getSelectedCandidatePair();I.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol}),", remote ").concat(JSON.stringify({candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(i,r){var a=this;return L(function*(){var d;if(r||(r=a.peerConnection.getSenders().find(b=>b.track===i._mediaStreamTrack)),!r)return I.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(a.isVP8Simulcast(i))return I.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ot().supportSetRtpSenderParameters)return I.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const l={},h={};switch(i._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;default:l.degradationPreference="balanced"}if(i._encoderConfig){var f;const{bitrateMax:b,frameRate:y,scaleResolutionDownBy:T}=i._encoderConfig;b&&(h.maxBitrate=1e3*b),(ye(f=i._hints).call(f,kt.LOW_STREAM)||i.isUseScaleResolutionDownBy)&&(y&&(h.maxFramerate=No(y)),T&&T>=1&&(h.scaleResolutionDownBy=T))}if(B("DSCP_TYPE")&&Rd()){var _;const b=B("DSCP_TYPE");ye(_=["very-low","low","medium","high"]).call(_,b)&&(h.networkPriority=b)}const g=r.getParameters(),v=null===(d=g.encodings)||void 0===d?void 0:d[0];Pt()&&!v&&(l.encodings=[h]),v&&Object.assign(v,h),Object.assign(g,l),I.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),yield r.setParameters(g)})()}applySendEncodings(i,r){var a=this;return L(function*(){try{if(!Ot().supportSetRtpSenderParameters||i.length!==r.length)return;for(let d=0;d<i.length;d++){const l=i[d],h=r[d];h instanceof je&&!a.isVP8Simulcast(h)&&(yield a.updateRtpSenderEncodings(h,l.sender))}}catch{I.debug("[".concat(a.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(i,r,a){const d=Xt.parse(i);return r.forEach((l,h)=>{const f=a[h],_=d.mediaDescriptions.find(g=>g.attributes.mid===f);_&&(Jd(_,l),kp(_,l,this.store.codec))}),Xt.print(d)}mungReceiveAnswerSDP(i,r,a){const d=Xt.parse(i),l=d.mediaDescriptions.find(h=>h.attributes.mid===r);return l&&(a===Se.AUDIO&&"audio"===l.media.mediaType&&ga(l),this.useXR&&m_(d)),Xt.print(d)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,r,a)=>{var d;null===(d=this.onFirstVideoDecoded)||void 0===d||d.call(this,i,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var r;null===(r=this.onFirstVideoDecodedTimeout)||void 0===r||r.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(i,r){var a=this;return L(function*(){if(i.length===r.length)for(let g=0;g<i.length;g++){var d,l,h,f,_;const v=i[g],b=r[g];if(b instanceof je&&!ye(d=b._hints).call(d,kt.LOW_STREAM)&&null!==(l=b._encoderConfig)&&void 0!==l&&l.bitrateMax&&(null===(h=b._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(f=b._scalabilityMode)&&void 0!==f&&f.numSpatialLayers&&(null===(_=b._scalabilityMode)||void 0===_?void 0:_.numSpatialLayers)>1&&"vp8"===a.store.codec){const y={},T={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};y.encodings=[{rid:"m",active:!0,maxBitrate:T.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:T.high}];const M=v.sender.getParameters();yield v.sender.setParameters(Object.assign(M,y))}}})()}applySimulcastEncodings(i,r){var a=this;return L(function*(){if(!Pt()&&i.length===r.length)for(let d=0;d<i.length;d++){const l=r[d];if(l instanceof je&&a.isVP8Simulcast(l)){const h=i[d],f={},_={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:_.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:_.medium,scaleResolutionDownBy:4}];const g=h.sender.getParameters();yield h.sender.setParameters(Object.assign(g,f))}}})()}isVP8Simulcast(i){var r,a,d,l,h;return!!(i instanceof je&&B("SIMULCAST")&&"vp8"===this.store.codec&&!ye(r=i._hints).call(r,kt.LOW_STREAM)&&null!==(a=i._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(d=i._encoderConfig)||void 0===d?void 0:d.bitrateMax)>200&&null!==(l=i._scalabilityMode)&&void 0!==l&&l.numSpatialLayers&&(null===(h=i._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(i,r,a,d){if(B("SDP_LOGGING"))return I.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(r," SDP during P2PConnection.").concat(d,"\n"),i),"offer"===r?l=>{this.logSDPExchange(l,"answer","local"===a?"remote":"local",d)}:void 0}getRemoteSSRC(i){var r=this;return L(function*(){if(!r.remoteSDP)return;const a=r.remoteSDP.getSSRC(i);return a?.[0].ssrcId})()}setConfiguration(i){if(Ot().supportPCSetConfiguration){const r=Jt.resolvePCConfiguration(i);this.peerConnection.setConfiguration(r)}}}function dr(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=L(function*(){const d=this.mutex,l=yield d.lock("From P2PConnection.".concat(i));try{for(var h=arguments.length,f=new Array(h),_=0;_<h;_++)f[_]=arguments[_];return yield a.apply(this,f)}finally{l()}}),r}function OP(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function NP(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?OP(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):OP(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}ne([dr,N("design:type",Function),N("design:paramtypes",[Array,Array]),N("design:returntype",X)],Jt.prototype,"updateRemoteRTPCapabilities",null),ne([dr,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",X)],Jt.prototype,"connect",null),ne([dr,N("design:type",Function),N("design:paramtypes",[Object,Array]),N("design:returntype",X)],Jt.prototype,"createDataChannels",null),ne([dr,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",X)],Jt.prototype,"receive",null),ne([dr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],Jt.prototype,"batchReceive",null),ne([dr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],Jt.prototype,"stopReceiving",null),ne([dr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],Jt.prototype,"muteRemote",null),ne([dr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],Jt.prototype,"unmuteRemote",null),ne([dr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],Jt.prototype,"muteLocal",null),ne([dr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],Jt.prototype,"unmuteLocal",null),ne([dr,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Jt.prototype,"close",null),ne([dr,N("design:type",Function),N("design:paramtypes",[String,Bi]),N("design:returntype",X)],Jt.prototype,"updateEncoderConfig",null),ne([dr,N("design:type",Function),N("design:paramtypes",[String,Bi]),N("design:returntype",X)],Jt.prototype,"updateSendParameters",null),ne([dr,N("design:type",Function),N("design:paramtypes",[Bi,String]),N("design:returntype",X)],Jt.prototype,"replaceTrack",null),ne([dr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],Jt.prototype,"getRemoteSSRC",null);const Eb="v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0\na=msid-semantic: WMS\na=ice-lite\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 127.0.0.1\na=mid:0\n";class VF{get localCapabilities(){return Ft(this._localCapabilities)}get rtpCapabilities(){return Ft(this._rtpCapabilities)}get candidates(){return Ft(this._candidates)}get iceParameters(){return Ft(this._iceParameters)}get dtlsParameters(){return Ft(this._dtlsParameters)}constructor(i){C(this,"sessionDesc",void 0),C(this,"_localCapabilities",void 0),C(this,"_rtpCapabilities",void 0),C(this,"_candidates",void 0),C(this,"_iceParameters",void 0),C(this,"_dtlsParameters",void 0),C(this,"setup",void 0),C(this,"currentMidIndex",void 0),C(this,"cname",void 0),C(this,"firefoxSsrcMidMap",new Map),i=Ft(i);const{remoteIceParameters:r,remoteDtlsParameters:a,candidates:d,remoteRTPCapabilities:l,remoteSetup:h,localCapabilities:f,cname:_}=i,g=Xt.parse(Eb);this._rtpCapabilities=l,this._candidates=d,this._iceParameters=r,this._dtlsParameters=a,this._localCapabilities=f,this.setup=h,this.cname=_;const v=this.rtpCapabilities.send;for(const b of g.mediaDescriptions){if(b.attributes.iceUfrag=r.iceUfrag,b.attributes.icePwd=r.icePwd,b.attributes.fingerprints=a.fingerprints,b.attributes.candidates=d,b.attributes.setup=h,"application"===b.media.mediaType&&(b.attributes.sctpPort="5000"),"video"===b.media.mediaType&&(b.media.fmts=v.videoCodecs.map(y=>y.payloadType.toString(10)),b.attributes.payloads=v.videoCodecs,b.attributes.extmaps=v.videoExtensions,B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:y,ssrcGroups:T}=Hi([{ssrcId:4e4,rtx:B("USE_SUB_RTX")?40001:void 0}],this.cname);b.attributes.ssrcs=y,b.attributes.ssrcGroups=T}if("audio"===b.media.mediaType&&(b.media.fmts=v.audioCodecs.map(y=>y.payloadType.toString(10)),b.attributes.payloads=v.audioCodecs,b.attributes.extmaps=v.audioExtensions,ga(b),B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:y,ssrcGroups:T}=Hi([{ssrcId:2e4}],this.cname);b.attributes.ssrcs=y,b.attributes.ssrcGroups=T}}this.sessionDesc=g,this.currentMidIndex=g.mediaDescriptions.length-1}updateRemoteRTPCapabilities(i){const r=Xt.parse(Eb);this._rtpCapabilities=i;const a=this.rtpCapabilities.send;for(const d of r.mediaDescriptions){if(d.attributes.iceUfrag=this._iceParameters.iceUfrag,d.attributes.icePwd=this._iceParameters.icePwd,d.attributes.fingerprints=this._dtlsParameters.fingerprints,d.attributes.candidates=this._candidates,d.attributes.setup=this.setup,"application"===d.media.mediaType&&(d.attributes.sctpPort="5000"),"video"===d.media.mediaType&&(d.media.fmts=a.videoCodecs.map(l=>l.payloadType.toString(10)),d.attributes.payloads=a.videoCodecs,d.attributes.extmaps=a.videoExtensions,B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:l,ssrcGroups:h}=Hi([{ssrcId:4e4,rtx:B("USE_SUB_RTX")?40001:void 0}],this.cname);d.attributes.ssrcs=l,d.attributes.ssrcGroups=h}if("audio"===d.media.mediaType&&(d.media.fmts=a.audioCodecs.map(l=>l.payloadType.toString(10)),d.attributes.payloads=a.audioCodecs,d.attributes.extmaps=a.audioExtensions,B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:l,ssrcGroups:h}=Hi([{ssrcId:2e4}],this.cname);d.attributes.ssrcs=l,d.attributes.ssrcGroups=h}}this.sessionDesc=r,this.currentMidIndex=r.mediaDescriptions.length-1}preloadRemoteMedia(i){const r=this.candidates,a=this.dtlsParameters,d=this.iceParameters,l=this.rtpCapabilities.send;for(let h=1;h<i;h++){const f=2*h+2e4,_=2*h+4e4,{ssrcs:g,ssrcGroups:v}=Hi([{ssrcId:f}],this.cname),{ssrcs:b,ssrcGroups:y}=Hi([{ssrcId:_,rtx:B("USE_SUB_RTX")?_+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.videoCodecs.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:d.iceUfrag,icePwd:d.icePwd,unrecognized:[],candidates:r,extmaps:l.videoExtensions,fingerprints:a.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:b,ssrcGroups:y,rtcpFeedbackWildcards:[],payloads:l.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.audioCodecs.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:d.iceUfrag,icePwd:d.icePwd,unrecognized:[],candidates:r,extmaps:l.audioExtensions,fingerprints:a.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:g,ssrcGroups:v,rtcpFeedbackWildcards:[],payloads:l.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Xt.print(this.sessionDesc)}send(i,r,a,d){const{ssrcs:l,ssrcGroups:h}=Hi(r,this.cname,B("SYNC_GROUP")?a:void 0),f=this.findPreloadMediaDesc(l);if(f){if(Pt()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,f.attributes.mid),d&&(d.twcc||d.remb)){const _=this.sessionDesc.mediaDescriptions.indexOf(f);return this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(f,d),{mid:f.attributes.mid,needExchangeSDP:!0}}return{mid:f.attributes.mid,needExchangeSDP:!1}}{const _=this.findAvailableMediaIndex(i,l);let g;return-1===_||fr()||Pi()||FL()||0===_&&B("USE_SUB_RTX")?(g=this.createOrRecycleSendMedia(i,l,h,"sendonly",d),this.updateBundleMids()):(g=Ft(this.sessionDesc.mediaDescriptions[_]),g.attributes.direction="sendonly",g.attributes.ssrcs=l,g.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(g,d)),Pt()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,g.attributes.mid),{mid:g.attributes.mid,needExchangeSDP:!0}}}batchSend(i){const r=i.map(l=>{let{kind:h,ssrcMsg:f,mslabel:_}=l;return this.send(h,f,_)}),a=[];let d=!1;return r.forEach(l=>{let{mid:h,needExchangeSDP:f}=l;f&&(d=!0),a.push(h)}),{mids:a,needExchangeSDP:d}}stopSending(i){const r=this.sessionDesc.mediaDescriptions.filter(a=>a.attributes.mid&&-1!==i.indexOf(a.attributes.mid));if(r.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(a=>{"0"===a.attributes.mid||Pt()||fr()||Pi()?a.attributes.ssrcs=[]:(a.attributes.ssrcs=[],a.attributes.direction="inactive",a.media.port="0")}),this.updateBundleMids()}mute(i){const r=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===i);if(!r)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(i){const r=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===i);if(!r)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}muteRemote(i){const r=this.sessionDesc.mediaDescriptions.filter(a=>ye(i).call(i,a.attributes.mid||""));if(r.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(a=>{a.attributes.direction="inactive"})}unmuteRemote(i){const r=this.sessionDesc.mediaDescriptions.filter(a=>ye(i).call(i,a.attributes.mid||""));if(r.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(a=>{a.attributes.direction="recvonly"})}receive(i,r,a,d){i.forEach((l,h)=>{this.createOrRecycleRecvMedia(l,[],"recvonly",r,a,d[h])}),this.updateBundleMids()}stopReceiving(i){const r=this.sessionDesc.mediaDescriptions.filter(a=>-1!==i.indexOf(a.attributes.mid));if(r.length!==i.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(a=>{a.media.port="0",a.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(i){i===Mi.TCP?this._candidates.forEach(r=>{-1===this._candidates.findIndex(a=>"tcp"===a.transport&&a.connectionAddress===r.connectionAddress&&a.port===r.port)&&this._candidates.push(NP(NP({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}):this._candidates=this._candidates.filter(r=>"tcp"!==r.transport);for(const r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}restartICE(i){i=Ft(i),this._iceParameters=i,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=i.iceUfrag,r.attributes.icePwd=i.icePwd})}predictReceivingMids(i){const r=[];for(let a=0;a<i;a++)r.push((this.currentMidIndex+a+1).toString(10));return r}findAvailableMediaIndex(i,r){return this.sessionDesc.mediaDescriptions.findIndex(a=>{const d=a.media.mediaType===i&&"0"!==a.media.port&&("sendonly"===a.attributes.direction||"sendrecv"===a.attributes.direction)&&0===a.attributes.ssrcs.length;if(Pt()){if(d){const l=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(l||"0"!==a.attributes.mid&&"1"!==a.attributes.mid)||!(!l||l!==a.attributes.mid)}return!1}return d})}createOrRecycleRecvMedia(i,r,a,d,l,h){const f=i._mediaStreamTrack.kind,_=this.rtpCapabilities.recv,g=Du(f,_,this.localCapabilities.send,f===Se.VIDEO?d:l),v=f===Se.VIDEO?_.videoExtensions:_.audioExtensions;this.currentMidIndex+=1;const b="".concat(this.currentMidIndex);let y={media:{mediaType:f,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:g.map(M=>M.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:v,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:g,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(b)}};y=this.mungRecvMediaDsec(y,i,h);const T=this.findFirstClosedMedia(f);if(T){const M=this.sessionDesc.mediaDescriptions.indexOf(T);this.sessionDesc.mediaDescriptions[M]=y}else this.sessionDesc.mediaDescriptions.push(y);return y}updateRemoteCodec(i,r,a){const d=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(y=>y.rtpMap&&y.rtpMap.encodingName.toLowerCase()||"").filter(y=>{var T;return ye(T=Object.keys(xc)).call(T,y)}))],l=new Set(r);if(d.every(y=>l.has(y)))return I.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(r)),!1;const h=this._rtpCapabilities.recv.videoCodecs.filter(y=>r.some(T=>{var M;return ye(M=y.rtpMap&&y.rtpMap.encodingName.toLowerCase()||"").call(M,T)}));if(0===h.length)return I.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(d," codecs: ").concat(r)),!1;const f=[...new Set(h.map(y=>y.rtpMap&&y.rtpMap.encodingName.toLowerCase()||""))];let _;if(I.debug("updateRemoteCodec, from ".concat(d," to ").concat(f)),0===i.length)_=this.sessionDesc.mediaDescriptions.filter(y=>"video"===y.media.mediaType&&"recvonly"===y.attributes.direction);else if(_=this.sessionDesc.mediaDescriptions.filter(y=>y.attributes.mid&&ye(i).call(i,y.attributes.mid)&&"recvonly"===y.attributes.direction),_.length!==i.length)return I.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(i,", codecs: ").concat(r)),!1;this._rtpCapabilities.recv.videoCodecs=h;const b=Du(Se.VIDEO,this.rtpCapabilities.recv,this.localCapabilities.send,a);return _.forEach(y=>{const T=b.map(M=>M.payloadType.toString(10));I.debug("updateRemoteCodec mid: ".concat(y.attributes.mid,", from ").concat(y.attributes.payloads," to ").concat(b)),y.attributes.payloads=b,y.media.fmts=T}),!0}createOrRecycleSendMedia(i,r,a,d,l){const h=this.rtpCapabilities.send,f=i===Se.VIDEO?h.videoCodecs:h.audioCodecs,_=i===Se.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const g="".concat(this.currentMidIndex);let v={media:{mediaType:i,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:a,rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:d,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};v=this.mungSendMediaDesc(v,l);const b=this.findFirstClosedMedia(i);if(b){const y=this.sessionDesc.mediaDescriptions.indexOf(b);this.sessionDesc.mediaDescriptions[y]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(i=>"0"!==i.media.port).map(i=>i.attributes.mid)}mungRecvMediaDsec(i,r,a){const d=Ft(i);return ub(d),Jd(d,r),f_(d,r),j0(d),Au(d,a,this.localCapabilities.send),d}mungSendMediaDesc(i,r){const a=Ft(i);return Au(a,r,this.localCapabilities.recv),ga(a),a}updateRecvMedia(i,r){const a=this.sessionDesc.mediaDescriptions.findIndex(d=>d.attributes.mid===i);if(-1!==a){const d=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],r);this.sessionDesc.mediaDescriptions[a]=d}}bumpMid(i){this.currentMidIndex+=i}findFirstClosedMedia(i){return this.sessionDesc.mediaDescriptions.find(r=>Pt()?"0"===r.media.port&&r.media.mediaType===i:"0"===r.media.port)}findPreloadMediaDesc(i){return this.sessionDesc.mediaDescriptions.find(r=>{var a;return(null===(a=r.attributes)||void 0===a||null===(a=a.ssrcs[0])||void 0===a?void 0:a.ssrcId)===i[0].ssrcId})}getSSRC(i){var r;return null===(r=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===i))||void 0===r?void 0:r.attributes.ssrcs}}function PP(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function vb(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?PP(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):PP(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class wi extends Cv{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){let i;return this.localCapabilities&&(i=ri(this.localCapabilities)),[...new Set(i&&i.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var a;return ye(a=Object.keys(xc)).call(a,r)}))]}constructor(i,r,a){super(i,r),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"remoteSDP",void 0),C(this,"initialOffer",void 0),C(this,"transportEventReceiver",void 0),C(this,"statsFilter",void 0),C(this,"useXR",B("USE_XR")),C(this,"localCapabilities",void 0),C(this,"localCandidateCount",0),C(this,"allCandidatesReceived",!1),C(this,"remoteCodecs",void 0),C(this,"dataStreamChannelMap",new Map),C(this,"establishPromise",void 0),C(this,"mutex",new gi("NVExtentionsConnection-mutex")),C(this,"rtcMedia",void 0),this.store=r,this.peerConnection=a,this.statsFilter=xp(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,Pt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(i){var r=this;return L(function*(){try{const a=yield r.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const d=qs(a.sdp),l=yield Qd({filterRTX:!B("USE_PUB_RTX")&&!B("USE_SUB_RTX"),filterVideoFec:B("FILTER_VIDEO_FEC"),filterAudioFec:B("FILTER_AUDIO_FEC"),filterVideoCodec:B("FILTER_VIDEO_CODEC")},{useXR:r.useXR});return r.localCapabilities=l,r.initialOffer=a,vb(vb({},d),{},{rtpCapabilities:l,offerSDP:a.sdp})}catch(a){throw new W(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}})()}connect(i,r,a,d,l,h){var f=this;return L(function*(){try{if(!f.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");f.remoteSDP=new VF({remoteIceParameters:i,remoteDtlsParameters:r,candidates:a,remoteRTPCapabilities:d,remoteSetup:l,localCapabilities:ri(f.localCapabilities),cname:h});const _=f.remoteSDP.toString(),g=Xt.parse(f.initialOffer.sdp),v=g.mediaDescriptions.find(T=>"audio"===T.media.mediaType);v&&ga(v),f.useXR&&m_(g);const b=Xt.print(g),y=f.logSDPExchange(b||"","offer","local","connect");yield f.peerConnection.setLocalDescription({type:"offer",sdp:b}),y?.(_),yield f.peerConnection.setRemoteDescription({type:"answer",sdp:_})}catch(_){throw new W(k.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(_.toString()))}})()}updateRemoteRTPCapabilities(i,r){var a=this;return L(function*(){if(a.remoteCodecs=r,a.remoteSDP)if(a.remoteSDP.updateRemoteCodec(i,r,a.store.codec)){const d=yield a.peerConnection.createOffer(),l=a.logSDPExchange(d.sdp||"","offer","local","muteLocal");yield a.peerConnection.setLocalDescription(d);const h=a.remoteSDP.toString();l?.(h),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}else I.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else I.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(a.localCodecs,", codecs: ").concat(r))})()}updateRemoteConnect(i){var r=this;return L(function*(){var a,d,l,h;null===(a=r.remoteSDP)||void 0===a||a.updateRemoteRTPCapabilities(i),Array.isArray(r.remoteCodecs)&&r.remoteCodecs.length>0&&(null===(h=r.remoteSDP)||void 0===h||h.updateRemoteCodec([],r.remoteCodecs,r.store.codec)),null===(d=r.remoteSDP)||void 0===d||d.preloadRemoteMedia(2);const f=null===(l=r.remoteSDP)||void 0===l?void 0:l.toString();yield r.peerConnection.setRemoteDescription({type:"offer",sdp:f});const _=yield r.peerConnection.createAnswer();yield r.peerConnection.setLocalDescription(_),I.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")})()}send(i,r,a){var d=this;return Xr(function*(){const l=yield Be(d.mutex.lock("From NVExtentionsConnection.send"));try{if(!d.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const h=[];i.forEach(O=>{const D=d.peerConnection.addTransceiver(O._mediaStreamTrack,{direction:"sendonly"});h.push(D)}),Pt()&&!0===B("SIMULCAST")&&(yield Be(d.applySimulcastForFirefox(h,i)));const f=yield Be(d.peerConnection.createOffer()),_=d.remoteSDP.predictReceivingMids(i.length),g=d.mungSendOfferSDP(f.sdp,i,_),v=Xt.parse(g),b=_.map(O=>{const D=v.mediaDescriptions.find(x=>x.attributes.mid===O);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return lb(D,B("USE_PUB_RTX"))});let y;try{y=yield b}catch(O){y=[],d.remoteSDP.receive(i,r,a,y);const D=d.remoteSDP.toString();throw yield Be(d.peerConnection.setLocalDescription({type:"offer",sdp:g})),yield Be(d.peerConnection.setRemoteDescription({type:"answer",sdp:D})),yield Be(d.stopSending(_,!0)),O}d.remoteSDP.receive(i,r,a,y);const T=d.remoteSDP.toString(),M=d.logSDPExchange(g,"offer","local","send");return yield Be(d.peerConnection.setLocalDescription({type:"offer",sdp:g})),yield Be(d.applySimulcastEncodings(h,i)),yield Be(d.applySendEncodings(h,i)),M?.(T),yield Be(d.peerConnection.setRemoteDescription({type:"answer",sdp:T})),h.map((O,D)=>({localSSRC:b[D],id:_[D],transceiver:O}))}catch(h){throw h instanceof W?h:new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(h.toString()))}finally{l()}})()}stopSending(i,r){var a=this;return L(function*(){const d=r?void 0:yield a.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!a.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const l=a.peerConnection.getTransceivers().filter(g=>-1!==i.indexOf(g.mid));if(l.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");l.map(g=>{var v;g.direction="inactive",null===(v=g.stop)||void 0===v||v.call(g)});const h=yield a.peerConnection.createOffer(),f=a.logSDPExchange(h.sdp||"","offer","local","stopSending");yield a.peerConnection.setLocalDescription(h),a.remoteSDP.stopReceiving(i);const _=a.remoteSDP.toString();f?.(_),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:_})}catch(l){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(l.toString()))}finally{d&&d()}})()}createDataChannels(i,r){var a=this;return L(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let d=a.dataStreamChannelMap.get(i);return d&&"open"===d.readyState?I.debug("[P2PConnection] Channels are already available and can be reused directly."):(d=a.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:B("DATASTREAM_MAX_RETRANSMITS")}),d.binaryType="arraybuffer",a.dataStreamChannelMap.set(i,d)),void r.forEach(l=>{l._updateOriginDataChannel(d)})}catch(d){throw d instanceof W?d:new W(k.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(d.toString()))}})()}stopDataChannels(i){var r=this;return L(function*(){try{const a=r.dataStreamChannelMap.get(i);return a?.close(),void r.dataStreamChannelMap.delete(i)}catch(a){throw a instanceof W?a:new W(k.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(a.toString()))}})()}receive(i,r,a,d){var l=this;return L(function*(){try{if(!l.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(i," before remoteSDP created."));const{mid:h,needExchangeSDP:f}=l.remoteSDP.send(i,r,a,d);if(f){const g=l.remoteSDP.toString(),v=l.logSDPExchange(g,"offer","remote","receive");yield l.peerConnection.setRemoteDescription({type:"offer",sdp:g});const b=yield l.peerConnection.createAnswer(),y=l.mungReceiveAnswerSDP(b.sdp,h,i);v?.(y||""),yield l.peerConnection.setLocalDescription({type:"answer",sdp:y}),I.debug("[NVExtentionsConnection] receive ".concat(i," by exchanging SDP."))}else I.debug("[NVExtentionsConnection] receive ".concat(i," no need to exchange SDP."));const _=l.peerConnection.getTransceivers().find(g=>g.mid===h);if(!_)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:_.receiver.track,id:h}}catch(h){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(h.toString()))}})()}batchReceive(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:a,needExchangeSDP:d}=r.remoteSDP.batchSend(i);if(d){const l=r.remoteSDP.toString(),h=r.logSDPExchange(l,"offer","remote","receive");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:l});const f=yield r.peerConnection.createAnswer();h?.(f.sdp||""),yield r.peerConnection.setLocalDescription(f),I.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else I.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return a.map(l=>{const h=r.peerConnection.getTransceivers().find(f=>f.mid===l);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:l}})}catch(a){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(a.toString()))}})()}stopReceiving(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");r.remoteSDP.stopSending(i);const a=r.remoteSDP.toString(),d=r.logSDPExchange(a,"offer","remote","stopReceiving");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const l=yield r.peerConnection.createAnswer();d?.(l.sdp||""),yield r.peerConnection.setLocalDescription(l)}catch(a){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(a.toString()))}})()}muteRemote(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(i," before remote SDP created."));r.remoteSDP.mute(i);const a=r.remoteSDP.toString(),d=r.logSDPExchange(a,"offer","remote","muteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const l=yield r.peerConnection.createAnswer();d?.(l.sdp||""),yield r.peerConnection.setLocalDescription(l)}catch(a){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(a.toString()))}})()}unmuteRemote(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(i," before remote SDP created."));r.remoteSDP.unmute(i);const a=r.remoteSDP.toString(),d=r.logSDPExchange(a,"offer","remote","unmuteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const l=yield r.peerConnection.createAnswer();d?.(l.sdp||""),yield r.peerConnection.setLocalDescription(l)}catch(a){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(a.toString()))}})()}muteLocal(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(f=>f.mid&&-1!==i.indexOf(f.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(f=>{f.direction="inactive"});const d=yield r.peerConnection.createOffer(),l=r.logSDPExchange(d.sdp||"","offer","local","muteLocal");yield r.peerConnection.setLocalDescription(d),r.remoteSDP.muteRemote(i);const h=r.remoteSDP.toString();l?.(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(a.toString()))}})()}unmuteLocal(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(f=>f.mid&&-1!==i.indexOf(f.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(function(){var f=L(function*(_,g){_.direction="sendonly"});return function(_,g){return f.apply(this,arguments)}}());const d=yield r.peerConnection.createOffer(),l=r.logSDPExchange(d.sdp||"","offer","local","unmuteLocal");yield r.peerConnection.setLocalDescription(d),r.remoteSDP.unmuteRemote(i);const h=r.remoteSDP.toString();l?.(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(a.toString()))}})()}restartICE(i){var r=this;return Xr(function*(){const a=yield Be(r.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ot().supportPCSetConfiguration){const g=r.peerConnection.getConfiguration(),v=i===Mi.RELAY?"relay":"all";g.iceTransportPolicy!==v&&(I.debug("restartICE change iceTransportPolicy from [".concat(g.iceTransportPolicy,"] to [").concat(v,"]")),g.iceTransportPolicy=v,r.peerConnection.setConfiguration(g))}else if(i===Mi.RELAY)return;i!==Mi.RELAY&&r.remoteSDP.updateCandidates(i);const d=yield Be(r.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const l=qs(d.sdp),{remoteIceParameters:h}=yield l.iceParameters;r.remoteSDP.restartICE(h);const f=r.remoteSDP.toString(),_=r.logSDPExchange(d.sdp||"","offer","local","restartICE");yield Be(r.peerConnection.setLocalDescription(d)),_?.(f),yield Be(r.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(d){I.warning("restart ICE failed, abort operation",d)}finally{a()}})()}close(){var i;null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}updateEncoderConfig(i,r){var a=this;return L(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const d=yield a.peerConnection.createOffer(),l=a.mungSendOfferSDP(d.sdp,[r],[i]);a.remoteSDP.updateRecvMedia(i,r);const h=a.remoteSDP.toString(),f=a.logSDPExchange(l,"offer","local","updateEncoderConfig");yield a.peerConnection.setLocalDescription({type:"offer",sdp:l}),f?.(h),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(d){throw new W(k.EXCHANGE_SDP_FAILED,d.toString())}})()}updateSendParameters(i,r){var a=this;return L(function*(){const d=a.peerConnection.getTransceivers().filter(l=>l.mid===i);1===d.length&&(a.isVP8Simulcast(r)?Pt()||(yield a.applySimulcastEncodings(d,[r])):yield a.applySendEncodings(d,[r]))})()}setStatsRemoteVideoIsReady(i,r){this.statsFilter.setVideoIsReady2(i,r)}replaceTrack(i,r){var a=this;return L(function*(){const d=a.peerConnection.getTransceivers().find(l=>l.mid===r);d&&(yield d.sender.replaceTrack(i._mediaStreamTrack))})()}getP2PConnectionParams(){var i;if(null===(i=this.peerConnection.currentLocalDescription)||void 0===i||!i.sdp||!this.localCapabilities)throw new Error;return vb(vb({},qs(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;null===(i=this.onICEConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,I.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,I.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},B("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const r={iceServers:[]};return i.iceServers?r.iceServers=i.iceServers:i.turnServer&&"off"!==i.turnServer.mode&&(oa(i.turnServer.servers)?r.iceServers=i.turnServer.servers:(r.iceServers&&r.iceServers.push(...wi.turnServerConfigToIceServers(i.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&i.turnServer.serversFromGateway&&r.iceServers.push(...wi.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),B("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(i){const r=[];return i.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Bd(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!B("FORCE_TURN_TCP")&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}applySendEncodings(i,r){var a=this;return L(function*(){try{if(!Ot().supportSetRtpSenderParameters||i.length!==r.length)return;for(let y=0;y<i.length;y++){const T=i[y],M=r[y];if(M&&M instanceof je){var d,l,h;if(a.isVP8Simulcast(M))continue;const O={},D={};switch(M._optimizationMode){case"motion":O.degradationPreference="maintain-framerate";break;case"detail":O.degradationPreference="maintain-resolution";break;default:O.degradationPreference="balanced"}var f,_,g,v;if(null!==(d=M._encoderConfig)&&void 0!==d&&d.bitrateMax&&(D.maxBitrate=1e3*(null===(f=M._encoderConfig)||void 0===f?void 0:f.bitrateMax)),ye(l=M._hints).call(l,kt.LOW_STREAM)&&(null!==(_=M._encoderConfig)&&void 0!==_&&_.frameRate&&(D.maxFramerate=No(M._encoderConfig.frameRate)),null!==(g=M._encoderConfig)&&void 0!==g&&g.scaleResolutionDownBy&&(null===(v=M._encoderConfig)||void 0===v?void 0:v.scaleResolutionDownBy)>1&&(D.scaleResolutionDownBy=M._encoderConfig.scaleResolutionDownBy)),B("DSCP_TYPE")&&Rd()){var b;const j=B("DSCP_TYPE");ye(b=["very-low","low","medium","high"]).call(b,j)&&(D.networkPriority=j)}const x=T.sender.getParameters(),F=null===(h=x.encodings)||void 0===h?void 0:h[0];Pt()&&!F&&(O.encodings=[D]),F&&Object.assign(F,D),Object.assign(x,O),yield T.sender.setParameters(x)}}}catch{I.debug("Apply RTPSendEncodings failed.")}})()}mungSendOfferSDP(i,r,a){const d=Xt.parse(i);return r.forEach((l,h)=>{const f=a[h],_=d.mediaDescriptions.find(g=>g.attributes.mid===f);_&&(Jd(_,l),kp(_,l,this.store.codec))}),Xt.print(d)}mungReceiveAnswerSDP(i,r,a){const d=Xt.parse(i),l=d.mediaDescriptions.find(h=>h.attributes.mid===r);return l&&a===Se.AUDIO&&"audio"===l.media.mediaType&&ga(l),this.useXR&&m_(d),Xt.print(d)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,r,a)=>{var d;null===(d=this.onFirstVideoDecoded)||void 0===d||d.call(this,i,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var r;null===(r=this.onFirstVideoDecodedTimeout)||void 0===r||r.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(i,r){var a=this;return L(function*(){if(i.length===r.length)for(let g=0;g<i.length;g++){var d,l,h,f,_;const v=i[g],b=r[g];if(b instanceof je&&!ye(d=b._hints).call(d,kt.LOW_STREAM)&&null!==(l=b._encoderConfig)&&void 0!==l&&l.bitrateMax&&(null===(h=b._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(f=b._scalabilityMode)&&void 0!==f&&f.numSpatialLayers&&(null===(_=b._scalabilityMode)||void 0===_?void 0:_.numSpatialLayers)>1&&"vp8"===a.store.codec){const y={},T={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};y.encodings=[{rid:"m",active:!0,maxBitrate:T.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:T.high}];const M=v.sender.getParameters();yield v.sender.setParameters(Object.assign(M,y))}}})()}applySimulcastEncodings(i,r){var a=this;return L(function*(){if(!Pt()&&i.length===r.length)for(let d=0;d<i.length;d++){const l=r[d];if(l instanceof je&&a.isVP8Simulcast(l)){const h=i[d],f={},_={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:_.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:_.medium,scaleResolutionDownBy:4}];const g=h.sender.getParameters();yield h.sender.setParameters(Object.assign(g,f))}}})()}isVP8Simulcast(i){var r,a,d,l,h;return!!(i instanceof je&&B("SIMULCAST")&&"vp8"===this.store.codec&&!ye(r=i._hints).call(r,kt.LOW_STREAM)&&null!==(a=i._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(d=i._encoderConfig)||void 0===d?void 0:d.bitrateMax)>200&&null!==(l=i._scalabilityMode)&&void 0!==l&&l.numSpatialLayers&&(null===(h=i._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(i,r,a,d){if(B("SDP_LOGGING"))return I.upload("exchanging ".concat(a," ").concat(r," SDP during NVExtentionsConnection.").concat(d,"\n"),i),"offer"===r?l=>{this.logSDPExchange(l,"answer","local"===a?"remote":"local",d)}:void 0}getRemoteSSRC(i){var r=this;return L(function*(){if(!r.remoteSDP)return;const a=r.remoteSDP.getSSRC(i);return a?.[0].ssrcId})()}setConfiguration(i){if(Ot().supportPCSetConfiguration){const r=wi.resolvePCConfiguration(i);this.peerConnection.setConfiguration(r)}}}function Jr(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=L(function*(){const d=this.mutex,l=yield d.lock("From NVExtentionsConnection.".concat(i));try{for(var h=arguments.length,f=new Array(h),_=0;_<h;_++)f[_]=arguments[_];return yield a.apply(this,f)}finally{l()}}),r}function MP(s){var i,r,a,d=2;for(typeof Symbol<"u"&&(r=W0,a=Symbol.iterator);d--;){if(r&&null!=(i=s[r]))return i.call(s);if(a&&null!=(i=s[a]))return new bb(i.call(s));r="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function bb(s){function i(r){if(Object(r)!==r)return X.reject(new TypeError(r+" is not an object."));var a=r.done;return X.resolve(r.value).then(function(d){return{value:d,done:a}})}return(bb=function(r){this.s=r,this.n=r.next}).prototype={s:null,n:null,next:function(){return i(this.n.apply(this.s,arguments))},return:function(r){var a=this.s.return;return void 0===a?X.resolve({value:r,done:!0}):i(a.apply(this.s,arguments))},throw:function(r){var a=this.s.return;return void 0===a?X.reject(r):i(a.apply(this.s,arguments))}},new bb(s)}ne([Jr,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",X)],wi.prototype,"connect",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[Array,Array]),N("design:returntype",X)],wi.prototype,"updateRemoteRTPCapabilities",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],wi.prototype,"updateRemoteConnect",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[Object,Array]),N("design:returntype",X)],wi.prototype,"createDataChannels",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",X)],wi.prototype,"receive",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],wi.prototype,"batchReceive",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],wi.prototype,"stopReceiving",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],wi.prototype,"muteRemote",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],wi.prototype,"unmuteRemote",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],wi.prototype,"muteLocal",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],wi.prototype,"unmuteLocal",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],wi.prototype,"close",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[String,Bi]),N("design:returntype",X)],wi.prototype,"updateEncoderConfig",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[String,Bi]),N("design:returntype",X)],wi.prototype,"updateSendParameters",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[Bi,String]),N("design:returntype",X)],wi.prototype,"replaceTrack",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],wi.prototype,"getRemoteSSRC",null);class Gn extends Cv{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(i,r){super(i,r),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"cname",void 0),C(this,"mutex",new gi("DataChannelConnection-mutex")),C(this,"dataChannel",void 0),C(this,"_p2pConnection",void 0),C(this,"establishPromise",void 0),C(this,"_nvMedia",void 0),this.store=r,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(Gn.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new wi(i,r,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}establish(){var i=this;return L(function*(){var r;const a=null===(r=i._nvMedia)||void 0===r?void 0:r.getLocalRtpCapabilities();return yield i._p2pConnection.establish(a)})()}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}connect(i,r,a,d,l,h){var f=this;return L(function*(){return f.cname=h,yield f._p2pConnection.connect(i,r,a,d,l,h),yield new X((_,g)=>{const v=setTimeout(()=>{f.closeSignal(),g(new W(k.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(a))))},2e3);f.dataChannel.onopen=()=>{if("open"===f.dataChannel.readyState)return clearTimeout(v),void _()},f.dataChannel.onerror=b=>{f.closeSignal(),g(b)}}),{transmitter:f.dataChannel,close:f.closeSignal.bind(f)}})()}updateRemoteRTPCapabilities(i,r){var a=this;return L(function*(){return a._p2pConnection.updateRemoteRTPCapabilities(i,r)})()}send(i,r,a){var d=this;return Xr(function*(){const l=yield Be(d.mutex.lock("From DataChannelConnection.send"));try{return yield*mb(MP(d._p2pConnection.send(i,r,a)))}finally{l()}})()}stopSending(i,r){var a=this;return L(function*(){return a._p2pConnection.stopSending(i,r)})()}createDataChannels(i,r){var a=this;return L(function*(){return a._p2pConnection.createDataChannels(i,r)})()}stopDataChannels(i){var r=this;return L(function*(){return r._p2pConnection.stopDataChannels(i)})()}receive(i,r,a,d){var l=this;return L(function*(){return l._nvMedia?(I.debug("[DataChannelConnection] receive ".concat(i," by DataChannel.")),yield l._nvMedia.reveiveByRTCMedia(i,r,l.cname)):(I.debug("[DataChannelConnection] receive ".concat(i," by WebRTC.")),yield l._p2pConnection.receive(i,r,a,d))})()}batchReceive(i){var r=this;return L(function*(){return[...yield r._p2pConnection.batchReceive(i)]})()}stopReceiving(i){var r=this;return L(function*(){return yield r._p2pConnection.stopReceiving(i)})()}muteRemote(i){var r=this;return L(function*(){return yield r._p2pConnection.muteRemote(i)})()}unmuteRemote(i){var r=this;return L(function*(){return yield r._p2pConnection.unmuteRemote(i)})()}muteLocal(i){var r=this;return L(function*(){return yield r._p2pConnection.muteLocal(i)})()}unmuteLocal(i){var r=this;return L(function*(){return yield r._p2pConnection.unmuteLocal(i)})()}restartICE(i){var r=this;return Xr(function*(){return yield*mb(MP(r._p2pConnection.restartICE(i)))})()}close(){var i;null===(i=this._nvMedia)||void 0===i||i.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(i){return this._p2pConnection.getRemoteVideoIsReady(i)}updateRemoteConnect(i){var r;null===(r=this._nvMedia)||void 0===r||r.setRemoteRtpCapabilities(i),this._p2pConnection.updateRemoteConnect(i)}updateEncoderConfig(i,r){var a=this;return L(function*(){return yield a._p2pConnection.updateEncoderConfig(i,r)})()}updateSendParameters(i,r){var a=this;return L(function*(){return yield a._p2pConnection.updateSendParameters(i,r)})()}setStatsRemoteVideoIsReady(i,r){this._p2pConnection.setStatsRemoteVideoIsReady(i,r)}replaceTrack(i,r){var a=this;return L(function*(){return yield a._p2pConnection.replaceTrack(i,r)})()}getRemoteSSRC(i){var r=this;return L(function*(){return r._p2pConnection.getRemoteSSRC(i)})()}logSDPExchange(i,r,a,d){if(B("SDP_LOGGING"))return I.upload("exchanging ".concat(a," ").concat(r," SDP during DataChannelConnection.").concat(d,"\n"),i),"offer"===r?l=>{this.logSDPExchange(l,"answer","local"===a?"remote":"local",d)}:void 0}static resolvePCConfiguration(i){const r={iceServers:[]};return i.iceServers?r.iceServers=i.iceServers:i.turnServer&&"off"!==i.turnServer.mode&&(oa(i.turnServer.servers)?r.iceServers=i.turnServer.servers:(r.iceServers&&r.iceServers.push(...Gn.turnServerConfigToIceServers(i.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&i.turnServer.serversFromGateway&&r.iceServers.push(...Gn.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),B("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(i){const r=[];return i.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Bd(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!B("FORCE_TURN_TCP")&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=i=>{var r;return null===(r=this.onICEConnectionStateChange)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onConnectionStateChange=i=>{var r;return null===(r=this.onConnectionStateChange)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onDTLSTransportStateChange=i=>{var r;return null===(r=this.onDTLSTransportStateChange)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onDTLSTransportError=i=>{var r;return null===(r=this.onDTLSTransportError)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onICETransportStateChange=i=>{var r;return null===(r=this.onICETransportStateChange)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onFirstAudioReceived=i=>{var r;return null===(r=this.onFirstAudioReceived)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onFirstVideoReceived=i=>{var r;return null===(r=this.onFirstVideoReceived)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onFirstAudioDecoded=i=>{var r;return null===(r=this.onFirstAudioDecoded)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onFirstVideoDecoded=(i,r,a)=>{var d;return null===(d=this.onFirstVideoDecoded)||void 0===d?void 0:d.call(this,i,r,a)},this._p2pConnection.onFirstVideoDecodedTimeout=i=>{var r;return null===(r=this.onFirstVideoDecodedTimeout)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onSelectedLocalCandidateChanged=(i,r)=>{var a;return null===(a=this.onSelectedLocalCandidateChanged)||void 0===a?void 0:a.call(this,i,r)},this._p2pConnection.onSelectedRemoteCandidateChanged=(i,r)=>{var a;return null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a?void 0:a.call(this,i,r)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(i){i.onConnectionStateChange=void 0,i.onICEConnectionStateChange=void 0,i.onICETransportStateChange=void 0,i.onDTLSTransportStateChange=void 0,i.onDTLSTransportError=void 0,i.onFirstAudioDecoded=void 0,i.onFirstAudioReceived=void 0,i.onFirstVideoDecoded=void 0,i.onFirstVideoReceived=void 0,i.onSelectedLocalCandidateChanged=void 0,i.onSelectedRemoteCandidateChanged=void 0,i.onFirstVideoDecodedTimeout=void 0}setConfiguration(i){this._p2pConnection.setConfiguration(i)}}function Qr(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=L(function*(){const d=this.mutex,l=yield d.lock("From DataChannelConnection.".concat(i));try{for(var h=arguments.length,f=new Array(h),_=0;_<h;_++)f[_]=arguments[_];return yield a.apply(this,f)}finally{l()}}),r}function K0(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function nl(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?K0(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):K0(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function BF(s){var i,r,a,d=2;for(typeof Symbol<"u"&&(r=W0,a=Symbol.iterator);d--;){if(r&&null!=(i=s[r]))return i.call(s);if(a&&null!=(i=s[a]))return new yb(i.call(s));r="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function yb(s){function i(r){if(Object(r)!==r)return X.reject(new TypeError(r+" is not an object."));var a=r.done;return X.resolve(r.value).then(function(d){return{value:d,done:a}})}return(yb=function(r){this.s=r,this.n=r.next}).prototype={s:null,n:null,next:function(){return i(this.n.apply(this.s,arguments))},return:function(r){var a=this.s.return;return void 0===a?X.resolve({value:r,done:!0}):i(a.apply(this.s,arguments))},throw:function(r){var a=this.s.return;return void 0===a?X.reject(r):i(a.apply(this.s,arguments))}},new yb(s)}ne([Qr,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",X)],Gn.prototype,"connect",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[Array,Array]),N("design:returntype",X)],Gn.prototype,"updateRemoteRTPCapabilities",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[Object,Array]),N("design:returntype",X)],Gn.prototype,"createDataChannels",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",X)],Gn.prototype,"receive",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],Gn.prototype,"stopReceiving",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],Gn.prototype,"muteRemote",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],Gn.prototype,"unmuteRemote",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],Gn.prototype,"muteLocal",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],Gn.prototype,"unmuteLocal",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Gn.prototype,"close",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[String,Bi]),N("design:returntype",X)],Gn.prototype,"updateEncoderConfig",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[String,Bi]),N("design:returntype",X)],Gn.prototype,"updateSendParameters",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[Bi,String]),N("design:returntype",X)],Gn.prototype,"replaceTrack",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],Gn.prototype,"getRemoteSSRC",null);class si extends jt{get state(){return this._state}set state(i){const r=this._state;this._state=i,this.emit(Oe.StateChange,r,this._state)}constructor(i,r){var a;super(),a=this,C(this,"store",void 0),C(this,"statsUploader",void 0),C(this,"connection",void 0),C(this,"localTrackMap",new Map),C(this,"remoteUserMap",new Map),C(this,"localDataChannels",[]),C(this,"remoteDataChannelMap",new Map),C(this,"pendingLocalTracks",[]),C(this,"pendingRemoteTracks",[]),C(this,"pendingLocalDataChannels",[]),C(this,"pendingRemoteDataChannels",[]),C(this,"statsCollector",void 0),C(this,"isPlanB",!1),C(this,"shouldForwardP2PCreation",void 0),C(this,"iceFailedCount",0),C(this,"dtlsFailedCount",0),C(this,"mutex",new gi("P2PChannel-mutex")),C(this,"_state",Dt.Disconnected),C(this,"_pcStatsUploadType",B("NEW_ICE_RESTART")?Bs.FIRST_CONNECTION:Bs.OLD_FIRST_CONNECTION),C(this,"_isInRestartIce",!1),C(this,"_isStartRestartIce",!1),C(this,"_restartStates",["disconnected","failed"]),C(this,"_restartTimer",void 0),C(this,"_isFirstConnected",!0),C(this,"handleMuteLocalTrack",function(){var d=L(function*(l,h,f){const _=yield a.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!a.connection||a.state!==Dt.Connected)return void f(new ee(k.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const g=a.filterTobeMutedTracks(l);if(0===g.length)return void h();const v=g.find(y=>"videoLowTrack"===y[0]);v&&v[1].track._originMediaStreamTrack.stop(),yield a.connection.muteLocal(g.map(y=>{let[,{id:T}]=y;return T}));const b=a.createMuteMessage(g);yield Tt(a,Oe.RequestMuteLocal,b),h()}catch(g){f(g)}finally{_()}});return function(l,h,f){return d.apply(this,arguments)}}()),C(this,"handleUnmuteLocalTrack",function(){var d=L(function*(l,h,f){const _=yield a.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!a.connection||a.state!==Dt.Connected)return void f(new ee(k.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const g=a.filterTobeUnmutedTracks(l);if(0===g.length)return void h();const v=g.find(y=>"videoLowTrack"===y[0]);if(v){const y=v[1];if(y.track._originMediaStreamTrack.stop(),!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ot().supportDualStreamEncoding){const T=l._mediaStreamTrack.clone();y.track._mediaStreamTrack=T,y.track._originMediaStreamTrack=T}else{const T=Lp(l,mr(a,Oe.RequestLowStreamParameter));y.track._mediaStreamTrack=T,y.track._originMediaStreamTrack=T}yield new X((T,M)=>{a.handleReplaceTrack(y.track,T,M,!0)})}yield a.connection.unmuteLocal(g.map(y=>{let[,{id:T}]=y;return T}));const b=a.createUnmuteMessage(g);yield Tt(a,Oe.RequestUnmuteLocal,b),h()}catch(g){f(g)}finally{_()}});return function(l,h,f){return d.apply(this,arguments)}}()),C(this,"handleUpdateVideoEncoder",function(){var d=L(function*(l,h,f){const _=yield a.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const g=a.localTrackMap.get(re.LocalVideoTrack);if(!a.connection||!g||g.track!==l||a.state!==Dt.Connected)return void h();const{id:v,track:b}=g;yield a.connection.updateSendParameters(v,b),yield a.connection.updateEncoderConfig(v,b),a.emit(Oe.UpdateVideoEncoder,b),h()}catch(g){f(g)}finally{_()}});return function(l,h,f){return d.apply(this,arguments)}}()),C(this,"handleSetOptimizationMode",function(){var d=L(function*(l,h,f){const _=yield a.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const g=a.localTrackMap.get(re.LocalVideoTrack);if(!a.connection||!g||g.track!==l||a.state!==Dt.Connected)return;const{id:v,track:b}=g;yield a.connection.updateSendParameters(v,b),h()}catch(g){f(g)}finally{_()}});return function(l,h,f){return d.apply(this,arguments)}}()),C(this,"handleReplaceTrack",function(){var d=L(function*(l,h,f,_){let g;I.debug("[".concat(a.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(l.getTrackId(),"]")),"boolean"==typeof _&&_||(g=yield a.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var v;const y=Array.from(a.localTrackMap.entries()).find(T=>{let[,{track:M}]=T;return l===M});if(!a.connection||!y||a.state!==Dt.Connected)return void h();if(yield null===(v=a.connection)||void 0===v?void 0:v.replaceTrack(l,y[1].id),a.isPlanB){const T=y[1];T.id=l._mediaStreamTrack.id,a.localTrackMap.set(y[0],T)}if(y[0]===re.LocalVideoTrack&&!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ot().supportDualStreamEncoding){const T=a.localTrackMap.get(re.LocalVideoLowTrack);if(T){const M=l._mediaStreamTrack.clone();T.track._originMediaStreamTrack.stop(),T.track._mediaStreamTrack=M,T.track._originMediaStreamTrack=M,yield new X((O,D)=>{a.handleReplaceTrack(T.track,O,D,!0)})}}h()}catch(y){f(y)}finally{var b;null===(b=g)||void 0===b||b()}});return function(l,h,f,_){return d.apply(this,arguments)}}()),C(this,"handleGetRTCStats",d=>{d(this.statsCollector.getRTCStats())}),C(this,"handleGetLocalVideoStats",d=>{d(this.statsCollector.getLocalVideoTrackStats())}),C(this,"handleGetLocalAudioStats",d=>{d(this.statsCollector.getLocalAudioTrackStats())}),C(this,"handleGetRemoteVideoStats",d=>this.statsCollector.getRemoteVideoTrackStats(d.uid)[d.uid]),C(this,"handleGetRemoteAudioStats",d=>this.statsCollector.getRemoteAudioTrackStats(d.uid)[d.uid]),this.store=i,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new TP(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!Ot().supportUnifiedPlan||B("CHROME_FORCE_PLAN_B")&&Rd(),this.shouldForwardP2PCreation=B("FORWARD_P2P_CREATION")&&Ot().supportPCSetConfiguration&&function(){const d=qE();return d===Zn.ANDROID||d===Zn.IOS||d===Zn.HARMONY_OS}(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Gn({},this.store):this.isPlanB?new pi({},this.store):new Jt({},this.store),this.bindConnectionEvents(this.connection))}startP2PConnection(i,r){var a=this;return L(function*(){var d;a.state=Dt.New;const l=a.shouldForwardP2PCreation&&"closed"===(null===(d=a.connection)||void 0===d?void 0:d.peerConnectionState);if(a.shouldForwardP2PCreation&&!l||(l&&a.connection&&(I.warning("[".concat(a.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),a.connection.close(),a.unbindConnectionEvents(a.connection)),a.connection=a.store.useDataChannel?new Gn(i,a.store):a.isPlanB?new pi(i,a.store):new Jt(i,a.store),a.bindConnectionEvents(a.connection)),!a.connection)throw new ee(k.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return a._pcStatsUploadType=B("NEW_ICE_RESTART")?Bs.FIRST_CONNECTION:Bs.OLD_FIRST_CONNECTION,a._isFirstConnected=!0,a._isInRestartIce=!1,a._isStartRestartIce=!1,a.connection.setConfiguration(i),a.connection.establishPromise})()}connect(i,r,a,d,l,h){var f=this;return L(function*(){if(!f.connection)throw new ee(k.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");f.connection instanceof Gn?f.connection.updateRemoteConnect(d):(f.store.peerConnectionStart(),yield f.connection.connect(i,r,a,d,l,h),f.statsUploader.startUploadTransportStats(),f.statsUploader.startUploadExtensionUsageStats(),f.state=Dt.Connected)})()}updateRemoteRTPCapabilities(i){const r=Array.from(this.localTrackMap.entries()).filter(l=>{var h;let[f]=l;return ye(h=[re.LocalVideoLowTrack,re.LocalVideoTrack]).call(h,f)}),a=r.map(l=>{let[,{id:h}]=l;return h}),d=r.map(l=>{let[h]=l;return h});if(this.connection instanceof Jt){if(Ie.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(d),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(i)}),!ye(i).call(i,this.store.codec)){const l=["vp8","h264"].find(h=>ye(i).call(i,h));l&&(this.store.codec=l,I.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(l,".")))}this.connection.updateRemoteRTPCapabilities(a,i)}}preConnect(i,r,a,d,l,h){var f=this;return L(function*(){if(!f.connection)throw new ee(k.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");f.store.peerConnectionStart();const _=yield f.connection.connect(i,r,a,d,l,h);return f.statsUploader.startUploadTransportStats(),f.statsUploader.startUploadExtensionUsageStats(),f.state=Dt.Connected,_})()}getEstablishParams(){if(this.connection instanceof Gn)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}publishDataChannel(i){var r=this;return L(function*(){if(!r.connection){if(r.state===Dt.Disconnected)throw new ee(k.UNEXPECTED_ERROR,"PeerConnection already disconnected.");const d=i.filter(l=>-1!==r.pendingLocalDataChannels.findIndex(h=>h.id===l.id));return void(r.pendingLocalDataChannels=r.pendingLocalDataChannels.concat(d))}const a=r.filterTobePublishedDataChannels(i);0!==a.length&&(a.forEach(d=>{const l=Date.now();r.store.publish(d.id.toString(),"datachannel",l)}),yield r.connection.createDataChannels(r.store.uid,a),a.forEach(d=>{r.localDataChannels.push(d);const l=Date.now();r.store.publish(d.id+"","datachannel",void 0,l)}))})()}publish(i,r,a){var d=this;return Xr(function*(){const l=yield Be(d.mutex.lock("From P2PChannel.publish"));try{if(!d.connection||d.state!==Dt.Connected){if(d.state===Dt.Disconnected)throw new ee(k.UNEXPECTED_ERROR,"PeerConnection already disconnected.");d.throwIfTrackTypeNotMatch(i);const f=i.filter(_=>-1===d.pendingLocalTracks.indexOf(_));return void(d.pendingLocalTracks=d.pendingLocalTracks.concat(f))}d.store.pubId=d.store.pubId+1,Li.markPublishStart(d.store.clientId,d.store.pubId);const h=d.filterTobePublishedTracks(i,r,a);if(0===h.length)return void(yield Be(d.tryToUnmuteAudio(i)));yield*mb(BF(d.doPublish(d.connection,h)))}finally{l()}})()}doPublish(i,r){var a=this;return Xr(function*(){r.forEach(v=>{let{track:b,type:y}=v;const T=Date.now();a.store.publish(b.getTrackId(),y===re.LocalAudioTrack?"audio":"video",T)}),a.bindLocalTrackEvents(r);const d=yield Be(i.send(r.map(v=>{let{track:b}=v;return b}),a.store.codec,a.store.audioCodec)),l=(yield Be(d.next())).value,h=a.createGatewayPublishMessage(r,l);let f;try{f=yield h}catch(v){throw d.throw(v),v?.code===k.WS_ABORT&&r.forEach(b=>{let{track:y}=b;-1===a.pendingLocalTracks.indexOf(y)&&a.pendingLocalTracks.push(y)}),a.unbindLocalTrackEvents(r),v}const _=a.mapPubResToRemoteConfig(h,f),g=(yield Be(d.next(_))).value;r.forEach(v=>{let{type:b}=v;a.statsCollector.addLocalStats(b)}),a.assignLocalTracks(r,g),a.statsUploader.startUploadOutboundStats(),r.forEach(v=>{let{track:b,type:y}=v;const T=Date.now();a.store.publish(b.getTrackId(),y===re.LocalAudioTrack?"audio":"video",void 0,T)})})()}updateVideoStreamParameter(i,r){var a=this;return L(function*(){const d=a.localTrackMap.get(r);if(!d)return;if(!(d.track instanceof je))return I.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(a.connection instanceof Jt||a.connection instanceof pi))return I.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:l}=d,h=function(f,_){const g={};return f.height&&f.width&&(g.scaleResolutionDownBy=OT(f,_)),g.maxFramerate=f.framerate?No(f.framerate):void 0,g.maxBitrate=f.bitrate?1e3*f.bitrate:void 0,g}(i,l);if(l._encoderConfig||(l._encoderConfig={}),r!==re.LocalVideoLowTrack||!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ot().supportDualStreamEncoding)null!=h.scaleResolutionDownBy&&(l._encoderConfig.scaleResolutionDownBy=h.scaleResolutionDownBy);else{const f=l._originMediaStreamTrack;if(!f.canvas)return I.warn("[".concat(l.getTrackId(),"] no canvas on track"));!function(_,g){const v=_.canvas;g.width&&(v.width=No(g.width)),g.height&&(v.height=No(g.height)),g.framerate&&(v.stopCapture&&v.stopCapture(),v.stopCapture=YT(()=>{!v.startCapture&&v.stopCapture&&v.stopCapture(),v.startCapture&&v.startCapture()},No(g.framerate)))}(f,i)}null!=h.maxBitrate&&(l._encoderConfig.bitrateMax=h.maxBitrate/1e3),null!=h.maxFramerate&&(l._encoderConfig.frameRate&&"object"==typeof l._encoderConfig.frameRate?l._encoderConfig.frameRate.max=h.maxFramerate:l._encoderConfig.frameRate={max:h.maxFramerate}),I.debug("[".concat(l.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(l._encoderConfig))),yield a.connection.updateRtpSenderEncodings(l)})()}publishLowStream(i){var r=this;return Xr(function*(){if(!r.connection||r.state!==Dt.Connected)return;const a=yield Be(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const l=r.localTrackMap.get(re.LocalVideoTrack);if(!l)throw new ee(k.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(re.LocalVideoLowTrack))throw new ee(k.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const h=[{track:r.getLowVideoTrack(l.track,i),type:re.LocalVideoLowTrack}];if(yield*mb(BF(r.doPublish(r.connection,h))),l.track.muted||!l.track.enabled){var d;const f=null===(d=r.localTrackMap.get(re.LocalVideoLowTrack))||void 0===d?void 0:d.id;void 0!==f&&(yield Be(r.connection.muteLocal([f])))}}finally{a()}})()}republish(){var i=this;return L(function*(){i.pendingLocalTracks.length>0&&(I.debug("[".concat(i.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield nn(i,Oe.RequestRePublish,i.pendingLocalTracks),i.emit(Oe.MediaReconnectEnd,i.store.uid),i.pendingLocalTracks=[]),i.pendingLocalDataChannels.length>0&&(I.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),yield nn(i,Oe.RequestRePublishDataChannel,i.pendingLocalDataChannels),i.pendingLocalDataChannels=[])})()}reSubscribe(i){var r=this;return L(function*(){for(let a=r.pendingRemoteTracks.length-1;a>=0;a--){const{user:d,kind:l}=r.pendingRemoteTracks[a];(l!==Se.AUDIO||d._audio_added_&&d._audioSSRC)&&(l!==Se.VIDEO||d._video_added_&&d._videoSSRC)||r.pendingRemoteTracks.splice(a,1)}if(i)yield nn(r,Oe.RequestReSubscribe,r.pendingRemoteTracks);else for(const{user:a,kind:d}of r.pendingRemoteTracks)yield r.subscribe(a,d,d===Se.VIDEO?a._videoSSRC:a._audioSSRC);r.pendingRemoteTracks.forEach(a=>{let{user:d}=a;r.emit(Oe.MediaReconnectEnd,d.uid)}),r.pendingRemoteTracks=[]})()}unpublish(i){var r=this;return L(function*(){if(!r.connection||r.state!==Dt.Connected)return void i.forEach(l=>{const h=r.pendingLocalTracks.indexOf(l);-1!==h&&r.pendingLocalTracks.splice(h,1)});const a=r.filterTobeUnpublishedTracks(i);if(0===a.length)return;const d=a.find(l=>"videoLowTrack"===l[0]);return d&&d[1].track.close(),r.doUnpublish(r.connection,a)})()}unpublishDataChannel(i){var r=this;return L(function*(){if(!r.connection||r.state!==Dt.Connected)return void i.forEach(d=>{const l=r.pendingLocalDataChannels.indexOf(d);-1!==l&&r.pendingLocalDataChannels.splice(l,1)});const a=r.filterTobeUnpublishedDataChannels(i);return 0!==a.length?(a.forEach(d=>{const l=r.localDataChannels.indexOf(d);-1!==l&&r.localDataChannels.splice(l,1)}),0===r.localDataChannels.length&&(yield r.connection.stopDataChannels(r.store.uid)),a.map(d=>d.id)):void 0})()}unpublishLowStream(){var i=this;return L(function*(){if(!i.connection||i.state!==Dt.Connected)return;const r=i.localTrackMap.get(re.LocalVideoLowTrack);return r?(r.track.close(),i.doUnpublish(i.connection,[[re.LocalVideoLowTrack,r]])):void 0})()}doUnpublish(i,r){var a=this;return L(function*(){const d=a.createGatewayUnpublishMessage(r);return yield i.stopSending(r.map(l=>{let[,{id:h}]=l;return h})),a.withdrawLocalTracks(r),a.unbindLocalTrackEvents(r.map(l=>{let[h,{track:f}]=l;return{type:h,track:f}})),r.forEach(l=>{let[h]=l;a.statsCollector.removeLocalStats(h)}),0===a.localTrackMap.size&&a.statsUploader.stopUploadOutboundStats(),d})()}subscribeDataChannel(i,r){var a=this;return L(function*(){if(!a.connection||a.state!==Dt.Connected)throw new ee(k.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const d=r.filter(l=>{var h;return!(null!==(h=a.remoteDataChannelMap.get(i))&&void 0!==h&&h.get(l.id))});if(0!==d.length)return yield a.connection.createDataChannels(i.uid,d),d.forEach(l=>{var h;a.remoteDataChannelMap.has(i)?null===(h=a.remoteDataChannelMap.get(i))||void 0===h||h.set(l.id,l):a.remoteDataChannelMap.set(i,new Map([[l.id,l]]));const f=a.pendingRemoteDataChannels.findIndex(_=>{let{user:g,id:v}=_;return g.uid===i.uid&&v===l.id});-1!==f&&a.pendingRemoteDataChannels.splice(f,1)}),d.map(l=>l.id)})()}subscribe(i,r,a,d,l){var h=this;return L(function*(){var f;if(!h.connection||h.state!==Dt.Connected)throw new ee(k.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(f=h.remoteUserMap.get(i))&&void 0!==f&&f.has(r))return;let _,g,v;if(l){const T=l.find(O=>{let{stream_type:D}=O;return D===r});if(!T)throw new ee(k.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(i.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const M=yield h.connection.receive(r,T.ssrcs,String(i._uintid),T.attributes);h.connection instanceof Jt&&(v=M.transceiver),_=M.track,g=M.id}else{const T=yield h.connection.receive(r,[{ssrcId:a,rtx:d}],String(i._uintid),void 0);h.connection instanceof Jt&&(v=T.transceiver),_=T.track,g=T.id}r===Se.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(_):(i._audioTrack=new _s(_,i.uid,i._uintid,h.store),I.info("[".concat(h.store.clientId,"] [").concat(h.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),v&&i._audioTrack._updateRtpTransceiver(v),h.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(_):(i._videoTrack=new za(_,i.uid,i._uintid,h.store),I.info("[".concat(h.store.clientId,"] [").concat(h.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),v&&i._videoTrack._updateRtpTransceiver(v),h.bindRemoteTrackEvents(i,i._videoTrack));const b=h.remoteUserMap.get(i);b?b.set(r,g):h.remoteUserMap.set(i,new Map([[r,g]])),h.statsCollector.addRemoteStats(i.uid),h.statsUploader.startUploadInboundStats();const y=h.pendingRemoteTracks.findIndex(T=>{let{user:M,kind:O}=T;return M.uid===i.uid&&r===O});-1!==y&&(h.pendingRemoteTracks.splice(y,1),h.emit(Oe.MediaReconnectEnd,i.uid))})()}massSubscribe(i){var r=this;return L(function*(){return r.massSubscribeNoLock(i)})()}massSubscribeNoLock(i){var r=this;return L(function*(){if(!r.connection||r.state!==Dt.Connected)throw new ee(k.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");i=i.filter(d=>{var l;let{user:h,mediaType:f}=d;return!(null!==(l=r.remoteUserMap.get(h))&&void 0!==l&&l.has(f))});const a=yield r.connection.batchReceive(i.map(d=>{let{user:l,mediaType:h,ssrcId:f,rtxSsrcId:_}=d;return{kind:h,ssrcMsg:[{ssrcId:f,rtx:_}],mslabel:String(l._uintid)}}));i.forEach((d,l)=>{let{user:h,mediaType:f}=d;const{track:_,id:g,transceiver:v}=a[l];f===Se.AUDIO?(h._audioTrack?h._audioTrack._updateOriginMediaStreamTrack(_):(h._audioTrack=new _s(_,h.uid,h._uintid,r.store),I.info("[".concat(r.store.clientId,"] [").concat(r.store.p2pId,"] create remote audio track: ").concat(h._audioTrack.getTrackId()))),v&&h._audioTrack._updateRtpTransceiver(v),r.bindRemoteTrackEvents(h,h._audioTrack)):(h._videoTrack?h._videoTrack._updateOriginMediaStreamTrack(_):(h._videoTrack=new za(_,h.uid,h._uintid,r.store),I.info("[".concat(r.store.clientId,"] [").concat(r.store.p2pId,"] create remote video track: ").concat(h._videoTrack.getTrackId()))),v&&h._videoTrack._updateRtpTransceiver(v),r.bindRemoteTrackEvents(h,h._videoTrack));const b=r.remoteUserMap.get(h);b?b.set(f,g):r.remoteUserMap.set(h,new Map([[f,g]])),r.statsCollector.addRemoteStats(h.uid),r.statsUploader.startUploadInboundStats();const y=r.pendingRemoteTracks.findIndex(T=>{let{user:M,kind:O}=T;return M.uid===h.uid&&f===O});-1!==y&&(r.pendingRemoteTracks.splice(y,1),r.emit(Oe.MediaReconnectEnd,h.uid))})})()}unsubscribe(i,r,a){var d=this;return L(function*(){const l=d.pendingRemoteTracks.filter(_=>{let{user:g,kind:v}=_;return void 0!==r?g.uid===i.uid&&r===v:g.uid===i.uid});if(l.forEach(_=>{const g=d.pendingRemoteTracks.indexOf(_);d.pendingRemoteTracks.splice(g,1)}),d.connection&&d.state===Dt.Connected||a||l.forEach(_=>{let{kind:g}=_;var v;if(g===Se.AUDIO)null===(v=i._audioTrack)||void 0===v||v._destroy(),i._audioTrack=void 0;else if(g===Se.VIDEO){var b;null===(b=i._videoTrack)||void 0===b||b._destroy(),i._videoTrack=void 0}}),!d.connection||d.state!==Dt.Connected)return;const h=d.filterTobeUnSubscribedTracks(i,r);if(0===h.length)return;yield d.connection.stopReceiving(h.map(_=>{let[,{id:g}]=_;return g}));const f=d.createUnsubscribeMessage(h);return d.withdrawRemoteTracks(h),0===d.remoteUserMap.size&&d.statsUploader.stopUploadInboundStats(),h.forEach(_=>{let[g,{kind:v}]=_;var b,y;if(v===Se.VIDEO&&g._videoSSRC&&(null===(b=d.connection)||void 0===b||b.setStatsRemoteVideoIsReady(g._videoSSRC,!1)),v===Se.VIDEO)d.unbindRemoteTrackEvents(g._videoTrack),a||(null===(y=g._videoTrack)||void 0===y||y._destroy(),g._videoTrack=void 0);else if(v===Se.AUDIO){var T;d.unbindRemoteTrackEvents(g._audioTrack),!a&&(null===(T=g._audioTrack)||void 0===T||T._destroy(),g._audioTrack=void 0)}}),f})()}unsubscribeDataChannel(i,r){var a=this;return L(function*(){if(r.forEach(h=>{const f=a.pendingRemoteDataChannels.findIndex(_=>_.id===h.id);-1!==f&&a.pendingRemoteDataChannels.splice(f,1)}),!a.connection)return;const d=a.filterTobeUnSubscribedDataChannels(i,r);if(0===d.length)return;r.forEach(h=>{h._close()});const l=a.remoteDataChannelMap.get(i);return d.forEach(h=>{l&&l.delete(h.id)}),l&&0===l.size&&(a.remoteDataChannelMap.delete(i),yield a.connection.stopDataChannels(i.uid)),d.map(h=>h.id)})()}massUnsubscribe(i){var r=this;return L(function*(){return r.massUnsubscribeNoLock(i)})()}massUnsubscribeNoLock(i){var r=this;return L(function*(){let a=[];for(const{user:h,mediaType:f}of i){const _=r.pendingRemoteTracks.filter(g=>{let{user:v,kind:b}=g;return void 0!==f?v.uid===h.uid&&f===b:v.uid===h.uid});_.forEach(g=>{const v=r.pendingRemoteTracks.indexOf(g);r.pendingRemoteTracks.splice(v,1)}),a=a.concat(_)}if(!r.connection||r.state!==Dt.Connected)return void a.forEach(h=>{let{user:f,kind:_}=h;var g;if(_===Se.AUDIO)null===(g=f._audioTrack)||void 0===g||g._destroy(),f._audioTrack=void 0;else if(_===Se.VIDEO){var v;null===(v=f._videoTrack)||void 0===v||v._destroy(),f._videoTrack=void 0}});const d=Ba(i).call(i,(h,f)=>{let{user:_,mediaType:g}=f;const v=r.filterTobeUnSubscribedTracks(_,g);return h.concat(v)},[]);if(0===d.length)return;yield r.connection.stopReceiving(d.map(h=>{let[,{id:f}]=h;return f}));const l=r.createUnsubscribeAllMessage(d);return r.withdrawRemoteTracks(d),0===r.remoteUserMap.size&&r.statsUploader.stopUploadInboundStats(),d.forEach(h=>{let[f,{kind:_}]=h;var g,v;if(_===Se.VIDEO&&f._videoSSRC&&(null===(g=r.connection)||void 0===g||g.setStatsRemoteVideoIsReady(f._videoSSRC,!1)),_===Se.VIDEO)r.unbindRemoteTrackEvents(f._videoTrack),null===(v=f._videoTrack)||void 0===v||v._destroy(),f._videoTrack=void 0;else if(_===Se.AUDIO){var b;r.unbindRemoteTrackEvents(f._audioTrack),null===(b=f._audioTrack)||void 0===b||b._destroy(),f._audioTrack=void 0}}),l})()}muteRemote(i,r){var a=this;return L(function*(){if(!a.connection)return;const d=a.remoteUserMap.get(i);if(!d)return void I.warning("[".concat(a.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(i.uid,"."));if(!d.get(r))return void I.warning("[".concat(a.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(i.uid," media type ").concat(r,"."));const l=r===Se.VIDEO?i._videoSSRC:i._audioSSRC;void 0!==l&&a.connection.setStatsRemoteVideoIsReady(l,!1)})()}unmuteRemote(i,r){var a=this;return L(function*(){return a.unmuteRemoteNoLock(i,r)})()}unmuteRemoteNoLock(i,r){var a=this;return L(function*(){if(!a.connection)return;const d=a.remoteUserMap.get(i);d?d.get(r)||I.warning("[".concat(a.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(i.uid," media type ").concat(r,".")):I.warning("[".concat(a.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(i.uid,"."))})()}getAllTracks(i){const r=this.localTrackMap.get(re.LocalAudioTrack);if(r?.track instanceof jn){const a=r.track;return Array.from(this.localTrackMap.entries()).filter(d=>{let[l]=d;return l!==re.LocalAudioTrack}).filter(d=>{let[l]=d;return!(i&&l===re.LocalVideoLowTrack)}).map(d=>{let[,{track:l}]=d;return l}).concat(a.trackList)}return Array.from(this.localTrackMap.entries()).filter(a=>{let[d]=a;return!(i&&d===re.LocalVideoLowTrack)}).map(a=>{let[,{track:d}]=a;return d})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(i,r,a,d,l){if(i){const f=this.localTrackMap.get(re.LocalAudioTrack),_=this.localTrackMap.get(d?re.LocalVideoLowTrack:re.LocalVideoTrack);Ie.publish(this.store.sessionId,{eventElapse:Li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:i,ec:r,audioName:f?.track.getTrackLabel(),videoName:_?.track.getTrackLabel(),screenshare:-1!==_?.track._hints.indexOf(kt.SCREEN_TRACK),audio:!!f,video:!!_,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:l})}else{var h;a||(a=[]);const f=a.find(g=>g instanceof Et),_=d?null===(h=this.localTrackMap.get(re.LocalVideoTrack))||void 0===h?void 0:h.track:a.find(g=>g instanceof je);Ie.publish(this.store.sessionId,{eventElapse:Li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:i,ec:r,audioName:f?.getTrackLabel(),videoName:_?.getTrackLabel(),screenshare:-1!==_?._hints.indexOf(kt.SCREEN_TRACK),audio:!!f,video:!!_,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:l})}}reportSubscribeEvent(i,r,a,d){const l=d===Se.VIDEO?a._videoSSRC:a._audioSSRC;l&&Ie.subscribe(this.store.sessionId,{succ:i,ec:r,video:d===Se.VIDEO,audio:d===Se.AUDIO,peerid:a.uid,subscribeRequestid:d===Se.VIDEO?a._videoSSRC:a._audioSSRC,p2pid:this.store.p2pId,eventElapse:Li.measureFromSubscribeStart(this.store.clientId,l)})}reset(){I.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new gi("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Gn({},this.store):this.isPlanB?new pi({},this.store):new Jt({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const i=this.localTrackMap.get(re.LocalAudioTrack);if(i?.track instanceof jn){if(i.track.trackList.length>0){const r=i.track;i.track.trackList.forEach(a=>{r.removeAudioTrack(a)})}i.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Dt.Disconnected}getStats(){var i;return null===(i=this.connection)||void 0===i?void 0:i.getStats()}getRemoteVideoIsReady(i){var r;return(null===(r=this.connection)||void 0===r?void 0:r.getRemoteVideoIsReady(i))||!1}getLocalAudioVolume(){const i=this.localTrackMap.get(re.LocalAudioTrack);if(i)return i.track.getVolumeLevel()}getLocalVideoSize(){const i=this.localTrackMap.get(re.LocalVideoTrack);if(i)return{width:i.track._videoWidth||0,height:i.track._videoHeight||0}}getEncoderConfig(i){const r=this.localTrackMap.get(i);return r&&r.track instanceof je||r&&r.track instanceof Et?r.track._encoderConfig:void 0}getLocalMedia(i){return this.localTrackMap.get(i)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(i,r){if(!i)return this.remoteUserMap.size>0;const a=this.remoteUserMap.get(i);return!!a&&(!r||a.has(r))}hasRemoteMediaWithLock(i,r){var a=this;return L(function*(){if(!i)return a.remoteUserMap.size>0;const d=a.remoteUserMap.get(i);return!!d&&(!r||d.has(r))})()}getRemoteMedia(i){var r;const a=Array.from(ir(r=this.remoteUserMap).call(r)).find(d=>d.uid===i);return a?{audioTrack:a.audioTrack,audioSSRC:a._audioSSRC,videoTrack:a.videoTrack,videoSSRC:a._videoSSRC}:{}}getAudioLevels(){let i=Array.from(this.remoteUserMap.entries()).map(a=>{let[d]=a;return{uid:d.uid,level:d.audioTrack?100*d.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(re.LocalAudioTrack);return r&&i.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),i=bE(i).call(i,(a,d)=>a.level-d.level),i}disconnectForReconnect(){var i=this;return L(function*(){i.connection&&(I.debug("[".concat(i.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),i.state=Dt.Reconnecting,B("KEEP_LAST_FRAME")&&0!==i.remoteUserMap.size&&Array.from(i.remoteUserMap.entries()).forEach(r=>{let[a]=r;var d;a._videoTrack&&a._videoTrack._player&&(null===(d=a._videoTrack._player.getVideoElement())||void 0===d||d.pause(),a._videoTrack._player.isKeepLastFrame=!0,a._videoTrack._originMediaStreamTrack.stop())}),i.connection.close(),i.unbindConnectionEvents(i.connection),i.connection=void 0,i.shouldForwardP2PCreation&&(i.connection=i.store.useDataChannel?new Gn({},i.store):i.isPlanB?new pi({},i.store):new Jt({},i.store),i.bindConnectionEvents(i.connection)),0!==i.localTrackMap.size&&(Array.from(i.localTrackMap.entries()).forEach(r=>{var a;let[d,{track:l}]=r;switch(d){case re.LocalVideoTrack:ye(a=l._hints).call(a,kt.LOW_STREAM)?l.close():i.pendingLocalTracks.push(l);break;case re.LocalAudioTrack:l instanceof jn?i.pendingLocalTracks=i.pendingLocalTracks.concat(l.trackList):i.pendingLocalTracks.push(l)}}),i.emit(Oe.MediaReconnectStart,i.store.uid)),i.unbindLocalTrackEvents(),i.localTrackMap.clear(),0!==i.remoteUserMap.size&&Array.from(i.remoteUserMap.entries()).forEach(r=>{let[a,d]=r;Array.from(ir(d).call(d)).forEach(l=>{i.setPendingRemoteMedia(a,l)}),i.emit(Oe.MediaReconnectStart,a.uid)}),i.unbindAllRemoteTrackEvents(),i.remoteUserMap.clear(),0!==i.localDataChannels.length&&(i.localDataChannels.forEach(r=>{i.pendingLocalDataChannels.push(r)}),i.localDataChannels.length=0),0!==i.remoteDataChannelMap.size&&(Array.from(i.remoteDataChannelMap.entries()).forEach(r=>{let[a,d]=r;Array.from(ir(d).call(d)).forEach(l=>{i.setPendingRemoteDataChannel(a,l)})}),i.remoteDataChannelMap.clear()),i.statsUploader.stopUploadOutboundStats(),i.statsUploader.stopUploadInboundStats(),i.statsUploader.stopUploadTransportStats(),I.debug("[".concat(i.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))})()}hasPendingRemoteDataChannel(i,r){for(const a of this.pendingRemoteDataChannels){const{user:d,id:l}=a;if((i instanceof Ii?i.uid:i)===d.uid&&l===r)return!0}return!1}setPendingRemoteDataChannel(i,r){this.hasPendingRemoteDataChannel(i,r)||this.pendingRemoteDataChannels.push({user:i,id:r})}hasPendingRemoteMedia(i,r){for(const a of this.pendingRemoteTracks){const{user:d,kind:l}=a;if((i instanceof Ii?i.uid:i)===d.uid&&r===l)return!0}return!1}setPendingRemoteMedia(i,r){this.hasPendingRemoteMedia(i,r)||this.pendingRemoteTracks.push({user:i,kind:r})}restartICE(i){var r=this;return Xr(function*(){if(!r.connection||r.state!==Dt.Connected||r.connection instanceof Gn)return;const a=yield Be(r.mutex.lock("From P2PChannel.restartICE"));let d;try{d=yield Be(r.connection.restartICE(i));const h=yield Be(d.next());if(h.done)return;const f=h.value,_=yield f;switch(r.reportPCDisconnectedOrFailed(i),i){case Mi.TCP:r._pcStatsUploadType=Bs.TCP_RESTART;break;case Mi.RELAY:r._pcStatsUploadType=Bs.RELAY_RESTART;break;default:r._pcStatsUploadType=Bs.OLD_RESTART}r._isInRestartIce=!0,d.next(_)}catch(h){var l;null===(l=d)||void 0===l||l.throw(h)}finally{a()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const i=this.connection.getStats(),r=this.localTrackMap.get(re.LocalVideoTrack),a=this.localTrackMap.get(re.LocalAudioTrack),d=i.videoSend.find(M=>M.ssrc===r?.ssrcs[0].ssrcId),l=i.audioSend.find(M=>M.ssrc===a?.ssrcs[0].ssrcId);if(!d||!l)return 1;const h=Mr(this,Oe.NeedSignalRTT),f=d?d.rttMs:void 0,_=l?l.rttMs:void 0,g=f&&_?(f+_)/2:f||_,b=100*i.sendPacketLossRate*.7/50+.3*((g&&h?(g+h)/2:g||h)||0)/1500,y=b<.17?1:b<.36?2:b<.59?3:b<.1?4:5,T=r?.track;if(T&&T._encoderConfig&&-1===T._hints.indexOf(kt.SCREEN_TRACK)){const M=T._encoderConfig.bitrateMax,O=i.bitrate.actualEncoded;if(M&&O){const D=(1e3*M-O)/(1e3*M);return UO[D<.15?0:D<.3?1:D<.45?2:D<.6?3:4][y]}}return y}getDownlinkNetworkQuality(){if(!this.connection)return 0;const i=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(a=>{let[d]=a;const l=d._audioSSRC,h=d._videoSSRC,f=i.audioRecv.find(O=>O.ssrc===l),_=i.videoRecv.find(O=>O.ssrc===h);if(!f&&!_)return void(r+=1);const g=Mr(this,Oe.NeedSignalRTT),v=i.rtt,b=(v&&g?(v+g)/2:v||g)||0,y=f?f.jitterMs:void 0,T=i.recvPacketLossRate;let M=.7*T*100/50+.3*b/1500;y&&(M=.6*T*100/50+.2*b/1500+.2*y/400),r+=M<.1?1:M<.17?2:M<.36?3:M<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}muteLocalTrack(i){var r=this;return L(function*(){return new X((a,d)=>{r.handleMuteLocalTrack(i,a,d)})})()}filterTobePublishedTracks(i,r,a){const d=[],l=Ot(),h=this.getAllTracks();i=Dd(i=i.filter(g=>-1===h.indexOf(g)));let f=!1,_=!1;for(const g of i){if(g instanceof je&&(this.localTrackMap.has(re.LocalVideoTrack)||f?new ee(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(d.push({track:g,type:re.LocalVideoTrack}),f=!0),r)){const v=this.getLowVideoTrack(g,a);d.push({track:v,type:re.LocalVideoLowTrack})}if(g instanceof Et){const v=this.localTrackMap.get(re.LocalAudioTrack);if(v){if(!(v.track instanceof jn))throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0)}else if(_){const b=d.find(y=>{let{type:T}=y;return T===re.LocalAudioTrack});if(!(b.track instanceof jn))throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");b.track.addAudioTrack(g)}else{if(!l.webAudioMediaStreamDest||g instanceof jn||g._bypassWebAudio)d.push({track:g,type:re.LocalAudioTrack});else{const b=new jn;b.addAudioTrack(g),d.push({track:b,type:re.LocalAudioTrack})}_=!0}}}return d}filterTobeUnpublishedTracks(i){const r=[],a=this.getAllTracks();i=Dd(i=i.filter(d=>-1!==a.indexOf(d)));for(const d of i){if(d instanceof Et){const l=this.localTrackMap.get(re.LocalAudioTrack);if(!l)continue;l.track instanceof jn?(l.track.removeAudioTrack(d),this.unbindLocalAudioTrackEvents(d),0===l.track.trackList.length&&(r.push([re.LocalAudioTrack,l]),l.track.close())):r.push([re.LocalAudioTrack,l])}if(d instanceof je){const l=this.localTrackMap.get(re.LocalVideoTrack);if(!l)continue;r.push([re.LocalVideoTrack,l]);const h=this.localTrackMap.get(re.LocalVideoLowTrack);h&&r.push([re.LocalVideoLowTrack,h])}}return r}filterTobePublishedDataChannels(i){return(i=Dd(i)).filter(r=>-1===this.localDataChannels.findIndex(a=>a.id===r.id))}filterTobeUnpublishedDataChannels(i){return(i=(i=Dd(i)).filter(r=>-1!==this.localDataChannels.indexOf(r))).filter(r=>r._originDataChannel)}bindLocalTrackEvents(i){i.forEach(r=>{let{track:a,type:d}=r;switch(d){case re.LocalVideoTrack:a.addListener(ve.GET_STATS,this.handleGetLocalVideoStats),a.addListener(ve.GET_RTC_STATS,this.handleGetRTCStats),a.addListener(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.addListener(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.addListener(ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),a.addListener(ve.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),a.addListener(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),a.addListener(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.addListener(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case re.LocalAudioTrack:this.bindLocalAudioTrackEvents(a)}})}bindLocalAudioTrackEvents(i,r){i instanceof jn?i.trackList.forEach(a=>{a.addListener(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.addListener(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.addListener(ve.GET_STATS,this.handleGetLocalAudioStats),a.addListener(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.addListener(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(i.addListener(ve.GET_STATS,this.handleGetLocalAudioStats),i.addListener(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||i.addListener(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(i){i||(i=Array.from(this.localTrackMap.entries()).map(r=>{let[a,{track:d}]=r;return{track:d,type:a}})),i.forEach(r=>{let{track:a,type:d}=r;switch(d){case re.LocalVideoTrack:a.off(ve.GET_STATS,this.handleGetLocalVideoStats),a.off(ve.GET_RTC_STATS,this.handleGetRTCStats),a.off(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.off(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.off(ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),a.off(ve.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),a.off(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),a.off(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.off(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case re.LocalAudioTrack:this.unbindLocalAudioTrackEvents(a)}})}unbindLocalAudioTrackEvents(i){i instanceof jn?i.trackList.forEach(r=>{r.off(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(ve.GET_STATS,this.handleGetLocalAudioStats),r.off(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(i.off(ve.GET_STATS,this.handleGetLocalAudioStats),i.off(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(i,r){r instanceof za&&r.addListener(ve.GET_STATS,a=>{a(this.handleGetRemoteVideoStats(i))}),r instanceof _s&&r.addListener(ve.GET_STATS,a=>{a(this.handleGetRemoteAudioStats(i))})}unbindRemoteTrackEvents(i){i&&i.removeAllListeners(ve.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(i=>{let[r,a]=i;a.has(Se.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),a.has(Se.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(i,r){return i.map((a,d)=>{var l;let h,f,{track:_,type:g}=a;switch(g){case re.LocalAudioTrack:h=ut.Audio,f={dtx:_ instanceof ji&&_._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case re.LocalVideoTrack:h=ye(l=_._hints).call(l,kt.SCREEN_TRACK)?ut.Screen:ut.High,f=nl(nl({},tN(_)),{},{codec:this.store.codec});break;case re.LocalVideoLowTrack:h=ut.Low,f=nl(nl({},tN(_)),{},{codec:this.store.codec})}return{stream_type:h,attributes:f,ssrcs:r[d]}})}createGatewayUnpublishMessage(i){return i.map(r=>{var a;let d,[l,{track:h,ssrcs:f,id:_}]=r;switch(l){case re.LocalVideoTrack:d=ye(a=h._hints).call(a,kt.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalAudioTrack:d=ut.Audio;break;case re.LocalVideoLowTrack:d=ut.Low}return{stream_type:d,ssrcs:f,mid:_}})}assignLocalTracks(i,r){i.forEach((a,d)=>{let{track:l,type:h}=a;this.localTrackMap.set(h,{track:l,id:r[d].id,ssrcs:r[d].localSSRC})})}withdrawLocalTracks(i){i.forEach(r=>{let[a]=r;this.localTrackMap.delete(a)})}bindConnectionEvents(i){var r=this;i.onConnectionStateChange=function(){var a=L(function*(d){if(I.info("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(d,")")),r.emit(Oe.PeerConnectionStateChange,d),"connected"!==d||r.store.keyMetrics.peerConnectionEnd||r.store.peerConnectionEnd(),"connected"===d&&(r._restartTimer&&(clearTimeout(r._restartTimer),r._restartTimer=void 0),(r._isFirstConnected||r._isInRestartIce)&&r.reportPCStats(Date.now(),!0,r._pcStatsUploadType),r._isInRestartIce=!1,r._isFirstConnected=!1,r._isStartRestartIce=!1),B("NEW_ICE_RESTART")){var l;if(ye(l=r._restartStates).call(l,d)){if(r._isStartRestartIce)return;r._isStartRestartIce=!0;const h=g=>{("disconnected"===i.iceConnectionState||"checking"===i.iceConnectionState||"failed"===i.iceConnectionState)&&(I.debug("[".concat(r.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(g)),"CONNECTED"===Mr(r,Oe.QueryClientConnectionState)&&r.emit(Oe.RequestRestartICE,g))},f=()=>{"disconnected"!==i.iceConnectionState&&"checking"!==i.iceConnectionState&&"failed"!==i.iceConnectionState||(r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),I.debug("[".concat(r.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>r.emit(Oe.P2PLost),0),r.iceFailedCount+=1,r.requestReconnect())},_=B("ICE_RESTART_INTERVAL");return void(r._restartTimer=window.setTimeout(()=>{if(B("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ot().supportPCSetConfiguration)h(Mi.RELAY),r._restartTimer=window.setTimeout(f,_);else if(Pt())h(Mi.UDP),r._restartTimer=window.setTimeout(f,4e3);else{if(h(Mi.TCP),Ot().supportPCSetConfiguration)return void(r._restartTimer=window.setTimeout(()=>{h(Mi.RELAY),r._restartTimer=window.setTimeout(f,_)},_));r._restartTimer=window.setTimeout(f,_)}},800))}}else{if("disconnected"===d&&"disconnected"===i.iceConnectionState)return setTimeout(()=>{"disconnected"===i.iceConnectionState&&B("ICE_RESTART")&&"CONNECTED"===Mr(r,Oe.QueryClientConnectionState)&&r.emit(Oe.RequestRestartICE)},800),void setTimeout(()=>{"disconnected"===i.peerConnectionState&&(I.debug("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),r._isInRestartIce=!1,setTimeout(()=>r.emit(Oe.P2PLost),0),r.iceFailedCount+=1,r.requestReconnect())},4e3);"failed"===d&&(I.debug("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection state failed, force reconnect")),r.reportPCDisconnectedOrFailed(),setTimeout(()=>r.emit(Oe.P2PLost),0),r.iceFailedCount+=1,yield r.requestReconnect())}});return function(d){return a.apply(this,arguments)}}(),i.onICEConnectionStateChange=a=>{"connected"!==a||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(a,")")),Ie.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:a,tag:Kt.TRACER}).onSuccess(),this.emit(Oe.IceConnectionStateChange,a)},i.onICETransportStateChange=a=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(a,")"))},i.onDTLSTransportStateChange=a=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(a,")"))},i.onDTLSTransportError=a=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(a,")"))},i.onFirstAudioDecoded=a=>{var d;const l=Array.from(ir(d=this.remoteUserMap).call(d)).find(f=>f._audioSSRC===a);var h;l&&(this.store.subscribe(l.uid,"audio",void 0,void 0,void 0,Date.now()),null===(h=l.audioTrack)||void 0===h||h.emit(fu.FIRST_FRAME_DECODED),Ie.firstRemoteFrame(this.store.sessionId,ti.FIRST_AUDIO_DECODE,Gt.FIRST_AUDIO_DECODE,{peer:l._uintid,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId}))},i.onFirstAudioReceived=a=>{var d;const l=Array.from(ir(d=this.remoteUserMap).call(d)).find(h=>h._audioSSRC===a);l&&Ie.firstRemoteFrame(this.store.sessionId,ti.FIRST_AUDIO_RECEIVED,Gt.FIRST_AUDIO_RECEIVED,{peer:l._uintid,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId})},i.onFirstVideoDecoded=(a,d,l)=>{this.reportVideoFirstFrameDecoded(a,d,l)},i.onFirstVideoReceived=a=>{var d;const l=Array.from(ir(d=this.remoteUserMap).call(d)).find(h=>h._videoSSRC===a);l&&Ie.firstRemoteFrame(this.store.sessionId,ti.FIRST_VIDEO_RECEIVED,Gt.FIRST_VIDEO_RECEIVED,{peer:l._uintid,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId})},i.onSelectedLocalCandidateChanged=(a,d)=>{const l="relay"===a.candidateType;"unknown"!==d.candidateType&&l===("relay"===d.candidateType)||this.emit(Oe.ConnectionTypeChange,l),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Bc(d))," -> ").concat(JSON.stringify(Bc(a)),")"))},i.onSelectedRemoteCandidateChanged=(a,d)=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Bc(d))," -> ").concat(JSON.stringify(Bc(a)),")"))},i.onFirstVideoDecodedTimeout=a=>{this.reportVideoFirstFrameDecoded(a,void 0,void 0,!0)}}unbindConnectionEvents(i){i.onConnectionStateChange=void 0,i.onICEConnectionStateChange=void 0,i.onICETransportStateChange=void 0,i.onDTLSTransportStateChange=void 0,i.onDTLSTransportError=void 0,i.onFirstAudioDecoded=void 0,i.onFirstAudioReceived=void 0,i.onFirstVideoDecoded=void 0,i.onFirstVideoReceived=void 0,i.onSelectedLocalCandidateChanged=void 0,i.onSelectedRemoteCandidateChanged=void 0,i.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(i){const r=[];if(-1===this.getAllTracks().indexOf(i))return r;const a=this.localTrackMap.get(re.LocalAudioTrack);if(i instanceof Et&&a?.track instanceof jn)return a.track.isActive||r.push([re.LocalAudioTrack,a]),r;const d=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:h}]=l;return i===h});if(d&&(r.push(d),d[0]===re.LocalVideoTrack)){const l=this.localTrackMap.get(re.LocalVideoLowTrack);l&&r.push([re.LocalVideoLowTrack,l])}return r}filterTobeUnmutedTracks(i){const r=[],a=this.localTrackMap.get(re.LocalAudioTrack);if(i instanceof Et&&a?.track instanceof jn)return a.track.isActive&&r.push([re.LocalAudioTrack,a]),r;const d=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:h}]=l;return i===h});if(d)if(d[0]===re.LocalVideoTrack){r.push(d);const l=this.localTrackMap.get(re.LocalVideoLowTrack);l&&r.push([re.LocalVideoLowTrack,l])}else r.push(d);return r}createMuteMessage(i){return i.map(r=>{var a;let d,[l,{track:h,ssrcs:f,id:_}]=r;switch(l){case re.LocalAudioTrack:d=ut.Audio;break;case re.LocalVideoTrack:d=ye(a=h._hints).call(a,kt.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalVideoLowTrack:d=ut.Low}return{stream_type:d,ssrcs:f,mid:_}})}createUnmuteMessage(i){return i.map(r=>{var a;let d,[l,{track:h,ssrcs:f,id:_}]=r;switch(l){case re.LocalAudioTrack:d=ut.Audio;break;case re.LocalVideoTrack:d=ye(a=h._hints).call(a,kt.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalVideoLowTrack:d=ut.Low}return{stream_type:d,ssrcs:f,mid:_}})}filterTobeUnSubscribedTracks(i,r){const a=[],d=this.remoteUserMap.get(i);if(!d)return a;if(r){const l=d.get(r);if(!l)return a;a.push([i,{kind:r,id:l}])}else Array.from(d.entries()).forEach(l=>{let[h,f]=l;a.push([i,{kind:h,id:f}])});return a}filterTobeUnSubscribedDataChannels(i,r){const a=[];return r.forEach(d=>{var l;null!==(l=this.remoteDataChannelMap.get(i))&&void 0!==l&&l.has(d.id)&&a.push(d)}),a}createUnsubscribeMessage(i){const r=[];return i.forEach(a=>{let[d,{kind:l}]=a;switch(l){case Se.VIDEO:return void(d._videoSSRC&&r.push({stream_type:Se.VIDEO,ssrcId:d._videoSSRC}));case Se.AUDIO:return void(d._audioSSRC&&r.push({stream_type:Se.AUDIO,ssrcId:d._audioSSRC}))}}),r}createUnsubscribeAllMessage(i){const r=new Map;return i.forEach(a=>{let[d,{kind:l}]=a;if(r.has(d)){let h=r.get(d);h|=l===Se.VIDEO?Bn.Video:Bn.Audio,r.set(d,h)}else r.set(d,l===Se.VIDEO?Bn.Video:Bn.Audio)}),{users:Array.from(r.entries()).map(a=>{let[d,l]=a;return{stream_id:d.uid,stream_type:l}})}}withdrawRemoteTracks(i){i.forEach(r=>{let[a,{kind:d}]=r;const l=this.remoteUserMap.get(a);l&&(l.delete(d),0===Array.from(l.entries()).length&&this.remoteUserMap.delete(a))})}updateBitrateLimit(i){var r=this;return L(function*(){const a=r.localTrackMap.get(re.LocalVideoTrack),d=r.localTrackMap.get(re.LocalVideoLowTrack);a&&(yield a.track.setBitrateLimit(i.uplink)),d&&i.low_stream_uplink&&(yield d.track.setBitrateLimit({max_bitrate:i.low_stream_uplink.bitrate,min_bitrate:i.low_stream_uplink.bitrate||0}))})()}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(i,r){return i.map((a,d)=>{var l;let{stream_type:h}=a;return null===(l=r.find(f=>{let{stream_type:_}=f;return h===_}))||void 0===l?void 0:l.attributes})}tryToUnmuteAudio(i){var r=this;return L(function*(){for(let d=0;d<i.length;d++)if(i[d]instanceof Et){var a;const l=r.filterTobeUnmutedTracks(i[d]);if(0===l.length)continue;yield null===(a=r.connection)||void 0===a?void 0:a.unmuteLocal(l.map(f=>{let[,{id:_}]=f;return _}));const h=r.createUnmuteMessage(l);return void(yield Tt(r,Oe.RequestUnmuteLocal,h))}})()}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=i=>{var r;return!(null===(r=this.connection)||void 0===r||!r.getRemoteVideoIsReady(i))},this.statsUploader.requestUpload=(i,r)=>this.emit(Oe.RequestUpload,i,r),this.statsUploader.requestUploadStats=i=>this.emit(Oe.RequestUploadStats,i),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){var i=this;return L(function*(){i.dtlsFailedCount+=1,yield Un(ev(i.dtlsFailedCount,Pn)),i.emit(Oe.RequestReconnect)})()}reconnectP2P(){var i=this;return L(function*(){const r=Array.from(i.localTrackMap.entries()),a=i.createGatewayUnpublishMessage(r);Array.from(i.remoteUserMap.entries()),a.length>0&&(yield nn(i,Oe.RequestUnpublishForReconnectPC,a)),i.disconnectForReconnect(),i.emit(Oe.RequestReconnectPC)})()}canPublishLowStream(){return this.localTrackMap.has(re.LocalVideoTrack)||this.pendingLocalTracks.some(i=>i instanceof je)}throwIfTrackTypeNotMatch(i){if(i.filter(r=>r instanceof je).length>1)throw new ee(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(i.filter(r=>r instanceof Et).length>1&&(i.some(r=>r instanceof Et&&r._bypassWebAudio)||!Ot().webAudioMediaStreamDest))throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of i){if(r instanceof je&&this.pendingLocalTracks.some(a=>a instanceof je))throw new ee(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Et&&this.pendingLocalTracks.some(a=>a instanceof Et)&&(!Ot().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(a=>a instanceof Et&&a._bypassWebAudio)))throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(i,r){const a=!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ot().supportDualStreamEncoding,d=nl(nl({},{width:160,height:120,framerate:15,bitrate:50}),r);let l;l=a?i._mediaStreamTrack.clone():Lp(i,d);const h=qe(8,"track-low-"),f=new je(l,nl(nl({},a&&{scaleResolutionDownBy:OT(d,i)}),{},{frameRate:d.framerate,bitrateMax:d.bitrate,bitrateMin:d.bitrate}),void 0,void 0,h);return f.on(pu.TRANSCEIVER_UPDATED,_=>{i._updateRtpTransceiver(_,jd.LOW_STREAM)}),f._hints.push(kt.LOW_STREAM),i.addListener(ve.NEED_CLOSE,()=>{f.close()}),f}globalLock(){var i=this;return L(function*(){return i.mutex.lock("From P2PChannel.globalLock")})()}reportPCStats(i,r,a){var d=arguments,l=this;return L(function*(){let h=d.length>3&&void 0!==d[3]?d[3]:null;if(l.connection&&l.connection instanceof Jt){var f,_,g,v;const b=l.store.keyMetrics.descriptionStart||0,{iceConnectionState:y,dtlsTransportState:T,peerConnectionState:M}=l.connection,{local:O,remote:D}=yield l.connection.getSelectedCandidatePair();Ie.pcStats(l.store.sessionId,{startTime:b,eventElapse:i-b||0,iceconnectionsate:y,dtlsstate:T,connectionstate:M,intSucc:r?1:2,error:h,selectedLocalCandidateProtocol:null!==(f=O?.protocol)&&void 0!==f?f:"",selectedLocalCandidateType:null!==(_=O.candidateType)&&void 0!==_?_:"",selectedLocalCandidateAddress:"".concat(O.address,":").concat(O.port),selectedRemoteCandidateProtocol:null!==(g=D.protocol)&&void 0!==g?g:"",selectedRemoteCandidateType:null!==(v=D.candidateType)&&void 0!==v?v:"",selectedRemoteCandidateAddress:"".concat(D.address,":").concat(D.port),restartCnt:a})}})()}reportVideoFirstFrameDecoded(i,r,a,d){var l;const h=Array.from(ir(l=this.remoteUserMap).call(l)).find(f=>f._videoSSRC===i);if(h){d||this.store.subscribe(h.uid,"video",void 0,void 0,void 0,void 0,Date.now());const f=this.store.keyMetrics,_=f.subscribe.find(g=>g.userId===h.uid&&"video"===g.type);Ie.firstRemoteVideoDecode(this.store.sessionId,ti.FIRST_VIDEO_DECODE,Gt.FIRST_VIDEO_DECODE,{peer:h._uintid,videowidth:r,videoheight:a,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId,apEnd:f.requestAPEnd||0,apStart:f.requestAPStart||0,joinGwEnd:f.joinGatewayEnd||0,joinGwStart:f.joinGatewayStart||0,pcEnd:f.peerConnectionEnd||0,pcStart:f.peerConnectionStart||0,subscriberEnd:_?.subscribeEnd||0,subscriberStart:_?.subscribeStart||0,videoAddNotify:_?.streamAdded||0,state:d?1:0})}}remoteMediaSsrcChanged(i,r,a){var d=this;return L(function*(){if(!d.connection)return!1;const l=d.remoteUserMap.get(i);if(!l)return!1;const h=l.get(r);if(!h)return!1;const f=yield d.connection.getRemoteSSRC(h);return void 0!==f&&f!==a})()}resetConnection(i){I.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(i)),this.state===Dt.Connected?(I.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=i===Om.datachannel?new Gn({},this.store):this.isPlanB?new pi({},this.store):new Jt({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(i=>{let[r,{track:a}]=i;r===re.LocalVideoLowTrack?a._updateRtpTransceiver(void 0,jd.LOW_STREAM):a._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(i){this.connection&&this.connection instanceof Jt&&("disconnected"!==this.connection.iceConnectionState&&"checking"!==this.connection.iceConnectionState&&"failed"!==this.connection.iceConnectionState||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this.reportPCStats(Date.now(),!1,this._pcStatsUploadType===Bs.TCP_RESTART&&i===Mi.RELAY?this._pcStatsUploadType:Bs.DISCONNECTED_OR_FAILED)))}}function Wi(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=L(function*(){const d=this.mutex,l=yield d.lock("From P2PChannel.".concat(i));try{for(var h=arguments.length,f=new Array(h),_=0;_<h;_++)f[_]=arguments[_];return yield a.apply(this,f)}finally{l()}}),r}function xP(s){let i={};e:for(;!FP(s);){let r=Za(s);switch(r>>>3){case 0:break e;case 1:i.requestId=Q0(s,Za(s));break;case 2:i.requestType=Za(s)>>>0;break;case 3:i.scorePorn=Cs(s);break;case 4:i.scoreSexy=Cs(s);break;case 5:i.scoreNeutral=Cs(s);break;case 6:i.requestScene=Za(s)>>>0;break;case 7:i.scene=Za(s)>>>0;break;default:$0(s,7&r)}}return i}function HF(s,i){let r=s.service;void 0!==r&&(wt(i,8),wt(i,r));let a=s.vendor;void 0!==a&&(wt(i,16),wt(i,a));let d=s.token;void 0!==d&&(wt(i,26),Qa(i,d));let l=s.callbackUrl;void 0!==l&&(wt(i,34),Qa(i,l))}function kP(s){let i=Za(s),r=s.limit;return s.limit=s.offset+i,r}function $0(s,i){switch(i){case 0:for(;128&Z0(s););break;case 2:J0(s,Za(s));break;case 5:J0(s,4);break;case 1:J0(s,8);break;default:throw new Error("Unimplemented type: "+i)}}ne([Wi,N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",X)],si.prototype,"startP2PConnection",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",X)],si.prototype,"connect",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",void 0)],si.prototype,"updateRemoteRTPCapabilities",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",X)],si.prototype,"preConnect",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],si.prototype,"publishDataChannel",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],si.prototype,"unpublish",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],si.prototype,"unpublishDataChannel",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",X)],si.prototype,"unpublishLowStream",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Ii,Array]),N("design:returntype",X)],si.prototype,"subscribeDataChannel",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Ii,String,Number,Number,Array]),N("design:returntype",X)],si.prototype,"subscribe",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],si.prototype,"massSubscribe",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Ii,String,Boolean]),N("design:returntype",X)],si.prototype,"unsubscribe",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Ii,Array]),N("design:returntype",X)],si.prototype,"unsubscribeDataChannel",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],si.prototype,"massUnsubscribe",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Ii,String]),N("design:returntype",X)],si.prototype,"muteRemote",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Ii,String]),N("design:returntype",X)],si.prototype,"unmuteRemote",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Ii,String]),N("design:returntype",X)],si.prototype,"hasRemoteMediaWithLock",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",X)],si.prototype,"disconnectForReconnect",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],si.prototype,"updateBitrateLimit",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Ii,String,Number]),N("design:returntype",X)],si.prototype,"remoteMediaSsrcChanged",null);let ij=new Float32Array(1);new Uint8Array(ij.buffer);let Mu=new Float64Array(1),Zr=new Uint8Array(Mu.buffer);function xu(s){return{low:s|=0,high:s>>31,unsigned:s>=0}}let LP=[];function Sb(){const s=LP.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}function X0(s){LP.push(s)}function J0(s,i){if(s.offset+i>s.limit)throw new Error("Skip past limit");s.offset+=i}function FP(s){return s.offset>=s.limit}function C_(s,i){let r=s.bytes,a=s.offset,d=s.limit,l=a+i;if(l>r.length){let h=new Uint8Array(2*l);h.set(r),s.bytes=h}return s.offset=l,l>d&&(s.limit=l),a}function UP(s,i){let r=s.offset;if(r+i>s.limit)throw new Error("Read past limit");return s.offset+=i,r}function Q0(s,i){let r=UP(s,i),a=String.fromCharCode,d=s.bytes,l="\ufffd",h="";for(let f=0;f<i;f++){let _,g,v,b,y=d[f+r];128&y?192==(224&y)?f+1>=i?h+=l:(_=d[f+r+1],128!=(192&_)?h+=l:(b=(31&y)<<6|63&_,b<128?h+=l:(h+=a(b),f++))):224==(240&y)?f+2>=i?h+=l:(_=d[f+r+1],g=d[f+r+2],32896!=(49344&(_|g<<8))?h+=l:(b=(15&y)<<12|(63&_)<<6|63&g,b<2048||b>=55296&&b<=57343?h+=l:(h+=a(b),f+=2))):240==(248&y)?f+3>=i?h+=l:(_=d[f+r+1],g=d[f+r+2],v=d[f+r+3],8421504!=(12632256&(_|g<<8|v<<16))?h+=l:(b=(7&y)<<18|(63&_)<<12|(63&g)<<6|63&v,b<65536||b>1114111?h+=l:(b-=65536,h+=a(55296+(b>>10),56320+(1023&b)),f+=3))):h+=l:h+=a(y)}return h}function Qa(s,i){let r=i.length,a=0;for(let h=0;h<r;h++){let f=i.charCodeAt(h);f>=55296&&f<=56319&&h+1<r&&(f=(f<<10)+i.charCodeAt(++h)-56613888),a+=f<128?1:f<2048?2:f<65536?3:4}wt(s,a);let d=C_(s,a),l=s.bytes;for(let h=0;h<r;h++){let f=i.charCodeAt(h);f>=55296&&f<=56319&&h+1<r&&(f=(f<<10)+i.charCodeAt(++h)-56613888),f<128?l[d++]=f:(f<2048?l[d++]=f>>6&31|192:(f<65536?l[d++]=f>>12&15|224:(l[d++]=f>>18&7|240,l[d++]=f>>12&63|128),l[d++]=f>>6&63|128),l[d++]=63&f|128)}}function GF(s,i){let r=C_(s,i.limit),a=s.bytes,d=i.bytes;for(let l=0,h=i.limit;l<h;l++)a[l+r]=d[l]}function Z0(s){return s.bytes[UP(s,1)]}function WF(s,i){let r=C_(s,1);s.bytes[r]=i}function Cs(s){let i=UP(s,8),r=s.bytes;return Zr[0]=r[i++],Zr[1]=r[i++],Zr[2]=r[i++],Zr[3]=r[i++],Zr[4]=r[i++],Zr[5]=r[i++],Zr[6]=r[i++],Zr[7]=r[i++],Mu[0]}function eI(s,i){let r=C_(s,8),a=s.bytes;Mu[0]=i,a[r++]=Zr[0],a[r++]=Zr[1],a[r++]=Zr[2],a[r++]=Zr[3],a[r++]=Zr[4],a[r++]=Zr[5],a[r++]=Zr[6],a[r++]=Zr[7]}function Za(s){let i,r=0,a=0;do{i=Z0(s),r<32&&(a|=(127&i)<<r),r+=7}while(128&i);return a}function wt(s,i){for(i>>>=0;i>=128;)WF(s,127&i|128),i>>>=7;WF(s,i)}function il(s,i){let r=i.low>>>0,a=(i.low>>>28|i.high<<4)>>>0,d=i.high>>>24,l=0===d?0===a?r<16384?r<128?1:2:r<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:d<128?9:10,h=C_(s,l),f=s.bytes;switch(l){case 10:f[h+9]=d>>>7&1;case 9:f[h+8]=9!==l?128|d:127&d;case 8:f[h+7]=8!==l?a>>>21|128:a>>>21&127;case 7:f[h+6]=7!==l?a>>>14|128:a>>>14&127;case 6:f[h+5]=6!==l?a>>>7|128:a>>>7&127;case 5:f[h+4]=5!==l?128|a:127&a;case 4:f[h+3]=4!==l?r>>>21|128:r>>>21&127;case 3:f[h+2]=3!==l?r>>>14|128:r>>>14&127;case 2:f[h+1]=2!==l?r>>>7|128:r>>>7&127;case 1:f[h]=1!==l?128|r:127&r}}function Cb(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}const zF=new Map([["moderation",1],["supervise",2]]);class Tb extends jt{get connectionState(){return this._connectionState}set connectionState(i){if(this._connectionState===i)return;const r=this._connectionState;this._connectionState=i,this.emit(ni.CONNECTION_STATE_CHANGE,r,i)}get inspectType(){return this._inspectType}set inspectType(i){var r;this._inspectMode=Ba(r=i.map(a=>zF.get(a)||0)).call(r,(a,d)=>a+d),this._inspectType=i}get quality(){return this._quality}set quality(i){this._quality=i>1?1:i<.1?.1:i,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(i){super(),C(this,"name","AgoraRTCVideoContentInspect"),C(this,"_connectionState",Do.CONNECTING),C(this,"_innerConnectionState",void 0),C(this,"sequence",0),C(this,"inspectStartTime",void 0),C(this,"workerManagerConnection",void 0),C(this,"workerConnection",void 0),C(this,"workerMessageLengthLimit",void 0),C(this,"inspectIntervalMinimum",void 0),C(this,"qualityRatio",void 0),C(this,"_connectInfo",void 0),C(this,"_cancelTokenSource",Ze.CancelToken.source()),C(this,"_retryConfig",void 0),C(this,"wmSequence",0),C(this,"inspectInterval",void 0),C(this,"inspectTimer",null),C(this,"ossFilePrefix",void 0),C(this,"extraInfo",void 0),C(this,"_inspectType",void 0),C(this,"_inspectMode",void 0),C(this,"_quality",1),C(this,"qualityTimer",null),C(this,"_inspectId",void 0),C(this,"_needWorkUrlOnly",!1),C(this,"inspectImage",()=>{if(this.connectionState!==Do.CONNECTED)throw new W(k.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Do.CONNECTED?this.requestToInspectImage():I.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=qe(5,"inspect-"),this.workerMessageLengthLimit=B("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=B("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=B("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=i.interval,this.ossFilePrefix=i.ossFilePrefix,this.extraInfo=i.extraInfo,this.inspectType=i.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Lm("worker-manager-"+this._inspectId,Pn),this.on(ni.STATE_CHANGE,(r,a)=>{this._innerConnectionState=r,I.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Oo[r]," ").concat(a||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Lm("worker-"+this._inspectId,Pn),this.handleWorkerEvents()}init(i,r){var a=this;return L(function*(){a.emit(ni.STATE_CHANGE,Oo.CONNECT_AP),a._connectInfo=i;const d=a._cancelTokenSource.token;return a._retryConfig=r,new X((l,h)=>{a.on(ni.CONNECTION_STATE_CHANGE,(f,_)=>{_===Do.CONNECTED&&l()}),a.requestAP(i,d,r).then(f=>{a.connectWorkerManager(f)}).catch(f=>{h(f)})})})()}requestAP(i,r,a){var d=this;return L(function*(){const l=B("WEBCS_DOMAIN").map(_=>"https://".concat(_,"/api/v1")),h=yield function(_,g,v,b){let{appId:y,areaCode:T,cname:M,sid:O,token:D,uid:x}=g;cu++;const F="image_moderation_api",j={service_name:F,json_body:JSON.stringify({appId:y,areaCode:T,cname:M,command:"allocateEdge",requestId:cu,seq:cu,sid:O,token:D,ts:Date.now(),uid:x+""})};let Y,te,K=_[0];return In(L(function*(){Y=Date.now();const Q=yield Ga(K,{data:j,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(te=Date.now()-Y,0!==Q.code){const _e=new W(k.UNEXPECTED_RESPONSE,"image inspect ap error, code"+Q.code,{retry:!0,responseTime:te});throw I.error(_e.toString()),_e}const $=JSON.parse(Q.json_body);if(200!==$.code){const _e=new W(k.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat($.code,", reason: ").concat($.reason),{code:$.code,responseTime:te});throw I.error(_e.toString()),_e}if(!$.servers||!Array.isArray($.servers)||0===$.servers.length){const _e=new W(k.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:$.code,responseTime:te});throw I.error(_e.toString()),_e}const q=B("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ge=B("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:$.servers.map(_e=>{let{address:Fe,wss:rt}=_e;if(Fe&&rt)return"wss://".concat(Fe.replace(/\./g,"-"),".").concat(q,":").concat(ge||rt)}).filter(_e=>!!_e),workerToken:$.workerToken,vid:$.vid,responseTime:te}}),(Q,$)=>(Ie.apworkerEvent(O,{success:!0,sc:200,serviceName:F,responseDetail:JSON.stringify(Q.addressList),firstSuccess:0===$,responseTime:te,serverIp:_[$%_.length]}),!1),(Q,$)=>(Ie.apworkerEvent(O,{success:!1,sc:Q.data&&Q.data.code||200,serviceName:F,responseTime:te,serverIp:_[$%_.length]}),!!(Q.code!==k.OPERATION_ABORTED&&Q.code!==k.UNEXPECTED_RESPONSE||Q.data&&Q.data.retry)&&(K=_[($+1)%_.length],!0)),b)}(l,i,r,a);d.emit(ni.STATE_CHANGE,Oo.AP_CONNECTED);const{addressList:f}=h;return d.wmSequence++,f})()}connectWorkerManager(i){var r=arguments,a=this;return L(function*(){a._needWorkUrlOnly=r.length>1&&void 0!==r[1]&&r[1],a.emit(ni.STATE_CHANGE,Oo.CONNECT_WORKER_MANAGER),yield a.workerManagerConnection.init(i,1e4)})()}connectWorker(i){var r=this;return L(function*(){yield r.workerConnection.init([i])})()}handleWorkerManagerEvents(){var i=this;this.workerManagerConnection.on(Me.CONNECTED,L(function*(){i.emit(ni.STATE_CHANGE,Oo.WORKER_MANAGER_CONNECTED,i.workerManagerConnection.url),i.workerManagerConnection.sendMessage({appId:i._connectInfo.appId,cname:i._connectInfo.cname,uid:i._connectInfo.uid+"",sdkVersion:"4.20.0",sid:i._connectInfo.sid,seq:i.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(Me.CLOSED,()=>{this._innerConnectionState<Oo.GET_WORKER_MANAGER_RESPONSE&&I.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Me.FAILED,()=>{this._innerConnectionState<Oo.GET_WORKER_MANAGER_RESPONSE&&I.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Me.RECONNECTING,()=>{this._innerConnectionState<Oo.GET_WORKER_MANAGER_RESPONSE&&I.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Me.ON_MESSAGE,function(){var r=L(function*(a){i.emit(ni.STATE_CHANGE,Oo.GET_WORKER_MANAGER_RESPONSE);const d=i.workerManagerConnection.url;i.workerManagerConnection.close();const l=JSON.parse(a.data);if(200!==l.code)throw I.error("[".concat(i._inspectId,"] Unexpected code ").concat(l.code," from worker manager")),new W(k.UNEXPECTED_RESPONSE,"response code of worker is unexpected",l);if(!(l.serverResponse&&l.serverResponse.portWss&&d))throw I.error("[".concat(i._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(l))),new W(k.UNEXPECTED_RESPONSE,"response content of worker is unexpected",l);{const h=B("VIDEO_INSPECT_WORKER_PORT")||l.serverResponse.portWss,f=d.replace(/:\d+\/?$/,":".concat(h));i.emit(ni.STATE_CHANGE,Oo.CONNECT_WORKER,f),i._needWorkUrlOnly?i.emit(ni.REQUEST_NEW_WORKER_URL,f):yield i.connectWorker(f)}});return function(a){return r.apply(this,arguments)}}()),this.workerManagerConnection.on(Me.WILL_RECONNECT,(r,a,d)=>{d(r)}),this.workerManagerConnection.on(Me.REQUEST_NEW_URLS,(r,a)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(a)})}handleWorkerEvents(){var i=this;this.workerConnection.on(Me.CONNECTED,L(function*(){i.emit(ni.STATE_CHANGE,Oo.WORKER_CONNECTED,i.workerConnection.url),i.connectionState=Do.CONNECTED})),this.workerConnection.on(Me.ON_MESSAGE,function(){var r=L(function*(a){if(a.data instanceof ArrayBuffer){const l=function jF(s){return function(r){let a={};e:for(;!FP(r);){let d=Za(r);switch(d>>>3){case 0:break e;case 1:a.code=Za(r);break;case 2:a.msg=Q0(r,Za(r));break;case 3:{let l=kP(r);a.data=xP(r),r.limit=l;break}default:$0(r,7&d)}}return a}({bytes:i=s,offset:0,limit:i.length});var i}(new Uint8Array(a.data));if(B("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&I.debug("[".concat(i._inspectId,"] Response message for worker of inspect content "),JSON.stringify(l)),200===l.code){if(Array.isArray(i.inspectType)&&1===i.inspectType.length&&"supervise"===i.inspectType[0])return void i.emit(ni.INSPECT_RESULT,void 0,void 0);if(l.data&&l.data.scorePorn&&l.data.scoreSexy&&l.data.scoreNeutral){var d;const h={porn:l.data.scorePorn,sexy:l.data.scoreSexy,neutral:l.data.scoreNeutral},f=Ba(d=Object.keys(h)).call(d,(g,v)=>h[g]>h[v]?g:v,"porn"),_=Object.keys(h).find(g=>g===f);i.emit(ni.INSPECT_RESULT,_)}else i.emit(ni.INSPECT_RESULT,void 0,new W(k.UNEXPECTED_RESPONSE,l.code+"","There is an unexpected data on message"))}else i.emit(ni.INSPECT_RESULT,void 0,new W(k.UNEXPECTED_RESPONSE,l.code+"",l.msg))}else I.error("[".concat(i._inspectId,"] Unexpected message type from worker")),i.emit(ni.INSPECT_RESULT,void 0,new W(k.UNEXPECTED_RESPONSE,"invalid worker message type"))});return function(a){return r.apply(this,arguments)}}()),this.workerConnection.on(Me.CLOSED,()=>{this.connectionState=Do.CLOSED}),this.workerConnection.on(Me.FAILED,()=>{this.connectionState=Do.CLOSED}),this.workerConnection.on(Me.RECONNECTING,()=>{this.connectionState=this.connectionState===Do.CONNECTED?Do.RECONNECTING:Do.CONNECTING}),this.workerConnection.on(Me.WILL_RECONNECT,(r,a,d)=>{"recover"===r&&d(r),d("tryNext")}),this.workerConnection.on(Me.REQUEST_NEW_URLS,(r,a)=>{this.workerManagerConnection.close(),this.once(ni.REQUEST_NEW_WORKER_URL,d=>{r([d])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(d=>{this.connectWorkerManager(d,!0)}).catch(d=>{a(d)})})}static intToLong(i){return{low:i|=0,high:i>>31,unsigned:i>=0}}requestToInspectImage(){var i=this;return L(function*(){i.sequence++;const r=Mr(i,ni.CLIENT_LOCAL_VIDEO_TRACK),a={appId:i._connectInfo.appId,cname:i._connectInfo.cname,cid:i._connectInfo.cid,sid:i._connectInfo.sid,uid:i._connectInfo.uid,vid:i._connectInfo.vid};if(r){if(!r.isPlaying)return void i.emit(ni.INSPECT_RESULT,void 0,new W(k.INVALID_OPERATION,"Only the track being played can be inspected"));const d=yield i.generateRequestData(r,a);i.workerConnection.sendMessage(d,!0,!0)}else i.emit(ni.INSPECT_RESULT,void 0,new W(k.INVALID_OPERATION,"Only the track being published can be inspected"))})()}generateRequestData(i,r){var a=this;return L(function*(){let{appId:d,cname:l,cid:h,vid:f,sid:_,uid:g}=r;const v=Date.now(),b=yield i.getCurrentFrameImage("image/jpeg",a.quality),y=yield N2(b,d,l),T=a.sequence+"-"+h+"-"+g+"-"+v+"-"+qe(12,""),M={appId:d,cid:h,cname:l,deviceId:"",elapse:Tb.intToLong(Number(v-a.inspectStartTime)),fileSize:y.byteLength,jpgEncryption:2,height:b.height,width:b.width,jpg:y,networkType:6,osType:7,requestId:T,sdkVersion:"4.20.0",sequence:a.sequence,sid:_,timestamp:Tb.intToLong(v),uid:g,vid:f,service:a._inspectMode,callbackData:a.extraInfo,ossFilePrefix:a.ossFilePrefix};void 0===a.extraInfo&&delete M.callbackData,void 0===a.ossFilePrefix&&delete M.ossFilePrefix;const O=function Y0(s){let i=Sb();return function(r,a){let d=r.appId;void 0!==d&&(wt(a,10),Qa(a,d));let l=r.cid;void 0!==l&&(wt(a,16),wt(a,l));let h=r.cname;void 0!==h&&(wt(a,26),Qa(a,h));let f=r.deviceId;void 0!==f&&(wt(a,34),Qa(a,f));let _=r.elapse;void 0!==_&&(wt(a,40),il(a,_));let g=r.fileSize;void 0!==g&&(wt(a,48),il(a,xu(g)));let v=r.height;void 0!==v&&(wt(a,56),il(a,xu(v)));let b=r.jpg;void 0!==b&&(wt(a,66),wt(a,b.length),function(Fi,ie){let ue=C_(Fi,ie.length);Fi.bytes.set(ie,ue)}(a,b));let y=r.networkType;void 0!==y&&(wt(a,72),il(a,xu(y)));let T=r.osType;void 0!==T&&(wt(a,80),il(a,xu(T)));let M=r.requestId;void 0!==M&&(wt(a,90),Qa(a,M));let O=r.sdkVersion;void 0!==O&&(wt(a,98),Qa(a,O));let D=r.sequence;void 0!==D&&(wt(a,104),il(a,xu(D)));let x=r.sid;void 0!==x&&(wt(a,114),Qa(a,x));let F=r.timestamp;void 0!==F&&(wt(a,120),il(a,F));let j=r.uid;void 0!==j&&(wt(a,128),wt(a,j));let Y=r.vid;void 0!==Y&&(wt(a,136),wt(a,Y));let te=r.width;void 0!==te&&(wt(a,144),il(a,xu(te)));let K=r.service;void 0!==K&&(wt(a,152),wt(a,K));let Q=r.callbackData;void 0!==Q&&(wt(a,162),Qa(a,Q));let $=r.jpgEncryption;void 0!==$&&(wt(a,168),wt(a,$));let q=r.requestType;void 0!==q&&(wt(a,176),wt(a,q));let ge=r.scorePorn;void 0!==ge&&(wt(a,185),eI(a,ge));let _e=r.scoreSexy;void 0!==_e&&(wt(a,193),eI(a,_e));let Fe=r.scoreNeutral;void 0!==Fe&&(wt(a,201),eI(a,Fe));let rt=r.scene;void 0!==rt&&(wt(a,208),wt(a,rt));let ai=r.ossFilePrefix;void 0!==ai&&(wt(a,218),Qa(a,ai));let Qt=r.serviceVendor;if(void 0!==Qt)for(let Fi of Qt){wt(a,226);let ie=Sb();HF(Fi,ie),wt(a,ie.limit),GF(a,ie),X0(ie)}}(s,i),function(r){let a=r.bytes,d=r.limit;return a.length===d?a:a.subarray(0,d)}(i)}(M);if(O.byteLength<a.workerMessageLengthLimit){if(B("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const D=function(x){for(var F=1;F<arguments.length;F++){var j=null!=arguments[F]?arguments[F]:{};F%2?Cb(Object(j),!0).forEach(function(Y){C(x,Y,j[Y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(j)):Cb(Object(j)).forEach(function(Y){Object.defineProperty(x,Y,Object.getOwnPropertyDescriptor(j,Y))})}return x}({},M);delete D.jpg,I.debug("[".concat(a._inspectId,"] Request message for worker of inspect content "),JSON.stringify(D))}return O}return a.quality=a.quality*a.qualityRatio,yield a.generateRequestData(i,{appId:d,cname:l,cid:h,vid:f,sid:_,uid:g})})()}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ze.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Do.CLOSED,this.emit(ni.STATE_CHANGE,Oo.CLOSED)}}function YF(s,i){switch(i){case 0:for(;128&Ts(s););break;case 2:tI(s,T_(s));break;case 5:tI(s,4);break;case 1:tI(s,8);break;default:throw new Error("Unimplemented type: "+i)}}function Fp(s){return{low:s|=0,high:s>>31,unsigned:s>=0}}let $F=[];function tI(s,i){if(s.offset+i>s.limit)throw new Error("Skip past limit");s.offset+=i}function XF(s){return s.offset>=s.limit}function Ib(s,i){let r=s.bytes,a=s.offset,d=s.limit,l=a+i;if(l>r.length){let h=new Uint8Array(2*l);h.set(r),s.bytes=h}return s.offset=l,l>d&&(s.limit=l),a}function VP(s,i){let r=s.offset;if(r+i>s.limit)throw new Error("Read past limit");return s.offset+=i,r}function BP(s,i){let r=Ib(s,i.length);s.bytes.set(i,r)}function jP(s,i){let r=VP(s,i),a=String.fromCharCode,d=s.bytes,l="\ufffd",h="";for(let f=0;f<i;f++){let _,g,v,b,y=d[f+r];128&y?192==(224&y)?f+1>=i?h+=l:(_=d[f+r+1],128!=(192&_)?h+=l:(b=(31&y)<<6|63&_,b<128?h+=l:(h+=a(b),f++))):224==(240&y)?f+2>=i?h+=l:(_=d[f+r+1],g=d[f+r+2],32896!=(49344&(_|g<<8))?h+=l:(b=(15&y)<<12|(63&_)<<6|63&g,b<2048||b>=55296&&b<=57343?h+=l:(h+=a(b),f+=2))):240==(248&y)?f+3>=i?h+=l:(_=d[f+r+1],g=d[f+r+2],v=d[f+r+3],8421504!=(12632256&(_|g<<8|v<<16))?h+=l:(b=(7&y)<<18|(63&_)<<12|(63&g)<<6|63&v,b<65536||b>1114111?h+=l:(b-=65536,h+=a(55296+(b>>10),56320+(1023&b)),f+=3))):h+=l:h+=a(y)}return h}function rl(s,i){let r=i.length,a=0;for(let h=0;h<r;h++){let f=i.charCodeAt(h);f>=55296&&f<=56319&&h+1<r&&(f=(f<<10)+i.charCodeAt(++h)-56613888),a+=f<128?1:f<2048?2:f<65536?3:4}xn(s,a);let d=Ib(s,a),l=s.bytes;for(let h=0;h<r;h++){let f=i.charCodeAt(h);f>=55296&&f<=56319&&h+1<r&&(f=(f<<10)+i.charCodeAt(++h)-56613888),f<128?l[d++]=f:(f<2048?l[d++]=f>>6&31|192:(f<65536?l[d++]=f>>12&15|224:(l[d++]=f>>18&7|240,l[d++]=f>>12&63|128),l[d++]=f>>6&63|128),l[d++]=63&f|128)}}function Ts(s){return s.bytes[VP(s,1)]}function HP(s,i){let r=Ib(s,1);s.bytes[r]=i}function T_(s){let i,r=0,a=0;do{i=Ts(s),r<32&&(a|=(127&i)<<r),r+=7}while(128&i);return a}function xn(s,i){for(i>>>=0;i>=128;)HP(s,127&i|128),i>>>=7;HP(s,i)}function nI(s,i){let r,a=0,d=0,l=0;return r=Ts(s),a=127&r,128&r&&(r=Ts(s),a|=(127&r)<<7,128&r&&(r=Ts(s),a|=(127&r)<<14,128&r&&(r=Ts(s),a|=(127&r)<<21,128&r&&(r=Ts(s),d=127&r,128&r&&(r=Ts(s),d|=(127&r)<<7,128&r&&(r=Ts(s),d|=(127&r)<<14,128&r&&(r=Ts(s),d|=(127&r)<<21,128&r&&(r=Ts(s),l=127&r,128&r&&(r=Ts(s),l|=(127&r)<<7))))))))),{low:a|d<<28,high:d>>>4|l<<24,unsigned:i}}function ec(s,i){let r=i.low>>>0,a=(i.low>>>28|i.high<<4)>>>0,d=i.high>>>24,l=0===d?0===a?r<16384?r<128?1:2:r<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:d<128?9:10,h=Ib(s,l),f=s.bytes;switch(l){case 10:f[h+9]=d>>>7&1;case 9:f[h+8]=9!==l?128|d:127&d;case 8:f[h+7]=8!==l?a>>>21|128:a>>>21&127;case 7:f[h+6]=7!==l?a>>>14|128:a>>>14&127;case 6:f[h+5]=6!==l?a>>>7|128:a>>>7&127;case 5:f[h+4]=5!==l?128|a:127&a;case 4:f[h+3]=4!==l?r>>>21|128:r>>>21&127;case 3:f[h+2]=3!==l?r>>>14|128:r>>>14&127;case 2:f[h+1]=2!==l?r>>>7|128:r>>>7&127;case 1:f[h]=1!==l?128|r:127&r}}const JF={},QF={},ku=4294967296,iI=ku*ku,GP=iI/2,rI=ZF(0,!0),WP=ZF(0),zP=I_(0,-2147483648,!1),qP=I_(-1,2147483647,!1),rj=I_(-1,-1,!0);function ZF(s,i){let r,a,d;return i?(d=0<=(s>>>=0)&&s<256)&&(a=QF[s],a)?a:(r=I_(s,0,!0),d&&(QF[s]=r),r):(d=-128<=(s|=0)&&s<128)&&(a=JF[s],a)?a:(r=I_(s,s<0?-1:0,!1),d&&(JF[s]=r),r)}function I_(s,i,r){return{low:0|s,high:0|i,unsigned:!!r}}function eU(s,i){if(isNaN(s))return i?rI:WP;if(i){if(s<0)return rI;if(s>=iI)return rj}else{if(s<=-GP)return zP;if(s+1>=GP)return qP}return s<0?i?rI:WP:I_(s%ku|0,s/ku|0,i)}function KP(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}class oI extends jt{get connectionState(){return this._connectionState}set connectionState(i){if(this._connectionState===i)return;const r=this._connectionState;this._connectionState=i,this.emit(ls.CONNECTION_STATE_CHANGE,i,r)}get quality(){return this._quality}set quality(i){this._quality=i>1?1:i<.1?.1:i,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(i){var r;super(),C(this,"name","AgoraRTCImageModeration"),C(this,"_connectionState",qr.CONNECTING),C(this,"_sequence",0),C(this,"_moderationStartTime",void 0),C(this,"_workerConnection",void 0),C(this,"_workerMessageLengthLimit",void 0),C(this,"_qualityRatio",void 0),C(this,"_connectInfo",void 0),C(this,"_cancelTokenSource",Ze.CancelToken.source()),C(this,"_retryConfig",void 0),C(this,"_moderationInterval",void 0),C(this,"_moderationTimer",null),C(this,"_moderationMode",1),C(this,"_quality",1),C(this,"_qualityTimer",null),C(this,"_ticket",void 0),C(this,"_moderationIntervalMinimum",void 0),C(this,"_uploadFailedNum",0),C(this,"_uploadNum",0),C(this,"_uploadTimer",null),C(this,"_extraInfo",void 0),C(this,"_vendor",""),C(this,"_encoder",new TextEncoder),C(this,"_moderationId",void 0),C(this,"inspectImage",()=>{if(this.connectionState!==qr.CONNECTED)throw new W(k.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===qr.CONNECTED?this.requestToInspectImage():I.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=qe(5,"image-moderation-"),this._workerMessageLengthLimit=B("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=B("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(r=i.interval)&&void 0!==r?r:1e3,i.extraInfo&&(this._extraInfo=this._encoder.encode(i.extraInfo)),i.vendor&&(this._vendor=i.vendor),this._qualityRatio=B("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Lm("worker-"+this._moderationId,Pn),this.on(ls.STATE_CHANGE,(a,d)=>{I.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Vd[a]," ").concat(d||""))}),this.handleWorkerEvents()}init(i,r){var a=this;return L(function*(){a.emit(ls.STATE_CHANGE,Vd.CONNECT_AP),a._connectInfo=i;const d=a._cancelTokenSource.token;return a._retryConfig=r,new X((l,h)=>{a.on(ls.CONNECTION_STATE_CHANGE,(f,_)=>{f===qr.CONNECTED&&l()}),a.requestAP(i,d,r).then(f=>{a.connectWorker(f)}).catch(f=>{h(f)})})})()}updateConfig(i){var r;this._moderationInterval=null!==(r=i.interval)&&void 0!==r?r:1e3,i.extraInfo&&(this._extraInfo=this._encoder.encode(i.extraInfo)),i.vendor&&(this._vendor=i.vendor),I.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(i))),this.connectionState===qr.CONNECTED&&this.inspectImage()}requestAP(i,r,a){var d=this;return L(function*(){const l=B("WEBCS_DOMAIN").map(g=>"https://".concat(g,"/api/v1")),h=yield function(g,v,b,y){let{appId:T,areaCode:M,cname:O,sid:D,token:x,uid:F}=v;cu++;const j="moderation_plugin",Y={service_name:j,json_body:JSON.stringify({appId:T,areaCode:M,cname:O,command:"allocateEdge",requestId:cu,seq:cu,sid:D,appToken:x,ts:Date.now(),uid:F+""})};let te,K,Q=g[0];return In(L(function*(){te=Date.now();const $=yield Ga(Q,{data:Y,cancelToken:b,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(K=Date.now()-te,0!==$.code){const _e=new W(k.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+$.code,{retry:!0,responseTime:K});throw I.error(_e.toString()),_e}const q=JSON.parse($.json_body);if(200!==q.code){const _e=new W(k.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(q.code,", reason: ").concat(q.reason),{code:q.code,responseTime:K});throw I.error(_e.toString()),_e}if(!q.servers||!Array.isArray(q.servers)||0===q.servers.length){const _e=new W(k.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:q.code,responseTime:K});throw I.error(_e.toString()),_e}if(!q.servers.some(_e=>!!_e.wss)){const _e=new W(k.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:q.code,responseTime:K});throw I.error(_e.toString()),_e}const ge=B("IMAGE_MODERATION_WORKER_HOST");return{addressList:q.servers.map(_e=>{let{address:Fe,wss:rt}=_e;if(Fe&&rt)return"wss://".concat(Fe.replace(/\./g,"-"),".").concat(ge,":").concat(rt,"/moderation")}).filter(_e=>!!_e),workerToken:q.workerToken,vid:q.vid,ticket:q.appTicket,responseTime:K}}),($,q)=>(Ie.apworkerEvent(D,{success:!0,sc:200,serviceName:j,responseDetail:JSON.stringify($.addressList),firstSuccess:0===q,responseTime:K,serverIp:g[q%g.length]}),!1),($,q)=>(Ie.apworkerEvent(D,{success:!1,sc:$.data&&$.data.code||200,serviceName:j,responseTime:K,serverIp:g[q%g.length]}),!!($.code!==k.OPERATION_ABORTED&&$.code!==k.UNEXPECTED_RESPONSE||$.data&&$.data.retry)&&(Q=g[(q+1)%g.length],!0)),y)}(l,i,r,a);d.emit(ls.STATE_CHANGE,Vd.AP_CONNECTED);const{addressList:f,ticket:_}=h;return d._ticket=_,f})()}connectWorker(i){var r=this;return L(function*(){r.emit(ls.STATE_CHANGE,Vd.CONNECT_WORKER),yield r._workerConnection.init(i,1e4)})()}handleWorkerEvents(){var i=this;this._workerConnection.on(Me.CONNECTED,L(function*(){i.emit(ls.STATE_CHANGE,Vd.WORKER_CONNECTED,i._workerConnection.url),i.connectionState=qr.CONNECTED})),this._workerConnection.on(Me.CLOSED,()=>{this.connectionState=qr.CLOSED}),this._workerConnection.on(Me.FAILED,()=>{this.connectionState=qr.CLOSED}),this._workerConnection.on(Me.RECONNECTING,()=>{this.connectionState=this.connectionState===qr.CONNECTED?qr.RECONNECTING:qr.CONNECTING}),this._workerConnection.on(Me.ON_MESSAGE,function(){var r=L(function*(a){if(a.data instanceof ArrayBuffer){const d=function KF(s){return function(r){let a={};e:for(;!XF(r);){let d=T_(r);switch(d>>>3){case 0:break e;case 1:a.code=T_(r);break;case 2:a.msg=jP(r,T_(r));break;case 3:a.requestId=jP(r,T_(r));break;case 4:a.timestamp=nI(r,!1);break;default:YF(r,7&d)}}return a}({bytes:i=s,offset:0,limit:i.length});var i}(new Uint8Array(a.data));B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&I.debug("[".concat(i._moderationId,"] Response message for worker of image moderation "),JSON.stringify(d)),i._uploadNum++,void 0===d.code||0===d.code||(i._uploadFailedNum++,I.error("[".concat(i._moderationId,"] Error response from worke, code is ").concat(d.code,", msg is ").concat(d.msg)),i._uploadTimer||(i._uploadTimer=window.setTimeout(()=>{Ie.reportApiInvoke(i._connectInfo.sid||null,{name:qn.IMAGE_MODERATION_UPLOAD,options:[i._uploadFailedNum,i._uploadNum,d.code],tag:Kt.TRACER}).onError(new W(k.IMAGE_MODERATION_UPLOAD_FAILED,d.msg)),i._uploadTimer=null},B("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else I.error("[".concat(i._moderationId,"] Unexpected message type from worker"))});return function(a){return r.apply(this,arguments)}}()),this._workerConnection.on(Me.WILL_RECONNECT,(r,a,d)=>{"recover"===r&&d(r),d("tryNext")}),this._workerConnection.on(Me.REQUEST_NEW_URLS,(r,a)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(a)})}static intToLong(i){return{low:i|=0,high:i>>31,unsigned:i>=0}}requestToInspectImage(){var i=this;return L(function*(){const r=Mr(i,ls.CLIENT_LOCAL_VIDEO_TRACK),a={appId:i._connectInfo.appId,cname:i._connectInfo.cname,cid:i._connectInfo.cid,sid:i._connectInfo.sid,uid:i._connectInfo.uid,vid:i._connectInfo.vid};if(r){if(!r.isPlaying)return void(B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&I.debug("Only the track being played can be inspected"));i._sequence++;const d=yield i.generateRequestData(r,a);i._workerConnection.sendMessage(d,!0,!0)}else B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&I.debug("Only the track being published can be inspected")})()}generateRequestData(i,r){var a=this;return L(function*(){let{appId:d,cname:l,cid:h,vid:f,sid:_,uid:g}=r;const v=Date.now(),b=yield i.getCurrentFrameImage("image/jpeg",a.quality),y=yield N2(b,d,l),T=a._sequence+"-"+h+"-"+g+"-"+v+"-"+qe(12,""),M={appId:d,cid:h,cname:l,deviceId:"",elapse:oI.intToLong(Number(v-a._moderationStartTime)),fileSize:b.buffer.byteLength,height:b.height,width:b.width,jpg:y,networkType:6,osType:7,requestId:T,sdkVersion:"4.20.0",sequence:a._sequence,sid:_,timestamp:eU(v),uid:g,vid:f,service:a._moderationMode,ticket:a._ticket,callbackData:a._extraInfo,vendorConfigs:a._vendor};void 0===a._extraInfo&&delete M.callbackData;const O=function qF(s){let i=function(){const r=$F.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(r,a){let d=r.appId;void 0!==d&&(xn(a,10),rl(a,d));let l=r.cid;void 0!==l&&(xn(a,16),xn(a,l));let h=r.cname;void 0!==h&&(xn(a,26),rl(a,h));let f=r.deviceId;void 0!==f&&(xn(a,34),rl(a,f));let _=r.elapse;void 0!==_&&(xn(a,40),ec(a,_));let g=r.fileSize;void 0!==g&&(xn(a,48),ec(a,Fp(g)));let v=r.height;void 0!==v&&(xn(a,56),ec(a,Fp(v)));let b=r.jpg;void 0!==b&&(xn(a,66),xn(a,b.length),BP(a,b));let y=r.networkType;void 0!==y&&(xn(a,72),ec(a,Fp(y)));let T=r.osType;void 0!==T&&(xn(a,80),ec(a,Fp(T)));let M=r.requestId;void 0!==M&&(xn(a,90),rl(a,M));let O=r.sdkVersion;void 0!==O&&(xn(a,98),rl(a,O));let D=r.sequence;void 0!==D&&(xn(a,104),ec(a,Fp(D)));let x=r.sid;void 0!==x&&(xn(a,114),rl(a,x));let F=r.timestamp;void 0!==F&&(xn(a,120),ec(a,F));let j=r.uid;void 0!==j&&(xn(a,128),xn(a,j));let Y=r.vid;void 0!==Y&&(xn(a,136),xn(a,Y));let te=r.width;void 0!==te&&(xn(a,144),ec(a,Fp(te)));let K=r.service;void 0!==K&&(xn(a,152),xn(a,K));let Q=r.callbackData;void 0!==Q&&(xn(a,162),xn(a,Q.length),BP(a,Q));let $=r.ticket;void 0!==$&&(xn(a,170),rl(a,$));let q=r.vendorConfigs;void 0!==q&&(xn(a,178),rl(a,q))}(s,i),function(r){let a=r.bytes,d=r.limit;return a.length===d?a:a.subarray(0,d)}(i)}(M);if(O.byteLength<a._workerMessageLengthLimit){if(B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const D=function(x){for(var F=1;F<arguments.length;F++){var j=null!=arguments[F]?arguments[F]:{};F%2?KP(Object(j),!0).forEach(function(Y){C(x,Y,j[Y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(j)):KP(Object(j)).forEach(function(Y){Object.defineProperty(x,Y,Object.getOwnPropertyDescriptor(j,Y))})}return x}({},M);delete D.jpg,I.debug("[".concat(a._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(D))}return O}return a.quality=a.quality*a._qualityRatio,yield a.generateRequestData(i,{appId:d,cname:l,cid:h,vid:f,sid:_,uid:g})})()}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ze.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=qr.CLOSED,this.emit(ls.STATE_CHANGE,Vd.CLOSED)}}function YP(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function $P(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?YP(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):YP(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}const oj=Date.now(),sI=20,XP=new Map,wb=new Map;function JP(s){return aI.apply(this,arguments)}function aI(){return aI=L(function*(s){const i=XP.get(s),r=Array.isArray(i)&&i[i.length-1],a=wb.get(s);if(!r)return void(a.isSyncing=!1);const d={uid:r.uid,payload:gm(r.payload)};0===a.firstRecvTs&&(a.firstRecvTs=r.recvTs,a.firstSendTs=r.sendTs);const l=r.sendTs-a.firstSendTs,h=l-(Date.now()-a.firstRecvTs);h>0&&(a.firstRecvTs=Date.now()-l);let f=r.mediaDelay+h;f<=0?(i.pop(),w_(r.context,d),f=0):f=Math.min(f,sI),setTimeout(()=>i.length&&JP(s),f)}),aI.apply(this,arguments)}function w_(s,i){s.safeEmit($e.STREAM_MESSAGE,i.uid,i.payload),s.onStreamMessage&&s.onStreamMessage(i)}const sj=lt().name;function QP(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function ol(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?QP(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):QP(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}gi.setLogger(I);class Mt extends jt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var i;return(null===(i=this._config)||void 0===i?void 0:i.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(i){var r;let a;if(super(),r=this,C(this,"store",void 0),C(this,"_uid",void 0),C(this,"_channelName",void 0),C(this,"_uintUid",void 0),C(this,"_users",[]),C(this,"_config",void 0),C(this,"_clientId",void 0),C(this,"_appId",void 0),C(this,"_sessionId",null),C(this,"_key",void 0),C(this,"_rtmConfig",{}),C(this,"_joinInfo",void 0),C(this,"_gateway",void 0),C(this,"_statsCollector",void 0),C(this,"_configDistribute",void 0),C(this,"_leaveMutex",new gi("client-leave")),C(this,"_publishMutex",new gi("client-publish")),C(this,"_renewTokenMutex",new gi("client-renewtoken")),C(this,"_subscribeMutex",new gi("client-subscribe")),C(this,"_encryptionMode","none"),C(this,"_encryptionSecret",null),C(this,"_encryptionSalt",null),C(this,"_proxyServer",void 0),C(this,"_turnServer",{servers:[],mode:"auto"}),C(this,"_cloudProxyServerMode","disabled"),C(this,"_isDualStreamEnabled",!1),C(this,"_defaultStreamFallbackType",void 0),C(this,"_lowStreamParameter",void 0),C(this,"_streamFallbackTypeCacheMap",new Map),C(this,"_remoteStreamTypeCacheMap",new Map),C(this,"_axiosCancelSource",Ze.CancelToken.source()),C(this,"_audioVolumeIndicationInterval",void 0),C(this,"_networkQualityInterval",void 0),C(this,"_userOfflineTimeout",void 0),C(this,"_streamRemovedTimeout",void 0),C(this,"_injectStreamingClient",void 0),C(this,"_liveTranscodeStreamingClient",void 0),C(this,"_liveRawStreamingClient",void 0),C(this,"_channelMediaRelayClient",void 0),C(this,"_networkQualitySensitivity","normal"),C(this,"_p2pChannel",void 0),C(this,"_useLocalAccessPoint",!1),C(this,"_setLocalAPVersion",void 0),C(this,"_joinAndNotLeaveYet",!1),C(this,"_numberOfJoinCount",0),C(this,"_remoteDefaultVideoStreamType",void 0),C(this,"_inspect",void 0),C(this,"_moderation",void 0),C(this,"_license",void 0),C(this,"_pendingPublishedUsers",[]),C(this,"ntpAlignErrorCount",0),C(this,"remoteInboundOffset",0),C(this,"_handleLocalTrackEnable",(d,l,h)=>{this.publish(d,!1).then(l).catch(h)}),C(this,"_handleLocalTrackDisable",(d,l,h)=>{this.unpublish(d).then(l).catch(h)}),C(this,"_handleUserOnline",d=>{if(B("BLOCK_LOCAL_CLIENT")&&ou(d.uid,this.channelName))return void I.debug("[".concat(d.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof d.uid&&I.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const l=this._users.find(h=>h.uid===d.uid);if(l)l._trust_in_room_=!0,l._is_pre_created&&(l._is_pre_created=!1,this.safeEmit($e.USER_JOINED,l));else{const h=new Ii(d.uid,d.uint_id||d.uid);this._users.push(h),I.debug("[".concat(this._clientId,"] user online"),d.uid),this.safeEmit($e.USER_JOINED,h)}}),C(this,"_handleUserOffline",d=>{if(B("BLOCK_LOCAL_CLIENT")&&ou(d.uid,this.channelName))return;const l=this._users.find(h=>h.uid===d.uid);l&&(this._handleRemoveStream(d),this._handleRemoveDataChannels(d),l._audio_pre_subscribed||l._video_pre_subscribed?l._is_pre_created=!0:mm(this._users,l),this._remoteStreamTypeCacheMap.delete(l.uid),this._streamFallbackTypeCacheMap.delete(l.uid),I.debug("[".concat(this._clientId,"] user offline"),d.uid,"reason:",d.reason),this.safeEmit($e.USER_LEAVED,l,d.reason))}),C(this,"_handleAddAudioOrVideoStream",(d,l,h,f,_,g,v)=>{if(B("BLOCK_LOCAL_CLIENT")&&ou(l,this.channelName))return;const b=this._users.find(T=>T.uid===l);if(!b)return void I.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));I.debug("[".concat(this._clientId,"] stream added with uid ").concat(l,", type ").concat(d)),this.store.subscribe(b.uid,d,void 0,void 0,void 0,Date.now());const y="audio"===d?b.hasAudio:b.hasVideo;b._uintid||(b._uintid=_||l),"audio"===d?b._trust_audio_stream_added_state_=!0:b._trust_video_stream_added_state_=!0,"audio"===d?(b._audio_added_=!0,void 0!==h&&(b._audioSSRC=h),void 0!==f&&(b._cname=f),g&&(b._audioOrtc=g)):(b._video_added_=!0,void 0!==h&&(b._videoSSRC=h),void 0!==f&&(b._cname=f),void 0!==v&&(b._rtxSsrcId=v),g&&(b._videoOrtc=g)),("audio"===d?b.hasAudio:b.hasVideo)&&!y&&(I.info("[".concat(this._clientId,"] remote user ").concat(b.uid," published ").concat(d)),this.safeEmit($e.USER_PUBLISHED,b,d)),"video"===d?Ie.onGatewayStream(this._sessionId,ti.ON_ADD_VIDEO_STREAM,Gt.ON_ADD_VIDEO_STREAM,{peer:_||l,ssrc:b._videoSSRC}):Ie.onGatewayStream(this._sessionId,ti.ON_ADD_AUDIO_STREAM,Gt.ON_ADD_AUDIO_STREAM,{peer:_||l,ssrc:b._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(b,d,h).then(T=>{if(T&&(I.debug("[".concat(this._clientId,"] resubscribe ").concat(d," for user ").concat(b.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof si))return this._p2pChannel.unsubscribe(b,d,!0).then(()=>this._subscribe(b,d,!0).catch(M=>{I.error("[".concat(this._clientId,"] resubscribe error"),M.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(b,d)&&(I.debug("[".concat(this._clientId,"] resubscribe ").concat(d," for user ").concat(b.uid," after reconnect.")),this._subscribe(b,d,!0).catch(T=>{I.error("[".concat(this._clientId,"] resubscribe error"),T.toString())}))}),C(this,"_handleRemoveStream",d=>{if(B("BLOCK_LOCAL_CLIENT")&&ou(d.uid,this.channelName))return;const l=this._users.find(f=>f.uid===d.uid);if(!l)return void I.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));I.debug("[".concat(this._clientId,"] stream removed with uid ").concat(d.uid));let h=()=>{};l.hasAudio&&l.hasVideo?h=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit($e.USER_UNPUBLISHED,l,"audio"),I.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit($e.USER_UNPUBLISHED,l,"video")}:l.hasVideo?h=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit($e.USER_UNPUBLISHED,l,"video")}:l.hasAudio&&(h=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit($e.USER_UNPUBLISHED,l,"audio")}),l._video_pre_subscribed||l._audio_pre_subscribed||(l._trust_audio_stream_added_state_=!0,l._trust_video_stream_added_state_=!0,l._audio_added_=!1,l._video_added_=!1,this._p2pChannel instanceof si&&this._p2pChannel.unsubscribe(l).then(f=>{if(f)return this._gateway.unsubscribe(f,l.uid)}),l._audioSSRC=void 0,l._videoSSRC=void 0,l._audioOrtc=void 0,l._videoOrtc=void 0,l._rtxSsrcId=void 0),Ie.onGatewayStream(this._sessionId,ti.ON_REMOVE_STREAM,Gt.ON_REMOVE_STREAM,{peer:d.uint_id||d.uid}),h()}),C(this,"_handleSetStreamLocalEnable",(d,l,h)=>{if(B("BLOCK_LOCAL_CLIENT")&&ou(l,this.channelName))return;const f=this._users.find(v=>v.uid===l);if(!f)return void I.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));I.debug("[".concat(this._clientId,"] local ").concat(d," ").concat(h?"enabled":"disabled"," with uid ").concat(l));const _="audio"===d?f.hasAudio:f.hasVideo;if("audio"===d){f._trust_audio_enabled_state_=!0;const v=f._audio_enabled_;if(f._audio_enabled_=h,f._audio_enabled_===v)return;{const b=f._audio_enabled_?"enable-local-audio":"disable-local-audio";I.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(l,", msg: ").concat(b)),this.safeEmit($e.USER_INFO_UPDATED,l,b)}}else{f._trust_video_enabled_state_=!0;const v=f._video_enabled_;if(f._video_enabled_=h,f._video_enabled_===v)return;{const b=f._video_enabled_?"enable-local-video":"disable-local-video";I.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(b)),this.safeEmit($e.USER_INFO_UPDATED,l,b)}}const g="audio"===d?f.hasAudio:f.hasVideo;return _!==g?!_&&g?(I.info("[".concat(this._clientId,"] remote user ").concat(l," published ").concat(d)),void this.safeEmit($e.USER_PUBLISHED,f,d)):("video"===d&&f._videoTrack&&f._videoTrack._destroy(),this._p2pChannel.muteRemote(f,d),I.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished ").concat(d)),void this.safeEmit($e.USER_UNPUBLISHED,f,d)):void 0}),C(this,"_handleMuteStream",(d,l,h)=>{if(B("BLOCK_LOCAL_CLIENT")&&ou(d,this.channelName))return;I.debug("[".concat(this._clientId,"] receive mute message"),d,l,h);const f=this._users.find(v=>v.uid===d);if(!f)return void I.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(d));const _="audio"===l?f.hasAudio:f.hasVideo;if("audio"===l){f._trust_audio_mute_state_=!0;const v=f._audio_muted_;if(f._audio_muted_=h,f._audio_muted_===v)return;{const b=f._audio_muted_?"mute-audio":"unmute-audio";I.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(b)),this.safeEmit($e.USER_INFO_UPDATED,d,b)}}else{f._trust_video_mute_state_=!0;const v=f._video_muted_;if(f._video_muted_=h,f._video_muted_===v)return;{const b=f._video_muted_?"mute-video":"unmute-video";I.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(b)),this.safeEmit($e.USER_INFO_UPDATED,d,b)}}const g="audio"===l?f.hasAudio:f.hasVideo;if(_!==g){if(!_&&g)return("audio"===l?f._audioSSRC:f._videoSSRC)?(I.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(l)),void this.safeEmit($e.USER_PUBLISHED,f,l)):void I.warning("[".concat(this._clientId,"] remote user ").concat(d," receive ").concat(l," unmute message  before add stream message, ").concat(l," SSRC doesn't exist yet."));"video"===l&&f._videoTrack&&!f._video_pre_subscribed&&f._videoTrack._destroy(),this._p2pChannel.muteRemote(f,l),I.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(l)),this.safeEmit($e.USER_UNPUBLISHED,f,l)}}),C(this,"_handleP2PLost",function(){var d=L(function*(l){I.debug("[".concat(r._clientId,"] receive p2p lost"),l),parseInt(l.p2pid,10)===r.store.p2pId?yield r._p2pChannel.requestReconnect():I.warning("[".concat(r._clientId,"] P2PLost stream not found"),l)});return function(l){return d.apply(this,arguments)}}()),C(this,"_handleTokenWillExpire",()=>{I.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit($e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),C(this,"_handleBeforeUnload",d=>{"beforeunload"===d.type&&void 0!==d.returnValue&&""!==d.returnValue||(this.leave(),I.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),C(this,"_handleUpdateNetworkQuality",()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit($e.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const d={downlinkNetworkQuality:0,uplinkNetworkQuality:0};d.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),d.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit($e.NETWORK_QUALITY,d)}),C(this,"_handleP2PAddAudioOrVideoStream",(d,l,h,f)=>{const _=this._users.find(v=>v.uid===l);if(!_)return void I.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));I.debug("[".concat(this._clientId,"] stream added with uid ").concat(l,", type ").concat(d)),this.store.subscribe(_.uid,d,void 0,void 0,void 0,Date.now());const g="audio"===d?_.hasAudio:_.hasVideo;"audio"===d?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,"audio"===d?(_._audio_added_=!0,void 0!==h&&(_._audioSSRC=h),void 0!==f&&(_._audioMid=f)):(_._video_added_=!0,void 0!==h&&(_._videoSSRC=h),void 0!==f&&(_._videoMid=f)),("audio"===d?_.hasAudio:_.hasVideo)&&!g&&(I.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(d)),this.safeEmit($e.USER_PUBLISHED,_,d)),this._p2pChannel.hasPendingRemoteMedia(_,d)&&(I.debug("[".concat(this._clientId,"] resubscribe ").concat(d," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,d,!0).catch(v=>{I.error("[".concat(this._clientId,"] resubscribe error"),v.toString())}))}),this._config=i,this._clientId=qe(5,"client-"),this.store=new PO(i.codec,i.audioCodec,i.mode,this._clientId),this.store.clientCreated(),i.proxyServer&&this.setProxyServer(i.proxyServer,!0),i.turnServer&&this.setTurnServer(i.turnServer,!0),I.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Ao," build: ").concat(mT,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),i.clientRoleOptions)try{WC(i.clientRoleOptions),a=Object.assign({},i.clientRoleOptions)}catch(d){I.warning("[".concat(this._clientId,"] ").concat(d.toString()))}this._statsCollector=new ys(this.store),this._statsCollector.onStatsException=(d,l,h)=>{I.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(d,", msg: ").concat(l,", uid: ").concat(h)),this.safeEmit($e.EXCEPTION,{code:d,msg:l,uid:h})},this._statsCollector.onUploadPublishDuration=(d,l,h,f)=>{const _=this._users.find(g=>g.uid===d);_&&Ie.peerPublishStatus(this._sessionId,{subscribeElapse:f,audioPublishDuration:l,videoPublishDuration:h,peer:_._uintid})},this.store.useDataChannel=Ot().supportDataChannel&&B("SIGNAL_CHANNEL"),this.store.useP2P="p2p"===i.mode,this._gateway=new rN(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:i.websocketRetryConfig||Pn,httpRetryConfig:i.httpRetryConfig||Pn,forceWaitGatewayResponse:void 0===i.forceWaitGatewayResponse||i.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:i.role,clientRoleOptions:a}),this._configDistribute=new pN,this.store.useP2P?(this._p2pChannel=new Je(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new si(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}joinMeta(i,r,a,d,l){var h=arguments,f=this;return L(function*(){let _=!(h.length>5&&void 0!==h[5])||h[5],g=h.length>6&&void 0!==h[6]&&h[6];It("JOIN_GATEWAY_USE_443PORT_ONLY",_),It("JOIN_GATEWAY_USE_DUAL_DOMAIN",g);const v=f._gateway.signal.websocket;return v instanceof pp&&(v.use443PortOnly=_,v.tryDoubleDomain=g),(b=L(function*(y,T,M){zE.get(y)||zE.set(y,[]),lm.get(y)||lm.set(y,T),Nt.get(y)||Nt.set(y,0);const O=zE.get(y),D=lm.get(y);if(!O||!D)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Nt.get(y)===D){const te=dm();O.push(te),yield te.promise}Nt.set(y,Nt.get(y)+1);for(var x=arguments.length,F=new Array(x>3?x-3:0),j=3;j<x;j++)F[j-3]=arguments[j];const Y=yield M(...F);return Nt.set(y,Nt.get(y)-1),Nt.get(y)===D-1&&O.length>0&&(O[0].resolve(),O.shift()),0===Nt.get(y)&&(zE.set(y,[]),lm.set(y,0),Nt.set(y,0)),Y}),function(y,T,M){return b.apply(this,arguments)})("client.join",B("JOIN_MAX_CONCURRENCY"),f.join.bind(f),i,r,a,d,l);var b})()}join(i,r,a,d,l){var h=this;return L(function*(){const f=++h._numberOfJoinCount;h.store.joinStart(),d&&(h.store.uid=d);const _="HTTPS"===(Ht||Ht||(Ht=(window.location.protocol.split(":")[0]||"").toUpperCase(),Ht)),g=pT()?window.isSecureContext:"Browser Not Support";(!pT()&&!_||!window.isSecureContext)&&I.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");const v=Dc();"DISCONNECTED"===h.connectionState&&(h.store.avoidJoinStart=Math.round(Date.now()),I.debug("[".concat(h._clientId,"] set avoidJoinStart to ").concat(h.store.avoidJoinStart)));const b=Ie.reportApiInvoke(v,{name:qn.JOIN,options:[i,r,a,d],states:{isHttps:_,isSecureContext:g},tag:Kt.TRACER});Ie.setAppId(i);try{if(!a&&null!==a)throw new W(k.INVALID_PARAMS,"Invalid token: ".concat(a,". If you don not use token, set it to null"));a&&hi(a,"token",1,2047),hi(i,"appid",1,2047),jO(r),d&&bv(d),l&&hi(l,"optionalInfo",1,2047)}catch(D){throw b.onError(D),D}if(I.info("[".concat(h._clientId,"] start join channel ").concat(r,", join number: ").concat(f)),h._leaveMutex.isLocked&&(I.debug("[".concat(h._clientId,"] join: waiting leave operation")),(yield h._leaveMutex.lock())(),I.debug("[".concat(h._clientId,"] join: continue"))),h._joinAndNotLeaveYet=!0,"DISCONNECTED"!==h.connectionState){const D=new W(k.INVALID_OPERATION,"[".concat(h._clientId,"] Client already in connecting/connected state"));throw b.onError(D),D}h._sessionId||(h._sessionId=v,h.store.sessionId=h._sessionId),h._gateway.state="CONNECTING";const y=ol(ol({},h._rtmConfig),{},{clientId:h._clientId,appId:i,sid:h._sessionId,cname:r,uid:"string"!=typeof d?d:null,turnServer:h._turnServer,proxyServer:h._proxyServer,token:a||i,cloudProxyServer:h._cloudProxyServerMode,optionalInfo:l,license:h._license,useLocalAccessPoint:h._useLocalAccessPoint},void 0!==h._remoteDefaultVideoStreamType&&{defaultVideoStream:h._remoteDefaultVideoStreamType});if(h._useLocalAccessPoint&&(y.setLocalAPVersion=h._setLocalAPVersion),"string"==typeof d&&(y.stringUid=d,h._uintUid?(y.uid=h._uintUid,h._uintUid=void 0):y.uid=0),"none"!==h._encryptionMode&&h._encryptionSecret){if(y.aesmode=h._encryptionMode,y.aespassword=yield fm(h._encryptionSecret),!h._joinAndNotLeaveYet)throw new W(k.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));h._encryptionSalt&&(y.aessalt=h._encryptionSalt)}h._startSession(h._sessionId,{channel:r,appId:i,stringUid:y.stringUid});const T=h._sessionId;setTimeout(()=>{"CONNECTING"===h.connectionState&&T===h._sessionId&&Ie.joinChannelTimeout(h._sessionId,5)},5e3);try{var M;let D;const x=y.cloudProxyServer;if(ye(M=["proxy3","proxy4","proxy5"]).call(M,x)){const K=B("PROXY_SERVER_TYPE3");y.proxyServer=Array.isArray(K)?K[0]:K}if(Ie.setProxyServer(y.proxyServer),I.setProxyServer(y.proxyServer),h.store.requestAPStart(),y.stringUid&&!y.uid){let K;[K,D]=yield X.all([ar(y.stringUid,y,h._axiosCancelSource.token,h._config.httpRetryConfig||Pn,h.store),ha(y,h._axiosCancelSource.token,h._config.httpRetryConfig||Pn,!0,h.store)]),I.debug("[".concat(h._clientId,"] getUserAccount Success ").concat(y.stringUid," => ").concat(K)),y.uid=K,D.gatewayInfo.uid=K,D.gatewayInfo.res.uid=K}else D=yield ha(y,h._axiosCancelSource.token,h._config.httpRetryConfig||Pn,!0,h.store);if(!h._joinAndNotLeaveYet)throw new W(k.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));h.store.requestAPEnd(),setTimeout(()=>{h._configDistribute.startGetConfigDistribute(y,h._axiosCancelSource.token),h._configDistribute.on(Nm.UPDATE_BITRATE_LIMIT,K=>{h._p2pChannel.updateBitrateLimit(K)})},0),h._key=a||i;const F=D.gatewayInfo,j=y.uid?y.uid:F.uid;h._joinInfo=ol(ol({},y),{},{cid:F.cid,uid:j,vid:F.vid,apResponse:F.res,uni_lbs_ip:F.uni_lbs_ip,gatewayAddrs:F.gatewayAddrs}),h.store.intUid=j;const Y=yield h._joinGateway();if(!h._joinAndNotLeaveYet)throw new W(k.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));b.onSuccess(Y),h._appId=i,h._channelName=y.cname,h._uid=Y,h.store.uid=Y,setTimeout(()=>{h._networkQualityInterval&&window.clearInterval(h._networkQualityInterval),h._networkQualityInterval=window.setInterval(h._handleUpdateNetworkQuality,2e3),window.addEventListener(fr()?"beforeunload":"pagehide",h._handleBeforeUnload)},0);const te=y.stringUid?"string uid: ".concat(y.stringUid,",uid: ").concat(y.uid):"uid: ".concat(h._uid);return I.info("[".concat(h._clientId,"] Joining channel success: channel: ").concat(r,",").concat(te)),setTimeout(()=>{I.startUpload()},5e3),h.store.joinEnd(),O=h,ye(Fd).call(Fd,O)||Fd.push(O),Y}catch(D){const x=Array.isArray(D)?D[0]:D;throw x&&x.code===k.OPERATION_ABORTED?I.warning("[".concat(h._clientId,"] join number: ").concat(f,", Joining channel failed, rollback"),x):I.error("[".concat(h._clientId,"] join number: ").concat(f,", Joining channel failed, rollback"),x),x.code!==k.OPERATION_ABORTED&&h._numberOfJoinCount===f&&(h._gateway.state="DISCONNECTED",h._reset()),b.onError(x),x}var O})()}_joinGateway(){if(!this._joinInfo||!this._key)throw new W(k.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!B("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(i=>i).catch(i=>{if(i.code===k.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,ze.FALLBACK),i;if(i.code===k.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,ze.FALLBACK),i;throw i}).then(i=>{if(i instanceof W){if(i.code===k.INIT_WEBSOCKET_TIMEOUT){if(I.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new W(k.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const r=B("PROXY_SERVER_TYPE3");if(Array.isArray(r))if(this._joinInfo.apUrl){const d=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),l=d.slice(d.length-2).join(".");r.forEach(h=>{this._joinInfo&&ye(h).call(h,l)&&(this._joinInfo.proxyServer=h)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=r[0])}else this._joinInfo.proxyServer=r[0];else this._joinInfo.proxyServer=r;const a=B("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return a&&a[1]&&"443"!==a[1]&&I.setProxyServer(this._joinInfo.proxyServer),"443"!==B("STATS_COLLECTOR_PORT").toString()&&Ie.setProxyServer(this._joinInfo.proxyServer),Ie.reportApiInvoke(this._sessionId,{name:qn.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:Kt.TRACER}).onSuccess(),this.safeEmit($e.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),B("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(d=>{"forceturn"in d&&(d.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(I.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new W(k.INVALID_OPERATION);return Ie.reportApiInvoke(this._sessionId,{name:qn.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:Kt.TRACER}).onSuccess(),this._joinGateway()}return i}).then(i=>i)}leave(){var i=this;return L(function*(){I.info("[".concat(i._clientId,"] Leaving channel")),window.removeEventListener(fr()?"beforeunload":"pagehide",i._handleBeforeUnload),i._reset(),function(a){const d=Fd.indexOf(a);-1!==d&&Fd.splice(d,1)}(i);const r=yield i._leaveMutex.lock();if("DISCONNECTED"===i.connectionState)return I.info("[".concat(i._clientId,"] Leaving channel repeated, success")),void r();yield i._gateway.leave("CONNECTED"!==i.connectionState),I.info("[".concat(i._clientId,"] Leaving channel success")),i._joinAndNotLeaveYet=!1,i.store.resetJoinChannelServiceRecords(),r()})()}publish(i){var r=arguments,a=this;return L(function*(){let d=!(r.length>1&&void 0!==r[1])||r[1];if(!Array.isArray(i)){if(!(i instanceof Bi))return a._publishDataChannel(i);i=[i]}if(0===i.length)throw new W(k.INVALID_PARAMS,"param list is empty");const l=i;if("audience"===a._gateway.role)throw new W(k.INVALID_OPERATION,"audience can not publish stream");for(const f of l){if(!(f instanceof Bi))throw new W(k.INVALID_PARAMS,"parameter is not local track");if(!f._enabled&&d)throw new W(k.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(f.getTrackId()))}I.info("[".concat(a._clientId,"] Publishing tracks, id ").concat(l.map(f=>"".concat(f.getTrackId()," "))));const h=yield a._publishMutex.lock();yield a._configDistribute.awaitConfigDistributeComplete(),d&&l.forEach(f=>{const _=a._configDistribute.getBitrateLimit();f instanceof je&&_&&f.setBitrateLimit(_.uplink)});try{yield a._publishHighStream(l),I.info("[".concat(a._clientId,"] Publish success, id ").concat(l.map(f=>"".concat(f.getTrackId()," "))))}catch(f){throw I.error("[".concat(a._clientId,"] publish error"),f.toString()),f}finally{h()}})()}_publishDataChannel(i){var r=this;return L(function*(){At(i.id,"id",0,65535,!0),Rc(i.ordered,"ordered"),hi(i.metadata,"metadata",0,512),I.info("[".concat(r._clientId,"] Publishing datachannels, id ").concat(i.id));const a=yield r._publishMutex.lock();try{if(-1!==r._p2pChannel.getAllDataChannels().findIndex(l=>l.id===i.id))throw new W(k.INVALID_PARAMS,"Invalid id: ".concat(i.id,". If you want to republish the datachannel, unpublish first"));if(!r._joinInfo||void 0===r._uid)throw new W(k.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new W(k.INVALID_OPERATION,"can not publish datachannel in ".concat(r.connectionState," state"));if("auto"===r._turnServer.mode&&B("FORCE_TURN")&&!B("TURN_ENABLE_TCP")&&!B("TURN_ENABLE_UDP"))throw new W(k.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const d=new _F(i);yield r._p2pChannel.publishDataChannel([d]);try{const l={streamId:i.id,ordered:i.ordered,maxRetransmits:B("DATASTREAM_MAX_RETRANSMITS"),metadata:i.metadata,channelId:d._originDataChannelId};yield r._gateway.publishDataChannel(r._uid,l,!0)}catch(l){if(l.code!==k.DISCONNECT_P2P)throw l}return yield d._waitTillOpen(),I.info("[".concat(r._clientId,"] Publish dataChannels success, id ").concat(d.id)),d}catch(d){throw I.error("[".concat(r._clientId,"] publish datachannels error"),d.toString()),d}finally{a()}})()}unpublish(i){var r=this;return L(function*(){if(!r._joinInfo||void 0===r._uid)throw new W(k.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let a=[];if(i)if(Array.isArray(i))a=i;else{if(!(i instanceof Bi))return r._unpublishDataChannel([i]);a=[i]}else r.store.useP2P||(yield r._unpublishDataChannel()),a=r._p2pChannel.getAllTracks(!0);I.info("[".concat(r._clientId,"] Unpublish tracks, tracks ").concat(a.map(l=>"".concat(l.getTrackId()," "))," "));const d=yield r._publishMutex.lock();try{if(r._p2pChannel instanceof Je){const l=yield r._p2pChannel.unpublish(a);l&&(yield r._gateway.sendExtensionMessage(fn.UNPUBLISH,{unpubMsg:l},!0))}else{const l=yield r._p2pChannel.unpublish(a);l&&(yield r._gateway.unpublish(l,r._uid)),I.info("[".concat(r._clientId,"] Unpublish success,tracks ").concat(a.map(h=>"".concat(h.getTrackId()))))}}catch(l){throw I.error("[".concat(r._clientId,"] unpublish error"),l.toString()),l}finally{d&&d()}})()}_unpublishDataChannel(i){var r=this;return L(function*(){void 0!==i&&0!==i.length||(i=r._p2pChannel.getAllDataChannels()),I.info("[".concat(r._clientId,"] Unpublish datachannels, datachannels ").concat(i.map(d=>"".concat(d.id," "))," "));const a=yield r._publishMutex.lock();try{const d=yield r._p2pChannel.unpublishDataChannel(i);d&&(yield r._gateway.unpublishDataChannel(d)),I.info("[".concat(r._clientId,"] Unpublish dataChannel success,dataChannel ").concat(i.map(l=>"".concat(l.id))))}catch(d){throw I.error("[".concat(r._clientId,"] unpublish dataChannel error"),d.toString()),d}finally{a&&a()}})()}subscribe(i,r,a){var d=this;return L(function*(){return"datachannel"===r?d._subscribeDataChannel(i,a):d._subscribe(i,r)})()}presubscribe(i,r){var a=this;return L(function*(){if(Cn(r,"mediaType",["audio","video"]),a._p2pChannel instanceof Je)throw new W(k.INVALID_OPERATION,"can't presub at p2p mode");if(!a._joinInfo)throw new W(k.INVALID_OPERATION,"can't presub when not join");if("CONNECTED"!==a.connectionState&&"RECONNECTING"!==a.connectionState)throw new W(k.INVALID_OPERATION,"can't presub in ".concat(a.connectionState," state"));const d=r===Se.AUDIO,l=r===Se.VIDEO,h=yield a._subscribeMutex.lock();try{const{ssrcId:f,ortc:_,rtxSsrcId:g,cname:v,uint_id:b}=yield a._gateway.presubscribe(i,r,!0);if(null==f)throw new W(k.UNEXPECTED_RESPONSE,"no ssrc id");let y=a._users.find(M=>M.uid===i);y||(y=new Ii(i,b||i),y._is_pre_created=!0,a._users.push(y)),v&&(y._cname=v),y._uintid||(y._uintid=b||i),d&&(y._audioSSRC=f,y._audio_pre_subscribed=!0,_&&(y._audioOrtc=_)),l&&(y._videoSSRC=f,y._video_pre_subscribed=!0,_&&(y._videoOrtc=_),null!=g&&(y._rtxSsrcId=g)),I.info("[".concat(a._clientId,"] presub succeed ssrc: ").concat(f)),yield a._p2pChannel.subscribe(y,r,f,g,_);const T=d?y._audioTrack:y._videoTrack;if(!T)throw new W(k.UNEXPECTED_ERROR,"can not find remote track in user");return d&&(y._trust_audio_stream_added_state_=!0,y._audio_added_=!0),l&&(y._trust_video_stream_added_state_=!0,y._video_added_=!0),T}catch(f){throw I.error("[".concat(a._clientId,"] presub user ").concat(i," error"),f),f}finally{h()}})()}_subscribeDataChannel(i,r){var a=this;return L(function*(){var d;if(At(r,"channelId",0,65535,!0),!a._joinInfo)throw new W(k.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==a.connectionState&&"RECONNECTING"!==a.connectionState)throw new W(k.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(a.connectionState," state"));if(!a._users.find(_=>_===i))throw I.error("[".concat(a._clientId,"] can not subscribe ").concat(i.uid,", this user is not in the channel")),new W(k.INVALID_REMOTE_USER,"user is not in the channel");if(!i.hasAudio&&!i.hasVideo&&0===i._dataChannels.length)throw I.error("[".concat(a._clientId,"] can not subscribe ").concat(i.uid,", user is not published")),new W(k.INVALID_REMOTE_USER,"user is not published");const l=null===(d=i._dataChannels)||void 0===d?void 0:d.find(_=>_.id===r);if(!l)throw I.error("[".concat(a._clientId,"] can not subscribe ").concat(i.uid," with mediaType datachannel, remote datachannel is not published")),new W(k.REMOTE_USER_IS_NOT_PUBLISHED);const h=yield a._subscribeMutex.lock();I.info("[".concat(a._clientId,"] subscribe user ").concat(i.uid,", mediaType: datachannel"));try{const _=yield a._p2pChannel.subscribeDataChannel(i,[l]);if(_&&ye(_).call(_,l.id))try{var f;if(!l._originDataChannelId)throw I.error("[".concat(a._clientId,"] can not subscribe ").concat(i.uid," with mediaType datachannel, cannot get RTCDatachannel")),new W(k.REMOTE_USER_IS_NOT_PUBLISHED);const g={id:l.id,datachannelId:l._originDataChannelId,ordered:l.ordered,maxRetransmits:l.maxRetransmits,metadata:null!==(f=l.metadata)&&void 0!==f?f:""};yield a._gateway.subscribeDataChannel(i.uid,g,!0)}catch(g){if(g?.code!==k.WS_ABORT)throw yield a._p2pChannel.unsubscribeDataChannel(i,[l]),g;yield a._p2pChannel.unsubscribeDataChannel(i,[l]),a._p2pChannel.setPendingRemoteDataChannel(i,l.id)}return yield l._waitTillOpen(),I.info("[".concat(a._clientId,"] subscribe success user ").concat(i.uid,", mediaType: datachannel")),l}finally{h()}})()}_p2pSubscribe(i,r,a){var d=this;return L(function*(){if(Cn(r,"mediaType",["audio","video"]),!d._joinInfo)throw new W(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==d.connectionState&&"RECONNECTING"!==d.connectionState)throw new W(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(d.connectionState," state"));if(!d._users.find(h=>h===i)){const h=new W(k.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(d._clientId,"] can not subscribe ").concat(i.uid,", this user is not in the channel")),h}if(!i.hasAudio&&!i.hasVideo){const h=new W(k.INVALID_REMOTE_USER,"user is not published");throw I.error("[".concat(d._clientId,"] can not subscribe ").concat(i.uid,", user is not published")),h}if(!a&&("audio"===r&&!i.hasAudio||"video"===r&&!i.hasVideo)){const h=new W(k.REMOTE_USER_IS_NOT_PUBLISHED);throw I.error("[".concat(d._clientId,"] can not subscribe ").concat(i.uid," with mediaType ").concat(r,", remote track is not published")),h}const l=yield d._subscribeMutex.lock();I.info("[".concat(d._clientId,"] subscribe user ").concat(i.uid,", mediaType: ").concat(r));try{if(yield d._p2pChannel.hasRemoteMediaWithLock(i,r))yield d._p2pChannel.unmuteRemote(i,r);else try{const f="audio"===r?i._audioSSRC:i._videoSSRC,_="audio"===r?i._audioMid:i._videoMid;d.store.subscribe(i.uid,r,Date.now()),d._p2pChannel instanceof Je&&(yield d._p2pChannel.subscribe(i,r,f,_))}catch(f){throw f}I.info("[".concat(d._clientId,"] subscribe success user ").concat(i.uid,", mediaType: ").concat(r)),d._defaultStreamFallbackType&&d.setStreamFallbackOption(i.uid,d._defaultStreamFallbackType).catch(f=>{I.warning("[".concat(d._clientId,"] auto set fallback failed"),f)});const h="audio"===r?i._audioTrack:i._videoTrack;if(!h)throw new W(k.UNEXPECTED_ERROR,"can not find remote track in user object");return h}catch(h){throw I.error("[".concat(d._clientId,"] subscribe user ").concat(i.uid," error"),h),h}finally{l()}})()}_subscribe(i,r,a){var d=this;return L(function*(){if(d._p2pChannel instanceof Je)return d._p2pSubscribe(i,r);if(Cn(r,"mediaType",["audio","video"]),!d._joinInfo)throw new W(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==d.connectionState&&"RECONNECTING"!==d.connectionState)throw new W(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(d.connectionState," state"));if(!d._users.find(v=>v===i)){const v=new W(k.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(d._clientId,"] can not subscribe ").concat(i.uid,", this user is not in the channel")),v}if(!i.hasAudio&&!i.hasVideo){const v=new W(k.INVALID_REMOTE_USER,"user is not published");throw I.error("[".concat(d._clientId,"] can not subscribe ").concat(i.uid,", user is not published")),v}if(!(a||("audio"!==r||i.hasAudio&&void 0!==i._audioSSRC)&&("video"!==r||i.hasVideo&&void 0!==i._videoSSRC))){const v=new W(k.REMOTE_USER_IS_NOT_PUBLISHED);throw I.error("[".concat(d._clientId,"] can not subscribe ").concat(i.uid," with mediaType ").concat(r,", remote track is not published")),v}let l="audio"===r?i._audioSSRC:i._videoSSRC,h="audio"===r?i._audioOrtc:i._videoOrtc,f="video"===r?i._rtxSsrcId:void 0,_={stream_type:"audio"===r?Se.AUDIO:Se.VIDEO,ssrcId:l};const g=yield d._subscribeMutex.lock();I.info("[".concat(d._clientId,"] subscribe user ").concat(i.uid,", mediaType: ").concat(r));try{if(yield d._p2pChannel.hasRemoteMediaWithLock(i,r))yield d._p2pChannel.unmuteRemote(i,r);else try{const b="audio"===r?i._audioSSRC:i._videoSSRC;void 0!==b&&b!==l&&(l=b,h="audio"===r?i._audioOrtc:i._videoOrtc,f="video"===r?i._rtxSsrcId:void 0,_={stream_type:"audio"===r?Se.AUDIO:Se.VIDEO,ssrcId:l}),Li.markSubscribeStart(d.store.clientId,l),d.store.subscribe(i.uid,r,Date.now()),yield d._p2pChannel.subscribe(i,r,l,f,h);try{yield d._gateway.subscribe(i.uid,_,!0)}catch(y){if(y?.code!==k.WS_ABORT)throw yield d._p2pChannel.unsubscribe(i,r),y;yield d._p2pChannel.unsubscribe(i,r,!0),d._p2pChannel.setPendingRemoteMedia(i,r)}d.store.subscribe(i.uid,r,void 0,Date.now()),d._p2pChannel.reportSubscribeEvent(!0,null,i,r)}catch(b){throw d._p2pChannel.reportSubscribeEvent(!1,b?.code,i,r),b}I.info("[".concat(d._clientId,"] subscribe success user ").concat(i.uid,", mediaType: ").concat(r)),d._defaultStreamFallbackType&&d.setStreamFallbackOption(i.uid,d._defaultStreamFallbackType).catch(b=>{I.warning("[".concat(d._clientId,"] auto set fallback failed"),b)});const v="audio"===r?i._audioTrack:i._videoTrack;if(!v)throw new W(k.UNEXPECTED_ERROR,"can not find remote track in user object");return v}catch(v){throw I.error("[".concat(d._clientId,"] subscribe user ").concat(i.uid," error"),v),v}finally{g()}})()}massSubscribe(i){var r=this;return L(function*(){if(Fa(i,"subscribeList"),!r._joinInfo)throw new W(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new W(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(r.connectionState," state"));const a=Date.now(),d=new Map,l=yield r._subscribeMutex.lock();I.info("[".concat(r._clientId,"]start massSubscribe user ").concat(i.map(g=>{let{user:v,mediaType:b}=g;return"user: ".concat(v?.uid,", mediaType: ").concat(b)}).join("; ")));const h=(i=[...i]).map(g=>{let{user:v,mediaType:b}=g;return{user:v,mediaType:b}}),f=yield r._p2pChannel.globalLock();try{var _;for(let v=i.length-1;v>=0;v--){const b=i[v],{user:y,mediaType:T}=b;if(Cn(T,"mediaType",["audio","video"]),!y){const D=new W(k.INVALID_PARAMS,"user property does not exist in subscribeList item");throw I.error("[".concat(r._clientId,"] user property does not exist in subscribeList item")),D}if(!r._users.find(D=>D===y)){const D=new W(k.INVALID_REMOTE_USER,"user is not in the channel");I.error("[".concat(r._clientId,"] can not massSubscribe ").concat(y.uid,", this user is not in the channel")),h[v].error=D,i.splice(v,1);continue}if("audio"===T&&(!y.hasAudio||void 0===y._audioSSRC)||"video"===T&&(!y.hasVideo||void 0===y._videoSSRC)){const D=new W(k.REMOTE_USER_IS_NOT_PUBLISHED);I.error("[".concat(r._clientId,"] can not subscribe ").concat(y.uid," with mediaType ").concat(T,", remote user is not published")),h[v].error=D,i.splice(v,1);continue}const M=Bn.Video|Bn.LwoVideo,O=d.get(y);if(O){if("video"===T?O&M:O&Bn.Audio){i.splice(v,1),I.warning("[".concat(r._clientId,"] repeat massSubscribe user:").concat(y.uid,", mediaType:").concat(T," twice"));continue}d.set(y,O|("video"===T?M:Bn.Audio))}else d.set(y,"video"===T?M:Bn.Audio)}for(let v=i.length-1;v>=0;v--){const b=i[v],{user:y,mediaType:T}=b,M=Bn.Video|Bn.LwoVideo;if(r._p2pChannel.hasRemoteMedia(y,T)){yield r._p2pChannel.unmuteRemoteNoLock(y,T);const O=d.get(y);d.set(y,"video"===T?O^M:O^Bn.Audio),i.splice(v,1)}}r.store.massSubscribe(i.map(v=>({userId:v.user.uid,type:v.mediaType})),a);const g=Ba(_=Array.from(d.entries())).call(_,(v,b)=>{let[y,T]=b;if(0===T)return v;const M={stream_id:y.uid,stream_type:T};return T&Bn.Audio&&(M.audio_ssrc=y._audioSSRC),T&Bn.Video&&(M.video_ssrc=y._videoSSRC),v.push(M),v},[]);try{i.length>0&&(yield r._p2pChannel.massSubscribeNoLock(i.map(b=>{let{user:y,mediaType:T}=b;return{user:y,mediaType:T,ssrcId:T===Se.VIDEO?y._videoSSRC:y._audioSSRC,rtxSsrcId:T===Se.VIDEO?y._rtxSsrcId:void 0}})));const v=new Map;if(g.length>0){const b=yield r._gateway.subscribeAll(g,!0);(b?.users||[]).forEach(y=>{let{stream_id:T,video_error_code:M,audio_error_code:O,error_code:D}=y;(M||O||D)&&v.set(T,{video_error_code:M,audio_error_code:O,error_code:D})})}if(Array.from(v.entries()).length>0){const b=Array.from(v.entries()).map(y=>{let T,[M,O]=y;return O.error_code||O.video_error_code&&O.audio_error_code?T=void 0:O.video_error_code?T=Se.VIDEO:O.audio_error_code&&(T=Se.AUDIO),{user:r.remoteUsers.find(D=>D.uid===M),mediaType:T}});yield r._p2pChannel.massUnsubscribeNoLock(b)}for(const b of h){const y=v.get(b.user.uid);if(y){const T=y.error_code||"audio"===b.mediaType&&y.audio_error_code||"video"===b.mediaType&&y.video_error_code;if(T){const M=au(T);I.error("user:".concat(b.user.uid," mediaType:").concat(b.mediaType," has massSubscribe error ").concat(M.desc)),b.error=new W(k.SUBSCRIBE_FAILED,"code ".concat(T,": ").concat(M.desc))}}b.error||(b.track="video"===b.mediaType?b.user.videoTrack:b.user.audioTrack)}return r.store.massSubscribe(h.filter(b=>!b.error).map(b=>({userId:b.user.uid,type:b.mediaType})),void 0,Date.now()),h.forEach(b=>{var y;Ie.subscribe(r.store.sessionId,{succ:!!b.error,ec:(null===(y=b.error)||void 0===y?void 0:y.code)||null,video:b.mediaType===Se.VIDEO,audio:b.mediaType===Se.AUDIO,peerid:b.user.uid,subscribeRequestid:b.mediaType===Se.VIDEO?b.user._videoSSRC:b.user._audioSSRC,p2pid:r.store.p2pId,eventElapse:Math.floor(performance.now()-a)},!0)}),I.info("[".concat(r._clientId,"] massSubscribe success ").concat(i.map(b=>{let{user:y,mediaType:T}=b;return"user: ".concat(y?.uid,", mediaType: ").concat(T)}).join("; "))),h}catch(v){throw yield r._p2pChannel.massUnsubscribeNoLock(i),v}}finally{f(),l()}})()}unsubscribe(i,r,a){var d=this;return L(function*(){if(r||d.store.useP2P){if("datachannel"===r)return d._unsubscribeDataChannel(i,a)}else yield d._unsubscribeDataChannel(i,a);if(r&&Cn(r,"mediaType",["audio","video"]),!d._joinInfo)throw new W(k.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!d._users.find(h=>h===i)){const h=new W(k.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(d._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),h}I.info("[".concat(d._clientId,"] unsubscribe uid: ").concat(i.uid,", mediaType: ").concat(r));const l=yield d._subscribeMutex.lock();try{if(d._p2pChannel instanceof Je)yield d._p2pChannel.unsubscribe(i,r);else{const h=yield d._p2pChannel.unsubscribe(i,r);h&&(yield d._gateway.unsubscribe(h,i.uid)),r&&"audio"!==r||(i._audio_pre_subscribed=!1),r&&"video"!==r||(i._video_pre_subscribed=!1),i._is_pre_created&&mm(d._users,i),I.info("[".concat(d._clientId,"] unsubscribe success uid: ").concat(i.uid,", mediaType: ").concat(r))}}catch(h){if(h.code===k.DISCONNECT_P2P)return void I.warning("disconnecting p2p, abort unsubscribe request.");throw I.error("[".concat(d._clientId,"] unsubscribe user ").concat(i.uid," error"),h.toString()),h}finally{l()}})()}_unsubscribeDataChannel(i,r){var a=this;return L(function*(){if(r&&At(r,"id",0,65535,!0),!a._joinInfo)throw new W(k.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!a._users.find(l=>l===i)){const l=new W(k.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(a._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),l}let d;if("number"==typeof r){const l=i._dataChannels.find(h=>h.id===r);l&&(d=[l])}else d=i._dataChannels;if(void 0===d){const l=new W(k.REMOTE_USER_IS_NOT_PUBLISHED);throw I.error("[".concat(a._clientId,"] can not unsubscribe ").concat(i.uid," with channelId ").concat(r,", remote datachannel is not published")),l}I.info("[".concat(a._clientId,"] unsubscribe uid: ").concat(i.uid,", mediaType: datachannel, ids: ").concat(d.map(l=>l.id)));try{const l=yield a._p2pChannel.unsubscribeDataChannel(i,d);l&&(yield a._gateway.unsubscribeDataChannel(l,i.uid)),I.info("[".concat(a._clientId,"] unsubscribe datachannel success uid: ").concat(i.uid,", mediaType: datachannel, ids: ").concat(l))}catch(l){if(l.code===k.DISCONNECT_P2P)return void I.warning("disconnecting p2p, abort unsubscribe request.");throw I.error("[".concat(a._clientId,"] unsubscribe user ").concat(i.uid," error"),l.toString()),l}})()}massUnsubscribe(i){var r=this;return L(function*(){if(Fa(i,"unsubscribeList"),!r._joinInfo)throw new W(k.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");I.info("[".concat(r._clientId,"] start massUnsubscribe ").concat(i.map(d=>{let{user:l,mediaType:h}=d;return"user: ".concat(l?.uid,", mediaType: ").concat(h,";")}).join())),i=[...i];const a=new Map;for(let d=i.length-1;d>=0;d--){const{user:l,mediaType:h}=i[d];if(!l){const _=new W(k.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw I.error("[".concat(r._clientId,"] user property does not exist in unsubscribeList item")),_}if(Cn(h,"mediaType",["video","audio",void 0]),!r._users.find(_=>_===l)){I.warning("[".concat(r._clientId,"] can not unsubscribe ").concat(l.uid,", user is not in the channel")),i.splice(d,1);continue}const f=Bn.Video|Bn.LwoVideo;if(a.has(l)){const _=a.get(l);let g;switch(h){case"video":g=_&f;break;case"audio":g=_&Bn.Audio;break;default:g=_&(Bn.Audio|f)}if(g){I.warning("[".concat(r._clientId,"] repeat massUnsubscribe user:").concat(l.uid,",mediaType:").concat(h," twice.")),i.splice(d,1);continue}h?"audio"===h?a.set(l,_|Bn.Audio):"video"===h&&a.set(l,_|f):a.set(l,_|Bn.Audio|f)}else h?"audio"===h?a.set(l,Bn.Audio):"video"===h&&a.set(l,f):a.set(l,Bn.Audio|f)}try{const d=yield r._p2pChannel.massUnsubscribe(i);d&&(yield r._gateway.massUnsubscribe(d)),I.info("[".concat(r._clientId,"] massUnsubscribe success ").concat(i.map(l=>{let{user:h,mediaType:f}=l;return"user: ".concat(h?.uid,", mediaType: ").concat(f,";")}).join()))}catch(d){if(d.code===k.DISCONNECT_P2P)return void I.warning("[".concat(r._clientId,"] disconnecting p2p, abort unsubscribe request."));throw I.error("[".concat(r._clientId,"] massUnsubscribe error"),d.toString()),d}})()}setLowStreamParameter(i){var r=this;return L(function*(){(function(d){if(!d)throw new ee(k.INVALID_PARAMS);tn(d.width)||BC(d.width,"streamParameter.width"),tn(d.height)||BC(d.height,"streamParameter.height"),tn(d.framerate)||BC(d.framerate,"streamParameter.framerate"),tn(d.bitrate)||At(d.bitrate,"streamParameter.bitrate")})(i),(!i.width&&i.height||i.width&&!i.height)&&I.warning("[".concat(r._clientId,"] The width and height parameters take effect only when both are set")),I.info("[".concat(r._clientId,"] set low stream parameter to"),JSON.stringify(i));const a=r._configDistribute.getLowStreamConfigDistribute();if(a&&a.bitrate&&i.bitrate&&a.bitrate<i.bitrate&&(i.bitrate=a.bitrate),r._lowStreamParameter=i,r._isDualStreamEnabled)return r._p2pChannel.updateVideoStreamParameter(i,re.LocalVideoLowTrack)})()}enableDualStream(){var i=this;return L(function*(){if(!Ot().supportDualStream)throw Ie.streamSwitch(i._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new W(k.NOT_SUPPORTED,"Your browser is not support dual stream");if(i._isDualStreamEnabled)throw new W(k.INVALID_OPERATION,"Dual stream is already enabled");if(i._p2pChannel.canPublishLowStream())try{yield i._publishLowStream()}catch(r){throw Ie.streamSwitch(i._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),r}i._isDualStreamEnabled=!0,Ie.streamSwitch(i._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),I.info("[".concat(i._clientId,"] enable dual stream"))})()}disableDualStream(){var i=this;return L(function*(){if(i._isDualStreamEnabled){if(!i._joinInfo)throw new W(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(i._p2pChannel.getLocalMedia(re.LocalVideoLowTrack))try{const r=yield i._p2pChannel.unpublishLowStream();r&&(yield i._gateway.unpublish(r,i._joinInfo.stringUid||i._joinInfo.uid))}catch(r){throw Ie.streamSwitch(i._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),r}i._isDualStreamEnabled=!1,Ie.streamSwitch(i._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),I.info("[".concat(i._clientId,"] disable dual stream"))}})()}setClientRole(i,r){var a=this;return L(function*(){if(Cn(i,"role",["audience","host"]),r&&WC(r),"rtc"===a.mode||"p2p"===a.mode)throw I.warning("[".concat(a._clientId,"]").concat(a.mode," mode can not use setClientRole")),new W(k.INVALID_OPERATION,"".concat(a.mode," mode can not use setClientRole"));if(r&&r.level&&"host"===i)throw new W(k.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===i&&a._p2pChannel.hasLocalMedia())throw new W(k.INVALID_OPERATION,"can not set client role to audience when publishing stream");yield a._gateway.setClientRole(i,r),a._config.role=i,I.info("[".concat(a._clientId,"] set client role to ").concat(i,", level: ").concat(r&&r.level))})()}getRemoteInboundOffset(){var i;const r=null===(i=this._p2pChannel.getStats())||void 0===i?void 0:i.audioSend[0];if(!r||!r.timestamp)return 0;const a=r.timestamp-Date.now();return Math.abs(a)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?a:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(i,r){if(hi(i,"proxyServer"),!r){if("DISCONNECTED"!==this.connectionState)throw new W(k.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new W(k.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=i,Ie.setProxyServer(this._proxyServer),I.setProxyServer(this._proxyServer),I.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(i,r){if(Array.isArray(i)||(i=[i]),!r){if("DISCONNECTED"!==this.connectionState)throw new W(k.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new W(k.INVALID_OPERATION,"You have already set the proxy")}if(oa(i))return this._turnServer={servers:i,mode:"original-manual"},void I.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(i.map(a=>a.urls).join(","),"."));i.forEach(a=>Xh(a)),this._turnServer={servers:i,mode:"manual"},I.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(i){if("DISCONNECTED"!==this.connectionState)throw new W(k.INVALID_OPERATION,"you should set license before join channel");if(hi(i,"license",32,32),!/^[A-Za-z\d]+$/.test(i))throw new W(k.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=i,I.info("[".concat(this._clientId,"] set license success"),i)}startProxyServer(i){if("DISCONNECTED"!==this.connectionState)throw new W(k.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new W(k.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let a;switch(void 0===i&&(i=3),i){case 1:case 2:throw new W(k.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:a="proxy3";break;case 4:a="proxy4";break;case 5:a="proxy5";break;default:throw new W(k.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=a,this.store.cloudProxyServerMode=a,I.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new W(k.INVALID_OPERATION,"Stop proxy server after leave channel");Ie.setProxyServer(),I.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",I.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(i){if(!i.accessPoints)throw new W(k.INVALID_PARAMS,"accessPoints is required.");Fa(i.accessPoints.serverList,"accessPoints.serverList"),hi(i.accessPoints.domain,"accessPoints.domain");const r=(T,M)=>{At(T,M,0,65535,!0)};let a=443;if(i.accessPoints.port&&(r(i.accessPoints.port,"accessPoints.port"),a=i.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new W(k.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");B("CLOSE_AFB_FOR_LOCAL_AP")&&(It("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),It("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const d=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,l=i.accessPoints.domain,h=i.accessPoints.serverList.map(T=>d.test(T)?"".concat(T.replace(/\./g,"-"),".").concat(l):T),f=h.map(T=>"".concat(T,":").concat(a));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,It("WEBCS_DOMAIN",f),It("WEBCS_DOMAIN_BACKUP_LIST",f),It("GATEWAY_DOMAINS",[l]),i.report&&i.report.hostname&&Array.isArray(i.report.hostname)&&i.report.hostname.length?(Fa(i.report.hostname,"report.hostname"),It("EVENT_REPORT_DOMAIN",i.report.hostname[0]),It("EVENT_REPORT_BACKUP_DOMAIN",i.report.hostname[1]||i.report.hostname[0])):(It("EVENT_REPORT_DOMAIN",h[0]),It("EVENT_REPORT_BACKUP_DOMAIN",h[1]||h[0]));let _=6443;i.report&&i.report.port&&(r(i.report.port,"report.port"),_=i.report.port),It("STATS_COLLECTOR_PORT",_),It("ENABLE_EVENT_REPORT",!!i.report);let g="";i.log&&i.log.hostname&&Array.isArray(i.log.hostname)&&i.log.hostname.length?(Fa(i.log.hostname,"log.hostname"),g=i.log.hostname[0]):g=h[0];let v=6444;i.log&&i.log.port&&(r(i.log.port,"log.port"),v=i.log.port),It("LOG_UPLOAD_SERVER","".concat(g,":").concat(v));let b=[];i.cds&&i.cds.hostname&&Array.isArray(i.cds.hostname)&&i.cds.hostname.length?(Fa(i.cds.hostname,"cds.hostname"),b=i.cds.hostname):b=h;let y=443;i.cds&&i.cds.port&&(r(i.cds.port,"cds.port"),y=i.cds.port),It("CDS_AP",b.map(T=>"".concat(T,":").concat(y))),It("ENABLE_CONFIG_DISTRIBUTE",!!i.cds),I.info("set local access point v2 success")}setLocalAccessPoints(i,r){if(Fa(i,"serverList"),hi(r,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new W(k.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const a=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;i=i.map(d=>a.test(d)?"".concat(d.replace(/\./g,"-"),".").concat(r):d),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,It("WEBCS_DOMAIN",i),It("WEBCS_DOMAIN_BACKUP_LIST",i),It("GATEWAY_DOMAINS",[r]),It("EVENT_REPORT_DOMAIN",i[0]),It("EVENT_REPORT_BACKUP_DOMAIN",i[1]||i[0]),It("LOG_UPLOAD_SERVER","".concat(i[0],":6444")),I.info("[".concat(this._clientId,"] set local access point success"))}setRemoteDefaultVideoStreamType(i){var r=this;return L(function*(){if(Cn(i,"streamType",[0,1]),r._remoteDefaultVideoStreamType=i,r._joinInfo)try{yield r._gateway.setDefaultRemoteVideoStreamType(i),r._joinInfo.defaultVideoStream=r._remoteDefaultVideoStreamType}catch(a){throw I.error("[".concat(r._clientId,"] set default remote video stream type error"),a.toString()),a}else I.debug("[".concat(r._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(i))})()}setRemoteVideoStreamType(i,r){var a=this;return L(function*(){Cn(r,"streamType",[0,1]);try{yield a._gateway.setRemoteVideoStreamType(i,r),setTimeout(()=>{const d=a._users.find(l=>l.uid===i);d&&d.videoTrack&&d.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(d){throw I.error("[".concat(a._clientId,"] set remote video stream type error"),d.toString()),d}I.info("[".concat(a._clientId,"] set remote ").concat(i," video stream type to ").concat(r)),a._remoteStreamTypeCacheMap.set(i,r)})()}setStreamFallbackOption(i,r){var a=this;return L(function*(){Cn(r,"fallbackType",[0,1,2]);try{yield a._gateway.setStreamFallbackOption(i,r)}catch(d){throw I.error("[".concat(a._clientId,"] set stream fallback option"),d.toString()),d}I.info("[".concat(a._clientId,"] set remote ").concat(i," stream fallback type to ").concat(r)),a._streamFallbackTypeCacheMap.set(i,r)})()}setEncryptionConfig(i,r,a){Cn(i,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"]),hi(r,"secret");const d=["aes-128-gcm2","aes-256-gcm2"];if(ye(d).call(d,i)){if(!a||!(a instanceof Uint8Array&&32===a.length))throw new W(k.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(a)throw new W(k.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(r)||I.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=i,this._encryptionSecret=r,a&&(this._encryptionSalt=Qh(a))}renewToken(i){var r=this;return L(function*(){if(hi(i,"token",1,2047),!r._key||!r._joinInfo)throw new W(k.INVALID_OPERATION,"renewToken should not be called before user join");const a=r._key;r._key=i,r._joinInfo&&(r._joinInfo.token=i);const d=yield r._renewTokenMutex.lock();try{if(B("USE_NEW_TOKEN")){I.debug("[".concat(r._clientId,"] start renew token with ticket from unilbs"));const l=yield function E2(s,i,r){return jT.apply(this,arguments)}(r._joinInfo,r._axiosCancelSource.token,r._config.httpRetryConfig||Pn);I.debug("[".concat(r._clientId,"] get ticket from unilbs success")),yield r._gateway.renewToken({token:i,ticket:l})}else I.debug("[".concat(r._clientId,"] start renew token without ticket")),yield r._gateway.renewToken({token:i});I.debug("[".concat(r._clientId,"] renewToken success"))}catch(l){throw r._key=a,r._joinInfo.token=a,I.error("[".concat(r._clientId,"] renewToken failed"),l.toString()),l}finally{d()}})()}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?I.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const i=this._p2pChannel.getAudioLevels();this.safeEmit($e.VOLUME_INDICATOR,i)},B("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const i=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return i.Duration=Math.round(r.duration/1e3),i}startLiveStreaming(i,r){var a=this;return L(function*(){if(!r){if("h264"!==a.codec)throw new W(k.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!a._p2pChannel.hasLocalMedia())throw new W(k.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(a._liveRawStreamingClient&&a._liveRawStreamingClient.hasUrl(i)||a._liveTranscodeStreamingClient&&a._liveTranscodeStreamingClient.hasUrl(i))throw new W(k.LIVE_STREAMING_TASK_CONFLICT);const d=r?Kn.TRANSCODE:Kn.RAW;return a._createLiveStreamingClient(d).startLiveStreamingTask(i,d)})()}setLiveTranscoding(i){return this._createLiveStreamingClient(Kn.TRANSCODE).setTranscodingConfig(i)}stopLiveStreaming(i){var r=this;return L(function*(){const a=[r._liveRawStreamingClient,r._liveTranscodeStreamingClient].filter(d=>d&&d.hasUrl(i));if(!a.length)throw new W(k.INVALID_PARAMS,"can not find live streaming url to stop");yield X.all(a.map(d=>d&&d.stopLiveStreamingTask(i)))})()}addInjectStreamUrl(i,r){var a=this;return L(function*(){if(!a._joinInfo)throw new W(k.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const d=a._createLiveStreamingClient(Kn.INJECT);d.setInjectStreamConfig(r,0),yield d.startLiveStreamingTask(i,Kn.INJECT)})()}removeInjectStreamUrl(){var i=this;return L(function*(){var r;const a=i._createLiveStreamingClient(Kn.INJECT),d=Array.from(ca(r=a.streamingTasks).call(r)).find(l=>l.mode===Kn.INJECT);if(!i._joinInfo||!d)throw new W(k.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");yield a.stopLiveStreamingTask(d.url)})()}startChannelMediaRelay(i){var r=this;return L(function*(){E_(i),yield r._createChannelMediaRelayClient().startChannelMediaRelay(i)})()}updateChannelMediaRelay(i){var r=this;return L(function*(){E_(i),yield r._createChannelMediaRelayClient().updateChannelMediaRelay(i)})()}stopChannelMediaRelay(){var i=this;return L(function*(){yield i._createChannelMediaRelayClient().stopChannelMediaRelay(),i._statsCollector.onStatsChanged&&(i._statsCollector.onStatsChanged=void 0)})()}sendStreamMessage(i){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new W(k.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof i||i instanceof Uint8Array)&&(i={payload:i}),"string"==typeof i.payload){const a=new TextEncoder;i.payload=a.encode(i.payload)}if(new Blob([i.payload]).size>1024)throw new W(k.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(Ae.DATA_STREAM,{payload:Qh(i.payload),syncWithAudio:i.syncWithAudio,sendTs:Date.now()-oj},!r)}sendMetadata(i){if(!this._joinInfo)throw new W(k.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([i]).size>1024)throw new W(k.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Ae.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Qh(i)})}sendCustomReportMessage(i){var r=this;return L(function*(){if(Array.isArray(i)||(i=[i]),i.forEach(WL),!r._joinInfo)throw new W(k.INVALID_OPERATION,"can not send custom report, not joined");yield Ie.sendCustomReportMessage(r._joinInfo.sid,i)})()}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}pickSVCLayer(i,r){var a=this;return L(function*(){Cn(r.spatialLayer,"spatialLayer",[0,1,2,3]),Cn(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{yield a._gateway.pickSVCLayer(i,r)}catch(d){throw I.error("[".concat(a._clientId,"] pick SVC layer failed"),d.toString()),d}})()}setRTMConfig(i){var r=this;return L(function*(){const{apRTM:a=!1,rtmFlag:d}=i;if(Rc(a,"apRTM"),At(d,"rtmFlag",0),r._rtmConfig.apRTM=a,r._rtmConfig.rtmFlag=d,I.debug("[".concat(r._clientId,"] setRTMconfig ").concat(JSON.stringify(i)," in ").concat(r.connectionState," state")),("CONNECTED"===r.connectionState||"RECONNECTING"===r.connectionState)&&r._joinInfo)return r._joinInfo.apRTM=a,r._joinInfo.rtmFlag=d,r._gateway.setRTM2Flag(d)})()}_reset(){if(I.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Ze.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._pendingPublishedUsers=[],this._users.forEach(i=>{i._audioTrack&&i._audioTrack._destroy(),i._videoTrack&&i._videoTrack._destroy(),i._dataChannels&&(i._dataChannels.forEach(r=>r._close()),i._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new gi("client-publish"),this._subscribeMutex=new gi("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(i,r){var a;const d=i||Dc();I.debug(i?"[".concat(this._clientId,"] new Session ").concat(d):"[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(d));const l=i?"":this._sessionId||"";this._sessionId=d,this.store.sessionId=d;const h={lts:(new Date).getTime(),mode:this.mode,stringUid:r?.stringUid||(null===(a=this._joinInfo)||void 0===a?void 0:a.stringUid),channelProfile:"live"===this.mode?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:l,clientRole:"audience"===this.role?2:1};r?Ie.sessionInit(this._sessionId,ol({cname:r.channel,appid:r.appId},h)):this._joinInfo?Ie.sessionInit(this._sessionId,ol({cname:this._joinInfo.cname,appid:this._joinInfo.appId},h)):this._gateway.joinInfo&&Ie.sessionInit(this._sessionId,ol({cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId},h)),this._joinInfo&&(this._joinInfo.sid=d),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=d)}_publishHighStream(i){var r=this;return L(function*(){if(!r._joinInfo||void 0===r._uid)throw new W(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new W(k.INVALID_OPERATION,"can not publish stream in ".concat(r.connectionState," state"));if("auto"===r._turnServer.mode&&B("FORCE_TURN")&&!B("TURN_ENABLE_TCP")&&!B("TURN_ENABLE_UDP"))throw new W(k.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");I.debug("[".concat(r._clientId,"] publish high stream"));try{const d=yield r._p2pChannel.publish(i,r._isDualStreamEnabled,r._lowStreamParameter);if(r._p2pChannel instanceof Je){const l=(yield d.next()).value;if(l){try{yield r._gateway.sendExtensionMessage(fn.PUBLISH,l,!0)}catch(h){throw d.throw(h),h}yield d.next()}r._p2pChannel.reportPublishEvent(!0,null)}else{const l=(yield d.next()).value;if(l){var a;let h;try{h=yield r._gateway.publish(r._uid,l,!0)}catch(f){if(f.code!==k.DISCONNECT_P2P)throw d.throw(f),f}yield d.next((null===(a=h)||void 0===a?void 0:a.ortc)||[])}r._p2pChannel.reportPublishEvent(!0,null);for(const h of i)h instanceof je&&h._encoderConfig&&r._gateway.setVideoProfile(h._encoderConfig),!h.muted&&h.enabled||(yield r._p2pChannel.muteLocalTrack(h))}}catch(d){if(r._p2pChannel.reportPublishEvent(!1,d?.code,i),d?.code===k.WS_ABORT)return;throw d}})()}_publishLowStream(){var i=this;return L(function*(){if(!i._joinInfo||void 0===i._uid)throw new W(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==i.connectionState&&"RECONNECTING"!==i.connectionState)throw new W(k.INVALID_OPERATION,"can not publish stream in ".concat(i.connectionState," state"));I.debug("[".concat(i._clientId,"] publish low stream"));const r=i._configDistribute.getLowStreamConfigDistribute();r&&r.bitrate&&(i._lowStreamParameter||(i._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),i._lowStreamParameter&&i._lowStreamParameter.bitrate&&r.bitrate<i._lowStreamParameter.bitrate&&(i._lowStreamParameter.bitrate=r.bitrate));try{const d=yield i._p2pChannel.publishLowStream(i._lowStreamParameter),l=(yield d.next()).value;if(l){var a;let h;try{h=yield i._gateway.publish(i._uid,l,!0)}catch(f){if(f.code!==k.DISCONNECT_P2P)throw d.throw(f),f}d.next((null===(a=h)||void 0===a?void 0:a.ortc)||[]),i._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(d){if(i._p2pChannel.reportPublishEvent(!1,d?.code,void 0,!0),d?.code===k.WS_ABORT)return;throw d}})()}_createLiveStreamingClient(i){if(!this._joinInfo||!this._appId)return new W(k.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const r=()=>new oi(this._joinInfo,this._config.websocketRetryConfig||Pn,this._config.httpRetryConfig||Pn),a=d=>{d.onLiveStreamError=(l,h)=>{Ie.reportApiInvoke(this._sessionId,{name:qn.ON_LIVE_STREAM_ERROR,options:[l,h],tag:Kt.TRACER}).onSuccess(),this.safeEmit($e.LIVE_STREAMING_ERROR,l,h)},d.onLiveStreamWarning=(l,h)=>{Ie.reportApiInvoke(this._sessionId,{name:qn.ON_LIVE_STREAM_WARNING,options:[l,h],tag:Kt.TRACER}).onSuccess(),this.safeEmit($e.LIVE_STREAMING_WARNING,l,h)},d.on(da.REQUEST_WORKER_MANAGER_LIST,(l,h,f)=>{if(!this._joinInfo)return f(new W(k.INVALID_OPERATION,"can not find join info to get worker manager"));hN(l,this._joinInfo,this._axiosCancelSource.token,Pn).then(h).catch(f)})};switch(i){case Kn.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=r(),a(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Kn.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=r(),a(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Kn.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=r(),this._injectStreamingClient.on(da.REQUEST_WORKER_MANAGER_LIST,(d,l,h)=>{if(!this._joinInfo)return h(new W(k.INVALID_OPERATION,"can not find join info to get worker manager"));hN(d,this._joinInfo,this._axiosCancelSource.token,Pn).then(l).catch(h)}),this._injectStreamingClient.onInjectStatusChange=(d,l,h)=>{this.safeEmit($e.INJECT_STREAM_STATUS,d,l,h)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new W(k.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:i,sendResolutionHeight:r}=this.getLocalVideoStats();this._channelMediaRelayClient=new fb(this._joinInfo,this._clientId,this._config.websocketRetryConfig||Pn,this._config.httpRetryConfig||Pn,{width:i,height:r}),this._channelMediaRelayClient.on("state",d=>{d===sr.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit($e.CHANNEL_MEDIA_RELAY_STATE,d)}),this._channelMediaRelayClient.on("event",d=>{this.safeEmit($e.CHANNEL_MEDIA_RELAY_EVENT,d)}),this._statsCollector.onStatsChanged=(d,l)=>{var h;"resolution"===d&&(null===(h=this._channelMediaRelayClient)||void 0===h||h.setVideoProfile(l))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(i,r){const{added:a,deleted:d}=i,l=[];Array.isArray(a)&&a.length>0&&a.forEach(h=>{const{uid:f,stream_id:_,ordered:g,max_retrans_times:v,metadata:b}=h,y=this._users.find(T=>T._uintid===f);if(y){if(I.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(f)),ye(l).call(l,y)||l.push(y),y._uintid||(y._uintid=f),-1===y._dataChannels.findIndex(T=>T.id===h.stream_id)){const T={id:_,ordered:!!g,maxRetransmits:v,metadata:b},M=new mF(T);y._dataChannels.push(M),I.info("[".concat(this._clientId,"] remote user ").concat(y.uid," published datachannel")),r||this.safeEmit($e.USER_PUBLISHED,y,"datachannel",T)}this._p2pChannel.hasPendingRemoteDataChannel(y,h.stream_id)&&(I.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(y.uid," after reconnect.")),this._subscribeDataChannel(y,h.stream_id).catch(T=>{I.error("[".concat(this._clientId,"] resubscribe datachannel error"),T.toString())}))}else I.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))}),r&&(this.safeEmit($e.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(d)&&d.length>0&&d.forEach(h=>{const{uid:f}=h,g=this._users.find(b=>b._uintid===f);if(!g)return void I.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const v=g._dataChannels.find(b=>b.id===h.stream_id);v&&(I.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(f)),this._p2pChannel.unsubscribeDataChannel(g,[v]).then(b=>{if(g._dataChannels=g._dataChannels.filter(y=>y!==v),b)return this._gateway.unsubscribeDataChannel(b,g.uid)}),I.info("[".concat(this._clientId,"] remote user ").concat(f," unpublished datachannel ,id:").concat(v.id)),this.safeEmit($e.USER_UNPUBLISHED,g,"datachannel",v._config))})}_handleRemoveDataChannels(i){const r=this._users.find(a=>a.uid===i.uid);if(r){if(void 0!==r._dataChannels&&r._dataChannels.length>0){I.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(i.uid));const a=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(d=>{this.safeEmit($e.USER_UNPUBLISHED,r,"datachannel",d._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(d=>{if(d)return this._gateway.unsubscribeDataChannel(d,r.uid)}),a()}}else I.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){var i=this;this._gateway.on(rn.DISCONNECT_P2P,L(function*(){yield i._p2pChannel.disconnectForReconnect()})),this._gateway.on(rn.CONNECTION_STATE_CHANGE,(r,a,d)=>{var l;if(d===ze.FALLBACK)return;const h=()=>{this.safeEmit($e.CONNECTION_STATE_CHANGE,r,a,d)};if(Ie.reportApiInvoke(this._sessionId||(null===(l=this._gateway.joinInfo)||void 0===l?void 0:l.sid)||null,{name:qn.CONNECTION_STATE_CHANGE,options:[r,a,d],tag:Kt.TRACER}).onSuccess(JSON.stringify({cur:r,prev:a,reason:d})),I.info("[".concat(this._clientId,"] connection state change: ").concat(a," -> ").concat(r)),"DISCONNECTED"===r)return this._reset(),void h();if("RECONNECTING"===r)this._users.forEach(_=>{_._trust_in_room_=!1,_._trust_audio_enabled_state_=!1,_._trust_video_enabled_state_=!1,_._trust_audio_mute_state_=!1,_._trust_video_mute_state_=!1,_._trust_audio_stream_added_state_=!1,_._trust_video_stream_added_state_=!1,_._is_pre_created||(_._audio_pre_subscribed||(_._audioSSRC=void 0,_._audioOrtc=void 0),_._video_pre_subscribed||(_._videoSSRC=void 0,_._videoOrtc=void 0,_._rtxSsrcId=void 0),_._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===r){var f;this._streamFallbackTypeCacheMap.forEach((_,g)=>{this._gateway.setStreamFallbackOption(g,_).catch(v=>{I.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),v)})}),this._remoteStreamTypeCacheMap.forEach((_,g)=>{this._gateway.setRemoteVideoStreamType(g,_).catch(v=>{I.warning("[".concat(this._clientId,"] auto set remote stream type failed"),v)})}),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(f=this._joinInfo)||void 0===f?void 0:f.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{I.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(_=>{I.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(_))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter(_=>!_._trust_in_room_).forEach(_=>{I.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(_.uid)),this._handleUserOffline({uid:_.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach(_=>{_._trust_audio_mute_state_||(I.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(_.uid)),this._handleMuteStream(_.uid,Se.AUDIO,!1)),_._trust_video_mute_state_||(I.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(_.uid)),this._handleMuteStream(_.uid,Se.VIDEO,!1)),_._trust_audio_enabled_state_||(I.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(_.uid)),this._handleSetStreamLocalEnable("audio",_.uid,!0)),_._trust_video_enabled_state_||(I.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(_.uid)),this._handleSetStreamLocalEnable("video",_.uid,!0)),_._trust_video_stream_added_state_||(I.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(_.uid)),this._handleResetAddStream(_,"video")),_._trust_audio_stream_added_state_||(I.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(_.uid)),this._handleResetAddStream(_,"audio")),_._video_added_||_._audio_added_||(I.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(_.uid)),this._handleRemoveStream({uid:_.uid,uint_id:_._uintid}))}))},1e3))}h()}),this._gateway.on(rn.REQUEST_NEW_GATEWAY_LIST,(r,a)=>{if(!this._joinInfo)return a(new W(k.UNEXPECTED_ERROR,"can not recover, no join info"));kv(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Pn,this.store).then(d=>{this._joinInfo&&(this._joinInfo.apResponse=d.gatewayInfo.res,this._joinInfo.gatewayAddrs=d.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=d.gatewayInfo.uni_lbs_ip);const l=[];d.gatewayInfo.gatewayAddrs.forEach(h=>{let{address:f}=h;const[_,g]=f.split(":");l.push(this._joinInfo&&this._joinInfo.proxyServer?{proxy:this._joinInfo.proxyServer,host:_,port:g}:{host:_,port:g})}),r(l)}).catch(a)}),this._gateway.on(rn.NETWORK_QUALITY,r=>{"normal"===this._networkQualitySensitivity&&this.safeEmit($e.NETWORK_QUALITY,r)}),this._gateway.on(rn.STREAM_TYPE_CHANGE,(r,a)=>{this.safeEmit($e.STREAM_TYPE_CHANGED,r,a),Ie.reportApiInvoke(this._sessionId,{name:qn.STREAM_TYPE_CHANGE,options:[r,a],tag:Kt.TRACER}).onSuccess(JSON.stringify({uid:r,streamType:a}))}),this._gateway.on(rn.IS_P2P_DISCONNECTED,r=>{this._p2pChannel.isP2PDisconnected()?r(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?r(!1):r(!0)}),this._gateway.on(rn.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(rn.REQUEST_P2P_CONNECTION_PARAMS,function(){var r=L(function*(a,d,l){try{d(yield i._p2pChannel.startP2PConnection(a))}catch(h){l(h)}});return function(a,d,l){return r.apply(this,arguments)}}()),this._gateway.on(rn.JOIN_RESPONSE,(r,a)=>{if(this.store.useP2P)return;const{dtlsParameters:d,iceParameters:l,candidates:h,rtpCapabilities:f,setup:_,cname:g}=bP(r.ortc,a);this._p2pChannel.connect(l,d,h,f,_,g)}),this._gateway.on(rn.REQUEST_DC_CONNECTION_PARAMS,r=>{r(this._p2pChannel.getEstablishParams())}),this._gateway.on(rn.RESET_SIGNAL,r=>{this._p2pChannel.resetConnection(r),this._handleGatewaySignalEvents()}),this._gateway.on(rn.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(rn.DATACHANNEL_PRECONNECT,function(){var r=L(function*(a,d,l,h){var f,_,g,v,b,y;yield i._p2pChannel.startP2PConnection({turnServer:null===(f=i._joinInfo)||void 0===f?void 0:f.turnServer},!0);const T=function(M,O){let D;return O&&O.ip&&"number"==typeof O.port?(D=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:O.ip,port:O.port.toString(),type:"host",extension:{}}],I.debug("Using remote candidate from AP ".concat(O.ip,":").concat(O.port)),O.ip6&&(D.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:O.ip6,port:O.port.toString(),type:"host",extension:{}}),I.debug("Using IPV6 remote candidate from AP ".concat(O.ip6,":").concat(O.port)))):D=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:M.ip,port:M.port.toString(),type:"host",extension:{}}],D}(a,d);return i._p2pChannel.preConnect({iceUfrag:"".concat(null===(_=i._joinInfo)||void 0===_?void 0:_.apResponse.cid,"_").concat(null===(g=i._joinInfo)||void 0===g?void 0:g.apResponse.cert),icePwd:"".concat(null===(v=i._joinInfo)||void 0===v?void 0:v.apResponse.cid,"_").concat(null===(b=i._joinInfo)||void 0===b?void 0:b.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(y=B("FINGERPRINT"))&&void 0!==y?y:a.fingerprint}]},T,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(l).catch(h)});return function(a,d,l,h){return r.apply(this,arguments)}}())}_handleGatewaySignalEvents(){var i=this;this._gateway.signal.on(xe.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(xe.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(xe.ON_ADD_AUDIO_STREAM,r=>this._handleAddAudioOrVideoStream("audio",r.uid,r.ssrcId,r.cname,r.uint_id,r.ortc)),this._gateway.signal.on(xe.ON_ADD_VIDEO_STREAM,r=>this._handleAddAudioOrVideoStream("video",r.uid,r.ssrcId,r.cname,r.uint_id,r.ortc,r.rtxSsrcId)),this._gateway.signal.on(xe.ON_REMOTE_DATASTREAM_UPDATE,r=>{this._handleUpdateDataChannel(r)}),this._gateway.signal.on(xe.ON_REMOTE_FULL_DATASTREAM_INFO,r=>{this._handleUpdateDataChannel({added:r.datastreams,deleted:[]},!0)}),this._gateway.signal.on(xe.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(xe.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(xe.MUTE_AUDIO,r=>this._handleMuteStream(r.uid,Se.AUDIO,!0)),this._gateway.signal.on(xe.UNMUTE_AUDIO,r=>this._handleMuteStream(r.uid,Se.AUDIO,!1)),this._gateway.signal.on(xe.MUTE_VIDEO,r=>this._handleMuteStream(r.uid,Se.VIDEO,!0)),this._gateway.signal.on(xe.UNMUTE_VIDEO,r=>this._handleMuteStream(r.uid,Se.VIDEO,!1)),this._gateway.signal.on(xe.RECEIVE_METADATA,r=>{const a=gm(r.metadata);this.safeEmit($e.RECEIVE_METADATA,r.uid,a)}),this._gateway.signal.on(xe.ON_DATA_STREAM,function(){var r=L(function*(a){if(!a)return;let d=0;if(a.ordered||a.syncWithAudio){const l=i._p2pChannel.getStats(),h=i.remoteUsers.find(_=>_.uid===a.uid),f=l?.audioRecv.find(_=>_.ssrc===h?._audioSSRC);d=f?.jitterBufferMs}null==d&&(d=0),function tU(s){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(!s.syncWithAudio)return w_(r,{uid:s.uid,payload:gm(s.payload)});const a="".concat(r.id,"-").concat(s.uid),d=XP.get(a)||[],l=d.findIndex(g=>s.sendTs>=g.sendTs),h=$P($P({},s),{},{context:r,mediaDelay:i,recvTs:Date.now()});-1===l?d.push(h):d.splice(l,0,h),XP.set(a,d);let f=!1;var _;wb.has(a)?f=!(null===(_=wb.get(a))||void 0===_||!_.isSyncing):wb.set(a,{isSyncing:f,firstRecvTs:0,firstSendTs:0}),f||JP(a)}(a,d,{id:i._clientId,onStreamMessage:"function"==typeof i.onStreamMessage?i.onStreamMessage.bind(i):void 0,safeEmit:i.safeEmit.bind(i)})});return function(a){return r.apply(this,arguments)}}()),this._gateway.signal.on(xe.ON_CRYPT_ERROR,()=>{Jh(()=>{I.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit($e.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(xe.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(xe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{I.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,ze.TOKEN_EXPIRE),this.safeEmit($e.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(xe.ON_STREAM_FALLBACK_UPDATE,r=>{I.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(r.stream_id,", attr: ").concat(r.stream_type)),this.safeEmit($e.STREAM_FALLBACK,r.stream_id,1===r.stream_type?"fallback":"recover")}),this._gateway.signal.on(xe.ON_PUBLISH_STREAM,r=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:r.proxy})),I.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(r))))}),this._gateway.signal.on(xe.ENABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!0)}),this._gateway.signal.on(xe.DISABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!1)}),this._gateway.signal.on(de.REQUEST_TIMEOUT,(r,a)=>{if(this._joinInfo)switch(r){case Ae.PUBLISH:{if(!a)return;const h=a.ortc;if(h){var d,l;const f=h.some(v=>{let{stream_type:b}=v;return b===ut.Audio}),_=h.some(v=>{let{stream_type:b}=v;return b!==ut.Audio}),g=h.some(v=>{let{stream_type:b}=v;return b===ut.Screen||b===ut.ScreenLow});"offer"===a.state&&Ie.publish(this._joinInfo.sid,{eventElapse:Li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:k.TIMEOUT,audio:f,video:_,p2pid:a.p2p_id,publishRequestid:this.store.pubId,screenshare:g,audioName:f?null===(d=h.find(v=>{let{stream_type:b}=v;return b===ut.Audio}))||void 0===d||null===(d=d.ssrcs[0])||void 0===d?void 0:d.ssrcId.toString():void 0,videoName:_?null===(l=h.find(v=>{let{stream_type:b}=v;return b!==ut.Audio}))||void 0===l||null===(l=l.ssrcs[0])||void 0===l?void 0:l.ssrcId.toString():void 0})}break}case Ae.SUBSCRIBE:a&&Ie.subscribe(this._joinInfo.sid,{succ:!1,ec:k.TIMEOUT,audio:a.stream_type===Se.AUDIO,video:a.stream_type===Se.VIDEO,peerid:a.stream_id,subscribeRequestid:a.ssrcId,p2pid:this.store.p2pId,eventElapse:Li.measureFromSubscribeStart(this.store.clientId,a.ssrcId)})}}),this._gateway.signal.on(xe.ON_P2P_OK,r=>{}),this._gateway.signal.on(xe.ON_PUBLISHED_USER_LIST,r=>{if(null==r||!r.users)return;B("BLOCK_LOCAL_CLIENT")&&(r.users=r.users.filter(l=>!ou(l.string_id||l.stream_id,this.channelName)));const a=[],d=[];for(const l of r.users){let h=this._users.find(y=>y._uintid===l.stream_id);h?h._trust_in_room_=!0:(h=new Ii(l.string_id||l.stream_id,l.stream_id),this._users.push(h),0===this.getListeners($e.PUBLISHED_USER_LIST).length&&(I.debug("[".concat(this._clientId,"] user online"),l.stream_id),this.safeEmit($e.USER_JOINED,h)));const f=Bn.Audio&l.stream_type,_=(Bn.Video|Bn.LwoVideo)&l.stream_type,g=0!=(65280&l.stream_type),v=f&&h.hasAudio,b=_&&h.hasVideo;_&&(h._trust_video_stream_added_state_=!0,h._video_added_=!0,h._videoSSRC=l.video_ssrc,h._rtxSsrcId=l.video_rtx),f&&(h._trust_audio_stream_added_state_=!0,h._audio_added_=!0,h._audioSSRC=l.audio_ssrc),f&&!v&&0===this.getListeners($e.PUBLISHED_USER_LIST).length&&(I.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published audio")),this.safeEmit($e.USER_PUBLISHED,h,"audio")),_&&!b&&0===this.getListeners($e.PUBLISHED_USER_LIST).length&&(I.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published video")),this.safeEmit($e.USER_PUBLISHED,h,"video")),(f&&!v||_&&!b||g)&&a.push(h),_&&this._p2pChannel.hasPendingRemoteMedia(h,"video")&&d.push({user:h,mediaType:"video"}),f&&this._p2pChannel.hasPendingRemoteMedia(h,"audio")&&d.push({user:h,mediaType:"audio"})}d.length>0&&(I.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(d.map(l=>"user: ".concat(l.user.uid,", mediaType: ").concat(l.mediaType)).join("; ")," ")),this.massSubscribe(d).catch(l=>{I.error("[".concat(this._clientId,"] mass resubscribe error"),l.toString())})),this.getListeners($e.PUBLISHED_USER_LIST).length>0?B("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=a:(I.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(a.map(l=>l.uid).join(", "))),this.safeEmit($e.PUBLISHED_USER_LIST,a)):I.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(a.map(l=>l.uid).join(", ")))}),this._gateway.signal.on(xe.ON_RTP_CAPABILITY_CHANGE,r=>{const{video_codec:a}=r;this._p2pChannel instanceof si&&this._p2pChannel.updateRemoteRTPCapabilities(a.map(d=>d.toLowerCase()).filter(d=>{var l;return ye(l=Object.keys(xc)).call(l,d)}))})}_handleP2PEvents(){var i=this;this._gateway.signal.on(xe.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(fn.PUBLISH,(r,a,d)=>{const{uid:l}=r;r.forEach(h=>{const{kind:f,ssrcs:_,mid:g,isMuted:v}=h;this._handleP2PAddAudioOrVideoStream(f,l,_[0].ssrcId,g);const b=this._users.find(y=>y.uid===l);return b&&this._p2pChannel instanceof Je?this._p2pChannel.mockSubscribe(b,f,_[0].ssrcId,g).then(()=>{a()}).catch(d):a(),this._handleMuteStream(l,f,!!v)})}),this._gateway.signal.on(fn.CALL,function(){var r=L(function*(a,d,l){if(i._p2pChannel instanceof Je)try{var h;d(yield i._p2pChannel.startP2P({turnServer:null===(h=i._joinInfo)||void 0===h?void 0:h.turnServer},a))}catch(f){l(f)}});return function(a,d,l){return r.apply(this,arguments)}}()),this._gateway.signal.on(de.P2P_CONNECTION,function(){var r=L(function*(a){i._p2pChannel instanceof Je&&(yield i._p2pChannel.p2pConnect(a))});return function(a){return r.apply(this,arguments)}}()),this._gateway.signal.on(fn.UNPUBLISH,function(){var r=L(function*(a,d,l){if(i._p2pChannel instanceof Je){const{unpubMsg:h,uid:f}=a,_=i._users.find(g=>g.uid===f);if(!_)return I.warning("[".concat(i._clientId,"] can not find remote user, ignore mute event, uid: ").concat(f)),void d();try{h.forEach(function(){var g=L(function*(v){let{stream_type:b}=v;const y=b===ut.Audio?Se.AUDIO:Se.VIDEO;yield i._p2pChannel.unsubscribe(_,y),i._handleMuteStream(f,y,!0)});return function(v){return g.apply(this,arguments)}}()),d()}catch(g){l(g)}}});return function(a,d,l){return r.apply(this,arguments)}}()),this._gateway.signal.on(fn.CONTROL,function(){var r=L(function*(a,d){const{action:l}=a;switch(l){case Vc.MUTE_LOCAL_VIDEO:i._handleMuteStream(d,Se.VIDEO,!0);break;case Vc.MUTE_LOCAL_AUDIO:i._handleMuteStream(d,Se.AUDIO,!0);break;case Vc.UNMUTE_LOCAL_VIDEO:i._handleP2PAddAudioOrVideoStream("video",d),i._handleMuteStream(d,Se.VIDEO,!1);break;case Vc.UNMUTE_LOCAL_AUDIO:i._handleP2PAddAudioOrVideoStream("audio",d),i._handleMuteStream(d,Se.AUDIO,!1)}});return function(a,d){return r.apply(this,arguments)}}()),this._gateway.signal.on(fn.RESTART_ICE,function(){var r=L(function*(a,d,l){if(i._p2pChannel instanceof Je)try{const{direction:h,iceParameter:f}=a;h!==Ei.SEND_ONLY||f?d(yield i._p2pChannel.restartICE(h,f)):(i._p2pChannel.handleDisconnect(h),d())}catch(h){l(h)}});return function(a,d,l){return r.apply(this,arguments)}}()),this._gateway.signal.on(fn.CANDIDATE,r=>{if(this._p2pChannel instanceof Je){const{candidate:a,direction:d}=r;this._p2pChannel.addRemoteCandidate(a,d)}}),this._p2pChannel.on(Oe.RequestP2PRestartICE,function(){var r=L(function*(a,d,l){try{const{direction:h}=a;d(yield i._gateway.sendExtensionMessage(fn.RESTART_ICE,a,h===Ei.SEND_ONLY))}catch(h){l(h)}});return function(a,d,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(Oe.LocalCandidate,r=>{this._gateway.sendExtensionMessage(fn.CANDIDATE,JSON.stringify(r),!0)}),this._p2pChannel.on(Oe.RequestP2PMuteLocal,function(){var r=L(function*(a,d,l){try{yield i._gateway.sendExtensionMessage(fn.CONTROL,a,!0),d()}catch(h){l(h)}});return function(a,d,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(Oe.RequestP2PUnmuteRemote,function(){var r=L(function*(a,d,l){if(i._joinInfo)try{yield i._gateway.unmuteRemote(a,i._joinInfo.stringUid||i._joinInfo.uid),d()}catch(h){h.code===k.DISCONNECT_P2P?d():l(h)}else d()});return function(a,d,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(Oe.RequestP2PMuteRemote,function(){var r=L(function*(a,d,l){if(i._joinInfo)try{yield i._gateway.muteRemote(a,i._joinInfo.stringUid||i._joinInfo.uid),d()}catch(h){h.code===k.DISCONNECT_P2P?d():l(h)}else d()});return function(a,d,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(Oe.StateChange,(r,a)=>{a===Dt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){var i=this;this._p2pChannel.on(Oe.RequestMuteLocal,function(){var r=L(function*(a,d,l){if(i._joinInfo)try{yield i._gateway.muteLocal(a,i._joinInfo.stringUid||i._joinInfo.uid),d()}catch(h){h.code===k.DISCONNECT_P2P?d():l(h)}else d()});return function(a,d,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(Oe.RequestUnmuteLocal,function(){var r=L(function*(a,d,l){if(i._joinInfo)try{yield i._gateway.unmuteLocal(a,i._joinInfo.stringUid||i._joinInfo.uid),d()}catch(h){h.code===k.DISCONNECT_P2P?d():l(h)}else d()});return function(a,d,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(Oe.RequestRePublish,(r,a,d)=>{this.publish(r,!1).then(a).catch(d)}),this._p2pChannel.on(Oe.RequestRePublishDataChannel,(r,a,d)=>{X.all(r.map(function(){var l=L(function*(h){yield i._p2pChannel.publishDataChannel([h]);const f={streamId:h.id,ordered:h.ordered,maxRetransmits:h.maxRetransmits,metadata:h.metadata,channelId:h._originDataChannelId};try{yield i._gateway.publishDataChannel(i._uid,f,!0)}catch(_){if(_.code!==k.DISCONNECT_P2P)throw _}});return function(h){return l.apply(this,arguments)}}())).then(a).catch(d)}),this._p2pChannel.on(Oe.RequestReSubscribe,function(){var r=L(function*(a,d,l){try{for(const{user:h,kind:f}of a)f===Se.VIDEO?yield i.subscribe(h,"video"):yield i.subscribe(h,"audio");d()}catch(h){l(h)}});return function(a,d,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(Oe.RequestUpload,(r,a)=>{this._gateway.upload(r,a)}),this._p2pChannel.on(Oe.RequestUploadStats,r=>{this._gateway.uploadWRTCStats(r)}),this._p2pChannel.on(Oe.MediaReconnectStart,r=>{this.safeEmit($e.MEDIA_RECONNECT_START,r)}),this._p2pChannel.on(Oe.MediaReconnectEnd,r=>{this.safeEmit($e.MEDIA_RECONNECT_END,r)}),this._p2pChannel.on(Oe.NeedSignalRTT,r=>{r(this._gateway.getSignalRTT())}),this._p2pChannel.on(Oe.RequestRestartICE,function(){var r=L(function*(a){if(i._p2pChannel instanceof Je)return;const d=yield i._p2pChannel.restartICE(a),l=yield d.next();if(l.done)return;const h=l.value;let f;try{f=yield i._gateway.restartICE({iceParameters:h})}catch(g){return void d.throw(g)}const{iceParameters:_}=function(g){const v=g.iceParameters;return{iceParameters:{iceUfrag:v.iceUfrag,icePwd:v.icePwd}}}(f);yield d.next({remoteIceParameters:_})});return function(a){return r.apply(this,arguments)}}()),this._p2pChannel.on(Oe.RequestReconnect,L(function*(){i._gateway.reconnect()})),this._p2pChannel.on(Oe.RequestReconnectPC,L(function*(){var r;const{iceParameters:a,dtlsParameters:d,rtpCapabilities:l}=yield i._p2pChannel.startP2PConnection({turnServer:null===(r=i._joinInfo)||void 0===r?void 0:r.turnServer}),{gatewayEstablishParams:h,gatewayAddress:f}=yield i._gateway.reconnectPC({iceParameters:a,dtlsParameters:d,rtpCapabilities:l}),{dtlsParameters:_,iceParameters:g,candidates:v,rtpCapabilities:b,setup:y,cname:T}=bP(h,f);yield i._p2pChannel.connect(g,_,v,b,y,T),yield i._p2pChannel.republish(),yield i._p2pChannel.reSubscribe()})),this._p2pChannel.on(Oe.RequestUnpublishForReconnectPC,function(){var r=L(function*(a,d,l){i._joinInfo&&void 0!==i._uid?(yield i._gateway.unpublish(a,i._uid),d()):l()});return function(a,d,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(Oe.P2PLost,()=>{this.safeEmit($e.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Oe.UpdateVideoEncoder,r=>{r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig)}),this._p2pChannel.on(Oe.ConnectionTypeChange,r=>{this.safeEmit($e.IS_USING_CLOUD_PROXY,r)}),this._p2pChannel.on(Oe.RequestLowStreamParameter,r=>{r(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Oe.QueryClientConnectionState,r=>{r(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}enableContentInspect(i){var r=this;return L(function*(){if("CONNECTED"!==r.connectionState||!r._joinInfo)throw new W(k.INVALID_OPERATION,"[".concat(r._clientId,"] Client did not join channel"));if(r._inspect)throw new W(k.INVALID_OPERATION,"[".concat(r._clientId,"] Inspect content service already in connecting/connected state"));if(!i)throw new W(k.INVALID_PARAMS,"[".concat(r._clientId,"] inspectConfig is necessary"));if(!i.inspectType||!Array.isArray(i.inspectType))throw new W(k.INVALID_PARAMS,"[".concat(r._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const a=[...new Set(i.inspectType)];a.forEach(d=>{var l;if(!ye(l=["supervise","moderation"]).call(l,d))throw new W(k.INVALID_PARAMS,"[".concat(r._clientId,"] ").concat(d," is not a valid inspect type."))}),i.inspectType=a}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new W(k.INVALID_PARAMS,"[".concat(r._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const a=new Tb(i);r._inspect=a,r.handleVideoInspectEvents(r._inspect),yield a.init({appId:r._joinInfo.appId,areaCode:"",cname:r._joinInfo.cname,sid:r._joinInfo.sid,token:r._joinInfo.token,uid:r._joinInfo.uid,cid:r._joinInfo.cid,vid:r._joinInfo.vid?Number(r._joinInfo.vid):0},Pn)}catch(a){throw Array.isArray(a)?a[0]:a}})()}disableContentInspect(){var i=this;return L(function*(){if(!i._inspect)throw new W(k.INVALID_OPERATION,"[".concat(i._clientId,"] inspectVideoContent not started"));try{i._inspect.close(),i._inspect=void 0}catch(r){throw Array.isArray(r)?r[0]:r}})()}setImageModeration(i,r){var a=this;return L(function*(){if(Rc(i,"enabled"),i){if(!r)throw new W(k.INVALID_PARAMS,"[".concat(a._clientId,"] config is necessary"));if(At(r.interval,"interval",1e3,1/0),r&&r.extraInfo&&r.extraInfo.length>1024)throw new W(k.INVALID_PARAMS,"[".concat(a._clientId,"] config.extraInfo length cannot exceed 1024 bytes"));if(r&&r.vendor&&r.vendor.length>1024)throw new W(k.INVALID_PARAMS,"[".concat(a._clientId,"] config.vendor length cannot exceed 1024 bytes"));if("CONNECTED"!==a.connectionState||!a._joinInfo)throw new W(k.INVALID_OPERATION,"[".concat(a._clientId,'] can not enable image moderation, not joined"'));try{if(a._moderation)return void a._moderation.updateConfig(r);const d=new oI(r);a._moderation=d,a.handleImageModerationEvents(a._moderation),yield d.init({appId:a._joinInfo.appId,areaCode:"",cname:a._joinInfo.cname,sid:a._joinInfo.sid,token:a._joinInfo.token,uid:a._joinInfo.uid,cid:a._joinInfo.cid,vid:a._joinInfo.vid?Number(a._joinInfo.vid):0},Pn)}catch(d){throw Array.isArray(d)?d[0]:d}}else{if(!a._moderation)throw new W(k.INVALID_OPERATION,"[".concat(a._clientId,"] image moderation not started"));try{a._moderation.close(),a._moderation.removeAllListeners(),a._moderation=void 0}catch(d){throw Array.isArray(d)?d[0]:d}}})()}setP2PTransport(i){if(Cn(i,"transport",["default","auto","relay","sd-rtn"]),"p2p"!==this.mode)throw new W(k.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=i,I.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(i))}handleImageModerationEvents(i){i.on(ls.CONNECTION_STATE_CHANGE,(r,a)=>{if(this.safeEmit($e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,a),r===qr.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new W(k.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");i.inspectImage()}}),i.on(ls.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(a=>"video"===a.trackMediaType)[0])})}handleVideoInspectEvents(i){i.on(ni.CONNECTION_STATE_CHANGE,(r,a)=>{if(this.safeEmit($e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,a),a===Do.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit($e.CONTENT_INSPECT_ERROR,new W(k.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));i.inspectImage()}}),i.on(ni.INSPECT_RESULT,(r,a)=>{var d;if(a?.code===k.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return I.debug("Stop inspect content because that has left channel"),null==this||null===(d=this._inspect)||void 0===d||d.close(),void(this._inspect=void 0);this.safeEmit($e.CONTENT_INSPECT_RESULT,r,a)}),i.on(ni.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(a=>"video"===a.trackMediaType)[0])})}getJoinChannelServiceRecords(){return I.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}setPublishAudioFilterEnabled(i){var r=this;return L(function*(){Rc(i,"enabled"),It("ENABLE_PUBLISH_AUDIO_FILTER",i),r._joinInfo&&(yield r._gateway.setPublishAudioFilterEnabled(i))})()}_handleResetAddStream(i,r){switch(r){case"audio":i._audio_added_=!1,i._trust_audio_stream_added_state_=!0;break;case"video":i._video_added_=!1,i._trust_video_stream_added_state_=!0}}}ne([we(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",X)],Mt.prototype,"leave",null),ne([we({argsMap:(s,i)=>{if(!Array.isArray(i)){if(!(i instanceof Bi))return[i];i=[i]}return i.map(r=>r?Object(r).toString():"null")}}),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",X)],Mt.prototype,"publish",null),ne([we({argsMap:(s,i)=>(i||(i=[]),i instanceof _F?[i.getChannelId()]:(Array.isArray(i)||(i=[i]),i.map(r=>r.getTrackId())))}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],Mt.prototype,"unpublish",null),ne([we({argsMap:(s,i,r,a)=>[i.uid,r,a]}),N("design:type",Function),N("design:paramtypes",[Ii,String,Number]),N("design:returntype",X)],Mt.prototype,"subscribe",null),ne([we({argsMap:(s,i,r)=>[i,r]}),N("design:type",Function),N("design:paramtypes",[Object,String]),N("design:returntype",X)],Mt.prototype,"presubscribe",null),ne([we({argsMap:(s,i)=>i.map(r=>{let{user:a,mediaType:d}=r;return[a?.uid,d]})}),N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],Mt.prototype,"massSubscribe",null),ne([we({argsMap:(s,i,r,a)=>[i.uid,r,a]}),N("design:type",Function),N("design:paramtypes",[Ii,String,Number]),N("design:returntype",X)],Mt.prototype,"unsubscribe",null),ne([we({argsMap:(s,i)=>i.map(r=>{let{user:a,mediaType:d}=r;return{uid:a?.uid,mediaType:d}})}),N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],Mt.prototype,"massUnsubscribe",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],Mt.prototype,"setLowStreamParameter",null),ne([we(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",X)],Mt.prototype,"enableDualStream",null),ne([we(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",X)],Mt.prototype,"disableDualStream",null),ne([we(),N("design:type",Function),N("design:paramtypes",[String,Object]),N("design:returntype",X)],Mt.prototype,"setClientRole",null),ne([we(),N("design:type",Function),N("design:paramtypes",[String,Boolean]),N("design:returntype",void 0)],Mt.prototype,"setProxyServer",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",void 0)],Mt.prototype,"setTurnServer",null),ne([we(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",void 0)],Mt.prototype,"setLicense",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],Mt.prototype,"startProxyServer",null),ne([we(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Mt.prototype,"stopProxyServer",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],Mt.prototype,"setLocalAccessPointsV2",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Array,String]),N("design:returntype",void 0)],Mt.prototype,"setLocalAccessPoints",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",X)],Mt.prototype,"setRemoteDefaultVideoStreamType",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Object,Number]),N("design:returntype",X)],Mt.prototype,"setRemoteVideoStreamType",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Object,Number]),N("design:returntype",X)],Mt.prototype,"setStreamFallbackOption",null),ne([we({argsMap:(s,i)=>[i]}),N("design:type",Function),N("design:paramtypes",[String,String,Uint8Array]),N("design:returntype",void 0)],Mt.prototype,"setEncryptionConfig",null),ne([we(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],Mt.prototype,"renewToken",null),ne([we(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Mt.prototype,"enableAudioVolumeIndicator",null),ne([we(),N("design:type",Function),N("design:paramtypes",[String,Boolean]),N("design:returntype",X)],Mt.prototype,"startLiveStreaming",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],Mt.prototype,"setLiveTranscoding",null),ne([we(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],Mt.prototype,"stopLiveStreaming",null),ne([we(),N("design:type",Function),N("design:paramtypes",[String,Object]),N("design:returntype",X)],Mt.prototype,"addInjectStreamUrl",null),ne([we(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",X)],Mt.prototype,"removeInjectStreamUrl",null),ne([we(),N("design:type",Function),N("design:paramtypes",[pb]),N("design:returntype",X)],Mt.prototype,"startChannelMediaRelay",null),ne([we(),N("design:type",Function),N("design:paramtypes",[pb]),N("design:returntype",X)],Mt.prototype,"updateChannelMediaRelay",null),ne([we(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",X)],Mt.prototype,"stopChannelMediaRelay",null),ne([we({argsMap:(s,i)=>(Array.isArray(i)||(i=[i]),[JSON.stringify(i)])}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],Mt.prototype,"sendCustomReportMessage",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Object,Object]),N("design:returntype",X)],Mt.prototype,"pickSVCLayer",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],Mt.prototype,"setRTMConfig",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],Mt.prototype,"enableContentInspect",null),ne([we(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",X)],Mt.prototype,"disableContentInspect",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Boolean,Object]),N("design:returntype",X)],Mt.prototype,"setImageModeration",null),ne([we(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",void 0)],Mt.prototype,"setP2PTransport",null),ne([we({reportResult:!0}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",Array)],Mt.prototype,"getJoinChannelServiceRecords",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Boolean]),N("design:returntype",X)],Mt.prototype,"setPublishAudioFilterEnabled",null);class R_{constructor(i,r){C(this,"id",0),C(this,"element",void 0),C(this,"peerPair",void 0),C(this,"context",void 0),C(this,"audioPlayerElement",void 0),C(this,"audioTrack",void 0),R_.count+=1,this.id=R_.count,this.element=i,this.context=r}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=i=>{const r=document.createElement("audio");r.srcObject=new MediaStream([i.track]),r.play(),this.audioPlayerElement=r}}switchSdp(){var i=this;return L(function*(){if(!i.peerPair)return;const r=function(){var d=L(function*(l,h){const f="offer"===h?yield l.createOffer():yield l.createAnswer();return yield l.setLocalDescription(f),"complete"===l.iceGatheringState?l.localDescription:new X(_=>{l.onicegatheringstatechange=()=>{"complete"===l.iceGatheringState&&_(l.localDescription)}})});return function(h,f){return d.apply(this,arguments)}}(),a=function(){var d=L(function*(l,h){return yield l.setRemoteDescription(h)});return function(h,f){return d.apply(this,arguments)}}();try{const d=yield r(i.peerPair[0],"offer");yield a(i.peerPair[1],d);const l=yield r(i.peerPair[1],"answer");yield a(i.peerPair[0],l)}catch(d){throw new W(k.LOCAL_AEC_ERROR,d.toString()).print()}})()}getTracksFromMediaElement(i){var r=this;return L(function*(){if(r.audioTrack)return r.audioTrack;let a;try{i instanceof HTMLVideoElement&&(i.captureStream?i.captureStream():i.mozCaptureStream()),a=r.context.createMediaStreamDestination(),r.context.createMediaElementSource(i).connect(a)}catch(l){throw new W(k.LOCAL_AEC_ERROR,l.toString()).print()}if(!a)throw new W(k.LOCAL_AEC_ERROR,"no dest node when local aec").print();const d=a.stream.getAudioTracks()[0];return r.audioTrack=d,d})()}getElement(){return this.element}startEchoCancellation(){var i=this;return L(function*(){i.context.resume(),i.peerPair&&i.close(),i.initPeers();const r=i.element,a=yield i.getTracksFromMediaElement(r);i.peerPair&&i.peerPair[0].addTrack(a),yield i.switchSdp()})()}close(){I.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(i=>{i.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}C(R_,"count",0);const iU=window.AudioContext||window.webkitAudioContext;class ZP{constructor(){C(this,"units",[]),C(this,"context",void 0)}processExternalMediaAEC(i){if(!this._doesEnvironmentNeedAEC())return I.debug("the system does not need to process local aec"),-1;this.context||(this.context=new iU);let r=this.units.find(a=>a&&a.getElement()===i);return r||(r=new R_(i,this.context),this.units.push(r)),r.startEchoCancellation(),I.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return lt().name!==gt.SAFARI}}ne([we({report:Ie}),N("design:type",Function),N("design:paramtypes",[HTMLAudioElement]),N("design:returntype",Number)],ZP.prototype,"processExternalMediaAEC",null);const aj=new ZP;function rU(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function eM(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?rU(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):rU(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}const cI=window||document;function tM(s){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!cI)return;const r=Xn._cspEventHandlerPointer;if(r&&i)return void console.error(r,i);const a=d=>{if(!(d&&d.blockedURI&&(Xn.onSecurityPolicyViolation||Xn.getListeners(ds.SECURITY_POLICY_VIOLATION).length>0)))return;const l=d.blockedURI;B("CSP_DETECTED_HOSTNAME_LIST").some(h=>ye(l).call(l,h))&&(Xn.onSecurityPolicyViolation&&"function"==typeof Xn.onSecurityPolicyViolation&&Xn.onSecurityPolicyViolation(d),Xn.getListeners(ds.SECURITY_POLICY_VIOLATION).length>0&&Xn.safeEmit(ds.SECURITY_POLICY_VIOLATION,d))};r&&cI.removeEventListener("securitypolicyviolation",r),(i||s&&"function"==typeof s||Xn.getListeners(ds.SECURITY_POLICY_VIOLATION).length>0)&&cI.addEventListener("securitypolicyviolation",a),Xn._cspEventHandlerPointer=a}It("PROCESS_ID","process-".concat(qe(8,""),"-").concat(qe(4,""),"-").concat(qe(4,""),"-").concat(qe(4,""),"-").concat(qe(12,""))),function(){let s;try{s=window.localStorage.getItem("websdk_ng_global_parameter")}catch(i){return void I.error("Error loading sdk config",i.message)}if(s)try{const i=JSON.parse(window.atob(s)),r=Date.now();I.debug("Loading global parameters from cache",i),Object.keys(i).forEach(a=>{if(Object.prototype.hasOwnProperty.call(gr,a)){const{value:d,expires:l}=i[a];if(l&&l<=r)return;Ld[a]=d,gr[a]=d}})}catch(i){I.error("Error loading mutableParamsCache: ".concat(s),i.message)}}(),Array.isArray(Ld.AREAS)&&Ld.AREAS.length>0&&_p(Ld.AREAS,!0);const oU=(s,i,r)=>{I.debug("setParameter key:".concat(s,", value:").concat(JSON.stringify(i))),It(s,i,r)},Xn=function(s){const i=new jt,r=s,a={getListeners:i.getListeners.bind(i),on:(d,l)=>(d===ds.SECURITY_POLICY_VIOLATION&&tM(l,!0),i.on.bind(i)(d,l)),addListener:i.addListener.bind(i),once:i.once.bind(i),off:i.off.bind(i),removeAllListeners:i.removeAllListeners.bind(i),emit:i.emit.bind(i),safeEmit:i.safeEmit.bind(i)};return eM(eM({},r),a)}({__TRACK_LIST__:hu,VERSION:Ao,BUILD:mT,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:oU,getParameter:B,getSupportedCodec:function(){var s=L(function*(){let i={audio:[],video:[]};try{let r=new RTCPeerConnection;r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});const a=(yield r.createOffer()).sdp;if(!a)return i;r.close(),r=null,i=function(d){const l={video:[],audio:[]};return d.match(/ VP8/i)&&l.video.push("VP8"),d.match(/ VP9/i)&&l.video.push("VP9"),d.match(/ AV1/i)&&l.video.push("AV1"),d.match(/ H264/i)&&l.video.push("H264"),d.match(/ H265/i)&&l.video.push("H265"),d.match(/ opus/i)&&l.audio.push("OPUS"),d.match(/ PCMU/i)&&l.audio.push("PCMU"),d.match(/ PCMA/i)&&l.audio.push("PCMA"),d.match(/ G722/i)&&l.audio.push("G722"),l}(a)}catch(r){throw new W(k.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return i});return function(){return s.apply(this,arguments)}}(),checkSystemRequirements:function(){const s=Ie.reportApiInvoke(null,{name:qn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Kt.TRACER});let i=!1;try{const l=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,f=window.WebSocket;i=!!(l&&h&&f)}catch(l){return I.error("check system requirement failed: ",l),!1}let r=!1;const a=lt();a.name===gt.CHROME&&Number(a.version)>=58&&(!function RD(){return"WebKit"===Tc.engine.name}()||function wD(){const s=lt();if(KE()){if(s.os===Zn.MAC_OS)return!0;if(s.os===Zn.IOS){const i=Tc.os.version&&Tc.os.version.split(".");if(i&&14===Number(i[0])&&i[1]&&Number(i[1])>=3||i&&Number(i[0])>14)return!0}}return!1}())&&(r=!0),a.name===gt.FIREFOX&&Number(a.version)>=56&&(r=!0),a.name===gt.OPERA&&Number(a.version)>=45&&(r=!0),a.name===gt.SAFARI&&Number(a.version)>=11&&(r=!0),(PD()||lt().name===gt.QQ)&&(r=!0),I.debug("checkSystemRequirements, api:",i,"browser",r);const d=i&&r;return s.onSuccess(d),d},getDevices:function(s){return ko.enumerateDevices(!0,!0,s)},getMicrophones:function(s){return ko.getRecordingDevices(s)},getCameras:function(s){return ko.getCamerasDevices(s)},getElectronScreenSources:S2,getPlaybackDevices:function(s){return ko.getSpeakers(s)},createClient:function(){var s;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const r=Ie.reportApiInvoke(null,{name:qn.CREATE_CLIENT,options:[i],tag:Kt.TRACER});try{Cn((a=i).codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Cn(a.mode,"config.mode",["rtc","live","p2p"]),void 0!==a.audioCodec&&Cn(a.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==a.proxyServer&&hi(a.proxyServer,"config.proxyServer",1,1e4),void 0!==a.turnServer&&Xh(a.turnServer),void 0!==a.httpRetryConfig&&FD(a.httpRetryConfig),void 0!==a.websocketRetryConfig&&FD(a.websocketRetryConfig)}catch(a){throw r.onError(a),a}var a;return function nU(){return!function(s,i,r){const a=lt();if(a.os!==Zn.IOS||!a.osVersion)return!1;const d=a.osVersion.split(".");return Number(d[0])<16}()&&!function(s,i,r){const a=lt();if(a.name!==gt.SAFARI||!a.osVersion)return!1;const d=a.version.split(".");return Number(d[0])<16}()}()||("vp9"===i.codec&&(i.codec="vp8",I.debug("browser not support vp9, force use vp8")),It("UNSUPPORTED_VIDEO_CODEC",["vp9"])),void 0===i.audioCodec&&(i.audioCodec="opus"),r.onSuccess(),new Mt(ol(ol({forceWaitGatewayResponse:!0},i),{},{role:ye(s=["rtc","p2p"]).call(s,i.mode)?"host":i.role||"audience"}))},createCameraVideoTrack:function(){var s=L(function*(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=Ie.reportApiInvoke(null,{tag:Kt.TRACER,name:qn.CREATE_CAM_VIDEO_TRACK,options:[Qm({},i)]}),a=Hv(i),d=qe(8,"track-cam-");let l=null;const h="720p_auto"===i.encoderConfig;I.info("start create camera video track with config",JSON.stringify(i),"trackId",d);try{l=(yield xo({video:a},d)).getVideoTracks()[0]||null}catch(_){throw r.onError(_),_}if(!l){const _=new ee(k.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(_),_.throw(I)}i.optimizationMode&&Zm(d,l,i,Mo(i.encoderConfig));const f=new ms(l,i,a,i.scalabiltyMode?Gm(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,d);return h&&f.startMonitorStats(),r.onSuccess(f.getTrackId()),I.info("create camera video success, trackId:",d),f});return function(){return s.apply(this,arguments)}}(),createCustomVideoTrack:function(s){const i=Ie.reportApiInvoke(null,{tag:Kt.TRACER,name:qn.CREATE_CUSTOM_VIDEO_TRACK,options:[s]}),r=new je(s.mediaStreamTrack,{width:s.width,height:s.height,frameRate:s.frameRate,bitrateMax:s.bitrateMax,bitrateMin:s.bitrateMin},s.scalabiltyMode?Gm(s.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},s.optimizationMode,qe(8,"track-cus-"),[kt.CUSTOM_TRACK]);return i.onSuccess(r.getTrackId()),I.info("create custom video track success with config",s,"trackId",r.getTrackId()),r},createScreenVideoTrack:function(){var s=L(function*(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const a=Ie.reportApiInvoke(null,{tag:Kt.TRACER,name:qn.CREATE_SCREEN_VIDEO_TRACK,options:[Qm({},i),r]}),d="720p_auto"===i.encoderConfig;i.encoderConfig?"string"==typeof i.encoderConfig||i.encoderConfig.width&&i.encoderConfig.height||(i.encoderConfig.width={max:1920},i.encoderConfig.height={max:1080}):i.encoderConfig="1080p_2";const l=function(y){const T={};y.screenSourceType&&(T.mediaSource=y.screenSourceType),y.extensionId&&um()&&(T.extensionId=y.extensionId);const{displaySurface:M,selfBrowserSurface:O,surfaceSwitching:D,systemAudio:x}=y;(hm(107)||AD(107)||LL(93))&&(M&&(Cn(M,"displaySurface",["browser","window","monitor"]),T.displaySurface=M),O?(Cn(O,"selfBrowserSurface",["exclude","include"]),T.selfBrowserSurface=O):T.selfBrowserSurface="include",D&&(Cn(D,"surfaceSwitching",["exclude","include"]),T.surfaceSwitching=D)),(hm(105)||AD(105)||LL(91))&&x&&(Cn(x,"systemAudio",["exclude","include"]),T.systemAudio=x),y.electronScreenSourceId&&(T.sourceId=y.electronScreenSourceId);const F=y.encoderConfig?Fv(y.encoderConfig):null;return T.mandatory={chromeMediaSource:"desktop",maxWidth:F?F.width:void 0,maxHeight:F?F.height:void 0},F&&(F.frameRate&&("number"==typeof F.frameRate?(T.mandatory.maxFrameRate=F.frameRate,T.mandatory.minFrameRate=F.frameRate):(T.mandatory.maxFrameRate=F.frameRate.max||F.frameRate.ideal||F.frameRate.exact||void 0,T.mandatory.minFrameRate=F.frameRate.min||F.frameRate.ideal||F.frameRate.exact||void 0),T.frameRate=F.frameRate),F.width&&(T.width=F.width),F.height&&(T.height=F.height)),T}(i),h=qe(8,"track-scr-v-");let f=null,_=null;const g=Ot();if(!g.supportShareAudio&&"enable"===r){const y=new ee(k.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return a.onError(y),y.throw(I)}I.info("start create screen video track with config",i,"withAudio",r,"trackId",h);try{const y=yield xo({screen:l,screenAudio:"auto"===r?g.supportShareAudio:"enable"===r},h);f=y.getVideoTracks()[0]||null,_=y.getAudioTracks()[0]||null}catch(y){throw a.onError(y),y}if(!f){const y=new ee(k.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(y),y.throw(I)}if(!_&&"enable"===r){f&&f.stop();const y=new ee(k.SHARE_AUDIO_NOT_ALLOWED);return a.onError(y),y.throw(I)}i.optimizationMode||(i.optimizationMode="detail"),i.optimizationMode&&(Zm(h,f,i,i.encoderConfig&&Fv(i.encoderConfig)||void 0),i.encoderConfig&&"string"!=typeof i.encoderConfig&&(i.encoderConfig.bitrateMin=i.encoderConfig.bitrateMax));const v=new je(f,i.encoderConfig?Fv(i.encoderConfig):{},i.scalabiltyMode?Gm(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,h,[kt.SCREEN_TRACK]);if(d&&v.startMonitorStats(),!_)return a.onSuccess(v.getTrackId()),I.info("create screen video track success","video:",v.getTrackId()),v;const b=new Et(_,void 0,qe(8,"track-scr-a-"),!1,!0);return a.onSuccess([v.getTrackId(),b.getTrackId()]),I.info("create screen video track success","video:",v.getTrackId(),"audio:",b.getTrackId()),[v,b]});return function(){return s.apply(this,arguments)}}(),createMicrophoneAndCameraTracks:function(){var s=L(function*(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=Ie.reportApiInvoke(null,{tag:Kt.TRACER,name:qn.CREATE_MIC_AND_CAM_TRACKS,options:[i,r]}),d="720p_auto"===r.encoderConfig,l=Hv(r),h=D2(i),f=qe(8,"track-mic-"),_=qe(8,"track-cam-");let g=null,v=null;I.info("start create camera video track(".concat(_,") and microphone audio track(").concat(f,") with config, audio: ").concat(JSON.stringify(i),", video: ").concat(JSON.stringify(r)));try{const T=yield xo({audio:h,video:l},"".concat(f,"-").concat(_));g=T.getAudioTracks()[0],v=T.getVideoTracks()[0]}catch(T){throw a.onError(T),T}if(!g||!v){const T=new ee(k.UNEXPECTED_ERROR,"can not find tracks in media stream");return a.onError(T),T.throw(I)}r.optimizationMode&&Zm(_,v,r,Mo(r.encoderConfig));const b=new ji(g,i,h,f),y=new ms(v,r,l,r.scalabiltyMode?Gm(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,_);return d&&y.startMonitorStats(),a.onSuccess([b.getTrackId(),y.getTrackId()]),I.info("create camera video track(".concat(_,") and microphone audio track(").concat(f,") success")),[b,y]});return function(){return s.apply(this,arguments)}}(),createMicrophoneAudioTrack:function(){var s=L(function*(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=Ie.reportApiInvoke(null,{tag:Kt.TRACER,name:qn.CREATE_MIC_AUDIO_TRACK,options:[i]}),a=D2(i),d=qe(8,"track-mic-");let l=null;I.info("start create microphone audio track with config",JSON.stringify(i),"trackId",d);try{l=(yield xo({audio:a},d)).getAudioTracks()[0]||null}catch(f){throw r.onError(f),f}if(!l){const f=new ee(k.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(f),f.throw(I)}const h=new ji(l,i,a,d);return r.onSuccess(h.getTrackId()),I.info("create microphone audio track success, trackId:",d),h});return function(){return s.apply(this,arguments)}}(),createCustomAudioTrack:function(s){const i=Ie.reportApiInvoke(null,{tag:Kt.TRACER,name:qn.CREATE_CUSTOM_AUDIO_TRACK,options:[s]}),r=new Et(s.mediaStreamTrack,s.encoderConfig?Wm(s.encoderConfig):{},qe(8,"track-cus-"),!1,!0);return I.info("create custom audio track success with config",s,"trackId",r.getTrackId()),i.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:function(){var s=L(function*(i){var r;const{cacheOnlineFile:a,encoderConfig:d}=i;let{source:l}=i;const h={source:l instanceof AudioBuffer?"AudioBuffer":l instanceof File?null!==(r=File.name)&&void 0!==r?r:"File":l,cacheOnlineFile:a,encoderConfig:d},f=Ie.reportApiInvoke(null,{tag:Kt.TRACER,name:qn.CREATE_BUFFER_AUDIO_TRACK,options:[h]});if(B("DISABLE_WEBAUDIO"))throw new ee(k.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const _=qe(8,"track-buf-");I.info("start create buffer source audio track with config",JSON.stringify(h),"trackId",_);const g=l;if(!(l instanceof AudioBuffer))try{l=yield function O2(s,i){return $m.apply(this,arguments)}(l,a)}catch(y){return f.onError(y),y.throw(I)}const v=new FB(l),b=new fs(g,v,d?Wm(d):{},_);return I.info("create buffer source audio track success, trackId:",_),f.onSuccess(b.getTrackId()),b});return function(r){return s.apply(this,arguments)}}(),setAppType:function(s){if(I.debug("setAppType: ".concat(s)),!(Number.isInteger(s)&&s>=0))throw I.debug("Invalid appType"),new W(k.INVALID_PARAMS,"invalid app type",s);It("APP_TYPE",Math.floor(s))},setLogLevel:function(s){I.setLogLevel(s)},enableLogUpload:function(){B("USE_NEW_LOG")?It("UPLOAD_LOG",!0):I.enableLogUpload()},disableLogUpload:function(){B("USE_NEW_LOG")?It("UPLOAD_LOG",!1):I.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new pb},checkAudioTrackIsActive:function(){var s=L(function*(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const a=Ie.reportApiInvoke(null,{tag:Kt.TRACER,name:qn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(i instanceof Et||i instanceof _s)){const g=new W(k.INVALID_TRACK,"the parameter is not a audio track");return a.onError(g),g.throw()}r&&r<1e3&&(r=1e3);const d=i instanceof Et?i.getTrackLabel():"remote_track",l=i.getVolumeLevel();let h=l,f=l;const _=Date.now();return new X(g=>{const v=setInterval(()=>{const b=i.getVolumeLevel();h=b>h?b:h,f=b<f?b:f;const y=h-f>1e-4,T=Date.now()-_;if(y||T>r){clearInterval(v);const M=y,O={duration:T,deviceLabel:d,maxVolumeLevel:h,result:M};I.info("[track-".concat(i.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(O))),a.onSuccess(O),g(M)}},200)})});return function(r){return s.apply(this,arguments)}}(),checkVideoTrackIsActive:function(){var s=L(function*(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const a=Ie.reportApiInvoke(null,{tag:Kt.TRACER,name:qn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(i instanceof je||i instanceof za)){const y=new W(k.INVALID_TRACK,"the parameter is not a video track");return a.onError(y),y.throw()}r&&r<1e3&&(r=1e3);const d=i instanceof je?i.getTrackLabel():"remote_track",l=i.getMediaStreamTrack(!0),h=document.createElement("video");h.style.width="1px",h.style.height="1px",h.setAttribute("muted",""),h.muted=!0,h.setAttribute("playsinline",""),h.controls=!1,(fr()||KE())&&(h.style.opacity="0.01",h.style.position="fixed",h.style.left="0",h.style.top="0",document.body.appendChild(h)),h.srcObject=new MediaStream([l]),h.play();const f=document.createElement("canvas");f.width=160,f.height=120;let _=0,g=0;try{const y=Date.now();_=yield function(T,M,O,D){let x,F=0,j=null;return new X((Y,te)=>{setTimeout(()=>{x&&(x(),Y(F))},M),x=YT(()=>{!function K(){F>4&&x&&(x(),Y(F));const Q=O.getContext("2d");if(!Q){const ge=new W(k.UNEXPECTED_ERROR,"can not get canvas 2d context.");return I.error(ge.toString()),void te(ge)}Q.drawImage(T,0,0,160,120);const $=Q.getImageData(0,0,O.width,O.height),q=Math.floor($.data.length/3);if(j){for(let ge=0;ge<q;ge+=3)if($.data[ge]!==j[ge])return F+=1,void(j=$.data);j=$.data}else j=$.data}()},30)})}(h,r,f),g=Date.now()-y}catch(y){throw a.onError(y),y}sj===gt.SAFARI&&(h.pause(),h.remove()),h.srcObject=null;const v=_>4,b={duration:g,changedPicNum:_,deviceLabel:d,result:v};return I.info("[track-".concat(i.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(b))),a.onSuccess(b),v});return function(r){return s.apply(this,arguments)}}(),setArea:_p,audioElementPlayCenter:xr,resumeAudioContext:function(){xr.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(s){aj.processExternalMediaAEC(s)},registerExtensions:function(s){const i=B("PLUGIN_INFO")||[];s.forEach(r=>{"name"in r&&!ye(i).call(i,r.name)&&i.push(r.name);const a=r;a.__registered__=!0,a.logger.hookLog=I.extLog,a.reporter.hookApiInvoke=Ie.extApiInvoke,a.parameters&&Object.keys(a.parameters).forEach(d=>{a.parameters[d]=B(d)})}),oU("PLUGIN_INFO",i)},ChannelMediaRelayError:Uc,ChannelMediaRelayEvent:vi,ChannelMediaRelayState:sr,RemoteStreamFallbackType:qm,RemoteStreamType:zm,ConnectionDisconnectedReason:ze,AudienceLatencyLevelType:GC,AREAS:st});return Object.defineProperties(Xn,{onAudioAutoplayFailed:{get:()=>Lo.onAudioAutoplayFailed,set:s=>{Lo.onAudioAutoplayFailed=s}},onAutoplayFailed:{get:()=>Lo.onAutoplayFailed,set:s=>{Lo.onAutoplayFailed=s}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Xn._onSecurityPolicyViolation,set(s){Xn._onSecurityPolicyViolation=s,tM(s)}},__CLIENT_LIST__:{get:()=>B("SHOW_GLOBAL_CLIENT_LIST")?Fd:[]}}),ko.on(Hc.CAMERA_DEVICE_CHANGED,s=>{I.info("camera device changed",JSON.stringify(s)),Xn.onCameraChanged&&Xn.onCameraChanged(s),Xn.safeEmit(ds.CAMERA_CHANGED,s)}),ko.on(Hc.RECORDING_DEVICE_CHANGED,s=>{I.info("microphone device changed",JSON.stringify(s)),Xn.onMicrophoneChanged&&Xn.onMicrophoneChanged(s),Xn.safeEmit(ds.MICROPHONE_CHANGED,s)}),ko.on(Hc.PLAYOUT_DEVICE_CHANGED,s=>{I.debug("playout device changed",JSON.stringify(s)),Xn.onPlaybackDeviceChanged&&Xn.onPlaybackDeviceChanged(s),Xn.safeEmit(ds.PLAYBACK_DEVICE_CHANGED,s)}),xr.onAutoplayFailed=()=>{I.info("detect audio element autoplay failed"),Lo.onAudioAutoplayFailed&&Lo.onAudioAutoplayFailed()},Ct.on("autoplay-failed",()=>{I.info("detect webaudio autoplay failed"),Lo.onAudioAutoplayFailed&&Lo.onAudioAutoplayFailed(),Xn.safeEmit(ds.AUTOPLAY_FAILED)}),Ct.on(ii.STATE_CHANGE,(s,i)=>{I.info("audio context state changed: ".concat(i," => ").concat(s)),Xn.onAudioContextStateChanged&&Xn.onAudioContextStateChanged(s,i),Xn.safeEmit(ds.AUDIO_CONTEXT_STATE_CHANGED,s,i)}),Fn.on(Ac.NETWORK_STATE_CHANGE,(s,i)=>{I.info("[network-indicator] network state changed, ".concat(i," => ").concat(s))}),window&&(window.__ARTC__=Xn),Xn}()},156:rd=>{function z_(L,zu,Ys,Rt,an,As,qo){try{var An=L[As](qo),ac=An.value}catch(Jb){return void Ys(Jb)}An.done?zu(ac):Promise.resolve(ac).then(Rt,an)}rd.exports=function Xp(L){return function(){var zu=this,Ys=arguments;return new Promise(function(Rt,an){var As=L.apply(zu,Ys);function qo(ac){z_(As,Rt,an,qo,An,"next",ac)}function An(ac){z_(As,Rt,an,qo,An,"throw",ac)}qo(void 0)})}},rd.exports.__esModule=!0,rd.exports.default=rd.exports}},rd=>{rd(rd.s=572)}]);