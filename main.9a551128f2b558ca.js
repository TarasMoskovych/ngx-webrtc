(self.webpackChunkngx_webrtc=self.webpackChunkngx_webrtc||[]).push([[179],{567:(Oc,xm,ap)=>{"use strict";function M(e){return"function"==typeof e}function Nc(e){const t=e(o=>{Error.call(o),o.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const ua=Nc(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((o,c)=>`${c+1}) ${o.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function ha(e,n){if(e){const t=e.indexOf(n);0<=t&&e.splice(t,1)}}class kn{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const u of t)u.remove(this);else t.remove(this);const{initialTeardown:o}=this;if(M(o))try{o()}catch(u){n=u instanceof ua?u.errors:[u]}const{_finalizers:c}=this;if(c){this._finalizers=null;for(const u of c)try{xc(u)}catch(f){n=n??[],f instanceof ua?n=[...n,...f.errors]:n.push(f)}}if(n)throw new ua(n)}}add(n){var t;if(n&&n!==this)if(this.closed)xc(n);else{if(n instanceof kn){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(n)}}_hasParent(n){const{_parentage:t}=this;return t===n||Array.isArray(t)&&t.includes(n)}_addParent(n){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(n),t):t?[t,n]:n}_removeParent(n){const{_parentage:t}=this;t===n?this._parentage=null:Array.isArray(t)&&ha(t,n)}remove(n){const{_finalizers:t}=this;t&&ha(t,n),n instanceof kn&&n._removeParent(this)}}kn.EMPTY=(()=>{const e=new kn;return e.closed=!0,e})();const Mo=kn.EMPTY;function Pc(e){return e instanceof kn||e&&"closed"in e&&M(e.remove)&&M(e.add)&&M(e.unsubscribe)}function xc(e){M(e)?e():e.unsubscribe()}const Ur={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Mc={setTimeout(e,n,...t){const{delegate:o}=Mc;return o?.setTimeout?o.setTimeout(e,n,...t):setTimeout(e,n,...t)},clearTimeout(e){const{delegate:n}=Mc;return(n?.clearTimeout||clearTimeout)(e)},delegate:void 0};function zv(e){Mc.setTimeout(()=>{const{onUnhandledError:n}=Ur;if(!n)throw e;n(e)})}function Mm(){}const qv=km("C",void 0,void 0);function km(e,n,t){return{kind:e,value:n,error:t}}let kc=null;function cp(e){if(Ur.useDeprecatedSynchronousErrorHandling){const n=!kc;if(n&&(kc={errorThrown:!1,error:null}),e(),n){const{errorThrown:t,error:o}=kc;if(kc=null,t)throw o}}else e()}class Lm extends kn{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,Pc(n)&&n.add(this)):this.destination=$T}static create(n,t,o){return new Hl(n,t,o)}next(n){this.isStopped?Um(function WT(e){return km("N",e,void 0)}(n),this):this._next(n)}error(n){this.isStopped?Um(function GT(e){return km("E",void 0,e)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?Um(qv,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const qT=Function.prototype.bind;function Fm(e,n){return qT.call(e,n)}class KT{constructor(n){this.partialObserver=n}next(n){const{partialObserver:t}=this;if(t.next)try{t.next(n)}catch(o){lp(o)}}error(n){const{partialObserver:t}=this;if(t.error)try{t.error(n)}catch(o){lp(o)}else lp(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(t){lp(t)}}}class Hl extends Lm{constructor(n,t,o){let c;if(super(),M(n)||!n)c={next:n??void 0,error:t??void 0,complete:o??void 0};else{let u;this&&Ur.useDeprecatedNextContext?(u=Object.create(n),u.unsubscribe=()=>this.unsubscribe(),c={next:n.next&&Fm(n.next,u),error:n.error&&Fm(n.error,u),complete:n.complete&&Fm(n.complete,u)}):c=n}this.destination=new KT(c)}}function lp(e){Ur.useDeprecatedSynchronousErrorHandling?function zT(e){Ur.useDeprecatedSynchronousErrorHandling&&kc&&(kc.errorThrown=!0,kc.error=e)}(e):zv(e)}function Um(e,n){const{onStoppedNotification:t}=Ur;t&&Mc.setTimeout(()=>t(e,n))}const $T={closed:!0,next:Mm,error:function YT(e){throw e},complete:Mm},dp="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ka(e){return e}function Kv(e){return 0===e.length?Ka:1===e.length?e[0]:function(t){return e.reduce((o,c)=>c(o),t)}}let Ln=(()=>{class e{constructor(t){t&&(this._subscribe=t)}lift(t){const o=new e;return o.source=this,o.operator=t,o}subscribe(t,o,c){const u=function QT(e){return e&&e instanceof Lm||function JT(e){return e&&M(e.next)&&M(e.error)&&M(e.complete)}(e)&&Pc(e)}(t)?t:new Hl(t,o,c);return cp(()=>{const{operator:f,source:_}=this;u.add(f?f.call(u,_):_?this._subscribe(u):this._trySubscribe(u))}),u}_trySubscribe(t){try{return this._subscribe(t)}catch(o){t.error(o)}}forEach(t,o){return new(o=Yv(o))((c,u)=>{const f=new Hl({next:_=>{try{t(_)}catch(v){u(v),f.unsubscribe()}},error:u,complete:c});this.subscribe(f)})}_subscribe(t){var o;return null===(o=this.source)||void 0===o?void 0:o.subscribe(t)}[dp](){return this}pipe(...t){return Kv(t)(this)}toPromise(t){return new(t=Yv(t))((o,c)=>{let u;this.subscribe(f=>u=f,f=>c(f),()=>o(u))})}}return e.create=n=>new e(n),e})();function Yv(e){var n;return null!==(n=e??Ur.Promise)&&void 0!==n?n:Promise}const ZT=Nc(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let rn=(()=>{class e extends Ln{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const o=new $v(this,this);return o.operator=t,o}_throwIfClosed(){if(this.closed)throw new ZT}next(t){cp(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const o of this.currentObservers)o.next(t)}})}error(t){cp(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:o}=this;for(;o.length;)o.shift().error(t)}})}complete(){cp(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:o,isStopped:c,observers:u}=this;return o||c?Mo:(this.currentObservers=null,u.push(t),new kn(()=>{this.currentObservers=null,ha(u,t)}))}_checkFinalizedStatuses(t){const{hasError:o,thrownError:c,isStopped:u}=this;o?t.error(c):u&&t.complete()}asObservable(){const t=new Ln;return t.source=this,t}}return e.create=(n,t)=>new $v(n,t),e})();class $v extends rn{constructor(n,t){super(),this.destination=n,this.source=t}next(n){var t,o;null===(o=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===o||o.call(t,n)}error(n){var t,o;null===(o=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===o||o.call(t,n)}complete(){var n,t;null===(t=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===t||t.call(n)}_subscribe(n){var t,o;return null!==(o=null===(t=this.source)||void 0===t?void 0:t.subscribe(n))&&void 0!==o?o:Mo}}function Xv(e){return M(e?.lift)}function hi(e){return n=>{if(Xv(n))return n.lift(function(t){try{return e(t,this)}catch(o){this.error(o)}});throw new TypeError("Unable to lift unknown Observable type")}}function Jn(e,n,t,o,c){return new ew(e,n,t,o,c)}class ew extends Lm{constructor(n,t,o,c,u,f){super(n),this.onFinalize=u,this.shouldUnsubscribe=f,this._next=t?function(_){try{t(_)}catch(v){n.error(v)}}:super._next,this._error=c?function(_){try{c(_)}catch(v){n.error(v)}finally{this.unsubscribe()}}:super._error,this._complete=o?function(){try{o()}catch(_){n.error(_)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function mn(e,n){return hi((t,o)=>{let c=0;t.subscribe(Jn(o,u=>{o.next(e.call(n,u,c++))}))})}function xs(e){return this instanceof xs?(this.v=e,this):new xs(e)}function zm(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function hp(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],o=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(u){t[u]=e[u]&&function(f){return new Promise(function(_,v){!function c(u,f,_,v){Promise.resolve(v).then(function(S){u({value:S,done:_})},f)}(_,v,(f=e[u](f)).done,f.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const ey=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function aw(e){return M(e?.then)}function Ya(e){return M(e[dp])}function cw(e){return Symbol.asyncIterator&&M(e?.[Symbol.asyncIterator])}function lw(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Km=function ty(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function fp(e){return M(e?.[Km])}function dw(e){return function Qv(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,o=t.apply(e,n||[]),u=[];return c={},f("next"),f("throw"),f("return"),c[Symbol.asyncIterator]=function(){return this},c;function f(U){o[U]&&(c[U]=function(G){return new Promise(function(z,X){u.push([U,G,z,X])>1||_(U,G)})})}function _(U,G){try{!function v(U){U.value instanceof xs?Promise.resolve(U.value.v).then(S,R):k(u[0][2],U)}(o[U](G))}catch(z){k(u[0][3],z)}}function S(U){_("next",U)}function R(U){_("throw",U)}function k(U,G){U(G),u.shift(),u.length&&_(u[0][0],u[0][1])}}(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:o,done:c}=yield xs(t.read());if(c)return yield xs(void 0);yield yield xs(o)}}finally{t.releaseLock()}})}function vi(e){return M(e?.getReader)}function qi(e){if(e instanceof Ln)return e;if(null!=e){if(Ya(e))return function pa(e){return new Ln(n=>{const t=e[dp]();if(M(t.subscribe))return t.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(ey(e))return function y1(e){return new Ln(n=>{for(let t=0;t<e.length&&!n.closed;t++)n.next(e[t]);n.complete()})}(e);if(aw(e))return function Ym(e){return new Ln(n=>{e.then(t=>{n.closed||(n.next(t),n.complete())},t=>n.error(t)).then(null,zv)})}(e);if(cw(e))return $m(e);if(fp(e))return function Ir(e){return new Ln(n=>{for(const t of e)if(n.next(t),n.closed)return;n.complete()})}(e);if(vi(e))return function uw(e){return $m(dw(e))}(e)}throw lw(e)}function $m(e){return new Ln(n=>{(function hw(e,n){var t,o,c,u;return function Hm(e,n,t,o){return new(t||(t=Promise))(function(u,f){function _(R){try{S(o.next(R))}catch(k){f(k)}}function v(R){try{S(o.throw(R))}catch(k){f(k)}}function S(R){R.done?u(R.value):function c(u){return u instanceof t?u:new t(function(f){f(u)})}(R.value).then(_,v)}S((o=o.apply(e,n||[])).next())})}(this,void 0,void 0,function*(){try{for(t=zm(e);!(o=yield t.next()).done;)if(n.next(o.value),n.closed)return}catch(f){c={error:f}}finally{try{o&&!o.done&&(u=t.return)&&(yield u.call(t))}finally{if(c)throw c.error}}n.complete()})})(e,n).catch(t=>n.error(t))})}function $a(e,n,t,o=0,c=!1){const u=n.schedule(function(){t(),c?e.add(this.schedule(null,o)):this.unsubscribe()},o);if(e.add(u),!c)return u}function yi(e,n,t=1/0){return M(n)?yi((o,c)=>mn((u,f)=>n(o,u,c,f))(qi(e(o,c))),t):("number"==typeof n&&(t=n),hi((o,c)=>function Lc(e,n,t,o,c,u,f,_){const v=[];let S=0,R=0,k=!1;const U=()=>{k&&!v.length&&!S&&n.complete()},G=X=>S<o?z(X):v.push(X),z=X=>{u&&n.next(X),S++;let le=!1;qi(t(X,R++)).subscribe(Jn(n,pe=>{c?.(pe),u?G(pe):n.next(pe)},()=>{le=!0},void 0,()=>{if(le)try{for(S--;v.length&&S<o;){const pe=v.shift();f?$a(n,f,()=>z(pe)):z(pe)}U()}catch(pe){n.error(pe)}}))};return e.subscribe(Jn(n,G,()=>{k=!0,U()})),()=>{_?.()}}(o,c,e,t)))}function ds(e=1/0){return yi(Ka,e)}const ks=new Ln(e=>e.complete());function pw(e){return e&&M(e.schedule)}function mp(e){return e[e.length-1]}function _p(e){return M(mp(e))?e.pop():void 0}function gp(e){return pw(mp(e))?e.pop():void 0}function au(e,n=0){return hi((t,o)=>{t.subscribe(Jn(o,c=>$a(o,e,()=>o.next(c),n),()=>$a(o,e,()=>o.complete(),n),c=>$a(o,e,()=>o.error(c),n)))})}function fw(e,n=0){return hi((t,o)=>{o.add(e.schedule(()=>t.subscribe(o),n))})}function ko(e,n){if(!e)throw new Error("Iterable cannot be null");return new Ln(t=>{$a(t,n,()=>{const o=e[Symbol.asyncIterator]();$a(t,n,()=>{o.next().then(c=>{c.done?t.complete():t.next(c.value)})},0,!0)})})}function Mi(e,n){return n?function iy(e,n){if(null!=e){if(Ya(e))return function S1(e,n){return qi(e).pipe(fw(n),au(n))}(e,n);if(ey(e))return function mw(e,n){return new Ln(t=>{let o=0;return n.schedule(function(){o===e.length?t.complete():(t.next(e[o++]),t.closed||this.schedule())})})}(e,n);if(aw(e))return function Gl(e,n){return qi(e).pipe(fw(n),au(n))}(e,n);if(cw(e))return ko(e,n);if(fp(e))return function C1(e,n){return new Ln(t=>{let o;return $a(t,n,()=>{o=e[Km](),$a(t,n,()=>{let c,u;try{({value:c,done:u}=o.next())}catch(f){return void t.error(f)}u?t.complete():t.next(c)},0,!0)}),()=>M(o?.return)&&o.return()})}(e,n);if(vi(e))return function Wl(e,n){return ko(dw(e),n)}(e,n)}throw lw(e)}(e,n):qi(e)}function ry(...e){const n=gp(e),t=function b1(e,n){return"number"==typeof mp(e)?e.pop():n}(e,1/0),o=e;return o.length?1===o.length?qi(o[0]):ds(t)(Mi(o,n)):ks}class ro extends rn{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const t=super._subscribe(n);return!t.closed&&n.next(this._value),t}getValue(){const{hasError:n,thrownError:t,_value:o}=this;if(n)throw t;return this._throwIfClosed(),o}next(n){super.next(this._value=n)}}function He(...e){return Mi(e,gp(e))}function Xa(e={}){const{connector:n=(()=>new rn),resetOnError:t=!0,resetOnComplete:o=!0,resetOnRefCountZero:c=!0}=e;return u=>{let f,_,v,S=0,R=!1,k=!1;const U=()=>{_?.unsubscribe(),_=void 0},G=()=>{U(),f=v=void 0,R=k=!1},z=()=>{const X=f;G(),X?.unsubscribe()};return hi((X,le)=>{S++,!k&&!R&&U();const pe=v=v??n();le.add(()=>{S--,0===S&&!k&&!R&&(_=Xm(z,c))}),pe.subscribe(le),!f&&S>0&&(f=new Hl({next:ae=>pe.next(ae),error:ae=>{k=!0,U(),_=Xm(G,t,ae),pe.error(ae)},complete:()=>{R=!0,U(),_=Xm(G,o),pe.complete()}}),qi(X).subscribe(f))})(u)}}function Xm(e,n,...t){if(!0===n)return void e();if(!1===n)return;const o=new Hl({next:()=>{o.unsubscribe(),e()}});return qi(n(...t)).subscribe(o)}function us(e,n){return hi((t,o)=>{let c=null,u=0,f=!1;const _=()=>f&&!c&&o.complete();t.subscribe(Jn(o,v=>{c?.unsubscribe();let S=0;const R=u++;qi(e(v,R)).subscribe(c=Jn(o,k=>o.next(n?n(v,k,R,S++):k),()=>{c=null,_()}))},()=>{f=!0,_()}))})}function oy(e,n=Ka){return e=e??_w,hi((t,o)=>{let c,u=!0;t.subscribe(Jn(o,f=>{const _=n(f);(u||!e(c,_))&&(u=!1,c=_,o.next(f))}))})}function _w(e,n){return e===n}function _n(e){for(let n in e)if(e[n]===_n)return n;throw Error("Could not find renamed property on target object.")}function Ep(e,n){for(const t in n)n.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&(e[t]=n[t])}function Wn(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(Wn).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const n=e.toString();if(null==n)return""+n;const t=n.indexOf("\n");return-1===t?n:n.substring(0,t)}function Jm(e,n){return null==e||""===e?null===n?"":n:null==n||""===n?e:e+" "+n}const T1=_n({__forward_ref__:_n});function Cn(e){return e.__forward_ref__=Cn,e.toString=function(){return Wn(this())},e}function nt(e){return Qm(e)?e():e}function Qm(e){return"function"==typeof e&&e.hasOwnProperty(T1)&&e.__forward_ref__===Cn}function sy(e){return e&&!!e.\u0275providers}const gw="https://g.co/ng/security#xss";class ue extends Error{constructor(n,t){super(function Fc(e,n){return`NG0${Math.abs(e)}${n?": "+n:""}`}(n,t)),this.code=n}}function _t(e){return"string"==typeof e?e:null==e?"":String(e)}function oo(e,n){throw new ue(-201,!1)}function Fo(e,n){null==e&&function tt(e,n,t,o){throw new Error(`ASSERTION ERROR: ${e}`+(null==o?"":` [Expected=> ${t} ${o} ${n} <=Actual]`))}(n,e,null,"!=")}function xe(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function St(e){return{providers:e.providers||[],imports:e.imports||[]}}function Zm(e){return Sw(e,e_)||Sw(e,Cw)}function Sw(e,n){return e.hasOwnProperty(n)?e[n]:null}function lu(e){return e&&(e.hasOwnProperty(t_)||e.hasOwnProperty(P1))?e[t_]:null}const e_=_n({\u0275prov:_n}),t_=_n({\u0275inj:_n}),Cw=_n({ngInjectableDef:_n}),P1=_n({ngInjectorDef:_n});var Ft=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(Ft||{});let Uc;function so(e){const n=Uc;return Uc=e,n}function zn(e,n,t){const o=Zm(e);return o&&"root"==o.providedIn?void 0===o.value?o.value=o.factory():o.value:t&Ft.Optional?null:void 0!==n?n:void oo(Wn(e))}const Dn=globalThis,uu={},uy="__NG_DI_FLAG__",i_="ngTempTokenPath",F1=/\n/gm,Rw="__source";let hu;function Qa(e){const n=hu;return hu=e,n}function B1(e,n=Ft.Default){if(void 0===hu)throw new ue(-203,!1);return null===hu?zn(e,void 0,n):hu.get(e,n&Ft.Optional?null:void 0,n)}function fe(e,n=Ft.Default){return(function n_(){return Uc}()||B1)(nt(e),n)}function Oe(e,n=Ft.Default){return fe(e,r_(n))}function r_(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function hy(e){const n=[];for(let t=0;t<e.length;t++){const o=nt(e[t]);if(Array.isArray(o)){if(0===o.length)throw new ue(900,!1);let c,u=Ft.Default;for(let f=0;f<o.length;f++){const _=o[f],v=j1(_);"number"==typeof v?-1===v?c=_.token:u|=v:c=_}n.push(fe(c,u))}else n.push(fe(o))}return n}function vp(e,n){return e[uy]=n,e.prototype[uy]=n,e}function j1(e){return e[uy]}function Za(e){return{toString:e}.toString()}var o_=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(o_||{}),Rr=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(Rr||{});const bi={},Qt=[],s_=_n({\u0275cmp:_n}),py=_n({\u0275dir:_n}),fy=_n({\u0275pipe:_n}),hs=_n({\u0275mod:_n}),ec=_n({\u0275fac:_n}),yp=_n({__NG_ELEMENT_ID__:_n}),Ow=_n({__NG_ENV_ID__:_n});function bp(e,n,t){let o=e.length;for(;;){const c=e.indexOf(n,t);if(-1===c)return c;if(0===c||e.charCodeAt(c-1)<=32){const u=n.length;if(c+u===o||e.charCodeAt(c+u)<=32)return c}t=c+1}}function a_(e,n,t){let o=0;for(;o<t.length;){const c=t[o];if("number"==typeof c){if(0!==c)break;o++;const u=t[o++],f=t[o++],_=t[o++];e.setAttribute(n,f,_,u)}else{const u=c,f=t[++o];c_(u)?e.setProperty(n,u,f):e.setAttribute(n,u,f),o++}}return o}function Nw(e){return 3===e||4===e||6===e}function c_(e){return 64===e.charCodeAt(0)}function Sp(e,n){if(null!==n&&0!==n.length)if(null===e||0===e.length)e=n.slice();else{let t=-1;for(let o=0;o<n.length;o++){const c=n[o];"number"==typeof c?t=c:0===t||l_(e,t,c,null,-1===t||2===t?n[++o]:null)}}return e}function l_(e,n,t,o,c){let u=0,f=e.length;if(-1===n)f=-1;else for(;u<e.length;){const _=e[u++];if("number"==typeof _){if(_===n){f=-1;break}if(_>n){f=u-1;break}}}for(;u<e.length;){const _=e[u];if("number"==typeof _)break;if(_===t){if(null===o)return void(null!==c&&(e[u+1]=c));if(o===e[u+1])return void(e[u+2]=c)}u++,null!==o&&u++,null!==c&&u++}-1!==f&&(e.splice(f,0,n),u=f+1),e.splice(u++,0,t),null!==o&&e.splice(u++,0,o),null!==c&&e.splice(u++,0,c)}const d_="ng-template";function my(e,n,t){let o=0,c=!0;for(;o<e.length;){let u=e[o++];if("string"==typeof u&&c){const f=e[o++];if(t&&"class"===u&&-1!==bp(f.toLowerCase(),n,0))return!0}else{if(1===u){for(;o<e.length&&"string"==typeof(u=e[o++]);)if(u.toLowerCase()===n)return!0;return!1}"number"==typeof u&&(c=!1)}}return!1}function Pw(e){return 4===e.type&&e.value!==d_}function G1(e,n,t){return n===(4!==e.type||t?e.value:d_)}function Vc(e,n,t){let o=4;const c=e.attrs||[],u=function q1(e){for(let n=0;n<e.length;n++)if(Nw(e[n]))return n;return e.length}(c);let f=!1;for(let _=0;_<n.length;_++){const v=n[_];if("number"!=typeof v){if(!f)if(4&o){if(o=2|1&o,""!==v&&!G1(e,v,t)||""===v&&1===n.length){if(ao(o))return!1;f=!0}}else{const S=8&o?v:n[++_];if(8&o&&null!==e.attrs){if(!my(e.attrs,S,t)){if(ao(o))return!1;f=!0}continue}const k=W1(8&o?"class":v,c,Pw(e),t);if(-1===k){if(ao(o))return!1;f=!0;continue}if(""!==S){let U;U=k>u?"":c[k+1].toLowerCase();const G=8&o?U:null;if(G&&-1!==bp(G,S,0)||2&o&&S!==U){if(ao(o))return!1;f=!0}}}}else{if(!f&&!ao(o)&&!ao(v))return!1;if(f&&ao(v))continue;f=!1,o=v|1&o}}return ao(o)||f}function ao(e){return 0==(1&e)}function W1(e,n,t,o){if(null===n)return-1;let c=0;if(o||!t){let u=!1;for(;c<n.length;){const f=n[c];if(f===e)return c;if(3===f||6===f)u=!0;else{if(1===f||2===f){let _=n[++c];for(;"string"==typeof _;)_=n[++c];continue}if(4===f)break;if(0===f){c+=4;continue}}c+=u?1:2}return-1}return function K1(e,n){let t=e.indexOf(4);if(t>-1)for(t++;t<e.length;){const o=e[t];if("number"==typeof o)return-1;if(o===n)return t;t++}return-1}(n,e)}function xw(e,n,t=!1){for(let o=0;o<n.length;o++)if(Vc(e,n[o],t))return!0;return!1}function pu(e,n){e:for(let t=0;t<n.length;t++){const o=n[t];if(e.length===o.length){for(let c=0;c<e.length;c++)if(e[c]!==o[c])continue e;return!0}}return!1}function Mw(e,n){return e?":not("+n.trim()+")":n}function fu(e){let n=e[0],t=1,o=2,c="",u=!1;for(;t<e.length;){let f=e[t];if("string"==typeof f)if(2&o){const _=e[++t];c+="["+f+(_.length>0?'="'+_+'"':"")+"]"}else 8&o?c+="."+f:4&o&&(c+=" "+f);else""!==c&&!ao(f)&&(n+=Mw(u,c),c=""),o=f,u=u||!ao(o);t++}return""!==c&&(n+=Mw(u,c)),n}function Ct(e){return Za(()=>{const n=Fw(e),t={...n,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===o_.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||Rr.Emulated,styles:e.styles||Qt,_:null,schemas:e.schemas||null,tView:null,id:""};Uw(t);const o=e.dependencies;return t.directiveDefs=Cp(o,!1),t.pipeDefs=Cp(o,!0),t.id=function Z1(e){let n=0;const t=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const c of t)n=Math.imul(31,n)+c.charCodeAt(0)<<0;return n+=2147483648,"c"+n}(t),t})}function X1(e){return Yt(e)||dr(e)}function J1(e){return null!==e}function yn(e){return Za(()=>({type:e.type,bootstrap:e.bootstrap||Qt,declarations:e.declarations||Qt,imports:e.imports||Qt,exports:e.exports||Qt,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function Lw(e,n){if(null==e)return bi;const t={};for(const o in e)if(e.hasOwnProperty(o)){let c=e[o],u=c;Array.isArray(c)&&(u=c[1],c=c[0]),t[c]=o,n&&(n[c]=u)}return t}function Ge(e){return Za(()=>{const n=Fw(e);return Uw(n),n})}function Vr(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function Yt(e){return e[s_]||null}function dr(e){return e[py]||null}function Br(e){return e[fy]||null}function Uo(e,n){const t=e[hs]||null;if(!t&&!0===n)throw new Error(`Type ${Wn(e)} does not have '\u0275mod' property.`);return t}function Fw(e){const n={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:e.inputs||bi,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||Qt,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Lw(e.inputs,n),outputs:Lw(e.outputs)}}function Uw(e){e.features?.forEach(n=>n(e))}function Cp(e,n){if(!e)return null;const t=n?Br:X1;return()=>("function"==typeof e?e():e).map(o=>t(o)).filter(J1)}const fi=0,ke=1,Tt=2,Qn=3,Ls=4,Tp=5,Ar=6,mu=7,mi=8,fa=9,_u=10,gt=11,Bc=12,Bw=13,gu=14,Si=15,Fs=16,Eu=17,ma=18,Vo=19,jw=20,jc=21,tc=22,wp=23,vu=24,Ut=25,_y=1,gy=2,_a=7,Hc=9,ye=11;function co(e){return Array.isArray(e)&&"object"==typeof e[_y]}function jr(e){return Array.isArray(e)&&!0===e[_y]}function h_(e){return 0!=(4&e.flags)}function Gc(e){return e.componentOffset>-1}function p_(e){return 1==(1&e.flags)}function Us(e){return!!e.template}function Ey(e){return 0!=(512&e[Tt])}function Wc(e,n){return e.hasOwnProperty(ec)?e[ec]:null}let ur=null,__=!1;function Bo(e){const n=ur;return ur=e,n}const Gw={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function Ww(e){if(!yu(e)||e.dirty){if(!e.producerMustRecompute(e)&&!Kw(e))return void(e.dirty=!1);e.producerRecomputeValue(e),e.dirty=!1}}function qw(e){e.dirty=!0,function zw(e){if(void 0===e.liveConsumerNode)return;const n=__;__=!0;try{for(const t of e.liveConsumerNode)t.dirty||qw(t)}finally{__=n}}(e),e.consumerMarkedDirty?.(e)}function Cy(e){return e&&(e.nextProducerIndex=0),Bo(e)}function Ty(e,n){if(Bo(n),e&&void 0!==e.producerNode&&void 0!==e.producerIndexOfThis&&void 0!==e.producerLastReadVersion){if(yu(e))for(let t=e.nextProducerIndex;t<e.producerNode.length;t++)Ip(e.producerNode[t],e.producerIndexOfThis[t]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}function Kw(e){bu(e);for(let n=0;n<e.producerNode.length;n++){const t=e.producerNode[n],o=e.producerLastReadVersion[n];if(o!==t.version||(Ww(t),o!==t.version))return!0}return!1}function Yw(e){if(bu(e),yu(e))for(let n=0;n<e.producerNode.length;n++)Ip(e.producerNode[n],e.producerIndexOfThis[n]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}function Ip(e,n){if(function Xw(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}(e),bu(e),1===e.liveConsumerNode.length)for(let o=0;o<e.producerNode.length;o++)Ip(e.producerNode[o],e.producerIndexOfThis[o]);const t=e.liveConsumerNode.length-1;if(e.liveConsumerNode[n]=e.liveConsumerNode[t],e.liveConsumerIndexOfThis[n]=e.liveConsumerIndexOfThis[t],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,n<e.liveConsumerNode.length){const o=e.liveConsumerIndexOfThis[n],c=e.liveConsumerNode[n];bu(c),c.producerIndexOfThis[o]=n}}function yu(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function bu(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}let g_=null;function eI(e){const n=Bo(null);try{return e()}finally{Bo(n)}}const tI=()=>{},gx=(()=>({...Gw,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:e=>{e.schedule(e.ref)},hasRun:!1,cleanupFn:tI}))();class nI{constructor(n,t,o){this.previousValue=n,this.currentValue=t,this.firstChange=o}isFirstChange(){return this.firstChange}}function jo(){return Ny}function Ny(e){return e.type.prototype.ngOnChanges&&(e.setInput=Ex),E_}function E_(){const e=Py(this),n=e?.current;if(n){const t=e.previous;if(t===bi)e.previous=n;else for(let o in n)t[o]=n[o];e.current=null,this.ngOnChanges(n)}}function Ex(e,n,t,o){const c=this.declaredInputs[t],u=Py(e)||function vx(e,n){return e[iI]=n}(e,{previous:bi,current:null}),f=u.current||(u.current={}),_=u.previous,v=_[c];f[c]=new nI(v&&v.currentValue,n,_===bi),e[o]=n}jo.ngInherit=!0;const iI="__ngSimpleChanges__";function Py(e){return e[iI]||null}const fs=function(e,n,t){},v_="svg";function Tn(e){for(;Array.isArray(e);)e=e[fi];return e}function Rp(e,n){return Tn(n[e])}function hr(e,n){return Tn(n[e.index])}function Ap(e,n){return e.data[n]}function Su(e,n){return e[n]}function Ho(e,n){const t=n[e];return co(t)?t:t[fi]}function zc(e,n){return null==n?null:e[n]}function sI(e){e[Eu]=0}function Sx(e){1024&e[Tt]||(e[Tt]|=1024,aI(e,1))}function ky(e){1024&e[Tt]&&(e[Tt]&=-1025,aI(e,-1))}function aI(e,n){let t=e[Qn];if(null===t)return;t[Tp]+=n;let o=t;for(t=t[Qn];null!==t&&(1===n&&1===o[Tp]||-1===n&&0===o[Tp]);)t[Tp]+=n,o=t,t=t[Qn]}const ct={lFrame:_I(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function Uy(){return ct.bindingsEnabled}function Vs(){return null!==ct.skipHydrationRootTNode}function be(){return ct.lFrame.lView}function $t(){return ct.lFrame.tView}function ga(e){return ct.lFrame.contextLView=e,e[mi]}function dn(e){return ct.lFrame.contextLView=null,e}function pr(){let e=uI();for(;null!==e&&64===e.type;)e=e.parent;return e}function uI(){return ct.lFrame.currentTNode}function Ea(e,n){const t=ct.lFrame;t.currentTNode=e,t.isParent=n}function T_(){return ct.lFrame.isParent}function Vy(){ct.lFrame.isParent=!1}function Hr(){const e=ct.lFrame;let n=e.bindingRootIndex;return-1===n&&(n=e.bindingRootIndex=e.tView.bindingStartIndex),n}function ql(){return ct.lFrame.bindingIndex++}function Ax(e,n){const t=ct.lFrame;t.bindingIndex=t.bindingRootIndex=e,jy(n)}function jy(e){ct.lFrame.currentDirectiveIndex=e}function w_(){return ct.lFrame.currentQueryIndex}function Pp(e){ct.lFrame.currentQueryIndex=e}function Dx(e){const n=e[ke];return 2===n.type?n.declTNode:1===n.type?e[Ar]:null}function mI(e,n,t){if(t&Ft.SkipSelf){let c=n,u=e;for(;!(c=c.parent,null!==c||t&Ft.Host||(c=Dx(u),null===c||(u=u[gu],10&c.type))););if(null===c)return!1;n=c,e=u}const o=ct.lFrame=R_();return o.currentTNode=n,o.lView=e,!0}function I_(e){const n=R_(),t=e[ke];ct.lFrame=n,n.currentTNode=t.firstChild,n.lView=e,n.tView=t,n.contextLView=e,n.bindingIndex=t.bindingStartIndex,n.inI18n=!1}function R_(){const e=ct.lFrame,n=null===e?null:e.child;return null===n?_I(e):n}function _I(e){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=n),n}function Bs(){const e=ct.lFrame;return ct.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const Kl=Bs;function Cu(){const e=Bs();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Gr(){return ct.lFrame.selectedIndex}function Yl(e){ct.lFrame.selectedIndex=e}function ni(){const e=ct.lFrame;return Ap(e.tView,e.selectedIndex)}function Go(){ct.lFrame.currentNamespace=v_}function rc(){!function A_(){ct.lFrame.currentNamespace=null}()}let O_=!0;function N_(){return O_}function Wo(e){O_=e}function P_(e,n){for(let t=n.directiveStart,o=n.directiveEnd;t<o;t++){const u=e.data[t].type.prototype,{ngAfterContentInit:f,ngAfterContentChecked:_,ngAfterViewInit:v,ngAfterViewChecked:S,ngOnDestroy:R}=u;f&&(e.contentHooks??=[]).push(-t,f),_&&((e.contentHooks??=[]).push(t,_),(e.contentCheckHooks??=[]).push(t,_)),v&&(e.viewHooks??=[]).push(-t,v),S&&((e.viewHooks??=[]).push(t,S),(e.viewCheckHooks??=[]).push(t,S)),null!=R&&(e.destroyHooks??=[]).push(t,R)}}function Ci(e,n,t){Mp(e,n,3,t)}function x_(e,n,t,o){(3&e[Tt])===t&&Mp(e,n,t,o)}function xp(e,n){let t=e[Tt];(3&t)===n&&(t&=8191,t+=1,e[Tt]=t)}function Mp(e,n,t,o){const u=o??-1,f=n.length-1;let _=0;for(let v=void 0!==o?65535&e[Eu]:0;v<f;v++)if("number"==typeof n[v+1]){if(_=n[v],null!=o&&_>=o)break}else n[v]<0&&(e[Eu]+=65536),(_<u||-1==u)&&(Px(e,t,n,v),e[Eu]=(4294901760&e[Eu])+v+2),v++}function M_(e,n){fs(4,e,n);const t=Bo(null);try{n.call(e)}finally{Bo(t),fs(5,e,n)}}function Px(e,n,t,o){const c=t[o]<0,u=t[o+1],_=e[c?-t[o]:t[o]];c?e[Tt]>>13<e[Eu]>>16&&(3&e[Tt])===n&&(e[Tt]+=8192,M_(_,u)):M_(_,u)}const Kc=-1;class oc{constructor(n,t,o){this.factory=n,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=o}}function L_(e){return e!==Kc}function kp(e){return 32767&e}function wu(e,n){let t=function Gy(e){return e>>16}(e),o=n;for(;t>0;)o=o[gu],t--;return o}let F_=!0;function U_(e){const n=F_;return F_=e,n}const yI=255,bI=5;let Mx=0;const js={};function fr(e,n){const t=Ru(e,n);if(-1!==t)return t;const o=n[ke];o.firstCreatePass&&(e.injectorIndex=n.length,Iu(o.data,e),Iu(n,null),Iu(o.blueprint,null));const c=B_(e,n),u=e.injectorIndex;if(L_(c)){const f=kp(c),_=wu(c,n),v=_[ke].data;for(let S=0;S<8;S++)n[u+S]=_[f+S]|v[f+S]}return n[u+8]=c,u}function Iu(e,n){e.push(0,0,0,0,0,0,0,0,n)}function Ru(e,n){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===n[e.injectorIndex+8]?-1:e.injectorIndex}function B_(e,n){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let t=0,o=null,c=n;for(;null!==c;){if(o=Ky(c),null===o)return Kc;if(t++,c=c[gu],-1!==o.injectorIndex)return o.injectorIndex|t<<16}return Kc}function j_(e,n,t){!function V_(e,n,t){let o;"string"==typeof t?o=t.charCodeAt(0)||0:t.hasOwnProperty(yp)&&(o=t[yp]),null==o&&(o=t[yp]=Mx++);const c=o&yI;n.data[e+(c>>bI)]|=1<<c}(e,n,t)}function Yc(e,n,t){if(t&Ft.Optional||void 0!==e)return e;oo()}function Lp(e,n,t,o){if(t&Ft.Optional&&void 0===o&&(o=null),!(t&(Ft.Self|Ft.Host))){const c=e[fa],u=so(void 0);try{return c?c.get(n,o,t&Ft.Optional):zn(n,o,t&Ft.Optional)}finally{so(u)}}return Yc(o,0,t)}function SI(e,n,t,o=Ft.Default,c){if(null!==e){if(2048&n[Tt]&&!(o&Ft.Self)){const f=function qy(e,n,t,o,c){let u=e,f=n;for(;null!==u&&null!==f&&2048&f[Tt]&&!(512&f[Tt]);){const _=H_(u,f,t,o|Ft.Self,js);if(_!==js)return _;let v=u.parent;if(!v){const S=f[jw];if(S){const R=S.get(t,js,o);if(R!==js)return R}v=Ky(f),f=f[gu]}u=v}return c}(e,n,t,o,js);if(f!==js)return f}const u=H_(e,n,t,o,js);if(u!==js)return u}return Lp(n,t,o,c)}function H_(e,n,t,o,c){const u=function kx(e){if("string"==typeof e)return e.charCodeAt(0)||0;const n=e.hasOwnProperty(yp)?e[yp]:void 0;return"number"==typeof n?n>=0?n&yI:zy:n}(t);if("function"==typeof u){if(!mI(n,e,o))return o&Ft.Host?Yc(c,0,o):Lp(n,t,o,c);try{let f;if(f=u(o),null!=f||o&Ft.Optional)return f;oo()}finally{Kl()}}else if("number"==typeof u){let f=null,_=Ru(e,n),v=Kc,S=o&Ft.Host?n[Si][Ar]:null;for((-1===_||o&Ft.SkipSelf)&&(v=-1===_?B_(e,n):n[_+8],v!==Kc&&ya(o,!1)?(f=n[ke],_=kp(v),n=wu(v,n)):_=-1);-1!==_;){const R=n[ke];if(Wy(u,_,R.data)){const k=CI(_,n,t,f,o,S);if(k!==js)return k}v=n[_+8],v!==Kc&&ya(o,n[ke].data[_+8]===S)&&Wy(u,_,n)?(f=R,_=kp(v),n=wu(v,n)):_=-1}}return c}function CI(e,n,t,o,c,u){const f=n[ke],_=f.data[e+8],R=va(_,f,t,null==o?Gc(_)&&F_:o!=f&&0!=(3&_.type),c&Ft.Host&&u===_);return null!==R?$c(n,f,R,_):js}function va(e,n,t,o,c){const u=e.providerIndexes,f=n.data,_=1048575&u,v=e.directiveStart,R=u>>20,U=c?_+R:e.directiveEnd;for(let G=o?_:_+R;G<U;G++){const z=f[G];if(G<v&&t===z||G>=v&&z.type===t)return G}if(c){const G=f[v];if(G&&Us(G)&&G.type===t)return v}return null}function $c(e,n,t,o){let c=e[t];const u=n.data;if(function gI(e){return e instanceof oc}(c)){const f=c;f.resolving&&function w1(e,n){const t=n?`. Dependency path: ${n.join(" > ")} > ${e}`:"";throw new ue(-200,`Circular dependency in DI detected for ${e}${t}`)}(function Gt(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():_t(e)}(u[t]));const _=U_(f.canSeeViewProviders);f.resolving=!0;const S=f.injectImpl?so(f.injectImpl):null;mI(e,o,Ft.Default);try{c=e[t]=f.factory(void 0,u,e,o),n.firstCreatePass&&t>=o.directiveStart&&function Tu(e,n,t){const{ngOnChanges:o,ngOnInit:c,ngDoCheck:u}=n.type.prototype;if(o){const f=Ny(n);(t.preOrderHooks??=[]).push(e,f),(t.preOrderCheckHooks??=[]).push(e,f)}c&&(t.preOrderHooks??=[]).push(0-e,c),u&&((t.preOrderHooks??=[]).push(e,u),(t.preOrderCheckHooks??=[]).push(e,u))}(t,u[t],n)}finally{null!==S&&so(S),U_(_),f.resolving=!1,Kl()}}return c}function Wy(e,n,t){return!!(t[n+(e>>bI)]&1<<e)}function ya(e,n){return!(e&Ft.Self||e&Ft.Host&&n)}class mr{constructor(n,t){this._tNode=n,this._lView=t}get(n,t,o){return SI(this._tNode,this._lView,n,r_(o),t)}}function zy(){return new mr(pr(),be())}function Ti(e){return Za(()=>{const n=e.prototype.constructor,t=n[ec]||Au(n),o=Object.prototype;let c=Object.getPrototypeOf(e.prototype).constructor;for(;c&&c!==o;){const u=c[ec]||Au(c);if(u&&u!==t)return u;c=Object.getPrototypeOf(c)}return u=>new u})}function Au(e){return Qm(e)?()=>{const n=Au(nt(e));return n&&n()}:Wc(e)}function Ky(e){const n=e[ke],t=n.type;return 2===t?n.declTNode:1===t?e[Ar]:null}const Xl="__parameters__";function Ou(e,n,t){return Za(()=>{const o=function Yy(e){return function(...t){if(e){const o=e(...t);for(const c in o)this[c]=o[c]}}}(n);function c(...u){if(this instanceof c)return o.apply(this,u),this;const f=new c(...u);return _.annotation=f,_;function _(v,S,R){const k=v.hasOwnProperty(Xl)?v[Xl]:Object.defineProperty(v,Xl,{value:[]})[Xl];for(;k.length<=R;)k.push(null);return(k[R]=k[R]||[]).push(f),v}}return t&&(c.prototype=Object.create(t.prototype)),c.prototype.ngMetadataName=e,c.annotationCls=c,c})}function Ql(e,n){e.forEach(t=>Array.isArray(t)?Ql(t,n):n(t))}function OI(e,n,t){n>=e.length?e.push(t):e.splice(n,0,t)}function Up(e,n){return n>=e.length-1?e.pop():e.splice(n,1)[0]}function Pu(e,n){const t=[];for(let o=0;o<e;o++)t.push(n);return t}function uo(e,n,t){let o=xu(e,n);return o>=0?e[1|o]=t:(o=~o,function NI(e,n,t,o){let c=e.length;if(c==n)e.push(t,o);else if(1===c)e.push(o,e[0]),e[0]=t;else{for(c--,e.push(e[c-1],e[c]);c>n;)e[c]=e[c-2],c--;e[n]=t,e[n+1]=o}}(e,o,n,t)),o}function W_(e,n){const t=xu(e,n);if(t>=0)return e[1|t]}function xu(e,n){return function PI(e,n,t){let o=0,c=e.length>>t;for(;c!==o;){const u=o+(c-o>>1),f=e[u<<t];if(n===f)return u<<t;f>n?c=u:o=u+1}return~(c<<t)}(e,n,1)}const Bp=vp(Ou("Optional"),8),q_=vp(Ou("SkipSelf"),4);function Q_(e){return 128==(128&e.flags)}var Jc=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(Jc||{});const Zx=/^>|^->|<!--|-->|--!>|<!-$/g,eM=/(<|>)/g,tM="\u200b$1\u200b";const ib=new Map;let nM=0;const Lu="__ngContext__";function er(e,n){co(n)?(e[Lu]=n[Vo],function rM(e){ib.set(e[Vo],e)}(n)):e[Lu]=n}let eg;function cb(e,n){return eg(e,n)}function Gp(e){const n=e[Qn];return jr(n)?n[Qn]:n}function nR(e){return db(e[Bc])}function lb(e){return db(e[Ls])}function db(e){for(;null!==e&&!jr(e);)e=e[Ls];return e}function Qc(e,n,t,o,c){if(null!=o){let u,f=!1;jr(o)?u=o:co(o)&&(f=!0,o=o[fi]);const _=Tn(o);0===e&&null!==t?null==c?mb(n,t,_):ba(n,t,_,c||null,!0):1===e&&null!==t?ba(n,t,_,c||null,!0):2===e?function qp(e,n,t){const o=Uu(e,n);o&&function mM(e,n,t,o){e.removeChild(n,t,o)}(e,o,n,t)}(n,_,f):3===e&&n.destroyNode(_),null!=u&&function EM(e,n,t,o,c){const u=t[_a];u!==Tn(t)&&Qc(n,e,o,u,c);for(let _=ye;_<t.length;_++){const v=t[_];Kp(v[ke],v,e,n,o,u)}}(n,e,u,t,c)}}function ub(e,n){return e.createComment(function YI(e){return e.replace(Zx,n=>n.replace(eM,tM))}(n))}function ng(e,n,t){return e.createElement(n,t)}function oR(e,n){const t=e[Hc],o=t.indexOf(n);ky(n),t.splice(o,1)}function ig(e,n){if(e.length<=ye)return;const t=ye+n,o=e[t];if(o){const c=o[Fs];null!==c&&c!==e&&oR(c,o),n>0&&(e[t-1][Ls]=o[Ls]);const u=Up(e,ye+n);!function uM(e,n){Kp(e,n,n[gt],2,null,null),n[fi]=null,n[Ar]=null}(o[ke],o);const f=u[ma];null!==f&&f.detachView(u[ke]),o[Qn]=null,o[Ls]=null,o[Tt]&=-129}return o}function rg(e,n){if(!(256&n[Tt])){const t=n[gt];n[wp]&&Yw(n[wp]),n[vu]&&Yw(n[vu]),t.destroyNode&&Kp(e,n,t,3,null,null),function hM(e){let n=e[Bc];if(!n)return pb(e[ke],e);for(;n;){let t=null;if(co(n))t=n[Bc];else{const o=n[ye];o&&(t=o)}if(!t){for(;n&&!n[Ls]&&n!==e;)co(n)&&pb(n[ke],n),n=n[Qn];null===n&&(n=e),co(n)&&pb(n[ke],n),t=n&&n[Ls]}n=t}}(n)}}function pb(e,n){if(!(256&n[Tt])){n[Tt]&=-129,n[Tt]|=256,function fM(e,n){let t;if(null!=e&&null!=(t=e.destroyHooks))for(let o=0;o<t.length;o+=2){const c=n[t[o]];if(!(c instanceof oc)){const u=t[o+1];if(Array.isArray(u))for(let f=0;f<u.length;f+=2){const _=c[u[f]],v=u[f+1];fs(4,_,v);try{v.call(_)}finally{fs(5,_,v)}}else{fs(4,c,u);try{u.call(c)}finally{fs(5,c,u)}}}}}(e,n),function sR(e,n){const t=e.cleanup,o=n[mu];if(null!==t)for(let u=0;u<t.length-1;u+=2)if("string"==typeof t[u]){const f=t[u+3];f>=0?o[f]():o[-f].unsubscribe(),u+=2}else t[u].call(o[t[u+1]]);null!==o&&(n[mu]=null);const c=n[jc];if(null!==c){n[jc]=null;for(let u=0;u<c.length;u++)(0,c[u])()}}(e,n),1===n[ke].type&&n[gt].destroy();const t=n[Fs];if(null!==t&&jr(n[Qn])){t!==n[Qn]&&oR(t,n);const o=n[ma];null!==o&&o.detachView(e)}!function oM(e){ib.delete(e[Vo])}(n)}}function fb(e,n,t){return function aR(e,n,t){let o=n;for(;null!==o&&40&o.type;)o=(n=o).parent;if(null===o)return t[fi];{const{componentOffset:c}=o;if(c>-1){const{encapsulation:u}=e.data[o.directiveStart+c];if(u===Rr.None||u===Rr.Emulated)return null}return hr(o,t)}}(e,n.parent,t)}function ba(e,n,t,o,c){e.insertBefore(n,t,o,c)}function mb(e,n,t){e.appendChild(n,t)}function _b(e,n,t,o,c){null!==o?ba(e,n,t,o,c):mb(e,n,t)}function Uu(e,n){return e.parentNode(n)}function lR(e,n,t){return Eb(e,n,t)}let Zc,bb,Eb=function gb(e,n,t){return 40&e.type?hr(e,t):null};function sg(e,n,t,o){const c=fb(e,o,n),u=n[gt],_=lR(o.parent||n[Ar],o,n);if(null!=c)if(Array.isArray(t))for(let v=0;v<t.length;v++)_b(u,c,t[v],_,!1);else _b(u,c,t,_,!1);void 0!==Zc&&Zc(u,o,n,t,c)}function zp(e,n){if(null!==n){const t=n.type;if(3&t)return hr(n,e);if(4&t)return vb(-1,e[n.index]);if(8&t){const o=n.child;if(null!==o)return zp(e,o);{const c=e[n.index];return jr(c)?vb(-1,c):Tn(c)}}if(32&t)return cb(n,e)()||Tn(e[n.index]);{const o=dR(e,n);return null!==o?Array.isArray(o)?o[0]:zp(Gp(e[Si]),o):zp(e,n.next)}}return null}function dR(e,n){return null!==n?e[Si][Ar].projection[n.projection]:null}function vb(e,n){const t=ye+e+1;if(t<n.length){const o=n[t],c=o[ke].firstChild;if(null!==c)return zp(o,c)}return n[_a]}function ag(e,n,t,o,c,u,f){for(;null!=t;){const _=o[t.index],v=t.type;if(f&&0===n&&(_&&er(Tn(_),o),t.flags|=2),32!=(32&t.flags))if(8&v)ag(e,n,t.child,o,c,u,!1),Qc(n,e,c,_,u);else if(32&v){const S=cb(t,o);let R;for(;R=S();)Qc(n,e,c,R,u);Qc(n,e,c,_,u)}else 16&v?yb(e,n,o,t,c,u):Qc(n,e,c,_,u);t=f?t.projectionNext:t.next}}function Kp(e,n,t,o,c,u){ag(t,o,e.firstChild,n,c,u,!1)}function yb(e,n,t,o,c,u){const f=t[Si],v=f[Ar].projection[o.projection];if(Array.isArray(v))for(let S=0;S<v.length;S++)Qc(n,e,c,v[S],u);else{let S=v;const R=f[Qn];Q_(o)&&(S.flags|=128),ag(e,n,S,R,c,u,!0)}}function fR(e,n,t){""===t?e.removeAttribute(n,"class"):e.setAttribute(n,"class",t)}function mR(e,n,t){const{mergedAttrs:o,classes:c,styles:u}=t;null!==o&&a_(e,n,o),null!==c&&fR(e,n,c),null!==u&&function pR(e,n,t){e.setAttribute(n,"style",t)}(e,n,u)}class Tb{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${gw})`}}function el(e){return e instanceof Tb?e.changingThisBreaksApplicationSecurity:e}const DM=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var Gu=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}(Gu||{});function ug(e){const n=function Wu(){const e=be();return e&&e[_u].sanitizer}();return n?n.sanitize(Gu.URL,e)||"":function Hu(e,n){const t=function gR(e){return e instanceof Tb&&e.getTypeName()||null}(e);if(null!=t&&t!==n){if("ResourceURL"===t&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${t} (see ${gw})`)}return t===n}(e,"URL")?el(e):function cg(e){return(e=String(e)).match(DM)?e:"unsafe:"+e}(_t(e))}class De{constructor(n,t){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=xe({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Xp=new De("ENVIRONMENT_INITIALIZER"),TR=new De("INJECTOR",-1),wR=new De("INJECTOR_DEF_TYPES");class Nb{get(n,t=uu){if(t===uu){const o=new Error(`NullInjectorError: No provider for ${Wn(n)}!`);throw o.name="NullInjectorError",o}return t}}function RR(...e){return{\u0275providers:AR(0,e),\u0275fromNgModule:!0}}function AR(e,...n){const t=[],o=new Set;let c;const u=f=>{t.push(f)};return Ql(n,f=>{const _=f;hg(_,u,[],o)&&(c||=[],c.push(_))}),void 0!==c&&DR(c,u),t}function DR(e,n){for(let t=0;t<e.length;t++){const{ngModule:o,providers:c}=e[t];pg(c,u=>{n(u,o)})}}function hg(e,n,t,o){if(!(e=nt(e)))return!1;let c=null,u=lu(e);const f=!u&&Yt(e);if(u||f){if(f&&!f.standalone)return!1;c=e}else{const v=e.ngModule;if(u=lu(v),!u)return!1;c=v}const _=o.has(c);if(f){if(_)return!1;if(o.add(c),f.dependencies){const v="function"==typeof f.dependencies?f.dependencies():f.dependencies;for(const S of v)hg(S,n,t,o)}}else{if(!u)return!1;{if(null!=u.imports&&!_){let S;o.add(c);try{Ql(u.imports,R=>{hg(R,n,t,o)&&(S||=[],S.push(R))})}finally{}void 0!==S&&DR(S,n)}if(!_){const S=Wc(c)||(()=>new c);n({provide:c,useFactory:S,deps:Qt},c),n({provide:wR,useValue:c,multi:!0},c),n({provide:Xp,useValue:()=>fe(c),multi:!0},c)}const v=u.providers;if(null!=v&&!_){const S=e;pg(v,R=>{n(R,S)})}}}return c!==e&&void 0!==e.providers}function pg(e,n){for(let t of e)sy(t)&&(t=t.\u0275providers),Array.isArray(t)?pg(t,n):n(t)}const GM=_n({provide:String,useValue:_n});function Pb(e){return null!==e&&"object"==typeof e&&GM in e}function id(e){return"function"==typeof e}const Mb=new De("Set Injector scope."),fg={},zM={};let kb;function mg(){return void 0===kb&&(kb=new Nb),kb}class zo{}class _g extends zo{get destroyed(){return this._destroyed}constructor(n,t,o,c){super(),this.parent=t,this.source=o,this.scopes=c,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Fb(n,f=>this.processProvider(f)),this.records.set(TR,zu(void 0,this)),c.has("environment")&&this.records.set(zo,zu(void 0,this));const u=this.records.get(Mb);null!=u&&"string"==typeof u.value&&this.scopes.add(u.value),this.injectorDefTypes=new Set(this.get(wR.multi,Qt,Ft.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();const n=this._onDestroyHooks;this._onDestroyHooks=[];for(const t of n)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(n){return this.assertNotDestroyed(),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){this.assertNotDestroyed();const t=Qa(this),o=so(void 0);try{return n()}finally{Qa(t),so(o)}}get(n,t=uu,o=Ft.Default){if(this.assertNotDestroyed(),n.hasOwnProperty(Ow))return n[Ow](this);o=r_(o);const u=Qa(this),f=so(void 0);try{if(!(o&Ft.SkipSelf)){let v=this.records.get(n);if(void 0===v){const S=function $M(e){return"function"==typeof e||"object"==typeof e&&e instanceof De}(n)&&Zm(n);v=S&&this.injectableDefInScope(S)?zu(Lb(n),fg):null,this.records.set(n,v)}if(null!=v)return this.hydrate(n,v)}return(o&Ft.Self?mg():this.parent).get(n,t=o&Ft.Optional&&t===uu?null:t)}catch(_){if("NullInjectorError"===_.name){if((_[i_]=_[i_]||[]).unshift(Wn(n)),u)throw _;return function Dw(e,n,t,o){const c=e[i_];throw n[Rw]&&c.unshift(n[Rw]),e.message=function H1(e,n,t,o=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let c=Wn(n);if(Array.isArray(n))c=n.map(Wn).join(" -> ");else if("object"==typeof n){let u=[];for(let f in n)if(n.hasOwnProperty(f)){let _=n[f];u.push(f+":"+("string"==typeof _?JSON.stringify(_):Wn(_)))}c=`{${u.join(", ")}}`}return`${t}${o?"("+o+")":""}[${c}]: ${e.replace(F1,"\n  ")}`}("\n"+e.message,c,t,o),e.ngTokenPath=c,e[i_]=null,e}(_,n,"R3InjectorError",this.source)}throw _}finally{so(f),Qa(u)}}resolveInjectorInitializers(){const n=Qa(this),t=so(void 0);try{const c=this.get(Xp.multi,Qt,Ft.Self);for(const u of c)u()}finally{Qa(n),so(t)}}toString(){const n=[],t=this.records;for(const o of t.keys())n.push(Wn(o));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new ue(205,!1)}processProvider(n){let t=id(n=nt(n))?n:nt(n&&n.provide);const o=function KM(e){return Pb(e)?zu(void 0,e.useValue):zu(NR(e),fg)}(n);if(id(n)||!0!==n.multi)this.records.get(t);else{let c=this.records.get(t);c||(c=zu(void 0,fg,!0),c.factory=()=>hy(c.multi),this.records.set(t,c)),t=n,c.multi.push(n)}this.records.set(t,o)}hydrate(n,t){return t.value===fg&&(t.value=zM,t.value=t.factory()),"object"==typeof t.value&&t.value&&function PR(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(n){if(!n.providedIn)return!1;const t=nt(n.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(n){const t=this._onDestroyHooks.indexOf(n);-1!==t&&this._onDestroyHooks.splice(t,1)}}function Lb(e){const n=Zm(e),t=null!==n?n.factory:Wc(e);if(null!==t)return t;if(e instanceof De)throw new ue(204,!1);if(e instanceof Function)return function qM(e){const n=e.length;if(n>0)throw Pu(n,"?"),new ue(204,!1);const t=function N1(e){return e&&(e[e_]||e[Cw])||null}(e);return null!==t?()=>t.factory(e):()=>new e}(e);throw new ue(204,!1)}function NR(e,n,t){let o;if(id(e)){const c=nt(e);return Wc(c)||Lb(c)}if(Pb(e))o=()=>nt(e.useValue);else if(function xb(e){return!(!e||!e.useFactory)}(e))o=()=>e.useFactory(...hy(e.deps||[]));else if(function OR(e){return!(!e||!e.useExisting)}(e))o=()=>fe(nt(e.useExisting));else{const c=nt(e&&(e.useClass||e.provide));if(!function YM(e){return!!e.deps}(e))return Wc(c)||Lb(c);o=()=>new c(...hy(e.deps))}return o}function zu(e,n,t=!1){return{factory:e,value:n,multi:t?[]:void 0}}function Fb(e,n){for(const t of e)Array.isArray(t)?Fb(t,n):t&&sy(t)?Fb(t.\u0275providers,n):n(t)}const qu=new De("AppId",{providedIn:"root",factory:()=>XM}),XM="ng",Jp=new De("Platform Initializer"),nl=new De("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Sa=new De("AnimationModuleType"),Ub=new De("CSP nonce",{providedIn:"root",factory:()=>function Bu(){if(void 0!==bb)return bb;if(typeof document<"u")return document;throw new ue(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let Xu=(e,n,t)=>null;function Wb(e,n,t=!1){return Xu(e,n,t)}class rk{}class Kb{}class LR{resolveComponentFactory(n){throw function qo(e){const n=Error(`No component factory found for ${Wn(e)}.`);return n.ngComponent=e,n}(n)}}let Ju=(()=>{class e{static#e=this.NULL=new LR}return e})();function FR(){return rd(pr(),be())}function rd(e,n){return new bn(hr(e,n))}let bn=(()=>{class e{constructor(t){this.nativeElement=t}static#e=this.__NG_ELEMENT_ID__=FR}return e})();function UR(e){return e instanceof bn?e.nativeElement:e}class nf{}let Ca=(()=>{class e{constructor(){this.destroyNode=null}static#e=this.__NG_ELEMENT_ID__=()=>function ok(){const e=be(),t=Ho(pr().index,e);return(co(t)?t:e)[gt]}()}return e})(),Yb=(()=>{class e{static#e=this.\u0275prov=xe({token:e,providedIn:"root",factory:()=>null})}return e})();class cc{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const sk=new cc("16.2.10"),rf={};function Qb(e,n=null,t=null,o){const c=od(e,n,t,o);return c.resolveInjectorInitializers(),c}function od(e,n=null,t=null,o,c=new Set){const u=[t||Qt,RR(e)];return o=o||("object"==typeof e?void 0:Wn(e)),new _g(u,n||mg(),o||null,c)}let tr=(()=>{class e{static#e=this.THROW_IF_NOT_FOUND=uu;static#t=this.NULL=new Nb;static create(t,o){if(Array.isArray(t))return Qb({name:""},o,t,"");{const c=t.name??"";return Qb({name:c},t.parent,t.providers,c)}}static#n=this.\u0275prov=xe({token:e,providedIn:"any",factory:()=>fe(TR)});static#i=this.__NG_ELEMENT_ID__=-1}return e})();function Ig(e){return e.ngOriginalError}class Ta{constructor(){this._console=console}handleError(n){const t=this._findOriginalError(n);this._console.error("ERROR",n),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(n){let t=n&&Ig(n);for(;t&&Ig(t);)t=Ig(t);return t||null}}function eS(e){return n=>{setTimeout(e,void 0,n)}}const Zt=class GR extends rn{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,t,o){let c=n,u=t||(()=>null),f=o;if(n&&"object"==typeof n){const v=n;c=v.next?.bind(v),u=v.error?.bind(v),f=v.complete?.bind(v)}this.__isAsync&&(u=eS(u),c&&(c=eS(c)),f&&(f=eS(f)));const _=super.subscribe({next:c,error:u,complete:f});return n instanceof kn&&n.add(_),_}};function WR(...e){}class lt{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:o=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Zt(!1),this.onMicrotaskEmpty=new Zt(!1),this.onStable=new Zt(!1),this.onError=new Zt(!1),typeof Zone>"u")throw new ue(908,!1);Zone.assertZonePatched();const c=this;c._nesting=0,c._outer=c._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(c._inner=c._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(c._inner=c._inner.fork(Zone.longStackTraceZoneSpec)),c.shouldCoalesceEventChangeDetection=!o&&t,c.shouldCoalesceRunChangeDetection=o,c.lastRequestAnimationFrameId=-1,c.nativeRequestAnimationFrame=function lk(){const e="function"==typeof Dn.requestAnimationFrame;let n=Dn[e?"requestAnimationFrame":"setTimeout"],t=Dn[e?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&n&&t){const o=n[Zone.__symbol__("OriginalDelegate")];o&&(n=o);const c=t[Zone.__symbol__("OriginalDelegate")];c&&(t=c)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function qR(e){const n=()=>{!function zR(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(Dn,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,Zu(e),e.isCheckStableRunning=!0,Rg(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),Zu(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,o,c,u,f,_)=>{if(function eh(e){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0].data?.__ignore_ng_zone__}(_))return t.invokeTask(c,u,f,_);try{return nS(e),t.invokeTask(c,u,f,_)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===u.type||e.shouldCoalesceRunChangeDetection)&&n(),Ag(e)}},onInvoke:(t,o,c,u,f,_,v)=>{try{return nS(e),t.invoke(c,u,f,_,v)}finally{e.shouldCoalesceRunChangeDetection&&n(),Ag(e)}},onHasTask:(t,o,c,u)=>{t.hasTask(c,u),o===c&&("microTask"==u.change?(e._hasPendingMicrotasks=u.microTask,Zu(e),Rg(e)):"macroTask"==u.change&&(e.hasPendingMacrotasks=u.macroTask))},onHandleError:(t,o,c,u)=>(t.handleError(c,u),e.runOutsideAngular(()=>e.onError.emit(u)),!1)})}(c)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!lt.isInAngularZone())throw new ue(909,!1)}static assertNotInAngularZone(){if(lt.isInAngularZone())throw new ue(909,!1)}run(n,t,o){return this._inner.run(n,t,o)}runTask(n,t,o,c){const u=this._inner,f=u.scheduleEventTask("NgZoneEvent: "+c,n,tS,WR,WR);try{return u.runTask(f,t,o)}finally{u.cancelTask(f)}}runGuarded(n,t,o){return this._inner.runGuarded(n,t,o)}runOutsideAngular(n){return this._outer.run(n)}}const tS={};function Rg(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function Zu(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function nS(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function Ag(e){e._nesting--,Rg(e)}class Dg{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Zt,this.onMicrotaskEmpty=new Zt,this.onStable=new Zt,this.onError=new Zt}run(n,t,o){return n.apply(t,o)}runGuarded(n,t,o){return n.apply(t,o)}runOutsideAngular(n){return n()}runTask(n,t,o,c){return n.apply(t,o)}}const af=new De("",{providedIn:"root",factory:KR});function KR(){const e=Oe(lt);let n=!0;return ry(new Ln(c=>{n=e.isStable&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks,e.runOutsideAngular(()=>{c.next(n),c.complete()})}),new Ln(c=>{let u;e.runOutsideAngular(()=>{u=e.onStable.subscribe(()=>{lt.assertNotInAngularZone(),queueMicrotask(()=>{!n&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks&&(n=!0,c.next(!0))})})});const f=e.onUnstable.subscribe(()=>{lt.assertInAngularZone(),n&&(n=!1,e.runOutsideAngular(()=>{c.next(!1)}))});return()=>{u.unsubscribe(),f.unsubscribe()}}).pipe(Xa()))}function Ko(e){return e instanceof Function?e():e}let iS=(()=>{class e{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}static#e=this.\u0275prov=xe({token:e,providedIn:"root",factory:()=>new e})}return e})();function ad(e){for(;e;){e[Tt]|=64;const n=Gp(e);if(Ey(e)&&!n)return e;e=n}return null}const rS=new De("",{providedIn:"root",factory:()=>!1});let ol=null;function nA(e,n){return e[n]??Og()}function iA(e,n){const t=Og();t.producerNode?.length&&(e[n]=ol,t.lView=e,ol=rA())}const mk={...Gw,consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{ad(e.lView)},lView:null};function rA(){return Object.create(mk)}function Og(){return ol??=rA(),ol}const bt={};function Je(e){oA($t(),be(),Gr()+e,!1)}function oA(e,n,t,o){if(!o)if(3==(3&n[Tt])){const u=e.preOrderCheckHooks;null!==u&&Ci(n,u,t)}else{const u=e.preOrderHooks;null!==u&&x_(n,u,0,t)}Yl(t)}function re(e,n=Ft.Default){const t=be();return null===t?fe(e,n):SI(pr(),t,nt(e),n)}function ld(){throw new Error("invalid")}function Ng(e,n,t,o,c,u,f,_,v,S,R){const k=n.blueprint.slice();return k[fi]=c,k[Tt]=140|o,(null!==S||e&&2048&e[Tt])&&(k[Tt]|=2048),sI(k),k[Qn]=k[gu]=e,k[mi]=t,k[_u]=f||e&&e[_u],k[gt]=_||e&&e[gt],k[fa]=v||e&&e[fa]||null,k[Ar]=u,k[Vo]=function iM(){return nM++}(),k[tc]=R,k[jw]=S,k[Si]=2==n.type?e[Si]:k,k}function ih(e,n,t,o,c){let u=e.data[n];if(null===u)u=function Pg(e,n,t,o,c){const u=uI(),f=T_(),v=e.data[n]=function lS(e,n,t,o,c,u){let f=n?n.injectorIndex:-1,_=0;return Vs()&&(_|=128),{type:t,index:o,insertBeforeIndex:null,injectorIndex:f,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:_,providerIndexes:0,value:c,attrs:u,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,f?u:u&&u.parent,t,n,o,c);return null===e.firstChild&&(e.firstChild=v),null!==u&&(f?null==u.child&&null!==v.parent&&(u.child=v):null===u.next&&(u.next=v,v.prev=u)),v}(e,n,t,o,c),function Rx(){return ct.lFrame.inI18n}()&&(u.flags|=32);else if(64&u.type){u.type=t,u.value=o,u.attrs=c;const f=function Np(){const e=ct.lFrame,n=e.currentTNode;return e.isParent?n:n.parent}();u.injectorIndex=null===f?-1:f.injectorIndex}return Ea(u,!0),u}function dd(e,n,t,o){if(0===t)return-1;const c=n.length;for(let u=0;u<t;u++)n.push(o),e.blueprint.push(o),e.data.push(null);return c}function sS(e,n,t,o,c){const u=nA(n,wp),f=Gr(),_=2&o;try{Yl(-1),_&&n.length>Ut&&oA(e,n,Ut,!1),fs(_?2:0,c);const S=_?u:null,R=Cy(S);try{null!==S&&(S.dirty=!1),t(o,c)}finally{Ty(S,R)}}finally{_&&null===n[wp]&&iA(n,wp),Yl(f),fs(_?3:1,c)}}function xg(e,n,t){if(h_(n)){const o=Bo(null);try{const u=n.directiveEnd;for(let f=n.directiveStart;f<u;f++){const _=e.data[f];_.contentQueries&&_.contentQueries(1,t[f],f)}}finally{Bo(o)}}}function rh(e,n,t){Uy()&&(function dS(e,n,t,o){const c=t.directiveStart,u=t.directiveEnd;Gc(t)&&function Ck(e,n,t){const o=hr(n,e),c=sA(t);let f=16;t.signals?f=4096:t.onPush&&(f=64);const _=Vg(e,Ng(e,c,null,f,o,n,null,e[_u].rendererFactory.createRenderer(o,t),null,null,null));e[n.index]=_}(n,t,e.data[c+t.componentOffset]),e.firstCreatePass||fr(t,n),er(o,n);const f=t.initialInputs;for(let _=c;_<u;_++){const v=e.data[_],S=$c(n,e,_,t);er(S,n),null!==f&&Tk(0,_-c,S,v,0,f),Us(v)&&(Ho(t.index,n)[mi]=$c(n,e,_,t))}}(e,n,t,hr(t,n)),64==(64&t.flags)&&uS(e,n,t))}function Mg(e,n,t=hr){const o=n.localNames;if(null!==o){let c=n.index+1;for(let u=0;u<o.length;u+=2){const f=o[u+1],_=-1===f?t(n,e):e[f];e[c++]=_}}}function sA(e){const n=e.tView;return null===n||n.incompleteFirstPass?e.tView=uf(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):n}function uf(e,n,t,o,c,u,f,_,v,S,R){const k=Ut+o,U=k+c,G=function gk(e,n){const t=[];for(let o=0;o<n;o++)t.push(o<e?null:bt);return t}(k,U),z="function"==typeof S?S():S;return G[ke]={type:e,blueprint:G,template:t,queries:null,viewQuery:_,declTNode:n,data:G.slice().fill(null,k),bindingStartIndex:k,expandoStartIndex:U,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof u?u():u,pipeRegistry:"function"==typeof f?f():f,firstChild:null,schemas:v,consts:z,incompleteFirstPass:!1,ssrId:R}}let kg=e=>null;function cA(e,n,t,o){for(let c in e)if(e.hasOwnProperty(c)){t=null===t?{}:t;const u=e[c];null===o?lA(t,n,c,u):o.hasOwnProperty(c)&&lA(t,n,o[c],u)}return t}function lA(e,n,t,o){e.hasOwnProperty(t)?e[t].push(n,o):e[t]=[n,o]}function ho(e,n,t,o,c,u,f,_){const v=hr(n,t);let R,S=n.inputs;!_&&null!=S&&(R=S[o])?(fS(e,t,R,o,c),Gc(n)&&function hA(e,n){const t=Ho(n,e);16&t[Tt]||(t[Tt]|=64)}(t,n.index)):3&n.type&&(o=function uA(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(o),c=null!=f?f(c,n.value||"",o):c,u.setProperty(v,o,c))}function Lg(e,n,t,o){if(Uy()){const c=null===o?null:{"":-1},u=function vk(e,n){const t=e.directiveRegistry;let o=null,c=null;if(t)for(let u=0;u<t.length;u++){const f=t[u];if(xw(n,f.selectors,!1))if(o||(o=[]),Us(f))if(null!==f.findHostDirectiveDefs){const _=[];c=c||new Map,f.findHostDirectiveDefs(f,_,c),o.unshift(..._,f),Fg(e,n,_.length)}else o.unshift(f),Fg(e,n,0);else c=c||new Map,f.findHostDirectiveDefs?.(f,o,c),o.push(f)}return null===o?null:[o,c]}(e,t);let f,_;null===u?f=_=null:[f,_]=u,null!==f&&fA(e,n,t,f,c,_),c&&function yk(e,n,t){if(n){const o=e.localNames=[];for(let c=0;c<n.length;c+=2){const u=t[n[c+1]];if(null==u)throw new ue(-301,!1);o.push(n[c],u)}}}(t,o,c)}t.mergedAttrs=Sp(t.mergedAttrs,t.attrs)}function fA(e,n,t,o,c,u){for(let S=0;S<o.length;S++)j_(fr(t,n),e,o[S].type);!function Ug(e,n,t){e.flags|=1,e.directiveStart=n,e.directiveEnd=n+t,e.providerIndexes=n}(t,e.data.length,o.length);for(let S=0;S<o.length;S++){const R=o[S];R.providersResolver&&R.providersResolver(R)}let f=!1,_=!1,v=dd(e,n,o.length,null);for(let S=0;S<o.length;S++){const R=o[S];t.mergedAttrs=Sp(t.mergedAttrs,R.hostAttrs),Sk(e,t,n,v,R),bk(v,R,c),null!==R.contentQueries&&(t.flags|=4),(null!==R.hostBindings||null!==R.hostAttrs||0!==R.hostVars)&&(t.flags|=64);const k=R.type.prototype;!f&&(k.ngOnChanges||k.ngOnInit||k.ngDoCheck)&&((e.preOrderHooks??=[]).push(t.index),f=!0),!_&&(k.ngOnChanges||k.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(t.index),_=!0),v++}!function dA(e,n,t){const c=n.directiveEnd,u=e.data,f=n.attrs,_=[];let v=null,S=null;for(let R=n.directiveStart;R<c;R++){const k=u[R],U=t?t.get(k):null,z=U?U.outputs:null;v=cA(k.inputs,R,v,U?U.inputs:null),S=cA(k.outputs,R,S,z);const X=null===v||null===f||Pw(n)?null:wk(v,R,f);_.push(X)}null!==v&&(v.hasOwnProperty("class")&&(n.flags|=8),v.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=_,n.inputs=v,n.outputs=S}(e,t,u)}function uS(e,n,t){const o=t.directiveStart,c=t.directiveEnd,u=t.index,f=function fI(){return ct.lFrame.currentDirectiveIndex}();try{Yl(u);for(let _=o;_<c;_++){const v=e.data[_],S=n[_];jy(_),(null!==v.hostBindings||0!==v.hostVars||null!==v.hostAttrs)&&mA(v,S)}}finally{Yl(-1),jy(f)}}function mA(e,n){null!==e.hostBindings&&e.hostBindings(1,n)}function Fg(e,n,t){n.componentOffset=t,(e.components??=[]).push(n.index)}function bk(e,n,t){if(t){if(n.exportAs)for(let o=0;o<n.exportAs.length;o++)t[n.exportAs[o]]=e;Us(n)&&(t[""]=e)}}function Sk(e,n,t,o,c){e.data[o]=c;const u=c.factory||(c.factory=Wc(c.type)),f=new oc(u,Us(c),re);e.blueprint[o]=f,t[o]=f,function oh(e,n,t,o,c){const u=c.hostBindings;if(u){let f=e.hostBindingOpCodes;null===f&&(f=e.hostBindingOpCodes=[]);const _=~n.index;(function sh(e){let n=e.length;for(;n>0;){const t=e[--n];if("number"==typeof t&&t<0)return t}return 0})(f)!=_&&f.push(_),f.push(t,o,u)}}(e,n,o,dd(e,t,c.hostVars,bt),c)}function Ia(e,n,t,o,c,u){const f=hr(e,n);!function hS(e,n,t,o,c,u,f){if(null==u)e.removeAttribute(n,c,t);else{const _=null==f?_t(u):f(u,o||"",c);e.setAttribute(n,c,_,t)}}(n[gt],f,u,e.value,t,o,c)}function Tk(e,n,t,o,c,u){const f=u[n];if(null!==f)for(let _=0;_<f.length;)_A(o,t,f[_++],f[_++],f[_++])}function _A(e,n,t,o,c){const u=Bo(null);try{const f=e.inputTransforms;null!==f&&f.hasOwnProperty(o)&&(c=f[o].call(n,c)),null!==e.setInput?e.setInput(n,c,t,o):n[o]=c}finally{Bo(u)}}function wk(e,n,t){let o=null,c=0;for(;c<t.length;){const u=t[c];if(0!==u)if(5!==u){if("number"==typeof u)break;if(e.hasOwnProperty(u)){null===o&&(o=[]);const f=e[u];for(let _=0;_<f.length;_+=2)if(f[_]===n){o.push(u,f[_+1],t[c+1]);break}}c+=2}else c+=2;else c+=4}return o}function gA(e,n,t,o){return[e,!0,!1,n,null,0,o,t,null,null,null]}function EA(e,n){const t=e.contentQueries;if(null!==t)for(let o=0;o<t.length;o+=2){const u=t[o+1];if(-1!==u){const f=e.data[u];Pp(t[o]),f.contentQueries(2,n[u],u)}}}function Vg(e,n){return e[Bc]?e[Bw][Ls]=n:e[Bc]=n,e[Bw]=n,n}function pS(e,n,t){Pp(0);const o=Bo(null);try{n(e,t)}finally{Bo(o)}}function vA(e){return e[mu]||(e[mu]=[])}function yA(e){return e.cleanup||(e.cleanup=[])}function SA(e,n){const t=e[fa],o=t?t.get(Ta,null):null;o&&o.handleError(n)}function fS(e,n,t,o,c){for(let u=0;u<t.length;){const f=t[u++],_=t[u++];_A(e.data[f],n[f],o,_,c)}}function Ik(e,n){const t=Ho(n,e),o=t[ke];!function Rk(e,n){for(let t=n.length;t<e.blueprint.length;t++)n.push(e.blueprint[t])}(o,t);const c=t[fi];null!==c&&null===t[tc]&&(t[tc]=Wb(c,t[fa])),mS(o,t,t[mi])}function mS(e,n,t){I_(n);try{const o=e.viewQuery;null!==o&&pS(1,o,t);const c=e.template;null!==c&&sS(e,n,c,1,t),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&EA(e,n),e.staticViewQueries&&pS(2,e.viewQuery,t);const u=e.components;null!==u&&function Ak(e,n){for(let t=0;t<n.length;t++)Ik(e,n[t])}(n,u)}catch(o){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),o}finally{n[Tt]&=-5,Cu()}}let CA=(()=>{class e{constructor(){this.all=new Set,this.queue=new Map}create(t,o,c){const u=typeof Zone>"u"?null:Zone.current,f=function _x(e,n,t){const o=Object.create(gx);t&&(o.consumerAllowSignalWrites=!0),o.fn=e,o.schedule=n;const c=f=>{o.cleanupFn=f};return o.ref={notify:()=>qw(o),run:()=>{if(o.dirty=!1,o.hasRun&&!Kw(o))return;o.hasRun=!0;const f=Cy(o);try{o.cleanupFn(),o.cleanupFn=tI,o.fn(c)}finally{Ty(o,f)}},cleanup:()=>o.cleanupFn()},o.ref}(t,S=>{this.all.has(S)&&this.queue.set(S,u)},c);let _;this.all.add(f),f.notify();const v=()=>{f.cleanup(),_?.(),this.all.delete(f),this.queue.delete(f)};return _=o?.onDestroy(v),{destroy:v}}flush(){if(0!==this.queue.size)for(const[t,o]of this.queue)this.queue.delete(t),o?o.run(()=>t.run()):t.run()}get isQueueEmpty(){return 0===this.queue.size}static#e=this.\u0275prov=xe({token:e,providedIn:"root",factory:()=>new e})}return e})();function Bg(e,n,t){let o=t?e.styles:null,c=t?e.classes:null,u=0;if(null!==n)for(let f=0;f<n.length;f++){const _=n[f];"number"==typeof _?u=_:1==u?c=Jm(c,_):2==u&&(o=Jm(o,_+": "+n[++f]+";"))}t?e.styles=o:e.stylesWithoutHost=o,t?e.classes=c:e.classesWithoutHost=c}function pf(e,n,t,o,c=!1){for(;null!==t;){const u=n[t.index];null!==u&&o.push(Tn(u)),jr(u)&&TA(u,o);const f=t.type;if(8&f)pf(e,n,t.child,o);else if(32&f){const _=cb(t,n);let v;for(;v=_();)o.push(v)}else if(16&f){const _=dR(n,t);if(Array.isArray(_))o.push(..._);else{const v=Gp(n[Si]);pf(v[ke],v,_,o,!0)}}t=c?t.projectionNext:t.next}return o}function TA(e,n){for(let t=ye;t<e.length;t++){const o=e[t],c=o[ke].firstChild;null!==c&&pf(o[ke],o,c,n)}e[_a]!==e[fi]&&n.push(e[_a])}function jg(e,n,t,o=!0){const c=n[_u],u=c.rendererFactory,f=c.afterRenderEventManager;u.begin?.(),f?.begin();try{wA(e,n,e.template,t)}catch(v){throw o&&SA(n,v),v}finally{u.end?.(),c.effectManager?.flush(),f?.end()}}function wA(e,n,t,o){const c=n[Tt];if(256!=(256&c)){n[_u].effectManager?.flush(),I_(n);try{sI(n),function pI(e){return ct.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==t&&sS(e,n,t,2,o);const f=3==(3&c);if(f){const S=e.preOrderCheckHooks;null!==S&&Ci(n,S,null)}else{const S=e.preOrderHooks;null!==S&&x_(n,S,0,null),xp(n,0)}if(function Nk(e){for(let n=nR(e);null!==n;n=lb(n)){if(!n[gy])continue;const t=n[Hc];for(let o=0;o<t.length;o++){Sx(t[o])}}}(n),IA(n,2),null!==e.contentQueries&&EA(e,n),f){const S=e.contentCheckHooks;null!==S&&Ci(n,S)}else{const S=e.contentHooks;null!==S&&x_(n,S,1),xp(n,1)}!function _k(e,n){const t=e.hostBindingOpCodes;if(null===t)return;const o=nA(n,vu);try{for(let c=0;c<t.length;c++){const u=t[c];if(u<0)Yl(~u);else{const f=u,_=t[++c],v=t[++c];Ax(_,f),o.dirty=!1;const S=Cy(o);try{v(2,n[f])}finally{Ty(o,S)}}}}finally{null===n[vu]&&iA(n,vu),Yl(-1)}}(e,n);const _=e.components;null!==_&&_S(n,_,0);const v=e.viewQuery;if(null!==v&&pS(2,v,o),f){const S=e.viewCheckHooks;null!==S&&Ci(n,S)}else{const S=e.viewHooks;null!==S&&x_(n,S,2),xp(n,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),n[Tt]&=-73,ky(n)}finally{Cu()}}}function IA(e,n){for(let t=nR(e);null!==t;t=lb(t))for(let o=ye;o<t.length;o++)RA(t[o],n)}function Pk(e,n,t){RA(Ho(n,e),t)}function RA(e,n){if(!function oI(e){return 128==(128&e[Tt])}(e))return;const t=e[ke],o=e[Tt];if(80&o&&0===n||1024&o||2===n)wA(t,e,t.template,e[mi]);else if(e[Tp]>0){IA(e,1);const c=t.components;null!==c&&_S(e,c,1)}}function _S(e,n,t){for(let o=0;o<n.length;o++)Pk(e,n[o],t)}class ff{get rootNodes(){const n=this._lView,t=n[ke];return pf(t,n,t.firstChild,[])}constructor(n,t){this._lView=n,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[mi]}set context(n){this._lView[mi]=n}get destroyed(){return 256==(256&this._lView[Tt])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[Qn];if(jr(n)){const t=n[8],o=t?t.indexOf(this):-1;o>-1&&(ig(n,o),Up(t,o))}this._attachedToViewContainer=!1}rg(this._lView[ke],this._lView)}onDestroy(n){!function cI(e,n){if(256==(256&e[Tt]))throw new ue(911,!1);null===e[jc]&&(e[jc]=[]),e[jc].push(n)}(this._lView,n)}markForCheck(){ad(this._cdRefInjectingView||this._lView)}detach(){this._lView[Tt]&=-129}reattach(){this._lView[Tt]|=128}detectChanges(){jg(this._lView[ke],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new ue(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function rR(e,n){Kp(e,n,n[gt],2,null,null)}(this._lView[ke],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new ue(902,!1);this._appRef=n}}class gS extends ff{constructor(n){super(n),this._view=n}detectChanges(){const n=this._view;jg(n[ke],n,n[mi],!1)}checkNoChanges(){}get context(){return null}}class AA extends Ju{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const t=Yt(n);return new ah(t,this.ngModule)}}function DA(e){const n=[];for(let t in e)e.hasOwnProperty(t)&&n.push({propName:e[t],templateName:t});return n}class Mk{constructor(n,t){this.injector=n,this.parentInjector=t}get(n,t,o){o=r_(o);const c=this.injector.get(n,rf,o);return c!==rf||t===rf?c:this.parentInjector.get(n,t,o)}}class ah extends Kb{get inputs(){const n=this.componentDef,t=n.inputTransforms,o=DA(n.inputs);if(null!==t)for(const c of o)t.hasOwnProperty(c.propName)&&(c.transform=t[c.propName]);return o}get outputs(){return DA(this.componentDef.outputs)}constructor(n,t){super(),this.componentDef=n,this.ngModule=t,this.componentType=n.type,this.selector=function kw(e){return e.map(fu).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!t}create(n,t,o,c){let u=(c=c||this.ngModule)instanceof zo?c:c?.injector;u&&null!==this.componentDef.getStandaloneInjector&&(u=this.componentDef.getStandaloneInjector(u)||u);const f=u?new Mk(n,u):n,_=f.get(nf,null);if(null===_)throw new ue(407,!1);const k={rendererFactory:_,sanitizer:f.get(Yb,null),effectManager:f.get(CA,null),afterRenderEventManager:f.get(iS,null)},U=_.createRenderer(null,this.componentDef),G=this.componentDef.selectors[0][0]||"div",z=o?function Ek(e,n,t,o){const u=o.get(rS,!1)||t===Rr.ShadowDom,f=e.selectRootElement(n,u);return function hf(e){kg(e)}(f),f}(U,o,this.componentDef.encapsulation,f):ng(U,G,function xk(e){const n=e.toLowerCase();return"svg"===n?v_:"math"===n?"math":null}(G)),pe=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let ae=null;null!==z&&(ae=Wb(z,f,!0));const Ve=uf(0,null,null,1,0,null,null,null,null,null,null),je=Ng(null,Ve,null,pe,null,null,k,U,f,null,ae);let Pt,di;I_(je);try{const ui=this.componentDef;let Po,la=null;ui.findHostDirectiveDefs?(Po=[],la=new Map,ui.findHostDirectiveDefs(ui,Po,la),Po.push(ui)):Po=[ui];const Dc=function OA(e,n){const t=e[ke],o=Ut;return e[o]=n,ih(t,o,2,"#host",null)}(je,z),h1=function q(e,n,t,o,c,u,f){const _=c[ke];!function Lk(e,n,t,o){for(const c of e)n.mergedAttrs=Sp(n.mergedAttrs,c.hostAttrs);null!==n.mergedAttrs&&(Bg(n,n.mergedAttrs,!0),null!==t&&mR(o,t,n))}(o,e,n,f);let v=null;null!==n&&(v=Wb(n,c[fa]));const S=u.rendererFactory.createRenderer(n,t);let R=16;t.signals?R=4096:t.onPush&&(R=64);const k=Ng(c,sA(t),null,R,c[e.index],e,u,S,null,null,v);return _.firstCreatePass&&Fg(_,e,o.length-1),Vg(c,k),c[e.index]=k}(Dc,z,ui,Po,je,k,U);di=Ap(Ve,Ut),z&&function Hg(e,n,t,o){if(o)a_(e,t,["ng-version",sk.full]);else{const{attrs:c,classes:u}=function Y1(e){const n=[],t=[];let o=1,c=2;for(;o<e.length;){let u=e[o];if("string"==typeof u)2===c?""!==u&&n.push(u,e[++o]):8===c&&t.push(u);else{if(!ao(c))break;c=u}o++}return{attrs:n,classes:t}}(n.selectors[0]);c&&a_(e,t,c),u&&u.length>0&&fR(e,t,u.join(" "))}}(U,ui,z,o),void 0!==t&&function Gg(e,n,t){const o=e.projection=[];for(let c=0;c<n.length;c++){const u=t[c];o.push(null!=u?Array.from(u):null)}}(di,this.ngContentSelectors,t),Pt=function mf(e,n,t,o,c,u){const f=pr(),_=c[ke],v=hr(f,c);fA(_,c,f,t,null,o);for(let R=0;R<t.length;R++)er($c(c,_,f.directiveStart+R,f),c);uS(_,c,f),v&&er(v,c);const S=$c(c,_,f.directiveStart+f.componentOffset,f);if(e[mi]=c[mi]=S,null!==u)for(const R of u)R(S,n);return xg(_,f,e),S}(h1,ui,Po,la,je,[Aa]),mS(Ve,je,null)}finally{Cu()}return new kk(this.componentType,Pt,rd(di,je),je,di)}}class kk extends rk{constructor(n,t,o,c,u){super(),this.location=o,this._rootLView=c,this._tNode=u,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new gS(c),this.componentType=n}setInput(n,t){const o=this._tNode.inputs;let c;if(null!==o&&(c=o[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),t))return;const u=this._rootLView;fS(u[ke],u,c,n,t),this.previousInputValues.set(n,t),ad(Ho(this._tNode.index,u))}}get injector(){return new mr(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}function Aa(){const e=pr();P_(be()[ke],e)}function Ne(e){let n=function Fn(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),t=!0;const o=[e];for(;n;){let c;if(Us(e))c=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new ue(903,!1);c=n.\u0275dir}if(c){if(t){o.push(c);const f=e;f.inputs=ch(e.inputs),f.inputTransforms=ch(e.inputTransforms),f.declaredInputs=ch(e.declaredInputs),f.outputs=ch(e.outputs);const _=c.hostBindings;_&&dt(e,_);const v=c.viewQuery,S=c.contentQueries;if(v&&lc(e,v),S&&vS(e,S),Ep(e.inputs,c.inputs),Ep(e.declaredInputs,c.declaredInputs),Ep(e.outputs,c.outputs),null!==c.inputTransforms&&(null===f.inputTransforms&&(f.inputTransforms={}),Ep(f.inputTransforms,c.inputTransforms)),Us(c)&&c.data.animation){const R=e.data;R.animation=(R.animation||[]).concat(c.data.animation)}}const u=c.features;if(u)for(let f=0;f<u.length;f++){const _=u[f];_&&_.ngInherit&&_(e),_===Ne&&(t=!1)}}n=Object.getPrototypeOf(n)}!function ES(e){let n=0,t=null;for(let o=e.length-1;o>=0;o--){const c=e[o];c.hostVars=n+=c.hostVars,c.hostAttrs=Sp(c.hostAttrs,t=Sp(t,c.hostAttrs))}}(o)}function ch(e){return e===bi?{}:e===Qt?[]:e}function lc(e,n){const t=e.viewQuery;e.viewQuery=t?(o,c)=>{n(o,c),t(o,c)}:n}function vS(e,n){const t=e.contentQueries;e.contentQueries=t?(o,c,u)=>{n(o,c,u),t(o,c,u)}:n}function dt(e,n){const t=e.hostBindings;e.hostBindings=t?(o,c)=>{n(o,c),t(o,c)}:n}function _f(e){return!!sl(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}function sl(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function Ws(e,n,t){return e[n]=t}function _r(e,n,t){return!Object.is(e[n],t)&&(e[n]=t,!0)}function al(e,n,t,o){const c=_r(e,n,t);return _r(e,n+1,o)||c}function ii(e,n,t,o){const c=be();return _r(c,ql(),n)&&($t(),Ia(ni(),c,e,n,t,o)),ii}function Fe(e,n,t,o,c,u,f,_){const v=be(),S=$t(),R=e+Ut,k=S.firstCreatePass?function _i(e,n,t,o,c,u,f,_,v){const S=n.consts,R=ih(n,e,4,f||null,zc(S,_));Lg(n,t,R,zc(S,v)),P_(n,R);const k=R.tView=uf(2,R,o,c,u,n.directiveRegistry,n.pipeRegistry,null,n.schemas,S,null);return null!==n.queries&&(n.queries.template(n,R),k.queries=n.queries.embeddedTView(R)),R}(R,S,v,n,t,o,c,u,f):S.data[R];Ea(k,!1);const U=Zg(S,v,k,e);N_()&&sg(S,v,U,k),er(U,v),Vg(v,v[R]=gA(U,v,U,k)),p_(k)&&rh(S,v,k),null!=f&&Mg(v,k,_)}let Zg=function yf(e,n,t,o){return Wo(!0),n[gt].createComment("")};function pd(e){return Su(function Ix(){return ct.lFrame.contextLView}(),Ut+e)}function Qe(e,n,t){const o=be();return _r(o,ql(),n)&&ho($t(),ni(),o,e,n,o[gt],t,!1),Qe}function uh(e,n,t,o,c){const f=c?"class":"style";fS(e,t,n.inputs[f],f,o)}function Pe(e,n,t,o){const c=be(),u=$t(),f=Ut+e,_=c[gt],v=u.firstCreatePass?function Zn(e,n,t,o,c,u){const f=n.consts,v=ih(n,e,2,o,zc(f,c));return Lg(n,t,v,zc(f,u)),null!==v.attrs&&Bg(v,v.attrs,!1),null!==v.mergedAttrs&&Bg(v,v.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,v),v}(f,u,c,n,t,o):u.data[f],S=gs(u,c,v,_,n,e);c[f]=S;const R=p_(v);return Ea(v,!0),mR(_,S,v),32!=(32&v.flags)&&N_()&&sg(u,c,S,v),0===function Cx(){return ct.lFrame.elementDepthCount}()&&er(S,c),function Dp(){ct.lFrame.elementDepthCount++}(),R&&(rh(u,c,v),xg(u,v,c)),null!==o&&Mg(c,v),Pe}function Re(){let e=pr();T_()?Vy():(e=e.parent,Ea(e,!1));const n=e;(function wx(e){return ct.skipHydrationRootTNode===e})(n)&&function dI(){ct.skipHydrationRootTNode=null}(),function Tx(){ct.lFrame.elementDepthCount--}();const t=$t();return t.firstCreatePass&&(P_(t,e),h_(e)&&t.queries.elementEnd(e)),null!=n.classesWithoutHost&&function EI(e){return 0!=(8&e.flags)}(n)&&uh(t,n,be(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function vI(e){return 0!=(16&e.flags)}(n)&&uh(t,n,be(),n.stylesWithoutHost,!1),Re}function wt(e,n,t,o){return Pe(e,n,t,o),Re(),wt}let gs=(e,n,t,o,c,u)=>(Wo(!0),ng(o,c,function D_(){return ct.lFrame.currentNamespace}()));function bf(e,n,t){const o=be(),c=$t(),u=e+Ut,f=c.firstCreatePass?function Wk(e,n,t,o,c){const u=n.consts,f=zc(u,o),_=ih(n,e,8,"ng-container",f);return null!==f&&Bg(_,f,!0),Lg(n,t,_,zc(u,c)),null!==n.queries&&n.queries.elementStart(n,_),_}(u,c,o,n,t):c.data[u];Ea(f,!0);const _=jA(c,o,f,e);return o[u]=_,N_()&&sg(c,o,_,f),er(_,o),p_(f)&&(rh(c,o,f),xg(c,f,o)),null!=t&&Mg(o,f),bf}function Sf(){let e=pr();const n=$t();return T_()?Vy():(e=e.parent,Ea(e,!1)),n.firstCreatePass&&(P_(n,e),h_(e)&&n.queries.elementEnd(e)),Sf}let jA=(e,n,t,o)=>(Wo(!0),ub(n[gt],""));function hh(){return be()}function fd(e){return!!e&&"function"==typeof e.then}function ll(e){return!!e&&"function"==typeof e.subscribe}function en(e,n,t,o){const c=be(),u=$t(),f=pr();return function NS(e,n,t,o,c,u,f){const _=p_(o),S=e.firstCreatePass&&yA(e),R=n[mi],k=vA(n);let U=!0;if(3&o.type||f){const X=hr(o,n),le=f?f(X):X,pe=k.length,ae=f?je=>f(Tn(je[o.index])):o.index;let Ve=null;if(!f&&_&&(Ve=function OS(e,n,t,o){const c=e.cleanup;if(null!=c)for(let u=0;u<c.length-1;u+=2){const f=c[u];if(f===t&&c[u+1]===o){const _=n[mu],v=c[u+2];return _.length>v?_[v]:null}"string"==typeof f&&(u+=2)}return null}(e,n,c,o.index)),null!==Ve)(Ve.__ngLastListenerFn__||Ve).__ngNextListenerFn__=u,Ve.__ngLastListenerFn__=u,U=!1;else{u=tE(o,n,R,u,!1);const je=t.listen(le,c,u);k.push(u,je),S&&S.push(c,ae,pe,pe+1)}}else u=tE(o,n,R,u,!1);const G=o.outputs;let z;if(U&&null!==G&&(z=G[c])){const X=z.length;if(X)for(let le=0;le<X;le+=2){const Pt=n[z[le]][z[le+1]].subscribe(u),di=k.length;k.push(u,Pt),S&&S.push(c,o.index,di,-(di+1))}}}(u,c,c[gt],f,e,n,o),en}function HA(e,n,t,o){try{return fs(6,n,t),!1!==t(o)}catch(c){return SA(e,c),!1}finally{fs(7,n,t)}}function tE(e,n,t,o,c){return function u(f){if(f===Function)return o;ad(e.componentOffset>-1?Ho(e.index,n):n);let v=HA(n,t,o,f),S=u.__ngNextListenerFn__;for(;S;)v=HA(n,t,S,f)&&v,S=S.__ngNextListenerFn__;return c&&!1===v&&f.preventDefault(),v}}function tn(e=1){return function Ox(e){return(ct.lFrame.contextLView=function Nx(e,n){for(;e>0;)n=n[gu],e--;return n}(e,ct.lFrame.contextLView))[mi]}(e)}function md(e,n){let t=null;const o=function z1(e){const n=e.attrs;if(null!=n){const t=n.indexOf(5);if(!(1&t))return n[t+1]}return null}(e);for(let c=0;c<n.length;c++){const u=n[c];if("*"!==u){if(null===o?xw(e,u,!0):pu(o,u))return c}else t=c}return t}function _d(e){const n=be()[Si][Ar];if(!n.projection){const o=n.projection=Pu(e?e.length:1,null),c=o.slice();let u=n.child;for(;null!==u;){const f=e?md(u,e):0;null!==f&&(c[f]?c[f].projectionNext=u:o[f]=u,c[f]=u),u=u.next}}}function nr(e,n=0,t){const o=be(),c=$t(),u=ih(c,Ut+e,16,null,t||null);null===u.projection&&(u.projection=n),Vy(),(!o[tc]||Vs())&&32!=(32&u.flags)&&function gM(e,n,t){yb(n[gt],0,n,t,fb(e,t,n),lR(t.parent||n[Ar],t,n))}(c,o,u)}function ph(e,n){return e<<17|n<<2}function dl(e){return e>>17&32767}function oE(e){return 2|e}function ul(e){return(131068&e)>>2}function xS(e,n){return-131069&e|n<<2}function aE(e){return 1|e}function cE(e,n,t,o,c){const u=e[t+1],f=null===n;let _=o?dl(u):ul(u),v=!1;for(;0!==_&&(!1===v||f);){const R=e[_+1];YA(e[_],n)&&(v=!0,e[_+1]=o?aE(R):oE(R)),_=o?dl(R):ul(R)}v&&(e[t+1]=o?oE(u):aE(u))}function YA(e,n){return null===e||null==n||(Array.isArray(e)?e[1]:e)===n||!(!Array.isArray(e)||"string"!=typeof n)&&xu(e,n)>=0}function lE(e,n,t){return Ks(e,n,t,!1),lE}function Vt(e,n){return Ks(e,n,null,!0),Vt}function Ks(e,n,t,o){const c=be(),u=$t(),f=function lo(e){const n=ct.lFrame,t=n.bindingIndex;return n.bindingIndex=n.bindingIndex+e,t}(2);u.firstUpdatePass&&function oD(e,n,t,o){const c=e.data;if(null===c[t+1]){const u=c[Gr()],f=function rD(e,n){return n>=e.expandoStartIndex}(e,t);(function hE(e,n){return 0!=(e.flags&(n?8:16))})(u,o)&&null===n&&!f&&(n=!1),n=function dE(e,n,t,o){const c=function Hy(e){const n=ct.lFrame.currentDirectiveIndex;return-1===n?null:e[n]}(e);let u=o?n.residualClasses:n.residualStyles;if(null===c)0===(o?n.classBindings:n.styleBindings)&&(t=_h(t=uE(null,e,n,t,o),n.attrs,o),u=null);else{const f=n.directiveStylingLast;if(-1===f||e[f]!==c)if(t=uE(c,e,n,t,o),null===u){let v=function Xk(e,n,t){const o=t?n.classBindings:n.styleBindings;if(0!==ul(o))return e[dl(o)]}(e,n,o);void 0!==v&&Array.isArray(v)&&(v=uE(null,e,n,v[1],o),v=_h(v,n.attrs,o),function Jk(e,n,t,o){e[dl(t?n.classBindings:n.styleBindings)]=o}(e,n,o,v))}else u=function ir(e,n,t){let o;const c=n.directiveEnd;for(let u=1+n.directiveStylingLast;u<c;u++)o=_h(o,e[u].hostAttrs,t);return _h(o,n.attrs,t)}(e,n,o)}return void 0!==u&&(o?n.residualClasses=u:n.residualStyles=u),t}(c,u,n,o),function Yk(e,n,t,o,c,u){let f=u?n.classBindings:n.styleBindings,_=dl(f),v=ul(f);e[o]=t;let R,S=!1;if(Array.isArray(t)?(R=t[1],(null===R||xu(t,R)>0)&&(S=!0)):R=t,c)if(0!==v){const U=dl(e[_+1]);e[o+1]=ph(U,_),0!==U&&(e[U+1]=xS(e[U+1],o)),e[_+1]=function fh(e,n){return 131071&e|n<<17}(e[_+1],o)}else e[o+1]=ph(_,0),0!==_&&(e[_+1]=xS(e[_+1],o)),_=o;else e[o+1]=ph(v,0),0===_?_=o:e[v+1]=xS(e[v+1],o),v=o;S&&(e[o+1]=oE(e[o+1])),cE(e,R,o,!0),cE(e,R,o,!1),function mh(e,n,t,o,c){const u=c?e.residualClasses:e.residualStyles;null!=u&&"string"==typeof n&&xu(u,n)>=0&&(t[o+1]=aE(t[o+1]))}(n,R,e,o,u),f=ph(_,v),u?n.classBindings=f:n.styleBindings=f}(c,u,n,t,f,o)}}(u,e,f,o),n!==bt&&_r(c,f,n)&&function VS(e,n,t,o,c,u,f,_){if(!(3&n.type))return;const v=e.data,S=v[_+1],R=function sE(e){return 1==(1&e)}(S)?Tf(v,n,t,c,ul(S),f):void 0;wf(R)||(wf(u)||function Er(e){return 2==(2&e)}(S)&&(u=Tf(v,null,t,c,_,f)),function hR(e,n,t,o,c){if(n)c?e.addClass(t,o):e.removeClass(t,o);else{let u=-1===o.indexOf("-")?void 0:Jc.DashCase;null==c?e.removeStyle(t,o,u):("string"==typeof c&&c.endsWith("!important")&&(c=c.slice(0,-10),u|=Jc.Important),e.setStyle(t,o,c,u))}}(o,f,Rp(Gr(),t),c,u))}(u,u.data[Gr()],c,c[gt],e,c[f+1]=function cD(e,n){return null==e||""===e||("string"==typeof n?e+=n:"object"==typeof e&&(e=Wn(el(e)))),e}(n,t),o,f)}function uE(e,n,t,o,c){let u=null;const f=t.directiveEnd;let _=t.directiveStylingLast;for(-1===_?_=t.directiveStart:_++;_<f&&(u=n[_],o=_h(o,u.hostAttrs,c),u!==e);)_++;return null!==e&&(t.directiveStylingLast=_),o}function _h(e,n,t){const o=t?1:2;let c=-1;if(null!==n)for(let u=0;u<n.length;u++){const f=n[u];"number"==typeof f?c=f:c===o&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),uo(e,f,!!t||n[++u]))}return void 0===e?null:e}function Tf(e,n,t,o,c,u){const f=null===n;let _;for(;c>0;){const v=e[c],S=Array.isArray(v),R=S?v[1]:v,k=null===R;let U=t[c+1];U===bt&&(U=k?Qt:void 0);let G=k?W_(U,o):R===o?U:void 0;if(S&&!wf(G)&&(G=W_(v,o)),wf(G)&&(_=G,f))return _;const z=e[c+1];c=f?dl(z):ul(z)}if(null!==n){let v=u?n.residualClasses:n.residualStyles;null!=v&&(_=W_(v,o))}return _}function wf(e){return void 0!==e}function Dr(e,n=""){const t=be(),o=$t(),c=e+Ut,u=o.firstCreatePass?ih(o,c,1,n,null):o.data[c],f=lD(o,t,u,n,e);t[c]=f,N_()&&sg(o,t,f,u),Ea(u,!1)}let lD=(e,n,t,o,c)=>(Wo(!0),function Wp(e,n){return e.createText(n)}(n[gt],o));function hc(e){return If("",e,""),hc}function If(e,n,t){const o=be(),c=function J(e,n,t,o){return _r(e,ql(),t)?n+_t(t)+o:bt}(o,e,n,t);return c!==bt&&function Ra(e,n,t){const o=Rp(n,e);!function tg(e,n,t){e.setValue(n,t)}(e[gt],o,t)}(o,Gr(),c),If}function gh(e,n,t){const o=be();return _r(o,ql(),n)&&ho($t(),ni(),o,e,n,o[gt],t,!0),gh}const ri="en-US";let Df=ri;function it(e,n,t,o,c){if(e=nt(e),Array.isArray(e))for(let u=0;u<e.length;u++)it(e[u],n,t,o,c);else{const u=$t(),f=be(),_=pr();let v=id(e)?e:nt(e.provide);const S=NR(e),R=1048575&_.providerIndexes,k=_.directiveStart,U=_.providerIndexes>>20;if(id(e)||!e.multi){const G=new oc(S,c,re),z=Nr(v,n,c?R:R+U,k);-1===z?(j_(fr(_,f),u,v),we(u,e,n.length),n.push(v),_.directiveStart++,_.directiveEnd++,c&&(_.providerIndexes+=1048576),t.push(G),f.push(G)):(t[z]=G,f[z]=G)}else{const G=Nr(v,n,R+U,k),z=Nr(v,n,R,R+U),le=z>=0&&t[z];if(c&&!le||!c&&!(G>=0&&t[G])){j_(fr(_,f),u,v);const pe=function En(e,n,t,o,c){const u=new oc(e,t,re);return u.multi=[],u.index=n,u.componentProviders=0,aC(u,c,o&&!t),u}(c?jn:bo,t.length,c,o,S);!c&&le&&(t[z].providerFactory=pe),we(u,e,n.length,0),n.push(v),_.directiveStart++,_.directiveEnd++,c&&(_.providerIndexes+=1048576),t.push(pe),f.push(pe)}else we(u,e,G>-1?G:z,aC(t[c?z:G],S,!c&&o));!c&&o&&le&&t[z].componentProviders++}}}function we(e,n,t,o){const c=id(n),u=function WM(e){return!!e.useClass}(n);if(c||u){const v=(u?nt(n.useClass):n).prototype.ngOnDestroy;if(v){const S=e.destroyHooks||(e.destroyHooks=[]);if(!c&&n.multi){const R=S.indexOf(t);-1===R?S.push(t,[o,v]):S[R+1].push(o,v)}else S.push(t,v)}}}function aC(e,n,t){return t&&e.componentProviders++,e.multi.push(n)-1}function Nr(e,n,t,o){for(let c=t;c<o;c++)if(n[c]===e)return c;return-1}function bo(e,n,t,o){return vs(this.multi,[])}function jn(e,n,t,o){const c=this.multi;let u;if(this.providerFactory){const f=this.providerFactory.componentProviders,_=$c(t,t[ke],this.providerFactory.index,o);u=_.slice(0,f),vs(c,u);for(let v=f;v<_.length;v++)u.push(_[v])}else u=[],vs(c,u);return u}function vs(e,n){for(let t=0;t<e.length;t++)n.push((0,e[t])());return n}function Lt(e,n=[]){return t=>{t.providersResolver=(o,c)=>function ne(e,n,t){const o=$t();if(o.firstCreatePass){const c=Us(e);it(t,o.data,o.blueprint,c,!0),it(n,o.data,o.blueprint,c,!1)}}(o,c?c(e):e,n)}}class gl{}class Pr{}class Dt extends gl{constructor(n,t,o){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new AA(this);const c=Uo(n);this._bootstrapComponents=Ko(c.bootstrap),this._r3Injector=od(n,t,[{provide:gl,useValue:this},{provide:Ju,useValue:this.componentFactoryResolver},...o],Wn(n),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(n)}get injector(){return this._r3Injector}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class ys extends Pr{constructor(n){super(),this.moduleType=n}create(n){return new Dt(this.moduleType,n,[])}}class cC extends gl{constructor(n){super(),this.componentFactoryResolver=new AA(this),this.instance=null;const t=new _g([...n.providers,{provide:gl,useValue:this},{provide:Ju,useValue:this.componentFactoryResolver}],n.parent||mg(),n.debugName,new Set(["environment"]));this.injector=t,n.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}}function bh(e,n,t=null){return new cC({providers:e,parent:n,debugName:t,runEnvironmentInitializers:!0}).injector}let pL=(()=>{class e{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){const o=AR(0,t.type),c=o.length>0?bh([o],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,c)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=xe({token:e,providedIn:"environment",factory:()=>new e(fe(zo))})}return e})();function Ff(e){e.getStandaloneInjector=n=>n.get(pL).getOrCreateStandaloneInjector(e)}function pC(e,n,t,o,c,u,f){return function $n(e,n,t,o,c,u,f,_,v){const S=n+t;return function qr(e,n,t,o,c,u){const f=al(e,n,t,o);return al(e,n+2,c,u)||f}(e,S,c,u,f,_)?Ws(e,S+4,v?o.call(v,c,u,f,_):o(c,u,f,_)):Vf(e,S+4)}(be(),Hr(),e,n,t,o,c,u,f)}function Vf(e,n){const t=e[n];return t===bt?void 0:t}function bE(e,n){const t=$t();let o;const c=e+Ut;t.firstCreatePass?(o=function CL(e,n){if(n)for(let t=n.length-1;t>=0;t--){const o=n[t];if(e===o.name)return o}}(n,t.pipeRegistry),t.data[c]=o,o.onDestroy&&(t.destroyHooks??=[]).push(c,o.onDestroy)):o=t.data[c];const u=o.factory||(o.factory=Wc(o.type)),_=so(re);try{const v=U_(!1),S=u();return U_(v),function BA(e,n,t,o){t>=e.data.length&&(e.data[t]=null,e.blueprint[t]=null),n[t]=o}(t,be(),c,S),S}finally{so(_)}}function fc(e,n,t){const o=e+Ut,c=be(),u=Su(c,o);return function vl(e,n){return e[ke].data[n].pure}(c,o)?function mC(e,n,t,o,c,u){const f=n+t;return _r(e,f,c)?Ws(e,f+1,u?o.call(u,c):o(c)):Vf(e,f+1)}(c,Hr(),n,u.transform,t,u):u.transform(t)}function wL(){return this._results[Symbol.iterator]()}class gC{static#e=Symbol.iterator;get changes(){return this._changes||(this._changes=new Zt)}constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=gC.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=wL)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,t){return this._results.reduce(n,t)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,t){const o=this;o.dirty=!1;const c=function ms(e){return e.flat(Number.POSITIVE_INFINITY)}(n);(this._changesDetected=!function DI(e,n,t){if(e.length!==n.length)return!1;for(let o=0;o<e.length;o++){let c=e[o],u=n[o];if(t&&(c=t(c),u=t(u)),u!==c)return!1}return!0}(o._results,c,t))&&(o._results=c,o.length=c.length,o.last=c[this.length-1],o.first=c[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function SE(e,n,t,o=!0){const c=n[ke];if(function pM(e,n,t,o){const c=ye+o,u=t.length;o>0&&(t[c-1][Ls]=n),o<u-ye?(n[Ls]=t[c],OI(t,ye+o,n)):(t.push(n),n[Ls]=null),n[Qn]=t;const f=n[Fs];null!==f&&t!==f&&function hb(e,n){const t=e[Hc];n[Si]!==n[Qn][Qn][Si]&&(e[gy]=!0),null===t?e[Hc]=[n]:t.push(n)}(f,n);const _=n[ma];null!==_&&_.insertView(e),n[Tt]|=128}(c,n,e,t),o){const u=vb(t,e),f=n[gt],_=Uu(f,e[_a]);null!==_&&function iR(e,n,t,o,c,u){o[fi]=c,o[Ar]=n,Kp(e,o,t,1,c,u)}(c,e[Ar],f,n,_,u)}}let Ss=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=me}return e})();const Sh=Ss,JD=class extends Sh{constructor(n,t,o){super(),this._declarationLView=n,this._declarationTContainer=t,this.elementRef=o}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,t){return this.createEmbeddedViewImpl(n,t)}createEmbeddedViewImpl(n,t,o){const c=function Ma(e,n,t,o){const c=n.tView,_=Ng(e,c,t,4096&e[Tt]?4096:16,null,n,null,null,null,o?.injector??null,o?.hydrationInfo??null);_[Fs]=e[n.index];const S=e[ma];return null!==S&&(_[ma]=S.createEmbeddedView(c)),mS(c,_,t),_}(this._declarationLView,this._declarationTContainer,n,{injector:t,hydrationInfo:o});return new ff(c)}};function me(){return Ot(pr(),be())}function Ot(e,n){return 4&e.type?new JD(n,e,rd(e,n)):null}let Jo=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=IL}return e})();function IL(){return ka(pr(),be())}const QD=Jo,Ii=class extends QD{constructor(n,t,o){super(),this._lContainer=n,this._hostTNode=t,this._hostLView=o}get element(){return rd(this._hostTNode,this._hostLView)}get injector(){return new mr(this._hostTNode,this._hostLView)}get parentInjector(){const n=B_(this._hostTNode,this._hostLView);if(L_(n)){const t=wu(n,this._hostLView),o=kp(n);return new mr(t[ke].data[o+8],t)}return new mr(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const t=br(this._lContainer);return null!==t&&t[n]||null}get length(){return this._lContainer.length-ye}createEmbeddedView(n,t,o){let c,u;"number"==typeof o?c=o:null!=o&&(c=o.index,u=o.injector);const _=n.createEmbeddedViewImpl(t||{},u,null);return this.insertImpl(_,c,false),_}createComponent(n,t,o,c,u){const f=n&&!function Fp(e){return"function"==typeof e}(n);let _;if(f)_=t;else{const X=t||{};_=X.index,o=X.injector,c=X.projectableNodes,u=X.environmentInjector||X.ngModuleRef}const v=f?n:new ah(Yt(n)),S=o||this.parentInjector;if(!u&&null==v.ngModule){const le=(f?S:this.parentInjector).get(zo,null);le&&(u=le)}Yt(v.componentType??{});const G=v.create(S,c,null,u);return this.insertImpl(G.hostView,_,false),G}insert(n,t){return this.insertImpl(n,t,!1)}insertImpl(n,t,o){const c=n._lView;if(function bx(e){return jr(e[Qn])}(c)){const v=this.indexOf(n);if(-1!==v)this.detach(v);else{const S=c[Qn],R=new Ii(S,S[Ar],S[Qn]);R.detach(R.indexOf(n))}}const f=this._adjustIndex(t),_=this._lContainer;return SE(_,c,f,!o),n.attachToViewContainerRef(),OI(gc(_),f,n),n}move(n,t){return this.insert(n,t)}indexOf(n){const t=br(this._lContainer);return null!==t?t.indexOf(n):-1}remove(n){const t=this._adjustIndex(n,-1),o=ig(this._lContainer,t);o&&(Up(gc(this._lContainer),t),rg(o[ke],o))}detach(n){const t=this._adjustIndex(n,-1),o=ig(this._lContainer,t);return o&&null!=Up(gc(this._lContainer),t)?new ff(o):null}_adjustIndex(n,t=0){return n??this.length+t}};function br(e){return e[8]}function gc(e){return e[8]||(e[8]=[])}function ka(e,n){let t;const o=n[e.index];return jr(o)?t=o:(t=gA(o,n,null,e),n[e.index]=t,Vg(n,t)),RE(t,n,e,o),new Ii(t,e,n)}let RE=function Td(e,n,t,o){if(e[_a])return;let c;c=8&t.type?Tn(o):function Vi(e,n){const t=e[gt],o=t.createComment(""),c=hr(n,e);return ba(t,Uu(t,c),o,function cR(e,n){return e.nextSibling(n)}(t,c),!1),o}(n,t),e[_a]=c};class AE{constructor(n){this.queryList=n,this.matches=null}clone(){return new AE(this.queryList)}setDirty(){this.queryList.setDirty()}}class DE{constructor(n=[]){this.queries=n}createEmbeddedView(n){const t=n.queries;if(null!==t){const o=null!==n.contentQueries?n.contentQueries[0]:t.length,c=[];for(let u=0;u<o;u++){const f=t.getByIndex(u);c.push(this.queries[f.indexInDeclarationView].clone())}return new DE(c)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let t=0;t<this.queries.length;t++)null!==SC(n,t).matches&&this.queries[t].setDirty()}}class $r{constructor(n,t,o=null){this.predicate=n,this.flags=t,this.read=o}}class vt{constructor(n=[]){this.queries=n}elementStart(n,t){for(let o=0;o<this.queries.length;o++)this.queries[o].elementStart(n,t)}elementEnd(n){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(n)}embeddedTView(n){let t=null;for(let o=0;o<this.length;o++){const c=null!==t?t.length:0,u=this.getByIndex(o).embeddedTView(n,c);u&&(u.indexInDeclarationView=o,null!==t?t.push(u):t=[u])}return null!==t?new vt(t):null}template(n,t){for(let o=0;o<this.queries.length;o++)this.queries[o].template(n,t)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class vC{constructor(n,t=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(n,t){this.isApplyingToNode(t)&&this.matchTNode(n,t)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,t){this.elementStart(n,t)}embeddedTView(n,t){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,t),new vC(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let o=n.parent;for(;null!==o&&8&o.type&&o.index!==t;)o=o.parent;return t===(null!==o?o.index:-1)}return this._appliesToNextNode}matchTNode(n,t){const o=this.metadata.predicate;if(Array.isArray(o))for(let c=0;c<o.length;c++){const u=o[c];this.matchTNodeWithReadOption(n,t,Ch(t,u)),this.matchTNodeWithReadOption(n,t,va(t,n,u,!1,!1))}else o===Ss?4&t.type&&this.matchTNodeWithReadOption(n,t,-1):this.matchTNodeWithReadOption(n,t,va(t,n,o,!1,!1))}matchTNodeWithReadOption(n,t,o){if(null!==o){const c=this.metadata.read;if(null!==c)if(c===bn||c===Jo||c===Ss&&4&t.type)this.addMatch(t.index,-2);else{const u=va(t,n,c,!1,!1);null!==u&&this.addMatch(t.index,u)}else this.addMatch(t.index,o)}}addMatch(n,t){null===this.matches?this.matches=[n,t]:this.matches.push(n,t)}}function Ch(e,n){const t=e.localNames;if(null!==t)for(let o=0;o<t.length;o+=2)if(t[o]===n)return t[o+1];return null}function wd(e,n,t,o){return-1===t?function eO(e,n){return 11&e.type?rd(e,n):4&e.type?Ot(e,n):null}(n,e):-2===t?function yC(e,n,t){return t===bn?rd(n,e):t===Ss?Ot(n,e):t===Jo?ka(n,e):void 0}(e,n,o):$c(e,e[ke],t,n)}function OE(e,n,t,o){const c=n[ma].queries[o];if(null===c.matches){const u=e.data,f=t.matches,_=[];for(let v=0;v<f.length;v+=2){const S=f[v];_.push(S<0?null:wd(n,u[S],f[v+1],t.metadata.read))}c.matches=_}return c.matches}function Ei(e,n,t,o){const c=e.queries.getByIndex(t),u=c.matches;if(null!==u){const f=OE(e,n,c,t);for(let _=0;_<u.length;_+=2){const v=u[_];if(v>0)o.push(f[_/2]);else{const S=u[_+1],R=n[-v];for(let k=ye;k<R.length;k++){const U=R[k];U[Fs]===U[Qn]&&Ei(U[ke],U,S,o)}if(null!==R[Hc]){const k=R[Hc];for(let U=0;U<k.length;U++){const G=k[U];Ei(G[ke],G,S,o)}}}}}return o}function $e(e){const n=be(),t=$t(),o=w_();Pp(o+1);const c=SC(t,o);if(e.dirty&&function rI(e){return 4==(4&e[Tt])}(n)===(2==(2&c.metadata.flags))){if(null===c.matches)e.reset([]);else{const u=c.crossesNgTemplate?Ei(t,n,o,[]):OE(t,n,c,o);e.reset(u,UR),e.notifyOnChanges()}return!0}return!1}function Js(e,n,t){const o=$t();o.firstCreatePass&&(nO(o,new $r(e,n,t),-1),2==(2&n)&&(o.staticViewQueries=!0)),NE(o,be(),n)}function La(e,n,t,o){const c=$t();if(c.firstCreatePass){const u=pr();nO(c,new $r(n,t,o),u.index),function bC(e,n){const t=e.contentQueries||(e.contentQueries=[]);n!==(t.length?t[t.length-1]:-1)&&t.push(e.queries.length-1,n)}(c,e),2==(2&t)&&(c.staticContentQueries=!0)}NE(c,be(),t)}function Bi(){return function tO(e,n){return e[ma].queries[n].queryList}(be(),w_())}function NE(e,n,t){const o=new gC(4==(4&t));(function cS(e,n,t,o){const c=vA(n);c.push(t),e.firstCreatePass&&yA(e).push(o,c.length-1)})(e,n,o,o.destroy),null===n[ma]&&(n[ma]=new DE),n[ma].queries.push(new AE(o))}function nO(e,n,t){null===e.queries&&(e.queries=new vt),e.queries.track(new vC(n,t))}function SC(e,n){return e.queries.getByIndex(n)}function Bf(e,n){return Ot(e,n)}const Cs=new De("Application Initializer");let Co=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,o)=>{this.resolve=t,this.reject=o}),this.appInits=Oe(Cs,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const t=[];for(const c of this.appInits){const u=c();if(fd(u))t.push(u);else if(ll(u)){const f=new Promise((_,v)=>{u.subscribe({complete:_,error:v})});t.push(f)}}const o=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{o()}).catch(c=>{this.reject(c)}),0===t.length&&o(),this.initialized=!0}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Dd=(()=>{class e{log(t){console.log(t)}warn(t){console.warn(t)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();const Zs=new De("LocaleId",{providedIn:"root",factory:()=>Oe(Zs,Ft.Optional|Ft.SkipSelf)||function LC(){return typeof $localize<"u"&&$localize.locale||ri}()});let vO=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new ro(!1)}add(){this.hasPendingTasks.next(!0);const t=this.taskId++;return this.pendingTasks.add(t),t}remove(t){this.pendingTasks.delete(t),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class yO{constructor(n,t){this.ngModuleFactory=n,this.componentFactories=t}}let Ua=(()=>{class e{compileModuleSync(t){return new ys(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const o=this.compileModuleSync(t),u=Ko(Uo(t).declarations).reduce((f,_)=>{const v=Yt(_);return v&&f.push(new ah(v)),f},[]);return new yO(o,u)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const MO=new De(""),Cl=new De("");let Tl,jC=(()=>{class e{constructor(t,o,c){this._ngZone=t,this.registry=o,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Tl||(function xd(e){Tl=e}(c),c.addToWindow(o)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{lt.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(o=>!o.updateCb||!o.updateCb(t)||(clearTimeout(o.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,o,c){let u=-1;o&&o>0&&(u=setTimeout(()=>{this._callbacks=this._callbacks.filter(f=>f.timeoutId!==u),t(this._didWork,this.getPendingTasks())},o)),this._callbacks.push({doneCb:t,timeoutId:u,updateCb:c})}whenStable(t,o,c){if(c&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,o,c),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,o,c){return[]}static#e=this.\u0275fac=function(o){return new(o||e)(fe(lt),fe(ji),fe(Cl))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac})}return e})(),ji=(()=>{class e{constructor(){this._applications=new Map}registerApplication(t,o){this._applications.set(t,o)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,o=!0){return Tl?.findTestabilityInTree(this,t,o)??null}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})(),wl=null;const zE=new De("AllowMultipleToken"),HC=new De("PlatformDestroyListeners"),Ba=new De("appBootstrapListener");class ts{constructor(n,t){this.name=n,this.token=t}}function FO(e,n,t=[]){const o=`Platform: ${n}`,c=new De(o);return(u=[])=>{let f=Th();if(!f||f.injector.get(zE,!1)){const _=[...t,...u,{provide:c,useValue:!0}];e?e(_):function LO(e){if(wl&&!wl.get(zE,!1))throw new ue(400,!1);(function kO(){!function ux(e){g_=e}(()=>{throw new ue(600,!1)})})(),wl=e;const n=e.get(VO);(function GC(e){e.get(Jp,null)?.forEach(t=>t())})(e)}(function UO(e=[],n){return tr.create({name:n,providers:[{provide:Mb,useValue:"platform"},{provide:HC,useValue:new Set([()=>wl=null])},...e]})}(_,o))}return function WC(e){const n=Th();if(!n)throw new ue(401,!1);return n}()}}function Th(){return wl?.get(VO)??null}let VO=(()=>{class e{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,o){const c=function LL(e="zone.js",n){return"noop"===e?new Dg:"zone.js"===e?new lt(n):e}(o?.ngZone,function BO(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}({eventCoalescing:o?.ngZoneEventCoalescing,runCoalescing:o?.ngZoneRunCoalescing}));return c.run(()=>{const u=function UD(e,n,t){return new Dt(e,n,t)}(t.moduleType,this.injector,function Ld(e){return[{provide:lt,useFactory:e},{provide:Xp,multi:!0,useFactory:()=>{const n=Oe(kd,{optional:!0});return()=>n.initialize()}},{provide:GO,useFactory:FL},{provide:af,useFactory:KR}]}(()=>c)),f=u.injector.get(Ta,null);return c.runOutsideAngular(()=>{const _=c.onError.subscribe({next:v=>{f.handleError(v)}});u.onDestroy(()=>{qE(this._modules,u),_.unsubscribe()})}),function jO(e,n,t){try{const o=t();return fd(o)?o.catch(c=>{throw n.runOutsideAngular(()=>e.handleError(c)),c}):o}catch(o){throw n.runOutsideAngular(()=>e.handleError(o)),o}}(f,c,()=>{const _=u.injector.get(Co);return _.runInitializers(),_.donePromise.then(()=>(function AD(e){Fo(e,"Expected localeId to be defined"),"string"==typeof e&&(Df=e.toLowerCase().replace(/_/g,"-"))}(u.injector.get(Zs,ri)||ri),this._moduleDoBootstrap(u),u))})})}bootstrapModule(t,o=[]){const c=Yf({},o);return function ML(e,n,t){const o=new ys(t);return Promise.resolve(o)}(0,0,t).then(u=>this.bootstrapModuleFactory(u,c))}_moduleDoBootstrap(t){const o=t.injector.get(ea);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(c=>o.bootstrap(c));else{if(!t.instance.ngDoBootstrap)throw new ue(-403,!1);t.instance.ngDoBootstrap(o)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new ue(404,!1);this._modules.slice().forEach(o=>o.destroy()),this._destroyListeners.forEach(o=>o());const t=this._injector.get(HC,null);t&&(t.forEach(o=>o()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#e=this.\u0275fac=function(o){return new(o||e)(fe(tr))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();function Yf(e,n){return Array.isArray(n)?n.reduce(Yf,e):{...e,...n}}let ea=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Oe(GO),this.zoneIsStable=Oe(af),this.componentTypes=[],this.components=[],this.isStable=Oe(vO).hasPendingTasks.pipe(us(t=>t?He(!1):this.zoneIsStable),oy(),Xa()),this._injector=Oe(zo)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(t,o){const c=t instanceof Kb;if(!this._injector.get(Co).done)throw!c&&function ps(e){const n=Yt(e)||dr(e)||Br(e);return null!==n&&n.standalone}(t),new ue(405,!1);let f;f=c?t:this._injector.get(Ju).resolveComponentFactory(t),this.componentTypes.push(f.componentType);const _=function kL(e){return e.isBoundToModule}(f)?void 0:this._injector.get(gl),S=f.create(tr.NULL,[],o||f.selector,_),R=S.location.nativeElement,k=S.injector.get(MO,null);return k?.registerApplication(R),S.onDestroy(()=>{this.detachView(S.hostView),qE(this.components,S),k?.unregisterApplication(R)}),this._loadComponent(S),S}tick(){if(this._runningTick)throw new ue(101,!1);try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this.internalErrorHandler(t)}finally{this._runningTick=!1}}attachView(t){const o=t;this._views.push(o),o.attachToAppRef(this)}detachView(t){const o=t;qE(this._views,o),o.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const o=this._injector.get(Ba,[]);o.push(...this._bootstrapListeners),o.forEach(c=>c(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>qE(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new ue(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function qE(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}const GO=new De("",{providedIn:"root",factory:()=>Oe(Ta).handleError.bind(void 0)});function FL(){const e=Oe(lt),n=Oe(Ta);return t=>e.runOutsideAngular(()=>n.handleError(t))}let kd=(()=>{class e{constructor(){this.zone=Oe(lt),this.applicationRef=Oe(ea)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();let rr=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=ns}return e})();function ns(e){return function is(e,n,t){if(Gc(e)&&!t){const o=Ho(e.index,n);return new ff(o,o)}return 47&e.type?new ff(n[Si],n):null}(pr(),be(),16==(16&e))}class Oh{constructor(){}supports(n){return _f(n)}create(n){return new YO(n)}}const Xf=(e,n)=>n;class YO{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||Xf}forEachItem(n){let t;for(t=this._itHead;null!==t;t=t._next)n(t)}forEachOperation(n){let t=this._itHead,o=this._removalsHead,c=0,u=null;for(;t||o;){const f=!o||t&&t.currentIndex<JO(o,c,u)?t:o,_=JO(f,c,u),v=f.currentIndex;if(f===o)c--,o=o._nextRemoved;else if(t=t._next,null==f.previousIndex)c++;else{u||(u=[]);const S=_-c,R=v-c;if(S!=R){for(let U=0;U<S;U++){const G=U<u.length?u[U]:u[U]=0,z=G+U;R<=z&&z<S&&(u[U]=G+1)}u[f.previousIndex]=R-S}}_!==v&&n(f,_,v)}}forEachPreviousItem(n){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)n(t)}forEachAddedItem(n){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)n(t)}forEachMovedItem(n){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)n(t)}forEachRemovedItem(n){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)n(t)}forEachIdentityChange(n){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)n(t)}diff(n){if(null==n&&(n=[]),!_f(n))throw new ue(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let c,u,f,t=this._itHead,o=!1;if(Array.isArray(n)){this.length=n.length;for(let _=0;_<this.length;_++)u=n[_],f=this._trackByFn(_,u),null!==t&&Object.is(t.trackById,f)?(o&&(t=this._verifyReinsertion(t,u,f,_)),Object.is(t.item,u)||this._addIdentityChange(t,u)):(t=this._mismatch(t,u,f,_),o=!0),t=t._next}else c=0,function MA(e,n){if(Array.isArray(e))for(let t=0;t<e.length;t++)n(e[t]);else{const t=e[Symbol.iterator]();let o;for(;!(o=t.next()).done;)n(o.value)}}(n,_=>{f=this._trackByFn(c,_),null!==t&&Object.is(t.trackById,f)?(o&&(t=this._verifyReinsertion(t,_,f,c)),Object.is(t.item,_)||this._addIdentityChange(t,_)):(t=this._mismatch(t,_,f,c),o=!0),t=t._next,c++}),this.length=c;return this._truncate(t),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,t,o,c){let u;return null===n?u=this._itTail:(u=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(o,null))?(Object.is(n.item,t)||this._addIdentityChange(n,t),this._reinsertAfter(n,u,c)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(o,c))?(Object.is(n.item,t)||this._addIdentityChange(n,t),this._moveAfter(n,u,c)):n=this._addAfter(new $O(t,o),u,c),n}_verifyReinsertion(n,t,o,c){let u=null===this._unlinkedRecords?null:this._unlinkedRecords.get(o,null);return null!==u?n=this._reinsertAfter(u,n._prev,c):n.currentIndex!=c&&(n.currentIndex=c,this._addToMoves(n,c)),n}_truncate(n){for(;null!==n;){const t=n._next;this._addToRemovals(this._unlink(n)),n=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,t,o){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const c=n._prevRemoved,u=n._nextRemoved;return null===c?this._removalsHead=u:c._nextRemoved=u,null===u?this._removalsTail=c:u._prevRemoved=c,this._insertAfter(n,t,o),this._addToMoves(n,o),n}_moveAfter(n,t,o){return this._unlink(n),this._insertAfter(n,t,o),this._addToMoves(n,o),n}_addAfter(n,t,o){return this._insertAfter(n,t,o),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,t,o){const c=null===t?this._itHead:t._next;return n._next=c,n._prev=t,null===c?this._itTail=n:c._prev=n,null===t?this._itHead=n:t._next=n,null===this._linkedRecords&&(this._linkedRecords=new XO),this._linkedRecords.put(n),n.currentIndex=o,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const t=n._prev,o=n._next;return null===t?this._itHead=o:t._next=o,null===o?this._itTail=t:o._prev=t,n}_addToMoves(n,t){return n.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new XO),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,t){return n.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class $O{constructor(n,t){this.item=n,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class jL{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,t){let o;for(o=this._head;null!==o;o=o._nextDup)if((null===t||t<=o.currentIndex)&&Object.is(o.trackById,n))return o;return null}remove(n){const t=n._prevDup,o=n._nextDup;return null===t?this._head=o:t._nextDup=o,null===o?this._tail=t:o._prevDup=t,null===this._head}}class XO{constructor(){this.map=new Map}put(n){const t=n.trackById;let o=this.map.get(t);o||(o=new jL,this.map.set(t,o)),o.add(n)}get(n,t){const c=this.map.get(n);return c?c.get(n,t):null}remove(n){const t=n.trackById;return this.map.get(t).remove(n)&&this.map.delete(t),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function JO(e,n,t){const o=e.previousIndex;if(null===o)return o;let c=0;return t&&o<t.length&&(c=t[o]),o+n+c}class QO{constructor(){}supports(n){return n instanceof Map||sl(n)}create(){return new JE}}class JE{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(n){let t;for(t=this._mapHead;null!==t;t=t._next)n(t)}forEachPreviousItem(n){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)n(t)}forEachChangedItem(n){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)n(t)}forEachAddedItem(n){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)n(t)}forEachRemovedItem(n){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)n(t)}diff(n){if(n){if(!(n instanceof Map||sl(n)))throw new ue(900,!1)}else n=new Map;return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(n,(o,c)=>{if(t&&t.key===c)this._maybeAddToChanges(t,o),this._appendAfter=t,t=t._next;else{const u=this._getOrCreateRecordForKey(c,o);t=this._insertBeforeOrAppend(t,u)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let o=t;null!==o;o=o._nextRemoved)o===this._mapHead&&(this._mapHead=null),this._records.delete(o.key),o._nextRemoved=o._next,o.previousValue=o.currentValue,o.currentValue=null,o._prev=null,o._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,t){if(n){const o=n._prev;return t._next=n,t._prev=o,n._prev=t,o&&(o._next=t),n===this._mapHead&&(this._mapHead=t),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(n,t){if(this._records.has(n)){const c=this._records.get(n);this._maybeAddToChanges(c,t);const u=c._prev,f=c._next;return u&&(u._next=f),f&&(f._prev=u),c._next=null,c._prev=null,c}const o=new HL(n);return this._records.set(n,o),o.currentValue=t,this._addToAdditions(o),o}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;null!==n;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;null!=n;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,t){Object.is(t,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=t,this._addToChanges(n))}_addToAdditions(n){null===this._additionsHead?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){null===this._changesHead?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,t){n instanceof Map?n.forEach(t):Object.keys(n).forEach(o=>t(n[o],o))}}class HL{constructor(n){this.key=n,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function ZO(){return new QE([new Oh])}let QE=(()=>{class e{static#e=this.\u0275prov=xe({token:e,providedIn:"root",factory:ZO});constructor(t){this.factories=t}static create(t,o){if(null!=o){const c=o.factories.slice();t=t.concat(c)}return new e(t)}static extend(t){return{provide:e,useFactory:o=>e.create(t,o||ZO()),deps:[[e,new q_,new Bp]]}}find(t){const o=this.factories.find(c=>c.supports(t));if(null!=o)return o;throw new ue(901,!1)}}return e})();function Nh(){return new Bd([new QO])}let Bd=(()=>{class e{static#e=this.\u0275prov=xe({token:e,providedIn:"root",factory:Nh});constructor(t){this.factories=t}static create(t,o){if(o){const c=o.factories.slice();t=t.concat(c)}return new e(t)}static extend(t){return{provide:e,useFactory:o=>e.create(t,o||Nh()),deps:[[e,new q_,new Bp]]}}find(t){const o=this.factories.find(c=>c.supports(t));if(o)return o;throw new ue(901,!1)}}return e})();const WL=FO(null,"core",[]);let zL=(()=>{class e{constructor(t){}static#e=this.\u0275fac=function(o){return new(o||e)(fe(ea))};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({})}return e})(),t0=null;function Dl(){return t0}class n0{}const Kt=new De("DocumentToken");let r0=(()=>{class e{historyGo(t){throw new Error("Not implemented")}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:function(){return Oe(c2)},providedIn:"platform"})}return e})();const nN=new De("Location Initialized");let c2=(()=>{class e extends r0{constructor(){super(),this._doc=Oe(Kt),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Dl().getBaseHref(this._doc)}onPopState(t){const o=Dl().getGlobalEventTarget(this._doc,"window");return o.addEventListener("popstate",t,!1),()=>o.removeEventListener("popstate",t)}onHashChange(t){const o=Dl().getGlobalEventTarget(this._doc,"window");return o.addEventListener("hashchange",t,!1),()=>o.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,o,c){this._history.pushState(t,o,c)}replaceState(t,o,c){this._history.replaceState(t,o,c)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:function(){return new e},providedIn:"platform"})}return e})();function jd(e,n){if(0==e.length)return n;if(0==n.length)return e;let t=0;return e.endsWith("/")&&t++,n.startsWith("/")&&t++,2==t?e+n.substring(1):1==t?e+n:e+"/"+n}function rv(e){const n=e.match(/#|\?|$/),t=n&&n.index||e.length;return e.slice(0,t-("/"===e[t-1]?1:0))+e.slice(t)}function yc(e){return e&&"?"!==e[0]?"?"+e:e}let xh=(()=>{class e{historyGo(t){throw new Error("Not implemented")}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:function(){return Oe(l2)},providedIn:"root"})}return e})();const iN=new De("appBaseHref");let l2=(()=>{class e extends xh{constructor(t,o){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=o??this._platformLocation.getBaseHrefFromDOM()??Oe(Kt).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return jd(this._baseHref,t)}path(t=!1){const o=this._platformLocation.pathname+yc(this._platformLocation.search),c=this._platformLocation.hash;return c&&t?`${o}${c}`:o}pushState(t,o,c,u){const f=this.prepareExternalUrl(c+yc(u));this._platformLocation.pushState(t,o,f)}replaceState(t,o,c,u){const f=this.prepareExternalUrl(c+yc(u));this._platformLocation.replaceState(t,o,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(o){return new(o||e)(fe(r0),fe(iN,8))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),w3=(()=>{class e extends xh{constructor(t,o){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=o&&(this._baseHref=o)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let o=this._platformLocation.hash;return null==o&&(o="#"),o.length>0?o.substring(1):o}prepareExternalUrl(t){const o=jd(this._baseHref,t);return o.length>0?"#"+o:o}pushState(t,o,c,u){let f=this.prepareExternalUrl(c+yc(u));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.pushState(t,o,f)}replaceState(t,o,c,u){let f=this.prepareExternalUrl(c+yc(u));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.replaceState(t,o,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(o){return new(o||e)(fe(r0),fe(iN,8))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac})}return e})(),o0=(()=>{class e{constructor(t){this._subject=new Zt,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const o=this._locationStrategy.getBaseHref();this._basePath=function s0(e){if(new RegExp("^(https?:)?//").test(e)){const[,t]=e.split(/\/\/[^\/]+/);return t}return e}(rv(u2(o))),this._locationStrategy.onPopState(c=>{this._subject.emit({url:this.path(!0),pop:!0,state:c.state,type:c.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,o=""){return this.path()==this.normalize(t+yc(o))}normalize(t){return e.stripTrailingSlash(function I3(e,n){if(!e||!n.startsWith(e))return n;const t=n.substring(e.length);return""===t||["/",";","?","#"].includes(t[0])?t:n}(this._basePath,u2(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,o="",c=null){this._locationStrategy.pushState(c,"",t,o),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+yc(o)),c)}replaceState(t,o="",c=null){this._locationStrategy.replaceState(c,"",t,o),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+yc(o)),c)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(o=>{this._notifyUrlChangeListeners(o.url,o.state)})),()=>{const o=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(o,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",o){this._urlChangeListeners.forEach(c=>c(t,o))}subscribe(t,o,c){return this._subject.subscribe({next:t,error:o,complete:c})}static#e=this.normalizeQueryParams=yc;static#t=this.joinWithSlash=jd;static#n=this.stripTrailingSlash=rv;static#i=this.\u0275fac=function(o){return new(o||e)(fe(xh))};static#r=this.\u0275prov=xe({token:e,factory:function(){return function d2(){return new o0(fe(xh))}()},providedIn:"root"})}return e})();function u2(e){return e.replace(/\/index.html$/,"")}const w0=/\s+/,om=[];let _v=(()=>{class e{constructor(t,o,c,u){this._iterableDiffers=t,this._keyValueDiffers=o,this._ngEl=c,this._renderer=u,this.initialClasses=om,this.stateMap=new Map}set klass(t){this.initialClasses=null!=t?t.trim().split(w0):om}set ngClass(t){this.rawClass="string"==typeof t?t.trim().split(w0):t}ngDoCheck(){for(const o of this.initialClasses)this._updateState(o,!0);const t=this.rawClass;if(Array.isArray(t)||t instanceof Set)for(const o of t)this._updateState(o,!0);else if(null!=t)for(const o of Object.keys(t))this._updateState(o,!!t[o]);this._applyStateDiff()}_updateState(t,o){const c=this.stateMap.get(t);void 0!==c?(c.enabled!==o&&(c.changed=!0,c.enabled=o),c.touched=!0):this.stateMap.set(t,{enabled:o,changed:!0,touched:!0})}_applyStateDiff(){for(const t of this.stateMap){const o=t[0],c=t[1];c.changed?(this._toggleClass(o,c.enabled),c.changed=!1):c.touched||(c.enabled&&this._toggleClass(o,!1),this.stateMap.delete(o)),c.touched=!1}}_toggleClass(t,o){(t=t.trim()).length>0&&t.split(w0).forEach(c=>{o?this._renderer.addClass(this._ngEl.nativeElement,c):this._renderer.removeClass(this._ngEl.nativeElement,c)})}static#e=this.\u0275fac=function(o){return new(o||e)(re(QE),re(Bd),re(bn),re(Ca))};static#t=this.\u0275dir=Ge({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0})}return e})();class Oi{constructor(n,t,o,c){this.$implicit=n,this.ngForOf=t,this.index=o,this.count=c}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let gN=(()=>{class e{set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}constructor(t,o,c){this._viewContainer=t,this._template=o,this._differs=c,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const o=this._viewContainer;t.forEachOperation((c,u,f)=>{if(null==c.previousIndex)o.createEmbeddedView(this._template,new Oi(c.item,this._ngForOf,-1,-1),null===f?void 0:f);else if(null==f)o.remove(null===u?void 0:u);else if(null!==u){const _=o.get(u);o.move(_,f),EN(_,c)}});for(let c=0,u=o.length;c<u;c++){const _=o.get(c).context;_.index=c,_.count=u,_.ngForOf=this._ngForOf}t.forEachIdentityChange(c=>{EN(o.get(c.currentIndex),c)})}static ngTemplateContextGuard(t,o){return!0}static#e=this.\u0275fac=function(o){return new(o||e)(re(Jo),re(Ss),re(QE))};static#t=this.\u0275dir=Ge({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}return e})();function EN(e,n){e.context.$implicit=n.item}let qd=(()=>{class e{constructor(t,o){this._viewContainer=t,this._context=new I0,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=o}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){R0("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){R0("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,o){return!0}static#e=this.\u0275fac=function(o){return new(o||e)(re(Jo),re(Ss))};static#t=this.\u0275dir=Ge({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}return e})();class I0{constructor(){this.$implicit=null,this.ngIf=null}}function R0(e,n){if(n&&!n.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${Wn(n)}'.`)}class A0{constructor(n,t){this._viewContainerRef=n,this._templateRef=t,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(n){n&&!this._created?this.create():!n&&this._created&&this.destroy()}}let Hh=(()=>{class e{constructor(){this._defaultViews=[],this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(t){this._ngSwitch=t,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(t){this._defaultViews.push(t)}_matchCase(t){const o=t==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||o,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),o}_updateDefaultCases(t){if(this._defaultViews.length>0&&t!==this._defaultUsed){this._defaultUsed=t;for(const o of this._defaultViews)o.enforceState(t)}}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275dir=Ge({type:e,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"},standalone:!0})}return e})(),Gh=(()=>{class e{constructor(t,o,c){this.ngSwitch=c,c._addCase(),this._view=new A0(t,o)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}static#e=this.\u0275fac=function(o){return new(o||e)(re(Jo),re(Ss),re(Hh,9))};static#t=this.\u0275dir=Ge({type:e,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"},standalone:!0})}return e})(),cn=(()=>{class e{constructor(t){this._viewContainerRef=t,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(t){if(t.ngTemplateOutlet||t.ngTemplateOutletInjector){const o=this._viewContainerRef;if(this._viewRef&&o.remove(o.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:c,ngTemplateOutletContext:u,ngTemplateOutletInjector:f}=this;this._viewRef=o.createEmbeddedView(c,u,f?{injector:f}:void 0)}else this._viewRef=null}else this._viewRef&&t.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}static#e=this.\u0275fac=function(o){return new(o||e)(re(Jo))};static#t=this.\u0275dir=Ge({type:e,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[jo]})}return e})();class D0{createSubscription(n,t){return eI(()=>n.subscribe({next:t,error:o=>{throw o}}))}dispose(n){eI(()=>n.unsubscribe())}}class Kd{createSubscription(n,t){return n.then(t,o=>{throw o})}dispose(n){}}const bN=new Kd,SN=new D0;let Jr=(()=>{class e{constructor(t){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=t}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(t){return this._obj?t!==this._obj?(this._dispose(),this.transform(t)):this._latestValue:(t&&this._subscribe(t),this._latestValue)}_subscribe(t){this._obj=t,this._strategy=this._selectStrategy(t),this._subscription=this._strategy.createSubscription(t,o=>this._updateLatestValue(t,o))}_selectStrategy(t){if(fd(t))return bN;if(ll(t))return SN;throw function Rs(e,n){return new ue(2100,!1)}()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(t,o){t===this._obj&&(this._latestValue=o,this._ref.markForCheck())}static#e=this.\u0275fac=function(o){return new(o||e)(re(rr,16))};static#t=this.\u0275pipe=Vr({name:"async",type:e,pure:!1,standalone:!0})}return e})(),Wh=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({})}return e})();const L0="browser";function ON(e){return"server"===e}let NN=(()=>{class e{static#e=this.\u0275prov=xe({token:e,providedIn:"root",factory:()=>new w2(fe(Kt),window)})}return e})();class w2{constructor(n,t){this.document=n,this.window=t,this.offset=()=>[0,0]}setOffset(n){this.offset=Array.isArray(n)?()=>n:n}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(n){this.supportsScrolling()&&this.window.scrollTo(n[0],n[1])}scrollToAnchor(n){if(!this.supportsScrolling())return;const t=function Sv(e,n){const t=e.getElementById(n)||e.getElementsByName(n)[0];if(t)return t;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const o=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let c=o.currentNode;for(;c;){const u=c.shadowRoot;if(u){const f=u.getElementById(n)||u.querySelector(`[name="${n}"]`);if(f)return f}c=o.nextNode()}}return null}(this.document,n);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(n){this.supportsScrolling()&&(this.window.history.scrollRestoration=n)}scrollToElement(n){const t=n.getBoundingClientRect(),o=t.left+this.window.pageXOffset,c=t.top+this.window.pageYOffset,u=this.offset();this.window.scrollTo(o-u[0],c-u[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class Os extends n0{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class Av extends Os{static makeCurrent(){!function Zf(e){t0||(t0=e)}(new Av)}onAndCancel(n,t,o){return n.addEventListener(t,o),()=>{n.removeEventListener(t,o)}}dispatchEvent(n,t){n.dispatchEvent(t)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,t){return(t=t||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,t){return"window"===t?window:"document"===t?n:"body"===t?n.body:null}getBaseHref(n){const t=function Rn(){return Tc=Tc||document.querySelector("base"),Tc?Tc.getAttribute("href"):null}();return null==t?null:function Ml(e){Dv=Dv||document.createElement("a"),Dv.setAttribute("href",e);const n=Dv.pathname;return"/"===n.charAt(0)?n:`/${n}`}(t)}resetBaseElement(){Tc=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return function Tr(e,n){n=encodeURIComponent(n);for(const t of e.split(";")){const o=t.indexOf("="),[c,u]=-1==o?[t,""]:[t.slice(0,o),t.slice(o+1)];if(c.trim()===n)return decodeURIComponent(u)}return null}(document.cookie,n)}}let Dv,Tc=null,HN=(()=>{class e{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac})}return e})();const Yh=new De("EventManagerPlugins");let q0=(()=>{class e{constructor(t,o){this._zone=o,this._eventNameToPlugin=new Map,t.forEach(c=>{c.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,o,c){return this._findPluginFor(o).addEventListener(t,o,c)}getZone(){return this._zone}_findPluginFor(t){let o=this._eventNameToPlugin.get(t);if(o)return o;if(o=this._plugins.find(u=>u.supports(t)),!o)throw new ue(5101,!1);return this._eventNameToPlugin.set(t,o),o}static#e=this.\u0275fac=function(o){return new(o||e)(fe(Yh),fe(lt))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac})}return e})();class K0{constructor(n){this._doc=n}}const hm="ng-app-id";let Y0=(()=>{class e{constructor(t,o,c,u={}){this.doc=t,this.appId=o,this.nonce=c,this.platformId=u,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=ON(u),this.resetHostNodes()}addStyles(t){for(const o of t)1===this.changeUsageCount(o,1)&&this.onStyleAdded(o)}removeStyles(t){for(const o of t)this.changeUsageCount(o,-1)<=0&&this.onStyleRemoved(o)}ngOnDestroy(){const t=this.styleNodesInDOM;t&&(t.forEach(o=>o.remove()),t.clear());for(const o of this.getAllStyles())this.onStyleRemoved(o);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const o of this.getAllStyles())this.addStyleToHost(t,o)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(const o of this.hostNodes)this.addStyleToHost(o,t)}onStyleRemoved(t){const o=this.styleRef;o.get(t)?.elements?.forEach(c=>c.remove()),o.delete(t)}collectServerRenderedStyles(){const t=this.doc.head?.querySelectorAll(`style[${hm}="${this.appId}"]`);if(t?.length){const o=new Map;return t.forEach(c=>{null!=c.textContent&&o.set(c.textContent,c)}),o}return null}changeUsageCount(t,o){const c=this.styleRef;if(c.has(t)){const u=c.get(t);return u.usage+=o,u.usage}return c.set(t,{usage:o,elements:[]}),o}getStyleElement(t,o){const c=this.styleNodesInDOM,u=c?.get(o);if(u?.parentNode===t)return c.delete(o),u.removeAttribute(hm),u;{const f=this.doc.createElement("style");return this.nonce&&f.setAttribute("nonce",this.nonce),f.textContent=o,this.platformIsServer&&f.setAttribute(hm,this.appId),f}}addStyleToHost(t,o){const c=this.getStyleElement(t,o);t.appendChild(c);const u=this.styleRef,f=u.get(o)?.elements;f?f.push(c):u.set(o,{elements:[c],usage:1})}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}static#e=this.\u0275fac=function(o){return new(o||e)(fe(Kt),fe(qu),fe(Ub,8),fe(nl))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac})}return e})();const $0={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},X0=/%COMP%/g,zN=new De("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function pm(e,n){return n.map(t=>t.replace(X0,e))}let Gi=(()=>{class e{constructor(t,o,c,u,f,_,v,S=null){this.eventManager=t,this.sharedStylesHost=o,this.appId=c,this.removeStylesOnCompDestroy=u,this.doc=f,this.platformId=_,this.ngZone=v,this.nonce=S,this.rendererByCompId=new Map,this.platformIsServer=ON(_),this.defaultRenderer=new Oo(t,f,v,this.platformIsServer)}createRenderer(t,o){if(!t||!o)return this.defaultRenderer;this.platformIsServer&&o.encapsulation===Rr.ShadowDom&&(o={...o,encapsulation:Rr.Emulated});const c=this.getOrCreateRenderer(t,o);return c instanceof Q0?c.applyToHost(t):c instanceof to&&c.applyStyles(),c}getOrCreateRenderer(t,o){const c=this.rendererByCompId;let u=c.get(o.id);if(!u){const f=this.doc,_=this.ngZone,v=this.eventManager,S=this.sharedStylesHost,R=this.removeStylesOnCompDestroy,k=this.platformIsServer;switch(o.encapsulation){case Rr.Emulated:u=new Q0(v,S,o,this.appId,R,f,_,k);break;case Rr.ShadowDom:return new ln(v,S,t,o,f,_,this.nonce,k);default:u=new to(v,S,o,R,f,_,k)}c.set(o.id,u)}return u}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(o){return new(o||e)(fe(q0),fe(Y0),fe(qu),fe(zN),fe(Kt),fe(nl),fe(lt),fe(Ub))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac})}return e})();class Oo{constructor(n,t,o,c){this.eventManager=n,this.doc=t,this.ngZone=o,this.platformIsServer=c,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(n,t){return t?this.doc.createElementNS($0[t]||t,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,t){(wc(n)?n.content:n).appendChild(t)}insertBefore(n,t,o){n&&(wc(n)?n.content:n).insertBefore(t,o)}removeChild(n,t){n&&n.removeChild(t)}selectRootElement(n,t){let o="string"==typeof n?this.doc.querySelector(n):n;if(!o)throw new ue(-5104,!1);return t||(o.textContent=""),o}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,t,o,c){if(c){t=c+":"+t;const u=$0[c];u?n.setAttributeNS(u,t,o):n.setAttribute(t,o)}else n.setAttribute(t,o)}removeAttribute(n,t,o){if(o){const c=$0[o];c?n.removeAttributeNS(c,t):n.removeAttribute(`${o}:${t}`)}else n.removeAttribute(t)}addClass(n,t){n.classList.add(t)}removeClass(n,t){n.classList.remove(t)}setStyle(n,t,o,c){c&(Jc.DashCase|Jc.Important)?n.style.setProperty(t,o,c&Jc.Important?"important":""):n.style[t]=o}removeStyle(n,t,o){o&Jc.DashCase?n.style.removeProperty(t):n.style[t]=""}setProperty(n,t,o){n[t]=o}setValue(n,t){n.nodeValue=t}listen(n,t,o){if("string"==typeof n&&!(n=Dl().getGlobalEventTarget(this.doc,n)))throw new Error(`Unsupported event target ${n} for event ${t}`);return this.eventManager.addEventListener(n,t,this.decoratePreventDefault(o))}decoratePreventDefault(n){return t=>{if("__ngUnwrap__"===t)return n;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>n(t)):n(t))&&t.preventDefault()}}}function wc(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class ln extends Oo{constructor(n,t,o,c,u,f,_,v){super(n,u,f,v),this.sharedStylesHost=t,this.hostEl=o,this.shadowRoot=o.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const S=pm(c.id,c.styles);for(const R of S){const k=document.createElement("style");_&&k.setAttribute("nonce",_),k.textContent=R,this.shadowRoot.appendChild(k)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,t){return super.appendChild(this.nodeOrShadowRoot(n),t)}insertBefore(n,t,o){return super.insertBefore(this.nodeOrShadowRoot(n),t,o)}removeChild(n,t){return super.removeChild(this.nodeOrShadowRoot(n),t)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class to extends Oo{constructor(n,t,o,c,u,f,_,v){super(n,u,f,_),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=c,this.styles=v?pm(v,o.styles):o.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class Q0 extends to{constructor(n,t,o,c,u,f,_,v){const S=c+"-"+o.id;super(n,t,o,u,f,_,v,S),this.contentAttr=function J0(e){return"_ngcontent-%COMP%".replace(X0,e)}(S),this.hostAttr=function qN(e){return"_nghost-%COMP%".replace(X0,e)}(S)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,t){const o=super.createElement(n,t);return super.setAttribute(o,this.contentAttr,""),o}}let KN=(()=>{class e extends K0{constructor(t){super(t)}supports(t){return!0}addEventListener(t,o,c){return t.addEventListener(o,c,!1),()=>this.removeEventListener(t,o,c)}removeEventListener(t,o,c){return t.removeEventListener(o,c)}static#e=this.\u0275fac=function(o){return new(o||e)(fe(Kt))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac})}return e})();const YN=["alt","control","meta","shift"],Y2={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Z0={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let Ov=(()=>{class e extends K0{constructor(t){super(t)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,o,c){const u=e.parseEventName(o),f=e.eventCallback(u.fullKey,c,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Dl().onAndCancel(t,u.domEventName,f))}static parseEventName(t){const o=t.toLowerCase().split("."),c=o.shift();if(0===o.length||"keydown"!==c&&"keyup"!==c)return null;const u=e._normalizeKey(o.pop());let f="",_=o.indexOf("code");if(_>-1&&(o.splice(_,1),f="code."),YN.forEach(S=>{const R=o.indexOf(S);R>-1&&(o.splice(R,1),f+=S+".")}),f+=u,0!=o.length||0===u.length)return null;const v={};return v.domEventName=c,v.fullKey=f,v}static matchEventFullKeyCode(t,o){let c=Y2[t.key]||t.key,u="";return o.indexOf("code.")>-1&&(c=t.code,u="code."),!(null==c||!c)&&(c=c.toLowerCase()," "===c?c="space":"."===c&&(c="dot"),YN.forEach(f=>{f!==c&&(0,Z0[f])(t)&&(u+=f+".")}),u+=c,u===o)}static eventCallback(t,o,c){return u=>{e.matchEventFullKeyCode(u,t)&&c.runGuarded(()=>o(u))}}static _normalizeKey(t){return"esc"===t?"escape":t}static#e=this.\u0275fac=function(o){return new(o||e)(fe(Kt))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac})}return e})();const Nt=FO(WL,"browser",[{provide:nl,useValue:L0},{provide:Jp,useValue:function X2(){Av.makeCurrent()},multi:!0},{provide:Kt,useFactory:function XN(){return function bM(e){bb=e}(document),document},deps:[]}]),fm=new De(""),JN=[{provide:Cl,useClass:class jN{addToWindow(n){Dn.getAngularTestability=(o,c=!0)=>{const u=n.findTestabilityInTree(o,c);if(null==u)throw new ue(5103,!1);return u},Dn.getAllAngularTestabilities=()=>n.getAllTestabilities(),Dn.getAllAngularRootElements=()=>n.getAllRootElements(),Dn.frameworkStabilizers||(Dn.frameworkStabilizers=[]),Dn.frameworkStabilizers.push(o=>{const c=Dn.getAllAngularTestabilities();let u=c.length,f=!1;const _=function(v){f=f||v,u--,0==u&&o(f)};c.forEach(v=>{v.whenStable(_)})})}findTestabilityInTree(n,t,o){return null==t?null:n.getTestability(t)??(o?Dl().isShadowRoot(t)?this.findTestabilityInTree(n,t.host,!0):this.findTestabilityInTree(n,t.parentElement,!0):null)}},deps:[]},{provide:MO,useClass:jC,deps:[lt,ji,Cl]},{provide:jC,useClass:jC,deps:[lt,ji,Cl]}],tT=[{provide:Mb,useValue:"root"},{provide:Ta,useFactory:function J2(){return new Ta},deps:[]},{provide:Yh,useClass:KN,multi:!0,deps:[Kt,lt,nl]},{provide:Yh,useClass:Ov,multi:!0,deps:[Kt]},Gi,Y0,q0,{provide:nf,useExisting:Gi},{provide:class PN{},useClass:HN,deps:[]},[]];let QN=(()=>{class e{constructor(t){}static withServerTransition(t){return{ngModule:e,providers:[{provide:qu,useValue:t.appId}]}}static#e=this.\u0275fac=function(o){return new(o||e)(fe(fm,12))};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({providers:[...tT,...JN],imports:[Wh,zL]})}return e})(),Gn=(()=>{class e{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static#e=this.\u0275fac=function(o){return new(o||e)(fe(Kt))};static#t=this.\u0275prov=xe({token:e,factory:function(o){let c=null;return c=o?new o:function tP(){return new Gn(fe(Kt))}(),c},providedIn:"root"})}return e})();typeof window<"u"&&window;const{isArray:ve}=Array,{getPrototypeOf:Ze,prototype:yt,keys:xn}=Object;function Ht(e){if(1===e.length){const n=e[0];if(ve(n))return{args:n,keys:null};if(function li(e){return e&&"object"==typeof e&&Ze(e)===yt}(n)){const t=xn(n);return{args:t.map(o=>n[o]),keys:t}}}return{args:e,keys:null}}const{isArray:ie}=Array;function ge(e){return mn(n=>function ce(e,n){return ie(n)?e(...n):e(n)}(e,n))}function Le(e,n){return e.reduce((t,o,c)=>(t[o]=n[c],t),{})}let de=(()=>{class e{constructor(t,o){this._renderer=t,this._elementRef=o,this.onChange=c=>{},this.onTouched=()=>{}}setProperty(t,o){this._renderer.setProperty(this._elementRef.nativeElement,t,o)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static#e=this.\u0275fac=function(o){return new(o||e)(re(Ca),re(bn))};static#t=this.\u0275dir=Ge({type:e})}return e})(),I=(()=>{class e extends de{static#e=this.\u0275fac=function(){let t;return function(c){return(t||(t=Ti(e)))(c||e)}}();static#t=this.\u0275dir=Ge({type:e,features:[Ne]})}return e})();const F=new De("NgValueAccessor"),Be={provide:F,useExisting:Cn(()=>sr),multi:!0},Pi=new De("CompositionEventMode");let sr=(()=>{class e extends de{constructor(t,o,c){super(t,o),this._compositionMode=c,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function Bt(){const e=Dl()?Dl().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(t){this.setProperty("value",t??"")}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static#e=this.\u0275fac=function(o){return new(o||e)(re(Ca),re(bn),re(Pi,8))};static#t=this.\u0275dir=Ge({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(o,c){1&o&&en("input",function(f){return c._handleInput(f.target.value)})("blur",function(){return c.onTouched()})("compositionstart",function(){return c._compositionStart()})("compositionend",function(f){return c._compositionEnd(f.target.value)})},features:[Lt([Be]),Ne]})}return e})();function kr(e){return null==e||("string"==typeof e||Array.isArray(e))&&0===e.length}function mm(e){return null!=e&&"number"==typeof e.length}const Wi=new De("NgValidators"),zi=new De("NgAsyncValidators"),kl=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class Jd{static min(n){return function hn(e){return n=>{if(kr(n.value)||kr(e))return null;const t=parseFloat(n.value);return!isNaN(t)&&t<e?{min:{min:e,actual:n.value}}:null}}(n)}static max(n){return function An(e){return n=>{if(kr(n.value)||kr(e))return null;const t=parseFloat(n.value);return!isNaN(t)&&t>e?{max:{max:e,actual:n.value}}:null}}(n)}static required(n){return function jt(e){return kr(e.value)?{required:!0}:null}(n)}static requiredTrue(n){return function Lr(e){return!0===e.value?null:{required:!0}}(n)}static email(n){return function na(e){return kr(e.value)||kl.test(e.value)?null:{email:!0}}(n)}static minLength(n){return function pn(e){return n=>kr(n.value)||!mm(n.value)?null:n.value.length<e?{minlength:{requiredLength:e,actualLength:n.value.length}}:null}(n)}static maxLength(n){return function at(e){return n=>mm(n.value)&&n.value.length>e?{maxlength:{requiredLength:e,actualLength:n.value.length}}:null}(n)}static pattern(n){return function wr(e){if(!e)return ia;let n,t;return"string"==typeof e?(t="","^"!==e.charAt(0)&&(t+="^"),t+=e,"$"!==e.charAt(e.length-1)&&(t+="$"),n=new RegExp(t)):(t=e.toString(),n=e),o=>{if(kr(o.value))return null;const c=o.value;return n.test(c)?null:{pattern:{requiredPattern:t,actualValue:c}}}}(n)}static nullValidator(n){return null}static compose(n){return q3(n)}static composeAsync(n){return K3(n)}}function ia(e){return null}function Ns(e){return null!=e}function nT(e){return fd(e)?Mi(e):e}function G3(e){let n={};return e.forEach(t=>{n=null!=t?{...n,...t}:n}),0===Object.keys(n).length?null:n}function W3(e,n){return n.map(t=>t(e))}function z3(e){return e.map(n=>function T6(e){return!e.validate}(n)?n:t=>n.validate(t))}function q3(e){if(!e)return null;const n=e.filter(Ns);return 0==n.length?null:function(t){return G3(W3(t,n))}}function Z2(e){return null!=e?q3(z3(e)):null}function K3(e){if(!e)return null;const n=e.filter(Ns);return 0==n.length?null:function(t){return function ut(...e){const n=_p(e),{args:t,keys:o}=Ht(e),c=new Ln(u=>{const{length:f}=t;if(!f)return void u.complete();const _=new Array(f);let v=f,S=f;for(let R=0;R<f;R++){let k=!1;qi(t[R]).subscribe(Jn(u,U=>{k||(k=!0,S--),_[R]=U},()=>v--,void 0,()=>{(!v||!k)&&(S||u.next(o?Le(o,_):_),u.complete())}))}});return n?c.pipe(ge(n)):c}(W3(t,n).map(nT)).pipe(mn(G3))}}function eF(e){return null!=e?K3(z3(e)):null}function Y3(e,n){return null===e?[n]:Array.isArray(e)?[...e,n]:[e,n]}function $3(e){return e._rawValidators}function X3(e){return e._rawAsyncValidators}function tF(e){return e?Array.isArray(e)?e:[e]:[]}function nP(e,n){return Array.isArray(e)?e.includes(n):e===n}function J3(e,n){const t=tF(n);return tF(e).forEach(c=>{nP(t,c)||t.push(c)}),t}function Q3(e,n){return tF(n).filter(t=>!nP(e,t))}class Z3{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=Z2(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=eF(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,t){return!!this.control&&this.control.hasError(n,t)}getError(n,t){return this.control?this.control.getError(n,t):null}}class ls extends Z3{get formDirective(){return null}get path(){return null}}class Qd extends Z3{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class eB{constructor(n){this._cd=n}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let tB=(()=>{class e extends eB{constructor(t){super(t)}static#e=this.\u0275fac=function(o){return new(o||e)(re(Qd,2))};static#t=this.\u0275dir=Ge({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(o,c){2&o&&Vt("ng-untouched",c.isUntouched)("ng-touched",c.isTouched)("ng-pristine",c.isPristine)("ng-dirty",c.isDirty)("ng-valid",c.isValid)("ng-invalid",c.isInvalid)("ng-pending",c.isPending)},features:[Ne]})}return e})(),nB=(()=>{class e extends eB{constructor(t){super(t)}static#e=this.\u0275fac=function(o){return new(o||e)(re(ls,10))};static#t=this.\u0275dir=Ge({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(o,c){2&o&&Vt("ng-untouched",c.isUntouched)("ng-touched",c.isTouched)("ng-pristine",c.isPristine)("ng-dirty",c.isDirty)("ng-valid",c.isValid)("ng-invalid",c.isInvalid)("ng-pending",c.isPending)("ng-submitted",c.isSubmitted)},features:[Ne]})}return e})();const iT="VALID",rP="INVALID",Nv="PENDING",rT="DISABLED";function rF(e){return(oP(e)?e.validators:e)||null}function oF(e,n){return(oP(n)?n.asyncValidators:e)||null}function oP(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}function rB(e,n,t){const o=e.controls;if(!(n?Object.keys(o):o).length)throw new ue(1e3,"");if(!o[t])throw new ue(1001,"")}function oB(e,n,t){e._forEachChild((o,c)=>{if(void 0===t[c])throw new ue(1002,"")})}class sP{constructor(n,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(n),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get valid(){return this.status===iT}get invalid(){return this.status===rP}get pending(){return this.status==Nv}get disabled(){return this.status===rT}get enabled(){return this.status!==rT}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(J3(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(J3(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(Q3(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(Q3(n,this._rawAsyncValidators))}hasValidator(n){return nP(this._rawValidators,n)}hasAsyncValidator(n){return nP(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){this.touched=!0,this._parent&&!n.onlySelf&&this._parent.markAsTouched(n)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(n=>n.markAllAsTouched())}markAsUntouched(n={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}markAsDirty(n={}){this.pristine=!1,this._parent&&!n.onlySelf&&this._parent.markAsDirty(n)}markAsPristine(n={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}markAsPending(n={}){this.status=Nv,!1!==n.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!n.onlySelf&&this._parent.markAsPending(n)}disable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=rT,this.errors=null,this._forEachChild(o=>{o.disable({...n,onlySelf:!0})}),this._updateValue(),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...n,skipPristineCheck:t}),this._onDisabledChange.forEach(o=>o(!0))}enable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=iT,this._forEachChild(o=>{o.enable({...n,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors({...n,skipPristineCheck:t}),this._onDisabledChange.forEach(o=>o(!1))}_updateAncestors(n){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===iT||this.status===Nv)&&this._runAsyncValidator(n.emitEvent)),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(n)}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?rT:iT}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n){if(this.asyncValidator){this.status=Nv,this._hasOwnPendingAsyncValidator=!0;const t=nT(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(o=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(o,{emitEvent:n})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(n,t={}){this.errors=n,this._updateControlsErrors(!1!==t.emitEvent)}get(n){let t=n;return null==t||(Array.isArray(t)||(t=t.split(".")),0===t.length)?null:t.reduce((o,c)=>o&&o._find(c),this)}getError(n,t){const o=t?this.get(t):this;return o&&o.errors?o.errors[n]:null}hasError(n,t){return!!this.getError(n,t)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(n)}_initObservables(){this.valueChanges=new Zt,this.statusChanges=new Zt}_calculateStatus(){return this._allControlsDisabled()?rT:this.errors?rP:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Nv)?Nv:this._anyControlsHaveStatus(rP)?rP:iT}_anyControlsHaveStatus(n){return this._anyControls(t=>t.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n={}){this.pristine=!this._anyControlsDirty(),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}_updateTouched(n={}){this.touched=this._anyControlsTouched(),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){oP(n)&&null!=n.updateOn&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){return!n&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=function A6(e){return Array.isArray(e)?Z2(e):e||null}(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=function D6(e){return Array.isArray(e)?eF(e):e||null}(this._rawAsyncValidators)}}class oT extends sP{constructor(n,t,o){super(rF(t),oF(o,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(n,t){return this.controls[n]?this.controls[n]:(this.controls[n]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(n,t,o={}){this.registerControl(n,t),this.updateValueAndValidity({emitEvent:o.emitEvent}),this._onCollectionChange()}removeControl(n,t={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(n,t,o={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],t&&this.registerControl(n,t),this.updateValueAndValidity({emitEvent:o.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,t={}){oB(this,0,n),Object.keys(n).forEach(o=>{rB(this,!0,o),this.controls[o].setValue(n[o],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){null!=n&&(Object.keys(n).forEach(o=>{const c=this.controls[o];c&&c.patchValue(n[o],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n={},t={}){this._forEachChild((o,c)=>{o.reset(n?n[c]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(n,t,o)=>(n[o]=t.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(t,o)=>!!o._syncPendingControls()||t);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(t=>{const o=this.controls[t];o&&n(o,t)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(const[t,o]of Object.entries(this.controls))if(this.contains(t)&&n(o))return!0;return!1}_reduceValue(){return this._reduceChildren({},(t,o,c)=>((o.enabled||this.disabled)&&(t[c]=o.value),t))}_reduceChildren(n,t){let o=n;return this._forEachChild((c,u)=>{o=t(o,c,u)}),o}_allControlsDisabled(){for(const n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}}class sB extends oT{}const Pv=new De("CallSetDisabledState",{providedIn:"root",factory:()=>aP}),aP="always";function sT(e,n,t=aP){sF(e,n),n.valueAccessor.writeValue(e.value),(e.disabled||"always"===t)&&n.valueAccessor.setDisabledState?.(e.disabled),function N6(e,n){n.valueAccessor.registerOnChange(t=>{e._pendingValue=t,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&aB(e,n)})}(e,n),function x6(e,n){const t=(o,c)=>{n.valueAccessor.writeValue(o),c&&n.viewToModelUpdate(o)};e.registerOnChange(t),n._registerOnDestroy(()=>{e._unregisterOnChange(t)})}(e,n),function P6(e,n){n.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&aB(e,n),"submit"!==e.updateOn&&e.markAsTouched()})}(e,n),function O6(e,n){if(n.valueAccessor.setDisabledState){const t=o=>{n.valueAccessor.setDisabledState(o)};e.registerOnDisabledChange(t),n._registerOnDestroy(()=>{e._unregisterOnDisabledChange(t)})}}(e,n)}function lP(e,n,t=!0){const o=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(o),n.valueAccessor.registerOnTouched(o)),uP(e,n),e&&(n._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function dP(e,n){e.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(n)})}function sF(e,n){const t=$3(e);null!==n.validator?e.setValidators(Y3(t,n.validator)):"function"==typeof t&&e.setValidators([t]);const o=X3(e);null!==n.asyncValidator?e.setAsyncValidators(Y3(o,n.asyncValidator)):"function"==typeof o&&e.setAsyncValidators([o]);const c=()=>e.updateValueAndValidity();dP(n._rawValidators,c),dP(n._rawAsyncValidators,c)}function uP(e,n){let t=!1;if(null!==e){if(null!==n.validator){const c=$3(e);if(Array.isArray(c)&&c.length>0){const u=c.filter(f=>f!==n.validator);u.length!==c.length&&(t=!0,e.setValidators(u))}}if(null!==n.asyncValidator){const c=X3(e);if(Array.isArray(c)&&c.length>0){const u=c.filter(f=>f!==n.asyncValidator);u.length!==c.length&&(t=!0,e.setAsyncValidators(u))}}}const o=()=>{};return dP(n._rawValidators,o),dP(n._rawAsyncValidators,o),t}function aB(e,n){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function cB(e,n){sF(e,n)}function lB(e,n){e._syncPendingControls(),n.forEach(t=>{const o=t.control;"submit"===o.updateOn&&o._pendingChange&&(t.viewToModelUpdate(o._pendingValue),o._pendingChange=!1)})}const U6={provide:ls,useExisting:Cn(()=>hP)},aT=(()=>Promise.resolve())();let hP=(()=>{class e extends ls{constructor(t,o,c){super(),this.callSetDisabledState=c,this.submitted=!1,this._directives=new Set,this.ngSubmit=new Zt,this.form=new oT({},Z2(t),eF(o))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){aT.then(()=>{const o=this._findContainer(t.path);t.control=o.registerControl(t.name,t.control),sT(t.control,t,this.callSetDisabledState),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){aT.then(()=>{const o=this._findContainer(t.path);o&&o.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){aT.then(()=>{const o=this._findContainer(t.path),c=new oT({});cB(c,t),o.registerControl(t.name,c),c.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){aT.then(()=>{const o=this._findContainer(t.path);o&&o.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,o){aT.then(()=>{this.form.get(t.path).setValue(o)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submitted=!0,lB(this.form,this._directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}static#e=this.\u0275fac=function(o){return new(o||e)(re(Wi,10),re(zi,10),re(Pv,8))};static#t=this.\u0275dir=Ge({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(o,c){1&o&&en("submit",function(f){return c.onSubmit(f)})("reset",function(){return c.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Lt([U6]),Ne]})}return e})();function dB(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}function uB(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const cT=class extends sP{constructor(n=null,t,o){super(rF(t),oF(o,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(n),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),oP(t)&&(t.nonNullable||t.initialValueIsDefault)&&(this.defaultValue=uB(n)?n.value:n)}setValue(n,t={}){this.value=this._pendingValue=n,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(o=>o(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(n,t={}){this.setValue(n,t)}reset(n=this.defaultValue,t={}){this._applyFormState(n),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){dB(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){dB(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(n){uB(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}};let _B=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275dir=Ge({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}return e})(),EB=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({})}return e})();const dF=new De("NgModelWithFormControlWarning"),K6={provide:ls,useExisting:Cn(()=>lT)};let lT=(()=>{class e extends ls{constructor(t,o,c){super(),this.callSetDisabledState=c,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Zt,this._setValidators(t),this._setAsyncValidators(o)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(uP(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){const o=this.form.get(t.path);return sT(o,t,this.callSetDisabledState),o.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),o}getControl(t){return this.form.get(t.path)}removeControl(t){lP(t.control||null,t,!1),function F6(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,o){this.form.get(t.path).setValue(o)}onSubmit(t){return this.submitted=!0,lB(this.form,this.directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submitted=!1}_updateDomValue(){this.directives.forEach(t=>{const o=t.control,c=this.form.get(t.path);o!==c&&(lP(o||null,t),(e=>e instanceof cT)(c)&&(sT(c,t,this.callSetDisabledState),t.control=c))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){const o=this.form.get(t.path);cB(o,t),o.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){const o=this.form.get(t.path);o&&function M6(e,n){return uP(e,n)}(o,t)&&o.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){sF(this.form,this),this._oldForm&&uP(this._oldForm,this)}_checkFormPresent(){}static#e=this.\u0275fac=function(o){return new(o||e)(re(Wi,10),re(zi,10),re(Pv,8))};static#t=this.\u0275dir=Ge({type:e,selectors:[["","formGroup",""]],hostBindings:function(o,c){1&o&&en("submit",function(f){return c.onSubmit(f)})("reset",function(){return c.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Lt([K6]),Ne,jo]})}return e})();const X6={provide:Qd,useExisting:Cn(()=>pF)};let pF=(()=>{class e extends Qd{set isDisabled(t){}static#e=this._ngModelWarningSentOnce=!1;constructor(t,o,c,u,f){super(),this._ngModelWarningConfig=f,this._added=!1,this.name=null,this.update=new Zt,this._ngModelWarningSent=!1,this._parent=t,this._setValidators(o),this._setAsyncValidators(c),this.valueAccessor=function lF(e,n){if(!n)return null;let t,o,c;return Array.isArray(n),n.forEach(u=>{u.constructor===sr?t=u:function L6(e){return Object.getPrototypeOf(e.constructor)===I}(u)?o=u:c=u}),c||o||t||null}(0,u)}ngOnChanges(t){this._added||this._setUpControl(),function cF(e,n){if(!e.hasOwnProperty("model"))return!1;const t=e.model;return!!t.isFirstChange()||!Object.is(n,t.currentValue)}(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return function cP(e,n){return[...n.path,e]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}static#t=this.\u0275fac=function(o){return new(o||e)(re(ls,13),re(Wi,10),re(zi,10),re(F,10),re(dF,8))};static#n=this.\u0275dir=Ge({type:e,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[Lt([X6]),Ne,jo]})}return e})(),u8=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({imports:[EB]})}return e})();class xB extends sP{constructor(n,t,o){super(rF(t),oF(o,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(n){return this.controls[this._adjustIndex(n)]}push(n,t={}){this.controls.push(n),this._registerControl(n),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(n,t,o={}){this.controls.splice(n,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:o.emitEvent})}removeAt(n,t={}){let o=this._adjustIndex(n);o<0&&(o=0),this.controls[o]&&this.controls[o]._registerOnCollectionChange(()=>{}),this.controls.splice(o,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(n,t,o={}){let c=this._adjustIndex(n);c<0&&(c=0),this.controls[c]&&this.controls[c]._registerOnCollectionChange(()=>{}),this.controls.splice(c,1),t&&(this.controls.splice(c,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:o.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,t={}){oB(this,0,n),n.forEach((o,c)=>{rB(this,!1,c),this.at(c).setValue(o,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){null!=n&&(n.forEach((o,c)=>{this.at(c)&&this.at(c).patchValue(o,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n=[],t={}){this._forEachChild((o,c)=>{o.reset(n[c],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(n=>n.getRawValue())}clear(n={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_adjustIndex(n){return n<0?n+this.length:n}_syncPendingControls(){let n=this.controls.reduce((t,o)=>!!o._syncPendingControls()||t,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){this.controls.forEach((t,o)=>{n(t,o)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(t=>t.enabled&&n(t))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_allControlsDisabled(){for(const n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}_find(n){return this.at(n)??null}}function MB(e){return!!e&&(void 0!==e.asyncValidators||void 0!==e.validators||void 0!==e.updateOn)}let EF,h8=(()=>{class e{constructor(){this.useNonNullable=!1}get nonNullable(){const t=new e;return t.useNonNullable=!0,t}group(t,o=null){const c=this._reduceControls(t);let u={};return MB(o)?u=o:null!==o&&(u.validators=o.validator,u.asyncValidators=o.asyncValidator),new oT(c,u)}record(t,o=null){const c=this._reduceControls(t);return new sB(c,o)}control(t,o,c){let u={};return this.useNonNullable?(MB(o)?u=o:(u.validators=o,u.asyncValidators=c),new cT(t,{...u,nonNullable:!0})):new cT(t,o,c)}array(t,o,c){const u=t.map(f=>this._createControl(f));return new xB(u,o,c)}_reduceControls(t){const o={};return Object.keys(t).forEach(c=>{o[c]=this._createControl(t[c])}),o}_createControl(t){return t instanceof cT||t instanceof sP?t:Array.isArray(t)?this.control(t[0],t.length>1?t[1]:null,t.length>2?t[2]:null):this.control(t)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),p8=(()=>{class e extends h8{group(t,o=null){return super.group(t,o)}control(t,o,c){return super.control(t,o,c)}array(t,o,c){return super.array(t,o,c)}static#e=this.\u0275fac=function(){let t;return function(c){return(t||(t=Ti(e)))(c||e)}}();static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),f8=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:dF,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:Pv,useValue:t.callSetDisabledState??aP}]}}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({imports:[u8]})}return e})();try{EF=typeof Intl<"u"&&Intl.v8BreakIterator}catch{EF=!1}let xv,no=(()=>{class e{constructor(t){this._platformId=t,this.isBrowser=this._platformId?function DN(e){return e===L0}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!EF)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}static#e=this.\u0275fac=function(o){return new(o||e)(fe(nl))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const kB=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function LB(){if(xv)return xv;if("object"!=typeof document||!document)return xv=new Set(kB),xv;let e=document.createElement("input");return xv=new Set(kB.filter(n=>(e.setAttribute("type",n),e.type===n))),xv}let dT,gm,vF;function Mv(e){return function m8(){if(null==dT&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>dT=!0}))}finally{dT=dT||!1}return dT}()?e:!!e.capture}function _8(){if(null==gm){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return gm=!1,gm;if("scrollBehavior"in document.documentElement.style)gm=!0;else{const e=Element.prototype.scrollTo;gm=!!e&&!/\{\s*\[native code\]\s*\}/.test(e.toString())}}return gm}function Jh(e){return e.composedPath?e.composedPath()[0]:e.target}function yF(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function ra(e,n){return hi((t,o)=>{let c=0;t.subscribe(Jn(o,u=>e.call(n,u,c++)&&o.next(u)))})}function FB(e){return ra((n,t)=>e<=t)}function No(e){return hi((n,t)=>{qi(e).subscribe(Jn(t,()=>t.complete(),Mm)),!t.closed&&n.subscribe(t)})}function oa(e){return null!=e&&"false"!=`${e}`}function bF(e,n=0){return function I8(e){return!isNaN(parseFloat(e))&&!isNaN(Number(e))}(e)?Number(e):n}function fP(e){return Array.isArray(e)?e:[e]}function ar(e){return null==e?"":"string"==typeof e?e:`${e}px`}function Qh(e){return e instanceof bn?e.nativeElement:e}let R8=(()=>{class e{create(t){return typeof MutationObserver>"u"?null:new MutationObserver(t)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),UB=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({providers:[R8]})}return e})();function mP(...e){const n=gp(e),t=_p(e),{args:o,keys:c}=Ht(e);if(0===o.length)return Mi([],n);const u=new Ln(function A8(e,n,t=Ka){return o=>{VB(n,()=>{const{length:c}=e,u=new Array(c);let f=c,_=c;for(let v=0;v<c;v++)VB(n,()=>{const S=Mi(e[v],n);let R=!1;S.subscribe(Jn(o,k=>{u[v]=k,R||(R=!0,_--),_||o.next(t(u.slice()))},()=>{--f||o.complete()}))},o)},o)}}(o,n,c?f=>Le(c,f):Ka));return t?u.pipe(ge(t)):u}function VB(e,n,t){e?$a(t,e,n):n()}function _P(...e){return function D8(){return ds(1)}()(Mi(e,gp(e)))}function Zd(e){return e<=0?()=>ks:hi((n,t)=>{let o=0;n.subscribe(Jn(t,c=>{++o<=e&&(t.next(c),e<=o&&t.complete())}))})}class O8 extends kn{constructor(n,t){super()}schedule(n,t=0){return this}}const gP={setInterval(e,n,...t){const{delegate:o}=gP;return o?.setInterval?o.setInterval(e,n,...t):setInterval(e,n,...t)},clearInterval(e){const{delegate:n}=gP;return(n?.clearInterval||clearInterval)(e)},delegate:void 0};class SF extends O8{constructor(n,t){super(n,t),this.scheduler=n,this.work=t,this.pending=!1}schedule(n,t=0){var o;if(this.closed)return this;this.state=n;const c=this.id,u=this.scheduler;return null!=c&&(this.id=this.recycleAsyncId(u,c,t)),this.pending=!0,this.delay=t,this.id=null!==(o=this.id)&&void 0!==o?o:this.requestAsyncId(u,this.id,t),this}requestAsyncId(n,t,o=0){return gP.setInterval(n.flush.bind(n,this),o)}recycleAsyncId(n,t,o=0){if(null!=o&&this.delay===o&&!1===this.pending)return t;null!=t&&gP.clearInterval(t)}execute(n,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const o=this._execute(n,t);if(o)return o;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,t){let c,o=!1;try{this.work(n)}catch(u){o=!0,c=u||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),c}unsubscribe(){if(!this.closed){const{id:n,scheduler:t}=this,{actions:o}=t;this.work=this.state=this.scheduler=null,this.pending=!1,ha(o,this),null!=n&&(this.id=this.recycleAsyncId(t,n,null)),this.delay=null,super.unsubscribe()}}}const CF={now:()=>(CF.delegate||Date).now(),delegate:void 0};class uT{constructor(n,t=uT.now){this.schedulerActionCtor=n,this.now=t}schedule(n,t=0,o){return new this.schedulerActionCtor(this,n).schedule(o,t)}}uT.now=CF.now;class TF extends uT{constructor(n,t=uT.now){super(n,t),this.actions=[],this._active=!1}flush(n){const{actions:t}=this;if(this._active)return void t.push(n);let o;this._active=!0;do{if(o=n.execute(n.state,n.delay))break}while(n=t.shift());if(this._active=!1,o){for(;n=t.shift();)n.unsubscribe();throw o}}}const wF=new TF(SF),N8=wF;function BB(...e){const n=gp(e);return hi((t,o)=>{(n?_P(e,t,n):_P(e,t)).subscribe(o)})}const jB=new Set;let Em,x8=(()=>{class e{constructor(t,o){this._platform=t,this._nonce=o,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):k8}matchMedia(t){return(this._platform.WEBKIT||this._platform.BLINK)&&function M8(e,n){if(!jB.has(e))try{Em||(Em=document.createElement("style"),n&&(Em.nonce=n),Em.setAttribute("type","text/css"),document.head.appendChild(Em)),Em.sheet&&(Em.sheet.insertRule(`@media ${e} {body{ }}`,0),jB.add(e))}catch(t){console.error(t)}}(t,this._nonce),this._matchMedia(t)}static#e=this.\u0275fac=function(o){return new(o||e)(fe(no),fe(Ub,8))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function k8(e){return{matches:"all"===e||""===e,media:e,addListener:()=>{},removeListener:()=>{}}}let L8=(()=>{class e{constructor(t,o){this._mediaMatcher=t,this._zone=o,this._queries=new Map,this._destroySubject=new rn}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(t){return HB(fP(t)).some(c=>this._registerQuery(c).mql.matches)}observe(t){let u=mP(HB(fP(t)).map(f=>this._registerQuery(f).observable));return u=_P(u.pipe(Zd(1)),u.pipe(FB(1),function P8(e,n=wF){return hi((t,o)=>{let c=null,u=null,f=null;const _=()=>{if(c){c.unsubscribe(),c=null;const S=u;u=null,o.next(S)}};function v(){const S=f+e,R=n.now();if(R<S)return c=this.schedule(void 0,S-R),void o.add(c);_()}t.subscribe(Jn(o,S=>{u=S,f=n.now(),c||(c=n.schedule(v,e),o.add(c))},()=>{_(),o.complete()},void 0,()=>{u=c=null}))})}(0))),u.pipe(mn(f=>{const _={matches:!1,breakpoints:{}};return f.forEach(({matches:v,query:S})=>{_.matches=_.matches||v,_.breakpoints[S]=v}),_}))}_registerQuery(t){if(this._queries.has(t))return this._queries.get(t);const o=this._mediaMatcher.matchMedia(t),u={observable:new Ln(f=>{const _=v=>this._zone.run(()=>f.next(v));return o.addListener(_),()=>{o.removeListener(_)}}).pipe(BB(o),mn(({matches:f})=>({query:t,matches:f})),No(this._destroySubject)),mql:o};return this._queries.set(t,u),u}static#e=this.\u0275fac=function(o){return new(o||e)(fe(x8),fe(lt))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function HB(e){return e.map(n=>n.split(",")).reduce((n,t)=>n.concat(t)).map(n=>n.trim())}function EP(e,n){return(e.getAttribute(n)||"").match(/\S+/g)||[]}const WB="cdk-describedby-message",vP="cdk-describedby-host";let IF=0,V8=(()=>{class e{constructor(t,o){this._platform=o,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+IF++,this._document=t,this._id=Oe(qu)+"-"+IF++}describe(t,o,c){if(!this._canBeDescribed(t,o))return;const u=RF(o,c);"string"!=typeof o?(zB(o,this._id),this._messageRegistry.set(u,{messageElement:o,referenceCount:0})):this._messageRegistry.has(u)||this._createMessageElement(o,c),this._isElementDescribedByMessage(t,u)||this._addMessageReference(t,u)}removeDescription(t,o,c){if(!o||!this._isElementNode(t))return;const u=RF(o,c);if(this._isElementDescribedByMessage(t,u)&&this._removeMessageReference(t,u),"string"==typeof o){const f=this._messageRegistry.get(u);f&&0===f.referenceCount&&this._deleteMessageElement(u)}0===this._messagesContainer?.childNodes.length&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){const t=this._document.querySelectorAll(`[${vP}="${this._id}"]`);for(let o=0;o<t.length;o++)this._removeCdkDescribedByReferenceIds(t[o]),t[o].removeAttribute(vP);this._messagesContainer?.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(t,o){const c=this._document.createElement("div");zB(c,this._id),c.textContent=t,o&&c.setAttribute("role",o),this._createMessagesContainer(),this._messagesContainer.appendChild(c),this._messageRegistry.set(RF(t,o),{messageElement:c,referenceCount:0})}_deleteMessageElement(t){this._messageRegistry.get(t)?.messageElement?.remove(),this._messageRegistry.delete(t)}_createMessagesContainer(){if(this._messagesContainer)return;const t="cdk-describedby-message-container",o=this._document.querySelectorAll(`.${t}[platform="server"]`);for(let u=0;u<o.length;u++)o[u].remove();const c=this._document.createElement("div");c.style.visibility="hidden",c.classList.add(t),c.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&c.setAttribute("platform","server"),this._document.body.appendChild(c),this._messagesContainer=c}_removeCdkDescribedByReferenceIds(t){const o=EP(t,"aria-describedby").filter(c=>0!=c.indexOf(WB));t.setAttribute("aria-describedby",o.join(" "))}_addMessageReference(t,o){const c=this._messageRegistry.get(o);(function F8(e,n,t){const o=EP(e,n);o.some(c=>c.trim()==t.trim())||(o.push(t.trim()),e.setAttribute(n,o.join(" ")))})(t,"aria-describedby",c.messageElement.id),t.setAttribute(vP,this._id),c.referenceCount++}_removeMessageReference(t,o){const c=this._messageRegistry.get(o);c.referenceCount--,function U8(e,n,t){const c=EP(e,n).filter(u=>u!=t.trim());c.length?e.setAttribute(n,c.join(" ")):e.removeAttribute(n)}(t,"aria-describedby",c.messageElement.id),t.removeAttribute(vP)}_isElementDescribedByMessage(t,o){const c=EP(t,"aria-describedby"),u=this._messageRegistry.get(o),f=u&&u.messageElement.id;return!!f&&-1!=c.indexOf(f)}_canBeDescribed(t,o){if(!this._isElementNode(t))return!1;if(o&&"object"==typeof o)return!0;const c=null==o?"":`${o}`.trim(),u=t.getAttribute("aria-label");return!(!c||u&&u.trim()===c)}_isElementNode(t){return t.nodeType===this._document.ELEMENT_NODE}static#e=this.\u0275fac=function(o){return new(o||e)(fe(Kt),fe(no))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function RF(e,n){return"string"==typeof e?`${n||""}/${e}`:e}function zB(e,n){e.id||(e.id=`${WB}-${n}-${IF++}`)}function KB(e){return 0===e.buttons||0===e.offsetX&&0===e.offsetY}function YB(e){const n=e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0];return!(!n||-1!==n.identifier||null!=n.radiusX&&1!==n.radiusX||null!=n.radiusY&&1!==n.radiusY)}const z8=new De("cdk-input-modality-detector-options"),q8={ignoreKeys:[18,17,224,91,16]},kv=Mv({passive:!0,capture:!0});let K8=(()=>{class e{get mostRecentModality(){return this._modality.value}constructor(t,o,c,u){this._platform=t,this._mostRecentTarget=null,this._modality=new ro(null),this._lastTouchMs=0,this._onKeydown=f=>{this._options?.ignoreKeys?.some(_=>_===f.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Jh(f))},this._onMousedown=f=>{Date.now()-this._lastTouchMs<650||(this._modality.next(KB(f)?"keyboard":"mouse"),this._mostRecentTarget=Jh(f))},this._onTouchstart=f=>{YB(f)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Jh(f))},this._options={...q8,...u},this.modalityDetected=this._modality.pipe(FB(1)),this.modalityChanged=this.modalityDetected.pipe(oy()),t.isBrowser&&o.runOutsideAngular(()=>{c.addEventListener("keydown",this._onKeydown,kv),c.addEventListener("mousedown",this._onMousedown,kv),c.addEventListener("touchstart",this._onTouchstart,kv)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,kv),document.removeEventListener("mousedown",this._onMousedown,kv),document.removeEventListener("touchstart",this._onTouchstart,kv))}static#e=this.\u0275fac=function(o){return new(o||e)(fe(no),fe(lt),fe(Kt),fe(z8,8))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const $8=new De("cdk-focus-monitor-default-options"),yP=Mv({passive:!0,capture:!0});let AF=(()=>{class e{constructor(t,o,c,u,f){this._ngZone=t,this._platform=o,this._inputModalityDetector=c,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new rn,this._rootNodeFocusAndBlurListener=_=>{for(let S=Jh(_);S;S=S.parentElement)"focus"===_.type?this._onFocus(_,S):this._onBlur(_,S)},this._document=u,this._detectionMode=f?.detectionMode||0}monitor(t,o=!1){const c=Qh(t);if(!this._platform.isBrowser||1!==c.nodeType)return He();const u=function E8(e){if(function g8(){if(null==vF){const e=typeof document<"u"?document.head:null;vF=!(!e||!e.createShadowRoot&&!e.attachShadow)}return vF}()){const n=e.getRootNode?e.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&n instanceof ShadowRoot)return n}return null}(c)||this._getDocument(),f=this._elementInfo.get(c);if(f)return o&&(f.checkChildren=!0),f.subject;const _={checkChildren:o,subject:new rn,rootNode:u};return this._elementInfo.set(c,_),this._registerGlobalListeners(_),_.subject}stopMonitoring(t){const o=Qh(t),c=this._elementInfo.get(o);c&&(c.subject.complete(),this._setClasses(o),this._elementInfo.delete(o),this._removeGlobalListeners(c))}focusVia(t,o,c){const u=Qh(t);u===this._getDocument().activeElement?this._getClosestElementsInfo(u).forEach(([_,v])=>this._originChanged(_,o,v)):(this._setOrigin(o),"function"==typeof u.focus&&u.focus(c))}ngOnDestroy(){this._elementInfo.forEach((t,o)=>this.stopMonitoring(o))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(t){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(t)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:t&&this._isLastInteractionFromInputLabel(t)?"mouse":"program"}_shouldBeAttributedToTouch(t){return 1===this._detectionMode||!!t?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(t,o){t.classList.toggle("cdk-focused",!!o),t.classList.toggle("cdk-touch-focused","touch"===o),t.classList.toggle("cdk-keyboard-focused","keyboard"===o),t.classList.toggle("cdk-mouse-focused","mouse"===o),t.classList.toggle("cdk-program-focused","program"===o)}_setOrigin(t,o=!1){this._ngZone.runOutsideAngular(()=>{this._origin=t,this._originFromTouchInteraction="touch"===t&&o,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(t,o){const c=this._elementInfo.get(o),u=Jh(t);!c||!c.checkChildren&&o!==u||this._originChanged(o,this._getFocusOrigin(u),c)}_onBlur(t,o){const c=this._elementInfo.get(o);!c||c.checkChildren&&t.relatedTarget instanceof Node&&o.contains(t.relatedTarget)||(this._setClasses(o),this._emitOrigin(c,null))}_emitOrigin(t,o){t.subject.observers.length&&this._ngZone.run(()=>t.subject.next(o))}_registerGlobalListeners(t){if(!this._platform.isBrowser)return;const o=t.rootNode,c=this._rootNodeFocusListenerCount.get(o)||0;c||this._ngZone.runOutsideAngular(()=>{o.addEventListener("focus",this._rootNodeFocusAndBlurListener,yP),o.addEventListener("blur",this._rootNodeFocusAndBlurListener,yP)}),this._rootNodeFocusListenerCount.set(o,c+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(No(this._stopInputModalityDetector)).subscribe(u=>{this._setOrigin(u,!0)}))}_removeGlobalListeners(t){const o=t.rootNode;if(this._rootNodeFocusListenerCount.has(o)){const c=this._rootNodeFocusListenerCount.get(o);c>1?this._rootNodeFocusListenerCount.set(o,c-1):(o.removeEventListener("focus",this._rootNodeFocusAndBlurListener,yP),o.removeEventListener("blur",this._rootNodeFocusAndBlurListener,yP),this._rootNodeFocusListenerCount.delete(o))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(t,o,c){this._setClasses(t,o),this._emitOrigin(c,o),this._lastFocusOrigin=o}_getClosestElementsInfo(t){const o=[];return this._elementInfo.forEach((c,u)=>{(u===t||c.checkChildren&&u.contains(t))&&o.push([u,c])}),o}_isLastInteractionFromInputLabel(t){const{_mostRecentTarget:o,mostRecentModality:c}=this._inputModalityDetector;if("mouse"!==c||!o||o===t||"INPUT"!==t.nodeName&&"TEXTAREA"!==t.nodeName||t.disabled)return!1;const u=t.labels;if(u)for(let f=0;f<u.length;f++)if(u[f].contains(o))return!0;return!1}static#e=this.\u0275fac=function(o){return new(o||e)(fe(lt),fe(no),fe(K8),fe(Kt,8),fe($8,8))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const XB="cdk-high-contrast-black-on-white",JB="cdk-high-contrast-white-on-black",DF="cdk-high-contrast-active";let QB=(()=>{class e{constructor(t,o){this._platform=t,this._document=o,this._breakpointSubscription=Oe(L8).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const t=this._document.createElement("div");t.style.backgroundColor="rgb(1,2,3)",t.style.position="absolute",this._document.body.appendChild(t);const o=this._document.defaultView||window,c=o&&o.getComputedStyle?o.getComputedStyle(t):null,u=(c&&c.backgroundColor||"").replace(/ /g,"");switch(t.remove(),u){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const t=this._document.body.classList;t.remove(DF,XB,JB),this._hasCheckedHighContrastMode=!0;const o=this.getHighContrastMode();1===o?t.add(DF,XB):2===o&&t.add(DF,JB)}}static#e=this.\u0275fac=function(o){return new(o||e)(fe(no),fe(Kt))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),X8=(()=>{class e{constructor(t){t._applyBodyHighContrastModeCssClasses()}static#e=this.\u0275fac=function(o){return new(o||e)(fe(QB))};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({imports:[UB]})}return e})();const J8=new De("cdk-dir-doc",{providedIn:"root",factory:function Q8(){return Oe(Kt)}}),Z8=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let OF=(()=>{class e{constructor(t){this.value="ltr",this.change=new Zt,t&&(this.value=function eH(e){const n=e?.toLowerCase()||"";return"auto"===n&&typeof navigator<"u"&&navigator?.language?Z8.test(navigator.language)?"rtl":"ltr":"rtl"===n?"rtl":"ltr"}((t.body?t.body.dir:null)||(t.documentElement?t.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}static#e=this.\u0275fac=function(o){return new(o||e)(fe(J8,8))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),hT=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({})}return e})();const nH=new De("mat-sanity-checks",{providedIn:"root",factory:function tH(){return!0}});let Wa=(()=>{class e{constructor(t,o,c){this._sanityChecks=o,this._document=c,this._hasDoneGlobalChecks=!1,t._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(t){return!yF()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[t])}static#e=this.\u0275fac=function(o){return new(o||e)(fe(QB),fe(nH,8),fe(Kt))};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({imports:[hT,hT]})}return e})();function tj(e){return class extends e{get disabled(){return this._disabled}set disabled(n){this._disabled=oa(n)}constructor(...n){super(...n),this._disabled=!1}}}function nj(e,n){return class extends e{get color(){return this._color}set color(t){const o=t||this.defaultColor;o!==this._color&&(this._color&&this._elementRef.nativeElement.classList.remove(`mat-${this._color}`),o&&this._elementRef.nativeElement.classList.add(`mat-${o}`),this._color=o)}constructor(...t){super(...t),this.defaultColor=n,this.color=n}}}function ij(e){return class extends e{get disableRipple(){return this._disableRipple}set disableRipple(n){this._disableRipple=oa(n)}constructor(...n){super(...n),this._disableRipple=!1}}}function iH(e,n=0){return class extends e{get tabIndex(){return this.disabled?-1:this._tabIndex}set tabIndex(t){this._tabIndex=null!=t?bF(t):this.defaultTabIndex}constructor(...t){super(...t),this._tabIndex=n,this.defaultTabIndex=n}}}function rH(e){return class extends e{updateErrorState(){const n=this.errorState,u=(this.errorStateMatcher||this._defaultErrorStateMatcher).isErrorState(this.ngControl?this.ngControl.control:null,this._parentFormGroup||this._parentForm);u!==n&&(this.errorState=u,this.stateChanges.next())}constructor(...n){super(...n),this.errorState=!1}}}let sH=(()=>{class e{isErrorState(t,o){return!!(t&&t.invalid&&(t.touched||o&&o.submitted))}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class aH{constructor(n,t,o,c=!1){this._renderer=n,this.element=t,this.config=o,this._animationForciblyDisabledThroughCss=c,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const rj=Mv({passive:!0,capture:!0});class cH{constructor(){this._events=new Map,this._delegateEventHandler=n=>{const t=Jh(n);t&&this._events.get(n.type)?.forEach((o,c)=>{(c===t||c.contains(t))&&o.forEach(u=>u.handleEvent(n))})}}addHandler(n,t,o,c){const u=this._events.get(t);if(u){const f=u.get(o);f?f.add(c):u.set(o,new Set([c]))}else this._events.set(t,new Map([[o,new Set([c])]])),n.runOutsideAngular(()=>{document.addEventListener(t,this._delegateEventHandler,rj)})}removeHandler(n,t,o){const c=this._events.get(n);if(!c)return;const u=c.get(t);u&&(u.delete(o),0===u.size&&c.delete(t),0===c.size&&(this._events.delete(n),document.removeEventListener(n,this._delegateEventHandler,rj)))}}const oj={enterDuration:225,exitDuration:150},sj=Mv({passive:!0,capture:!0}),aj=["mousedown","touchstart"],cj=["mouseup","mouseleave","touchend","touchcancel"];class bP{static#e=this._eventManager=new cH;constructor(n,t,o,c){this._target=n,this._ngZone=t,this._platform=c,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,c.isBrowser&&(this._containerElement=Qh(o))}fadeInRipple(n,t,o={}){const c=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),u={...oj,...o.animation};o.centered&&(n=c.left+c.width/2,t=c.top+c.height/2);const f=o.radius||function dH(e,n,t){const o=Math.max(Math.abs(e-t.left),Math.abs(e-t.right)),c=Math.max(Math.abs(n-t.top),Math.abs(n-t.bottom));return Math.sqrt(o*o+c*c)}(n,t,c),_=n-c.left,v=t-c.top,S=u.enterDuration,R=document.createElement("div");R.classList.add("mat-ripple-element"),R.style.left=_-f+"px",R.style.top=v-f+"px",R.style.height=2*f+"px",R.style.width=2*f+"px",null!=o.color&&(R.style.backgroundColor=o.color),R.style.transitionDuration=`${S}ms`,this._containerElement.appendChild(R);const k=window.getComputedStyle(R),G=k.transitionDuration,z="none"===k.transitionProperty||"0s"===G||"0s, 0s"===G||0===c.width&&0===c.height,X=new aH(this,R,o,z);R.style.transform="scale3d(1, 1, 1)",X.state=0,o.persistent||(this._mostRecentTransientRipple=X);let le=null;return!z&&(S||u.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const pe=()=>this._finishRippleTransition(X),ae=()=>this._destroyRipple(X);R.addEventListener("transitionend",pe),R.addEventListener("transitioncancel",ae),le={onTransitionEnd:pe,onTransitionCancel:ae}}),this._activeRipples.set(X,le),(z||!S)&&this._finishRippleTransition(X),X}fadeOutRipple(n){if(2===n.state||3===n.state)return;const t=n.element,o={...oj,...n.config.animation};t.style.transitionDuration=`${o.exitDuration}ms`,t.style.opacity="0",n.state=2,(n._animationForciblyDisabledThroughCss||!o.exitDuration)&&this._finishRippleTransition(n)}fadeOutAll(){this._getActiveRipples().forEach(n=>n.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(n=>{n.config.persistent||n.fadeOut()})}setupTriggerEvents(n){const t=Qh(n);!this._platform.isBrowser||!t||t===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=t,aj.forEach(o=>{bP._eventManager.addHandler(this._ngZone,o,t,this)}))}handleEvent(n){"mousedown"===n.type?this._onMousedown(n):"touchstart"===n.type?this._onTouchStart(n):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{cj.forEach(t=>{this._triggerElement.addEventListener(t,this,sj)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(n){0===n.state?this._startFadeOutTransition(n):2===n.state&&this._destroyRipple(n)}_startFadeOutTransition(n){const t=n===this._mostRecentTransientRipple,{persistent:o}=n.config;n.state=1,!o&&(!t||!this._isPointerDown)&&n.fadeOut()}_destroyRipple(n){const t=this._activeRipples.get(n)??null;this._activeRipples.delete(n),this._activeRipples.size||(this._containerRect=null),n===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),n.state=3,null!==t&&(n.element.removeEventListener("transitionend",t.onTransitionEnd),n.element.removeEventListener("transitioncancel",t.onTransitionCancel)),n.element.remove()}_onMousedown(n){const t=KB(n),o=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!t&&!o&&(this._isPointerDown=!0,this.fadeInRipple(n.clientX,n.clientY,this._target.rippleConfig))}_onTouchStart(n){if(!this._target.rippleDisabled&&!YB(n)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const t=n.changedTouches;if(t)for(let o=0;o<t.length;o++)this.fadeInRipple(t[o].clientX,t[o].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(n=>{!n.config.persistent&&(1===n.state||n.config.terminateOnPointerUp&&0===n.state)&&n.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const n=this._triggerElement;n&&(aj.forEach(t=>bP._eventManager.removeHandler(t,n,this)),this._pointerUpEventsRegistered&&cj.forEach(t=>n.removeEventListener(t,this,sj)))}}const lj=new De("mat-ripple-global-options");let dj=(()=>{class e{get disabled(){return this._disabled}set disabled(t){t&&this.fadeOutAllNonPersistent(),this._disabled=t,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(t){this._trigger=t,this._setupTriggerEventsIfEnabled()}constructor(t,o,c,u,f){this._elementRef=t,this._animationMode=f,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=u||{},this._rippleRenderer=new bP(this,o,t,c)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:{...this._globalOptions.animation,..."NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{},...this.animation},terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(t,o=0,c){return"number"==typeof t?this._rippleRenderer.fadeInRipple(t,o,{...this.rippleConfig,...c}):this._rippleRenderer.fadeInRipple(0,0,{...this.rippleConfig,...t})}static#e=this.\u0275fac=function(o){return new(o||e)(re(bn),re(lt),re(no),re(lj,8),re(Sa,8))};static#t=this.\u0275dir=Ge({type:e,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(o,c){2&o&&Vt("mat-ripple-unbounded",c.unbounded)},inputs:{color:["matRippleColor","color"],unbounded:["matRippleUnbounded","unbounded"],centered:["matRippleCentered","centered"],radius:["matRippleRadius","radius"],animation:["matRippleAnimation","animation"],disabled:["matRippleDisabled","disabled"],trigger:["matRippleTrigger","trigger"]},exportAs:["matRipple"]})}return e})(),uj=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({imports:[Wa,Wa]})}return e})();const hj={capture:!0},pj=["focus","click","mouseenter","touchstart"],NF="mat-ripple-loader-uninitialized",PF="mat-ripple-loader-class-name",fj="mat-ripple-loader-centered",SP="mat-ripple-loader-disabled";let uH=(()=>{class e{constructor(){this._document=Oe(Kt,{optional:!0}),this._animationMode=Oe(Sa,{optional:!0}),this._globalRippleOptions=Oe(lj,{optional:!0}),this._platform=Oe(no),this._ngZone=Oe(lt),this._onInteraction=t=>{if(!(t.target instanceof HTMLElement))return;const c=t.target.closest(`[${NF}]`);c&&this.createRipple(c)},this._ngZone.runOutsideAngular(()=>{for(const t of pj)this._document?.addEventListener(t,this._onInteraction,hj)})}ngOnDestroy(){for(const t of pj)this._document?.removeEventListener(t,this._onInteraction,hj)}configureRipple(t,o){t.setAttribute(NF,""),(o.className||!t.hasAttribute(PF))&&t.setAttribute(PF,o.className||""),o.centered&&t.setAttribute(fj,""),o.disabled&&t.setAttribute(SP,"")}getRipple(t){return t.matRipple?t.matRipple:this.createRipple(t)}setDisabled(t,o){const c=t.matRipple;c?c.disabled=o:o?t.setAttribute(SP,""):t.removeAttribute(SP)}createRipple(t){if(!this._document)return;t.querySelector(".mat-ripple")?.remove();const o=this._document.createElement("span");o.classList.add("mat-ripple",t.getAttribute(PF)),t.append(o);const c=new dj(new bn(o),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return c._isInitialized=!0,c.trigger=t,c.centered=t.hasAttribute(fj),c.disabled=t.hasAttribute(SP),this.attachRipple(t,c),c}attachRipple(t,o){t.removeAttribute(NF),t.matRipple=o}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const hH=["mat-button",""],pH=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],fH=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"],mH=[{selector:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{selector:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{selector:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{selector:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{selector:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{selector:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{selector:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],_H=nj(tj(ij(class{constructor(e){this._elementRef=e}})));let gH=(()=>{class e extends _H{get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(t){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,t)}get disableRipple(){return this._disableRipple}set disableRipple(t){this._disableRipple=oa(t),this._updateRippleDisabled()}get disabled(){return this._disabled}set disabled(t){this._disabled=oa(t),this._updateRippleDisabled()}constructor(t,o,c,u){super(t),this._platform=o,this._ngZone=c,this._animationMode=u,this._focusMonitor=Oe(AF),this._rippleLoader=Oe(uH),this._isFab=!1,this._disableRipple=!1,this._disabled=!1,this._rippleLoader?.configureRipple(this._elementRef.nativeElement,{className:"mat-mdc-button-ripple"});const f=t.nativeElement.classList;for(const _ of mH)this._hasHostAttributes(_.selector)&&_.mdcClasses.forEach(v=>{f.add(v)})}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(t="program",o){t?this._focusMonitor.focusVia(this._elementRef.nativeElement,t,o):this._elementRef.nativeElement.focus(o)}_hasHostAttributes(...t){return t.some(o=>this._elementRef.nativeElement.hasAttribute(o))}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}static#e=this.\u0275fac=function(o){ld()};static#t=this.\u0275dir=Ge({type:e,features:[Ne]})}return e})(),vH=(()=>{class e extends gH{constructor(t,o,c,u){super(t,o,c,u)}static#e=this.\u0275fac=function(o){return new(o||e)(re(bn),re(no),re(lt),re(Sa,8))};static#t=this.\u0275cmp=Ct({type:e,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:7,hostBindings:function(o,c){2&o&&(ii("disabled",c.disabled||null),Vt("_mat-animation-noopable","NoopAnimations"===c._animationMode)("mat-unthemed",!c.color)("mat-mdc-button-base",!0))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color"},exportAs:["matButton"],features:[Ne],attrs:hH,ngContentSelectors:fH,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(o,c){1&o&&(_d(pH),wt(0,"span",0),nr(1),Pe(2,"span",1),nr(3,1),Re(),nr(4,2),wt(5,"span",2)(6,"span",3)),2&o&&Vt("mdc-button__ripple",!c._isFab)("mdc-fab__ripple",c._isFab)},styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(\n      100% + 4px\n    );width:calc(\n      100% + 4px\n    );display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{height:var(--mdc-text-button-container-height, 36px);border-radius:var(--mdc-text-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color, inherit)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-unelevated-button{height:var(--mdc-filled-button-container-height, 36px);border-radius:var(--mdc-filled-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color, transparent)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color, rgba(0, 0, 0, 0.12))}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color, inherit)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-raised-button{height:var(--mdc-protected-button-container-height, 36px);border-radius:var(--mdc-protected-button-container-shape, var(--mdc-shape-small, 4px));box-shadow:var(--mdc-protected-button-container-elevation, 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color, transparent)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color, rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color, inherit)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-raised-button.mdc-ripple-upgraded--background-focused,.mat-mdc-raised-button:not(.mdc-ripple-upgraded):focus{box-shadow:var(--mdc-protected-button-focus-container-elevation, 0px 2px 4px -1px rgba(0, 0, 0, 0.2), 0px 4px 5px 0px rgba(0, 0, 0, 0.14), 0px 1px 10px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation, 0px 2px 4px -1px rgba(0, 0, 0, 0.2), 0px 4px 5px 0px rgba(0, 0, 0, 0.14), 0px 1px 10px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled):active{box-shadow:var(--mdc-protected-button-pressed-container-elevation, 0px 5px 5px -3px rgba(0, 0, 0, 0.2), 0px 8px 10px 1px rgba(0, 0, 0, 0.14), 0px 3px 14px 2px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation, 0px 0px 0px 0px rgba(0, 0, 0, 0.2), 0px 0px 0px 0px rgba(0, 0, 0, 0.14), 0px 0px 0px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button{height:var(--mdc-outlined-button-container-height, 36px);border-radius:var(--mdc-outlined-button-container-shape, var(--mdc-shape-small, 4px));padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width, 1px)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color, inherit)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color, rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color, rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width, 1px)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width, 1px));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width, 1px))}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0;background-color:var(--mat-mdc-button-persistent-ripple-color)}.mat-mdc-button .mat-ripple-element,.mat-mdc-unelevated-button .mat-ripple-element,.mat-mdc-raised-button .mat-ripple-element,.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-mdc-button-ripple-color)}.mat-mdc-button .mdc-button__label,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-outlined-button .mdc-button__label{z-index:1}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button[disabled],.mat-mdc-unelevated-button[disabled],.mat-mdc-raised-button[disabled],.mat-mdc-outlined-button[disabled]{cursor:default;pointer-events:none}.mat-mdc-button .mat-mdc-button-touch-target,.mat-mdc-unelevated-button .mat-mdc-button-touch-target,.mat-mdc-raised-button .mat-mdc-button-touch-target,.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}[dir=rtl] .mat-mdc-button>.mat-icon,.mat-mdc-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:0}.mat-mdc-button .mdc-button__label+.mat-icon{margin-left:8px;margin-right:0}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon,.mat-mdc-button .mdc-button__label+.mat-icon[dir=rtl]{margin-left:0;margin-right:8px}.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem;margin-left:-4px;margin-right:8px}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon,[dir=rtl] .mat-mdc-raised-button>.mat-icon,[dir=rtl] .mat-mdc-outlined-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon[dir=rtl],.mat-mdc-raised-button>.mat-icon[dir=rtl],.mat-mdc-outlined-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:0}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon,[dir=rtl] .mat-mdc-raised-button>.mat-icon,[dir=rtl] .mat-mdc-outlined-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon[dir=rtl],.mat-mdc-raised-button>.mat-icon[dir=rtl],.mat-mdc-outlined-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:-4px}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon,.mat-mdc-raised-button .mdc-button__label+.mat-icon,.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-left:8px;margin-right:-4px}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon,[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon,[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon,.mat-mdc-unelevated-button .mdc-button__label+.mat-icon[dir=rtl],.mat-mdc-raised-button .mdc-button__label+.mat-icon[dir=rtl],.mat-mdc-outlined-button .mdc-button__label+.mat-icon[dir=rtl]{margin-left:-4px;margin-right:8px}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px) * -1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px) * -1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0})}return e})(),bH=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({imports:[Wa,uj,Wa]})}return e})();const mj=Mv({passive:!0});let SH=(()=>{class e{constructor(t,o){this._platform=t,this._ngZone=o,this._monitoredElements=new Map}monitor(t){if(!this._platform.isBrowser)return ks;const o=Qh(t),c=this._monitoredElements.get(o);if(c)return c.subject;const u=new rn,f="cdk-text-field-autofilled",_=v=>{"cdk-text-field-autofill-start"!==v.animationName||o.classList.contains(f)?"cdk-text-field-autofill-end"===v.animationName&&o.classList.contains(f)&&(o.classList.remove(f),this._ngZone.run(()=>u.next({target:v.target,isAutofilled:!1}))):(o.classList.add(f),this._ngZone.run(()=>u.next({target:v.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{o.addEventListener("animationstart",_,mj),o.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(o,{subject:u,unlisten:()=>{o.removeEventListener("animationstart",_,mj)}}),u}stopMonitoring(t){const o=Qh(t),c=this._monitoredElements.get(o);c&&(c.unlisten(),c.subject.complete(),o.classList.remove("cdk-text-field-autofill-monitored"),o.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(o))}ngOnDestroy(){this._monitoredElements.forEach((t,o)=>this.stopMonitoring(o))}static#e=this.\u0275fac=function(o){return new(o||e)(fe(no),fe(lt))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),CH=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({})}return e})();class TH extends rn{constructor(n=1/0,t=1/0,o=CF){super(),this._bufferSize=n,this._windowTime=t,this._timestampProvider=o,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,n),this._windowTime=Math.max(1,t)}next(n){const{isStopped:t,_buffer:o,_infiniteTimeWindow:c,_timestampProvider:u,_windowTime:f}=this;t||(o.push(n),!c&&o.push(u.now()+f)),this._trimBuffer(),super.next(n)}_subscribe(n){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(n),{_infiniteTimeWindow:o,_buffer:c}=this,u=c.slice();for(let f=0;f<u.length&&!n.closed;f+=o?1:2)n.next(u[f]);return this._checkFinalizedStatuses(n),t}_trimBuffer(){const{_bufferSize:n,_timestampProvider:t,_buffer:o,_infiniteTimeWindow:c}=this,u=(c?1:2)*n;if(n<1/0&&u<o.length&&o.splice(0,o.length-u),!c){const f=t.now();let _=0;for(let v=1;v<o.length&&o[v]<=f;v+=2)_=v;_&&o.splice(0,_+1)}}}class IH{constructor(n){this._box=n,this._destroyed=new rn,this._resizeSubject=new rn,this._elementObservables=new Map,typeof ResizeObserver<"u"&&(this._resizeObserver=new ResizeObserver(t=>this._resizeSubject.next(t)))}observe(n){return this._elementObservables.has(n)||this._elementObservables.set(n,new Ln(t=>{const o=this._resizeSubject.subscribe(t);return this._resizeObserver?.observe(n,{box:this._box}),()=>{this._resizeObserver?.unobserve(n),o.unsubscribe(),this._elementObservables.delete(n)}}).pipe(ra(t=>t.some(o=>o.target===n)),function wH(e,n,t){let o,c=!1;return e&&"object"==typeof e?({bufferSize:o=1/0,windowTime:n=1/0,refCount:c=!1,scheduler:t}=e):o=e??1/0,Xa({connector:()=>new TH(o,n,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:c})}({bufferSize:1,refCount:!0}),No(this._destroyed))),this._elementObservables.get(n)}destroy(){this._destroyed.next(),this._destroyed.complete(),this._resizeSubject.complete(),this._elementObservables.clear()}}let RH=(()=>{class e{constructor(){this._observers=new Map,this._ngZone=Oe(lt)}ngOnDestroy(){for(const[,t]of this._observers)t.destroy();this._observers.clear()}observe(t,o){const c=o?.box||"content-box";return this._observers.has(c)||this._observers.set(c,new IH(c)),this._observers.get(c).observe(t)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class _j{}class AH{}const eu="*";function xF(e,n){return{type:7,name:e,definitions:n,options:{}}}function fT(e,n=null){return{type:4,styles:n,timings:e}}function gj(e,n=null){return{type:2,steps:e,options:n}}function Ll(e){return{type:6,styles:e,offset:null}}function MF(e,n,t){return{type:0,name:e,styles:n,options:t}}function mT(e,n,t=null){return{type:1,expr:e,animation:n,options:t}}class _T{constructor(n=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=n+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(n=>n()),this._onDoneFns=[])}onStart(n){this._originalOnStartFns.push(n),this._onStartFns.push(n)}onDone(n){this._originalOnDoneFns.push(n),this._onDoneFns.push(n)}onDestroy(n){this._onDestroyFns.push(n)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(n=>n()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(n=>n()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(n){this._position=this.totalTime?n*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(n){const t="start"==n?this._onStartFns:this._onDoneFns;t.forEach(o=>o()),t.length=0}}class Ej{constructor(n){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=n;let t=0,o=0,c=0;const u=this.players.length;0==u?queueMicrotask(()=>this._onFinish()):this.players.forEach(f=>{f.onDone(()=>{++t==u&&this._onFinish()}),f.onDestroy(()=>{++o==u&&this._onDestroy()}),f.onStart(()=>{++c==u&&this._onStart()})}),this.totalTime=this.players.reduce((f,_)=>Math.max(f,_.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(n=>n()),this._onDoneFns=[])}init(){this.players.forEach(n=>n.init())}onStart(n){this._onStartFns.push(n)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(n=>n()),this._onStartFns=[])}onDone(n){this._onDoneFns.push(n)}onDestroy(n){this._onDestroyFns.push(n)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(n=>n.play())}pause(){this.players.forEach(n=>n.pause())}restart(){this.players.forEach(n=>n.restart())}finish(){this._onFinish(),this.players.forEach(n=>n.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(n=>n.destroy()),this._onDestroyFns.forEach(n=>n()),this._onDestroyFns=[])}reset(){this.players.forEach(n=>n.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(n){const t=n*this.totalTime;this.players.forEach(o=>{const c=o.totalTime?Math.min(1,t/o.totalTime):1;o.setPosition(c)})}getPosition(){const n=this.players.reduce((t,o)=>null===t||o.totalTime>t.totalTime?o:t,null);return null!=n?n.getPosition():0}beforeDestroy(){this.players.forEach(n=>{n.beforeDestroy&&n.beforeDestroy()})}triggerCallback(n){const t="start"==n?this._onStartFns:this._onDoneFns;t.forEach(o=>o()),t.length=0}}const DH=["notch"],OH=["matFormFieldNotchedOutline",""],NH=["*"],PH=["textField"],xH=["iconPrefixContainer"],MH=["textPrefixContainer"];function kH(e,n){1&e&&wt(0,"span",19)}function LH(e,n){if(1&e&&(Pe(0,"label",17),nr(1,1),Fe(2,kH,1,0,"span",18),Re()),2&e){const t=tn(2);Qe("floating",t._shouldLabelFloat())("monitorResize",t._hasOutline())("id",t._labelId),ii("for",t._control.id),Je(2),Qe("ngIf",!t.hideRequiredMarker&&t._control.required)}}function FH(e,n){1&e&&Fe(0,LH,3,5,"label",16),2&e&&Qe("ngIf",tn()._hasFloatingLabel())}function UH(e,n){1&e&&wt(0,"div",20)}function VH(e,n){}function BH(e,n){1&e&&Fe(0,VH,0,0,"ng-template",22),2&e&&(tn(2),Qe("ngTemplateOutlet",pd(1)))}function jH(e,n){if(1&e&&(Pe(0,"div",21),Fe(1,BH,1,1,"ng-template",9),Re()),2&e){const t=tn();Qe("matFormFieldNotchedOutlineOpen",t._shouldLabelFloat()),Je(1),Qe("ngIf",!t._forceDisplayInfixLabel())}}function HH(e,n){1&e&&(Pe(0,"div",23,24),nr(2,2),Re())}function GH(e,n){1&e&&(Pe(0,"div",25,26),nr(2,3),Re())}function WH(e,n){}function zH(e,n){1&e&&Fe(0,WH,0,0,"ng-template",22),2&e&&(tn(),Qe("ngTemplateOutlet",pd(1)))}function qH(e,n){1&e&&(Pe(0,"div",27),nr(1,4),Re())}function KH(e,n){1&e&&(Pe(0,"div",28),nr(1,5),Re())}function YH(e,n){1&e&&wt(0,"div",29)}function $H(e,n){1&e&&(Pe(0,"div",30),nr(1,6),Re()),2&e&&Qe("@transitionMessages",tn()._subscriptAnimationState)}function XH(e,n){if(1&e&&(Pe(0,"mat-hint",34),Dr(1),Re()),2&e){const t=tn(2);Qe("id",t._hintLabelId),Je(1),hc(t.hintLabel)}}function JH(e,n){if(1&e&&(Pe(0,"div",31),Fe(1,XH,2,2,"mat-hint",32),nr(2,7),wt(3,"div",33),nr(4,8),Re()),2&e){const t=tn();Qe("@transitionMessages",t._subscriptAnimationState),Je(1),Qe("ngIf",t.hintLabel)}}const QH=["*",[["mat-label"]],[["","matPrefix",""],["","matIconPrefix",""]],[["","matTextPrefix",""]],[["","matTextSuffix",""]],[["","matSuffix",""],["","matIconSuffix",""]],[["mat-error"],["","matError",""]],[["mat-hint",3,"align","end"]],[["mat-hint","align","end"]]],ZH=["*","mat-label","[matPrefix], [matIconPrefix]","[matTextPrefix]","[matTextSuffix]","[matSuffix], [matIconSuffix]","mat-error, [matError]","mat-hint:not([align='end'])","mat-hint[align='end']"];let LF=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275dir=Ge({type:e,selectors:[["mat-label"]]})}return e})();const eG=new De("MatError");let tG=0,vj=(()=>{class e{constructor(){this.align="start",this.id="mat-mdc-hint-"+tG++}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275dir=Ge({type:e,selectors:[["mat-hint"]],hostAttrs:[1,"mat-mdc-form-field-hint","mat-mdc-form-field-bottom-align"],hostVars:4,hostBindings:function(o,c){2&o&&(gh("id",c.id),ii("align",null),Vt("mat-mdc-form-field-hint-end","end"===c.align))},inputs:{align:"align",id:"id"}})}return e})();const nG=new De("MatPrefix"),iG=new De("MatSuffix"),yj=new De("FloatingLabelParent");let bj=(()=>{class e{get floating(){return this._floating}set floating(t){this._floating=t,this.monitorResize&&this._handleResize()}get monitorResize(){return this._monitorResize}set monitorResize(t){this._monitorResize=t,this._monitorResize?this._subscribeToResize():this._resizeSubscription.unsubscribe()}constructor(t){this._elementRef=t,this._floating=!1,this._monitorResize=!1,this._resizeObserver=Oe(RH),this._ngZone=Oe(lt),this._parent=Oe(yj),this._resizeSubscription=new kn}ngOnDestroy(){this._resizeSubscription.unsubscribe()}getWidth(){return function rG(e){if(null!==e.offsetParent)return e.scrollWidth;const t=e.cloneNode(!0);t.style.setProperty("position","absolute"),t.style.setProperty("transform","translate(-9999px, -9999px)"),document.documentElement.appendChild(t);const o=t.scrollWidth;return t.remove(),o}(this._elementRef.nativeElement)}get element(){return this._elementRef.nativeElement}_handleResize(){setTimeout(()=>this._parent._handleLabelResized())}_subscribeToResize(){this._resizeSubscription.unsubscribe(),this._ngZone.runOutsideAngular(()=>{this._resizeSubscription=this._resizeObserver.observe(this._elementRef.nativeElement,{box:"border-box"}).subscribe(()=>this._handleResize())})}static#e=this.\u0275fac=function(o){return new(o||e)(re(bn))};static#t=this.\u0275dir=Ge({type:e,selectors:[["label","matFormFieldFloatingLabel",""]],hostAttrs:[1,"mdc-floating-label","mat-mdc-floating-label"],hostVars:2,hostBindings:function(o,c){2&o&&Vt("mdc-floating-label--float-above",c.floating)},inputs:{floating:"floating",monitorResize:"monitorResize"}})}return e})();const Sj="mdc-line-ripple--active",CP="mdc-line-ripple--deactivating";let Cj=(()=>{class e{constructor(t,o){this._elementRef=t,this._handleTransitionEnd=c=>{const u=this._elementRef.nativeElement.classList,f=u.contains(CP);"opacity"===c.propertyName&&f&&u.remove(Sj,CP)},o.runOutsideAngular(()=>{t.nativeElement.addEventListener("transitionend",this._handleTransitionEnd)})}activate(){const t=this._elementRef.nativeElement.classList;t.remove(CP),t.add(Sj)}deactivate(){this._elementRef.nativeElement.classList.add(CP)}ngOnDestroy(){this._elementRef.nativeElement.removeEventListener("transitionend",this._handleTransitionEnd)}static#e=this.\u0275fac=function(o){return new(o||e)(re(bn),re(lt))};static#t=this.\u0275dir=Ge({type:e,selectors:[["div","matFormFieldLineRipple",""]],hostAttrs:[1,"mdc-line-ripple"]})}return e})(),Tj=(()=>{class e{constructor(t,o){this._elementRef=t,this._ngZone=o,this.open=!1}ngAfterViewInit(){const t=this._elementRef.nativeElement.querySelector(".mdc-floating-label");t?(this._elementRef.nativeElement.classList.add("mdc-notched-outline--upgraded"),"function"==typeof requestAnimationFrame&&(t.style.transitionDuration="0s",this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>t.style.transitionDuration="")}))):this._elementRef.nativeElement.classList.add("mdc-notched-outline--no-label")}_setNotchWidth(t){this._notch.nativeElement.style.width=this.open&&t?`calc(${t}px * var(--mat-mdc-form-field-floating-label-scale, 0.75) + 9px)`:""}static#e=this.\u0275fac=function(o){return new(o||e)(re(bn),re(lt))};static#t=this.\u0275cmp=Ct({type:e,selectors:[["div","matFormFieldNotchedOutline",""]],viewQuery:function(o,c){if(1&o&&Js(DH,5),2&o){let u;$e(u=Bi())&&(c._notch=u.first)}},hostAttrs:[1,"mdc-notched-outline"],hostVars:2,hostBindings:function(o,c){2&o&&Vt("mdc-notched-outline--notched",c.open)},inputs:{open:["matFormFieldNotchedOutlineOpen","open"]},attrs:OH,ngContentSelectors:NH,decls:5,vars:0,consts:[[1,"mdc-notched-outline__leading"],[1,"mdc-notched-outline__notch"],["notch",""],[1,"mdc-notched-outline__trailing"]],template:function(o,c){1&o&&(_d(),wt(0,"div",0),Pe(1,"div",1,2),nr(3),Re(),wt(4,"div",3))},encapsulation:2,changeDetection:0})}return e})();const oG={transitionMessages:xF("transitionMessages",[MF("enter",Ll({opacity:1,transform:"translateY(0%)"})),mT("void => enter",[Ll({opacity:0,transform:"translateY(-5px)"}),fT("300ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])};let wj=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275dir=Ge({type:e})}return e})();const Ij=new De("MatFormField"),sG=new De("MAT_FORM_FIELD_DEFAULT_OPTIONS");let Rj=0,lG=(()=>{class e{get hideRequiredMarker(){return this._hideRequiredMarker}set hideRequiredMarker(t){this._hideRequiredMarker=oa(t)}get floatLabel(){return this._floatLabel||this._defaults?.floatLabel||"auto"}set floatLabel(t){t!==this._floatLabel&&(this._floatLabel=t,this._changeDetectorRef.markForCheck())}get appearance(){return this._appearance}set appearance(t){const o=this._appearance;this._appearance=t||this._defaults?.appearance||"fill","outline"===this._appearance&&this._appearance!==o&&(this._needsOutlineLabelOffsetUpdateOnStable=!0)}get subscriptSizing(){return this._subscriptSizing||this._defaults?.subscriptSizing||"fixed"}set subscriptSizing(t){this._subscriptSizing=t||this._defaults?.subscriptSizing||"fixed"}get hintLabel(){return this._hintLabel}set hintLabel(t){this._hintLabel=t,this._processHints()}get _control(){return this._explicitFormFieldControl||this._formFieldControl}set _control(t){this._explicitFormFieldControl=t}constructor(t,o,c,u,f,_,v,S){this._elementRef=t,this._changeDetectorRef=o,this._ngZone=c,this._dir=u,this._platform=f,this._defaults=_,this._animationMode=v,this._hideRequiredMarker=!1,this.color="primary",this._appearance="fill",this._subscriptSizing=null,this._hintLabel="",this._hasIconPrefix=!1,this._hasTextPrefix=!1,this._hasIconSuffix=!1,this._hasTextSuffix=!1,this._labelId="mat-mdc-form-field-label-"+Rj++,this._hintLabelId="mat-mdc-hint-"+Rj++,this._subscriptAnimationState="",this._destroyed=new rn,this._isFocused=null,this._needsOutlineLabelOffsetUpdateOnStable=!1,_&&(_.appearance&&(this.appearance=_.appearance),this._hideRequiredMarker=!!_?.hideRequiredMarker,_.color&&(this.color=_.color))}ngAfterViewInit(){this._updateFocusState(),this._subscriptAnimationState="enter",this._changeDetectorRef.detectChanges()}ngAfterContentInit(){this._assertFormFieldControl(),this._initializeControl(),this._initializeSubscript(),this._initializePrefixAndSuffix(),this._initializeOutlineLabelOffsetSubscriptions()}ngAfterContentChecked(){this._assertFormFieldControl()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}getLabelId(){return this._hasFloatingLabel()?this._labelId:null}getConnectedOverlayOrigin(){return this._textField||this._elementRef}_animateAndLockLabel(){this._hasFloatingLabel()&&(this.floatLabel="always")}_initializeControl(){const t=this._control;t.controlType&&this._elementRef.nativeElement.classList.add(`mat-mdc-form-field-type-${t.controlType}`),t.stateChanges.subscribe(()=>{this._updateFocusState(),this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),t.ngControl&&t.ngControl.valueChanges&&t.ngControl.valueChanges.pipe(No(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck())}_checkPrefixAndSuffixTypes(){this._hasIconPrefix=!!this._prefixChildren.find(t=>!t._isText),this._hasTextPrefix=!!this._prefixChildren.find(t=>t._isText),this._hasIconSuffix=!!this._suffixChildren.find(t=>!t._isText),this._hasTextSuffix=!!this._suffixChildren.find(t=>t._isText)}_initializePrefixAndSuffix(){this._checkPrefixAndSuffixTypes(),ry(this._prefixChildren.changes,this._suffixChildren.changes).subscribe(()=>{this._checkPrefixAndSuffixTypes(),this._changeDetectorRef.markForCheck()})}_initializeSubscript(){this._hintChildren.changes.subscribe(()=>{this._processHints(),this._changeDetectorRef.markForCheck()}),this._errorChildren.changes.subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._validateHints(),this._syncDescribedByIds()}_assertFormFieldControl(){}_updateFocusState(){this._control.focused&&!this._isFocused?(this._isFocused=!0,this._lineRipple?.activate()):!this._control.focused&&(this._isFocused||null===this._isFocused)&&(this._isFocused=!1,this._lineRipple?.deactivate()),this._textField?.nativeElement.classList.toggle("mdc-text-field--focused",this._control.focused)}_initializeOutlineLabelOffsetSubscriptions(){this._prefixChildren.changes.subscribe(()=>this._needsOutlineLabelOffsetUpdateOnStable=!0),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(No(this._destroyed)).subscribe(()=>{this._needsOutlineLabelOffsetUpdateOnStable&&(this._needsOutlineLabelOffsetUpdateOnStable=!1,this._updateOutlineLabelOffset())})}),this._dir.change.pipe(No(this._destroyed)).subscribe(()=>this._needsOutlineLabelOffsetUpdateOnStable=!0)}_shouldAlwaysFloat(){return"always"===this.floatLabel}_hasOutline(){return"outline"===this.appearance}_forceDisplayInfixLabel(){return!this._platform.isBrowser&&this._prefixChildren.length&&!this._shouldLabelFloat()}_hasFloatingLabel(){return!!this._labelChildNonStatic||!!this._labelChildStatic}_shouldLabelFloat(){return this._control.shouldLabelFloat||this._shouldAlwaysFloat()}_shouldForward(t){const o=this._control?this._control.ngControl:null;return o&&o[t]}_getDisplayedMessages(){return this._errorChildren&&this._errorChildren.length>0&&this._control.errorState?"error":"hint"}_handleLabelResized(){this._refreshOutlineNotchWidth()}_refreshOutlineNotchWidth(){this._hasOutline()&&this._floatingLabel&&this._shouldLabelFloat()?this._notchedOutline?._setNotchWidth(this._floatingLabel.getWidth()):this._notchedOutline?._setNotchWidth(0)}_processHints(){this._validateHints(),this._syncDescribedByIds()}_validateHints(){}_syncDescribedByIds(){if(this._control){let t=[];if(this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&t.push(...this._control.userAriaDescribedBy.split(" ")),"hint"===this._getDisplayedMessages()){const o=this._hintChildren?this._hintChildren.find(u=>"start"===u.align):null,c=this._hintChildren?this._hintChildren.find(u=>"end"===u.align):null;o?t.push(o.id):this._hintLabel&&t.push(this._hintLabelId),c&&t.push(c.id)}else this._errorChildren&&t.push(...this._errorChildren.map(o=>o.id));this._control.setDescribedByIds(t)}}_updateOutlineLabelOffset(){if(!this._platform.isBrowser||!this._hasOutline()||!this._floatingLabel)return;const t=this._floatingLabel.element;if(!this._iconPrefixContainer&&!this._textPrefixContainer)return void(t.style.transform="");if(!this._isAttachedToDom())return void(this._needsOutlineLabelOffsetUpdateOnStable=!0);const o=this._iconPrefixContainer?.nativeElement,c=this._textPrefixContainer?.nativeElement,u=o?.getBoundingClientRect().width??0,f=c?.getBoundingClientRect().width??0;t.style.transform=`var(\n        --mat-mdc-form-field-label-transform,\n        translateY(-50%) translateX(calc(${"rtl"===this._dir.value?"-1":"1"} * (${u+f}px + var(--mat-mdc-form-field-label-offset-x, 0px))))\n    )`}_isAttachedToDom(){const t=this._elementRef.nativeElement;if(t.getRootNode){const o=t.getRootNode();return o&&o!==t}return document.documentElement.contains(t)}static#e=this.\u0275fac=function(o){return new(o||e)(re(bn),re(rr),re(lt),re(OF),re(no),re(sG,8),re(Sa,8),re(Kt))};static#t=this.\u0275cmp=Ct({type:e,selectors:[["mat-form-field"]],contentQueries:function(o,c,u){if(1&o&&(La(u,LF,5),La(u,LF,7),La(u,wj,5),La(u,nG,5),La(u,iG,5),La(u,eG,5),La(u,vj,5)),2&o){let f;$e(f=Bi())&&(c._labelChildNonStatic=f.first),$e(f=Bi())&&(c._labelChildStatic=f.first),$e(f=Bi())&&(c._formFieldControl=f.first),$e(f=Bi())&&(c._prefixChildren=f),$e(f=Bi())&&(c._suffixChildren=f),$e(f=Bi())&&(c._errorChildren=f),$e(f=Bi())&&(c._hintChildren=f)}},viewQuery:function(o,c){if(1&o&&(Js(PH,5),Js(xH,5),Js(MH,5),Js(bj,5),Js(Tj,5),Js(Cj,5)),2&o){let u;$e(u=Bi())&&(c._textField=u.first),$e(u=Bi())&&(c._iconPrefixContainer=u.first),$e(u=Bi())&&(c._textPrefixContainer=u.first),$e(u=Bi())&&(c._floatingLabel=u.first),$e(u=Bi())&&(c._notchedOutline=u.first),$e(u=Bi())&&(c._lineRipple=u.first)}},hostAttrs:[1,"mat-mdc-form-field"],hostVars:42,hostBindings:function(o,c){2&o&&Vt("mat-mdc-form-field-label-always-float",c._shouldAlwaysFloat())("mat-mdc-form-field-has-icon-prefix",c._hasIconPrefix)("mat-mdc-form-field-has-icon-suffix",c._hasIconSuffix)("mat-form-field-invalid",c._control.errorState)("mat-form-field-disabled",c._control.disabled)("mat-form-field-autofilled",c._control.autofilled)("mat-form-field-no-animations","NoopAnimations"===c._animationMode)("mat-form-field-appearance-fill","fill"==c.appearance)("mat-form-field-appearance-outline","outline"==c.appearance)("mat-form-field-hide-placeholder",c._hasFloatingLabel()&&!c._shouldLabelFloat())("mat-focused",c._control.focused)("mat-primary","accent"!==c.color&&"warn"!==c.color)("mat-accent","accent"===c.color)("mat-warn","warn"===c.color)("ng-untouched",c._shouldForward("untouched"))("ng-touched",c._shouldForward("touched"))("ng-pristine",c._shouldForward("pristine"))("ng-dirty",c._shouldForward("dirty"))("ng-valid",c._shouldForward("valid"))("ng-invalid",c._shouldForward("invalid"))("ng-pending",c._shouldForward("pending"))},inputs:{hideRequiredMarker:"hideRequiredMarker",color:"color",floatLabel:"floatLabel",appearance:"appearance",subscriptSizing:"subscriptSizing",hintLabel:"hintLabel"},exportAs:["matFormField"],features:[Lt([{provide:Ij,useExisting:e},{provide:yj,useExisting:e}])],ngContentSelectors:ZH,decls:18,vars:23,consts:[["labelTemplate",""],[1,"mat-mdc-text-field-wrapper","mdc-text-field",3,"click"],["textField",""],["class","mat-mdc-form-field-focus-overlay",4,"ngIf"],[1,"mat-mdc-form-field-flex"],["matFormFieldNotchedOutline","",3,"matFormFieldNotchedOutlineOpen",4,"ngIf"],["class","mat-mdc-form-field-icon-prefix",4,"ngIf"],["class","mat-mdc-form-field-text-prefix",4,"ngIf"],[1,"mat-mdc-form-field-infix"],[3,"ngIf"],["class","mat-mdc-form-field-text-suffix",4,"ngIf"],["class","mat-mdc-form-field-icon-suffix",4,"ngIf"],["matFormFieldLineRipple","",4,"ngIf"],[1,"mat-mdc-form-field-subscript-wrapper","mat-mdc-form-field-bottom-align",3,"ngSwitch"],["class","mat-mdc-form-field-error-wrapper",4,"ngSwitchCase"],["class","mat-mdc-form-field-hint-wrapper",4,"ngSwitchCase"],["matFormFieldFloatingLabel","",3,"floating","monitorResize","id",4,"ngIf"],["matFormFieldFloatingLabel","",3,"floating","monitorResize","id"],["aria-hidden","true","class","mat-mdc-form-field-required-marker mdc-floating-label--required",4,"ngIf"],["aria-hidden","true",1,"mat-mdc-form-field-required-marker","mdc-floating-label--required"],[1,"mat-mdc-form-field-focus-overlay"],["matFormFieldNotchedOutline","",3,"matFormFieldNotchedOutlineOpen"],[3,"ngTemplateOutlet"],[1,"mat-mdc-form-field-icon-prefix"],["iconPrefixContainer",""],[1,"mat-mdc-form-field-text-prefix"],["textPrefixContainer",""],[1,"mat-mdc-form-field-text-suffix"],[1,"mat-mdc-form-field-icon-suffix"],["matFormFieldLineRipple",""],[1,"mat-mdc-form-field-error-wrapper"],[1,"mat-mdc-form-field-hint-wrapper"],[3,"id",4,"ngIf"],[1,"mat-mdc-form-field-hint-spacer"],[3,"id"]],template:function(o,c){1&o&&(_d(QH),Fe(0,FH,1,1,"ng-template",null,0,Bf),Pe(2,"div",1,2),en("click",function(f){return c._control.onContainerClick(f)}),Fe(4,UH,1,0,"div",3),Pe(5,"div",4),Fe(6,jH,2,2,"div",5),Fe(7,HH,3,0,"div",6),Fe(8,GH,3,0,"div",7),Pe(9,"div",8),Fe(10,zH,1,1,"ng-template",9),nr(11),Re(),Fe(12,qH,2,0,"div",10),Fe(13,KH,2,0,"div",11),Re(),Fe(14,YH,1,0,"div",12),Re(),Pe(15,"div",13),Fe(16,$H,2,1,"div",14),Fe(17,JH,5,2,"div",15),Re()),2&o&&(Je(2),Vt("mdc-text-field--filled",!c._hasOutline())("mdc-text-field--outlined",c._hasOutline())("mdc-text-field--no-label",!c._hasFloatingLabel())("mdc-text-field--disabled",c._control.disabled)("mdc-text-field--invalid",c._control.errorState),Je(2),Qe("ngIf",!c._hasOutline()&&!c._control.disabled),Je(2),Qe("ngIf",c._hasOutline()),Je(1),Qe("ngIf",c._hasIconPrefix),Je(1),Qe("ngIf",c._hasTextPrefix),Je(2),Qe("ngIf",!c._hasOutline()||c._forceDisplayInfixLabel()),Je(2),Qe("ngIf",c._hasTextSuffix),Je(1),Qe("ngIf",c._hasIconSuffix),Je(1),Qe("ngIf",!c._hasOutline()),Je(1),Vt("mat-mdc-form-field-subscript-dynamic-size","dynamic"===c.subscriptSizing),Qe("ngSwitch",c._getDisplayedMessages()),Je(1),Qe("ngSwitchCase","error"),Je(1),Qe("ngSwitchCase","hint"))},dependencies:[qd,cn,Hh,Gh,vj,bj,Tj,Cj],styles:['.mdc-text-field{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:0;border-bottom-left-radius:0;display:inline-flex;align-items:baseline;padding:0 16px;position:relative;box-sizing:border-box;overflow:hidden;will-change:opacity,transform,color}.mdc-text-field .mdc-floating-label{top:50%;transform:translateY(-50%);pointer-events:none}.mdc-text-field__input{height:28px;width:100%;min-width:0;border:none;border-radius:0;background:none;appearance:none;padding:0}.mdc-text-field__input::-ms-clear{display:none}.mdc-text-field__input::-webkit-calendar-picker-indicator{display:none}.mdc-text-field__input:focus{outline:none}.mdc-text-field__input:invalid{box-shadow:none}@media all{.mdc-text-field__input::placeholder{opacity:0}}@media all{.mdc-text-field__input:-ms-input-placeholder{opacity:0}}@media all{.mdc-text-field--no-label .mdc-text-field__input::placeholder,.mdc-text-field--focused .mdc-text-field__input::placeholder{opacity:1}}@media all{.mdc-text-field--no-label .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mdc-text-field__input:-ms-input-placeholder{opacity:1}}.mdc-text-field__affix{height:28px;opacity:0;white-space:nowrap}.mdc-text-field--label-floating .mdc-text-field__affix,.mdc-text-field--no-label .mdc-text-field__affix{opacity:1}@supports(-webkit-hyphens: none){.mdc-text-field--outlined .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field__affix--prefix,.mdc-text-field__affix--prefix[dir=rtl]{padding-left:2px;padding-right:0}.mdc-text-field--end-aligned .mdc-text-field__affix--prefix{padding-left:0;padding-right:12px}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--end-aligned .mdc-text-field__affix--prefix[dir=rtl]{padding-left:12px;padding-right:0}.mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field__affix--suffix,.mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:12px}.mdc-text-field--end-aligned .mdc-text-field__affix--suffix{padding-left:2px;padding-right:0}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--end-aligned .mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:2px}.mdc-text-field--filled{height:56px}.mdc-text-field--filled::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}.mdc-text-field--filled .mdc-floating-label{left:16px;right:initial}[dir=rtl] .mdc-text-field--filled .mdc-floating-label,.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:16px}.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{height:100%}.mdc-text-field--filled.mdc-text-field--no-label .mdc-floating-label{display:none}.mdc-text-field--filled.mdc-text-field--no-label::before{display:none}@supports(-webkit-hyphens: none){.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field--outlined{height:56px;overflow:visible}.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) scale(1)}.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) scale(0.75)}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--outlined .mdc-text-field__input{height:100%}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:4px;border-bottom-left-radius:var(--mdc-shape-small, 4px)}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading[dir=rtl]{border-top-left-radius:0;border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:4px;border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px, var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px, var(--mdc-shape-small, 4px))*2)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing{border-top-left-radius:0;border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:4px;border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing[dir=rtl]{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:4px;border-bottom-left-radius:var(--mdc-shape-small, 4px)}@supports(top: max(0%)){.mdc-text-field--outlined{padding-left:max(16px, calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px, var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-left:max(16px, calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-right:max(16px, var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-left:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-right:max(16px, var(--mdc-shape-small, 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-right:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:max(16px, var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-right:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-left:max(16px, calc(var(--mdc-shape-small, 4px) + 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-right:max(16px, calc(var(--mdc-shape-small, 4px) + 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:1px}.mdc-text-field--outlined .mdc-floating-label{left:4px;right:initial}[dir=rtl] .mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:4px}.mdc-text-field--outlined .mdc-text-field__input{display:flex;border:none !important;background-color:rgba(0,0,0,0)}.mdc-text-field--outlined .mdc-notched-outline{z-index:1}.mdc-text-field--textarea{flex-direction:column;align-items:center;width:auto;height:auto;padding:0}.mdc-text-field--textarea .mdc-floating-label{top:19px}.mdc-text-field--textarea .mdc-floating-label:not(.mdc-floating-label--float-above){transform:none}.mdc-text-field--textarea .mdc-text-field__input{flex-grow:1;height:auto;min-height:1.5rem;overflow-x:hidden;overflow-y:auto;box-sizing:border-box;resize:none;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--filled::before{display:none}.mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-10.25px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--filled .mdc-text-field__input{margin-top:23px;margin-bottom:9px}.mdc-text-field--textarea.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-27.25px) scale(1)}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-24.75px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label{top:18px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field__input{margin-bottom:2px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter{align-self:flex-end;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::after{display:inline-block;width:0;height:16px;content:"";vertical-align:-16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::before{display:none}.mdc-text-field__resizer{align-self:stretch;display:inline-flex;flex-direction:column;flex-grow:1;max-height:100%;max-width:100%;min-height:56px;min-width:fit-content;min-width:-moz-available;min-width:-webkit-fill-available;overflow:hidden;resize:both}.mdc-text-field--filled .mdc-text-field__resizer{transform:translateY(-1px)}.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateY(1px)}.mdc-text-field--outlined .mdc-text-field__resizer{transform:translateX(-1px) translateY(-1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer,.mdc-text-field--outlined .mdc-text-field__resizer[dir=rtl]{transform:translateX(1px) translateY(-1px)}.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateX(1px) translateY(1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input[dir=rtl],.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter[dir=rtl]{transform:translateX(-1px) translateY(1px)}.mdc-text-field--with-leading-icon{padding-left:0;padding-right:16px}[dir=rtl] .mdc-text-field--with-leading-icon,.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:16px;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 48px);left:48px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:48px}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100% / 0.75 - 64px / 0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label{left:36px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:36px}.mdc-text-field--with-leading-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) translateX(-32px) scale(1)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-37.25px) translateX(32px) scale(1)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) translateX(-32px) scale(0.75)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl],.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-34.75px) translateX(32px) scale(0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--with-trailing-icon{padding-left:16px;padding-right:0}[dir=rtl] .mdc-text-field--with-trailing-icon,.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0;padding-right:16px}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 64px)}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100% / 0.75 - 64px / 0.75)}.mdc-text-field--with-trailing-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 96px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100% / 0.75 - 96px / 0.75)}.mdc-text-field-helper-line{display:flex;justify-content:space-between;box-sizing:border-box}.mdc-text-field+.mdc-text-field-helper-line{padding-right:16px;padding-left:16px}.mdc-form-field>.mdc-text-field+label{align-self:flex-start}.mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--focused .mdc-notched-outline__trailing{border-width:2px}.mdc-text-field--focused+.mdc-text-field-helper-line .mdc-text-field-helper-text:not(.mdc-text-field-helper-text--validation-msg){opacity:1}.mdc-text-field--focused.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:2px}.mdc-text-field--focused.mdc-text-field--outlined.mdc-text-field--textarea .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--invalid+.mdc-text-field-helper-line .mdc-text-field-helper-text--validation-msg{opacity:1}.mdc-text-field--disabled{pointer-events:none}@media screen and (forced-colors: active){.mdc-text-field--disabled .mdc-text-field__input{background-color:Window}.mdc-text-field--disabled .mdc-floating-label{z-index:1}}.mdc-text-field--disabled .mdc-floating-label{cursor:default}.mdc-text-field--disabled.mdc-text-field--filled .mdc-text-field__ripple{display:none}.mdc-text-field--disabled .mdc-text-field__input{pointer-events:auto}.mdc-text-field--end-aligned .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--end-aligned .mdc-text-field__input[dir=rtl]{text-align:left}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix{direction:ltr}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--leading,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--leading{order:1}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{order:2}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input{order:3}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{order:4}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--trailing,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--trailing{order:5}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--prefix{padding-right:12px}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--suffix{padding-left:2px}.mdc-floating-label{position:absolute;left:0;-webkit-transform-origin:left top;transform-origin:left top;line-height:1.15rem;text-align:left;text-overflow:ellipsis;white-space:nowrap;cursor:text;overflow:hidden;will-change:transform}[dir=rtl] .mdc-floating-label,.mdc-floating-label[dir=rtl]{right:0;left:auto;-webkit-transform-origin:right top;transform-origin:right top;text-align:right}.mdc-floating-label--float-above{cursor:auto}.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after{margin-left:1px;margin-right:0px;content:"*"}[dir=rtl] .mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after,.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)[dir=rtl]::after{margin-left:0;margin-right:1px}.mdc-notched-outline{display:flex;position:absolute;top:0;right:0;left:0;box-sizing:border-box;width:100%;max-width:100%;height:100%;text-align:left;pointer-events:none}[dir=rtl] .mdc-notched-outline,.mdc-notched-outline[dir=rtl]{text-align:right}.mdc-notched-outline__leading,.mdc-notched-outline__notch,.mdc-notched-outline__trailing{box-sizing:border-box;height:100%;pointer-events:none}.mdc-notched-outline__trailing{flex-grow:1}.mdc-notched-outline__notch{flex:0 0 auto;width:auto}.mdc-notched-outline .mdc-floating-label{display:inline-block;position:relative;max-width:100%}.mdc-notched-outline .mdc-floating-label--float-above{text-overflow:clip}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:133.3333333333%}.mdc-notched-outline--notched .mdc-notched-outline__notch{padding-left:0;padding-right:8px;border-top:none}[dir=rtl] .mdc-notched-outline--notched .mdc-notched-outline__notch,.mdc-notched-outline--notched .mdc-notched-outline__notch[dir=rtl]{padding-left:8px;padding-right:0}.mdc-notched-outline--no-label .mdc-notched-outline__notch{display:none}.mdc-line-ripple::before,.mdc-line-ripple::after{position:absolute;bottom:0;left:0;width:100%;border-bottom-style:solid;content:""}.mdc-line-ripple::before{z-index:1}.mdc-line-ripple::after{transform:scaleX(0);opacity:0;z-index:2}.mdc-line-ripple--active::after{transform:scaleX(1);opacity:1}.mdc-line-ripple--deactivating::after{opacity:0}.mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-notched-outline__leading,.mdc-notched-outline__notch,.mdc-notched-outline__trailing{border-top:1px solid;border-bottom:1px solid}.mdc-notched-outline__leading{border-left:1px solid;border-right:none;width:12px}[dir=rtl] .mdc-notched-outline__leading,.mdc-notched-outline__leading[dir=rtl]{border-left:none;border-right:1px solid}.mdc-notched-outline__trailing{border-left:none;border-right:1px solid}[dir=rtl] .mdc-notched-outline__trailing,.mdc-notched-outline__trailing[dir=rtl]{border-left:1px solid;border-right:none}.mdc-notched-outline__notch{max-width:calc(100% - 12px * 2)}.mdc-line-ripple::before{border-bottom-width:1px}.mdc-line-ripple::after{border-bottom-width:2px}.mdc-text-field--filled{--mdc-filled-text-field-active-indicator-height:1px;--mdc-filled-text-field-focus-active-indicator-height:2px;--mdc-filled-text-field-container-shape:4px;border-top-left-radius:var(--mdc-filled-text-field-container-shape);border-top-right-radius:var(--mdc-filled-text-field-container-shape);border-bottom-right-radius:0;border-bottom-left-radius:0}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-caret-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-error-caret-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-filled-text-field-input-text-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-filled-text-field-disabled-input-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-focus-label-text-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-disabled-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-focus-label-text-color)}.mdc-text-field--filled .mdc-floating-label{font-family:var(--mdc-filled-text-field-label-text-font);font-size:var(--mdc-filled-text-field-label-text-size);font-weight:var(--mdc-filled-text-field-label-text-weight);letter-spacing:var(--mdc-filled-text-field-label-text-tracking)}@media all{.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}}@media all{.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}}.mdc-text-field--filled:not(.mdc-text-field--disabled){background-color:var(--mdc-filled-text-field-container-color)}.mdc-text-field--filled.mdc-text-field--disabled{background-color:var(--mdc-filled-text-field-disabled-container-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-hover-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-focus-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-disabled-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-hover-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-error-focus-active-indicator-color)}.mdc-text-field--filled .mdc-line-ripple::before{border-bottom-width:var(--mdc-filled-text-field-active-indicator-height)}.mdc-text-field--filled .mdc-line-ripple::after{border-bottom-width:var(--mdc-filled-text-field-focus-active-indicator-height)}.mdc-text-field--outlined{--mdc-outlined-text-field-outline-width:1px;--mdc-outlined-text-field-focus-outline-width:2px;--mdc-outlined-text-field-container-shape:4px}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-caret-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-error-caret-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-outlined-text-field-input-text-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-outlined-text-field-disabled-input-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-focus-label-text-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-disabled-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-focus-label-text-color)}.mdc-text-field--outlined .mdc-floating-label{font-family:var(--mdc-outlined-text-field-label-text-font);font-size:var(--mdc-outlined-text-field-label-text-size);font-weight:var(--mdc-outlined-text-field-label-text-weight);letter-spacing:var(--mdc-outlined-text-field-label-text-tracking)}@media all{.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}}@media all{.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading[dir=rtl]{border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:0}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px, var(--mdc-outlined-text-field-container-shape))}}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px, var(--mdc-outlined-text-field-container-shape))*2)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing{border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:0}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing[dir=rtl]{border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}@supports(top: max(0%)){.mdc-text-field--outlined{padding-left:max(16px, calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px, var(--mdc-outlined-text-field-container-shape))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-left:max(16px, calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-right:max(16px, var(--mdc-outlined-text-field-container-shape))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-left:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-right:max(16px, var(--mdc-outlined-text-field-container-shape))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-right:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:max(16px, var(--mdc-outlined-text-field-container-shape))}}.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-right:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-left:max(16px, calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-right:max(16px, calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-hover-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-focus-outline-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-disabled-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-hover-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-focus-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__trailing{border-width:var(--mdc-outlined-text-field-outline-width)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__trailing{border-width:var(--mdc-outlined-text-field-focus-outline-width)}.mat-mdc-form-field-textarea-control{vertical-align:middle;resize:vertical;box-sizing:border-box;height:auto;margin:0;padding:0;border:none;overflow:auto}.mat-mdc-form-field-input-control.mat-mdc-form-field-input-control{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:inherit;letter-spacing:inherit;text-decoration:inherit;text-transform:inherit;border:none}.mat-mdc-form-field .mat-mdc-floating-label.mdc-floating-label{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;line-height:normal;pointer-events:all}.mat-mdc-form-field:not(.mat-form-field-disabled) .mat-mdc-floating-label.mdc-floating-label{cursor:inherit}.mdc-text-field--no-label:not(.mdc-text-field--textarea) .mat-mdc-form-field-input-control.mdc-text-field__input,.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control{height:auto}.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control.mdc-text-field__input[type=color]{height:23px}.mat-mdc-text-field-wrapper{height:auto;flex:auto}.mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-left:0;--mat-mdc-form-field-label-offset-x: -16px}.mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-right:0}[dir=rtl] .mat-mdc-text-field-wrapper{padding-left:16px;padding-right:16px}[dir=rtl] .mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-left:0}[dir=rtl] .mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-right:0}.mat-form-field-disabled .mdc-text-field__input::placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-moz-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-webkit-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input:-ms-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-mdc-form-field-label-always-float .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms;opacity:1}.mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-floating-label{left:auto;right:auto}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-text-field__input{display:inline-block}.mat-mdc-form-field .mat-mdc-text-field-wrapper.mdc-text-field .mdc-notched-outline__notch{padding-top:0}.mat-mdc-text-field-wrapper::before{content:none}.mat-mdc-form-field-subscript-wrapper{box-sizing:border-box;width:100%;position:relative}.mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-error-wrapper{position:absolute;top:0;left:0;right:0;padding:0 16px}.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-error-wrapper{position:static}.mat-mdc-form-field-bottom-align::before{content:"";display:inline-block;height:16px}.mat-mdc-form-field-bottom-align.mat-mdc-form-field-subscript-dynamic-size::before{content:unset}.mat-mdc-form-field-hint-end{order:1}.mat-mdc-form-field-hint-wrapper{display:flex}.mat-mdc-form-field-hint-spacer{flex:1 0 1em}.mat-mdc-form-field-error{display:block}.mat-mdc-form-field-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;opacity:0;pointer-events:none}select.mat-mdc-form-field-input-control{-moz-appearance:none;-webkit-appearance:none;background-color:rgba(0,0,0,0);display:inline-flex;box-sizing:border-box}select.mat-mdc-form-field-input-control:not(:disabled){cursor:pointer}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{content:"";width:0;height:0;border-left:5px solid rgba(0,0,0,0);border-right:5px solid rgba(0,0,0,0);border-top:5px solid;position:absolute;right:0;top:50%;margin-top:-2.5px;pointer-events:none}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{right:auto;left:0}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:15px}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:0;padding-left:15px}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-mdc-text-field-wrapper{outline:solid 1px}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-form-field-disabled .mat-mdc-text-field-wrapper{outline-color:GrayText}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-focused .mat-mdc-text-field-wrapper{outline:dashed 3px}.cdk-high-contrast-active .mat-mdc-form-field.mat-focused .mdc-notched-outline{border:dashed 3px}.mat-mdc-form-field-input-control[type=date],.mat-mdc-form-field-input-control[type=datetime],.mat-mdc-form-field-input-control[type=datetime-local],.mat-mdc-form-field-input-control[type=month],.mat-mdc-form-field-input-control[type=week],.mat-mdc-form-field-input-control[type=time]{line-height:1}.mat-mdc-form-field-input-control::-webkit-datetime-edit{line-height:1;padding:0;margin-bottom:-2px}.mat-mdc-form-field{--mat-mdc-form-field-floating-label-scale: 0.75;display:inline-flex;flex-direction:column;min-width:0;text-align:left;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-container-text-font);line-height:var(--mat-form-field-container-text-line-height);font-size:var(--mat-form-field-container-text-size);letter-spacing:var(--mat-form-field-container-text-tracking);font-weight:var(--mat-form-field-container-text-weight)}[dir=rtl] .mat-mdc-form-field{text-align:right}.mat-mdc-form-field .mdc-text-field--outlined .mdc-floating-label--float-above{font-size:calc(var(--mat-form-field-outlined-label-text-populated-size) * var(--mat-mdc-form-field-floating-label-scale))}.mat-mdc-form-field .mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:var(--mat-form-field-outlined-label-text-populated-size)}.mat-mdc-form-field-flex{display:inline-flex;align-items:baseline;box-sizing:border-box;width:100%}.mat-mdc-text-field-wrapper{width:100%}.mat-mdc-form-field-icon-prefix,.mat-mdc-form-field-icon-suffix{align-self:center;line-height:0;pointer-events:auto;position:relative;z-index:1}.mat-mdc-form-field-icon-prefix,[dir=rtl] .mat-mdc-form-field-icon-suffix{padding:0 4px 0 0}.mat-mdc-form-field-icon-suffix,[dir=rtl] .mat-mdc-form-field-icon-prefix{padding:0 0 0 4px}.mat-mdc-form-field-icon-prefix>.mat-icon,.mat-mdc-form-field-icon-suffix>.mat-icon{padding:12px;box-sizing:content-box}.mat-mdc-form-field-subscript-wrapper .mat-icon,.mat-mdc-form-field label .mat-icon{width:1em;height:1em;font-size:inherit}.mat-mdc-form-field-infix{flex:auto;min-width:0;width:180px;position:relative;box-sizing:border-box}.mat-mdc-form-field .mdc-notched-outline__notch{margin-left:-1px;-webkit-clip-path:inset(-9em -999em -9em 1px);clip-path:inset(-9em -999em -9em 1px)}[dir=rtl] .mat-mdc-form-field .mdc-notched-outline__notch{margin-left:0;margin-right:-1px;-webkit-clip-path:inset(-9em 1px -9em -999em);clip-path:inset(-9em 1px -9em -999em)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition-delay:40ms;transition-duration:110ms}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__affix{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled.mdc-ripple-upgraded--background-focused .mdc-text-field__ripple::before,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled:not(.mdc-ripple-upgraded):focus .mdc-text-field__ripple::before{transition-duration:75ms}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea{transition:none}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-filled 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-filled{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-outlined{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon{0%{transform:translateX(calc(0% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}}[dir=rtl] .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined[dir=rtl] .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon-rtl{0%{transform:translateX(calc(0% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-floating-label{transition:transform 150ms cubic-bezier(0.4, 0, 0.2, 1),color 150ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-standard 250ms 1}@keyframes mdc-floating-label-shake-float-above-standard{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-line-ripple::after{transition:transform 180ms cubic-bezier(0.4, 0, 0.2, 1),opacity 180ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-notched-outline .mdc-floating-label{max-width:calc(100% + 1px)}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:calc(133.3333333333% + 1px)}'],encapsulation:2,data:{animation:[oG.transitionMessages]},changeDetection:0})}return e})(),Oj=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({imports:[Wa,Wh,UB,Wa]})}return e})();const dG=new De("MAT_INPUT_VALUE_ACCESSOR"),uG=["button","checkbox","file","hidden","image","radio","range","reset","submit"];let hG=0;const pG=rH(class{constructor(e,n,t,o){this._defaultErrorStateMatcher=e,this._parentForm=n,this._parentFormGroup=t,this.ngControl=o,this.stateChanges=new rn}});let fG=(()=>{class e extends pG{get disabled(){return this._disabled}set disabled(t){this._disabled=oa(t),this.focused&&(this.focused=!1,this.stateChanges.next())}get id(){return this._id}set id(t){this._id=t||this._uid}get required(){return this._required??this.ngControl?.control?.hasValidator(Jd.required)??!1}set required(t){this._required=oa(t)}get type(){return this._type}set type(t){this._type=t||"text",this._validateType(),!this._isTextarea&&LB().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get value(){return this._inputValueAccessor.value}set value(t){t!==this.value&&(this._inputValueAccessor.value=t,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(t){this._readonly=oa(t)}constructor(t,o,c,u,f,_,v,S,R,k){super(_,u,f,c),this._elementRef=t,this._platform=o,this._autofillMonitor=S,this._formField=k,this._uid="mat-input-"+hG++,this.focused=!1,this.stateChanges=new rn,this.controlType="mat-input",this.autofilled=!1,this._disabled=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(z=>LB().has(z)),this._iOSKeyupListener=z=>{const X=z.target;!X.value&&0===X.selectionStart&&0===X.selectionEnd&&(X.setSelectionRange(1,1),X.setSelectionRange(0,0))};const U=this._elementRef.nativeElement,G=U.nodeName.toLowerCase();this._inputValueAccessor=v||U,this._previousNativeValue=this.value,this.id=this.id,o.IOS&&R.runOutsideAngular(()=>{t.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._isServer=!this._platform.isBrowser,this._isNativeSelect="select"===G,this._isTextarea="textarea"===G,this._isInFormField=!!k,this._isNativeSelect&&(this.controlType=U.multiple?"mat-native-select-multiple":"mat-native-select")}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(t=>{this.autofilled=t.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener)}ngDoCheck(){this.ngControl&&(this.updateErrorState(),null!==this.ngControl.disabled&&this.ngControl.disabled!==this.disabled&&(this.disabled=this.ngControl.disabled,this.stateChanges.next())),this._dirtyCheckNativeValue(),this._dirtyCheckPlaceholder()}focus(t){this._elementRef.nativeElement.focus(t)}_focusChanged(t){t!==this.focused&&(this.focused=t,this.stateChanges.next())}_onInput(){}_dirtyCheckNativeValue(){const t=this._elementRef.nativeElement.value;this._previousNativeValue!==t&&(this._previousNativeValue=t,this.stateChanges.next())}_dirtyCheckPlaceholder(){const t=this._getPlaceholder();if(t!==this._previousPlaceholder){const o=this._elementRef.nativeElement;this._previousPlaceholder=t,t?o.setAttribute("placeholder",t):o.removeAttribute("placeholder")}}_getPlaceholder(){return this.placeholder||null}_validateType(){uG.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){let t=this._elementRef.nativeElement.validity;return t&&t.badInput}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}get shouldLabelFloat(){if(this._isNativeSelect){const t=this._elementRef.nativeElement,o=t.options[0];return this.focused||t.multiple||!this.empty||!!(t.selectedIndex>-1&&o&&o.label)}return this.focused||!this.empty}setDescribedByIds(t){t.length?this._elementRef.nativeElement.setAttribute("aria-describedby",t.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}_isInlineSelect(){const t=this._elementRef.nativeElement;return this._isNativeSelect&&(t.multiple||t.size>1)}static#e=this.\u0275fac=function(o){return new(o||e)(re(bn),re(no),re(Qd,10),re(hP,8),re(lT,8),re(sH),re(dG,10),re(SH),re(lt),re(Ij,8))};static#t=this.\u0275dir=Ge({type:e,selectors:[["input","matInput",""],["textarea","matInput",""],["select","matNativeControl",""],["input","matNativeControl",""],["textarea","matNativeControl",""]],hostAttrs:[1,"mat-mdc-input-element"],hostVars:18,hostBindings:function(o,c){1&o&&en("focus",function(){return c._focusChanged(!0)})("blur",function(){return c._focusChanged(!1)})("input",function(){return c._onInput()}),2&o&&(gh("id",c.id)("disabled",c.disabled)("required",c.required),ii("name",c.name||null)("readonly",c.readonly&&!c._isNativeSelect||null)("aria-invalid",c.empty&&c.required?null:c.errorState)("aria-required",c.required)("id",c.id),Vt("mat-input-server",c._isServer)("mat-mdc-form-field-textarea-control",c._isInFormField&&c._isTextarea)("mat-mdc-form-field-input-control",c._isInFormField)("mdc-text-field__input",c._isInFormField)("mat-mdc-native-select-inline",c._isInlineSelect()))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["matInput"],features:[Lt([{provide:wj,useExisting:e}]),Ne,jo]})}return e})(),mG=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({imports:[Wa,Oj,Oj,CH,Wa]})}return e})();const _G=["switch"];function gG(e,n){1&e&&(Pe(0,"div",12),Go(),Pe(1,"svg",13),wt(2,"path",14),Re(),Pe(3,"svg",15),wt(4,"path",16),Re()())}const EG=["*"],vG=new De("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1,hideIcon:!1})}),yG={provide:F,useExisting:Cn(()=>Pj),multi:!0};class Nj{constructor(n,t){this.source=n,this.checked=t}}let bG=0;const SG=iH(nj(ij(tj(class{constructor(e){this._elementRef=e}}))));let CG=(()=>{class e extends SG{get required(){return this._required}set required(t){this._required=oa(t)}get checked(){return this._checked}set checked(t){this._checked=oa(t),this._changeDetectorRef.markForCheck()}get hideIcon(){return this._hideIcon}set hideIcon(t){this._hideIcon=oa(t)}get inputId(){return`${this.id||this._uniqueId}-input`}constructor(t,o,c,u,f,_,v){super(t),this._focusMonitor=o,this._changeDetectorRef=c,this.defaults=f,this._onChange=S=>{},this._onTouched=()=>{},this._required=!1,this._checked=!1,this.name=null,this.labelPosition="after",this.ariaLabel=null,this.ariaLabelledby=null,this._hideIcon=!1,this.change=new Zt,this.toggleChange=new Zt,this.tabIndex=parseInt(u)||0,this.color=this.defaultColor=f.color||"accent",this._noopAnimations="NoopAnimations"===_,this.id=this._uniqueId=`${v}${++bG}`,this._hideIcon=f.hideIcon??!1}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{"keyboard"===t||"program"===t?(this._focused=!0,this._changeDetectorRef.markForCheck()):t||Promise.resolve().then(()=>{this._focused=!1,this._onTouched(),this._changeDetectorRef.markForCheck()})})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}writeValue(t){this.checked=!!t}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this.disabled=t,this._changeDetectorRef.markForCheck()}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(this._createChangeEvent(this.checked))}static#e=this.\u0275fac=function(o){ld()};static#t=this.\u0275dir=Ge({type:e,inputs:{name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],required:"required",checked:"checked",hideIcon:"hideIcon"},outputs:{change:"change",toggleChange:"toggleChange"},features:[Ne]})}return e})(),Pj=(()=>{class e extends CG{get buttonId(){return`${this.id||this._uniqueId}-button`}constructor(t,o,c,u,f,_){super(t,o,c,u,f,_,"mat-mdc-slide-toggle-"),this._labelId=this._uniqueId+"-label"}_handleClick(){this.toggleChange.emit(),this.defaults.disableToggleValue||(this.checked=!this.checked,this._onChange(this.checked),this.change.emit(new Nj(this,this.checked)))}focus(){this._switchElement.nativeElement.focus()}_createChangeEvent(t){return new Nj(this,t)}_getAriaLabelledBy(){return this.ariaLabelledby?this.ariaLabelledby:this.ariaLabel?null:this._labelId}static#e=this.\u0275fac=function(o){return new(o||e)(re(bn),re(AF),re(rr),function Du(e){return function Hs(e,n){if("class"===n)return e.classes;if("style"===n)return e.styles;const t=e.attrs;if(t){const o=t.length;let c=0;for(;c<o;){const u=t[c];if(Nw(u))break;if(0===u)c+=2;else if("number"==typeof u)for(c++;c<o&&"string"==typeof t[c];)c++;else{if(u===n)return t[c+1];c+=2}}}return null}(pr(),e)}("tabindex"),re(vG),re(Sa,8))};static#t=this.\u0275cmp=Ct({type:e,selectors:[["mat-slide-toggle"]],viewQuery:function(o,c){if(1&o&&Js(_G,5),2&o){let u;$e(u=Bi())&&(c._switchElement=u.first)}},hostAttrs:[1,"mat-mdc-slide-toggle"],hostVars:11,hostBindings:function(o,c){2&o&&(gh("id",c.id),ii("tabindex",null)("aria-label",null)("name",null)("aria-labelledby",null),Vt("mat-mdc-slide-toggle-focused",c._focused)("mat-mdc-slide-toggle-checked",c.checked)("_mat-animation-noopable",c._noopAnimations))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color",tabIndex:"tabIndex"},exportAs:["matSlideToggle"],features:[Lt([yG]),Ne],ngContentSelectors:EG,decls:13,vars:25,consts:[[1,"mdc-form-field"],["role","switch","type","button",1,"mdc-switch",3,"tabIndex","disabled","click"],["switch",""],[1,"mdc-switch__track"],[1,"mdc-switch__handle-track"],[1,"mdc-switch__handle"],[1,"mdc-switch__shadow"],[1,"mdc-elevation-overlay"],[1,"mdc-switch__ripple"],["mat-ripple","",1,"mat-mdc-slide-toggle-ripple","mat-mdc-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],["class","mdc-switch__icons",4,"ngIf"],[1,"mdc-label",3,"for","click"],[1,"mdc-switch__icons"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--on"],["d","M19.69,5.23L8.96,15.96l-4.23-4.23L2.96,13.5l6,6L21.46,7L19.69,5.23z"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--off"],["d","M20 13H4v-2h16v2z"]],template:function(o,c){if(1&o&&(_d(),Pe(0,"div",0)(1,"button",1,2),en("click",function(){return c._handleClick()}),wt(3,"div",3),Pe(4,"div",4)(5,"div",5)(6,"div",6),wt(7,"div",7),Re(),Pe(8,"div",8),wt(9,"div",9),Re(),Fe(10,gG,5,0,"div",10),Re()()(),Pe(11,"label",11),en("click",function(f){return f.stopPropagation()}),nr(12),Re()()),2&o){const u=pd(2);Vt("mdc-form-field--align-end","before"==c.labelPosition),Je(1),Vt("mdc-switch--selected",c.checked)("mdc-switch--unselected",!c.checked)("mdc-switch--checked",c.checked)("mdc-switch--disabled",c.disabled),Qe("tabIndex",c.tabIndex)("disabled",c.disabled),ii("id",c.buttonId)("name",c.name)("aria-label",c.ariaLabel)("aria-labelledby",c._getAriaLabelledBy())("aria-describedby",c.ariaDescribedby)("aria-required",c.required||null)("aria-checked",c.checked),Je(8),Qe("matRippleTrigger",u)("matRippleDisabled",c.disableRipple||c.disabled)("matRippleCentered",!0),Je(1),Qe("ngIf",!c.hideIcon),Je(1),Qe("for",c.buttonId),ii("id",c._labelId)}},dependencies:[dj,qd],styles:['.mdc-form-field{display:inline-flex;align-items:center;vertical-align:middle}.mdc-form-field[hidden]{display:none}.mdc-form-field>label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0;order:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{margin-left:auto;margin-right:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{padding-left:0;padding-right:4px}.mdc-form-field--nowrap>label{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.mdc-form-field--align-end>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px;order:-1}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{margin-left:0;margin-right:auto}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{padding-left:4px;padding-right:0}.mdc-form-field--space-between{justify-content:space-between}.mdc-form-field--space-between>label{margin:0}[dir=rtl] .mdc-form-field--space-between>label,.mdc-form-field--space-between>label[dir=rtl]{margin:0}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1);background-color:var(--mdc-elevation-overlay-color)}.mdc-switch{align-items:center;background:none;border:none;cursor:pointer;display:inline-flex;flex-shrink:0;margin:0;outline:none;overflow:visible;padding:0;position:relative}.mdc-switch[hidden]{display:none}.mdc-switch:disabled{cursor:default;pointer-events:none}.mdc-switch__track{overflow:hidden;position:relative;width:100%}.mdc-switch__track::before,.mdc-switch__track::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";height:100%;left:0;position:absolute;width:100%}@media screen and (forced-colors: active){.mdc-switch__track::before,.mdc-switch__track::after{border-color:currentColor}}.mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(-100%)}[dir=rtl] .mdc-switch__track::after,.mdc-switch__track[dir=rtl]::after{transform:translateX(100%)}.mdc-switch--selected .mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__track::before,.mdc-switch--selected .mdc-switch__track[dir=rtl]::before{transform:translateX(-100%)}.mdc-switch--selected .mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__handle-track{height:100%;pointer-events:none;position:absolute;top:0;transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);left:0;right:auto;transform:translateX(0)}[dir=rtl] .mdc-switch__handle-track,.mdc-switch__handle-track[dir=rtl]{left:auto;right:0}.mdc-switch--selected .mdc-switch__handle-track{transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__handle-track,.mdc-switch--selected .mdc-switch__handle-track[dir=rtl]{transform:translateX(-100%)}.mdc-switch__handle{display:flex;pointer-events:auto;position:absolute;top:50%;transform:translateY(-50%);left:0;right:auto}[dir=rtl] .mdc-switch__handle,.mdc-switch__handle[dir=rtl]{left:auto;right:0}.mdc-switch__handle::before,.mdc-switch__handle::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";width:100%;height:100%;left:0;position:absolute;top:0;transition:background-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1),border-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);z-index:-1}@media screen and (forced-colors: active){.mdc-switch__handle::before,.mdc-switch__handle::after{border-color:currentColor}}.mdc-switch__shadow{border-radius:inherit;bottom:0;left:0;position:absolute;right:0;top:0}.mdc-elevation-overlay{bottom:0;left:0;right:0;top:0}.mdc-switch__ripple{left:50%;position:absolute;top:50%;transform:translate(-50%, -50%);z-index:-1}.mdc-switch:disabled .mdc-switch__ripple{display:none}.mdc-switch__icons{height:100%;position:relative;width:100%;z-index:1}.mdc-switch__icon{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0;opacity:0;transition:opacity 30ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-switch--selected .mdc-switch__icon--on,.mdc-switch--unselected .mdc-switch__icon--off{opacity:1;transition:opacity 45ms 30ms cubic-bezier(0, 0, 0.2, 1)}.mdc-switch{width:var(--mdc-switch-track-width);--mdc-switch-disabled-handle-opacity:0.38;--mdc-switch-disabled-selected-icon-opacity:0.38;--mdc-switch-disabled-track-opacity:0.12;--mdc-switch-disabled-unselected-icon-opacity:0.38;--mdc-switch-handle-height:20px;--mdc-switch-handle-shape:10px;--mdc-switch-handle-width:20px;--mdc-switch-selected-icon-size:18px;--mdc-switch-track-height:14px;--mdc-switch-track-shape:7px;--mdc-switch-track-width:36px;--mdc-switch-unselected-icon-size:18px;--mdc-switch-state-layer-size:40px;--mdc-switch-selected-focus-state-layer-opacity:0.12;--mdc-switch-selected-hover-state-layer-opacity:0.04;--mdc-switch-selected-pressed-state-layer-opacity:0.1;--mdc-switch-unselected-focus-state-layer-opacity:0.12;--mdc-switch-unselected-hover-state-layer-opacity:0.04;--mdc-switch-unselected-pressed-state-layer-opacity:0.1}.mdc-switch.mdc-switch--selected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-selected-handle-color)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-hover-handle-color)}.mdc-switch.mdc-switch--selected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-focus-handle-color)}.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-selected-pressed-handle-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-selected-handle-color)}.mdc-switch.mdc-switch--unselected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-unselected-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-hover-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-focus-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-unselected-pressed-handle-color)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-unselected-handle-color)}.mdc-switch .mdc-switch__handle::before{background:var(--mdc-switch-handle-surface-color)}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation)}.mdc-switch:disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation)}.mdc-switch .mdc-switch__focus-ring-wrapper,.mdc-switch .mdc-switch__handle{height:var(--mdc-switch-handle-height)}.mdc-switch:disabled .mdc-switch__handle::after{opacity:var(--mdc-switch-disabled-handle-opacity)}.mdc-switch .mdc-switch__handle{border-radius:var(--mdc-switch-handle-shape)}.mdc-switch .mdc-switch__handle{width:var(--mdc-switch-handle-width)}.mdc-switch .mdc-switch__handle-track{width:calc(100% - var(--mdc-switch-handle-width))}.mdc-switch.mdc-switch--selected:enabled .mdc-switch__icon{fill:var(--mdc-switch-selected-icon-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-selected-icon-color)}.mdc-switch.mdc-switch--unselected:enabled .mdc-switch__icon{fill:var(--mdc-switch-unselected-icon-color)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-unselected-icon-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-selected-icon-opacity)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-unselected-icon-opacity)}.mdc-switch.mdc-switch--selected .mdc-switch__icon{width:var(--mdc-switch-selected-icon-size);height:var(--mdc-switch-selected-icon-size)}.mdc-switch.mdc-switch--unselected .mdc-switch__icon{width:var(--mdc-switch-unselected-icon-size);height:var(--mdc-switch-unselected-icon-size)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-hover-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-focus-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-pressed-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-hover-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-focus-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-pressed-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-selected-hover-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-selected-focus-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-selected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-selected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-unselected-hover-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-unselected-focus-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity)}.mdc-switch .mdc-switch__ripple{height:var(--mdc-switch-state-layer-size);width:var(--mdc-switch-state-layer-size)}.mdc-switch .mdc-switch__track{height:var(--mdc-switch-track-height)}.mdc-switch:disabled .mdc-switch__track{opacity:var(--mdc-switch-disabled-track-opacity)}.mdc-switch:enabled .mdc-switch__track::after{background:var(--mdc-switch-selected-track-color)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-hover-track-color)}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-focus-track-color)}.mdc-switch:enabled:active .mdc-switch__track::after{background:var(--mdc-switch-selected-pressed-track-color)}.mdc-switch:disabled .mdc-switch__track::after{background:var(--mdc-switch-disabled-selected-track-color)}.mdc-switch:enabled .mdc-switch__track::before{background:var(--mdc-switch-unselected-track-color)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-hover-track-color)}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-focus-track-color)}.mdc-switch:enabled:active .mdc-switch__track::before{background:var(--mdc-switch-unselected-pressed-track-color)}.mdc-switch:disabled .mdc-switch__track::before{background:var(--mdc-switch-disabled-unselected-track-color)}.mdc-switch .mdc-switch__track{border-radius:var(--mdc-switch-track-shape)}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation-shadow)}.mdc-switch:disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation-shadow)}.mat-mdc-slide-toggle .mdc-label{font-family:var(--mat-slide-toggle-label-text-font);font-size:var(--mat-slide-toggle-label-text-size);letter-spacing:var(--mat-slide-toggle-label-text-tracking);line-height:var(--mat-slide-toggle-label-text-line-height);font-weight:var(--mat-slide-toggle-label-text-weight)}.mat-mdc-slide-toggle{display:inline-block;-webkit-tap-highlight-color:rgba(0,0,0,0);outline:0}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple,.mat-mdc-slide-toggle .mdc-switch__ripple::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:50%;pointer-events:none}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple:not(:empty),.mat-mdc-slide-toggle .mdc-switch__ripple::after:not(:empty){transform:translateZ(0)}.mat-mdc-slide-toggle .mdc-switch__ripple::after{content:"";opacity:0}.mat-mdc-slide-toggle .mdc-switch:hover .mdc-switch__ripple::after{opacity:.04;transition:opacity 75ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mdc-switch .mdc-switch__ripple::after{opacity:.12}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mat-mdc-focus-indicator::before{content:""}.mat-mdc-slide-toggle .mat-ripple-element{opacity:.12}.mat-mdc-slide-toggle .mat-mdc-focus-indicator::before{border-radius:50%}.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle-track,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-elevation-overlay,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__icon,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::after,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::after{transition:none}.mat-mdc-slide-toggle .mdc-switch:enabled+.mdc-label{cursor:pointer}'],encapsulation:2,changeDetection:0})}return e})(),xj=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({})}return e})(),IG=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({imports:[xj,Wa,uj,Wh,xj,Wa]})}return e})();const RG=["addListener","removeListener"],AG=["addEventListener","removeEventListener"],DG=["on","off"];function FF(e,n,t,o){if(M(t)&&(o=t,t=void 0),o)return FF(e,n,t).pipe(ge(o));const[c,u]=function PG(e){return M(e.addEventListener)&&M(e.removeEventListener)}(e)?AG.map(f=>_=>e[f](n,_,t)):function OG(e){return M(e.addListener)&&M(e.removeListener)}(e)?RG.map(Mj(e,n)):function NG(e){return M(e.on)&&M(e.off)}(e)?DG.map(Mj(e,n)):[];if(!c&&ey(e))return yi(f=>FF(f,n,t))(qi(e));if(!c)throw new TypeError("Invalid event target");return new Ln(f=>{const _=(...v)=>f.next(1<v.length?v:v[0]);return c(_),()=>u(_)})}function Mj(e,n){return t=>o=>e[t](n,o)}const gT={schedule(e){let n=requestAnimationFrame,t=cancelAnimationFrame;const{delegate:o}=gT;o&&(n=o.requestAnimationFrame,t=o.cancelAnimationFrame);const c=n(u=>{t=void 0,e(u)});return new kn(()=>t?.(c))},requestAnimationFrame(...e){const{delegate:n}=gT;return(n?.requestAnimationFrame||requestAnimationFrame)(...e)},cancelAnimationFrame(...e){const{delegate:n}=gT;return(n?.cancelAnimationFrame||cancelAnimationFrame)(...e)},delegate:void 0};new class MG extends TF{flush(n){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:o}=this;let c;n=n||o.shift();do{if(c=n.execute(n.state,n.delay))break}while((n=o[0])&&n.id===t&&o.shift());if(this._active=!1,c){for(;(n=o[0])&&n.id===t&&o.shift();)n.unsubscribe();throw c}}}(class xG extends SF{constructor(n,t){super(n,t),this.scheduler=n,this.work=t}requestAsyncId(n,t,o=0){return null!==o&&o>0?super.requestAsyncId(n,t,o):(n.actions.push(this),n._scheduled||(n._scheduled=gT.requestAnimationFrame(()=>n.flush(void 0))))}recycleAsyncId(n,t,o=0){var c;if(null!=o?o>0:this.delay>0)return super.recycleAsyncId(n,t,o);const{actions:u}=n;null!=t&&(null===(c=u[u.length-1])||void 0===c?void 0:c.id)!==t&&(gT.cancelAnimationFrame(t),n._scheduled=void 0)}});let UF,LG=1;const TP={};function kj(e){return e in TP&&(delete TP[e],!0)}const FG={setImmediate(e){const n=LG++;return TP[n]=!0,UF||(UF=Promise.resolve()),UF.then(()=>kj(n)&&e()),n},clearImmediate(e){kj(e)}},{setImmediate:UG,clearImmediate:VG}=FG,wP={setImmediate(...e){const{delegate:n}=wP;return(n?.setImmediate||UG)(...e)},clearImmediate(e){const{delegate:n}=wP;return(n?.clearImmediate||VG)(e)},delegate:void 0};new class jG extends TF{flush(n){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:o}=this;let c;n=n||o.shift();do{if(c=n.execute(n.state,n.delay))break}while((n=o[0])&&n.id===t&&o.shift());if(this._active=!1,c){for(;(n=o[0])&&n.id===t&&o.shift();)n.unsubscribe();throw c}}}(class BG extends SF{constructor(n,t){super(n,t),this.scheduler=n,this.work=t}requestAsyncId(n,t,o=0){return null!==o&&o>0?super.requestAsyncId(n,t,o):(n.actions.push(this),n._scheduled||(n._scheduled=wP.setImmediate(n.flush.bind(n,void 0))))}recycleAsyncId(n,t,o=0){var c;if(null!=o?o>0:this.delay>0)return super.recycleAsyncId(n,t,o);const{actions:u}=n;null!=t&&(null===(c=u[u.length-1])||void 0===c?void 0:c.id)!==t&&(wP.clearImmediate(t),n._scheduled===t&&(n._scheduled=void 0))}});function Lj(e,n=wF){return function GG(e){return hi((n,t)=>{let o=!1,c=null,u=null,f=!1;const _=()=>{if(u?.unsubscribe(),u=null,o){o=!1;const S=c;c=null,t.next(S)}f&&t.complete()},v=()=>{u=null,f&&t.complete()};n.subscribe(Jn(t,S=>{o=!0,c=S,u||qi(e(S)).subscribe(u=Jn(t,_,v))},()=>{f=!0,(!o||!u||u.closed)&&t.complete()}))})}(()=>function zG(e=0,n,t=N8){let o=-1;return null!=n&&(pw(n)?t=n:o=n),new Ln(c=>{let u=function WG(e){return e instanceof Date&&!isNaN(e)}(e)?+e-t.now():e;u<0&&(u=0);let f=0;return t.schedule(function(){c.closed||(c.next(f++),0<=o?this.schedule(void 0,o):c.complete())},u)})}(e,n))}let Fj=(()=>{class e{constructor(t,o,c){this._ngZone=t,this._platform=o,this._scrolled=new rn,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=c}register(t){this.scrollContainers.has(t)||this.scrollContainers.set(t,t.elementScrolled().subscribe(()=>this._scrolled.next(t)))}deregister(t){const o=this.scrollContainers.get(t);o&&(o.unsubscribe(),this.scrollContainers.delete(t))}scrolled(t=20){return this._platform.isBrowser?new Ln(o=>{this._globalSubscription||this._addGlobalListener();const c=t>0?this._scrolled.pipe(Lj(t)).subscribe(o):this._scrolled.subscribe(o);return this._scrolledCount++,()=>{c.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):He()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((t,o)=>this.deregister(o)),this._scrolled.complete()}ancestorScrolled(t,o){const c=this.getAncestorScrollContainers(t);return this.scrolled(o).pipe(ra(u=>!u||c.indexOf(u)>-1))}getAncestorScrollContainers(t){const o=[];return this.scrollContainers.forEach((c,u)=>{this._scrollableContainsElement(u,t)&&o.push(u)}),o}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(t,o){let c=Qh(o),u=t.getElementRef().nativeElement;do{if(c==u)return!0}while(c=c.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>FF(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}static#e=this.\u0275fac=function(o){return new(o||e)(fe(lt),fe(no),fe(Kt,8))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Uj=(()=>{class e{constructor(t,o,c){this._platform=t,this._change=new rn,this._changeListener=u=>{this._change.next(u)},this._document=c,o.runOutsideAngular(()=>{if(t.isBrowser){const u=this._getWindow();u.addEventListener("resize",this._changeListener),u.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const t=this._getWindow();t.removeEventListener("resize",this._changeListener),t.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const t={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),t}getViewportRect(){const t=this.getViewportScrollPosition(),{width:o,height:c}=this.getViewportSize();return{top:t.top,left:t.left,bottom:t.top+c,right:t.left+o,height:c,width:o}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const t=this._document,o=this._getWindow(),c=t.documentElement,u=c.getBoundingClientRect();return{top:-u.top||t.body.scrollTop||o.scrollY||c.scrollTop||0,left:-u.left||t.body.scrollLeft||o.scrollX||c.scrollLeft||0}}change(t=20){return t>0?this._change.pipe(Lj(t)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const t=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:t.innerWidth,height:t.innerHeight}:{width:0,height:0}}static#e=this.\u0275fac=function(o){return new(o||e)(fe(no),fe(lt),fe(Kt,8))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),VF=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({})}return e})(),Vj=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({imports:[hT,VF,hT,VF]})}return e})();class BF{attach(n){return this._attachedHost=n,n.attach(this)}detach(){let n=this._attachedHost;null!=n&&(this._attachedHost=null,n.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(n){this._attachedHost=n}}class Bj extends BF{constructor(n,t,o,c,u){super(),this.component=n,this.viewContainerRef=t,this.injector=o,this.componentFactoryResolver=c,this.projectableNodes=u}}class YG extends BF{constructor(n,t,o,c){super(),this.templateRef=n,this.viewContainerRef=t,this.context=o,this.injector=c}get origin(){return this.templateRef.elementRef}attach(n,t=this.context){return this.context=t,super.attach(n)}detach(){return this.context=void 0,super.detach()}}class $G extends BF{constructor(n){super(),this.element=n instanceof bn?n.nativeElement:n}}class XG{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(n){return n instanceof Bj?(this._attachedPortal=n,this.attachComponentPortal(n)):n instanceof YG?(this._attachedPortal=n,this.attachTemplatePortal(n)):this.attachDomPortal&&n instanceof $G?(this._attachedPortal=n,this.attachDomPortal(n)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(n){this._disposeFn=n}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class JG extends XG{constructor(n,t,o,c,u){super(),this.outletElement=n,this._componentFactoryResolver=t,this._appRef=o,this._defaultInjector=c,this.attachDomPortal=f=>{const _=f.element,v=this._document.createComment("dom-portal");_.parentNode.insertBefore(v,_),this.outletElement.appendChild(_),this._attachedPortal=f,super.setDisposeFn(()=>{v.parentNode&&v.parentNode.replaceChild(_,v)})},this._document=u}attachComponentPortal(n){const o=(n.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(n.component);let c;return n.viewContainerRef?(c=n.viewContainerRef.createComponent(o,n.viewContainerRef.length,n.injector||n.viewContainerRef.injector,n.projectableNodes||void 0),this.setDisposeFn(()=>c.destroy())):(c=o.create(n.injector||this._defaultInjector||tr.NULL),this._appRef.attachView(c.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(c.hostView),c.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(c)),this._attachedPortal=n,c}attachTemplatePortal(n){let t=n.viewContainerRef,o=t.createEmbeddedView(n.templateRef,n.context,{injector:n.injector});return o.rootNodes.forEach(c=>this.outletElement.appendChild(c)),o.detectChanges(),this.setDisposeFn(()=>{let c=t.indexOf(o);-1!==c&&t.remove(c)}),this._attachedPortal=n,o}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(n){return n.hostView.rootNodes[0]}}let QG=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({})}return e})();const jj=_8();class ZG{constructor(n,t){this._viewportRuler=n,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=t}attach(){}enable(){if(this._canBeEnabled()){const n=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=n.style.left||"",this._previousHTMLStyles.top=n.style.top||"",n.style.left=ar(-this._previousScrollPosition.left),n.style.top=ar(-this._previousScrollPosition.top),n.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const n=this._document.documentElement,o=n.style,c=this._document.body.style,u=o.scrollBehavior||"",f=c.scrollBehavior||"";this._isEnabled=!1,o.left=this._previousHTMLStyles.left,o.top=this._previousHTMLStyles.top,n.classList.remove("cdk-global-scrollblock"),jj&&(o.scrollBehavior=c.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),jj&&(o.scrollBehavior=u,c.scrollBehavior=f)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const t=this._document.body,o=this._viewportRuler.getViewportSize();return t.scrollHeight>o.height||t.scrollWidth>o.width}}class eW{constructor(n,t,o,c){this._scrollDispatcher=n,this._ngZone=t,this._viewportRuler=o,this._config=c,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(n){this._overlayRef=n}enable(){if(this._scrollSubscription)return;const n=this._scrollDispatcher.scrolled(0).pipe(ra(t=>!t||!this._overlayRef.overlayElement.contains(t.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=n.subscribe(()=>{const t=this._viewportRuler.getViewportScrollPosition().top;Math.abs(t-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=n.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class Hj{enable(){}disable(){}attach(){}}function jF(e,n){return n.some(t=>e.bottom<t.top||e.top>t.bottom||e.right<t.left||e.left>t.right)}function Gj(e,n){return n.some(t=>e.top<t.top||e.bottom>t.bottom||e.left<t.left||e.right>t.right)}class tW{constructor(n,t,o,c){this._scrollDispatcher=n,this._viewportRuler=t,this._ngZone=o,this._config=c,this._scrollSubscription=null}attach(n){this._overlayRef=n}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const t=this._overlayRef.overlayElement.getBoundingClientRect(),{width:o,height:c}=this._viewportRuler.getViewportSize();jF(t,[{width:o,height:c,bottom:c,right:o,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let nW=(()=>{class e{constructor(t,o,c,u){this._scrollDispatcher=t,this._viewportRuler=o,this._ngZone=c,this.noop=()=>new Hj,this.close=f=>new eW(this._scrollDispatcher,this._ngZone,this._viewportRuler,f),this.block=()=>new ZG(this._viewportRuler,this._document),this.reposition=f=>new tW(this._scrollDispatcher,this._viewportRuler,this._ngZone,f),this._document=u}static#e=this.\u0275fac=function(o){return new(o||e)(fe(Fj),fe(Uj),fe(lt),fe(Kt))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class iW{constructor(n){if(this.scrollStrategy=new Hj,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,n){const t=Object.keys(n);for(const o of t)void 0!==n[o]&&(this[o]=n[o])}}}class rW{constructor(n,t){this.connectionPair=n,this.scrollableViewProperties=t}}let Wj=(()=>{class e{constructor(t){this._attachedOverlays=[],this._document=t}ngOnDestroy(){this.detach()}add(t){this.remove(t),this._attachedOverlays.push(t)}remove(t){const o=this._attachedOverlays.indexOf(t);o>-1&&this._attachedOverlays.splice(o,1),0===this._attachedOverlays.length&&this.detach()}static#e=this.\u0275fac=function(o){return new(o||e)(fe(Kt))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),oW=(()=>{class e extends Wj{constructor(t,o){super(t),this._ngZone=o,this._keydownListener=c=>{const u=this._attachedOverlays;for(let f=u.length-1;f>-1;f--)if(u[f]._keydownEvents.observers.length>0){const _=u[f]._keydownEvents;this._ngZone?this._ngZone.run(()=>_.next(c)):_.next(c);break}}}add(t){super.add(t),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}static#e=this.\u0275fac=function(o){return new(o||e)(fe(Kt),fe(lt,8))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),sW=(()=>{class e extends Wj{constructor(t,o,c){super(t),this._platform=o,this._ngZone=c,this._cursorStyleIsSet=!1,this._pointerDownListener=u=>{this._pointerDownEventTarget=Jh(u)},this._clickListener=u=>{const f=Jh(u),_="click"===u.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:f;this._pointerDownEventTarget=null;const v=this._attachedOverlays.slice();for(let S=v.length-1;S>-1;S--){const R=v[S];if(R._outsidePointerEvents.observers.length<1||!R.hasAttached())continue;if(R.overlayElement.contains(f)||R.overlayElement.contains(_))break;const k=R._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>k.next(u)):k.next(u)}}}add(t){if(super.add(t),!this._isAttached){const o=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(o)):this._addEventListeners(o),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=o.style.cursor,o.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const t=this._document.body;t.removeEventListener("pointerdown",this._pointerDownListener,!0),t.removeEventListener("click",this._clickListener,!0),t.removeEventListener("auxclick",this._clickListener,!0),t.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(t.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(t){t.addEventListener("pointerdown",this._pointerDownListener,!0),t.addEventListener("click",this._clickListener,!0),t.addEventListener("auxclick",this._clickListener,!0),t.addEventListener("contextmenu",this._clickListener,!0)}static#e=this.\u0275fac=function(o){return new(o||e)(fe(Kt),fe(no),fe(lt,8))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),zj=(()=>{class e{constructor(t,o){this._platform=o,this._document=t}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const t="cdk-overlay-container";if(this._platform.isBrowser||yF()){const c=this._document.querySelectorAll(`.${t}[platform="server"], .${t}[platform="test"]`);for(let u=0;u<c.length;u++)c[u].remove()}const o=this._document.createElement("div");o.classList.add(t),yF()?o.setAttribute("platform","test"):this._platform.isBrowser||o.setAttribute("platform","server"),this._document.body.appendChild(o),this._containerElement=o}static#e=this.\u0275fac=function(o){return new(o||e)(fe(Kt),fe(no))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class aW{constructor(n,t,o,c,u,f,_,v,S,R=!1){this._portalOutlet=n,this._host=t,this._pane=o,this._config=c,this._ngZone=u,this._keyboardDispatcher=f,this._document=_,this._location=v,this._outsideClickDispatcher=S,this._animationsDisabled=R,this._backdropElement=null,this._backdropClick=new rn,this._attachments=new rn,this._detachments=new rn,this._locationChanges=kn.EMPTY,this._backdropClickHandler=k=>this._backdropClick.next(k),this._backdropTransitionendHandler=k=>{this._disposeBackdrop(k.target)},this._keydownEvents=new rn,this._outsidePointerEvents=new rn,c.scrollStrategy&&(this._scrollStrategy=c.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=c.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(n){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const t=this._portalOutlet.attach(n);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Zd(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof t?.onDestroy&&t.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),t}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const n=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),n}dispose(){const n=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,n&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(n){n!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=n,this.hasAttached()&&(n.attach(this),this.updatePosition()))}updateSize(n){this._config={...this._config,...n},this._updateElementSize()}setDirection(n){this._config={...this._config,direction:n},this._updateElementDirection()}addPanelClass(n){this._pane&&this._toggleClasses(this._pane,n,!0)}removePanelClass(n){this._pane&&this._toggleClasses(this._pane,n,!1)}getDirection(){const n=this._config.direction;return n?"string"==typeof n?n:n.value:"ltr"}updateScrollStrategy(n){n!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=n,this.hasAttached()&&(n.attach(this),n.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const n=this._pane.style;n.width=ar(this._config.width),n.height=ar(this._config.height),n.minWidth=ar(this._config.minWidth),n.minHeight=ar(this._config.minHeight),n.maxWidth=ar(this._config.maxWidth),n.maxHeight=ar(this._config.maxHeight)}_togglePointerEvents(n){this._pane.style.pointerEvents=n?"":"none"}_attachBackdrop(){const n="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(n)})}):this._backdropElement.classList.add(n)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const n=this._backdropElement;if(n){if(this._animationsDisabled)return void this._disposeBackdrop(n);n.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{n.addEventListener("transitionend",this._backdropTransitionendHandler)}),n.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(n)},500))}}_toggleClasses(n,t,o){const c=fP(t||[]).filter(u=>!!u);c.length&&(o?n.classList.add(...c):n.classList.remove(...c))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const n=this._ngZone.onStable.pipe(No(ry(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),n.unsubscribe())})})}_disposeScrollStrategy(){const n=this._scrollStrategy;n&&(n.disable(),n.detach&&n.detach())}_disposeBackdrop(n){n&&(n.removeEventListener("click",this._backdropClickHandler),n.removeEventListener("transitionend",this._backdropTransitionendHandler),n.remove(),this._backdropElement===n&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const qj="cdk-overlay-connected-position-bounding-box",cW=/([A-Za-z%]+)$/;class lW{get positions(){return this._preferredPositions}constructor(n,t,o,c,u){this._viewportRuler=t,this._document=o,this._platform=c,this._overlayContainer=u,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new rn,this._resizeSubscription=kn.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(n)}attach(n){this._validatePositions(),n.hostElement.classList.add(qj),this._overlayRef=n,this._boundingBox=n.hostElement,this._pane=n.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const n=this._originRect,t=this._overlayRect,o=this._viewportRect,c=this._containerRect,u=[];let f;for(let _ of this._preferredPositions){let v=this._getOriginPoint(n,c,_),S=this._getOverlayPoint(v,t,_),R=this._getOverlayFit(S,t,o,_);if(R.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(_,v);this._canFitWithFlexibleDimensions(R,S,o)?u.push({position:_,origin:v,overlayRect:t,boundingBoxRect:this._calculateBoundingBoxRect(v,_)}):(!f||f.overlayFit.visibleArea<R.visibleArea)&&(f={overlayFit:R,overlayPoint:S,originPoint:v,position:_,overlayRect:t})}if(u.length){let _=null,v=-1;for(const S of u){const R=S.boundingBoxRect.width*S.boundingBoxRect.height*(S.position.weight||1);R>v&&(v=R,_=S)}return this._isPushed=!1,void this._applyPosition(_.position,_.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(f.position,f.originPoint);this._applyPosition(f.position,f.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&vm(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(qj),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const n=this._lastPosition;if(n){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._getOriginPoint(this._originRect,this._containerRect,n);this._applyPosition(n,t)}else this.apply()}withScrollableContainers(n){return this._scrollables=n,this}withPositions(n){return this._preferredPositions=n,-1===n.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(n){return this._viewportMargin=n,this}withFlexibleDimensions(n=!0){return this._hasFlexibleDimensions=n,this}withGrowAfterOpen(n=!0){return this._growAfterOpen=n,this}withPush(n=!0){return this._canPush=n,this}withLockedPosition(n=!0){return this._positionLocked=n,this}setOrigin(n){return this._origin=n,this}withDefaultOffsetX(n){return this._offsetX=n,this}withDefaultOffsetY(n){return this._offsetY=n,this}withTransformOriginOn(n){return this._transformOriginSelector=n,this}_getOriginPoint(n,t,o){let c,u;if("center"==o.originX)c=n.left+n.width/2;else{const f=this._isRtl()?n.right:n.left,_=this._isRtl()?n.left:n.right;c="start"==o.originX?f:_}return t.left<0&&(c-=t.left),u="center"==o.originY?n.top+n.height/2:"top"==o.originY?n.top:n.bottom,t.top<0&&(u-=t.top),{x:c,y:u}}_getOverlayPoint(n,t,o){let c,u;return c="center"==o.overlayX?-t.width/2:"start"===o.overlayX?this._isRtl()?-t.width:0:this._isRtl()?0:-t.width,u="center"==o.overlayY?-t.height/2:"top"==o.overlayY?0:-t.height,{x:n.x+c,y:n.y+u}}_getOverlayFit(n,t,o,c){const u=Yj(t);let{x:f,y:_}=n,v=this._getOffset(c,"x"),S=this._getOffset(c,"y");v&&(f+=v),S&&(_+=S);let U=0-_,G=_+u.height-o.height,z=this._subtractOverflows(u.width,0-f,f+u.width-o.width),X=this._subtractOverflows(u.height,U,G),le=z*X;return{visibleArea:le,isCompletelyWithinViewport:u.width*u.height===le,fitsInViewportVertically:X===u.height,fitsInViewportHorizontally:z==u.width}}_canFitWithFlexibleDimensions(n,t,o){if(this._hasFlexibleDimensions){const c=o.bottom-t.y,u=o.right-t.x,f=Kj(this._overlayRef.getConfig().minHeight),_=Kj(this._overlayRef.getConfig().minWidth);return(n.fitsInViewportVertically||null!=f&&f<=c)&&(n.fitsInViewportHorizontally||null!=_&&_<=u)}return!1}_pushOverlayOnScreen(n,t,o){if(this._previousPushAmount&&this._positionLocked)return{x:n.x+this._previousPushAmount.x,y:n.y+this._previousPushAmount.y};const c=Yj(t),u=this._viewportRect,f=Math.max(n.x+c.width-u.width,0),_=Math.max(n.y+c.height-u.height,0),v=Math.max(u.top-o.top-n.y,0),S=Math.max(u.left-o.left-n.x,0);let R=0,k=0;return R=c.width<=u.width?S||-f:n.x<this._viewportMargin?u.left-o.left-n.x:0,k=c.height<=u.height?v||-_:n.y<this._viewportMargin?u.top-o.top-n.y:0,this._previousPushAmount={x:R,y:k},{x:n.x+R,y:n.y+k}}_applyPosition(n,t){if(this._setTransformOrigin(n),this._setOverlayElementStyles(t,n),this._setBoundingBoxStyles(t,n),n.panelClass&&this._addPanelClasses(n.panelClass),this._lastPosition=n,this._positionChanges.observers.length){const o=this._getScrollVisibility(),c=new rW(n,o);this._positionChanges.next(c)}this._isInitialRender=!1}_setTransformOrigin(n){if(!this._transformOriginSelector)return;const t=this._boundingBox.querySelectorAll(this._transformOriginSelector);let o,c=n.overlayY;o="center"===n.overlayX?"center":this._isRtl()?"start"===n.overlayX?"right":"left":"start"===n.overlayX?"left":"right";for(let u=0;u<t.length;u++)t[u].style.transformOrigin=`${o} ${c}`}_calculateBoundingBoxRect(n,t){const o=this._viewportRect,c=this._isRtl();let u,f,_,R,k,U;if("top"===t.overlayY)f=n.y,u=o.height-f+this._viewportMargin;else if("bottom"===t.overlayY)_=o.height-n.y+2*this._viewportMargin,u=o.height-_+this._viewportMargin;else{const G=Math.min(o.bottom-n.y+o.top,n.y),z=this._lastBoundingBoxSize.height;u=2*G,f=n.y-G,u>z&&!this._isInitialRender&&!this._growAfterOpen&&(f=n.y-z/2)}if("end"===t.overlayX&&!c||"start"===t.overlayX&&c)U=o.width-n.x+this._viewportMargin,R=n.x-this._viewportMargin;else if("start"===t.overlayX&&!c||"end"===t.overlayX&&c)k=n.x,R=o.right-n.x;else{const G=Math.min(o.right-n.x+o.left,n.x),z=this._lastBoundingBoxSize.width;R=2*G,k=n.x-G,R>z&&!this._isInitialRender&&!this._growAfterOpen&&(k=n.x-z/2)}return{top:f,left:k,bottom:_,right:U,width:R,height:u}}_setBoundingBoxStyles(n,t){const o=this._calculateBoundingBoxRect(n,t);!this._isInitialRender&&!this._growAfterOpen&&(o.height=Math.min(o.height,this._lastBoundingBoxSize.height),o.width=Math.min(o.width,this._lastBoundingBoxSize.width));const c={};if(this._hasExactPosition())c.top=c.left="0",c.bottom=c.right=c.maxHeight=c.maxWidth="",c.width=c.height="100%";else{const u=this._overlayRef.getConfig().maxHeight,f=this._overlayRef.getConfig().maxWidth;c.height=ar(o.height),c.top=ar(o.top),c.bottom=ar(o.bottom),c.width=ar(o.width),c.left=ar(o.left),c.right=ar(o.right),c.alignItems="center"===t.overlayX?"center":"end"===t.overlayX?"flex-end":"flex-start",c.justifyContent="center"===t.overlayY?"center":"bottom"===t.overlayY?"flex-end":"flex-start",u&&(c.maxHeight=ar(u)),f&&(c.maxWidth=ar(f))}this._lastBoundingBoxSize=o,vm(this._boundingBox.style,c)}_resetBoundingBoxStyles(){vm(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){vm(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(n,t){const o={},c=this._hasExactPosition(),u=this._hasFlexibleDimensions,f=this._overlayRef.getConfig();if(c){const R=this._viewportRuler.getViewportScrollPosition();vm(o,this._getExactOverlayY(t,n,R)),vm(o,this._getExactOverlayX(t,n,R))}else o.position="static";let _="",v=this._getOffset(t,"x"),S=this._getOffset(t,"y");v&&(_+=`translateX(${v}px) `),S&&(_+=`translateY(${S}px)`),o.transform=_.trim(),f.maxHeight&&(c?o.maxHeight=ar(f.maxHeight):u&&(o.maxHeight="")),f.maxWidth&&(c?o.maxWidth=ar(f.maxWidth):u&&(o.maxWidth="")),vm(this._pane.style,o)}_getExactOverlayY(n,t,o){let c={top:"",bottom:""},u=this._getOverlayPoint(t,this._overlayRect,n);return this._isPushed&&(u=this._pushOverlayOnScreen(u,this._overlayRect,o)),"bottom"===n.overlayY?c.bottom=this._document.documentElement.clientHeight-(u.y+this._overlayRect.height)+"px":c.top=ar(u.y),c}_getExactOverlayX(n,t,o){let f,c={left:"",right:""},u=this._getOverlayPoint(t,this._overlayRect,n);return this._isPushed&&(u=this._pushOverlayOnScreen(u,this._overlayRect,o)),f=this._isRtl()?"end"===n.overlayX?"left":"right":"end"===n.overlayX?"right":"left","right"===f?c.right=this._document.documentElement.clientWidth-(u.x+this._overlayRect.width)+"px":c.left=ar(u.x),c}_getScrollVisibility(){const n=this._getOriginRect(),t=this._pane.getBoundingClientRect(),o=this._scrollables.map(c=>c.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:Gj(n,o),isOriginOutsideView:jF(n,o),isOverlayClipped:Gj(t,o),isOverlayOutsideView:jF(t,o)}}_subtractOverflows(n,...t){return t.reduce((o,c)=>o-Math.max(c,0),n)}_getNarrowedViewportRect(){const n=this._document.documentElement.clientWidth,t=this._document.documentElement.clientHeight,o=this._viewportRuler.getViewportScrollPosition();return{top:o.top+this._viewportMargin,left:o.left+this._viewportMargin,right:o.left+n-this._viewportMargin,bottom:o.top+t-this._viewportMargin,width:n-2*this._viewportMargin,height:t-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(n,t){return"x"===t?null==n.offsetX?this._offsetX:n.offsetX:null==n.offsetY?this._offsetY:n.offsetY}_validatePositions(){}_addPanelClasses(n){this._pane&&fP(n).forEach(t=>{""!==t&&-1===this._appliedPanelClasses.indexOf(t)&&(this._appliedPanelClasses.push(t),this._pane.classList.add(t))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(n=>{this._pane.classList.remove(n)}),this._appliedPanelClasses=[])}_getOriginRect(){const n=this._origin;if(n instanceof bn)return n.nativeElement.getBoundingClientRect();if(n instanceof Element)return n.getBoundingClientRect();const t=n.width||0,o=n.height||0;return{top:n.y,bottom:n.y+o,left:n.x,right:n.x+t,height:o,width:t}}}function vm(e,n){for(let t in n)n.hasOwnProperty(t)&&(e[t]=n[t]);return e}function Kj(e){if("number"!=typeof e&&null!=e){const[n,t]=e.split(cW);return t&&"px"!==t?null:parseFloat(n)}return e||null}function Yj(e){return{top:Math.floor(e.top),right:Math.floor(e.right),bottom:Math.floor(e.bottom),left:Math.floor(e.left),width:Math.floor(e.width),height:Math.floor(e.height)}}const $j="cdk-global-overlay-wrapper";class dW{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(n){const t=n.getConfig();this._overlayRef=n,this._width&&!t.width&&n.updateSize({width:this._width}),this._height&&!t.height&&n.updateSize({height:this._height}),n.hostElement.classList.add($j),this._isDisposed=!1}top(n=""){return this._bottomOffset="",this._topOffset=n,this._alignItems="flex-start",this}left(n=""){return this._xOffset=n,this._xPosition="left",this}bottom(n=""){return this._topOffset="",this._bottomOffset=n,this._alignItems="flex-end",this}right(n=""){return this._xOffset=n,this._xPosition="right",this}start(n=""){return this._xOffset=n,this._xPosition="start",this}end(n=""){return this._xOffset=n,this._xPosition="end",this}width(n=""){return this._overlayRef?this._overlayRef.updateSize({width:n}):this._width=n,this}height(n=""){return this._overlayRef?this._overlayRef.updateSize({height:n}):this._height=n,this}centerHorizontally(n=""){return this.left(n),this._xPosition="center",this}centerVertically(n=""){return this.top(n),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const n=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement.style,o=this._overlayRef.getConfig(),{width:c,height:u,maxWidth:f,maxHeight:_}=o,v=!("100%"!==c&&"100vw"!==c||f&&"100%"!==f&&"100vw"!==f),S=!("100%"!==u&&"100vh"!==u||_&&"100%"!==_&&"100vh"!==_),R=this._xPosition,k=this._xOffset,U="rtl"===this._overlayRef.getConfig().direction;let G="",z="",X="";v?X="flex-start":"center"===R?(X="center",U?z=k:G=k):U?"left"===R||"end"===R?(X="flex-end",G=k):("right"===R||"start"===R)&&(X="flex-start",z=k):"left"===R||"start"===R?(X="flex-start",G=k):("right"===R||"end"===R)&&(X="flex-end",z=k),n.position=this._cssPosition,n.marginLeft=v?"0":G,n.marginTop=S?"0":this._topOffset,n.marginBottom=this._bottomOffset,n.marginRight=v?"0":z,t.justifyContent=X,t.alignItems=S?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const n=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement,o=t.style;t.classList.remove($j),o.justifyContent=o.alignItems=n.marginTop=n.marginBottom=n.marginLeft=n.marginRight=n.position="",this._overlayRef=null,this._isDisposed=!0}}let uW=(()=>{class e{constructor(t,o,c,u){this._viewportRuler=t,this._document=o,this._platform=c,this._overlayContainer=u}global(){return new dW}flexibleConnectedTo(t){return new lW(t,this._viewportRuler,this._document,this._platform,this._overlayContainer)}static#e=this.\u0275fac=function(o){return new(o||e)(fe(Uj),fe(Kt),fe(no),fe(zj))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),hW=0,IP=(()=>{class e{constructor(t,o,c,u,f,_,v,S,R,k,U,G){this.scrollStrategies=t,this._overlayContainer=o,this._componentFactoryResolver=c,this._positionBuilder=u,this._keyboardDispatcher=f,this._injector=_,this._ngZone=v,this._document=S,this._directionality=R,this._location=k,this._outsideClickDispatcher=U,this._animationsModuleType=G}create(t){const o=this._createHostElement(),c=this._createPaneElement(o),u=this._createPortalOutlet(c),f=new iW(t);return f.direction=f.direction||this._directionality.value,new aW(u,o,c,f,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(t){const o=this._document.createElement("div");return o.id="cdk-overlay-"+hW++,o.classList.add("cdk-overlay-pane"),t.appendChild(o),o}_createHostElement(){const t=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(t),t}_createPortalOutlet(t){return this._appRef||(this._appRef=this._injector.get(ea)),new JG(t,this._componentFactoryResolver,this._appRef,this._injector,this._document)}static#e=this.\u0275fac=function(o){return new(o||e)(fe(nW),fe(zj),fe(Ju),fe(uW),fe(oW),fe(tr),fe(lt),fe(Kt),fe(OF),fe(o0),fe(sW),fe(Sa,8))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const mW={provide:new De("cdk-connected-overlay-scroll-strategy"),deps:[IP],useFactory:function fW(e){return()=>e.scrollStrategies.reposition()}};let _W=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({providers:[IP,mW],imports:[hT,QG,Vj,Vj]})}return e})();const gW=["tooltip"],Xj=new De("mat-tooltip-scroll-strategy"),yW={provide:Xj,deps:[IP],useFactory:function vW(e){return()=>e.scrollStrategies.reposition({scrollThrottle:20})}},SW=new De("mat-tooltip-default-options",{providedIn:"root",factory:function bW(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}}),Jj="tooltip-panel",Qj=Mv({passive:!0});let AW=(()=>{class e{get position(){return this._position}set position(t){t!==this._position&&(this._position=t,this._overlayRef&&(this._updatePosition(this._overlayRef),this._tooltipInstance?.show(0),this._overlayRef.updatePosition()))}get positionAtOrigin(){return this._positionAtOrigin}set positionAtOrigin(t){this._positionAtOrigin=oa(t),this._detach(),this._overlayRef=null}get disabled(){return this._disabled}set disabled(t){this._disabled=oa(t),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(t){this._showDelay=bF(t)}get hideDelay(){return this._hideDelay}set hideDelay(t){this._hideDelay=bF(t),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(t){this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=null!=t?String(t).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this.message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(t){this._tooltipClass=t,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}constructor(t,o,c,u,f,_,v,S,R,k,U,G){this._overlay=t,this._elementRef=o,this._scrollDispatcher=c,this._viewContainerRef=u,this._ngZone=f,this._platform=_,this._ariaDescriber=v,this._focusMonitor=S,this._dir=k,this._defaultOptions=U,this._position="below",this._positionAtOrigin=!1,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._viewportMargin=8,this._cssClassPrefix="mat",this.touchGestures="auto",this._message="",this._passiveListeners=[],this._destroyed=new rn,this._scrollStrategy=R,this._document=G,U&&(this._showDelay=U.showDelay,this._hideDelay=U.hideDelay,U.position&&(this.position=U.position),U.positionAtOrigin&&(this.positionAtOrigin=U.positionAtOrigin),U.touchGestures&&(this.touchGestures=U.touchGestures)),k.change.pipe(No(this._destroyed)).subscribe(()=>{this._overlayRef&&this._updatePosition(this._overlayRef)})}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(No(this._destroyed)).subscribe(t=>{t?"keyboard"===t&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const t=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([o,c])=>{t.removeEventListener(o,c,Qj)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),this._ariaDescriber.removeDescription(t,this.message,"tooltip"),this._focusMonitor.stopMonitoring(t)}show(t=this.showDelay,o){if(this.disabled||!this.message||this._isTooltipVisible())return void this._tooltipInstance?._cancelPendingAnimations();const c=this._createOverlay(o);this._detach(),this._portal=this._portal||new Bj(this._tooltipComponent,this._viewContainerRef);const u=this._tooltipInstance=c.attach(this._portal).instance;u._triggerElement=this._elementRef.nativeElement,u._mouseLeaveHideDelay=this._hideDelay,u.afterHidden().pipe(No(this._destroyed)).subscribe(()=>this._detach()),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),u.show(t)}hide(t=this.hideDelay){const o=this._tooltipInstance;o&&(o.isVisible()?o.hide(t):(o._cancelPendingAnimations(),this._detach()))}toggle(t){this._isTooltipVisible()?this.hide():this.show(void 0,t)}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(t){if(this._overlayRef){const u=this._overlayRef.getConfig().positionStrategy;if((!this.positionAtOrigin||!t)&&u._origin instanceof bn)return this._overlayRef;this._detach()}const o=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),c=this._overlay.position().flexibleConnectedTo(this.positionAtOrigin&&t||this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(o);return c.positionChanges.pipe(No(this._destroyed)).subscribe(u=>{this._updateCurrentPositionClass(u.connectionPair),this._tooltipInstance&&u.scrollableViewProperties.isOverlayClipped&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({direction:this._dir,positionStrategy:c,panelClass:`${this._cssClassPrefix}-${Jj}`,scrollStrategy:this._scrollStrategy()}),this._updatePosition(this._overlayRef),this._overlayRef.detachments().pipe(No(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.outsidePointerEvents().pipe(No(this._destroyed)).subscribe(()=>this._tooltipInstance?._handleBodyInteraction()),this._overlayRef.keydownEvents().pipe(No(this._destroyed)).subscribe(u=>{this._isTooltipVisible()&&27===u.keyCode&&!function w8(e,...n){return n.length?n.some(t=>e[t]):e.altKey||e.shiftKey||e.ctrlKey||e.metaKey}(u)&&(u.preventDefault(),u.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._defaultOptions?.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}_updatePosition(t){const o=t.getConfig().positionStrategy,c=this._getOrigin(),u=this._getOverlayPosition();o.withPositions([this._addOffset({...c.main,...u.main}),this._addOffset({...c.fallback,...u.fallback})])}_addOffset(t){return t}_getOrigin(){const t=!this._dir||"ltr"==this._dir.value,o=this.position;let c;"above"==o||"below"==o?c={originX:"center",originY:"above"==o?"top":"bottom"}:"before"==o||"left"==o&&t||"right"==o&&!t?c={originX:"start",originY:"center"}:("after"==o||"right"==o&&t||"left"==o&&!t)&&(c={originX:"end",originY:"center"});const{x:u,y:f}=this._invertPosition(c.originX,c.originY);return{main:c,fallback:{originX:u,originY:f}}}_getOverlayPosition(){const t=!this._dir||"ltr"==this._dir.value,o=this.position;let c;"above"==o?c={overlayX:"center",overlayY:"bottom"}:"below"==o?c={overlayX:"center",overlayY:"top"}:"before"==o||"left"==o&&t||"right"==o&&!t?c={overlayX:"end",overlayY:"center"}:("after"==o||"right"==o&&t||"left"==o&&!t)&&(c={overlayX:"start",overlayY:"center"});const{x:u,y:f}=this._invertPosition(c.overlayX,c.overlayY);return{main:c,fallback:{overlayX:u,overlayY:f}}}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(Zd(1),No(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(t){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=t,this._tooltipInstance._markForCheck())}_invertPosition(t,o){return"above"===this.position||"below"===this.position?"top"===o?o="bottom":"bottom"===o&&(o="top"):"end"===t?t="start":"start"===t&&(t="end"),{x:t,y:o}}_updateCurrentPositionClass(t){const{overlayY:o,originX:c,originY:u}=t;let f;if(f="center"===o?this._dir&&"rtl"===this._dir.value?"end"===c?"left":"right":"start"===c?"left":"right":"bottom"===o&&"top"===u?"above":"below",f!==this._currentPosition){const _=this._overlayRef;if(_){const v=`${this._cssClassPrefix}-${Jj}-`;_.removePanelClass(v+this._currentPosition),_.addPanelClass(v+f)}this._currentPosition=f}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||(this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",t=>{let o;this._setupPointerExitEventsIfNeeded(),void 0!==t.x&&void 0!==t.y&&(o=t),this.show(void 0,o)}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",t=>{const o=t.targetTouches?.[0],c=o?{x:o.clientX,y:o.clientY}:void 0;this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(void 0,c),500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const t=[];if(this._platformSupportsMouseEvents())t.push(["mouseleave",o=>{const c=o.relatedTarget;(!c||!this._overlayRef?.overlayElement.contains(c))&&this.hide()}],["wheel",o=>this._wheelListener(o)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const o=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};t.push(["touchend",o],["touchcancel",o])}this._addListeners(t),this._passiveListeners.push(...t)}_addListeners(t){t.forEach(([o,c])=>{this._elementRef.nativeElement.addEventListener(o,c,Qj)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(t){if(this._isTooltipVisible()){const o=this._document.elementFromPoint(t.clientX,t.clientY),c=this._elementRef.nativeElement;o!==c&&!c.contains(o)&&this.hide()}}_disableNativeGesturesIfNecessary(){const t=this.touchGestures;if("off"!==t){const o=this._elementRef.nativeElement,c=o.style;("on"===t||"INPUT"!==o.nodeName&&"TEXTAREA"!==o.nodeName)&&(c.userSelect=c.msUserSelect=c.webkitUserSelect=c.MozUserSelect="none"),("on"===t||!o.draggable)&&(c.webkitUserDrag="none"),c.touchAction="none",c.webkitTapHighlightColor="transparent"}}static#e=this.\u0275fac=function(o){ld()};static#t=this.\u0275dir=Ge({type:e,inputs:{position:["matTooltipPosition","position"],positionAtOrigin:["matTooltipPositionAtOrigin","positionAtOrigin"],disabled:["matTooltipDisabled","disabled"],showDelay:["matTooltipShowDelay","showDelay"],hideDelay:["matTooltipHideDelay","hideDelay"],touchGestures:["matTooltipTouchGestures","touchGestures"],message:["matTooltip","message"],tooltipClass:["matTooltipClass","tooltipClass"]}})}return e})(),DW=(()=>{class e extends AW{constructor(t,o,c,u,f,_,v,S,R,k,U,G){super(t,o,c,u,f,_,v,S,R,k,U,G),this._tooltipComponent=NW,this._cssClassPrefix="mat-mdc",this._viewportMargin=8}_addOffset(t){const c=!this._dir||"ltr"==this._dir.value;return"top"===t.originY?t.offsetY=-8:"bottom"===t.originY?t.offsetY=8:"start"===t.originX?t.offsetX=c?-8:8:"end"===t.originX&&(t.offsetX=c?8:-8),t}static#e=this.\u0275fac=function(o){return new(o||e)(re(IP),re(bn),re(Fj),re(Jo),re(lt),re(no),re(V8),re(AF),re(Xj),re(OF,8),re(SW,8),re(Kt))};static#t=this.\u0275dir=Ge({type:e,selectors:[["","matTooltip",""]],hostAttrs:[1,"mat-mdc-tooltip-trigger"],hostVars:2,hostBindings:function(o,c){2&o&&Vt("mat-mdc-tooltip-disabled",c.disabled)},exportAs:["matTooltip"],features:[Ne]})}return e})(),OW=(()=>{class e{constructor(t,o){this._changeDetectorRef=t,this._closeOnInteraction=!1,this._isVisible=!1,this._onHide=new rn,this._animationsDisabled="NoopAnimations"===o}show(t){null!=this._hideTimeoutId&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=setTimeout(()=>{this._toggleVisibility(!0),this._showTimeoutId=void 0},t)}hide(t){null!=this._showTimeoutId&&clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0},t)}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){this._cancelPendingAnimations(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:t}){(!t||!this._triggerElement.contains(t))&&(this.isVisible()?this.hide(this._mouseLeaveHideDelay):this._finalizeAnimation(!1))}_onShow(){}_handleAnimationEnd({animationName:t}){(t===this._showAnimation||t===this._hideAnimation)&&this._finalizeAnimation(t===this._showAnimation)}_cancelPendingAnimations(){null!=this._showTimeoutId&&clearTimeout(this._showTimeoutId),null!=this._hideTimeoutId&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=this._hideTimeoutId=void 0}_finalizeAnimation(t){t?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next()}_toggleVisibility(t){const o=this._tooltip.nativeElement,c=this._showAnimation,u=this._hideAnimation;if(o.classList.remove(t?u:c),o.classList.add(t?c:u),this._isVisible=t,t&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const f=getComputedStyle(o);("0s"===f.getPropertyValue("animation-duration")||"none"===f.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}t&&this._onShow(),this._animationsDisabled&&(o.classList.add("_mat-animation-noopable"),this._finalizeAnimation(t))}static#e=this.\u0275fac=function(o){return new(o||e)(re(rr),re(Sa,8))};static#t=this.\u0275dir=Ge({type:e})}return e})(),NW=(()=>{class e extends OW{constructor(t,o,c){super(t,c),this._elementRef=o,this._isMultiline=!1,this._showAnimation="mat-mdc-tooltip-show",this._hideAnimation="mat-mdc-tooltip-hide"}_onShow(){this._isMultiline=this._isTooltipMultiline(),this._markForCheck()}_isTooltipMultiline(){const t=this._elementRef.nativeElement.getBoundingClientRect();return t.height>24&&t.width>=200}static#e=this.\u0275fac=function(o){return new(o||e)(re(rr),re(bn),re(Sa,8))};static#t=this.\u0275cmp=Ct({type:e,selectors:[["mat-tooltip-component"]],viewQuery:function(o,c){if(1&o&&Js(gW,7),2&o){let u;$e(u=Bi())&&(c._tooltip=u.first)}},hostAttrs:["aria-hidden","true"],hostVars:2,hostBindings:function(o,c){1&o&&en("mouseleave",function(f){return c._handleMouseLeave(f)}),2&o&&lE("zoom",c.isVisible()?1:null)},features:[Ne],decls:4,vars:4,consts:[[1,"mdc-tooltip","mdc-tooltip--shown","mat-mdc-tooltip",3,"ngClass","animationend"],["tooltip",""],[1,"mdc-tooltip__surface","mdc-tooltip__surface-animation"]],template:function(o,c){1&o&&(Pe(0,"div",0,1),en("animationend",function(f){return c._handleAnimationEnd(f)}),Pe(2,"div",2),Dr(3),Re()()),2&o&&(Vt("mdc-tooltip--multiline",c._isMultiline),Qe("ngClass",c.tooltipClass),Je(3),hc(c.message))},dependencies:[_v],styles:['.mdc-tooltip__surface{word-break:break-all;word-break:var(--mdc-tooltip-word-break, normal);overflow-wrap:anywhere}.mdc-tooltip--showing-transition .mdc-tooltip__surface-animation{transition:opacity 150ms 0ms cubic-bezier(0, 0, 0.2, 1),transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-tooltip--hide-transition .mdc-tooltip__surface-animation{transition:opacity 75ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-tooltip{position:fixed;display:none;z-index:9}.mdc-tooltip-wrapper--rich{position:relative}.mdc-tooltip--shown,.mdc-tooltip--showing,.mdc-tooltip--hide{display:inline-flex}.mdc-tooltip--shown.mdc-tooltip--rich,.mdc-tooltip--showing.mdc-tooltip--rich,.mdc-tooltip--hide.mdc-tooltip--rich{display:inline-block;left:-320px;position:absolute}.mdc-tooltip__surface{line-height:16px;padding:4px 8px;min-width:40px;max-width:200px;min-height:24px;max-height:40vh;box-sizing:border-box;overflow:hidden;text-align:center}.mdc-tooltip__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-tooltip__surface::before{border-color:CanvasText}}.mdc-tooltip--rich .mdc-tooltip__surface{align-items:flex-start;display:flex;flex-direction:column;min-height:24px;min-width:40px;max-width:320px;position:relative}.mdc-tooltip--multiline .mdc-tooltip__surface{text-align:left}[dir=rtl] .mdc-tooltip--multiline .mdc-tooltip__surface,.mdc-tooltip--multiline .mdc-tooltip__surface[dir=rtl]{text-align:right}.mdc-tooltip__surface .mdc-tooltip__title{margin:0 8px}.mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(200px - (2 * 8px));margin:8px;text-align:left}[dir=rtl] .mdc-tooltip__surface .mdc-tooltip__content,.mdc-tooltip__surface .mdc-tooltip__content[dir=rtl]{text-align:right}.mdc-tooltip--rich .mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(320px - (2 * 8px));align-self:stretch}.mdc-tooltip__surface .mdc-tooltip__content-link{text-decoration:none}.mdc-tooltip--rich-actions,.mdc-tooltip__content,.mdc-tooltip__title{z-index:1}.mdc-tooltip__surface-animation{opacity:0;transform:scale(0.8);will-change:transform,opacity}.mdc-tooltip--shown .mdc-tooltip__surface-animation{transform:scale(1);opacity:1}.mdc-tooltip--hide .mdc-tooltip__surface-animation{transform:scale(1)}.mdc-tooltip__caret-surface-top,.mdc-tooltip__caret-surface-bottom{position:absolute;height:24px;width:24px;transform:rotate(35deg) skewY(20deg) scaleX(0.9396926208)}.mdc-tooltip__caret-surface-top .mdc-elevation-overlay,.mdc-tooltip__caret-surface-bottom .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-tooltip__caret-surface-bottom{box-shadow:0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12);outline:1px solid rgba(0,0,0,0);z-index:-1}@media screen and (forced-colors: active){.mdc-tooltip__caret-surface-bottom{outline-color:CanvasText}}.mat-mdc-tooltip{--mdc-plain-tooltip-container-shape:4px;--mdc-plain-tooltip-supporting-text-line-height:16px}.mat-mdc-tooltip .mdc-tooltip__surface{background-color:var(--mdc-plain-tooltip-container-color)}.mat-mdc-tooltip .mdc-tooltip__surface{border-radius:var(--mdc-plain-tooltip-container-shape)}.mat-mdc-tooltip .mdc-tooltip__caret-surface-top,.mat-mdc-tooltip .mdc-tooltip__caret-surface-bottom{border-radius:var(--mdc-plain-tooltip-container-shape)}.mat-mdc-tooltip .mdc-tooltip__surface{color:var(--mdc-plain-tooltip-supporting-text-color)}.mat-mdc-tooltip .mdc-tooltip__surface{font-family:var(--mdc-plain-tooltip-supporting-text-font);line-height:var(--mdc-plain-tooltip-supporting-text-line-height);font-size:var(--mdc-plain-tooltip-supporting-text-size);font-weight:var(--mdc-plain-tooltip-supporting-text-weight);letter-spacing:var(--mdc-plain-tooltip-supporting-text-tracking)}.mat-mdc-tooltip{position:relative;transform:scale(0)}.mat-mdc-tooltip::before{content:"";top:0;right:0;bottom:0;left:0;z-index:-1;position:absolute}.mat-mdc-tooltip-panel-below .mat-mdc-tooltip::before{top:-8px}.mat-mdc-tooltip-panel-above .mat-mdc-tooltip::before{bottom:-8px}.mat-mdc-tooltip-panel-right .mat-mdc-tooltip::before{left:-8px}.mat-mdc-tooltip-panel-left .mat-mdc-tooltip::before{right:-8px}.mat-mdc-tooltip._mat-animation-noopable{animation:none;transform:scale(1)}.mat-mdc-tooltip-panel-non-interactive{pointer-events:none}@keyframes mat-mdc-tooltip-show{0%{opacity:0;transform:scale(0.8)}100%{opacity:1;transform:scale(1)}}@keyframes mat-mdc-tooltip-hide{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0.8)}}.mat-mdc-tooltip-show{animation:mat-mdc-tooltip-show 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-mdc-tooltip-hide{animation:mat-mdc-tooltip-hide 75ms cubic-bezier(0.4, 0, 1, 1) forwards}'],encapsulation:2,changeDetection:0})}return e})(),PW=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({providers:[yW],imports:[X8,Wh,_W,Wa,Wa,VF]})}return e})();function Zj(e){return new ue(3e3,!1)}function Zh(e){switch(e.length){case 0:return new _T;case 1:return e[0];default:return new Ej(e)}}function e4(e,n,t=new Map,o=new Map){const c=[],u=[];let f=-1,_=null;if(n.forEach(v=>{const S=v.get("offset"),R=S==f,k=R&&_||new Map;v.forEach((U,G)=>{let z=G,X=U;if("offset"!==G)switch(z=e.normalizePropertyName(z,c),X){case"!":X=t.get(G);break;case eu:X=o.get(G);break;default:X=e.normalizeStyleValue(G,z,X,c)}k.set(z,X)}),R||u.push(k),_=k,f=S}),c.length)throw function t9(e){return new ue(3502,!1)}();return u}function HF(e,n,t,o){switch(n){case"start":e.onStart(()=>o(t&&GF(t,"start",e)));break;case"done":e.onDone(()=>o(t&&GF(t,"done",e)));break;case"destroy":e.onDestroy(()=>o(t&&GF(t,"destroy",e)))}}function GF(e,n,t){const u=WF(e.element,e.triggerName,e.fromState,e.toState,n||e.phaseName,t.totalTime??e.totalTime,!!t.disabled),f=e._data;return null!=f&&(u._data=f),u}function WF(e,n,t,o,c="",u=0,f){return{element:e,triggerName:n,fromState:t,toState:o,phaseName:c,totalTime:u,disabled:!!f}}function sa(e,n,t){let o=e.get(n);return o||e.set(n,o=t),o}function t4(e){const n=e.indexOf(":");return[e.substring(1,n),e.slice(n+1)]}const p9=(()=>typeof document>"u"?null:document.documentElement)();function zF(e){const n=e.parentNode||e.host||null;return n===p9?null:n}let ym=null,n4=!1;function i4(e,n){for(;n;){if(n===e)return!0;n=zF(n)}return!1}function r4(e,n,t){if(t)return Array.from(e.querySelectorAll(n));const o=e.querySelector(n);return o?[o]:[]}let o4=(()=>{class e{validateStyleProperty(t){return function m9(e){ym||(ym=function _9(){return typeof document<"u"?document.body:null}()||{},n4=!!ym.style&&"WebkitAppearance"in ym.style);let n=!0;return ym.style&&!function f9(e){return"ebkit"==e.substring(1,6)}(e)&&(n=e in ym.style,!n&&n4&&(n="Webkit"+e.charAt(0).toUpperCase()+e.slice(1)in ym.style)),n}(t)}matchesElement(t,o){return!1}containsElement(t,o){return i4(t,o)}getParentElement(t){return zF(t)}query(t,o,c){return r4(t,o,c)}computeStyle(t,o,c){return c||""}animate(t,o,c,u,f,_=[],v){return new _T(c,u)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac})}return e})(),qF=(()=>{class e{static#e=this.NOOP=new o4}return e})();const g9=1e3,KF="ng-enter",RP="ng-leave",AP="ng-trigger",DP=".ng-trigger",a4="ng-animating",YF=".ng-animating";function tu(e){if("number"==typeof e)return e;const n=e.match(/^(-?[\.\d]+)(m?s)/);return!n||n.length<2?0:$F(parseFloat(n[1]),n[2])}function $F(e,n){return"s"===n?e*g9:e}function OP(e,n,t){return e.hasOwnProperty("duration")?e:function v9(e,n,t){let c,u=0,f="";if("string"==typeof e){const _=e.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===_)return n.push(Zj()),{duration:0,delay:0,easing:""};c=$F(parseFloat(_[1]),_[2]);const v=_[3];null!=v&&(u=$F(parseFloat(v),_[4]));const S=_[5];S&&(f=S)}else c=e;if(!t){let _=!1,v=n.length;c<0&&(n.push(function xW(){return new ue(3100,!1)}()),_=!0),u<0&&(n.push(function MW(){return new ue(3101,!1)}()),_=!0),_&&n.splice(v,0,Zj())}return{duration:c,delay:u,easing:f}}(e,n,t)}function ET(e,n={}){return Object.keys(e).forEach(t=>{n[t]=e[t]}),n}function c4(e){const n=new Map;return Object.keys(e).forEach(t=>{n.set(t,e[t])}),n}function ep(e,n=new Map,t){if(t)for(let[o,c]of t)n.set(o,c);for(let[o,c]of e)n.set(o,c);return n}function Fl(e,n,t){n.forEach((o,c)=>{const u=JF(c);t&&!t.has(c)&&t.set(c,e.style[u]),e.style[u]=o})}function bm(e,n){n.forEach((t,o)=>{const c=JF(o);e.style[c]=""})}function vT(e){return Array.isArray(e)?1==e.length?e[0]:gj(e):e}const XF=new RegExp("{{\\s*(.+?)\\s*}}","g");function d4(e){let n=[];if("string"==typeof e){let t;for(;t=XF.exec(e);)n.push(t[1]);XF.lastIndex=0}return n}function yT(e,n,t){const o=e.toString(),c=o.replace(XF,(u,f)=>{let _=n[f];return null==_&&(t.push(function LW(e){return new ue(3003,!1)}()),_=""),_.toString()});return c==o?e:c}function NP(e){const n=[];let t=e.next();for(;!t.done;)n.push(t.value),t=e.next();return n}const S9=/-+([a-z0-9])/g;function JF(e){return e.replace(S9,(...n)=>n[1].toUpperCase())}function aa(e,n,t){switch(n.type){case 7:return e.visitTrigger(n,t);case 0:return e.visitState(n,t);case 1:return e.visitTransition(n,t);case 2:return e.visitSequence(n,t);case 3:return e.visitGroup(n,t);case 4:return e.visitAnimate(n,t);case 5:return e.visitKeyframes(n,t);case 6:return e.visitStyle(n,t);case 8:return e.visitReference(n,t);case 9:return e.visitAnimateChild(n,t);case 10:return e.visitAnimateRef(n,t);case 11:return e.visitQuery(n,t);case 12:return e.visitStagger(n,t);default:throw function FW(e){return new ue(3004,!1)}()}}function u4(e,n){return window.getComputedStyle(e)[n]}const PP="*";function w9(e,n){const t=[];return"string"==typeof e?e.split(/\s*,\s*/).forEach(o=>function I9(e,n,t){if(":"==e[0]){const v=function R9(e,n){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,o)=>parseFloat(o)>parseFloat(t);case":decrement":return(t,o)=>parseFloat(o)<parseFloat(t);default:return n.push(function JW(e){return new ue(3016,!1)}()),"* => *"}}(e,t);if("function"==typeof v)return void n.push(v);e=v}const o=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==o||o.length<4)return t.push(function XW(e){return new ue(3015,!1)}()),n;const c=o[1],u=o[2],f=o[3];n.push(h4(c,f));"<"==u[0]&&!(c==PP&&f==PP)&&n.push(h4(f,c))}(o,t,n)):t.push(e),t}const xP=new Set(["true","1"]),MP=new Set(["false","0"]);function h4(e,n){const t=xP.has(e)||MP.has(e),o=xP.has(n)||MP.has(n);return(c,u)=>{let f=e==PP||e==c,_=n==PP||n==u;return!f&&t&&"boolean"==typeof c&&(f=c?xP.has(e):MP.has(e)),!_&&o&&"boolean"==typeof u&&(_=u?xP.has(n):MP.has(n)),f&&_}}const A9=new RegExp("s*:selfs*,?","g");function QF(e,n,t,o){return new D9(e).build(n,t,o)}class D9{constructor(n){this._driver=n}build(n,t,o){const c=new P9(t);return this._resetContextStyleTimingState(c),aa(this,vT(n),c)}_resetContextStyleTimingState(n){n.currentQuerySelector="",n.collectedStyles=new Map,n.collectedStyles.set("",new Map),n.currentTime=0}visitTrigger(n,t){let o=t.queryCount=0,c=t.depCount=0;const u=[],f=[];return"@"==n.name.charAt(0)&&t.errors.push(function VW(){return new ue(3006,!1)}()),n.definitions.forEach(_=>{if(this._resetContextStyleTimingState(t),0==_.type){const v=_,S=v.name;S.toString().split(/\s*,\s*/).forEach(R=>{v.name=R,u.push(this.visitState(v,t))}),v.name=S}else if(1==_.type){const v=this.visitTransition(_,t);o+=v.queryCount,c+=v.depCount,f.push(v)}else t.errors.push(function BW(){return new ue(3007,!1)}())}),{type:7,name:n.name,states:u,transitions:f,queryCount:o,depCount:c,options:null}}visitState(n,t){const o=this.visitStyle(n.styles,t),c=n.options&&n.options.params||null;if(o.containsDynamicStyles){const u=new Set,f=c||{};o.styles.forEach(_=>{_ instanceof Map&&_.forEach(v=>{d4(v).forEach(S=>{f.hasOwnProperty(S)||u.add(S)})})}),u.size&&(NP(u.values()),t.errors.push(function jW(e,n){return new ue(3008,!1)}()))}return{type:0,name:n.name,style:o,options:c?{params:c}:null}}visitTransition(n,t){t.queryCount=0,t.depCount=0;const o=aa(this,vT(n.animation),t);return{type:1,matchers:w9(n.expr,t.errors),animation:o,queryCount:t.queryCount,depCount:t.depCount,options:Sm(n.options)}}visitSequence(n,t){return{type:2,steps:n.steps.map(o=>aa(this,o,t)),options:Sm(n.options)}}visitGroup(n,t){const o=t.currentTime;let c=0;const u=n.steps.map(f=>{t.currentTime=o;const _=aa(this,f,t);return c=Math.max(c,t.currentTime),_});return t.currentTime=c,{type:3,steps:u,options:Sm(n.options)}}visitAnimate(n,t){const o=function M9(e,n){if(e.hasOwnProperty("duration"))return e;if("number"==typeof e)return ZF(OP(e,n).duration,0,"");const t=e;if(t.split(/\s+/).some(u=>"{"==u.charAt(0)&&"{"==u.charAt(1))){const u=ZF(0,0,"");return u.dynamic=!0,u.strValue=t,u}const c=OP(t,n);return ZF(c.duration,c.delay,c.easing)}(n.timings,t.errors);t.currentAnimateTimings=o;let c,u=n.styles?n.styles:Ll({});if(5==u.type)c=this.visitKeyframes(u,t);else{let f=n.styles,_=!1;if(!f){_=!0;const S={};o.easing&&(S.easing=o.easing),f=Ll(S)}t.currentTime+=o.duration+o.delay;const v=this.visitStyle(f,t);v.isEmptyStep=_,c=v}return t.currentAnimateTimings=null,{type:4,timings:o,style:c,options:null}}visitStyle(n,t){const o=this._makeStyleAst(n,t);return this._validateStyleAst(o,t),o}_makeStyleAst(n,t){const o=[],c=Array.isArray(n.styles)?n.styles:[n.styles];for(let _ of c)"string"==typeof _?_===eu?o.push(_):t.errors.push(new ue(3002,!1)):o.push(c4(_));let u=!1,f=null;return o.forEach(_=>{if(_ instanceof Map&&(_.has("easing")&&(f=_.get("easing"),_.delete("easing")),!u))for(let v of _.values())if(v.toString().indexOf("{{")>=0){u=!0;break}}),{type:6,styles:o,easing:f,offset:n.offset,containsDynamicStyles:u,options:null}}_validateStyleAst(n,t){const o=t.currentAnimateTimings;let c=t.currentTime,u=t.currentTime;o&&u>0&&(u-=o.duration+o.delay),n.styles.forEach(f=>{"string"!=typeof f&&f.forEach((_,v)=>{const S=t.collectedStyles.get(t.currentQuerySelector),R=S.get(v);let k=!0;R&&(u!=c&&u>=R.startTime&&c<=R.endTime&&(t.errors.push(function GW(e,n,t,o,c){return new ue(3010,!1)}()),k=!1),u=R.startTime),k&&S.set(v,{startTime:u,endTime:c}),t.options&&function b9(e,n,t){const o=n.params||{},c=d4(e);c.length&&c.forEach(u=>{o.hasOwnProperty(u)||t.push(function kW(e){return new ue(3001,!1)}())})}(_,t.options,t.errors)})})}visitKeyframes(n,t){const o={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(function WW(){return new ue(3011,!1)}()),o;let u=0;const f=[];let _=!1,v=!1,S=0;const R=n.steps.map(pe=>{const ae=this._makeStyleAst(pe,t);let Ve=null!=ae.offset?ae.offset:function x9(e){if("string"==typeof e)return null;let n=null;if(Array.isArray(e))e.forEach(t=>{if(t instanceof Map&&t.has("offset")){const o=t;n=parseFloat(o.get("offset")),o.delete("offset")}});else if(e instanceof Map&&e.has("offset")){const t=e;n=parseFloat(t.get("offset")),t.delete("offset")}return n}(ae.styles),je=0;return null!=Ve&&(u++,je=ae.offset=Ve),v=v||je<0||je>1,_=_||je<S,S=je,f.push(je),ae});v&&t.errors.push(function zW(){return new ue(3012,!1)}()),_&&t.errors.push(function qW(){return new ue(3200,!1)}());const k=n.steps.length;let U=0;u>0&&u<k?t.errors.push(function KW(){return new ue(3202,!1)}()):0==u&&(U=1/(k-1));const G=k-1,z=t.currentTime,X=t.currentAnimateTimings,le=X.duration;return R.forEach((pe,ae)=>{const Ve=U>0?ae==G?1:U*ae:f[ae],je=Ve*le;t.currentTime=z+X.delay+je,X.duration=je,this._validateStyleAst(pe,t),pe.offset=Ve,o.styles.push(pe)}),o}visitReference(n,t){return{type:8,animation:aa(this,vT(n.animation),t),options:Sm(n.options)}}visitAnimateChild(n,t){return t.depCount++,{type:9,options:Sm(n.options)}}visitAnimateRef(n,t){return{type:10,animation:this.visitReference(n.animation,t),options:Sm(n.options)}}visitQuery(n,t){const o=t.currentQuerySelector,c=n.options||{};t.queryCount++,t.currentQuery=n;const[u,f]=function O9(e){const n=!!e.split(/\s*,\s*/).find(t=>":self"==t);return n&&(e=e.replace(A9,"")),e=e.replace(/@\*/g,DP).replace(/@\w+/g,t=>DP+"-"+t.slice(1)).replace(/:animating/g,YF),[e,n]}(n.selector);t.currentQuerySelector=o.length?o+" "+u:u,sa(t.collectedStyles,t.currentQuerySelector,new Map);const _=aa(this,vT(n.animation),t);return t.currentQuery=null,t.currentQuerySelector=o,{type:11,selector:u,limit:c.limit||0,optional:!!c.optional,includeSelf:f,animation:_,originalSelector:n.selector,options:Sm(n.options)}}visitStagger(n,t){t.currentQuery||t.errors.push(function YW(){return new ue(3013,!1)}());const o="full"===n.timings?{duration:0,delay:0,easing:"full"}:OP(n.timings,t.errors,!0);return{type:12,animation:aa(this,vT(n.animation),t),timings:o,options:null}}}class P9{constructor(n){this.errors=n,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function Sm(e){return e?(e=ET(e)).params&&(e.params=function N9(e){return e?ET(e):null}(e.params)):e={},e}function ZF(e,n,t){return{duration:e,delay:n,easing:t}}function eU(e,n,t,o,c,u,f=null,_=!1){return{type:1,element:e,keyframes:n,preStyleProps:t,postStyleProps:o,duration:c,delay:u,totalTime:c+u,easing:f,subTimeline:_}}class kP{constructor(){this._map=new Map}get(n){return this._map.get(n)||[]}append(n,t){let o=this._map.get(n);o||this._map.set(n,o=[]),o.push(...t)}has(n){return this._map.has(n)}clear(){this._map.clear()}}const F9=new RegExp(":enter","g"),V9=new RegExp(":leave","g");function tU(e,n,t,o,c,u=new Map,f=new Map,_,v,S=[]){return(new B9).buildKeyframes(e,n,t,o,c,u,f,_,v,S)}class B9{buildKeyframes(n,t,o,c,u,f,_,v,S,R=[]){S=S||new kP;const k=new nU(n,t,S,c,u,R,[]);k.options=v;const U=v.delay?tu(v.delay):0;k.currentTimeline.delayNextStep(U),k.currentTimeline.setStyles([f],null,k.errors,v),aa(this,o,k);const G=k.timelines.filter(z=>z.containsAnimation());if(G.length&&_.size){let z;for(let X=G.length-1;X>=0;X--){const le=G[X];if(le.element===t){z=le;break}}z&&!z.allowOnlyTimelineStyles()&&z.setStyles([_],null,k.errors,v)}return G.length?G.map(z=>z.buildKeyframes()):[eU(t,[],[],[],0,U,"",!1)]}visitTrigger(n,t){}visitState(n,t){}visitTransition(n,t){}visitAnimateChild(n,t){const o=t.subInstructions.get(t.element);if(o){const c=t.createSubContext(n.options),u=t.currentTimeline.currentTime,f=this._visitSubInstructions(o,c,c.options);u!=f&&t.transformIntoNewTimeline(f)}t.previousNode=n}visitAnimateRef(n,t){const o=t.createSubContext(n.options);o.transformIntoNewTimeline(),this._applyAnimationRefDelays([n.options,n.animation.options],t,o),this.visitReference(n.animation,o),t.transformIntoNewTimeline(o.currentTimeline.currentTime),t.previousNode=n}_applyAnimationRefDelays(n,t,o){for(const c of n){const u=c?.delay;if(u){const f="number"==typeof u?u:tu(yT(u,c?.params??{},t.errors));o.delayNextStep(f)}}}_visitSubInstructions(n,t,o){let u=t.currentTimeline.currentTime;const f=null!=o.duration?tu(o.duration):null,_=null!=o.delay?tu(o.delay):null;return 0!==f&&n.forEach(v=>{const S=t.appendInstructionToTimeline(v,f,_);u=Math.max(u,S.duration+S.delay)}),u}visitReference(n,t){t.updateOptions(n.options,!0),aa(this,n.animation,t),t.previousNode=n}visitSequence(n,t){const o=t.subContextCount;let c=t;const u=n.options;if(u&&(u.params||u.delay)&&(c=t.createSubContext(u),c.transformIntoNewTimeline(),null!=u.delay)){6==c.previousNode.type&&(c.currentTimeline.snapshotCurrentStyles(),c.previousNode=LP);const f=tu(u.delay);c.delayNextStep(f)}n.steps.length&&(n.steps.forEach(f=>aa(this,f,c)),c.currentTimeline.applyStylesToKeyframe(),c.subContextCount>o&&c.transformIntoNewTimeline()),t.previousNode=n}visitGroup(n,t){const o=[];let c=t.currentTimeline.currentTime;const u=n.options&&n.options.delay?tu(n.options.delay):0;n.steps.forEach(f=>{const _=t.createSubContext(n.options);u&&_.delayNextStep(u),aa(this,f,_),c=Math.max(c,_.currentTimeline.currentTime),o.push(_.currentTimeline)}),o.forEach(f=>t.currentTimeline.mergeTimelineCollectedStyles(f)),t.transformIntoNewTimeline(c),t.previousNode=n}_visitTiming(n,t){if(n.dynamic){const o=n.strValue;return OP(t.params?yT(o,t.params,t.errors):o,t.errors)}return{duration:n.duration,delay:n.delay,easing:n.easing}}visitAnimate(n,t){const o=t.currentAnimateTimings=this._visitTiming(n.timings,t),c=t.currentTimeline;o.delay&&(t.incrementTime(o.delay),c.snapshotCurrentStyles());const u=n.style;5==u.type?this.visitKeyframes(u,t):(t.incrementTime(o.duration),this.visitStyle(u,t),c.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=n}visitStyle(n,t){const o=t.currentTimeline,c=t.currentAnimateTimings;!c&&o.hasCurrentStyleProperties()&&o.forwardFrame();const u=c&&c.easing||n.easing;n.isEmptyStep?o.applyEmptyStep(u):o.setStyles(n.styles,u,t.errors,t.options),t.previousNode=n}visitKeyframes(n,t){const o=t.currentAnimateTimings,c=t.currentTimeline.duration,u=o.duration,_=t.createSubContext().currentTimeline;_.easing=o.easing,n.styles.forEach(v=>{_.forwardTime((v.offset||0)*u),_.setStyles(v.styles,v.easing,t.errors,t.options),_.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(_),t.transformIntoNewTimeline(c+u),t.previousNode=n}visitQuery(n,t){const o=t.currentTimeline.currentTime,c=n.options||{},u=c.delay?tu(c.delay):0;u&&(6===t.previousNode.type||0==o&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=LP);let f=o;const _=t.invokeQuery(n.selector,n.originalSelector,n.limit,n.includeSelf,!!c.optional,t.errors);t.currentQueryTotal=_.length;let v=null;_.forEach((S,R)=>{t.currentQueryIndex=R;const k=t.createSubContext(n.options,S);u&&k.delayNextStep(u),S===t.element&&(v=k.currentTimeline),aa(this,n.animation,k),k.currentTimeline.applyStylesToKeyframe(),f=Math.max(f,k.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(f),v&&(t.currentTimeline.mergeTimelineCollectedStyles(v),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=n}visitStagger(n,t){const o=t.parentContext,c=t.currentTimeline,u=n.timings,f=Math.abs(u.duration),_=f*(t.currentQueryTotal-1);let v=f*t.currentQueryIndex;switch(u.duration<0?"reverse":u.easing){case"reverse":v=_-v;break;case"full":v=o.currentStaggerTime}const R=t.currentTimeline;v&&R.delayNextStep(v);const k=R.currentTime;aa(this,n.animation,t),t.previousNode=n,o.currentStaggerTime=c.currentTime-k+(c.startTime-o.currentTimeline.startTime)}}const LP={};class nU{constructor(n,t,o,c,u,f,_,v){this._driver=n,this.element=t,this.subInstructions=o,this._enterClassName=c,this._leaveClassName=u,this.errors=f,this.timelines=_,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=LP,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=v||new FP(this._driver,t,0),_.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(n,t){if(!n)return;const o=n;let c=this.options;null!=o.duration&&(c.duration=tu(o.duration)),null!=o.delay&&(c.delay=tu(o.delay));const u=o.params;if(u){let f=c.params;f||(f=this.options.params={}),Object.keys(u).forEach(_=>{(!t||!f.hasOwnProperty(_))&&(f[_]=yT(u[_],f,this.errors))})}}_copyOptions(){const n={};if(this.options){const t=this.options.params;if(t){const o=n.params={};Object.keys(t).forEach(c=>{o[c]=t[c]})}}return n}createSubContext(n=null,t,o){const c=t||this.element,u=new nU(this._driver,c,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(c,o||0));return u.previousNode=this.previousNode,u.currentAnimateTimings=this.currentAnimateTimings,u.options=this._copyOptions(),u.updateOptions(n),u.currentQueryIndex=this.currentQueryIndex,u.currentQueryTotal=this.currentQueryTotal,u.parentContext=this,this.subContextCount++,u}transformIntoNewTimeline(n){return this.previousNode=LP,this.currentTimeline=this.currentTimeline.fork(this.element,n),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(n,t,o){const c={duration:t??n.duration,delay:this.currentTimeline.currentTime+(o??0)+n.delay,easing:""},u=new j9(this._driver,n.element,n.keyframes,n.preStyleProps,n.postStyleProps,c,n.stretchStartingKeyframe);return this.timelines.push(u),c}incrementTime(n){this.currentTimeline.forwardTime(this.currentTimeline.duration+n)}delayNextStep(n){n>0&&this.currentTimeline.delayNextStep(n)}invokeQuery(n,t,o,c,u,f){let _=[];if(c&&_.push(this.element),n.length>0){n=(n=n.replace(F9,"."+this._enterClassName)).replace(V9,"."+this._leaveClassName);let S=this._driver.query(this.element,n,1!=o);0!==o&&(S=o<0?S.slice(S.length+o,S.length):S.slice(0,o)),_.push(...S)}return!u&&0==_.length&&f.push(function $W(e){return new ue(3014,!1)}()),_}}class FP{constructor(n,t,o,c){this._driver=n,this.element=t,this.startTime=o,this._elementTimelineStylesLookup=c,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(n){const t=1===this._keyframes.size&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+n),t&&this.snapshotCurrentStyles()):this.startTime+=n}fork(n,t){return this.applyStylesToKeyframe(),new FP(this._driver,n,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(n){this.applyStylesToKeyframe(),this.duration=n,this._loadKeyframe()}_updateStyle(n,t){this._localTimelineStyles.set(n,t),this._globalTimelineStyles.set(n,t),this._styleSummary.set(n,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(n){n&&this._previousKeyframe.set("easing",n);for(let[t,o]of this._globalTimelineStyles)this._backFill.set(t,o||eu),this._currentKeyframe.set(t,eu);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(n,t,o,c){t&&this._previousKeyframe.set("easing",t);const u=c&&c.params||{},f=function H9(e,n){const t=new Map;let o;return e.forEach(c=>{if("*"===c){o=o||n.keys();for(let u of o)t.set(u,eu)}else ep(c,t)}),t}(n,this._globalTimelineStyles);for(let[_,v]of f){const S=yT(v,u,o);this._pendingStyles.set(_,S),this._localTimelineStyles.has(_)||this._backFill.set(_,this._globalTimelineStyles.get(_)??eu),this._updateStyle(_,S)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((n,t)=>{this._currentKeyframe.set(t,n)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((n,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,n)}))}snapshotCurrentStyles(){for(let[n,t]of this._localTimelineStyles)this._pendingStyles.set(n,t),this._updateStyle(n,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const n=[];for(let t in this._currentKeyframe)n.push(t);return n}mergeTimelineCollectedStyles(n){n._styleSummary.forEach((t,o)=>{const c=this._styleSummary.get(o);(!c||t.time>c.time)&&this._updateStyle(o,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();const n=new Set,t=new Set,o=1===this._keyframes.size&&0===this.duration;let c=[];this._keyframes.forEach((_,v)=>{const S=ep(_,new Map,this._backFill);S.forEach((R,k)=>{"!"===R?n.add(k):R===eu&&t.add(k)}),o||S.set("offset",v/this.duration),c.push(S)});const u=n.size?NP(n.values()):[],f=t.size?NP(t.values()):[];if(o){const _=c[0],v=new Map(_);_.set("offset",0),v.set("offset",1),c=[_,v]}return eU(this.element,c,u,f,this.duration,this.startTime,this.easing,!1)}}class j9 extends FP{constructor(n,t,o,c,u,f,_=!1){super(n,t,f.delay),this.keyframes=o,this.preStyleProps=c,this.postStyleProps=u,this._stretchStartingKeyframe=_,this.timings={duration:f.duration,delay:f.delay,easing:f.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let n=this.keyframes,{delay:t,duration:o,easing:c}=this.timings;if(this._stretchStartingKeyframe&&t){const u=[],f=o+t,_=t/f,v=ep(n[0]);v.set("offset",0),u.push(v);const S=ep(n[0]);S.set("offset",m4(_)),u.push(S);const R=n.length-1;for(let k=1;k<=R;k++){let U=ep(n[k]);const G=U.get("offset");U.set("offset",m4((t+G*o)/f)),u.push(U)}o=f,t=0,c="",n=u}return eU(this.element,n,this.preStyleProps,this.postStyleProps,o,t,c,!0)}}function m4(e,n=3){const t=Math.pow(10,n-1);return Math.round(e*t)/t}class iU{}const G9=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class W9 extends iU{normalizePropertyName(n,t){return JF(n)}normalizeStyleValue(n,t,o,c){let u="";const f=o.toString().trim();if(G9.has(t)&&0!==o&&"0"!==o)if("number"==typeof o)u="px";else{const _=o.match(/^[+-]?[\d\.]+([a-z]*)$/);_&&0==_[1].length&&c.push(function UW(e,n){return new ue(3005,!1)}())}return f+u}}function _4(e,n,t,o,c,u,f,_,v,S,R,k,U){return{type:0,element:e,triggerName:n,isRemovalTransition:c,fromState:t,fromStyles:u,toState:o,toStyles:f,timelines:_,queriedElements:v,preStyleProps:S,postStyleProps:R,totalTime:k,errors:U}}const rU={};class g4{constructor(n,t,o){this._triggerName=n,this.ast=t,this._stateStyles=o}match(n,t,o,c){return function z9(e,n,t,o,c){return e.some(u=>u(n,t,o,c))}(this.ast.matchers,n,t,o,c)}buildStyles(n,t,o){let c=this._stateStyles.get("*");return void 0!==n&&(c=this._stateStyles.get(n?.toString())||c),c?c.buildStyles(t,o):new Map}build(n,t,o,c,u,f,_,v,S,R){const k=[],U=this.ast.options&&this.ast.options.params||rU,z=this.buildStyles(o,_&&_.params||rU,k),X=v&&v.params||rU,le=this.buildStyles(c,X,k),pe=new Set,ae=new Map,Ve=new Map,je="void"===c,Pt={params:q9(X,U),delay:this.ast.options?.delay},di=R?[]:tU(n,t,this.ast.animation,u,f,z,le,Pt,S,k);let ui=0;if(di.forEach(la=>{ui=Math.max(la.duration+la.delay,ui)}),k.length)return _4(t,this._triggerName,o,c,je,z,le,[],[],ae,Ve,ui,k);di.forEach(la=>{const Dc=la.element,h1=sa(ae,Dc,new Set);la.preStyleProps.forEach(Nm=>h1.add(Nm));const jT=sa(Ve,Dc,new Set);la.postStyleProps.forEach(Nm=>jT.add(Nm)),Dc!==t&&pe.add(Dc)});const Po=NP(pe.values());return _4(t,this._triggerName,o,c,je,z,le,di,Po,ae,Ve,ui)}}function q9(e,n){const t=ET(n);for(const o in e)e.hasOwnProperty(o)&&null!=e[o]&&(t[o]=e[o]);return t}class K9{constructor(n,t,o){this.styles=n,this.defaultParams=t,this.normalizer=o}buildStyles(n,t){const o=new Map,c=ET(this.defaultParams);return Object.keys(n).forEach(u=>{const f=n[u];null!==f&&(c[u]=f)}),this.styles.styles.forEach(u=>{"string"!=typeof u&&u.forEach((f,_)=>{f&&(f=yT(f,c,t));const v=this.normalizer.normalizePropertyName(_,t);f=this.normalizer.normalizeStyleValue(_,v,f,t),o.set(_,f)})}),o}}class $9{constructor(n,t,o){this.name=n,this.ast=t,this._normalizer=o,this.transitionFactories=[],this.states=new Map,t.states.forEach(c=>{this.states.set(c.name,new K9(c.style,c.options&&c.options.params||{},o))}),E4(this.states,"true","1"),E4(this.states,"false","0"),t.transitions.forEach(c=>{this.transitionFactories.push(new g4(n,c,this.states))}),this.fallbackTransition=function X9(e,n,t){return new g4(e,{type:1,animation:{type:2,steps:[],options:null},matchers:[(f,_)=>!0],options:null,queryCount:0,depCount:0},n)}(n,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(n,t,o,c){return this.transitionFactories.find(f=>f.match(n,t,o,c))||null}matchStyles(n,t,o){return this.fallbackTransition.buildStyles(n,t,o)}}function E4(e,n,t){e.has(n)?e.has(t)||e.set(t,e.get(n)):e.has(t)&&e.set(n,e.get(t))}const J9=new kP;class Q9{constructor(n,t,o){this.bodyNode=n,this._driver=t,this._normalizer=o,this._animations=new Map,this._playersById=new Map,this.players=[]}register(n,t){const o=[],u=QF(this._driver,t,o,[]);if(o.length)throw function n9(e){return new ue(3503,!1)}();this._animations.set(n,u)}_buildPlayer(n,t,o){const c=n.element,u=e4(this._normalizer,n.keyframes,t,o);return this._driver.animate(c,u,n.duration,n.delay,n.easing,[],!0)}create(n,t,o={}){const c=[],u=this._animations.get(n);let f;const _=new Map;if(u?(f=tU(this._driver,t,u,KF,RP,new Map,new Map,o,J9,c),f.forEach(R=>{const k=sa(_,R.element,new Map);R.postStyleProps.forEach(U=>k.set(U,null))})):(c.push(function i9(){return new ue(3300,!1)}()),f=[]),c.length)throw function r9(e){return new ue(3504,!1)}();_.forEach((R,k)=>{R.forEach((U,G)=>{R.set(G,this._driver.computeStyle(k,G,eu))})});const S=Zh(f.map(R=>{const k=_.get(R.element);return this._buildPlayer(R,new Map,k)}));return this._playersById.set(n,S),S.onDestroy(()=>this.destroy(n)),this.players.push(S),S}destroy(n){const t=this._getPlayer(n);t.destroy(),this._playersById.delete(n);const o=this.players.indexOf(t);o>=0&&this.players.splice(o,1)}_getPlayer(n){const t=this._playersById.get(n);if(!t)throw function o9(e){return new ue(3301,!1)}();return t}listen(n,t,o,c){const u=WF(t,"","","");return HF(this._getPlayer(n),o,u,c),()=>{}}command(n,t,o,c){if("register"==o)return void this.register(n,c[0]);if("create"==o)return void this.create(n,t,c[0]||{});const u=this._getPlayer(n);switch(o){case"play":u.play();break;case"pause":u.pause();break;case"reset":u.reset();break;case"restart":u.restart();break;case"finish":u.finish();break;case"init":u.init();break;case"setPosition":u.setPosition(parseFloat(c[0]));break;case"destroy":this.destroy(n)}}}const v4="ng-animate-queued",oU="ng-animate-disabled",iz=[],y4={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},rz={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Ic="__ng_removed";class sU{get params(){return this.options.params}constructor(n,t=""){this.namespaceId=t;const o=n&&n.hasOwnProperty("value");if(this.value=function cz(e){return e??null}(o?n.value:n),o){const u=ET(n);delete u.value,this.options=u}else this.options={};this.options.params||(this.options.params={})}absorbOptions(n){const t=n.params;if(t){const o=this.options.params;Object.keys(t).forEach(c=>{null==o[c]&&(o[c]=t[c])})}}}const bT="void",aU=new sU(bT);class oz{constructor(n,t,o){this.id=n,this.hostElement=t,this._engine=o,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+n,za(t,this._hostClassName)}listen(n,t,o,c){if(!this._triggers.has(t))throw function s9(e,n){return new ue(3302,!1)}();if(null==o||0==o.length)throw function a9(e){return new ue(3303,!1)}();if(!function lz(e){return"start"==e||"done"==e}(o))throw function c9(e,n){return new ue(3400,!1)}();const u=sa(this._elementListeners,n,[]),f={name:t,phase:o,callback:c};u.push(f);const _=sa(this._engine.statesByElement,n,new Map);return _.has(t)||(za(n,AP),za(n,AP+"-"+t),_.set(t,aU)),()=>{this._engine.afterFlush(()=>{const v=u.indexOf(f);v>=0&&u.splice(v,1),this._triggers.has(t)||_.delete(t)})}}register(n,t){return!this._triggers.has(n)&&(this._triggers.set(n,t),!0)}_getTrigger(n){const t=this._triggers.get(n);if(!t)throw function l9(e){return new ue(3401,!1)}();return t}trigger(n,t,o,c=!0){const u=this._getTrigger(t),f=new cU(this.id,t,n);let _=this._engine.statesByElement.get(n);_||(za(n,AP),za(n,AP+"-"+t),this._engine.statesByElement.set(n,_=new Map));let v=_.get(t);const S=new sU(o,this.id);if(!(o&&o.hasOwnProperty("value"))&&v&&S.absorbOptions(v.options),_.set(t,S),v||(v=aU),S.value!==bT&&v.value===S.value){if(!function hz(e,n){const t=Object.keys(e),o=Object.keys(n);if(t.length!=o.length)return!1;for(let c=0;c<t.length;c++){const u=t[c];if(!n.hasOwnProperty(u)||e[u]!==n[u])return!1}return!0}(v.params,S.params)){const X=[],le=u.matchStyles(v.value,v.params,X),pe=u.matchStyles(S.value,S.params,X);X.length?this._engine.reportError(X):this._engine.afterFlush(()=>{bm(n,le),Fl(n,pe)})}return}const U=sa(this._engine.playersByElement,n,[]);U.forEach(X=>{X.namespaceId==this.id&&X.triggerName==t&&X.queued&&X.destroy()});let G=u.matchTransition(v.value,S.value,n,S.params),z=!1;if(!G){if(!c)return;G=u.fallbackTransition,z=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:n,triggerName:t,transition:G,fromState:v,toState:S,player:f,isFallbackTransition:z}),z||(za(n,v4),f.onStart(()=>{Lv(n,v4)})),f.onDone(()=>{let X=this.players.indexOf(f);X>=0&&this.players.splice(X,1);const le=this._engine.playersByElement.get(n);if(le){let pe=le.indexOf(f);pe>=0&&le.splice(pe,1)}}),this.players.push(f),U.push(f),f}deregister(n){this._triggers.delete(n),this._engine.statesByElement.forEach(t=>t.delete(n)),this._elementListeners.forEach((t,o)=>{this._elementListeners.set(o,t.filter(c=>c.name!=n))})}clearElementCache(n){this._engine.statesByElement.delete(n),this._elementListeners.delete(n);const t=this._engine.playersByElement.get(n);t&&(t.forEach(o=>o.destroy()),this._engine.playersByElement.delete(n))}_signalRemovalForInnerTriggers(n,t){const o=this._engine.driver.query(n,DP,!0);o.forEach(c=>{if(c[Ic])return;const u=this._engine.fetchNamespacesByElement(c);u.size?u.forEach(f=>f.triggerLeaveAnimation(c,t,!1,!0)):this.clearElementCache(c)}),this._engine.afterFlushAnimationsDone(()=>o.forEach(c=>this.clearElementCache(c)))}triggerLeaveAnimation(n,t,o,c){const u=this._engine.statesByElement.get(n),f=new Map;if(u){const _=[];if(u.forEach((v,S)=>{if(f.set(S,v.value),this._triggers.has(S)){const R=this.trigger(n,S,bT,c);R&&_.push(R)}}),_.length)return this._engine.markElementAsRemoved(this.id,n,!0,t,f),o&&Zh(_).onDone(()=>this._engine.processLeaveNode(n)),!0}return!1}prepareLeaveAnimationListeners(n){const t=this._elementListeners.get(n),o=this._engine.statesByElement.get(n);if(t&&o){const c=new Set;t.forEach(u=>{const f=u.name;if(c.has(f))return;c.add(f);const v=this._triggers.get(f).fallbackTransition,S=o.get(f)||aU,R=new sU(bT),k=new cU(this.id,f,n);this._engine.totalQueuedPlayers++,this._queue.push({element:n,triggerName:f,transition:v,fromState:S,toState:R,player:k,isFallbackTransition:!0})})}}removeNode(n,t){const o=this._engine;if(n.childElementCount&&this._signalRemovalForInnerTriggers(n,t),this.triggerLeaveAnimation(n,t,!0))return;let c=!1;if(o.totalAnimations){const u=o.players.length?o.playersByQueriedElement.get(n):[];if(u&&u.length)c=!0;else{let f=n;for(;f=f.parentNode;)if(o.statesByElement.get(f)){c=!0;break}}}if(this.prepareLeaveAnimationListeners(n),c)o.markElementAsRemoved(this.id,n,!1,t);else{const u=n[Ic];(!u||u===y4)&&(o.afterFlush(()=>this.clearElementCache(n)),o.destroyInnerAnimations(n),o._onRemovalComplete(n,t))}}insertNode(n,t){za(n,this._hostClassName)}drainQueuedTransitions(n){const t=[];return this._queue.forEach(o=>{const c=o.player;if(c.destroyed)return;const u=o.element,f=this._elementListeners.get(u);f&&f.forEach(_=>{if(_.name==o.triggerName){const v=WF(u,o.triggerName,o.fromState.value,o.toState.value);v._data=n,HF(o.player,_.phase,v,_.callback)}}),c.markedForDestroy?this._engine.afterFlush(()=>{c.destroy()}):t.push(o)}),this._queue=[],t.sort((o,c)=>{const u=o.transition.ast.depCount,f=c.transition.ast.depCount;return 0==u||0==f?u-f:this._engine.driver.containsElement(o.element,c.element)?1:-1})}destroy(n){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,n)}}class sz{_onRemovalComplete(n,t){this.onRemovalComplete(n,t)}constructor(n,t,o){this.bodyNode=n,this.driver=t,this._normalizer=o,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(c,u)=>{}}get queuedPlayers(){const n=[];return this._namespaceList.forEach(t=>{t.players.forEach(o=>{o.queued&&n.push(o)})}),n}createNamespace(n,t){const o=new oz(n,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(o,t):(this.newHostElements.set(t,o),this.collectEnterElement(t)),this._namespaceLookup[n]=o}_balanceNamespaceList(n,t){const o=this._namespaceList,c=this.namespacesByHostElement;if(o.length-1>=0){let f=!1,_=this.driver.getParentElement(t);for(;_;){const v=c.get(_);if(v){const S=o.indexOf(v);o.splice(S+1,0,n),f=!0;break}_=this.driver.getParentElement(_)}f||o.unshift(n)}else o.push(n);return c.set(t,n),n}register(n,t){let o=this._namespaceLookup[n];return o||(o=this.createNamespace(n,t)),o}registerTrigger(n,t,o){let c=this._namespaceLookup[n];c&&c.register(t,o)&&this.totalAnimations++}destroy(n,t){n&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{const o=this._fetchNamespace(n);this.namespacesByHostElement.delete(o.hostElement);const c=this._namespaceList.indexOf(o);c>=0&&this._namespaceList.splice(c,1),o.destroy(t),delete this._namespaceLookup[n]}))}_fetchNamespace(n){return this._namespaceLookup[n]}fetchNamespacesByElement(n){const t=new Set,o=this.statesByElement.get(n);if(o)for(let c of o.values())if(c.namespaceId){const u=this._fetchNamespace(c.namespaceId);u&&t.add(u)}return t}trigger(n,t,o,c){if(UP(t)){const u=this._fetchNamespace(n);if(u)return u.trigger(t,o,c),!0}return!1}insertNode(n,t,o,c){if(!UP(t))return;const u=t[Ic];if(u&&u.setForRemoval){u.setForRemoval=!1,u.setForMove=!0;const f=this.collectedLeaveElements.indexOf(t);f>=0&&this.collectedLeaveElements.splice(f,1)}if(n){const f=this._fetchNamespace(n);f&&f.insertNode(t,o)}c&&this.collectEnterElement(t)}collectEnterElement(n){this.collectedEnterElements.push(n)}markElementAsDisabled(n,t){t?this.disabledNodes.has(n)||(this.disabledNodes.add(n),za(n,oU)):this.disabledNodes.has(n)&&(this.disabledNodes.delete(n),Lv(n,oU))}removeNode(n,t,o){if(UP(t)){const c=n?this._fetchNamespace(n):null;c?c.removeNode(t,o):this.markElementAsRemoved(n,t,!1,o);const u=this.namespacesByHostElement.get(t);u&&u.id!==n&&u.removeNode(t,o)}else this._onRemovalComplete(t,o)}markElementAsRemoved(n,t,o,c,u){this.collectedLeaveElements.push(t),t[Ic]={namespaceId:n,setForRemoval:c,hasAnimation:o,removedBeforeQueried:!1,previousTriggersValues:u}}listen(n,t,o,c,u){return UP(t)?this._fetchNamespace(n).listen(t,o,c,u):()=>{}}_buildInstruction(n,t,o,c,u){return n.transition.build(this.driver,n.element,n.fromState.value,n.toState.value,o,c,n.fromState.options,n.toState.options,t,u)}destroyInnerAnimations(n){let t=this.driver.query(n,DP,!0);t.forEach(o=>this.destroyActiveAnimationsForElement(o)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(n,YF,!0),t.forEach(o=>this.finishActiveQueriedAnimationOnElement(o)))}destroyActiveAnimationsForElement(n){const t=this.playersByElement.get(n);t&&t.forEach(o=>{o.queued?o.markedForDestroy=!0:o.destroy()})}finishActiveQueriedAnimationOnElement(n){const t=this.playersByQueriedElement.get(n);t&&t.forEach(o=>o.finish())}whenRenderingDone(){return new Promise(n=>{if(this.players.length)return Zh(this.players).onDone(()=>n());n()})}processLeaveNode(n){const t=n[Ic];if(t&&t.setForRemoval){if(n[Ic]=y4,t.namespaceId){this.destroyInnerAnimations(n);const o=this._fetchNamespace(t.namespaceId);o&&o.clearElementCache(n)}this._onRemovalComplete(n,t.setForRemoval)}n.classList?.contains(oU)&&this.markElementAsDisabled(n,!1),this.driver.query(n,".ng-animate-disabled",!0).forEach(o=>{this.markElementAsDisabled(o,!1)})}flush(n=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((o,c)=>this._balanceNamespaceList(o,c)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let o=0;o<this.collectedEnterElements.length;o++)za(this.collectedEnterElements[o],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const o=[];try{t=this._flushAnimations(o,n)}finally{for(let c=0;c<o.length;c++)o[c]()}}else for(let o=0;o<this.collectedLeaveElements.length;o++)this.processLeaveNode(this.collectedLeaveElements[o]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(o=>o()),this._flushFns=[],this._whenQuietFns.length){const o=this._whenQuietFns;this._whenQuietFns=[],t.length?Zh(t).onDone(()=>{o.forEach(c=>c())}):o.forEach(c=>c())}}reportError(n){throw function d9(e){return new ue(3402,!1)}()}_flushAnimations(n,t){const o=new kP,c=[],u=new Map,f=[],_=new Map,v=new Map,S=new Map,R=new Set;this.disabledNodes.forEach(qe=>{R.add(qe);const ot=this.driver.query(qe,".ng-animate-queued",!0);for(let pt=0;pt<ot.length;pt++)R.add(ot[pt])});const k=this.bodyNode,U=Array.from(this.statesByElement.keys()),G=C4(U,this.collectedEnterElements),z=new Map;let X=0;G.forEach((qe,ot)=>{const pt=KF+X++;z.set(ot,pt),qe.forEach(fn=>za(fn,pt))});const le=[],pe=new Set,ae=new Set;for(let qe=0;qe<this.collectedLeaveElements.length;qe++){const ot=this.collectedLeaveElements[qe],pt=ot[Ic];pt&&pt.setForRemoval&&(le.push(ot),pe.add(ot),pt.hasAnimation?this.driver.query(ot,".ng-star-inserted",!0).forEach(fn=>pe.add(fn)):ae.add(ot))}const Ve=new Map,je=C4(U,Array.from(pe));je.forEach((qe,ot)=>{const pt=RP+X++;Ve.set(ot,pt),qe.forEach(fn=>za(fn,pt))}),n.push(()=>{G.forEach((qe,ot)=>{const pt=z.get(ot);qe.forEach(fn=>Lv(fn,pt))}),je.forEach((qe,ot)=>{const pt=Ve.get(ot);qe.forEach(fn=>Lv(fn,pt))}),le.forEach(qe=>{this.processLeaveNode(qe)})});const Pt=[],di=[];for(let qe=this._namespaceList.length-1;qe>=0;qe--)this._namespaceList[qe].drainQueuedTransitions(t).forEach(pt=>{const fn=pt.player,Fr=pt.element;if(Pt.push(fn),this.collectedEnterElements.length){const xo=Fr[Ic];if(xo&&xo.setForMove){if(xo.previousTriggersValues&&xo.previousTriggersValues.has(pt.triggerName)){const Pm=xo.previousTriggersValues.get(pt.triggerName),qa=this.statesByElement.get(pt.element);if(qa&&qa.has(pt.triggerName)){const p1=qa.get(pt.triggerName);p1.value=Pm,qa.set(pt.triggerName,p1)}}return void fn.destroy()}}const jl=!k||!this.driver.containsElement(k,Fr),da=Ve.get(Fr),sp=z.get(Fr),xi=this._buildInstruction(pt,o,sp,da,jl);if(xi.errors&&xi.errors.length)return void di.push(xi);if(jl)return fn.onStart(()=>bm(Fr,xi.fromStyles)),fn.onDestroy(()=>Fl(Fr,xi.toStyles)),void c.push(fn);if(pt.isFallbackTransition)return fn.onStart(()=>bm(Fr,xi.fromStyles)),fn.onDestroy(()=>Fl(Fr,xi.toStyles)),void c.push(fn);const C6=[];xi.timelines.forEach(xo=>{xo.stretchStartingKeyframe=!0,this.disabledNodes.has(xo.element)||C6.push(xo)}),xi.timelines=C6,o.append(Fr,xi.timelines),f.push({instruction:xi,player:fn,element:Fr}),xi.queriedElements.forEach(xo=>sa(_,xo,[]).push(fn)),xi.preStyleProps.forEach((xo,Pm)=>{if(xo.size){let qa=v.get(Pm);qa||v.set(Pm,qa=new Set),xo.forEach((p1,tV)=>qa.add(tV))}}),xi.postStyleProps.forEach((xo,Pm)=>{let qa=S.get(Pm);qa||S.set(Pm,qa=new Set),xo.forEach((p1,tV)=>qa.add(tV))})});if(di.length){const qe=[];di.forEach(ot=>{qe.push(function u9(e,n){return new ue(3505,!1)}())}),Pt.forEach(ot=>ot.destroy()),this.reportError(qe)}const ui=new Map,Po=new Map;f.forEach(qe=>{const ot=qe.element;o.has(ot)&&(Po.set(ot,ot),this._beforeAnimationBuild(qe.player.namespaceId,qe.instruction,ui))}),c.forEach(qe=>{const ot=qe.element;this._getPreviousPlayers(ot,!1,qe.namespaceId,qe.triggerName,null).forEach(fn=>{sa(ui,ot,[]).push(fn),fn.destroy()})});const la=le.filter(qe=>w4(qe,v,S)),Dc=new Map;S4(Dc,this.driver,ae,S,eu).forEach(qe=>{w4(qe,v,S)&&la.push(qe)});const jT=new Map;G.forEach((qe,ot)=>{S4(jT,this.driver,new Set(qe),v,"!")}),la.forEach(qe=>{const ot=Dc.get(qe),pt=jT.get(qe);Dc.set(qe,new Map([...ot?.entries()??[],...pt?.entries()??[]]))});const Nm=[],b6=[],S6={};f.forEach(qe=>{const{element:ot,player:pt,instruction:fn}=qe;if(o.has(ot)){if(R.has(ot))return pt.onDestroy(()=>Fl(ot,fn.toStyles)),pt.disabled=!0,pt.overrideTotalTime(fn.totalTime),void c.push(pt);let Fr=S6;if(Po.size>1){let da=ot;const sp=[];for(;da=da.parentNode;){const xi=Po.get(da);if(xi){Fr=xi;break}sp.push(da)}sp.forEach(xi=>Po.set(xi,Fr))}const jl=this._buildAnimation(pt.namespaceId,fn,ui,u,jT,Dc);if(pt.setRealPlayer(jl),Fr===S6)Nm.push(pt);else{const da=this.playersByElement.get(Fr);da&&da.length&&(pt.parentPlayer=Zh(da)),c.push(pt)}}else bm(ot,fn.fromStyles),pt.onDestroy(()=>Fl(ot,fn.toStyles)),b6.push(pt),R.has(ot)&&c.push(pt)}),b6.forEach(qe=>{const ot=u.get(qe.element);if(ot&&ot.length){const pt=Zh(ot);qe.setRealPlayer(pt)}}),c.forEach(qe=>{qe.parentPlayer?qe.syncPlayerEvents(qe.parentPlayer):qe.destroy()});for(let qe=0;qe<le.length;qe++){const ot=le[qe],pt=ot[Ic];if(Lv(ot,RP),pt&&pt.hasAnimation)continue;let fn=[];if(_.size){let jl=_.get(ot);jl&&jl.length&&fn.push(...jl);let da=this.driver.query(ot,YF,!0);for(let sp=0;sp<da.length;sp++){let xi=_.get(da[sp]);xi&&xi.length&&fn.push(...xi)}}const Fr=fn.filter(jl=>!jl.destroyed);Fr.length?dz(this,ot,Fr):this.processLeaveNode(ot)}return le.length=0,Nm.forEach(qe=>{this.players.push(qe),qe.onDone(()=>{qe.destroy();const ot=this.players.indexOf(qe);this.players.splice(ot,1)}),qe.play()}),Nm}afterFlush(n){this._flushFns.push(n)}afterFlushAnimationsDone(n){this._whenQuietFns.push(n)}_getPreviousPlayers(n,t,o,c,u){let f=[];if(t){const _=this.playersByQueriedElement.get(n);_&&(f=_)}else{const _=this.playersByElement.get(n);if(_){const v=!u||u==bT;_.forEach(S=>{S.queued||!v&&S.triggerName!=c||f.push(S)})}}return(o||c)&&(f=f.filter(_=>!(o&&o!=_.namespaceId||c&&c!=_.triggerName))),f}_beforeAnimationBuild(n,t,o){const u=t.element,f=t.isRemovalTransition?void 0:n,_=t.isRemovalTransition?void 0:t.triggerName;for(const v of t.timelines){const S=v.element,R=S!==u,k=sa(o,S,[]);this._getPreviousPlayers(S,R,f,_,t.toState).forEach(G=>{const z=G.getRealPlayer();z.beforeDestroy&&z.beforeDestroy(),G.destroy(),k.push(G)})}bm(u,t.fromStyles)}_buildAnimation(n,t,o,c,u,f){const _=t.triggerName,v=t.element,S=[],R=new Set,k=new Set,U=t.timelines.map(z=>{const X=z.element;R.add(X);const le=X[Ic];if(le&&le.removedBeforeQueried)return new _T(z.duration,z.delay);const pe=X!==v,ae=function uz(e){const n=[];return T4(e,n),n}((o.get(X)||iz).map(ui=>ui.getRealPlayer())).filter(ui=>!!ui.element&&ui.element===X),Ve=u.get(X),je=f.get(X),Pt=e4(this._normalizer,z.keyframes,Ve,je),di=this._buildPlayer(z,Pt,ae);if(z.subTimeline&&c&&k.add(X),pe){const ui=new cU(n,_,X);ui.setRealPlayer(di),S.push(ui)}return di});S.forEach(z=>{sa(this.playersByQueriedElement,z.element,[]).push(z),z.onDone(()=>function az(e,n,t){let o=e.get(n);if(o){if(o.length){const c=o.indexOf(t);o.splice(c,1)}0==o.length&&e.delete(n)}return o}(this.playersByQueriedElement,z.element,z))}),R.forEach(z=>za(z,a4));const G=Zh(U);return G.onDestroy(()=>{R.forEach(z=>Lv(z,a4)),Fl(v,t.toStyles)}),k.forEach(z=>{sa(c,z,[]).push(G)}),G}_buildPlayer(n,t,o){return t.length>0?this.driver.animate(n.element,t,n.duration,n.delay,n.easing,o):new _T(n.duration,n.delay)}}class cU{constructor(n,t,o){this.namespaceId=n,this.triggerName=t,this.element=o,this._player=new _T,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(n){this._containsRealPlayer||(this._player=n,this._queuedCallbacks.forEach((t,o)=>{t.forEach(c=>HF(n,o,void 0,c))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(n.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(n){this.totalTime=n}syncPlayerEvents(n){const t=this._player;t.triggerCallback&&n.onStart(()=>t.triggerCallback("start")),n.onDone(()=>this.finish()),n.onDestroy(()=>this.destroy())}_queueEvent(n,t){sa(this._queuedCallbacks,n,[]).push(t)}onDone(n){this.queued&&this._queueEvent("done",n),this._player.onDone(n)}onStart(n){this.queued&&this._queueEvent("start",n),this._player.onStart(n)}onDestroy(n){this.queued&&this._queueEvent("destroy",n),this._player.onDestroy(n)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(n){this.queued||this._player.setPosition(n)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(n){const t=this._player;t.triggerCallback&&t.triggerCallback(n)}}function UP(e){return e&&1===e.nodeType}function b4(e,n){const t=e.style.display;return e.style.display=n??"none",t}function S4(e,n,t,o,c){const u=[];t.forEach(v=>u.push(b4(v)));const f=[];o.forEach((v,S)=>{const R=new Map;v.forEach(k=>{const U=n.computeStyle(S,k,c);R.set(k,U),(!U||0==U.length)&&(S[Ic]=rz,f.push(S))}),e.set(S,R)});let _=0;return t.forEach(v=>b4(v,u[_++])),f}function C4(e,n){const t=new Map;if(e.forEach(_=>t.set(_,[])),0==n.length)return t;const c=new Set(n),u=new Map;function f(_){if(!_)return 1;let v=u.get(_);if(v)return v;const S=_.parentNode;return v=t.has(S)?S:c.has(S)?1:f(S),u.set(_,v),v}return n.forEach(_=>{const v=f(_);1!==v&&t.get(v).push(_)}),t}function za(e,n){e.classList?.add(n)}function Lv(e,n){e.classList?.remove(n)}function dz(e,n,t){Zh(t).onDone(()=>e.processLeaveNode(n))}function T4(e,n){for(let t=0;t<e.length;t++){const o=e[t];o instanceof Ej?T4(o.players,n):n.push(o)}}function w4(e,n,t){const o=t.get(e);if(!o)return!1;let c=n.get(e);return c?o.forEach(u=>c.add(u)):n.set(e,o),t.delete(e),!0}class VP{constructor(n,t,o){this.bodyNode=n,this._driver=t,this._normalizer=o,this._triggerCache={},this.onRemovalComplete=(c,u)=>{},this._transitionEngine=new sz(n,t,o),this._timelineEngine=new Q9(n,t,o),this._transitionEngine.onRemovalComplete=(c,u)=>this.onRemovalComplete(c,u)}registerTrigger(n,t,o,c,u){const f=n+"-"+c;let _=this._triggerCache[f];if(!_){const v=[],R=QF(this._driver,u,v,[]);if(v.length)throw function e9(e,n){return new ue(3404,!1)}();_=function Y9(e,n,t){return new $9(e,n,t)}(c,R,this._normalizer),this._triggerCache[f]=_}this._transitionEngine.registerTrigger(t,c,_)}register(n,t){this._transitionEngine.register(n,t)}destroy(n,t){this._transitionEngine.destroy(n,t)}onInsert(n,t,o,c){this._transitionEngine.insertNode(n,t,o,c)}onRemove(n,t,o){this._transitionEngine.removeNode(n,t,o)}disableAnimations(n,t){this._transitionEngine.markElementAsDisabled(n,t)}process(n,t,o,c){if("@"==o.charAt(0)){const[u,f]=t4(o);this._timelineEngine.command(u,t,f,c)}else this._transitionEngine.trigger(n,t,o,c)}listen(n,t,o,c,u){if("@"==o.charAt(0)){const[f,_]=t4(o);return this._timelineEngine.listen(f,t,_,u)}return this._transitionEngine.listen(n,t,o,c,u)}flush(n=-1){this._transitionEngine.flush(n)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(n){this._transitionEngine.afterFlushAnimationsDone(n)}}let fz=(()=>{class e{static#e=this.initialStylesByElement=new WeakMap;constructor(t,o,c){this._element=t,this._startStyles=o,this._endStyles=c,this._state=0;let u=e.initialStylesByElement.get(t);u||e.initialStylesByElement.set(t,u=new Map),this._initialStyles=u}start(){this._state<1&&(this._startStyles&&Fl(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Fl(this._element,this._initialStyles),this._endStyles&&(Fl(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(e.initialStylesByElement.delete(this._element),this._startStyles&&(bm(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(bm(this._element,this._endStyles),this._endStyles=null),Fl(this._element,this._initialStyles),this._state=3)}}return e})();function lU(e){let n=null;return e.forEach((t,o)=>{(function mz(e){return"display"===e||"position"===e})(o)&&(n=n||new Map,n.set(o,t))}),n}class I4{constructor(n,t,o,c){this.element=n,this.keyframes=t,this.options=o,this._specialStyles=c,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=o.duration,this._delay=o.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(n=>n()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const n=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,n,this.options),this._finalKeyframe=n.length?n[n.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(n){const t=[];return n.forEach(o=>{t.push(Object.fromEntries(o))}),t}_triggerWebAnimation(n,t,o){return n.animate(this._convertKeyframesToObject(t),o)}onStart(n){this._originalOnStartFns.push(n),this._onStartFns.push(n)}onDone(n){this._originalOnDoneFns.push(n),this._onDoneFns.push(n)}onDestroy(n){this._onDestroyFns.push(n)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(n=>n()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(n=>n()),this._onDestroyFns=[])}setPosition(n){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=n*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const n=new Map;this.hasStarted()&&this._finalKeyframe.forEach((o,c)=>{"offset"!==c&&n.set(c,this._finished?o:u4(this.element,c))}),this.currentSnapshot=n}triggerCallback(n){const t="start"===n?this._onStartFns:this._onDoneFns;t.forEach(o=>o()),t.length=0}}class _z{validateStyleProperty(n){return!0}validateAnimatableStyleProperty(n){return!0}matchesElement(n,t){return!1}containsElement(n,t){return i4(n,t)}getParentElement(n){return zF(n)}query(n,t,o){return r4(n,t,o)}computeStyle(n,t,o){return window.getComputedStyle(n)[t]}animate(n,t,o,c,u,f=[]){const v={duration:o,delay:c,fill:0==c?"both":"forwards"};u&&(v.easing=u);const S=new Map,R=f.filter(G=>G instanceof I4);(function C9(e,n){return 0===e||0===n})(o,c)&&R.forEach(G=>{G.currentSnapshot.forEach((z,X)=>S.set(X,z))});let k=function y9(e){return e.length?e[0]instanceof Map?e:e.map(n=>c4(n)):[]}(t).map(G=>ep(G));k=function T9(e,n,t){if(t.size&&n.length){let o=n[0],c=[];if(t.forEach((u,f)=>{o.has(f)||c.push(f),o.set(f,u)}),c.length)for(let u=1;u<n.length;u++){let f=n[u];c.forEach(_=>f.set(_,u4(e,_)))}}return n}(n,k,S);const U=function pz(e,n){let t=null,o=null;return Array.isArray(n)&&n.length?(t=lU(n[0]),n.length>1&&(o=lU(n[n.length-1]))):n instanceof Map&&(t=lU(n)),t||o?new fz(e,t,o):null}(n,k);return new I4(n,k,v,U)}}let gz=(()=>{class e extends _j{constructor(t,o){super(),this._nextAnimationId=0,this._renderer=t.createRenderer(o.body,{id:"0",encapsulation:Rr.None,styles:[],data:{animation:[]}})}build(t){const o=this._nextAnimationId.toString();this._nextAnimationId++;const c=Array.isArray(t)?gj(t):t;return R4(this._renderer,null,o,"register",[c]),new Ez(o,this._renderer)}static#e=this.\u0275fac=function(o){return new(o||e)(fe(nf),fe(Kt))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac})}return e})();class Ez extends AH{constructor(n,t){super(),this._id=n,this._renderer=t}create(n,t){return new vz(this._id,n,t||{},this._renderer)}}class vz{constructor(n,t,o,c){this.id=n,this.element=t,this._renderer=c,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",o)}_listen(n,t){return this._renderer.listen(this.element,`@@${this.id}:${n}`,t)}_command(n,...t){return R4(this._renderer,this.element,this.id,n,t)}onDone(n){this._listen("done",n)}onStart(n){this._listen("start",n)}onDestroy(n){this._listen("destroy",n)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(n){this._command("setPosition",n)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function R4(e,n,t,o,c){return e.setProperty(n,`@@${t}:${o}`,c)}const A4="@.disabled";let yz=(()=>{class e{constructor(t,o,c){this.delegate=t,this.engine=o,this._zone=c,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,o.onRemovalComplete=(u,f)=>{const _=f?.parentNode(u);_&&f.removeChild(_,u)}}createRenderer(t,o){const u=this.delegate.createRenderer(t,o);if(!(t&&o&&o.data&&o.data.animation)){let R=this._rendererCache.get(u);return R||(R=new D4("",u,this.engine,()=>this._rendererCache.delete(u)),this._rendererCache.set(u,R)),R}const f=o.id,_=o.id+"-"+this._currentId;this._currentId++,this.engine.register(_,t);const v=R=>{Array.isArray(R)?R.forEach(v):this.engine.registerTrigger(f,_,t,R.name,R)};return o.data.animation.forEach(v),new bz(this,_,u,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(t,o,c){t>=0&&t<this._microtaskId?this._zone.run(()=>o(c)):(0==this._animationCallbacksBuffer.length&&queueMicrotask(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(u=>{const[f,_]=u;f(_)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([o,c]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}static#e=this.\u0275fac=function(o){return new(o||e)(fe(nf),fe(VP),fe(lt))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac})}return e})();class D4{constructor(n,t,o,c){this.namespaceId=n,this.delegate=t,this.engine=o,this._onDestroy=c}get data(){return this.delegate.data}destroyNode(n){this.delegate.destroyNode?.(n)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(n,t){return this.delegate.createElement(n,t)}createComment(n){return this.delegate.createComment(n)}createText(n){return this.delegate.createText(n)}appendChild(n,t){this.delegate.appendChild(n,t),this.engine.onInsert(this.namespaceId,t,n,!1)}insertBefore(n,t,o,c=!0){this.delegate.insertBefore(n,t,o),this.engine.onInsert(this.namespaceId,t,n,c)}removeChild(n,t,o){this.engine.onRemove(this.namespaceId,t,this.delegate)}selectRootElement(n,t){return this.delegate.selectRootElement(n,t)}parentNode(n){return this.delegate.parentNode(n)}nextSibling(n){return this.delegate.nextSibling(n)}setAttribute(n,t,o,c){this.delegate.setAttribute(n,t,o,c)}removeAttribute(n,t,o){this.delegate.removeAttribute(n,t,o)}addClass(n,t){this.delegate.addClass(n,t)}removeClass(n,t){this.delegate.removeClass(n,t)}setStyle(n,t,o,c){this.delegate.setStyle(n,t,o,c)}removeStyle(n,t,o){this.delegate.removeStyle(n,t,o)}setProperty(n,t,o){"@"==t.charAt(0)&&t==A4?this.disableAnimations(n,!!o):this.delegate.setProperty(n,t,o)}setValue(n,t){this.delegate.setValue(n,t)}listen(n,t,o){return this.delegate.listen(n,t,o)}disableAnimations(n,t){this.engine.disableAnimations(n,t)}}class bz extends D4{constructor(n,t,o,c,u){super(t,o,c,u),this.factory=n,this.namespaceId=t}setProperty(n,t,o){"@"==t.charAt(0)?"."==t.charAt(1)&&t==A4?this.disableAnimations(n,o=void 0===o||!!o):this.engine.process(this.namespaceId,n,t.slice(1),o):this.delegate.setProperty(n,t,o)}listen(n,t,o){if("@"==t.charAt(0)){const c=function Sz(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(n);let u=t.slice(1),f="";return"@"!=u.charAt(0)&&([u,f]=function Cz(e){const n=e.indexOf(".");return[e.substring(0,n),e.slice(n+1)]}(u)),this.engine.listen(this.namespaceId,c,u,f,_=>{this.factory.scheduleListenerCallback(_._data||-1,o,_)})}return this.delegate.listen(n,t,o)}}const O4=[{provide:_j,useClass:gz},{provide:iU,useFactory:function wz(){return new W9}},{provide:VP,useClass:(()=>{class e extends VP{constructor(t,o,c,u){super(t.body,o,c)}ngOnDestroy(){this.flush()}static#e=this.\u0275fac=function(o){return new(o||e)(fe(Kt),fe(qF),fe(iU),fe(ea))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac})}return e})()},{provide:nf,useFactory:function Iz(e,n,t){return new yz(e,n,t)},deps:[Gi,VP,lt]}],dU=[{provide:qF,useFactory:()=>new _z},{provide:Sa,useValue:"BrowserAnimations"},...O4],N4=[{provide:qF,useClass:o4},{provide:Sa,useValue:"NoopAnimations"},...O4];let Rz=(()=>{class e{static withConfig(t){return{ngModule:e,providers:t.disableAnimations?N4:dU}}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({providers:dU,imports:[QN]})}return e})();const jP=Nc(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function P4(e){return new Ln(n=>{qi(e()).subscribe(n)})}function ST(e,n){const t=M(e)?e:()=>e,o=c=>c.error(t());return new Ln(n?c=>n.schedule(o,0,c):o)}function uU(){return hi((e,n)=>{let t=null;e._refCount++;const o=Jn(n,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(t=null);const c=e._connection,u=t;t=null,c&&(!u||c===u)&&c.unsubscribe(),n.unsubscribe()});e.subscribe(o),o.closed||(t=e.connect())})}class x4 extends Ln{constructor(n,t){super(),this.source=n,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,Xv(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new kn;const t=this.getSubject();n.add(this.source.subscribe(Jn(t,void 0,()=>{this._teardown(),t.complete()},o=>{this._teardown(),t.error(o)},()=>this._teardown()))),n.closed&&(this._connection=null,n=kn.EMPTY)}return n}refCount(){return uU()(this)}}function HP(e){return hi((n,t)=>{let o=!1;n.subscribe(Jn(t,c=>{o=!0,t.next(c)},()=>{o||t.next(e),t.complete()}))})}function M4(e=Dz){return hi((n,t)=>{let o=!1;n.subscribe(Jn(t,c=>{o=!0,t.next(c)},()=>o?t.complete():t.error(e())))})}function Dz(){return new jP}function Cm(e,n){const t=arguments.length>=2;return o=>o.pipe(e?ra((c,u)=>e(c,u,o)):Ka,Zd(1),t?HP(n):M4(()=>new jP))}function CT(e,n){return M(n)?yi(e,n,1):yi(e,1)}function io(e,n,t){const o=M(e)||n||t?{next:e,error:n,complete:t}:e;return o?hi((c,u)=>{var f;null===(f=o.subscribe)||void 0===f||f.call(o);let _=!0;c.subscribe(Jn(u,v=>{var S;null===(S=o.next)||void 0===S||S.call(o,v),u.next(v)},()=>{var v;_=!1,null===(v=o.complete)||void 0===v||v.call(o),u.complete()},v=>{var S;_=!1,null===(S=o.error)||void 0===S||S.call(o,v),u.error(v)},()=>{var v,S;_&&(null===(v=o.unsubscribe)||void 0===v||v.call(o)),null===(S=o.finalize)||void 0===S||S.call(o)}))}):Ka}function Tm(e){return hi((n,t)=>{let u,o=null,c=!1;o=n.subscribe(Jn(t,void 0,void 0,f=>{u=qi(e(f,Tm(e)(n))),o?(o.unsubscribe(),o=null,u.subscribe(t)):c=!0})),c&&(o.unsubscribe(),o=null,u.subscribe(t))})}function hU(e){return e<=0?()=>ks:hi((n,t)=>{let o=[];n.subscribe(Jn(t,c=>{o.push(c),e<o.length&&o.shift()},()=>{for(const c of o)t.next(c);t.complete()},void 0,()=>{o=null}))})}function pU(e){return hi((n,t)=>{try{n.subscribe(t)}finally{t.add(e)}})}const xt="primary",TT=Symbol("RouteTitle");class Mz{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t[0]:t}return null}getAll(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function Fv(e){return new Mz(e)}function kz(e,n,t){const o=t.path.split("/");if(o.length>e.length||"full"===t.pathMatch&&(n.hasChildren()||o.length<e.length))return null;const c={};for(let u=0;u<o.length;u++){const f=o[u],_=e[u];if(f.startsWith(":"))c[f.substring(1)]=_;else if(f!==_.path)return null}return{consumed:e.slice(0,o.length),posParams:c}}function Ul(e,n){const t=e?Object.keys(e):void 0,o=n?Object.keys(n):void 0;if(!t||!o||t.length!=o.length)return!1;let c;for(let u=0;u<t.length;u++)if(c=t[u],!k4(e[c],n[c]))return!1;return!0}function k4(e,n){if(Array.isArray(e)&&Array.isArray(n)){if(e.length!==n.length)return!1;const t=[...e].sort(),o=[...n].sort();return t.every((c,u)=>o[u]===c)}return e===n}function L4(e){return e.length>0?e[e.length-1]:null}function tp(e){return function Az(e){return!!e&&(e instanceof Ln||M(e.lift)&&M(e.subscribe))}(e)?e:fd(e)?Mi(Promise.resolve(e)):He(e)}const Fz={exact:function V4(e,n,t){if(!wm(e.segments,n.segments)||!GP(e.segments,n.segments,t)||e.numberOfChildren!==n.numberOfChildren)return!1;for(const o in n.children)if(!e.children[o]||!V4(e.children[o],n.children[o],t))return!1;return!0},subset:B4},F4={exact:function Uz(e,n){return Ul(e,n)},subset:function Vz(e,n){return Object.keys(n).length<=Object.keys(e).length&&Object.keys(n).every(t=>k4(e[t],n[t]))},ignored:()=>!0};function U4(e,n,t){return Fz[t.paths](e.root,n.root,t.matrixParams)&&F4[t.queryParams](e.queryParams,n.queryParams)&&!("exact"===t.fragment&&e.fragment!==n.fragment)}function B4(e,n,t){return j4(e,n,n.segments,t)}function j4(e,n,t,o){if(e.segments.length>t.length){const c=e.segments.slice(0,t.length);return!(!wm(c,t)||n.hasChildren()||!GP(c,t,o))}if(e.segments.length===t.length){if(!wm(e.segments,t)||!GP(e.segments,t,o))return!1;for(const c in n.children)if(!e.children[c]||!B4(e.children[c],n.children[c],o))return!1;return!0}{const c=t.slice(0,e.segments.length),u=t.slice(e.segments.length);return!!(wm(e.segments,c)&&GP(e.segments,c,o)&&e.children[xt])&&j4(e.children[xt],n,u,o)}}function GP(e,n,t){return n.every((o,c)=>F4[t](e[c].parameters,o.parameters))}class Uv{constructor(n=new Mn([],{}),t={},o=null){this.root=n,this.queryParams=t,this.fragment=o}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Fv(this.queryParams)),this._queryParamMap}toString(){return Hz.serialize(this)}}class Mn{constructor(n,t){this.segments=n,this.children=t,this.parent=null,Object.values(t).forEach(o=>o.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return WP(this)}}class wT{constructor(n,t){this.path=n,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=Fv(this.parameters)),this._parameterMap}toString(){return W4(this)}}function wm(e,n){return e.length===n.length&&e.every((t,o)=>t.path===n[o].path)}let IT=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:function(){return new fU},providedIn:"root"})}return e})();class fU{parse(n){const t=new Zz(n);return new Uv(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(n){const t=`/${RT(n.root,!0)}`,o=function zz(e){const n=Object.keys(e).map(t=>{const o=e[t];return Array.isArray(o)?o.map(c=>`${zP(t)}=${zP(c)}`).join("&"):`${zP(t)}=${zP(o)}`}).filter(t=>!!t);return n.length?`?${n.join("&")}`:""}(n.queryParams);return`${t}${o}${"string"==typeof n.fragment?`#${function Gz(e){return encodeURI(e)}(n.fragment)}`:""}`}}const Hz=new fU;function WP(e){return e.segments.map(n=>W4(n)).join("/")}function RT(e,n){if(!e.hasChildren())return WP(e);if(n){const t=e.children[xt]?RT(e.children[xt],!1):"",o=[];return Object.entries(e.children).forEach(([c,u])=>{c!==xt&&o.push(`${c}:${RT(u,!1)}`)}),o.length>0?`${t}(${o.join("//")})`:t}{const t=function jz(e,n){let t=[];return Object.entries(e.children).forEach(([o,c])=>{o===xt&&(t=t.concat(n(c,o)))}),Object.entries(e.children).forEach(([o,c])=>{o!==xt&&(t=t.concat(n(c,o)))}),t}(e,(o,c)=>c===xt?[RT(e.children[xt],!1)]:[`${c}:${RT(o,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[xt]?`${WP(e)}/${t[0]}`:`${WP(e)}/(${t.join("//")})`}}function H4(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function zP(e){return H4(e).replace(/%3B/gi,";")}function mU(e){return H4(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function qP(e){return decodeURIComponent(e)}function G4(e){return qP(e.replace(/\+/g,"%20"))}function W4(e){return`${mU(e.path)}${function Wz(e){return Object.keys(e).map(n=>`;${mU(n)}=${mU(e[n])}`).join("")}(e.parameters)}`}const qz=/^[^\/()?;#]+/;function _U(e){const n=e.match(qz);return n?n[0]:""}const Kz=/^[^\/()?;=#]+/,$z=/^[^=?&#]+/,Jz=/^[^&#]+/;class Zz{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Mn([],{}):new Mn([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let o={};return this.peekStartsWith("(")&&(o=this.parseParens(!1)),(n.length>0||Object.keys(t).length>0)&&(o[xt]=new Mn(n,t)),o}parseSegment(){const n=_U(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new ue(4009,!1);return this.capture(n),new wT(qP(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const t=function Yz(e){const n=e.match(Kz);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let o="";if(this.consumeOptional("=")){const c=_U(this.remaining);c&&(o=c,this.capture(o))}n[qP(t)]=qP(o)}parseQueryParam(n){const t=function Xz(e){const n=e.match($z);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let o="";if(this.consumeOptional("=")){const f=function Qz(e){const n=e.match(Jz);return n?n[0]:""}(this.remaining);f&&(o=f,this.capture(o))}const c=G4(t),u=G4(o);if(n.hasOwnProperty(c)){let f=n[c];Array.isArray(f)||(f=[f],n[c]=f),f.push(u)}else n[c]=u}parseParens(n){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const o=_U(this.remaining),c=this.remaining[o.length];if("/"!==c&&")"!==c&&";"!==c)throw new ue(4010,!1);let u;o.indexOf(":")>-1?(u=o.slice(0,o.indexOf(":")),this.capture(u),this.capture(":")):n&&(u=xt);const f=this.parseChildren();t[u]=1===Object.keys(f).length?f[xt]:new Mn([],f),this.consumeOptional("//")}return t}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new ue(4011,!1)}}function z4(e){return e.segments.length>0?new Mn([],{[xt]:e}):e}function q4(e){const n={};for(const o of Object.keys(e.children)){const u=q4(e.children[o]);if(o===xt&&0===u.segments.length&&u.hasChildren())for(const[f,_]of Object.entries(u.children))n[f]=_;else(u.segments.length>0||u.hasChildren())&&(n[o]=u)}return function e7(e){if(1===e.numberOfChildren&&e.children[xt]){const n=e.children[xt];return new Mn(e.segments.concat(n.segments),n.children)}return e}(new Mn(e.segments,n))}function Im(e){return e instanceof Uv}function K4(e){let n;const c=z4(function t(u){const f={};for(const v of u.children){const S=t(v);f[v.outlet]=S}const _=new Mn(u.url,f);return u===e&&(n=_),_}(e.root));return n??c}function Y4(e,n,t,o){let c=e;for(;c.parent;)c=c.parent;if(0===n.length)return gU(c,c,c,t,o);const u=function n7(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new X4(!0,0,e);let n=0,t=!1;const o=e.reduce((c,u,f)=>{if("object"==typeof u&&null!=u){if(u.outlets){const _={};return Object.entries(u.outlets).forEach(([v,S])=>{_[v]="string"==typeof S?S.split("/"):S}),[...c,{outlets:_}]}if(u.segmentPath)return[...c,u.segmentPath]}return"string"!=typeof u?[...c,u]:0===f?(u.split("/").forEach((_,v)=>{0==v&&"."===_||(0==v&&""===_?t=!0:".."===_?n++:""!=_&&c.push(_))}),c):[...c,u]},[]);return new X4(t,n,o)}(n);if(u.toRoot())return gU(c,c,new Mn([],{}),t,o);const f=function i7(e,n,t){if(e.isAbsolute)return new YP(n,!0,0);if(!t)return new YP(n,!1,NaN);if(null===t.parent)return new YP(t,!0,0);const o=KP(e.commands[0])?0:1;return function r7(e,n,t){let o=e,c=n,u=t;for(;u>c;){if(u-=c,o=o.parent,!o)throw new ue(4005,!1);c=o.segments.length}return new YP(o,!1,c-u)}(t,t.segments.length-1+o,e.numberOfDoubleDots)}(u,c,e),_=f.processChildren?DT(f.segmentGroup,f.index,u.commands):J4(f.segmentGroup,f.index,u.commands);return gU(c,f.segmentGroup,_,t,o)}function KP(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function AT(e){return"object"==typeof e&&null!=e&&e.outlets}function gU(e,n,t,o,c){let f,u={};o&&Object.entries(o).forEach(([v,S])=>{u[v]=Array.isArray(S)?S.map(R=>`${R}`):`${S}`}),f=e===n?t:$4(e,n,t);const _=z4(q4(f));return new Uv(_,u,c)}function $4(e,n,t){const o={};return Object.entries(e.children).forEach(([c,u])=>{o[c]=u===n?t:$4(u,n,t)}),new Mn(e.segments,o)}class X4{constructor(n,t,o){if(this.isAbsolute=n,this.numberOfDoubleDots=t,this.commands=o,n&&o.length>0&&KP(o[0]))throw new ue(4003,!1);const c=o.find(AT);if(c&&c!==L4(o))throw new ue(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class YP{constructor(n,t,o){this.segmentGroup=n,this.processChildren=t,this.index=o}}function J4(e,n,t){if(e||(e=new Mn([],{})),0===e.segments.length&&e.hasChildren())return DT(e,n,t);const o=function s7(e,n,t){let o=0,c=n;const u={match:!1,pathIndex:0,commandIndex:0};for(;c<e.segments.length;){if(o>=t.length)return u;const f=e.segments[c],_=t[o];if(AT(_))break;const v=`${_}`,S=o<t.length-1?t[o+1]:null;if(c>0&&void 0===v)break;if(v&&S&&"object"==typeof S&&void 0===S.outlets){if(!Z4(v,S,f))return u;o+=2}else{if(!Z4(v,{},f))return u;o++}c++}return{match:!0,pathIndex:c,commandIndex:o}}(e,n,t),c=t.slice(o.commandIndex);if(o.match&&o.pathIndex<e.segments.length){const u=new Mn(e.segments.slice(0,o.pathIndex),{});return u.children[xt]=new Mn(e.segments.slice(o.pathIndex),e.children),DT(u,0,c)}return o.match&&0===c.length?new Mn(e.segments,{}):o.match&&!e.hasChildren()?EU(e,n,t):o.match?DT(e,0,c):EU(e,n,t)}function DT(e,n,t){if(0===t.length)return new Mn(e.segments,{});{const o=function o7(e){return AT(e[0])?e[0].outlets:{[xt]:e}}(t),c={};if(Object.keys(o).some(u=>u!==xt)&&e.children[xt]&&1===e.numberOfChildren&&0===e.children[xt].segments.length){const u=DT(e.children[xt],n,t);return new Mn(e.segments,u.children)}return Object.entries(o).forEach(([u,f])=>{"string"==typeof f&&(f=[f]),null!==f&&(c[u]=J4(e.children[u],n,f))}),Object.entries(e.children).forEach(([u,f])=>{void 0===o[u]&&(c[u]=f)}),new Mn(e.segments,c)}}function EU(e,n,t){const o=e.segments.slice(0,n);let c=0;for(;c<t.length;){const u=t[c];if(AT(u)){const v=a7(u.outlets);return new Mn(o,v)}if(0===c&&KP(t[0])){o.push(new wT(e.segments[n].path,Q4(t[0]))),c++;continue}const f=AT(u)?u.outlets[xt]:`${u}`,_=c<t.length-1?t[c+1]:null;f&&_&&KP(_)?(o.push(new wT(f,Q4(_))),c+=2):(o.push(new wT(f,{})),c++)}return new Mn(o,{})}function a7(e){const n={};return Object.entries(e).forEach(([t,o])=>{"string"==typeof o&&(o=[o]),null!==o&&(n[t]=EU(new Mn([],{}),0,o))}),n}function Q4(e){const n={};return Object.entries(e).forEach(([t,o])=>n[t]=`${o}`),n}function Z4(e,n,t){return e==t.path&&Ul(n,t.parameters)}const OT="imperative";class Vl{constructor(n,t){this.id=n,this.url=t}}class $P extends Vl{constructor(n,t,o="imperative",c=null){super(n,t),this.type=0,this.navigationTrigger=o,this.restoredState=c}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class np extends Vl{constructor(n,t,o){super(n,t),this.urlAfterRedirects=o,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class NT extends Vl{constructor(n,t,o,c){super(n,t),this.reason=o,this.code=c,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Vv extends Vl{constructor(n,t,o,c){super(n,t),this.reason=o,this.code=c,this.type=16}}class XP extends Vl{constructor(n,t,o,c){super(n,t),this.error=o,this.target=c,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class e5 extends Vl{constructor(n,t,o,c){super(n,t),this.urlAfterRedirects=o,this.state=c,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class c7 extends Vl{constructor(n,t,o,c){super(n,t),this.urlAfterRedirects=o,this.state=c,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class l7 extends Vl{constructor(n,t,o,c,u){super(n,t),this.urlAfterRedirects=o,this.state=c,this.shouldActivate=u,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class d7 extends Vl{constructor(n,t,o,c){super(n,t),this.urlAfterRedirects=o,this.state=c,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class u7 extends Vl{constructor(n,t,o,c){super(n,t),this.urlAfterRedirects=o,this.state=c,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class h7{constructor(n){this.route=n,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class p7{constructor(n){this.route=n,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class f7{constructor(n){this.snapshot=n,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class m7{constructor(n){this.snapshot=n,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class _7{constructor(n){this.snapshot=n,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class g7{constructor(n){this.snapshot=n,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class t5{constructor(n,t,o){this.routerEvent=n,this.position=t,this.anchor=o,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class vU{}class yU{constructor(n){this.url=n}}class E7{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new PT,this.attachRef=null}}let PT=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(t,o){const c=this.getOrCreateContext(t);c.outlet=o,this.contexts.set(t,c)}onChildOutletDestroyed(t){const o=this.getContext(t);o&&(o.outlet=null,o.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let o=this.getContext(t);return o||(o=new E7,this.contexts.set(t,o)),o}getContext(t){return this.contexts.get(t)||null}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class n5{constructor(n){this._root=n}get root(){return this._root.value}parent(n){const t=this.pathFromRoot(n);return t.length>1?t[t.length-2]:null}children(n){const t=bU(n,this._root);return t?t.children.map(o=>o.value):[]}firstChild(n){const t=bU(n,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(n){const t=SU(n,this._root);return t.length<2?[]:t[t.length-2].children.map(c=>c.value).filter(c=>c!==n)}pathFromRoot(n){return SU(n,this._root).map(t=>t.value)}}function bU(e,n){if(e===n.value)return n;for(const t of n.children){const o=bU(e,t);if(o)return o}return null}function SU(e,n){if(e===n.value)return[n];for(const t of n.children){const o=SU(e,t);if(o.length)return o.unshift(n),o}return[]}class nu{constructor(n,t){this.value=n,this.children=t}toString(){return`TreeNode(${this.value})`}}function Bv(e){const n={};return e&&e.children.forEach(t=>n[t.value.outlet]=t),n}class r5 extends n5{constructor(n,t){super(n),this.snapshot=t,CU(this,n)}toString(){return this.snapshot.toString()}}function o5(e,n){const t=function v7(e,n){const f=new JP([],{},{},"",{},xt,n,null,{});return new a5("",new nu(f,[]))}(0,n),o=new ro([new wT("",{})]),c=new ro({}),u=new ro({}),f=new ro({}),_=new ro(""),v=new Rm(o,c,f,_,u,xt,n,t.root);return v.snapshot=t.root,new r5(new nu(v,[]),t)}class Rm{constructor(n,t,o,c,u,f,_,v){this.urlSubject=n,this.paramsSubject=t,this.queryParamsSubject=o,this.fragmentSubject=c,this.dataSubject=u,this.outlet=f,this.component=_,this._futureSnapshot=v,this.title=this.dataSubject?.pipe(mn(S=>S[TT]))??He(void 0),this.url=n,this.params=t,this.queryParams=o,this.fragment=c,this.data=u}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(mn(n=>Fv(n)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(mn(n=>Fv(n)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function s5(e,n="emptyOnly"){const t=e.pathFromRoot;let o=0;if("always"!==n)for(o=t.length-1;o>=1;){const c=t[o],u=t[o-1];if(c.routeConfig&&""===c.routeConfig.path)o--;else{if(u.component)break;o--}}return function y7(e){return e.reduce((n,t)=>({params:{...n.params,...t.params},data:{...n.data,...t.data},resolve:{...t.data,...n.resolve,...t.routeConfig?.data,...t._resolvedData}}),{params:{},data:{},resolve:{}})}(t.slice(o))}class JP{get title(){return this.data?.[TT]}constructor(n,t,o,c,u,f,_,v,S){this.url=n,this.params=t,this.queryParams=o,this.fragment=c,this.data=u,this.outlet=f,this.component=_,this.routeConfig=v,this._resolve=S}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Fv(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Fv(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(o=>o.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class a5 extends n5{constructor(n,t){super(t),this.url=n,CU(this,t)}toString(){return c5(this._root)}}function CU(e,n){n.value._routerState=e,n.children.forEach(t=>CU(e,t))}function c5(e){const n=e.children.length>0?` { ${e.children.map(c5).join(", ")} } `:"";return`${e.value}${n}`}function TU(e){if(e.snapshot){const n=e.snapshot,t=e._futureSnapshot;e.snapshot=t,Ul(n.queryParams,t.queryParams)||e.queryParamsSubject.next(t.queryParams),n.fragment!==t.fragment&&e.fragmentSubject.next(t.fragment),Ul(n.params,t.params)||e.paramsSubject.next(t.params),function Lz(e,n){if(e.length!==n.length)return!1;for(let t=0;t<e.length;++t)if(!Ul(e[t],n[t]))return!1;return!0}(n.url,t.url)||e.urlSubject.next(t.url),Ul(n.data,t.data)||e.dataSubject.next(t.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function wU(e,n){const t=Ul(e.params,n.params)&&function Bz(e,n){return wm(e,n)&&e.every((t,o)=>Ul(t.parameters,n[o].parameters))}(e.url,n.url);return t&&!(!e.parent!=!n.parent)&&(!e.parent||wU(e.parent,n.parent))}let IU=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=xt,this.activateEvents=new Zt,this.deactivateEvents=new Zt,this.attachEvents=new Zt,this.detachEvents=new Zt,this.parentContexts=Oe(PT),this.location=Oe(Jo),this.changeDetector=Oe(rr),this.environmentInjector=Oe(zo),this.inputBinder=Oe(QP,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(t){if(t.name){const{firstChange:o,previousValue:c}=t.name;if(o)return;this.isTrackedInParentContexts(c)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(c)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new ue(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new ue(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new ue(4012,!1);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,o){this.activated=t,this._activatedRoute=o,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,o){if(this.isActivated)throw new ue(4013,!1);this._activatedRoute=t;const c=this.location,f=t.snapshot.component,_=this.parentContexts.getOrCreateContext(this.name).children,v=new b7(t,_,c.injector);this.activated=c.createComponent(f,{index:c.length,injector:v,environmentInjector:o??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275dir=Ge({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[jo]})}return e})();class b7{constructor(n,t,o){this.route=n,this.childContexts=t,this.parent=o}get(n,t){return n===Rm?this.route:n===PT?this.childContexts:this.parent.get(n,t)}}const QP=new De("");let l5=(()=>{class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(t){this.unsubscribeFromRouteData(t),this.subscribeToRouteData(t)}unsubscribeFromRouteData(t){this.outletDataSubscriptions.get(t)?.unsubscribe(),this.outletDataSubscriptions.delete(t)}subscribeToRouteData(t){const{activatedRoute:o}=t,c=mP([o.queryParams,o.params,o.data]).pipe(us(([u,f,_],v)=>(_={...u,...f,..._},0===v?He(_):Promise.resolve(_)))).subscribe(u=>{if(!t.isActivated||!t.activatedComponentRef||t.activatedRoute!==o||null===o.component)return void this.unsubscribeFromRouteData(t);const f=function s2(e){const n=Yt(e);if(!n)return null;const t=new ah(n);return{get selector(){return t.selector},get type(){return t.componentType},get inputs(){return t.inputs},get outputs(){return t.outputs},get ngContentSelectors(){return t.ngContentSelectors},get isStandalone(){return n.standalone},get isSignal(){return n.signals}}}(o.component);if(f)for(const{templateName:_}of f.inputs)t.activatedComponentRef.setInput(_,u[_]);else this.unsubscribeFromRouteData(t)});this.outletDataSubscriptions.set(t,c)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac})}return e})();function xT(e,n,t){if(t&&e.shouldReuseRoute(n.value,t.value.snapshot)){const o=t.value;o._futureSnapshot=n.value;const c=function C7(e,n,t){return n.children.map(o=>{for(const c of t.children)if(e.shouldReuseRoute(o.value,c.value.snapshot))return xT(e,o,c);return xT(e,o)})}(e,n,t);return new nu(o,c)}{if(e.shouldAttach(n.value)){const u=e.retrieve(n.value);if(null!==u){const f=u.route;return f.value._futureSnapshot=n.value,f.children=n.children.map(_=>xT(e,_)),f}}const o=function T7(e){return new Rm(new ro(e.url),new ro(e.params),new ro(e.queryParams),new ro(e.fragment),new ro(e.data),e.outlet,e.component,e)}(n.value),c=n.children.map(u=>xT(e,u));return new nu(o,c)}}const RU="ngNavigationCancelingError";function d5(e,n){const{redirectTo:t,navigationBehaviorOptions:o}=Im(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,c=u5(!1,0,n);return c.url=t,c.navigationBehaviorOptions=o,c}function u5(e,n,t){const o=new Error("NavigationCancelingError: "+(e||""));return o[RU]=!0,o.cancellationCode=n,t&&(o.url=t),o}function h5(e){return e&&e[RU]}let p5=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275cmp=Ct({type:e,selectors:[["ng-component"]],standalone:!0,features:[Ff],decls:1,vars:0,template:function(o,c){1&o&&wt(0,"router-outlet")},dependencies:[IU],encapsulation:2})}return e})();function AU(e){const n=e.children&&e.children.map(AU),t=n?{...e,children:n}:{...e};return!t.component&&!t.loadComponent&&(n||t.loadChildren)&&t.outlet&&t.outlet!==xt&&(t.component=p5),t}function Rc(e){return e.outlet||xt}function MT(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let n=e.parent;n;n=n.parent){const t=n.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class P7{constructor(n,t,o,c,u){this.routeReuseStrategy=n,this.futureState=t,this.currState=o,this.forwardEvent=c,this.inputBindingEnabled=u}activate(n){const t=this.futureState._root,o=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,o,n),TU(this.futureState.root),this.activateChildRoutes(t,o,n)}deactivateChildRoutes(n,t,o){const c=Bv(t);n.children.forEach(u=>{const f=u.value.outlet;this.deactivateRoutes(u,c[f],o),delete c[f]}),Object.values(c).forEach(u=>{this.deactivateRouteAndItsChildren(u,o)})}deactivateRoutes(n,t,o){const c=n.value,u=t?t.value:null;if(c===u)if(c.component){const f=o.getContext(c.outlet);f&&this.deactivateChildRoutes(n,t,f.children)}else this.deactivateChildRoutes(n,t,o);else u&&this.deactivateRouteAndItsChildren(t,o)}deactivateRouteAndItsChildren(n,t){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,t):this.deactivateRouteAndOutlet(n,t)}detachAndStoreRouteSubtree(n,t){const o=t.getContext(n.value.outlet),c=o&&n.value.component?o.children:t,u=Bv(n);for(const f of Object.keys(u))this.deactivateRouteAndItsChildren(u[f],c);if(o&&o.outlet){const f=o.outlet.detach(),_=o.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:f,route:n,contexts:_})}}deactivateRouteAndOutlet(n,t){const o=t.getContext(n.value.outlet),c=o&&n.value.component?o.children:t,u=Bv(n);for(const f of Object.keys(u))this.deactivateRouteAndItsChildren(u[f],c);o&&(o.outlet&&(o.outlet.deactivate(),o.children.onOutletDeactivated()),o.attachRef=null,o.route=null)}activateChildRoutes(n,t,o){const c=Bv(t);n.children.forEach(u=>{this.activateRoutes(u,c[u.value.outlet],o),this.forwardEvent(new g7(u.value.snapshot))}),n.children.length&&this.forwardEvent(new m7(n.value.snapshot))}activateRoutes(n,t,o){const c=n.value,u=t?t.value:null;if(TU(c),c===u)if(c.component){const f=o.getOrCreateContext(c.outlet);this.activateChildRoutes(n,t,f.children)}else this.activateChildRoutes(n,t,o);else if(c.component){const f=o.getOrCreateContext(c.outlet);if(this.routeReuseStrategy.shouldAttach(c.snapshot)){const _=this.routeReuseStrategy.retrieve(c.snapshot);this.routeReuseStrategy.store(c.snapshot,null),f.children.onOutletReAttached(_.contexts),f.attachRef=_.componentRef,f.route=_.route.value,f.outlet&&f.outlet.attach(_.componentRef,_.route.value),TU(_.route.value),this.activateChildRoutes(n,null,f.children)}else{const _=MT(c.snapshot);f.attachRef=null,f.route=c,f.injector=_,f.outlet&&f.outlet.activateWith(c,f.injector),this.activateChildRoutes(n,null,f.children)}}else this.activateChildRoutes(n,null,o)}}class f5{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class ZP{constructor(n,t){this.component=n,this.route=t}}function x7(e,n,t){const o=e._root;return kT(o,n?n._root:null,t,[o.value])}function jv(e,n){const t=Symbol(),o=n.get(e,t);return o===t?"function"!=typeof e||function O1(e){return null!==Zm(e)}(e)?n.get(e):e:o}function kT(e,n,t,o,c={canDeactivateChecks:[],canActivateChecks:[]}){const u=Bv(n);return e.children.forEach(f=>{(function k7(e,n,t,o,c={canDeactivateChecks:[],canActivateChecks:[]}){const u=e.value,f=n?n.value:null,_=t?t.getContext(e.value.outlet):null;if(f&&u.routeConfig===f.routeConfig){const v=function L7(e,n,t){if("function"==typeof t)return t(e,n);switch(t){case"pathParamsChange":return!wm(e.url,n.url);case"pathParamsOrQueryParamsChange":return!wm(e.url,n.url)||!Ul(e.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!wU(e,n)||!Ul(e.queryParams,n.queryParams);default:return!wU(e,n)}}(f,u,u.routeConfig.runGuardsAndResolvers);v?c.canActivateChecks.push(new f5(o)):(u.data=f.data,u._resolvedData=f._resolvedData),kT(e,n,u.component?_?_.children:null:t,o,c),v&&_&&_.outlet&&_.outlet.isActivated&&c.canDeactivateChecks.push(new ZP(_.outlet.component,f))}else f&&LT(n,_,c),c.canActivateChecks.push(new f5(o)),kT(e,null,u.component?_?_.children:null:t,o,c)})(f,u[f.value.outlet],t,o.concat([f.value]),c),delete u[f.value.outlet]}),Object.entries(u).forEach(([f,_])=>LT(_,t.getContext(f),c)),c}function LT(e,n,t){const o=Bv(e),c=e.value;Object.entries(o).forEach(([u,f])=>{LT(f,c.component?n?n.children.getContext(u):null:n,t)}),t.canDeactivateChecks.push(new ZP(c.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,c))}function FT(e){return"function"==typeof e}function m5(e){return e instanceof jP||"EmptyError"===e?.name}const e1=Symbol("INITIAL_VALUE");function Hv(){return us(e=>mP(e.map(n=>n.pipe(Zd(1),BB(e1)))).pipe(mn(n=>{for(const t of n)if(!0!==t){if(t===e1)return e1;if(!1===t||t instanceof Uv)return t}return!0}),ra(n=>n!==e1),Zd(1)))}function _5(e){return function XT(...e){return Kv(e)}(io(n=>{if(Im(n))throw d5(0,n)}),mn(n=>!0===n))}class t1{constructor(n){this.segmentGroup=n||null}}class g5{constructor(n){this.urlTree=n}}function Gv(e){return ST(new t1(e))}function E5(e){return ST(new g5(e))}class nq{constructor(n,t){this.urlSerializer=n,this.urlTree=t}noMatchError(n){return new ue(4002,!1)}lineralizeSegments(n,t){let o=[],c=t.root;for(;;){if(o=o.concat(c.segments),0===c.numberOfChildren)return He(o);if(c.numberOfChildren>1||!c.children[xt])return ST(new ue(4e3,!1));c=c.children[xt]}}applyRedirectCommands(n,t,o){return this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),n,o)}applyRedirectCreateUrlTree(n,t,o,c){const u=this.createSegmentGroup(n,t.root,o,c);return new Uv(u,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(n,t){const o={};return Object.entries(n).forEach(([c,u])=>{if("string"==typeof u&&u.startsWith(":")){const _=u.substring(1);o[c]=t[_]}else o[c]=u}),o}createSegmentGroup(n,t,o,c){const u=this.createSegments(n,t.segments,o,c);let f={};return Object.entries(t.children).forEach(([_,v])=>{f[_]=this.createSegmentGroup(n,v,o,c)}),new Mn(u,f)}createSegments(n,t,o,c){return t.map(u=>u.path.startsWith(":")?this.findPosParam(n,u,c):this.findOrReturn(u,o))}findPosParam(n,t,o){const c=o[t.path.substring(1)];if(!c)throw new ue(4001,!1);return c}findOrReturn(n,t){let o=0;for(const c of t){if(c.path===n.path)return t.splice(o),c;o++}return n}}const DU={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function iq(e,n,t,o,c){const u=OU(e,n,t);return u.matched?(o=function I7(e,n){return e.providers&&!e._injector&&(e._injector=bh(e.providers,n,`Route: ${e.path}`)),e._injector??n}(n,o),function Z7(e,n,t,o){const c=n.canMatch;return c&&0!==c.length?He(c.map(f=>{const _=jv(f,e);return tp(function H7(e){return e&&FT(e.canMatch)}(_)?_.canMatch(n,t):e.runInContext(()=>_(n,t)))})).pipe(Hv(),_5()):He(!0)}(o,n,t).pipe(mn(f=>!0===f?u:{...DU}))):He(u)}function OU(e,n,t){if(""===n.path)return"full"===n.pathMatch&&(e.hasChildren()||t.length>0)?{...DU}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const c=(n.matcher||kz)(t,e,n);if(!c)return{...DU};const u={};Object.entries(c.posParams??{}).forEach(([_,v])=>{u[_]=v.path});const f=c.consumed.length>0?{...u,...c.consumed[c.consumed.length-1].parameters}:u;return{matched:!0,consumedSegments:c.consumed,remainingSegments:t.slice(c.consumed.length),parameters:f,positionalParamSegments:c.posParams??{}}}function v5(e,n,t,o){return t.length>0&&function sq(e,n,t){return t.some(o=>n1(e,n,o)&&Rc(o)!==xt)}(e,t,o)?{segmentGroup:new Mn(n,oq(o,new Mn(t,e.children))),slicedSegments:[]}:0===t.length&&function aq(e,n,t){return t.some(o=>n1(e,n,o))}(e,t,o)?{segmentGroup:new Mn(e.segments,rq(e,0,t,o,e.children)),slicedSegments:t}:{segmentGroup:new Mn(e.segments,e.children),slicedSegments:t}}function rq(e,n,t,o,c){const u={};for(const f of o)if(n1(e,t,f)&&!c[Rc(f)]){const _=new Mn([],{});u[Rc(f)]=_}return{...c,...u}}function oq(e,n){const t={};t[xt]=n;for(const o of e)if(""===o.path&&Rc(o)!==xt){const c=new Mn([],{});t[Rc(o)]=c}return t}function n1(e,n,t){return(!(e.hasChildren()||n.length>0)||"full"!==t.pathMatch)&&""===t.path}class uq{constructor(n,t,o,c,u,f,_){this.injector=n,this.configLoader=t,this.rootComponentType=o,this.config=c,this.urlTree=u,this.paramsInheritanceStrategy=f,this.urlSerializer=_,this.allowRedirects=!0,this.applyRedirects=new nq(this.urlSerializer,this.urlTree)}noMatchError(n){return new ue(4002,!1)}recognize(){const n=v5(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,n,xt).pipe(Tm(t=>{if(t instanceof g5)return this.allowRedirects=!1,this.urlTree=t.urlTree,this.match(t.urlTree);throw t instanceof t1?this.noMatchError(t):t}),mn(t=>{const o=new JP([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},xt,this.rootComponentType,null,{}),c=new nu(o,t),u=new a5("",c),f=function t7(e,n,t=null,o=null){return Y4(K4(e),n,t,o)}(o,[],this.urlTree.queryParams,this.urlTree.fragment);return f.queryParams=this.urlTree.queryParams,u.url=this.urlSerializer.serialize(f),this.inheritParamsAndData(u._root),{state:u,tree:f}}))}match(n){return this.processSegmentGroup(this.injector,this.config,n.root,xt).pipe(Tm(o=>{throw o instanceof t1?this.noMatchError(o):o}))}inheritParamsAndData(n){const t=n.value,o=s5(t,this.paramsInheritanceStrategy);t.params=Object.freeze(o.params),t.data=Object.freeze(o.data),n.children.forEach(c=>this.inheritParamsAndData(c))}processSegmentGroup(n,t,o,c){return 0===o.segments.length&&o.hasChildren()?this.processChildren(n,t,o):this.processSegment(n,t,o,o.segments,c,!0)}processChildren(n,t,o){const c=[];for(const u of Object.keys(o.children))"primary"===u?c.unshift(u):c.push(u);return Mi(c).pipe(CT(u=>{const f=o.children[u],_=function O7(e,n){const t=e.filter(o=>Rc(o)===n);return t.push(...e.filter(o=>Rc(o)!==n)),t}(t,u);return this.processSegmentGroup(n,_,f,u)}),function Nz(e,n){return hi(function Oz(e,n,t,o,c){return(u,f)=>{let _=t,v=n,S=0;u.subscribe(Jn(f,R=>{const k=S++;v=_?e(v,R,k):(_=!0,R),o&&f.next(v)},c&&(()=>{_&&f.next(v),f.complete()})))}}(e,n,arguments.length>=2,!0))}((u,f)=>(u.push(...f),u)),HP(null),function Pz(e,n){const t=arguments.length>=2;return o=>o.pipe(e?ra((c,u)=>e(c,u,o)):Ka,hU(1),t?HP(n):M4(()=>new jP))}(),yi(u=>{if(null===u)return Gv(o);const f=y5(u);return function hq(e){e.sort((n,t)=>n.value.outlet===xt?-1:t.value.outlet===xt?1:n.value.outlet.localeCompare(t.value.outlet))}(f),He(f)}))}processSegment(n,t,o,c,u,f){return Mi(t).pipe(CT(_=>this.processSegmentAgainstRoute(_._injector??n,t,_,o,c,u,f).pipe(Tm(v=>{if(v instanceof t1)return He(null);throw v}))),Cm(_=>!!_),Tm(_=>{if(m5(_))return function lq(e,n,t){return 0===n.length&&!e.children[t]}(o,c,u)?He([]):Gv(o);throw _}))}processSegmentAgainstRoute(n,t,o,c,u,f,_){return function cq(e,n,t,o){return!!(Rc(e)===o||o!==xt&&n1(n,t,e))&&("**"===e.path||OU(n,e,t).matched)}(o,c,u,f)?void 0===o.redirectTo?this.matchSegmentAgainstRoute(n,c,o,u,f,_):_&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(n,c,t,o,u,f):Gv(c):Gv(c)}expandSegmentAgainstRouteUsingRedirect(n,t,o,c,u,f){return"**"===c.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(n,o,c,f):this.expandRegularSegmentAgainstRouteUsingRedirect(n,t,o,c,u,f)}expandWildCardWithParamsAgainstRouteUsingRedirect(n,t,o,c){const u=this.applyRedirects.applyRedirectCommands([],o.redirectTo,{});return o.redirectTo.startsWith("/")?E5(u):this.applyRedirects.lineralizeSegments(o,u).pipe(yi(f=>{const _=new Mn(f,{});return this.processSegment(n,t,_,f,c,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(n,t,o,c,u,f){const{matched:_,consumedSegments:v,remainingSegments:S,positionalParamSegments:R}=OU(t,c,u);if(!_)return Gv(t);const k=this.applyRedirects.applyRedirectCommands(v,c.redirectTo,R);return c.redirectTo.startsWith("/")?E5(k):this.applyRedirects.lineralizeSegments(c,k).pipe(yi(U=>this.processSegment(n,o,t,U.concat(S),f,!1)))}matchSegmentAgainstRoute(n,t,o,c,u,f){let _;if("**"===o.path){const v=c.length>0?L4(c).parameters:{};_=He({snapshot:new JP(c,v,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,b5(o),Rc(o),o.component??o._loadedComponent??null,o,S5(o)),consumedSegments:[],remainingSegments:[]}),t.children={}}else _=iq(t,o,c,n).pipe(mn(({matched:v,consumedSegments:S,remainingSegments:R,parameters:k})=>v?{snapshot:new JP(S,k,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,b5(o),Rc(o),o.component??o._loadedComponent??null,o,S5(o)),consumedSegments:S,remainingSegments:R}:null));return _.pipe(us(v=>null===v?Gv(t):this.getChildConfig(n=o._injector??n,o,c).pipe(us(({routes:S})=>{const R=o._loadedInjector??n,{snapshot:k,consumedSegments:U,remainingSegments:G}=v,{segmentGroup:z,slicedSegments:X}=v5(t,U,G,S);if(0===X.length&&z.hasChildren())return this.processChildren(R,S,z).pipe(mn(pe=>null===pe?null:[new nu(k,pe)]));if(0===S.length&&0===X.length)return He([new nu(k,[])]);const le=Rc(o)===u;return this.processSegment(R,S,z,X,le?xt:u,!0).pipe(mn(pe=>[new nu(k,pe)]))}))))}getChildConfig(n,t,o){return t.children?He({routes:t.children,injector:n}):t.loadChildren?void 0!==t._loadedRoutes?He({routes:t._loadedRoutes,injector:t._loadedInjector}):function Q7(e,n,t,o){const c=n.canLoad;return void 0===c||0===c.length?He(!0):He(c.map(f=>{const _=jv(f,e);return tp(function U7(e){return e&&FT(e.canLoad)}(_)?_.canLoad(n,t):e.runInContext(()=>_(n,t)))})).pipe(Hv(),_5())}(n,t,o).pipe(yi(c=>c?this.configLoader.loadChildren(n,t).pipe(io(u=>{t._loadedRoutes=u.routes,t._loadedInjector=u.injector})):function tq(e){return ST(u5(!1,3))}())):He({routes:[],injector:n})}}function pq(e){const n=e.value.routeConfig;return n&&""===n.path}function y5(e){const n=[],t=new Set;for(const o of e){if(!pq(o)){n.push(o);continue}const c=n.find(u=>o.value.routeConfig===u.value.routeConfig);void 0!==c?(c.children.push(...o.children),t.add(c)):n.push(o)}for(const o of t){const c=y5(o.children);n.push(new nu(o.value,c))}return n.filter(o=>!t.has(o))}function b5(e){return e.data||{}}function S5(e){return e.resolve||{}}function C5(e){return"string"==typeof e.title||null===e.title}function NU(e){return us(n=>{const t=e(n);return t?Mi(t).pipe(mn(()=>n)):He(n)})}const Wv=new De("ROUTES");let PU=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Oe(Ua)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return He(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const o=tp(t.loadComponent()).pipe(mn(T5),io(u=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=u}),pU(()=>{this.componentLoaders.delete(t)})),c=new x4(o,()=>new rn).pipe(uU());return this.componentLoaders.set(t,c),c}loadChildren(t,o){if(this.childrenLoaders.get(o))return this.childrenLoaders.get(o);if(o._loadedRoutes)return He({routes:o._loadedRoutes,injector:o._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(o);const u=function yq(e,n,t,o){return tp(e.loadChildren()).pipe(mn(T5),yi(c=>c instanceof Pr||Array.isArray(c)?He(c):Mi(n.compileModuleAsync(c))),mn(c=>{o&&o(e);let u,f,_=!1;return Array.isArray(c)?(f=c,!0):(u=c.create(t).injector,f=u.get(Wv,[],{optional:!0,self:!0}).flat()),{routes:f.map(AU),injector:u}}))}(o,this.compiler,t,this.onLoadEndListener).pipe(pU(()=>{this.childrenLoaders.delete(o)})),f=new x4(u,()=>new rn).pipe(uU());return this.childrenLoaders.set(o,f),f}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function T5(e){return function bq(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let r1=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new rn,this.transitionAbortSubject=new rn,this.configLoader=Oe(PU),this.environmentInjector=Oe(zo),this.urlSerializer=Oe(IT),this.rootContexts=Oe(PT),this.inputBindingEnabled=null!==Oe(QP,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>He(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=c=>this.events.next(new p7(c)),this.configLoader.onLoadStartListener=c=>this.events.next(new h7(c))}complete(){this.transitions?.complete()}handleNavigationRequest(t){const o=++this.navigationId;this.transitions?.next({...this.transitions.value,...t,id:o})}setupNavigations(t,o,c){return this.transitions=new ro({id:0,currentUrlTree:o,currentRawUrl:o,currentBrowserUrl:o,extractedUrl:t.urlHandlingStrategy.extract(o),urlAfterRedirects:t.urlHandlingStrategy.extract(o),rawUrl:o,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:OT,restoredState:null,currentSnapshot:c.snapshot,targetSnapshot:null,currentRouterState:c,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(ra(u=>0!==u.id),mn(u=>({...u,extractedUrl:t.urlHandlingStrategy.extract(u.rawUrl)})),us(u=>{this.currentTransition=u;let f=!1,_=!1;return He(u).pipe(io(v=>{this.currentNavigation={id:v.id,initialUrl:v.rawUrl,extractedUrl:v.extractedUrl,trigger:v.source,extras:v.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),us(v=>{const S=v.currentBrowserUrl.toString(),R=!t.navigated||v.extractedUrl.toString()!==S||S!==v.currentUrlTree.toString();if(!R&&"reload"!==(v.extras.onSameUrlNavigation??t.onSameUrlNavigation)){const U="";return this.events.next(new Vv(v.id,this.urlSerializer.serialize(v.rawUrl),U,0)),v.resolve(null),ks}if(t.urlHandlingStrategy.shouldProcessUrl(v.rawUrl))return He(v).pipe(us(U=>{const G=this.transitions?.getValue();return this.events.next(new $P(U.id,this.urlSerializer.serialize(U.extractedUrl),U.source,U.restoredState)),G!==this.transitions?.getValue()?ks:Promise.resolve(U)}),function fq(e,n,t,o,c,u){return yi(f=>function dq(e,n,t,o,c,u,f="emptyOnly"){return new uq(e,n,t,o,c,f,u).recognize()}(e,n,t,o,f.extractedUrl,c,u).pipe(mn(({state:_,tree:v})=>({...f,targetSnapshot:_,urlAfterRedirects:v}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,t.paramsInheritanceStrategy),io(U=>{u.targetSnapshot=U.targetSnapshot,u.urlAfterRedirects=U.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:U.urlAfterRedirects};const G=new e5(U.id,this.urlSerializer.serialize(U.extractedUrl),this.urlSerializer.serialize(U.urlAfterRedirects),U.targetSnapshot);this.events.next(G)}));if(R&&t.urlHandlingStrategy.shouldProcessUrl(v.currentRawUrl)){const{id:U,extractedUrl:G,source:z,restoredState:X,extras:le}=v,pe=new $P(U,this.urlSerializer.serialize(G),z,X);this.events.next(pe);const ae=o5(0,this.rootComponentType).snapshot;return this.currentTransition=u={...v,targetSnapshot:ae,urlAfterRedirects:G,extras:{...le,skipLocationChange:!1,replaceUrl:!1}},He(u)}{const U="";return this.events.next(new Vv(v.id,this.urlSerializer.serialize(v.extractedUrl),U,1)),v.resolve(null),ks}}),io(v=>{const S=new c7(v.id,this.urlSerializer.serialize(v.extractedUrl),this.urlSerializer.serialize(v.urlAfterRedirects),v.targetSnapshot);this.events.next(S)}),mn(v=>(this.currentTransition=u={...v,guards:x7(v.targetSnapshot,v.currentSnapshot,this.rootContexts)},u)),function W7(e,n){return yi(t=>{const{targetSnapshot:o,currentSnapshot:c,guards:{canActivateChecks:u,canDeactivateChecks:f}}=t;return 0===f.length&&0===u.length?He({...t,guardsResult:!0}):function z7(e,n,t,o){return Mi(e).pipe(yi(c=>function J7(e,n,t,o,c){const u=n&&n.routeConfig?n.routeConfig.canDeactivate:null;return u&&0!==u.length?He(u.map(_=>{const v=MT(n)??c,S=jv(_,v);return tp(function j7(e){return e&&FT(e.canDeactivate)}(S)?S.canDeactivate(e,n,t,o):v.runInContext(()=>S(e,n,t,o))).pipe(Cm())})).pipe(Hv()):He(!0)}(c.component,c.route,t,n,o)),Cm(c=>!0!==c,!0))}(f,o,c,e).pipe(yi(_=>_&&function F7(e){return"boolean"==typeof e}(_)?function q7(e,n,t,o){return Mi(n).pipe(CT(c=>_P(function Y7(e,n){return null!==e&&n&&n(new f7(e)),He(!0)}(c.route.parent,o),function K7(e,n){return null!==e&&n&&n(new _7(e)),He(!0)}(c.route,o),function X7(e,n,t){const o=n[n.length-1],u=n.slice(0,n.length-1).reverse().map(f=>function M7(e){const n=e.routeConfig?e.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:e,guards:n}:null}(f)).filter(f=>null!==f).map(f=>P4(()=>He(f.guards.map(v=>{const S=MT(f.node)??t,R=jv(v,S);return tp(function B7(e){return e&&FT(e.canActivateChild)}(R)?R.canActivateChild(o,e):S.runInContext(()=>R(o,e))).pipe(Cm())})).pipe(Hv())));return He(u).pipe(Hv())}(e,c.path,t),function $7(e,n,t){const o=n.routeConfig?n.routeConfig.canActivate:null;if(!o||0===o.length)return He(!0);const c=o.map(u=>P4(()=>{const f=MT(n)??t,_=jv(u,f);return tp(function V7(e){return e&&FT(e.canActivate)}(_)?_.canActivate(n,e):f.runInContext(()=>_(n,e))).pipe(Cm())}));return He(c).pipe(Hv())}(e,c.route,t))),Cm(c=>!0!==c,!0))}(o,u,e,n):He(_)),mn(_=>({...t,guardsResult:_})))})}(this.environmentInjector,v=>this.events.next(v)),io(v=>{if(u.guardsResult=v.guardsResult,Im(v.guardsResult))throw d5(0,v.guardsResult);const S=new l7(v.id,this.urlSerializer.serialize(v.extractedUrl),this.urlSerializer.serialize(v.urlAfterRedirects),v.targetSnapshot,!!v.guardsResult);this.events.next(S)}),ra(v=>!!v.guardsResult||(this.cancelNavigationTransition(v,"",3),!1)),NU(v=>{if(v.guards.canActivateChecks.length)return He(v).pipe(io(S=>{const R=new d7(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot);this.events.next(R)}),us(S=>{let R=!1;return He(S).pipe(function mq(e,n){return yi(t=>{const{targetSnapshot:o,guards:{canActivateChecks:c}}=t;if(!c.length)return He(t);let u=0;return Mi(c).pipe(CT(f=>function _q(e,n,t,o){const c=e.routeConfig,u=e._resolve;return void 0!==c?.title&&!C5(c)&&(u[TT]=c.title),function gq(e,n,t,o){const c=function Eq(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===c.length)return He({});const u={};return Mi(c).pipe(yi(f=>function vq(e,n,t,o){const c=MT(n)??o,u=jv(e,c);return tp(u.resolve?u.resolve(n,t):c.runInContext(()=>u(n,t)))}(e[f],n,t,o).pipe(Cm(),io(_=>{u[f]=_}))),hU(1),function xz(e){return mn(()=>e)}(u),Tm(f=>m5(f)?ks:ST(f)))}(u,e,n,o).pipe(mn(f=>(e._resolvedData=f,e.data=s5(e,t).resolve,c&&C5(c)&&(e.data[TT]=c.title),null)))}(f.route,o,e,n)),io(()=>u++),hU(1),yi(f=>u===c.length?He(t):ks))})}(t.paramsInheritanceStrategy,this.environmentInjector),io({next:()=>R=!0,complete:()=>{R||this.cancelNavigationTransition(S,"",2)}}))}),io(S=>{const R=new u7(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot);this.events.next(R)}))}),NU(v=>{const S=R=>{const k=[];R.routeConfig?.loadComponent&&!R.routeConfig._loadedComponent&&k.push(this.configLoader.loadComponent(R.routeConfig).pipe(io(U=>{R.component=U}),mn(()=>{})));for(const U of R.children)k.push(...S(U));return k};return mP(S(v.targetSnapshot.root)).pipe(HP(),Zd(1))}),NU(()=>this.afterPreactivation()),mn(v=>{const S=function S7(e,n,t){const o=xT(e,n._root,t?t._root:void 0);return new r5(o,n)}(t.routeReuseStrategy,v.targetSnapshot,v.currentRouterState);return this.currentTransition=u={...v,targetRouterState:S},u}),io(()=>{this.events.next(new vU)}),((e,n,t,o)=>mn(c=>(new P7(n,c.targetRouterState,c.currentRouterState,t,o).activate(e),c)))(this.rootContexts,t.routeReuseStrategy,v=>this.events.next(v),this.inputBindingEnabled),Zd(1),io({next:v=>{f=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new np(v.id,this.urlSerializer.serialize(v.extractedUrl),this.urlSerializer.serialize(v.urlAfterRedirects))),t.titleStrategy?.updateTitle(v.targetRouterState.snapshot),v.resolve(!0)},complete:()=>{f=!0}}),No(this.transitionAbortSubject.pipe(io(v=>{throw v}))),pU(()=>{f||_||this.cancelNavigationTransition(u,"",1),this.currentNavigation?.id===u.id&&(this.currentNavigation=null)}),Tm(v=>{if(_=!0,h5(v))this.events.next(new NT(u.id,this.urlSerializer.serialize(u.extractedUrl),v.message,v.cancellationCode)),function w7(e){return h5(e)&&Im(e.url)}(v)?this.events.next(new yU(v.url)):u.resolve(!1);else{this.events.next(new XP(u.id,this.urlSerializer.serialize(u.extractedUrl),v,u.targetSnapshot??void 0));try{u.resolve(t.errorHandler(v))}catch(S){u.reject(S)}}return ks}))}))}cancelNavigationTransition(t,o,c){const u=new NT(t.id,this.urlSerializer.serialize(t.extractedUrl),o,c);this.events.next(u),t.resolve(!1)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function w5(e){return e!==OT}let I5=(()=>{class e{buildTitle(t){let o,c=t.root;for(;void 0!==c;)o=this.getResolvedTitleForRoute(c)??o,c=c.children.find(u=>u.outlet===xt);return o}getResolvedTitleForRoute(t){return t.data[TT]}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:function(){return Oe(Sq)},providedIn:"root"})}return e})(),Sq=(()=>{class e extends I5{constructor(t){super(),this.title=t}updateTitle(t){const o=this.buildTitle(t);void 0!==o&&this.title.setTitle(o)}static#e=this.\u0275fac=function(o){return new(o||e)(fe(Gn))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Cq=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:function(){return Oe(wq)},providedIn:"root"})}return e})();class Tq{shouldDetach(n){return!1}store(n,t){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,t){return n.routeConfig===t.routeConfig}}let wq=(()=>{class e extends Tq{static#e=this.\u0275fac=function(){let t;return function(c){return(t||(t=Ti(e)))(c||e)}}();static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const o1=new De("",{providedIn:"root",factory:()=>({})});let Iq=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:function(){return Oe(Rq)},providedIn:"root"})}return e})(),Rq=(()=>{class e{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,o){return t}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var UT=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(UT||{});function R5(e,n){e.events.pipe(ra(t=>t instanceof np||t instanceof NT||t instanceof XP||t instanceof Vv),mn(t=>t instanceof np||t instanceof Vv?UT.COMPLETE:t instanceof NT&&(0===t.code||1===t.code)?UT.REDIRECTING:UT.FAILED),ra(t=>t!==UT.REDIRECTING),Zd(1)).subscribe(()=>{n()})}function Aq(e){throw e}function Dq(e,n,t){return n.parse("/")}const Oq={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Nq={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Ps=(()=>{class e{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}get events(){return this._events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=Oe(Dd),this.isNgZoneEnabled=!1,this._events=new rn,this.options=Oe(o1,{optional:!0})||{},this.pendingTasks=Oe(vO),this.errorHandler=this.options.errorHandler||Aq,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||Dq,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=Oe(Iq),this.routeReuseStrategy=Oe(Cq),this.titleStrategy=Oe(I5),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=Oe(Wv,{optional:!0})?.flat()??[],this.navigationTransitions=Oe(r1),this.urlSerializer=Oe(IT),this.location=Oe(o0),this.componentInputBindingEnabled=!!Oe(QP,{optional:!0}),this.eventsSubscription=new kn,this.isNgZoneEnabled=Oe(lt)instanceof lt&&lt.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new Uv,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=o5(0,null),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe(t=>{this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const t=this.navigationTransitions.events.subscribe(o=>{try{const{currentTransition:c}=this.navigationTransitions;if(null===c)return void(A5(o)&&this._events.next(o));if(o instanceof $P)w5(c.source)&&(this.browserUrlTree=c.extractedUrl);else if(o instanceof Vv)this.rawUrlTree=c.rawUrl;else if(o instanceof e5){if("eager"===this.urlUpdateStrategy){if(!c.extras.skipLocationChange){const u=this.urlHandlingStrategy.merge(c.urlAfterRedirects,c.rawUrl);this.setBrowserUrl(u,c)}this.browserUrlTree=c.urlAfterRedirects}}else if(o instanceof vU)this.currentUrlTree=c.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(c.urlAfterRedirects,c.rawUrl),this.routerState=c.targetRouterState,"deferred"===this.urlUpdateStrategy&&(c.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,c),this.browserUrlTree=c.urlAfterRedirects);else if(o instanceof NT)0!==o.code&&1!==o.code&&(this.navigated=!0),(3===o.code||2===o.code)&&this.restoreHistory(c);else if(o instanceof yU){const u=this.urlHandlingStrategy.merge(o.url,c.currentRawUrl),f={skipLocationChange:c.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||w5(c.source)};this.scheduleNavigation(u,OT,null,f,{resolve:c.resolve,reject:c.reject,promise:c.promise})}o instanceof XP&&this.restoreHistory(c,!0),o instanceof np&&(this.navigated=!0),A5(o)&&this._events.next(o)}catch(c){this.navigationTransitions.transitionAbortSubject.next(c)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const t=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),OT,t)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const o="popstate"===t.type?"popstate":"hashchange";"popstate"===o&&setTimeout(()=>{this.navigateToSyncWithBrowser(t.url,o,t.state)},0)}))}navigateToSyncWithBrowser(t,o,c){const u={replaceUrl:!0},f=c?.navigationId?c:null;if(c){const v={...c};delete v.navigationId,delete v.\u0275routerPageId,0!==Object.keys(v).length&&(u.state=v)}const _=this.parseUrl(t);this.scheduleNavigation(_,o,f,u)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(AU),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,o={}){const{relativeTo:c,queryParams:u,fragment:f,queryParamsHandling:_,preserveFragment:v}=o,S=v?this.currentUrlTree.fragment:f;let k,R=null;switch(_){case"merge":R={...this.currentUrlTree.queryParams,...u};break;case"preserve":R=this.currentUrlTree.queryParams;break;default:R=u||null}null!==R&&(R=this.removeEmptyProps(R));try{k=K4(c?c.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof t[0]||!t[0].startsWith("/"))&&(t=[]),k=this.currentUrlTree.root}return Y4(k,t,R,S??null)}navigateByUrl(t,o={skipLocationChange:!1}){const c=Im(t)?t:this.parseUrl(t),u=this.urlHandlingStrategy.merge(c,this.rawUrlTree);return this.scheduleNavigation(u,OT,null,o)}navigate(t,o={skipLocationChange:!1}){return function Pq(e){for(let n=0;n<e.length;n++)if(null==e[n])throw new ue(4008,!1)}(t),this.navigateByUrl(this.createUrlTree(t,o),o)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let o;try{o=this.urlSerializer.parse(t)}catch(c){o=this.malformedUriErrorHandler(c,this.urlSerializer,t)}return o}isActive(t,o){let c;if(c=!0===o?{...Oq}:!1===o?{...Nq}:o,Im(t))return U4(this.currentUrlTree,t,c);const u=this.parseUrl(t);return U4(this.currentUrlTree,u,c)}removeEmptyProps(t){return Object.keys(t).reduce((o,c)=>{const u=t[c];return null!=u&&(o[c]=u),o},{})}scheduleNavigation(t,o,c,u,f){if(this.disposed)return Promise.resolve(!1);let _,v,S;f?(_=f.resolve,v=f.reject,S=f.promise):S=new Promise((k,U)=>{_=k,v=U});const R=this.pendingTasks.add();return R5(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(R))}),this.navigationTransitions.handleNavigationRequest({source:o,restoredState:c,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,currentBrowserUrl:this.browserUrlTree,rawUrl:t,extras:u,resolve:_,reject:v,promise:S,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),S.catch(k=>Promise.reject(k))}setBrowserUrl(t,o){const c=this.urlSerializer.serialize(t);if(this.location.isCurrentPathEqualTo(c)||o.extras.replaceUrl){const f={...o.extras.state,...this.generateNgRouterState(o.id,this.browserPageId)};this.location.replaceState(c,"",f)}else{const u={...o.extras.state,...this.generateNgRouterState(o.id,this.browserPageId+1)};this.location.go(c,"",u)}}restoreHistory(t,o=!1){if("computed"===this.canceledNavigationResolution){const u=this.currentPageId-this.browserPageId;0!==u?this.location.historyGo(u):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===u&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(o&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,o){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:o}:{navigationId:t}}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function A5(e){return!(e instanceof vU||e instanceof yU)}class D5{}let kq=(()=>{class e{constructor(t,o,c,u,f){this.router=t,this.injector=c,this.preloadingStrategy=u,this.loader=f}setUpPreloading(){this.subscription=this.router.events.pipe(ra(t=>t instanceof np),CT(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,o){const c=[];for(const u of o){u.providers&&!u._injector&&(u._injector=bh(u.providers,t,`Route: ${u.path}`));const f=u._injector??t,_=u._loadedInjector??f;(u.loadChildren&&!u._loadedRoutes&&void 0===u.canLoad||u.loadComponent&&!u._loadedComponent)&&c.push(this.preloadConfig(f,u)),(u.children||u._loadedRoutes)&&c.push(this.processRoutes(_,u.children??u._loadedRoutes))}return Mi(c).pipe(ds())}preloadConfig(t,o){return this.preloadingStrategy.preload(o,()=>{let c;c=o.loadChildren&&void 0===o.canLoad?this.loader.loadChildren(t,o):He(null);const u=c.pipe(yi(f=>null===f?He(void 0):(o._loadedRoutes=f.routes,o._loadedInjector=f.injector,this.processRoutes(f.injector??t,f.routes))));return o.loadComponent&&!o._loadedComponent?Mi([u,this.loader.loadComponent(o)]).pipe(ds()):u})}static#e=this.\u0275fac=function(o){return new(o||e)(fe(Ps),fe(Ua),fe(zo),fe(D5),fe(PU))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const MU=new De("");let O5=(()=>{class e{constructor(t,o,c,u,f={}){this.urlSerializer=t,this.transitions=o,this.viewportScroller=c,this.zone=u,this.options=f,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},f.scrollPositionRestoration=f.scrollPositionRestoration||"disabled",f.anchorScrolling=f.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof $P?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof np?(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment)):t instanceof Vv&&0===t.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof t5&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,o){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new t5(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,o))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#e=this.\u0275fac=function(o){ld()};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac})}return e})();function iu(e,n){return{\u0275kind:e,\u0275providers:n}}function P5(){const e=Oe(tr);return n=>{const t=e.get(ea);if(n!==t.components[0])return;const o=e.get(Ps),c=e.get(x5);1===e.get(kU)&&o.initialNavigation(),e.get(M5,null,Ft.Optional)?.setUpPreloading(),e.get(MU,null,Ft.Optional)?.init(),o.resetRootComponentType(t.componentTypes[0]),c.closed||(c.next(),c.complete(),c.unsubscribe())}}const x5=new De("",{factory:()=>new rn}),kU=new De("",{providedIn:"root",factory:()=>1}),M5=new De("");function Vq(e){return iu(0,[{provide:M5,useExisting:kq},{provide:D5,useExisting:e}])}const k5=new De("ROUTER_FORROOT_GUARD"),jq=[o0,{provide:IT,useClass:fU},Ps,PT,{provide:Rm,useFactory:function N5(e){return e.routerState.root},deps:[Ps]},PU,[]];function Hq(){return new ts("Router",Ps)}let Gq=(()=>{class e{constructor(t){}static forRoot(t,o){return{ngModule:e,providers:[jq,[],{provide:Wv,multi:!0,useValue:t},{provide:k5,useFactory:Kq,deps:[[Ps,new Bp,new q_]]},{provide:o1,useValue:o||{}},o?.useHash?{provide:xh,useClass:w3}:{provide:xh,useClass:l2},{provide:MU,useFactory:()=>{const e=Oe(NN),n=Oe(lt),t=Oe(o1),o=Oe(r1),c=Oe(IT);return t.scrollOffset&&e.setOffset(t.scrollOffset),new O5(c,o,e,n,t)}},o?.preloadingStrategy?Vq(o.preloadingStrategy).\u0275providers:[],{provide:ts,multi:!0,useFactory:Hq},o?.initialNavigation?Yq(o):[],o?.bindToComponentInputs?iu(8,[l5,{provide:QP,useExisting:l5}]).\u0275providers:[],[{provide:L5,useFactory:P5},{provide:Ba,multi:!0,useExisting:L5}]]}}static forChild(t){return{ngModule:e,providers:[{provide:Wv,multi:!0,useValue:t}]}}static#e=this.\u0275fac=function(o){return new(o||e)(fe(k5,8))};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({})}return e})();function Kq(e){return"guarded"}function Yq(e){return["disabled"===e.initialNavigation?iu(3,[{provide:Cs,multi:!0,useFactory:()=>{const n=Oe(Ps);return()=>{n.setUpLocationChangeListener()}}},{provide:kU,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?iu(2,[{provide:kU,useValue:0},{provide:Cs,multi:!0,deps:[tr],useFactory:n=>{const t=n.get(nN,Promise.resolve());return()=>t.then(()=>new Promise(o=>{const c=n.get(Ps),u=n.get(x5);R5(c,()=>{o(!0)}),n.get(r1).afterPreactivation=()=>(o(!0),u.closed?He(void 0):u),c.initialNavigation()}))}}]).\u0275providers:[]]}const L5=new De(""),F5_configs={AppID:"fee9eb8f5bb44a6893ec96fd5e993a31"};let Xq=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275cmp=Ct({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(o,c){1&o&&wt(0,"router-outlet")},dependencies:[IU],changeDetection:0})}return e})();function cr(e){return"function"==typeof e}function U5(e){const t=e(o=>{Error.call(o),o.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const LU=U5(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((o,c)=>`${c+1}) ${o.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function s1(e,n){if(e){const t=e.indexOf(n);0<=t&&e.splice(t,1)}}class Ac{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const u of t)u.remove(this);else t.remove(this);const{initialTeardown:o}=this;if(cr(o))try{o()}catch(u){n=u instanceof LU?u.errors:[u]}const{_finalizers:c}=this;if(c){this._finalizers=null;for(const u of c)try{j5(u)}catch(f){n=n??[],f instanceof LU?n=[...n,...f.errors]:n.push(f)}}if(n)throw new LU(n)}}add(n){var t;if(n&&n!==this)if(this.closed)j5(n);else{if(n instanceof Ac){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(n)}}_hasParent(n){const{_parentage:t}=this;return t===n||Array.isArray(t)&&t.includes(n)}_addParent(n){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(n),t):t?[t,n]:n}_removeParent(n){const{_parentage:t}=this;t===n?this._parentage=null:Array.isArray(t)&&s1(t,n)}remove(n){const{_finalizers:t}=this;t&&s1(t,n),n instanceof Ac&&n._removeParent(this)}}Ac.EMPTY=(()=>{const e=new Ac;return e.closed=!0,e})();const V5=Ac.EMPTY;function B5(e){return e instanceof Ac||e&&"closed"in e&&cr(e.remove)&&cr(e.add)&&cr(e.unsubscribe)}function j5(e){cr(e)?e():e.unsubscribe()}const Am={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},a1={setTimeout(e,n,...t){const{delegate:o}=a1;return o?.setTimeout?o.setTimeout(e,n,...t):setTimeout(e,n,...t)},clearTimeout(e){const{delegate:n}=a1;return(n?.clearTimeout||clearTimeout)(e)},delegate:void 0};function H5(e){a1.setTimeout(()=>{const{onUnhandledError:n}=Am;if(!n)throw e;n(e)})}function FU(){}const Jq=UU("C",void 0,void 0);function UU(e,n,t){return{kind:e,value:n,error:t}}let Dm=null;function c1(e){if(Am.useDeprecatedSynchronousErrorHandling){const n=!Dm;if(n&&(Dm={errorThrown:!1,error:null}),e(),n){const{errorThrown:t,error:o}=Dm;if(Dm=null,t)throw o}}else e()}class VU extends Ac{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,B5(n)&&n.add(this)):this.destination=rK}static create(n,t,o){return new jU(n,t,o)}next(n){this.isStopped?HU(function Zq(e){return UU("N",e,void 0)}(n),this):this._next(n)}error(n){this.isStopped?HU(function Qq(e){return UU("E",void 0,e)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?HU(Jq,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const tK=Function.prototype.bind;function BU(e,n){return tK.call(e,n)}class nK{constructor(n){this.partialObserver=n}next(n){const{partialObserver:t}=this;if(t.next)try{t.next(n)}catch(o){l1(o)}}error(n){const{partialObserver:t}=this;if(t.error)try{t.error(n)}catch(o){l1(o)}else l1(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(t){l1(t)}}}class jU extends VU{constructor(n,t,o){let c;if(super(),cr(n)||!n)c={next:n??void 0,error:t??void 0,complete:o??void 0};else{let u;this&&Am.useDeprecatedNextContext?(u=Object.create(n),u.unsubscribe=()=>this.unsubscribe(),c={next:n.next&&BU(n.next,u),error:n.error&&BU(n.error,u),complete:n.complete&&BU(n.complete,u)}):c=n}this.destination=new nK(c)}}function l1(e){Am.useDeprecatedSynchronousErrorHandling?function eK(e){Am.useDeprecatedSynchronousErrorHandling&&Dm&&(Dm.errorThrown=!0,Dm.error=e)}(e):H5(e)}function HU(e,n){const{onStoppedNotification:t}=Am;t&&a1.setTimeout(()=>t(e,n))}const rK={closed:!0,next:FU,error:function iK(e){throw e},complete:FU},GU="function"==typeof Symbol&&Symbol.observable||"@@observable";function WU(e){return e}let ca=(()=>{class e{constructor(t){t&&(this._subscribe=t)}lift(t){const o=new e;return o.source=this,o.operator=t,o}subscribe(t,o,c){const u=function sK(e){return e&&e instanceof VU||function oK(e){return e&&cr(e.next)&&cr(e.error)&&cr(e.complete)}(e)&&B5(e)}(t)?t:new jU(t,o,c);return c1(()=>{const{operator:f,source:_}=this;u.add(f?f.call(u,_):_?this._subscribe(u):this._trySubscribe(u))}),u}_trySubscribe(t){try{return this._subscribe(t)}catch(o){t.error(o)}}forEach(t,o){return new(o=W5(o))((c,u)=>{const f=new jU({next:_=>{try{t(_)}catch(v){u(v),f.unsubscribe()}},error:u,complete:c});this.subscribe(f)})}_subscribe(t){var o;return null===(o=this.source)||void 0===o?void 0:o.subscribe(t)}[GU](){return this}pipe(...t){return function G5(e){return 0===e.length?WU:1===e.length?e[0]:function(t){return e.reduce((o,c)=>c(o),t)}}(t)(this)}toPromise(t){return new(t=W5(t))((o,c)=>{let u;this.subscribe(f=>u=f,f=>c(f),()=>o(u))})}}return e.create=n=>new e(n),e})();function W5(e){var n;return null!==(n=e??Am.Promise)&&void 0!==n?n:Promise}const aK=U5(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let VT=(()=>{class e extends ca{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const o=new z5(this,this);return o.operator=t,o}_throwIfClosed(){if(this.closed)throw new aK}next(t){c1(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const o of this.currentObservers)o.next(t)}})}error(t){c1(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:o}=this;for(;o.length;)o.shift().error(t)}})}complete(){c1(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:o,isStopped:c,observers:u}=this;return o||c?V5:(this.currentObservers=null,u.push(t),new Ac(()=>{this.currentObservers=null,s1(u,t)}))}_checkFinalizedStatuses(t){const{hasError:o,thrownError:c,isStopped:u}=this;o?t.error(c):u&&t.complete()}asObservable(){const t=new ca;return t.source=this,t}}return e.create=(n,t)=>new z5(n,t),e})();class z5 extends VT{constructor(n,t){super(),this.destination=n,this.source=t}next(n){var t,o;null===(o=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===o||o.call(t,n)}error(n){var t,o;null===(o=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===o||o.call(t,n)}complete(){var n,t;null===(t=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===t||t.call(n)}_subscribe(n){var t,o;return null!==(o=null===(t=this.source)||void 0===t?void 0:t.subscribe(n))&&void 0!==o?o:V5}}function q5(e){return e&&cr(e.schedule)}function K5(e){return q5(function zU(e){return e[e.length-1]}(e))?e.pop():void 0}function ip(e){return this instanceof ip?(this.v=e,this):new ip(e)}function J5(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function $U(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],o=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(u){t[u]=e[u]&&function(f){return new Promise(function(_,v){!function c(u,f,_,v){Promise.resolve(v).then(function(S){u({value:S,done:_})},f)}(_,v,(f=e[u](f)).done,f.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Q5=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function Z5(e){return cr(e?.then)}function e6(e){return cr(e[GU])}function t6(e){return Symbol.asyncIterator&&cr(e?.[Symbol.asyncIterator])}function n6(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const i6=function DK(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function r6(e){return cr(e?.[i6])}function o6(e){return function X5(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,o=t.apply(e,n||[]),u=[];return c={},f("next"),f("throw"),f("return"),c[Symbol.asyncIterator]=function(){return this},c;function f(U){o[U]&&(c[U]=function(G){return new Promise(function(z,X){u.push([U,G,z,X])>1||_(U,G)})})}function _(U,G){try{!function v(U){U.value instanceof ip?Promise.resolve(U.value.v).then(S,R):k(u[0][2],U)}(o[U](G))}catch(z){k(u[0][3],z)}}function S(U){_("next",U)}function R(U){_("throw",U)}function k(U,G){U(G),u.shift(),u.length&&_(u[0][0],u[0][1])}}(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:o,done:c}=yield ip(t.read());if(c)return yield ip(void 0);yield yield ip(o)}}finally{t.releaseLock()}})}function s6(e){return cr(e?.getReader)}function Om(e){if(e instanceof ca)return e;if(null!=e){if(e6(e))return function OK(e){return new ca(n=>{const t=e[GU]();if(cr(t.subscribe))return t.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Q5(e))return function NK(e){return new ca(n=>{for(let t=0;t<e.length&&!n.closed;t++)n.next(e[t]);n.complete()})}(e);if(Z5(e))return function PK(e){return new ca(n=>{e.then(t=>{n.closed||(n.next(t),n.complete())},t=>n.error(t)).then(null,H5)})}(e);if(t6(e))return a6(e);if(r6(e))return function xK(e){return new ca(n=>{for(const t of e)if(n.next(t),n.closed)return;n.complete()})}(e);if(s6(e))return function MK(e){return a6(o6(e))}(e)}throw n6(e)}function a6(e){return new ca(n=>{(function kK(e,n){var t,o,c,u;return function Y5(e,n,t,o){return new(t||(t=Promise))(function(u,f){function _(R){try{S(o.next(R))}catch(k){f(k)}}function v(R){try{S(o.throw(R))}catch(k){f(k)}}function S(R){R.done?u(R.value):function c(u){return u instanceof t?u:new t(function(f){f(u)})}(R.value).then(_,v)}S((o=o.apply(e,n||[])).next())})}(this,void 0,void 0,function*(){try{for(t=J5(e);!(o=yield t.next()).done;)if(n.next(o.value),n.closed)return}catch(f){c={error:f}}finally{try{o&&!o.done&&(u=t.return)&&(yield u.call(t))}finally{if(c)throw c.error}}n.complete()})})(e,n).catch(t=>n.error(t))})}function rp(e,n,t,o=0,c=!1){const u=n.schedule(function(){t(),c?e.add(this.schedule(null,o)):this.unsubscribe()},o);if(e.add(u),!c)return u}function op(e){return n=>{if(function LK(e){return cr(e?.lift)}(n))return n.lift(function(t){try{return e(t,this)}catch(o){this.error(o)}});throw new TypeError("Unable to lift unknown Observable type")}}function ru(e,n,t,o,c){return new FK(e,n,t,o,c)}class FK extends VU{constructor(n,t,o,c,u,f){super(n),this.onFinalize=u,this.shouldUnsubscribe=f,this._next=t?function(_){try{t(_)}catch(v){n.error(v)}}:super._next,this._error=c?function(_){try{c(_)}catch(v){n.error(v)}finally{this.unsubscribe()}}:super._error,this._complete=o?function(){try{o()}catch(_){n.error(_)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function c6(e,n=0){return op((t,o)=>{t.subscribe(ru(o,c=>rp(o,e,()=>o.next(c),n),()=>rp(o,e,()=>o.complete(),n),c=>rp(o,e,()=>o.error(c),n)))})}function l6(e,n=0){return op((t,o)=>{o.add(e.schedule(()=>t.subscribe(o),n))})}function d6(e,n){if(!e)throw new Error("Iterable cannot be null");return new ca(t=>{rp(t,n,()=>{const o=e[Symbol.asyncIterator]();rp(t,n,()=>{o.next().then(c=>{c.done?t.complete():t.next(c.value)})},0,!0)})})}function u6(e,n){return n?function GK(e,n){if(null!=e){if(e6(e))return function UK(e,n){return Om(e).pipe(l6(n),c6(n))}(e,n);if(Q5(e))return function BK(e,n){return new ca(t=>{let o=0;return n.schedule(function(){o===e.length?t.complete():(t.next(e[o++]),t.closed||this.schedule())})})}(e,n);if(Z5(e))return function VK(e,n){return Om(e).pipe(l6(n),c6(n))}(e,n);if(t6(e))return d6(e,n);if(r6(e))return function jK(e,n){return new ca(t=>{let o;return rp(t,n,()=>{o=e[i6](),rp(t,n,()=>{let c,u;try{({value:c,done:u}=o.next())}catch(f){return void t.error(f)}u?t.complete():t.next(c)},0,!0)}),()=>cr(o?.return)&&o.return()})}(e,n);if(s6(e))return function HK(e,n){return d6(o6(e),n)}(e,n)}throw n6(e)}(e,n):Om(e)}const h6=new ca(e=>e.complete());function Bl(e){return e<=0?()=>h6:op((n,t)=>{let o=0;n.subscribe(ru(t,c=>{++o<=e&&(t.next(c),e<=o&&t.complete())}))})}const d1_HIDDEN={opacity:0,"margin-top":"100%"},d1_SHOWN={opacity:1,"margin-top":0},p6=xF("fade",[mT(":enter",[Ll(d1_HIDDEN),fT("250ms ease-in-out",Ll(d1_SHOWN))]),mT(":leave",[Ll(d1_SHOWN),fT("250ms ease-in-out",Ll(d1_HIDDEN))])]);class f6{constructor(n){this.cdr=n,this.afterClosed=new VT,this.shown=!0}closeDialog(n){this.onAfterClosed(n)}onAfterClosed(n){this.shown=!1,this.cdr.markForCheck(),this.afterClosed.next(n)}}var YK=ap(885),$K=ap.n(YK);class m6 extends VT{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const t=super._subscribe(n);return!t.closed&&n.next(this._value),t}getValue(){const{hasError:n,thrownError:t,_value:o}=this;if(n)throw t;return this._throwIfClosed(),o}next(n){super.next(this._value=n)}}class XK extends Ac{constructor(n,t){super()}schedule(n,t=0){return this}}const u1={setInterval(e,n,...t){const{delegate:o}=u1;return o?.setInterval?o.setInterval(e,n,...t):setInterval(e,n,...t)},clearInterval(e){const{delegate:n}=u1;return(n?.clearInterval||clearInterval)(e)},delegate:void 0},_6={now:()=>(_6.delegate||Date).now(),delegate:void 0};class BT{constructor(n,t=BT.now){this.schedulerActionCtor=n,this.now=t}schedule(n,t=0,o){return new this.schedulerActionCtor(this,n).schedule(o,t)}}BT.now=_6.now;const XU=new class QK extends BT{constructor(n,t=BT.now){super(n,t),this.actions=[],this._active=!1}flush(n){const{actions:t}=this;if(this._active)return void t.push(n);let o;this._active=!0;do{if(o=n.execute(n.state,n.delay))break}while(n=t.shift());if(this._active=!1,o){for(;n=t.shift();)n.unsubscribe();throw o}}}(class JK extends XK{constructor(n,t){super(n,t),this.scheduler=n,this.work=t,this.pending=!1}schedule(n,t=0){var o;if(this.closed)return this;this.state=n;const c=this.id,u=this.scheduler;return null!=c&&(this.id=this.recycleAsyncId(u,c,t)),this.pending=!0,this.delay=t,this.id=null!==(o=this.id)&&void 0!==o?o:this.requestAsyncId(u,this.id,t),this}requestAsyncId(n,t,o=0){return u1.setInterval(n.flush.bind(n,this),o)}recycleAsyncId(n,t,o=0){if(null!=o&&this.delay===o&&!1===this.pending)return t;null!=t&&u1.clearInterval(t)}execute(n,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const o=this._execute(n,t);if(o)return o;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,t){let c,o=!1;try{this.work(n)}catch(u){o=!0,c=u||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),c}unsubscribe(){if(!this.closed){const{id:n,scheduler:t}=this,{actions:o}=t;this.work=this.state=this.scheduler=null,this.pending=!1,s1(o,this),null!=n&&(this.id=this.recycleAsyncId(t,n,null)),this.delay=null,super.unsubscribe()}}}),ZK=XU;function JU(e=0,n,t=ZK){let o=-1;return null!=n&&(q5(n)?t=n:o=n),new ca(c=>{let u=function eY(e){return e instanceof Date&&!isNaN(e)}(e)?+e-t.now():e;u<0&&(u=0);let f=0;return t.schedule(function(){c.closed||(c.next(f++),0<=o?this.schedule(void 0,o):c.complete())},u)})}function QU(e=0,n=XU){return e<0&&(e=0),JU(e,e,n)}const g6={connected:!1,loading:!0,statusText:"Initializing",started:null,ended:!1,error:!1},tY={mode:"rtc",codec:"h264"};let E6=(()=>{class e{constructor(t){this.config=t,this.agoraRTC=$K(),this.streamState=new m6(g6),this.remoteStreamVideoToggle=new m6(!0),this.callEnd=new VT,this.localContainerId="local-video",this.remoteCalls=[],this.remoteStreamVideoToggle$=this.remoteStreamVideoToggle.asObservable(),this.streamState$=this.streamState.asObservable(),this.agoraRTC.checkSystemRequirements()||this.handleError(new Error("Web RTC is not supported in this browser"))}init(t,o,c=!1){return this.uid=t,this.agoraRTC.setLogLevel(c?0:4),this.client=this.agoraRTC.createClient(tY),this.assignClientHandlers(),this.initLocalStream().then(()=>{this.client.join(this.config.AppID,o,null,this.uid).then(()=>{this.localTracks.videoTrack.play(this.localContainerId),this.client.publish(Object.values(this.localTracks)),this.streamState.next({...this.streamState.value,connected:!0,statusText:"Waiting others to join"})}).catch(u=>this.handleError(u))}),this.callEnd.asObservable()}deinit(){this.streamState.next(g6)}endCall(){this.client.leave().then(()=>{this.stopLocalStream(),this.streamState.next({...this.streamState.value,started:null,loading:!0,statusText:"",ended:!0}),this.remoteCalls=[],QU(500).pipe(Bl(1)).subscribe(()=>this.callEnd.next())})}toggleVideo(t){this.localTracks&&this.localTracks.videoTrack.setMuted(t)}toggleAudio(t){this.localTracks&&this.localTracks.audioTrack.setMuted(t)}toggleFullScreen(t){t?document.exitFullscreen():document.documentElement.requestFullscreen()}isVideoEnabled(){return!!this.localTracks&&!this.localTracks.videoTrack.muted}isAudioEnabled(){return!!this.localTracks&&!this.localTracks.audioTrack.muted}assignClientHandlers(){this.client.on("user-joined",t=>{this.streamState.next({...this.streamState.value,started:Date.now(),loading:!1}),this.remoteCalls.length||this.remoteCalls.push(this.getRemoteId(t))}),this.client.on("user-published",(t,o)=>{const c=this.getRemoteId(t);this.client.subscribe(t,o).then(u=>{this.remoteCalls.includes(c)&&u.play(c)})}),this.client.on("user-info-updated",(t,o)=>{"mute-video"===o&&this.remoteStreamVideoToggle.next(!1),"unmute-video"===o&&this.remoteStreamVideoToggle.next(!0)}),this.client.on("user-left",()=>{this.endCall()})}initLocalStream(){return Promise.all([this.agoraRTC.createCameraVideoTrack(),this.agoraRTC.createMicrophoneAudioTrack()]).then(([t,o])=>{this.localTracks={audioTrack:o,videoTrack:t}}).catch(t=>{this.handleError(t)})}getRemoteId(t){return`remote_call-${t.uid}`}handleError(t){throw this.streamState.next({...this.streamState.value,statusText:t.message,error:!0}),this.stopLocalStream(),QU(5e3).pipe(Bl(1)).subscribe(()=>this.callEnd.next()),new Error(t.message)}stopLocalStream(){this.localTracks&&Object.values(this.localTracks).forEach(t=>{t.stop(),t.close()})}static#e=this.\u0275fac=function(o){return new(o||e)(fe("AgoraConfig"))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function nY(e,n){if(1&e){const t=hh();Pe(0,"div",1)(1,"button",2),en("click",function(){return ga(t),dn(tn().onToggleFullScreen())}),Pe(2,"div",3),Go(),Pe(3,"svg",4)(4,"g",26)(5,"g",6)(6,"g",7)(7,"g",11),wt(8,"path",27)(9,"path",28)(10,"path",29)(11,"path",30),Re()()()(),Pe(12,"g",31)(13,"g",6)(14,"g",32)(15,"g",7),wt(16,"path",33)(17,"path",34)(18,"path",35)(19,"path",36),Re()()()()()(),rc(),Pe(20,"p"),Dr(21),Re()()()}if(2&e){const t=tn();Je(1),Vt("controls__button--active",t.fullScreenEnabled),Je(3),Vt("controls__icon--shown",!t.fullScreenEnabled),Je(8),Vt("controls__icon--shown",t.fullScreenEnabled),Je(9),hc(t.fullScreenEnabled?"Exit fullscreen":"Fullscreen")}}function iY(e,n){if(1&e){const t=hh();Pe(0,"div",1)(1,"button",37),en("click",function(){return ga(t),dn(tn().onToggleSmallScreen())}),Pe(2,"div",3),Go(),Pe(3,"svg",4)(4,"g",38),wt(5,"path",39),Re(),Pe(6,"defs")(7,"filter",40),wt(8,"feFlood",41)(9,"feColorMatrix",42)(10,"feOffset",43)(11,"feGaussianBlur",44)(12,"feComposite",45)(13,"feColorMatrix",46)(14,"feBlend",47)(15,"feBlend",48),Re()()()(),rc(),Pe(16,"p"),Dr(17,"Minimize"),Re()()()}if(2&e){const t=tn();Je(1),Vt("controls__button--active",t.smallScreenEnabled)}}let rY=(()=>{class e{constructor(){this.cameraEnabled=!0,this.microphoneEnabled=!0,this.fullScreenEnabled=!1,this.smallScreenEnabled=!1,this.displaySmallScreen=!1,this.toggleCamera=new Zt,this.toggleMicrophone=new Zt,this.toggleFullScreen=new Zt,this.toggleSmallScreen=new Zt,this.endCall=new Zt}onToggleCamera(){this.toggleCamera.emit(this.cameraEnabled)}onToggleMicrophone(){this.toggleMicrophone.emit(this.microphoneEnabled)}onToggleFullScreen(){this.toggleFullScreen.emit(this.fullScreenEnabled)}onToggleSmallScreen(){this.toggleSmallScreen.emit(this.smallScreenEnabled)}onEndCall(){this.endCall.emit()}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275cmp=Ct({type:e,selectors:[["ngx-controls"]],inputs:{cameraEnabled:"cameraEnabled",microphoneEnabled:"microphoneEnabled",fullScreenEnabled:"fullScreenEnabled",smallScreenEnabled:"smallScreenEnabled",displaySmallScreen:"displaySmallScreen"},outputs:{toggleCamera:"toggleCamera",toggleMicrophone:"toggleMicrophone",toggleFullScreen:"toggleFullScreen",toggleSmallScreen:"toggleSmallScreen",endCall:"endCall"},decls:43,vars:16,consts:[[1,"controls"],[1,"controls__item"],[1,"controls__button",3,"click"],[1,"controls__icon-wrapper"],["viewBox","0 0 64 64","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","video-camera",1,"controls__icon"],["id","Group"],["id","Group_2"],["id","Vector","d","M63.4134 16.2294C63.0454 15.9814 62.5787 15.928 62.1707 16.096L50.6668 20.6986V20C50.6668 16.3226 47.6748 13.3334 44.0001 13.3334H6.66663C2.992 13.3334 0 16.3226 0 20V44C0 47.6774 2.992 50.6666 6.66663 50.6666H44C47.6746 50.6666 50.6666 47.6772 50.6666 44V43.3014L62.1706 47.904C62.5812 48.072 63.048 48.0186 63.4132 47.7706C63.7786 47.5226 63.9999 47.1093 63.9999 46.6666V17.3334C64 16.8906 63.7786 16.4774 63.4134 16.2294Z","fill","white"],["id","no-camera",1,"controls__icon"],["id","Vector","d","M44.0002 13.3325H6.66735C2.99276 13.3325 0.000793457 16.3218 0.000793457 19.999V43.9988C0.000793457 47.6761 2.99276 50.6654 6.66735 50.6654H7.67797L44.9176 13.4257C44.6162 13.3832 44.315 13.3325 44.0002 13.3325Z","fill","white"],["id","Group_3"],["id","Group_4"],["id","Vector_2","d","M63.4134 16.2285C63.0454 15.9805 62.5788 15.9271 62.1708 16.0951L50.6669 20.6977V19.9991C50.6669 18.6417 50.2535 17.3831 49.5549 16.3297L63.608 2.2766C64.128 1.75661 64.128 0.911242 63.608 0.391247C63.088 -0.128748 62.2426 -0.128748 61.7226 0.391247L0.389996 61.724C-0.129999 62.244 -0.129999 63.0894 0.389996 63.6094C0.651369 63.868 0.992615 63.9988 1.33399 63.9988C1.67536 63.9988 2.01661 63.8681 2.27798 63.6094L15.2192 50.6655H44.0003C47.6749 50.6655 50.6669 47.6762 50.6669 43.9989V43.3003L62.1708 47.9029C62.5814 48.0709 63.0481 48.0175 63.4134 47.7695C63.7788 47.5215 64 47.1082 64 46.6655V17.3325C64 16.8898 63.7788 16.4765 63.4134 16.2285Z","fill","white"],["id","microphone",1,"controls__icon"],["id","Vector"],["fill-rule","evenodd","clip-rule","evenodd","d","M44.3474 12.1407L44.3468 17.2309V33.8672C44.3468 40.6024 38.9004 46.0823 32.206 46.0823C27.8366 46.0787 23.8059 43.7286 21.6503 39.9279L20.4131 36.8161C20.1824 35.875 20.0659 34.9098 20.0659 33.941V12.1407C20.0659 5.43551 25.5014 0 32.2066 0C38.9118 0 44.3474 5.43551 44.3474 12.1407Z","fill","white"],["fill-rule","evenodd","clip-rule","evenodd","d","M15.0971 33.7512C15.0947 36.1345 15.5932 38.4912 16.5596 40.6697L18.1223 43.4553C22.3699 49.6259 30.1387 52.3143 37.292 50.089C44.4453 47.8638 49.318 41.2426 49.3156 33.7518C49.3156 32.9026 50.0039 32.2143 50.8532 32.2143C51.7018 32.2143 52.3907 32.9026 52.3907 33.7518C52.4051 44.4499 44.0585 53.2951 33.3778 53.9017V60.9246H39.8098C40.6584 60.9246 41.3473 61.6135 41.3473 62.4622C41.3473 63.3114 40.6584 63.9997 39.8098 63.9997H24.6029C23.7537 63.9997 23.0654 63.3114 23.0654 62.4622C23.0654 61.6135 23.7537 60.9246 24.6029 60.9246H30.3033V53.847C25.6228 53.4212 21.2413 51.3623 17.926 48.0313C17.1926 47.298 16.5163 46.51 15.9031 45.6739L14.2418 42.9874C12.7757 40.1297 12.0148 36.9633 12.022 33.7512C12.022 32.902 12.7103 32.2137 13.5595 32.2137C14.4088 32.2137 15.0971 32.902 15.0971 33.7512Z","fill","white"],["id","no-microphone",1,"controls__icon"],["id","Vector","d","M52.9733 4.25592L44.3474 12.8813V12.1407C44.3474 5.43551 38.9118 0 32.2066 0C25.5014 0 20.0659 5.43551 20.0659 12.1407V33.941C20.0659 34.9098 20.1824 35.875 20.4131 36.8161L16.5596 40.6697C15.5932 38.4912 15.0947 36.1345 15.0971 33.7512C15.0971 32.902 14.4088 32.2137 13.5595 32.2137C12.7103 32.2137 12.022 32.902 12.022 33.7512C12.0148 36.9633 12.7757 40.1297 14.2418 42.9874L8.81411 48.4151C8.4117 48.8007 8.24954 49.3731 8.39008 49.9124C8.53002 50.4518 8.95105 50.8728 9.4898 51.0133C10.0291 51.1539 10.6021 50.9917 10.9877 50.5899L15.9031 45.6739C16.5163 46.51 17.1926 47.298 17.926 48.0313C21.2413 51.3623 25.6228 53.4212 30.3033 53.847V60.9246H24.6029C23.7537 60.9246 23.0654 61.6135 23.0654 62.4622C23.0654 63.3114 23.7537 63.9997 24.6029 63.9997H39.8098C40.6584 63.9997 41.3473 63.3114 41.3473 62.4622C41.3473 61.6135 40.6584 60.9246 39.8098 60.9246H33.3778V53.9017C44.0585 53.2951 52.4051 44.4499 52.3907 33.7518C52.3907 32.9026 51.7018 32.2143 50.8532 32.2143C50.0039 32.2143 49.3156 32.9026 49.3156 33.7518C49.318 41.2426 44.4453 47.8638 37.292 50.089C30.1387 52.3143 22.3699 49.6259 18.1224 43.4553L21.6503 39.9279C23.8059 43.7286 27.8366 46.0787 32.206 46.0823C38.9004 46.0823 44.3468 40.6024 44.3468 33.8672V17.2309L55.1475 6.43072C55.7481 5.83071 55.7481 4.85713 55.1475 4.25652C54.5469 3.65591 53.5733 3.65591 52.9733 4.25652V4.25592Z","fill","white"],["class","controls__item",4,"ngIf"],[1,"controls__button","controls__button--danger",3,"click"],["id","phone"],["id","Vector","d","M51.7097 13.2478C51.2458 12.7839 50.4959 12.7839 50.032 13.2478L1.38351 61.8963C0.919568 62.3602 0.919568 63.1101 1.38351 63.574C1.61488 63.8054 1.91864 63.9217 2.2224 63.9217C2.52615 63.9217 2.82991 63.8054 3.06129 63.574L51.7097 14.9256C52.1737 14.4628 52.1737 13.7117 51.7097 13.2478Z","fill","white"],["id","Vector_2","d","M16.9605 42.9635L26.1159 33.8081L21.3365 29.0287C18.91 26.6022 18.6869 24.3679 20.5878 21.5629C20.8535 21.1951 22.5444 19.6941 23.992 18.4839C24.9151 17.9333 25.5487 17.1181 25.8264 16.1155C26.1954 14.783 25.9225 13.2156 25.0516 11.6885C24.8463 11.3373 19.9625 3.06229 15.4583 0.680892C14.6171 0.235937 13.6714 0.0010004 12.721 0.0010004C11.1571 0.0010004 9.68576 0.610886 8.58109 1.71556L5.57082 4.72702C-3.21082 13.5098 -1.58525 24.419 10.2719 36.2749L16.9605 42.9635Z","fill","white"],["id","Vector_3","d","M63.313 48.5357C60.9304 44.0328 52.6566 39.1478 52.2923 38.9342C51.2304 38.329 50.1209 38.0099 49.0839 38.0099C47.5402 38.0099 46.2753 38.717 45.51 40.0033C44.2986 41.452 42.7964 43.1429 42.4345 43.4051C39.6129 45.3154 37.4071 45.1007 34.9652 42.6588L31.148 38.8416L21.9926 47.997L27.7189 53.7233C34.5356 60.5412 41.0367 63.9976 47.0371 63.9976C47.0383 63.9976 47.0383 63.9976 47.0383 63.9976C51.4534 63.9976 55.5672 62.1217 59.2669 58.4232L62.2771 55.413C64.1068 53.5845 64.5233 50.821 63.313 48.5357Z","fill","white"],["id","fullscreen",1,"controls__icon"],["id","Vector","d","M57.8018 53.4382L44.3964 40.0328L40.0328 44.3964L53.4382 57.8018H43.0205V64H64V43.0205H57.8018V53.4382Z","fill","white"],["id","Vector_2","d","M44.3964 23.9803L57.8018 10.5618V20.9795H64V0H43.0205V6.1982H53.4382L40.0328 19.6036L44.3964 23.9803Z","fill","white"],["id","Vector_3","d","M19.6036 40.0328L6.1982 53.4382V43.0205H0V64H20.9795V57.8018H10.5618L23.9803 44.3964L19.6036 40.0328Z","fill","white"],["id","Vector_4","d","M20.9795 6.1982V0H0V20.9795H6.1982V10.5618L19.6036 23.9803L23.9803 19.6036L10.5618 6.1982H20.9795Z","fill","white"],["id","exit-full-screen",1,"controls__icon"],["id","fullscreen_x5F_exit"],["id","Vector","d","M49.172 54.828L58.344 64L64 58.344L54.828 49.172L64 40H40V64L49.172 54.828Z","fill","white"],["id","Vector_2","d","M0 24H24V0L14.828 9.172L5.75 0.086L0.094 5.742L9.172 14.828L0 24Z","fill","white"],["id","Vector_3","d","M0 58.344L5.656 64L14.828 54.828L24 64V40H0L9.172 49.172L0 58.344Z","fill","white"],["id","Vector_4","d","M40 24H64L54.828 14.828L63.922 5.742L58.266 0.086L49.172 9.172L40 0V24Z","fill","white"],[1,"controls__button","controls__button--rotate",3,"click"],["filter","url(#filter0_d_0_4)"],["d","M-4.81762e-07 34.7678V57.0215C-4.81762e-07 60.8696 3.13284 64 6.98275 64H57.016C60.8672 64 64 60.8696 64 57.0215V7.05508C64 3.20697 60.8672 0.0757321 57.016 0.0757321H34.6959C35.8972 1.3077 36.6961 2.93443 36.871 4.74067H57.0168C58.2942 4.74067 59.3335 5.77899 59.3335 7.05508V57.0216C59.3335 58.2969 58.2942 59.3352 57.0168 59.3352H6.98342C5.7062 59.3352 4.66761 58.2969 4.66761 57.0216V36.9389C2.90982 36.7703 1.27948 36.0149 -4.81762e-07 34.7678ZM10.7807 30.6654H26.0384L1.34093 5.97437C-0.02533 4.60686 -0.02533 2.39174 1.34093 1.02583C2.70813 -0.341677 4.92462 -0.341677 6.29089 1.02423L30.9883 25.7159V10.4614C30.9883 8.52907 32.5556 6.96139 34.4888 6.96139C35.4553 6.96139 36.3305 7.35214 36.9642 7.98612C37.5976 8.62116 37.9897 9.49543 37.9897 10.4613V34.1643C37.9897 36.0966 36.4228 37.6635 34.4896 37.6635H10.7807C8.84705 37.6635 7.28056 36.0974 7.28056 34.1643C7.28056 32.2312 8.84705 30.6654 10.7807 30.6654Z","fill","white"],["id","filter0_d_0_4","x","-4","y","0","width","72","height","72","filterUnits","userSpaceOnUse","color-interpolation-filters","sRGB"],["flood-opacity","0","result","BackgroundImageFix"],["in","SourceAlpha","type","matrix","values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0","result","hardAlpha"],["dy","4"],["stdDeviation","2"],["in2","hardAlpha","operator","out"],["type","matrix","values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"],["mode","normal","in2","BackgroundImageFix","result","effect1_dropShadow_0_4"],["mode","normal","in","SourceGraphic","in2","effect1_dropShadow_0_4","result","shape"]],template:function(o,c){1&o&&(Pe(0,"div",0)(1,"div",1)(2,"button",2),en("click",function(){return c.onToggleCamera()}),Pe(3,"div",3),Go(),Pe(4,"svg",4)(5,"g",5)(6,"g",6)(7,"g",7),wt(8,"path",8),Re()()(),Pe(9,"g",9)(10,"g",6)(11,"g",7),wt(12,"path",10),Re()(),Pe(13,"g",11)(14,"g",12),wt(15,"path",13),Re()()()()(),rc(),Pe(16,"p"),Dr(17,"Camera"),Re()()(),Pe(18,"div",1)(19,"button",2),en("click",function(){return c.onToggleMicrophone()}),Pe(20,"div",3),Go(),Pe(21,"svg",4)(22,"g",14)(23,"g",15),wt(24,"path",16)(25,"path",17),Re()(),Pe(26,"g",18),wt(27,"path",19),Re()()(),rc(),Pe(28,"p"),Dr(29,"Mic"),Re()()(),Fe(30,nY,22,7,"div",20),Fe(31,iY,18,2,"div",20),Pe(32,"div",1)(33,"button",21),en("click",function(){return c.onEndCall()}),Pe(34,"div",3),Go(),Pe(35,"svg",4)(36,"g",22)(37,"g",6),wt(38,"path",23)(39,"path",24)(40,"path",25),Re()()()(),rc(),Pe(41,"p"),Dr(42,"End"),Re()()()()),2&o&&(Vt("controls--small",c.smallScreenEnabled),Je(2),Vt("controls__button--active",c.cameraEnabled),Je(3),Vt("controls__icon--shown",c.cameraEnabled),Je(4),Vt("controls__icon--shown",!c.cameraEnabled),Je(10),Vt("controls__button--active",c.microphoneEnabled),Je(3),Vt("controls__icon--shown",c.microphoneEnabled),Je(4),Vt("controls__icon--shown",!c.microphoneEnabled),Je(4),Qe("ngIf",!c.smallScreenEnabled),Je(1),Qe("ngIf",c.displaySmallScreen))},dependencies:[qd],styles:["[_nghost-%COMP%]{transition:.3s}.controls[_ngcontent-%COMP%]{background:rgba(0,0,0,.3);bottom:0;display:flex;justify-content:center;padding:15px 0;position:absolute;left:0;width:100%}.controls--small[_ngcontent-%COMP%]{border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding:5px 0}.controls--small[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{height:32px;width:32px}.controls--small[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:16px;width:16px}.controls--small[_ngcontent-%COMP%]   .controls__item[_ngcontent-%COMP%]{margin:0}.controls--small[_ngcontent-%COMP%]   .controls__button[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:none}.controls__item[_ngcontent-%COMP%]{margin:0 5px;text-align:center}.controls__button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer}.controls__button[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#101316}.controls__button--active[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#0b73c9}.controls__button--active[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#158ef2}.controls__button--active.controls__button--rotate[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{transform:translate(-50%,-50%) rotate(-180deg)}.controls__button--danger[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#d73b3d}.controls__button--danger[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#e06567}.controls__button[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;margin:8px 0 0}.controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#313a42;border-radius:50%;box-shadow:0 3px 8px #00000080;margin:auto;position:relative;height:60px;width:60px;transition:.3s}.controls__icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%) rotate(0);height:32px;width:32px;transition:.3s}.controls__icon[_ngcontent-%COMP%]{opacity:0;transition:.3s}.controls__icon--shown[_ngcontent-%COMP%]{opacity:1}"],changeDetection:0})}return e})();function ZU(e,n){return op((t,o)=>{let c=0;t.subscribe(ru(o,u=>{o.next(e.call(n,u,c++))}))})}let oY=(()=>{class e{constructor(){this.started=Date.now()}ngOnInit(){this.time$=JU(0,1e3).pipe(ZU(()=>this.format(Date.now()-this.started)))}format(t){const o=Math.floor(t/1e3%60).toString().padStart(2,"0"),c=Math.floor(t/6e4%60).toString().padStart(2,"0");return[Math.floor(t/36e5%24).toString().padStart(2,"0"),c,o].join(":")}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275cmp=Ct({type:e,selectors:[["ngx-timer"]],inputs:{started:"started"},decls:4,vars:3,consts:[[1,"timer"]],template:function(o,c){1&o&&(Pe(0,"div",0)(1,"span"),Dr(2),bE(3,"async"),Re()()),2&o&&(Je(2),hc(fc(3,1,c.time$)))},dependencies:[Jr],styles:[".timer[_ngcontent-%COMP%]{color:#fff;position:relative;text-align:center;z-index:1}.timer[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:rgba(0,0,0,.3);border-radius:5px;padding:5px 10px}"],changeDetection:0})}return e})();function sY(e,n){if(1&e&&(Pe(0,"div",8),Dr(1),Re()),2&e){const t=tn();Je(1),hc(t.text)}}const aY=function(e,n,t,o){return{"spinner--connected":e,"spinner--ended":n,"spinner--small":t,"spinner--error":o}};let cY=(()=>{class e{constructor(){this.error=!1,this.connected=!0,this.ended=!1,this.small=!1}get color(){return this.ended?"#aaa":this.error?"#d73b3d":this.connected?"#37D425":"#1195E6"}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275cmp=Ct({type:e,selectors:[["ngx-spinner"]],inputs:{text:"text",error:"error",connected:"connected",ended:"ended",small:"small"},decls:8,vars:9,consts:[[1,"spinner",3,"ngClass"],[1,"spinner__wrapper"],[1,"spinner__icon"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 32 32","fill","none"],["d","M5.25 5.5C3.45507 5.5 2 6.95508 2 8.75V19.25C2 21.0449 3.45507 22.5 5.25 22.5H14.75C16.5449 22.5 18 21.0449 18 19.25V8.75C18 6.95507 16.5449 5.5 14.75 5.5H5.25Z"],["d","M23.1232 20.6431L19.5 17.0935V10.9989L23.1121 7.3706C23.8988 6.58044 25.248 7.13753 25.248 8.25251V19.7502C25.248 20.8577 23.9143 21.4181 23.1232 20.6431Z"],[1,"spinner__cirle"],["class","spinner__text",4,"ngIf"],[1,"spinner__text"]],template:function(o,c){1&o&&(Pe(0,"div",0)(1,"div",1)(2,"div",2),Go(),Pe(3,"svg",3),wt(4,"path",4)(5,"path",5),Re()(),rc(),wt(6,"div",6),Fe(7,sY,2,1,"div",7),Re()()),2&o&&(Qe("ngClass",pC(4,aY,c.connected,c.ended,c.small,c.error)),Je(4),ii("fill",c.color),Je(1),ii("fill",c.color),Je(2),Qe("ngIf",!c.small))},dependencies:[_v,qd],styles:[".spinner[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;position:relative;transition:.3s}.spinner--connected[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:#37d425}.spinner--ended[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:transparent}.spinner--error[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:#d73b3d}.spinner--small[_ngcontent-%COMP%]{border-radius:10px;height:200px}.spinner--small[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-width:4px;height:80px;width:80px}.spinner--small[_ngcontent-%COMP%]   .spinner__icon[_ngcontent-%COMP%]{top:26px;transform:translate(-35%)}.spinner--small[_ngcontent-%COMP%]   .spinner__icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:32px;width:32px}.spinner__wrapper[_ngcontent-%COMP%]{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%)}.spinner__cirle[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 2s linear infinite;border:5px solid #1195E6;border-radius:50%;border-top-color:transparent;height:160px;margin:auto;width:160px;transition:.3s}.spinner__icon[_ngcontent-%COMP%]{left:50%;position:absolute;top:52px;transform:translate(-40%);transition:.3s}.spinner__icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:64px;width:64px;transition:.3s}.spinner__text[_ngcontent-%COMP%]{color:#fff;font-size:1.3em;margin-top:25px;text-align:center}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"],changeDetection:0})}return e})(),lY=(()=>{class e{onEnter(){this.subscription.unsubscribe(),this.setStyle(1)}onLeave(){this.hide()}constructor(t,o){this.renderer=t,this.el=o,this.subscription=new Ac,this.delay=5e3}ngOnInit(){this.hide()}hide(){this.subscription.unsubscribe(),this.subscription=QU(this.delay).pipe(Bl(1)).subscribe(()=>this.setStyle(0))}setStyle(t){this.renderer.setStyle(this.el.nativeElement,"opacity",t)}static#e=this.\u0275fac=function(o){return new(o||e)(re(Ca),re(bn))};static#t=this.\u0275dir=Ge({type:e,selectors:[["","ngxToggle",""]],hostBindings:function(o,c){1&o&&en("mouseenter",function(){return c.onEnter()})("mouseleave",function(){return c.onLeave()})}})}return e})();function dY(e,n){if(1&e&&wt(0,"ngx-spinner",15),2&e){const t=tn().ngIf,o=tn(2);Qe("error",t.error)("text",t.statusText)("connected",t.connected)("ended",t.ended)("small",o.smallScreenEnabled)}}function uY(e,n){1&e&&wt(0,"ngx-timer",16),2&e&&Qe("started",tn().ngIf.started)}function hY(e,n){if(1&e&&(wt(0,"div",17),bE(1,"async")),2&e){const t=n.$implicit;Vt("hidden",!1===fc(1,3,tn(3).remoteStreamVideoToggle$)),Qe("id",t)}}function pY(e,n){if(1&e){const t=hh();Go(),rc(),Pe(0,"ngx-controls",18),en("toggleCamera",function(c){return ga(t),dn(tn(3).onToggleCamera(c))})("toggleMicrophone",function(c){return ga(t),dn(tn(3).onToggleMicrophone(c))})("toggleFullScreen",function(c){return ga(t),dn(tn(3).onToggleFullScreen(c))})("toggleSmallScreen",function(c){return ga(t),dn(tn(3).onToggleSmallScreen(c))})("endCall",function(){return ga(t),dn(tn(3).onEndCall())}),Re()}if(2&e){const t=tn(3);Qe("cameraEnabled",t.cameraEnabled)("microphoneEnabled",t.microphoneEnabled)("fullScreenEnabled",t.fullScreenEnabled)("smallScreenEnabled",t.smallScreenEnabled)("displaySmallScreen",t.displaySmallScreen)}}function fY(e,n){if(1&e&&(Pe(0,"div",2),Fe(1,dY,1,5,"ngx-spinner",3),Fe(2,uY,1,1,"ngx-timer",4),wt(3,"div",5),Fe(4,hY,2,5,"div",6),Pe(5,"div",7),Go(),Pe(6,"svg",8)(7,"g",9),wt(8,"path",10)(9,"path",11),Re(),Pe(10,"defs")(11,"clipPath",12),wt(12,"rect",13),Re()()()(),Fe(13,pY,1,5,"ngx-controls",14),Re()),2&e){const t=n.ngIf,o=tn(2);Je(1),Qe("ngIf",t.loading),Je(1),Qe("ngIf",t.started),Je(1),Vt("hidden",!o.cameraEnabled||o.smallScreenEnabled),Qe("id",o.localContainerId),Je(1),Qe("ngForOf",o.remoteCalls),Je(9),Qe("ngIf",t.connected&&!t.ended)}}function mY(e,n){if(1&e&&(Pe(0,"div"),Fe(1,fY,14,7,"div",1),bE(2,"async"),Re()),2&e){const t=tn();Qe("@fade",void 0)("@.disabled",!t.animate),Je(1),Qe("ngIf",fc(2,3,t.streamState$))}}let v6=(()=>{class e extends f6{constructor(t,o){super(o),this.webRtcService=t,this.animate=!0,this.displaySmallScreen=!1,this.debug=!1,this.callEnd=new Zt,this.smallScreenEnabled=!1,this.active=!1,this.streamState$=this.webRtcService.streamState$,this.remoteStreamVideoToggle$=this.webRtcService.remoteStreamVideoToggle$}ngOnInit(){this.webRtcService.init(this.uid,this.channel,this.debug).pipe(Bl(1)).subscribe(()=>{this.active=this.smallScreenEnabled,this.callEnd.emit(),this.closeDialog(!0)})}ngOnDestroy(){this.webRtcService.deinit()}get localContainerId(){return this.webRtcService.localContainerId}get remoteCalls(){return this.webRtcService.remoteCalls}get cameraEnabled(){return this.webRtcService.isVideoEnabled()}get microphoneEnabled(){return this.webRtcService.isAudioEnabled()}get fullScreenEnabled(){return!!document.fullscreenElement}onToggleCamera(t){this.webRtcService.toggleVideo(t)}onToggleMicrophone(t){this.webRtcService.toggleAudio(t)}onToggleFullScreen(t){this.webRtcService.toggleFullScreen(t)}onToggleSmallScreen(t){this.smallScreenEnabled=!t,this.active=!0}onEndCall(){this.webRtcService.endCall()}static#e=this.\u0275fac=function(o){return new(o||e)(re(E6),re(rr))};static#t=this.\u0275cmp=Ct({type:e,selectors:[["ngx-webrtc"]],hostVars:4,hostBindings:function(o,c){2&o&&Vt("small-screen",c.smallScreenEnabled)("active",c.active)},inputs:{uid:"uid",channel:"channel",animate:"animate",displaySmallScreen:"displaySmallScreen",debug:"debug"},outputs:{callEnd:"callEnd"},features:[Ne],decls:1,vars:1,consts:[[4,"ngIf"],["class","container",4,"ngIf"],[1,"container"],[3,"error","text","connected","ended","small",4,"ngIf"],[3,"started",4,"ngIf"],[1,"container__local",3,"id"],["class","container__remote",3,"id","hidden",4,"ngFor","ngForOf"],[1,"container__user-icon"],["viewBox","0 0 64 64","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","user","clip-path","url(#clip0)"],["id","Vector","d","M31.5439 30.829C35.7793 30.829 39.4468 29.3099 42.4434 26.3129C45.4399 23.3163 46.959 19.6498 46.959 15.414C46.959 11.1796 45.4399 7.51267 42.4429 4.51512C39.4458 1.51904 35.7788 0 31.5439 0C27.3081 0 23.6416 1.51904 20.645 4.51561C17.6484 7.51218 16.1289 11.1792 16.1289 15.414C16.1289 19.6498 17.6484 23.3168 20.6455 26.3134C23.6426 29.3095 27.3096 30.829 31.5439 30.829V30.829Z","fill","#0B73C9"],["id","Vector_2","d","M58.5161 49.2127C58.4297 47.9656 58.2549 46.6053 57.9976 45.1688C57.7378 43.7215 57.4033 42.3533 57.0029 41.1029C56.5894 39.8104 56.0269 38.534 55.3315 37.3109C54.6099 36.0414 53.7622 34.9359 52.811 34.0262C51.8164 33.0746 50.5986 32.3094 49.1904 31.7513C47.7871 31.1962 46.2319 30.9149 44.5684 30.9149C43.915 30.9149 43.2832 31.183 42.063 31.9774C41.312 32.4672 40.4336 33.0336 39.4531 33.66C38.6147 34.1942 37.479 34.6947 36.0762 35.1478C34.7075 35.5907 33.3179 35.8153 31.9463 35.8153C30.5747 35.8153 29.1855 35.5907 27.8154 35.1478C26.4141 34.6952 25.2783 34.1947 24.4409 33.6605C23.4697 33.0399 22.5908 32.4735 21.8286 31.9769C20.6099 31.1825 19.9775 30.9144 19.3242 30.9144C17.6602 30.9144 16.1055 31.1962 14.7026 31.7518C13.2954 32.309 12.0771 33.0741 11.0815 34.0267C10.1309 34.9369 9.28271 36.0419 8.56201 37.3109C7.86719 38.534 7.30469 39.8099 6.89062 41.1034C6.49072 42.3538 6.15625 43.7215 5.89648 45.1688C5.63916 46.6033 5.46436 47.9642 5.37793 49.2142C5.29297 50.4388 5.25 51.7098 5.25 52.9934C5.25 56.3343 6.31201 59.0388 8.40625 61.0335C10.4746 63.0017 13.2114 64.0002 16.5396 64.0002H47.356C50.6841 64.0002 53.4199 63.0022 55.4888 61.0335C57.5835 59.0403 58.6455 56.3352 58.6455 52.993C58.645 51.7034 58.6016 50.4314 58.5161 49.2127V49.2127Z","fill","#0B73C9"],["id","clip0"],["width","64","height","64","fill","#0B73C9"],["ngxToggle","",3,"cameraEnabled","microphoneEnabled","fullScreenEnabled","smallScreenEnabled","displaySmallScreen","toggleCamera","toggleMicrophone","toggleFullScreen","toggleSmallScreen","endCall",4,"ngIf"],[3,"error","text","connected","ended","small"],[3,"started"],[1,"container__remote",3,"id"],["ngxToggle","",3,"cameraEnabled","microphoneEnabled","fullScreenEnabled","smallScreenEnabled","displaySmallScreen","toggleCamera","toggleMicrophone","toggleFullScreen","toggleSmallScreen","endCall"]],template:function(o,c){1&o&&Fe(0,mY,3,5,"div",0),2&o&&Qe("ngIf",c.shown)},dependencies:[gN,qd,rY,oY,cY,lY,Jr],styles:["ngx-timer[_ngcontent-%COMP%]{display:block;padding-top:25px}[_nghost-%COMP%]{bottom:0;max-width:100%;right:0;width:100%;transition:.3s}.active[_nghost-%COMP%]{position:fixed}.small-screen[_nghost-%COMP%]{max-width:210px}.small-screen[_nghost-%COMP%]   ngx-timer[_ngcontent-%COMP%]{padding-top:10px}.small-screen[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{border-radius:10px;box-shadow:#00000059 0 5px 15px;height:200px;max-width:200px;margin-right:10px;margin-bottom:10px}.small-screen[_nghost-%COMP%]   .container__remote[_ngcontent-%COMP%]{border-radius:10px;height:200px;width:200px}.small-screen[_nghost-%COMP%]   .container__remote[_ngcontent-%COMP%]    >div{border-radius:10px}.small-screen[_nghost-%COMP%]   .container__user-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:32px;width:32px}.container[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;max-width:100%;margin-left:auto;overflow:hidden;position:relative;transition:.3s}.container__local[_ngcontent-%COMP%]{border-radius:5px;height:20vh;opacity:1;overflow:hidden;position:absolute;right:1rem;top:1rem;width:20vw;z-index:1;transition:.3s}.container__local.hidden[_ngcontent-%COMP%]{opacity:0;visibility:hidden}.container__local[_ngcontent-%COMP%]:not(:empty){box-shadow:0 3px 8px #00000080}.container__remote[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;left:0;position:absolute;top:0;width:100vw;transition:.3s}.container__remote[_ngcontent-%COMP%]    >div{transition:.3s}.container__remote.hidden[_ngcontent-%COMP%]{display:none}.container__remote.hidden[_ngcontent-%COMP%] + .container__user-icon[_ngcontent-%COMP%]{display:block}.container__remote[_ngcontent-%COMP%]:empty{display:none}.container__user-icon[_ngcontent-%COMP%]{background:rgba(0,0,0,.3);border-radius:50%;box-shadow:0 3px 8px #00000080;display:none;left:50%;padding:20px;position:absolute;top:50%;transform:translate(-50%,-50%)}.container__user-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:64px;width:64px}@media screen and (max-width: 769px){ngx-controls[_ngcontent-%COMP%]{opacity:1!important}}"],data:{animation:[p6]},changeDetection:0})}return e})();function _Y(e,n){if(1&e&&(bf(0),Dr(1),Sf()),2&e){const t=tn(2);Je(1),If(" Calling to ",t.data.user.name," ")}}function gY(e,n){1&e&&Dr(0),2&e&&If(" ",tn(2).data.user.name," is calling ")}function EY(e,n){if(1&e){const t=hh();bf(0),Pe(1,"button",11),en("click",function(){return ga(t),dn(tn(2).onAcceptCall())}),Re(),Sf()}}function vY(e,n){if(1&e){const t=hh();Pe(0,"div",1)(1,"div",2)(2,"div",3),wt(3,"img",4),Re(),Pe(4,"p",5),Fe(5,_Y,2,1,"ng-container",6),Fe(6,gY,1,1,"ng-template",null,7,Bf),Re()(),Pe(8,"div",8),Fe(9,EY,2,0,"ng-container",9),Pe(10,"span")(11,"button",10),en("click",function(){return ga(t),dn(tn().onDeclineCall())}),Re()()()()}if(2&e){const t=pd(7),o=tn();Vt("video-call--full-screen",o.fullScreen),Qe("@fade",void 0),Je(3),Qe("src",o.data.user.photoURL,ug),Je(2),Qe("ngIf",o.data.outcome)("ngIfElse",t),Je(4),Qe("ngIf",!o.data.outcome)}}let yY=(()=>{class e extends f6{constructor(t){super(t),this.fullScreen=!1}ngOnInit(){this.play(`assets/${this.data.outcome?"outcome":"income"}.mp3`)}ngOnDestroy(){this.stop()}onAcceptCall(){this.fullScreen=!0,this.cdr.markForCheck(),this.afterClosed.next(this.data)}onDeclineCall(){this.play("assets/cancel.mp3"),setTimeout(()=>this.closeDialog(null),200)}play(t,o=!0){this.audio&&this.stop(),this.audio=new Audio(t),this.audio.loop=o,this.audio.load(),this.audio.play()}stop(){this.audio.pause(),this.audio.remove()}static#e=this.\u0275fac=function(o){return new(o||e)(re(rr))};static#t=this.\u0275cmp=Ct({type:e,selectors:[["ngx-video-call"]],inputs:{data:"data"},features:[Ne],decls:1,vars:1,consts:[["class","video-call",3,"video-call--full-screen",4,"ngIf"],[1,"video-call"],[1,"video-call-user"],[1,"video-call-user__block","video-call-user__block--animated"],["alt","",1,"video-call-user__img",3,"src"],[1,"video-call-user__title"],[4,"ngIf","ngIfElse"],["income",""],[1,"video-call__actions"],[4,"ngIf"],["aria-label","Decline",1,"video-call__button","video-call__button--decline",3,"click"],["aria-label","Accept",1,"video-call__button","video-call__button--accept",3,"click"]],template:function(o,c){1&o&&Fe(0,vY,12,7,"div",0),2&o&&Qe("ngIf",c.shown&&c.data)},dependencies:[qd],styles:['[_nghost-%COMP%]{display:block;height:100vh;position:relative}.video-call[_ngcontent-%COMP%]{background-image:linear-gradient(#3F51B5,#313A42);background-size:cover;border-radius:10px;box-shadow:0 5px 10px #0000001a;display:flex;flex-direction:column;height:100%;justify-content:flex-end;left:50%;max-height:400px;max-width:400px;position:absolute;top:50%;transform:translate(-50%,-50%);width:100%;z-index:5;transition:.3s}.video-call--full-screen[_ngcontent-%COMP%]{background-image:linear-gradient(#22292F);border-radius:0;max-height:100%;max-width:100%}.video-call-user[_ngcontent-%COMP%]{left:50%;position:absolute;text-align:center;top:50%;transform:translate(-50%,-55%);z-index:1}.video-call-user__block[_ngcontent-%COMP%]{background:#fff;border-radius:50%;border:solid 5px #fff;height:180px;margin:0 auto;transform:scale(1);width:180px}.video-call-user__block--animated[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_play 2s ease infinite;backface-visibility:hidden}.video-call-user__img[_ngcontent-%COMP%]{border-radius:50%;height:100%;left:0;object-fit:cover;position:absolute;top:0;width:100%}.video-call-user__title[_ngcontent-%COMP%]{color:#fff;font-size:1.2em;font-weight:700;margin:15px 0 0}.video-call__actions[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:10px 0}.video-call__button[_ngcontent-%COMP%]{border-radius:50%;box-shadow:0 0 #3f51b500,0 .05em .1em #0003;border:0;cursor:pointer;display:block;font-size:40px;height:1em;margin:0 5px;position:relative;transform:translateZ(0) scale(1);width:1em;transition:.3s}.video-call__button[_ngcontent-%COMP%]:before, .video-call__button[_ngcontent-%COMP%]:after{content:"";position:absolute}.video-call__button[_ngcontent-%COMP%]:before{background-color:#ffffff1a;border-radius:50%;height:1em;left:0;opacity:1;top:0;transform:translateZ(0) scale(0);width:1em}.video-call__button[_ngcontent-%COMP%]:after{background-position:50% 50%;background-repeat:no-repeat;background-size:cover;background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTYuNiAxMC44YzEuNCAyLjggMy44IDUuMSA2LjYgNi42bDIuMi0yLjJjLjMtLjMuNy0uNCAxLS4yIDEuMS40IDIuMy42IDMuNi42LjUgMCAxIC40IDEgMVYyMGMwIC41LS41IDEtMSAxLTkuNCAwLTE3LTcuNi0xNy0xNyAwLS42LjQtMSAxLTFoMy41Yy41IDAgMSAuNCAxIDEgMCAxLjIuMiAyLjUuNiAzLjYuMS40IDAgLjctLjIgMWwtMi4zIDIuMnoiIGZpbGw9IiNmZmZmZmYiLz48L3N2Zz4=);height:.5em;left:.25em;top:.25em;transform:translateZ(0);width:.5em;transition:.3s}.video-call__button--accept[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_phone-outer 3s infinite;background-color:#3f51b5}.video-call__button--accept[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_phone-inner 3s infinite}.video-call__button--accept[_ngcontent-%COMP%]:after{animation:_ngcontent-%COMP%_phone-icon 3s infinite}.video-call__button--decline[_ngcontent-%COMP%]{background-color:#d73b3d}.video-call__button--decline[_ngcontent-%COMP%]:hover{background-color:#ce2a2c}.video-call__button--decline[_ngcontent-%COMP%]:after{top:.28em;transform:translateZ(0) rotate(135deg)}@keyframes _ngcontent-%COMP%_play{0%{transform:scale(1)}15%{box-shadow:0 0 0 5px #9b9da466}25%{box-shadow:0 0 0 10px #9b9da466,0 0 0 20px #9b9da433}25%{box-shadow:0 0 0 15px #9b9da466,0 0 0 30px #9b9da433}}@keyframes _ngcontent-%COMP%_phone-outer{0%{box-shadow:0 0 #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}33.3333%{box-shadow:0 0 #3f51b51a,0 .05em .1em #00000080;transform:translateZ(0) scale(1.1)}66.6666%{box-shadow:0 0 0 .5em #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}to{box-shadow:0 0 #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}}@keyframes _ngcontent-%COMP%_phone-inner{0%{opacity:1;transform:translateZ(0) scale(0)}33.3333%{opacity:1;transform:translateZ(0) scale(.9)}66.6666%{opacity:0;transform:translateZ(0) scale(0)}to{opacity:0;transform:translateZ(0) scale(0)}}@keyframes _ngcontent-%COMP%_phone-icon{0%{transform:translateZ(0)}2%{transform:translate3d(.01em,0,0)}4%{transform:translate3d(-.01em,0,0)}6%{transform:translate3d(.01em,0,0)}8%{transform:translate3d(-.01em,0,0)}10%{transform:translate3d(.01em,0,0)}12%{transform:translate3d(-.01em,0,0)}14%{transform:translate3d(.01em,0,0)}16%{transform:translate3d(-.01em,0,0)}18%{transform:translate3d(.01em,0,0)}20%{transform:translate3d(-.01em,0,0)}22%{transform:translate3d(.01em,0,0)}24%{transform:translate3d(-.01em,0,0)}26%{transform:translate3d(.01em,0,0)}28%{transform:translate3d(-.01em,0,0)}30%{transform:translate3d(.01em,0,0)}32%{transform:translate3d(-.01em,0,0)}34%{transform:translate3d(.01em,0,0)}36%{transform:translate3d(-.01em,0,0)}38%{transform:translate3d(.01em,0,0)}40%{transform:translate3d(-.01em,0,0)}42%{transform:translate3d(.01em,0,0)}44%{transform:translate3d(-.01em,0,0)}46%{transform:translateZ(0)}}'],data:{animation:[p6]},changeDetection:0})}return e})();function eV(e,n,t=1/0){return cr(n)?eV((o,c)=>ZU((u,f)=>n(o,u,c,f))(Om(e(o,c))),t):("number"==typeof n&&(t=n),op((o,c)=>function bY(e,n,t,o,c,u,f,_){const v=[];let S=0,R=0,k=!1;const U=()=>{k&&!v.length&&!S&&n.complete()},G=X=>S<o?z(X):v.push(X),z=X=>{u&&n.next(X),S++;let le=!1;Om(t(X,R++)).subscribe(ru(n,pe=>{c?.(pe),u?G(pe):n.next(pe)},()=>{le=!0},void 0,()=>{if(le)try{for(S--;v.length&&S<o;){const pe=v.shift();f?rp(n,f,()=>z(pe)):z(pe)}U()}catch(pe){n.error(pe)}}))};return e.subscribe(ru(n,G,()=>{k=!0,U()})),()=>{_?.()}}(o,c,e,t)))}function y6(e,n){return n?t=>function TY(...e){return function CY(){return function SY(e=1/0){return eV(WU,e)}(1)}()(u6(e,K5(e)))}(n.pipe(Bl(1),function wY(){return op((e,n)=>{e.subscribe(ru(n,FU))})}()),t.pipe(y6(e))):eV((t,o)=>Om(e(t,o)).pipe(Bl(1),function IY(e){return ZU(()=>e)}(t)))}let AY=(()=>{class e{constructor(t,o,c,u){this.document=t,this.componentFactoryResolver=o,this.appRef=c,this.injector=u,this.wrapperSelector="ngx-webrtc-wrapper"}open(t,o={}){return this.appendComponent(t,o)}appendComponent(t,o){const c=this.componentFactoryResolver.resolveComponentFactory(t).create(this.injector),{instance:u}=c;Object.keys(o).forEach(_=>u[_]=o[_]),this.appRef.attachView(c.hostView);const f=c.hostView.rootNodes[0];return this.getContainer().append(f),u.afterClosed.pipe(Bl(1),function RY(e,n=XU){const t=JU(e,n);return y6(()=>t)}(250)).subscribe(()=>{this.appRef.detachView(c.hostView),c.destroy()}),u}getContainer(){let t=this.document.querySelector(`.${this.wrapperSelector}`);return t||(t=this.document.createElement("div"),t.setAttribute("class",this.wrapperSelector),t.setAttribute("style","position: fixed; top: 0; width: 100%; z-index: 1;"),this.document.body.appendChild(t)),t}static#e=this.\u0275fac=function(o){return new(o||e)(fe(Kt),fe(Ju),fe(ea),fe(tr))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),DY=(()=>{class e{constructor(t){this.dialog=t}open(t){const o=new VT,c=this.dialog.open(yY,{data:t});return c.afterClosed.asObservable().pipe(function zK(e,n){return op((t,o)=>{let c=null,u=0,f=!1;const _=()=>f&&!c&&o.complete();t.subscribe(ru(o,v=>{c?.unsubscribe();let S=0;const R=u++;Om(e(v,R)).subscribe(c=ru(o,k=>o.next(n?n(v,k,R,S++):k),()=>{c=null,_()}))},()=>{f=!0,_()}))})}(u=>u?.channel?this.dialog.open(v6,{uid:u.uid,channel:u.channel,debug:!!u.debug,displaySmallScreen:!0}).afterClosed.asObservable():function WK(...e){return u6(e,K5(e))}(!1)),Bl(1),function KK(e,n,t){const o=cr(e)||n||t?{next:e,error:n,complete:t}:e;return o?op((c,u)=>{var f;null===(f=o.subscribe)||void 0===f||f.call(o);let _=!0;c.subscribe(ru(u,v=>{var S;null===(S=o.next)||void 0===S||S.call(o,v),u.next(v)},()=>{var v;_=!1,null===(v=o.complete)||void 0===v||v.call(o),u.complete()},v=>{var S;_=!1,null===(S=o.error)||void 0===S||S.call(o,v),u.error(v)},()=>{var v,S;_&&(null===(v=o.unsubscribe)||void 0===v||v.call(o)),null===(S=o.finalize)||void 0===S||S.call(o)}))}):WU}(()=>o.next(!0))).subscribe(),{acceptCall:c.onAcceptCall.bind(c),close:c.closeDialog.bind(c),afterConfirmation:()=>c.afterClosed.asObservable().pipe(Bl(1)),afterCallEnd:()=>o.asObservable().pipe(Bl(1))}}static#e=this.\u0275fac=function(o){return new(o||e)(fe(AY))};static#t=this.\u0275prov=xe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),OY=(()=>{class e{constructor(t,o,c,u,f){this.formBuilder=t,this.router=o,this.localStorage=c,this.videoCallDialogService=u,this.cdr=f,this.sessionKey="ngx-webrtc:channelId",this.outcome=!1}get channelId(){return this.localStorage.getItem(this.sessionKey)||"test-channel-ngx-webrtc"}get tooltipText(){return this.outcome?"Outcome":"Income"}ngOnInit(){this.form=this.formBuilder.group({channelId:[this.channelId,Jd.required]})}onSubmit(){this.saveChannel(),this.router.navigate(["conference"],{queryParams:{...this.form.value}})}onModalOpen(){this.saveChannel(),this.dialog=this.videoCallDialogService.open({uid:String(Math.floor(100*Math.random())),channel:this.channelId,outcome:this.outcome,user:{name:"Test User",photoURL:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTvDtoEwuV9E2kHqNDi6MnBzXlefn8TfyrwgQ&usqp=CAU"},debug:!0});const t=setTimeout(()=>this.dialog?.close(),7e3);this.dialog.afterConfirmation().pipe(ra(o=>!!o),io(()=>clearTimeout(t))).subscribe(),this.dialog.afterCallEnd().subscribe(()=>{clearTimeout(t),this.dialog=null,this.cdr.markForCheck()})}saveChannel(){const{channelId:t}=this.form.value;this.localStorage.setItem(this.sessionKey,t)}static#e=this.\u0275fac=function(o){return new(o||e)(re(p8),re(Ps),re(Storage),re(DY),re(rr))};static#t=this.\u0275cmp=Ct({type:e,selectors:[["app-home"]],decls:25,vars:8,consts:[[1,"home"],[1,"home__welcome"],[1,"home__form",3,"formGroup","ngSubmit"],[1,"home__wrapper","home__wrapper--center"],["src","assets/user.svg","alt","User",1,"user"],[1,"home__title"],["appearance","outline",1,"home__wrapper"],["matInput","","placeholder","Channel id","formControlName","channelId"],[1,"home__wrapper","home__wrapper--center","home__wrapper--buttons"],["mat-flat-button","","color","primary",1,"home__btn",3,"disabled"],["mat-raised-button","","type","button",1,"home__btn",3,"disabled","click"],[3,"checked","disabled","matTooltip","change","click"],[1,"home__footer"],["href","https://www.npmjs.com/package/ngx-webrtc-lib","target","_blank"],["viewBox","0 0 27.23 27.23"],["width","27.23","height","27.23","rx","2"],["fill","#fff","points","5.8 21.75 13.66 21.75 13.67 9.98 17.59 9.98 17.58 21.76 21.51 21.76 21.52 6.06 5.82 6.04 5.8 21.75"],["href","https://github.com/TarasMoskovych/ngx-webrtc","target","_blank"],["aria-hidden","true","role","img","viewBox","0 0 16 16","width","50","height","50",1,""],["fill-rule","evenodd","d","M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"]],template:function(o,c){1&o&&(Pe(0,"div",0)(1,"div",1)(2,"form",2),en("ngSubmit",function(){return!c.dialog&&c.onSubmit()}),Pe(3,"div",3),wt(4,"img",4),Re(),Pe(5,"h1",5),Dr(6," Welcome "),Re(),Pe(7,"mat-form-field",6)(8,"mat-label"),Dr(9,"Channel Id"),Re(),wt(10,"input",7),Re(),Pe(11,"div",8)(12,"button",9),Dr(13,"Start / Join call"),Re(),Pe(14,"button",10),en("click",function(){return!c.dialog&&c.onModalOpen()}),Dr(15,"Open Call Dialog "),Pe(16,"mat-slide-toggle",11),en("change",function(f){return c.outcome=f.checked})("click",function(f){return f.stopPropagation()}),Re()()()(),Pe(17,"div",12)(18,"a",13),Go(),Pe(19,"svg",14),wt(20,"rect",15)(21,"polygon",16),Re()(),rc(),Pe(22,"a",17),Go(),Pe(23,"svg",18),wt(24,"path",19),Re()()()()()),2&o&&(Je(2),Qe("formGroup",c.form),Je(5),Vt("mat-focused",c.form.valid),Je(5),Qe("disabled",c.form.invalid||!!c.dialog),Je(2),Qe("disabled",c.form.invalid||!!c.dialog),Je(2),Qe("checked",c.outcome)("disabled",!!c.dialog)("matTooltip",c.tooltipText))},dependencies:[_B,sr,tB,nB,lT,pF,fG,lG,LF,vH,DW,Pj],styles:[".home[_ngcontent-%COMP%]{align-items:center;background-color:#f2f2f2;display:flex;flex-wrap:wrap;justify-content:center;min-height:100vh;width:100%}.home__welcome[_ngcontent-%COMP%]{background:#fff;border-radius:10px;box-shadow:0 5px 10px #0000001a;overflow:hidden;padding:10px 35px;width:390px}.home__welcome[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]{height:150px}.home__title[_ngcontent-%COMP%]{color:#333;display:block;font-size:30px;font-weight:500;margin:10px 0 60px;text-align:center}.home__wrapper[_ngcontent-%COMP%]{width:100%}.home__wrapper--center[_ngcontent-%COMP%]{text-align:center}.home__wrapper--buttons[_ngcontent-%COMP%]{align-items:center;display:flex}.home__btn[_ngcontent-%COMP%]{letter-spacing:normal}.home__btn[_ngcontent-%COMP%]:first-of-type{margin-right:5px}.home__btn[_ngcontent-%COMP%]:last-of-type{margin-left:5px}.home__footer[_ngcontent-%COMP%]{margin-top:30px;text-align:center}.home__footer[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{fill:#333;cursor:pointer;height:24px;margin:0 5px;width:24px;transition:.3s}.home__footer[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]:hover{fill:#aaa}"],changeDetection:0})}return e})(),NY=(()=>{class e{constructor(t,o){this.route=t,this.router=o,this.uid=String(Math.floor(100*Math.random()))}ngOnInit(){this.channel=this.route.snapshot.queryParams.channelId||"test-channel"}onCallEnd(){this.router.navigateByUrl("/")}static#e=this.\u0275fac=function(o){return new(o||e)(re(Rm),re(Ps))};static#t=this.\u0275cmp=Ct({type:e,selectors:[["app-conference"]],decls:1,vars:4,consts:[[3,"animate","channel","debug","uid","callEnd"]],template:function(o,c){1&o&&(Pe(0,"ngx-webrtc",0),en("callEnd",function(){return c.onCallEnd()}),Re()),2&o&&Qe("animate",!1)("channel",c.channel)("debug",!0)("uid",c.uid)},dependencies:[v6],changeDetection:0})}return e})(),PY=(()=>{class e{static forRoot(t){return{ngModule:e,providers:[E6,{provide:"AgoraConfig",useValue:t}]}}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({imports:[Wh]})}return e})();const xY=[{path:"",component:OY},{path:"conference",component:NY},{path:"**",redirectTo:""}];let MY=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e,bootstrap:[Xq]});static#n=this.\u0275inj=St({providers:[{provide:Storage,useValue:window.localStorage}],imports:[QN,Rz,PY.forRoot(F5_configs),f8,Gq.forRoot(xY),mG,bH,PW,IG]})}return e})();Nt().bootstrapModule(MY).catch(e=>console.error(e))},885:function(Oc,xm,ap){var M=ap(156).default;Oc.exports=function(){"use strict";let ua=!0,ha=!0;function kn(s,i,r){const a=s.match(i);return a&&a.length>=r&&parseInt(a[r],10)}function Mo(s,i,r){if(!s.RTCPeerConnection)return;const a=s.RTCPeerConnection.prototype,l=a.addEventListener;a.addEventListener=function(h,p){if(h!==i)return l.apply(this,arguments);const m=g=>{const E=r(g);E&&(p.handleEvent?p.handleEvent(E):p(E))};return this._eventMap=this._eventMap||{},this._eventMap[i]||(this._eventMap[i]=new Map),this._eventMap[i].set(p,m),l.apply(this,[h,m])};const d=a.removeEventListener;a.removeEventListener=function(h,p){if(h!==i||!this._eventMap||!this._eventMap[i])return d.apply(this,arguments);if(!this._eventMap[i].has(p))return d.apply(this,arguments);const m=this._eventMap[i].get(p);return this._eventMap[i].delete(p),0===this._eventMap[i].size&&delete this._eventMap[i],0===Object.keys(this._eventMap).length&&delete this._eventMap,d.apply(this,[h,m])},Object.defineProperty(a,"on"+i,{get(){return this["_on"+i]},set(h){this["_on"+i]&&(this.removeEventListener(i,this["_on"+i]),delete this["_on"+i]),h&&this.addEventListener(i,this["_on"+i]=h)},enumerable:!0,configurable:!0})}function Pc(s){return"boolean"!=typeof s?new Error("Argument type: "+typeof s+". Please use a boolean."):(ua=s,s?"adapter.js logging disabled":"adapter.js logging enabled")}function xc(s){return"boolean"!=typeof s?new Error("Argument type: "+typeof s+". Please use a boolean."):(ha=!s,"adapter.js deprecation warnings "+(s?"disabled":"enabled"))}function Ur(){if("object"==typeof window){if(ua)return;typeof console<"u"&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Mc(s,i){ha&&console.warn(s+" is deprecated, please use "+i+" instead.")}function zv(s){return"[object Object]"===Object.prototype.toString.call(s)}function Mm(s){return zv(s)?Object.keys(s).reduce(function(i,r){const a=zv(s[r]),l=a?Mm(s[r]):s[r],d=a&&!Object.keys(l).length;return void 0===l||d?i:Object.assign(i,{[r]:l})},{}):s}function qv(s,i,r){i&&!r.has(i.id)&&(r.set(i.id,i),Object.keys(i).forEach(a=>{a.endsWith("Id")?qv(s,s.get(i[a]),r):a.endsWith("Ids")&&i[a].forEach(l=>{qv(s,s.get(l),r)})}))}function GT(s,i,r){const a=r?"outbound-rtp":"inbound-rtp",l=new Map;if(null===i)return l;const d=[];return s.forEach(h=>{"track"===h.type&&h.trackIdentifier===i.id&&d.push(h)}),d.forEach(h=>{s.forEach(p=>{p.type===a&&p.trackId===h.id&&qv(s,p,l)})}),l}const WT=Ur;function km(s,i){const r=s&&s.navigator;if(!r.mediaDevices)return;const a=function(h){if("object"!=typeof h||h.mandatory||h.optional)return h;const p={};return Object.keys(h).forEach(m=>{if("require"===m||"advanced"===m||"mediaSource"===m)return;const g="object"==typeof h[m]?h[m]:{ideal:h[m]};void 0!==g.exact&&"number"==typeof g.exact&&(g.min=g.max=g.exact);const E=function(y,b){return y?y+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==g.ideal){p.optional=p.optional||[];let y={};"number"==typeof g.ideal?(y[E("min",m)]=g.ideal,p.optional.push(y),y={},y[E("max",m)]=g.ideal,p.optional.push(y)):(y[E("",m)]=g.ideal,p.optional.push(y))}void 0!==g.exact&&"number"!=typeof g.exact?(p.mandatory=p.mandatory||{},p.mandatory[E("",m)]=g.exact):["min","max"].forEach(y=>{void 0!==g[y]&&(p.mandatory=p.mandatory||{},p.mandatory[E(y,m)]=g[y])})}),h.advanced&&(p.optional=(p.optional||[]).concat(h.advanced)),p},l=function(h,p){if(i.version>=61)return p(h);if((h=JSON.parse(JSON.stringify(h)))&&"object"==typeof h.audio){const m=function(g,E,y){E in g&&!(y in g)&&(g[y]=g[E],delete g[E])};m((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),m(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=a(h.audio)}if(h&&"object"==typeof h.video){let m=h.video.facingMode;m=m&&("object"==typeof m?m:{ideal:m});const g=i.version<66;if(m&&("user"===m.exact||"environment"===m.exact||"user"===m.ideal||"environment"===m.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||g)){let E;if(delete h.video.facingMode,"environment"===m.exact||"environment"===m.ideal?E=["back","rear"]:"user"!==m.exact&&"user"!==m.ideal||(E=["front"]),E)return r.mediaDevices.enumerateDevices().then(y=>{let b=(y=y.filter(T=>"videoinput"===T.kind)).find(T=>E.some(O=>T.label.toLowerCase().includes(O)));return!b&&y.length&&E.includes("back")&&(b=y[y.length-1]),b&&(h.video.deviceId=m.exact?{exact:b.deviceId}:{ideal:b.deviceId}),h.video=a(h.video),WT("chrome: "+JSON.stringify(h)),p(h)})}h.video=a(h.video)}return WT("chrome: "+JSON.stringify(h)),p(h)},d=function(h){return i.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=function(h,p,m){l(h,g=>{r.webkitGetUserMedia(g,p,E=>{m&&m(d(E))})})}.bind(r),r.mediaDevices.getUserMedia){const h=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(p){return l(p,m=>h(m).then(g=>{if(m.audio&&!g.getAudioTracks().length||m.video&&!g.getVideoTracks().length)throw g.getTracks().forEach(E=>{E.stop()}),new DOMException("","NotFoundError");return g},g=>Promise.reject(d(g))))}}}function kc(s){s.MediaStream=s.MediaStream||s.webkitMediaStream}function cp(s){if("object"==typeof s&&s.RTCPeerConnection&&!("ontrack"in s.RTCPeerConnection.prototype)){Object.defineProperty(s.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const i=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",a=>{let l;l=s.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.track.id):{track:a.track};const d=new Event("track");d.track=a.track,d.receiver=l,d.transceiver={receiver:l},d.streams=[r.stream],this.dispatchEvent(d)}),r.stream.getTracks().forEach(a=>{let l;l=s.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.id):{track:a};const d=new Event("track");d.track=a,d.receiver=l,d.transceiver={receiver:l},d.streams=[r.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),i.apply(this,arguments)}}else Mo(s,"track",i=>(i.transceiver||Object.defineProperty(i,"transceiver",{value:{receiver:i.receiver}}),i))}function zT(s){if("object"==typeof s&&s.RTCPeerConnection&&!("getSenders"in s.RTCPeerConnection.prototype)&&"createDTMFSender"in s.RTCPeerConnection.prototype){const i=function(l,d){return{track:d,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===d.kind?l.createDTMFSender(d):null),this._dtmf},_pc:l}};if(!s.RTCPeerConnection.prototype.getSenders){s.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const l=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(h,p){let m=l.apply(this,arguments);return m||(m=i(this,h),this._senders.push(m)),m};const d=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);const p=this._senders.indexOf(h);-1!==p&&this._senders.splice(p,1)}}const r=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(l){this._senders=this._senders||[],r.apply(this,[l]),l.getTracks().forEach(d=>{this._senders.push(i(this,d))})};const a=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(l){this._senders=this._senders||[],a.apply(this,[l]),l.getTracks().forEach(d=>{const h=this._senders.find(p=>p.track===d);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if("object"==typeof s&&s.RTCPeerConnection&&"getSenders"in s.RTCPeerConnection.prototype&&"createDTMFSender"in s.RTCPeerConnection.prototype&&s.RTCRtpSender&&!("dtmf"in s.RTCRtpSender.prototype)){const i=s.RTCPeerConnection.prototype.getSenders;s.RTCPeerConnection.prototype.getSenders=function(){const r=i.apply(this,[]);return r.forEach(a=>a._pc=this),r},Object.defineProperty(s.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}}function Lm(s){if(!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[r,a,l]=arguments;if(arguments.length>0&&"function"==typeof r)return i.apply(this,arguments);if(0===i.length&&(0===arguments.length||"function"!=typeof r))return i.apply(this,[]);const d=function(p){const m={};return p.result().forEach(g=>{const E={id:g.id,timestamp:g.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[g.type]||g.type};g.names().forEach(y=>{E[y]=g.stat(y)}),m[E.id]=E}),m},h=function(p){return new Map(Object.keys(p).map(m=>[m,p[m]]))};return arguments.length>=2?i.apply(this,[function(m){a(h(d(m)))},r]):new Promise((p,m)=>{i.apply(this,[function(g){p(h(d(g)))},m])}).then(a,l)}}function qT(s){if(!("object"==typeof s&&s.RTCPeerConnection&&s.RTCRtpSender&&s.RTCRtpReceiver))return;if(!("getStats"in s.RTCRtpSender.prototype)){const r=s.RTCPeerConnection.prototype.getSenders;r&&(s.RTCPeerConnection.prototype.getSenders=function(){const l=r.apply(this,[]);return l.forEach(d=>d._pc=this),l});const a=s.RTCPeerConnection.prototype.addTrack;a&&(s.RTCPeerConnection.prototype.addTrack=function(){const l=a.apply(this,arguments);return l._pc=this,l}),s.RTCRtpSender.prototype.getStats=function(){const l=this;return this._pc.getStats().then(d=>GT(d,l.track,!0))}}if(!("getStats"in s.RTCRtpReceiver.prototype)){const r=s.RTCPeerConnection.prototype.getReceivers;r&&(s.RTCPeerConnection.prototype.getReceivers=function(){const a=r.apply(this,[]);return a.forEach(l=>l._pc=this),a}),Mo(s,"track",a=>(a.receiver._pc=a.srcElement,a)),s.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(l=>GT(l,a.track,!1))}}if(!("getStats"in s.RTCRtpSender.prototype)||!("getStats"in s.RTCRtpReceiver.prototype))return;const i=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof s.MediaStreamTrack){const r=arguments[0];let a,l,d;return this.getSenders().forEach(h=>{h.track===r&&(a?d=!0:a=h)}),this.getReceivers().forEach(h=>(h.track===r&&(l?d=!0:l=h),h.track===r)),d||a&&l?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():l?l.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}function Fm(s){s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};const i=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return i.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const p=i.apply(this,arguments);return this._shimmedLocalStreams[h.id]?-1===this._shimmedLocalStreams[h.id].indexOf(p)&&this._shimmedLocalStreams[h.id].push(p):this._shimmedLocalStreams[h.id]=[h,p],p};const r=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(m=>{if(this.getSenders().find(g=>g.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();r.apply(this,arguments);const p=this.getSenders().filter(m=>-1===h.indexOf(m));this._shimmedLocalStreams[d.id]=[d].concat(p)};const a=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],a.apply(this,arguments)};const l=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const p=this._shimmedLocalStreams[h].indexOf(d);-1!==p&&this._shimmedLocalStreams[h].splice(p,1),1===this._shimmedLocalStreams[h].length&&delete this._shimmedLocalStreams[h]}),l.apply(this,arguments)}}function KT(s,i){if(!s.RTCPeerConnection)return;if(s.RTCPeerConnection.prototype.addTrack&&i.version>=65)return Fm(s);const r=s.RTCPeerConnection.prototype.getLocalStreams;s.RTCPeerConnection.prototype.getLocalStreams=function(){const m=r.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(g=>this._reverseStreams[g.id])};const a=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(g=>{if(this.getSenders().find(E=>E.track===g))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const g=new s.MediaStream(m.getTracks());this._streams[m.id]=g,this._reverseStreams[g.id]=m,m=g}a.apply(this,[m])};const l=s.RTCPeerConnection.prototype.removeStream;function d(m,g){let E=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(y=>{const b=m._reverseStreams[y];E=E.replace(new RegExp(m._streams[b.id].id,"g"),b.id)}),new RTCSessionDescription({type:g.type,sdp:E})}s.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},s.RTCPeerConnection.prototype.addTrack=function(m,g){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const E=[].slice.call(arguments,1);if(1!==E.length||!E[0].getTracks().find(b=>b===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(b=>b.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const y=this._streams[g.id];if(y)y.addTrack(m),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const b=new s.MediaStream([m]);this._streams[g.id]=b,this._reverseStreams[b.id]=g,this.addStream(b)}return this.getSenders().find(b=>b.track===m)},["createOffer","createAnswer"].forEach(function(m){const g=s.RTCPeerConnection.prototype[m],E={[m](){const y=arguments;return arguments.length&&"function"==typeof arguments[0]?g.apply(this,[b=>{const T=d(this,b);y[0].apply(null,[T])},b=>{y[1]&&y[1].apply(null,b)},arguments[2]]):g.apply(this,arguments).then(b=>d(this,b))}};s.RTCPeerConnection.prototype[m]=E[m]});const h=s.RTCPeerConnection.prototype.setLocalDescription;s.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(m,g){let E=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(y=>{const b=m._reverseStreams[y],T=m._streams[b.id];E=E.replace(new RegExp(b.id,"g"),T.id)}),new RTCSessionDescription({type:g.type,sdp:E})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const p=Object.getOwnPropertyDescriptor(s.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(s.RTCPeerConnection.prototype,"localDescription",{get(){const m=p.get.apply(this);return""===m.type?m:d(this,m)}}),s.RTCPeerConnection.prototype.removeTrack=function(m){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(m._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let g;this._streams=this._streams||{},Object.keys(this._streams).forEach(E=>{this._streams[E].getTracks().find(y=>m.track===y)&&(g=this._streams[E])}),g&&(1===g.getTracks().length?this.removeStream(this._reverseStreams[g.id]):g.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Hl(s,i){!s.RTCPeerConnection&&s.webkitRTCPeerConnection&&(s.RTCPeerConnection=s.webkitRTCPeerConnection),s.RTCPeerConnection&&i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const a=s.RTCPeerConnection.prototype[r],l={[r](){return arguments[0]=new("addIceCandidate"===r?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};s.RTCPeerConnection.prototype[r]=l[r]})}function lp(s,i){Mo(s,"negotiationneeded",r=>{const a=r.target;if(!(i.version<72||a.getConfiguration&&"plan-b"===a.getConfiguration().sdpSemantics)||"stable"===a.signalingState)return r})}var YT=Object.freeze({__proto__:null,fixNegotiationNeeded:lp,shimAddTrackRemoveTrack:KT,shimAddTrackRemoveTrackWithNative:Fm,shimGetDisplayMedia:function(s,i){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&("function"==typeof i?s.navigator.mediaDevices.getDisplayMedia=function(r){return i(r).then(a=>{const l=r.video&&r.video.width,d=r.video&&r.video.height;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:r.video&&r.video.frameRate||3}},l&&(r.video.mandatory.maxWidth=l),d&&(r.video.mandatory.maxHeight=d),s.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:zT,shimGetStats:Lm,shimGetUserMedia:km,shimMediaStream:kc,shimOnTrack:cp,shimPeerConnection:Hl,shimSenderReceiverGetStats:qT});function Um(s,i){const r=s&&s.navigator,a=s&&s.MediaStreamTrack;if(r.getUserMedia=function(l,d,h){Mc("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(l).then(d,h)},!(i.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const l=function(h,p,m){p in h&&!(m in h)&&(h[m]=h[p],delete h[p])},d=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(h){return"object"==typeof h&&"object"==typeof h.audio&&(h=JSON.parse(JSON.stringify(h)),l(h.audio,"autoGainControl","mozAutoGainControl"),l(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},a&&a.prototype.getSettings){const h=a.prototype.getSettings;a.prototype.getSettings=function(){const p=h.apply(this,arguments);return l(p,"mozAutoGainControl","autoGainControl"),l(p,"mozNoiseSuppression","noiseSuppression"),p}}if(a&&a.prototype.applyConstraints){const h=a.prototype.applyConstraints;a.prototype.applyConstraints=function(p){return"audio"===this.kind&&"object"==typeof p&&(p=JSON.parse(JSON.stringify(p)),l(p,"autoGainControl","mozAutoGainControl"),l(p,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[p])}}}}function $T(s){"object"==typeof s&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function dp(s,i){if("object"!=typeof s||!s.RTCPeerConnection&&!s.mozRTCPeerConnection)return;!s.RTCPeerConnection&&s.mozRTCPeerConnection&&(s.RTCPeerConnection=s.mozRTCPeerConnection),i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(l){const d=s.RTCPeerConnection.prototype[l],h={[l](){return arguments[0]=new("addIceCandidate"===l?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};s.RTCPeerConnection.prototype[l]=h[l]});const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[l,d,h]=arguments;return a.apply(this,[l||null]).then(p=>{if(i.version<53&&!d)try{p.forEach(m=>{m.type=r[m.type]||m.type})}catch(m){if("TypeError"!==m.name)throw m;p.forEach((g,E)=>{p.set(E,Object.assign({},g,{type:r[g.type]||g.type}))})}return p}).then(d,h)}}function Ka(s){if("object"!=typeof s||!s.RTCPeerConnection||!s.RTCRtpSender||s.RTCRtpSender&&"getStats"in s.RTCRtpSender.prototype)return;const i=s.RTCPeerConnection.prototype.getSenders;i&&(s.RTCPeerConnection.prototype.getSenders=function(){const a=i.apply(this,[]);return a.forEach(l=>l._pc=this),a});const r=s.RTCPeerConnection.prototype.addTrack;r&&(s.RTCPeerConnection.prototype.addTrack=function(){const a=r.apply(this,arguments);return a._pc=this,a}),s.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function XT(s){if("object"!=typeof s||!s.RTCPeerConnection||!s.RTCRtpSender||s.RTCRtpSender&&"getStats"in s.RTCRtpReceiver.prototype)return;const i=s.RTCPeerConnection.prototype.getReceivers;i&&(s.RTCPeerConnection.prototype.getReceivers=function(){const r=i.apply(this,[]);return r.forEach(a=>a._pc=this),r}),Mo(s,"track",r=>(r.receiver._pc=r.srcElement,r)),s.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Kv(s){s.RTCPeerConnection&&!("removeStream"in s.RTCPeerConnection.prototype)&&(s.RTCPeerConnection.prototype.removeStream=function(i){Mc("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&i.getTracks().includes(r.track)&&this.removeTrack(r)})})}function Ln(s){s.DataChannel&&!s.RTCDataChannel&&(s.RTCDataChannel=s.DataChannel)}function Yv(s){if("object"!=typeof s||!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype.addTransceiver;i&&(s.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;void 0===r&&(r=[]),r=[...r];const a=r.length>0;a&&r.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const l=i.apply(this,arguments);if(a){const{sender:d}=l,h=d.getParameters();(!("encodings"in h)||1===h.encodings.length&&0===Object.keys(h.encodings[0]).length)&&(h.encodings=r,d.sendEncodings=r,this.setParametersPromises.push(d.setParameters(h).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return l})}function JT(s){if("object"!=typeof s||!s.RTCRtpSender)return;const i=s.RTCRtpSender.prototype.getParameters;i&&(s.RTCRtpSender.prototype.getParameters=function(){const r=i.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function QT(s){if("object"!=typeof s||!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}function ZT(s){if("object"!=typeof s||!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype.createAnswer;s.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}var rn=Object.freeze({__proto__:null,shimAddTransceiver:Yv,shimCreateAnswer:ZT,shimCreateOffer:QT,shimGetDisplayMedia:function(s,i){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&(s.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,Promise.reject(a)}return!0===r.video?r.video={mediaSource:i}:r.video.mediaSource=i,s.navigator.mediaDevices.getUserMedia(r)})},shimGetParameters:JT,shimGetUserMedia:Um,shimOnTrack:$T,shimPeerConnection:dp,shimRTCDataChannel:Ln,shimReceiverGetStats:XT,shimRemoveStream:Kv,shimSenderGetStats:Ka});function $v(s){if("object"==typeof s&&s.RTCPeerConnection){if("getLocalStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in s.RTCPeerConnection.prototype)){const i=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(a=>i.call(this,a,r)),r.getVideoTracks().forEach(a=>i.call(this,a,r))},s.RTCPeerConnection.prototype.addTrack=function(r,...a){return a&&a.forEach(l=>{this._localStreams?this._localStreams.includes(l)||this._localStreams.push(l):this._localStreams=[l]}),i.apply(this,arguments)}}"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(i){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(i);if(-1===r)return;this._localStreams.splice(r,1);const a=i.getTracks();this.getSenders().forEach(l=>{a.includes(l.track)&&this.removeTrack(l)})})}}function Xv(s){if("object"==typeof s&&s.RTCPeerConnection&&("getRemoteStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in s.RTCPeerConnection.prototype))){Object.defineProperty(s.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(l=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(l))return;this._remoteStreams.push(l);const d=new Event("addstream");d.stream=l,this.dispatchEvent(d)})})}});const i=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(l=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(l)>=0)return;r._remoteStreams.push(l);const d=new Event("addstream");d.stream=l,r.dispatchEvent(d)})}),i.apply(r,arguments)}}}function hi(s){if("object"!=typeof s||!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype,r=i.createOffer,a=i.createAnswer,l=i.setLocalDescription,d=i.setRemoteDescription,h=i.addIceCandidate;i.createOffer=function(m,g){const y=r.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return g?(y.then(m,g),Promise.resolve()):y},i.createAnswer=function(m,g){const y=a.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return g?(y.then(m,g),Promise.resolve()):y};let p=function(m,g,E){const y=l.apply(this,[m]);return E?(y.then(g,E),Promise.resolve()):y};i.setLocalDescription=p,p=function(m,g,E){const y=d.apply(this,[m]);return E?(y.then(g,E),Promise.resolve()):y},i.setRemoteDescription=p,p=function(m,g,E){const y=h.apply(this,[m]);return E?(y.then(g,E),Promise.resolve()):y},i.addIceCandidate=p}function Jn(s){const i=s&&s.navigator;if(i.mediaDevices&&i.mediaDevices.getUserMedia){const r=i.mediaDevices,a=r.getUserMedia.bind(r);i.mediaDevices.getUserMedia=l=>a(ew(l))}!i.getUserMedia&&i.mediaDevices&&i.mediaDevices.getUserMedia&&(i.getUserMedia=function(r,a,l){i.mediaDevices.getUserMedia(r).then(a,l)}.bind(i))}function ew(s){return s&&void 0!==s.video?Object.assign({},s,{video:Mm(s.video)}):s}function mn(s){if(!s.RTCPeerConnection)return;const i=s.RTCPeerConnection;s.RTCPeerConnection=function(r,a){if(r&&r.iceServers){const l=[];for(let d=0;d<r.iceServers.length;d++){let h=r.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(Mc("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,l.push(h)):l.push(r.iceServers[d])}r.iceServers=l}return new i(r,a)},s.RTCPeerConnection.prototype=i.prototype,"generateCertificate"in i&&Object.defineProperty(s.RTCPeerConnection,"generateCertificate",{get:()=>i.generateCertificate})}function Vm(s){"object"==typeof s&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function tw(s){const i=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(r){if(r){void 0!==r.offerToReceiveAudio&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const a=this.getTransceivers().find(d=>"audio"===d.receiver.track.kind);!1===r.offerToReceiveAudio&&a?"sendrecv"===a.direction?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":"recvonly"===a.direction&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):!0!==r.offerToReceiveAudio||a||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==r.offerToReceiveVideo&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const l=this.getTransceivers().find(d=>"video"===d.receiver.track.kind);!1===r.offerToReceiveVideo&&l?"sendrecv"===l.direction?l.setDirection?l.setDirection("sendonly"):l.direction="sendonly":"recvonly"===l.direction&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive"):!0!==r.offerToReceiveVideo||l||this.addTransceiver("video",{direction:"recvonly"})}return i.apply(this,arguments)}}function Bm(s){"object"!=typeof s||s.AudioContext||(s.AudioContext=s.webkitAudioContext)}var nw=Object.freeze({__proto__:null,shimAudioContext:Bm,shimCallbacksAPI:hi,shimConstraints:ew,shimCreateOfferLegacy:tw,shimGetUserMedia:Jn,shimLocalStreamsAPI:$v,shimRTCIceServerUrls:mn,shimRemoteStreamsAPI:Xv,shimTrackEventTransceiver:Vm}),ou=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function lr(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var f1={exports:{}};!function(s){const i={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};i.localCName=i.generateIdentifier(),i.splitLines=function(r){return r.trim().split("\n").map(a=>a.trim())},i.splitSections=function(r){return r.split("\nm=").map((a,l)=>(l>0?"m="+a:a).trim()+"\r\n")},i.getDescription=function(r){const a=i.splitSections(r);return a&&a[0]},i.getMediaSections=function(r){const a=i.splitSections(r);return a.shift(),a},i.matchPrefix=function(r,a){return i.splitLines(r).filter(l=>0===l.indexOf(a))},i.parseCandidate=function(r){let a;a=0===r.indexOf("a=candidate:")?r.substring(12).split(" "):r.substring(10).split(" ");const l={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let d=8;d<a.length;d+=2)switch(a[d]){case"raddr":l.relatedAddress=a[d+1];break;case"rport":l.relatedPort=parseInt(a[d+1],10);break;case"tcptype":l.tcpType=a[d+1];break;case"ufrag":l.ufrag=a[d+1],l.usernameFragment=a[d+1];break;default:void 0===l[a[d]]&&(l[a[d]]=a[d+1])}return l},i.writeCandidate=function(r){const a=[];a.push(r.foundation);const l=r.component;a.push("rtp"===l?1:"rtcp"===l?2:l),a.push(r.protocol.toUpperCase()),a.push(r.priority),a.push(r.address||r.ip),a.push(r.port);const d=r.type;return a.push("typ"),a.push(d),"host"!==d&&r.relatedAddress&&r.relatedPort&&(a.push("raddr"),a.push(r.relatedAddress),a.push("rport"),a.push(r.relatedPort)),r.tcpType&&"tcp"===r.protocol.toLowerCase()&&(a.push("tcptype"),a.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(a.push("ufrag"),a.push(r.usernameFragment||r.ufrag)),"candidate:"+a.join(" ")},i.parseIceOptions=function(r){return r.substring(14).split(" ")},i.parseRtpMap=function(r){let a=r.substring(9).split(" ");const l={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),l.name=a[0],l.clockRate=parseInt(a[1],10),l.channels=3===a.length?parseInt(a[2],10):1,l.numChannels=l.channels,l},i.writeRtpMap=function(r){let a=r.payloadType;void 0!==r.preferredPayloadType&&(a=r.preferredPayloadType);const l=r.channels||r.numChannels||1;return"a=rtpmap:"+a+" "+r.name+"/"+r.clockRate+(1!==l?"/"+l:"")+"\r\n"},i.parseExtmap=function(r){const a=r.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},i.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&"sendrecv"!==r.direction?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+"\r\n"},i.parseFmtp=function(r){const a={};let l;const d=r.substring(r.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)l=d[h].trim().split("="),a[l[0].trim()]=l[1];return a},i.writeFmtp=function(r){let a="",l=r.payloadType;if(void 0!==r.preferredPayloadType&&(l=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){const d=[];Object.keys(r.parameters).forEach(h=>{d.push(void 0!==r.parameters[h]?h+"="+r.parameters[h]:h)}),a+="a=fmtp:"+l+" "+d.join(";")+"\r\n"}return a},i.parseRtcpFb=function(r){const a=r.substring(r.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},i.writeRtcpFb=function(r){let a="",l=r.payloadType;return void 0!==r.preferredPayloadType&&(l=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(d=>{a+="a=rtcp-fb:"+l+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+"\r\n"}),a},i.parseSsrcMedia=function(r){const a=r.indexOf(" "),l={ssrc:parseInt(r.substring(7,a),10)},d=r.indexOf(":",a);return d>-1?(l.attribute=r.substring(a+1,d),l.value=r.substring(d+1)):l.attribute=r.substring(a+1),l},i.parseSsrcGroup=function(r){const a=r.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(l=>parseInt(l,10))}},i.getMid=function(r){const a=i.matchPrefix(r,"a=mid:")[0];if(a)return a.substring(6)},i.parseFingerprint=function(r){const a=r.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},i.getDtlsParameters=function(r,a){return{role:"auto",fingerprints:i.matchPrefix(r+a,"a=fingerprint:").map(i.parseFingerprint)}},i.writeDtlsParameters=function(r,a){let l="a=setup:"+a+"\r\n";return r.fingerprints.forEach(d=>{l+="a=fingerprint:"+d.algorithm+" "+d.value+"\r\n"}),l},i.parseCryptoLine=function(r){const a=r.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},i.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+("object"==typeof r.keyParams?i.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+"\r\n"},i.parseCryptoKeyParams=function(r){if(0!==r.indexOf("inline:"))return null;const a=r.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},i.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},i.getCryptoParameters=function(r,a){return i.matchPrefix(r+a,"a=crypto:").map(i.parseCryptoLine)},i.getIceParameters=function(r,a){const l=i.matchPrefix(r+a,"a=ice-ufrag:")[0],d=i.matchPrefix(r+a,"a=ice-pwd:")[0];return l&&d?{usernameFragment:l.substring(12),password:d.substring(10)}:null},i.writeIceParameters=function(r){let a="a=ice-ufrag:"+r.usernameFragment+"\r\na=ice-pwd:"+r.password+"\r\n";return r.iceLite&&(a+="a=ice-lite\r\n"),a},i.parseRtpParameters=function(r){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},l=i.splitLines(r)[0].split(" ");a.profile=l[2];for(let h=3;h<l.length;h++){const p=l[h],m=i.matchPrefix(r,"a=rtpmap:"+p+" ")[0];if(m){const g=i.parseRtpMap(m),E=i.matchPrefix(r,"a=fmtp:"+p+" ");switch(g.parameters=E.length?i.parseFmtp(E[0]):{},g.rtcpFeedback=i.matchPrefix(r,"a=rtcp-fb:"+p+" ").map(i.parseRtcpFb),a.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(g.name.toUpperCase())}}}i.matchPrefix(r,"a=extmap:").forEach(h=>{a.headerExtensions.push(i.parseExtmap(h))});const d=i.matchPrefix(r,"a=rtcp-fb:* ").map(i.parseRtcpFb);return a.codecs.forEach(h=>{d.forEach(p=>{h.rtcpFeedback.find(m=>m.type===p.type&&m.parameter===p.parameter)||h.rtcpFeedback.push(p)})}),a},i.writeRtpDescription=function(r,a){let l="";l+="m="+r+" ",l+=a.codecs.length>0?"9":"0",l+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",l+=a.codecs.map(h=>void 0!==h.preferredPayloadType?h.preferredPayloadType:h.payloadType).join(" ")+"\r\n",l+="c=IN IP4 0.0.0.0\r\n",l+="a=rtcp:9 IN IP4 0.0.0.0\r\n",a.codecs.forEach(h=>{l+=i.writeRtpMap(h),l+=i.writeFmtp(h),l+=i.writeRtcpFb(h)});let d=0;return a.codecs.forEach(h=>{h.maxptime>d&&(d=h.maxptime)}),d>0&&(l+="a=maxptime:"+d+"\r\n"),a.headerExtensions&&a.headerExtensions.forEach(h=>{l+=i.writeExtmap(h)}),l},i.parseRtpEncodingParameters=function(r){const a=[],l=i.parseRtpParameters(r),d=-1!==l.fecMechanisms.indexOf("RED"),h=-1!==l.fecMechanisms.indexOf("ULPFEC"),p=i.matchPrefix(r,"a=ssrc:").map(b=>i.parseSsrcMedia(b)).filter(b=>"cname"===b.attribute),m=p.length>0&&p[0].ssrc;let g;const E=i.matchPrefix(r,"a=ssrc-group:FID").map(b=>b.substring(17).split(" ").map(T=>parseInt(T,10)));E.length>0&&E[0].length>1&&E[0][0]===m&&(g=E[0][1]),l.codecs.forEach(b=>{if("RTX"===b.name.toUpperCase()&&b.parameters.apt){let T={ssrc:m,codecPayloadType:parseInt(b.parameters.apt,10)};m&&g&&(T.rtx={ssrc:g}),a.push(T),d&&(T=JSON.parse(JSON.stringify(T)),T.fec={ssrc:m,mechanism:h?"red+ulpfec":"red"},a.push(T))}}),0===a.length&&m&&a.push({ssrc:m});let y=i.matchPrefix(r,"b=");return y.length&&(y=0===y[0].indexOf("b=TIAS:")?parseInt(y[0].substring(7),10):0===y[0].indexOf("b=AS:")?1e3*parseInt(y[0].substring(5),10)*.95-16e3:void 0,a.forEach(b=>{b.maxBitrate=y})),a},i.parseRtcpParameters=function(r){const a={},l=i.matchPrefix(r,"a=ssrc:").map(p=>i.parseSsrcMedia(p)).filter(p=>"cname"===p.attribute)[0];l&&(a.cname=l.value,a.ssrc=l.ssrc);const d=i.matchPrefix(r,"a=rtcp-rsize");a.reducedSize=d.length>0,a.compound=0===d.length;const h=i.matchPrefix(r,"a=rtcp-mux");return a.mux=h.length>0,a},i.writeRtcpParameters=function(r){let a="";return r.reducedSize&&(a+="a=rtcp-rsize\r\n"),r.mux&&(a+="a=rtcp-mux\r\n"),void 0!==r.ssrc&&r.cname&&(a+="a=ssrc:"+r.ssrc+" cname:"+r.cname+"\r\n"),a},i.parseMsid=function(r){let a;const l=i.matchPrefix(r,"a=msid:");if(1===l.length)return a=l[0].substring(7).split(" "),{stream:a[0],track:a[1]};const d=i.matchPrefix(r,"a=ssrc:").map(h=>i.parseSsrcMedia(h)).filter(h=>"msid"===h.attribute);return d.length>0?(a=d[0].value.split(" "),{stream:a[0],track:a[1]}):void 0},i.parseSctpDescription=function(r){const a=i.parseMLine(r),l=i.matchPrefix(r,"a=max-message-size:");let d;l.length>0&&(d=parseInt(l[0].substring(19),10)),isNaN(d)&&(d=65536);const h=i.matchPrefix(r,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:a.fmt,maxMessageSize:d};const p=i.matchPrefix(r,"a=sctpmap:");if(p.length>0){const m=p[0].substring(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:d}}},i.writeSctpDescription=function(r,a){let l=[];return l="DTLS/SCTP"!==r.protocol?["m="+r.kind+" 9 "+r.protocol+" "+a.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+a.port+"\r\n"]:["m="+r.kind+" 9 "+r.protocol+" "+a.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+a.port+" "+a.protocol+" 65535\r\n"],void 0!==a.maxMessageSize&&l.push("a=max-message-size:"+a.maxMessageSize+"\r\n"),l.join("")},i.generateSessionId=function(){return Math.random().toString().substr(2,22)},i.writeSessionBoilerplate=function(r,a,l){let d;const h=void 0!==a?a:2;return d=r||i.generateSessionId(),"v=0\r\no="+(l||"thisisadapterortc")+" "+d+" "+h+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},i.getDirection=function(r,a){const l=i.splitLines(r);for(let d=0;d<l.length;d++)switch(l[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return l[d].substring(2)}return a?i.getDirection(a):"sendrecv"},i.getKind=function(r){return i.splitLines(r)[0].split(" ")[0].substring(2)},i.isRejected=function(r){return"0"===r.split(" ",2)[1]},i.parseMLine=function(r){const a=i.splitLines(r)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},i.parseOLine=function(r){const a=i.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},i.isValidSDP=function(r){if("string"!=typeof r||0===r.length)return!1;const a=i.splitLines(r);for(let l=0;l<a.length;l++)if(a[l].length<2||"="!==a[l].charAt(1))return!1;return!0},s.exports=i}(f1);var m1=f1.exports,up=lr(m1),nV=function Nc(s,i){return i.forEach(function(r){r&&"string"!=typeof r&&!Array.isArray(r)&&Object.keys(r).forEach(function(a){if("default"!==a&&!(a in s)){var l=Object.getOwnPropertyDescriptor(r,a);Object.defineProperty(s,a,l.get?l:{enumerable:!0,get:function(){return r[a]}})}})}),Object.freeze(s)}({__proto__:null,default:up},[m1]);function jm(s){if(!s.RTCIceCandidate||s.RTCIceCandidate&&"foundation"in s.RTCIceCandidate.prototype)return;const i=s.RTCIceCandidate;s.RTCIceCandidate=function(r){if("object"==typeof r&&r.candidate&&0===r.candidate.indexOf("a=")&&((r=JSON.parse(JSON.stringify(r))).candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){const a=new i(r),l=up.parseCandidate(r.candidate),d=Object.assign(a,l);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new i(r)},s.RTCIceCandidate.prototype=i.prototype,Mo(s,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new s.RTCIceCandidate(r.candidate),writable:"false"}),r))}function Hm(s){!s.RTCIceCandidate||s.RTCIceCandidate&&"relayProtocol"in s.RTCIceCandidate.prototype||Mo(s,"icecandidate",i=>{if(i.candidate){const r=up.parseCandidate(i.candidate.candidate);"relay"===r.type&&(i.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return i})}function Gm(s,i){if(!s.RTCPeerConnection)return;"sctp"in s.RTCPeerConnection.prototype||Object.defineProperty(s.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const h=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===i.browser&&i.version>=76){const{sdpSemantics:p}=this.getConfiguration();"plan-b"===p&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(p){if(!p||!p.sdp)return!1;const m=up.splitSections(p.sdp);return m.shift(),m.some(g=>{const E=up.parseMLine(g);return E&&"application"===E.kind&&-1!==E.protocol.indexOf("SCTP")})}(arguments[0])){const p=function(p){const m=p.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===m||m.length<2)return-1;const g=parseInt(m[1],10);return g!=g?-1:g}(arguments[0]),m=function(p){let m=65536;return"firefox"===i.browser&&(m=i.version<57?-1===p?16384:2147483637:i.version<60?57===i.version?65535:65536:2147483637),m}(p),g=function(p,m){let g=65536;"firefox"===i.browser&&57===i.version&&(g=65535);const E=up.matchPrefix(p.sdp,"a=max-message-size:");return E.length>0?g=parseInt(E[0].substr(19),10):"firefox"===i.browser&&-1!==m&&(g=2147483637),g}(arguments[0],p);let E;E=0===m&&0===g?Number.POSITIVE_INFINITY:0===m||0===g?Math.max(m,g):Math.min(m,g);const y={};Object.defineProperty(y,"maxMessageSize",{get:()=>E}),this._sctp=y}return h.apply(this,arguments)}}function su(s){if(!s.RTCPeerConnection||!("createDataChannel"in s.RTCPeerConnection.prototype))return;function i(a,l){const d=a.send;a.send=function(){const h=arguments[0];if("open"===a.readyState&&l.sctp&&(h.length||h.size||h.byteLength)>l.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+l.sctp.maxMessageSize+" bytes)");return d.apply(a,arguments)}}const r=s.RTCPeerConnection.prototype.createDataChannel;s.RTCPeerConnection.prototype.createDataChannel=function(){const a=r.apply(this,arguments);return i(a,this),a},Mo(s,"datachannel",a=>(i(a.channel,a.target),a))}function Jv(s){if(!s.RTCPeerConnection||"connectionState"in s.RTCPeerConnection.prototype)return;const i=s.RTCPeerConnection.prototype;Object.defineProperty(i,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(i,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{const a=i[r];i[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=l=>{const d=l.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const h=new Event("connectionstatechange",l);d.dispatchEvent(h)}return l},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function hp(s,i){if(!s.RTCPeerConnection||"chrome"===i.browser&&i.version>=71||"safari"===i.browser&&i.version>=605)return;const r=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&-1!==a.sdp.indexOf("\na=extmap-allow-mixed")){const l=a.sdp.split("\n").filter(d=>"a=extmap-allow-mixed"!==d.trim()).join("\n");s.RTCSessionDescription&&a instanceof s.RTCSessionDescription?arguments[0]=new s.RTCSessionDescription({type:a.type,sdp:l}):a.sdp=l}return r.apply(this,arguments)}}function pp(s,i){if(!s.RTCPeerConnection||!s.RTCPeerConnection.prototype)return;const r=s.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(s.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===i.browser&&i.version<78||"firefox"===i.browser&&i.version<68||"safari"===i.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Wm(s,i){if(!s.RTCPeerConnection||!s.RTCPeerConnection.prototype)return;const r=s.RTCPeerConnection.prototype.setLocalDescription;r&&0!==r.length&&(s.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if("object"!=typeof a||a.type&&a.sdp)return r.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||"offer"!==a.type&&"answer"!==a.type?r.apply(this,[a]):("offer"===a.type?this.createOffer:this.createAnswer).apply(this).then(l=>r.apply(this,[l]))})}var _1=Object.freeze({__proto__:null,removeExtmapAllowMixed:hp,shimAddIceCandidateNullOrEmpty:pp,shimConnectionState:Jv,shimMaxMessageSize:Gm,shimParameterlessSetLocalDescription:Wm,shimRTCIceCandidate:jm,shimRTCIceCandidateRelayProtocol:Hm,shimSendThrowTypeError:su});!function({window:s}={},i={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const r=Ur,a=function(d){const h={browser:null,version:null};if(void 0===d||!d.navigator)return h.browser="Not a browser.",h;const{navigator:p}=d;if(p.mozGetUserMedia)h.browser="firefox",h.version=kn(p.userAgent,/Firefox\/(\d+)\./,1);else if(p.webkitGetUserMedia||!1===d.isSecureContext&&d.webkitRTCPeerConnection)h.browser="chrome",h.version=kn(p.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!p.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=kn(p.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return h}(s),l={browserDetails:a,commonShim:_1,extractVersion:kn,disableLog:Pc,disableWarnings:xc,sdp:nV};switch(a.browser){case"chrome":if(!YT||!Hl||!i.shimChrome)return r("Chrome shim is not included in this adapter release."),l;if(null===a.version)return r("Chrome shim can not determine version, not shimming."),l;r("adapter.js shimming chrome."),l.browserShim=YT,pp(s,a),Wm(s),km(s,a),kc(s),Hl(s,a),cp(s),KT(s,a),zT(s),Lm(s),qT(s),lp(s,a),jm(s),Hm(s),Jv(s),Gm(s,a),su(s),hp(s,a);break;case"firefox":if(!rn||!dp||!i.shimFirefox)return r("Firefox shim is not included in this adapter release."),l;r("adapter.js shimming firefox."),l.browserShim=rn,pp(s,a),Wm(s),Um(s,a),dp(s,a),$T(s),Kv(s),Ka(s),XT(s),Ln(s),Yv(s),JT(s),QT(s),ZT(s),jm(s),Jv(s),Gm(s,a),su(s);break;case"safari":if(!nw||!i.shimSafari)return r("Safari shim is not included in this adapter release."),l;r("adapter.js shimming safari."),l.browserShim=nw,pp(s,a),Wm(s),mn(s),tw(s),hi(s),$v(s),Xv(s),Vm(s),Jn(s),Bm(s),jm(s),Hm(s),Gm(s,a),su(s),hp(s,a);break;default:r("Unsupported browser!")}}({window:typeof window>"u"?void 0:window});var pi=function(s){try{return!!s()}catch{return!0}},xs=!pi(function(){var s=function(){}.bind();return"function"!=typeof s||s.hasOwnProperty("prototype")}),Qv=xs,iw=Function.prototype,zm=iw.call,g1=Qv&&iw.bind.bind(zm,zm),ti=Qv?g1:function(s){return function(){return zm.apply(s,arguments)}},Ms=ti({}.isPrototypeOf),qm=function(s){return s&&s.Math==Math&&s},Zi=qm("object"==typeof globalThis&&globalThis)||qm("object"==typeof window&&window)||qm("object"==typeof self&&self)||qm("object"==typeof ou&&ou)||function(){return this}()||ou||Function("return this")(),rw=Function.prototype,ow=rw.apply,sw=rw.call,Zv="object"==typeof Reflect&&Reflect.apply||(xs?sw.bind(ow):function(){return sw.apply(ow,arguments)}),v1=ti,ey=v1({}.toString),aw=v1("".slice),Ya=function(s){return aw(ey(s),8,-1)},cw=Ya,lw=ti,ty=function(s){if("Function"===cw(s))return lw(s)},Km="object"==typeof document&&document.all,fp={all:Km,IS_HTMLDDA:void 0===Km&&void 0!==Km},dw=fp.all,vi=fp.IS_HTMLDDA?function(s){return"function"==typeof s||s===dw}:function(s){return"function"==typeof s},qi={},pa=!pi(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),Ym=Function.prototype.call,Ir=xs?Ym.bind(Ym):function(){return Ym.apply(Ym,arguments)},$m={},uw={}.propertyIsEnumerable,hw=Object.getOwnPropertyDescriptor,$a=hw&&!uw.call({1:2},1);$m.f=$a?function(s){var i=hw(this,s);return!!i&&i.enumerable}:uw;var Lc,yi,ds=function(s,i){return{enumerable:!(1&s),configurable:!(2&s),writable:!(4&s),value:i}},ks=pi,iV=Ya,ny=Object,pw=ti("".split),mp=ks(function(){return!ny("z").propertyIsEnumerable(0)})?function(s){return"String"==iV(s)?pw(s,""):ny(s)}:ny,_p=function(s){return null==s},gp=_p,b1=TypeError,au=function(s){if(gp(s))throw b1("Can't call method on "+s);return s},fw=mp,S1=au,Gl=function(s){return fw(S1(s))},mw=vi,C1=fp.all,ko=fp.IS_HTMLDDA?function(s){return"object"==typeof s?null!==s:mw(s)||s===C1}:function(s){return"object"==typeof s?null!==s:mw(s)},Wl={},iy=Wl,Mi=Zi,ry=vi,ro=function(s){return ry(s)?s:void 0},He=function(s,i){return arguments.length<2?ro(iy[s])||ro(Mi[s]):iy[s]&&iy[s][i]||Mi[s]&&Mi[s][i]},Xa=typeof navigator<"u"&&String(navigator.userAgent)||"",us=Xa,oy=Zi.process,_w=Zi.Deno,_n=oy&&oy.versions||_w&&_w.version,Ep=_n&&_n.v8;Ep&&(yi=(Lc=Ep.split("."))[0]>0&&Lc[0]<4?1:+(Lc[0]+Lc[1])),!yi&&us&&(!(Lc=us.match(/Edge\/(\d+)/))||Lc[1]>=74)&&(Lc=us.match(/Chrome\/(\d+)/))&&(yi=+Lc[1]);var Wn=yi,Jm=Wn,Cn=Zi.String,nt=!!Object.getOwnPropertySymbols&&!pi(function(){var s=Symbol();return!Cn(s)||!(Object(s)instanceof Symbol)||!Symbol.sham&&Jm&&Jm<41}),Qm=nt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,sy=He,rV=vi,gw=Ms,ue=Object,Fc=Qm?function(s){return"symbol"==typeof s}:function(s){var i=sy("Symbol");return rV(i)&&gw(i.prototype,ue(s))},_t=String,Gt=function(s){try{return _t(s)}catch{return"Object"}},w1=vi,oV=Gt,I1=TypeError,oo=function(s){if(w1(s))return s;throw I1(oV(s)+" is not a function")},Lo=oo,sV=_p,ay=function(s,i){var r=s[i];return sV(r)?void 0:Lo(r)},Ew=Ir,Ja=vi,vw=ko,aV=TypeError,R1={exports:{}},A1=Zi,D1=Object.defineProperty,yw="__core-js_shared__",bw=Zi[yw]||function(s,i){try{D1(A1,s,{value:i,configurable:!0,writable:!0})}catch{A1[s]=i}return i}(yw,{}),Fo=bw;(R1.exports=function(s,i){return Fo[s]||(Fo[s]=void 0!==i?i:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var tt=R1.exports,lV=au,dV=Object,cu=function(s){return dV(lV(s))},xe=cu,uV=ti({}.hasOwnProperty),St=Object.hasOwn||function(s,i){return uV(xe(s),i)},Zm=ti,O1=0,Sw=Math.random(),N1=Zm(1..toString),lu=function(s){return"Symbol("+(void 0===s?"":s)+")_"+N1(++O1+Sw,36)},t_=St,Cw=lu,P1=nt,Ft=Qm,Uc=Zi.Symbol,n_=tt("wks"),so=Ft?Uc.for||Uc:Uc&&Uc.withoutSetter||Cw,zn=function(s){return t_(n_,s)||(n_[s]=P1&&t_(Uc,s)?Uc[s]:so("Symbol."+s)),n_[s]},hV=Ir,Dn=ko,x1=Fc,pV=ay,ly=TypeError,Tw=zn("toPrimitive"),dy=function(s,i){if(!Dn(s)||x1(s))return s;var r,a=pV(s,Tw);if(a){if(void 0===i&&(i="default"),r=hV(a,s,i),!Dn(r)||x1(r))return r;throw ly("Can't convert object to primitive value")}return void 0===i&&(i="number"),function(s,i){var r,a;if("string"===i&&Ja(r=s.toString)&&!vw(a=Ew(r,s))||Ja(r=s.valueOf)&&!vw(a=Ew(r,s))||"string"!==i&&Ja(r=s.toString)&&!vw(a=Ew(r,s)))return a;throw aV("Can't convert object to primitive value")}(s,i)},M1=Fc,du=function(s){var i=dy(s,"string");return M1(i)?i:i+""},k1=ko,ww=Zi.document,fV=k1(ww)&&k1(ww.createElement),Iw=function(s){return fV?ww.createElement(s):{}},mV=Iw,uu=!pa&&!pi(function(){return 7!=Object.defineProperty(mV("div"),"a",{get:function(){return 7}}).a}),i_=Ir,L1=$m,F1=ds,U1=Gl,Rw=du,hu=St,V1=uu,Qa=Object.getOwnPropertyDescriptor;qi.f=pa?Qa:function(s,i){if(s=U1(s),i=Rw(i),V1)try{return Qa(s,i)}catch{}if(hu(s,i))return F1(!i_(L1.f,s,i),s[i])};var B1=pi,fe=vi,Aw=/#|\.prototype\./,Oe=function(s,i){var r=hy[r_(s)];return r==j1||r!=vp&&(fe(i)?B1(i):!!i)},r_=Oe.normalize=function(s){return String(s).replace(Aw,".").toLowerCase()},hy=Oe.data={},vp=Oe.NATIVE="N",j1=Oe.POLYFILL="P",Dw=Oe,H1=oo,Za=xs,o_=ty(ty.bind),Rr=function(s,i){return H1(s),void 0===i?s:Za?o_(s,i):function(){return s.apply(i,arguments)}},bi={},Qt=pa&&pi(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),s_=ko,py=String,fy=TypeError,hs=function(s){if(s_(s))return s;throw fy(py(s)+" is not an object")},yp=uu,bp=hs,a_=du,Nw=TypeError,c_=Object.defineProperty,Sp=Object.getOwnPropertyDescriptor,l_="enumerable",d_="configurable",my="writable";bi.f=pa?Qt?function(s,i,r){if(bp(s),i=a_(i),bp(r),"function"==typeof s&&"prototype"===i&&"value"in r&&my in r&&!r[my]){var a=Sp(s,i);a&&a[my]&&(s[i]=r.value,r={configurable:d_ in r?r[d_]:a[d_],enumerable:l_ in r?r[l_]:a[l_],writable:!1})}return c_(s,i,r)}:c_:function(s,i,r){if(bp(s),i=a_(i),bp(r),yp)try{return c_(s,i,r)}catch{}if("get"in r||"set"in r)throw Nw("Accessors not supported");return"value"in r&&(s[i]=r.value),s};var Pw=bi,G1=ds,Vc=pa?function(s,i,r){return Pw.f(s,i,G1(1,r))}:function(s,i,r){return s[i]=r,s},ao=Zi,W1=Zv,xw=ty,z1=vi,q1=qi.f,K1=Dw,pu=Wl,Mw=Rr,fu=Vc,kw=St,Y1=function(s){var i=function(r,a,l){if(this instanceof i){switch(arguments.length){case 0:return new s;case 1:return new s(r);case 2:return new s(r,a)}return new s(r,a,l)}return W1(s,this,arguments)};return i.prototype=s.prototype,i},Ct=function(s,i){var r,a,l,d,h,p,m,g,E,y=s.target,b=s.global,T=s.stat,O=s.proto,P=b?ao:T?ao[y]:(ao[y]||{}).prototype,D=b?pu:pu[y]||fu(pu,y,{})[y],L=D.prototype;for(d in i)a=!(r=K1(b?d:y+(T?".":"#")+d,s.forced))&&P&&kw(P,d),p=D[d],a&&(m=s.dontCallGetSet?(E=q1(P,d))&&E.value:P[d]),h=a&&m?m:i[d],a&&typeof p==typeof h||(g=s.bind&&a?Mw(h,ao):s.wrap&&a?Y1(h):O&&z1(h)?xw(h):h,(s.sham||h&&h.sham||p&&p.sham)&&fu(g,"sham",!0),fu(D,d,g),O&&(kw(pu,l=y+"Prototype")||fu(pu,l,{}),fu(pu[l],d,h),s.real&&L&&(r||!L[d])&&fu(L,d,h)))},$1=Math.ceil,X1=Math.floor,J1=Math.trunc||function(s){var i=+s;return(i>0?X1:$1)(i)},yn=function(s){var i=+s;return i!=i||0===i?0:J1(i)},Q1=yn,Lw=Math.max,Ge=Math.min,Vr=function(s,i){var r=Q1(s);return r<0?Lw(r+i,0):Ge(r,i)},Yt=yn,dr=Math.min,ps=function(s){return function(s){return s>0?dr(Yt(s),9007199254740991):0}(s.length)},Uo=Gl,Fw=Vr,Uw=ps,Cp=function(s){return function(i,r,a){var l,d=Uo(i),h=Uw(d),p=Fw(a,h);if(s&&r!=r){for(;h>p;)if((l=d[p++])!=l)return!0}else for(;h>p;p++)if((s||p in d)&&d[p]===r)return s||p||0;return!s&&-1}},Vw={includes:Cp(!0),indexOf:Cp(!1)},Z1=Vw.includes;Ct({target:"Array",proto:!0,forced:pi(function(){return!Array(1).includes()})},{includes:function(s){return Z1(this,s,arguments.length>1?arguments[1]:void 0)}});var fi=Wl,ke=function(s){return fi[s+"Prototype"]},Tt=ke("Array").includes,Qn=ko,Ls=Ya,Tp=zn("match"),mu=TypeError,mi={};mi[zn("toStringTag")]="z";var fa="[object z]"===String(mi),_u=fa,gt=vi,Bc=Ya,Bw=zn("toStringTag"),gu=Object,Si="Arguments"==Bc(function(){return arguments}()),Fs=_u?Bc:function(s){var i,r,a;return void 0===s?"Undefined":null===s?"Null":"string"==typeof(r=function(l,d){try{return l[d]}catch{}}(i=gu(s),Bw))?r:Si?Bc(i):"Object"==(a=Bc(i))&&gt(i.callee)?"Arguments":a},Eu=Fs,ma=String,Vo=function(s){if("Symbol"===Eu(s))throw TypeError("Cannot convert a Symbol value to a string");return ma(s)},jw=zn("match"),jc=Ct,tc=function(s){if(function(s){var i;return Qn(s)&&(void 0!==(i=s[Tp])?!!i:"RegExp"==Ls(s))}(s))throw mu("The method doesn't accept regular expressions");return s},wp=au,vu=Vo,_V=ti("".indexOf);jc({target:"String",proto:!0,forced:!function(s){var i=/./;try{"/./"[s](i)}catch{try{return i[jw]=!1,"/./"[s](i)}catch{}}return!1}("includes")},{includes:function(s){return!!~_V(vu(wp(this)),vu(tc(s)),arguments.length>1?arguments[1]:void 0)}});var _y=ke("String").includes,gy=Ms,_a=Tt,u_=_y,Hc=Array.prototype,zl=String.prototype,ye=lr(function(s){var i=s.includes;return s===Hc||gy(Hc,s)&&i===Hc.includes?_a:"string"==typeof s||s===zl||gy(zl,s)&&i===zl.includes?u_:i}),ex={exports:{}},h_=bi.f;Ct({target:"Object",stat:!0,forced:Object.defineProperty!==h_,sham:!pa},{defineProperty:h_});var Gc=Wl.Object,p_=ex.exports=function(s,i,r){return Gc.defineProperty(s,i,r)};Gc.defineProperty.sham&&(p_.sham=!0);var Us=lr(ex.exports),Ey=Ya,vy=Array.isArray||function(s){return"Array"==Ey(s)},tx=TypeError,gV=du,nx=bi,ix=ds,rx=function(s,i,r){var a=gV(i);a in s?nx.f(s,a,ix(0,r)):s[a]=r},EV=vi,Hw=bw,vV=ti(Function.toString);EV(Hw.inspectSource)||(Hw.inspectSource=function(s){return vV(s)});var ox=Hw.inspectSource,yV=ti,bV=pi,sx=vi,SV=Fs,CV=ox,ax=function(){},TV=[],yy=He("Reflect","construct"),f_=/^\s*(?:class|function)\b/,wV=yV(f_.exec),IV=!f_.exec(ax),m_=function(s){if(!sx(s))return!1;try{return yy(ax,TV,s),!0}catch{return!1}},Wc=function(s){if(!sx(s))return!1;switch(SV(s)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return IV||!!wV(f_,CV(s))}catch{return!0}};Wc.sham=!0;var nc=!yy||bV(function(){var s;return m_(m_.call)||!m_(Object)||!m_(function(){s=!0})||s})?Wc:m_,cx=vy,RV=nc,ur=ko,__=zn("species"),Bo=Array,by=function(s,i){return new(function(s){var i;return cx(s)&&(RV(i=s.constructor)&&(i===Bo||cx(i.prototype))||ur(i)&&null===(i=i[__]))&&(i=void 0),void 0===i?Bo:i}(s))(0===i?0:i)},Ww=pi,zw=Wn,Sy=zn("species"),qw=Ct,Cy=pi,Ty=vy,Kw=ko,Yw=cu,$w=ps,Ip=function(s){if(s>9007199254740991)throw tx("Maximum allowed index exceeded");return s},yu=rx,bu=by,AV=Wn,lx=zn("isConcatSpreadable"),DV=AV>=51||!Cy(function(){var s=[];return s[lx]=!1,s.concat()[0]!==s}),dx=function(s){if(!Kw(s))return!1;var i=s[lx];return void 0!==i?!!i:Ty(s)};qw({target:"Array",proto:!0,arity:1,forced:!DV||!function(s){return zw>=51||!Ww(function(){var i=[];return(i.constructor={})[Sy]=function(){return{foo:1}},1!==i[s](Boolean).foo})}("concat")},{concat:function(s){var i,r,a,l,d,h=Yw(this),p=bu(h,0),m=0;for(i=-1,a=arguments.length;i<a;i++)if(dx(d=-1===i?h:arguments[i]))for(l=$w(d),Ip(m+l),r=0;r<l;r++,m++)r in d&&yu(p,m,d[r]);else Ip(m+1),yu(p,m++,d);return p.length=m,p}});var wy={},Iy={},g_=St,Ry=Gl,ux=Vw.indexOf,Ay=Iy,hx=ti([].push),px=function(s,i){var r,a=Ry(s),l=0,d=[];for(r in a)!g_(Ay,r)&&g_(a,r)&&hx(d,r);for(;i.length>l;)g_(a,r=i[l++])&&(~ux(d,r)||hx(d,r));return d},Dy=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Jw=px,Qw=Dy,Zw=Object.keys||function(s){return Jw(s,Qw)},eI=bi,_x=hs,tI=Gl,gx=Zw;wy.f=pa&&!Qt?Object.defineProperties:function(s,i){_x(s);for(var r,a=tI(i),l=gx(i),d=l.length,h=0;d>h;)eI.f(s,r=l[h++],a[r]);return s};var Oy,nI=He("document","documentElement"),jo=lu,Ny=tt("keys"),E_=function(s){return Ny[s]||(Ny[s]=jo(s))},Ex=hs,iI=wy,Py=Dy,vx=Iy,xy=nI,yx=Iw,fs="prototype",v_="script",My=E_("IE_PROTO"),Tn=function(){},y_=function(s){return"<script>"+s+"</"+v_+">"},Rp=function(s){s.write(y_("")),s.close();var i=s.parentWindow.Object;return s=null,i},hr=function(){try{Oy=new ActiveXObject("htmlfile")}catch{}var s,i;hr=typeof document<"u"?document.domain&&Oy?Rp(Oy):("javascript:",(i=yx("iframe")).style.display="none",xy.appendChild(i),i.src=String("javascript:"),(s=i.contentWindow.document).open(),s.write(y_("document.F=Object")),s.close(),s.F):Rp(Oy);for(var a=Py.length;a--;)delete hr[fs][Py[a]];return hr()};vx[My]=!0;var b_=Object.create||function(s,i){var r;return null!==s?(Tn[fs]=Ex(s),r=new Tn,Tn[fs]=null,r[My]=s):r=hr(),void 0===i?r:iI.f(r,i)},Ap={},Su=px,Ho=Dy.concat("length","prototype");Ap.f=Object.getOwnPropertyNames||function(s){return Su(s,Ho)};var rI={},oI=Vr,bx=ps,zc=rx,sI=Array,Sx=Math.max,ky=function(s,i,r){for(var a=bx(s),l=oI(i,a),d=oI(void 0===r?a:r,a),h=sI(Sx(d-l,0)),p=0;l<d;l++,p++)zc(h,p,s[l]);return h.length=p,h},aI=Ya,cI=Gl,lI=Ap.f,ct=ky,Ly="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];rI.f=function(s){return Ly&&"Window"==aI(s)?function(i){try{return lI(i)}catch{return ct(Ly)}}(s):lI(cI(s))};var Fy={};Fy.f=Object.getOwnPropertySymbols;var Cx=Vc,Dp=function(s,i,r,a){return a&&a.enumerable?s[i]=r:Cx(s,i,r),s},Tx=bi,Uy=function(s,i,r){return Tx.f(s,i,r)},Vs={};Vs.f=zn;var S_,Op,C_,dI=Wl,be=St,$t=Vs,ga=bi.f,dn=function(s){var i=dI.Symbol||(dI.Symbol={});be(i,s)||ga(i,s,{value:$t.f(s)})},pr=Ir,uI=He,Np=zn,Ea=Dp,T_=function(){var s=uI("Symbol"),i=s&&s.prototype,r=i&&i.valueOf,a=Np("toPrimitive");i&&!i[a]&&Ea(i,a,function(l){return pr(r,this)},{arity:1})},Vy=Fs,OV=fa,hI=bi.f,Hr=Vc,ic=St,pI=fa?{}.toString:function(){return"[object "+Vy(this)+"]"},ql=zn("toStringTag"),lo=function(s,i,r,a){if(s){var l=r?s:s.prototype;ic(l,ql)||hI(l,ql,{configurable:!0,value:i}),a&&!OV&&Hr(l,"toString",pI)}},By=Zi.WeakMap,Ax=vi(By)&&/native code/.test(String(By)),jy=ko,Hy=Vc,w_=St,Dx=E_,mI=Iy,I_="Object already initialized",R_=Zi.TypeError;if(Ax||bw.state){var Bs=bw.state||(bw.state=new(0,Zi.WeakMap));Bs.get=Bs.get,Bs.has=Bs.has,Bs.set=Bs.set,S_=function(s,i){if(Bs.has(s))throw R_(I_);return i.facade=s,Bs.set(s,i),i},Op=function(s){return Bs.get(s)||{}},C_=function(s){return Bs.has(s)}}else{var Kl=Dx("state");mI[Kl]=!0,S_=function(s,i){if(w_(s,Kl))throw R_(I_);return i.facade=s,Hy(s,Kl,i),i},Op=function(s){return w_(s,Kl)?s[Kl]:{}},C_=function(s){return w_(s,Kl)}}var Cu={set:S_,get:Op,has:C_,enforce:function(s){return C_(s)?Op(s):S_(s,{})},getterFor:function(s){return function(i){var r;if(!jy(i)||(r=Op(i)).type!==s)throw R_("Incompatible receiver, "+s+" required");return r}}},Ox=Rr,Nx=mp,Gr=cu,Yl=ps,ni=by,Go=ti([].push),qc=function(s){var i=1==s,r=2==s,a=3==s,l=4==s,d=6==s,h=7==s,p=5==s||d;return function(m,g,E,y){for(var b,T,O=Gr(m),P=Nx(O),D=Ox(g,E),L=Yl(P),B=0,V=y||ni,Q=i?V(m,L):r||h?V(m,0):void 0;L>B;B++)if((p||B in P)&&(T=D(b=P[B],B,O),s))if(i)Q[B]=T;else if(T)switch(s){case 3:return!0;case 5:return b;case 6:return B;case 2:Go(Q,b)}else switch(s){case 4:return!1;case 7:Go(Q,b)}return d?-1:a||l?l:Q}},rc={forEach:qc(0),map:qc(1),filter:qc(2),some:qc(3),every:qc(4),find:qc(5),findIndex:qc(6),filterReject:qc(7)},A_=Ct,D_=Zi,O_=Ir,N_=ti,Wo=pa,Tu=nt,P_=pi,Ci=St,x_=Ms,xp=hs,Mp=Gl,M_=du,Px=Vo,Kc=ds,oc=b_,gI=Zw,NV=Ap,k_=rI,PV=Fy,EI=qi,vI=bi,xV=wy,xx=$m,L_=Dp,kp=Uy,Gy=tt,wu=Iy,F_=lu,U_=zn,MV=Vs,yI=dn,bI=T_,Mx=lo,js=Cu,V_=rc.forEach,fr=E_("hidden"),Iu="Symbol",Ru="prototype",B_=js.set,j_=js.getterFor(Iu),Hs=Object[Ru],Yc=D_.Symbol,Lp=Yc&&Yc[Ru],SI=D_.TypeError,H_=D_.QObject,CI=EI.f,va=vI.f,$c=k_.f,kx=xx.f,Wy=N_([].push),ya=Gy("symbols"),sc=Gy("op-symbols"),Lx=Gy("wks"),mr=!H_||!H_[Ru]||!H_[Ru].findChild,zy=Wo&&P_(function(){return 7!=oc(va({},"a",{get:function(){return va(this,"a",{value:7}).a}})).a})?function(s,i,r){var a=CI(Hs,i);a&&delete Hs[i],va(s,i,r),a&&s!==Hs&&va(Hs,i,a)}:va,Ti=function(s,i){var r=ya[s]=oc(Lp);return B_(r,{type:Iu,tag:s,description:i}),Wo||(r.description=i),r},Au=function(s,i,r){s===Hs&&Au(sc,i,r),xp(s);var a=M_(i);return xp(r),Ci(ya,a)?(r.enumerable?(Ci(s,fr)&&s[fr][a]&&(s[fr][a]=!1),r=oc(r,{enumerable:Kc(0,!1)})):(Ci(s,fr)||va(s,fr,Kc(1,{})),s[fr][a]=!0),zy(s,a,r)):va(s,a,r)},qy=function(s,i){xp(s);var r=Mp(i),a=gI(r).concat(Xl(r));return V_(a,function(l){Wo&&!O_(Ky,r,l)||Au(s,l,r[l])}),s},Ky=function(s){var i=M_(s),r=O_(kx,this,i);return!(this===Hs&&Ci(ya,i)&&!Ci(sc,i))&&(!(r||!Ci(this,i)||!Ci(ya,i)||Ci(this,fr)&&this[fr][i])||r)},Du=function(s,i){var r=Mp(s),a=M_(i);if(r!==Hs||!Ci(ya,a)||Ci(sc,a)){var l=CI(r,a);return!l||!Ci(ya,a)||Ci(r,fr)&&r[fr][a]||(l.enumerable=!0),l}},$l=function(s){var i=$c(Mp(s)),r=[];return V_(i,function(a){Ci(ya,a)||Ci(wu,a)||Wy(r,a)}),r},Xl=function(s){var i=s===Hs,r=$c(i?sc:Mp(s)),a=[];return V_(r,function(l){!Ci(ya,l)||i&&!Ci(Hs,l)||Wy(a,ya[l])}),a};Tu||(Yc=function(){if(x_(Lp,this))throw SI("Symbol is not a constructor");var s=arguments.length&&void 0!==arguments[0]?Px(arguments[0]):void 0,i=F_(s),r=function(a){this===Hs&&O_(r,sc,a),Ci(this,fr)&&Ci(this[fr],i)&&(this[fr][i]=!1),zy(this,i,Kc(1,a))};return Wo&&mr&&zy(Hs,i,{configurable:!0,set:r}),Ti(i,s)},L_(Lp=Yc[Ru],"toString",function(){return j_(this).tag}),L_(Yc,"withoutSetter",function(s){return Ti(F_(s),s)}),xx.f=Ky,vI.f=Au,xV.f=qy,EI.f=Du,NV.f=k_.f=$l,PV.f=Xl,MV.f=function(s){return Ti(U_(s),s)},Wo&&kp(Lp,"description",{configurable:!0,get:function(){return j_(this).description}})),A_({global:!0,constructor:!0,wrap:!0,forced:!Tu,sham:!Tu},{Symbol:Yc}),V_(gI(Lx),function(s){yI(s)}),A_({target:Iu,stat:!0,forced:!Tu},{useSetter:function(){mr=!0},useSimple:function(){mr=!1}}),A_({target:"Object",stat:!0,forced:!Tu,sham:!Wo},{create:function(s,i){return void 0===i?oc(s):qy(oc(s),i)},defineProperty:Au,defineProperties:qy,getOwnPropertyDescriptor:Du}),A_({target:"Object",stat:!0,forced:!Tu},{getOwnPropertyNames:$l}),bI(),Mx(Yc,Iu),wu[fr]=!0;var Jl=nt&&!!Symbol.for&&!!Symbol.keyFor,TI=Ct,Yy=He,Ou=St,kV=Vo,wI=tt,LV=Jl,II=wI("string-to-symbol-registry"),FV=wI("symbol-to-string-registry");TI({target:"Symbol",stat:!0,forced:!LV},{for:function(s){var i=kV(s);if(Ou(II,i))return II[i];var r=Yy("Symbol")(i);return II[i]=r,FV[r]=i,r}});var UV=Ct,VV=St,BV=Fc,Nu=Gt,Fx=Jl,RI=tt("symbol-to-string-registry");UV({target:"Symbol",stat:!0,forced:!Fx},{keyFor:function(s){if(!BV(s))throw TypeError(Nu(s)+" is not a symbol");if(VV(RI,s))return RI[s]}});var ki=ti([].slice),AI=vy,Fp=vi,DI=Ya,ms=Vo,Ql=ti([].push),OI=Ct,Up=He,Pu=Zv,Ux=Ir,G_=ti,NI=pi,Vx=vi,uo=Fc,W_=ki,jV=nt,PI=String,Xc=Up("JSON","stringify"),z_=G_(/./.exec),xI=G_("".charAt),Bx=G_("".charCodeAt),jx=G_("".replace),Hx=G_(1..toString),$y=/[\uD800-\uDFFF]/g,Vp=/^[\uD800-\uDBFF]$/,MI=/^[\uDC00-\uDFFF]$/,Bp=!jV||NI(function(){var s=Up("Symbol")();return"[null]"!=Xc([s])||"{}"!=Xc({a:s})||"{}"!=Xc(Object(s))}),kI=NI(function(){return'"\\udf06\\ud834"'!==Xc("\udf06\ud834")||'"\\udead"'!==Xc("\udead")}),q_=function(s,i){var r=W_(arguments),a=function(s){if(Fp(s))return s;if(AI(s)){for(var i=s.length,r=[],a=0;a<i;a++){var l=s[a];"string"==typeof l?Ql(r,l):"number"!=typeof l&&"Number"!=DI(l)&&"String"!=DI(l)||Ql(r,ms(l))}var d=r.length,h=!0;return function(p,m){if(h)return h=!1,m;if(AI(this))return m;for(var g=0;g<d;g++)if(r[g]===p)return m}}}(i);if(Vx(a)||void 0!==s&&!uo(s))return r[1]=function(l,d){if(Vx(a)&&(d=Ux(a,this,PI(l),d)),!uo(d))return d},Pu(Xc,null,r)},Gx=function(s,i,r){var a=xI(r,i-1),l=xI(r,i+1);return z_(Vp,s)&&!z_(MI,l)||z_(MI,s)&&!z_(Vp,a)?"\\u"+Hx(Bx(s,0),16):s};Xc&&OI({target:"JSON",stat:!0,arity:3,forced:Bp||kI},{stringify:function(s,i,r){var a=W_(arguments),l=Pu(Bp?q_:Xc,null,a);return kI&&"string"==typeof l?jx(l,$y,Gx):l}});var Xy=Fy,Jy=cu;Ct({target:"Object",stat:!0,forced:!nt||pi(function(){Xy.f(1)})},{getOwnPropertySymbols:function(s){var i=Xy.f;return i?i(Jy(s)):[]}}),dn("asyncIterator"),dn("hasInstance"),dn("isConcatSpreadable"),dn("iterator"),dn("match"),dn("matchAll"),dn("replace"),dn("search"),dn("species"),dn("split");var K_=T_;dn("toPrimitive"),K_();var LI=He,Wx=lo;dn("toStringTag"),Wx(LI("Symbol"),"Symbol"),dn("unscopables"),lo(Zi.JSON,"JSON",!0);var Zl,ed,Mu,zx=Wl.Symbol,jp={},Y_=pa,Kx=Function.prototype,Yx=Y_&&Object.getOwnPropertyDescriptor,Qy=St(Kx,"name"),FI={EXISTS:Qy,PROPER:Qy&&"something"===function(){}.name,CONFIGURABLE:Qy&&(!Y_||Y_&&Yx(Kx,"name").configurable)},$_=!pi(function(){function s(){}return s.prototype.constructor=null,Object.getPrototypeOf(new s)!==s.prototype}),UI=St,$x=vi,VI=cu,HV=$_,Zy=E_("IE_PROTO"),BI=Object,Xx=BI.prototype,eb=HV?BI.getPrototypeOf:function(s){var i=VI(s);if(UI(i,Zy))return i[Zy];var r=i.constructor;return $x(r)&&i instanceof r?r.prototype:i instanceof BI?Xx:null},tb=pi,GV=vi,WV=ko,nb=b_,Jx=eb,zV=Dp,jI=zn("iterator"),Qx=!1;[].keys&&("next"in(Mu=[].keys())?(ed=Jx(Jx(Mu)))!==Object.prototype&&(Zl=ed):Qx=!0);var qV=!WV(Zl)||tb(function(){var s={};return Zl[jI].call(s)!==s});GV((Zl=qV?{}:nb(Zl))[jI])||zV(Zl,jI,function(){return this});var HI={IteratorPrototype:Zl,BUGGY_SAFARI_ITERATORS:Qx},X_=HI.IteratorPrototype,J_=b_,GI=ds,WI=lo,zI=jp,ku=function(){return this},qI=ti,KI=oo,Q_=vi,Z_=String,Jc=TypeError,eM=hs,YI=Object.setPrototypeOf||("__proto__"in{}?function(){var s,i=!1,r={};try{(s=function(s,i,r){try{return qI(KI(Object.getOwnPropertyDescriptor(s,i)[r]))}catch{}}(Object.prototype,"__proto__","set"))(r,[]),i=r instanceof Array}catch{}return function(a,l){return eM(a),function(s){if("object"==typeof s||Q_(s))return s;throw Jc("Can't set "+Z_(s)+" as a prototype")}(l),i?s(a,l):a.__proto__=l,a}}():void 0),ib=Ct,nM=Ir,$I=eb,oM=lo,XI=Dp,Wr=jp,JI=FI.PROPER,Lu=HI.BUGGY_SAFARI_ITERATORS,er=zn("iterator"),Hp="values",ob="entries",sM=function(){return this},sb=function(s,i,r,a,l,d,h){!function(s,i,r,a){var l=i+" Iterator";s.prototype=J_(X_,{next:GI(+!a,r)}),WI(s,l,!1,!0),zI[l]=ku}(r,i,a);var p,m,g,E=function(L){if(L===l&&P)return P;if(!Lu&&L in T)return T[L];switch(L){case"keys":case Hp:case ob:return function(){return new r(this,L)}}return function(){return new r(this)}},y=i+" Iterator",b=!1,T=s.prototype,O=T[er]||T["@@iterator"]||l&&T[l],P=!Lu&&O||E(l),D="Array"==i&&T.entries||O;if(D&&(p=$I(D.call(new s)))!==Object.prototype&&p.next&&(oM(p,y,!0,!0),Wr[y]=sM),JI&&l==Hp&&O&&O.name!==Hp&&(b=!0,P=function(){return nM(O,this)}),l)if(m={values:E(Hp),keys:d?P:E("keys"),entries:E(ob)},h)for(g in m)(Lu||b||!(g in T))&&XI(T,g,m[g]);else ib({target:i,proto:!0,forced:Lu||b},m);return h&&T[er]!==P&&XI(T,er,P,{name:l}),Wr[i]=P,m},QI=function(s,i){return{value:s,done:i}},ZI=Gl,eR=jp,aM=sb,tR=QI,eg="Array Iterator",cb=Cu.set,cM=Cu.getterFor(eg);aM(Array,"Array",function(s,i){cb(this,{type:eg,target:ZI(s),index:0,kind:i})},function(){var s=cM(this),i=s.target,r=s.kind,a=s.index++;return!i||a>=i.length?(s.target=void 0,tR(void 0,!0)):tR("keys"==r?a:"values"==r?i[a]:[a,i[a]],!1)},"values"),eR.Arguments=eR.Array;var lM=Zi,dM=Fs,nR=Vc,lb=jp,db=zn("toStringTag");for(var Qc in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var Wp=lM[Qc],tg=Wp&&Wp.prototype;tg&&dM(tg)!==db&&nR(tg,db,Qc),lb[Qc]=lb.Array}var ub=zx,uM=bi.f,iR=zn("metadata"),rR=Function.prototype;void 0===rR[iR]&&uM(rR,iR,{value:null}),dn("dispose"),dn("metadata");var hM=ub;dn("asyncDispose");var pM=ti,hb=He("Symbol"),oR=hb.keyFor,ig=pM(hb.prototype.valueOf),rg=hb.isRegisteredSymbol||function(s){try{return void 0!==oR(ig(s))}catch{return!1}};Ct({target:"Symbol",stat:!0},{isRegisteredSymbol:rg});for(var pb=tt,sR=He,fM=ti,fb=Fc,aR=zn,ba=sR("Symbol"),mb=ba.isWellKnownSymbol,_b=sR("Object","getOwnPropertyNames"),mM=fM(ba.prototype.valueOf),_M=pb("wks"),Uu=0,cR=_b(ba),lR=cR.length;Uu<lR;Uu++)try{var gb=cR[Uu];fb(ba[gb])&&aR(gb)}catch{}var Eb=function(s){if(mb&&mb(s))return!0;try{for(var i=mM(s),r=0,a=_b(_M),l=a.length;r<l;r++)if(_M[a[r]]==i)return!0}catch{}return!1};Ct({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:Eb}),dn("matcher"),dn("observable"),Ct({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:rg}),Ct({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:Eb}),dn("metadataKey"),dn("patternMatch"),dn("replaceAll");var Zc=lr(hM),og=ti,sg=yn,zp=Vo,dR=au,vb=og("".charAt),qp=og("".charCodeAt),uR=og("".slice),ag=function(s){return function(i,r){var a,l,d=zp(dR(i)),h=sg(r),p=d.length;return h<0||h>=p?s?"":void 0:(a=qp(d,h))<55296||a>56319||h+1===p||(l=qp(d,h+1))<56320||l>57343?s?vb(d,h):a:s?uR(d,h,h+2):l-56320+(a-55296<<10)+65536}},Kp=(ag(!1),ag(!0)),gM=Vo,EM=sb,hR=QI,pR="String Iterator",fR=Cu.set,mR=Cu.getterFor(pR);EM(String,"String",function(s){fR(this,{type:pR,string:gM(s),index:0})},function(){var s,i=mR(this),r=i.string,a=i.index;return a>=r.length?hR(void 0,!0):(s=Kp(r,a),i.index+=s.length,hR(s,!1))});var Yp=lr(Vs.f("iterator"));function td(s){return(td="function"==typeof Zc&&"symbol"==typeof Yp?function(i){return typeof i}:function(i){return i&&"function"==typeof Zc&&i.constructor===Zc&&i!==Zc.prototype?"symbol":typeof i})(s)}var Vu=lr(Vs.f("toPrimitive"));function C(s,i,r){return(i=function vM(s){var i=function(r,a){if("object"!==td(r)||null===r)return r;var l=r[Vu];if(void 0!==l){var d=l.call(r,"string");if("object"!==td(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}(s);return"symbol"===td(i)?i:String(i)}(i))in s?Us(s,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[i]=r,s}var KV=ke("Array").keys,yM=Fs,bb=St,bM=Ms,Bu=KV,ju=Array.prototype,Sb={DOMTokenList:!0,NodeList:!0},zr=lr(function(s){var i=s.keys;return s===ju||bM(ju,s)&&i===ju.keys||bb(Sb,yM(s))?Bu:i}),Cb=Gt,_R=TypeError,Tb=ky,SM=Math.floor,wb=function(s,i){var r=s.length,a=SM(r/2);return r<8?CM(s,i):TM(s,wb(Tb(s,0,a),i),wb(Tb(s,a),i),i)},CM=function(s,i){for(var r,a,l=s.length,d=1;d<l;){for(a=d,r=s[d];a&&i(s[a-1],r)>0;)s[a]=s[--a];a!==d++&&(s[a]=r)}return s},TM=function(s,i,r,a){for(var l=i.length,d=r.length,h=0,p=0;h<l||p<d;)s[h+p]=h<l&&p<d?a(i[h],r[p])<=0?i[h++]:r[p++]:h<l?i[h++]:r[p++];return s},wM=wb,el=pi,Hu=function(s,i){var r=[][s];return!!r&&el(function(){r.call(null,i||function(){return 1},1)})},gR=Xa.match(/firefox\/(\d+)/i),YV=!!gR&&+gR[1],$V=/MSIE|Trident/.test(Xa),IM=Xa.match(/AppleWebKit\/(\d+)\./),JV=Ct,Ib=ti,RM=oo,AM=cu,ER=ps,DM=function(s,i){if(!delete s[i])throw _R("Cannot delete property "+Cb(i)+" of "+Cb(s))},cg=Vo,Gs=pi,$p=wM,vR=Hu,Rb=YV,yR=$V,OM=Wn,NM=!!IM&&+IM[1],nd=[],lg=Ib(nd.sort),Ab=Ib(nd.push),QV=Gs(function(){nd.sort(void 0)}),ZV=Gs(function(){nd.sort(null)}),bR=vR("sort"),SR=!Gs(function(){if(OM)return OM<70;if(!(Rb&&Rb>3)){if(yR)return!0;if(NM)return NM<603;var s,i,r,a,l="";for(s=65;s<76;s++){switch(i=String.fromCharCode(s),s){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(a=0;a<47;a++)nd.push({k:i+a,v:r})}for(nd.sort(function(d,h){return h.v-d.v}),a=0;a<nd.length;a++)i=nd[a].k.charAt(0),l.charAt(l.length-1)!==i&&(l+=i);return"DGBEFHACIJK"!==l}});JV({target:"Array",proto:!0,forced:QV||!ZV||!bR||!SR},{sort:function(s){void 0!==s&&RM(s);var i=AM(this);if(SR)return void 0===s?lg(i):lg(i,s);var r,a,l=[],d=ER(i);for(a=0;a<d;a++)a in i&&Ab(l,i[a]);for($p(l,function(h){return function(p,m){return void 0===m?-1:void 0===p?1:void 0!==h?+h(p,m)||0:cg(p)>cg(m)?1:-1}}(s)),r=ER(l),a=0;a<r;)i[a]=l[a++];for(;a<d;)DM(i,a++);return i}});var PM=ke("Array").sort,xM=Ms,MM=PM,dg=Array.prototype,tl=lr(function(s){var i=s.sort;return s===dg||xM(dg,s)&&i===dg.sort?MM:i}),kM=He,Db=Ap,LM=Fy,Gu=hs,FM=ti([].concat),UM=kM("Reflect","ownKeys")||function(s){var i=Db.f(Gu(s)),r=LM.f;return r?FM(i,r(s)):i},ug=St,CR=UM,VM=qi,BM=bi,jM=ko,HM=Vc,Ob=Error,e3=ti("".replace),t3=String(Ob("zxcasd").stack),Wu=/\n\s*at [^:]*:[^\n]*/,De=Wu.test(t3),Xp=ds,TR=!pi(function(){var s=Error("a");return!("stack"in s)||(Object.defineProperty(s,"stack",Xp(1,7)),7!==s.stack)}),wR=Vc,IR=TR,RR=Error.captureStackTrace,AR=jp,DR=zn("iterator"),hg=Array.prototype,n3=Fs,pg=ay,GM=_p,Pb=jp,OR=zn("iterator"),xb=function(s){if(!GM(s))return pg(s,OR)||pg(s,"@@iterator")||Pb[n3(s)]},id=Ir,WM=oo,Mb=hs,fg=Gt,zM=xb,kb=TypeError,mg=Ir,zo=hs,_g=ay,Lb=Rr,qM=Ir,KM=hs,NR=Gt,YM=ps,PR=Ms,Fb=xb,qu=function(s,i,r){var a,l;zo(s);try{if(!(a=_g(s,"return"))){if("throw"===i)throw r;return r}a=mg(a,s)}catch(d){l=!0,a=d}if("throw"===i)throw r;if(l)throw a;return zo(a),r},XM=TypeError,Jp=function(s,i){this.stopped=s,this.result=i},nl=Jp.prototype,gg=function(s,i,r){var a,l,d,h,p,m,g,y=!(!r||!r.AS_ENTRIES),b=!(!r||!r.IS_RECORD),T=!(!r||!r.IS_ITERATOR),O=!(!r||!r.INTERRUPTED),P=Lb(i,r&&r.that),D=function(B){return a&&qu(a,"normal",B),new Jp(!0,B)},L=function(B){return y?(KM(B),O?P(B[0],B[1],D):P(B[0],B[1])):O?P(B,D):P(B)};if(b)a=s.iterator;else if(T)a=s;else{if(!(l=Fb(s)))throw XM(NR(s)+" is not iterable");if(function(s){return void 0!==s&&(AR.Array===s||hg[DR]===s)}(l)){for(d=0,h=YM(s);h>d;d++)if((p=L(s[d]))&&PR(nl,p))return p;return new Jp(!1)}a=function(s,i){var r=arguments.length<2?zM(s):i;if(WM(r))return Mb(id(r,s));throw kb(fg(s)+" is not iterable")}(s,l)}for(m=b?s.next:a.next;!(g=qM(m,a)).done;){try{p=L(g.value)}catch(B){qu(a,"throw",B)}if("object"==typeof p&&p&&PR(nl,p))return p}return new Jp(!1)},Sa=Vo,Ub=Ct,JM=Ms,r3=eb,Vb=YI,xR=b_,Qp=Vc,Zp=ds,Bb=function(s,i,r,a){IR&&(RR?RR(s,i):wR(s,"stack",function(s,i){if(De&&"string"==typeof s&&!Ob.prepareStackTrace)for(;i--;)s=e3(s,Wu,"");return s}(r,a)))},jb=gg,vg=zn("toStringTag"),ac=Error,Hb=[].push,il=function(s,i){var r,a=JM(Yu,this);Vb?r=Vb(ac(),a?r3(this):Yu):(r=a?this:xR(Yu),Qp(r,vg,"Error")),void 0!==i&&Qp(r,"message",function(s,i){return void 0===s?arguments.length<2?"":i:Sa(s)}(i)),Bb(r,il,r.stack,1),arguments.length>2&&function(s,i){jM(i)&&"cause"in i&&HM(s,"cause",i.cause)}(r,arguments[2]);var l=[];return jb(s,Hb,{that:l}),Qp(r,"errors",l),r};Vb?Vb(il,ac):function(s,i,r){for(var a=CR(i),l=BM.f,d=VM.f,h=0;h<a.length;h++){var p=a[h];ug(s,p)||r&&ug(r,p)||l(s,p,d(i,p))}}(il,ac,{name:!0});var Yu=il.prototype=xR(ac.prototype,{constructor:Zp(1,il),message:Zp(1,""),name:Zp(1,"AggregateError")});Ub({global:!0,constructor:!0,arity:2},{AggregateError:il});var yg,rl,$u,Gb,Xu=typeof process<"u"&&"process"==Ya(process),QM=He,ZM=Uy,Wb=pa,zb=zn("species"),ek=Ms,tk=TypeError,o3=nc,nk=Gt,bg=TypeError,Sg=hs,MR=_p,qb=zn("species"),tf=function(s,i){var r,a=Sg(s).constructor;return void 0===a||MR(r=Sg(a)[qb])?i:function(s){if(o3(s))return s;throw bg(nk(s)+" is not a constructor")}(r)},rk=TypeError,Kb=/(?:ipad|iphone|ipod).*applewebkit/i.test(Xa),qo=Zi,kR=Zv,s3=Rr,LR=vi,Ju=St,FR=pi,rd=nI,bn=ki,UR=Iw,Ca=Kb,ok=Xu,Yb=qo.setImmediate,cc=qo.clearImmediate,sk=qo.process,rf=qo.Dispatch,a3=qo.Function,Cg=qo.MessageChannel,VR=qo.String,$b=0,sf={},Xb="onreadystatechange";FR(function(){yg=qo.location});var Jb=function(s){if(Ju(sf,s)){var i=sf[s];delete sf[s],i()}},Tg=function(s){return function(){Jb(s)}},BR=function(s){Jb(s.data)},jR=function(s){qo.postMessage(VR(s),yg.protocol+"//"+yg.host)};Yb&&cc||(Yb=function(s){!function(s,i){if(s<i)throw rk("Not enough arguments")}(arguments.length,1);var i=LR(s)?s:a3(s),r=bn(arguments,1);return sf[++$b]=function(){kR(i,void 0,r)},rl($b),$b},cc=function(s){delete sf[s]},ok?rl=function(s){sk.nextTick(Tg(s))}:rf&&rf.now?rl=function(s){rf.now(Tg(s))}:Cg&&!Ca?(Gb=($u=new Cg).port2,$u.port1.onmessage=BR,rl=s3(Gb.postMessage,Gb)):qo.addEventListener&&LR(qo.postMessage)&&!qo.importScripts&&yg&&"file:"!==yg.protocol&&!FR(jR)?(rl=jR,qo.addEventListener("message",BR,!1)):rl=Xb in UR("script")?function(s){rd.appendChild(UR("script"))[Xb]=function(){rd.removeChild(this),Jb(s)}}:function(s){setTimeout(Tg(s),0)});var ak={set:Yb,clear:cc},Qb=function(){this.head=null,this.tail=null};Qb.prototype={add:function(s){var i={item:s,next:null},r=this.tail;r?r.next=i:this.head=i,this.tail=i},get:function(){var s=this.head;if(s)return null===(this.head=s.next)&&(this.tail=null),s.item}};var od,tr,wg,HR,Ig,Ta=Qb,Zb=/ipad|iphone|ipod/i.test(Xa)&&typeof Pebble<"u",ck=/web0s(?!.*chrome)/i.test(Xa),Qu=Zi,GR=Rr,Zt=ak.set,WR=Ta,lk=Kb,c3=Zb,lt=ck,tS=Xu,Rg=Qu.MutationObserver||Qu.WebKitMutationObserver,zR=Qu.document,qR=Qu.process,Zu=Qu.Promise,nS=(0,qi.f)(Qu,"queueMicrotask"),Ag=nS&&nS.value;if(!Ag){var Dg=new WR,af=function(){var s,i;for(tS&&(s=qR.domain)&&s.exit();i=Dg.get();)try{i()}catch(r){throw Dg.head&&od(),r}s&&s.enter()};lk||tS||lt||!Rg||!zR?!c3&&Zu&&Zu.resolve?((HR=Zu.resolve(void 0)).constructor=Zu,Ig=GR(HR.then,HR),od=function(){Ig(af)}):tS?od=function(){qR.nextTick(af)}:(Zt=GR(Zt,Qu),od=function(){Zt(af)}):(tr=!0,wg=zR.createTextNode(""),new Rg(af).observe(wg,{characterData:!0}),od=function(){wg.data=tr=!tr}),Ag=function(s){Dg.head||od(),Dg.add(s)}}var KR=Ag,eh=function(s){try{return{error:!1,value:s()}}catch(i){return{error:!0,value:i}}},sd=Zi.Promise,YR="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,$R=!YR&&!Xu&&"object"==typeof window&&"object"==typeof document,th=Zi,Ko=sd,nh=vi,dk=Dw,uk=ox,JR=$R,iS=YR,ad=Wn,cf=Ko&&Ko.prototype,QR=zn("species"),rS=!1,ZR=nh(th.PromiseRejectionEvent),lf={CONSTRUCTOR:dk("Promise",function(){var s=uk(Ko),i=s!==String(Ko);if(!i&&66===ad||!cf.catch||!cf.finally)return!0;if(!ad||ad<51||!/native code/.test(s)){var r=new Ko(function(l){l(1)}),a=function(l){l(function(){},function(){})};if((r.constructor={})[QR]=a,!(rS=r.then(function(){})instanceof a))return!0}return!i&&(JR||iS)&&!ZR}),REJECTION_EVENT:ZR,SUBCLASSING:rS},wa={},oS=oo,l3=TypeError,pk=function(s){var i,r;this.promise=new s(function(a,l){if(void 0!==i||void 0!==r)throw l3("Bad Promise constructor");i=a,r=l}),this.resolve=oS(i),this.reject=oS(r)};wa.f=function(s){return new pk(s)};var eA,fk,tA=Ct,df=Xu,cd=Zi,ol=Ir,nA=Dp,iA=lo,rA=oo,Og=vi,bt=ko,oA=tf,re=ak.set,ld=KR,Ng=eh,ih=Ta,Pg=Cu,dd=sd,xg=wa,rh="Promise",Mg=lf.CONSTRUCTOR,sA=lf.REJECTION_EVENT,uf=Pg.getterFor(rh),gk=Pg.set,hf=dd,kg=dd&&dd.prototype,aA=cd.TypeError,aS=cd.document,cS=cd.process,lS=xg.f,cA=lS,lA=!!(aS&&aS.createEvent&&cd.dispatchEvent),dA="unhandledrejection",uA=function(s){var i;return!(!bt(s)||!Og(i=s.then))&&i},ho=function(s,i){var r,a,l,d=i.value,h=1==i.state,p=h?s.ok:s.fail,m=s.resolve,g=s.reject,E=s.domain;try{p?(h||(2===i.rejection&&fA(i),i.rejection=1),!0===p?r=d:(E&&E.enter(),r=p(d),E&&(E.exit(),l=!0)),r===s.promise?g(aA("Promise-chain cycle")):(a=uA(r))?ol(a,r,m,g):m(r)):g(d)}catch(y){E&&!l&&E.exit(),g(y)}},hA=function(s,i){s.notified||(s.notified=!0,ld(function(){for(var r,a=s.reactions;r=a.get();)ho(r,s);s.notified=!1,i&&!s.rejection&&d3(s)}))},pA=function(s,i,r){var a,l;lA?((a=aS.createEvent("Event")).promise=i,a.reason=r,a.initEvent(s,!1,!0),cd.dispatchEvent(a)):a={promise:i,reason:r},!sA&&(l=cd["on"+s])?l(a):s===dA&&function(s,i){try{1==arguments.length?console.error(s):console.error(s,i)}catch{}}("Unhandled promise rejection",r)},d3=function(s){ol(re,cd,function(){var i,r=s.facade,a=s.value;if(Lg(s)&&(i=Ng(function(){df?cS.emit("unhandledRejection",a,r):pA(dA,r,a)}),s.rejection=df||Lg(s)?2:1,i.error))throw i.value})},Lg=function(s){return 1!==s.rejection&&!s.parent},fA=function(s){ol(re,cd,function(){var i=s.facade;df?cS.emit("rejectionHandled",i):pA("rejectionhandled",i,s.value)})},oh=function(s,i,r){return function(a){s(i,a,r)}},sh=function(s,i,r){s.done||(s.done=!0,r&&(s=r),s.value=i,s.state=2,hA(s,!0))},dS=function(s,i,r){if(!s.done){s.done=!0,r&&(s=r);try{if(s.facade===i)throw aA("Promise can't be resolved itself");var a=uA(i);a?ld(function(){var l={done:!1};try{ol(a,i,oh(dS,l,s),oh(sh,l,s))}catch(d){sh(l,d,s)}}):(s.value=i,s.state=1,hA(s,!1))}catch(l){sh({done:!1},l,s)}}};Mg&&(kg=(hf=function(s){(function(s,i){if(ek(i,s))return s;throw tk("Incorrect invocation")})(this,kg),rA(s),ol(eA,this);var i=uf(this);try{s(oh(dS,i),oh(sh,i))}catch(r){sh(i,r)}}).prototype,(eA=function(s){gk(this,{type:rh,done:!1,notified:!1,parent:!1,reactions:new ih,rejection:!1,state:0,value:void 0})}).prototype=nA(kg,"then",function(s,i){var r=uf(this),a=lS(oA(this,hf));return r.parent=!0,a.ok=!Og(s)||s,a.fail=Og(i)&&i,a.domain=df?cS.domain:void 0,0==r.state?r.reactions.add(a):ld(function(){ho(a,r)}),a.promise}),fk=function(){var s=new eA,i=uf(s);this.promise=s,this.resolve=oh(dS,i),this.reject=oh(sh,i)},xg.f=lS=function(s){return s===hf||void 0===s?new fk(s):cA(s)}),tA({global:!0,constructor:!0,wrap:!0,forced:Mg},{Promise:hf}),iA(hf,rh,!1,!0),function(s){var i=QM(s);Wb&&i&&!i[zb]&&ZM(i,zb,{configurable:!0,get:function(){return this}})}(rh);var uS=zn("iterator"),mA=!1;try{var vk=0,Fg={next:function(){return{done:!!vk++}},return:function(){mA=!0}};Fg[uS]=function(){return this},Array.from(Fg,function(){throw 2})}catch{}var yk=sd,Ug=lf.CONSTRUCTOR||!function(s,i){if(!i&&!mA)return!1;var r=!1;try{var a={};a[uS]=function(){return{next:function(){return{done:r=!0}}}},s(a)}catch{}return r}(function(s){yk.all(s).then(void 0,function(){})}),Sk=Ir,Ck=oo,Ia=wa,hS=eh,Tk=gg;Ct({target:"Promise",stat:!0,forced:Ug},{all:function(s){var i=this,r=Ia.f(i),a=r.resolve,l=r.reject,d=hS(function(){var h=Ck(i.resolve),p=[],m=0,g=1;Tk(s,function(E){var y=m++,b=!1;g++,Sk(h,i,E).then(function(T){b||(b=!0,p[y]=T,--g||a(p))},l)}),--g||a(p)});return d.error&&l(d.value),r.promise}}),Ct({target:"Promise",proto:!0,forced:lf.CONSTRUCTOR,real:!0},{catch:function(s){return this.then(void 0,s)}});var gA=Ir,EA=oo,Vg=wa,pS=eh,u3=gg;Ct({target:"Promise",stat:!0,forced:Ug},{race:function(s){var i=this,r=Vg.f(i),a=r.reject,l=pS(function(){var d=EA(i.resolve);u3(s,function(h){gA(d,i,h).then(r.resolve,a)})});return l.error&&a(l.value),r.promise}});var vA=Ir,yA=wa;Ct({target:"Promise",stat:!0,forced:lf.CONSTRUCTOR},{reject:function(s){var i=yA.f(this);return vA(i.reject,void 0,s),i.promise}});var bA=hs,SA=ko,fS=wa,Ra=function(s,i){if(bA(s),SA(i)&&i.constructor===s)return i;var r=fS.f(s);return(0,r.resolve)(i),r.promise},Ik=Ct,Rk=sd,mS=lf.CONSTRUCTOR,Ak=Ra,CA=He("Promise"),Dk=!mS;Ik({target:"Promise",stat:!0,forced:!0},{resolve:function(s){return Ak(Dk&&this===CA?Rk:this,s)}});var Bg=Ir,pf=oo,TA=wa,jg=eh,h3=gg;Ct({target:"Promise",stat:!0,forced:Ug},{allSettled:function(s){var i=this,r=TA.f(i),a=r.resolve,l=r.reject,d=jg(function(){var h=pf(i.resolve),p=[],m=0,g=1;h3(s,function(E){var y=m++,b=!1;g++,Bg(h,i,E).then(function(T){b||(b=!0,p[y]={status:"fulfilled",value:T},--g||a(p))},function(T){b||(b=!0,p[y]={status:"rejected",reason:T},--g||a(p))})}),--g||a(p)});return d.error&&l(d.value),r.promise}});var Ok=Ir,wA=oo,IA=He,Nk=wa,Pk=eh,RA=gg,_S="No one promise resolved";Ct({target:"Promise",stat:!0,forced:Ug},{any:function(s){var i=this,r=IA("AggregateError"),a=Nk.f(i),l=a.resolve,d=a.reject,h=Pk(function(){var p=wA(i.resolve),m=[],g=0,E=1,y=!1;RA(s,function(b){var T=g++,O=!1;E++,Ok(p,i,b).then(function(P){O||y||(y=!0,l(P))},function(P){O||y||(O=!0,m[T]=P,--E||d(new r(m,_S)))})}),--E||d(new r(m,_S))});return h.error&&d(h.value),a.promise}});var DA=He,xk=vi,Mk=tf,ah=Ra,kk=sd&&sd.prototype;Ct({target:"Promise",proto:!0,real:!0,forced:!!sd&&pi(function(){kk.finally.call({then:function(){}},function(){})})},{finally:function(s){var i=Mk(this,DA("Promise")),r=xk(s);return this.then(r?function(a){return ah(i,s()).then(function(){return a})}:s,r?function(a){return ah(i,s()).then(function(){throw a})}:s)}});var OA=Wl.Promise,q=lr(OA);const Lk=()=>{};function mf(){const s={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Lk};return s.promise=new q((i,r)=>{s.resolve=a=>{s.isFinished||(s.isResolved=!0,s.isFinished=!0,i(a),s.value=a)},s.reject=a=>{s.isFinished||(s.isRejected=!0,s.isFinished=!0,r(a))}}),s}const Hg=new Map,Gg=new Map,Aa=new Map;var Fn,Ne,s;(s=Fn||(Fn={})).WIN_10="Windows 10",s.WIN_81="Windows 8.1",s.WIN_8="Windows 8",s.WIN_7="Windows 7",s.WIN_VISTA="Windows Vista",s.WIN_SERVER_2003="Windows Server 2003",s.WIN_XP="Windows XP",s.WIN_2000="Windows 2000",s.ANDROID="Android",s.HARMONY_OS="HarmonyOS",s.OPEN_BSD="Open BSD",s.SUN_OS="Sun OS",s.LINUX="Linux",s.IOS="iOS",s.MAC_OS="Mac OS",s.QNX="QNX",s.UNIX="UNIX",s.BEOS="BeOS",s.OS_2="OS/2",s.SEARCH_BOT="Search Bot",function(s){s.CHROME="Chrome",s.SAFARI="Safari",s.EDGE="Edge",s.FIREFOX="Firefox",s.OPERA="OPR",s.QQ="QQBrowser",s.WECHAT="MicroMessenger"}(Ne||(Ne={}));var ES={exports:{}};!function(s,i){!function(r,a){var l="function",d="undefined",h="object",p="string",m="major",g="model",E="name",y="type",b="vendor",T="version",O="architecture",P="console",D="mobile",L="tablet",B="smarttv",V="wearable",Q="embedded",se="Amazon",K="Apple",$="BlackBerry",Y="Browser",_e="Chrome",ve="Firefox",Ze="Google",Ht="Microsoft",li="Motorola",ie="Opera",ce="Samsung",Le="Sony",ut="Xiaomi",de="Zebra",I="Facebook",F="Chromium OS",H="Mac OS",oe=function(hn){for(var An={},jt=0;jt<hn.length;jt++)An[hn[jt].toUpperCase()]=hn[jt];return An},Be=function(hn,An){return typeof hn===p&&-1!==Bt(An).indexOf(Bt(hn))},Bt=function(hn){return hn.toLowerCase()},Pi=function(hn,An){if(typeof hn===p)return hn=hn.replace(/^\s\s*/,""),typeof An===d?hn:hn.substring(0,350)},sr=function(hn,An){for(var jt,Lr,na,pn,at,wr,ia=0;ia<An.length&&!at;){var Ns=An[ia],nT=An[ia+1];for(jt=Lr=0;jt<Ns.length&&!at&&Ns[jt];)if(at=Ns[jt++].exec(hn))for(na=0;na<nT.length;na++)wr=at[++Lr],typeof(pn=nT[na])===h&&pn.length>0?2===pn.length?this[pn[0]]=typeof pn[1]==l?pn[1].call(this,wr):pn[1]:3===pn.length?this[pn[0]]=typeof pn[1]!==l||pn[1].exec&&pn[1].test?wr?wr.replace(pn[1],pn[2]):a:wr?pn[1].call(this,wr,pn[2]):a:4===pn.length&&(this[pn[0]]=wr?pn[3].call(this,wr.replace(pn[1],pn[2])):a):this[pn]=wr||a;ia+=2}},kr=function(hn,An){for(var jt in An)if(typeof An[jt]===h&&An[jt].length>0){for(var Lr=0;Lr<An[jt].length;Lr++)if(Be(An[jt][Lr],hn))return"?"===jt?a:jt}else if(Be(An[jt],hn))return"?"===jt?a:jt;return hn},mm={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Wi={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[T,[E,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[T,[E,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[E,T],[/opios[\/ ]+([\w\.]+)/i],[T,[E,ie+" Mini"]],[/\bopr\/([\w\.]+)/i],[T,[E,ie]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[E,T],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[T,[E,"UC"+Y]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[T,[E,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[T,[E,"WeChat"]],[/konqueror\/([\w\.]+)/i],[T,[E,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[T,[E,"IE"]],[/yabrowser\/([\w\.]+)/i],[T,[E,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[E,/(.+)/,"$1 Secure "+Y],T],[/\bfocus\/([\w\.]+)/i],[T,[E,ve+" Focus"]],[/\bopt\/([\w\.]+)/i],[T,[E,ie+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[T,[E,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[T,[E,"Dolphin"]],[/coast\/([\w\.]+)/i],[T,[E,ie+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[T,[E,"MIUI "+Y]],[/fxios\/([-\w\.]+)/i],[T,[E,ve]],[/\bqihu|(qi?ho?o?|360)browser/i],[[E,"360 "+Y]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[E,/(.+)/,"$1 "+Y],T],[/(comodo_dragon)\/([\w\.]+)/i],[[E,/_/g," "],T],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[E,T],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[E],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[E,I],T],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[E,T],[/\bgsa\/([\w\.]+) .*safari\//i],[T,[E,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[T,[E,_e+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[E,_e+" WebView"],T],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[T,[E,"Android "+Y]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[E,T],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[T,[E,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[T,E],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[E,[T,kr,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[E,T],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[E,"Netscape"],T],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[T,[E,ve+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[E,T],[/(cobalt)\/([\w\.]+)/i],[E,[T,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[O,"amd64"]],[/(ia32(?=;))/i],[[O,Bt]],[/((?:i[346]|x)86)[;\)]/i],[[O,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[O,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[O,"armhf"]],[/windows (ce|mobile); ppc;/i],[[O,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[O,/ower/,"",Bt]],[/(sun4\w)[;\)]/i],[[O,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[O,Bt]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[g,[b,ce],[y,L]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[g,[b,ce],[y,D]],[/\((ip(?:hone|od)[\w ]*);/i],[g,[b,K],[y,D]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[g,[b,K],[y,L]],[/(macintosh);/i],[g,[b,K]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[g,[b,"Sharp"],[y,D]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[g,[b,"Huawei"],[y,L]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[g,[b,"Huawei"],[y,D]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[g,/_/g," "],[b,ut],[y,D]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[g,/_/g," "],[b,ut],[y,L]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[g,[b,"OPPO"],[y,D]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[g,[b,"Vivo"],[y,D]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[g,[b,"Realme"],[y,D]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[g,[b,li],[y,D]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[g,[b,li],[y,L]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[g,[b,"LG"],[y,L]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[g,[b,"LG"],[y,D]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[g,[b,"Lenovo"],[y,L]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[g,/_/g," "],[b,"Nokia"],[y,D]],[/(pixel c)\b/i],[g,[b,Ze],[y,L]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[g,[b,Ze],[y,D]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[g,[b,Le],[y,D]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[g,"Xperia Tablet"],[b,Le],[y,L]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[g,[b,"OnePlus"],[y,D]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[g,[b,se],[y,L]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[g,/(.+)/g,"Fire Phone $1"],[b,se],[y,D]],[/(playbook);[-\w\),; ]+(rim)/i],[g,b,[y,L]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[g,[b,$],[y,D]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[g,[b,"ASUS"],[y,L]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[g,[b,"ASUS"],[y,D]],[/(nexus 9)/i],[g,[b,"HTC"],[y,L]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[b,[g,/_/g," "],[y,D]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[g,[b,"Acer"],[y,L]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[g,[b,"Meizu"],[y,D]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[b,g,[y,D]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[b,g,[y,L]],[/(surface duo)/i],[g,[b,Ht],[y,L]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[g,[b,"Fairphone"],[y,D]],[/(u304aa)/i],[g,[b,"AT&T"],[y,D]],[/\bsie-(\w*)/i],[g,[b,"Siemens"],[y,D]],[/\b(rct\w+) b/i],[g,[b,"RCA"],[y,L]],[/\b(venue[\d ]{2,7}) b/i],[g,[b,"Dell"],[y,L]],[/\b(q(?:mv|ta)\w+) b/i],[g,[b,"Verizon"],[y,L]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[g,[b,"Barnes & Noble"],[y,L]],[/\b(tm\d{3}\w+) b/i],[g,[b,"NuVision"],[y,L]],[/\b(k88) b/i],[g,[b,"ZTE"],[y,L]],[/\b(nx\d{3}j) b/i],[g,[b,"ZTE"],[y,D]],[/\b(gen\d{3}) b.+49h/i],[g,[b,"Swiss"],[y,D]],[/\b(zur\d{3}) b/i],[g,[b,"Swiss"],[y,L]],[/\b((zeki)?tb.*\b) b/i],[g,[b,"Zeki"],[y,L]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[b,"Dragon Touch"],g,[y,L]],[/\b(ns-?\w{0,9}) b/i],[g,[b,"Insignia"],[y,L]],[/\b((nxa|next)-?\w{0,9}) b/i],[g,[b,"NextBook"],[y,L]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[b,"Voice"],g,[y,D]],[/\b(lvtel\-)?(v1[12]) b/i],[[b,"LvTel"],g,[y,D]],[/\b(ph-1) /i],[g,[b,"Essential"],[y,D]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[g,[b,"Envizen"],[y,L]],[/\b(trio[-\w\. ]+) b/i],[g,[b,"MachSpeed"],[y,L]],[/\btu_(1491) b/i],[g,[b,"Rotor"],[y,L]],[/(shield[\w ]+) b/i],[g,[b,"Nvidia"],[y,L]],[/(sprint) (\w+)/i],[b,g,[y,D]],[/(kin\.[onetw]{3})/i],[[g,/\./g," "],[b,Ht],[y,D]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[g,[b,de],[y,L]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[g,[b,de],[y,D]],[/smart-tv.+(samsung)/i],[b,[y,B]],[/hbbtv.+maple;(\d+)/i],[[g,/^/,"SmartTV"],[b,ce],[y,B]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[b,"LG"],[y,B]],[/(apple) ?tv/i],[b,[g,K+" TV"],[y,B]],[/crkey/i],[[g,_e+"cast"],[b,Ze],[y,B]],[/droid.+aft(\w)( bui|\))/i],[g,[b,se],[y,B]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[g,[b,"Sharp"],[y,B]],[/(bravia[\w ]+)( bui|\))/i],[g,[b,Le],[y,B]],[/(mitv-\w{5}) bui/i],[g,[b,ut],[y,B]],[/Hbbtv.*(technisat) (.*);/i],[b,g,[y,B]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[b,Pi],[g,Pi],[y,B]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[y,B]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[b,g,[y,P]],[/droid.+; (shield) bui/i],[g,[b,"Nvidia"],[y,P]],[/(playstation [345portablevi]+)/i],[g,[b,Le],[y,P]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[g,[b,Ht],[y,P]],[/((pebble))app/i],[b,g,[y,V]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[g,[b,K],[y,V]],[/droid.+; (glass) \d/i],[g,[b,Ze],[y,V]],[/droid.+; (wt63?0{2,3})\)/i],[g,[b,de],[y,V]],[/(quest( 2| pro)?)/i],[g,[b,I],[y,V]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[b,[y,Q]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[g,[y,D]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[g,[y,L]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[y,L]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[y,D]],[/(android[-\w\. ]{0,9});.+buil/i],[g,[b,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[T,[E,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[T,[E,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[E,T],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[T,E]],os:[[/microsoft (windows) (vista|xp)/i],[E,T],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[E,[T,kr,mm]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[E,"Windows"],[T,kr,mm]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[T,/_/g,"."],[E,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[E,H],[T,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[T,E],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[E,T],[/\(bb(10);/i],[T,[E,$]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[T,[E,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[T,[E,ve+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[T,[E,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[T,[E,"watchOS"]],[/crkey\/([\d\.]+)/i],[T,[E,_e+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[E,F],T],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[E,T],[/(sunos) ?([\w\.\d]*)/i],[[E,"Solaris"],T],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[E,T]]},zi=function(hn,An){if(typeof hn===h&&(An=hn,hn=a),!(this instanceof zi))return new zi(hn,An).getResult();var jt=typeof r!==d&&r.navigator?r.navigator:a,Lr=hn||(jt&&jt.userAgent?jt.userAgent:""),na=jt&&jt.userAgentData?jt.userAgentData:a,pn=An?function(at,wr){var ia={};for(var Ns in at)ia[Ns]=wr[Ns]&&wr[Ns].length%2==0?wr[Ns].concat(at[Ns]):at[Ns];return ia}(Wi,An):Wi;return this.getBrowser=function(){var wr,at={};return at[E]=a,at[T]=a,sr.call(at,Lr,pn.browser),at[m]=typeof(wr=at[T])===p?wr.replace(/[^\d\.]/g,"").split(".")[0]:a,jt&&jt.brave&&typeof jt.brave.isBrave==l&&(at[E]="Brave"),at},this.getCPU=function(){var at={};return at[O]=a,sr.call(at,Lr,pn.cpu),at},this.getDevice=function(){var at={};return at[b]=a,at[g]=a,at[y]=a,sr.call(at,Lr,pn.device),!at[y]&&na&&na.mobile&&(at[y]=D),"Macintosh"==at[g]&&jt&&typeof jt.standalone!==d&&jt.maxTouchPoints&&jt.maxTouchPoints>2&&(at[g]="iPad",at[y]=L),at},this.getEngine=function(){var at={};return at[E]=a,at[T]=a,sr.call(at,Lr,pn.engine),at},this.getOS=function(){var at={};return at[E]=a,at[T]=a,sr.call(at,Lr,pn.os),!at[E]&&na&&"Unknown"!=na.platform&&(at[E]=na.platform.replace(/chrome os/i,F).replace(/macos/i,H)),at},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Lr},this.setUA=function(at){return Lr=typeof at===p&&at.length>350?Pi(at,350):at,this},this.setUA(Lr),this};zi.VERSION="0.7.34",zi.BROWSER=oe([E,T,m]),zi.CPU=oe([O]),zi.DEVICE=oe([g,b,y,P,D,B,L,V,Q]),zi.ENGINE=zi.OS=oe([E,T]),s.exports&&(i=s.exports=zi),i.UAParser=zi;var kl=typeof r!==d&&(r.jQuery||r.Zepto);if(kl&&!kl.ua){var Jd=new zi;kl.ua=Jd.getResult(),kl.ua.get=function(){return Jd.getUA()},kl.ua.set=function(hn){Jd.setUA(hn);var An=Jd.getResult();for(var jt in An)kl.ua[jt]=An[jt]}}}("object"==typeof window?window:ou)}(ES,ES.exports);const ch=new(lr(ES.exports));let lc=ch.getResult(),vS=null;function dt(s){if(!vS){s&&ch.setUA(s),lc=ch.getResult();const i=function(d){if("Blink"===d.engine.name&&"WeChat"!==d.browser.name)return Ne.CHROME;switch(d.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ne.CHROME;case"Safari":case"Mobile Safari":return Ne.SAFARI;case"Edge":return Ne.EDGE;case"Firefox":return Ne.FIREFOX;case"QQBrowser":return Ne.QQ;case"Opera":return Ne.OPERA;case"WeChat":return Ne.WECHAT;default:return d.browser.name||""}}(lc),r=function(d){let h;return h="Blink"===d.engine.name?d.engine.version||"":d.browser.version||"",h.split(".")[0]}(lc),a="Windows"===(d=lc).os.name?d.os.version?d.os.name+" "+d.os.version:d.os.name:d.os.name||"",l=lc.os.version;if(!(i&&r&&a&&l))return{name:i,version:r,os:a,osVersion:l};vS={name:i,version:r,os:a,osVersion:l}}var d;return vS}function Wg(){return dt().os}function NA(){const s=dt();return"".concat(s.os," ").concat(s.osVersion)}function zg(){const s=dt();return!!("WebKit"===lc.engine.name&&s.os===Fn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&s.name!==Ne.SAFARI||Li()&&s.name!==Ne.SAFARI)}function qg(){return dt().name===Ne.CHROME}function Ki(){return dt().name===Ne.SAFARI}function Wt(){return dt().name===Ne.FIREFOX}function Li(){return dt().os===Fn.IOS}function Kg(s){const i=dt();return!(i.name!==Ne.CHROME||!i.osVersion)&&Number(i.version)>=s}function Uk(s){const i=dt();return!(i.name!==Ne.EDGE||!i.osVersion)&&Number(i.version)>=s}function _f(s){const i=dt();return!(i.name!==Ne.OPERA||!i.osVersion)&&Number(i.version)>=s}function xA(){const s=dt();return!(s.name!==Ne.CHROME||!s.osVersion)&&Number(s.version)<=90}function MA(){const s=dt();if(s.os!==Fn.IOS||!s.osVersion)return!1;const i=s.osVersion.split(".");return Number(i[0])<14||14===Number(i[0])&&Number(i[1])<=6}function sl(){const s=dt();if(s.os!==Fn.IOS||!s.osVersion)return!1;const i=s.osVersion.split(".");return 15===Number(i[0])}function yS(){const s=dt();if(s.os!==Fn.IOS||!s.osVersion)return!1;const i=s.osVersion.split(".");return 16===Number(i[0])}function Ws(){const s=dt();if(s.os!==Fn.IOS||!s.osVersion)return!1;const i=s.osVersion.split(".");return 15===Number(i[0])&&Number(i[1])>=1}function po(){return Ki()&&navigator.maxTouchPoints>0}function _r(){return dt().name===Ne.WECHAT}function al(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function zs(){const s=dt();return s.name!==Ne.EDGE&&s.name!==Ne.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function qr(){return Wg()===Fn.ANDROID}function ii(){const s=dt();return qr()&&(s.name===Ne.CHROME||s.name===Ne.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}var x;!function(s){s.UNEXPECTED_ERROR="UNEXPECTED_ERROR",s.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",s.TIMEOUT="TIMEOUT",s.INVALID_PARAMS="INVALID_PARAMS",s.NOT_READABLE="NOT_READABLE",s.NOT_SUPPORTED="NOT_SUPPORTED",s.INVALID_OPERATION="INVALID_OPERATION",s.OPERATION_ABORTED="OPERATION_ABORTED",s.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",s.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",s.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",s.DATACHANNEL_FAILED="DATACHANNEL_FAILED",s.NETWORK_ERROR="NETWORK_ERROR",s.NETWORK_TIMEOUT="NETWORK_TIMEOUT",s.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",s.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",s.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",s.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",s.ELECTRON_IS_NULL="ELECTRON_IS_NULL",s.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",s.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",s.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",s.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",s.PERMISSION_DENIED="PERMISSION_DENIED",s.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",s.TRACK_IS_DISABLED="TRACK_IS_DISABLED",s.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",s.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",s.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",s.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",s.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",s.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",s.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",s.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",s.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",s.UID_CONFLICT="UID_CONFLICT",s.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",s.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",s.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",s.INVALID_TRACK="INVALID_TRACK",s.SENDER_NOT_FOUND="SENDER_NOT_FOUND",s.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",s.SET_ANSWER_FAILED="SET_ANSWER_FAILED",s.ICE_FAILED="ICE_FAILED",s.PC_CLOSED="PC_CLOSED",s.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",s.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",s.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",s.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",s.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",s.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",s.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",s.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",s.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",s.INVALID_REMOTE_USER="INVALID_REMOTE_USER",s.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",s.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",s.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",s.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",s.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",s.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",s.WS_ABORT="WS_ABORT",s.WS_DISCONNECT="WS_DISCONNECT",s.WS_ERR="WS_ERR",s.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",s.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",s.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",s.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",s.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",s.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",s.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",s.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",s.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",s.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",s.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",s.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",s.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",s.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",s.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",s.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",s.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",s.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",s.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",s.INVALID_PLUGIN="INVALID_PLUGIN",s.DISCONNECT_P2P="DISCONNECT_P2P",s.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",s.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",s.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",s.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",s.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",s.PROHIBITED_OPERATION="PROHIBITED_OPERATION",s.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED"}(x||(x={}));let J=class extends Error{constructor(s){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(i),C(this,"code",void 0),C(this,"message",void 0),C(this,"data",void 0),C(this,"name","AgoraRTCException"),this.code=s,this.message="AgoraRTCError ".concat(this.code,": ").concat(i),this.data=r}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),"\n").concat(this.stack):"".concat(this.stack)}print(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",i=arguments.length>1?arguments[1]:void 0;return"error"===s&&(i||console).error(this.toString()),"warning"===s&&(i||console).warn(this.toString()),this}throw(s){throw this.print("error",s),this}};function _s(s,i){if("boolean"!=typeof s)throw new J(x.INVALID_PARAMS,"Invalid ".concat(i,": The value is of the boolean type."))}function gn(s,i,r){if(!ye(r).call(r,s))throw new J(x.INVALID_PARAMS,"".concat(i," can only be set as ").concat(JSON.stringify(r)))}function ft(s,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(s<r||s>a||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&("number"!=typeof(l=s)||l%1!=0))throw new J(x.INVALID_PARAMS,"invalid ".concat(i,": the value range is [").concat(r,", ").concat(a,"]. integer only"));var l}function cl(s,i){if("number"!=typeof s){if(!(s.min||s.max||s.ideal||s.exact))throw new J(x.INVALID_PARAMS,"".concat(i," is not a valid ConstrainLong"));void 0!==s.min&&ft(s.min,"".concat(i,".min"),0,1/0),void 0!==s.max&&ft(s.max,"".concat(i,".max"),1,1/0),void 0!==s.exact&&ft(s.exact,"".concat(i,".exact"),1,1/0),void 0!==s.ideal&&ft(s.ideal,"".concat(i,".ideal"),1,1/0)}else ft(s,i,1,1/0)}function Un(s,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==s)throw new J(x.INVALID_PARAMS,"".concat(i||"param"," cannot be empty"));if(!bS(s,r,a,l))throw new J(x.INVALID_PARAMS,"Invalid ".concat(i||"string param",": Length of the string: [").concat(r,",").concat(a,"].").concat(l?" ASCII characters only.":""))}function fo(s,i){if(!Array.isArray(s))throw new J(x.INVALID_PARAMS,"".concat(i," should be an array"))}function kt(s){return null==s}function bS(s){return"string"==typeof s&&s.length<=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:255)&&s.length>=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)&&(!(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])||function(l){if("string"!=typeof l)return!1;for(let d=0;d<l.length;d+=1){const h=l.charCodeAt(d);if(h<0||h>255)return!1}return!0}(s))}function SS(s,i,r){if("getBigUint64"in DataView.prototype)return s.getBigUint64(i,r);const a=s.getUint32(i,r),l=s.getUint32(i+4,r),d=+!!r,h=+!r;return BigInt(a*h+l*d)<<BigInt(32)|BigInt(a*d+l*h)}function CS(s,i,r,a){if("setBigUint64"in DataView.prototype)return s.setBigUint64(i,r,a);const l=Number(r>>BigInt(32)),d=Number(r&BigInt(4294967295));a?(s.setUint32(i+4,l,a),s.setUint32(i,d,a)):(s.setUint32(i,l,a),s.setUint32(i+4,d,a))}var ud,gf;(function(s){s.COVERED="COVERED",s.POSITION="POSITION",s.SIZE="SIZE",s.STYLE="STYLE"})(ud||(ud={})),function(s){s.UNMOUNTED="UNMOUNTED",s.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(gf||(gf={}));const TS=new class{constructor(){C(this,"_clientSize",null),C(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),C(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),C(this,"getStyle",s=>window.getComputedStyle(s,null)),C(this,"checkCssVisibleProperty",s=>{var i;let r=!0;const a=this.getStyle(s),{display:l,visibility:d,opacity:h,filter:p}=a;return("none"===l||ye(i=["hidden","collapse"]).call(i,d)||Number(h)<.1)&&(r=!1),!!r&&(p&&p.split(" ").filter(m=>{var g;const E=m.split("(")[0];return ye(g=["brightness","blur","opacity"]).call(g,E)}).map(m=>{const[g,E]=m.split(/\(|\)/);return[g,Number(E.match(/^[0-9\.]+/))]}).forEach(m=>{const[g,E]=m;switch(g){case"brightness":(E<.1||E>3)&&(r=!1);break;case"blur":E>3&&(r=!1);break;case"opacity":E<.1&&(r=!1)}}),r)}),C(this,"checkPropertyUpToAllParentNodes",(s,i)=>{let r=!0,a=!0;let d=s;for(;d&&a;)i(d)||(r=!1,a=!1),d=d.parentElement,d||(a=!1);return r}),C(this,"checkActualCssVisibleIncludeInherit",s=>this.checkPropertyUpToAllParentNodes(s,this.checkCssVisibleProperty)),C(this,"getSizeAboutClient",s=>{const{width:i,height:r,left:a,right:l,top:d,bottom:h}=s.getBoundingClientRect(),p=this.getClientWidth(),m=this.getClientHeight();return{width:i,height:r,left:a,right:l,top:d,bottom:h,clientWidth:p,clientHeight:m,clientMin:Math.min(p,m)}}),C(this,"checkActualSize",()=>{const{width:s,height:i,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(s,i,r)}),C(this,"elementFromPoint",(s,i)=>document.elementFromPoint?document.elementFromPoint(s,i):null),C(this,"checkCoverForAPoint",(s,i,r)=>{const a=this.elementFromPoint(s,i);return null!==a&&a!==r}),C(this,"getPointPositionList",()=>{const{width:s,height:i,left:r,top:a}=this._clientSize,l=s/6,d=i/6,h=[],p=10**6;for(let m=0;m<5;m++)for(let g=0;g<5;g++)h.push({x:(r*p+(0===m?.1:4===m?(l*m*p-1e5)/p:l*m)*p)/p,y:(a*p+(0===g?.1:4===g?(d*g*p-1e5)/p:d*g)*p)/p});return[...h]}),C(this,"checkElementCover",s=>this.getPointPositionList().map(i=>this.checkCoverForAPoint(i.x,i.y,s)).filter(i=>!!i).length>6),C(this,"checkSizeIsVisible",(s,i,r)=>(s>50||r/s<=10)&&(i>50||r/i<=10)),C(this,"checkSizeOfPartInClient",()=>{const{left:s,right:i,top:r,bottom:a,clientHeight:l,clientWidth:d,clientMin:h}=this._clientSize;let p,m,g,E;if(s<0)p=0;else{if(!(s<d))return!1;p=s}if(i<0)return!1;if(m=i<d?i:d,r<0)g=0;else{if(!(r<l))return!1;g=r}return!(a<0)&&(E=a<l?a:l,this.checkSizeIsVisible(m-p,E-g,h))}),C(this,"returnHiddenResult",s=>(this._clientSize=null,{visible:!1,reason:s})),C(this,"checkOneElementVisible",s=>{if(s instanceof HTMLElement){if(this.checkElementIsMountedOnDom(s)){if(this.checkActualCssVisibleIncludeInherit(s)){if(this._clientSize=this.getSizeAboutClient(s),this.checkElementCover(s))return this.returnHiddenResult(ud.COVERED);{const i=this.checkActualSize(),r=this.checkSizeOfPartInClient();return i&&!r?this.returnHiddenResult(ud.POSITION):i?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(ud.SIZE)}}return this.returnHiddenResult(ud.STYLE)}return this.returnHiddenResult(gf.UNMOUNTED)}return this.returnHiddenResult(gf.INVALID_HTML_ELEMENT)}),C(this,"checkElementIsMountedOnDom",s=>this.checkPropertyUpToAllParentNodes(s,i=>"HTML"!==i.nodeName.toUpperCase()?null!==i.parentElement:!!document.documentElement))}};function Yg(s){return(new TextEncoder).encode(s)}const wS=function(s,i){const r=new Uint8Array(s.byteLength+i.byteLength);return r.set(new Uint8Array(s),0),r.set(new Uint8Array(i),s.byteLength),r},kA=function(){var s=M(function*(i){const r=function(h){const p=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),m=new Uint8Array(new ArrayBuffer(p.length));for(let g=0;g<p.length;g+=1)m[g]=p.charCodeAt(g);return m}(),a=yield window.crypto.subtle.importKey("spki",r,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),l=Yg(i),d=yield window.crypto.subtle.encrypt({name:"RSA-OAEP"},a,l);return function(h){let p="";for(let m=0;m<h.length;m+=1)p+=String.fromCharCode(h[m]);return window.btoa(p)}(new Uint8Array(d))});return function(r){return s.apply(this,arguments)}}(),IS=function(){var s=M(function*(i){return function(r,a){let l="";return new Uint8Array(r).forEach(d=>{l+=d.toString(16).padStart(2,"0")}),l}(yield crypto.subtle.digest("SHA-256",Yg(i)))});return function(r){return s.apply(this,arguments)}}();class zt{constructor(){C(this,"_events",{}),C(this,"addListener",this.on)}getListeners(i){return this._events[i]?this._events[i].map(r=>r.listener):[]}on(i,r){this._events[i]||(this._events[i]=[]);const a=this._events[i];-1===this._indexOfListener(a,r)&&a.push({listener:r,once:!1})}once(i,r){this._events[i]||(this._events[i]=[]);const a=this._events[i];-1===this._indexOfListener(a,r)&&a.push({listener:r,once:!0})}off(i,r){if(!this._events[i])return;const a=this._events[i],l=this._indexOfListener(a,r);-1!==l&&a.splice(l,1),0===this._events[i].length&&delete this._events[i]}removeAllListeners(i){i?delete this._events[i]:this._events={}}emit(i){this._events[i]||(this._events[i]=[]);const r=this._events[i].map(h=>h);for(var a=arguments.length,l=new Array(a>1?a-1:0),d=1;d<a;d++)l[d-1]=arguments[d];for(let h=0;h<r.length;h+=1){const p=r[h];p.once&&this.off(i,p.listener),p.listener.apply(this,l||[])}}safeEmit(i){for(var r=arguments.length,a=new Array(r>1?r-1:0),l=1;l<r;l++)a[l-1]=arguments[l];[...this._events[i]||[]].forEach(d=>{d.once&&this.off(i,d.listener);try{d.listener.apply(this,a)}catch(h){console.error("safeEmit event:".concat(i," error ").concat(h?.toString()))}})}_indexOfListener(i,r){let a=i.length;for(;a--;)if(i[a].listener===r)return a;return-1}}let $g=null;function Vk(){if($g)return $g;if(window.electron)return $g=window.electron;if(!window.require)return null;try{return $g=window.require("electron"),$g}catch{return null}}var On,Xt,LA,Ye,Xe,qn,Yi,dc;function Xg(s){return ft(s.timeout,"config.timeout",0,1e5),ft(s.timeoutFactor,"config.timeoutFactor",0,100,!1),ft(s.maxRetryCount,"config.maxRetryConfig",0,1/0),ft(s.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function Da(s){if(!Array.isArray(s)||s.length<1)return!1;try{s.forEach(i=>{if(!i.urls)throw Error()})}catch{return!1}return!0}function Jg(s){return Un(s.turnServerURL,"turnServerURL"),Un(s.username,"username"),Un(s.password,"password"),s.udpport&&ft(s.udpport,"udpport",1,99999,!0),s.forceturn&&_s(s.forceturn,"forceturn"),s.security&&_s(s.security,"security"),s.tcpport&&ft(s.tcpport,"tcpport",1,99999,!0),!0}function Ef(s){return void 0!==s.level&&gn(s.level,"level",[1,2,3]),void 0!==s.delay&&ft(s.delay,"delay",0,3e3,!0),!0}function Jt(s,i){for(var r=arguments.length,a=new Array(r>2?r-2:0),l=2;l<r;l++)a[l-2]=arguments[l];return 0===s.getListeners(i).length?q.reject(new J(x.UNEXPECTED_ERROR,"can not emit promise")):new q((d,h)=>{s.emit(i,...a,d,h)})}function Et(s,i){if(0===s.getListeners(i).length)return q.resolve();for(var r=arguments.length,a=new Array(r>2?r-2:0),l=2;l<r;l++)a[l-2]=arguments[l];return Jt(s,i,...a)}function gr(s,i){if(0===s.getListeners(i).length)return null;for(var r=arguments.length,a=new Array(r>2?r-2:0),l=2;l<r;l++)a[l-2]=arguments[l];return uc(s,i,...a)}function uc(s,i){let r=null,a=null;for(var l=arguments.length,d=new Array(l>2?l-2:0),h=2;h<l;h++)d[h-2]=arguments[h];if(s.emit(i,...d,p=>{r=p},p=>{a=p}),null!==a)throw a;if(null===r)throw new J(x.UNEXPECTED_ERROR,"handler is not sync");return r}(function(s){s.CREATE_CLIENT="createClient",s.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",s.SET_AREA="setArea",s.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",s.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",s.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",s.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",s.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",s.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",s.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",s.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",s.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",s.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",s.START_PROXY_SERVER="Client.startProxyServer",s.STOP_PROXY_SERVER="Client.stopProxyServer",s.SET_PROXY_SERVER="Client.setProxyServer",s.SET_TURN_SERVER="Client.setTurnServer",s.SET_CLIENT_ROLE="Client.setClientRole",s.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",s.ENABLE_DUAL_STREAM="Client.enableDualStream",s.DISABLE_DUAL_STREAM="Client.disableDualStream",s.JOIN="Client.join",s.LEAVE="Client.leave",s.PUBLISH="Client.publish",s.UNPUBLISH="Client.unpublish",s.SUBSCRIBE="Client.subscribe",s.MASS_SUBSCRIBE="Client.massSubscribe",s.MASS_UNSUBSCRIBE="Client.massUnsubscribe",s.UNSUBSCRIBE="Client.unsubscribe",s.RENEW_TOKEN="Client.renewToken",s.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",s.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",s.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",s.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",s.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",s.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",s.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",s.DATACHANNEL_FAILBACK="Client._datachannelFailback",s.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",s.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",s.START_LIVE_STREAMING="Client.startLiveStreaming",s.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",s.STOP_LIVE_STREAMING="Client.stopLiveStreaming",s.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",s.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",s.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",s.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",s.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",s.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",s.SET_CONFIG_DISTRIBUTE="_configDistribute",s.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",s.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",s.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",s.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",s.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",s.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",s.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",s.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",s.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",s.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",s.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",s.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",s.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",s.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",s.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",s.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",s.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",s.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",s.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",s.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",s.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",s.STREAM_TYPE_CHANGE="streamTypeChange",s.CONNECTION_STATE_CHANGE="connectionStateChange",s.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",s.IMAGE_MODERATION_UPLOAD="imageModerationUpload"})(On||(On={})),function(s){s.TRACER="tracer"}(Xt||(Xt={})),function(s){s[s.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",s[s.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",s[s.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(LA||(LA={})),function(s){s.LEAVE="LEAVE",s.NETWORK_ERROR="NETWORK_ERROR",s.SERVER_ERROR="SERVER_ERROR",s.UID_BANNED="UID_BANNED",s.IP_BANNED="IP_BANNED",s.CHANNEL_BANNED="CHANNEL_BANNED",s.FALLBACK="FALLBACK",s.LICENSE_MISSING="LICENSE_MISSING",s.LICENSE_EXPIRED="LICENSE_EXPIRED",s.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",s.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",s.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",s.LICENSE_ILLEGAL="LICENSE_ILLEGAL",s.TOKEN_EXPIRE="TOKEN_EXPIRE"}(Ye||(Ye={})),function(s){s.CONNECTION_STATE_CHANGE="connection-state-change",s.MEDIA_RECONNECT_START="media-reconnect-start",s.MEDIA_RECONNECT_END="media-reconnect-end",s.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",s.USER_JOINED="user-joined",s.USER_LEAVED="user-left",s.USER_PUBLISHED="user-published",s.USER_UNPUBLISHED="user-unpublished",s.USER_INFO_UPDATED="user-info-updated",s.CLIENT_BANNED="client-banned",s.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",s.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",s.VOLUME_INDICATOR="volume-indicator",s.CRYPT_ERROR="crypt-error",s.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",s.NETWORK_QUALITY="network-quality",s.STREAM_TYPE_CHANGED="stream-type-changed",s.STREAM_FALLBACK="stream-fallback",s.RECEIVE_METADATA="receive-metadata",s.STREAM_MESSAGE="stream-message",s.LIVE_STREAMING_ERROR="live-streaming-error",s.LIVE_STREAMING_WARNING="live-streaming-warning",s.INJECT_STREAM_STATUS="stream-inject-status",s.EXCEPTION="exception",s.ERROR="error",s.P2P_LOST="p2p_lost",s.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",s.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",s.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",s.PUBLISHED_USER_LIST="published-user-list",s.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",s.CONTENT_INSPECT_ERROR="content-inspect-error",s.CONTENT_INSPECT_RESULT="content-inspect-result",s.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}(Xe||(Xe={})),function(s){s.NETWORK_ERROR="NETWORK_ERROR",s.SERVER_ERROR="SERVER_ERROR",s.MULTI_IP="MULTI_IP",s.TIMEOUT="TIMEOUT",s.OFFLINE="OFFLINE",s.LEAVE="LEAVE",s.P2P_FAILED="P2P_FAILED",s.FALLBACK="FALLBACK"}(qn||(qn={})),function(s){s.ONLINE="ONLINE",s.OFFLINE="OFFLINE"}(Yi||(Yi={})),function(s){s.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",s.ONLINE="ONLINE",s.OFFLINE="OFFLINE"}(dc||(dc={}));const on=new class extends zt{set networkState(s){this.emit(dc.NETWORK_STATE_CHANGE,s,this._networkState),s===Yi.ONLINE?this.emit(dc.ONLINE):s===Yi.OFFLINE&&(this.onlineWaiter=new q(i=>{this.once(dc.ONLINE,()=>{this.onlineWaiter=void 0,i(Yi.ONLINE)})}),this.emit(dc.OFFLINE)),this._networkState=s}get networkState(){return this._networkState}get isOnline(){return this._networkState===Yi.ONLINE}constructor(){super(),C(this,"_moduleName","network-indicator"),C(this,"_networkState",Yi.ONLINE),C(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Yi.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Yi.OFFLINE})}};function FA(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function hd(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?FA(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):FA(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function RS(s,i){const r=s.indexOf(i);-1!==r&&s.splice(r,1)}function lh(s){const i=[];return s.forEach(r=>{-1===i.indexOf(r)&&i.push(r)}),i}function mo(s){void 0!==q?q.resolve().then(s):setTimeout(s,0)}function un(s){return JSON.parse(JSON.stringify(s))}function Oa(s){try{return un(s)}catch{return s}}const Bk={};function vf(s,i){Bk[i]||(Bk[i]=!0,s())}function Qg(s){const i=window.atob(s),r=new Uint8Array(new ArrayBuffer(i.length));for(let a=0;a<i.length;a+=1)r[a]=i.charCodeAt(a);return r}function dh(s){let i="";for(let r=0;r<s.length;r+=1)i+=String.fromCharCode(s[r]);return window.btoa(i)}function Na(s){return window.TextEncoder?(new TextEncoder).encode(s).length:s.length}function AS(s){let i=0;return/DingTalk/i.test(navigator.userAgent)&&s.realFormData&&(s=s.realFormData),s.forEach(r=>{i+="string"==typeof r?Na(r):r.size}),i+138}function jk(s){const i=new J(x.TIMEOUT,"timeout");return new q((r,a)=>{window.setTimeout(()=>a(i),s)})}function _i(s){return new q(i=>{window.setTimeout(i,s)})}function Fe(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,i=arguments.length>1?arguments[1]:void 0;const r=Math.random().toString(16).substr(2,s).toLowerCase();return r.length===s?"".concat(i).concat(r):"".concat(i).concat(r)+Fe(s-r.length,"")}function Zg(){return Fe(32,"").toUpperCase()}const yf=()=>{},UA=new class{constructor(){C(this,"fnMap",new Map)}throttleByKey(s,i,r,a){for(var l=arguments.length,d=new Array(l>4?l-4:0),h=4;h<l;h++)d[h-4]=arguments[h];if(this.fnMap.has(i)){const p=this.fnMap.get(i);if(p.threshold!==r){p.fn(...p.args),clearTimeout(p.timer);const m=window.setTimeout(()=>{const g=this.fnMap.get(i);g&&g.fn(...g.args),this.fnMap.delete(i)},r);this.fnMap.set(i,{fn:s,threshold:r,timer:m,args:d,skipFn:a})}else p.skipFn&&p.skipFn(...p.args),this.fnMap.set(i,hd(hd({},p),{},{fn:s,args:d,skipFn:a}))}else{const p=window.setTimeout(()=>{const m=this.fnMap.get(i);m&&m.fn(...m.args),this.fnMap.delete(i)},r);this.fnMap.set(i,{fn:s,threshold:r,timer:p,args:d,skipFn:a})}}},VA=UA.throttleByKey.bind(UA);function BA(s){return"object"==typeof s&&null!==s&&!(s instanceof RegExp)}function pd(s,i){if(!BA(s)||!BA(i)||Array.isArray(s)&&!Array.isArray(i)||!Array.isArray(s)&&Array.isArray(i))return i;if(Array.isArray(i)&&Array.isArray(s)){const r=[...s];for(let a=0;a<i.length;a++)r[a]=pd(s[a],i[a]);return r}{const r=hd({},s);for(const a in i)Object.prototype.hasOwnProperty.call(i,a)&&(r[a]=Object.prototype.hasOwnProperty.call(s,a)?pd(s[a],i[a]):i[a]);return r}}let Qe=1,uh=console;class Zn{static setLogger(i){uh=i}constructor(i){C(this,"lockingPromise",q.resolve()),C(this,"locks",0),C(this,"name",""),C(this,"lockId",void 0),this.lockId=Qe++,i&&(this.name=i),uh.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(i){let r;this.locks+=1,uh.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat("string"==typeof i?i:""));const a=new q(d=>{r=()=>{this.locks-=1,uh.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat("string"==typeof i?i:"")),d()}}),l=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>a),l}}function Pe(s,i){return function(r,a,l){const d=l.value;if("function"!=typeof d)throw new Error("Cannot use mutex on object property.");return l.value=M(function*(){const h=this[i];if(!h)throw new Error("mutex property key ".concat(i," doesn't exist on ").concat(s));const p=yield h.lock("From ".concat(s,".").concat(a));try{for(var m=arguments.length,g=new Array(m),E=0;E<m;E++)g[E]=arguments[E];return yield d.apply(this,g)}finally{p()}}),l}}const Re={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function wt(s,i){const r=Math.floor(i.timeout*Math.pow(i.timeoutFactor,s));return Math.min(i.maxRetryTimeout,r)}function gs(s,i,r,a){const l=Object.assign({},Re,a);let d=l.timeout;const h=function(){var g=M(function*(){var E;yield(E=d,new q(y=>{window.setTimeout(y,E)})),d*=l.timeoutFactor,d=Math.min(l.maxRetryTimeout,d)});return function(){return g.apply(this,arguments)}}();let p=!1;const m=new q(function(){var g=M(function*(E,y){i=i||(()=>!1),r=r||(()=>!0);for(let b=0;b<l.maxRetryCount;b+=1){if(p)return y(new J(x.OPERATION_ABORTED));try{const T=yield s();if(!i(T,b)||b+1===l.maxRetryCount)return E(T);yield h()}catch(T){if(!r(T,b)||b+1===l.maxRetryCount)return y(T);yield h()}}});return function(E,y){return g.apply(this,arguments)}}());return m.cancel=()=>p=!0,m}var Hk=oo,Gk=cu,Wk=mp,bf=ps,Sf=TypeError,DS=function(s){return function(i,r,a,l){Hk(r);var d=Gk(i),h=Wk(d),p=bf(d),m=s?p-1:0,g=s?-1:1;if(a<2)for(;;){if(m in h){l=h[m],m+=g;break}if(m+=g,s?m<0:p<=m)throw Sf("Reduce of empty array with no initial value")}for(;s?m>=0:p>m;m+=g)m in h&&(l=r(l,h[m],m,d));return l}},jA=[DS(!1),DS(!0)][0];Ct({target:"Array",proto:!0,forced:!Xu&&Wn>79&&Wn<83||!Hu("reduce")},{reduce:function(s){var i=arguments.length;return jA(this,s,i,i>1?arguments[1]:void 0)}});var zk=ke("Array").reduce,qk=Ms,hh=zk,fd=Array.prototype,ll=lr(function(s){var i=s.reduce;return s===fd||qk(fd,s)&&i===fd.reduce?hh:i});let en=class{constructor(s){C(this,"input",[]),C(this,"size",void 0),this.size=s}add(s){this.input.push(s),this.input.length>this.size&&this.input.splice(0,1)}mean(){var s;return 0===this.input.length?0:ll(s=this.input).call(s,(i,r)=>i+r)/this.input.length}};var eE,OS={exports:{}},NS=function(s,i){return function(){for(var r=new Array(arguments.length),a=0;a<r.length;a++)r[a]=arguments[a];return s.apply(i,r)}},HA=NS,tE=Object.prototype.toString,tn=(eE=Object.create(null),function(s){var i=tE.call(s);return eE[i]||(eE[i]=i.slice(8,-1).toLowerCase())});function md(s){return s=s.toLowerCase(),function(i){return tn(i)===s}}function _d(s){return Array.isArray(s)}function nr(s){return void 0===s}var PS=md("ArrayBuffer");function nE(s){return null!==s&&"object"==typeof s}function Cf(s){if("object"!==tn(s))return!1;var i=Object.getPrototypeOf(s);return null===i||i===Object.prototype}var GA=md("Date"),WA=md("File"),zA=md("Blob"),qA=md("FileList");function iE(s){return"[object Function]"===tE.call(s)}var KA=md("URLSearchParams");function rE(s,i){if(null!=s)if("object"!=typeof s&&(s=[s]),_d(s))for(var r=0,a=s.length;r<a;r++)i.call(null,s[r],r,s);else for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&i.call(null,s[l],l,s)}var ph,dl=(ph=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(s){return ph&&s instanceof ph}),Er={isArray:_d,isArrayBuffer:PS,isBuffer:function(s){return null!==s&&!nr(s)&&null!==s.constructor&&!nr(s.constructor)&&"function"==typeof s.constructor.isBuffer&&s.constructor.isBuffer(s)},isFormData:function(s){var i="[object FormData]";return s&&("function"==typeof FormData&&s instanceof FormData||tE.call(s)===i||iE(s.toString)&&s.toString()===i)},isArrayBufferView:function(s){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(s):s&&s.buffer&&PS(s.buffer)},isString:function(s){return"string"==typeof s},isNumber:function(s){return"number"==typeof s},isObject:nE,isPlainObject:Cf,isUndefined:nr,isDate:GA,isFile:WA,isBlob:zA,isFunction:iE,isStream:function(s){return nE(s)&&iE(s.pipe)},isURLSearchParams:KA,isStandardBrowserEnv:function(){return(typeof navigator>"u"||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&typeof window<"u"&&typeof document<"u"},forEach:rE,merge:function s(){var i={};function r(d,h){i[h]=Cf(i[h])&&Cf(d)?s(i[h],d):Cf(d)?s({},d):_d(d)?d.slice():d}for(var a=0,l=arguments.length;a<l;a++)rE(arguments[a],r);return i},extend:function(s,i,r){return rE(i,function(a,l){s[l]=r&&"function"==typeof a?HA(a,r):a}),s},trim:function(s){return s.trim?s.trim():s.replace(/^\s+|\s+$/g,"")},stripBOM:function(s){return 65279===s.charCodeAt(0)&&(s=s.slice(1)),s},inherits:function(s,i,r,a){s.prototype=Object.create(i.prototype,a),s.prototype.constructor=s,r&&Object.assign(s.prototype,r)},toFlatObject:function(s,i,r){var a,l,d,h={};i=i||{};do{for(l=(a=Object.getOwnPropertyNames(s)).length;l-- >0;)h[d=a[l]]||(i[d]=s[d],h[d]=!0);s=Object.getPrototypeOf(s)}while(s&&(!r||r(s,i))&&s!==Object.prototype);return i},kindOf:tn,kindOfTest:md,endsWith:function(s,i,r){s=String(s),(void 0===r||r>s.length)&&(r=s.length);var a=s.indexOf(i,r-=i.length);return-1!==a&&a===r},toArray:function(s){if(!s)return null;var i=s.length;if(nr(i))return null;for(var r=new Array(i);i-- >0;)r[i]=s[i];return r},isTypedArray:dl,isFileList:qA},fh=Er;function oE(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var ul=function(s,i,r){if(!i)return s;var a;if(r)a=r(i);else if(fh.isURLSearchParams(i))a=i.toString();else{var l=[];fh.forEach(i,function(h,p){null!=h&&(fh.isArray(h)?p+="[]":h=[h],fh.forEach(h,function(m){fh.isDate(m)?m=m.toISOString():fh.isObject(m)&&(m=JSON.stringify(m)),l.push(oE(p)+"="+oE(m))}))}),a=l.join("&")}if(a){var d=s.indexOf("#");-1!==d&&(s=s.slice(0,d)),s+=(-1===s.indexOf("?")?"?":"&")+a}return s},xS=Er;function sE(){this.handlers=[]}sE.prototype.use=function(s,i,r){return this.handlers.push({fulfilled:s,rejected:i,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},sE.prototype.eject=function(s){this.handlers[s]&&(this.handlers[s]=null)},sE.prototype.forEach=function(s){xS.forEach(this.handlers,function(i){null!==i&&s(i)})};var aE,Kk,p3=sE,Yk=Er;function mh(){if(Kk)return aE;Kk=1;var s=Er;function i(l,d,h,p,m){Error.call(this),this.message=l,this.name="AxiosError",d&&(this.code=d),h&&(this.config=h),p&&(this.request=p),m&&(this.response=m)}s.inherits(i,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var r=i.prototype,a={};return["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(l){a[l]={value:l}}),Object.defineProperties(i,a),Object.defineProperty(r,"isAxiosError",{value:!0}),i.from=function(l,d,h,p,m,g){var E=Object.create(r);return s.toFlatObject(l,E,function(y){return y!==Error.prototype}),i.call(E,l.message,d,h,p,m),E.name=l.name,g&&Object.assign(E,g),E},aE=i}var cE,YA,Fi,MS,kS,$A,LS={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};function XA(){if(YA)return cE;YA=1;var s=Er;return cE=function(i,r){r=r||new FormData;var a=[];function l(d){return null===d?"":s.isDate(d)?d.toISOString():s.isArrayBuffer(d)||s.isTypedArray(d)?"function"==typeof Blob?new Blob([d]):Buffer.from(d):d}return function d(h,p){if(s.isPlainObject(h)||s.isArray(h)){if(-1!==a.indexOf(h))throw Error("Circular reference detected in "+p);a.push(h),s.forEach(h,function(m,g){if(!s.isUndefined(m)){var E,y=p?p+"."+g:g;if(m&&!p&&"object"==typeof m)if(s.endsWith(g,"{}"))m=JSON.stringify(m);else if(s.endsWith(g,"[]")&&(E=s.toArray(m)))return void E.forEach(function(b){!s.isUndefined(b)&&r.append(y,l(b))});d(m,y)}}),a.pop()}else r.append(p,l(h))}(i),r}}var hl,ZA,eD,FS,tD,US,$k,lE,Vt,qs,nD,iD,Es=function(s,i){return s&&!function(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}(i)?function(s,i){return i?s.replace(/\/+$/,"")+"/"+i.replace(/^\/+/,""):s}(s,i):i};function dE(){if(US)return tD;US=1;var s=mh();function i(r){s.call(this,r??"canceled",s.ERR_CANCELED),this.name="CanceledError"}return Er.inherits(i,s,{__CANCEL__:!0}),tD=i}var ir=Er,uE=function(s,i){Yk.forEach(s,function(r,a){a!==i&&a.toUpperCase()===i.toUpperCase()&&(s[i]=r,delete s[a])})},_h=mh(),Qk=LS,sD=XA(),Zk={"Content-Type":"application/x-www-form-urlencoded"};function aD(s,i){!ir.isUndefined(s)&&ir.isUndefined(s["Content-Type"])&&(s["Content-Type"]=i)}var VS,Tf={transitional:Qk,adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&"[object process]"===Object.prototype.toString.call(process))&&(VS=function Jk(){if(qs)return Vt;qs=1;var s=Er,i=function JA(){if(MS)return Fi;MS=1;var s=mh();return Fi=function(i,r,a){var l=a.config.validateStatus;a.status&&l&&!l(a.status)?r(new s("Request failed with status code "+a.status,[s.ERR_BAD_REQUEST,s.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a)):i(a)}}(),r=function QA(){if($A)return kS;$A=1;var s=Er;return kS=s.isStandardBrowserEnv()?{write:function(i,r,a,l,d,h){var p=[];p.push(i+"="+encodeURIComponent(r)),s.isNumber(a)&&p.push("expires="+new Date(a).toGMTString()),s.isString(l)&&p.push("path="+l),s.isString(d)&&p.push("domain="+d),!0===h&&p.push("secure"),document.cookie=p.join("; ")},read:function(i){var r=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove:function(i){this.write(i,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}}(),a=ul,l=Es,d=function rD(){if(ZA)return hl;ZA=1;var s=Er,i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return hl=function(r){var a,l,d,h={};return r&&s.forEach(r.split("\n"),function(p){if(d=p.indexOf(":"),a=s.trim(p.substr(0,d)).toLowerCase(),l=s.trim(p.substr(d+1)),a){if(h[a]&&i.indexOf(a)>=0)return;h[a]="set-cookie"===a?(h[a]?h[a]:[]).concat([l]):h[a]?h[a]+", "+l:l}}),h}}(),h=function oD(){if(FS)return eD;FS=1;var s=Er;return eD=s.isStandardBrowserEnv()?function(){var i,r=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement("a");function l(d){var h=d;return r&&(a.setAttribute("href",h),h=a.href),a.setAttribute("href",h),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,""):"",host:a.host,search:a.search?a.search.replace(/^\?/,""):"",hash:a.hash?a.hash.replace(/^#/,""):"",hostname:a.hostname,port:a.port,pathname:"/"===a.pathname.charAt(0)?a.pathname:"/"+a.pathname}}return i=l(window.location.href),function(d){var h=s.isString(d)?l(d):d;return h.protocol===i.protocol&&h.host===i.host}}():function(){return!0}}(),p=LS,m=mh(),g=dE(),E=function Xk(){return lE||(lE=1,$k=function(s){var i=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return i&&i[1]||""}),$k}();return Vt=function(y){return new Promise(function(b,T){var O,P=y.data,D=y.headers,L=y.responseType;function B(){y.cancelToken&&y.cancelToken.unsubscribe(O),y.signal&&y.signal.removeEventListener("abort",O)}s.isFormData(P)&&s.isStandardBrowserEnv()&&delete D["Content-Type"];var V=new XMLHttpRequest;if(y.auth){var Q=y.auth.username||"",se=y.auth.password?unescape(encodeURIComponent(y.auth.password)):"";D.Authorization="Basic "+btoa(Q+":"+se)}var K=l(y.baseURL,y.url);function ee(){if(V){var _e="getAllResponseHeaders"in V?d(V.getAllResponseHeaders()):null;i(function(Ze){b(Ze),B()},function(Ze){T(Ze),B()},{data:L&&"text"!==L&&"json"!==L?V.response:V.responseText,status:V.status,statusText:V.statusText,headers:_e,config:y,request:V}),V=null}}if(V.open(y.method.toUpperCase(),a(K,y.params,y.paramsSerializer),!0),V.timeout=y.timeout,"onloadend"in V?V.onloadend=ee:V.onreadystatechange=function(){V&&4===V.readyState&&(0!==V.status||V.responseURL&&0===V.responseURL.indexOf("file:"))&&setTimeout(ee)},V.onabort=function(){V&&(T(new m("Request aborted",m.ECONNABORTED,y,V)),V=null)},V.onerror=function(){T(new m("Network Error",m.ERR_NETWORK,y,V,V)),V=null},V.ontimeout=function(){var _e=y.timeout?"timeout of "+y.timeout+"ms exceeded":"timeout exceeded";y.timeoutErrorMessage&&(_e=y.timeoutErrorMessage),T(new m(_e,(y.transitional||p).clarifyTimeoutError?m.ETIMEDOUT:m.ECONNABORTED,y,V)),V=null},s.isStandardBrowserEnv()){var $=(y.withCredentials||h(K))&&y.xsrfCookieName?r.read(y.xsrfCookieName):void 0;$&&(D[y.xsrfHeaderName]=$)}"setRequestHeader"in V&&s.forEach(D,function(_e,ve){void 0===P&&"content-type"===ve.toLowerCase()?delete D[ve]:V.setRequestHeader(ve,_e)}),s.isUndefined(y.withCredentials)||(V.withCredentials=!!y.withCredentials),L&&"json"!==L&&(V.responseType=y.responseType),"function"==typeof y.onDownloadProgress&&V.addEventListener("progress",y.onDownloadProgress),"function"==typeof y.onUploadProgress&&V.upload&&V.upload.addEventListener("progress",y.onUploadProgress),(y.cancelToken||y.signal)&&(O=function(_e){V&&(T(!_e||_e&&_e.type?new g:_e),V.abort(),V=null)},y.cancelToken&&y.cancelToken.subscribe(O),y.signal&&(y.signal.aborted?O():y.signal.addEventListener("abort",O))),P||(P=null);var Y=E(K);Y&&-1===["http","https","file"].indexOf(Y)?T(new m("Unsupported protocol "+Y+":",m.ERR_BAD_REQUEST,y)):V.send(P)})}}()),VS),transformRequest:[function(s,i){if(uE(i,"Accept"),uE(i,"Content-Type"),ir.isFormData(s)||ir.isArrayBuffer(s)||ir.isBuffer(s)||ir.isStream(s)||ir.isFile(s)||ir.isBlob(s))return s;if(ir.isArrayBufferView(s))return s.buffer;if(ir.isURLSearchParams(s))return aD(i,"application/x-www-form-urlencoded;charset=utf-8"),s.toString();var r,a=ir.isObject(s),l=i&&i["Content-Type"];if((r=ir.isFileList(s))||a&&"multipart/form-data"===l){var d=this.env&&this.env.FormData;return sD(r?{"files[]":s}:s,d&&new d)}return a||"application/json"===l?(aD(i,"application/json"),function(h,p,m){if(ir.isString(h))try{return(0,JSON.parse)(h),ir.trim(h)}catch(g){if("SyntaxError"!==g.name)throw g}return(0,JSON.stringify)(h)}(s)):s}],transformResponse:[function(s){var i=this.transitional||Tf.transitional,l=!(i&&i.silentJSONParsing)&&"json"===this.responseType;if(l||i&&i.forcedJSONParsing&&ir.isString(s)&&s.length)try{return JSON.parse(s)}catch(d){if(l)throw"SyntaxError"===d.name?_h.from(d,_h.ERR_BAD_RESPONSE,this,null,this.response):d}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:iD?nD:(iD=1,nD=null)},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};ir.forEach(["delete","get","head"],function(s){Tf.headers[s]={}}),ir.forEach(["post","put","patch"],function(s){Tf.headers[s]=ir.merge(Zk)});var wf,cD,hE=Tf,Dr=Er,lD=hE;function dD(){return cD?wf:(cD=1,wf=function(s){return!(!s||!s.__CANCEL__)})}var uD=Er,hc=function(s,i,r){var a=this||lD;return Dr.forEach(r,function(l){s=l.call(a,s,i)}),s},If=dD(),hD=hE,pD=dE();function pE(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new pD}var BS,jS,_o=Er,HS=function(s,i){i=i||{};var r={};function a(g,E){return _o.isPlainObject(g)&&_o.isPlainObject(E)?_o.merge(g,E):_o.isPlainObject(E)?_o.merge({},E):_o.isArray(E)?E.slice():E}function l(g){return _o.isUndefined(i[g])?_o.isUndefined(s[g])?void 0:a(void 0,s[g]):a(s[g],i[g])}function d(g){if(!_o.isUndefined(i[g]))return a(void 0,i[g])}function h(g){return _o.isUndefined(i[g])?_o.isUndefined(s[g])?void 0:a(void 0,s[g]):a(void 0,i[g])}function p(g){return g in i?a(s[g],i[g]):g in s?a(void 0,s[g]):void 0}var m={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:p};return _o.forEach(Object.keys(s).concat(Object.keys(i)),function(g){var E=m[g]||l,y=E(g);_o.isUndefined(y)&&E!==p||(r[g]=y)}),r};function GS(){return jS?BS:(jS=1,BS={version:"0.27.2"})}var eL=GS().version,pl=mh(),WS={};["object","boolean","number","function","string","symbol"].forEach(function(s,i){WS[s]=function(r){return typeof r===s||"a"+(i<1?"n ":" ")+s}});var fD={};WS.transitional=function(s,i,r){function a(l,d){return"[Axios v"+eL+"] Transitional option '"+l+"'"+d+(r?". "+r:"")}return function(l,d,h){if(!1===s)throw new pl(a(d," has been removed"+(i?" in "+i:"")),pl.ERR_DEPRECATED);return i&&!fD[d]&&(fD[d]=!0,console.warn(a(d," has been deprecated since v"+i+" and will be removed in the near future"))),!s||s(l,d,h)}};var mD,_D,gD,ED,vD,yD,bD=Er,nL=ul,SD=p3,CD=function(s){return pE(s),s.headers=s.headers||{},s.data=hc.call(s,s.data,s.headers,s.transformRequest),s.headers=uD.merge(s.headers.common||{},s.headers[s.method]||{},s.headers),uD.forEach(["delete","get","head","post","put","patch","common"],function(i){delete s.headers[i]}),(s.adapter||hD.adapter)(s).then(function(i){return pE(s),i.data=hc.call(s,i.data,i.headers,s.transformResponse),i},function(i){return If(i)||(pE(s),i&&i.response&&(i.response.data=hc.call(s,i.response.data,i.response.headers,s.transformResponse))),Promise.reject(i)})},fE=HS,iL=Es,TD={assertOptions:function(s,i,r){if("object"!=typeof s)throw new pl("options must be an object",pl.ERR_BAD_OPTION_VALUE);for(var a=Object.keys(s),l=a.length;l-- >0;){var d=a[l],h=i[d];if(h){var p=s[d],m=void 0===p||h(p,d,s);if(!0!==m)throw new pl("option "+d+" must be "+m,pl.ERR_BAD_OPTION_VALUE)}else if(!0!==r)throw new pl("Unknown option "+d,pl.ERR_BAD_OPTION)}},validators:WS},gd=TD.validators;function Ed(s){this.defaults=s,this.interceptors={request:new SD,response:new SD}}Ed.prototype.request=function(s,i){"string"==typeof s?(i=i||{}).url=s:i=s||{},i.method=(i=fE(this.defaults,i)).method?i.method.toLowerCase():this.defaults.method?this.defaults.method.toLowerCase():"get";var r=i.transitional;void 0!==r&&TD.assertOptions(r,{silentJSONParsing:gd.transitional(gd.boolean),forcedJSONParsing:gd.transitional(gd.boolean),clarifyTimeoutError:gd.transitional(gd.boolean)},!1);var a=[],l=!0;this.interceptors.request.forEach(function(y){"function"==typeof y.runWhen&&!1===y.runWhen(i)||(l=l&&y.synchronous,a.unshift(y.fulfilled,y.rejected))});var d,h=[];if(this.interceptors.response.forEach(function(y){h.push(y.fulfilled,y.rejected)}),!l){var p=[CD,void 0];for(Array.prototype.unshift.apply(p,a),p=p.concat(h),d=Promise.resolve(i);p.length;)d=d.then(p.shift(),p.shift());return d}for(var m=i;a.length;){var g=a.shift(),E=a.shift();try{m=g(m)}catch(y){E(y);break}}try{d=CD(m)}catch(y){return Promise.reject(y)}for(;h.length;)d=d.then(h.shift(),h.shift());return d},Ed.prototype.getUri=function(s){s=fE(this.defaults,s);var i=iL(s.baseURL,s.url);return nL(i,s.params,s.paramsSerializer)},bD.forEach(["delete","get","head","options"],function(s){Ed.prototype[s]=function(i,r){return this.request(fE(r||{},{method:s,url:i,data:(r||{}).data}))}}),bD.forEach(["post","put","patch"],function(s){function i(r){return function(a,l,d){return this.request(fE(d||{},{method:s,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:l}))}}Ed.prototype[s]=i(),Ed.prototype[s+"Form"]=i(!0)});var zS=Er,wD=NS,Rf=Ed,ID=HS,Kr=function s(i){var r=new Rf(i),a=wD(Rf.prototype.request,r);return zS.extend(a,Rf.prototype,r),zS.extend(a,r),a.create=function(l){return s(ID(i,l))},a}(hE);Kr.Axios=Rf,Kr.CanceledError=dE(),Kr.CancelToken=function(){if(_D)return mD;_D=1;var s=dE();function i(r){if("function"!=typeof r)throw new TypeError("executor must be a function.");var a;this.promise=new Promise(function(d){a=d});var l=this;this.promise.then(function(d){if(l._listeners){var h,p=l._listeners.length;for(h=0;h<p;h++)l._listeners[h](d);l._listeners=null}}),this.promise.then=function(d){var h,p=new Promise(function(m){l.subscribe(m),h=m}).then(d);return p.cancel=function(){l.unsubscribe(h)},p},r(function(d){l.reason||(l.reason=new s(d),a(l.reason))})}return i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.prototype.subscribe=function(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]},i.prototype.unsubscribe=function(r){if(this._listeners){var a=this._listeners.indexOf(r);-1!==a&&this._listeners.splice(a,1)}},i.source=function(){var r;return{token:new i(function(a){r=a}),cancel:r}},mD=i}(),Kr.isCancel=dD(),Kr.VERSION=GS().version,Kr.toFormData=XA(),Kr.AxiosError=mh(),Kr.Cancel=Kr.CanceledError,Kr.all=function(s){return Promise.all(s)},Kr.spread=ED?gD:(ED=1,gD=function(s){return function(i){return s.apply(null,i)}}),Kr.isAxiosError=function(){if(yD)return vD;yD=1;var s=Er;return vD=function(i){return s.isObject(i)&&!0===i.isAxiosError}}(),OS.exports=Kr,OS.exports.default=Kr;var vr=lr(OS.exports);function qS(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function gh(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?qS(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):qS(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}let Af,xa=0,KS=0;function YS(s,i,r,a){return new q((l,d)=>{i.responseType=i.responseType||"json",i.data&&!r?(i.data=JSON.stringify(i.data),xa+=Na(i.data)):r&&(i.data.size?xa+=i.data.size:i.data instanceof FormData?xa+=AS(i.data):xa+=Na(JSON.stringify(i.data))),i.headers=i.headers||{},i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json",i.method="POST",i.url=s,vr.request(i).then(h=>{"string"==typeof h.data?KS+=Na(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?KS+=h.data.byteLength:KS+=Na(JSON.stringify(h.data)),a&&l({data:h.data,headers:h.headers}),l(h.data)}).catch(h=>{vr.isCancel(h)?d(new J(x.OPERATION_ABORTED,"cancel token canceled")):d("ECONNABORTED"===h.code?new J(x.NETWORK_TIMEOUT,h.message):h.response?new J(x.NETWORK_RESPONSE_ERROR,h.response.status):new J(x.NETWORK_ERROR,h.message))})})}function Eh(s,i){return RD.apply(this,arguments)}function RD(){return RD=M(function*(s,i){const r=new Blob([i.data],{type:"buffer"});return yield YS(s,gh(gh({},i),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}),RD.apply(this,arguments)}const rL=()=>void 0!==window.isSecureContext;function $S(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Te(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?$S(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):$S(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}var et;!function(s){s.SET_SESSION_ID="SET_SESSION_ID",s.SET_P2P_ID="SET_P2P_id",s.SET_DC_ID="SET_DC_id",s.SET_UID="SET_UID",s.SET_PUB_ID="SET_PUB_ID",s.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",s.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",s.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",s.AVOID_JOIN_START="AVOID_JOIN_START",s.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",s.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",s.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",s.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",s.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",s.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",s.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",s.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",s.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",s.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",s.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",s.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",s.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",s.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",s.RESET_KEY_METRICS="RESET_KEY_METRICS",s.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",s.SET_USE_P2P="SET_USE_P2P"}(et||(et={}));class Vn{constructor(i,r,a,l){C(this,"state",void 0),this.state={codec:i,audioCodec:r,mode:a,clientId:l,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1}}dispatch(i){this.state=function(r,a){switch(a.type){case et.SET_SESSION_ID:return Te(Te({},r),{},{sessionId:a.sessionId});case et.SET_P2P_ID:return Te(Te({},r),{},{p2pId:a.p2pId});case et.SET_UID:return Te(Te({},r),{},{uid:a.uid});case et.SET_PUB_ID:return Te(Te({},r),{},{pubId:a.pubId});case et.KEY_METRIC_CLIENT_CREATED:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{clientCreated:a.metric})});case et.KEY_METRIC_JOIN_START:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{joinStart:a.metric})});case et.AVOID_JOIN_START:return Te(Te({},r),{},{avoidJoinStart:a.avoidJoinStart});case et.KEY_METRIC_JOIN_END:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{joinEnd:a.metric})});case et.KEY_METRIC_REQUEST_AP_START:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{requestAPStart:a.metric})});case et.KEY_METRIC_REQUEST_AP_END:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{requestAPEnd:a.metric})});case et.KEY_METRIC_JOIN_GATEWAY_START:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{joinGatewayStart:a.metric})});case et.KEY_METRIC_JOIN_GATEWAY_END:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{joinGatewayEnd:a.metric})});case et.KEY_METRIC_PEER_CONNECTION_START:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{peerConnectionStart:a.metric})});case et.KEY_METRIC_PEER_CONNECTION_END:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{peerConnectionEnd:a.metric})});case et.KEY_METRIC_DESCRIPTION_START:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{descriptionStart:a.metric})});case et.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{signalChannelOpen:a.metric})});case et.KEY_METRIC_ICE_CONNECTION_END:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{iceConnectionEnd:a.metric})});case et.KEY_METRIC_PUBLISH:{const l=r.keyMetrics.publish,d=l.findIndex(h=>h.trackId===a.metric.trackId);return-1!==d?(l[d]=Te(Te({},l[d]),a.metric),Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{publish:[...l]})})):Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{publish:[...r.keyMetrics.publish,a.metric]})})}case et.KEY_METRIC_SUBSCRIBE:{const l=r.keyMetrics.subscribe,d=l.findIndex(h=>h.userId===a.metric.userId&&h.type===a.metric.type);return-1!==d?(l[d]=Te(Te({},l[d]),a.metric),Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{subscribe:[...l]})})):Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{subscribe:[...r.keyMetrics.subscribe,a.metric]})})}case et.SET_CLOUD_PROXY_SERVER_MODE:return r.cloudProxyServerMode=a.mode,r;case et.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof a.index?r.joinChannelServiceRecords=[...r.joinChannelServiceRecords,a.record]:(r.joinChannelServiceRecords[a.index]=Te(Te({},r.joinChannelServiceRecords[a.index]),a.record),r.joinChannelServiceRecords=[...r.joinChannelServiceRecords]),r;case et.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return r.joinChannelServiceRecords=[],r;case et.RESET_KEY_METRICS:return r.keyMetrics={publish:[],subscribe:[]},r;case et.SET_USE_DATACHANNEL:return Te(Te({},r),{},{useDataChannel:a.val});case et.SET_USE_P2P:return Te(Te({},r),{},{useP2P:a.val});default:return r}}(this.state,i)}set sessionId(i){this.dispatch({type:et.SET_SESSION_ID,sessionId:i})}get sessionId(){return this.state.sessionId}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(i){this.dispatch({type:et.SET_P2P_ID,p2pId:i})}get p2pId(){return this.state.p2pId}set dcId(i){this.dispatch({type:et.SET_DC_ID,dcId:i})}get dcId(){return this.state.dcId}set uid(i){this.dispatch({type:et.SET_UID,uid:i})}get uid(){return this.state.uid}set pubId(i){this.dispatch({type:et.SET_PUB_ID,pubId:i})}get pubId(){return this.state.pubId}set cloudProxyServerMode(i){this.dispatch({type:et.SET_CLOUD_PROXY_SERVER_MODE,mode:i})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(i){this.dispatch({type:et.SET_USE_DATACHANNEL,val:i})}get useDataChannel(){return this.state.useDataChannel}set useP2P(i){this.dispatch({type:et.SET_USE_P2P,val:i})}get useP2P(){return this.state.useP2P}clientCreated(){this.dispatch({type:et.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:et.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:et.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:et.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:et.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:et.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:et.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:et.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:et.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:et.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:et.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:et.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(i,r,a,l){this.dispatch({type:et.KEY_METRIC_PUBLISH,metric:Te(Te({trackId:i,type:r},a&&{publishStart:a}),l&&{publishEnd:l})})}subscribe(i,r,a,l,d,h,p){this.dispatch({type:et.KEY_METRIC_SUBSCRIBE,metric:Te(Te(Te(Te(Te({userId:i,type:r},a&&{subscribeStart:a}),l&&{subscribeEnd:l}),d&&{firstFrame:d}),h&&{streamAdded:h}),p&&{firstDecoded:p})})}massSubscribe(i,r,a,l){i.forEach(d=>{this.dispatch({type:et.KEY_METRIC_SUBSCRIBE,metric:Te(Te(Te({userId:d.userId,type:d.type},r&&{subscribeStart:r}),a&&{subscribeEnd:a}),l&&{firstFrame:l})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(i,r){"gateway"===i.service&&Array.isArray(i.urls)&&(i.urls=i.urls.map(a=>a.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return"number"!=typeof r?(this.dispatch({type:et.RECORD_JOIN_CHANNEL_SERVICE,record:Te(Te({},i),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(r<0||r>=this.state.joinChannelServiceRecords.length||this.dispatch({type:et.RECORD_JOIN_CHANNEL_SERVICE,record:i,index:r}),r)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:et.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:et.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(i){this.dispatch({type:et.AVOID_JOIN_START,avoidJoinStart:i})}}const Yo=function(s){if(s.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return s;const i=s.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(i&&i[1]&&i[2]){const l=i[2];return"".concat(i[1],".").concat(l)}const r=s.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(r&&r[1]&&r[2]){const l=r[2];return"".concat(r[1],".").concat(100*(Number(l)+1))}return"4.0.0.999"}("4.19.2"),XS=function(){try{return!0===JSON.parse("true")}catch{return!0}}(),JS="v4.19.2-0-g791c0f00(10/18/2023, 4:17:50 PM)",ri={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:100,PROFILE_SWITCH_INTERVAL:2e3,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,RTM2_FLAG:void 0,AP_RTM:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,USE_XR:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:1e4,P2P:!1,SHOW_P2P_LOG:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[]};function At(s,i,r){var a,l;ye(a=Object.keys(ri)).call(a,s)&&(!r&&ye(l=Object.keys(Ys)).call(l,s)||(ri[s]=i))}function j(s){return ri[s]}const Ys={};var Ui,oL;(function(s){s.h264="h264",s.h265="h265",s.vp8="vp8",s.vp9="vp9",s.av1="av1"})(Ui||(Ui={})),function(s){s.opus="opus",s.pcma="pcma",s.pcmu="pcmu",s.g722="g722"}(oL||(oL={}));const Df=new class extends zt{reportLogUploadError(s){this.emit("REPORT_LOG_UPLOAD",s)}};class AD{constructor(i){C(this,"logger",void 0),C(this,"prefixLists",[]),this.logger=i}debug(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];this.logger.debug(...this.prefixLists,...r)}info(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];this.logger.info(...this.prefixLists,...r)}warning(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];this.logger.warning(...this.prefixLists,...r)}error(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];this.logger.error(...this.prefixLists,...r)}prefix(i){return this.prefixLists.push(i),this}popPrefix(){return this.prefixLists.pop(),this}}function QS(){const s=new Date;return s.toTimeString().split(" ")[0]+":"+s.getMilliseconds()}function ZS(){const s=new Date,i=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return i?i?.[0]+":"+s.getUTCMilliseconds():s.toTimeString().split(" ")[0]+":"+s.getMilliseconds()}const go={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Of=Date.now(),vh=s=>{for(const i in go)if(Object.prototype.hasOwnProperty.call(go,i)&&go[i]===s)return i;return"DEFAULT"},w=new class{constructor(){C(this,"proxyServerURL",void 0),C(this,"logLevel",go.DEBUG),C(this,"uploadState","collecting"),C(this,"uploadLogWaitingList",[]),C(this,"uploadLogUploadingList",[]),C(this,"uploadErrorCount",0),C(this,"currentLogID",0),C(this,"url",void 0),C(this,"extLog",(s,i)=>{this.appendLogToWaitingList(s,...i)})}debug(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];const a=[go.DEBUG].concat(i);this.log.apply(this,a)}info(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];const a=[go.INFO].concat(i);this.log.apply(this,a)}warning(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];const a=[go.WARNING].concat(i);this.log.apply(this,a)}warn(){this.warning(...arguments)}error(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];const a=[go.ERROR].concat(i);this.log.apply(this,a)}upload(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];const a=[go.DEBUG].concat(i);this.uploadLog.apply(this,a)}setLogLevel(s){s=Math.min(Math.max(0,s),4),this.logLevel=s}enableLogUpload(){At("UPLOAD_LOG",!0)}disableLogUpload(){At("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(s){this.proxyServerURL=s}prefix(s){return new AD(this).prefix(s)}log(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];if(Date.now()-Of<100)return void setTimeout(()=>{this.log(...i)},Date.now()-Of);const a=Math.max(0,Math.min(4,i[0]));if(i[0]=QS()+" Agora-SDK [".concat(vh(a),"]:"),this.appendLogToWaitingList(a,...i),a<this.logLevel)return;const l=QS()+" %cAgora-SDK [".concat(vh(a),"]:");let d=[];if(!j("USE_NEW_LOG"))switch(a){case go.DEBUG:d=[l,"color: #64B5F6;"].concat(i.slice(1)),console.log.apply(console,d);break;case go.INFO:d=[l,"color: #1E88E5; font-weight: bold;"].concat(i.slice(1)),console.log.apply(console,d);break;case go.WARNING:d=[l,"color: #FB8C00; font-weight: bold;"].concat(i.slice(1)),console.warn.apply(console,d);break;case go.ERROR:d=[l,"color: #B00020; font-weight: bold;"].concat(i.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];if(Date.now()-Of<100)return void setTimeout(()=>{this.uploadLog(...i)},Date.now()-Of);const a=Math.max(0,Math.min(4,i[0]));i[0]=QS()+" Agora-SDK [".concat(vh(a),"]:"),this.appendLogToWaitingList(a,...i)}appendLogToWaitingList(s){if(!j("UPLOAD_LOG"))return;for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];Array.isArray(r[0])?r[0][0]=ZS()+" Agora-SDK [".concat(vh(s),"]:"):r[0]=ZS()+" Agora-SDK [".concat(vh(s),"]:");let l="";r.forEach(d=>{"object"==typeof d&&(d=JSON.stringify(d)),l+="".concat(d," ")}),this.uploadLogWaitingList.push({payload_str:l,log_level:s,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}uploadLogs(){var s=this;return M(function*(){const i=s.uploadLogUploadingList,r={sdk_version:Yo,process_id:j("PROCESS_ID"),payload:JSON.stringify(i)};return gs(M(function*(){const a=yield vr.post(s.url||(s.proxyServerURL?"https://".concat(s.proxyServerURL,"/ls/?h=").concat(j("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(j("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if("OK"!==a.data){const l=new Error("unexpected upload log response");throw l.response=a,l}}),()=>(s.uploadLogUploadingList=[],!1),a=>(Df.reportLogUploadError(a.response?{status:a.response.status,data:a.response.data,headers:a.response.headers,message:a.message}:a.request?{status:a.request.status,message:a.message}:{status:-1,message:a.message}),!0),{timeout:j("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:j("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})})()}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,j("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),j("UPLOAD_LOG_INTERVAL"))}).catch(s=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),j("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),j("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var DD,OD;function Nf(s){return Un(s.reportId,"params.reportId",0,100,!1),Un(s.category,"params.category",0,100,!1),Un(s.event,"params.event",0,100,!1),Un(s.label,"params.label",0,100,!1),ft(s.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(function(s){s.FREE="free",s.UPLOADING="uploading"})(DD||(DD={})),function(s){s[s.MISC=0]="MISC",s[s.INTERNAL_EVENT=1]="INTERNAL_EVENT",s[s.PUBLIC_EVENT=2]="PUBLIC_EVENT",s[s.WEB_EVENT=3]="WEB_EVENT",s[s.INTERNAL_API=4]="INTERNAL_API",s[s.WEB_API=5]="WEB_API",s[s.PUBLIC_API=6]="PUBLIC_API"}(OD||(OD={}));const sL={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var Kn,qt,Pf,eC;function tC(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function We(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?tC(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):tC(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}(function(s){s.PUBLISH="publish",s.SUBSCRIBE="subscribe",s.WS_COMPRESSOR_INIT="ws_compressor_init",s.SESSION_INIT="session_init",s.JOIN_CHOOSE_SERVER="join_choose_server",s.REQ_USER_ACCOUNT="req_user_account",s.JOIN_GATEWAY="join_gateway",s.REJOIN_GATEWAY="rejoin_gateway",s.STREAM_SWITCH="stream_switch",s.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",s.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",s.FIRST_VIDEO_RECEIVED="first_video_received",s.FIRST_AUDIO_RECEIVED="first_audio_received",s.FIRST_VIDEO_DECODE="first_video_decode",s.FIRST_AUDIO_DECODE="first_audio_decode",s.ON_ADD_AUDIO_STREAM="on_add_audio_stream",s.ON_ADD_VIDEO_STREAM="on_add_video_stream",s.ON_UPDATE_STREAM="on_update_stream",s.ON_REMOVE_STREAM="on_remove_stream",s.USER_ANALYTICS="req_user_analytics",s.PC_STATS="pc_stats"})(Kn||(Kn={})),function(s){s.SESSION="io.agora.pb.Wrtc.Session",s.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",s.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",s.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",s.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",s.PUBLISH="io.agora.pb.Wrtc.Publish",s.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",s.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",s.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",s.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",s.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",s.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",s.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",s.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",s.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",s.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",s.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",s.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",s.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",s.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",s.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",s.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",s.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",s.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",s.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",s.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",s.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",s.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",s.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",s.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",s.PC_STATS="io.agora.pb.Wrtc.PCStats"}(qt||(qt={})),function(s){s[s.WORKER_EVENT=156]="WORKER_EVENT",s[s.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(Pf||(Pf={})),function(s){s[s.SESSION=26]="SESSION",s[s.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",s[s.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",s[s.JOIN_GATEWAY=28]="JOIN_GATEWAY",s[s.PUBLISH=30]="PUBLISH",s[s.SUBSCRIBE=29]="SUBSCRIBE",s[s.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",s[s.STREAM_SWITCH=32]="STREAM_SWITCH",s[s.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",s[s.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",s[s.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",s[s.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",s[s.API_INVOKE=41]="API_INVOKE",s[s.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",s[s.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",s[s.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",s[s.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",s[s.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",s[s.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",s[s.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",s[s.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",s[s.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",s[s.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",s[s.WORKER_EVENT=156]="WORKER_EVENT",s[s.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",s[s.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",s[s.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",s[s.USER_ANALYTICS=1e4]="USER_ANALYTICS",s[s.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(eC||(eC={}));class xf{constructor(){var i=this;C(this,"baseInfoMap",new Map),C(this,"proxyServer",void 0),C(this,"eventUploadTimer",void 0),C(this,"setSessionIdTimer",void 0),C(this,"url",void 0),C(this,"backupUrl",void 0),C(this,"_appId",void 0),C(this,"keyEventUploadPendingItems",[]),C(this,"normalEventUploadPendingItems",[]),C(this,"apiInvokeUploadPendingItems",[]),C(this,"apiInvokeCount",0),C(this,"ltsList",[]),C(this,"lastSendNormalEventTime",Date.now()),C(this,"customReportCounterTimer",void 0),C(this,"customReportCount",0),C(this,"extApiInvoke",function(){var r=M(function*(a){for(const l of a){const d=We(We({},l),{},{sid:null,invokeId:++i.apiInvokeCount,tag:Xt.TRACER});i.sendApiInvoke(d)}});return function(a){return r.apply(this,arguments)}}()),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),j("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),j("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(i){return this.baseInfoMap.get(i)}adjustSessionStartTime(i){if(!this.baseInfoMap.has(i)&&!this.baseInfoMap.get(i))return void w.error("adjust session ".concat(i," start time, sid is not exist or info is undefined"));const r=this.baseInfoMap.get(i),a=Date.now(),l=r.startTime;r.startTime=a,w.debug("rewrite session ".concat(i," startTime: ").concat(a," , ").concat(a-l,"ms")),this.baseInfoMap.set(i,r)}setAppId(i){this._appId=i}reportApiInvoke(i,r,a){r.timeout=r.timeout||6e4,r.reportResult=void 0===r.reportResult||r.reportResult;const l=Date.now();this.apiInvokeCount+=1;const d=this.apiInvokeCount,h=()=>({tag:r.tag,invokeId:d,sid:i,name:r.name,apiInvokeTime:l,options:r.options,states:r.states||null}),p=!!j("SHOW_REPORT_INVOKER_LOG");p&&w.info("".concat(r.name," start"),r.options);let m=!1;_i(r.timeout).then(()=>{m||(this.sendApiInvoke(We(We({},h()),{},{error:x.API_INVOKE_TIMEOUT,success:!1})),w.debug("".concat(r.name," timeout")))});const g=new J(x.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:E=>{const y=()=>{if(m)throw g;return m=!0,this.sendApiInvoke(We(We({},h()),{},{success:!0},r.reportResult&&{result:E})),p&&w.info("".concat(r.name," onSuccess")),E};return a?VA(y,r.name+"Success",a,()=>m=!0):y()},onError:E=>{const y=()=>{if(m)throw E;m=!0,this.sendApiInvoke(We(We({},h()),{},{success:!1,error:E})),p&&w.info("".concat(r.name," onFailure"),E.toString())};return a?VA(y,r.name+"Error",a,()=>m=!0):y()}}}sessionInit(i,r){if(this.baseInfoMap.has(i))return;const a=Date.now(),l=this.createBaseInfo(i,a);l.cname=r.cname;const d=Object.assign({},{willUploadConsoleLog:j("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:XS?"global":"oversea",areas:j("AREAS")&&j("AREAS").join(",")},r.extend),h=Date.now(),p=We(We({},l),{},{eventType:Kn.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,build:JS,lts:h,elapse:h-a,extend:JSON.stringify(d),mode:r.mode,process:j("PROCESS_ID"),appType:j("APP_TYPE"),success:!0,version:Yo});this.send({type:qt.SESSION,data:p},!0)}joinChooseServer(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now(),h=We(We({},l),{},{eventType:Kn.JOIN_CHOOSE_SERVER,lts:d,eventElapse:d-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:d-a.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3});this.send({type:qt.JOIN_CHOOSE_SERVER,data:h},!0)}reqUserAccount(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now(),h=We(We({},l),{},{eventType:Kn.REQ_USER_ACCOUNT,lts:d,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:d-a.startTime,eventElapse:d-r.lts,extend:JSON.stringify(r.extend)});this.send({type:qt.REQ_USER_ACCOUNT,data:h},!0)}joinGateway(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info;r.vid&&(l.vid=r.vid),l.uid=r.uid,l.cid=r.cid;const d=Date.now(),{firstSuccess:h,avoidJoinStartTime:p,isProxy:m,addr:g}=r,E=d-(h&&p?p:a.startTime),y=We(We({},l),{},{eventType:Kn.JOIN_GATEWAY,lts:d,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,elapse:E,eventElapse:d-r.lts,firstSuccess:h,signalChannel:r.signalChannel}),b=y.success?1:0;if(r.succ&&(a.lastJoinSuccessTime=d),h)this.send({type:qt.JOIN_GATEWAY,data:y},!0);else{let T;if(g)if(m){const P=g.match(/h=(\d{1,3}-){3}\d{1,3}/g),D=g.match(/p=[0-9]{1,6}/g);T={isSuccess:b,gatewayIp:P&&P.length?P[0].split("=")[1].replace(/-/g,"."):"",port:D&&D.length?D[0].split("=")[1]:"",isProxy:m?1:0}}else{const P=g.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),D=g.match(/(:|p=)[0-9]{1,6}/g);T={isSuccess:b,gatewayIp:P&&P.length?P[0].split("//")[1].replace(/-/g,"."):"",port:D&&D.length?D[0].split(/:|p=/g)[1]:"",isProxy:m?1:0}}else T={isSuccess:b,gatewayIp:"",port:"",isProxy:m?1:0};delete y.success,delete y.eventType,delete y.firstSuccess,y.vid=Number(y.vid);const O=Object.assign({},y,T,{eventType:Kn.REJOIN_GATEWAY});this.send({type:qt.RE_JOIN_GATEWAY,data:O},!0)}}joinChannelTimeout(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=Date.now(),d=We(We({},a.info),{},{lts:l,timeout:r,elapse:l-a.startTime});this.send({type:qt.JOIN_CHANNEL_TIMEOUT,data:d},!0)}publish(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now(),h=We(We({},l),{},{eventType:Kn.PUBLISH,lts:d,eventElapse:r.eventElapse,elapse:d-a.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:qt.PUBLISH,data:h},!0)}subscribe(i,r,a){const l=this.baseInfoMap.get(i);if(!l)return;const d=l.info,h=Date.now(),p=We(We({},d),{},{eventType:Kn.SUBSCRIBE,lts:h,eventElapse:r.eventElapse,elapse:h-l.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid},a&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof r.peerid?p.peerSuid=r.peerid:p.peer=r.peerid,this.send({type:qt.SUBSCRIBE,data:p},!0)}wsCompressorInit(i){var r;const a=[...zr(r=this.baseInfoMap).call(r)],d=this.baseInfoMap.get(a.length?a[0]:"UnableToGetSid");if(!d)return;const h=d.info,p=Date.now(),m=We(We({},h),{},{eventType:Kn.WS_COMPRESSOR_INIT,lts:p,eventElapse:i.eventElapse,elapse:p-d.startTime,status:i.status?1:2});this.send({type:qt.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(i,r,a,l){const d=this.baseInfoMap.get(i);if(!d)return;const h=d.info,p=Date.now(),m=We(We(We({},h),l),{},{elapse:p-d.startTime,eventType:r,lts:p,firstDecodeFrame:Math.max(p-d.startTime,0),apEnd:Math.max(l.apEnd-d.startTime,0),apStart:Math.max(l.apStart-d.startTime,0),joinGwEnd:Math.max(l.joinGwEnd-d.startTime,0),joinGwStart:Math.max(l.joinGwStart-d.startTime,0),pcEnd:Math.max(l.pcEnd-d.startTime,0),pcStart:Math.max(l.pcStart-d.startTime,0),subscriberEnd:Math.max(l.subscriberEnd-d.startTime,0),subscriberStart:Math.max(l.subscriberStart-d.startTime,0),videoAddNotify:Math.max(l.videoAddNotify-d.startTime,0)});this.send({type:a,data:m},!0)}firstRemoteFrame(i,r,a,l){const d=this.baseInfoMap.get(i);if(!d)return;const h=d.info,p=Date.now(),m=We(We(We({},h),l),{},{elapse:p-d.startTime,eventType:r,lts:p});this.send({type:a,data:m},!0)}pcStats(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now(),h=We(We(We({},l),r),{},{vid:void 0===l.vid?0:Number(l.vid),elapse:d-a.startTime,eventType:Kn.PC_STATS,lts:d});this.send({type:qt.PC_STATS,data:h},!0)}updateRemoteRTPCapabilities(i,r){this.reportApiInvoke(i,{name:"Client.updateRemoteRTPCapabilities",options:r,tag:Xt.TRACER}).onSuccess()}onGatewayStream(i,r,a,l){const d=this.baseInfoMap.get(i);if(!d)return;const h=d.info,p=Date.now(),m=We(We(We({},h),l),{},{eventType:r,lts:p});this.send({type:a,data:m},!0)}streamSwitch(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now(),h=We(We({},l),{},{eventType:Kn.STREAM_SWITCH,lts:d,isDual:r.isdual,elapse:d-a.startTime,success:r.succ});this.send({type:qt.STREAM_SWITCH,data:h},!0)}requestProxyAppCenter(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now(),h=We(We({},l),{},{eventType:Kn.REQUEST_PROXY_APPCENTER,lts:d,eventElapse:d-r.lts,elapse:d-a.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:qt.REQUEST_PROXY_APPCENTER,data:h},!0)}requestProxyWorkerManager(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now(),h=We(We({},l),{},{eventType:Kn.REQUEST_PROXY_WORKER_MANAGER,lts:d,eventElapse:d-r.lts,elapse:d-a.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:qt.REQUEST_PROXY_WORKER_MANAGER,data:h},!0)}setProxyServer(i){this.proxyServer=i,w.debug(i?"reportProxyServerurl: ".concat(i):"disable reportProxyServerurl: ".concat(i))}peerPublishStatus(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now(),h=We(We({},l),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:d,elapse:d-a.startTime,joinChannelSuccessElapse:d-(a.lastJoinSuccessTime||d),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:qt.PEER_PUBLISH_STATUS,data:h},!0)}workerEvent(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now();(function(p,m,g){const E=p[m];if(!E||"string"!=typeof E)return[p];p[m]="";const y=Na(JSON.stringify(p));let b=0;const T=[];let O=0;for(let P=0;P<E.length;P++)O+=E.charCodeAt(P)<=127?1:3,O<=1300-y||(T[T.length]=hd(hd({},p),{},{[m]:E.substring(b,P)}),b=P,O=E.charCodeAt(P)<=127?1:3);return b!==E.length-1&&(T[T.length]=hd(hd({},p),{},{[m]:E.substring(b)})),T})(We(We(We({},l),r),{},{elapse:d-a.startTime,lts:d,productType:"WebRTC"}),"payload").forEach(p=>this.send({type:qt.WORKER_EVENT,data:p},!0))}apworkerEvent(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now(),h=We(We(We({},l),r),{},{elapse:d-a.startTime,lts:d});this.send({type:qt.AP_WORKER_EVENT,data:h},!0)}joinWebProxyAP(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now(),h=We(We(We({},l),r),{},{elapse:d-a.startTime,lts:d,extend:r.extend||void 0});this.send({type:qt.JOIN_WEB_PROXY_AP,data:h},!0)}WebSocketQuit(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,d=Date.now(),h=We(We(We({},l),r),{},{elapse:d-a.startTime,lts:d});this.send({type:qt.WEBSOCKET_QUIT,data:h},!0)}sendCustomReportMessage(i,r){var a=this;return M(function*(){if(a.customReportCount+=r.length,a.customReportCount>j("CUSTOM_REPORT_LIMIT"))throw new J(x.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);a.customReportCounterTimer||(a.customReportCounterTimer=window.setInterval(()=>{a.customReportCount=0},5e3));const l=Date.now(),d=r.map(h=>({type:qt.USER_ANALYTICS,data:We(We({sid:i},h),{},{lts:l})}));try{j("NEW_REPORT_SERVER")?yield a.postDataToStatsCollector2(d):yield a.postDataToStatsCollector(d)}catch(h){throw w.error("send custom report message failed",h.toString()),new J(x.CUSTOM_REPORT_SEND_FAILED,h.message)}})()}sendApiInvoke(i){const r=j("NOT_REPORT_EVENT");if(i.tag&&ye(r)&&ye(r).call(r,i.tag))return!1;if(null===i.sid)return this.apiInvokeUploadPendingItems.push(i),!1;const a=this.baseInfoMap.get(i.sid);if(!a)return this.apiInvokeUploadPendingItems.push(i),!1;const{cname:l,uid:d,cid:h}=a.info;let p;if(i.lts=i.lts||Date.now(),i.error)if(i.error instanceof J){const{code:g,message:E}=i.error;p=g||E||i.error.toString()}else p=i.error.toString();const m={invokeId:i.invokeId,sid:i.sid,cname:l,cid:h,uid:d,lts:i.lts,success:i.success,elapse:i.lts-a.startTime,execElapse:i.lts-i.apiInvokeTime,apiName:i.name,options:i.options?JSON.stringify(i.options):void 0,execStates:i.states?JSON.stringify(i.states):void 0,execResult:i.result?JSON.stringify(i.result):void 0,errorCode:i.error?p:void 0,errorMsg:i.error?JSON.stringify(i.error):void 0};return this.send({type:qt.API_INVOKE,data:m},!1),!0}appendSessionId(){xf.__CLIENT_LIST__.forEach(i=>{if(i._sessionId){const r=this.apiInvokeUploadPendingItems.length;for(let a=0;a<r;a++){const l=this.apiInvokeUploadPendingItems.shift();l&&(l.sid=i._sessionId,this.sendApiInvoke(Object.assign({},l)))}}})}send(i,r){if(r)return this.keyEventUploadPendingItems.push(i),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(i),this.normalEventUploadPendingItems.length>j("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(i,r){const a=[],l=[];for(;i.length;){const h=i.shift();a.length<20?a.push(h):l.push(h)}i.push(...l);for(const h of[...a]){var d;-1!==this.ltsList.indexOf(h.data.lts)?(h.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(h.data.lts)):(this.ltsList.push(h.data.lts),tl(d=this.ltsList).call(d,(p,m)=>p-m))}return r||(this.lastSendNormalEventTime=Date.now()),j("ENABLE_EVENT_REPORT")&&a.length&&(j("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(a):this.postDataToStatsCollector(a)).catch((h=>p=>{j("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(h):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(h),this.normalEventUploadPendingItems.length>j("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-j("NORMAL_EVENT_QUEUE_CAPACITY")),w.warning("report: drop normal events"))))})(a)),i}postDataToStatsCollector2(i){var r=this;return M(function*(){on.networkState===Yi.OFFLINE&&(yield q.race([on.onlineWaiter,_i(2*Re.maxRetryTimeout)]));const a=h=>{let p=new Uint8Array;return h.forEach(m=>{const g=Yg(JSON.stringify(m.data)),E=new ArrayBuffer(5),y=(T=>{let O=0;return Object.entries(qt).forEach(P=>{let[D,L]=P;L===T.type&&(O=EventNameToID[D])}),O})(m),b=new DataView(E);b.setUint16(0,g.byteLength,!0),b.setUint8(2,255&y),b.setUint8(3,y>>>8&255),b.setUint8(4,y>>>16&255),p=wS(p,new Uint8Array(E)),p=wS(p,g)}),p},l="event";let d=r.proxyServer?"https://".concat(r.proxyServer,"/rs/?h=").concat(j("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(l):"https://".concat(j("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(l);for(let h=0;h<2;h+=1){1===h&&(d=r.proxyServer?"https://".concat(r.proxyServer,"/rs/?h=").concat(j("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(l):"https://".concat(j("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(l));try{yield YS(d,{timeout:1e4,data:a(i),headers:We(We({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},r._appId&&{appid:r._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(p){if(1===h)throw p;continue}return}})()}postDataToStatsCollector(i){var r=arguments,a=this;return M(function*(){let l=r.length>1&&void 0!==r[1]&&r[1];const d={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:i.map(m=>JSON.stringify(m)),vid:(m=>{const g=m&&m.data.sid&&a.baseInfoMap.get(m.data.sid);return g&&g.info.vid&&+g.info.vid||0})(i[0])};on.networkState===Yi.OFFLINE&&(yield q.race([on.onlineWaiter,_i(2*Re.maxRetryTimeout)]));const h=l?"/events/proto-raws":"/events/messages";let p=a.url||(a.proxyServer?"https://".concat(a.proxyServer,"/rs/?h=").concat(j("EVENT_REPORT_DOMAIN"),"&p=").concat(j("STATS_COLLECTOR_PORT"),"&d=").concat(h):"https://".concat(j("EVENT_REPORT_DOMAIN"),":").concat(j("STATS_COLLECTOR_PORT")).concat(h));for(let m=0;m<2;m+=1){1===m&&(p=a.backupUrl||(a.proxyServer?"https://".concat(a.proxyServer,"/rs/?h=").concat(j("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(j("STATS_COLLECTOR_PORT"),"&d=").concat(h):"https://".concat(j("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(j("STATS_COLLECTOR_PORT")).concat(h)));try{l?yield Eh(p,{timeout:1e4,data:d}):yield YS(p,{timeout:1e4,data:d})}catch(g){if(1===m)throw g;continue}return}})()}createBaseInfo(i,r){const a=Object.assign({},sL);return a.sid=i,this.baseInfoMap.set(i,{info:a,startTime:r}),a}reportResourceTiming(i,r){const a=performance.getEntriesByName(i),l=a[a.length-1];l&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:l,tag:Xt.TRACER}).onSuccess()}}function Ae(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(i,r,a){const l=a.value;if("function"==typeof l){const d=s.className||i.__className__||("AgoraRTCClient"===i.constructor.name?"Client":i.constructor.name);a.value=function(){for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];let g=p;if(s.argsMap)try{g=s.argsMap(this,...p)}catch(y){w.warning(y),g=[]}try{JSON.stringify(g)}catch{w.warning("arguments for method ".concat(d,".").concat(String(r)," not serializable for apiInvoke.")),g=[]}const E=(s.report||Se).reportApiInvoke(this._sessionId||null,{name:"".concat(d,".").concat(String(r)),options:g,tag:Xt.TRACER,reportResult:s.reportResult},s.throttleTime);try{const y=l.apply(this,p);return y instanceof q?y.then(b=>(E.onSuccess(s.reportResult&&b),b)).catch(b=>{throw E.onError(b),b}):(E.onSuccess(s.reportResult&&y),y)}catch(y){throw E.onError(y),y}}}return a}}C(xf,"__CLIENT_LIST__",[]);const Se=new xf;Df.on("REPORT_LOG_UPLOAD",s=>{s.networkState=on.networkState,Se.reportApiInvoke(null,{name:"logUploadError",options:s,tag:Xt.TRACER})});const aL=["CHINA","GLOBAL"],Eo=function(){const s="us".concat("erna","me"),i="pa".concat("sswo","rd"),r=["t","s","t"];r.splice(1,0,"e");const a=r.join(""),l=[];for(let p=0;p<6;p++)l.push("1");const d=l.join(""),h={};return h[s]=a,h[i]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Eo,XS||(ri.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],ri.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],ri.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],ri.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ri.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],ri.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],ri.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",ri.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",ri.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",ri.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",ri.AREAS=["NORTH_AMERICA","OVERSEA"]);const ND=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],pc=[];function fl(s,i){return!!i&&pc.some(r=>r.uid===s&&r.channelName===i)}xf.__CLIENT_LIST__=pc;var mE,Or,vd,Mf,vo,$i,Ie,Ke,he,Ce,Xi,Ue,PD,yd,Me,Bn,ml,cL=ke("Array").values,lL=Fs,f3=St,dL=Ms,xD=cL,nC=Array.prototype,uL={DOMTokenList:!0,NodeList:!0},yo=lr(function(s){var i=s.values;return s===nC||dL(nC,s)&&i===nC.values||f3(uL,lL(s))?xD:i});function te(s,i,r,a){var l,d=arguments.length,h=d<3?i:null===a?a=Object.getOwnPropertyDescriptor(i,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect.decorate(s,i,r,a);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(h=(d<3?l(h):d>3?l(i,r,h):l(i,r))||h);return d>3&&h&&Object.defineProperty(i,r,h),h}function N(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)}(function(s){s.L1T1="L1T1",s.L1T2="L1T2",s.L1T3="L1T3",s.L2T1_KEY="L2T1_KEY",s.L2T2_KEY="L2T2_KEY",s.L2T3_KEY="L2T3_KEY",s.L3T1_KEY="L3T1_KEY",s.L3T2_KEY="L3T2_KEY",s.L3T3_KEY="L3T3_KEY"})(mE||(mE={})),function(s){s.CERTIFICATE="certificate",s.CODEC="codec",s.CANDIDATE_PAIR="candidate-pair",s.LOCAL_CANDIDATE="local-candidate",s.REMOTE_CANDIDATE="remote-candidate",s.INBOUND="inbound-rtp",s.TRACK="track",s.OUTBOUND="outbound-rtp",s.PC="peer-connection",s.REMOTE_INBOUND="remote-inbound-rtp",s.REMOTE_OUTBOUND="remote-outbound-rtp",s.TRANSPORT="transport",s.CSRC="csrc",s.DATA_CHANNEL="data-channel",s.STREAM="stream",s.SENDER="sender",s.RECEIVER="receiver"}(Or||(Or={})),function(s){s[s.ACCESS_POINT=101]="ACCESS_POINT",s[s.UNILBS=201]="UNILBS",s[s.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(vd||(vd={})),function(s){s[s.IIIEGAL_APPID=1]="IIIEGAL_APPID",s[s.IIIEGAL_UID=2]="IIIEGAL_UID",s[s.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(Mf||(Mf={})),function(s){s[s.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",s[s.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",s[s.INTERNAL_ERROR=8]="INTERNAL_ERROR",s[s.NO_AUTHORIZED=9]="NO_AUTHORIZED",s[s.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",s[s.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",s[s.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",s[s.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",s[s.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",s[s.USER_OVERLOAD=16]="USER_OVERLOAD",s[s.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",s[s.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(vo||(vo={})),function(s){s[s.NO_FLAG_SET=100]="NO_FLAG_SET",s[s.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",s[s.INVALID_FALG_SET=102]="INVALID_FALG_SET",s[s.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",s[s.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",s[s.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",s[s.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",s[s.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",s[s.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",s[s.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",s[s.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",s[s.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",s[s.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",s[s.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",s[s.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",s[s.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",s[s.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",s[s.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",s[s.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}($i||($i={})),function(s){s[s.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",s[s.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",s[s.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",s[s.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",s[s.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",s[s.K_TICKET_INVALID=7]="K_TICKET_INVALID",s[s.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",s[s.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",s[s.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",s[s.K_UID_BANNED=14]="K_UID_BANNED",s[s.K_IP_BANNED=15]="K_IP_BANNED",s[s.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",s[s.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",s[s.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",s[s.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",s[s.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",s[s.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",s[s.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",s[s.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",s[s.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",s[s.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",s[s.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",s[s.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",s[s.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",s[s.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",s[s.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",s[s.ERR_INVALID_UID=117]="ERR_INVALID_UID",s[s.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",s[s.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",s[s.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",s[s.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",s[s.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",s[s.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",s[s.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",s[s.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",s[s.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",s[s.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",s[s.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",s[s.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",s[s.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",s[s.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",s[s.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",s[s.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",s[s.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",s[s.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",s[s.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",s[s.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",s[s.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",s[s.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",s[s.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",s[s.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",s[s.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",s[s.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",s[s.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",s[s.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",s[s.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",s[s.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",s[s.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",s[s.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",s[s.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",s[s.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",s[s.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",s[s.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",s[s.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(Ie||(Ie={})),function(s){s.CONNECTING="connecting",s.CONNECTED="connected",s.RECONNECTING="reconnecting",s.CLOSED="closed"}(Ke||(Ke={})),function(s){s.WS_CONNECTED="ws_connected",s.WS_RECONNECTING="ws_reconnecting",s.WS_CLOSED="ws_closed",s.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",s.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",s.ON_BINARY_DATA="on_binary_data",s.REQUEST_RECOVER="request_recover",s.REQUEST_JOIN_INFO="request_join_info",s.REQUEST_REJOIN_INFO="req_rejoin_info",s.IS_P2P_DISCONNECTED="is_p2p_dis",s.DISCONNECT_P2P="dis_p2p",s.ABORT_P2P_EXECUTION="abort_p2p_execution",s.NEED_RENEW_SESSION="need-sid",s.REPORT_JOIN_GATEWAY="report_join_gateway",s.REQUEST_TIMEOUT="request_timeout",s.REQUEST_SUCCESS="request_success",s.JOIN_RESPONSE="join_response",s.DATACHANNEL_PRECONNECT="datachannel_preconnect",s.DATACHANNEL_CONNECTING="datachannel_connecting",s.DATACHANNEL_FAILBACK="datachannel_failback",s.P2P_START="p2p_start",s.P2P_CONNECTION="p2p_connection",s.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",s.P2P_SUBSCRIBE="p2p_subscribe",s.P2P_UNSUBSCRIBE="p2p_unsubscribe",s.P2P_EXCHANGE_SDP="p2p_exchange_sdp",s.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",s.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream"}(he||(he={})),function(s){s.PING="ping",s.PING_BACK="ping_back",s.JOIN="join_v3",s.REJOIN="rejoin_v3",s.LEAVE="leave",s.SET_CLIENT_ROLE="set_client_role",s.PUBLISH="publish",s.PUBLISH_DATASTREAM="publish_datastream",s.UNPUBLISH="unpublish",s.UNPUBLISH_DATASTREAM="unpublish_datastream",s.SUBSCRIBE="subscribe",s.SUBSCRIBE_DATASTREAM="subscribe_datastream",s.SUBSCRIBE_STREAMS="subscribe_streams",s.UNSUBSCRIBE="unsubscribe",s.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",s.UNSUBSCRIBE_STREAMS="unsubscribe_streams",s.SUBSCRIBE_CHANGE="subscribe_change",s.TRAFFIC_STATS="traffic_stats",s.RENEW_TOKEN="renew_token",s.SWITCH_VIDEO_STREAM="switch_video_stream",s.DEFAULT_VIDEO_STREAM="default_video_stream",s.SET_FALLBACK_OPTION="set_fallback_option",s.GATEWAY_INFO="gateway_info",s.CONTROL="control",s.SEND_METADATA="send_metadata",s.DATA_STREAM="data_stream",s.PICK_SVC_LAYER="pick_svc_layer",s.RESTART_ICE="restart_ice",s.CONNECT_PC="connect_pc",s.SET_VIDEO_PROFILE="set_video_profile",s.SET_PARAMETER="set_parameter",s.SET_RTM2_FLAG="set_rtm2_flag"}(Ce||(Ce={})),function(s){s.PUBLISH_STATS="publish_stats",s.PUBLISH_RELATED_STATS="publish_related_stats",s.SUBSCRIBE_STATS="subscribe_stats",s.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",s.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",s.DENOISER_STATS="denoiser_stats",s.TRANSPORT_STATS="transport_stats",s.EXTENSION_USAGE_STATS="extension_usage_stats"}(Xi||(Xi={})),function(s){s.ON_USER_ONLINE="on_user_online",s.ON_USER_OFFLINE="on_user_offline",s.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",s.ON_PUBLISH_STREAM="on_publish_stream",s.ON_UPLINK_STATS="on_uplink_stats",s.ON_P2P_LOST="on_p2p_lost",s.ON_REMOVE_STREAM="on_remove_stream",s.ON_ADD_AUDIO_STREAM="on_add_audio_stream",s.ON_ADD_VIDEO_STREAM="on_add_video_stream",s.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",s.ON_USER_BANNED="on_user_banned",s.ON_USER_LICENSE_BANNED="on_user_license_banned",s.ON_NOTIFICATION="on_notification",s.ON_CRYPT_ERROR="on_crypt_error",s.MUTE_AUDIO="mute_audio",s.MUTE_VIDEO="mute_video",s.UNMUTE_AUDIO="unmute_audio",s.UNMUTE_VIDEO="unmute_video",s.ON_P2P_OK="on_p2p_ok",s.RECEIVE_METADATA="receive_metadata",s.ON_DATA_STREAM="on_data_stream",s.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",s.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",s.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",s.ENABLE_LOCAL_VIDEO="enable_local_video",s.DISABLE_LOCAL_VIDEO="disable_local_video",s.ENABLE_LOCAL_AUDIO="enable_local_audio",s.DISABLE_LOCAL_AUDIO="disable_local_audio",s.ON_PUBLISHED_USER_LIST="on_published_user_list"}(Ue||(Ue={})),function(s){s.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",s.NEED_ANSWER="NEED_ANSWER",s.NEED_RENEGOTIATE="NEED_RENEGOTIATE",s.P2P_LOST="P2P_LOST",s.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",s.NEED_UNPUB="NEED_UNPUB",s.NEED_UNSUB="NEED_UNSUB",s.NEED_UPLOAD="NEED_UPLOAD",s.NEED_CONTROL="NEED_CONTROL",s.START_RECONNECT="START_RECONNECT",s.END_RECONNECT="END_RECONNECT",s.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(PD||(PD={})),function(s){s.SEND_ONLY="SEND_ONLY",s.RECEIVE_ONLY="RECEIVE_ONLY"}(yd||(yd={})),function(s){s.CONNECTED="websocket:connected",s.RECONNECTING="websocket:reconnecting",s.WILL_RECONNECT="websocket:will_reconnect",s.CLOSED="websocket:closed",s.FAILED="websocket:failed",s.ON_MESSAGE="websocket:on_message",s.REQUEST_NEW_URLS="websocket:request_new_urls",s.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",s.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"}(Me||(Me={}));class W extends J{constructor(i){super(i,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),C(this,"name","AgoraRTCException")}print(){return super.print(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",w)}throw(){super.throw(w)}}function _E(s){if("string"!=typeof s||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(s))throw w.error("Invalid Channel Name ".concat(s)),new W(x.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function iC(s){if(!("number"==typeof(i=s)&&Math.floor(i)===i&&0<=i&&i<=4294967295||bS(s,1,255)))throw new W(x.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var i;"string"==typeof s&&w.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}(function(s){s.TRANSCODE="mix_streaming",s.RAW="raw_streaming",s.INJECT="inject_streaming"})(Bn||(Bn={})),function(s){s[s.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",s[s.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",s[s.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",s[s.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",s[s.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",s[s.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",s[s.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",s[s.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",s[s.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",s[s.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",s[s.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(ml||(ml={}));const MD={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},rC={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function kf(s,i){Un(s.url,"".concat(i,".url"),1,1e3,!1),kt(s.x)||ft(s.x,"".concat(i,".x"),0,1e4),kt(s.y)||ft(s.y,"".concat(i,".y"),0,1e4),kt(s.width)||ft(s.width,"".concat(i,".width"),0,1e4),kt(s.height)||ft(s.height,"".concat(i,".height"),0,1e4),kt(s.zOrder)||ft(s.zOrder,"".concat(i,".zOrder"),0,255),kt(s.alpha)||ft(s.alpha,"".concat(i,".alpha"),0,1,!1)}const hL={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},kD={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var $o,yh,Sn,LD,gi,$s,Ji,_l,It,sn,bd,Nn,gE,st;function FD(s){if(!s.channelName)throw new W(x.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof s.uid)throw new W(x.INVALID_PARAMS,"invalid uid in info, uid must be a number");return s.token&&Un(s.token,"info.token",1,2047),iC(s.uid),_E(s.channelName),!0}(function(s){s.WARNING="@live_uap-warning",s.ERROR="@line_uap-error",s.PUBLISH_STREAM_STATUS="@live_uap-publish-status",s.INJECT_STREAM_STATUS="@live_uap-inject-status",s.WORKER_STATUS="@live_uap-worker-status",s.REQUEST_NEW_ADDRESS="@live_uap-request-address"})($o||($o={})),function(s){s.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(yh||(yh={})),function(s){s[s.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",s[s.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",s[s.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",s[s.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",s[s.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",s[s.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",s[s.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",s[s.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",s[s.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",s[s.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",s[s.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",s[s.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",s[s.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",s[s.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",s[s.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",s[s.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",s[s.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",s[s.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",s[s.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",s[s.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",s[s.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(Sn||(Sn={})),function(s){s.CONNECT_FAILED="connect failed",s.CONNECT_TIMEOUT="connect timeout",s.WS_DISCONNECTED="websocket disconnected",s.REQUEST_TIMEOUT="request timeout",s.REQUEST_FAILED="request failed",s.WAIT_STATUS_TIMEOUT="wait status timeout",s.WAIT_STATUS_ERROR="wait status error",s.BAD_STATE="bad state",s.WS_ABORT="ws abort",s.AP_REQUEST_TIMEOUT="AP request timeout",s.AP_JSON_PARSE_ERROR="AP json parse error",s.AP_REQUEST_ERROR="AP request error",s.AP_REQUEST_ABORT="AP request abort"}(LD||(LD={})),function(s){s[s.SetSdkProfile=0]="SetSdkProfile",s[s.SetSourceChannel=1]="SetSourceChannel",s[s.SetSourceUserId=2]="SetSourceUserId",s[s.SetDestChannel=3]="SetDestChannel",s[s.StartPacketTransfer=4]="StartPacketTransfer",s[s.StopPacketTransfer=5]="StopPacketTransfer",s[s.UpdateDestChannel=6]="UpdateDestChannel",s[s.Reconnect=7]="Reconnect",s[s.SetVideoProfile=8]="SetVideoProfile"}(gi||(gi={})),function(s){s.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",s.NETWORK_CONNECTED="NETWORK_CONNECTED",s.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",s.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",s.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",s.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",s.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",s.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",s.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",s.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}($s||($s={})),function(s){s.RELAY_STATE_IDLE="RELAY_STATE_IDLE",s.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",s.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",s.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(Ji||(Ji={})),function(s){s.RELAY_OK="RELAY_OK",s.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",s.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",s.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(_l||(_l={})),function(s){s.High="high",s.Low="low",s.Audio="audio",s.Screen="screen",s.ScreenLow="screen_low"}(It||(It={})),function(s){s.DISCONNECT="disconnect",s.CONNECTION_STATE_CHANGE="connection-state-change",s.NETWORK_QUALITY="network-quality",s.STREAM_TYPE_CHANGE="stream-type-change",s.IS_P2P_DISCONNECTED="is-p2p-dis",s.DISCONNECT_P2P="dis-p2p",s.REQUEST_NEW_GATEWAY_LIST="req-gate-url",s.NEED_RENEW_SESSION="need-sid",s.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",s.JOIN_RESPONSE="join-response",s.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",s.RESET_CONNECTION_EVENTS="reset-connection-events",s.DATACHANNEL_PRECONNECT="datachannel_preconnect",s.DATACHANNEL_FAILBACK="datachannel_failback",s.RESET_SIGNAL="reset-signal"}(sn||(sn={})),function(s){s.P2P_DISCONNECTED="P2P_DISCONNECTED",s.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",s.TIMEOUT="TIMEOUT",s.UNKNOWN_REASON="UNKNOWN_REASON"}(bd||(bd={})),function(s){s[s.Nothing=0]="Nothing",s[s.Audio=1]="Audio",s[s.LwoVideo=2]="LwoVideo",s[s.Video=4]="Video",s[s.Data=8]="Data",s[s.DataStream0=256]="DataStream0",s[s.DataStream1=512]="DataStream1",s[s.DataStream2=1024]="DataStream2",s[s.DataStream3=2048]="DataStream3",s[s.DataStream4=4096]="DataStream4",s[s.DataStream5=8192]="DataStream5",s[s.DataStream6=16384]="DataStream6",s[s.DataStream7=32768]="DataStream7"}(Nn||(Nn={})),function(s){s[s.websocket=0]="websocket",s[s.datachannel=1]="datachannel"}(gE||(gE={})),function(s){s.CHINA="CHINA",s.ASIA="ASIA",s.NORTH_AMERICA="NORTH_AMERICA",s.EUROPE="EUROPE",s.JAPAN="JAPAN",s.INDIA="INDIA",s.KOREA="KOREA",s.HKMC="HKMC",s.US="US",s.OCEANIA="OCEANIA",s.SOUTH_AMERICA="SOUTH_AMERICA",s.AFRICA="AFRICA",s.OVERSEA="OVERSEA",s.GLOBAL="GLOBAL",s.EXTENSIONS="EXTENSIONS"}(st||(st={}));const oC=[st.AFRICA,st.ASIA,st.CHINA,st.EUROPE,st.GLOBAL,st.INDIA,st.JAPAN,st.NORTH_AMERICA,st.OCEANIA,st.OVERSEA,st.SOUTH_AMERICA];var ei;!function(s){s.CHINA="CN",s.ASIA="AS",s.NORTH_AMERICA="NA",s.EUROPE="EU",s.JAPAN="JP",s.INDIA="IN",s.KOREA="KR",s.HKMC="HK",s.US="US",s.OCEANIA="OC",s.SOUTH_AMERICA="SA",s.AFRICA="AF",s.OVERSEA="OVERSEA",s.GLOBAL="GLOBAL",s.EXTENSIONS="GLOBAL"}(ei||(ei={}));const EE={CHINA:{},ASIA:{CODE:ei.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ei.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ei.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ei.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","\tuap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ei.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ei.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ei.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ei.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ei.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ei.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ei.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ei.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ei.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};var Lf,sC,Ee,wi,Xs,ne,it,we,aC,Nr,bo,jn,vs,En,Lt,gl,Pr,Xo,Sd,Dt,ys,UD;XS&&(EE.CHINA={CODE:ei.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(s){s.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(Lf||(Lf={}));class cC extends zt{constructor(i,r){super(),C(this,"onICEConnectionStateChange",void 0),C(this,"onConnectionStateChange",void 0),C(this,"onDTLSTransportStateChange",void 0),C(this,"onDTLSTransportError",void 0),C(this,"onICETransportStateChange",void 0),C(this,"onFirstAudioReceived",void 0),C(this,"onFirstVideoReceived",void 0),C(this,"onFirstAudioDecoded",void 0),C(this,"onFirstVideoDecoded",void 0),C(this,"onFirstVideoDecodedTimeout",void 0),C(this,"onSelectedLocalCandidateChanged",void 0),C(this,"onSelectedRemoteCandidateChanged",void 0)}}class bh extends cC{constructor(i,r){super(i,r)}}(function(s){s.SEND="sendonly",s.RECV="recvonly",s.SENDRECV="sendrecv",s.INACTIVE="inactive"})(sC||(sC={})),function(s){s.VIDEO="video",s.AUDIO="audio"}(Ee||(Ee={})),function(s){s[s.UDP=0]="UDP",s[s.TCP=1]="TCP",s[s.RELAY=2]="RELAY"}(wi||(wi={})),function(s){s[s.FIRST_CONNECTION=0]="FIRST_CONNECTION",s[s.TCP_RESTART=1]="TCP_RESTART",s[s.RELAY_RESTART=2]="RELAY_RESTART",s[s.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",s[s.OLD_RESTART=11]="OLD_RESTART",s[s.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(Xs||(Xs={})),function(s){s.LocalVideoTrack="videoTrack",s.LocalAudioTrack="audioTrack",s.LocalVideoLowTrack="videoLowTrack"}(ne||(ne={})),function(s){s.New="new",s.Connected="connected",s.Reconnecting="reconnecting",s.Disconnected="disconnected"}(it||(it={})),function(s){s.StateChange="stateChange",s.IceConnectionStateChange="iceConnectionStateChange",s.RequestMuteLocal="requestMuteLocal",s.RequestUnmuteLocal="requestUnmuteLocal",s.RequestRePublish="requestRePublish",s.RequestRePublishDataChannel="requestRePublishDataChannel",s.RequestReSubscribe="requestReSubscribe",s.RequestUploadStats="requestUploadStats",s.MediaReconnectStart="MediaReconnectStart",s.MediaReconnectEnd="MediaReconnectEnd",s.NeedSignalRTT="NeedSignalRTT",s.RequestRestartICE="RequestRestartIce",s.PeerConnectionStateChange="PeerConnectionStateChange",s.RequestReconnect="RequestReconnect",s.RequestReconnectPC="RequestReconnectPC",s.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",s.P2PLost="P2PLost",s.UpdateVideoEncoder="UpdateVideoEncoder",s.ConnectionTypeChange="ConnectionTypeChange",s.RequestLowStreamParameter="RequestLowStreamParameter",s.QueryClientConnectionState="QueryClientConnectionState",s.LocalCandidate="LocalCandidate",s.RequestP2PMuteLocal="requestP2PMuteLocal",s.RequestP2PPublish="RequestP2PPublish",s.RequestP2PUnPublish="RequestP2PUnPublish",s.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",s.RequestP2PMuteRemote="RequestP2PMuteRemote",s.RequestP2PRestartICE="RequestP2PRestartICE"}(we||(we={})),function(s){s.MUTE_LOCAL_VIDEO="mute_local_video",s.MUTE_LOCAL_AUDIO="mute_local_audio",s.UNMUTE_LOCAL_VIDEO="unmute_local_video",s.UNMUTE_LOCAL_AUDIO="unmute_local_audio",s.MUTE_REMOTE_VIDEO="mute_remote_video",s.MUTE_REMOTE_AUDIO="mute_remote_audio",s.UNMUTE_REMOTE_VIDEO="unmute_remote_video",s.UNMUTE_REMOTE_AUDIO="unmute_remote_audio"}(aC||(aC={})),function(s){s.CONNECTING="CONNECTING",s.RECONNECTING="RECONNECTING",s.CONNECTED="CONNECTED",s.CLOSED="CLOSED"}(Nr||(Nr={})),function(s){s[s.CONNECT_AP=0]="CONNECT_AP",s[s.AP_CONNECTED=1]="AP_CONNECTED",s[s.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",s[s.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",s[s.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",s[s.CONNECT_WORKER=5]="CONNECT_WORKER",s[s.WORKER_CONNECTED=6]="WORKER_CONNECTED",s[s.CLOSED=7]="CLOSED"}(bo||(bo={})),function(s){s.CONNECTION_STATE_CHANGE="connection-state-change",s.STATE_CHANGE="state-change",s.INSPECT_RESULT="inspect-result",s.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",s.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(jn||(jn={})),function(s){s.NETWORK_ERROR="NETWORK_ERROR",s.SERVER_ERROR="SERVER_ERROR",s.MULTI_IP="MULTI_IP",s.TIMEOUT="TIMEOUT",s.OFFLINE="OFFLINE",s.LEAVE="LEAVE",s.P2P_FAILED="P2P_FAILED",s.FALLBACK="FALLBACK"}(vs||(vs={})),function(s){s.CONNECTED="transmitter:connected",s.RECONNECTING="transmitter:reconnecting",s.WILL_RECONNECT="transmitter:will_reconnect",s.CLOSED="transmitter:closed",s.FAILED="transmitter:failed",s.ON_MESSAGE="transmitter:on_message",s.REQUEST_NEW_URLS="transmitter:request_new_urls",s.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",s.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",s.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",s.FAILBACK="transmitter:failback"}(En||(En={})),function(s){s.CAMERA_CHANGED="camera-changed",s.MICROPHONE_CHANGED="microphone-changed",s.PLAYBACK_DEVICE_CHANGED="playback-device-changed",s.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",s.AUTOPLAY_FAILED="autoplay-failed",s.SECURITY_POLICY_VIOLATION="security-policy-violation"}(Lt||(Lt={})),function(s){s[s.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",s[s.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",s[s.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",s[s.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",s[s.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",s[s.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",s[s.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",s[s.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",s[s.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",s[s.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",s[s.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",s[s.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",s[s.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",s[s.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",s[s.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",s[s.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",s[s.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",s[s.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",s[s.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",s[s.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(gl||(gl={})),function(s){s.CONNECTING="CONNECTING",s.RECONNECTING="RECONNECTING",s.CONNECTED="CONNECTED",s.CLOSED="CLOSED"}(Pr||(Pr={})),function(s){s.CONNECTION_STATE_CHANGE="connection-state-change",s.STATE_CHANGE="state-change",s.INSPECT_RESULT="inspect-result",s.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",s.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(Xo||(Xo={})),function(s){s[s.CONNECT_AP=0]="CONNECT_AP",s[s.AP_CONNECTED=1]="AP_CONNECTED",s[s.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",s[s.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",s[s.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",s[s.CONNECT_WORKER=5]="CONNECT_WORKER",s[s.WORKER_CONNECTED=6]="WORKER_CONNECTED",s[s.CLOSED=7]="CLOSED"}(Sd||(Sd={})),function(s){s.CALL="call",s.CANDIDATE="candidate",s.PUBLISH="publish",s.UNPUBLISH="unpublish",s.SUBSCRIBE="subscribe",s.UNSUBSCRIBE="unsubscribe",s.CONTROL="control",s.RESTART_ICE="restart_ice",s.ACK="ack",s.JOIN="join",s.EXCHANGE_SDP="exchange_sdp",s.DO_SUBSCRIBE="do_subscribe",s.DO_UNSUBSCRIBE="do_unsubscribe"}(Dt||(Dt={})),function(s){s.MUTE_LOCAL_AUDIO="mute_local_audio",s.MUTE_LOCAL_VIDEO="mute_local_video",s.UNMUTE_LOCAL_AUDIO="unmute_local_audio",s.UNMUTE_LOCAL_VIDEO="unmute_local_video"}(ys||(ys={})),function(s){s[s.SUCCESS=1]="SUCCESS",s[s.FAILED=0]="FAILED"}(UD||(UD={}));const pL={[vd.ACCESS_POINT]:{[$i.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[$i.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[$i.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[$i.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[$i.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[$i.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[vd.UNILBS]:{[vo.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[vo.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[vo.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[vo.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[vo.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[vo.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[vo.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[vo.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[vo.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[vo.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[vo.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[vo.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[vd.STRING_UID_ALLOCATOR]:{[Mf.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Mf.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Mf.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Ff(s){const i=pL[Math.floor(s/1e4)];if(!i)return{desc:"unkonw error",retry:!1};const r=i[s%1e4];if(!r){if(Math.floor(s/1e4)===vd.ACCESS_POINT){const a=s%1e4;if("1"===a.toString()[0])return{desc:s.toString(),retry:!1};if("2"===a.toString()[0])return{desc:s.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return r}const lC={[Ie.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ie.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ie.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ie.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ie.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ie.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ie.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ie.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ie.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ie.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ie.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ie.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ie.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ie.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ie.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ie.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ie.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ie.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ie.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ie.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ie.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ie.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ie.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ie.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ie.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ie.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ie.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ie.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ie.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ie.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ie.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ie.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ie.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ie.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ie.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ie.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ie.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ie.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ie.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ie.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ie.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ie.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ie.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ie.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ie.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ie.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ie.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ie.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ie.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ie.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ie.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ie.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ie.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ie.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ie.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ie.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ie.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ie.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ie.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ie.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ie.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ie.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ie.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function El(s){return lC[s]||{desc:"UNKNOW_ERROR_".concat(s),action:"failed"}}function dC(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function vE(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?dC(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):dC(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function uC(s){return s.every(i=>i.readyState===WebSocket.CLOSED||i.readyState===WebSocket.CLOSING)}function VD(s,i){if("string"==typeof s)return s;const{proxy:r,host:a,port:l}=s;if(i){const d=j("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===d?"wss://".concat(a,"/ws/?p=").concat(Number(l)+150):"wss://".concat(a,":").concat(d,"/ws/?p=").concat(Number(l)+150)}return r?"wss://".concat(r,"/ws/?h=").concat(a,"&p=").concat(l):"wss://".concat(a,":").concat(l)}const fL=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,mL=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,_L=/wss:\/\/(.+):([0-9]+)\/?/,BD=/wss:\/\/(.[^\/]+)\/?/;let m3=0;class jD{constructor(i,r){C(this,"id",0),C(this,"store",void 0),C(this,"recordIndex",void 0),C(this,"websockets",[]),C(this,"try443PortDuration",2e3),C(this,"forceCloseWSDuration",5e3),C(this,"try443PortTimeout",null),C(this,"forceCloseTimeout",null),C(this,"isTry443PortFailed",!1),C(this,"isNormalPortFailed",!1),C(this,"useDoubleDomain",!1),C(this,"useProxy",!1),C(this,"startTime",Date.now()),this.id=++m3,this.try443PortDuration=j("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=i||5e3,this.store=r}closeAllWebsockets(){this.websockets.forEach(i=>{i.onopen=null,i.onclose=null,i.onmessage=null,i.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var i;const r=Date.now()-this.startTime;for(var a=arguments.length,l=new Array(a),d=0;d<a;d++)l[d]=arguments[d];w.debug("[choose-best-ws ".concat(null===(i=this.store)||void 0===i?void 0:i.clientId," ").concat(this.id,"] ").concat(r,"ms:"),...l)}createWebSocket(i,r,a){this.logger("createWebSocket:",i,{isTry443Port:r,hasTimeoutDetection:a});const l=j("GATEWAY_DOMAINS"),d=Date.now(),h=[],p=l.find(E=>{var y;return ye(y=i.host).call(y,E)});p||(this.useDoubleDomain=!1);const m=[];if(this.useDoubleDomain)l.forEach(E=>{m.push(VD(vE(vE({},i),{},{host:i.host.replace(p,E)}),r))});else{const E=vE({},i);if(r&&p){const y=l.find(b=>b!==p);y&&(E.host=E.host.replace(p,y))}m.push(VD(E,r))}try{m.forEach(E=>{const y=new WebSocket(E);y.binaryType="arraybuffer",h.push(y),this.logger("ws is connecting:",y.url)})}catch(E){if(this.logger("ws create failed"),h.forEach(y=>y.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(i,r,a);if(!r&&443!==Number(i.port))return this.createWebSocket(i,!0,a);throw new W(x.WS_ERR,"init websocket failed! Error: ".concat(E.toString()))}const g=mf();return this.store&&this.store.recordJoinChannelService({urls:h.map(E=>E.url),service:"gateway"},this.recordIndex),h.forEach(E=>{E.onopen=()=>{this.logger("onopen: ws ".concat(E.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach(y=>{y!==E&&(y.onopen=null,y.onclose=null,y.onmessage=null,y.close(),this.logger("close backup websocket: ".concat(y.url)))}),this.websockets.length=0,g.resolve(E)},E.onclose=y=>{this.logger("onclose: ws ".concat(E.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(E.readyState)),r?this.isTry443PortFailed=uC(h):this.isNormalPortFailed=uC(h),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(r&&this.isTry443PortFailed||!r&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(y.reason)),g.reject({code:y.code,reason:bd.A_ROUND_WS_FAILED}))},E.onmessage=y=>this.logger("".concat(E.url," onmessage: ").concat(y.data))}),this.websockets.push(...h),a||(()=>{const E=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",g.isResolved),this.websockets.forEach(y=>y.readyState!==WebSocket.OPEN&&y.close())};if(r||this.useProxy)return this.logger("add 5s timeout at ".concat(r?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(E,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",g.isResolved),g.isResolved)return E();dt().os===Fn.MAC_OS&&Wt()&&E(),this.createWebSocket(i,!0,!0).then(y=>g.resolve(y)).catch(y=>{this.isNormalPortFailed&&g.reject(y),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(E,this.forceCloseWSDuration)},this.try443PortDuration)})(),g.promise}chooseBestWebsocket(i,r,a,l){return this.useDoubleDomain=!!r,"string"==typeof i&&(i=function(d){let h,p,m;return[,h,p,m]=d.match(fL)||[],h||([,p,m]=d.match(mL)||[]),p&&m||([,p,m]=d.match(_L)||[]),p&&m||([,p]=d.match(BD)||[]),p||w.warning("un-destructible url: ",d),{proxy:h,host:p,port:m||"443"}}(i)),this.recordIndex=l,this.useProxy=!!i.proxy,a&&this.useProxy&&(w.warn("cannot use 443 only when use proxy"),a=!1),this.createWebSocket(i,!!a,!1).finally(()=>this.clearTimeout())}}function HD(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}class GD extends zt{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(i){var r;ye(r=["tryNext","recover"]).call(r,i)&&this.resetReconnectCount(i),this._reconnectMode=i}get state(){return this._state}set state(i){i!==this._state&&(this._state=i,"reconnecting"===this._state?this.emit(Me.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(Me.CONNECTED):"closed"===this._state?this.emit(Me.CLOSED):"failed"===this._state&&this.emit(Me.FAILED))}resetReconnectCount(i){w.debug("websocket reset reconnect count, reason: "+i),this.reconnectCount=0}constructor(i,r){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),C(this,"connectionID",0),C(this,"currentURLIndex",0),C(this,"urls",[]),C(this,"_reconnectMode","tryNext"),C(this,"reconnectReason",void 0),C(this,"_initMutex",new Zn("websocket")),C(this,"name",void 0),C(this,"_state","closed"),C(this,"reconnectInterrupter",void 0),C(this,"websocket",void 0),C(this,"retryConfig",void 0),C(this,"reconnectCount",0),C(this,"forceCloseTimeout",5e3),C(this,"onlineReconnectListener",void 0),C(this,"useCompress",void 0),C(this,"tryDoubleDomain",!1),C(this,"use443PortOnly",!1),C(this,"wsInflateLength",0),C(this,"wsDeflateLength",0),C(this,"closeEstablishingWs",()=>{}),C(this,"store",void 0),C(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=i,this.retryConfig=function(y){for(var b=1;b<arguments.length;b++){var T=null!=arguments[b]?arguments[b]:{};b%2?HD(Object(T),!0).forEach(function(O){C(y,O,T[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(T)):HD(Object(T)).forEach(function(O){Object.defineProperty(y,O,Object.getOwnPropertyDescriptor(T,O))})}return y}({},r),this.useCompress=a,this.tryDoubleDomain=l,this.use443PortOnly=d;const{timeout:p,timeoutFactor:m}=r,g=Math.max(300,Math.floor(3*p/5)),E=Math.max(1.2,Math.floor(8*m)/10);Yi.ONLINE&&(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=E),on.on(dc.NETWORK_STATE_CHANGE,(y,b)=>{y!==b&&(this.resetReconnectCount("network state change: ".concat(b," -> ").concat(y)),y===Yi.ONLINE?(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=E):(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m))})}getConnection(){return this.websocket||void 0}init(i){var r=arguments,a=this;return M(function*(){let l=r.length>1&&void 0!==r[1]?r[1]:5e3;const d=yield a._initMutex.lock();a.forceCloseTimeout=l,a.urls=i,a.state="connecting";try{const h=mf();a.createWebSocketConnection(a.urls[a.currentURLIndex]).then(h.resolve).catch(h.reject),a.once(Me.CLOSED,()=>{h.reject(new J(x.WS_DISCONNECT))}),a.once(Me.CONNECTED,h.resolve),yield h.promise}catch{}finally{d()}})()}close(i,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const a=this.websocket;r?setTimeout(()=>a.close(),500):a.close(),this.websocket=void 0}this.state=i?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(i,r){if(!this.websocket)return void w.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==i&&(this.reconnectMode=i),w.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(r)]},this.joinGatewayRecordIndex);const a=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),a&&a.bind(this.websocket)({code:9999,reason:r})}sendMessage(i){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new J(x.WS_ABORT,"websocket is not ready");try{r||(i=JSON.stringify(i)),this.websocket.send(i)}catch(a){throw new J(x.WS_ERR,"send websocket message error"+a.toString())}}setWsInflateData(i){this.wsDeflateLength=this.wsDeflateLength+i.originLength,this.wsInflateLength=this.wsInflateLength+i.compressedLength}getWsInflateData(){const i=this.wsInflateLength,r=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:i,wsDeflateLength:r}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}createWebSocketConnection(i){var r=this;return M(function*(){var a;const l=mf();r.connectionID+=1,r.joinGatewayRecordIndex=void 0;const d=y=>{var b;null===(b=r.store)||void 0===b||b.signalChannelOpen(),w.debug("[".concat(r.name,"] websocket opened:"),y),r.reconnectMode="retry",r.state="connected",r.resetReconnectCount("opened"),l.resolve()},h=function(){var y=M(function*(b){var T;if(w.debug("[".concat(r.name,"] websocket close ").concat(null===(T=r.websocket)||void 0===T?void 0:T.url,", code: ").concat(b.code,", reason: ").concat(b.reason,", current mode: ").concat(r.reconnectMode)),r.reconnectCount>=r.retryConfig.maxRetryCount)l.reject(new J(x.WS_DISCONNECT,"websocket close: ".concat(b.code))),r.close();else{"connected"===r.state&&(r.reconnectReason=b.reason,r.state="reconnecting");const O=gr(r,Me.WILL_RECONNECT,r.reconnectMode,b.reason)||r.reconnectMode,P=yield r.reconnectWithAction(O);if("closed"===r.state)return void w.debug("[".concat(r.connectionID,"] ws is closed, no need to reconnect"));if(!P)return l.reject(new J(x.WS_DISCONNECT,"websocket reconnect failed: ".concat(b.code))),r.close(!0);l.resolve()}});return function(T){return y.apply(this,arguments)}}(),p=y=>{r.emit(Me.ON_MESSAGE,y)},m=y=>{w.warn("[".concat(r.connectionID,"] ws open error ").concat(y))};r.websocket&&(r.websocket.onclose=null,r.websocket.close()),j("GATEWAY_WSS_ADDRESS")&&r.name.startsWith("gateway")&&(i=j("GATEWAY_WSS_ADDRESS")),w.debug("[".concat(r.name,"] start connect, url:"),i);const g=null===(a=r.store)||void 0===a?void 0:a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var E;const y=yield r.chooseBestWebsocketConnection(i);r.websocket=y,d&&d(r.websocket.url),r.websocket.onclose=h,r.websocket.onmessage=p,r.websocket.onerror=m,null===(E=r.store)||void 0===E||E.recordJoinChannelService({endTs:Date.now(),status:"success"},g),r.joinGatewayRecordIndex=g}catch(y){const b="closed"===r.state,T=y instanceof J,O=T&&y.code===x.WS_ABORT,P=T&&y.code===x.WS_ERR,D=T?y.message:y&&(y.reason||y.toString());w.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(D)),r.store&&r.store.recordJoinChannelService({endTs:Date.now(),status:O?"aborted":"error",errors:[y]},g),b||P?(l.reject(b?new J(x.WS_DISCONNECT,"websocket is closed: ".concat(D)):new J(x.WS_ERR,"init websocket failed: ".concat(D))),P&&w.error("[".concat(r.name,"] init websocket failed: ").concat(D))):h&&h(y)}return l.promise})()}reconnectWithAction(i){var r=arguments,a=this;return M(function*(){let l=!(r.length>1&&void 0!==r[1])||r[1];if(a.reconnectCount>=a.retryConfig.maxRetryCount||0===a.urls.length||"closed"===a.state)return!1;w.warning("[choose-best-ws] action: =>",i),a.onlineReconnectListener||on.isOnline||!on.onlineWaiter||(a.onlineReconnectListener=on.onlineWaiter.then(()=>{a.onlineReconnectListener=void 0}));let d=!0;if(a.reconnectInterrupter=()=>d=!1,l){const m=wt(a.reconnectCount,a.retryConfig);w.debug("[".concat(a.name,"] wait ").concat(m,"ms to reconnect websocket, mode: ").concat(i)),yield q.race([_i(m),a.onlineReconnectListener||new q(()=>{})])}if("closed"===a._state||!d)return!1;a.reconnectCount+=1;const h=function(){var m=M(function*(g,E){a.emit(Me.RECONNECT_CREATE_CONNECTION,E),yield a.createWebSocketConnection(g)});return function(E,y){return m.apply(this,arguments)}}();try{if("retry"===i)a.emit(Me.RECONNECT_WAITTING_FINISH,i),yield h(a.urls[a.currentURLIndex],i);else if("tryNext"===i){if(a.currentURLIndex+=1,a.currentURLIndex>=a.urls.length)return a.reconnectWithAction("recover",!1);w.debug("[".concat(a.name,"] websocket url length: ").concat(a.urls.length," current index: ").concat(a.currentURLIndex)),a.emit(Me.RECONNECT_WAITTING_FINISH,i),yield h(a.urls[a.currentURLIndex],i)}else"recover"===i&&(w.debug("[".concat(a.name,"] request new urls")),a.resetReconnectCount("recover mode"),a.emit(Me.RECONNECT_WAITTING_FINISH,i),a.urls=yield Jt(a,Me.REQUEST_NEW_URLS),a.currentURLIndex=0,yield h(a.urls[a.currentURLIndex],i))}catch(m){var p;w.error("[".concat(a.name,"] reconnect failed ").concat(m&&m.toString()));const g=null==m||null===(p=m.data)||void 0===p?void 0:p.desc;return Array.isArray(g)&&ye(g).call(g,"dynamic key expired")?(a.emit(Me.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):a.reconnectWithAction(i,l)}return!0})()}}class yE extends GD{constructor(i,r){super(i,r,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(i,r){var a=this;return M(function*(){const l=mf(),d=new jD(a.forceCloseTimeout,a.store);a.closeEstablishingWs=()=>{w.debug("[choose-best-ws] close establishing websockets"),d.closeAllWebsockets(),l.reject(new J(x.WS_ABORT,"choose best websocket aborted"))};const h=j("GATEWAY_DOMAINS");return w.debug("[choose-best-ws] currentDomain: ",i,", domains: ",h,"total: ".concat(a.urls.length),"current: ".concat(a.currentURLIndex+1)),d.chooseBestWebsocket(i,a.tryDoubleDomain,a.use443PortOnly,r).then(l.resolve).catch(l.reject),l.promise.finally(()=>{a.closeEstablishingWs=void 0})})()}}class Uf extends GD{constructor(i,r){super(i,r,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(i,r){var a=this;return M(function*(){return new q((l,d)=>{let h=!1;const p=[];a.closeEstablishingWs=()=>{w.debug("[choose-best-ws] close establishing websockets"),p.forEach(P=>{P.onclose=null,P.onopen=null,P.onmessage=null,P.close()}),d(new J(x.WS_ABORT,"choose best websocket aborted"))};const m=j("GATEWAY_DOMAINS");let g;const E=i.indexOf("?h="),y=m.find(P=>-1!==E?ye(i).call(i,P,E):ye(i).call(i,P));w.debug("[choose-best-ws] currentDomain: ",y,", domains: ",m);let b=!a.tryDoubleDomain||!y;if(!b&&y){var T;const P=Date.now();try{m.forEach(D=>{const L=-1===E?i.replace(y,D):i.substr(0,E)+i.substr(E).replace(y,D),B=new WebSocket(L);B.binaryType="arraybuffer",p.push(B),w.debug("[choose-best-ws] ws is connecting:",B.url)})}catch{for(w.debug("[choose-best-ws] ws create failed, fallback to single url"),p.forEach(L=>L.close());p.length;)p.pop();b=!0}null===(T=a.store)||void 0===T||T.recordJoinChannelService({urls:p.map(D=>D.url),service:"gateway"},r),p.forEach(D=>{D.onopen=()=>{if(h)return;const L=Date.now()-P;w.debug("[choose-best-ws] ws open cost ".concat(L,"ms")),p.filter(B=>B!==D).forEach(B=>{w.debug("[choose-best-ws]close backup websocket: ".concat(B.url)),B.close()}),h=!0,l(D)},D.onclose=L=>{g=L,!h&&(p.find(B=>!(B.readyState===WebSocket.CLOSED||B.readyState===WebSocket.CLOSING))||(w.debug("[choose-best-ws] all websocket is closed"),h=!0,d(g)))},D.onmessage=L=>{w.debug("[choose-best-ws]".concat(D.url," onmessage: ").concat(L.data))}}),_i(a.forceCloseTimeout).then(()=>{p.forEach(D=>{D.readyState!==WebSocket.OPEN&&D.close()})})}if(b){var O;let P;w.debug("[choose-best-ws] use single url: ",i),null===(O=a.store)||void 0===O||O.recordJoinChannelService({urls:[i],service:"gateway"},r);try{P=new WebSocket(i),p.push(P),P.binaryType="arraybuffer"}catch(D){const L=new J(x.WS_ERR,"init websocket failed! Error: ".concat(D.toString()));return w.error("[".concat(a.name,"]").concat(L)),void d(L)}P.onopen=()=>{l(P)},P.onclose=D=>{d(D)},P.onmessage=D=>{w.debug("[choose-best-ws]".concat(P.url," onmessage: ").concat(D.data))},_i(a.forceCloseTimeout).then(()=>{P&&P.readyState!==WebSocket.OPEN&&P.close()})}}).then(l=>(a.closeEstablishingWs=void 0,l)).catch(l=>{throw a.closeEstablishingWs=void 0,l})})()}}class WD extends zt{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===Ke.CONNECTED?this.emit(he.WS_CONNECTED):i===Ke.RECONNECTING?this.emit(he.WS_RECONNECTING,this._websocketReconnectReason):i===Ke.CLOSED&&this.emit(he.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(i,r){super(),C(this,"_disconnectedReason",void 0),C(this,"_websocketReconnectReason",void 0),C(this,"_connectionState",Ke.CLOSED),C(this,"reconnectToken",void 0),C(this,"websocket",void 0),C(this,"openConnectionTime",void 0),C(this,"clientId",void 0),C(this,"lastMsgTime",Date.now()),C(this,"uploadCache",[]),C(this,"uploadCacheInterval",void 0),C(this,"rttRolling",new en(5)),C(this,"pingpongTimer",void 0),C(this,"wsInflateDataTimer",void 0),C(this,"pingpongTimeoutCount",0),C(this,"joinResponse",void 0),C(this,"multiIpOption",void 0),C(this,"initError",void 0),C(this,"spec",void 0),C(this,"store",void 0),C(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(he.ON_BINARY_DATA,a.data);const l=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(l,"_id")){const d="res-@".concat(l._id);this.emit(d,l._result,l._message)}else if(Object.prototype.hasOwnProperty.call(l,"_type")){if(this.emit(l._type,l._message),l._type===Ue.ON_NOTIFICATION&&this.handleNotification(l._message),l._type===Ue.ON_USER_BANNED)switch(l._message.error_code){case 14:this.close(Ye.UID_BANNED);break;case 15:this.close(Ye.IP_BANNED);break;case 16:this.close(Ye.CHANNEL_BANNED)}if(l._type===Ue.ON_USER_LICENSE_BANNED)switch(l._message.error_code){case Ie.ERR_LICENSE_MISSING:this.close(Ye.LICENSE_MISSING);break;case Ie.ERR_LICENSE_EXPIRED:this.close(Ye.LICENSE_EXPIRED);break;case Ie.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ye.LICENSE_MINUTES_EXCEEDED);break;case Ie.ERR_LICENSE_PERIOD_INVALID:this.close(Ye.LICENSE_PERIOD_INVALID);break;case Ie.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ye.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ie.ERR_LICENSE_ILLEGAL:this.close(Ye.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=i.clientId,this.spec=i,this.store=r,this.websocket=new yE("gateway-".concat(this.clientId),this.spec.retryConfig,!0,j("JOIN_GATEWAY_USE_DUAL_DOMAIN"),j("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ke.CONNECTED&&this.reconnect("retry",qn.OFFLINE)})}request(i,r,a,l){var d=this;return M(function*(){const h=Fe(6,""),p={_id:h,_type:i,_message:r},m=d.websocket.connectionID,g=()=>new q((P,D)=>{if(d.connectionState===Ke.CONNECTED)return P();const L=()=>{d.off(he.WS_CLOSED,B),P()},B=()=>{d.off(he.WS_CONNECTED,L),D(new W(x.WS_ABORT))};d.once(he.WS_CONNECTED,L),d.once(he.WS_CLOSED,B),i!==Ce.PUBLISH&&i!==Ce.SUBSCRIBE&&i!==Ce.UNSUBSCRIBE&&i!==Ce.UNPUBLISH&&i!==Ce.CONTROL&&i!==Ce.RESTART_ICE||d.once(he.DISCONNECT_P2P,()=>{D(new W(x.DISCONNECT_P2P))}),i!==Ce.PUBLISH&&i!==Ce.RESTART_ICE||d.once(he.ABORT_P2P_EXECUTION,()=>{D(new W(x.DISCONNECT_P2P))})});if(d.connectionState!==Ke.CONNECTING&&d.connectionState!==Ke.RECONNECTING||i===Ce.JOIN||i===Ce.REJOIN||(yield g()),d.websocket.sendMessage(p,!0),l)return;const E=new q((P,D)=>{let L=!1;const B=(Q,se)=>{L=!0,P({isSuccess:"success"===Q,message:se||{}}),d.off(he.WS_CLOSED,V),d.off(he.WS_RECONNECTING,V),d.emit(he.REQUEST_SUCCESS,i,r)};d.once("res-@".concat(h),B);const V=()=>{D(new W(x.WS_ABORT,"type: ".concat(i))),d.off(he.WS_CLOSED,V),d.off(he.WS_RECONNECTING,V),d.off("res-@".concat(h),B)};d.once(he.WS_CLOSED,V),d.once(he.WS_RECONNECTING,V),_i(j("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||L||(w.warning("[".concat(d.clientId,"] ws request timeout, type: ").concat(i)),d.emit(he.REQUEST_TIMEOUT,i,r))})});let y=null;try{y=yield E}catch(P){if(d.connectionState===Ke.CLOSED||i===Ce.LEAVE)throw new W(x.WS_ABORT);return!d.spec.forceWaitGatewayResponse||a?P.throw():i===Ce.JOIN||i===Ce.REJOIN?null:(yield g(),yield d.request(i,r))}if(y.isSuccess)return y.message;const b=Number(y.message.error_code||y.message.code),T=El(b),O=new W(x.UNEXPECTED_RESPONSE,"".concat(T.desc,": ").concat(y.message.error_str),{code:b,data:y.message});return"success"===T.action?y.message:(w.warning("[".concat(d.clientId,"] [").concat(d.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(b,", message: ").concat(T.desc,", action: ").concat(T.action)),b===Ie.ERR_TOO_MANY_BROADCASTERS?((i===Ce.JOIN||i===Ce.REJOIN)&&(d.initError=O,d.close()),O.throw()):"failed"===T.action?O.throw():"quit"===T.action?(d.initError=O,d.close(),O.throw()):(b===Ie.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=y.message.option,w.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",qn.MULTI_IP)):d.reconnect(T.action,qn.SERVER_ERROR),i===Ce.JOIN||i===Ce.REJOIN?null:yield d.request(i,r)))})()}waitMessage(i,r){return new q(a=>{const l=d=>{(!r||r(d))&&(this.off(i,l),a(d))};this.on(i,l)})}upload(i,r){const a={_type:i,_message:r};try{this.websocket.sendMessage(a)}catch{const d=j("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ke.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},j("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,r){this.websocket.sendMessage({_type:i,_message:r})}init(i,r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new q((a,l)=>{this.once(he.WS_CONNECTED,()=>a(this.joinResponse)),this.once(he.WS_CLOSED,()=>l(this.initError||new W(x.WS_ABORT))),this.connectionState=Ke.CONNECTING,this.websocket.init(i).catch(l),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=i||Ye.LEAVE,this.connectionState=Ke.CLOSED,w.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),i===Ye.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new yE("gateway-".concat(this.clientId),this.spec.retryConfig,!0,j("JOIN_GATEWAY_USE_DUAL_DOMAIN"),j("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}join(){var i=this;return M(function*(){if(!i.joinResponse){i.emit(he.ABORT_P2P_EXECUTION);const r=yield Jt(i,he.REQUEST_JOIN_INFO),a=yield i.request(Ce.JOIN,r);if(!a)return i.emit(he.REPORT_JOIN_GATEWAY,bd.TIMEOUT,i.url||""),!1;i.joinResponse=a,i.emit(he.JOIN_RESPONSE,i.joinResponse),i.reconnectToken=i.joinResponse.rejoin_token}return i.connectionState=Ke.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),!0})()}rejoin(){var i=this;return M(function*(){if(!i.reconnectToken)throw new W(x.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=uc(i,he.REQUEST_REJOIN_INFO);r.token=i.reconnectToken;const a=yield i.request(Ce.REJOIN,r);return!!a&&(i.connectionState=Ke.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),a.peers&&a.peers.forEach(l=>{i.emit(Ue.ON_USER_ONLINE,{uid:l.uid}),l.audio&&i.emit(Ue.ON_ADD_AUDIO_STREAM,{uid:l.uid,uint_id:l.uint_id,audio:!0,ssrcId:l.audio_ssrc}),l.video&&i.emit(Ue.ON_ADD_VIDEO_STREAM,{uid:l.uid,uint_id:l.uint_id,video:!0,ssrcId:l.video_ssrc}),i.emit(l.audio_mute?Ue.MUTE_AUDIO:Ue.UNMUTE_AUDIO,{uid:l.uid}),i.emit(l.video_mute?Ue.MUTE_VIDEO:Ue.UNMUTE_VIDEO,{uid:l.uid}),i.emit(l.audio_enable_local?Ue.ENABLE_LOCAL_AUDIO:Ue.DISABLE_LOCAL_AUDIO,{uid:l.uid}),i.emit(l.video_enable_local?Ue.ENABLE_LOCAL_VIDEO:Ue.DISABLE_LOCAL_VIDEO,{uid:l.uid}),l.audio||l.video||i.emit(Ue.ON_REMOVE_STREAM,{uid:l.uid,uint_id:l.uint_id})}),!0)})()}reconnect(i,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,r)}handleNotification(i){w.debug("[".concat(this.clientId,"] receive notification: "),i);const r=El(i.code);if("success"!==r.action){if("failed"!==r.action)return"quit"===r.action?("ERR_REPEAT_JOIN_CHANNEL"===r.desc&&this.close(Ye.UID_BANNED),void this.close()):void this.reconnect(r.action,qn.SERVER_ERROR);w.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=j("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=i&&(w.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>j("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",qn.TIMEOUT):this.request(Ce.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-r;this.rttRolling.add(a),j("REPORT_STATS")&&this.send(Ce.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWsInflateData(){const{wsInflateLength:i,wsDeflateLength:r}=this.websocket.getWsInflateData();0!==i&&0!==r&&this.upload(Xi.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:i})}handleWebsocketEvents(){this.websocket.on(Me.RECONNECT_WAITTING_FINISH,i=>{this.emit(he.WS_RECONNECT_WAITTING_FINISH,i)}),this.websocket.on(Me.RECONNECT_CREATE_CONNECTION,i=>{this.emit(he.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(Me.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Me.CLOSED,()=>{this.connectionState=Ke.CLOSED}),this.websocket.on(Me.FAILED,()=>{this._disconnectedReason=Ye.NETWORK_ERROR,this.connectionState=Ke.CLOSED}),this.websocket.on(Me.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState=this.connectionState===Ke.CONNECTED?Ke.RECONNECTING:Ke.CONNECTING}),this.websocket.on(Me.WILL_RECONNECT,(i,r,a)=>{const l=uc(this,he.IS_P2P_DISCONNECTED),d=l||"retry"!==i;l&&"retry"===i&&(w.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),i="tryNext",r=bd.P2P_DISCONNECTED),d&&(w.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(i)),this.emit(he.REPORT_JOIN_GATEWAY,r||bd.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(he.NEED_RENEW_SESSION),this.emit(he.DISCONNECT_P2P)),a(i)}),this.websocket.on(Me.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(i=>{w.warning("[".concat(this.clientId,"] rejoin failed ").concat(i)),this.reconnect("tryNext",qn.SERVER_ERROR)}):this.join().catch(i=>{if(this.emit(he.REPORT_JOIN_GATEWAY,i.message||i.code||bd.UNKNOWN_REASON,this.url||""),i instanceof W&&i.code===x.UNEXPECTED_RESPONSE&&i.data.code===Ie.ERR_NO_AUTHORIZED)return w.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",qn.SERVER_ERROR);w.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",qn.SERVER_ERROR):(this.initError=i,this.close())})}),this.websocket.on(Me.REQUEST_NEW_URLS,(i,r)=>{Jt(this,he.REQUEST_RECOVER,this.multiIpOption).then(i).catch(r)}),this.websocket.on(Me.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var zD="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",gL=au,EL=Vo,hC=zD,pC=ti("".replace),vL=RegExp("^["+hC+"]+"),yL=RegExp("(^|[^"+hC+"])["+hC+"]+$"),fC=function(s){return function(i){var r=EL(gL(i));return 1&s&&(r=pC(r,vL,"")),2&s&&(r=pC(r,yL,"$1")),r}},bL={start:fC(1),end:fC(2),trim:fC(3)},SL=FI.PROPER,Vf=pi,mC=zD,qD=bL.trim;Ct({target:"String",proto:!0,forced:function(s){return Vf(function(){return!!mC[s]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[s]()||SL&&mC[s].name!==s})}("trim")},{trim:function(){return qD(this)}});var Yn,$n,KD=ke("String").trim,bE=Ms,CL=KD,YD=String.prototype,$D=lr(function(s){var i=s.trim;return"string"==typeof s||s===YD||bE(YD,s)&&i===YD.trim?CL:i});function fc(s,i,r){return{sampleRate:s,stereo:i,bitrate:r}}function rt(s,i,r,a,l){return{width:s,height:i,frameRate:r,bitrateMin:a,bitrateMax:l}}function bs(s,i,r,a,l){return{width:{max:s},height:{max:i},frameRate:r,bitrateMin:a,bitrateMax:l}}function _C(s,i){return{numSpatialLayers:s,numTemporalLayers:i}}(function(s){s[s.CHOOSE_SERVER=11]="CHOOSE_SERVER",s[s.CLOUD_PROXY=18]="CLOUD_PROXY",s[s.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",s[s.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"})(Yn||(Yn={})),function(s){s.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",s.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",s.IOS_INTERRUPTION_START="ios-interruption-start",s.IOS_INTERRUPTION_END="ios-interruption-end",s.STATE_CHANGE="state-change"}($n||($n={}));const TL={"90p":rt(160,90),"90p_1":rt(160,90),"120p":rt(160,120,15,30,65),"120p_1":rt(160,120,15,30,65),"120p_3":rt(120,120,15,30,50),"120p_4":rt(212,120),"180p":rt(320,180,15,30,140),"180p_1":rt(320,180,15,30,140),"180p_3":rt(180,180,15,30,100),"180p_4":rt(240,180,15,30,120),"240p":rt(320,240,15,40,200),"240p_1":rt(320,240,15,40,200),"240p_3":rt(240,240,15,40,140),"240p_4":rt(424,240,15,40,220),"360p":rt(640,360,15,80,400),"360p_1":rt(640,360,15,80,400),"360p_3":rt(360,360,15,80,260),"360p_4":rt(640,360,30,80,600),"360p_6":rt(360,360,30,80,400),"360p_7":rt(480,360,15,80,320),"360p_8":rt(480,360,30,80,490),"360p_9":rt(640,360,15,80,800),"360p_10":rt(640,360,24,80,800),"360p_11":rt(640,360,24,80,1e3),"480p":rt(640,480,15,100,500),"480p_1":rt(640,480,15,100,500),"480p_2":rt(640,480,30,100,1e3),"480p_3":rt(480,480,15,100,400),"480p_4":rt(640,480,30,100,750),"480p_6":rt(480,480,30,100,600),"480p_8":rt(848,480,15,100,610),"480p_9":rt(848,480,30,100,930),"480p_10":rt(640,480,10,100,400),"720p":rt(1280,720,15,120,1130),"720p_auto":rt(1280,720,30,900,3e3),"720p_1":rt(1280,720,15,120,1130),"720p_2":rt(1280,720,30,120,2e3),"720p_3":rt(1280,720,30,120,1710),"720p_5":rt(960,720,15,120,910),"720p_6":rt(960,720,30,120,1380),"1080p":rt(1920,1080,15,120,2080),"1080p_1":rt(1920,1080,15,120,2080),"1080p_2":rt(1920,1080,30,120,3e3),"1080p_3":rt(1920,1080,30,120,3150),"1080p_5":rt(1920,1080,60,120,4780),"1440p":rt(2560,1440,30,120,4850),"1440p_1":rt(2560,1440,30,120,4850),"1440p_2":rt(2560,1440,60,120,7350),"4k":rt(3840,2160,30,120,8910),"4k_1":rt(3840,2160,30,120,8910),"4k_3":rt(3840,2160,60,120,13500)},vl=[{scaleResolutionDownBy:2,width:1280,height:720,frameRate:30,bitrateMin:300,bitrateMax:900},{scaleResolutionDownBy:1.333333,width:1280,height:720,frameRate:30,bitrateMin:600,bitrateMax:2e3},{scaleResolutionDownBy:1,width:1280,height:720,frameRate:30,bitrateMin:900,bitrateMax:3e3}],wL={"480p":bs(640,480,5),"480p_1":bs(640,480,5),"480p_2":bs(640,480,30),"480p_3":bs(640,480,15),"720p":bs(1280,720,5),"720p_auto":rt(1280,720,30,900,3e3),"720p_1":bs(1280,720,5),"720p_2":bs(1280,720,30),"720p_3":bs(1280,720,15),"1080p":bs(1920,1080,5),"1080p_1":bs(1920,1080,5),"1080p_2":bs(1920,1080,30),"1080p_3":bs(1920,1080,15)},gC={"1SL1TL":_C(1,1),"3SL3TL":_C(3,3),"2SL3TL":_C(2,3)};function Ma(s){return s||(s="480p_1"),"string"==typeof s?Object.assign({},TL[s]):s}function XD(s){return"string"==typeof s?Object.assign({},wL[s]):s}function SE(s){return"string"==typeof s?Object.assign({},gC[s]):s}const _3={speech_low_quality:fc(16e3,!1),speech_standard:fc(32e3,!1,18),music_standard:fc(48e3,!1),standard_stereo:fc(48e3,!0,56),high_quality:fc(48e3,!1,128),high_quality_stereo:fc(48e3,!0,192)};function Ss(s){return"string"==typeof s?Object.assign({},_3[s]):s}const Sh=[];function JD(s){return gn(s,"mediaSource",["screen","window","application"]),!0}var me,Ot,mc,CE,TE,_c,yl,Cd,yr,wE;(function(s){s.NEED_RENEGOTIATE="@need_renegotiate",s.NEED_REPLACE_TRACK="@need_replace_track",s.NEED_CLOSE="@need_close",s.NEED_ENABLE_TRACK="@need_enable_track",s.NEED_DISABLE_TRACK="@need_disable_track",s.NEED_SESSION_ID="@need_sid",s.SET_OPTIMIZATION_MODE="@set_optimization_mode",s.GET_STATS="@get_stats",s.GET_RTC_STATS="@get_rtc_stats",s.GET_LOW_VIDEO_TRACK="@get_low_video_track",s.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",s.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",s.NEED_MUTE_TRACK="@need_mute_track",s.NEED_UNMUTE_TRACK="@need_unmute_track"})(me||(me={})),function(s){s.SCREEN_TRACK="screen_track",s.CUSTOM_TRACK="custome_track",s.LOW_STREAM="low_stream"}(Ot||(Ot={})),function(s){s[s.HIGH_STREAM=0]="HIGH_STREAM",s[s.LOW_STREAM=1]="LOW_STREAM"}(mc||(mc={})),function(s){s[s.HIGH_STREAM=0]="HIGH_STREAM",s[s.LOW_STREAM=1]="LOW_STREAM"}(CE||(CE={})),function(s){s[s.DISABLE=0]="DISABLE",s[s.LOW_STREAM=1]="LOW_STREAM",s[s.AUDIO_ONLY=2]="AUDIO_ONLY"}(TE||(TE={})),function(s){s.TRANSCEIVER_UPDATED="transceiver-updated"}(_c||(_c={})),function(s){s.SOURCE_STATE_CHANGE="source-state-change",s.TRACK_ENDED="track-ended",s.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",s.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",s.CLOSED="closed"}(yl||(yl={})),function(s){s.FIRST_FRAME_DECODED="first-frame-decoded",s.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(Cd||(Cd={})),function(s){s.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",s.RECEIVE_TRACK_BUFFER="receive_track_buffer",s.ON_AUDIO_BUFFER="on_audio_buffer",s.UPDATE_SOURCE="update_source"}(yr||(yr={})),function(s){s.UPDATE_TRACK_SOURCE="update-track-source"}(wE||(wE={}));const EC={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},IE={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Jo={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},IL={uplinkNetworkQuality:0,downlinkNetworkQuality:0},QD={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var Ii,br,gc,ka,Vi;(function(s){s.ON_TRACK="on_track",s.ON_NODE="on_node"})(Ii||(Ii={})),function(s){s.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",s.REQUEST_CONSTRAINTS="request_constraints"}(br||(br={})),function(s){s.IDLE="IDLE",s.INITING="INITING",s.INITEND="INITEND"}(gc||(gc={})),function(s){s.STATE_CHANGE="state_change",s.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",s.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",s.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(ka||(ka={})),function(s){s.NONE="none",s.INIT="init",s.CANPLAY="canplay",s.PLAYING="playing",s.PAUSED="paused",s.SUSPEND="suspend",s.STALLED="stalled",s.WAITING="waiting",s.ERROR="error",s.DESTROYED="destroyed",s.ABORT="abort",s.ENDED="ended",s.EMPTIED="emptied",s.LOADEDDATA="loadeddata"}(Vi||(Vi={}));const RE={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};var Td;!function(s){s.OPEN="open",s.MESSAGE="message",s.CLOSE="close",s.CLOSING="closing",s.ERROR="error"}(Td||(Td={}));class ZD extends zt{constructor(i,r){super(),C(this,"_ID",void 0),C(this,"_rtpTransceiver",void 0),C(this,"_lowRtpTransceiver",void 0),C(this,"_hints",[]),C(this,"_isClosed",!1),C(this,"_originMediaStreamTrack",void 0),C(this,"_mediaStreamTrack",void 0),C(this,"_external",{}),this._ID=r||Fe(8,"track-"),this._originMediaStreamTrack=i,this._mediaStreamTrack=i,ye(Sh).call(Sh,this)||Sh.push(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(i){if(!i){Se.reportApiInvoke(null,{name:On.GET_MEDIA_STREAM_TRACK,options:[],tag:Xt.TRACER}).onSuccess(this._mediaStreamTrack&&"string"==typeof this._mediaStreamTrack.label?this._mediaStreamTrack.label:"")}return this._mediaStreamTrack}getRTCRtpTransceiver(i){return i===mc.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(i){const r=Sh.indexOf(i);-1!==r&&Sh.splice(r,1)}(this),this.emit(yl.CLOSED)}_updateRtpTransceiver(i,r){if(r===mc.LOW_STREAM){if(this._lowRtpTransceiver===i)return;this._lowRtpTransceiver=i}else{if(this._rtpTransceiver===i)return;this._rtpTransceiver=i}this.emit(_c.TRANSCEIVER_UPDATED,i,r)}}class Ri extends ZD{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(i){this._processorContext=i}constructor(i,r){super(i,r),C(this,"_enabled",!0),C(this,"_muted",!1),C(this,"_isExternalTrack",!1),C(this,"_isClosed",!1),C(this,"_enabledMutex",void 0),C(this,"processor",void 0),C(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Zn("".concat(this.getTrackId())),i.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var i,r;return null!==(i=null===(r=this._originMediaStreamTrack)||void 0===r?void 0:r.label)&&void 0!==i?i:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,w.debug("[".concat(this.getTrackId(),"] close")),this.emit(me.NEED_CLOSE),super.close())}_updateOriginMediaStreamTrack(i,r){var a=arguments,l=this;return M(function*(){l._isExternalTrack=a.length>2&&void 0!==a[2]&&a[2],i!==l._originMediaStreamTrack&&(l._originMediaStreamTrack&&(l._originMediaStreamTrack.removeEventListener("ended",l._handleTrackEnded),r&&l._originMediaStreamTrack.stop()),i.addEventListener("ended",l._handleTrackEnded),l._originMediaStreamTrack=i,l._muted&&(l._originMediaStreamTrack.enabled=!1),l._mediaStreamTrack=l._originMediaStreamTrack,l._updatePlayerSource(),yield Et(l,me.NEED_REPLACE_TRACK,l),l.processor&&l.processor.updateInput({track:l._originMediaStreamTrack,context:l.processorContext}))})()}_getDefaultPlayerConfig(){return{}}onTrackEnded(){w.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(yl.TRACK_ENDED)}stateCheck(i,r){if(w.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(i,": ").concat(r,"]")),_s(r,i),this._enabled&&this._muted&&"enabled"===i&&!1===r)throw new J(x.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",w);if(!this._enabled&&!this._muted&&"muted"===i&&!0===r)throw new J(x.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",w)}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function AE(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}const DE=window.AudioContext||window.webkitAudioContext;let $r=null;const vt=new class extends zt{constructor(){var s;super(...arguments),s=this,C(this,"prevState",void 0),C(this,"curState",void 0),C(this,"currentTime",void 0),C(this,"currentTimeStuckAt",void 0),C(this,"interruptDetectorTrack",void 0),C(this,"onLocalAudioTrackMute",()=>{w.info("ios15-interruption-start"),this.emit($n.IOS_15_16_INTERRUPTION_START)}),C(this,"onLocalAudioTrackUnmute",M(function*(){w.info("ios15-interruption-end"),"running"!==s.curState||s.duringInterruption?w.info("ios15-interruption-end-canceled"):($r&&(yield $r.suspend()),s.emit($n.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(s){w.debug("webaudio bindInterruptDetectorTrack ".concat(s.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=s,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(s){w.debug("webaudio unbindInterruptDetectorTrack ".concat(s.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===s&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Ch(){if(!$r){if(function vC(){if(!DE)return void w.error("your browser is not support web audio");w.info("create audio context");const s=function(i){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?AE(Object(a),!0).forEach(function(l){C(i,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):AE(Object(a)).forEach(function(l){Object.defineProperty(i,l,Object.getOwnPropertyDescriptor(a,l))})}return i}({},j("WEBAUDIO_INIT_OPTIONS"));var i;w.debug("audio context init option:",JSON.stringify(s)),$r=new DE(s),vt.curState=$r.state,$r.onstatechange=()=>{vt.prevState=vt.curState,vt.curState=$r?$r.state:void 0;const{prevState:i,curState:r}=vt,a="running"===r,l="interrupted"===r,d="running"===i,h="suspended"===i,p="interrupted"===i,m=dt().osVersion;(Li()||po())&&d&&l&&(w.info("ios".concat(m,"-interruption-start")),vt.emit($n.IOS_INTERRUPTION_START)),(Li()||po())&&(h||p)&&a&&(w.info("ios".concat(m,"-interruption-end")),vt.emit($n.IOS_INTERRUPTION_END)),i!==r&&(w.debug("AudioContext State Change","".concat(i,"=>").concat(r)),vt.emit($n.STATE_CHANGE))},setInterval(()=>{var i;const r=null===(i=$r)||void 0===i?void 0:i.currentTime;vt.currentTime!==r?(vt.currentTimeStuckAt&&(w.debug("AudioContext current time resume at ".concat(r)),vt.currentTimeStuckAt=void 0),vt.currentTime=r):(r!==vt.currentTimeStuckAt&&(Se.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:r},tag:Xt.TRACER}).onSuccess(),w.warning("AudioContext current time stuck at ".concat(r))),vt.currentTimeStuckAt=r)},5e3),(i=M(function*(r){const a=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let l,d=!1,h=!1,p=!1;function m(L){"running"===r.state?g(!1):Li()||po()?"suspended"===r.state&&(g(!0),L&&r.resume().then(y,y)):"closed"!==r.state&&(g(!0),L&&r.resume().then(y,y))}function g(L){if(d!==L){d=L;for(let B=0,V=a;B<V.length;B+=1){const Q=V[B];L?window.addEventListener(Q,b,{capture:!0,passive:!0}):window.removeEventListener(Q,b,{capture:!0,passive:!0})}}}function y(){m(!1)}function b(){m(!0)}function T(L){if(!p)if(l.paused)if(L){let B;O(!1),p=!0;try{B=l.play(),B?B.then(P,P):(l.addEventListener("playing",P),l.addEventListener("abort",P),l.addEventListener("error",P))}catch{P()}}else O(!0);else O(!1)}function O(L){if(h!==L){h=L;for(let B=0,V=a;B<V.length;B++){const Q=V[B];L?window.addEventListener(Q,D,{capture:!0,passive:!0}):window.removeEventListener(Q,D,{capture:!0,passive:!0})}}}function P(){l.removeEventListener("playing",P),l.removeEventListener("abort",P),l.removeEventListener("error",P),p=!1,T(!1)}function D(){T(!0)}if(Li()){const L=r.createMediaStreamDestination(),B=document.createElement("div");B.innerHTML="<audio x-webkit-airplay='deny'></audio>",l=B.children.item(0),l.controls=!1,l.disableRemotePlayback=!0,l.preload="auto",l.srcObject=L.stream,T(!0)}vt.on($n.STATE_CHANGE,function E(){m(!0)}),m(!1)}),function(r){return i.apply(this,arguments)})($r)}(),!$r)throw new J(x.NOT_SUPPORTED,"can not create audio context");return $r}return $r}function eO(){return!!$r}function wd(s){if(function(){if(null!==yC)return yC;const a=Ch(),l=a.createBufferSource(),d=a.createGain(),h=a.createGain();l.connect(d),l.connect(h),l.disconnect(d);let p=!1;try{l.disconnect(d)}catch{p=!0}return l.disconnect(),yC=p,p}())return;const i=s.connect,r=s.disconnect;s.connect=(a,l,d)=>{var h;return s._inputNodes||(s._inputNodes=[]),ye(h=s._inputNodes).call(h,a)||(a instanceof AudioNode?(s._inputNodes.push(a),i.call(s,a,l,d)):i.call(s,a,l)),s},s.disconnect=(a,l,d)=>{r.call(s),a?RS(s._inputNodes,a):s._inputNodes=[];for(const h of s._inputNodes)i.call(s,h)}}let yC=null;function OE(s,i){let r=!1;const a=1/i;if(j("DISABLE_WEBAUDIO")){const l=window.setInterval(()=>{r?window.clearInterval(l):s(performance.now()/1e3)},1e3*a)}else{const l=Ch();let d=l.createGain();d.gain.value=0,d.connect(l.destination);const h=()=>{if(r)return void(d=null);const p=l.createOscillator();p.onended=h,p.connect(d),p.start(0),p.stop(l.currentTime+a),s(l.currentTime)};h()}return()=>{r=!0}}const Ei={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1};function $e(){return Ei}class Js{constructor(){C(this,"context",void 0),C(this,"analyserNode",void 0),C(this,"sourceNode",void 0),this.context=Ch(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(i){if(i!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=i,i?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Li()||po()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode))return 0;const i=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(i);else{const a=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(a);for(let l=0;l<i.length;++l)i[l]=a[l]/128-1}const r=ll(i).call(i,(a,l)=>a+l*l,0)/i.length;return Math.max(10*Math.log10(r)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var i,r;null===(i=this.sourceNode)||void 0===i||i.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(r=this.sourceNode)||void 0===r||r.connect(this.analyserNode)}catch{w.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class La extends zt{get processSourceNode(){return this.sourceNode}set processedNode(i){var r;if(!this.isDestroyed&&this._processedNode!==i){try{var a;null===(a=this.sourceNode)||void 0===a||a.disconnect(this.outputNode)}catch{}null===(r=this._processedNode)||void 0===r||r.disconnect(),this._processedNode=i,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),C(this,"outputNode",void 0),C(this,"outputTrack",void 0),C(this,"isPlayed",!1),C(this,"context",void 0),C(this,"audioBufferNode",void 0),C(this,"destNode",void 0),C(this,"audioOutputLevel",0),C(this,"volumeLevelAnalyser",void 0),C(this,"_processedNode",void 0),C(this,"playNode",void 0),C(this,"isDestroyed",!1),C(this,"onNoAudioInput",void 0),C(this,"isNoAudioInput",!1),C(this,"_noAudioInputCount",0),this.context=Ch(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),wd(this.outputNode),this.volumeLevelAnalyser=new Js}startGetAudioBuffer(i){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(i),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=r=>{this.emit(yr.ON_AUDIO_BUFFER,function(a){for(let l=0;l<a.outputBuffer.numberOfChannels;l+=1){const d=a.outputBuffer.getChannelData(l);for(let h=0;h<d.length;h+=1)d[h]=0}return a.inputBuffer}(r))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!$e().webAudioMediaStreamDest)throw new J(x.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(i){"running"!==this.context.state&&mo(()=>{vt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=i||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}checkHasAudioInput(){var i=arguments,r=this;return M(function*(){let a=i.length>0&&void 0!==i[0]?i[0]:0;if(a>5)return r.isNoAudioInput=!0,r.onNoAudioInput&&r.onNoAudioInput(),!1;Li()||po()?"suspended"===r.context.state&&r.context.resume():"running"!==r.context.state&&r.context.resume();const l=r.volumeLevelAnalyser.getAnalyserNode();let d;l.getFloatTimeDomainData?(d=new Float32Array(l.fftSize),l.getFloatTimeDomainData(d)):(d=new Uint8Array(l.fftSize),l.getByteTimeDomainData(d));let h=!1;for(let p=0;p<d.length;p++)0!==d[p]&&(h=!0);return h?(r.isNoAudioInput=!1,!0):(yield _i(200),(yield r.checkHasAudioInput(a?a+1:1))&&h)})()}getAudioVolume(){return this.outputNode.gain.value}setVolume(i){this.outputNode.gain.setValueAtTime(i,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var i,r;null===(i=this.processedNode)||void 0===i||i.disconnect(),null===(r=this.sourceNode)||void 0===r||r.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var i;this.processedNode?null===(i=this.processedNode)||void 0===i||i.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class Bi extends La{get isFreeze(){return!1}constructor(i,r,a){var l,d;if(super(),l=this,C(this,"sourceNode",void 0),C(this,"track",void 0),C(this,"clonedTrack",void 0),C(this,"audioElement",void 0),C(this,"isCurrentTrackCloned",!1),C(this,"isRemoteTrack",!1),C(this,"originVolumeLevelAnalyser",void 0),C(this,"rebuildWebAudio",M(function*(){if(w.debug("ready to rebuild web audio, state:",l.context.state),l.isNoAudioInput&&(yield l.checkHasAudioInput()),!l.isNoAudioInput||l.isDestroyed)return document.body.removeEventListener("click",l.rebuildWebAudio,!0),void w.debug("rebuild web audio success, current volume status",l.getAccurateVolumeLevel());l.context.resume().then(()=>w.info("resume success")),w.debug("rebuild web audio because of ios 12 bugs"),l.disconnect();const m=l.track;l.track=l.track.clone(),l.isCurrentTrackCloned?m.stop():l.isCurrentTrackCloned=!0;const g=new MediaStream([l.track]);l.sourceNode=l.context.createMediaStreamSource(g),wd(l.sourceNode),l.volumeLevelAnalyser.rebuildAnalyser();const E=l.outputNode.gain.value;l.outputNode=l.context.createGain(),l.outputNode.gain.setValueAtTime(E,l.context.currentTime),wd(l.outputNode),l.emit(yr.UPDATE_SOURCE),l.connect(),l.audioElement.srcObject=g,l.isPlayed&&l.play(l.playNode),l.checkHasAudioInput()})),"audio"!==i.kind)throw new J(x.UNEXPECTED_ERROR);this.track=i;const h=new MediaStream([this.track]);if(this.isRemoteTrack=!!r,this.sourceNode=this.context.createMediaStreamSource(h),wd(this.sourceNode),a){const m=a.clone();m.enabled=!0,this.clonedTrack=m,w.debug("create an unmuted track ".concat(m.id," from the original track ").concat(a.id," to get the volume"));const g=this.context.createMediaStreamSource(new MediaStream([m]));wd(g),this.originVolumeLevelAnalyser=new Js,this.originVolumeLevelAnalyser.updateSource(g)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=h;const p=dt();r&&p.os===Fn.IOS&&Number(null===(d=p.osVersion)||void 0===d?void 0:d.split(".")[0])<15&&(vt.on($n.STATE_CHANGE,()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(i){this.sourceNode.disconnect(),this.track=i,this.isCurrentTrackCloned=!1;const r=new MediaStream([i]);this.sourceNode=this.context.createMediaStreamSource(r),wd(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(yr.UPDATE_SOURCE),this.audioElement.srcObject=r}destroy(){var i;this.audioElement.srcObject=null,this.audioElement.remove(),vt.off("state-change",this.rebuildWebAudio),null===(i=this.originVolumeLevelAnalyser)||void 0===i||i.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(i){return this.context.createMediaStreamSource(new MediaStream([i]))}updateOriginTrack(i){const r=i.clone();r.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=r),w.debug("create an unmuted track ".concat(r.id," from the original track ").concat(i.id," to get the volume"));const a=this.context.createMediaStreamSource(new MediaStream([r]));wd(a),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(a)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}function tO(s,i,r){return NE.apply(this,arguments)}function NE(){return NE=M(function*(s,i,r){const a=(d,h)=>d?"number"!=typeof d?d.max||d.exact||d.ideal||d.min||h:d:h,l={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxHeight:a(i.height,1080),maxWidth:a(i.width,1920)}}};return i.frameRate&&"number"!=typeof i.frameRate?(l.video.mandatory.maxFrameRate=i.frameRate.max,l.video.mandatory.minFrameRate=i.frameRate.min):"number"==typeof i.frameRate&&(l.video.mandatory.maxFrameRate=i.frameRate),yield navigator.mediaDevices.getUserMedia(l)}),NE.apply(this,arguments)}function bC(){return bC=M(function*(s,i){const r=yield SC(s.mediaSource),{sourceId:a,audio:l}=yield function(d){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new q((p,m)=>{const g=document.createElement("div");g.innerText="share screen",g.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const E=document.createElement("div");E.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const y=document.createElement("div");y.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",y.setAttribute("style","height: 12%;");const b=document.createElement("div");b.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const T=document.createElement("div");T.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const O=document.createElement("button");O.innerHTML="cancel",O.setAttribute("style","width: 85px;"),O.onclick=()=>{document.body.removeChild(L);const B=new Error("NotAllowedError");B.name="NotAllowedError",m(B)};let P=h;const D=document.createElement("div");if(h){const B=document.createElement("input");B.setAttribute("type","checkbox");const V=document.createElement("span");B.setAttribute("style","margin-right: 6px;"),V.innerText="Share audio",B.checked=P,B.onchange=()=>{P=B.checked},D.appendChild(B),D.appendChild(V)}T.appendChild(D),T.appendChild(O),E.appendChild(y),E.appendChild(b),E.appendChild(T);const L=document.createElement("div");L.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),L.appendChild(g),L.appendChild(E),document.body.appendChild(L),d.map(B=>{if(B.id){const V=document.createElement("div");V.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Q=B.thumbnail;try{const{width:se}=Q.getSize();se>1920&&(Q=Q.resize({width:1920}))}catch(se){throw se&&se.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),se}V.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Q.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+B.name.replace(/[\u00A0-\u9999<>\&]/g,function(se){return"&#"+se.charCodeAt(0)+";"})+"</span>",V.onclick=()=>{document.body.removeChild(L),p({sourceId:B.id,audio:P})},b.appendChild(V)}})})}(r,i);return yield tO(a,s,l)}),bC.apply(this,arguments)}function SC(s){return Bf.apply(this,arguments)}function Bf(){return Bf=M(function*(s){let i=["window","screen"];"application"!==s&&"window"!==s||(i=["window"]),"screen"===s&&(i=["screen"]);const r=Vk();if(!r)throw console.error("failed to fetch electron, please mount it to window"),new J(x.ELECTRON_IS_NULL);let a=null;try{var l;a=(null===(l=r.desktopCapturer)||void 0===l?void 0:l.getSources({types:i}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:i})}catch{a=null}a&&a.then||(a=new q((d,h)=>{r.desktopCapturer.getSources({types:i},(p,m)=>{p?h(p):d(m)})}));try{return yield a}catch(d){throw new J(x.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}),Bf.apply(this,arguments)}function xr(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}const bl=new Zn("safari");let iO=!1,rO=!1;function Qo(s,i){return oO.apply(this,arguments)}function oO(){return oO=M(function*(s,i){let r=0,a=null;for(;r<2;)try{a=yield sO(s,i,r>0);break}catch(l){if(l instanceof J)throw w.error("[".concat(i,"] ").concat(l.toString())),l;const d=CC(l.name||l.code||l,l.message);if(d.code===x.MEDIA_OPTION_INVALID){w.debug("[".concat(i,"] detect media option invalid, retry")),r+=1,yield _i(500);continue}throw w.error("[".concat(i,"] ").concat(d.toString())),d}if(!a)throw new J(x.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return a}),oO.apply(this,arguments)}function sO(s,i,r){return jf.apply(this,arguments)}function jf(){return jf=M(function*(s,i,r){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new J(x.NOT_SUPPORTED,"can not find getUserMedia");r&&(s.video&&(delete s.video.width,delete s.video.height),s.screen&&(delete s.screen.width,delete s.screen.height));const a=$e(),l=new MediaStream;if(s.audioSource&&l.addTrack(s.audioSource),s.videoSource&&l.addTrack(s.videoSource),!s.audio&&!s.video&&!s.screen)return w.debug("Using Video Source/ Audio Source"),l;if(s.screen)if(Vk())Hf(l,s.screen.sourceId?yield tO(s.screen.sourceId,s.screen,s.screenAudio):yield function nO(s,i){return bC.apply(this,arguments)}(s.screen,s.screenAudio));else if(qg()&&s.screen.extensionId&&s.screen.mandatory){if(!a.getStreamFromExtension)throw new J(x.NOT_SUPPORTED,"This browser does not support screen sharing");w.debug("[".concat(i,'] Screen access on chrome stable, looking for extension"'));const b=yield(h=s.screen.extensionId,p=i,new q((T,O)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},P=>{if(!P||!P.streamId)return w.error("[".concat(p,"] No response from Chrome Plugin. Plugin not installed properly"),P),void O(new J(x.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));T(P.streamId)})}catch(P){w.error("[".concat(p,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),P.toString()),O(new J(x.CHROME_PLUGIN_NOT_INSTALL))}}));s.screen.mandatory.chromeMediaSourceId=b,Hf(l,yield navigator.mediaDevices.getUserMedia({video:{mandatory:s.screen.mandatory}}))}else if(a.getDisplayMedia){var d;s.screen.mediaSource&&JD(s.screen.mediaSource);const b={width:s.screen.width,height:s.screen.height,frameRate:s.screen.frameRate,displaySurface:null!==(d=s.screen.displaySurface)&&void 0!==d?d:"screen"===s.screen.mediaSource?"monitor":s.screen.mediaSource},{selfBrowserSurface:T,surfaceSwitching:O,systemAudio:P}=s.screen,D={selfBrowserSurface:T,surfaceSwitching:O,systemAudio:P};!T&&delete D.selfBrowserSurface,!O&&delete D.surfaceSwitching,!P&&delete D.systemAudio,w.debug("[".concat(i,"] getDisplayMedia:"),JSON.stringify({video:b,audio:!!s.screenAudio,controls:D}));const L=yield navigator.mediaDevices.getDisplayMedia(function(B){for(var V=1;V<arguments.length;V++){var Q=null!=arguments[V]?arguments[V]:{};V%2?xr(Object(Q),!0).forEach(function(se){C(B,se,Q[se])}):Object.getOwnPropertyDescriptors?Object.defineProperties(B,Object.getOwnPropertyDescriptors(Q)):xr(Object(Q)).forEach(function(se){Object.defineProperty(B,se,Object.getOwnPropertyDescriptor(Q,se))})}return B}({video:b,audio:!!s.screenAudio},D));Hf(l,L)}else{if(!Wt())throw w.error("[".concat(i,"] This browser does not support screenSharing")),new J(x.NOT_SUPPORTED,"This browser does not support screen sharing");{s.screen.mediaSource&&JD(s.screen.mediaSource);const b={video:{mediaSource:s.screen.mediaSource,width:s.screen.width,height:s.screen.height,frameRate:s.screen.frameRate}};w.debug("[".concat(i,"] getUserMedia: ").concat(JSON.stringify(b))),Hf(l,yield navigator.mediaDevices.getUserMedia(b))}}var h,p;if(!s.video&&!s.audio)return l;let m={video:s.video,audio:s.audio},g=j("MEDIA_DEVICE_CONSTRAINTS");if(g)try{"string"==typeof g&&(g=JSON.parse(g)),m=pd(m,g)}catch{}w.debug("[".concat(i,"] GetUserMedia"),JSON.stringify(m)),dt();let E,y=null;(Ki()||Li()||zg())&&(y=yield bl.lock());try{E=yield navigator.mediaDevices.getUserMedia(m)}catch(b){throw y&&y(),b}return m.audio&&(iO=!0),m.video&&(rO=!0),Hf(l,E),y&&y(),l}),jf.apply(this,arguments)}function CC(s,i){switch(s){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new J(x.MEDIA_OPTION_INVALID,"".concat(s,": ").concat(i));case"NotFoundError":case"DevicesNotFoundError":return new J(x.DEVICE_NOT_FOUND,"".concat(s,": ").concat(i));case"NotSupportedError":return new J(x.NOT_SUPPORTED,"".concat(s,": ").concat(i));case"NotReadableError":return new J(x.NOT_READABLE,"".concat(s,": ").concat(i));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new J(x.PERMISSION_DENIED,"".concat(s,": ").concat(i));case"ConstraintNotSatisfiedError":return new J(x.CONSTRAINT_NOT_SATISFIED,"".concat(s,": ").concat(i));default:return w.error("getUserMedia unexpected error",s),new J(x.UNEXPECTED_ERROR,"".concat(s,": ").concat(i))}}function Hf(s,i){const r=s.getVideoTracks()[0],a=s.getAudioTracks()[0],l=i.getVideoTracks()[0],d=i.getAudioTracks()[0];d&&(a&&s.removeTrack(a),s.addTrack(d)),l&&(r&&s.removeTrack(r),s.addTrack(l))}const Zo=new class extends zt{get state(){return this._state}set state(s){s!==this._state&&(this.emit(ka.STATE_CHANGE,s),this._state=s)}constructor(){super(),C(this,"_state",gc.IDLE),C(this,"isAccessMicrophonePermission",!1),C(this,"isAccessCameraPermission",!1),C(this,"lastAccessMicrophonePermission",!1),C(this,"lastAccessCameraPermission",!1),C(this,"checkdeviceMatched",!1),C(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(j("ENUMERATE_DEVICES_INTERVAL")||(qr()||Wg()===Fn.HARMONY_OS)&&zs())&&this.updateDevicesInfo()},j("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(s=>w.error(s.toString()))}enumerateDevices(s,i){var r=arguments,a=this;return M(function*(){let l=r.length>2&&void 0!==r[2]&&r[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new J(x.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const d=yield navigator.mediaDevices.enumerateDevices(),h=a.checkMediaDeviceInfoIsOk(d);let p=!a.isAccessMicrophonePermission&&s,m=!a.isAccessCameraPermission&&i;h.audio&&(p=!1),h.video&&(m=!1);let g=null,E=null,y=null;if(!l&&(p||m)){if(bl.isLocked&&(w.debug("[device manager] wait GUM lock"),(yield bl.lock())(),w.debug("[device manager] GUM unlock")),iO&&(p=!1,a.isAccessMicrophonePermission=!0),rO&&(m=!1,a.isAccessCameraPermission=!0),w.debug("[device manager] check media device permissions",s,i,p,m),p&&m){try{y=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(b){const T=CC(b.name||b.code||b,b.message);if(T.code===x.PERMISSION_DENIED)throw T;w.warning("getUserMedia failed in getDevices",T)}a.isAccessCameraPermission=!0,a.isAccessMicrophonePermission=!0}else if(p){try{g=yield navigator.mediaDevices.getUserMedia({audio:s})}catch(b){const T=CC(b.name||b.code||b,b.message);if(T.code===x.PERMISSION_DENIED)throw T;w.warning("getUserMedia failed in getDevices",T)}a.isAccessMicrophonePermission=!0}else if(m){try{E=yield navigator.mediaDevices.getUserMedia({video:i})}catch(b){const T=CC(b.name||b.code||b,b.message);if(T.code===x.PERMISSION_DENIED)throw T;w.warning("getUserMedia failed in getDevices",T)}a.isAccessCameraPermission=!0}w.debug("[device manager] mic permission",s,"cam permission",i)}try{const b=yield navigator.mediaDevices.enumerateDevices();return g&&g.getTracks().forEach(T=>T.stop()),E&&E.getTracks().forEach(T=>T.stop()),y&&y.getTracks().forEach(T=>T.stop()),g=null,E=null,y=null,b}catch(b){return g&&g.getTracks().forEach(T=>T.stop()),E&&E.getTracks().forEach(T=>T.stop()),y&&y.getTracks().forEach(T=>T.stop()),g=null,E=null,y=null,new J(x.ENUMERATE_DEVICES_FAILED,b.toString()).throw()}})()}getRecordingDevices(){var s=arguments,i=this;return M(function*(){let r=s.length>0&&void 0!==s[0]&&s[0];return(yield i.enumerateDevices(!0,!1,r)).filter(a=>"audioinput"===a.kind)})()}getCamerasDevices(){var s=arguments,i=this;return M(function*(){let r=s.length>0&&void 0!==s[0]&&s[0];return(yield i.enumerateDevices(!1,!0,r)).filter(a=>"videoinput"===a.kind)})()}getSpeakers(){var s=arguments,i=this;return M(function*(){let r=s.length>0&&void 0!==s[0]&&s[0];return(yield i.enumerateDevices(!0,!1,r)).filter(a=>"audiooutput"===a.kind)})()}searchDeviceIdByName(s){let i=null;return this.deviceInfoMap.forEach(r=>{r.device.label===s&&(i=r.device.deviceId)}),i}getDeviceById(s){var i=this;return M(function*(){const r=(yield i.enumerateDevices(!0,!0,!0)).find(a=>a.deviceId===s);if(!r)throw new J(x.DEVICE_NOT_FOUND,"deviceId: ".concat(s));return r})()}init(){var s=this;return M(function*(){s.state=gc.INITING;try{yield s.updateDevicesInfo(),s.state=gc.INITEND}catch(i){throw w.warning("Device Detection functionality cannot start properly.",i.toString()),s.state=gc.IDLE,!("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)&&new J(x.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),i}})()}updateDevicesInfo(){var s=this;return M(function*(){const i=yield s.enumerateDevices(!0,!0,!0),r=Date.now(),a=[];if(i[0]&&i[0].label&&!1===s.checkdeviceMatched){s.checkdeviceMatched=!0;const d=i.find(p=>"audioinput"===p.kind&&"default"===p.deviceId),h=i.find(p=>"audiooutput"===p.kind&&"default"===p.deviceId);d&&h?h.groupId===d.groupId?w.debug("[device-check] default input ".concat(d.label," and output ").concat(h.label," is the same group")):w.warning("[device-check] default input ".concat(d.label," and output ").concat(h.label," is not the same group")):w.debug("[device-check] default input or output not found")}const l=s.checkMediaDeviceInfoIsOk(i);if(i.forEach(d=>{if(!d.deviceId)return;const h=s.deviceInfoMap.get("".concat(d.kind,"_").concat(d.deviceId));if("ACTIVE"!==(h?h.state:"INACTIVE")){const p={initAt:r,updateAt:r,device:d,state:"ACTIVE"};s.deviceInfoMap.set("".concat(d.kind,"_").concat(d.deviceId),p),a.push(p)}h&&(h.updateAt=r)}),s.deviceInfoMap.forEach((d,h)=>{"ACTIVE"===d.state&&d.updateAt!==r&&(d.state="INACTIVE",a.push(d))}),s.state!==gc.INITEND)return l.audio&&(s.lastAccessMicrophonePermission=!0,s.isAccessMicrophonePermission=!0),void(l.video&&(s.lastAccessCameraPermission=!0,s.isAccessCameraPermission=!0));a.forEach(d=>{switch(d.device.kind){case"audioinput":s.lastAccessMicrophonePermission&&s.isAccessMicrophonePermission&&s.emit(ka.RECORDING_DEVICE_CHANGED,d);break;case"videoinput":s.lastAccessCameraPermission&&s.isAccessCameraPermission&&s.emit(ka.CAMERA_DEVICE_CHANGED,d);break;case"audiooutput":s.lastAccessMicrophonePermission&&s.isAccessMicrophonePermission&&s.emit(ka.PLAYOUT_DEVICE_CHANGED,d)}}),l.audio&&(s.lastAccessMicrophonePermission=!0,s.isAccessMicrophonePermission=!0),l.video&&(s.lastAccessCameraPermission=!0,s.isAccessCameraPermission=!0)})()}checkMediaDeviceInfoIsOk(s){const i=s.filter(l=>"audioinput"===l.kind),r=s.filter(l=>"videoinput"===l.kind),a={audio:!1,video:!1};for(const l of i)if(l.label&&l.deviceId){a.audio=!0;break}for(const l of r)if(l.label&&l.deviceId){a.video=!0;break}return a}};let Id=!1;const So=new class extends zt{constructor(){super(...arguments),C(this,"onAutoplayFailed",void 0),C(this,"onAudioAutoplayFailed",void 0)}};function PE(){if(dt(),!Id){const s=i=>{i.preventDefault(),Id=!1,ii()?document.body.removeEventListener("click",s,!0):(document.body.removeEventListener("touchstart",s,!0),document.body.removeEventListener("mousedown",s,!0))};Id=!0,ii()?document.body.addEventListener("click",s,!0):(document.body.addEventListener("touchstart",s,!0),document.body.addEventListener("mousedown",s,!0)),w.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),So.onAutoplayFailed?So.onAutoplayFailed():w.warning(So.onAudioAutoplayFailed?"AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .":"We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),So.emit("autoplay-failed")}}function aO(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function TC(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?aO(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):aO(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function cO(s,i,r,a){if(!s)return;const l=Se.getBaseInfoBySessionId(s);if(!l)return;const d=l.info,h=Date.now(),p=TC(TC({},d),{},{vid:void 0===d.vid?0:Number(d.vid),lts:h,elapse:h-l.startTime,cbRegistered:So.onAutoplayFailed||So.onAudioAutoplayFailed?1:-1,errorMsg:r,mediaType:i,trackId:a,extend:void 0});Se.send({type:qt.AUTOPLAY_FAILED,data:p},!0)}const RL=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Xr=new class{constructor(){C(this,"onAutoplayFailed",void 0),C(this,"elementMap",new Map),C(this,"elementStateMap",new Map),C(this,"elementsNeedToResume",[]),C(this,"sinkIdMap",new Map),C(this,"autoResumeAfterInterruption",()=>{Array.from(this.elementMap.entries()).forEach(s=>{let[i,r]=s;const a=this.elementStateMap.get(i),l=r.srcObject.getAudioTracks()[0];sl()?l&&"live"===l.readyState&&"running"===vt.curState&&(w.debug("auto resume after interruption for iOS 15"),r.pause(),r.play()):a&&"paused"===a&&l&&"live"===l.readyState&&"running"===vt.curState&&(w.debug("auto resume after interruption for iOS"),r.play())})}),C(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(s=>{let[i,r]=s;const a=r.srcObject.getAudioTracks()[0];a&&"live"===a.readyState&&(w.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r.pause(),r.play())})}),this.autoResumeAudioElement(),vt.on($n.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),vt.on($n.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),vt.on($n.STATE_CHANGE,()=>{Li()&&"suspended"===vt.prevState&&"running"===vt.curState&&this.autoResumeAfterInterruption()})}setSinkID(s,i){var r=this;return M(function*(){const a=r.elementMap.get(s);if(r.sinkIdMap.set(s,i),a)try{yield a.setSinkId(i)}catch(l){throw new J(x.PERMISSION_DENIED,"can not set sink id: "+l.toString())}})()}play(s,i,r,a){if(this.elementMap.has(i))return;const l=document.createElement("audio");l.autoplay=!0,l.srcObject=new MediaStream([s]),this.bindAudioElementEvents(i,l),this.elementMap.set(i,l),this.elementStateMap.set(i,Vi.INIT),this.setVolume(i,r);const d=this.sinkIdMap.get(i);if(d)try{l.setSinkId(d).catch(p=>{w.warning("[".concat(i,"] set sink id failed"),p.toString())})}catch(p){w.warning("[".concat(i,"] set sink id failed"),p.toString())}const h=l.play();h&&h.then&&h.catch(p=>{a&&cO(a,"audio",p.message,i),w.warning("audio element play warning",p.toString()),this.elementMap.has(i)&&"NotAllowedError"===p.name&&(w.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(l),mo(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),PE()}))})}updateTrack(s,i){const r=this.elementMap.get(s);r&&(r.srcObject=new MediaStream([i]))}isPlaying(s){return this.elementMap.has(s)&&"playing"===this.elementStateMap.get(s)}setVolume(s,i){const r=this.elementMap.get(s);r&&(i=Math.max(0,Math.min(100,i)),r.volume=i/100)}stop(s){const i=this.elementMap.get(s);if(this.sinkIdMap.delete(s),!i)return;const r=this.elementsNeedToResume.indexOf(i);this.elementsNeedToResume.splice(r,1),i.srcObject=null,i.remove(),this.elementMap.delete(s),this.elementStateMap.delete(s)}bindAudioElementEvents(s,i){RL.forEach(r=>{i.addEventListener(r,a=>{const l=this.elementStateMap.get(s),d="pause"===a.type?"paused":a.type;if(w.debug("[".concat(s,"] audio-element-status change ").concat(l," => ").concat(d)),"error"===a.type){const h=i?.error;h&&w.error("[".concat(s,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(s,d)})})}getPlayerState(s){return this.elementStateMap.get(s)||"uninit"}autoResumeAudioElement(){const s=()=>{this.elementsNeedToResume.forEach(i=>{i.play().then(r=>{w.debug("Auto resume audio element success")}).catch(r=>{w.warning("Auto resume audio element failed!",r)})}),this.elementsNeedToResume=[]};new q(i=>{document.body?i():window.addEventListener("load",()=>i())}).then(()=>{ii()?document.body.addEventListener("click",s,!0):(document.body.addEventListener("touchstart",s,!0),document.body.addEventListener("mousedown",s,!0))})}};function an(){return function(s,i,r){const a=r.value;return"function"==typeof a&&(r.value=function(){this._isClosed&&new J(x.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",w);for(var l=arguments.length,d=new Array(l),h=0;h<l;h++)d[h]=arguments[h];const p=a.apply(this,d);return p instanceof q?new q((m,g)=>{p.then(m).catch(g)}):p}),r}}function wC(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function xE(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?wC(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):wC(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class Gf extends zt{constructor(i){super(),C(this,"name","VideoProcessorDestination"),C(this,"ID","0"),C(this,"_source",void 0),C(this,"videoContext",void 0),C(this,"inputTrack",void 0),this.videoContext=i}get kind(){return"video"}get enabled(){return!0}pipe(){throw new J(x.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new J(x.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(i){if(i.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");i.track&&i.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=i.track,this.emit(Ii.ON_TRACK,i.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Ii.ON_TRACK,void 0)}}class ME extends zt{set chained(i){this._chained=i}get chained(){return this._chained}constructor(i,r){super(),C(this,"constraintsMap",new Map),C(this,"statsRegistry",[]),C(this,"usageRegistry",[]),C(this,"trackId",void 0),C(this,"direction",void 0),C(this,"_chained",!1),this.trackId=i,this.direction=r}getConstraints(){var i=this;return M(function*(){return yield Jt(i,br.REQUEST_CONSTRAINTS)})()}requestApplyConstraints(i,r){var a=this;return M(function*(){var l;return w.info("processor ".concat(r.name," requestApplyConstraints for ").concat(a.trackId)),i&&a.constraintsMap.set(r,i),Et(a,br.REQUEST_UPDATE_CONSTRAINTS,Array.from(yo(l=a.constraintsMap).call(l)))})()}requestRevertConstraints(i){var r=this;return M(function*(){var a;if(r.constraintsMap.has(i))return w.info("processor ".concat(i.name," requestRevertConstraints for ").concat(r.trackId)),r.constraintsMap.delete(i),Et(r,br.REQUEST_UPDATE_CONSTRAINTS,Array.from(yo(a=r.constraintsMap).call(a)))})()}registerStats(i,r,a){this.statsRegistry.find(l=>l.processorID===i.ID&&l.processorName===i.name&&l.type===r)||this.statsRegistry.push({processorName:i.name,processorID:i.ID,type:r,cb:a})}unregisterStats(i,r){const a=this.statsRegistry.findIndex(l=>l.processorID===i.ID&&l.processorName===i.name&&l.type===r);-1!==a&&this.statsRegistry.splice(a,1)}gatherStats(){const i=[];for(const{processorID:r,processorName:a,type:l,cb:d}of this.statsRegistry)try{const h=d();i.push({processorID:r,processorName:a,type:l,stats:h})}catch(h){w.error(new J(x.UNEXPECTED_ERROR,h.message))}return i}registerUsage(i,r){this.usageRegistry.find(a=>a.processorID===i.ID&&a.processorName===i.name)||this.usageRegistry.push({processorID:i.ID,processorName:i.name,cb:r})}unregisterUsage(i){const r=this.usageRegistry.findIndex(a=>a.processorID===i.ID&&a.processorName===i.name);-1!==r&&this.usageRegistry.splice(r,1)}gatherUsage(){var i=this;return M(function*(){const r=[];if(!i.chained)return[];for(const{cb:a}of i.usageRegistry)try{let l=a();l instanceof q&&(l=yield l),r.push(xE(xE({},l),{},{direction:i.direction}))}catch(l){w.error("gather extension usage error",l)}return r})()}getDirection(){return this.direction}}class IC extends zt{constructor(i){super(),C(this,"name","AudioProcessorDestination"),C(this,"ID","0"),C(this,"inputTrack",void 0),C(this,"inputNode",void 0),C(this,"audioProcessorContext",void 0),C(this,"_source",void 0),this.audioProcessorContext=i}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new J(x.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new J(x.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Ii.ON_TRACK,void 0),this.emit(Ii.ON_NODE,void 0)}updateInput(i){if(i.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");i.track&&this.inputTrack!==i.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=i.track,this.emit(Ii.ON_TRACK,this.inputTrack)),i.node&&this.inputNode!==i.node&&(this.audioProcessorContext.chained=!0,this.inputNode=i.node,this.emit(Ii.ON_NODE,this.inputNode))}}class Wf extends zt{set chained(i){this._chained=i}get chained(){return this._chained}constructor(i,r,a){super(),C(this,"constraintsMap",new Map),C(this,"statsRegistry",[]),C(this,"audioContext",void 0),C(this,"trackId",void 0),C(this,"direction",void 0),C(this,"usageRegistry",[]),C(this,"_chained",!1),this.audioContext=i,this.trackId=r,this.direction=a}getConstraints(){var i=this;return M(function*(){return Jt(i,br.REQUEST_CONSTRAINTS)})()}getAudioContext(){return this.audioContext}requestApplyConstraints(i,r){var a=this;return M(function*(){var l;return w.info("processor ".concat(r.name," requestApplyConstraints for ").concat(a.trackId)),i&&a.constraintsMap.set(r,i),Et(a,br.REQUEST_UPDATE_CONSTRAINTS,Array.from(yo(l=a.constraintsMap).call(l)))})()}requestRevertConstraints(i){var r=this;return M(function*(){var a;if(r.constraintsMap.has(i))return r.constraintsMap.delete(i),Et(r,br.REQUEST_UPDATE_CONSTRAINTS,Array.from(yo(a=r.constraintsMap).call(a)))})()}registerStats(i,r,a){this.statsRegistry.find(l=>l.processorID===i.ID&&l.processorName===i.name&&l.type===r)||this.statsRegistry.push({processorName:i.name,processorID:i.ID,type:r,cb:a})}unregisterStats(i,r){const a=this.statsRegistry.findIndex(l=>l.processorID===i.ID&&l.processorName===i.name&&l.type===r);-1!==a&&this.statsRegistry.splice(a,1)}gatherStats(){const i=[];for(const{processorID:r,processorName:a,type:l,cb:d}of this.statsRegistry)try{const h=d();i.push({processorID:r,processorName:a,type:l,stats:h})}catch(h){w.error(new J(x.UNEXPECTED_ERROR,h.message))}return i}registerUsage(i,r){this.usageRegistry.find(a=>a.processorID===i.ID&&a.processorName===i.name)||this.usageRegistry.push({processorID:i.ID,processorName:i.name,cb:r})}unregisterUsage(i){const r=this.usageRegistry.findIndex(a=>a.processorID===i.ID&&a.processorName===i.name);-1!==r&&this.usageRegistry.splice(r,1)}gatherUsage(){var i=this;return M(function*(){const r=[];if(!i.chained)return[];for(const{cb:a}of i.usageRegistry)try{let l=a();l instanceof q&&(l=yield l),r.push(xE(xE({},l),{},{direction:i.direction}))}catch(l){w.error("gather extension usage error",l)}return r})()}getDirection(){return this.direction}}class RC extends zt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),C(this,"context",void 0),C(this,"processSourceNode",void 0),C(this,"outputTrack",void 0),C(this,"processedNode",void 0),C(this,"clonedTrack",void 0),C(this,"outputNode",void 0),this.outputNode=new lO}setVolume(){}createOutputTrack(){throw new J(x.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class lO{disconnect(){}connect(){}}let Qs=null;class AL{constructor(){C(this,"state","open"),C(this,"trigger",void 0),C(this,"tasks",[]),w.debug("[macro-task-queue] is created."),this.trigger=window.setTimeout(()=>{this.state="closed",w.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map(i=>i.key),"]")),this.trigger=void 0,this.tasks.forEach(i=>{let{func:r}=i;return r()}),this.tasks.length=0,w.debug("[macro-task-queue] is closed.")})}enqueue(i,r){"closed"!==this.state&&(this.tasks.push({key:i,func:r}),w.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof i?i:"")))}runTask(i){if("closed"===this.state)return;const r=this.tasks.findIndex(a=>a.key===i);if(-1!==r){const a=this.tasks.splice(r,1);w.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof i?i:"")),a[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,w.debug("[macro-task-queue] is closed."))}}function kE(s){return function(i,r,a){var l;const d=null!==(l=a.value)&&void 0!==l?l:a.get,h=function(){Qs&&"open"===Qs.state&&Qs.runTask(s);for(var p=arguments.length,m=new Array(p),g=0;g<p;g++)m[g]=arguments[g];return d?.apply(this,...m)};return a.value?a.value=h:a.get=h,a}}function LE(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function dO(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?LE(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):LE(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class mt extends Ri{get _source(){return this._trackSource}set _source(i){this._trackSource=i}get processorContext(){return this._processorContext}set processorContext(i){this._processorContext=i}get processorDestination(){return this._processorDestination}set processorDestination(i){this._processorDestination=i}get isPlaying(){return this._useAudioElement?Xr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(i,r,a,l,d){super(i,a),C(this,"trackMediaType","audio"),C(this,"_encoderConfig",void 0),C(this,"_trackSource",void 0),C(this,"_enabled",!0),C(this,"_volume",100),C(this,"_useAudioElement",!1),C(this,"_bypassWebAudio",!1),C(this,"processor",void 0),C(this,"_processorContext",void 0),C(this,"_processorDestination",void 0),C(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!l;const h=()=>{this.processorContext=new Wf(this._source.context,this.getTrackId(),"local"),this.processorDestination=new IC(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(yr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})},p=d&&Ki()&&!eO();j("DISABLE_WEBAUDIO")?(this._source=new RC,this._useAudioElement=!0,this._bypassWebAudio=!0):p?this._source=new RC:(this._source=new Bi(i,!1,this._getOriginVolumeLevel?i:void 0),j("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),h(),!j("DISABLE_WEBAUDIO")&&p&&(Qs||(Qs=new AL),Qs).enqueue("INIT_WEBAUDIO",()=>{this._source=new Bi(i,!1,this._getOriginVolumeLevel?i:void 0),j("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),h(),this.emit(wE.UPDATE_TRACK_SOURCE)})}setVolume(i){ft(i,"volume",0,1e3),this._volume=i,this._source.setVolume(i/100),this._useAudioElement&&Xr.setVolume(this.getTrackId(),i);try{if(this._bypassWebAudio)return void w.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,Et(this,me.NEED_REPLACE_TRACK,this).then(()=>{w.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(a=>{w.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),a)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}setPlaybackDevice(i){var r=this;return M(function*(){if(!r._useAudioElement)throw new J(x.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield Xr.setSinkID(r.getTrackId(),i)})()}setEnabled(i,r,a){var l=this;return M(function*(){return l._setEnabled(i,r,a)})()}_setEnabled(i,r,a){var l=this;return M(function*(){if(!a){if(i===l._enabled)return;l.stateCheck("enabled",i)}if(w.info("[".concat(l.getTrackId(),"] start setEnabled"),i),i){l._originMediaStreamTrack.enabled=!0;try{a||(l._enabled=!0),yield Et(l,me.NEED_ENABLE_TRACK,l),w.info("[".concat(l.getTrackId(),"] setEnabled to ").concat(i," success"))}catch(d){throw a||(l._enabled=!1),w.error("[".concat(l.getTrackId(),"] setEnabled to true error"),d.toString()),d}}else{l._originMediaStreamTrack.enabled=!1,a||(l._enabled=!1);try{yield Et(l,me.NEED_DISABLE_TRACK,l)}catch(d){throw a||(l._enabled=!0),w.error("[".concat(l.getTrackId(),"] setEnabled to false error"),d.toString()),d}}})()}setMuted(i){var r=this;return M(function*(){i!==r._muted&&(r.stateCheck("muted",i),r._muted=i,r._originMediaStreamTrack.enabled=!i,w.debug("[".concat(r.getTrackId(),"] start set muted: ").concat(i)),i?yield Et(r,me.NEED_MUTE_TRACK,r):yield Et(r,me.NEED_UNMUTE_TRACK,r))})()}getStats(){return vf(()=>{w.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),gr(this,me.GET_STATS)||dO({},EC)}setAudioFrameCallback(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!i)return this._source.removeAllListeners(yr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(yr.ON_AUDIO_BUFFER),this._source.on(yr.ON_AUDIO_BUFFER,a=>i(a))}play(){w.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(w.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Xr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){w.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Xr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];w.debug("[".concat(this.getTrackId(),"] update player source track")),i&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Xr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}_updateOriginMediaStreamTrack(i,r){var a=this;return M(function*(){a._originMediaStreamTrack!==i&&(a._originMediaStreamTrack&&(a._originMediaStreamTrack.removeEventListener("ended",a._handleTrackEnded),r&&a._originMediaStreamTrack.stop()),i.addEventListener("ended",a._handleTrackEnded),a._originMediaStreamTrack=i,a._muted&&(a._originMediaStreamTrack.enabled=!1),a.processor&&a.processor.updateInput({track:i,context:a.processorContext}),a._mediaStreamTrack!==a._source.outputTrack?(a._mediaStreamTrack=a._originMediaStreamTrack,a._updatePlayerSource(),yield Et(a,me.NEED_REPLACE_TRACK,a)):a._source.updateTrack(a._originMediaStreamTrack),a._getOriginVolumeLevel&&a._source.updateOriginTrack(i))})()}renewMediaStreamTrack(i){return q.resolve(void 0)}pipe(i){if(this._bypassWebAudio)throw new J(x.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===i)return i;if(i._source)throw new J(x.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),i}unpipe(){var i;if(!this.processor)return;const r=this.processor;null===(i=this._source.processSourceNode)||void 0===i||i.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){var i=this;this.processorDestination.on(Ii.ON_TRACK,function(){var r=M(function*(a){a?a!==i._mediaStreamTrack&&(i._mediaStreamTrack=a,i._updatePlayerSource(!1),i._source.processedNode=i._source.createMediaStreamSourceNode(a),yield Et(i,me.NEED_REPLACE_TRACK,i)):i._mediaStreamTrack!==i._originMediaStreamTrack&&(i._mediaStreamTrack=i._originMediaStreamTrack,i._updatePlayerSource(),yield Et(i,me.NEED_REPLACE_TRACK,i))});return function(a){return r.apply(this,arguments)}}()),this.processorDestination.on(Ii.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ii.ON_TRACK),this.processorDestination.removeAllListeners(Ii.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(br.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(br.REQUEST_CONSTRAINTS)}}te([kE("INIT_WEBAUDIO"),N("design:type",Object),N("design:paramtypes",[Object])],mt.prototype,"_source",null),te([kE("INIT_WEBAUDIO"),N("design:type",Wf),N("design:paramtypes",[Wf])],mt.prototype,"processorContext",null),te([kE("INIT_WEBAUDIO"),N("design:type",IC),N("design:paramtypes",[IC])],mt.prototype,"processorDestination",null),te([Ae({argsMap:(s,i)=>[s.getTrackId(),i],throttleTime:300}),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],mt.prototype,"setVolume",null),te([Ae({argsMap:(s,i)=>[s.getTrackId(),i]}),an(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],mt.prototype,"setPlaybackDevice",null),te([Pe("LocalAudioTrack","_enabledMutex"),Ae({argsMap:(s,i)=>[s.getTrackId(),i]}),an(),N("design:type",Function),N("design:paramtypes",[Boolean,Object,Boolean]),N("design:returntype",q)],mt.prototype,"setEnabled",null),te([Pe("LocalAudioTrack","_enabledMutex"),Ae({argsMap:(s,i)=>[s.getTrackId(),i]}),an(),N("design:type",Function),N("design:paramtypes",[Boolean]),N("design:returntype",q)],mt.prototype,"setMuted",null),te([an(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",Object)],mt.prototype,"getStats",null),te([an(),N("design:type",Function),N("design:paramtypes",[Object,Number]),N("design:returntype",void 0)],mt.prototype,"setAudioFrameCallback",null),te([Ae({argsMap:s=>[s.getTrackId()]}),an(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],mt.prototype,"play",null),te([Ae({argsMap:s=>[s.getTrackId()]}),an(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],mt.prototype,"stop",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],mt.prototype,"close",null),te([Ae({argsMap:(s,i)=>[s.getTrackId(),i.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],mt.prototype,"pipe",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],mt.prototype,"unpipe",null);class Rd extends mt{get __className__(){return"MicrophoneAudioTrack"}constructor(i,r,a,l){super(i,r.encoderConfig?Ss(r.encoderConfig):{},l,j("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),C(this,"_config",void 0),C(this,"_deviceName","default"),C(this,"_constraints",void 0),C(this,"_originalConstraints",void 0),C(this,"_enabled",!0),this._config=r,this._constraints=a,this._originalConstraints=a,this._deviceName=i.label,"boolean"==typeof r.bypassWebAudio&&(this._bypassWebAudio=r.bypassWebAudio),(sl()||yS())&&vt.bindInterruptDetectorTrack(this),this.on(wE.UPDATE_TRACK_SOURCE,()=>{this.bindProcessorContextEvents()}),eO()&&this.bindProcessorContextEvents()}setDevice(i){var r=this;return M(function*(){if(w.info("[".concat(r.getTrackId(),"] start set device to ").concat(i)),r._enabled)try{const a=yield Zo.getDeviceById(i),l={};l.audio=dO({},r._constraints),l.audio.deviceId={exact:i},r._originMediaStreamTrack.stop();let d=null;try{d=yield Qo(l,r.getTrackId())}catch(h){throw w.error("[".concat(r.getTrackId(),"] setDevice failed"),h.toString()),d=yield Qo({audio:r._constraints},r.getTrackId()),yield r._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),h}yield r._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),r._deviceName=a.label,r._config.microphoneId=i,r._constraints.deviceId={exact:i}}catch(a){throw w.error("[".concat(r.getTrackId(),"] setDevice error"),a.toString()),a}else try{const a=yield Zo.getDeviceById(i);r._deviceName=a.label,r._config.microphoneId=i,r._constraints.deviceId={exact:i}}catch(a){throw w.error("[".concat(r.getTrackId(),"] setDevice error"),a.toString()),a}w.info("[".concat(r.getTrackId(),"] set device to ").concat(i," success"))})()}setEnabled(i,r,a){var l=()=>super._setEnabled,d=this;return M(function*(){if(r)return w.debug("[".concat(d.getTrackId(),"] setEnabled false (do not close microphone)")),yield l().call(d,i);if(!a){if(i===d._enabled)return;d.stateCheck("enabled",i)}if(w.info("[".concat(d.getTrackId(),"] start setEnabled"),i),!i){var h;d._originMediaStreamTrack.onended=null,d._originMediaStreamTrack.stop(),null===(h=d._source.clonedTrack)||void 0===h||h.stop(),a||(d._enabled=!1);try{yield Et(d,me.NEED_DISABLE_TRACK,d)}catch(g){throw w.error("[".concat(d.getTrackId(),"] setEnabled false failed"),g.toString()),g}return}const p=dO({},d._constraints),m=Zo.searchDeviceIdByName(d._deviceName);m&&!p.deviceId&&(p.deviceId=m);try{a||(d._enabled=!0);const g=yield Qo({audio:d._constraints},d.getTrackId());yield d._updateOriginMediaStreamTrack(g.getAudioTracks()[0],!1),yield Et(d,me.NEED_ENABLE_TRACK,d)}catch(g){throw a||(d._enabled=!1),w.error("[".concat(d.getTrackId(),"] setEnabled true failed"),g.toString()),g}w.info("[".concat(d.getTrackId(),"] setEnabled success"))})()}close(){super.close(),(sl()||yS())&&vt.unbindInterruptDetectorTrack(this)}onTrackEnded(){var i=this;if((Li()||po())&&this._enabled&&!this._isClosed&&vt.duringInterruption){const r=function(){var a=M(function*(){vt.off($n.IOS_INTERRUPTION_END,r),i._enabled&&!i._isClosed&&(w.debug("[".concat(i.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),yield i.setEnabled(!1),yield i.setEnabled(!0))});return function(){return a.apply(this,arguments)}}();vt.on($n.IOS_INTERRUPTION_END,r)}else w.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(yl.TRACK_ENDED)}renewMediaStreamTrack(i){var r=this;return M(function*(){const a=i||r._constraints,l=Zo.searchDeviceIdByName(r._deviceName);if(l&&!a.deviceId&&(a.deviceId=l),r._constraints=a,r._enabled){r._originMediaStreamTrack.stop();const d=yield Qo({audio:r._constraints},r.getTrackId());yield r._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!0)}})()}bindProcessorContextEvents(){var i=this;this.processorContext.on(br.REQUEST_UPDATE_CONSTRAINTS,function(){var r=M(function*(a,l,d){try{const h=Object.assign({},i._originalConstraints,...a);yield i.renewMediaStreamTrack(h),l()}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this.processorContext.on(br.REQUEST_CONSTRAINTS,function(){var r=M(function*(a){a(i._originMediaStreamTrack.getSettings())});return function(a){return r.apply(this,arguments)}}())}}te([Ae({argsMap:(s,i)=>[s.getTrackId(),i]}),an(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Rd.prototype,"setDevice",null),te([Pe("MicrophoneAudioTrack","_enabledMutex"),Ae({argsMap:(s,i,r)=>[s.getTrackId(),i,r]}),an(),N("design:type",Function),N("design:paramtypes",[Boolean,Boolean,Boolean]),N("design:returntype",q)],Rd.prototype,"setEnabled",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Rd.prototype,"close",null);class Sl extends mt{get __className__(){return"BufferSourceAudioTrack"}constructor(i,r,a,l){super(r.createOutputTrack(),a,l),C(this,"source",void 0),C(this,"_bufferSource",void 0),this.source=i,this._bufferSource=r,this._bufferSource.on(yr.AUDIO_SOURCE_STATE_CHANGE,d=>{this.safeEmit(yl.SOURCE_STATE_CHANGE,d)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(i){i&&this._bufferSource.updateOptions(i),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(i){this._bufferSource.seekAudioBuffer(i)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(i){ft(i,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(i)}}te([Ae({argsMap:(s,i)=>[s.getTrackId(),i,s.duration]}),an(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],Sl.prototype,"startProcessAudioBuffer",null),te([Ae({argsMap:s=>[s.getTrackId()]}),an(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Sl.prototype,"pauseProcessAudioBuffer",null),te([Ae({argsMap:s=>[s.getTrackId()]}),an(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],Sl.prototype,"seekAudioBuffer",null),te([Ae({argsMap:s=>[s.getTrackId()]}),an(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Sl.prototype,"resumeProcessAudioBuffer",null),te([Ae({argsMap:s=>[s.getTrackId()]}),an(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Sl.prototype,"stopProcessAudioBuffer",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Sl.prototype,"close",null),te([Ae({argsMap:s=>[s.getTrackId()]}),an(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],Sl.prototype,"setAudioBufferPlaybackSpeed",null);class wn extends mt{get __className__(){return"MixingAudioTrack"}get isActive(){for(const i of this.trackList)if(i._enabled&&!i._isClosed&&!i.muted)return!0;return!1}constructor(){const i=Ch().createMediaStreamDestination();super(i.stream.getAudioTracks()[0],void 0,Fe(8,"track-mix-")),C(this,"trackList",void 0),C(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=i,this.trackList=[]}hasAudioTrack(i){return-1!==this.trackList.indexOf(i)}addAudioTrack(i){-1===this.trackList.indexOf(i)?(w.debug("add ".concat(i.getTrackId()," to mixing track")),i._source.outputNode.connect(this.destNode),this.trackList.push(i),this.updateEncoderConfig()):w.debug("track ".concat(i.getTrackId()," is already added"))}removeAudioTrack(i){if(-1!==this.trackList.indexOf(i)){w.debug("remove ".concat(i.getTrackId()," from mixing track"));try{i._source.outputNode.disconnect(this.destNode)}catch{}RS(this.trackList,i),this.updateEncoderConfig()}}updateEncoderConfig(){const i={};this.trackList.forEach(r=>{r._encoderConfig&&((r._encoderConfig.bitrate||0)>(i.bitrate||0)&&(i.bitrate=r._encoderConfig.bitrate),(r._encoderConfig.sampleRate||0)>(i.sampleRate||0)&&(i.sampleRate=r._encoderConfig.sampleRate),(r._encoderConfig.sampleSize||0)>(i.sampleSize||0)&&(i.sampleSize=r._encoderConfig.sampleSize),r._encoderConfig.stereo&&(i.stereo=!0))}),this._encoderConfig=i}_updateRtpTransceiver(i){this._rtpTransceiver!==i&&(this._rtpTransceiver=i,this.trackList.forEach(r=>{r instanceof wn?r.emit(_c.TRANSCEIVER_UPDATED,i):r._updateRtpTransceiver(i)}))}}function FE(s){const i={};s.facingMode&&(i.facingMode=s.facingMode),s.cameraId&&(i.deviceId={exact:s.cameraId});const r=Ma(s.encoderConfig);return null!=r.width&&(i.width=r.width),null!=r.height&&(i.height=r.height),!al()&&r.frameRate&&(i.frameRate=r.frameRate),dt().name===Ne.EDGE&&"object"==typeof i.frameRate&&(i.frameRate.max=60),Wt()&&(i.frameRate={ideal:30,max:30}),i}function AC(s){const i={};if(al()||(void 0!==s.AGC&&(i.autoGainControl=s.AGC),void 0!==s.AEC&&(i.echoCancellation=s.AEC),void 0!==s.ANS&&(i.noiseSuppression=s.ANS,qg()&&s.ANS&&(i.googHighpassFilter=s.ANS))),s.encoderConfig){const r=Ss(s.encoderConfig);i.channelCount=r.stereo?2:1,i.sampleRate=r.sampleRate,i.sampleSize=r.sampleSize}return s.microphoneId&&(i.deviceId={exact:s.microphoneId}),qr()&&(i.sampleRate=void 0),i}class uO extends La{set currentState(i){i!==this._currentState&&(this._currentState=i,this.safeEmit(yr.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),C(this,"audioBuffer",void 0),C(this,"sourceNode",void 0),C(this,"startPlayTime",0),C(this,"startPlayOffset",0),C(this,"pausePlayTime",0),C(this,"options",void 0),C(this,"currentLoopCount",0),C(this,"currentPlaybackSpeed",100),C(this,"_currentState","stopped"),this.audioBuffer=i,this.options=r,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:(this.playbackSpeed/100*(this.context.currentTime-this.startPlayTime)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(i){"stopped"===this.currentState?(this.options=i,this.startPlayOffset=this.options.startPlayTime||0):w.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(i){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=i,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=i))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(i){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=i/100),this.currentPlaybackSpeed=i}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const i=this.context.createBufferSource();return i.buffer=this.audioBuffer,i.loop=!!this.options.loop,i.connect(this.outputNode),i.playbackRate.value=this.currentPlaybackSpeed/100,i}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const hO=new Map;function UE(){return UE=M(function*(s,i){let r=null;if("string"==typeof s){const l=hO.get(s);if(l)return w.debug("use cached audio resource: ",s),l;try{r=(yield gs(()=>vr.get(s,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(d){throw new J(x.FETCH_AUDIO_FILE_FAILED,d.toString())}}else r=yield new q((d,h)=>{const p=new FileReader;p.onload=m=>{m.target?d(m.target.result):h(new J(x.READ_LOCAL_AUDIO_FILE_ERROR))},p.onerror=()=>{h(new J(x.READ_LOCAL_AUDIO_FILE_ERROR))},p.readAsArrayBuffer(s)});const a=yield function(l){const d=Ch();return new q((h,p)=>{d.decodeAudioData(l,m=>{h(m)},m=>{p(new J(x.DECODE_AUDIO_FILE_FAILED,m.toString()))})})}(r);return"string"==typeof s&&i&&hO.set(s,a),a}),UE.apply(this,arguments)}const DC=s=>{const i=document.createElement("canvas");return i.width=2,i.height=2,new q((r,a)=>{i.toBlob(function(){var l=M(function*(d){if(i.remove(),d){const h=yield fO(d);r({buffer:h,width:i.width,height:i.height})}else a(new J(x.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(d){return l.apply(this,arguments)}}(),s,1)})},fO=function(){var s=M(function*(i){const r=yield i.arrayBuffer();return new Uint8Array(r)});return function(r){return s.apply(this,arguments)}}(),Fa=new class extends zt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),C(this,"_lastHiddenTime",0),C(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),w.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};function mO(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function OC(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?mO(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):mO(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class VE{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(i){i!==this._videoElementStatus&&(w.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(i)),this._videoElementStatus=i)}constructor(i){C(this,"trackId",void 0),C(this,"config",void 0),C(this,"onFirstVideoFrameDecoded",void 0),C(this,"freezeTimeCounterList",[]),C(this,"renderFreezeAccTime",0),C(this,"isKeepLastFrame",!1),C(this,"timeUpdatedCount",0),C(this,"freezeTime",0),C(this,"playbackTime",0),C(this,"lastTimeUpdatedTime",0),C(this,"autoplayFailed",!1),C(this,"videoTrack",void 0),C(this,"videoElement",void 0),C(this,"cacheVideoElement",void 0),C(this,"videoElementCheckInterval",void 0),C(this,"_videoElementStatus",Vi.NONE),C(this,"isGettingVideoDimensions",!1),C(this,"startGetVideoDimensions",()=>{const r=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return w.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(r,500)};!this.isGettingVideoDimensions&&r()}),C(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===vt.curState&&(w.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(NA())),Ws()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),C(this,"handleVideoEvents",r=>{switch(r.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Vi.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Vi.CANPLAY;break;case"stalled":this.videoElementStatus=Vi.STALLED;break;case"suspend":this.videoElementStatus=Vi.SUSPEND;break;case"pause":this.videoElementStatus=Vi.PAUSED,Li()||po()||Ki()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(w.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Vi.WAITING;break;case"abort":this.videoElementStatus=Vi.ABORT;break;case"ended":this.videoElementStatus=Vi.ENDED;break;case"emptied":this.videoElementStatus=Vi.EMPTIED;break;case"error":{this.videoElementStatus=Vi.ERROR;const a=this.videoElement.error;a&&w.error("[".concat(this.trackId,"] media error, code: ").concat(a.code,", message: ").concat(a.message));break}case"timeupdate":{const a=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=a);const l=a-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=a,Fa.lastVisibleTime<Fa.lastHiddenTime||d<Fa.lastHiddenTime||d<Fa.lastVisibleTime)return;for(l>j("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=l),this.playbackTime+=l;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),C(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(w.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(NA())),Ws()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=i.trackId,this.config=i,this.videoElement=i.element instanceof HTMLVideoElement?i.element:document.createElement("video"),vt.on($n.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),vt.on($n.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var i;return null!==(i=this.videoElement.parentElement)&&void 0!==i?i:void 0}updateConfig(i){this.config=i,this.trackId=i.trackId,i.element!==this.videoElement&&(this.destroy(),this.videoElement=i.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(i){this.videoTrack!==i&&(this.videoTrack=i,this.initVideoElement())}play(i){const r=this.videoElement.play();r&&r.catch&&r.catch(l=>{i&&cO(i,"video",l.message,this.trackId),"NotAllowedError"===l.name?(w.warning("detected video element autoplay failed",l),this.autoplayFailed=!0,this.handleAutoPlayFailed()):w.warning("[".concat(this.trackId,"] play warning: "),l)});const a=dt();if(("Safari"===a.name&&15===Number(a.version)||sl())&&r&&r.then){const l=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};r.then(l).catch(l)}}getCurrentFrame(){const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const r=i.getContext("2d");if(!r)return w.error("create canvas context failed!"),new ImageData(2,2);r.drawImage(this.videoElement,0,0,i.width,i.height);const a=r.getImageData(0,0,i.width,i.height);return i.remove(),a}getCurrentFrameToUint8Array(i){var r=arguments,a=this;return M(function*(){let l=r.length>1&&void 0!==r[1]?r[1]:1;const d=document.createElement("canvas");d.width=a.videoElement.videoWidth,d.height=a.videoElement.videoHeight;const h=d.getContext("2d");return h?(h.drawImage(a.videoElement,0,0,d.width,d.height),new q((p,m)=>{d.toBlob(function(){var g=M(function*(E){if(d.remove(),E){const y=yield fO(E);p({buffer:y,width:d.width,height:d.height})}else m(new J(x.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(E){return g.apply(this,arguments)}}(),i,l<0?.1:l>1?1:l)})):yield DC(i)})()}destroy(){vt.off($n.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),vt.off($n.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=Vi.INIT,!this.videoElementCheckInterval&&(NC.forEach(d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{var d;(d=this.videoElement)!==document.body&&document.body.contains(d)||(this.videoElementStatus=Vi.DESTROYED)},1e3),j("ENABLE_VIDEO_FRAME_CALLBACK"))){var i,r;let d;const h=(p,m)=>{if(this.videoElementStatus===Vi.PLAYING){if(d){const y=m.presentationTime-d.presentationTime;y>j("VIDEO_FREEZE_DURATION")&&Fa.lastVisibleTime>=Fa.lastHiddenTime&&d.timestamp>Fa.lastVisibleTime&&d.timestamp>Fa.lastHiddenTime&&(this.renderFreezeAccTime+=y)}d=OC(OC({},m),{},{timestamp:p})}var g,E;j("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(g=(E=this.videoElement).requestVideoFrameCallback)||void 0===g||g.call(E,h))};null===(i=(r=this.videoElement).requestVideoFrameCallback)||void 0===i||i.call(r,h)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),qr()&&(this.videoElement.poster="noposter");const a=dt();"Safari"===a.name&&15===Number(a.version)||sl()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.videoElement.style.objectFit=this.config.fit?this.config.fit:"cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Wt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Wt()&&this.videoElement.load());const l=this.videoElement.play();void 0!==l&&l.catch(d=>{w.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())})}resetVideoElement(){NC.forEach(i=>{this.videoElement&&this.videoElement.removeEventListener(i,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Vi.NONE}handleAutoPlayFailed(){const i=r=>{r.preventDefault(),this.videoElement.play().then(()=>{w.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(a=>{w.error(a)}),this.autoplayFailed=!1,ii()?document.body.removeEventListener("click",i,!0):(document.body.removeEventListener("touchstart",i,!0),document.body.removeEventListener("mousedown",i,!0))};ii()?document.body.addEventListener("click",i,!0):(document.body.addEventListener("touchstart",i,!0),document.body.addEventListener("mousedown",i,!0)),PE()}}const NC=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class PC extends VE{constructor(i){super(i),C(this,"container",void 0),C(this,"slot",void 0),this.slot=i.element,this.updateConfig(i)}updateConfig(i){this.config=i,this.trackId=i.trackId;const r=i.element;r!==this.slot&&(this.destroy(),this.slot=r),this.createElements()}updateVideoTrack(i){this.videoTrack!==i&&(this.videoTrack=i,this.createElements())}play(i){var r;null!==(r=this.container)&&void 0!==r&&r.contains(this.videoElement)&&super.play(i)}getCurrentFrame(){var i;return null!==(i=this.container)&&void 0!==i&&i.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}getCurrentFrameToUint8Array(i){var r=arguments,a=()=>super.getCurrentFrameToUint8Array,l=this;return M(function*(){var d;let h=r.length>1&&void 0!==r[1]?r[1]:1;return null!==(d=l.container)&&void 0!==d&&d.contains(l.videoElement)?yield a().call(l,i,h):yield DC(i)})()}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",j("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var i;!this.container||null!==(i=this.container)&&void 0!==i&&i.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var i;if(null!==(i=this.container)&&void 0!==i&&i.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var i;null!==(i=this.container)&&void 0!==i&&i.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function _O(s){return new q((i,r)=>{let a=!1;const l=document.createElement("video");l.setAttribute("autoplay",""),l.setAttribute("muted",""),l.muted=!0,l.autoplay=!0,l.setAttribute("playsinline",""),l.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(l);const d=Li()?"canplay":"playing";l.addEventListener(d,()=>{const h=l.videoWidth,p=l.videoHeight;!h&&Wt()||(a=!0,l.srcObject=null,l.remove(),i([h,p]))}),l.srcObject=new MediaStream([s]),l.play().catch(yf),setTimeout(()=>{a||(l.srcObject=null,l.remove(),i([l.videoWidth,l.videoHeight]))},4e3)})}const DL=function(){var s=M(function*(i,r,a){const l=function(p){const m=[];for(let g=0;g<p.length;g+=2)m.push(parseInt(p.slice(g,g+2),16));return Uint8Array.from(m)}(function(p){const m="0123456789abcdef";function g(_e){let ve,Ze="";for(ve=0;ve<=3;ve++)Ze+=m.charAt(_e>>8*ve+4&15)+m.charAt(_e>>8*ve&15);return Ze}function E(_e,ve){const Ze=(65535&_e)+(65535&ve);return(_e>>16)+(ve>>16)+(Ze>>16)<<16|65535&Ze}function y(_e,ve,Ze,yt,xn,Ht){return E((li=E(E(ve,_e),E(yt,Ht)))<<(ie=xn)|li>>>32-ie,Ze);var li,ie}function b(_e,ve,Ze,yt,xn,Ht,li){return y(ve&Ze|~ve&yt,_e,ve,xn,Ht,li)}function T(_e,ve,Ze,yt,xn,Ht,li){return y(ve&yt|Ze&~yt,_e,ve,xn,Ht,li)}function O(_e,ve,Ze,yt,xn,Ht,li){return y(ve^Ze^yt,_e,ve,xn,Ht,li)}function P(_e,ve,Ze,yt,xn,Ht,li){return y(Ze^(ve|~yt),_e,ve,xn,Ht,li)}const D=function(_e){let ve;const Ze=1+(_e.length+8>>6),yt=new Array(16*Ze);for(ve=0;ve<16*Ze;ve++)yt[ve]=0;for(ve=0;ve<_e.length;ve++)yt[ve>>2]|=_e.charCodeAt(ve)<<ve%4*8;return yt[ve>>2]|=128<<ve%4*8,yt[16*Ze-2]=8*_e.length,yt}(p);let L,B,V,Q,se,K=1732584193,ee=-271733879,$=-1732584194,Y=271733878;for(L=0;L<D.length;L+=16)B=K,V=ee,Q=$,se=Y,K=b(K,ee,$,Y,D[L+0],7,-680876936),Y=b(Y,K,ee,$,D[L+1],12,-389564586),$=b($,Y,K,ee,D[L+2],17,606105819),ee=b(ee,$,Y,K,D[L+3],22,-1044525330),K=b(K,ee,$,Y,D[L+4],7,-176418897),Y=b(Y,K,ee,$,D[L+5],12,1200080426),$=b($,Y,K,ee,D[L+6],17,-1473231341),ee=b(ee,$,Y,K,D[L+7],22,-45705983),K=b(K,ee,$,Y,D[L+8],7,1770035416),Y=b(Y,K,ee,$,D[L+9],12,-1958414417),$=b($,Y,K,ee,D[L+10],17,-42063),ee=b(ee,$,Y,K,D[L+11],22,-1990404162),K=b(K,ee,$,Y,D[L+12],7,1804603682),Y=b(Y,K,ee,$,D[L+13],12,-40341101),$=b($,Y,K,ee,D[L+14],17,-1502002290),ee=b(ee,$,Y,K,D[L+15],22,1236535329),K=T(K,ee,$,Y,D[L+1],5,-165796510),Y=T(Y,K,ee,$,D[L+6],9,-1069501632),$=T($,Y,K,ee,D[L+11],14,643717713),ee=T(ee,$,Y,K,D[L+0],20,-373897302),K=T(K,ee,$,Y,D[L+5],5,-701558691),Y=T(Y,K,ee,$,D[L+10],9,38016083),$=T($,Y,K,ee,D[L+15],14,-660478335),ee=T(ee,$,Y,K,D[L+4],20,-405537848),K=T(K,ee,$,Y,D[L+9],5,568446438),Y=T(Y,K,ee,$,D[L+14],9,-1019803690),$=T($,Y,K,ee,D[L+3],14,-187363961),ee=T(ee,$,Y,K,D[L+8],20,1163531501),K=T(K,ee,$,Y,D[L+13],5,-1444681467),Y=T(Y,K,ee,$,D[L+2],9,-51403784),$=T($,Y,K,ee,D[L+7],14,1735328473),ee=T(ee,$,Y,K,D[L+12],20,-1926607734),K=O(K,ee,$,Y,D[L+5],4,-378558),Y=O(Y,K,ee,$,D[L+8],11,-2022574463),$=O($,Y,K,ee,D[L+11],16,1839030562),ee=O(ee,$,Y,K,D[L+14],23,-35309556),K=O(K,ee,$,Y,D[L+1],4,-1530992060),Y=O(Y,K,ee,$,D[L+4],11,1272893353),$=O($,Y,K,ee,D[L+7],16,-155497632),ee=O(ee,$,Y,K,D[L+10],23,-1094730640),K=O(K,ee,$,Y,D[L+13],4,681279174),Y=O(Y,K,ee,$,D[L+0],11,-358537222),$=O($,Y,K,ee,D[L+3],16,-722521979),ee=O(ee,$,Y,K,D[L+6],23,76029189),K=O(K,ee,$,Y,D[L+9],4,-640364487),Y=O(Y,K,ee,$,D[L+12],11,-421815835),$=O($,Y,K,ee,D[L+15],16,530742520),ee=O(ee,$,Y,K,D[L+2],23,-995338651),K=P(K,ee,$,Y,D[L+0],6,-198630844),Y=P(Y,K,ee,$,D[L+7],10,1126891415),$=P($,Y,K,ee,D[L+14],15,-1416354905),ee=P(ee,$,Y,K,D[L+5],21,-57434055),K=P(K,ee,$,Y,D[L+12],6,1700485571),Y=P(Y,K,ee,$,D[L+3],10,-1894986606),$=P($,Y,K,ee,D[L+10],15,-1051523),ee=P(ee,$,Y,K,D[L+1],21,-2054922799),K=P(K,ee,$,Y,D[L+8],6,1873313359),Y=P(Y,K,ee,$,D[L+15],10,-30611744),$=P($,Y,K,ee,D[L+6],15,-1560198380),ee=P(ee,$,Y,K,D[L+13],21,1309151649),K=P(K,ee,$,Y,D[L+4],6,-145523070),Y=P(Y,K,ee,$,D[L+11],10,-1120210379),$=P($,Y,K,ee,D[L+2],15,718787259),ee=P(ee,$,Y,K,D[L+9],21,-343485551),K=E(K,B),ee=E(ee,V),$=E($,Q),Y=E(Y,se);return g(K)+g(ee)+g($)+g(Y)}(""+r+a)).slice(0,16),d=l.slice(0,12),h=yield window.crypto.subtle.importKey("raw",l,"AES-GCM",!0,["encrypt"]);return new Uint8Array(yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:d},h,i))});return function(r,a,l){return s.apply(this,arguments)}}(),OL=function(){var s=M(function*(i,r,a){return yield DL(i.buffer,r,a)});return function(r,a,l){return s.apply(this,arguments)}}();function xC(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function es(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?xC(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):xC(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class ze extends Ri{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Vi.PLAYING)}get processorContext(){return this._processorContext}set processorContext(i){this._processorContext=i}get __className__(){return"LocalVideoTrack"}constructor(i,r,a,l,d,h){if(super(i,d),C(this,"trackMediaType","video"),C(this,"_player",void 0),C(this,"isUseScaleResolutionDownBy",!1),C(this,"_videoVisibleTimer",null),C(this,"_statsTimer",null),C(this,"_previousVideoVisibleStatus",void 0),C(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),C(this,"_encoderConfig",void 0),C(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),C(this,"_optimizationMode",void 0),C(this,"_videoHeight",void 0),C(this,"_videoWidth",void 0),C(this,"_forceBitrateLimit",void 0),C(this,"_enabled",!0),C(this,"processorDestination",void 0),C(this,"_processorContext",void 0),Ki()){const{width:p,height:m}=i.getSettings();this._videoWidth=p,this._videoHeight=m}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=r,this._scalabilityMode=a,this._optimizationMode=l,this._hints=h||[],-1===this._hints.indexOf(Ot.SCREEN_TRACK))this.updateBitrateFromProfile();else if(function(p,m,g){const E=dt();return!(E.name!==p||!E.osVersion)&&115===Number(E.version)}(Ne.CHROME)&&-1!==Wg().indexOf("Windows")){const p=function(m,g){if("VideoFrame"in window&&"TransformStream"in window&&$e().supportWebRTCInsertableStream){const E=new MediaStreamTrackProcessor(m),y=new MediaStreamTrackGenerator({kind:"video"});let b,T,O=Date.now();const P=()=>{D&&(clearInterval(D),D=void 0),b&&(b.close(),b=void 0),m.stop(),T=void 0,y.removeEventListener("ended",P)};let D=window.setInterval(()=>{if(T&&b&&Date.now()-O>1e3)try{"live"===y.readyState?T.enqueue(b.clone()):P()}catch{P()}},1e3);const L=new TransformStream({transform:(B,V)=>{"live"===y.readyState?(T=V,O=Date.now(),void 0===b?(b=B,V.enqueue(B.clone())):(V.enqueue(b),b=B)):B.close()}});return y.addEventListener("ended",P),E.readable.pipeThrough(L).pipeTo(y.writable),y}}(i);p&&(w.info("local screen video track begin to inject frame"),this._mediaStreamTrack=p)}r&&-1!==this._hints.indexOf(Ot.CUSTOM_TRACK)&&this.setEncoderConfiguration(r),this.processorContext=new ME(this.getTrackId(),"local"),this.processorDestination=new Gf(this.processorContext),this.bindProcessorDestinationEvents()}play(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof i){const l=document.getElementById(i);l?i=l:(w.warning("[".concat(this.getTrackId(),'] can not find "#').concat(i,'" element, use document.body')),i=document.body)}w.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const a=es(es(es({},this._getDefaultPlayerConfig()),r),{},{trackId:this.getTrackId(),element:i});this._player?this._player.updateConfig(a):(this._player=i instanceof HTMLVideoElement?new VE(a):new PC(a),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const l=this.getVideoElementVisibleStatus();this.safeEmit(yl.VIDEO_ELEMENT_VISIBLE_STATUS,l)}catch{}},j("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._statsTimer&&(this.isUseScaleResolutionDownBy=!1,window.clearInterval(this._statsTimer),this._statsTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,w.debug("[".concat(this.getTrackId(),"] stop video playback")))}setEnabled(i,r){var a=this;return M(function*(){if(!r){if(i===a._enabled)return;a.stateCheck("enabled",i)}if(w.info("[".concat(a.getTrackId(),"] start setEnabled"),i),!i){a._originMediaStreamTrack.enabled=!1;try{yield Et(a,me.NEED_DISABLE_TRACK,a)}catch(l){throw w.error("[".concat(a.getTrackId(),"] setEnabled to false error"),l.toString()),l}return r||(a._enabled=!1),void w.info("[".concat(a.getTrackId(),"] setEnabled to false success"))}a._originMediaStreamTrack.enabled=!0;try{yield Et(a,me.NEED_ENABLE_TRACK,a)}catch(l){throw w.error("[".concat(a.getTrackId(),"] setEnabled to true error"),l.toString()),l}w.info("[".concat(a.getTrackId(),"] setEnabled to true success")),r||(a._enabled=!0)})()}setMuted(i){var r=this;return M(function*(){i!==r._muted&&(r.stateCheck("muted",i),r._muted=i,r._originMediaStreamTrack.enabled=!i,w.debug("[".concat(r.getTrackId(),"] start set muted: ").concat(i)),i?yield Et(r,me.NEED_MUTE_TRACK,r):yield Et(r,me.NEED_UNMUTE_TRACK,r))})()}setEncoderConfiguration(i,r){var a=this;return M(function*(){if(!a._enabled)throw new J(x.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if("720p_auto"===i?a.startMonitorStats():a._statsTimer&&(window.clearInterval(a._statsTimer),a._statsTimer=null),i=Ma(i),a._forceBitrateLimit&&(i.bitrateMax=a._forceBitrateLimit.max_bitrate?a._forceBitrateLimit.max_bitrate:i.bitrateMax,i.bitrateMin=a._forceBitrateLimit.min_bitrate?a._forceBitrateLimit.min_bitrate:i.bitrateMin),i.width||i.height||i.frameRate){const l=FE({encoderConfig:i});(Ki()||Li()||po())&&(l.deviceId=void 0),w.debug("[".concat(a.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(i),JSON.stringify(l));try{yield a._originMediaStreamTrack.applyConstraints(l),a.updateMediaStreamTrackResolution()}catch(d){const h=new J(x.UNEXPECTED_ERROR,d.toString());throw w.error("[".concat(a.getTrackId(),"] applyConstraints error"),h.toString()),h}}a._encoderConfig=i,-1===a._hints.indexOf(Ot.SCREEN_TRACK)&&a.updateBitrateFromProfile();try{yield Et(a,me.NEED_UPDATE_VIDEO_ENCODER,a)}catch(l){return l.throw(w)}})()}getStats(){return vf(()=>{w.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),gr(this,me.GET_STATS)||es({},IE)}setBeautyEffect(i){return M(function*(){w.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")})()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}getCurrentFrameImage(i){var r=arguments,a=this;return M(function*(){return a._player?a._player.getCurrentFrameToUint8Array(i,r.length>1&&void 0!==r[1]?r[1]:1):yield DC(i)})()}setBitrateLimit(i){var r=this;return M(function*(){if(w.debug("[".concat(r.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(i))),i){r._forceBitrateLimit=i,r._encoderConfig&&(r._encoderConfig.bitrateMax=r._encoderConfig.bitrateMax&&r._encoderConfig.bitrateMax<i.max_bitrate?r._encoderConfig.bitrateMax:i.max_bitrate,r._encoderConfig.bitrateMin=i.min_bitrate);try{yield Et(r,me.NEED_UPDATE_VIDEO_ENCODER,r)}catch(a){return a.throw(w)}}})()}setOptimizationMode(i){var r=this;return M(function*(){if("motion"!==i&&"detail"!==i&&"balanced"!==i)return void w.error(x.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const a=r._optimizationMode;try{r._optimizationMode=i,yield Et(r,me.SET_OPTIMIZATION_MODE,r)}catch(l){throw r._optimizationMode=a,w.error("[".concat(r.getTrackId(),"] set optimization mode failed"),l.toString()),l}w.info("[".concat(r.getTrackId(),"] set optimization mode success (").concat(i,")"))})()}setScalabiltyMode(i){if(1===i.numSpatialLayers&&1!==i.numTemporalLayers)return w.error(x.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=i,w.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(i,")"))}updateMediaStreamTrackResolution(){_O(this._originMediaStreamTrack).then(i=>{let[r,a]=i;this._videoHeight=a,this._videoWidth=r}).catch(yf)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}setSenderConfiguration(i){var r=this;return M(function*(){if(!r._enabled)throw new J(x.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");w.debug("[".concat(r.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(i)),i=Ma(i),r._forceBitrateLimit&&(i.bitrateMax=r._forceBitrateLimit.max_bitrate?r._forceBitrateLimit.max_bitrate:i.bitrateMax,i.bitrateMin=r._forceBitrateLimit.min_bitrate?r._forceBitrateLimit.min_bitrate:i.bitrateMin),r._encoderConfig=i,-1===r._hints.indexOf(Ot.SCREEN_TRACK)&&r.updateBitrateFromProfile();try{yield Et(r,me.NEED_UPDATE_VIDEO_ENCODER,r)}catch(a){return a.throw(w)}})()}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:i,height:r,frameRate:a}=this.getMediaStreamTrackSettings();if(!i||!r||!a)return;const[l,d]=function(h,p,m,g){let E;const y=200*Math.pow(m/15,.6)*Math.pow(h*p/640/360,.75),b=y;if("STANDARD_BITRATE"===g)E=4*y;else{if("COMPATIABLE_BITRATE"!==g)return;E=2*y}return[Math.floor(E),Math.floor(b)]}(i,r,a,j("BITRATE_ADAPTER_TYPE"))||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=d,this._encoderConfig.bitrateMax=l,w.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(i,", h: ").concat(r,", fps: ").concat(a,"] => [brMax: ").concat(l,", brMin: ").concat(d,"]")))}getVideoElementVisibleStatus(){try{var i,r;const a=null==this||null===(i=this._player)||void 0===i?void 0:i.getContainerElement(),l={track:this,element:null==this||null===(r=this._player)||void 0===r?void 0:r.getVideoElement(),slot:a?.parentElement},{element:d,slot:h}=l;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const p=TS.checkOneElementVisible(d),m=Object.assign({},p);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;Se.reportApiInvoke(null,{tag:Xt.TRACER,name:On.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(m.visible?"Video is visible":"Invisible because of ".concat(m.reason))}return m}return}catch(a){throw new J(x.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}renewMediaStreamTrack(i){return M(function*(){})()}pipe(i){if(this.processor===i)return i;if(i._source)throw new J(x.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),i}unpipe(){if(!this.processor)return;const i=this.processor;this.processor._source=void 0,this.processor=void 0,i.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(i){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this._encoderConfig;i&&(a=es(es({},a),Ma(i))),a=Oa(a);const l=Fe(8,"track-video-cloned-"),d=new ze(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,a,Oa(this._scalabilityMode),this._optimizationMode,l,Oa(this._hints));return i&&a&&d.setEncoderConfiguration(a),w.debug("clone video track from ".concat(this.getTrackId()," to ").concat(l,", clone ").concat(r)),d}replaceTrack(i,r){var a=this;return M(function*(){if(!(i instanceof MediaStreamTrack))throw new J(x.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==i.kind)throw new J(x.INVALID_PARAMS,"track should be a video MediaStreamTrack");yield a._updateOriginMediaStreamTrack(i,r,!0),a.updateMediaStreamTrackResolution()})()}startMonitorStats(){if(!Ki()&&!Li())return;this._statsTimer&&window.clearInterval(this._statsTimer);let i=2,r=vl[i],a=-1,l=Date.now();const d=h=>{h>2||h<0||(l=Date.now(),r=vl[h],this.setSenderConfiguration(r))};this.isUseScaleResolutionDownBy=!0,this._statsTimer=window.setInterval(()=>{const h=this.getStats(),p=gr(this,me.GET_RTC_STATS);if(h.sendPackets>0&&p){-1===a&&(a=Date.now());const m=Date.now();if(m-a<1e3||m-l<j("PROFILE_SWITCH_INTERVAL"))return;const g=h.sendFrameRate,y=.9*r.frameRate;"number"==typeof g&&g>0&&g<.6*r.frameRate?i>0&&(i--,d(i),w.debug("[".concat(this.getTrackId(),"] step down for fps ").concat(g,", switchProfile to ").concat(i))):p.OutgoingAvailableBandwidth<r.bitrateMin?i>0&&(i--,d(i),w.debug("[".concat(this.getTrackId(),"] step down for OutgoingAvailableBandwidth ").concat(p.OutgoingAvailableBandwidth,", bitrateMin ").concat(r.bitrateMin,", switchProfile to ").concat(i))):"number"==typeof g&&g>y&&i<vl.length-1&&p.OutgoingAvailableBandwidth>1.2*vl[i+1].bitrateMin&&(i++,d(i),w.debug("[".concat(this.getTrackId(),"] step up for fps ").concat(g,", OutgoingAvailableBandwidth ").concat(p.OutgoingAvailableBandwidth,", switchProfile to ").concat(i)))}},j("CHECK_LOCAL_STATS_INTERVAL"))}bindProcessorDestinationEvents(){var i=this;this.processorDestination.on(Ii.ON_TRACK,function(){var r=M(function*(a){a?a!==i._mediaStreamTrack&&(i._mediaStreamTrack=a,i._updatePlayerSource(),yield Et(i,me.NEED_REPLACE_TRACK,i)):i._mediaStreamTrack!==i._originMediaStreamTrack&&(i._mediaStreamTrack=i._originMediaStreamTrack,i._updatePlayerSource(),yield Et(i,me.NEED_REPLACE_TRACK,i))});return function(a){return r.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ii.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(br.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(br.REQUEST_CONSTRAINTS)}}te([Ae({argsMap:(s,i,r)=>[s.getTrackId(),"string"==typeof i?i:i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),an(),N("design:type",Function),N("design:paramtypes",[Object,Object]),N("design:returntype",void 0)],ze.prototype,"play",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],ze.prototype,"stop",null),te([Pe("LocalVideoTrack","_enabledMutex"),Ae({argsMap:(s,i)=>[s.getTrackId(),i]}),an(),N("design:type",Function),N("design:paramtypes",[Boolean,Boolean]),N("design:returntype",q)],ze.prototype,"setEnabled",null),te([Pe("LocalVideoTrack","_enabledMutex"),Ae({argsMap:(s,i)=>[s.getTrackId(),i]}),an(),N("design:type",Function),N("design:paramtypes",[Boolean]),N("design:returntype",q)],ze.prototype,"setMuted",null),te([Ae({argsMap:(s,i)=>[s.getTrackId(),i]}),an(),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",q)],ze.prototype,"setEncoderConfiguration",null),te([an(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",Object)],ze.prototype,"getStats",null),te([Ae({argsMap:(s,i,r)=>[s.getTrackId(),i,r]}),an(),N("design:type",Function),N("design:paramtypes",[Boolean,Object]),N("design:returntype",q)],ze.prototype,"setBeautyEffect",null),te([an(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",ImageData)],ze.prototype,"getCurrentFrameData",null),te([an(),N("design:type",Function),N("design:paramtypes",[String,Number]),N("design:returntype",q)],ze.prototype,"getCurrentFrameImage",null),te([an(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",q)],ze.prototype,"setBitrateLimit",null),te([an(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],ze.prototype,"setOptimizationMode",null),te([an(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],ze.prototype,"setScalabiltyMode",null),te([an(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],ze.prototype,"updateMediaStreamTrackResolution",null),te([Ae({argsMap:(s,i)=>[s.getTrackId(),i.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],ze.prototype,"pipe",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],ze.prototype,"unpipe",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],ze.prototype,"close",null),te([Ae({argsMap:(s,i,r)=>[s.getTrackId(),i.label,r]}),N("design:type",Function),N("design:paramtypes",[MediaStreamTrack,Boolean]),N("design:returntype",q)],ze.prototype,"replaceTrack",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],ze.prototype,"startMonitorStats",null);class Ad extends ze{get __className__(){return"CameraVideoTrack"}constructor(i,r,a,l,d,h){var p;super(i,Ma(r.encoderConfig),l,d,h),p=this,C(this,"_config",void 0),C(this,"_originalConstraints",void 0),C(this,"_constraints",void 0),C(this,"_enabled",!0),C(this,"_deviceName","default"),C(this,"tryResumeVideoForIOS15_16WeChat",M(function*(){(sl()||yS())&&!function(){const m=dt();if(m.os!==Fn.IOS||!m.osVersion)return!1;const g=m.osVersion.split(".");return 15===Number(g[0])&&Number(g[1])>=2}()&&_r()&&p._enabled&&!p._isClosed&&(w.debug("[".concat(p.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),yield p.renewMediaStreamTrack())})),this._config=r,this._originalConstraints=a,this._constraints=a,this._deviceName=i.label,this._encoderConfig=Ma(this._config.encoderConfig),vt.on($n.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),vt.on($n.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}setDevice(i){var r=this;return M(function*(){return"string"==typeof i?r._setDeviceById(i):i.deviceId?r._setDeviceById(i.deviceId):i.facingMode?r._setDeviceByFacingModel(i.facingMode):void 0})()}_setDeviceById(i){var r=this;return M(function*(){if(w.info("[".concat(r.getTrackId(),"] set device to ").concat(i)),r._enabled)try{const a=yield Zo.getDeviceById(i),l={};l.video=es({},r._constraints),l.video.deviceId={exact:i},l.video.facingMode=void 0,r._originMediaStreamTrack.stop();let d=null;try{d=yield Qo(l,r.getTrackId())}catch(h){throw w.error("[".concat(r.getTrackId(),"] setDevice failed"),h.toString()),d=yield Qo({video:r._constraints},r.getTrackId()),yield r._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),h}yield r._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),r.updateMediaStreamTrackResolution(),r._deviceName=a.label,r._config.cameraId=i,r._constraints.deviceId={exact:i}}catch(a){throw w.error("[".concat(r.getTrackId(),"] setDevice error"),a.toString()),a}else try{const a=yield Zo.getDeviceById(i);r._deviceName=a.label,r._config.cameraId=i,r._constraints.deviceId={exact:i}}catch(a){throw w.error("[".concat(r.getTrackId(),"] setDevice error"),a.toString()),a}w.info("[".concat(r.getTrackId(),"] setDevice success"))})()}_setDeviceByFacingModel(i){var r=this;return M(function*(){w.info("[".concat(r.getTrackId(),"] set facingMode ").concat(i));const a={video:es(es({},r._constraints),{},{deviceId:void 0,facingMode:{exact:i}})};if(r._enabled){r._originMediaStreamTrack.stop();let l=null;try{l=yield Qo(a,r.getTrackId())}catch(d){throw w.error("[".concat(r.getTrackId(),"] setDeviceByFacingModel failed"),d.toString()),l=yield Qo({video:r._constraints},r.getTrackId()),yield r._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1),d}yield r._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1),r.updateMediaStreamTrackResolution()}r._deviceName="",r._config.facingMode=i,r._config.cameraId=void 0,r._constraints=es({},a.video),w.info("[".concat(r.getTrackId(),"] setDeviceByFacingModel success"))})()}setEnabled(i,r){var a=this;return M(function*(){if(!r){if(i===a._enabled)return;a.stateCheck("enabled",i)}if(w.info("[".concat(a.getTrackId(),"] start setEnabled"),i),i){try{if(a.isExternalTrack)a._originMediaStreamTrack.enabled=!0;else{const l=yield Qo({video:a._constraints},a.getTrackId());yield a._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1)}yield Et(a,me.NEED_ENABLE_TRACK,a)}catch(l){throw w.error("[".concat(a.getTrackId(),"] setEnabled true error"),l.toString()),l}a.updateMediaStreamTrackResolution(),w.info("[".concat(a.getTrackId(),"] setEnabled to true success")),r||(a._enabled=!0)}else{a.isExternalTrack?a._originMediaStreamTrack.enabled=!1:(a._originMediaStreamTrack.onended=null,a._originMediaStreamTrack.stop()),r||(a._enabled=!1);try{yield Et(a,me.NEED_DISABLE_TRACK,a)}catch(l){throw w.error("[".concat(a.getTrackId(),"] setEnabled to false error"),l.toString()),l}w.info("[".concat(a.getTrackId(),"] setEnabled to false success"))}})()}setEncoderConfiguration(i,r){var a=this;return M(function*(){if(!a._enabled)throw new J(x.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");"720p_auto"===i?a.startMonitorStats():a._statsTimer&&(window.clearInterval(a._statsTimer),a._statsTimer=null),i=Ma(i),a._forceBitrateLimit&&(i.bitrateMax=a._forceBitrateLimit.max_bitrate?a._forceBitrateLimit.max_bitrate:i.bitrateMax,i.bitrateMin=a._forceBitrateLimit.min_bitrate?a._forceBitrateLimit.min_bitrate:i.bitrateMin);const l=un(a._config);l.encoderConfig=i;const d=FE(l);(Ki()||Li()||po())&&(d.deviceId=void 0),w.debug("[".concat(a.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(i),JSON.stringify(d));try{yield a._originMediaStreamTrack.applyConstraints(d),a.updateMediaStreamTrackResolution()}catch(h){const p=new J(x.UNEXPECTED_ERROR,h.toString());throw w.error("[".concat(a.getTrackId(),"] applyConstraints error"),p.toString()),p}a._config=l,a._constraints=d,a._originalConstraints=d,a._encoderConfig=i,-1===a._hints.indexOf(Ot.SCREEN_TRACK)&&a.updateBitrateFromProfile();try{yield Et(a,me.NEED_UPDATE_VIDEO_ENCODER,a)}catch(h){return h.throw(w)}})()}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){var i=this;if((Li()||po())&&this._enabled&&!this._isClosed&&vt.duringInterruption){const r=function(){var a=M(function*(){vt.off($n.IOS_INTERRUPTION_END,r),i._enabled&&!i._isClosed&&(w.debug("[".concat(i.getTrackId(),"] try capture camera media device for interrupted iOS device.")),yield i.setEnabled(!1),yield i.setEnabled(!0))});return function(){return a.apply(this,arguments)}}();vt.on($n.IOS_INTERRUPTION_END,r)}else w.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(yl.TRACK_ENDED)}renewMediaStreamTrack(i){var r=this;return M(function*(){const a=i||r._constraints,l=Zo.searchDeviceIdByName(r._deviceName);if(l&&!a.deviceId&&(a.deviceId={exact:l}),r._enabled){const d=yield Qo({video:a},r.getTrackId());r._constraints=a,yield r._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!0),r.updateMediaStreamTrackResolution()}})()}close(){super.close(),vt.off($n.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),vt.off($n.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(i){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this._encoderConfig;i&&(a=es(es({},a),Ma(i))),a=Oa(a);const l=Fe(8,"track-cam-cloned-"),d=new Ad(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,Oa(es(es({},this._config),{},{encoderConfig:a})),Oa(this._constraints),Oa(this._scalabilityMode),this._optimizationMode,l);return i&&a&&d.setEncoderConfiguration(a),w.debug("clone track from ".concat(this.getTrackId()," to ").concat(l,", clone ").concat(r)),d}bindProcessorContextEvents(){var i=this;this.processorContext.on(br.REQUEST_UPDATE_CONSTRAINTS,function(){var r=M(function*(a,l,d){try{const h=Object.assign({},i._originalConstraints,...a);yield i.renewMediaStreamTrack(h),l()}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this.processorContext.on(br.REQUEST_CONSTRAINTS,function(){var r=M(function*(a){a(i._originMediaStreamTrack.getSettings())});return function(a){return r.apply(this,arguments)}}())}}function NL(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function MC(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?NL(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):NL(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function gO(s,i,r,a){r.optimizationMode&&(a&&a.width&&a.height?(r.encoderConfig=MC(MC({},a),{},{bitrateMin:a.bitrateMin,bitrateMax:a.bitrateMax}),"motion"!==r.optimizationMode&&"detail"!==r.optimizationMode||(i.contentHint=r.optimizationMode,i.contentHint===r.optimizationMode?w.debug("[".concat(s,"] set content hint to"),r.optimizationMode):w.debug("[".concat(s,"] set content hint failed")))):w.warning("[".concat(s,"] can not apply optimization mode bitrate config, no encoderConfig")))}function PL(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function kC(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?PL(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):PL(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}te([Ae({argsMap:(s,i)=>[s.getTrackId(),i]}),an(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",q)],Ad.prototype,"setDevice",null),te([Pe("CameraVideoTrack","_enabledMutex"),Ae({argsMap:(s,i)=>[s.getTrackId(),i]}),an(),N("design:type",Function),N("design:paramtypes",[Boolean,Boolean]),N("design:returntype",q)],Ad.prototype,"setEnabled",null),te([Ae({argsMap:(s,i)=>[s.getTrackId(),i]}),an(),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",q)],Ad.prototype,"setEncoderConfiguration",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Ad.prototype,"close",null);class xL extends ZD{getUserId(){return this._userId}constructor(i,r,a,l){super(i,"track-".concat(i.kind,"-").concat(r,"-").concat(l.clientId,"_").concat(Fe(5,""))),C(this,"_userId",void 0),C(this,"_uintId",void 0),C(this,"_isDestroyed",!1),C(this,"store",void 0),C(this,"processor",void 0),this._userId=r,this._uintId=a,this.store=l}_updateOriginMediaStreamTrack(i){this._originMediaStreamTrack=i,this._mediaStreamTrack=i,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,w.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}class Cs extends xL{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Vi.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(i,r,a,l){super(i,r,a,l),C(this,"_videoVisibleTimer",null),C(this,"_previousVideoVisibleStatus",void 0),C(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),C(this,"trackMediaType","video"),C(this,"_videoWidth",void 0),C(this,"_videoHeight",void 0),C(this,"_player",void 0),C(this,"processorDestination",void 0),C(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new ME(this.getTrackId(),"remote"),this.processorDestination=new Gf(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return vf(()=>{w.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),gr(this,me.GET_STATS)||kC({},QD)}play(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof i){const l=document.getElementById(i);l?i=l:(w.warning("[".concat(this.getTrackId(),'] can not find "#').concat(i,'" element, use document.body')),i=document.body)}w.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const a=kC(kC({fit:"cover"},r),{},{trackId:this.getTrackId(),element:i});this._player?this._player.updateConfig(a):(this._player=i instanceof HTMLVideoElement?new VE(a):new PC(a),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Cd.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const l=this.getVideoElementVisibleStatus();this.safeEmit(Cd.VIDEO_ELEMENT_VISIBLE_STATUS,l)}catch{}},j("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,w.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){_O(this._originMediaStreamTrack).then(i=>{let[r,a]=i;this._videoHeight=a,this._videoWidth=r}).catch(yf)}_updatePlayerSource(){w.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var i,r;const a=null==this||null===(i=this._player)||void 0===i?void 0:i.getContainerElement(),l={track:this,element:null==this||null===(r=this._player)||void 0===r?void 0:r.getVideoElement(),slot:a?.parentElement},{element:d,slot:h}=l;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const p=TS.checkOneElementVisible(d),m=Object.assign({},p);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;Se.reportApiInvoke(null,{tag:Xt.TRACER,name:On.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(m.visible?"Video is visible":"Invisible because of ".concat(m.reason))}return m}return}catch(a){throw new J(x.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}pipe(i){if(this.processor===i)return i;if(i._source)throw new J(x.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),i}unpipe(){if(!this.processor)return;const i=this.processor;this.processor._source=void 0,this.processor=void 0,i.reset()}bindProcessorDestinationEvents(){var i=this;this.processorDestination.on(Ii.ON_TRACK,function(){var r=M(function*(a){a?a!==i._mediaStreamTrack&&(i._mediaStreamTrack=a,i._updatePlayerSource()):i._mediaStreamTrack!==i._originMediaStreamTrack&&(i._mediaStreamTrack=i._originMediaStreamTrack,i._updatePlayerSource())});return function(a){return r.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ii.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}te([Ae({argsMap:(s,i,r)=>[s.getTrackId(),"string"==typeof i?i:i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),N("design:type",Function),N("design:paramtypes",[Object,Object]),N("design:returntype",void 0)],Cs.prototype,"play",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Cs.prototype,"stop",null),te([Ae({argsMap:(s,i)=>[s.getTrackId(),i.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],Cs.prototype,"pipe",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Cs.prototype,"unpipe",null);class Co extends xL{get isPlaying(){return this._useAudioElement?Xr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(i,r,a,l){super(i,r,a,l),C(this,"trackMediaType","audio"),C(this,"_source",void 0),C(this,"_useAudioElement",!0),C(this,"_volume",100),C(this,"processorContext",void 0),C(this,"processorDestination",void 0),C(this,"_played",!1),C(this,"_bypassWebAudio",!1),j("DISABLE_WEBAUDIO")?(this._source=new RC,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new Bi(i,!0),j("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(yr.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Cd.FIRST_FRAME_DECODED)}),this.processorContext=new Wf(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new IC(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(yr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!i)return this._source.removeAllListeners(yr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(yr.ON_AUDIO_BUFFER),this._source.on(yr.ON_AUDIO_BUFFER,a=>i(a))}setVolume(i){this._volume=i,this._useAudioElement?Xr.setVolume(this.getTrackId(),i):this._source.setVolume(i/100)}setPlaybackDevice(i){var r=this;return M(function*(){if(!r._useAudioElement)throw new J(x.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield Xr.setSinkID(r.getTrackId(),i)})()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return vf(()=>{w.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),gr(this,me.GET_STATS)||kC({},Jo)}play(){w.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(w.debug("[".concat(this.getTrackId(),"] use audio element to play")),Xr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){w.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Xr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];w.debug("[".concat(this.getTrackId(),"] update player source track")),i&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Xr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(i){if(this._bypassWebAudio)throw new J(x.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===i)return i;if(i._source)throw new J(x.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),i}unpipe(){var i;if(this._bypassWebAudio)throw new J(x.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;null===(i=this._source.processSourceNode)||void 0===i||i.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){var i=this;this.processorDestination.on(Ii.ON_TRACK,function(){var r=M(function*(a){a?a!==i._mediaStreamTrack&&(i._mediaStreamTrack=a,i._updatePlayerSource(!1),i._source.processedNode=i._source.createMediaStreamSourceNode(a)):i._mediaStreamTrack!==i._originMediaStreamTrack&&(i._mediaStreamTrack=i._originMediaStreamTrack,i._updatePlayerSource())});return function(a){return r.apply(this,arguments)}}()),this.processorDestination.on(Ii.ON_NODE,r=>{this._source.processedNode=r;const a=!r;this._useAudioElement!==a&&(this._played?(this.stop(),this._useAudioElement=a,this.play()):this._useAudioElement=a)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ii.ON_TRACK),this.processorDestination.removeAllListeners(Ii.ON_NODE)}}function Dd(s){let i=s.length;for(;--i>=0;)s[i]=0}te([Ae({argsMap:(s,i)=>[s.getTrackId(),i],throttleTime:300}),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],Co.prototype,"setVolume",null),te([Ae({argsMap:(s,i)=>[s.getTrackId(),i]}),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Co.prototype,"setPlaybackDevice",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Co.prototype,"play",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Co.prototype,"stop",null),te([Ae({argsMap:(s,i)=>[s.getTrackId(),i.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],Co.prototype,"pipe",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Co.prototype,"unpipe",null);const EO=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),jE=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),vO=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),yO=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ua=new Array(576);Dd(Ua);const qf=new Array(60);Dd(qf);const HE=new Array(512);Dd(HE);const Kf=new Array(256);Dd(Kf);const Od=new Array(29);Dd(Od);const Nd=new Array(30);function FC(s,i,r,a,l){this.static_tree=s,this.extra_bits=i,this.extra_base=r,this.elems=a,this.max_length=l,this.has_stree=s&&s.length}let bO,SO,CO;function UC(s,i){this.dyn_tree=s,this.max_code=0,this.stat_desc=i}Dd(Nd);const TO=s=>s<256?HE[s]:HE[256+(s>>>7)],Pd=(s,i)=>{s.pending_buf[s.pending++]=255&i,s.pending_buf[s.pending++]=i>>>8&255},To=(s,i,r)=>{s.bi_valid>16-r?(s.bi_buf|=i<<s.bi_valid&65535,Pd(s,s.bi_buf),s.bi_buf=i>>16-s.bi_valid,s.bi_valid+=r-16):(s.bi_buf|=i<<s.bi_valid&65535,s.bi_valid+=r)},Va=(s,i,r)=>{To(s,r[2*i],r[2*i+1])},wO=(s,i)=>{let r=0;do{r|=1&s,s>>>=1,r<<=1}while(--i>0);return r>>>1},IO=(s,i,r)=>{const a=new Array(16);let l,d,h=0;for(l=1;l<=15;l++)h=h+r[l-1]<<1,a[l]=h;for(d=0;d<=i;d++){let p=s[2*d+1];0!==p&&(s[2*d]=wO(a[p]++,p))}},RO=s=>{let i;for(i=0;i<286;i++)s.dyn_ltree[2*i]=0;for(i=0;i<30;i++)s.dyn_dtree[2*i]=0;for(i=0;i<19;i++)s.bl_tree[2*i]=0;s.dyn_ltree[512]=1,s.opt_len=s.static_len=0,s.sym_next=s.matches=0},AO=s=>{s.bi_valid>8?Pd(s,s.bi_buf):s.bi_valid>0&&(s.pending_buf[s.pending++]=s.bi_buf),s.bi_buf=0,s.bi_valid=0},DO=(s,i,r,a)=>{const l=2*i,d=2*r;return s[l]<s[d]||s[l]===s[d]&&a[i]<=a[r]},VC=(s,i,r)=>{const a=s.heap[r];let l=r<<1;for(;l<=s.heap_len&&(l<s.heap_len&&DO(i,s.heap[l+1],s.heap[l],s.depth)&&l++,!DO(i,a,s.heap[l],s.depth));)s.heap[r]=s.heap[l],r=l,l<<=1;s.heap[r]=a},OO=(s,i,r)=>{let a,l,d,h,p=0;if(0!==s.sym_next)do{a=255&s.pending_buf[s.sym_buf+p++],a+=(255&s.pending_buf[s.sym_buf+p++])<<8,l=s.pending_buf[s.sym_buf+p++],0===a?Va(s,l,i):(d=Kf[l],Va(s,d+256+1,i),h=EO[d],0!==h&&(l-=Od[d],To(s,l,h)),a--,d=TO(a),Va(s,d,r),h=jE[d],0!==h&&(a-=Nd[d],To(s,a,h)))}while(p<s.sym_next);Va(s,256,i)},GE=(s,i)=>{const r=i.dyn_tree,a=i.stat_desc.static_tree,l=i.stat_desc.has_stree,d=i.stat_desc.elems;let h,p,m,g=-1;for(s.heap_len=0,s.heap_max=573,h=0;h<d;h++)0!==r[2*h]?(s.heap[++s.heap_len]=g=h,s.depth[h]=0):r[2*h+1]=0;for(;s.heap_len<2;)m=s.heap[++s.heap_len]=g<2?++g:0,r[2*m]=1,s.depth[m]=0,s.opt_len--,l&&(s.static_len-=a[2*m+1]);for(i.max_code=g,h=s.heap_len>>1;h>=1;h--)VC(s,r,h);m=d;do{h=s.heap[1],s.heap[1]=s.heap[s.heap_len--],VC(s,r,1),p=s.heap[1],s.heap[--s.heap_max]=h,s.heap[--s.heap_max]=p,r[2*m]=r[2*h]+r[2*p],s.depth[m]=(s.depth[h]>=s.depth[p]?s.depth[h]:s.depth[p])+1,r[2*h+1]=r[2*p+1]=m,s.heap[1]=m++,VC(s,r,1)}while(s.heap_len>=2);s.heap[--s.heap_max]=s.heap[1],((E,y)=>{const b=y.dyn_tree,T=y.max_code,O=y.stat_desc.static_tree,P=y.stat_desc.has_stree,D=y.stat_desc.extra_bits,L=y.stat_desc.extra_base,B=y.stat_desc.max_length;let V,Q,se,K,ee,$,Y=0;for(K=0;K<=15;K++)E.bl_count[K]=0;for(b[2*E.heap[E.heap_max]+1]=0,V=E.heap_max+1;V<573;V++)Q=E.heap[V],K=b[2*b[2*Q+1]+1]+1,K>B&&(K=B,Y++),b[2*Q+1]=K,Q>T||(E.bl_count[K]++,ee=0,Q>=L&&(ee=D[Q-L]),$=b[2*Q],E.opt_len+=$*(K+ee),P&&(E.static_len+=$*(O[2*Q+1]+ee)));if(0!==Y){do{for(K=B-1;0===E.bl_count[K];)K--;E.bl_count[K]--,E.bl_count[K+1]+=2,E.bl_count[B]--,Y-=2}while(Y>0);for(K=B;0!==K;K--)for(Q=E.bl_count[K];0!==Q;)se=E.heap[--V],se>T||(b[2*se+1]!==K&&(E.opt_len+=(K-b[2*se+1])*b[2*se],b[2*se+1]=K),Q--)}})(s,i),IO(r,g,s.bl_count)},WE=(s,i,r)=>{let a,l,d=-1,h=i[1],p=0,m=7,g=4;for(0===h&&(m=138,g=3),i[2*(r+1)+1]=65535,a=0;a<=r;a++)l=h,h=i[2*(a+1)+1],++p<m&&l===h||(p<g?s.bl_tree[2*l]+=p:0!==l?(l!==d&&s.bl_tree[2*l]++,s.bl_tree[32]++):p<=10?s.bl_tree[34]++:s.bl_tree[36]++,p=0,d=l,0===h?(m=138,g=3):l===h?(m=6,g=3):(m=7,g=4))},NO=(s,i,r)=>{let a,l,d=-1,h=i[1],p=0,m=7,g=4;for(0===h&&(m=138,g=3),a=0;a<=r;a++)if(l=h,h=i[2*(a+1)+1],!(++p<m&&l===h)){if(p<g)do{Va(s,l,s.bl_tree)}while(0!=--p);else 0!==l?(l!==d&&(Va(s,l,s.bl_tree),p--),Va(s,16,s.bl_tree),To(s,p-3,2)):p<=10?(Va(s,17,s.bl_tree),To(s,p-3,3)):(Va(s,18,s.bl_tree),To(s,p-11,7));p=0,d=l,0===h?(m=138,g=3):l===h?(m=6,g=3):(m=7,g=4)}};let PO=!1;const BC=(s,i,r,a)=>{To(s,0+(a?1:0),3),AO(s),Pd(s,r),Pd(s,~r),r&&s.pending_buf.set(s.window.subarray(i,i+r),s.pending),s.pending+=r};var MO={_tr_init:s=>{PO||((()=>{let i,r,a,l,d;const h=new Array(16);for(a=0,l=0;l<28;l++)for(Od[l]=a,i=0;i<1<<EO[l];i++)Kf[a++]=l;for(Kf[a-1]=l,d=0,l=0;l<16;l++)for(Nd[l]=d,i=0;i<1<<jE[l];i++)HE[d++]=l;for(d>>=7;l<30;l++)for(Nd[l]=d<<7,i=0;i<1<<jE[l]-7;i++)HE[256+d++]=l;for(r=0;r<=15;r++)h[r]=0;for(i=0;i<=143;)Ua[2*i+1]=8,i++,h[8]++;for(;i<=255;)Ua[2*i+1]=9,i++,h[9]++;for(;i<=279;)Ua[2*i+1]=7,i++,h[7]++;for(;i<=287;)Ua[2*i+1]=8,i++,h[8]++;for(IO(Ua,287,h),i=0;i<30;i++)qf[2*i+1]=5,qf[2*i]=wO(i,5);bO=new FC(Ua,EO,257,286,15),SO=new FC(qf,jE,0,30,15),CO=new FC(new Array(0),vO,0,19,7)})(),PO=!0),s.l_desc=new UC(s.dyn_ltree,bO),s.d_desc=new UC(s.dyn_dtree,SO),s.bl_desc=new UC(s.bl_tree,CO),s.bi_buf=0,s.bi_valid=0,RO(s)},_tr_stored_block:BC,_tr_flush_block:(s,i,r,a)=>{let l,d,h=0;s.level>0?(2===s.strm.data_type&&(s.strm.data_type=(p=>{let m,g=4093624447;for(m=0;m<=31;m++,g>>>=1)if(1&g&&0!==p.dyn_ltree[2*m])return 0;if(0!==p.dyn_ltree[18]||0!==p.dyn_ltree[20]||0!==p.dyn_ltree[26])return 1;for(m=32;m<256;m++)if(0!==p.dyn_ltree[2*m])return 1;return 0})(s)),GE(s,s.l_desc),GE(s,s.d_desc),h=(p=>{let m;for(WE(p,p.dyn_ltree,p.l_desc.max_code),WE(p,p.dyn_dtree,p.d_desc.max_code),GE(p,p.bl_desc),m=18;m>=3&&0===p.bl_tree[2*yO[m]+1];m--);return p.opt_len+=3*(m+1)+5+5+4,m})(s),l=s.opt_len+3+7>>>3,d=s.static_len+3+7>>>3,d<=l&&(l=d)):l=d=r+5,r+4<=l&&-1!==i?BC(s,i,r,a):4===s.strategy||d===l?(To(s,2+(a?1:0),3),OO(s,Ua,qf)):(To(s,4+(a?1:0),3),((p,m,g,E)=>{let y;for(To(p,m-257,5),To(p,g-1,5),To(p,E-4,4),y=0;y<E;y++)To(p,p.bl_tree[2*yO[y]+1],3);NO(p,p.dyn_ltree,m-1),NO(p,p.dyn_dtree,g-1)})(s,s.l_desc.max_code+1,s.d_desc.max_code+1,h+1),OO(s,s.dyn_ltree,s.dyn_dtree)),RO(s),a&&AO(s)},_tr_tally:(s,i,r)=>(s.pending_buf[s.sym_buf+s.sym_next++]=i,s.pending_buf[s.sym_buf+s.sym_next++]=i>>8,s.pending_buf[s.sym_buf+s.sym_next++]=r,0===i?s.dyn_ltree[2*r]++:(s.matches++,i--,s.dyn_ltree[2*(Kf[r]+256+1)]++,s.dyn_dtree[2*TO(i)]++),s.sym_next===s.sym_end),_tr_align:s=>{var i;To(s,2,3),Va(s,256,Ua),16===(i=s).bi_valid?(Pd(i,i.bi_buf),i.bi_buf=0,i.bi_valid=0):i.bi_valid>=8&&(i.pending_buf[i.pending++]=255&i.bi_buf,i.bi_buf>>=8,i.bi_valid-=8)}},Cl=(s,i,r,a)=>{let l=65535&s|0,d=s>>>16&65535|0,h=0;for(;0!==r;){h=r>2e3?2e3:r,r-=h;do{l=l+i[a++]|0,d=d+l|0}while(--h);l%=65521,d%=65521}return l|d<<16|0};const jC=new Uint32Array((()=>{let s,i=[];for(var r=0;r<256;r++){s=r;for(var a=0;a<8;a++)s=1&s?3988292384^s>>>1:s>>>1;i[r]=s}return i})());var ji=(s,i,r,a)=>{const l=jC,d=a+r;s^=-1;for(let h=a;h<d;h++)s=s>>>8^l[255&(s^i[h])];return-1^s},xd={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Tl={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:wl,_tr_stored_block:zE,_tr_flush_block:HC,_tr_tally:Ba,_tr_align:ML}=MO,{Z_NO_FLUSH:Md,Z_PARTIAL_FLUSH:kO,Z_FULL_FLUSH:kL,Z_FINISH:ts,Z_BLOCK:LO,Z_OK:Sr,Z_STREAM_END:GC,Z_STREAM_ERROR:Ec,Z_DATA_ERROR:FO,Z_BUF_ERROR:WC,Z_DEFAULT_COMPRESSION:UO,Z_FILTERED:E3,Z_HUFFMAN_ONLY:Th,Z_RLE:VO,Z_FIXED:BO,Z_DEFAULT_STRATEGY:LL,Z_UNKNOWN:jO,Z_DEFLATED:Yf}=Tl,vc=262,wh=(s,i)=>(s.msg=xd[i],i),UL=s=>2*s-(s>4?9:0),Ud=s=>{let i=s.length;for(;--i>=0;)s[i]=0},WO=s=>{let i,r,a,l=s.w_size;i=s.hash_size,a=i;do{r=s.head[--a],s.head[a]=r>=l?r-l:0}while(--i);i=l,a=i;do{r=s.prev[--a],s.prev[a]=r>=l?r-l:0}while(--i)};let rr=(s,i,r)=>(i<<s.hash_shift^r)&s.hash_mask;const ns=s=>{const i=s.state;let r=i.pending;r>s.avail_out&&(r=s.avail_out),0!==r&&(s.output.set(i.pending_buf.subarray(i.pending_out,i.pending_out+r),s.next_out),s.next_out+=r,i.pending_out+=r,s.total_out+=r,s.avail_out-=r,i.pending-=r,0===i.pending&&(i.pending_out=0))},is=(s,i)=>{HC(s,s.block_start>=0?s.block_start:-1,s.strstart-s.block_start,i),s.block_start=s.strstart,ns(s.strm)},vn=(s,i)=>{s.pending_buf[s.pending++]=i},YE=(s,i)=>{s.pending_buf[s.pending++]=i>>>8&255,s.pending_buf[s.pending++]=255&i},zO=(s,i,r,a)=>{let l=s.avail_in;return l>a&&(l=a),0===l?0:(s.avail_in-=l,i.set(s.input.subarray(s.next_in,s.next_in+l),r),1===s.state.wrap?s.adler=Cl(s.adler,i,l,r):2===s.state.wrap&&(s.adler=ji(s.adler,i,l,r)),s.next_in+=l,s.total_in+=l,l)},VL=(s,i)=>{let r,a,l=s.max_chain_length,d=s.strstart,h=s.prev_length,p=s.nice_match;const m=s.strstart>s.w_size-vc?s.strstart-(s.w_size-vc):0,g=s.window,E=s.w_mask,y=s.prev,b=s.strstart+258;let T=g[d+h-1],O=g[d+h];s.prev_length>=s.good_match&&(l>>=2),p>s.lookahead&&(p=s.lookahead);do{if(r=i,g[r+h]===O&&g[r+h-1]===T&&g[r]===g[d]&&g[++r]===g[d+1]){d+=2,r++;do{}while(g[++d]===g[++r]&&g[++d]===g[++r]&&g[++d]===g[++r]&&g[++d]===g[++r]&&g[++d]===g[++r]&&g[++d]===g[++r]&&g[++d]===g[++r]&&g[++d]===g[++r]&&d<b);if(a=258-(b-d),d=b-258,a>h){if(s.match_start=i,h=a,a>=p)break;T=g[d+h-1],O=g[d+h]}}}while((i=y[i&E])>m&&0!=--l);return h<=s.lookahead?h:s.lookahead},$f=s=>{const i=s.w_size;let r,a,l;do{if(a=s.window_size-s.lookahead-s.strstart,s.strstart>=i+(i-vc)&&(s.window.set(s.window.subarray(i,i+i-a),0),s.match_start-=i,s.strstart-=i,s.block_start-=i,s.insert>s.strstart&&(s.insert=s.strstart),WO(s),a+=i),0===s.strm.avail_in)break;if(r=zO(s.strm,s.window,s.strstart+s.lookahead,a),s.lookahead+=r,s.lookahead+s.insert>=3)for(l=s.strstart-s.insert,s.ins_h=s.window[l],s.ins_h=rr(s,s.ins_h,s.window[l+1]);s.insert&&(s.ins_h=rr(s,s.ins_h,s.window[l+3-1]),s.prev[l&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=l,l++,s.insert--,!(s.lookahead+s.insert<3)););}while(s.lookahead<vc&&0!==s.strm.avail_in)},qO=(s,i)=>{let r,a,l,d=s.pending_buf_size-5>s.w_size?s.w_size:s.pending_buf_size-5,h=0,p=s.strm.avail_in;do{if(r=65535,l=s.bi_valid+42>>3,s.strm.avail_out<l||(l=s.strm.avail_out-l,a=s.strstart-s.block_start,r>a+s.strm.avail_in&&(r=a+s.strm.avail_in),r>l&&(r=l),r<d&&(0===r&&i!==ts||i===Md||r!==a+s.strm.avail_in)))break;h=i===ts&&r===a+s.strm.avail_in?1:0,zE(s,0,0,h),s.pending_buf[s.pending-4]=r,s.pending_buf[s.pending-3]=r>>8,s.pending_buf[s.pending-2]=~r,s.pending_buf[s.pending-1]=~r>>8,ns(s.strm),a&&(a>r&&(a=r),s.strm.output.set(s.window.subarray(s.block_start,s.block_start+a),s.strm.next_out),s.strm.next_out+=a,s.strm.avail_out-=a,s.strm.total_out+=a,s.block_start+=a,r-=a),r&&(zO(s.strm,s.strm.output,s.strm.next_out,r),s.strm.next_out+=r,s.strm.avail_out-=r,s.strm.total_out+=r)}while(0===h);return p-=s.strm.avail_in,p&&(p>=s.w_size?(s.matches=2,s.window.set(s.strm.input.subarray(s.strm.next_in-s.w_size,s.strm.next_in),0),s.strstart=s.w_size,s.insert=s.strstart):(s.window_size-s.strstart<=p&&(s.strstart-=s.w_size,s.window.set(s.window.subarray(s.w_size,s.w_size+s.strstart),0),s.matches<2&&s.matches++,s.insert>s.strstart&&(s.insert=s.strstart)),s.window.set(s.strm.input.subarray(s.strm.next_in-p,s.strm.next_in),s.strstart),s.strstart+=p,s.insert+=p>s.w_size-s.insert?s.w_size-s.insert:p),s.block_start=s.strstart),s.high_water<s.strstart&&(s.high_water=s.strstart),h?4:i!==Md&&i!==ts&&0===s.strm.avail_in&&s.strstart===s.block_start?2:(l=s.window_size-s.strstart,s.strm.avail_in>l&&s.block_start>=s.w_size&&(s.block_start-=s.w_size,s.strstart-=s.w_size,s.window.set(s.window.subarray(s.w_size,s.w_size+s.strstart),0),s.matches<2&&s.matches++,l+=s.w_size,s.insert>s.strstart&&(s.insert=s.strstart)),l>s.strm.avail_in&&(l=s.strm.avail_in),l&&(zO(s.strm,s.window,s.strstart,l),s.strstart+=l,s.insert+=l>s.w_size-s.insert?s.w_size-s.insert:l),s.high_water<s.strstart&&(s.high_water=s.strstart),l=s.bi_valid+42>>3,l=s.pending_buf_size-l>65535?65535:s.pending_buf_size-l,d=l>s.w_size?s.w_size:l,a=s.strstart-s.block_start,(a>=d||(a||i===ts)&&i!==Md&&0===s.strm.avail_in&&a<=l)&&(r=a>l?l:a,h=i===ts&&0===s.strm.avail_in&&r===a?1:0,zE(s,s.block_start,r,h),s.block_start+=r,ns(s.strm)),h?3:1)},Ih=(s,i)=>{let r,a;for(;;){if(s.lookahead<vc){if($f(s),s.lookahead<vc&&i===Md)return 1;if(0===s.lookahead)break}if(r=0,s.lookahead>=3&&(s.ins_h=rr(s,s.ins_h,s.window[s.strstart+3-1]),r=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),0!==r&&s.strstart-r<=s.w_size-vc&&(s.match_length=VL(s,r)),s.match_length>=3)if(a=Ba(s,s.strstart-s.match_start,s.match_length-3),s.lookahead-=s.match_length,s.match_length<=s.max_lazy_match&&s.lookahead>=3){s.match_length--;do{s.strstart++,s.ins_h=rr(s,s.ins_h,s.window[s.strstart+3-1]),r=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart}while(0!=--s.match_length);s.strstart++}else s.strstart+=s.match_length,s.match_length=0,s.ins_h=s.window[s.strstart],s.ins_h=rr(s,s.ins_h,s.window[s.strstart+1]);else a=Ba(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++;if(a&&(is(s,!1),0===s.strm.avail_out))return 1}return s.insert=s.strstart<2?s.strstart:2,i===ts?(is(s,!0),0===s.strm.avail_out?3:4):s.sym_next&&(is(s,!1),0===s.strm.avail_out)?1:2},Rh=(s,i)=>{let r,a,l;for(;;){if(s.lookahead<vc){if($f(s),s.lookahead<vc&&i===Md)return 1;if(0===s.lookahead)break}if(r=0,s.lookahead>=3&&(s.ins_h=rr(s,s.ins_h,s.window[s.strstart+3-1]),r=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),s.prev_length=s.match_length,s.prev_match=s.match_start,s.match_length=2,0!==r&&s.prev_length<s.max_lazy_match&&s.strstart-r<=s.w_size-vc&&(s.match_length=VL(s,r),s.match_length<=5&&(s.strategy===E3||3===s.match_length&&s.strstart-s.match_start>4096)&&(s.match_length=2)),s.prev_length>=3&&s.match_length<=s.prev_length){l=s.strstart+s.lookahead-3,a=Ba(s,s.strstart-1-s.prev_match,s.prev_length-3),s.lookahead-=s.prev_length-1,s.prev_length-=2;do{++s.strstart<=l&&(s.ins_h=rr(s,s.ins_h,s.window[s.strstart+3-1]),r=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart)}while(0!=--s.prev_length);if(s.match_available=0,s.match_length=2,s.strstart++,a&&(is(s,!1),0===s.strm.avail_out))return 1}else if(s.match_available){if(a=Ba(s,0,s.window[s.strstart-1]),a&&is(s,!1),s.strstart++,s.lookahead--,0===s.strm.avail_out)return 1}else s.match_available=1,s.strstart++,s.lookahead--}return s.match_available&&(a=Ba(s,0,s.window[s.strstart-1]),s.match_available=0),s.insert=s.strstart<2?s.strstart:2,i===ts?(is(s,!0),0===s.strm.avail_out?3:4):s.sym_next&&(is(s,!1),0===s.strm.avail_out)?1:2};function ja(s,i,r,a,l){this.good_length=s,this.max_lazy=i,this.nice_length=r,this.max_chain=a,this.func=l}const Ah=[new ja(0,0,0,0,qO),new ja(4,4,8,4,Ih),new ja(4,5,16,8,Ih),new ja(4,6,32,32,Ih),new ja(4,4,16,16,Rh),new ja(8,16,32,32,Rh),new ja(8,16,128,128,Rh),new ja(8,32,128,256,Rh),new ja(32,128,258,1024,Rh),new ja(32,258,258,4096,Rh)];function Vd(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Yf,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Ud(this.dyn_ltree),Ud(this.dyn_dtree),Ud(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Ud(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Ud(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Dh=s=>{if(!s)return 1;const i=s.state;return!i||i.strm!==s||42!==i.status&&57!==i.status&&69!==i.status&&73!==i.status&&91!==i.status&&103!==i.status&&113!==i.status&&666!==i.status?1:0},$E=s=>{if(Dh(s))return wh(s,Ec);s.total_in=s.total_out=0,s.data_type=jO;const i=s.state;return i.pending=0,i.pending_out=0,i.wrap<0&&(i.wrap=-i.wrap),i.status=2===i.wrap?57:i.wrap?42:113,s.adler=2===i.wrap?0:1,i.last_flush=-2,wl(i),Sr},XE=s=>{const i=$E(s);var r;return i===Sr&&((r=s.state).window_size=2*r.w_size,Ud(r.head),r.max_lazy_match=Ah[r.level].max_lazy,r.good_match=Ah[r.level].good_length,r.nice_match=Ah[r.level].nice_length,r.max_chain_length=Ah[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0),i},KO=(s,i,r,a,l,d)=>{if(!s)return Ec;let h=1;if(i===UO&&(i=6),a<0?(h=0,a=-a):a>15&&(h=2,a-=16),l<1||l>9||r!==Yf||a<8||a>15||i<0||i>9||d<0||d>BO||8===a&&1!==h)return wh(s,Ec);8===a&&(a=9);const p=new Vd;return s.state=p,p.strm=s,p.status=42,p.wrap=h,p.gzhead=null,p.w_bits=a,p.w_size=1<<p.w_bits,p.w_mask=p.w_size-1,p.hash_bits=l+7,p.hash_size=1<<p.hash_bits,p.hash_mask=p.hash_size-1,p.hash_shift=~~((p.hash_bits+3-1)/3),p.window=new Uint8Array(2*p.w_size),p.head=new Uint16Array(p.hash_size),p.prev=new Uint16Array(p.w_size),p.lit_bufsize=1<<l+6,p.pending_buf_size=4*p.lit_bufsize,p.pending_buf=new Uint8Array(p.pending_buf_size),p.sym_buf=p.lit_bufsize,p.sym_end=3*(p.lit_bufsize-1),p.level=i,p.strategy=d,p.method=r,XE(s)};var Il={deflateInit:(s,i)=>KO(s,i,Yf,15,8,LL),deflateInit2:KO,deflateReset:XE,deflateResetKeep:$E,deflateSetHeader:(s,i)=>Dh(s)||2!==s.state.wrap?Ec:(s.state.gzhead=i,Sr),deflate:(s,i)=>{if(Dh(s)||i>LO||i<0)return s?wh(s,Ec):Ec;const r=s.state;if(!s.output||0!==s.avail_in&&!s.input||666===r.status&&i!==ts)return wh(s,0===s.avail_out?WC:Ec);const a=r.last_flush;if(r.last_flush=i,0!==r.pending){if(ns(s),0===s.avail_out)return r.last_flush=-1,Sr}else if(0===s.avail_in&&UL(i)<=UL(a)&&i!==ts)return wh(s,WC);if(666===r.status&&0!==s.avail_in)return wh(s,WC);if(42===r.status&&0===r.wrap&&(r.status=113),42===r.status){let l=Yf+(r.w_bits-8<<4)<<8,d=-1;if(d=r.strategy>=Th||r.level<2?0:r.level<6?1:6===r.level?2:3,l|=d<<6,0!==r.strstart&&(l|=32),l+=31-l%31,YE(r,l),0!==r.strstart&&(YE(r,s.adler>>>16),YE(r,65535&s.adler)),s.adler=1,r.status=113,ns(s),0!==r.pending)return r.last_flush=-1,Sr}if(57===r.status)if(s.adler=0,vn(r,31),vn(r,139),vn(r,8),r.gzhead)vn(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),vn(r,255&r.gzhead.time),vn(r,r.gzhead.time>>8&255),vn(r,r.gzhead.time>>16&255),vn(r,r.gzhead.time>>24&255),vn(r,9===r.level?2:r.strategy>=Th||r.level<2?4:0),vn(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(vn(r,255&r.gzhead.extra.length),vn(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(s.adler=ji(s.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(vn(r,0),vn(r,0),vn(r,0),vn(r,0),vn(r,0),vn(r,9===r.level?2:r.strategy>=Th||r.level<2?4:0),vn(r,3),r.status=113,ns(s),0!==r.pending)return r.last_flush=-1,Sr;if(69===r.status){if(r.gzhead.extra){let l=r.pending,d=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+d>r.pending_buf_size;){let p=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+p),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>l&&(s.adler=ji(s.adler,r.pending_buf,r.pending-l,l)),r.gzindex+=p,ns(s),0!==r.pending)return r.last_flush=-1,Sr;l=0,d-=p}let h=new Uint8Array(r.gzhead.extra);r.pending_buf.set(h.subarray(r.gzindex,r.gzindex+d),r.pending),r.pending+=d,r.gzhead.hcrc&&r.pending>l&&(s.adler=ji(s.adler,r.pending_buf,r.pending-l,l)),r.gzindex=0}r.status=73}if(73===r.status){if(r.gzhead.name){let l,d=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>d&&(s.adler=ji(s.adler,r.pending_buf,r.pending-d,d)),ns(s),0!==r.pending)return r.last_flush=-1,Sr;d=0}l=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,vn(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>d&&(s.adler=ji(s.adler,r.pending_buf,r.pending-d,d)),r.gzindex=0}r.status=91}if(91===r.status){if(r.gzhead.comment){let l,d=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>d&&(s.adler=ji(s.adler,r.pending_buf,r.pending-d,d)),ns(s),0!==r.pending)return r.last_flush=-1,Sr;d=0}l=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,vn(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>d&&(s.adler=ji(s.adler,r.pending_buf,r.pending-d,d))}r.status=103}if(103===r.status){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(ns(s),0!==r.pending))return r.last_flush=-1,Sr;vn(r,255&s.adler),vn(r,s.adler>>8&255),s.adler=0}if(r.status=113,ns(s),0!==r.pending)return r.last_flush=-1,Sr}if(0!==s.avail_in||0!==r.lookahead||i!==Md&&666!==r.status){let l=0===r.level?qO(r,i):r.strategy===Th?((d,h)=>{let p;for(;;){if(0===d.lookahead&&($f(d),0===d.lookahead)){if(h===Md)return 1;break}if(d.match_length=0,p=Ba(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,p&&(is(d,!1),0===d.strm.avail_out))return 1}return d.insert=0,h===ts?(is(d,!0),0===d.strm.avail_out?3:4):d.sym_next&&(is(d,!1),0===d.strm.avail_out)?1:2})(r,i):r.strategy===VO?((d,h)=>{let p,m,g,E;const y=d.window;for(;;){if(d.lookahead<=258){if($f(d),d.lookahead<=258&&h===Md)return 1;if(0===d.lookahead)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(g=d.strstart-1,m=y[g],m===y[++g]&&m===y[++g]&&m===y[++g])){E=d.strstart+258;do{}while(m===y[++g]&&m===y[++g]&&m===y[++g]&&m===y[++g]&&m===y[++g]&&m===y[++g]&&m===y[++g]&&m===y[++g]&&g<E);d.match_length=258-(E-g),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(p=Ba(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(p=Ba(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),p&&(is(d,!1),0===d.strm.avail_out))return 1}return d.insert=0,h===ts?(is(d,!0),0===d.strm.avail_out?3:4):d.sym_next&&(is(d,!1),0===d.strm.avail_out)?1:2})(r,i):Ah[r.level].func(r,i);if(3!==l&&4!==l||(r.status=666),1===l||3===l)return 0===s.avail_out&&(r.last_flush=-1),Sr;if(2===l&&(i===kO?ML(r):i!==LO&&(zE(r,0,0,!1),i===kL&&(Ud(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),ns(s),0===s.avail_out))return r.last_flush=-1,Sr}return i!==ts?Sr:r.wrap<=0?GC:(2===r.wrap?(vn(r,255&s.adler),vn(r,s.adler>>8&255),vn(r,s.adler>>16&255),vn(r,s.adler>>24&255),vn(r,255&s.total_in),vn(r,s.total_in>>8&255),vn(r,s.total_in>>16&255),vn(r,s.total_in>>24&255)):(YE(r,s.adler>>>16),YE(r,65535&s.adler)),ns(s),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?Sr:GC)},deflateEnd:s=>{if(Dh(s))return Ec;const i=s.state.status;return s.state=null,113===i?wh(s,FO):Sr},deflateSetDictionary:(s,i)=>{let r=i.length;if(Dh(s))return Ec;const a=s.state,l=a.wrap;if(2===l||1===l&&42!==a.status||a.lookahead)return Ec;if(1===l&&(s.adler=Cl(s.adler,i,r,0)),a.wrap=0,r>=a.w_size){0===l&&(Ud(a.head),a.strstart=0,a.block_start=0,a.insert=0);let m=new Uint8Array(a.w_size);m.set(i.subarray(r-a.w_size,r),0),i=m,r=a.w_size}const d=s.avail_in,h=s.next_in,p=s.input;for(s.avail_in=r,s.next_in=0,s.input=i,$f(a);a.lookahead>=3;){let m=a.strstart,g=a.lookahead-2;do{a.ins_h=rr(a,a.ins_h,a.window[m+3-1]),a.prev[m&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=m,m++}while(--g);a.strstart=m,a.lookahead=2,$f(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,s.next_in=h,s.input=p,s.avail_in=d,a.wrap=l,Sr},deflateInfo:"pako deflate (from Nodeca project)"};const v3=(s,i)=>Object.prototype.hasOwnProperty.call(s,i);var KC={assign:function(s){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const r=i.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const a in r)v3(r,a)&&(s[a]=r[a])}}return s},flattenChunks:s=>{let i=0;for(let a=0,l=s.length;a<l;a++)i+=s[a].length;const r=new Uint8Array(i);for(let a=0,l=0,d=s.length;a<d;a++){let h=s[a];r.set(h,l),l+=h.length}return r}};let BL=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{BL=!1}const Oh=new Uint8Array(256);for(let s=0;s<256;s++)Oh[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;Oh[254]=Oh[254]=1;var Xf={string2buf:s=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(s);let i,r,a,l,d,h=s.length,p=0;for(l=0;l<h;l++)r=s.charCodeAt(l),55296==(64512&r)&&l+1<h&&(a=s.charCodeAt(l+1),56320==(64512&a)&&(r=65536+(r-55296<<10)+(a-56320),l++)),p+=r<128?1:r<2048?2:r<65536?3:4;for(i=new Uint8Array(p),d=0,l=0;d<p;l++)r=s.charCodeAt(l),55296==(64512&r)&&l+1<h&&(a=s.charCodeAt(l+1),56320==(64512&a)&&(r=65536+(r-55296<<10)+(a-56320),l++)),r<128?i[d++]=r:r<2048?(i[d++]=192|r>>>6,i[d++]=128|63&r):r<65536?(i[d++]=224|r>>>12,i[d++]=128|r>>>6&63,i[d++]=128|63&r):(i[d++]=240|r>>>18,i[d++]=128|r>>>12&63,i[d++]=128|r>>>6&63,i[d++]=128|63&r);return i},buf2string:(s,i)=>{const r=i||s.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(s.subarray(0,i));let a,l;const d=new Array(2*r);for(l=0,a=0;a<r;){let h=s[a++];if(h<128){d[l++]=h;continue}let p=Oh[h];if(p>4)d[l++]=65533,a+=p-1;else{for(h&=2===p?31:3===p?15:7;p>1&&a<r;)h=h<<6|63&s[a++],p--;p>1?d[l++]=65533:h<65536?d[l++]=h:(h-=65536,d[l++]=55296|h>>10&1023,d[l++]=56320|1023&h)}}return((h,p)=>{if(p<65534&&h.subarray&&BL)return String.fromCharCode.apply(null,h.length===p?h:h.subarray(0,p));let m="";for(let g=0;g<p;g++)m+=String.fromCharCode(h[g]);return m})(d,l)},utf8border:(s,i)=>{(i=i||s.length)>s.length&&(i=s.length);let r=i-1;for(;r>=0&&128==(192&s[r]);)r--;return r<0||0===r?i:r+Oh[s[r]]>i?r:i}},YO=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const $O=Object.prototype.toString,{Z_NO_FLUSH:jL,Z_SYNC_FLUSH:XO,Z_FULL_FLUSH:JO,Z_FINISH:QO,Z_OK:JE,Z_STREAM_END:HL,Z_DEFAULT_COMPRESSION:ZO,Z_DEFAULT_STRATEGY:QE,Z_DEFLATED:y3}=Tl;function Nh(s){this.options=KC.assign({level:ZO,method:y3,chunkSize:16384,windowBits:15,memLevel:8,strategy:QE},s||{});let i=this.options;i.raw&&i.windowBits>0?i.windowBits=-i.windowBits:i.gzip&&i.windowBits>0&&i.windowBits<16&&(i.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new YO,this.strm.avail_out=0;let r=Il.deflateInit2(this.strm,i.level,i.method,i.windowBits,i.memLevel,i.strategy);if(r!==JE)throw new Error(xd[r]);if(i.header&&Il.deflateSetHeader(this.strm,i.header),i.dictionary){let a;if(a="string"==typeof i.dictionary?Xf.string2buf(i.dictionary):"[object ArrayBuffer]"===$O.call(i.dictionary)?new Uint8Array(i.dictionary):i.dictionary,r=Il.deflateSetDictionary(this.strm,a),r!==JE)throw new Error(xd[r]);this._dict_set=!0}}function Bd(s,i){const r=new Nh(i);if(r.push(s,!0),r.err)throw r.msg||xd[r.err];return r.result}Nh.prototype.push=function(s,i){const r=this.strm,a=this.options.chunkSize;let l,d;if(this.ended)return!1;for(d=i===~~i?i:!0===i?QO:jL,r.input="string"==typeof s?Xf.string2buf(s):"[object ArrayBuffer]"===$O.call(s)?new Uint8Array(s):s,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(a),r.next_out=0,r.avail_out=a),(d===XO||d===JO)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(l=Il.deflate(r,d),l===HL)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),l=Il.deflateEnd(this.strm),this.onEnd(l),this.ended=!0,l===JE;if(0!==r.avail_out){if(d>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},Nh.prototype.onData=function(s){this.chunks.push(s)},Nh.prototype.onEnd=function(s){s===JE&&(this.result=KC.flattenChunks(this.chunks)),this.chunks=[],this.err=s,this.msg=this.strm.msg};var GL={Deflate:Nh,deflate:Bd,deflateRaw:function(s,i){return(i=i||{}).raw=!0,Bd(s,i)},gzip:function(s,i){return(i=i||{}).gzip=!0,Bd(s,i)},constants:Tl};const ZE=16209;var b3=function(s,i){let r,a,l,d,h,p,m,g,E,y,b,T,O,P,D,L,B,V,Q,se,K,ee,$,Y;const _e=s.state;r=s.next_in,$=s.input,a=r+(s.avail_in-5),l=s.next_out,Y=s.output,d=l-(i-s.avail_out),h=l+(s.avail_out-257),p=_e.dmax,m=_e.wsize,g=_e.whave,E=_e.wnext,y=_e.window,b=_e.hold,T=_e.bits,O=_e.lencode,P=_e.distcode,D=(1<<_e.lenbits)-1,L=(1<<_e.distbits)-1;e:do{T<15&&(b+=$[r++]<<T,T+=8,b+=$[r++]<<T,T+=8),B=O[b&D];t:for(;;){if(V=B>>>24,b>>>=V,T-=V,V=B>>>16&255,0===V)Y[l++]=65535&B;else{if(!(16&V)){if(!(64&V)){B=O[(65535&B)+(b&(1<<V)-1)];continue t}if(32&V){_e.mode=16191;break e}s.msg="invalid literal/length code",_e.mode=ZE;break e}Q=65535&B,V&=15,V&&(T<V&&(b+=$[r++]<<T,T+=8),Q+=b&(1<<V)-1,b>>>=V,T-=V),T<15&&(b+=$[r++]<<T,T+=8,b+=$[r++]<<T,T+=8),B=P[b&L];n:for(;;){if(V=B>>>24,b>>>=V,T-=V,V=B>>>16&255,!(16&V)){if(!(64&V)){B=P[(65535&B)+(b&(1<<V)-1)];continue n}s.msg="invalid distance code",_e.mode=ZE;break e}if(se=65535&B,V&=15,T<V&&(b+=$[r++]<<T,T+=8,T<V&&(b+=$[r++]<<T,T+=8)),se+=b&(1<<V)-1,se>p){s.msg="invalid distance too far back",_e.mode=ZE;break e}if(b>>>=V,T-=V,V=l-d,se>V){if(V=se-V,V>g&&_e.sane){s.msg="invalid distance too far back",_e.mode=ZE;break e}if(K=0,ee=y,0===E){if(K+=m-V,V<Q){Q-=V;do{Y[l++]=y[K++]}while(--V);K=l-se,ee=Y}}else if(E<V){if(K+=m+E-V,V-=E,V<Q){Q-=V;do{Y[l++]=y[K++]}while(--V);if(K=0,E<Q){V=E,Q-=V;do{Y[l++]=y[K++]}while(--V);K=l-se,ee=Y}}}else if(K+=E-V,V<Q){Q-=V;do{Y[l++]=y[K++]}while(--V);K=l-se,ee=Y}for(;Q>2;)Y[l++]=ee[K++],Y[l++]=ee[K++],Y[l++]=ee[K++],Q-=3;Q&&(Y[l++]=ee[K++],Q>1&&(Y[l++]=ee[K++]))}else{K=l-se;do{Y[l++]=Y[K++],Y[l++]=Y[K++],Y[l++]=Y[K++],Q-=3}while(Q>2);Q&&(Y[l++]=Y[K++],Q>1&&(Y[l++]=Y[K++]))}break}}break}}while(r<a&&l<h);Q=T>>3,r-=Q,T-=Q<<3,b&=(1<<T)-1,s.next_in=r,s.next_out=l,s.avail_in=r<a?a-r+5:5-(r-a),s.avail_out=l<h?h-l+257:257-(l-h),_e.hold=b,_e.bits=T};const WL=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),zL=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),qL=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),KL=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Ph=(s,i,r,a,l,d,h,p)=>{const m=p.bits;let g,E,y,b,T,O,P=0,D=0,L=0,B=0,V=0,Q=0,se=0,K=0,ee=0,$=0,Y=null;const _e=new Uint16Array(16),ve=new Uint16Array(16);let Ze,yt,xn,Ht=null;for(P=0;P<=15;P++)_e[P]=0;for(D=0;D<a;D++)_e[i[r+D]]++;for(V=m,B=15;B>=1&&0===_e[B];B--);if(V>B&&(V=B),0===B)return l[d++]=20971520,l[d++]=20971520,p.bits=1,0;for(L=1;L<B&&0===_e[L];L++);for(V<L&&(V=L),K=1,P=1;P<=15;P++)if(K<<=1,K-=_e[P],K<0)return-1;if(K>0&&(0===s||1!==B))return-1;for(ve[1]=0,P=1;P<15;P++)ve[P+1]=ve[P]+_e[P];for(D=0;D<a;D++)0!==i[r+D]&&(h[ve[i[r+D]]++]=D);if(0===s?(Y=Ht=h,O=20):1===s?(Y=WL,Ht=zL,O=257):(Y=qL,Ht=KL,O=0),$=0,D=0,P=L,T=d,Q=V,se=0,y=-1,ee=1<<V,b=ee-1,1===s&&ee>852||2===s&&ee>592)return 1;for(;;){Ze=P-se,h[D]+1<O?(yt=0,xn=h[D]):h[D]>=O?(yt=Ht[h[D]-O],xn=Y[h[D]-O]):(yt=96,xn=0),g=1<<P-se,E=1<<Q,L=E;do{E-=g,l[T+($>>se)+E]=Ze<<24|yt<<16|xn|0}while(0!==E);for(g=1<<P-1;$&g;)g>>=1;if(0!==g?($&=g-1,$+=g):$=0,D++,0==--_e[P]){if(P===B)break;P=i[r+h[D]]}if(P>V&&($&b)!==y){for(0===se&&(se=V),T+=L,Q=P-se,K=1<<Q;Q+se<B&&(K-=_e[Q+se],!(K<=0));)Q++,K<<=1;if(ee+=1<<Q,1===s&&ee>852||2===s&&ee>592)return 1;y=$&b,l[y]=V<<24|Q<<16|T-d|0}}return 0!==$&&(l[T+$]=P-se<<24|64<<16|0),p.bits=V,0};const{Z_FINISH:$C,Z_BLOCK:YL,Z_TREES:Jf,Z_OK:Rl,Z_STREAM_END:S3,Z_NEED_DICT:$L,Z_STREAM_ERROR:Io,Z_DATA_ERROR:XC,Z_MEM_ERROR:JC,Z_BUF_ERROR:XL,Z_DEFLATED:Qf}=Tl,ev=16180,tv=16190,Ha=16191,iv=16199,QC=16200,oi=16209,JL=s=>(s>>>24&255)+(s>>>8&65280)+((65280&s)<<8)+((255&s)<<24);function QL(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ts=s=>{if(!s)return 1;const i=s.state;return!i||i.strm!==s||i.mode<ev||i.mode>16211?1:0},ZL=s=>{if(Ts(s))return Io;const i=s.state;return s.total_in=s.total_out=i.total=0,s.msg="",i.wrap&&(s.adler=1&i.wrap),i.mode=ev,i.last=0,i.havedict=0,i.flags=-1,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Int32Array(852),i.distcode=i.distdyn=new Int32Array(592),i.sane=1,i.back=-1,Rl},e2=s=>{if(Ts(s))return Io;const i=s.state;return i.wsize=0,i.whave=0,i.wnext=0,ZL(s)},t2=(s,i)=>{let r;if(Ts(s))return Io;const a=s.state;return i<0?(r=0,i=-i):(r=5+(i>>4),i<48&&(i&=15)),i&&(i<8||i>15)?Io:(null!==a.window&&a.wbits!==i&&(a.window=null),a.wrap=r,a.wbits=i,e2(s))},n2=(s,i)=>{if(!s)return Io;const r=new QL;s.state=r,r.strm=s,r.window=null,r.mode=ev;const a=t2(s,i);return a!==Rl&&(s.state=null),a};let tN,e0,r2=!0;const C3=s=>{if(r2){tN=new Int32Array(512),e0=new Int32Array(32);let i=0;for(;i<144;)s.lens[i++]=8;for(;i<256;)s.lens[i++]=9;for(;i<280;)s.lens[i++]=7;for(;i<288;)s.lens[i++]=8;for(Ph(1,s.lens,0,288,tN,0,s.work,{bits:9}),i=0;i<32;)s.lens[i++]=5;Ph(2,s.lens,0,32,e0,0,s.work,{bits:5}),r2=!1}s.lencode=tN,s.lenbits=9,s.distcode=e0,s.distbits=5},o2=(s,i,r,a)=>{let l;const d=s.state;return null===d.window&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),a>=d.wsize?(d.window.set(i.subarray(r-d.wsize,r),0),d.wnext=0,d.whave=d.wsize):(l=d.wsize-d.wnext,l>a&&(l=a),d.window.set(i.subarray(r-a,r-a+l),d.wnext),(a-=l)?(d.window.set(i.subarray(r-a,r),0),d.wnext=a,d.whave=d.wsize):(d.wnext+=l,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=l))),0};var Al={inflateReset:e2,inflateReset2:t2,inflateResetKeep:ZL,inflateInit:s=>n2(s,15),inflateInit2:n2,inflate:(s,i)=>{let r,a,l,d,h,p,m,g,E,y,b,T,O,P,D,L,B,V,Q,se,K,ee,$=0;const Y=new Uint8Array(4);let _e,ve;const Ze=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ts(s)||!s.output||!s.input&&0!==s.avail_in)return Io;r=s.state,r.mode===Ha&&(r.mode=16192),h=s.next_out,l=s.output,m=s.avail_out,d=s.next_in,a=s.input,p=s.avail_in,g=r.hold,E=r.bits,y=p,b=m,ee=Rl;e:for(;;)switch(r.mode){case ev:if(0===r.wrap){r.mode=16192;break}for(;E<16;){if(0===p)break e;p--,g+=a[d++]<<E,E+=8}if(2&r.wrap&&35615===g){0===r.wbits&&(r.wbits=15),r.check=0,Y[0]=255&g,Y[1]=g>>>8&255,r.check=ji(r.check,Y,2,0),g=0,E=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&g)<<8)+(g>>8))%31){s.msg="incorrect header check",r.mode=oi;break}if((15&g)!==Qf){s.msg="unknown compression method",r.mode=oi;break}if(g>>>=4,E-=4,K=8+(15&g),0===r.wbits&&(r.wbits=K),K>15||K>r.wbits){s.msg="invalid window size",r.mode=oi;break}r.dmax=1<<r.wbits,r.flags=0,s.adler=r.check=1,r.mode=512&g?16189:Ha,g=0,E=0;break;case 16181:for(;E<16;){if(0===p)break e;p--,g+=a[d++]<<E,E+=8}if(r.flags=g,(255&r.flags)!==Qf){s.msg="unknown compression method",r.mode=oi;break}if(57344&r.flags){s.msg="unknown header flags set",r.mode=oi;break}r.head&&(r.head.text=g>>8&1),512&r.flags&&4&r.wrap&&(Y[0]=255&g,Y[1]=g>>>8&255,r.check=ji(r.check,Y,2,0)),g=0,E=0,r.mode=16182;case 16182:for(;E<32;){if(0===p)break e;p--,g+=a[d++]<<E,E+=8}r.head&&(r.head.time=g),512&r.flags&&4&r.wrap&&(Y[0]=255&g,Y[1]=g>>>8&255,Y[2]=g>>>16&255,Y[3]=g>>>24&255,r.check=ji(r.check,Y,4,0)),g=0,E=0,r.mode=16183;case 16183:for(;E<16;){if(0===p)break e;p--,g+=a[d++]<<E,E+=8}r.head&&(r.head.xflags=255&g,r.head.os=g>>8),512&r.flags&&4&r.wrap&&(Y[0]=255&g,Y[1]=g>>>8&255,r.check=ji(r.check,Y,2,0)),g=0,E=0,r.mode=16184;case 16184:if(1024&r.flags){for(;E<16;){if(0===p)break e;p--,g+=a[d++]<<E,E+=8}r.length=g,r.head&&(r.head.extra_len=g),512&r.flags&&4&r.wrap&&(Y[0]=255&g,Y[1]=g>>>8&255,r.check=ji(r.check,Y,2,0)),g=0,E=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&r.flags&&(T=r.length,T>p&&(T=p),T&&(r.head&&(K=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(a.subarray(d,d+T),K)),512&r.flags&&4&r.wrap&&(r.check=ji(r.check,a,T,d)),p-=T,d+=T,r.length-=T),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&r.flags){if(0===p)break e;T=0;do{K=a[d+T++],r.head&&K&&r.length<65536&&(r.head.name+=String.fromCharCode(K))}while(K&&T<p);if(512&r.flags&&4&r.wrap&&(r.check=ji(r.check,a,T,d)),p-=T,d+=T,K)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&r.flags){if(0===p)break e;T=0;do{K=a[d+T++],r.head&&K&&r.length<65536&&(r.head.comment+=String.fromCharCode(K))}while(K&&T<p);if(512&r.flags&&4&r.wrap&&(r.check=ji(r.check,a,T,d)),p-=T,d+=T,K)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&r.flags){for(;E<16;){if(0===p)break e;p--,g+=a[d++]<<E,E+=8}if(4&r.wrap&&g!==(65535&r.check)){s.msg="header crc mismatch",r.mode=oi;break}g=0,E=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),s.adler=r.check=0,r.mode=Ha;break;case 16189:for(;E<32;){if(0===p)break e;p--,g+=a[d++]<<E,E+=8}s.adler=r.check=JL(g),g=0,E=0,r.mode=tv;case tv:if(0===r.havedict)return s.next_out=h,s.avail_out=m,s.next_in=d,s.avail_in=p,r.hold=g,r.bits=E,$L;s.adler=r.check=1,r.mode=Ha;case Ha:if(i===YL||i===Jf)break e;case 16192:if(r.last){g>>>=7&E,E-=7&E,r.mode=16206;break}for(;E<3;){if(0===p)break e;p--,g+=a[d++]<<E,E+=8}switch(r.last=1&g,g>>>=1,E-=1,3&g){case 0:r.mode=16193;break;case 1:if(C3(r),r.mode=iv,i===Jf){g>>>=2,E-=2;break e}break;case 2:r.mode=16196;break;case 3:s.msg="invalid block type",r.mode=oi}g>>>=2,E-=2;break;case 16193:for(g>>>=7&E,E-=7&E;E<32;){if(0===p)break e;p--,g+=a[d++]<<E,E+=8}if((65535&g)!=(g>>>16^65535)){s.msg="invalid stored block lengths",r.mode=oi;break}if(r.length=65535&g,g=0,E=0,r.mode=16194,i===Jf)break e;case 16194:r.mode=16195;case 16195:if(T=r.length,T){if(T>p&&(T=p),T>m&&(T=m),0===T)break e;l.set(a.subarray(d,d+T),h),p-=T,d+=T,m-=T,h+=T,r.length-=T;break}r.mode=Ha;break;case 16196:for(;E<14;){if(0===p)break e;p--,g+=a[d++]<<E,E+=8}if(r.nlen=257+(31&g),g>>>=5,E-=5,r.ndist=1+(31&g),g>>>=5,E-=5,r.ncode=4+(15&g),g>>>=4,E-=4,r.nlen>286||r.ndist>30){s.msg="too many length or distance symbols",r.mode=oi;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;E<3;){if(0===p)break e;p--,g+=a[d++]<<E,E+=8}r.lens[Ze[r.have++]]=7&g,g>>>=3,E-=3}for(;r.have<19;)r.lens[Ze[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,_e={bits:r.lenbits},ee=Ph(0,r.lens,0,19,r.lencode,0,r.work,_e),r.lenbits=_e.bits,ee){s.msg="invalid code lengths set",r.mode=oi;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;$=r.lencode[g&(1<<r.lenbits)-1],D=$>>>24,L=$>>>16&255,B=65535&$,!(D<=E);){if(0===p)break e;p--,g+=a[d++]<<E,E+=8}if(B<16)g>>>=D,E-=D,r.lens[r.have++]=B;else{if(16===B){for(ve=D+2;E<ve;){if(0===p)break e;p--,g+=a[d++]<<E,E+=8}if(g>>>=D,E-=D,0===r.have){s.msg="invalid bit length repeat",r.mode=oi;break}K=r.lens[r.have-1],T=3+(3&g),g>>>=2,E-=2}else if(17===B){for(ve=D+3;E<ve;){if(0===p)break e;p--,g+=a[d++]<<E,E+=8}g>>>=D,E-=D,K=0,T=3+(7&g),g>>>=3,E-=3}else{for(ve=D+7;E<ve;){if(0===p)break e;p--,g+=a[d++]<<E,E+=8}g>>>=D,E-=D,K=0,T=11+(127&g),g>>>=7,E-=7}if(r.have+T>r.nlen+r.ndist){s.msg="invalid bit length repeat",r.mode=oi;break}for(;T--;)r.lens[r.have++]=K}}if(r.mode===oi)break;if(0===r.lens[256]){s.msg="invalid code -- missing end-of-block",r.mode=oi;break}if(r.lenbits=9,_e={bits:r.lenbits},ee=Ph(1,r.lens,0,r.nlen,r.lencode,0,r.work,_e),r.lenbits=_e.bits,ee){s.msg="invalid literal/lengths set",r.mode=oi;break}if(r.distbits=6,r.distcode=r.distdyn,_e={bits:r.distbits},ee=Ph(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,_e),r.distbits=_e.bits,ee){s.msg="invalid distances set",r.mode=oi;break}if(r.mode=iv,i===Jf)break e;case iv:r.mode=QC;case QC:if(p>=6&&m>=258){s.next_out=h,s.avail_out=m,s.next_in=d,s.avail_in=p,r.hold=g,r.bits=E,b3(s,b),h=s.next_out,l=s.output,m=s.avail_out,d=s.next_in,a=s.input,p=s.avail_in,g=r.hold,E=r.bits,r.mode===Ha&&(r.back=-1);break}for(r.back=0;$=r.lencode[g&(1<<r.lenbits)-1],D=$>>>24,L=$>>>16&255,B=65535&$,!(D<=E);){if(0===p)break e;p--,g+=a[d++]<<E,E+=8}if(L&&!(240&L)){for(V=D,Q=L,se=B;$=r.lencode[se+((g&(1<<V+Q)-1)>>V)],D=$>>>24,L=$>>>16&255,B=65535&$,!(V+D<=E);){if(0===p)break e;p--,g+=a[d++]<<E,E+=8}g>>>=V,E-=V,r.back+=V}if(g>>>=D,E-=D,r.back+=D,r.length=B,0===L){r.mode=16205;break}if(32&L){r.back=-1,r.mode=Ha;break}if(64&L){s.msg="invalid literal/length code",r.mode=oi;break}r.extra=15&L,r.mode=16201;case 16201:if(r.extra){for(ve=r.extra;E<ve;){if(0===p)break e;p--,g+=a[d++]<<E,E+=8}r.length+=g&(1<<r.extra)-1,g>>>=r.extra,E-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;$=r.distcode[g&(1<<r.distbits)-1],D=$>>>24,L=$>>>16&255,B=65535&$,!(D<=E);){if(0===p)break e;p--,g+=a[d++]<<E,E+=8}if(!(240&L)){for(V=D,Q=L,se=B;$=r.distcode[se+((g&(1<<V+Q)-1)>>V)],D=$>>>24,L=$>>>16&255,B=65535&$,!(V+D<=E);){if(0===p)break e;p--,g+=a[d++]<<E,E+=8}g>>>=V,E-=V,r.back+=V}if(g>>>=D,E-=D,r.back+=D,64&L){s.msg="invalid distance code",r.mode=oi;break}r.offset=B,r.extra=15&L,r.mode=16203;case 16203:if(r.extra){for(ve=r.extra;E<ve;){if(0===p)break e;p--,g+=a[d++]<<E,E+=8}r.offset+=g&(1<<r.extra)-1,g>>>=r.extra,E-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){s.msg="invalid distance too far back",r.mode=oi;break}r.mode=16204;case 16204:if(0===m)break e;if(T=b-m,r.offset>T){if(T=r.offset-T,T>r.whave&&r.sane){s.msg="invalid distance too far back",r.mode=oi;break}T>r.wnext?(T-=r.wnext,O=r.wsize-T):O=r.wnext-T,T>r.length&&(T=r.length),P=r.window}else P=l,O=h-r.offset,T=r.length;T>m&&(T=m),m-=T,r.length-=T;do{l[h++]=P[O++]}while(--T);0===r.length&&(r.mode=QC);break;case 16205:if(0===m)break e;l[h++]=r.length,m--,r.mode=QC;break;case 16206:if(r.wrap){for(;E<32;){if(0===p)break e;p--,g|=a[d++]<<E,E+=8}if(b-=m,s.total_out+=b,r.total+=b,4&r.wrap&&b&&(s.adler=r.check=r.flags?ji(r.check,l,b,h-b):Cl(r.check,l,b,h-b)),b=m,4&r.wrap&&(r.flags?g:JL(g))!==r.check){s.msg="incorrect data check",r.mode=oi;break}g=0,E=0}r.mode=16207;case 16207:if(r.wrap&&r.flags){for(;E<32;){if(0===p)break e;p--,g+=a[d++]<<E,E+=8}if(4&r.wrap&&g!==(4294967295&r.total)){s.msg="incorrect length check",r.mode=oi;break}g=0,E=0}r.mode=16208;case 16208:ee=S3;break e;case oi:ee=XC;break e;case 16210:return JC;default:return Io}return s.next_out=h,s.avail_out=m,s.next_in=d,s.avail_in=p,r.hold=g,r.bits=E,(r.wsize||b!==s.avail_out&&r.mode<oi&&(r.mode<16206||i!==$C))&&o2(s,s.output,s.next_out,b-s.avail_out),y-=s.avail_in,b-=s.avail_out,s.total_in+=y,s.total_out+=b,r.total+=b,4&r.wrap&&b&&(s.adler=r.check=r.flags?ji(r.check,l,b,s.next_out-b):Cl(r.check,l,b,s.next_out-b)),s.data_type=r.bits+(r.last?64:0)+(r.mode===Ha?128:0)+(r.mode===iv||16194===r.mode?256:0),(0===y&&0===b||i===$C)&&ee===Rl&&(ee=XL),ee},inflateEnd:s=>{if(Ts(s))return Io;let i=s.state;return i.window&&(i.window=null),s.state=null,Rl},inflateGetHeader:(s,i)=>{if(Ts(s))return Io;const r=s.state;return 2&r.wrap?(r.head=i,i.done=!1,Rl):Io},inflateSetDictionary:(s,i)=>{const r=i.length;let a,l,d;return Ts(s)?Io:(a=s.state,0!==a.wrap&&a.mode!==tv?Io:a.mode===tv&&(l=1,l=Cl(l,i,r,0),l!==a.check)?XC:(d=o2(s,i,r,r),d?(a.mode=16210,JC):(a.havedict=1,Rl)))},inflateInfo:"pako inflate (from Nodeca project)"},s2=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const a2=Object.prototype.toString,{Z_NO_FLUSH:t0,Z_FINISH:Dl,Z_OK:Zf,Z_STREAM_END:n0,Z_NEED_DICT:Kt,Z_STREAM_ERROR:r0,Z_DATA_ERROR:nN,Z_MEM_ERROR:c2}=Tl;function jd(s){this.options=KC.assign({chunkSize:65536,windowBits:15,to:""},s||{});const i=this.options;i.raw&&i.windowBits>=0&&i.windowBits<16&&(i.windowBits=-i.windowBits,0===i.windowBits&&(i.windowBits=-15)),!(i.windowBits>=0&&i.windowBits<16)||s&&s.windowBits||(i.windowBits+=32),i.windowBits>15&&i.windowBits<48&&!(15&i.windowBits)&&(i.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new YO,this.strm.avail_out=0;let r=Al.inflateInit2(this.strm,i.windowBits);if(r!==Zf)throw new Error(xd[r]);if(this.header=new s2,Al.inflateGetHeader(this.strm,this.header),i.dictionary&&("string"==typeof i.dictionary?i.dictionary=Xf.string2buf(i.dictionary):"[object ArrayBuffer]"===a2.call(i.dictionary)&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw&&(r=Al.inflateSetDictionary(this.strm,i.dictionary),r!==Zf)))throw new Error(xd[r])}function rv(s,i){const r=new jd(i);if(r.push(s),r.err)throw r.msg||xd[r.err];return r.result}jd.prototype.push=function(s,i){const r=this.strm,a=this.options.chunkSize,l=this.options.dictionary;let d,h,p;if(this.ended)return!1;for(h=i===~~i?i:!0===i?Dl:t0,r.input="[object ArrayBuffer]"===a2.call(s)?new Uint8Array(s):s,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(a),r.next_out=0,r.avail_out=a),d=Al.inflate(r,h),d===Kt&&l&&(d=Al.inflateSetDictionary(r,l),d===Zf?d=Al.inflate(r,h):d===nN&&(d=Kt));r.avail_in>0&&d===n0&&r.state.wrap>0&&0!==s[r.next_in];)Al.inflateReset(r),d=Al.inflate(r,h);switch(d){case r0:case nN:case Kt:case c2:return this.onEnd(d),this.ended=!0,!1}if(p=r.avail_out,r.next_out&&(0===r.avail_out||d===n0))if("string"===this.options.to){let m=Xf.utf8border(r.output,r.next_out),g=r.next_out-m,E=Xf.buf2string(r.output,m);r.next_out=g,r.avail_out=a-g,g&&r.output.set(r.output.subarray(m,m+g),0),this.onData(E)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(d!==Zf||0!==p){if(d===n0)return d=Al.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},jd.prototype.onData=function(s){this.chunks.push(s)},jd.prototype.onEnd=function(s){s===Zf&&(this.result="string"===this.options.to?this.chunks.join(""):KC.flattenChunks(this.chunks)),this.chunks=[],this.err=s,this.msg=this.strm.msg};var yc={Inflate:jd,inflate:rv,inflateRaw:function(s,i){return(i=i||{}).raw=!0,rv(s,i)},ungzip:rv,constants:Tl};const{deflate:iN}=GL,{inflate:d2}=yc;var s0,rN=iN,ov=d2;!function(s){s[s.ONE_BYTE=0]="ONE_BYTE",s[s.TWO_BYTE=1]="TWO_BYTE"}(s0||(s0={}));class Mh{constructor(){C(this,"_sequence",0),C(this,"_startTime",Date.now()),C(this,"isUseOneByte",!0)}get startTime(){const i=Date.now()-this._startTime;return i<Math.pow(2,16)?i:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(i){const r={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:i};if(i.byteLength>128){const p=new Uint8Array(4);p.set([1,0,0,0]);const g={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[{id:0,length:4,data:p.buffer}]};r.commonPacketHeader.extension=1,r.extension=g,r.payload=this.compress(i),r.commonPacketHeader.length=8+(r.extension.length+2)+r.payload.byteLength}else r.commonPacketHeader.length=8+r.payload.byteLength;const a=new ArrayBuffer(r.commonPacketHeader.length),l=new Uint8Array(a),d=new DataView(a);let h=0;if(d.setUint16(h,r.commonPacketHeader.extension<<15|r.commonPacketHeader.reserved<<14|r.commonPacketHeader.length,!0),h+=2,d.setUint32(h,r.commonPacketHeader.sequence,!0),h+=4,d.setUint16(h,r.commonStreamHeader,!0),h+=2,r.extension){const p=this.serializeExtension(r.extension);l.set(new Uint8Array(p),h),h+=p.byteLength}if(l.set(new Uint8Array(r.payload),h),h+=r.payload.byteLength,h!==r.commonPacketHeader.length)throw Error("serialize error!");return a}deserialize(i){if(i.byteLength<4)return new ArrayBuffer(0);const r=new DataView(i);let a=0;const l=r.getUint16(a,!0);a+=2;const d=(32768&l)>>15;let h,p;if(r.getUint16(a+2,!0),r.getUint16(a,!0),a+=4,r.getUint16(a,!0),a+=2,d){p=this.deserializeExtension(i.slice(a)),a+=2+p.length,h=i.slice(a);let m=!1;if(p.datas.length>0){const g=p.datas.find(E=>0===E.id);g&&(m=1==(1&new DataView(g.data).getUint32(0,!0)))}h=m?this.decompress(h):h}else h=i.slice(8);return h}serializeExtension(i){const{profile:r,length:a,datas:l}=i,d=new ArrayBuffer(a+2),h=new Uint8Array(d),p=new DataView(d);let m=0;if(p.setUint8(m++,r),p.setUint8(m++,a),l.forEach(g=>{r?(p.setUint8(m++,g.id),p.setUint8(m++,g.length),h.set(new Uint8Array(g.data),m),m+=g.data.byteLength):(p.setUint8(m++,g.id|g.length<<4),h.set(new Uint8Array(g.data),m),m+=g.data.byteLength)}),m!==a+2)throw Error("serialize extension error, is ".concat(m,"!==").concat(a+2));return d}deserializeExtension(i){const r=new DataView(i);let a=0;const l=r.getUint8(a);a++;const d=r.getUint8(a);a++;const h=l===s0.TWO_BYTE,p=[],m=new DataView(i,2);let g=0;for(;g<d;){let E=0,y=0,b=new ArrayBuffer(0);h?(E=m.getUint8(g),g++,y=m.getUint8(g),g++):(E=15&m.getUint8(g),y=m.getUint8(g)>>4,g++),y>0&&(b=m.buffer.slice(g+2,g+2+y),g+=b.byteLength),p.push({id:E,length:y,data:b})}if(g!==d)throw Error("parse error");return{profile:l,length:d,datas:p}}decompress(i){return ov(new Uint8Array(i))}compress(i){return rN(new Uint8Array(i))}}class Mr extends zt{constructor(i,r){super(),C(this,"_version",1),C(this,"_type",3),C(this,"_config",void 0),C(this,"_originDataChannel",void 0),C(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),C(this,"_dataStreamPacketHandler",void 0),C(this,"_datachannelEventMap",new Map),this._config=i,r&&(this._originDataChannel=r,this._bandDataChannelEvents(r)),this._initPacketHeader(),this._dataStreamPacketHandler=new Mh}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return j("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var i,r;return null!==(i=null===(r=this._originDataChannel)||void 0===r?void 0:r.readyState)&&void 0!==i?i:"connecting"}get _originDataChannelId(){var i,r;return null!==(i=null===(r=this._originDataChannel)||void 0===r?void 0:r.id)&&void 0!==i?i:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}_waitTillOpen(){var i=this;return M(function*(){return new q((r,a)=>{if(i._originDataChannel){"open"===i._originDataChannel.readyState&&r();const l=setTimeout(()=>{var d;a(new J(x.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(d=i._originDataChannel)||void 0===d?void 0:d.id)))},1e4);i._originDataChannel.onopen=()=>{clearTimeout(l),i._originDataChannel&&i._bandDataChannelEvents(i._originDataChannel),r()},i._originDataChannel.onerror=()=>{throw clearTimeout(l),new J(x.DATACHANNEL_CONNECTION_TIMEOUT)}}else a(new J(x.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})})()}_updateOriginDataChannel(i){this._originDataChannel=i,this._bandDataChannelEvents(i)}_initPacketHeader(){const i=new DataView(this._dataStreamPacketHeader);i.setUint16(0,this._version),i.setUint8(2,this._type),i.setUint8(3,this._config.id)}_bandDataChannelEvents(i){this._unbindDataChannelEvents(i),[Td.OPEN,Td.CLOSE,Td.ERROR].forEach(r=>{const a=()=>{this.emit(r)};this._datachannelEventMap.set(r,a),i.addEventListener(r,a)})}_unbindDataChannelEvents(i){Array.from(this._datachannelEventMap.entries()).forEach(r=>{let[a,l]=r;i.removeEventListener(a,l)}),this._datachannelEventMap.clear()}}class Pn extends Mr{constructor(i){super(i),C(this,"_messageListener",void 0),this._messageListener=r=>{if(r.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const a=r.data.slice(0,this._dataStreamPacketHeader.byteLength);if(new DataView(a).getUint8(3)!==this.id)return;let l=r.data.slice(this._dataStreamPacketHeader.byteLength);l=this._dataStreamPacketHandler.deserialize(l),this.emit(Td.MESSAGE,l)}}_updateOriginDataChannel(i){super._updateOriginDataChannel(i),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Ro extends Mr{send(i){if(this._originDataChannel){let r=i;r=this._dataStreamPacketHandler.serialize(i);const a=new Uint8Array(this._dataStreamPacketHeader.byteLength+r.byteLength);a.set(new Uint8Array(this._dataStreamPacketHeader),0),a.set(new Uint8Array(r),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(a.buffer)}}}class Ai extends zt{constructor(){super(...arguments),C(this,"resultStorage",new Map)}setLocalAudioStats(i,r,a){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",i,this.checkAudioInputLevel(a,r)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",i,this.checkSendAudioBitrate(a,r))}setLocalVideoStats(i,r,a){this.record("SEND_VIDEO_BITRATE_TOO_LOW",i,this.checkSendVideoBitrate(a,r)),this.record("FRAMERATE_INPUT_TOO_LOW",i,this.checkFramerateInput(a,r)),this.record("FRAMERATE_SENT_TOO_LOW",i,this.checkFramerateSent(a))}setRemoteAudioStats(i,r){const a=i.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",a,this.checkAudioOutputLevel(r))}setRemoteVideoStats(i,r){const a=i.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",a,this.checkVideoDecode(r))}record(i,r,a){if(j("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(i)||this.resultStorage.set(i,{result:[],isPrevNormal:!0});const l=this.resultStorage.get(i);if(l&&(l.result.push(a),l.result.length>=5)){var d;const h=ye(d=l.result).call(d,!0);l.isPrevNormal&&!h&&this.emit("exception",oN[i],i,r),!l.isPrevNormal&&h&&this.emit("exception",oN[i]+2e3,i+"_RECOVER",r),l.isPrevNormal=h,l.result=[]}}checkAudioOutputLevel(i){return!(i.receiveBitrate>0&&0===i.receiveLevel)}checkAudioInputLevel(i,r){return r instanceof wn&&!r.isActive||!!r.muted||0!==i.sendVolumeLevel}checkFramerateInput(i,r){let a=null;r._encoderConfig&&r._encoderConfig.frameRate&&(a=Cr(r._encoderConfig.frameRate));const l=i.captureFrameRate;return!a||!l||!(a>10&&l<5||a<10&&a>=5&&l<=1)}checkFramerateSent(i){return!(i.captureFrameRate&&i.sendFrameRate&&i.captureFrameRate>5&&i.sendFrameRate<=1)}checkSendVideoBitrate(i,r){return!!r.muted||0!==i.sendBitrate}checkSendAudioBitrate(i,r){return r instanceof wn&&!r.isActive||!!r.muted||0!==i.sendBitrate}checkVideoDecode(i){return 0===i.receiveBitrate||0!==i.decodeFrameRate}}const oN={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Di=new class{markSubscribeStart(s,i){performance.mark("agora-web-sdk/".concat(s,"/subscribe-").concat(i))}markPublishStart(s,i){performance.mark("agora-web-sdk/".concat(s,"/publish-").concat(i))}measureFromSubscribeStart(s,i){const r=performance.getEntriesByName("agora-web-sdk/".concat(s,"/subscribe-").concat(i));if(r.length>0){const a=r[r.length-1];return Math.round(performance.now()-a.startTime)}return 0}measureFromPublishStart(s,i){const r=performance.getEntriesByName("agora-web-sdk/".concat(s,"/publish-").concat(i));if(r.length>0){const a=r[r.length-1];return Math.round(performance.now()-a.startTime)}return 0}};function sN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Hd(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?sN(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):sN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class kh{constructor(i){C(this,"store",void 0),C(this,"onStatsException",void 0),C(this,"onUploadPublishDuration",void 0),C(this,"onStatsChanged",void 0),C(this,"localStats",new Map),C(this,"remoteStats",new Map),C(this,"updateStatsInterval",void 0),C(this,"trafficStats",void 0),C(this,"trafficStatsPeerList",[]),C(this,"uplinkStats",void 0),C(this,"exceptionMonitor",void 0),C(this,"p2pChannel",void 0),C(this,"scalabilityMode",mE.L1T1),C(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=i,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new Ai,this.exceptionMonitor.on("exception",(r,a,l)=>{this.onStatsException&&this.onStatsException(r,a,l)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ne.LocalAudioTrack)||Hd({},EC)}getLocalVideoTrackStats(){return this.localStats.get(ne.LocalVideoTrack)||Hd({},IE)}getRemoteAudioTrackStats(i){const r=(d,h)=>{if(!this.trafficStats)return h;const p=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return p&&(h.publishDuration=p.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},a={};if(i){var l;const d=null===(l=this.remoteStats.get(i))||void 0===l?void 0:l.audioStats;d&&(a[i]=r(i,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{audioStats:p}]=d;p&&(a[h]=r(h,p))});return a}getRemoteNetworkQualityStats(i){const r={};if(i){var a;const l=null===(a=this.remoteStats.get(i))||void 0===a?void 0:a.networkStats;l&&(r[i]=l)}else Array.from(this.remoteStats.entries()).forEach(l=>{let[d,{networkStats:h}]=l;h&&(r[d]=h)});return r}getRemoteVideoTrackStats(i){const r=(d,h)=>{if(!this.trafficStats)return h;const p=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return p&&(h.publishDuration=p.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},a={};if(i){var l;const d=null===(l=this.remoteStats.get(i))||void 0===l?void 0:l.videoStats;d&&(a[i]=r(i,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{videoStats:p}]=d;p&&(a[h]=r(h,p))});return a}getRTCStats(){let i=0,r=0,a=0,l=0;const d=this.localStats.get(ne.LocalAudioTrack);d&&(i+=d.sendBytes,r+=d.sendBitrate);const h=this.localStats.get(ne.LocalVideoTrack);h&&(i+=h.sendBytes,r+=h.sendBitrate);const p=this.localStats.get(ne.LocalVideoLowTrack);p&&(i+=p.sendBytes,r+=p.sendBitrate),this.remoteStats.forEach(g=>{let{audioStats:E,videoStats:y}=g;E&&(a+=E.receiveBytes,l+=E.receiveBitrate),y&&(a+=y.receiveBytes,l+=y.receiveBitrate)});let m=1;return this.trafficStats&&(m+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:m,SendBitrate:r,SendBytes:i,RecvBytes:a,RecvBitrate:l,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(i){this.localStats.set(i,void 0)}removeLocalStats(i){i?this.localStats.delete(i):this.localStats.clear()}addRemoteStats(i){this.remoteStats.set(i,{})}removeRemoteStats(i){i?this.remoteStats.delete(i):this.remoteStats.clear()}addP2PChannel(i){this.p2pChannel=i}updateTrafficStats(i){i.peer_delay=i.peer_delay.filter(r=>void 0!==r.B_ppad||void 0!==r.B_ppvd),i.peer_delay.filter(r=>-1===this.trafficStatsPeerList.indexOf(r.peer_uid)).forEach(r=>{var a;const l=null===(a=this.p2pChannel)||void 0===a?void 0:a.getRemoteMedia(r.peer_uid),d=null!=l&&l.videoSSRC?Di.measureFromSubscribeStart(this.store.clientId,l.videoSSRC):0,h=null!=l&&l.audioSSRC?Di.measureFromSubscribeStart(this.store.clientId,l.audioSSRC):0;void 0!==r.B_ppad&&void 0!==r.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(r.peer_uid,r.B_ppad,r.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(r.peer_uid))}),this.trafficStats=i}updateUplinkStats(i){this.uplinkStats&&this.uplinkStats.B_fir!==i.B_fir&&w.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(i.B_fir)),this.uplinkStats=i}static isRemoteVideoFreeze(i,r,a){return!!i&&(!!a&&r.framesDecodeFreezeTime>a.framesDecodeFreezeTime||!(!a||r.framesDecodeCount>a.framesDecodeCount))}static isRemoteAudioFreeze(i){return!!i&&i._isFreeze()}isLocalVideoFreeze(i){return!(!i.inputFrame||!i.sentFrame)&&i.inputFrame.frameRate>5&&i.sentFrame.frameRate<3}updateLocalStats(i){Array.from(this.localStats.entries()).forEach(r=>{let[a,l]=r;switch(a){case ne.LocalVideoTrack:case ne.LocalVideoLowTrack:{const h=l,p=Hd({},IE),m=i.getStats(),g=i.getLocalMedia(a);if(m){const E=m.videoSend.find(y=>y.ssrc===g?.ssrcs[0].ssrcId);if(E){const y=i.getLocalVideoSize(),b=i.getEncoderConfig(ne.LocalVideoTrack);"H264"!==E.codec&&"H265"!==E.codec&&"VP8"!==E.codec&&"VP9"!==E.codec&&"AV1X"!==E.codec&&"AV1"!==E.codec||(p.codecType=E.codec),p.sendBytes=E.bytes,p.sendBitrate=h?8*Math.max(0,p.sendBytes-h.sendBytes):0,E.inputFrame?(p.captureFrameRate=E.inputFrame.frameRate,p.captureResolutionHeight=E.inputFrame.height,p.captureResolutionWidth=E.inputFrame.width):y&&(p.captureResolutionWidth=y.width,p.captureResolutionHeight=y.height),E.sentFrame?(p.sendFrameRate=E.sentFrame.frameRate,p.sendResolutionHeight=E.sentFrame.height,p.sendResolutionWidth=E.sentFrame.width):y&&(p.sendResolutionWidth=y.width,p.sendResolutionHeight=y.height),E.avgEncodeMs&&(p.encodeDelay=E.avgEncodeMs),b&&b.bitrateMax&&(p.targetSendBitrate=1e3*b.bitrateMax),p.sendPackets=E.packets,p.sendPacketsLost=E.packetsLost,p.sendJitterMs=E.jitterMs,p.sendRttMs=E.rttMs,p.totalDuration=h?h.totalDuration+1:1,p.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(E)&&(p.totalFreezeTime+=1),E.scalabilityMode&&this.scalabilityMode!==E.scalabilityMode&&(w.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(E.scalabilityMode)),this.scalabilityMode=E.scalabilityMode)}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var d;this.localStats.set(a,p),(h?.sendResolutionWidth!==p.sendResolutionWidth||h?.sendResolutionHeight!==p.sendResolutionHeight)&&(null===(d=this.onStatsChanged)||void 0===d||d.call(this,"resolution",{width:p.sendResolutionWidth,height:p.sendResolutionHeight})),p&&g&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,g.track,p);break}case ne.LocalAudioTrack:{const h=l,p=Hd({},EC),m=i.getStats(),g=i.getLocalMedia(a);if(m){const E=m.audioSend.find(y=>y.ssrc===g?.ssrcs[0].ssrcId);if(E){if("opus"!==E.codec&&"aac"!==E.codec&&"PCMU"!==E.codec&&"PCMA"!==E.codec&&"G722"!==E.codec||(p.codecType=E.codec),E.inputLevel)p.sendVolumeLevel=Math.round(32767*E.inputLevel);else{const y=i.getLocalAudioVolume();y&&(p.sendVolumeLevel=Math.round(32767*y))}p.sendBytes=E.bytes,p.sendPackets=E.packets,p.sendPacketsLost=E.packetsLost,p.sendJitterMs=E.jitterMs,p.sendRttMs=E.rttMs,p.sendBitrate=h?8*Math.max(0,p.sendBytes-h.sendBytes):0}}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(ne.LocalAudioTrack,p),p&&g&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,g.track,p);break}}})}updateRemoteStats(i){Array.from(this.remoteStats.entries()).forEach(r=>{let[a,{videoStats:l,audioStats:d,videoPcStats:h}]=r;const p=d,m=l,g=h,E=Hd({},Jo),y=Hd({},QD),b=Hd({},IL),{audioTrack:T,videoTrack:O,audioSSRC:P,videoSSRC:D}=i.getRemoteMedia(a),L=i.getStats(),B=L?.audioRecv.find(se=>se.ssrc===P),V=L?.videoRecv.find(se=>se.ssrc===D),Q=this.trafficStats&&this.trafficStats.peer_delay.find(se=>se.peer_uid===a);if(B&&("opus"!==B.codec&&"aac"!==B.codec&&"PCMU"!==B.codec&&"PCMA"!==B.codec&&"G722"!==B.codec||(E.codecType=B.codec),B.outputLevel?E.receiveLevel=Math.round(32767*B.outputLevel):T&&(E.receiveLevel=Math.round(32767*T.getVolumeLevel())),E.receiveBytes=B.bytes,E.receivePackets=B.packets,E.receivePacketsLost=B.packetsLost,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost),E.receiveBitrate=p?8*Math.max(0,E.receiveBytes-p.receiveBytes):0,E.totalDuration=p?p.totalDuration+1:1,E.totalFreezeTime=p?p.totalFreezeTime:0,E.freezeRate=E.totalFreezeTime/E.totalDuration,E.receiveDelay=B.jitterBufferMs,E.totalDuration>10&&kh.isRemoteAudioFreeze(T)&&(E.totalFreezeTime+=1)),V){"H264"!==V.codec&&"H265"!==V.codec&&"VP8"!==V.codec&&"VP9"!==V.codec&&"AV1X"!==V.codec&&"AV1"!==V.codec||(y.codecType=V.codec),y.receiveBytes=V.bytes,y.receiveBitrate=m?8*Math.max(0,y.receiveBytes-m.receiveBytes):0,y.decodeFrameRate=V.decodeFrameRate<0?0:V.decodeFrameRate,y.renderFrameRate=V.decodeFrameRate<0?0:V.decodeFrameRate,V.outputFrame&&(y.renderFrameRate=V.outputFrame.frameRate),V.receivedFrame?(y.receiveFrameRate=V.receivedFrame.frameRate,y.receiveResolutionHeight=V.receivedFrame.height,y.receiveResolutionWidth=V.receivedFrame.width):O&&(y.receiveResolutionHeight=O._videoHeight||0,y.receiveResolutionWidth=O._videoWidth||0),void 0!==V.framesRateFirefox&&(y.receiveFrameRate=Math.round(V.framesRateFirefox)),y.receivePackets=V.packets,y.receivePacketsLost=V.packetsLost,y.packetLossRate=y.receivePacketsLost/(y.receivePackets+y.receivePacketsLost),y.totalDuration=m?m.totalDuration+1:1,y.totalFreezeTime=m?m.totalFreezeTime:0,y.receiveDelay=V.jitterBufferMs||0;const se=!!D&&i.getRemoteVideoIsReady(D);O&&se&&kh.isRemoteVideoFreeze(O,V,g)&&(y.totalFreezeTime+=1),y.freezeRate=y.totalFreezeTime/y.totalDuration}Q&&(E.end2EndDelay=Q.B_ad,y.end2EndDelay=Q.B_vd,E.transportDelay=Q.B_ed,y.transportDelay=Q.B_ed,E.currentPacketLossRate=Q.B_ealr4/100,y.currentPacketLossRate=Q.B_evlr4/100,b.uplinkNetworkQuality=Q.B_punq?Q.B_punq:0,b.downlinkNetworkQuality=Q.B_pdnq?Q.B_pdnq:0),this.remoteStats.set(a,{audioStats:E,videoStats:y,videoPcStats:V,networkStats:b}),T&&this.exceptionMonitor.setRemoteAudioStats(T,E),O&&this.exceptionMonitor.setRemoteVideoStats(O,y)})}}function aN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function a0(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?aN(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):aN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function sv(s){return s.match(/^[\.\:\d]+$/)?"".concat(s.replace(/[^\d]/g,"-"),".").concat(j("TURN_DOMAIN")):(w.info("Cannot recognized as IP address ".concat(s,". Used As Host instead")),s)}function em(s,i){var r,a;const l=j("GATEWAY_DOMAINS");let d=l[1]&&-1!==i.indexOf(l[1])?1:0;s.addresses=s.addresses||[];const h=s.addresses.map(m=>m.domain_prefix?{address:"".concat(m.domain_prefix,".").concat(l[d++%l.length],":").concat(m.port)}:m.ip.match(/^[\.\:\d]+$/)?{ip:m.ip,port:m.port,address:"".concat(m.ip.replace(/[^\d]/g,"-"),".").concat(l[d++%l.length],":").concat(m.port)}:(w.info("Cannot recognized as IP address ".concat(m.ip,". Used As Host instead")),{ip:m.ip,port:m.port,address:"".concat(m.ip,":").concat(m.port)}));if(null!==(r=s.detail)&&void 0!==r&&r[18]&&"string"==typeof(null===(a=s.detail)||void 0===a?void 0:a[18])){const m=s.detail[18],g=m?.split(";");for(let E=0;E<g.length;E++){var p;const y=$D(p=g[E]).call(p);h[E]&&y&&(h[E].ip6=y)}}return{gatewayAddrs:h,uid:s.uid,cid:s.cid,cert:s.cert,vid:s.detail&&s.detail[8],uni_lbs_ip:s.detail&&s.detail[1],res:s,csIp:s.detail&&s.detail[502]}}function Cr(s){return"number"==typeof s?s:s.exact||s.ideal||s.max||s.min||0}function Gd(s){const i=s._encoderConfig;if(!i)return{};const r={resolution:i.width&&i.height?"".concat(Cr(i.width),"x").concat(Cr(i.height)):void 0,maxVideoBW:i.bitrateMax,minVideoBW:i.bitrateMin};return"number"==typeof i.frameRate?(r.maxFrameRate=i.frameRate,r.minFrameRate=i.frameRate):i.frameRate&&(r.maxFrameRate=i.frameRate.max||i.frameRate.ideal||i.frameRate.exact||i.frameRate.min,r.minFrameRate=i.frameRate.min||i.frameRate.ideal||i.frameRate.exact||i.frameRate.max),r}function rs(s){const i={connectionType:0,googRtt:s.rtt};switch(s.selectedCandidatePair.localCandidate.candidateType){case"relay":{const r=s.selectedCandidatePair.localCandidate.relayProtocol;"udp"===r&&(i.connectionType=1),"tcp"===r&&(i.connectionType=3),"tls"===r&&(i.connectionType=4);break}case"srflx":i.connectionType=2}return i}function av(s){return s>=0&&s<.17?1:s>=.17&&s<.36?2:s>=.36&&s<.59?3:s>=.59&&s<=1?4:s>1?5:0}function cN(s,i){let r,a,l;switch(i){case Yn.CHOOSE_SERVER:a=4096,l="choose server";break;case Yn.CLOUD_PROXY:a=1048576,l="proxy";break;case Yn.CLOUD_PROXY_5:a=4194304,l="proxy5";break;case Yn.CLOUD_PROXY_FALLBACK:a=4194310,l="proxy fallback";break;default:throw new W(x.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:s.detail&&s.detail[502],retry:!1})}if(s.response_body.forEach(d=>{d.buffer&&d.buffer.flag===a&&(r={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map(h=>a0(a0({},h),{},{ticket:d.buffer.cert})),server_ts:s.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:a0(a0({},d.buffer.detail),s.detail),flag:d.buffer.flag,opid:s.opid,cert:d.buffer.cert})}),!r)throw new W(x.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(l," from multi unilbs response"),{csIp:s.detail&&s.detail[502]});return r}function R3(s,i){return lN.apply(this,arguments)}function lN(){return lN=M(function*(s,i){return yield q.all(s.addresses.map(function(){var r=M(function*(a){return{address:sv(a.ip),tcpport:a.port,udpport:a.port,username:i&&j("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?i.toString():Eo.username,password:i&&j("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?yield IS(i.toString()):Eo.password}});return function(a){return r.apply(this,arguments)}}()))}),lN.apply(this,arguments)}function c0(s,i){const r=i._videoHeight||i.getMediaStreamTrack(!0).getSettings().height;return r?Math.max(r/Cr(s.height),1):(w.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Ol(s){let{candidateType:i,relayProtocol:r,type:a,address:l,port:d,protocol:h}=s;return"local-candidate"===a?{candidateType:i,relayProtocol:r,protocol:h}:{candidateType:i,relayProtocol:r,address:l,port:d,protocol:h}}function l0(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}class h2 extends zt{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(i){var r;ye(r=["tryNext","recover"]).call(r,i)&&this.resetReconnectCount(i),this._reconnectMode=i}get state(){return this._state}set state(i){i!==this._state&&(this._state=i,"reconnecting"===this._state?this.emit(En.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(En.CONNECTED):"closed"===this._state?this.emit(En.CLOSED):"failed"===this._state&&this.emit(En.FAILED))}constructor(i,r,a,l){super(),C(this,"connectionID",0),C(this,"currentURLIndex",0),C(this,"reconnectReason",void 0),C(this,"_reconnectMode","tryNext"),C(this,"_name",void 0),C(this,"_state","closed"),C(this,"_retryConfig",void 0),C(this,"_reconnectCount",0),C(this,"_forceCloseTimeout",5e3),C(this,"_onlineReconnectListener",void 0),C(this,"_closeEstablishingTransmitter",()=>{}),C(this,"_store",void 0),C(this,"_joinChannelServiceRecordIndex",void 0),C(this,"_useCompress",void 0),C(this,"_inflateLength",0),C(this,"_deflateLength",0),this._store=l,this._name=i,this._retryConfig=function(d){for(var h=1;h<arguments.length;h++){var p=null!=arguments[h]?arguments[h]:{};h%2?l0(Object(p),!0).forEach(function(m){C(d,m,p[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(p)):l0(Object(p)).forEach(function(m){Object.defineProperty(d,m,Object.getOwnPropertyDescriptor(p,m))})}return d}({},r),this._useCompress=a}resetReconnectCount(i){w.debug("".concat(this._name," reset reconnect count, reason: ").concat(i)),this._reconnectCount=0}close(i,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const a=this._transmitter;r?setTimeout(()=>a.close(),500):a.close(),this._transmitter=void 0}this.state=i?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(i,r){if(!this._transmitter)return void w.warning("[".concat(this._name,"] can not reconnect, no websocket"));var a;void 0!==i&&(this.reconnectMode=i),w.debug("[".concat(this._name,"] reconnect is triggered initiative")),"number"==typeof this._joinChannelServiceRecordIndex&&(null===(a=this._store)||void 0===a||a.recordJoinChannelService({status:"error",errors:[new Error(r)]},this._joinChannelServiceRecordIndex));const l=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),l&&l.bind(this._transmitter)({code:9999,reason:r})}getInflateData(){const i=this._inflateLength,r=this._deflateLength;return this.clearInflateData(),{inflateLength:i,deflateLength:r}}setInflateData(i){this._deflateLength=this._deflateLength+i.originLength,this._inflateLength=this._inflateLength+i.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}var os;!function(s){s[s.Default=0]="Default",s[s.Ack=1]="Ack"}(os||(os={}));class A3{constructor(i,r,a){C(this,"version",1),C(this,"initialRTO",void 0),C(this,"maxBatchAckCount",void 0),C(this,"maxRTO",void 0),C(this,"initialRTT",void 0),C(this,"ID",void 0),C(this,"rtt",void 0),C(this,"packetNumber",1),C(this,"rtoRatioMap",new Map),C(this,"timeoutMap",new Map),C(this,"unorderedPacketQueue",[]),C(this,"batchAckPacketQueue",[]),C(this,"lastOrderedPacketNumber",0),C(this,"batchAckTimer",void 0),C(this,"sendImpl",void 0),C(this,"receiveImpl",void 0),this.sendImpl=i,this.receiveImpl=r,this.ID=Fe(7,"transmitter-"),this.initialRTO=void 0!==a?.initialRTO?a.initialRTO:j("TRANSMITTER_INITIAL_RTO"),this.initialRTT=void 0!==a?.initialRTT?a.initialRTT:j("TRANSMITTER_INITIAL_RTT"),this.rtt=void 0!==a?.initialRTT?a.initialRTT:j("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=void 0!==a?.maxBatchAckCount?a.maxBatchAckCount:j("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=void 0!==a?.maxRTO?a.maxRTO:j("TRANSMITTER_MAX_RTO")}packetize(i,r){return{type:os.Default,version:this.version,packetNumber:r,payload:i}}serialize(i){switch(i.type){case os.Default:{let r;r="string"==typeof i.payload?(new TextEncoder).encode(i.payload):i.payload;const a=new ArrayBuffer(r.length+15),l=new DataView(a);return l.setUint16(0,i.version),l.setUint8(2,i.type),l.setUint32(3,i.packetNumber),CS(l,7,BigInt(i.sendTs)),new Uint8Array(l.buffer).set(r,15),a}case os.Ack:{const r=new ArrayBuffer(16),a=new DataView(r);return a.setUint16(0,i.version),a.setUint8(2,i.type),a.setUint32(3,i.maxAckPacketNumber),a.setUint8(7,i.shift),CS(a,8,BigInt(i.ackSendTs)),r}}}deserialize(i){const r=new DataView(i),a=r.getUint16(0),l=r.getUint8(2);switch(l){case os.Default:{const d=r.getUint32(3),h=SS(r,7),p=i.slice(15),m=(new TextDecoder).decode(p);return{version:a,type:l,packetNumber:d,sendTs:Number(h),payload:m}}case os.Ack:{const d=r.getUint32(3),h=r.getUint8(7),p=SS(r,8);return{version:a,type:l,maxAckPacketNumber:d,shift:h,ackSendTs:Number(p)}}default:throw w.error("[".concat(this.ID,"] Unrecognized packet type ").concat(l)),new Error("Unrecognized packet type ".concat(l))}}sendMessage(i){const r=this.packetize(i,this.packetNumber);this.packetNumber=4294967295===this.packetNumber?1:this.packetNumber+1;const a=this.calculateRTO(r),l=window.setTimeout(()=>{this.resendMessage(r)},a);this.timeoutMap.set(r.packetNumber,l),this.sendPacket(r)}onData(i){const r=this.deserialize(i);r.type===os.Default?this.ack(r):r.type===os.Ack&&(this.updateRTT(r,Math.round(performance.now())),this.clearRTO(r))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(i=>{let[r,a]=i;window.clearTimeout(a)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,void 0!==this.batchAckTimer&&window.clearTimeout(this.batchAckTimer)}resendMessage(i){const r=this.calculateRTO(i),a=window.setTimeout(()=>{this.resendMessage(i)},r);this.timeoutMap.set(i.packetNumber,a),this.sendPacket(i)}calculateRTO(i){const r=this.rtoRatioMap.get(i.packetNumber);if(void 0===r)return this.rtoRatioMap.set(i.packetNumber,1),this.initialRTO;{const a=9*this.rtt/8*r;return this.rtoRatioMap.set(i.packetNumber,r+1),a>this.maxRTO?this.maxRTO:a}}updateRTT(i,r){this.rtt=this.rtt*(7/8)+(r-i.ackSendTs-this.rtt)/8}ack(i){if(i.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(i):(this.batchAckPacketQueue.push(i),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(i.payload);;){const r=this.unorderedPacketQueue[0];if(!r){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(r.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else i.packetNumber<=this.lastOrderedPacketNumber?this.sendPacket({ackSendTs:i.sendTs,maxAckPacketNumber:i.packetNumber,shift:0,type:os.Ack,version:this.version}):i.packetNumber>this.lastOrderedPacketNumber&&(this.unorderedPacketQueue[i.packetNumber-this.lastOrderedPacketNumber-2]=i,this.sendPacket({ackSendTs:i.sendTs,maxAckPacketNumber:i.packetNumber,shift:0,type:os.Ack,version:this.version}))}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0,this.sendPacket({ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:os.Ack,version:this.version}),this.batchAckPacketQueue=[]}sendPacket(i){i.type===os.Default&&(i.sendTs=Math.round(performance.now()));const r=this.serialize(i);this.sendImpl(r)}clearRTO(i){for(let r=i.maxAckPacketNumber-i.shift;r<=i.maxAckPacketNumber;r++){const a=this.timeoutMap.get(r);void 0!==a&&window.clearTimeout(a),this.timeoutMap.delete(r),this.rtoRatioMap.delete(r)}}}class ss extends h2{constructor(i,r){super(i,r,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3?arguments[3]:void 0),C(this,"_initMutex",void 0),C(this,"_reconnectInterrupter",void 0),C(this,"_url",void 0),C(this,"_transmitter",void 0),C(this,"_addresses",void 0),C(this,"_reliableTransmission",void 0),this._initMutex=new Zn("datachannel");const{timeout:a,timeoutFactor:l}=r,d=Math.max(300,Math.floor(3*a/5)),h=Math.max(1.2,Math.floor(8*l)/10);Yi.ONLINE&&(this._retryConfig.timeout=d,this._retryConfig.timeoutFactor=h),on.on(dc.NETWORK_STATE_CHANGE,(p,m)=>{p!==m&&(this.resetReconnectCount("network state change: ".concat(m," -> ").concat(p)),p===Yi.ONLINE?(this._retryConfig.timeout=d,this._retryConfig.timeoutFactor=h):(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=l))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}init(i){var r=arguments,a=this;return M(function*(){a._forceCloseTimeout=r.length>1&&void 0!==r[1]?r[1]:5e3;return a._initMutex.lock().then(h=>new q((p,m)=>{((h,p)=>{a._addresses=i,a.currentURLIndex=a._addresses.findIndex(g=>g.fingerprint||j("FINGERPRINT"));const m=a._addresses[a.currentURLIndex];a.state="connecting",a.createTransmitterConnection(m).then(h).catch(p),a.once(En.CLOSED,()=>p(new W(x.WS_DISCONNECT))),a.once(En.CONNECTED,()=>h())})(p,m)}).then(()=>{h()}).catch(()=>{h()}))})()}sendMessage(i){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new W(x.WS_ABORT,"datachannel is not ready");try{r||(i=JSON.stringify(i)),this._reliableTransmission.sendMessage(i)}catch(a){throw new W(x.WS_ERR,"send datachannel signal message error"+a.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(i){const r=JSON.stringify(i);return{compressed:r,compressedLength:r.length,origin:i}}sendMessageWithUint8Array(i){return{compressed:i,compressedLength:i.byteLength,origin:i}}createTransmitterConnection(i){var r=this;return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(i.ip,":").concat(i.port),new q((a,l)=>{var d;const h=()=>{w.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),a()},p=function(){var y=M(function*(b){var T;if(null===(T=r._closeEstablishingTransmitter)||void 0===T||T.call(r),w.debug("[".concat(r._name,"] datachannel close ").concat(r._url,", code: ").concat(b.code,", reason: ").concat(b.reason,", current mode: ").concat(r.reconnectMode)),r._reconnectCount<r._retryConfig.maxRetryCount){"connected"===r.state&&(r.reconnectReason=b.reason,r.state="reconnecting");const O=gr(r,En.WILL_RECONNECT,r.reconnectMode)||r.reconnectMode,P=yield r.reconnectWithAction(O);if("closed"===r.state)return void w.debug("[".concat(r.connectionID,"] dc is closed, no need to reconnect"));if(!P)return l(new W(x.WS_DISCONNECT,"datachannel reconnect failed: ".concat(b.code))),void r.close(!0);a()}else l(new W(x.WS_DISCONNECT,"datachannel close: ".concat(b.code))),r.close()});return function(T){return y.apply(this,arguments)}}(),m=y=>{var b;null===(b=this._reliableTransmission)||void 0===b||b.onData(y.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),w.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(i)));const g=null===(d=this._store)||void 0===d?void 0:d.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),E=Date.now();Jt(this,En.TO_CONNECT_DATACHANNEL,i).then(y=>{var b,T;if(!y)throw new Error("transmissonInfo not exist yet");const{transmitter:O,close:P}=y;this._transmitter=O,null===(b=this._store)||void 0===b||b.signalChannelOpen();const D=Date.now()-E;w.debug("[choose dc] dc open cost ".concat(D,"ms")),this._reliableTransmission=new A3(L=>{var B;this._transmitter&&"open"===this._transmitter.readyState&&(null===(B=this._transmitter)||void 0===B||B.send(L))},L=>{"string"==typeof L&&this.emit(En.ON_MESSAGE,L)}),this._closeEstablishingTransmitter=()=>{var L;null===(L=this._reliableTransmission)||void 0===L||L.close(),this._reliableTransmission=void 0,P()},h&&h(),O.onclose=p,O.onmessage=m,null===(T=this._store)||void 0===T||T.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this._joinChannelServiceRecordIndex=g}).catch(y=>{var b;if(null===(b=this._store)||void 0===b||b.recordJoinChannelService({endTs:Date.now(),status:y instanceof W&&y.code===x.WS_ABORT?"aborted":"error",errors:[y]},g),"closed"!==this.state){if(y instanceof W&&y.code===x.WS_ERR){const T=new W(x.WS_ERR,"init datachannel failed! Error: ".concat(y.toString()));return w.error("[".concat(this._name,"]").concat(T)),void l(T)}p&&p(y)}else l(new W(x.WS_DISCONNECT,"datachannel is closed: ".concat(y.toString())))})})}reconnectWithAction(i){var r=arguments,a=this;return M(function*(){let l=!(r.length>1&&void 0!==r[1])||r[1];if(a._reconnectCount>=a._retryConfig.maxRetryCount||!a._addresses||"closed"===a.state)return!1;a._onlineReconnectListener||on.networkState!==Yi.OFFLINE||(a._onlineReconnectListener=on.onlineWaiter&&on.onlineWaiter.then(()=>{a._onlineReconnectListener=void 0}));let d=!0;if(a._reconnectInterrupter=()=>{d=!1},l){const g=wt(a._reconnectCount,a._retryConfig);w.debug("[".concat(a._name,"] wait ").concat(g,"ms to reconnect datachannel, mode: ").concat(i)),yield q.race([_i(g),a._onlineReconnectListener||new q(()=>{})])}if("closed"===a.state||!d)return!1;a._reconnectCount+=1;const h=function(){var g=M(function*(E,y){a.emit(En.RECONNECT_CREATE_CONNECTION,y),yield a.createTransmitterConnection(E)});return function(y,b){return g.apply(this,arguments)}}();try{if("retry"===i){const g=a._addresses[a.currentURLIndex];a.emit(En.RECONNECT_WAITTING_FINISH,i),yield h(g,i)}else if("tryNext"===i){a.currentURLIndex+=1;for(let E=a.currentURLIndex;E<a._addresses.length;E++){if(a._addresses[E].fingerprint||j("FINGERPRINT")){a.currentURLIndex=E;break}a.currentURLIndex+=1}if(a.currentURLIndex>=a._addresses.length)return w.debug("[".concat(a._name,"] the available addresses are exhausted, change to recover")),yield a.reconnectWithAction("recover",!1);w.debug("[".concat(a._name,"] datachannel url length: ").concat(a._addresses.length," current index: ").concat(a.currentURLIndex));const g=a._addresses[a.currentURLIndex];a.emit(En.RECONNECT_WAITTING_FINISH,i),yield h(g,i)}else"recover"===i&&(w.debug("[".concat(a._name,"] start to failback to websocket")),a.resetReconnectCount("recover mode"),a.emit(En.RECONNECT_WAITTING_FINISH,i),a.emit(En.FAILBACK));return!0}catch(g){var p,m;return w.error("[".concat(a._name,"] reconnect failed"),g.toString()),null!=g&&null!==(p=g.data)&&void 0!==p&&p.desc&&Array.isArray(g.data.desc)&&g.data.desc.length&&ye(m=g.data.desc).call(m,"dynamic key expired")?(a.emit(En.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):yield a.reconnectWithAction(i,l)}})()}}class ta extends zt{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===Ke.CONNECTED?this.emit(he.WS_CONNECTED):i===Ke.RECONNECTING?this.emit(he.WS_RECONNECTING,this._websocketReconnectReason):i===Ke.CLOSED&&this.emit(he.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(i,r){super(),C(this,"_disconnectedReason",void 0),C(this,"_websocketReconnectReason",void 0),C(this,"_connectionState",Ke.CLOSED),C(this,"reconnectToken",void 0),C(this,"websocket",void 0),C(this,"openConnectionTime",void 0),C(this,"clientId",void 0),C(this,"lastMsgTime",Date.now()),C(this,"uploadCache",[]),C(this,"uploadCacheInterval",void 0),C(this,"rttRolling",new en(5)),C(this,"pingpongTimer",void 0),C(this,"inflateDataTimer",void 0),C(this,"pingpongTimeoutCount",0),C(this,"joinResponse",void 0),C(this,"multiIpOption",void 0),C(this,"initError",void 0),C(this,"spec",void 0),C(this,"store",void 0),C(this,"onWebsocketMessage",a=>{if(a instanceof ArrayBuffer)return void this.emit(he.ON_BINARY_DATA,a);const l=JSON.parse(a);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(l,"_id")){const d="res-@".concat(l._id);this.emit(d,l._result,l._message)}else if(Object.prototype.hasOwnProperty.call(l,"_type")&&(this.emit(l._type,l._message),l._type===Ue.ON_NOTIFICATION&&this.handleNotification(l._message),l._type===Ue.ON_USER_BANNED))switch(l._message.error_code){case 14:this.close(Ye.UID_BANNED);break;case 15:this.close(Ye.IP_BANNED);break;case 16:this.close(Ye.CHANNEL_BANNED)}}),this.clientId=i.clientId,this.spec=i,this.store=r,this.websocket=new ss("gateway-".concat(this.clientId),this.spec.retryConfig,!0,r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ke.CONNECTED&&this.reconnect("retry",vs.OFFLINE)})}request(i,r,a,l){var d=this;return M(function*(){const h=Fe(6,""),p={_id:h,_type:i,_message:r},m=d.websocket.connectionID,g=()=>new q((P,D)=>{if(d.connectionState===Ke.CONNECTED)return P();const L=()=>{d.off(he.WS_CLOSED,B),P()},B=()=>{d.off(he.WS_CONNECTED,L),D(new W(x.WS_ABORT))};d.once(he.WS_CONNECTED,L),d.once(he.WS_CLOSED,B),i!==Ce.PUBLISH&&i!==Ce.SUBSCRIBE&&i!==Ce.UNSUBSCRIBE&&i!==Ce.UNPUBLISH&&i!==Ce.CONTROL&&i!==Ce.RESTART_ICE||d.once(he.DISCONNECT_P2P,()=>{D(new W(x.DISCONNECT_P2P))}),i!==Ce.PUBLISH&&i!==Ce.RESTART_ICE||d.once(he.ABORT_P2P_EXECUTION,()=>{D(new W(x.DISCONNECT_P2P))})});if(d.connectionState!==Ke.CONNECTING&&d.connectionState!==Ke.RECONNECTING||i===Ce.JOIN||i===Ce.REJOIN||(yield g()),i===Ce.LEAVE&&(d.websocket.unbindDcCloseEventListener(),l=!0),d.websocket.sendMessage(p,!0,!1),l)return;const E=new q((P,D)=>{let L=!1;const B=(Q,se)=>{L=!0,P({isSuccess:"success"===Q,message:se||{}}),d.off(he.WS_CLOSED,V),d.off(he.WS_RECONNECTING,V),d.emit(he.REQUEST_SUCCESS,i,r)};d.once("res-@".concat(h),B);const V=()=>{D(new W(x.WS_ABORT,"type: ".concat(i))),d.off(he.WS_CLOSED,V),d.off(he.WS_RECONNECTING,V),d.off("res-@".concat(h),B)};d.once(he.WS_CLOSED,V),d.once(he.WS_RECONNECTING,V),_i(j("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||L||(w.warning("dc request timeout, type: ".concat(i)),d.emit(he.REQUEST_TIMEOUT,i,r))})});let y=null;try{y=yield E}catch(P){if(d.connectionState===Ke.CLOSED||i===Ce.LEAVE)throw new W(x.WS_ABORT);return!d.spec.forceWaitGatewayResponse||a?P.throw():i===Ce.JOIN||i===Ce.REJOIN?null:(yield g(),yield d.request(i,r))}if(y.isSuccess)return y.message;const b=Number(y.message.error_code||y.message.code),T=El(b),O=new W(x.UNEXPECTED_RESPONSE,"".concat(T.desc,": ").concat(y.message.error_str),{code:b,data:y.message});return"success"===T.action?y.message:(w.warning("[".concat(d.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(b,", message: ").concat(T.desc,", action: ").concat(T.action)),b===Ie.ERR_TOO_MANY_BROADCASTERS?((i===Ce.JOIN||i===Ce.REJOIN)&&(d.initError=O,d.close()),O.throw()):"failed"===T.action?O.throw():"quit"===T.action?(d.initError=O,d.close(),O.throw()):(b===Ie.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=y.message.option,w.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",vs.MULTI_IP)):d.reconnect(T.action,vs.SERVER_ERROR),i===Ce.JOIN||i===Ce.REJOIN?null:yield d.request(i,r)))})()}waitMessage(i,r){return new q(a=>{const l=d=>{(!r||r(d))&&(this.off(i,l),a(d))};this.on(i,l)})}upload(i,r){const a={_type:i,_message:r};try{this.websocket.sendMessage(a)}catch{const d=j("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ke.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},j("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,r){this.websocket.sendMessage({_type:i,_message:r})}init(i,r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new q((a,l)=>{this.once(he.WS_CONNECTED,()=>a(this.joinResponse)),this.once(he.WS_CLOSED,()=>l(this.initError||new W(x.WS_ABORT))),this.connectionState=Ke.CONNECTING,this.websocket.init(i).catch(l),this.websocket.once(En.FAILBACK,()=>{void 0===this.openConnectionTime&&l(new W(x.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{r&&void 0===this.openConnectionTime&&(w.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),l(new W(x.INIT_DATACHANNEL_TIMEOUT)))},j("DC_JOIN_WITH_FAILBACK"))})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=i||Ye.LEAVE,this.connectionState=Ke.CLOSED,w.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),i===Ye.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new ss("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}join(){var i=this;return M(function*(){if(!i.joinResponse){i.emit(he.ABORT_P2P_EXECUTION);const r=yield Jt(i,he.DATACHANNEL_CONNECTING),a=yield i.request(Ce.JOIN,r);if(!a)return i.emit(he.REPORT_JOIN_GATEWAY,x.TIMEOUT,i.url||""),!1;i.joinResponse=a,i.emit(he.JOIN_RESPONSE,i.joinResponse),i.reconnectToken=i.joinResponse.rejoin_token}return i.connectionState=Ke.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),!0})()}rejoin(){var i=this;return M(function*(){if(!i.reconnectToken)throw new W(x.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=uc(i,he.REQUEST_REJOIN_INFO);r.token=i.reconnectToken;const a=yield i.request(Ce.REJOIN,r);return!!a&&(i.connectionState=Ke.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),a.peers&&a.peers.forEach(l=>{i.emit(Ue.ON_USER_ONLINE,{uid:l.uid}),l.audio&&i.emit(Ue.ON_ADD_AUDIO_STREAM,{uid:l.uid,uint_id:l.uint_id,audio:!0,ssrcId:l.audio_ssrc}),l.video&&i.emit(Ue.ON_ADD_VIDEO_STREAM,{uid:l.uid,uint_id:l.uint_id,video:!0,ssrcId:l.video_ssrc}),i.emit(l.audio_mute?Ue.MUTE_AUDIO:Ue.UNMUTE_AUDIO,{uid:l.uid}),i.emit(l.video_mute?Ue.MUTE_VIDEO:Ue.UNMUTE_VIDEO,{uid:l.uid}),i.emit(l.audio_enable_local?Ue.ENABLE_LOCAL_AUDIO:Ue.DISABLE_LOCAL_AUDIO,{uid:l.uid}),i.emit(l.video_enable_local?Ue.ENABLE_LOCAL_VIDEO:Ue.DISABLE_LOCAL_VIDEO,{uid:l.uid}),l.audio||l.video||i.emit(Ue.ON_REMOVE_STREAM,{uid:l.uid,uint_id:l.uint_id})}),!0)})()}reconnect(i,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,r)}handleNotification(i){w.debug("[".concat(this.clientId,"] receive notification: "),i);const r=El(i.code);if("success"!==r.action){if("failed"!==r.action)return"quit"===r.action?("ERR_REPEAT_JOIN_CHANNEL"===r.desc&&this.close(Ye.UID_BANNED),void this.close()):void this.reconnect(r.action,vs.SERVER_ERROR);w.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=j("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=i&&(w.warning("PINGPONG Timeout. Last Socket Message: ".concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>j("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",vs.TIMEOUT):this.request(Ce.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-r;this.rttRolling.add(a),j("REPORT_STATS")&&this.send(Ce.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleInflateData(){const{inflateLength:i,deflateLength:r}=this.websocket.getInflateData();0!==i&&0!==r&&this.upload(Xi.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:i})}handleWebsocketEvents(){var i=this;this.websocket.on(En.RECONNECT_WAITTING_FINISH,r=>{this.emit(he.WS_RECONNECT_WAITTING_FINISH,r)}),this.websocket.on(En.RECONNECT_CREATE_CONNECTION,r=>{this.emit(he.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(En.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(En.CLOSED,()=>{this.connectionState=Ke.CLOSED}),this.websocket.on(En.FAILED,()=>{this._disconnectedReason=Ye.NETWORK_ERROR,this.connectionState=Ke.CLOSED}),this.websocket.on(En.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState=this.connectionState===Ke.CONNECTED?Ke.RECONNECTING:Ke.CONNECTING}),this.websocket.on(En.WILL_RECONNECT,(r,a)=>{if(uc(this,he.IS_P2P_DISCONNECTED)&&"retry"===r)return w.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(he.NEED_RENEW_SESSION),this.emit(he.DISCONNECT_P2P),a("tryNext");"retry"!==r&&(w.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0,this.emit(he.NEED_RENEW_SESSION),this.emit(he.DISCONNECT_P2P)),a(r)}),this.websocket.on(En.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{w.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",vs.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(he.REPORT_JOIN_GATEWAY,r.message||r.code,this.url||""),r instanceof W&&r.code===x.UNEXPECTED_RESPONSE&&r.data.code===Ie.ERR_NO_AUTHORIZED)return w.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",vs.SERVER_ERROR);w.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",vs.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(En.REQUEST_NEW_URLS,(r,a)=>{Jt(this,he.REQUEST_RECOVER,this.multiIpOption).then(r).catch(a)}),this.websocket.on(En.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(En.TO_CONNECT_DATACHANNEL,function(){var r=M(function*(a,l,d){return Jt(i,he.DATACHANNEL_PRECONNECT,a).then(l).catch(d)});return function(a,l,d){return r.apply(this,arguments)}}()),this.websocket.on(En.FAILBACK,()=>{void 0!==this.openConnectionTime&&this.emit(he.DATACHANNEL_FAILBACK)})}}class cv extends zt{constructor(i){super(),C(this,"_signal",void 0),C(this,"_sequence",0),C(this,"_userMap",new Map),C(this,"_encoder",new TextEncoder),this._signal=i}send(i,r,a,l,d){var h=this;return M(function*(){var p,m,g;"string"!=typeof r&&(r=JSON.stringify(r)),l=null!==(p=l)&&void 0!==p?p:Fe(6,""),d=null!==(m=d)&&void 0!==m?m:h._sequence++;const E={_id:l,_type:i,_seq:null!==(g=d)&&void 0!==g?g:h._sequence++,_message:r};if(j("SHOW_P2P_LOG")&&w.debug("send message",E),h.sendStreamMessage(JSON.stringify(E)),a)return;const y=new q((T,O)=>{const P=window.setTimeout(()=>{h.off("res-@".concat(l),D),w.warning("[external-signal] request timeout, type: ".concat(i)),O(new J(0===h._userMap.size?x.INVALID_REMOTE_USER:x.TIMEOUT))},j("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),D=(L,B)=>{P&&window.clearTimeout(P),"success"===L?T({isSuccess:!0,message:B}):O(new J(x.UNEXPECTED_ERROR,B))};h.once("res-@".concat(l),D)});let b;try{b=yield y}catch(T){if(T.code===x.TIMEOUT)return yield h.send(i,r,!1,l,d);throw T}return b.isSuccess?b.message:void 0})()}sendStreamMessage(i){this._splitMessage(i).forEach(r=>{this._signal.request(Ce.DATA_STREAM,{payload:dh(this._encoder.encode(r))})})}onMessage(i){const{_uid:r}=i;let a;const l=this._userMap.get(r);if(l?a=l.splitMessageMap:(a=new Map,this._userMap.set(r,{isStart:!1,splitMessageMap:a,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map})),"id"in i&&"total"in i){var d;const{id:h,total:p}=i,m=null!==(d=a.get(h))&&void 0!==d?d:[];if(m.push(i),a.has(h)||a.set(h,m),m.length!==p)return;{const g=tl(m).call(m,(E,y)=>E.index-y.index).map(E=>E.payload).join("");a.delete(h),(i=JSON.parse(g))._uid=r}}this.handleReceivedMessage(i)}setStart(i){this._userMap.has(i)?this._userMap.get(i).isStart=!0:this._userMap.set(i,{isStart:!0,splitMessageMap:new Map,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map}),this.handleReceivedMessage()}setEnd(i){return this._userMap.delete(i),0===this._userMap.size}ack(i,r,a){this.send(Dt.ACK,JSON.stringify({success:!a,message:r}),!0,i)}handleReceivedMessage(i){const r=()=>{this._userMap.forEach(g=>{const{receivedMessagesMap:E,nextExpectedSequenceNumber:y}=g;for(;E.has(y);){const b=E.get(y);E.delete(y),this.receiveMessage(b),g.nextExpectedSequenceNumber++}})};if(!i)return void r();const{_uid:a,_seq:l}=i,d=this._userMap.get(a),{receivedMessagesMap:h,isStart:p,nextExpectedSequenceNumber:m}=d;l<m?w.debug("[external-signal] receive old message, seq: ".concat(l)):(h.set(l,i),p&&l===m&&(this.receiveMessage(i),h.delete(m),d.nextExpectedSequenceNumber++,r()))}receiveMessage(i){const{_id:r,_type:a,_message:l,_uid:d}=i;if(j("SHOW_P2P_LOG")&&w.debug("\u6536\u5230\u6d88\u606f",i),r)switch(i._type){case Dt.PUBLISH:const h=JSON.parse(l);this._signal.emit(a,h,d),this.ack(i._id);break;case Dt.CONTROL:case Dt.UNPUBLISH:case Dt.DO_SUBSCRIBE:case Dt.DO_UNSUBSCRIBE:{const p=JSON.parse(l);p.uid=d,Jt(this._signal,a,p).then(m=>{this.ack(i._id,m)}).catch(m=>{this.ack(i._id,void 0,!0)});break}case Dt.ACK:{const{success:p,message:m}=JSON.parse(l);this.emit("res-@".concat(r),p?"success":"failed",m);break}case Dt.CALL:Jt(this,a,l).then(p=>{this.ack(r,p)});break;case Dt.RESTART_ICE:case Dt.EXCHANGE_SDP:case Dt.SUBSCRIBE:case Dt.UNSUBSCRIBE:Jt(this._signal,a,l).then(p=>{this.ack(r,p)}).catch(p=>{this.ack(i._id,void 0,!0)});break;case Dt.CANDIDATE:this._signal.emit(a,l),this.ack(r);break;case Dt.JOIN:this.emit(a,JSON.parse(l));break;default:this.emit(a,l),this.ack(r)}}_splitMessage(i){if(i.length<cv.MAX_MESSAGE_SIZE)return[i];const r=[],a=Fe(6,"");let l=0;const d=Math.ceil(i.length/800);for(;i.length>0;){l++;const h=i.slice(0,800);r.push({id:a,index:l,total:d,payload:h}),i=i.slice(800)}return r.map(h=>JSON.stringify(h))}clear(){this._sequence=0,this._userMap.clear()}}C(cv,"MAX_MESSAGE_SIZE",1024);class dN extends zt{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===Ke.CONNECTED?this.emit(he.WS_CONNECTED):i===Ke.RECONNECTING?this.emit(he.WS_RECONNECTING,this._websocketReconnectReason):i===Ke.CLOSED&&this.emit(he.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(i,r){super(),C(this,"_disconnectedReason",void 0),C(this,"_websocketReconnectReason",void 0),C(this,"_connectionState",Ke.CLOSED),C(this,"reconnectToken",void 0),C(this,"_userInRoom",!1),C(this,"_userOnlineTime",void 0),C(this,"websocket",void 0),C(this,"openConnectionTime",void 0),C(this,"clientId",void 0),C(this,"lastMsgTime",Date.now()),C(this,"uploadCache",[]),C(this,"uploadCacheInterval",void 0),C(this,"rttRolling",new en(5)),C(this,"pingpongTimer",void 0),C(this,"wsInflateDataTimer",void 0),C(this,"pingpongTimeoutCount",0),C(this,"joinResponse",void 0),C(this,"multiIpOption",void 0),C(this,"initError",void 0),C(this,"spec",void 0),C(this,"store",void 0),C(this,"_external_signal",void 0),C(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(he.ON_BINARY_DATA,a.data);const l=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(l,"_id")){const d="res-@".concat(l._id);this.emit(d,l._result,l._message)}else if(Object.prototype.hasOwnProperty.call(l,"_type")){switch(l._type){case Ue.ON_DATA_STREAM:return void this.handleDataStream(l._message);case Ue.MUTE_AUDIO:case Ue.MUTE_VIDEO:case Ue.ON_P2P_LOST:return;case Ue.ON_USER_ONLINE:this.emit(l._type,l._message);const{uid:d}=l._message;return this._external_signal.setStart(d),void this._external_signal.send(Dt.JOIN,{onlineTime:this._userOnlineTime},!0)}if(this.emit(l._type,l._message),l._type===Ue.ON_NOTIFICATION&&this.handleNotification(l._message),l._type===Ue.ON_USER_BANNED)switch(l._message.error_code){case 14:this.close(Ye.UID_BANNED);break;case 15:this.close(Ye.IP_BANNED);break;case 16:this.close(Ye.CHANNEL_BANNED)}if(l._type===Ue.ON_USER_LICENSE_BANNED)switch(l._message.error_code){case Ie.ERR_LICENSE_MISSING:this.close(Ye.LICENSE_MISSING);break;case Ie.ERR_LICENSE_EXPIRED:this.close(Ye.LICENSE_EXPIRED);break;case Ie.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ye.LICENSE_MINUTES_EXCEEDED);break;case Ie.ERR_LICENSE_PERIOD_INVALID:this.close(Ye.LICENSE_PERIOD_INVALID);break;case Ie.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ye.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ie.ERR_LICENSE_ILLEGAL:this.close(Ye.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=i.clientId,this.spec=i,this.store=r,this.websocket=new yE("gateway-".concat(this.clientId),this.spec.retryConfig,!0,j("JOIN_GATEWAY_USE_DUAL_DOMAIN"),j("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ke.CONNECTED&&this.reconnect("retry",qn.OFFLINE)}),this._external_signal=new cv(this),this._handleSignalP2PEvents()}request(i,r,a,l){var d=this;return M(function*(){const h=Fe(6,""),p={_id:h,_type:i,_message:r},m=d.websocket.connectionID,g=()=>new q((P,D)=>{if(d.connectionState===Ke.CONNECTED)return P();const L=()=>{d.off(he.WS_CLOSED,B),P()},B=()=>{d.off(he.WS_CONNECTED,L),D(new J(x.WS_ABORT))};d.once(he.WS_CONNECTED,L),d.once(he.WS_CLOSED,B),i!==Ce.PUBLISH&&i!==Ce.SUBSCRIBE&&i!==Ce.UNSUBSCRIBE&&i!==Ce.UNPUBLISH&&i!==Ce.CONTROL&&i!==Ce.RESTART_ICE||d.once(he.DISCONNECT_P2P,()=>{D(new J(x.DISCONNECT_P2P))}),i!==Ce.PUBLISH&&i!==Ce.RESTART_ICE||d.once(he.ABORT_P2P_EXECUTION,()=>{D(new J(x.DISCONNECT_P2P))})});if(d.connectionState!==Ke.CONNECTING&&d.connectionState!==Ke.RECONNECTING||i===Ce.JOIN||i===Ce.REJOIN||(yield g()),d.websocket.sendMessage(p,!0),l)return;const E=new q((P,D)=>{let L=!1;const B=(Q,se)=>{L=!0,P({isSuccess:"success"===Q,message:se||{}}),d.off(he.WS_CLOSED,V),d.off(he.WS_RECONNECTING,V),d.emit(he.REQUEST_SUCCESS,i,r)};d.once("res-@".concat(h),B);const V=()=>{D(new J(x.WS_ABORT,"type: ".concat(i))),d.off(he.WS_CLOSED,V),d.off(he.WS_RECONNECTING,V),d.off("res-@".concat(h),B)};d.once(he.WS_CLOSED,V),d.once(he.WS_RECONNECTING,V),_i(j("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||L||(w.warning("[".concat(d.clientId,"] ws request timeout, type: ").concat(i)),d.emit(he.REQUEST_TIMEOUT,i,r))})});let y=null;try{y=yield E}catch(P){if(d.connectionState===Ke.CLOSED||i===Ce.LEAVE)throw new J(x.WS_ABORT);return!d.spec.forceWaitGatewayResponse||a?P.throw():i===Ce.JOIN||i===Ce.REJOIN?null:(yield g(),yield d.request(i,r))}if(y.isSuccess)return y.message;const b=Number(y.message.error_code||y.message.code),T=El(b),O=new J(x.UNEXPECTED_RESPONSE,"".concat(T.desc,": ").concat(y.message.error_str),{code:b,data:y.message});return"success"===T.action?y.message:(w.warning("[".concat(d.clientId,"] [").concat(d.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(b,", message: ").concat(T.desc,", action: ").concat(T.action)),b===Ie.ERR_TOO_MANY_BROADCASTERS?((i===Ce.JOIN||i===Ce.REJOIN)&&(d.initError=O,d.close()),O.throw()):"failed"===T.action?O.throw():"quit"===T.action?(d.initError=O,d.close(),O.throw()):(b===Ie.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=y.message.option,w.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",qn.MULTI_IP)):d.reconnect(T.action,qn.SERVER_ERROR),i===Ce.JOIN||i===Ce.REJOIN?null:yield d.request(i,r)))})()}waitMessage(i,r){return new q(a=>{const l=d=>{(!r||r(d))&&(this.off(i,l),a(d))};this.on(i,l)})}upload(i,r){const a={_type:i,_message:r};try{this.websocket.sendMessage(a)}catch{const d=j("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ke.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},j("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,r){this.websocket.sendMessage({_type:i,_message:r})}sendExtensionMessage(i,r,a){var l=this;return M(function*(){return yield l.waitTillUserOnline(),yield l._external_signal.send(i,r,a)})()}init(i,r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new q((a,l)=>{this.once(he.WS_CONNECTED,()=>a(this.joinResponse)),this.once(he.WS_CLOSED,()=>l(this.initError||new J(x.WS_ABORT))),this.connectionState=Ke.CONNECTING,this.websocket.init(i).catch(l),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=i||Ye.LEAVE,this.connectionState=Ke.CLOSED,w.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),i===Ye.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new yE("gateway-".concat(this.clientId),this.spec.retryConfig,!0,j("JOIN_GATEWAY_USE_DUAL_DOMAIN"),j("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}join(){var i=this;return M(function*(){if(!i.joinResponse){i.emit(he.ABORT_P2P_EXECUTION);const r=yield Jt(i,he.REQUEST_JOIN_INFO),a=yield i.request(Ce.JOIN,r);if(!a)return i.emit(he.REPORT_JOIN_GATEWAY,x.TIMEOUT,i.url||""),!1;i.joinResponse=a,i.emit(he.JOIN_RESPONSE,i.joinResponse),i.reconnectToken=i.joinResponse.rejoin_token}return i.connectionState=Ke.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),i._userOnlineTime=(new Date).getTime(),i._external_signal.clear(),!0})()}rejoin(){var i=this;return M(function*(){if(!i.reconnectToken)throw new J(x.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=uc(i,he.REQUEST_REJOIN_INFO);return r.token=i.reconnectToken,!!(yield i.request(Ce.REJOIN,r))&&(i.connectionState=Ke.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),!0)})()}reconnect(i,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,r)}handleDataStream(i){try{var r;const a=Qg(i.payload),l=(new TextDecoder).decode(a),d=JSON.parse(l);"total"in d&&"id"in d||ye(r=Object.values(Dt)).call(r,d._type)?(i.seq&&delete i.seq,d._uid=i.uid,this._external_signal.onMessage(d)):this.emit(Ue.ON_DATA_STREAM,i)}catch{}}handleNotification(i){w.debug("[".concat(this.clientId,"] receive notification: "),i);const r=El(i.code);if("success"!==r.action){if("failed"!==r.action)return"quit"===r.action?("ERR_REPEAT_JOIN_CHANNEL"===r.desc&&this.close(Ye.UID_BANNED),void this.close()):void this.reconnect(r.action,qn.SERVER_ERROR);w.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=j("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=i&&(w.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>j("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",qn.TIMEOUT):this.request(Ce.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-r;this.rttRolling.add(a),j("REPORT_STATS")&&this.send(Ce.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWsInflateData(){const{wsInflateLength:i,wsDeflateLength:r}=this.websocket.getWsInflateData();0!==i&&0!==r&&this.upload(Xi.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:i})}handleWebsocketEvents(){this.websocket.on(Me.RECONNECT_WAITTING_FINISH,i=>{this.emit(he.WS_RECONNECT_WAITTING_FINISH,i)}),this.websocket.on(Me.RECONNECT_CREATE_CONNECTION,i=>{this.emit(he.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(Me.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Me.CLOSED,()=>{this.connectionState=Ke.CLOSED}),this.websocket.on(Me.FAILED,()=>{this._disconnectedReason=Ye.NETWORK_ERROR,this.connectionState=Ke.CLOSED}),this.websocket.on(Me.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState=this.connectionState===Ke.CONNECTED?Ke.RECONNECTING:Ke.CONNECTING}),this.websocket.on(Me.WILL_RECONNECT,(i,r,a)=>{if(uc(this,he.IS_P2P_DISCONNECTED)&&"retry"===i)return w.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(he.NEED_RENEW_SESSION),this.emit(he.DISCONNECT_P2P),a("tryNext");"retry"!==i&&(w.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(i)),this.reconnectToken=void 0,this.emit(he.NEED_RENEW_SESSION),this.emit(he.DISCONNECT_P2P)),a(i)}),this.websocket.on(Me.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(i=>{w.warning("[".concat(this.clientId,"] rejoin failed ").concat(i)),this.reconnect("tryNext",qn.SERVER_ERROR)}):this.join().catch(i=>{if(this.emit(he.REPORT_JOIN_GATEWAY,i.message||i.code,this.url||""),i instanceof J&&i.code===x.UNEXPECTED_RESPONSE&&i.data.code===Ie.ERR_NO_AUTHORIZED)return w.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",qn.SERVER_ERROR);w.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",qn.SERVER_ERROR):(this.initError=i,this.close())})}),this.websocket.on(Me.REQUEST_NEW_URLS,(i,r)=>{Jt(this,he.REQUEST_RECOVER,this.multiIpOption).then(i).catch(r)}),this.websocket.on(Me.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}_handleSignalP2PEvents(){var i=this;this._external_signal.on(Dt.JOIN,function(){var r=M(function*(a){if(i._userOnlineTime&&i._userOnlineTime<a.onlineTime){const l=yield Jt(i,he.P2P_START,void 0),d=yield i._external_signal.send(Dt.CALL,l);i.emit(he.P2P_CONNECTION,d,!0)}i._userInRoom=!0,i.emit("user-online")});return function(a){return r.apply(this,arguments)}}()),this.on(Ue.ON_USER_OFFLINE,function(){var r=M(function*(a){i._external_signal.clear(),i._userInRoom=!1});return function(a){return r.apply(this,arguments)}}()),this._external_signal.on(Dt.CALL,function(){var r=M(function*(a,l,d){i._userInRoom=!0,i.emit("user-online");try{l(yield Jt(i,he.P2P_START,a))}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}())}waitTillUserOnline(){var i=this;return M(function*(){return new q(r=>{if(i._userInRoom)r();else{const a=()=>{i.off("user-online",a),r()};i.on("user-online",a)}})})()}}function uN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function ws(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?uN(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):uN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}const Wd=new Map;class p2 extends zt{get state(){return this._state}set state(i){if(i===this._state)return;const r=this._state;this._state=i,"DISCONNECTED"===i&&this._disconnectedReason?this.emit(sn.CONNECTION_STATE_CHANGE,i,r,this._disconnectedReason):this.emit(sn.CONNECTION_STATE_CHANGE,i,r)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(i){w.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(i)),this._joinGatewayStartTime=i}constructor(i,r){super(),C(this,"store",void 0),C(this,"joinInfo",void 0),C(this,"key",void 0),C(this,"ntpOffset",0),C(this,"signal",void 0),C(this,"role",void 0),C(this,"inChannelInfo",{joinAt:null,duration:0}),C(this,"spec",void 0),C(this,"_state","DISCONNECTED"),C(this,"_statsCollector",void 0),C(this,"_disconnectedReason",void 0),C(this,"isSignalRecover",!1),C(this,"hasChangeBGPAddress",!1),C(this,"trafficStatsInterval",void 0),C(this,"networkQualityInterval",void 0),C(this,"_joinGatewayStartTime",0),C(this,"_signalTimeout",!1),C(this,"_clientRoleOptions",void 0),C(this,"_isProactiveJoin",!1),this.store=i,this.spec=r,this.signal=this.store.useP2P?new dN(ws(ws({},r),{},{retryConfig:r.websocketRetryConfig}),i):this.store.useDataChannel?new ta(ws(ws({},r),{},{retryConfig:r.websocketRetryConfig}),i):new WD(ws(ws({},r),{},{retryConfig:r.websocketRetryConfig}),i),this._statsCollector=r.statsCollector,this.role=r.role||"audience",this._clientRoleOptions=r.clientRoleOptions,this.handleSignalEvents()}join(i,r,a){var l=this;return M(function*(){if(l.signal instanceof ta){let g=!1;"disabled"!==i.cloudProxyServer?(w.debug("[".concat(l.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(i.cloudProxyServer,")")),g=!0):"".concat(i.apResponse.cid,"_").concat(i.apResponse.cert).length>255||"".concat(i.apResponse.cid,"_").concat(i.apResponse.cert).length<22?(w.debug("[".concat(l.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),g=!0):i.apResponse.addresses.some(E=>E.fingerprint)||j("FINGERPRINT")||(w.debug("[".concat(l.store.clientId,"] Dc is not supported, because fingerprint does not exist")),g=!0),g&&l.resetSignal()}l.store.joinGatewayStart(),"disabled"!==i.cloudProxyServer&&(l.hasChangeBGPAddress=!0);const d=Date.now();let h=Wd.get(i.cname);if(h||(h=new Map,Wd.set(i.cname,h)),l._isProactiveJoin=!0,h.has(i.uid)){const g=new W(x.UID_CONFLICT);throw Se.joinGateway(i.sid,{lts:d,succ:!1,ec:g.message,addr:null,uid:i.uid,cid:i.cid,firstSuccess:l._isProactiveJoin,avoidJoinStartTime:l.store.avoidJoinStart,isProxy:!!i.proxyServer,signalChannel:l.signal instanceof ta?"1":"0"}),l._isProactiveJoin=!1,g}h.set(i.uid,!0),l.joinInfo=i,l.key=r;let p=0;l.joinGatewayStartTime=d;const m=i.proxyServer;try{let g;if(w.debug("[".concat(l.store.clientId,"] use ").concat(l.signal instanceof ta?"datachannel":"websocket"," join uid ").concat(p)),l.signal instanceof ta)g=yield l.signal.init(i.apResponse.addresses,a);else{const E=i.gatewayAddrs.map(y=>{let{address:b}=y;const[T,O]=b.split(":"),P={host:T,port:O};return i.proxyServer&&(P.proxy=i.proxyServer),P});g=yield l.signal.init(E,a)}p=g.uid,w.debug("[".concat(l.store.clientId,"] ").concat(l.signal instanceof ta?"datachannel":"websocket"," join uid ").concat(p," cost ").concat(Date.now()-l.joinGatewayStartTime))}catch(g){throw g&&g.code===x.INIT_WEBSOCKET_TIMEOUT?(w.warning("[".concat(l.store.clientId,"] User join failed"),g.toString()),g):g&&g.code===x.INIT_DATACHANNEL_TIMEOUT?(w.warning("[".concat(l.store.clientId,"] User join datachannel failed"),g.toString()),l.resetSignal(),g):(w.error("[".concat(l.store.clientId,"] User join failed"),g.toString()),Se.joinGateway(i.sid,{lts:d,succ:!1,ec:g.message,addr:l.signal.url,uid:i.uid,cid:i.cid,firstSuccess:l._isProactiveJoin,avoidJoinStartTime:l.store.avoidJoinStart,isProxy:!!m,signalChannel:l.signal instanceof ta?"1":"0"}),l._isProactiveJoin=!1,h.delete(i.uid),l.signal.close(),g)}return l.state="CONNECTED",l.inChannelInfo.joinAt=Date.now(),w.debug("[".concat(l.store.clientId,"] Connected to gateway server")),l.trafficStatsInterval=window.setInterval(()=>{l.updateTrafficStats().catch(g=>{w.warning("[".concat(l.store.clientId,"] get traffic stats error"),g.toString())})},3e3),l.networkQualityInterval=window.setInterval(()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?l.emit(sn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):l.emit(sn.NETWORK_QUALITY,l._signalTimeout?{downlinkNetworkQuality:5,uplinkNetworkQuality:5}:"CONNECTED"===l.state&&l._statsCollector.trafficStats?{uplinkNetworkQuality:av(l._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:av(l._statsCollector.trafficStats.B_dnq)}:{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),l.store.joinGatewayEnd(),p})()}leave(){var i=arguments,r=this;return M(function*(){let a=i.length>0&&void 0!==i[0]&&i[0],l=i.length>1?i[1]:void 0;if("DISCONNECTED"!==r.state){l!==Ye.FALLBACK&&(r.state="DISCONNECTING");try{a||r.signal.connectionState!==Ke.CONNECTED||(yield(d=r.signal.request(Ce.LEAVE,void 0,!0),3e3,q.race([d,jk(3e3)])))}catch(d){w.warning("[".concat(r.store.clientId,"] leave request failed, ignore"),d)}r.signal.close(l),l!==Ye.FALLBACK&&(r.state="DISCONNECTED"),r.reset()}var d})()}publish(i,r,a){var l=this;return M(function*(){if("CONNECTED"!==l.state&&"RECONNECTING"!==l.state)throw new W(x.INVALID_OPERATION,"can not publish when connection state is ".concat(l.state));const d={state:"offer",p2p_id:l.store.p2pId,ortc:r,mode:l.spec.mode,extend:j("PUB_EXTEND"),twcc:!!j("PUBLISH_TWCC"),rtx:!!j("USE_PUB_RTX")};try{return(yield l.signal.request(Ce.PUBLISH,d,!0))._message}catch(h){if(a&&h.data&&h.data.code===Ie.ERR_PUBLISH_REQUEST_INVALID)return w.warning("[".concat(l.store.clientId,"] receive publish error code, retry"),h.toString()),yield l.tryUnpubBeforeRepub(i,r),l.publish(i,r,!1);throw h}})()}publishDataChannel(i,r,a){var l=this;return M(function*(){var d;if("CONNECTED"!==l.state&&"RECONNECTING"!==l.state)throw new W(x.INVALID_OPERATION,"can not publish when connection state is ".concat(l.state));const h={stream_id:r.streamId,ordered:r.ordered?1:0,max_retrans_times:null!==(d=r.maxRetransmits)&&void 0!==d?d:10,channel_id:r.channelId,metadata:r.metadata};try{yield l.signal.request(Ce.PUBLISH_DATASTREAM,h,!0)}catch(p){if(a&&p.data&&p.data.code===Ie.ERR_PUBLISH_REQUEST_INVALID)return w.warning("[".concat(l.store.clientId,"] receive publish datachannels error code, retry"),p.toString()),yield l.tryUnpubDataChannelBeforeRepub(i,r),l.publishDataChannel(i,r,!1);throw p}})()}unpublish(i,r){var a=this;return M(function*(){try{if("CONNECTED"!==a.state&&"RECONNECTING"!==a.state)throw new W(x.INVALID_OPERATION,"can not publish when connection state is ".concat(a.state));yield a.signal.request(Ce.UNPUBLISH,{stream_id:r,ortc:i},!0)}catch(l){w.warning("[".concat(a.store.clientId,"] unpublish warning: "),l)}})()}unpublishDataChannel(i){var r=this;return M(function*(){try{if("CONNECTED"!==r.state&&"RECONNECTING"!==r.state)throw new W(x.INVALID_OPERATION,"can not publish when connection state is ".concat(r.state));yield q.all(i.map(a=>r.signal.request(Ce.UNPUBLISH_DATASTREAM,{channel_id:a},!0)))}catch(a){w.warning("unpublish datachannels warning: ",a)}})()}subscribe(i,r,a){var l=this;return M(function*(){if("CONNECTED"!==l.state&&"RECONNECTING"!==l.state)throw new W(x.INVALID_OPERATION,"can not subscribe when connection state is ".concat(l.state));const d={stream_id:i,stream_type:r.stream_type,mode:l.spec.mode,codec:l.spec.codec,p2p_id:l.store.p2pId,twcc:!!j("SUBSCRIBE_TWCC"),rtx:!!j("USE_SUB_RTX"),extend:j("SUB_EXTEND"),ssrcId:r.ssrcId,svc:Array.isArray(j("SVC"))&&0!==j("SVC").length?j("SVC"):void 0};try{return(yield l.signal.request(Ce.SUBSCRIBE,d,!0))._message}catch(h){if(a&&h.data&&h.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(l.store.clientId,"] receiver subscribe error code, retry"),h.toString()),yield l.tryUnsubBeforeResub(i,r),yield l.subscribe(i,r,!1);throw h}})()}subscribeDataChannel(i,r,a){var l=this;return M(function*(){if("CONNECTED"!==l.state&&"RECONNECTING"!==l.state)throw new W(x.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(l.state));const d={uid:i,stream_id:r.id,channel_id:r.datachannelId};try{return void(yield l.signal.request(Ce.SUBSCRIBE_DATASTREAM,d,!0))}catch(h){if(a&&h.data&&h.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(l.store.clientId,"] receiver subscribe datachannel error code, retry"),h.toString()),yield l.tryUnsubDataChannelBeforeResub(i,r),yield l.subscribeDataChannel(i,r,!1);throw h}})()}subscribeAll(i,r){var a=this;return M(function*(){if("CONNECTED"!==a.state&&"RECONNECTING"!==a.state)throw new W(x.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(a.state));const l={p2p_id:a.store.p2pId,users:i,dtx:!1,rtx:!!j("USE_SUB_RTX")};try{return yield a.signal.request(Ce.SUBSCRIBE_STREAMS,l,!0)}catch(d){if(r&&d.data&&d.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(a.store.clientId,"] receiver massSubscribe error code, retry"),d.toString()),yield a.tryMassUnsubBeforeResub(i),yield a.subscribeAll(i,!1);throw d}})()}setVideoProfile(i){var r=this;return M(function*(){const a=function(l){if(!(l.bitrateMax&&l.bitrateMin&&l.frameRate&&l.height&&l.width))return;let d=l.frameRate,h=l.width,p=l.height,m=!0;return"number"!=typeof d&&(d=d.exact||d.ideal||d.max||d.min||0,d||(m=!1)),"number"!=typeof h&&(h=h.exact||h.ideal||h.max||h.min||0,h||(m=!1)),"number"!=typeof p&&(p=p.exact||p.ideal||p.max||p.min||0,d||(m=!1)),m?{stream_type:0,width:h,height:p,fps:d,start_bps:1e3*l.bitrateMax,min_bps:1e3*l.bitrateMin,target_bps:1e3*l.bitrateMax}:void 0}(i);if(a)return r.signal.request(Ce.SET_VIDEO_PROFILE,a);w.debug("[".concat(r.store.clientId,"] encoder config is not complete, do not report to gateway"))})()}unsubscribe(i,r){var a=this;return M(function*(){try{yield a.signal.request(Ce.UNSUBSCRIBE,{p2p_id:a.store.p2pId,ortc:i,stream_id:r},!0)}catch(l){w.warning("[".concat(a.store.clientId,"] unsubscribe warning: "),l)}})()}unsubscribeDataChannel(i,r){var a=this;return M(function*(){try{if("CONNECTED"!==a.state&&"RECONNECTING"!==a.state)throw new W(x.INVALID_OPERATION,"can not publish when connection state is ".concat(a.state));yield q.all(i.map(l=>a.signal.request(Ce.UNSUBSCRIBE_DATASTREAM,{stream_id:l,uid:r},!0)))}catch(l){w.warning("unsubscribeDataChannel warning: ",l)}})()}massUnsubscribe(i){var r=this;return M(function*(){try{yield r.signal.request(Ce.UNSUBSCRIBE_STREAMS,i,!0)}catch(a){w.warning("[".concat(r.store.clientId,"] massUnsubscribeAll warning: "),a)}})()}reconnectPC(i){var r=this;return M(function*(){const{iceParameters:a,dtlsParameters:l,rtpCapabilities:d}=i;return{gatewayEstablishParams:yield r.signal.request(Ce.CONNECT_PC,{p2p_id:r.store.p2pId,stream_id:r.store.uid,ortc:{iceParameters:a,dtlsParameters:l,rtpCapabilities:d}},!0),gatewayAddress:r.getCurrentGatewayAddress()}})()}getGatewayInfo(){return this.signal.request(Ce.GATEWAY_INFO)}renewToken(i){var r=this;return M(function*(){yield r.signal.request(Ce.RENEW_TOKEN,i),r.key=i.token})()}setClientRole(i,r){var a=this;return M(function*(){if(r&&(a._clientRoleOptions=Object.assign({},r)),"CONNECTED"!==a.state)return void(a.role=i);let l,d=0;"audience"===i?a._clientRoleOptions&&a._clientRoleOptions.delay?(l=a._clientRoleOptions.delay,d=1):d=a._clientRoleOptions&&a._clientRoleOptions.level?a._clientRoleOptions.level:2:d=0,yield a.signal.request(Ce.SET_CLIENT_ROLE,{role:i,level:d,delay:l,client_ts:Date.now()}),a.role=i})()}setRemoteVideoStreamType(i,r){var a=this;return M(function*(){yield a.signal.request(Ce.SWITCH_VIDEO_STREAM,{stream_id:i,stream_type:r})})()}setDefaultRemoteVideoStreamType(i){var r=this;return M(function*(){yield r.signal.request(Ce.DEFAULT_VIDEO_STREAM,{stream_type:i})})()}setStreamFallbackOption(i,r){var a=this;return M(function*(){yield a.signal.request(Ce.SET_FALLBACK_OPTION,{stream_id:i,fallback_type:r})})()}pickSVCLayer(i,r){var a=this;return M(function*(){yield a.signal.request(Ce.PICK_SVC_LAYER,{stream_id:i,spatial_layer:r.spatialLayer,temporal_layer:r.temporalLayer})})()}setRTM2Flag(i){var r=this;return M(function*(){yield r.signal.request(Ce.SET_RTM2_FLAG,{rtm2_flag:i})})()}sendExtensionMessage(i,r,a){var l=this;return M(function*(){if(l.signal instanceof dN)return l.signal.sendExtensionMessage(i,r,a)})()}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),ws({},this.inChannelInfo)}getGatewayVersion(){var i=this;return M(function*(){return(yield i.signal.request(Ce.GATEWAY_INFO)).version})()}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const i=Wd.get(this.joinInfo.cname);i&&i.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const i=function(r){let a;return a=r.startsWith("dc")?r.match(/(dc\:\/\/)?([^:]+):(\d+)/):r.match(/(wss\:\/\/)?([^:]+):(\d+)/),a?{username:Eo.username,password:Eo.password,turnServerURL:a[2],tcpport:parseInt(a[3])+30,udpport:parseInt(a[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],i&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(ws(ws({},Eo),{},{turnServerURL:i.turnServerURL,tcpport:i.tcpport,udpport:i.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}updateTrafficStats(){var i=this;return M(function*(){if("CONNECTED"!==i.state)return;const r=yield i.signal.request(Ce.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),null!=r.ntp_offset&&(i.ntpOffset=r.ntp_offset),r.peer_delay.forEach(a=>{const l=i._statsCollector.trafficStats&&i._statsCollector.trafficStats.peer_delay.find(d=>d.peer_uid===a.peer_uid);l&&l.B_st!==a.B_st&&mo(()=>{i.emit(sn.STREAM_TYPE_CHANGE,a.peer_uid,a.B_st)})}),i._statsCollector.updateTrafficStats(r)})()}getJoinMessage(i){if(!this.joinInfo||!this.key)throw new W(x.UNEXPECTED_ERROR,"can not generate join message, no join info");const r=Object.assign({},this.joinInfo.apResponse);let a=j("REPORT_APP_SCENARIO");if("string"!=typeof a)try{a=JSON.stringify(a)}catch{a=void 0}a&&a.length>128&&(a=void 0);const l=ws({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Yo,browser:navigator.userAgent,process_id:j("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:r,extend:j("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:a,attributes:{userAttributes:{enablePublishedUserList:j("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:j("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:"number"==typeof j("SUBSCRIBE_AUDIO_FILTER_TOPN")?j("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:"boolean"==typeof j("ENABLE_PUBLISH_AUDIO_FILTER")?j("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:"boolean"==typeof j("ENABLE_USER_LICENSE_CHECK")?j("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:!0===j("USE_PUB_RTX")||!0===j("USE_SUB_RTX")||void 0,disableFEC:j("DISABLE_FEC"),enableNTPReport:!!j("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!j("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:"boolean"==typeof j("ENABLE_DATASTREAM_2")?j("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:"number"==typeof j("RTM2_FLAG")?j("RTM2_FLAG"):void 0,enableUserAutoRebalanceCheck:!!j("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:"boolean"==typeof j("USE_XR")?j("USE_XR"):void 0}},join_ts:this.joinGatewayStartTime},i);return this.joinInfo.stringUid&&(l.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(l.aes_mode=this.joinInfo.aesmode,j("ENCRYPT_AES")?(l.aes_secret=this.joinInfo.aespassword,l.aes_encrypt=!0):l.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(l.aes_salt=this.joinInfo.aessalt)),r.addresses[this.signal.websocket.currentURLIndex]&&(l.ap_response.ticket=r.addresses[this.signal.websocket.currentURLIndex].ticket,delete r.addresses),void 0!==this.joinInfo.defaultVideoStream&&(l.default_video_stream=this.joinInfo.defaultVideoStream),l}getRejoinMessage(){if(!this.joinInfo)throw new W(x.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){var i=this;this.signal.on(he.WS_RECONNECT_WAITTING_FINISH,r=>{var a;ye(a=["tryNext","recover"]).call(a,r)&&this.joinInfo&&Se.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(he.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(he.WS_RECONNECTING,r=>{this.joinInfo&&Se.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||qn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Se.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(he.WS_CLOSED,r=>{let a;switch(r){case Ye.LEAVE:a=qn.LEAVE;break;case Ye.UID_BANNED:case Ye.IP_BANNED:case Ye.CHANNEL_BANNED:case Ye.SERVER_ERROR:a=qn.SERVER_ERROR;break;case Ye.FALLBACK:a=qn.FALLBACK;break;case Ye.LICENSE_MISSING:case Ye.LICENSE_EXPIRED:case Ye.LICENSE_MINUTES_EXCEEDED:case Ye.LICENSE_PERIOD_INVALID:case Ye.LICENSE_MULTIPLE_SDK_SERVICE:case Ye.LICENSE_ILLEGAL:case Ye.TOKEN_EXPIRE:a=r;break;default:a=qn.NETWORK_ERROR}w.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(a||"undefined -> "+qn.NETWORK_ERROR)),this.joinInfo&&Se.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===Ye.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:a}),this._disconnectedReason=r,r!==Ye.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(he.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&("audience"===this.role&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(w.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),Se.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof ta?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion)){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void w.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));At("EVENT_REPORT_DOMAIN",r[1]),At("EVENT_REPORT_BACKUP_DOMAIN",r[1]),At("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}),this.signal.on(Ue.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(he.REQUEST_RECOVER,(r,a,l)=>{if(!this.joinInfo)return l(new W(x.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Jt(this,sn.REQUEST_NEW_GATEWAY_LIST).then(a).catch(l)}),this.signal.on(he.REQUEST_JOIN_INFO,function(){var r=M(function*(a){var l;if(i.updateTurnConfigFromSignal(),i.store.useP2P)return void a(i.getJoinMessage({ortc:{}}));const{iceParameters:d,dtlsParameters:h,rtpCapabilities:p}=yield Jt(i,sn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:null===(l=i.joinInfo)||void 0===l?void 0:l.turnServer});a(i.getJoinMessage({ortc:{iceParameters:d,dtlsParameters:h,rtpCapabilities:p,version:"2"}}))});return function(a){return r.apply(this,arguments)}}()),this.signal.on(he.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(he.REPORT_JOIN_GATEWAY,(r,a)=>{this.joinInfo&&(Se.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,addr:a,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof ta?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(he.IS_P2P_DISCONNECTED,r=>{r(uc(this,sn.IS_P2P_DISCONNECTED))}),this.signal.on(he.DISCONNECT_P2P,()=>{this.emit(sn.DISCONNECT_P2P)}),this.signal.on(he.NEED_RENEW_SESSION,()=>{this.emit(sn.NEED_RENEW_SESSION)}),this.signal.on(he.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(he.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(he.JOIN_RESPONSE,r=>{const a=this.getCurrentGatewayAddress();this.emit(sn.JOIN_RESPONSE,r,a)}),this.signal.on(he.DATACHANNEL_PRECONNECT,function(){var r=M(function*(a,l,d){i.updateTurnConfigFromSignal();const h=i.getCurrentGatewayAddress();return Jt(i,sn.DATACHANNEL_PRECONNECT,a,h).then(l).catch(d)});return function(a,l,d){return r.apply(this,arguments)}}()),this.signal.on(he.DATACHANNEL_CONNECTING,function(){var r=M(function*(a){const{iceParameters:l,dtlsParameters:d,rtpCapabilities:h}=yield Jt(i,sn.REQUEST_DC_CONNECTION_PARAMS);a(i.getJoinMessage({ortc:{iceParameters:l,dtlsParameters:d,rtpCapabilities:h,version:"2"}}))});return function(a){return r.apply(this,arguments)}}()),this.signal.on(he.DATACHANNEL_FAILBACK,()=>{w.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(sn.DATACHANNEL_FAILBACK)})}tryUnsubBeforeResub(i,r){var a=this;return M(function*(){try{yield a.signal.request(Ce.UNSUBSCRIBE,{p2p_id:a.store.p2pId,stream_id:i,ortc:[r]},!0)}catch(l){throw w.warning("[".concat(a.store.clientId,"] tryUnsubBeforeResub warning"),l),l}})()}tryUnsubDataChannelBeforeResub(i,r){var a=this;return M(function*(){try{yield a.signal.request(Ce.UNSUBSCRIBE,{stream_id:r.id},!0)}catch(l){throw w.warning("unsubscribe datachannel warning",l),l}})()}tryUnpubBeforeRepub(i,r){var a=this;return M(function*(){try{yield a.signal.request(Ce.UNPUBLISH,{stream_id:i,ortc:r},!0)}catch(l){throw w.warning("[".concat(a.store.clientId,"] tryUnpubBeforeRepub warning: "),l),l}})()}tryUnpubDataChannelBeforeRepub(i,r){var a=this;return M(function*(){try{yield a.signal.request(Ce.UNPUBLISH_DATASTREAM,{channnel_id:r.channelId},!0)}catch(l){throw w.warning("unpublish datastream warning: ",l),l}})()}tryMassUnsubBeforeResub(i){var r=this;return M(function*(){const a={users:i.map(l=>({stream_id:l.stream_id,stream_type:l.stream_type}))};try{yield r.signal.request(Ce.UNSUBSCRIBE_STREAMS,a,!0)}catch(l){throw w.warning("[".concat(r.store.clientId,"] tryMassUnsubBeforeResub warning"),l),l}})()}muteLocal(i,r){var a=this;return M(function*(){const l={action:i.find(d=>d.stream_type===It.Audio)?"mute_local_audio":"mute_local_video",p2p_id:a.store.p2pId,ortc:i,stream_id:r};try{yield a.signal.request(Ce.CONTROL,l,!0,!0)}catch(d){throw w.warning("[".concat(a.store.clientId,"] gateway muteLocal warning: "),d),d}})()}unmuteLocal(i,r){var a=this;return M(function*(){const l={action:i.find(d=>d.stream_type===It.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:a.store.p2pId,ortc:i,stream_id:r};try{yield a.signal.request(Ce.CONTROL,l,!0,!0)}catch(d){throw w.warning("[".concat(a.store.clientId,"] gateway unmuteLocal warning: "),d),d}})()}muteRemote(i,r){var a=this;return M(function*(){const l={action:i===Ee.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:a.store.p2pId,stream_id:r};try{yield a.signal.request(Ce.CONTROL,l,!0,!0)}catch(d){throw w.warning("[".concat(a.store.clientId,"] gateway muteRemote warning: "),d),d}})()}unmuteRemote(i,r){var a=this;return M(function*(){const l={action:i===Ee.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:a.store.p2pId,stream_id:r};try{yield a.signal.request(Ce.CONTROL,l,!0,!0)}catch(d){throw w.warning("[".concat(a.store.clientId,"] gateway unmuteRemote warning: "),d),d}})()}uploadStats(i,r){this.signal.upload(i,r)}getSignalRTT(){return this.signal.rtt}restartICE(i){var r=this;return M(function*(){const a={p2p_id:r.store.p2pId,stream_id:r.store.uid,ortc:i};try{return yield r.signal.request(Ce.RESTART_ICE,a,!0)}catch(l){throw w.warning("[".concat(r.store.clientId,"] P2PChannel.restartICE warning: "),l),l}})()}reconnect(){"CONNECTED"===this.state&&this.signal.reconnect(void 0,qn.P2P_FAILED)}getCurrentGatewayAddress(){var i;if(!j("GATEWAY_WSS_ADDRESS"))return null!==(i=this.joinInfo)&&void 0!==i&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}setPublishAudioFilterEnabled(i){var r=this;return M(function*(){yield r.signal.request(Ce.SET_PARAMETER,{enablePublishAudioFilter:i})})()}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(Ye.FALLBACK)),this.store.useDataChannel=!1,this.signal=new WD(ws(ws({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(sn.RESET_SIGNAL,gE.websocket)}}let Is=0,nn=0;function Mt(s,i,r,a){return new q((l,d)=>{i.timeout=i.timeout||j("HTTP_CONNECT_TIMEOUT"),i.responseType=i.responseType||"json",i.data&&!r?(i.data=JSON.stringify(i.data),Is+=Na(i.data)):r&&(i.data.size?Is+=i.data.size:i.data instanceof FormData?Is+=AS(i.data):Is+=Na(JSON.stringify(i.data))),i.headers=i.headers||{},i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json",i.method="POST",i.url=s,vr.request(i).then(h=>{"string"==typeof h.data?nn+=Na(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?nn+=h.data.byteLength:nn+=Na(JSON.stringify(h.data)),a&&l({data:h.data,headers:h.headers}),l(h.data)}).catch(h=>{vr.isCancel(h)?d(new W(x.OPERATION_ABORTED,"cancel token canceled")):d("ECONNABORTED"===h.code?new W(x.NETWORK_TIMEOUT,h.message):h.response?new W(x.NETWORK_RESPONSE_ERROR,h.response.status):new W(x.NETWORK_ERROR,h.message))})})}!function(){var s;function i(ie){var ce=0;return function(){return ce<ie.length?{done:!1,value:ie[ce++]}:{done:!0}}}var a,r="function"==typeof Object.defineProperties?Object.defineProperty:function(ie,ce,ge){return ie==Array.prototype||ie==Object.prototype||(ie[ce]=ge.value),ie},l=function(ie){ie=["object"==typeof globalThis&&globalThis,ie,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof ou&&ou];for(var ce=0;ce<ie.length;++ce){var ge=ie[ce];if(ge&&ge.Math==Math)return ge}throw Error("Cannot find global object")}(this);function d(ie,ce){if(ce)e:{var ge=l;ie=ie.split(".");for(var Le=0;Le<ie.length-1;Le++){var ut=ie[Le];if(!(ut in ge))break e;ge=ge[ut]}(ce=ce(Le=ge[ie=ie[ie.length-1]]))!=Le&&null!=ce&&r(ge,ie,{configurable:!0,writable:!0,value:ce})}}function h(ie){return(ie={next:ie})[Symbol.iterator]=function(){return this},ie}function p(ie){var ce=typeof Symbol<"u"&&Symbol.iterator&&ie[Symbol.iterator];return ce?ce.call(ie):{next:i(ie)}}if(d("Symbol",function(ie){function ce(ut,de){this.A=ut,r(this,"description",{configurable:!0,writable:!0,value:de})}if(ie)return ie;ce.prototype.toString=function(){return this.A};var ge="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Le=0;return function ut(de){if(this instanceof ut)throw new TypeError("Symbol is not a constructor");return new ce(ge+(de||"")+"_"+Le++,de)}}),d("Symbol.iterator",function(ie){if(ie)return ie;ie=Symbol("Symbol.iterator");for(var ce="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),ge=0;ge<ce.length;ge++){var Le=l[ce[ge]];"function"==typeof Le&&"function"!=typeof Le.prototype[ie]&&r(Le.prototype,ie,{configurable:!0,writable:!0,value:function(){return h(i(this))}})}return ie}),"function"==typeof Object.setPrototypeOf)a=Object.setPrototypeOf;else{var m;e:{var g={};try{g.__proto__={a:!0},m=g.a;break e}catch{}m=!1}a=m?function(ie,ce){if(ie.__proto__=ce,ie.__proto__!==ce)throw new TypeError(ie+" is not extensible");return ie}:null}var E=a;function y(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function b(ie){if(ie.m)throw new TypeError("Generator is already running");ie.m=!0}function T(ie,ce){return ie.h=3,{value:ce}}function O(ie){this.g=new y,this.G=ie}function P(ie,ce,ge,Le){try{var ut=ce.call(ie.g.j,ge);if(!(ut instanceof Object))throw new TypeError("Iterator result "+ut+" is not an object");if(!ut.done)return ie.g.m=!1,ut;var de=ut.value}catch(I){return ie.g.j=null,ie.g.s(I),D(ie)}return ie.g.j=null,Le.call(ie.g,de),D(ie)}function D(ie){for(;ie.g.h;)try{var ce=ie.G(ie.g);if(ce)return ie.g.m=!1,{value:ce.value,done:!1}}catch(ge){ie.g.v=void 0,ie.g.s(ge)}if(ie.g.m=!1,ie.g.l){if(ce=ie.g.l,ie.g.l=null,ce.F)throw ce.D;return{value:ce.return,done:!0}}return{value:void 0,done:!0}}function L(ie){this.next=function(ce){return ie.o(ce)},this.throw=function(ce){return ie.s(ce)},this.return=function(ce){return function(ge,Le){b(ge.g);var ut=ge.g.j;return ut?P(ge,"return"in ut?ut.return:function(de){return{value:de,done:!0}},Le,ge.g.return):(ge.g.return(Le),D(ge))}(ie,ce)},this[Symbol.iterator]=function(){return this}}function B(ie,ce){return ce=new L(new O(ce)),E&&ie.prototype&&E(ce,ie.prototype),ce}if(y.prototype.o=function(ie){this.v=ie},y.prototype.s=function(ie){this.l={D:ie,F:!0},this.h=this.C||this.u},y.prototype.return=function(ie){this.l={return:ie},this.h=this.u},O.prototype.o=function(ie){return b(this.g),this.g.j?P(this,this.g.j.next,ie,this.g.o):(this.g.o(ie),D(this))},O.prototype.s=function(ie){return b(this.g),this.g.j?P(this,this.g.j.throw,ie,this.g.o):(this.g.s(ie),D(this))},d("Array.prototype.entries",function(ie){return ie||function(){return function(ce,ge){ce instanceof String&&(ce+="");var Le=0,ut=!1,de={next:function(){if(!ut&&Le<ce.length){var I=Le++;return{value:ge(I,ce[I]),done:!1}}return ut=!0,{done:!0,value:void 0}}};return de[Symbol.iterator]=function(){return de},de}(this,function(ce,ge){return[ce,ge]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var V=function(ie,ce){for(var ge=0;ge<ie.length;ge++)ce(ie[ge])},Q=function(ie){return ie.replace(/\r?\n|\r/g,"\r\n")},se=function(ie,ce,ge){return ce instanceof Blob?(ce.name===(ge=void 0!==ge?ge+"":"string"==typeof ce.name?ce.name:"blob")&&"[object Blob]"!==Object.prototype.toString.call(ce)||(ce=new File([ce],ge)),[String(ie),ce]):[String(ie),String(ce)]},K=function(ie,ce){if(ie.length<ce)throw new TypeError(ce+" argument required, but only "+ie.length+" present.")},ee="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,$=ee.FormData,Y=ee.XMLHttpRequest&&ee.XMLHttpRequest.prototype.send,_e=ee.Request&&ee.fetch,ve=ee.navigator&&ee.navigator.sendBeacon,Ze=ee.Element&&ee.Element.prototype,yt=ee.Symbol&&Symbol.toStringTag;yt&&(Blob.prototype[yt]||(Blob.prototype[yt]="Blob"),"File"in ee&&!File.prototype[yt]&&(File.prototype[yt]="File"));try{new File([],"")}catch{ee.File=function(ce,ge,Le){return ce=new Blob(ce,Le||{}),Object.defineProperties(ce,{name:{value:ge},lastModified:{value:+(Le&&void 0!==Le.lastModified?new Date(Le.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),yt&&Object.defineProperty(ce,yt,{value:"File"}),ce}}var xn=function(ie){return ie.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Ht=function(ie){this.i=[];var ce=this;ie&&V(ie.elements,function(ge){if(ge.name&&!ge.disabled&&"submit"!==ge.type&&"button"!==ge.type&&!ge.matches("form fieldset[disabled] *"))if("file"===ge.type){var Le=ge.files&&ge.files.length?ge.files:[new File([],"",{type:"application/octet-stream"})];V(Le,function(ut){ce.append(ge.name,ut)})}else"select-multiple"===ge.type||"select-one"===ge.type?V(ge.options,function(ut){!ut.disabled&&ut.selected&&ce.append(ge.name,ut.value)}):"checkbox"===ge.type||"radio"===ge.type?ge.checked&&ce.append(ge.name,ge.value):(Le="textarea"===ge.type?Q(ge.value):ge.value,ce.append(ge.name,Le))})};if((s=Ht.prototype).append=function(ie,ce,ge){K(arguments,2),this.i.push(se(ie,ce,ge))},s.delete=function(ie){K(arguments,1);var ce=[];ie=String(ie),V(this.i,function(ge){ge[0]!==ie&&ce.push(ge)}),this.i=ce},s.entries=function ie(){var ce,ge=this;return B(ie,function(Le){if(1==Le.h&&(ce=0),3!=Le.h)return ce<ge.i.length?Le=T(Le,ge.i[ce]):(Le.h=0,Le=void 0),Le;ce++,Le.h=2})},s.forEach=function(ie,ce){K(arguments,1);for(var ge=p(this),Le=ge.next();!Le.done;Le=ge.next()){var ut=p(Le.value);Le=ut.next().value,ut=ut.next().value,ie.call(ce,ut,Le,this)}},s.get=function(ie){K(arguments,1);var ce=this.i;ie=String(ie);for(var ge=0;ge<ce.length;ge++)if(ce[ge][0]===ie)return ce[ge][1];return null},s.getAll=function(ie){K(arguments,1);var ce=[];return ie=String(ie),V(this.i,function(ge){ge[0]===ie&&ce.push(ge[1])}),ce},s.has=function(ie){K(arguments,1),ie=String(ie);for(var ce=0;ce<this.i.length;ce++)if(this.i[ce][0]===ie)return!0;return!1},s.keys=function ie(){var ce,ge,de=this;return B(ie,function(I){if(1==I.h&&(ce=p(de),ge=ce.next()),3!=I.h)return ge.done?void(I.h=0):T(I,p(ge.value).next().value);ge=ce.next(),I.h=2})},s.set=function(ie,ce,ge){K(arguments,2),ie=String(ie);var Le=[],ut=se(ie,ce,ge),de=!0;V(this.i,function(I){I[0]===ie?de&&(de=!Le.push(ut)):Le.push(I)}),de&&Le.push(ut),this.i=Le},s.values=function ie(){var ce,ge,ut,de=this;return B(ie,function(I){if(1==I.h&&(ce=p(de),ge=ce.next()),3!=I.h)return ge.done?void(I.h=0):((ut=p(ge.value)).next(),T(I,ut.next().value));ge=ce.next(),I.h=2})},Ht.prototype._asNative=function(){for(var ie=new $,ce=p(this),ge=ce.next();!ge.done;ge=ce.next()){var Le=p(ge.value);ge=Le.next().value,Le=Le.next().value,ie.append(ge,Le)}return ie},Ht.prototype._blob=function(){var ie="----formdata-polyfill-"+Math.random(),ce=[],ge="--"+ie+'\r\nContent-Disposition: form-data; name="';return this.forEach(function(Le,ut){return"string"==typeof Le?ce.push(ge+xn(Q(ut))+'"\r\n\r\n'+Q(Le)+"\r\n"):ce.push(ge+xn(Q(ut))+'"; filename="'+xn(Le.name)+'"\r\nContent-Type: '+(Le.type||"application/octet-stream")+"\r\n\r\n",Le,"\r\n")}),ce.push("--"+ie+"--"),new Blob(ce,{type:"multipart/form-data; boundary="+ie})},Ht.prototype[Symbol.iterator]=function(){return this.entries()},Ht.prototype.toString=function(){return"[object FormData]"},Ze&&!Ze.matches&&(Ze.matches=Ze.matchesSelector||Ze.mozMatchesSelector||Ze.msMatchesSelector||Ze.oMatchesSelector||Ze.webkitMatchesSelector||function(ie){for(var ce=(ie=(this.document||this.ownerDocument).querySelectorAll(ie)).length;0<=--ce&&ie.item(ce)!==this;);return-1<ce}),yt&&(Ht.prototype[yt]="FormData"),Y){var li=ee.XMLHttpRequest.prototype.setRequestHeader;ee.XMLHttpRequest.prototype.setRequestHeader=function(ie,ce){li.call(this,ie,ce),"content-type"===ie.toLowerCase()&&(this.B=!0)},ee.XMLHttpRequest.prototype.send=function(ie){ie instanceof Ht?(ie=ie._blob(),this.B||this.setRequestHeader("Content-Type",ie.type),Y.call(this,ie)):Y.call(this,ie)}}_e&&(ee.fetch=function(ie,ce){return ce&&ce.body&&ce.body instanceof Ht&&(ce.body=ce.body._blob()),_e.call(this,ie,ce)}),ve&&(ee.navigator.sendBeacon=function(ie,ce){return ce instanceof Ht&&(ce=ce._asNative()),ve.call(this,ie,ce)}),ee.FormData=Ht}}();const lv=()=>{const s=j("AREAS");return 0===s.length&&s.push(st.GLOBAL),ll(s).call(s,(i,r,a)=>{const l=tm(r);return l?0===a?l:"".concat(i,",").concat(l):i},"")},tm=s=>s===st.OVERSEA?"".concat(ei.ASIA,",").concat(ei.EUROPE,",").concat(ei.AFRICA,",").concat(ei.NORTH_AMERICA,",").concat(ei.SOUTH_AMERICA,",").concat(ei.OCEANIA):ei[s],bc=s=>{const i={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return s.map(r=>{const a=EE[r],l=Object.keys(a);l&&l.map(d=>{"CODE"!==d&&(i[d]=i[d].concat(a[d]))})}),i},zd={GLOBAL:{ASIA:[st.CHINA,st.JAPAN,st.INDIA,st.KOREA,st.HKMC],EUROPE:[],NORTH_AMERICA:[st.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Ao=Object.keys(zd[st.GLOBAL]),d0=[st.CHINA,st.NORTH_AMERICA,st.EUROPE,st.ASIA,st.JAPAN,st.INDIA,st.OCEANIA,st.SOUTH_AMERICA,st.AFRICA,st.KOREA,st.HKMC,st.US],Hi=function(s,i){let r=[];if(ye(s).call(s,st.GLOBAL)){const d=[st.GLOBAL,st.OVERSEA],h=Object.keys(EE);if(i===st.GLOBAL)throw new W(x.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(i===st.CHINA)r=[st.OVERSEA];else if(l=i,ye(Ao).call(Ao,l)){const p=zd[st.GLOBAL][i]||[],m=[...d,i,...p];r=h.filter(g=>!ye(m).call(m,g))}else if(function(p){let m=!1;return Ao.forEach(g=>{var E;ye(E=zd[st.GLOBAL][g]).call(E,p)&&(m=!0)}),m}(i)){const p=function(g){let E;return Ao.forEach(y=>{var b;ye(b=zd[st.GLOBAL][y]).call(b,g)&&(E=y)}),E}(i),m=[...d,p,i];r=h.filter(g=>!ye(m).call(m,g))}else r=s;r=function(p){const m=[];return d0.forEach(g=>{ye(p).call(p,g)&&m.push(g)}),m.concat(p.filter(g=>!ye(d0).call(d0,g)))}(r)}else r=s;var l;return r};function hN(s){var i,r;if(!s&&ye(i=j("AREAS")).call(i,st.EXTENSIONS))return w.debug("update area from ap : reset"),void In(aL,!0);if(!ye(r=j("AREAS")).call(r,st.GLOBAL)||!s)return;let a=EE.EXTENSIONS;a&&(a={CODE:tm(st.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(s,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(s,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(s,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(s,".agora.io"),"cds-ap-web-2-".concat(s,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(s,".agora.io"),"sua-ap-web-2-".concat(s,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(s,".agora.io"),"uap-ap-web-2-".concat(s,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(s,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(s,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(s,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(s,".agora.io")]},w.debug("update area from ap success: ".concat(s,",config is "),a),At("AREAS",[st.EXTENSIONS],!0),Object.keys(a).map(l=>{At(l,"LOG_UPLOAD_SERVER"===l||"EVENT_REPORT_DOMAIN"===l||"EVENT_REPORT_BACKUP_DOMAIN"===l||"PROXY_SERVER_TYPE3"===l?a[l][0]:a[l])}))}function In(s){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=Se.reportApiInvoke(null,{name:On.SET_AREA,options:s,tag:Xt.TRACER});try{let a=[];if("string"==typeof s&&(a=[s]),Array.isArray(s)&&(s.forEach(d=>{if(!ye(oC).call(oC,d))throw new W(x.INVALID_PARAMS,"invalid area code")}),a=s),"[object Object]"===Object.prototype.toString.call(s)){const{areaCode:d,excludedArea:h}=s;if(!d)throw new W(x.INVALID_PARAMS,"area code is needed");let p=d;"string"==typeof d&&(p=[d]),a=h?Hi(p,h):p}if(!i){if(Ys.AREAS){const d=new W(x.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r.onError(d),void w.warning("setArea is prohibited because of config-distribute")}if(ye(a).call(a,st.GLOBAL)&&j("AREAS")===st.EXTENSIONS){const d=new W(x.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r.onError(d),void w.warning("setArea is prohibited because of ap extensions")}}At("AREAS",a,i);const l=bc(a);Object.keys(l).map(d=>{At(d,"LOG_UPLOAD_SERVER"===d||"EVENT_REPORT_DOMAIN"===d||"EVENT_REPORT_BACKUP_DOMAIN"===d||"PROXY_SERVER_TYPE3"===d?l[d][0]:l[d])}),w.debug("set area success:",a.join(","))}catch(a){throw r.onError(a),a}r.onSuccess()}function pN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Lh(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?pN(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):pN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}let u0=1;let h0=1;function p0(s,i,r,a){let{url:l,areaCode:d}=s;const h=Date.now();let p;const[m,g]=f0(i,d,[Yn.CHOOSE_SERVER]);let E=on.networkState;return gs(M(function*(){E&&on.networkState===Yi.OFFLINE&&on.onlineWaiter&&(yield q.race([on.onlineWaiter,_i(a&&a.maxRetryTimeout||Re.maxRetryTimeout)])),E=on.networkState;const{data:y,headers:b}=yield Mt(l,{data:m,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p="1"===b.http3?1:-1,Se.reportResourceTiming(l,i.sid),nm(y,l,i,h,[Yn.CHOOSE_SERVER],p);const T=cN(y,Yn.CHOOSE_SERVER);return hv(T),em(T,l)}),y=>(y&&Se.joinChooseServer(i.sid,{lts:h,succ:!0,csAddr:l,opid:g,serverList:y.gatewayAddrs.map(b=>b.address),ec:null,cid:y.cid.toString(),uid:y.uid.toString(),csIp:y.csIp,unilbsServerIds:[Yn.CHOOSE_SERVER].toString(),isHttp3:p}),!1),y=>y.code!==x.OPERATION_ABORTED&&(y.code===x.CAN_NOT_GET_GATEWAY_SERVER?y.data.retry:(Se.joinChooseServer(i.sid,{lts:h,succ:!1,csAddr:l,serverList:null,opid:g,ec:y.code,csIp:y.data&&y.data.csIp,unilbsServerIds:[Yn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:E}),isHttp3:p}),w.warning("[".concat(i.clientId,"] Choose server network error, retry"),y),!0)),a)}function uv(s,i,r,a){let l,{url:d,areaCode:h,serviceIds:p}=s;const m=Date.now(),[g,E]=f0(i,h,p);let y;return gs(M(function*(){y&&on.networkState===Yi.OFFLINE&&on.onlineWaiter&&(yield q.race([on.onlineWaiter,_i(a&&a.maxRetryTimeout||Re.maxRetryTimeout)])),y=on.networkState;const{data:b,headers:T}=yield Mt(d,{data:g,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l="1"===T.http3?1:-1,Se.reportResourceTiming(d,i.sid),nm(b,d,i,m,p,l);const O=cN(b,Yn.CHOOSE_SERVER),P=cN(b,"proxy5"===i.cloudProxyServer?Yn.CLOUD_PROXY_5:"proxy3"===i.cloudProxyServer||"proxy4"===i.cloudProxyServer?Yn.CLOUD_PROXY:Yn.CLOUD_PROXY_FALLBACK);return hv(O),{gatewayInfo:em(O,d),proxyInfo:P,url:d}}),b=>(b.gatewayInfo&&Se.joinChooseServer(i.sid,{lts:m,succ:!0,csAddr:d,serverList:b.gatewayInfo.gatewayAddrs.map(T=>T.address),ec:null,opid:E,cid:b.gatewayInfo.cid.toString(),uid:b.gatewayInfo.uid.toString(),csIp:b.gatewayInfo.csIp,unilbsServerIds:p.toString(),isHttp3:l}),b.proxyInfo&&Se.joinWebProxyAP(i.sid,{lts:m,sucess:1,apServerAddr:d,turnServerAddrList:b.proxyInfo.addresses.map(T=>T.ip).join(","),errorCode:null,eventType:i.cloudProxyServer,unilbsServerIds:p.toString()}),!1),b=>b.code!==x.OPERATION_ABORTED&&(b.code===x.CAN_NOT_GET_GATEWAY_SERVER?b.data.retry:(Se.joinWebProxyAP(i.sid,{lts:m,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:b.code,eventType:i.cloudProxyServer,unilbsServerIds:p.toString(),extend:JSON.stringify({networkState:y})}),w.warning("[".concat(i.clientId,"] multi unilbs network error, retry"),b),!0)),a)}const nm=(s,i,r,a,l,d)=>{const h=[],p=m=>{4096===m.flag?Se.joinChooseServer(r.sid,{lts:a,succ:!1,csAddr:i,opid:s.opid,serverList:null,ec:m.error.message,csIp:m.error.data&&m.error.data.csIp,unilbsServerIds:l.toString(),isHttp3:d}):1048576!==m.flag&&4194304!==m.flag&&4194310!==m.flag||Se.joinWebProxyAP(r.sid,{lts:a,sucess:0,apServerAddr:i,turnServerAddrList:null,errorCode:m.error.code,eventType:r.cloudProxyServer,unilbsServerIds:l.toString()})};if(s.response_body.forEach(m=>{const g=m.buffer.code;if(23===m.uri&&0===g&&!m.buffer.edges_services)if(4194310===m.buffer.flag)w.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),m.buffer.edges_services=[];else{const E={error:new W(x.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:s.detail[502]}),flag:m.buffer.flag};h.push(E),p(E)}if(0!==g){const E=Ff(g),y={error:new W(x.CAN_NOT_GET_GATEWAY_SERVER,E.desc,{desc:E.desc,retry:E.retry,csIp:s.detail[502]}),flag:m.buffer.flag};4194310===m.buffer.flag?w.warning(y.error.toString()):h.push(y),p(y)}}),h.length)throw w.warning("[".concat(r.clientId,"] multi unilbs ").concat(i," failed, ").concat(h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message,", retry: ").concat(m.error.data.retry)).join(" | "))),new W(x.CAN_NOT_GET_GATEWAY_SERVER,h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message)).join(" | "),{retry:!!h.find(m=>m.error.data.retry),csIp:s.detail[502],desc:[...new Set(h.map(m=>{var g;return null==m||null===(g=m.error)||void 0===g||null===(g=g.data)||void 0===g?void 0:g.desc}).filter(m=>!!m))]})},hv=s=>{var i,r,a,l;if(s.addresses&&0===s.addresses.length&&0===s.code)throw new W(x.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:s.detail&&s.detail[502]});if(j("AP_AREA")&&(null!==(a=s.detail)&&void 0!==a&&a[23]&&"string"==typeof(null===(l=s.detail)||void 0===l?void 0:l[23])?hN(s.detail[23].toLowerCase()):hN()),null!==(i=s.detail)&&void 0!==i&&i[19]&&"string"==typeof(null===(r=s.detail)||void 0===r?void 0:r[19])){const h=s.detail[19],p=h?.split(";");for(let m=0;m<p.length;m++){var d;const g=$D(d=p[m]).call(d);s.addresses[m]&&p&&(s.addresses[m].fingerprint=g)}}if(j("GATEWAY_ADDRESS")&&j("GATEWAY_ADDRESS").length>0){w.debug("assign gateway address to",j("GATEWAY_ADDRESS"));const h=j("GATEWAY_ADDRESS").map(p=>{var m,g;const E=null!==(m=null===(g=s.addresses.find(y=>y.ip===p.ip&&y.port===p.port))||void 0===g?void 0:g.fingerprint)&&void 0!==m?m:"";return{ip:p.ip,port:p.port,ticket:s.addresses[0]&&s.addresses[0].ticket,fingerprint:E}});s.addresses=h}},f2=(s,i)=>{if(s.response_body&&s.response_body.length){const r=s.response_body[0];if(0!==r.buffer.code){const a=Ff(r.buffer.code);throw new W(x.UPDATE_TICKET_FAILED,"[".concat(r.buffer.code,"]: ").concat(a.desc),{retry:a.retry})}return r.buffer.ticket}throw w.debug("update ticket request received ap response without response body:",i),new W(x.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},f0=(s,i,r)=>{const a=Math.floor(1e12*Math.random()),l={appid:s.appId,client_ts:Date.now(),opid:a,sid:s.sid,request_bodies:[{uri:22,buffer:{cname:s.cname,detail:Lh({6:s.stringUid,11:i,12:j("USE_NEW_TOKEN")?"1":void 0,22:i},j("AP_RTM")?{26:"RTM2"}:{}),key:s.token,service_ids:r,uid:s.uid||0}}]};l.request_bodies.forEach(h=>{s.multiIP&&s.multiIP.gateway_ip&&(h.buffer.detail[5]=JSON.stringify({vocs_ip:[s.multiIP.uni_lbs_ip],vos_ip:[s.multiIP.gateway_ip]}))});const d=new FormData;return d.append("request",JSON.stringify(l)),[d,a]},m2=(s,i)=>{const r=Math.floor(1e12*Math.random()),a={appid:s.appId,client_ts:Date.now(),opid:r,sid:s.sid,request_bodies:[{uri:28,buffer:{cname:s.cname,detail:{1:"",6:s.stringUid,12:"1"},token:s.token,service_ids:i,uid:s.uid||0,edges_services:s.apResponse.addresses.map(d=>({ip:d.ip,port:d.port}))}}]},l=new FormData;return l.append("request",JSON.stringify(a)),[l,r]};let Fh=0;function Uh(s){return q.all(s.map(i=>i.then(r=>{throw r},r=>r))).then(i=>{throw i},i=>i)}const im=function(){var s=M(function*(i){let{fragementLength:r,referenceList:a,asyncMapHandler:l,allFailedhandler:d,promisesCollector:h}=i,p=0;const m=r;let g,E=0;const y=function(){var b=M(function*(){const T=(()=>{const O=p*m;return a.slice(O,O+m).map(l)})();h&&h.push(...T);try{g=yield Uh(T)}catch(O){if(E+=m,p++,!(E>=a.length))return void(yield y());d(O)}T.forEach(O=>O.cancel())});return function(){return b.apply(this,arguments)}}();return yield y(),g});return function(r){return s.apply(this,arguments)}}();function pv(s,i,r,a){return m0.apply(this,arguments)}function m0(){return m0=M(function*(s,i,r,a){return{gatewayInfo:yield(d=M(function*(h,p,m,g){let E=null;const y=[],b=function(){var O=M(function*(){const P=j("WEBCS_DOMAIN").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(B=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(B+"/api/v2/transpond/webrtc?v=2"):"https://".concat(B,"/api/v2/transpond/webrtc?v=2"),areaCode:lv()})),D=g.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(B=>B.url)}),L=yield im({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:B=>(w.debug("[".concat(h.clientId,"] Connect to choose_server:"),B.url),p0(B,h,p,m)),allFailedhandler:B=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},D),B[0]},promisesCollector:y});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},D),L});return function(){return O.apply(this,arguments)}}(),T=function(){var O=M(function*(){if(yield _i(1e3),null!==E)return E;const P=j("WEBCS_DOMAIN_BACKUP_LIST").map(B=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(B+"/api/v2/transpond/webrtc?v=2"):"https://".concat(B,"/api/v2/transpond/webrtc?v=2"),areaCode:lv()})),D=g.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(B=>B.url)}),L=yield im({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:B=>(w.debug("[".concat(h.clientId,"] Connect to backup choose_server:"),B.url),p0(B,h,p,m)),allFailedhandler:B=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},D),B[0]},promisesCollector:y});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},D),L});return function(){return O.apply(this,arguments)}}();try{return E=yield Uh([b(),T()]),y.length&&y.forEach(O=>O.cancel&&"function"==typeof O.cancel&&O.cancel()),E}catch(O){throw O[0]}}),function(h,p,m,g){return d.apply(this,arguments)})(s,i,r,a)};var d}),m0.apply(this,arguments)}function _0(s,i,r,a,l){return Vh.apply(this,arguments)}function Vh(){return Vh=M(function*(s,i,r,a,l){const d=s.cloudProxyServer;if("disabled"===d){if(!a)return;if(s.useLocalAccessPoint)return yield pv(s,i,r,l);if(j("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:g,proxyInfo:E}=yield E0(s,i,r,l);return s.turnServer&&"auto"!==s.turnServer.mode||(s.turnServer={mode:"manual",servers:E.map(y=>({turnServerURL:y.address,tcpport:y.tcpport||Eo.tcpport,udpport:y.udpport||Eo.udpport,username:y.username||Eo.username,password:y.password||Eo.password,forceturn:!1,security:!0}))}),{gatewayInfo:g}}return yield pv(s,i,r,l)}const{proxyInfo:h,gatewayInfo:p}=yield E0(s,i,r,l),m={gatewayInfo:p};return s.turnServer={mode:"manual",servers:h.map(g=>({turnServerURL:g.address,tcpport:"proxy3"===d?void 0:g.tcpport?g.tcpport:Eo.tcpport,udpport:"proxy4"===d?void 0:g.udpport?g.udpport:Eo.udpport,username:g.username||Eo.username,password:g.password||Eo.password,forceturn:"proxy4"!==d,security:"proxy5"===d}))},w.debug("[".concat(s.clientId,"] set proxy server: ").concat(s.proxyServer,", mode: ").concat(d)),m}),Vh.apply(this,arguments)}function Bh(s,i,r,a,l){return g0.apply(this,arguments)}function g0(){return g0=M(function*(s,i,r,a,l){let h=[];h=j("ACCOUNT_REGISTER").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(i.proxyServer?m=>"https://".concat(i.proxyServer,"/ap/?url=").concat(m+"/api/v1"):m=>"https://".concat(m,"/api/v1"));const p=l?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const m=yield(g=M(function*(E,y,b,T,O){const P=Date.now(),D={sid:b.sid,opid:10,appid:b.appId,string_uid:y};let L=E[0];const B=yield gs(()=>Mt(L+"".concat(-1===L.indexOf("?")?"?":"&","action=stringuid"),{data:D,cancelToken:T,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(V,Q)=>{if(0===V.code){if(V.uid<=0||V.uid>=Math.pow(2,32))throw w.error("Invalid Uint Uid ".concat(y," => ").concat(V.uid),V),Se.reqUserAccount(D.sid,{lts:P,success:!1,serverAddr:L,stringUid:D.string_uid,uid:V.uid,errorCode:x.INVALID_UINT_UID_FROM_STRING_UID,extend:D}),new W(x.INVALID_UINT_UID_FROM_STRING_UID);return Se.reqUserAccount(D.sid,{lts:P,success:!0,serverAddr:L,stringUid:D.string_uid,uid:V.uid,errorCode:null,extend:D}),!1}const se=Ff(V.code);return se.retry&&(L=E[(Q+1)%E.length]),Se.reqUserAccount(D.sid,{lts:P,success:!1,serverAddr:L,stringUid:D.string_uid,uid:V.uid,errorCode:se.desc,extend:D}),se.retry},(V,Q)=>V.code!==x.OPERATION_ABORTED&&(Se.reqUserAccount(D.sid,{lts:P,success:!1,serverAddr:L,stringUid:D.string_uid,uid:null,errorCode:V.code,extend:D}),L=E[(Q+1)%E.length],!0),O);if(0!==B.code){const V=Ff(B.code);throw new W(x.UNEXPECTED_RESPONSE,V.desc)}return B}),function(E,y,b,T,O){return g.apply(this,arguments)})(h,s,i,r,a);return l?.recordJoinChannelService({status:"success",endTs:Date.now()},p),m.uid}catch(m){throw l?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[m]},p),m}var g}),g0.apply(this,arguments)}function rm(){return rm=M(function*(s,i,r){const a=j("CDS_AP").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(p=>s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(p+"/api/v1"):"https://".concat(p,"/api/v1?action=config")).map(p=>function(m,g,E,y){const b=dt(),T={flag:64,cipher_method:0,features:{device:b.name,system:b.os,system_general:navigator.userAgent,vendor:g.appId,version:Yo,cname:g.cname,sid:g.sid,session_id:g.sid,detail:"",proxyServer:g.proxyServer}};return gs(()=>Mt(m,{data:T,timeout:1e3,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,O=>O.code!==x.OPERATION_ABORTED,y)}(p,s,i,r));let l=null,d=null,h={};try{l=yield Uh(a)}catch(p){if(p.code===x.OPERATION_ABORTED)throw p;d=p}if(a.forEach(p=>p.cancel()),Se.reportApiInvoke(s.sid,{name:On.REQUEST_CONFIG_DISTRIBUTE,options:{error:d,res:l}}).onSuccess(),l&&l.test_tags)try{h=function(p){if(!p.test_tags)return{};const m=p.test_tags,g=Object.keys(m),E={};return g.forEach(y=>{var b;const T=$D(b=y.slice(4)).call(b),O=JSON.parse(m[y])[1];E[T]=O}),E}(l)}catch{}return h}),rm.apply(this,arguments)}function E0(s,i,r,a){return v0.apply(this,arguments)}function v0(){return v0=M(function*(s,i,r,a){const l=j("PROXY_SERVER_TYPE3"),d=(T,O,P)=>{let D=P||l;return Array.isArray(D)&&(D=O%2==0?l[1]:l[0]),"https://".concat(D,"/ap/?url=").concat(T)};let h=null;const p=[],m=function(){var T=M(function*(){const O=j("WEBCS_DOMAIN").slice(0,j("AJAX_REQUEST_CONCURRENT")).map((L,B)=>{let V;return V="disabled"===s.cloudProxyServer&&s.proxyServer?d("".concat(L,"/api/v2/transpond/webrtc?v=2"),B,s.proxyServer):"disabled"===s.cloudProxyServer||"fallback"===s.cloudProxyServer?"https://".concat(L,"/api/v2/transpond/webrtc?v=2"):d("".concat(L,"/api/v2/transpond/webrtc?v=2"),B),{url:V,areaCode:lv(),serviceIds:[Yn.CHOOSE_SERVER,"proxy5"===s.cloudProxyServer?Yn.CLOUD_PROXY_5:"proxy3"===s.cloudProxyServer||"proxy4"===s.cloudProxyServer?Yn.CLOUD_PROXY:Yn.CLOUD_PROXY_FALLBACK]}}),P=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(L=>L.url)}),D=yield im({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:L=>(w.debug("[".concat(s.clientId,"] Connect to choose_server:"),L.url),uv(L,s,i,r)),allFailedhandler:L=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:L},P),L[0]},promisesCollector:p});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},P),D});return function(){return T.apply(this,arguments)}}(),g=function(){var T=M(function*(){if(yield _i(1e3),null!==h)return h;const O=j("WEBCS_DOMAIN_BACKUP_LIST").map((L,B)=>{let V;return V="disabled"===s.cloudProxyServer&&s.proxyServer?d("".concat(L,"/api/v2/transpond/webrtc?v=2"),B,s.proxyServer):"disabled"===s.cloudProxyServer||"fallback"===s.cloudProxyServer?"https://".concat(L,"/api/v2/transpond/webrtc?v=2"):d("".concat(L,"/api/v2/transpond/webrtc?v=2"),B),{url:V,areaCode:lv(),serviceIds:[Yn.CHOOSE_SERVER,"proxy5"===s.cloudProxyServer?Yn.CLOUD_PROXY_5:"proxy3"===s.cloudProxyServer||"proxy4"===s.cloudProxyServer?Yn.CLOUD_PROXY:Yn.CLOUD_PROXY_FALLBACK]}}),P=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(L=>L.url)}),D=yield im({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:L=>(w.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),L.url),uv(L,s,i,r)),allFailedhandler:L=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:L},P),L[0]},promisesCollector:p});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},P),D});return function(){return T.apply(this,arguments)}}();let E,y,b;try{({gatewayInfo:E,proxyInfo:y,url:b}=yield Uh([m(),g()]))}catch(T){throw T[0]}if(p.length&&p.forEach(T=>T.cancel&&"function"==typeof T.cancel&&T.cancel()),!E||!y)throw new W(x.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(s.apUrl=b,"disabled"!==s.cloudProxyServer&&Array.isArray(l)&&b){const T=/^https?:\/\/(.+?)(\/.*)?$/.exec(b)[1];ye(l).call(l,T)&&(s.proxyServer=T,w.setProxyServer(T),Se.setProxyServer(T))}return h={gatewayInfo:E,proxyInfo:yield R3(y,E.uid)},h}),v0.apply(this,arguments)}function fv(s,i,r,a){return y0.apply(this,arguments)}function y0(){return y0=M(function*(s,i,r,a){const l=j("UAP_AP").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(d=>i.proxyServer?"https://".concat(i.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap"));return yield function dv(s,i,r,a,l){u0+=1;const d={sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(Date.now()/1e3),seq:u0,requestId:u0,version:Yo,cname:r.cname},h={service_name:i,json_body:JSON.stringify(d)};let p,m,g=s[0];return gs(M(function*(){p=Date.now();const E=yield Mt(g,{data:h,cancelToken:a,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(m=Date.now()-p,0!==E.code){const T=new W(x.UNEXPECTED_RESPONSE,"live streaming ap error, code"+E.code,{retry:!0,responseTime:m});throw w.error(T.toString()),T}const y=JSON.parse(E.json_body);if(200!==y.code){const T=new W(x.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(y.code,", reason: ").concat(y.reason),{code:y.code,responseTime:m});throw w.error(T.toString()),T}if(!y.servers||0===y.servers.length){const T=new W(x.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:y.code,responseTime:m});throw w.error(T.toString()),T}const b=(O=i,{addressList:(T=y).servers.map(P=>"wss://".concat(P.address.replace(/\./g,"-"),".").concat(j("WORKER_DOMAIN"),":").concat(P.wss,"?serviceName=").concat(encodeURIComponent(O))),workerToken:T.workerToken,vid:T.vid});var T,O;return j("LIVE_STREAMING_ADDRESS")&&(b.addressList=j("LIVE_STREAMING_ADDRESS")instanceof Array?j("LIVE_STREAMING_ADDRESS"):[j("LIVE_STREAMING_ADDRESS")]),Lh(Lh({},b),{},{responseTime:m})}),(E,y)=>(Se.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:i,responseDetail:JSON.stringify(E.addressList),firstSuccess:0===y,responseTime:m,serverIp:s[y%s.length]}),!1),(E,y)=>(Se.apworkerEvent(r.sid,{success:!1,sc:E.data&&E.data.code||200,serviceName:i,responseTime:m,serverIp:s[y%s.length]}),!!(E.code!==x.OPERATION_ABORTED&&E.code!==x.UNEXPECTED_RESPONSE||E.data&&E.data.retry)&&(g=s[(y+1)%s.length],!0)),l)}(l,s,i,r,a)}),y0.apply(this,arguments)}function b0(){return b0=M(function*(s,i,r){const a=j("UAP_AP").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(l=>s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(l+"/api/v1?action=uap"):"https://".concat(l,"/api/v1?action=uap")).map(l=>function(d,h,p,m){const g={command:"convergeAllocateEdge",sid:h.sid,appId:h.appId,token:h.token,ts:Date.now(),version:Yo,cname:h.cname,uid:h.uid.toString(),requestId:h0,seq:h0};h0+=1;const E={service_name:"tele_channel",json_body:JSON.stringify(g)};return gs(M(function*(){const y=yield Mt(d,{data:E,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==y.code){const T=new W(x.UNEXPECTED_RESPONSE,"cross channel ap error, code"+y.code,{retry:!0});throw w.error(T.toString()),T}const b=JSON.parse(y.json_body);if(200!==b.code){const T=new W(x.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(b.code,", reason: ").concat(b.reason));throw w.error(T.toString()),T}if(!b.servers||0===b.servers.length){const T=new W(x.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw w.error(T.toString()),T}return{vid:b.vid,workerToken:b.workerToken,addressList:(j("CHANNEL_MEDIA_RELAY_SERVERS")||b.servers).map(T=>"wss://".concat(T.address.replace(/\./g,"-"),".").concat(j("WORKER_DOMAIN"),":").concat(T.wss))}}),void 0,y=>!!(y.code!==x.OPERATION_ABORTED&&y.code!==x.UNEXPECTED_RESPONSE||y.data&&y.data.retry),m)}(l,s,i,r));try{const l=yield Uh(a);return a.forEach(d=>d.cancel()),l}catch(l){throw l[0]}}),b0.apply(this,arguments)}function C0(){return C0=M(function*(s,i,r){let a=null;const l=[],d=function(){var h=M(function*(p){const m=j(p?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(g=>s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(g+"/api/v2/transpond/webrtc?v=2"):"https://".concat(g,"/api/v2/transpond/webrtc?v=2"));return p&&(yield _i(1e3),null!==a)?a:yield im({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:g=>(w.debug("[".concat(s.clientId,"] update ticket, Connect to ").concat(p?"backup":""," choose_server:"),g),function(E,y,b,T){const[O]=m2(y,[Yn.CHOOSE_SERVER]);let P=on.networkState;return gs(M(function*(){P&&on.networkState===Yi.OFFLINE&&on.onlineWaiter&&(yield q.race([on.onlineWaiter,_i(T&&T.maxRetryTimeout||Re.maxRetryTimeout)])),P=on.networkState;const D=yield Mt(E,{data:O,cancelToken:b,headers:{"Content-Type":"multipart/form-data;"}},!0);return f2(D,E)}),()=>!1,D=>D.code!==x.OPERATION_ABORTED&&(D.code===x.UPDATE_TICKET_FAILED?D.data.retry:(w.warning("[".concat(y.clientId,"] update ticket network error, retry"),D),!0)),T)}(g,s,i,r)),allFailedhandler:g=>{throw g[0]},promisesCollector:l})});return function(m){return h.apply(this,arguments)}}();try{return a=yield Uh([d(!1),d(!0)]),l.length&&l.forEach(h=>h.cancel&&"function"==typeof h.cancel&&h.cancel()),a}catch(h){throw h[0]}}),C0.apply(this,arguments)}function fN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function mN(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?fN(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):fN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class T0 extends zt{constructor(){super(),C(this,"configs",void 0),C(this,"joinInfo",void 0),C(this,"cancelToken",void 0),C(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),C(this,"interval",void 0),C(this,"mutex",new Zn("config-distribute")),C(this,"mutableParamsRead",!1)}startGetConfigDistribute(i,r){this.joinInfo=i,this.cancelToken=r,this.interval&&this.stopGetConfigDistribute(),j("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},j("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}awaitConfigDistributeComplete(){var i=this;return M(function*(){i.mutex.isLocked&&(yield i.mutex.lock())()})()}updateConfigDistribute(){var i=this;return M(function*(){if(i.mutableParamsRead||(i.mutableParamsRead=!0,Se.reportApiInvoke(null,{options:void 0,name:On.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Xt.TRACER}).onSuccess(JSON.stringify(Ys))),!i.joinInfo||!i.cancelToken||!i.retryConfig)return void w.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const a=yield i.mutex.lock();try{r=yield function _2(s,i,r){return rm.apply(this,arguments)}(i.joinInfo,i.cancelToken,i.retryConfig),w.debug("[config-distribute] get config distribute",JSON.stringify(r)),r.limit_bitrate&&i.handleBitrateLimit(r.limit_bitrate),i.cacheGlobalParameterConfig(r),i.configs=r}catch(l){const d=new W(x.NETWORK_RESPONSE_ERROR,l);w.warning("[config-distribute] ".concat(d.toString()))}finally{a()}})()}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(i){var r;(r=i)&&r.uplink&&r.id&&void 0!==r.uplink.max_bitrate&&void 0!==r.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==i.id&&this.emit(Lf.UPDATE_BITRATE_LIMIT,i):this.emit(Lf.UPDATE_BITRATE_LIMIT,i))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&mN({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(i){var r;const a=tl(r=Object.keys(i).filter(d=>/^webrtc_ng_global_parameter/.test(d))).call(r);for(let d=0;d<a.length;d++)for(let h=a.length-1;h>d;h--){const p=a[h];if("number"==typeof i[p].__priority){const g=a[h-1];if("number"==typeof i[g].__priority){if(!(i[p].__priority>i[g].__priority))continue;{const E=p;a[h]=a[h-1],a[h-1]=E}}else{const E=p;a[h]=a[h-1],a[h-1]=E}}}const l={};a.forEach(d=>{const h=i[d],p=h.__expires;Object.keys(h).forEach(m=>{"__priority"===m||"__expires"===m||Object.prototype.hasOwnProperty.call(l,m)||(l[m]=mN({value:h[m]},p&&{expires:p}))})});try{!function(p){try{const m=Date.now();Object.keys(p).forEach(g=>{switch(g){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":if(Object.prototype.hasOwnProperty.call(ri,g)){const{value:E,expires:y}=p[g];if(y&&y<=m)return;Ys[g]=E,ri[g]=E,w.debug("Update global parameters from config distribute",g,E)}}})}catch(m){w.error("Error update config immediately: ".concat(p),m.message)}}(l);const d=JSON.stringify(l),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),w.debug("Caching global parameters ".concat(d))}catch(d){w.error("Error caching global parameters:",d.message)}}}function mv(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function jh(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?mv(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):mv(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class E2 extends zt{constructor(i,r,a,l){super(),C(this,"spec",void 0),C(this,"token",void 0),C(this,"websocket",void 0),C(this,"pingpongTimer",void 0),C(this,"reconnectMode","retry"),C(this,"serviceMode",void 0),C(this,"reqId",0),C(this,"commandReqId",0),C(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),C(this,"handleWebSocketMessage",d=>{if(!d.data)return;const h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):this.serviceMode===Bn.INJECT?this.emit($o.INJECT_STREAM_STATUS,h):(Se.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===Bn.TRANSCODE?1:2}),this.emit($o.PUBLISH_STREAM_STATUS,h))}),this.spec=r,this.token=i,this.serviceMode=l,this.websocket=new Uf("live-streaming",a),this.websocket.on(Me.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Me.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Me.REQUEST_NEW_URLS,(d,h)=>{Jt(this,$o.REQUEST_NEW_ADDRESS).then(d).catch(h)}),this.websocket.on(Me.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(i){return this.websocket.init(i)}request(i,r,a,l){var d=this;return M(function*(){d.reqId+=1,"request"===i&&(d.commandReqId+=1);const h=d.commandReqId,p=d.reqId;if(!p||!d.websocket)throw new W(x.UNEXPECTED_ERROR);const m=jh({command:i,sdkVersion:"4.19.2"===Yo?"0.0.1":Yo,seq:p,requestId:p,allocate:a,cname:d.spec.cname,appId:d.spec.appId,sid:d.spec.sid,uid:d.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},r);if("closed"===d.websocket.state)throw new W(x.WS_DISCONNECT);const g=()=>new q((T,O)=>{d.websocket.once(Me.CLOSED,()=>O(new W(x.WS_ABORT))),d.websocket.once(Me.CONNECTED,T)});"connected"!==d.websocket.state&&(yield g()),m.clientRequest&&(m.clientRequest.workerToken=d.token);const E=new q((T,O)=>{const P=()=>{O(new W(x.WS_ABORT))};d.websocket.once(Me.RECONNECTING,P),d.websocket.once(Me.CLOSED,P),d.once("@".concat(p,"-").concat(d.spec.sid),D=>{T(D)})});l&&Se.workerEvent(d.spec.sid,jh(jh({},l),{},{requestId:h,actionType:"request",payload:JSON.stringify(r.clientRequest),serverCode:0,code:0}));const y=Date.now();d.websocket.sendMessage(m);let b=null;try{b=yield E}catch(T){if("closed"===d.websocket.state)throw T;return yield g(),yield d.request(i,r,a)}return l&&Se.workerEvent(d.spec.sid,jh(jh({},l),{},{requestId:h,actionType:"response",payload:JSON.stringify(b.serverResponse),serverCode:b.code,success:200===b.code,responseTime:Date.now()-y})),200!==b.code&&d.handleResponseError(b),b})()}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const i="4.19.2"===Yo?"0.0.1":Yo;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:i,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(i){switch(i.code){case Sn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void w.warning("live stream response already exists stream");case Sn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Sn.LIVE_STREAM_RESPONSE_BAD_STREAM:case Sn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new W(x.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:i.code}).throw();case Sn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===i.serverResponse.command||"UninjectStream"===i.serverResponse.command)return;throw new W(x.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Sn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new W(x.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:i.code}).throw();case Sn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const r=new W(x.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit($o.WARNING,r,i.serverResponse.url)}case Sn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const r=new W(x.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit($o.WARNING,r,i.serverResponse.url)}case Sn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new W(x.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Sn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new W(x.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:i.code}).throw();case Sn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const r=new W(x.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit($o.WARNING,r,i.serverResponse.url)}case Sn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new W(x.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:i.code}).throw();case Sn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new W(x.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Sn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Sn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===i.serverResponse.command||"UninjectStream"===i.serverResponse.command)return;throw new W(x.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Sn.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===i.serverResponse.command||"UninjectStream"===i.serverResponse.command)return;if("UpdateTranscoding"===i.serverResponse.command||"ControlStream"===i.serverResponse.command)return new W(x.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:i.code}).throw();throw new W(x.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Sn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new W(x.LIVE_STREAMING_CDN_ERROR,"",{code:i.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(yf)},6e3)}}function v2(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Tr(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?v2(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):v2(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class w0 extends zt{constructor(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Re,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Re;super(),C(this,"onLiveStreamWarning",void 0),C(this,"onLiveStreamError",void 0),C(this,"onInjectStatusChange",void 0),C(this,"spec",void 0),C(this,"retryTimeout",1e4),C(this,"connection",void 0),C(this,"httpRetryConfig",void 0),C(this,"wsRetryConfig",void 0),C(this,"streamingTasks",new Map),C(this,"isStartingStreamingTask",!1),C(this,"taskMutex",new Zn("live-streaming")),C(this,"cancelToken",vr.CancelToken.source()),C(this,"transcodingConfig",void 0),C(this,"injectConfig",Tr({},kD)),C(this,"injectLoopTimes",0),C(this,"uapResponse",void 0),C(this,"lastTaskId",1),C(this,"statusError",new Map),this.spec=i,this.httpRetryConfig=a,this.wsRetryConfig=r}setTranscodingConfig(i){var r=this;return M(function*(){const a=Tr(Tr({},hL),i);var p;66!==a.videoCodecProfile&&77!==a.videoCodecProfile&&100!==a.videoCodecProfile&&(w.debug("[".concat(r.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(a.videoCodecProfile," -> 100")),a.videoCodecProfile=100),a.transcodingUsers||(a.transcodingUsers=a.userConfigs),a.transcodingUsers&&(a.transcodingUsers=a.transcodingUsers.map(p=>Tr(Tr(Tr({},MD),p),{},{zOrder:p.zOrder?p.zOrder+1:1}))),kt((p=a).width)||ft(p.width,"config.width",0,1e4),kt(p.height)||ft(p.height,"config.height",0,1e4),kt(p.videoBitrate)||ft(p.videoBitrate,"config.videoBitrate",1,1e6),kt(p.videoFrameRate)||ft(p.videoFrameRate,"config.videoFrameRate"),kt(p.lowLatency)||_s(p.lowLatency,"config.lowLatency"),kt(p.audioSampleRate)||gn(p.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),kt(p.audioBitrate)||ft(p.audioBitrate,"config.audioBitrate",1,128),kt(p.audioChannels)||gn(p.audioChannels,"config.audioChannels",[1,2,3,4,5]),kt(p.videoGop)||ft(p.videoGop,"config.videoGop"),kt(p.videoCodecProfile)||gn(p.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),kt(p.userCount)||ft(p.userCount,"config.userCount",0,17),kt(p.backgroundColor)||ft(p.backgroundColor,"config.backgroundColor",0,16777215),kt(p.userConfigExtraInfo)||Un(p.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),p.transcodingUsers&&!kt(p.transcodingUsers)&&(fo(p.transcodingUsers,"config.transcodingUsers"),p.transcodingUsers.forEach((m,g)=>{iC(m.uid),kt(m.x)||ft(m.x,"transcodingUser[".concat(g,"].x"),0,1e4),kt(m.y)||ft(m.y,"transcodingUser[".concat(g,"].y"),0,1e4),kt(m.width)||ft(m.width,"transcodingUser[".concat(g,"].width"),0,1e4),kt(m.height)||ft(m.height,"transcodingUser[".concat(g,"].height"),0,1e4),kt(m.zOrder)||ft(m.zOrder-1,"transcodingUser[".concat(g,"].zOrder"),0,100),kt(m.alpha)||ft(m.alpha,"transcodingUser[".concat(g,"].alpha"),0,1,!1)})),kt(p.watermark)||kf(p.watermark,"watermark"),kt(p.backgroundImage)||kf(p.backgroundImage,"backgroundImage"),p.images&&!kt(p.images)&&(fo(p.images,"config.images"),p.images.forEach((m,g)=>{kf(m,"images[".concat(g,"]"))}));const l=[];a.images&&l.push(...a.images.map(p=>Tr(Tr(Tr({},rC),p),{},{zOrder:255}))),a.backgroundImage&&(l.push(Tr(Tr(Tr({},rC),a.backgroundImage),{},{zOrder:0})),delete a.backgroundImage),a.watermark&&(l.push(Tr(Tr(Tr({},rC),a.watermark),{},{zOrder:255})),delete a.watermark),a.images=l,a.transcodingUsers&&(a.userConfigs=a.transcodingUsers.map(p=>Tr({},p)),a.userCount=a.transcodingUsers.length,delete a.transcodingUsers);const d=(a.userConfigs||[]).map(p=>"number"==typeof p.uid?q.resolve(p.uid):Bh(p.uid,r.spec,r.cancelToken.token,r.httpRetryConfig));if((yield q.all(d)).forEach((p,m)=>{a.userConfigs&&a.userConfigs[m]&&(a.userConfigs[m].uid=p)}),r.transcodingConfig=a,r.connection)try{var h;const p=yield r.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:r.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(yo(h=r.streamingTasks).call(h)).map(m=>m.taskId).join("#")});w.debug("[".concat(r.spec.clientId,"] update live transcoding config success, code: ").concat(p.code,", config:"),JSON.stringify(r.transcodingConfig))}catch(p){if(!p.data||!p.data.retry)throw p;p.data.changeAddress&&r.connection.tryNextAddress(),r.streamingTasks.forEach(m=>{w.warning("[".concat(r.spec.clientId,"] live streaming receive error"),p.toString(),"try to republish",m.url),r.startLiveStreamingTask(m.url,m.mode,p).then(()=>{w.debug("[".concat(r.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(g=>{w.error("[".concat(r.spec.clientId,"] live streaming republish failed"),m.url,g.toString()),r.onLiveStreamError&&r.onLiveStreamError(m.url,g)})})}})()}setInjectStreamConfig(i,r){this.injectConfig=Object.assign({},this.injectConfig,i),this.injectLoopTimes=r}startLiveStreamingTask(i,r,a){var l=this;return M(function*(){var d;if(Array.from(yo(d=l.streamingTasks).call(d)).find(g=>g.mode===Bn.INJECT)&&r===Bn.INJECT)return new W(x.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!l.transcodingConfig&&r===Bn.TRANSCODE)throw new W(x.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let h={command:"PublishStream",ts:Date.now(),url:i,uid:l.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};w.debug("[".concat(l.spec.clientId,"] start live streaming ").concat(i,", mode: ").concat(r));const p=yield l.taskMutex.lock();if(!l.connection&&a)return void p();if(l.streamingTasks.get(i)&&!a)return p(),new W(x.LIVE_STREAMING_TASK_CONFLICT).throw();try{l.connection||(l.connection=yield l.connect(r))}catch(g){throw p(),g}switch(r){case Bn.TRANSCODE:h.transcodingConfig=Tr({},l.transcodingConfig);break;case Bn.RAW:break;case Bn.INJECT:h={cname:l.spec.cname,command:"InjectStream",sid:l.spec.sid,transcodingConfig:l.injectConfig,ts:Date.now(),url:i,loopTimes:l.injectLoopTimes}}l.uapResponse&&l.uapResponse.vid&&(h.vid=l.uapResponse.vid),l.isStartingStreamingTask=!0;const m=l.lastTaskId++;try{const g=new q((y,b)=>{_i(l.retryTimeout).then(()=>{if(a)return b(a);const T=l.statusError.get(i);return T?(l.statusError.delete(i),b(T)):void 0})}),E=yield q.race([l.connection.request("request",{clientRequest:h},!0,{url:i,command:"PublishStream",workerType:r===Bn.TRANSCODE?1:2,requestByUser:!a,tid:m.toString()}),g]);l.isStartingStreamingTask=!1,w.debug("[".concat(l.spec.clientId,"] live streaming started, code: ").concat(E.code)),l.streamingTasks.set(i,{clientRequest:h,mode:r,url:i,taskId:m}),p()}catch(g){if(p(),l.isStartingStreamingTask=!1,!g.data||!g.data.retry||a)throw g;return g.data.changeAddress?(l.connection.tryNextAddress(),yield l.startLiveStreamingTask(i,r,g)):yield l.startLiveStreamingTask(i,r,g)}})()}stopLiveStreamingTask(i){return new q((r,a)=>{const l=this.streamingTasks.get(i);if(!l||!this.connection)return new W(x.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=l.mode;l.abortTask=()=>{w.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(i),r()},this.connection.request("request",{clientRequest:{command:d===Bn.INJECT?"UninjectStream":"UnpublishStream",url:l.url}},!1,{url:i,command:"UnPublishStream",workerType:d===Bn.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{w.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(i),0===this.streamingTasks.size&&d!==Bn.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),r(),d===Bn.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(ml.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,i)}).catch(a)})}controlInjectStream(i,r,a,l){var d=this;return M(function*(){const h=d.streamingTasks.get(i);if(!h||!d.connection||h.mode!==Bn.INJECT)throw new W(x.INVALID_OPERATION,"can not find inject stream task to control");return(yield d.connection.request("request",{clientRequest:{command:"ControlStream",url:i,control:r,audioVolume:a,position:l}})).serverResponse})()}resetAllTask(){var i;const r=Array.from(yo(i=this.streamingTasks).call(i));this.terminate();for(const a of r)this.startLiveStreamingTask(a.url,a.mode).catch(l=>{this.onLiveStreamError&&this.onLiveStreamError(a.url,l)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=vr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}connect(i){var r=this;return M(function*(){if(r.connection)throw new W(x.UNEXPECTED_ERROR,"live streaming connection has already connected");const a=yield Jt(r,yh.REQUEST_WORKER_MANAGER_LIST,i);return r.uapResponse=a,r.connection=new E2(a.workerToken,r.spec,r.wsRetryConfig,i),r.connection.on($o.WARNING,(l,d)=>r.onLiveStreamWarning&&r.onLiveStreamWarning(d,l)),r.connection.on($o.PUBLISH_STREAM_STATUS,l=>r.handlePublishStreamServer(l)),r.connection.on($o.INJECT_STREAM_STATUS,l=>r.handleInjectStreamServerStatus(l)),r.connection.on($o.REQUEST_NEW_ADDRESS,(l,d)=>{if(!r.connection)return d(new W(x.UNEXPECTED_ERROR,"can not get new live streaming address list"));Jt(r,yh.REQUEST_WORKER_MANAGER_LIST,i).then(h=>{r.uapResponse=h,l(h.addressList)}).catch(d)}),yield r.connection.init(a.addressList),r.connection})()}handlePublishStreamServer(i){const r=i.serverStatus&&i.serverStatus.url||"empty_url",a=this.streamingTasks.get(r),l=i.reason;switch(i.code){case Sn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new W(x.LIVE_STREAMING_CDN_ERROR,"",{code:i.code});if(a)return w.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(r,h);if(!this.isStartingStreamingTask)return;this.statusError.set(r,h)}case Sn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new W(x.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,l);return this.onLiveStreamWarning&&this.onLiveStreamWarning(r,h)}case Sn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Sn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(yo(d=this.streamingTasks).call(d));for(const p of h)p.abortTask?p.abortTask():(w.warning("[".concat(this.spec.clientId,"] publish stream status code"),i.code,"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,new W(x.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:i.code})).then(()=>{w.debug("[".concat(this.spec.clientId,"] republish live stream success"),p.url)}).catch(m=>{w.error(m.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,m)}));return}}}handleInjectStreamServerStatus(i){const r=Number(i.uid),a=i.serverStatus&&i.serverStatus.url;switch(i.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(ml.INJECT_STREAM_STATUS_START_SUCCESS,r,a));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(ml.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,r,a),void this.streamingTasks.delete(a);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(ml.INJECT_STREAM_STATUS_START_UNAUTHORIZED,r,a),void this.streamingTasks.delete(a);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(ml.INJECT_STREAM_STATUS_BROKEN,r,a),void this.streamingTasks.delete(a);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(ml.INJECT_STREAM_STATUS_START_TIMEOUT,r,a),void this.streamingTasks.delete(a);default:return void w.debug("inject stream server status",i)}}hasUrl(i){return this.streamingTasks.has(i)}}class om{constructor(){C(this,"destChannelMediaInfos",new Map),C(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(i){FD(i),this.srcChannelMediaInfo=i}addDestChannelInfo(i){FD(i),this.destChannelMediaInfos.set(i.channelName,i)}removeDestChannelInfo(i){_E(i),this.destChannelMediaInfos.delete(i)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function _v(s){if(!(s instanceof om))return new W(x.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const i=s.getSrcChannelMediaInfo(),r=s.getDestChannelMediaInfo();return i?0===r.size?new W(x.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new W(x.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class y2 extends zt{constructor(i,r,a){super(),C(this,"ws",void 0),C(this,"requestId",1),C(this,"heartBeatTimer",void 0),C(this,"joinInfo",void 0),C(this,"clientId",void 0),C(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),C(this,"onClose",l=>{this.emit("close"),this.dispose()}),C(this,"onMessage",l=>{const d=JSON.parse(l.data);if(!d||"serverResponse"!==d.command||!d.requestId)return d&&"serverStatus"===d.command&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)}),this.joinInfo=i,this.clientId=r,this.ws=new Uf("cross-channel-".concat(this.clientId),a),this.ws.on(Me.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Me.CONNECTED,this.onOpen),this.ws.on(Me.ON_MESSAGE,this.onMessage),this.ws.on(Me.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(i){const r=this.requestId++;return i.requestId=r,i.seq=r,this.ws.sendMessage(i),r}waitStatus(i){return new q((r,a)=>{const l=window.setTimeout(()=>{a(new W(x.TIMEOUT,"wait status timeout, status: ".concat(i)))},5e3);this.once(i,d=>{window.clearTimeout(l),d.state&&0!==d.state?a(new W(x.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(i))):r(void 0)}),this.once("dispose",()=>{window.clearTimeout(l),a(new W(x.WS_ABORT))})})}request(i){var r=this;return M(function*(){if("closed"===r.ws.state)throw new W(x.WS_DISCONNECT);"connected"!==r.ws.state&&(yield new q((p,m)=>{r.ws.once(Me.CLOSED,()=>m(new W(x.WS_ABORT))),r.ws.once(Me.CONNECTED,p)}));const l=r.sendMessage(i),d=new q((p,m)=>{const g=()=>{m(new W(x.WS_ABORT))};r.ws.once(Me.RECONNECTING,g),r.ws.once(Me.CLOSED,g),r.once("req_".concat(l),p),_i(3e3).then(()=>{r.removeAllListeners("req_".concat(l)),r.ws.off(Me.RECONNECTING,g),r.ws.off(Me.CLOSED,g),m(new W(x.TIMEOUT,"cross channel ws request timeout"))})}),h=yield d;if(!h||200!==h.code)throw new W(x.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(h)));return h})()}connect(i){var r=this;return M(function*(){r.ws.removeAllListeners(Me.REQUEST_NEW_URLS),r.ws.on(Me.REQUEST_NEW_URLS,a=>{a(i)}),yield r.ws.init(i)})()}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(i){const r=this.requestId++;return i.requestId=r,this.ws.sendMessage(i),r}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class _N extends zt{set state(i){i!==this._state&&(i!==Ji.RELAY_STATE_FAILURE&&(this.errorCode=_l.RELAY_OK),this.emit("state",i,this.errorCode),this._state=i)}get state(){return this._state}constructor(i,r,a,l,d){var h;super(),h=this,C(this,"joinInfo",void 0),C(this,"sid",void 0),C(this,"clientId",void 0),C(this,"cancelToken",vr.CancelToken.source()),C(this,"workerToken",void 0),C(this,"requestId",0),C(this,"signal",void 0),C(this,"prevChannelMediaConfig",void 0),C(this,"httpRetryConfig",void 0),C(this,"_resolution",void 0),C(this,"_state",Ji.RELAY_STATE_IDLE),C(this,"errorCode",_l.RELAY_OK),C(this,"onStatus",p=>{w.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(p))),p&&p.command&&("onAudioPacketReceived"===p.command&&this.emit("event",$s.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===p.command&&this.emit("event",$s.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===p.command&&(this.errorCode=_l.SRC_TOKEN_EXPIRED,this.state=Ji.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===p.command&&(this.errorCode=_l.DEST_TOKEN_EXPIRED,this.state=Ji.RELAY_STATE_FAILURE))}),C(this,"onReconnect",M(function*(){w.debug("[".concat(h.clientId,"] ChannelMediaSocket disconnect, reconnecting")),h.emit("event",$s.NETWORK_DISCONNECTED),h.state=Ji.RELAY_STATE_IDLE,h.prevChannelMediaConfig&&h.sendStartRelayMessage(h.prevChannelMediaConfig).catch(p=>{h.state!==Ji.RELAY_STATE_IDLE&&(w.error("auto restart channel media relay failed",p.toString()),h.errorCode=_l.SERVER_CONNECTION_LOST,h.state=Ji.RELAY_STATE_FAILURE)})})),this.joinInfo=i,this.clientId=r,this.sid=Zg(),this.signal=new y2(this.joinInfo,this.clientId,a),this.httpRetryConfig=l,this._resolution=d}startChannelMediaRelay(i){var r=this;return M(function*(){if(r.state!==Ji.RELAY_STATE_IDLE)throw new W(x.INVALID_OPERATION);r.state=Ji.RELAY_STATE_CONNECTING,yield r.connect(),w.debug("[".concat(r.clientId,"] startChannelMediaRelay: connect success"));try{yield r.sendStartRelayMessage(i)}catch(a){throw a.data&&a.data.serverResponse&&"SetSourceChannel"===a.data.serverResponse.command?new W(x.CROSS_CHANNEL_FAILED_JOIN_SRC):a.data&&a.data.serverResponse&&"SetDestChannelStatus"===a.serverResponse.command?new W(x.CROSS_CHANNEL_FAILED_JOIN_DEST):a.data&&a.data.serverResponse&&"StartPacketTransfer"===a.serverResponse.command?new W(x.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):a}r.prevChannelMediaConfig=i})()}updateChannelMediaRelay(i){var r=this;return M(function*(){if(r.state!==Ji.RELAY_STATE_RUNNING)throw new W(x.INVALID_OPERATION);yield r.sendUpdateMessage(i),r.prevChannelMediaConfig=i})()}setVideoProfile(i){var r=this;return M(function*(){if(r._resolution=i,r.state!==Ji.RELAY_STATE_RUNNING)throw new W(x.INVALID_OPERATION);const a=r.genMessage(gi.SetVideoProfile);yield r.signal.request(a),w.debug("[".concat(r.clientId,"] startChannelMediaRelay: setVideoProfile success"))})()}stopChannelMediaRelay(){var i=this;return M(function*(){yield i.sendStopRelayMessage(),w.debug("[".concat(i.clientId,"] stopChannelMediaRelay: send stop message success")),i.state=Ji.RELAY_STATE_IDLE,i.dispose()})()}dispose(){w.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=vr.CancelToken.source(),this.state=Ji.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}connect(){var i=this;return M(function*(){const r=yield function g2(s,i,r){return b0.apply(this,arguments)}(i.joinInfo,i.cancelToken.token,i.httpRetryConfig);i.workerToken=r.workerToken,yield i.signal.connect(r.addressList),i.emit("event",$s.NETWORK_CONNECTED),i.signal.on("status",i.onStatus),i.signal.on("reconnecting",i.onReconnect)})()}sendStartRelayMessage(i){var r=this;return M(function*(){const a=r.genMessage(gi.StopPacketTransfer);yield r.signal.request(a),yield r.signal.waitStatus("Normal Quit"),w.debug("[".concat(r.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const l=r.genMessage(gi.SetSdkProfile,i);yield r.signal.request(l),w.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const d=r.genMessage(gi.SetSourceChannel,i);yield r.signal.request(d),yield r.signal.waitStatus("SetSourceChannelStatus"),r.emit("event",$s.PACKET_JOINED_SRC_CHANNEL),w.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const h=r.genMessage(gi.SetSourceUserId,i);yield r.signal.request(h),w.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const p=r.genMessage(gi.SetDestChannel,i);yield r.signal.request(p),yield r.signal.waitStatus("SetDestChannelStatus"),r.emit("event",$s.PACKET_JOINED_DEST_CHANNEL),w.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=r.genMessage(gi.StartPacketTransfer,i);yield r.signal.request(m),r.emit("event",$s.PACKET_SENT_TO_DEST_CHANNEL),r.state=Ji.RELAY_STATE_RUNNING,w.debug("[".concat(r.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),r.setVideoProfile(r._resolution)})()}sendUpdateMessage(i){var r=this;return M(function*(){const a=r.genMessage(gi.UpdateDestChannel,i);yield r.signal.request(a),r.emit("event",$s.PACKET_UPDATE_DEST_CHANNEL),w.debug("[".concat(r.clientId,"] sendUpdateMessage: UpdateDestChannel success"))})()}sendStopRelayMessage(){var i=this;return M(function*(){const r=i.genMessage(gi.StopPacketTransfer);yield i.signal.request(r),w.debug("[".concat(i.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))})()}genMessage(i,r){const a=[],l=[],d=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Yo,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.19.2"===h.sdkVersion&&(h.sdkVersion="0.0.1");let p=null,m=null;switch(i){case gi.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case gi.SetSourceChannel:if(m=r&&r.getSrcChannelMediaInfo(),!m)throw new W(x.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:m.channelName,token:m.token||this.joinInfo.appId},h;case gi.SetSourceUserId:if(m=r&&r.getSrcChannelMediaInfo(),!m)throw new W(x.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:m.uid+""},h;case gi.SetDestChannel:if(p=r&&r.getDestChannelMediaInfo(),!p)throw new W(x.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(g=>{a.push(g.channelName),l.push(g.uid+""),d.push(g.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:a,uid:l,token:d},h;case gi.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case gi.Reconnect:return h.clientRequest={command:"Reconnect"},h;case gi.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case gi.UpdateDestChannel:if(p=r&&r.getDestChannelMediaInfo(),!p)throw new W(x.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(g=>{a.push(g.channelName),l.push(g.uid+""),d.push(g.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:a,uid:l,token:d},h;case gi.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}class Oi{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(i,r){C(this,"uid",void 0),C(this,"_uintid",void 0),C(this,"_trust_in_room_",!0),C(this,"_trust_audio_enabled_state_",!0),C(this,"_trust_video_enabled_state_",!0),C(this,"_trust_audio_mute_state_",!0),C(this,"_trust_video_mute_state_",!0),C(this,"_audio_muted_",!1),C(this,"_video_muted_",!1),C(this,"_audio_enabled_",!0),C(this,"_video_enabled_",!0),C(this,"_audio_added_",!1),C(this,"_video_added_",!1),C(this,"_trust_video_stream_added_state_",!0),C(this,"_trust_audio_stream_added_state_",!0),C(this,"_audioTrack",void 0),C(this,"_videoTrack",void 0),C(this,"_dataChannels",[]),C(this,"_audioSSRC",void 0),C(this,"_videoSSRC",void 0),C(this,"_audioOrtc",void 0),C(this,"_videoOrtc",void 0),C(this,"_cname",void 0),C(this,"_rtxSsrcId",void 0),this.uid=i,this._uintid=r}}var gN=OA,EN=wa;Ct({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var s=EN.f(this);return{promise:s.promise,resolve:s.resolve,reject:s.reject}}});var D3=wa,qd=eh;Ct({target:"Promise",stat:!0,forced:!0},{try:function(s){var i=D3.f(this),r=qd(s);return(r.error?i.reject:i.resolve)(r.value),i.promise}});var I0=lr(gN),R0=Vs.f("asyncIterator"),A0=lr(R0);function Hh(s,i){this.v=s,this.k=i}function Gh(s){var i,r;function a(d,h){try{var p=s[d](h),m=p.value,g=m instanceof Hh;I0.resolve(g?m.v:m).then(function(E){if(g){var y="return"===d?"return":"next";if(!m.k||E.done)return a(y,E);E=s[y](E).value}l(p.done?"return":"normal",E)},function(E){a("throw",E)})}catch(E){l("throw",E)}}function l(d,h){switch(d){case"return":i.resolve({value:h,done:!0});break;case"throw":i.reject(h);break;default:i.resolve({value:h,done:!1})}(i=i.next)?a(i.key,i.arg):r=null}this._invoke=function(d,h){return new I0(function(p,m){var g={key:d,arg:h,resolve:p,reject:m,next:null};r?r=r.next=g:(i=r=g,a(d,h))})},"function"!=typeof s.return&&(this.return=void 0)}function as(s){return function(){return new Gh(s.apply(this,arguments))}}function ht(s){return new Hh(s,0)}function sm(s){var i={},r=!1;function a(l,d){return r=!0,{done:!1,value:new Hh(d=new I0(function(h){h(s[l](d))}),1)}}return i[void 0!==Zc&&Yp||"@@iterator"]=function(){return this},i.next=function(l){return r?(r=!1,l):a("next",l)},"function"==typeof s.throw&&(i.throw=function(l){if(r)throw r=!1,l;return a("throw",l)}),"function"==typeof s.return&&(i.return=function(l){return r?(r=!1,l):a("return",l)}),i}Gh.prototype["function"==typeof Zc&&A0||"@@asyncIterator"]=function(){return this},Gh.prototype.next=function(s){return this._invoke("next",s)},Gh.prototype.throw=function(s){return this._invoke("throw",s)},Gh.prototype.return=function(s){return this._invoke("return",s)};var vN=lr(R0),yN={exports:{}};!function(s,i){s.exports=(()=>{var r={8:(d,h,p)=>{p.r(h),p.d(h,{Parser:()=>ve,Printer:()=>li,parse:()=>Le,print:()=>ut});const m="\n",g="".concat("\r").concat(m),E=" ";let y;function b(de){return de>="0"&&de<="9"}function T(de){return de>="!"&&de<="~"}function O(de){return T(de)||de>="\x80"&&de<="\xff"}function P(de){return"!"===de||de>="#"&&de<="'"||de>="*"&&de<="+"||de>="-"&&de<="."||de>="0"&&de<="9"||de>="A"&&de<="Z"||de>="^"&&de<="~"}function D(de){return de>="1"&&de<="9"}function L(de){return de>="A"&&de<="Z"||de>="a"&&de<="z"}function B(de){return"d"===de||"h"===de||"m"===de||"s"===de}function V(de){return de>"\x01"&&de<"\t"||de>"\v"&&de<"\f"||de>"\x0e"&&de<"\xff"}function Q(de){return L(de)||b(de)||"+"===de||"/"===de}function se(de){return b(de)||L(de)||"+"===de||"/"===de||"-"===de||"_"===de}function K(de){return L(de)||b(de)||"+"===de||"/"===de}function ee(de,I){var F=Object.keys(de);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(de);I&&(H=H.filter(function(oe){return Object.getOwnPropertyDescriptor(de,oe).enumerable})),F.push.apply(F,H)}return F}function $(de){for(var I=1;I<arguments.length;I++){var F=null!=arguments[I]?arguments[I]:{};I%2?ee(Object(F),!0).forEach(function(H){Y(de,H,F[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(de,Object.getOwnPropertyDescriptors(F)):ee(Object(F)).forEach(function(H){Object.defineProperty(de,H,Object.getOwnPropertyDescriptor(F,H))})}return de}function Y(de,I,F){return I in de?Object.defineProperty(de,I,{value:F,enumerable:!0,configurable:!0,writable:!0}):de[I]=F,de}var de;(de=y||(y={})).VERSION="v",de.ORIGIN="o",de.SESSION_NAME="s",de.INFORMATION="i",de.URI="u",de.EMAIL="e",de.PHONE="p",de.CONNECTION="c",de.BANDWIDTH="b",de.TIME="t",de.REPEAT="r",de.ZONE_ADJUSTMENTS="z",de.KEY="k",de.ATTRIBUTE="a",de.MEDIA="m";class _e{consumeText(I,F){let H=F;for(;H<I.length;){const oe=I[H];if("\0"===oe||"\r"===oe||oe===m)break;H+=1}if(H-F==0)throw new Error("Invalid text, at ".concat(I));return H}consumeUnicastAddress(I,F,H){return this.consumeTill(I,F,E)}consumeOneOrMore(I,F,H){let oe=F;for(;H(I[oe]);)oe++;if(oe-F==0)throw new Error("Invalid rule at ".concat(F,"."));return oe}consumeSpace(I,F){if(I[F]===E)return F+1;throw new Error("Invalid space at ".concat(F,"."))}consumeIP4Address(I,F){let H=F;for(let oe=0;oe<4;oe++)if(H=this.consumeDecimalUChar(I,H),3!==oe){if("."!==I[H])throw new Error("Invalid IP4 address.");H++}return H}consumeDecimalUChar(I,F){let H=F;for(let Be=0;Be<3&&b(I[H]);Be++,H++);if(H-F==0)throw new Error("Invalid decimal uchar.");const oe=parseInt(I.slice(F,H));if(oe>=0&&oe<=255)return H;throw new Error("Invalid decimal uchar")}consumeIP6Address(I,F){let H=this.consumeHexpart(I,F);return":"===I[H]&&(H+=1,H=this.consumeIP4Address(I,H)),H}consumeHexpart(I,F){let H=F;if(":"===I[H]&&":"===I[H+1]){H+=2;try{H=this.consumeHexseq(I,H)}catch{}return H}if(H=this.consumeHexseq(I,H),":"===I[H]&&":"===I[H+1]){H+=2;try{H=this.consumeHexseq(I,H)}catch{}return H}return H}consumeHexseq(I,F){let H=F;for(;H=this.consumeHex4(I,H),":"===I[H]&&":"!==I[H+1];)H+=1;return H}consumeHex4(I,F){let H=0;for(;H<4;H++)if(!((oe=I[F+H])>="0"&&oe<="9"||oe>="a"&&oe<="f"||oe>="A"&&oe<="F")){if(0===H)throw new Error("Invalid hex 4");break}var oe;return F+H}consumeFQDN(I,F){let H=F;for(;b(I[H])||L(I[H])||"-"===I[H]||"."===I[H];)H+=1;if(H-F<4)throw new Error("Invalid FQDN");return H}consumeExtnAddr(I,F){return this.consumeOneOrMore(I,F,O)}consumeMulticastAddress(I,F,H){switch(H){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(I,F);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(I,F);default:try{return this.consumeFQDN(I,F)}catch{return this.consumeExtnAddr(I,F)}}}consumeIP6MulticastAddress(I,F){const H=this.consumeHexpart(I,F);return"/"===I[H]?this.consumeInteger(I,H+1):H}consumeIP4MulticastAddress(I,F){let H=F+3;const oe=I.slice(F,H),Be=parseInt(oe);if(Be<224||Be>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Bt=0;Bt<3;Bt++){if("."!==I[H])throw new Error("Invalid IP4 multicast address.");H+=1,H=this.consumeDecimalUChar(I,H)}return"/"===I[H]&&(H+=1),H=this.consumeTTL(I,H),"/"===I[H]&&(H=this.consumeInteger(I,H)),H}consumeInteger(I,F){if(!D(I[F]))throw new Error("Invalid integer.");for(F+=1;b(I[F]);)F+=1;return F}consumeTTL(I,F){if("0"===I[F])return F+1;if(!D(I[F]))throw new Error("Invalid TTL.");F+=1;for(let H=0;H<2&&b(I[F]);H++)F+=1;return F}consumeToken(I,F){return this.consumeOneOrMore(I,F,P)}consumeTime(I,F){let H=F;if("0"===I[H])return H+1;for(D(I[H])&&(H+=1);b(I[H]);)H++;if(H-F<10)throw new Error("Invalid time");return H}consumeAddress(I,F){return this.consumeTill(I,F,E)}consumeTypedTime(I,F){let H=F;return H=this.consumeOneOrMore(I,H,b),B(I[H])?H+1:H}consumeRepeatInterval(I,F){if(!D(I[F]))throw new Error("Invalid repeat interval");for(F+=1;b(I[F]);)F+=1;return B(I[F])&&(F+=1),F}consumePort(I,F){return this.consumeOneOrMore(I,F,b)}consume(I,F,H){for(let oe=0;oe<H.length;oe++){if(F+oe>=I.length)throw new Error("consume exceeding value length");if(I[F+oe]!==H[oe])throw new Error("consume ".concat(H," failed at ").concat(oe))}return F+H.length}consumeTill(I,F,H){let oe=F;for(;oe<I.length&&("string"!=typeof H||I[oe]!==H)&&("function"!=typeof H||!H(I[oe]));)oe++;return oe}}class ve extends _e{constructor(){super(),Y(this,"records",[]),Y(this,"currentLine",0)}parse(I){const F=this.probeEOL(I);this.records=I.split(F).filter(An=>!!An.trim()).map(this.parseLine),this.currentLine=0;const H=this.parseVersion(),oe=this.parseOrigin(),Be=this.parseSessionName(),Bt=this.parseInformation(),Pi=this.parseUri(),sr=this.parseEmail(),kr=this.parsePhone(),mm=this.parseConnection(),Wi=this.parseBandWidth(),zi=this.parseTimeFields(),kl=this.parseKey(),Jd=this.parseSessionAttribute(),hn=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:H,origin:oe,sessionName:Be,information:Bt,uri:Pi,emails:sr,phones:kr,connection:mm,bandwidths:Wi,timeFields:zi,key:kl,attributes:Jd,mediaDescriptions:hn}}getCurrentRecord(){const I=this.records[this.currentLine];if(!I)throw new Error("Record doesn't exit.");return I}probeEOL(I){for(let F=0;F<I.length;F++)if(I[F]===m)return"\r"===I[F-1]?g:m;throw new Error("Invalid newline character.")}parseLine(I,F){if(I.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const H=I[0];if("="!==I[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:H,value:I.slice(2),line:F,cur:0}}parseSessionAttribute(){const I=new yt;for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==y.ATTRIBUTE)break;const H={attField:this.extractOneOrMore(F,oe=>P(oe)&&":"!==oe),_cur:0};":"===F.value[F.cur]&&(F.cur+=1,H.attValue=this.extractOneOrMore(F,V)),I.parse(H),this.currentLine++}return I.digest()}parseMediaAttributes(I){const F=new xn(I);for(;this.currentLine<this.records.length;){const H=this.getCurrentRecord();if(H.type!==y.ATTRIBUTE)break;const oe={attField:this.extractOneOrMore(H,Be=>P(Be)&&":"!==Be),_cur:0};":"===H.value[H.cur]&&(H.cur+=1,oe.attValue=this.extractOneOrMore(H,V)),F.parse(oe),this.currentLine++}return F.digest()}parseKey(){const I=this.getCurrentRecord();if(I.type===y.KEY){if("prompt"===I.value||"clear:"===I.value||"base64:"===I.value||"uri:"===I.value)return I.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const I=this.getCurrentRecord();if(I.type===y.ZONE_ADJUSTMENTS){const F=[];for(;;)try{const H=this.extract(I,this.consumeTime);this.consumeSpaceForRecord(I);let oe=!1;"-"===I.value[I.cur]&&(oe=!0,I.cur+=1);const Be=this.extract(I,this.consumeTypedTime);F.push({time:H,typedTime:Be,back:oe})}catch{break}if(0===F.length)throw new Error("Invalid zone adjustments");return this.currentLine++,F}return[]}parseRepeat(){const I=[];for(;;){const F=this.getCurrentRecord();if(F.type!==y.REPEAT)break;{const H=this.extract(F,this.consumeRepeatInterval),oe=this.parseTypedTime(F);I.push({repeatInterval:H,typedTimes:oe}),this.currentLine++}}return I}parseTypedTime(I){const F=[];for(;;)try{this.consumeSpaceForRecord(I),F.push(this.extract(I,this.consumeTypedTime))}catch{break}if(0===F.length)throw new Error("Invalid typed time.");return F}parseTime(){const I=this.getCurrentRecord(),F=this.extract(I,this.consumeTime);this.consumeSpaceForRecord(I);const H=this.extract(I,this.consumeTime);return this.currentLine++,{startTime:F,stopTime:H}}parseBandWidth(){const I=[];for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==y.BANDWIDTH)break;{const H=this.extractOneOrMore(F,P);if(":"!==F.value[F.cur])throw new Error("Invalid bandwidth field.");F.cur++;const oe=this.extractOneOrMore(F,b);I.push({bwtype:H,bandwidth:oe}),this.currentLine++}}return I}parseVersion(){const I=this.getCurrentRecord();if(I.type!==y.VERSION)throw new Error("first sdp record must be version");const F=I.value.slice(0,this.consumeOneOrMore(I.value,0,b));if(F.length!==I.value.length)throw new Error('invalid proto version, "v='.concat(I.value,'"'));return this.currentLine++,F}parseOrigin(){const I=this.getCurrentRecord();if(I.type!==y.ORIGIN)throw new Error("second line of sdp must be origin");const F=this.extractOneOrMore(I,O);this.consumeSpaceForRecord(I);const H=this.extractOneOrMore(I,b);this.consumeSpaceForRecord(I);const oe=this.extractOneOrMore(I,b);this.consumeSpaceForRecord(I);const Be=this.extractOneOrMore(I,P);this.consumeSpaceForRecord(I);const Bt=this.extractOneOrMore(I,P);this.consumeSpaceForRecord(I);const Pi=this.extract(I,this.consumeUnicastAddress);return this.currentLine++,{username:F,sessId:H,sessVersion:oe,nettype:Be,addrtype:Bt,unicastAddress:Pi}}parseSessionName(){const I=this.getCurrentRecord();if(I.type===y.SESSION_NAME){const F=this.extract(I,this.consumeText);return this.currentLine++,F}}parseInformation(){const I=this.getCurrentRecord();if(I.type!==y.INFORMATION)return;const F=this.extract(I,this.consumeText);return this.currentLine++,F}parseUri(){const I=this.getCurrentRecord();if(I.type===y.URI)return this.currentLine++,I.value}parseEmail(){const I=[];for(;;){const F=this.getCurrentRecord();if(F.type!==y.EMAIL)break;I.push(F.value),this.currentLine++}return I}parsePhone(){const I=[];for(;;){const F=this.getCurrentRecord();if(F.type!==y.PHONE)break;I.push(F.value),this.currentLine++}return I}parseConnection(){const I=this.getCurrentRecord();if(I.type===y.CONNECTION){const F=this.extractOneOrMore(I,P);this.consumeSpaceForRecord(I);const H=this.extractOneOrMore(I,P);this.consumeSpaceForRecord(I);const oe=this.extract(I,this.consumeAddress);return this.currentLine++,{nettype:F,addrtype:H,address:oe}}}parseMedia(){const I=this.getCurrentRecord(),F=this.extract(I,this.consumeToken);this.consumeSpaceForRecord(I);let H=this.extract(I,this.consumePort);"/"===I.value[I.cur]&&(I.cur+=1,H+=this.extract(I,this.consumeInteger)),this.consumeSpaceForRecord(I);const oe=[];for(oe.push(this.extract(I,this.consumeToken));"/"===I.value[I.cur];)I.cur+=1,oe.push(this.extract(I,this.consumeToken));if(0===oe.length)throw new Error("Invalid proto");const Be=this.parseFmt(I);return this.currentLine++,{mediaType:F,port:H,protos:oe,fmts:Be}}parseTimeFields(){const I=[];for(;this.getCurrentRecord().type===y.TIME;){const F=this.parseTime(),H=this.parseRepeat(),oe=this.parseZone();I.push({time:F,repeats:H,zones:oe})}return I}parseMediaDescription(){const I=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.MEDIA;){const F=this.parseMedia(),H=this.parseInformation(),oe=this.parseConnections(),Be=this.parseBandWidth(),Bt=this.parseKey(),Pi=this.parseMediaAttributes(F);I.push({media:F,information:H,connections:oe,bandwidths:Be,key:Bt,attributes:Pi})}return I}parseConnections(){const I=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.CONNECTION;)I.push(this.parseConnection());return I}parseFmt(I){const F=[];for(;;)try{this.consumeSpaceForRecord(I),F.push(this.extract(I,this.consumeToken))}catch{break}if(0===F.length)throw new Error("Invalid fmts");return F}extract(I,F,...H){const oe=F.call(this,I.value,I.cur,...H),Be=I.value.slice(I.cur,oe);return I.cur=oe,Be}extractOneOrMore(I,F){const H=this.consumeOneOrMore(I.value,I.cur,F),oe=I.value.slice(I.cur,H);return I.cur=H,oe}consumeSpaceForRecord(I){if(I.value[I.cur]!==E)throw new Error("Invalid space at ".concat(I.cur,"."));I.cur+=1}}class Ze extends _e{constructor(...I){super(...I),Y(this,"attributes",void 0),Y(this,"digested",!1)}extractOneOrMore(I,F,H){const oe=this.consumeOneOrMore(I.attValue,I._cur,F),Be=I.attValue.slice(I._cur,oe),[Bt,Pi]=H||[];if("number"==typeof Bt&&Be.length<Bt)throw new Error("error in length, should be more or equal than ".concat(Bt," characters."));if("number"==typeof Pi&&Be.length>Pi)throw new Error("error in length, should be less or equal than ".concat(Pi," characters."));return I._cur=oe,Be}consumeAttributeSpace(I){if(I.attValue[I._cur]!==E)throw new Error("Invalid space at ".concat(I._cur,"."));I._cur+=1}extract(I,F,...H){if(!I.attValue)throw new Error("Nothing to extract from attValue.");const oe=F.call(this,I.attValue,I._cur,...H),Be=I.attValue.slice(I._cur,oe);return I._cur=oe,Be}atEnd(I){if(!I.attValue)throw new Error;return I._cur>=I.attValue.length}peekChar(I){if(!I.attValue)throw new Error;return I.attValue[I._cur]}peek(I,F){if(!I.attValue)throw new Error;for(let H=0;H<F.length;H++)if(F[H]!==I.attValue[I._cur+H])return!1;return!0}parseIceUfrag(I){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(I,Q,[4,256])}parseIcePwd(I){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(I,Q,[22,256])}parseIceOptions(I){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const F=[];for(;!this.atEnd(I);){F.push(this.extractOneOrMore(I,Q));try{this.consumeAttributeSpace(I)}catch(H){if(this.atEnd(I))break;throw H}}this.attributes.iceOptions=F}parseFingerprint(I){const F=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);const H=this.extract(I,this.consumeTill);this.attributes.fingerprints.push({hashFunction:F,fingerprint:H})}parseExtmap(I){const F=this.extractOneOrMore(I,b);let H;"/"===this.peekChar(I)&&(this.extract(I,this.consume,"/"),H=this.extract(I,this.consumeToken)),this.consumeAttributeSpace(I);const oe=this.extract(I,this.consumeTill,E),Be=$($({entry:parseInt(F,10)},H&&{direction:H}),{},{extensionName:oe});this.peekChar(I)===E&&(this.consumeAttributeSpace(I),Be.extensionAttributes=this.extract(I,this.consumeTill)),this.attributes.extmaps.push(Be)}parseSetup(I){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const F=this.extract(I,this.consumeTill);if("active"!==F&&"passive"!==F&&"actpass"!==F&&"holdconn"!==F)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=F}}class yt extends Ze{constructor(...I){super(...I),Y(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(I){if(this.digested)throw new Error("already digested");try{switch(I.attField){case"group":this.parseGroup(I);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(I);break;case"ice-pwd":this.parseIcePwd(I);break;case"ice-options":this.parseIceOptions(I);break;case"fingerprint":this.parseFingerprint(I);break;case"setup":this.parseSetup(I);break;case"tls-id":this.parseTlsId(I);break;case"identity":this.parseIdentity(I);break;case"extmap":this.parseExtmap(I);break;case"msid-semantic":this.parseMsidSemantic(I);break;default:I.ignored=!0,this.attributes.unrecognized.push(I)}}catch(F){throw console.error("parsing session attribute ".concat(I.attField,' error, "a=').concat(I.attField,":").concat(I.attValue,'"')),F}if(!I.ignored&&I.attValue&&!this.atEnd(I))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(I){const F=this.extract(I,this.consumeToken),H=[];for(;!this.atEnd(I)&&this.peekChar(I)===E;)this.consumeAttributeSpace(I),H.push(this.extract(I,this.consumeToken));this.attributes.groups.push({semantic:F,identificationTag:H})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(I){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(I,se)}parseIdentity(I){const F=this.extractOneOrMore(I,K),H=[];for(;!this.atEnd(I)&&this.peekChar(I)===E;){this.consumeAttributeSpace(I);const oe=this.extract(I,this.consumeToken);this.extract(I,this.consume,"=");const Be=this.extractOneOrMore(I,Bt=>Bt!==E&&V(Bt));H.push({name:oe,value:Be})}this.attributes.identities.push({assertionValue:F,extensions:H})}parseMsidSemantic(I){this.peekChar(I)===E&&this.consumeAttributeSpace(I);const F={semantic:this.extract(I,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(I)}catch{break}if("*"===this.peekChar(I)){this.extract(I,this.consume,"*"),F.applyForAll=!0;break}{const H=this.extract(I,this.consumeTill,E);F.identifierList.push(H)}}this.attributes.msidSemantic=F}}class xn extends Ze{constructor(I){super(),Y(this,"attributes",void 0),-1!==I.protos.indexOf("RTP")||I.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(I){if(this.digested)throw new Error("already digested");try{switch(I.attField){case"extmap":this.parseExtmap(I);break;case"setup":this.parseSetup(I);break;case"ice-ufrag":this.parseIceUfrag(I);break;case"ice-pwd":this.parseIcePwd(I);break;case"ice-options":this.parseIceOptions(I);break;case"candidate":this.parseCandidate(I);break;case"remote-candidate":this.parseRemoteCandidate(I);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(I);break;case"rtpmap":this.parseRtpmap(I);break;case"ptime":this.parsePtime(I);break;case"maxptime":this.parseMaxPtime(I);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(I);break;case"ssrc":this.parseSSRC(I);break;case"fmtp":this.parseFmtp(I);break;case"rtcp-fb":this.parseRtcpFb(I);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(I);break;case"mid":this.parseMid(I);break;case"msid":this.parseMsid(I);break;case"imageattr":this.parseImageAttr(I);break;case"rid":this.parseRid(I);break;case"simulcast":this.parseSimulcast(I);break;case"sctp-port":this.parseSctpPort(I);break;case"max-message-size":this.parseMaxMessageSize(I);break;case"ssrc-group":this.parseSSRCGroup(I);break;default:I.ignored=!0,this.attributes.unrecognized.push(I)}}catch(F){throw console.error("parsing media attribute ".concat(I.attField,' error, "a=').concat(I.attField,":").concat(I.attValue,'"')),F}if(!I.ignored&&I.attValue&&!this.atEnd(I))throw new Error("attribute parsing error")}parseCandidate(I){const F=this.extractOneOrMore(I,Q,[1,32]);this.consumeAttributeSpace(I);const H=this.extractOneOrMore(I,b,[1,5]);this.consumeAttributeSpace(I);const oe=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);const Be=this.extractOneOrMore(I,b,[1,10]);this.consumeAttributeSpace(I);const Bt=this.extract(I,this.consumeAddress);this.consumeAttributeSpace(I);const Pi=this.extract(I,this.consumePort);this.consumeAttributeSpace(I),this.extract(I,this.consume,"typ"),this.consumeAttributeSpace(I);const sr={foundation:F,componentId:H,transport:oe,priority:Be,connectionAddress:Bt,port:Pi,type:this.extract(I,this.consumeToken),extension:{}};for(this.peek(I," raddr")&&(this.extract(I,this.consume," raddr"),this.consumeAttributeSpace(I),sr.relAddr=this.extract(I,this.consumeAddress)),this.peek(I," rport")&&(this.extract(I,this.consume," rport"),this.consumeAttributeSpace(I),sr.relPort=this.extract(I,this.consumePort));this.peekChar(I)===E;){this.consumeAttributeSpace(I);const kr=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I),sr.extension[kr]=this.extractOneOrMore(I,T)}this.attributes.candidates.push(sr)}parseRemoteCandidate(I){const F=[];for(;;){const H=this.extractOneOrMore(I,b,[1,5]);this.consumeAttributeSpace(I);const oe=this.extract(I,this.consumeAddress);this.consumeAttributeSpace(I);const Be=this.extract(I,this.consumePort);F.push({componentId:H,connectionAddress:oe,port:Be});try{this.consumeAttributeSpace(I)}catch{break}}this.attributes.remoteCandidatesList.push(F)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(I){const F=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);const H=this.extract(I,this.consumeTill,"/");this.extract(I,this.consume,"/");const oe={encodingName:H,clockRate:this.extractOneOrMore(I,b)};this.atEnd(I)||"/"!==this.peekChar(I)||(this.extract(I,this.consume,"/"),oe.encodingParameters=parseInt(this.extract(I,this.consumeTill),10));const Be=this.attributes.payloads.find(Bt=>Bt.payloadType===parseInt(F,10));Be?Be.rtpMap=oe:this.attributes.payloads.push({payloadType:parseInt(F,10),rtpMap:oe,rtcpFeedbacks:[]})}parsePtime(I){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(I,this.consumeTill)}parseMaxPtime(I){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(I,this.consumeTill)}parseDirection(I){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=I.attField}parseSSRC(I){const F=this.extractOneOrMore(I,b);this.consumeAttributeSpace(I);const H=this.extract(I,this.consumeTill,":");let oe;":"===this.peekChar(I)&&(this.extract(I,this.consume,":"),oe=this.extract(I,this.consumeTill));const Be=this.attributes.ssrcs.find(Bt=>Bt.ssrcId===parseInt(F,10));Be?Be.attributes[H]=oe:this.attributes.ssrcs.push({ssrcId:parseInt(F,10),attributes:{[H]:oe}})}parseFmtp(I){const F=this.extract(I,this.consumeTill,E);this.consumeAttributeSpace(I);const H=this.extract(I,this.consumeTill),oe={};H.split(";").forEach(Bt=>{let[Pi,sr]=Bt.split("=");Pi=Pi.trim();const kr="string"==typeof sr?sr.trim():null;"string"==typeof Pi&&Pi.length>0&&(oe[Pi]=kr)});const Be=this.attributes.payloads.find(Bt=>Bt.payloadType===parseInt(F,10));Be?Be.fmtp={parameters:oe}:this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[],fmtp:{parameters:oe}})}parseFmtParameters(I){const F={},H=this.extract(I,this.consumeTill,"=");I._cur++;const oe=this.extract(I,this.consumeTill,";");for(F[H]=oe;";"===I.attValue[I._cur];){const Be=this.extract(I,this.consumeTill,"=");I._cur++;const Bt=this.extract(I,this.consumeTill,";");F[Be]=Bt}return F}parseRtcpFb(I){let F="";F="*"===this.peekChar(I)?this.extract(I,this.consume,"*"):this.extract(I,this.consumeTill,E),this.consumeAttributeSpace(I);const H=this.extract(I,this.consumeTill,E);let oe;if("trr-int"===H)oe={type:H,interval:this.extract(I,this.consumeTill)};else{const Be={type:H};this.peekChar(I)===E&&(this.consumeAttributeSpace(I),Be.parameter=this.extract(I,this.consumeToken),this.peekChar(I)===E&&(Be.additional=this.extract(I,this.consumeTill))),oe=Be}if("*"===F)this.attributes.rtcpFeedbackWildcards.push(oe);else{const Be=this.attributes.payloads.find(Bt=>Bt.payloadType===parseInt(F,10));Be?Be.rtcpFeedbacks.push(oe):this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[oe]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(I){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const F={port:this.extract(I,this.consumePort)};this.peekChar(I)===E&&(this.consumeAttributeSpace(I),F.netType=this.extractOneOrMore(I,P),this.consumeAttributeSpace(I),F.addressType=this.extractOneOrMore(I,P),this.consumeAttributeSpace(I),F.address=this.extract(I,this.consumeAddress)),this.attributes.rtcp=F}parseMsid(I){const F={id:this.extractOneOrMore(I,P,[1,64])};this.peekChar(I)===E&&(this.consumeAttributeSpace(I),F.appdata=this.extractOneOrMore(I,P,[1,64])),this.attributes.msids.push(F)}parseImageAttr(I){this.attributes.imageattr.push(I.attValue)}parseRid(I){const F=this.extractOneOrMore(I,oe=>L(oe)||b(oe)||"_"===oe||"-"===oe);this.consumeAttributeSpace(I);const H={id:F,direction:this.extract(I,this.consumeToken),params:[]};if(this.peekChar(I)===E){if(this.consumeAttributeSpace(I),this.peek(I,"pt=")){this.extract(I,this.consume,"pt=");const oe=[];for(;;){const Be=this.extract(I,this.consumeToken);oe.push(Be);try{this.extract(I,this.consume,",")}catch{break}}H.payloads=oe,this.peekChar(I)===E&&this.extract(I,this.consume,E)}for(;;){const oe=this.extract(I,this.consumeToken);switch(oe){case"depend":{const Be={type:oe,rids:this.extract(I,this.consume,"=").split(",")};H.params.push(Be);break}default:{const Be={type:oe};"="===this.peekChar(I)&&(this.extract(I,this.consume,"="),Be.val=this.extract(I,this.consumeTill,";")),H.params.push(Be)}}try{this.extract(I,this.consume,";")}catch{break}}}this.attributes.rids.push(H)}parseSimulcast(I){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=I.attValue,this.extract(I,this.consumeTill)}parseSctpPort(I){this.attributes.sctpPort=this.extractOneOrMore(I,b,[1,5])}parseMaxMessageSize(I){this.attributes.maxMessageSize=this.extractOneOrMore(I,b,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(I){this.attributes.mid=this.extract(I,this.consumeToken)}parseSSRCGroup(I){const F=this.extract(I,this.consumeToken),H=[];for(;;)try{this.consumeAttributeSpace(I);const oe=this.extract(I,this.consumeInteger);H.push(parseInt(oe,10))}catch{break}this.attributes.ssrcGroups.push({semantic:F,ssrcIds:H})}}function Ht(de,I,F){return I in de?Object.defineProperty(de,I,{value:F,enumerable:!0,configurable:!0,writable:!0}):de[I]=F,de}class li{constructor(){Ht(this,"eol",g)}print(I,F){let H="";return F&&(this.eol=F),H+=this.printVersion(I.version),H+=this.printOrigin(I.origin),H+=this.printSessionName(I.sessionName),H+=this.printInformation(I.information),H+=this.printUri(I.uri),H+=this.printEmail(I.emails),H+=this.printPhone(I.phones),H+=this.printConnection(I.connection),H+=this.printBandwidth(I.bandwidths),H+=this.printTimeFields(I.timeFields),H+=this.printKey(I.key),H+=this.printSessionAttributes(I.attributes),H+=this.printMediaDescription(I.mediaDescriptions),H}printVersion(I){return"v=".concat(I).concat(this.eol)}printOrigin(I){return"o=".concat(I.username," ").concat(I.sessId," ").concat(I.sessVersion," ").concat(I.nettype," ").concat(I.addrtype," ").concat(I.unicastAddress).concat(this.eol)}printSessionName(I){return I?"s=".concat(I).concat(this.eol):""}printInformation(I){return I?"i=".concat(I).concat(this.eol):""}printUri(I){return I?"u=".concat(I).concat(this.eol):""}printEmail(I){let F="";for(const H of I)F+="e=".concat(H).concat(this.eol);return F}printPhone(I){let F="";for(const H of I)F+="e=".concat(H).concat(this.eol);return F}printConnection(I){return I?"c=".concat(I.nettype," ").concat(I.addrtype," ").concat(I.address).concat(this.eol):""}printBandwidth(I){let F="";for(const H of I)F+="b=".concat(H.bwtype,":").concat(H.bandwidth).concat(this.eol);return F}printTimeFields(I){let F="";for(const H of I){F+="t=".concat(H.time.startTime," ").concat(H.time.startTime).concat(this.eol);for(const oe of H.repeats)F+="r=".concat(oe.repeatInterval," ").concat(oe.typedTimes.join(" ")).concat(this.eol);H.zoneAdjustments&&(F+="z=",F+="z=".concat(H.zoneAdjustments.map(oe=>"".concat(oe.time," ").concat(oe.back?"-":""," ").concat(oe.typedTime)).join(" ")).concat(this.eol),F+=this.eol)}return F}printKey(I){return I?"k=".concat(I).concat(this.eol):""}printAttributes(I){let F="";for(const H of I)F+="a=".concat(H.attField).concat(H.attValue?":".concat(H.attValue):"").concat(this.eol);return F}printMediaDescription(I){let F="";for(const H of I)F+=this.printMedia(H.media),F+=this.printInformation(H.information),F+=this.printConnections(H.connections),F+=this.printBandwidth(H.bandwidths),F+=this.printKey(H.key),F+=this.printMediaAttributes(H);return F}printConnections(I){let F="";for(const H of I)F+=this.printConnection(H);return F}printMedia(I){return"m=".concat(I.mediaType," ").concat(I.port," ").concat(I.protos.join("/")," ").concat(I.fmts.join(" ")).concat(this.eol)}printSessionAttributes(I){return new ce(this.eol).print(I)}printMediaAttributes(I){return new ge(this.eol).print(I)}}class ie{constructor(I){Ht(this,"eol",void 0),this.eol=I}printIceUfrag(I){return void 0===I?"":"a=ice-ufrag:".concat(I).concat(this.eol)}printIcePwd(I){return void 0===I?"":"a=ice-pwd:".concat(I).concat(this.eol)}printIceOptions(I){return void 0===I?"":"a=ice-options:".concat(I.join(E)).concat(this.eol)}printFingerprints(I){return I.length>0?I.map(F=>"a=fingerprint:".concat(F.hashFunction).concat(E).concat(F.fingerprint)).join(this.eol)+this.eol:""}printExtmap(I){return I.map(F=>"a=extmap:".concat(F.entry).concat(F.direction?"/".concat(F.direction):"").concat(E).concat(F.extensionName).concat(F.extensionAttributes?"".concat(E).concat(F.extensionAttributes):"").concat(this.eol)).join("")}printSetup(I){return void 0===I?"":"a=setup:".concat(I).concat(this.eol)}printUnrecognized(I){return I.map(F=>"a=".concat(F.attField).concat(F.attValue?":".concat(F.attValue):"").concat(this.eol)).join("")}}class ce extends ie{print(I){let F="";return F+=this.printGroups(I.groups),F+=this.printMsidSemantic(I.msidSemantic),F+=this.printIceLite(I.iceLite),F+=this.printIceUfrag(I.iceUfrag),F+=this.printIcePwd(I.icePwd),F+=this.printIceOptions(I.iceOptions),F+=this.printFingerprints(I.fingerprints),F+=this.printSetup(I.setup),F+=this.printTlsId(I.tlsId),F+=this.printIdentity(I.identities),F+=this.printExtmap(I.extmaps),F+=this.printUnrecognized(I.unrecognized),F}printGroups(I){let F="";return I.length>0&&(F+=I.map(H=>"a=group:".concat(H.semantic).concat(H.identificationTag.map(oe=>"".concat(E).concat(oe)).join("")).concat(this.eol)).join("")),F}printIceLite(I){return void 0===I?"":"a=ice-lite"+this.eol}printTlsId(I){return I?"a=tls-id:".concat(I).concat(this.eol):""}printIdentity(I){return 0===I.length?"":I.map(F=>"a=identity:".concat(F.assertionValue).concat(F.extensions.map(H=>"".concat(E).concat(H.name).concat(H.value?"=".concat(H.value):"")))).join(this.eol)+this.eol}printMsidSemantic(I){if(!I)return"";let F="a=msid-semantic:".concat(I.semantic);return I.applyForAll?F+="".concat(E,"*"):I.identifierList.length>0&&(F+=I.identifierList.map(H=>"".concat(E).concat(H))),F+this.eol}}class ge extends ie{print(I){const F=I.attributes;let H="";return H+=this.printRTCP(F.rtcp),H+=this.printIceUfrag(F.iceUfrag),H+=this.printIcePwd(F.icePwd),H+=this.printIceOptions(F.iceOptions),H+=this.printCandidates(F.candidates),H+=this.printRemoteCandidatesList(F.remoteCandidatesList),H+=this.printEndOfCandidates(F.endOfCandidates),H+=this.printFingerprints(F.fingerprints),H+=this.printSetup(F.setup),H+=this.printMid(F.mid),H+=this.printExtmap(F.extmaps),H+=this.printRTPRelated(F),H+=this.printPtime(F.ptime),H+=this.printMaxPtime(F.maxPtime),H+=this.printDirection(F.direction),H+=this.printSSRCGroups(F.ssrcGroups),H+=this.printSSRC(F.ssrcs),H+=this.printRTCPMux(F.rtcpMux),H+=this.printRTCPMuxOnly(F.rtcpMuxOnly),H+=this.printRTCPRsize(F.rtcpRsize),H+=this.printMSId(F.msids),H+=this.printImageattr(F.imageattr),H+=this.printRid(F.rids),H+=this.printSimulcast(F.simulcast),H+=this.printSCTPPort(F.sctpPort),H+=this.printMaxMessageSize(F.maxMessageSize),H+=this.printUnrecognized(F.unrecognized),H}printCandidates(I){return I.map(F=>"a=candidate:".concat(F.foundation).concat(E).concat(F.componentId).concat(E).concat(F.transport).concat(E).concat(F.priority).concat(E).concat(F.connectionAddress).concat(E).concat(F.port).concat(E,"typ").concat(E).concat(F.type).concat(F.relAddr?"".concat(E,"raddr").concat(E).concat(F.relAddr):"").concat(F.relPort?"".concat(E,"rport").concat(E).concat(F.relPort):"").concat(Object.keys(F.extension).map(H=>"".concat(E).concat(H).concat(E).concat(F.extension[H])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(I){return I.map(F=>"a=remote-candidates:".concat(F.join(E)).concat(this.eol)).join("")}printEndOfCandidates(I){return void 0===I?"":"a=end-of-candidates"+this.eol}printRTPRelated(I){if(!I.payloads)return"";const F=I.payloads;let H="";H+=I.rtcpFeedbackWildcards.map(oe=>this.printRTCPFeedback("*",oe)).join("");for(const oe of F)H+=this.printRtpMap(oe.payloadType,oe.rtpMap),H+=this.printFmtp(oe.payloadType,oe.fmtp),H+=oe.rtcpFeedbacks.map(Be=>this.printRTCPFeedback(oe.payloadType,Be)).join("");return H}printFmtp(I,F){if(!F)return"";const H=Object.keys(F.parameters);return 1===H.length&&null===F.parameters[H[0]]?"a=fmtp:".concat(I).concat(E).concat(H[0]).concat(this.eol):"a=fmtp:".concat(I).concat(E).concat(Object.keys(F.parameters).map(oe=>"".concat(oe,"=").concat(F.parameters[oe])).join(";")).concat(this.eol)}printRtpMap(I,F){return F?"a=rtpmap:".concat(I).concat(E).concat(F.encodingName,"/").concat(F.clockRate).concat(F.encodingParameters?"/".concat(F.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(I,F){let H="a=rtcp-fb:".concat(I).concat(E),oe=F;return"trr-int"===oe.type?H+="ttr-int".concat(E).concat(oe.interval):(H+="".concat(oe.type),oe.parameter&&(H+="".concat(E).concat(oe.parameter),oe.additional&&(H+="".concat(E).concat(oe.additional)))),H+this.eol}printPtime(I){return void 0===I?"":"a=ptime:".concat(I).concat(this.eol)}printMaxPtime(I){return void 0===I?"":"a=maxptime:".concat(I).concat(this.eol)}printDirection(I){return void 0===I?"":"a=".concat(I).concat(this.eol)}printSSRC(I){return I.map(F=>Object.keys(F.attributes).map(H=>"a=ssrc:".concat(F.ssrcId.toString(10)).concat(E).concat(H).concat(F.attributes[H]?":".concat(F.attributes[H]):"").concat(this.eol)).join("")).join("")}printRTCPMux(I){return void 0===I?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(I){return void 0===I?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(I){return void 0===I?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(I){if(void 0===I)return"";let F="a=rtcp:".concat(I.port);return I.netType&&(F+="".concat(E).concat(I.netType)),I.addressType&&(F+="".concat(E).concat(I.addressType)),I.address&&(F+="".concat(E).concat(I.address)),F+this.eol}printMSId(I){return I.map(F=>"a=msid:".concat(F.id).concat(F.appdata?"".concat(E).concat(F.appdata):"").concat(this.eol)).join("")}printImageattr(I){return I.map(F=>"a=imageattr:".concat(F).concat(this.eol)).join("")}printRid(I){return I.map(F=>{let H="a=rid:".concat(F.id).concat(E).concat(F.direction);return F.payloads&&(H+="".concat(E,"pt=").concat(F.payloads.join(","))),F.params.length>0&&(H+="".concat(E).concat(F.params.map(oe=>"depend"===oe.type?"depend=".concat(oe.rids.join(",")):"".concat(oe.type,"=").concat(oe.val)).join(";"))),H+this.eol}).join("")}printSimulcast(I){return void 0===I?"":"a=simulcast:".concat(I).concat(this.eol)}printSCTPPort(I){return void 0===I?"":"a=sctp-port:".concat(I).concat(this.eol)}printMaxMessageSize(I){return void 0===I?"":"a=max-message-size:".concat(I).concat(this.eol)}printMid(I){return void 0===I?"":"a=mid:".concat(I).concat(this.eol)}printSSRCGroups(I){return I.map(F=>"a=ssrc-group:".concat(F.semantic).concat(F.ssrcIds.map(H=>"".concat(E).concat(H.toString(10))).join("")).concat(this.eol)).join("")}}function Le(de){return(new ve).parse(de)}function ut(de,I){return(new li).print(de,I)}}},a={};function l(d){if(a[d])return a[d].exports;var h=a[d]={exports:{}};return r[d](h,h.exports,l),h.exports}return l.d=(d,h)=>{for(var p in h)l.o(h,p)&&!l.o(d,p)&&Object.defineProperty(d,p,{enumerable:!0,get:h[p]})},l.o=(d,h)=>Object.prototype.hasOwnProperty.call(d,h),l.r=d=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})},l(8)})()}(yN);var cn=yN.exports;function b2(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Rs(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?b2(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):b2(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function D0(s){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;const{filterRTX:l,filterVideoFec:d,filterAudioFec:h,filterAudioCodec:p,filterVideoCodec:m}=i,{useXR:g}=r;let E=[],y=[],b=[],T=[],O=!1,P=!1;if(cn.parse(s).mediaDescriptions.forEach(D=>{a&&a!==D.attributes.direction||("video"!==D.media.mediaType||O||(y=D.attributes.payloads,T=D.attributes.extmaps,O=!0),"audio"!==D.media.mediaType||P||(E=D.attributes.payloads,b=D.attributes.extmaps,P=!0))}),!T||0===y.length)throw new Error("Cannot get video capabilities from SDP.");if(!b||0===E.length)throw new Error("Cannot get audio capabilities from SDP.");return y.forEach(D=>{var L;null!==(L=D.rtpMap)&&void 0!==L&&L.clockRate&&(D.rtpMap.clockRate=parseInt(D.rtpMap.clockRate)),g&&D.rtcpFeedbacks.push({type:"rrtr"})}),E.forEach(D=>{var L;null!==(L=D.rtpMap)&&void 0!==L&&L.clockRate&&(D.rtpMap.clockRate=parseInt(D.rtpMap.clockRate)),g&&D.rtcpFeedbacks.push({type:"rrtr"})}),l&&(E=E.filter(D=>{var L;return"rtx"!==(null===(L=D.rtpMap)||void 0===L?void 0:L.encodingName.toLowerCase())}),y=y.filter(D=>{var L;return"rtx"!==(null===(L=D.rtpMap)||void 0===L?void 0:L.encodingName.toLowerCase())})),d&&(y=y.filter(D=>{var L;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(L=D.rtpMap)||void 0===L?void 0:L.encodingName)||"")})),h&&(E=E.filter(D=>{var L;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(L=D.rtpMap)||void 0===L?void 0:L.encodingName)||"")})),p&&p?.length>0&&(E=E.filter(D=>{var L;return ye(p).call(p,(null===(L=D.rtpMap)||void 0===L?void 0:L.encodingName.toLowerCase())||"")})),m&&m?.length>0&&(y=y.filter(D=>{var L;return ye(m).call(m,(null===(L=D.rtpMap)||void 0===L?void 0:L.encodingName.toLowerCase())||"")})),{audioCodecs:E,videoCodecs:y,audioExtensions:b,videoExtensions:T}}function Kd(s){const i=cn.parse(s);let r,a;for(const l of i.mediaDescriptions){if(!r){const d=l.attributes.iceUfrag,h=l.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");r={iceUfrag:d,icePwd:h}}if(!a){const d=l.attributes.fingerprints;d.length>0&&(a={fingerprints:d})}}if(!a&&i.attributes.fingerprints.length>0&&(a={fingerprints:i.attributes.fingerprints}),!a||!r)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:r,dtlsParameters:a}}function bN(s,i){const r=[],a=s.attributes.ssrcGroups.filter(h=>"FID"===h.semantic),l=s.attributes.ssrcGroups.find(h=>"SIM"===h.semantic),d=s.attributes.ssrcs;if(l)l.ssrcIds.forEach(h=>{var p;const m=null===(p=a.find(g=>g.ssrcIds[0]===h))||void 0===p?void 0:p.ssrcIds[1];r.push({ssrcId:h,rtx:i?m:void 0})});else if(a.length>0)r.push({ssrcId:a[0].ssrcIds[0],rtx:i?a[0].ssrcIds[1]:void 0});else{if(0===d.length)throw new Error("No ssrcs found on local media description.");r.push({ssrcId:d[0].ssrcId})}return r}function SN(s,i){const{cname:r}=s;let a;i&&i.ip&&"number"==typeof i.port?(a=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:i.ip,port:i.port.toString(),type:"host",extension:{}}],w.debug("Using remote candidate from AP ".concat(i.ip,":").concat(i.port)),i.ip6&&(a.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:i.ip6,port:i.port.toString(),type:"host",extension:{}}),w.debug("Using IPV6 remote candidate from AP ".concat(i.ip6,":").concat(i.port)))):a=s.iceParameters.candidates.map(p=>({foundation:p.foundation,componentId:"1",transport:p.protocol,priority:p.priority.toString(),connectionAddress:p.ip,port:p.port.toString(),type:p.type,extension:{}}));const l={fingerprints:s.dtlsParameters.fingerprints.map(p=>({hashFunction:p.algorithm,fingerprint:p.fingerprint}))},d={iceUfrag:s.iceParameters.iceUfrag,icePwd:s.iceParameters.icePwd};let h;switch(s.dtlsParameters.role){case"server":h="passive";break;case"client":h="active";break;case"auto":h="actpass"}return{dtlsParameters:l,iceParameters:d,candidates:a,rtpCapabilities:vv(s.rtpCapabilities),setup:h,cname:r}}function Jr(s,i,r){const a=[],l=[];return s.forEach(d=>{let{ssrcId:h,rtx:p}=d;const m=Fe(8,"track-"),g={ssrcId:h,attributes:Rs({label:m,mslabel:r=r||Fe(10,""),msid:"".concat(r," ").concat(m)},i&&{cname:i})};if(a.push(g),void 0!==p){const E={ssrcId:p,attributes:Rs({label:m,mslabel:r,msid:"".concat(r," ").concat(m)},i&&{cname:i})};a.push(E),l.push({semantic:"FID",ssrcIds:[h,p]})}}),s.length>1&&l.push({semantic:"SIM",ssrcIds:s.map(d=>{let{ssrcId:h}=d;return h})}),{ssrcs:a,ssrcGroups:l}}function Yd(s,i){i instanceof mt&&s.attributes.payloads.forEach(r=>{var a;const l=null===(a=r.rtpMap)||void 0===a?void 0:a.encodingName.toLowerCase();if(!l||-1===["opus","pcmu","pcma","g722"].indexOf(l))return;r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.minptime="10",r.fmtp.parameters.useinbandfec="1";const d=i._encoderConfig;d&&"pcmu"!==l&&"pcma"!==l&&"g722"!==l&&(d.bitrate&&!Wt()&&(r.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(r.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),r.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"))})}function O0(s){const i=s.attributes.unrecognized.findIndex(r=>"x-google-flag"===r.attField&&"conference"===r.attValue);-1!==i&&s.attributes.unrecognized.splice(i,1)}function N0(s,i){var r;if(!(i instanceof ze&&i._encoderConfig&&-1===i._hints.indexOf(Ot.SCREEN_TRACK)))return;const a=i._encoderConfig;$e().supportMinBitrate&&a.bitrateMin&&s.attributes.payloads.forEach(l=>{var d,h;ye(d=["h264","h265","vp8","vp9","av1"]).call(d,(null===(h=l.rtpMap)||void 0===h?void 0:h.encodingName.toLowerCase())||"")&&(l.fmtp||(l.fmtp={parameters:{}}),l.fmtp.parameters["x-google-min-bitrate"]="".concat(a.bitrateMin))}),$e().supportMinBitrate&&!ye(r=i._hints).call(r,Ot.LOW_STREAM)&&a.bitrateMax&&s.attributes.payloads.forEach(l=>{var d,h;ye(d=["h264","h265","vp8","vp9","av1"]).call(d,(null===(h=l.rtpMap)||void 0===h?void 0:h.encodingName.toLowerCase())||"")&&(l.fmtp||(l.fmtp={parameters:{}}),l.fmtp.parameters["x-google-start-bitrate"]="".concat(j("X_GOOGLE_START_BITRATE")||Math.floor(a.bitrateMax)))})}function CN(s){if("video"!==s.media.mediaType)return;const i=dt();if(i.name!==Ne.SAFARI&&i.os!==Fn.IOS)return;const r=s.attributes.extmaps.findIndex(a=>/video-orientation/g.test(a.extensionName));-1!==r&&s.attributes.extmaps.splice(r,1)}function gv(s,i,r){if(!i)return;let a,l;if("video"===s.media.mediaType?(a=r.videoExtensions,l=r.videoCodecs):(a=r.audioExtensions,l=r.audioCodecs),!0===i.twcc){const d=a.find(h=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===h.extensionName);d&&(s.attributes.extmaps.find(p=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===p.extensionName)||s.attributes.extmaps.push({entry:d.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),(p=l,m=s.attributes.payloads,m.filter(g=>!!p.find(E=>E.payloadType===g.payloadType&&!!E.rtcpFeedbacks.find(y=>"transport-cc"===y.type)))).forEach(p=>{p.rtcpFeedbacks.find(m=>"transport-cc"===m.type)||p.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(!1===i.twcc){const d=s.attributes.extmaps.findIndex(h=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===h.extensionName);-1!==d&&s.attributes.extmaps.splice(d,1),s.attributes.payloads.forEach(h=>{const p=h.rtcpFeedbacks.findIndex(m=>"transport-cc"===m.type);-1!==p&&h.rtcpFeedbacks.splice(p,1)})}var p,m;if(!0===i.remb){const d=a.find(h=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===h.extensionName);d&&(s.attributes.extmaps.find(p=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===p.extensionName)||s.attributes.extmaps.push({entry:d.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(p,m){return m.filter(g=>!!p.find(E=>E.payloadType===g.payloadType&&!!E.rtcpFeedbacks.find(y=>"goog-remb"===y.type)))}(l,s.attributes.payloads).forEach(p=>{p.rtcpFeedbacks.find(m=>"goog-remb"===m.type)||p.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(!1===i.remb){const d=s.attributes.extmaps.findIndex(h=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===h.extensionName);-1!==d&&s.attributes.extmaps.splice(d,1),s.attributes.payloads.forEach(h=>{const p=h.rtcpFeedbacks.findIndex(m=>"goog-remb"===m.type);-1!==p&&h.rtcpFeedbacks.splice(p,1)})}}function P0(s,i,r){if(Wt()||"video"!==s.media.mediaType||!(i instanceof ze)||"vp9"!==r&&"vp8"!==r||"vp8"===r&&!j("SIMULCAST")||void 0===i._scalabilityMode||i._scalabilityMode.numSpatialLayers<=1)return;const a="vp8"===r?2:i._scalabilityMode.numSpatialLayers,l=s.attributes.ssrcs[0],d=s.attributes.ssrcGroups.find(p=>"FID"===p.semantic&&p.ssrcIds[0]===l.ssrcId),h={semantic:"SIM",ssrcIds:[l.ssrcId]};for(let p=1;p<a;p++)s.attributes.ssrcs.push({ssrcId:l.ssrcId+p,attributes:un(l.attributes)}),h.ssrcIds.push(l.ssrcId+p),d&&(s.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+p,attributes:un(l.attributes)}),s.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[l.ssrcId+p,d.ssrcIds[1]+p]}));s.attributes.ssrcGroups.unshift(h)}function TN(){return x0.apply(this,arguments)}function x0(){return x0=M(function*(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{filterRTX:r,filterVideoFec:a,filterAudioFec:l,filterAudioCodec:d,filterVideoCodec:h}=s,{useXR:p}=i,m=new RTCPeerConnection;m.addTransceiver("video",{direction:"sendonly"}),m.addTransceiver("audio",{direction:"sendonly"}),m.addTransceiver("video",{direction:"recvonly"}),m.addTransceiver("audio",{direction:"recvonly"});const g=(yield m.createOffer()).sdp,E=D0(g,{filterRTX:r,filterVideoFec:a,filterAudioFec:l,filterAudioCodec:d,filterVideoCodec:h},{useXR:p},"sendonly"),y=D0(g,{filterRTX:r,filterVideoFec:a,filterAudioFec:l,filterAudioCodec:d,filterVideoCodec:h},{useXR:p},"recvonly"),b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ev(E,y,"videoExtensions",b,T,O),Ev(E,y,"videoCodecs",b,T,O),Ev(E,y,"audioExtensions",b,T,O),Ev(E,y,"audioCodecs",b,T,O),j("RAISE_H264_BASELINE_PRIORITY")){const P=O.videoCodecs.findIndex(D=>{var L,B;return"h264"===(null===(L=D.rtpMap)||void 0===L?void 0:L.encodingName.toLocaleLowerCase())&&"42001f"===(null===(B=D.fmtp)||void 0===B?void 0:B.parameters["profile-level-id"])});if(-1!==P){const D=O.videoCodecs.findIndex(L=>{var B;return"h264"===(null===(B=L.rtpMap)||void 0===B?void 0:B.encodingName.toLocaleLowerCase())});if(D<P){w.debug("raising H264 baseline profile priority");const L=O.videoCodecs[P];O.videoCodecs.splice(P,1),O.videoCodecs.splice(D,0,L)}-1!==D&&(T.videoCodecs=T.videoCodecs.filter(L=>{var B,V;return!("h264"===(null===(B=L.rtpMap)||void 0===B?void 0:B.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(V=L.fmtp)||void 0===V?void 0:V.parameters["profile-level-id"]))})),-1!==D&&j("FILTER_SEND_H264_BASELINE")&&(b.videoCodecs=b.videoCodecs.filter(L=>{var B,V;return!("h264"===(null===(B=L.rtpMap)||void 0===B?void 0:B.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(V=L.fmtp)||void 0===V?void 0:V.parameters["profile-level-id"]))}))}}try{m.close()}catch{}return{send:b,recv:T,sendrecv:O}}),x0.apply(this,arguments)}function Ev(s,i,r,a,l,d){if("videoExtensions"===r||"audioExtensions"===r){const h=[];return s[r].forEach(p=>{i[r].some((m,g)=>{if(p.entry===m.entry&&p.extensionName===m.extensionName)return h.push(g),!0})?d[r].push(p):a[r].push(p)}),void i[r].forEach((p,m)=>{-1===h.indexOf(m)&&l[r].push(p)})}if("videoCodecs"===r||"audioCodecs"===r){const h=[];return s[r].forEach(p=>{i[r].some((m,g)=>{if(p.payloadType===m.payloadType&&JSON.stringify(p)===JSON.stringify(m))return h.push(g),!0})?d[r].push(p):a[r].push(p)}),void i[r].forEach((p,m)=>{-1===h.indexOf(m)&&l[r].push(p)})}}function vv(s){const{send:i,recv:r,sendrecv:a}=s;if(!a){if(!i||!r)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:i,recv:r}}let l,d;return i?(l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},l.audioCodecs=[...i.audioCodecs,...a.audioCodecs],l.videoCodecs=[...i.videoCodecs,...a.videoCodecs],l.audioExtensions=[...i.audioExtensions,...a.audioExtensions],l.videoExtensions=[...i.videoExtensions,...a.videoExtensions]):l=a,r?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...r.audioCodecs,...a.audioCodecs],d.videoCodecs=[...r.videoCodecs,...a.videoCodecs],d.audioExtensions=[...r.audioExtensions,...a.audioExtensions],d.videoExtensions=[...r.videoExtensions,...a.videoExtensions]):d=a,{send:l,recv:d}}function Nl(s){"audio"===s.media.mediaType&&s.attributes.payloads.filter(i=>{var r;return"opus"===(null===(r=i.rtpMap)||void 0===r?void 0:r.encodingName.toLowerCase())}).forEach(i=>{i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"})}function yv(s){s.mediaDescriptions.forEach(i=>{"video"!==i.media.mediaType&&"audio"!==i.media.mediaType||i.attributes.payloads.forEach(r=>{-1===r.rtcpFeedbacks.findIndex(a=>"rrtr"===a.type)&&r.rtcpFeedbacks.push({type:"rrtr"})})})}function bv(s,i,r,a){let l=[];if(s===Ee.VIDEO){if(j("H264_PROFILE_LEVEL_ID")&&"h264"===a&&(l=i.videoCodecs.filter(d=>{var h;return ye(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,a)&&d&&d.fmtp&&d.fmtp.parameters["profile-level-id"]===j("H264_PROFILE_LEVEL_ID")})),!Array.isArray(l)||0===l.length){const d=r.videoCodecs.filter(h=>{var p;return ye(p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(p,a)});0!==d.length&&(l=i.videoCodecs.filter(h=>d.some(p=>p.payloadType===h.payloadType)))}if(j("USE_PUB_RTX")){const d=l.map(p=>p.payloadType.toString()),h=i.videoCodecs.filter(p=>p.rtpMap&&"rtx"===p.rtpMap.encodingName&&ye(d).call(d,p.fmtp&&p.fmtp.parameters.apt||""));l=[...l,...h]}0===l.length&&(w.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(i.videoCodecs[0].rtpMap&&i.videoCodecs[0].rtpMap.encodingName)),l=i.videoCodecs)}else l=i.audioCodecs.filter(d=>{var h;return ye(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,a)}),0===l.length&&(w.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),l=i.audioCodecs.filter(d=>{var h;return ye(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return l}function wN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function M0(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?wN(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):wN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function As(s){if(Array.isArray(s))return s.map(r=>r);if(!IN(s))return s;const i={};for(const r in s){const a=s[r];i[r]=IN(a)||Array.isArray(a)?As(a):a}return i}function IN(s){return!("object"!=typeof s||Array.isArray(s)||!s)}class k0{constructor(i){C(this,"input",[]),C(this,"size",void 0),this.size=i}add(i){this.input.push(i),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const Ds={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},$d={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Ds,remoteCandidate:Ds}},S2={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},C2={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},Wh={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},L0={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function RN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function AN(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?RN(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):RN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class F0{constructor(i,r){var a=this;C(this,"onFirstVideoReceived",void 0),C(this,"onFirstVideoDecoded",void 0),C(this,"onFirstAudioReceived",void 0),C(this,"onFirstVideoDecodedTimeout",void 0),C(this,"onFirstAudioDecoded",void 0),C(this,"onSelectedLocalCandidateChanged",void 0),C(this,"onSelectedRemoteCandidateChanged",void 0),C(this,"videoIsReady",!1),C(this,"videoIsReady2",{}),C(this,"pc",void 0),C(this,"options",void 0),C(this,"intervalTimer",void 0),C(this,"stats",As($d)),C(this,"isFirstVideoReceived",{}),C(this,"isFirstVideoDecoded",{}),C(this,"isFirstAudioReceived",{}),C(this,"isFirstAudioDecoded",{}),C(this,"isFirstVideoDecodedTimeout",{}),C(this,"lossRateWindowStats",[]),this.pc=i,this.options=r,this.intervalTimer=window.setInterval(M(function*(){a.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new q(i=>{i({local:AN({},Ds),remote:AN({},Ds)})})}setVideoIsReady(i){this.videoIsReady=i}setVideoIsReady2(i,r){this.videoIsReady2[i]=r}getVideoIsReady(i){return this.videoIsReady2[i]||!1}setIsFirstAudioDecoded(i){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(i){this.lossRateWindowStats.push(i),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,a=["videoSend","audioSend","videoRecv","audioRecv"];let l=0,d=0,h=0,p=0;for(const m of a)i[m].forEach((g,E)=>{if(!this.lossRateWindowStats[r-1][m][E]||!this.lossRateWindowStats[0][m][E])return;const y=this.lossRateWindowStats[r-1][m][E].packets-this.lossRateWindowStats[0][m][E].packets,b=this.lossRateWindowStats[r-1][m][E].packetsLost-this.lossRateWindowStats[0][m][E].packetsLost;"videoSend"===m||"audioSend"===m?(l+=y,h+=b):(d+=y,p+=b),g.packetLostRate=Number.isNaN(y)||Number.isNaN(y)||y<=0||b<=0?0:b/(y+b)});i.sendPacketLossRate=l<=0||h<=0?0:h/(l+h),i.recvPacketLossRate=d<=0||p<=0?0:p/(d+p)}}function DN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function ON(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?DN(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):DN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class O3 extends F0{constructor(){super(...arguments),C(this,"_stats",$d),C(this,"lastDecodeVideoReceiverStats",new Map)}updateStats(){var i=this;return M(function*(){const r=yield i._getStats(),a=i.statsResponsesToObjects(r);i._stats=As($d);const l=a.filter(h=>"ssrc"===h.type);i.processSSRCStats(l);const d=a.find(h=>"VideoBwe"===h.type);d&&i.processBandwidthStats(d),i._stats.timestamp=Date.now(),i.calcLossRate(i._stats),i.stats=i._stats})()}processBandwidthStats(i){this._stats.bitrate={actualEncoded:Number(i.googActualEncBitrate),targetEncoded:Number(i.googTargetEncBitrate),retransmit:Number(i.googRetransmitBitrate),transmit:Number(i.googTransmitBitrate)},this._stats.sendBandwidth=Number(i.googAvailableSendBandwidth)}processSSRCStats(i){i.forEach(r=>{var a;const l=ye(a=r.id).call(a,"send");switch("".concat(r.mediaType,"_").concat(l?"send":"recv")){case"video_send":{const d=As(C2);d.codec=r.googCodecName,d.adaptionChangeReason="none",r.googCpuLimitedResolution&&(d.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(d.adaptionChangeReason="bandwidth"),d.avgEncodeMs=Number(r.googAvgEncodeMs),d.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},d.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},d.firsCount=Number(r.googFirReceived),d.nacksCount=Number(r.googNacksReceived),d.plisCount=Number(r.googPlisReceived),d.frameCount=Number(r.framesEncoded),d.bytes=Number(r.bytesSent),d.packets=Number(r.packetsSent),d.packetsLost=Number(r.packetsLost),d.ssrc=Number(r.ssrc),d.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(d),this._stats.rtt=d.rttMs;break}case"video_recv":{const d=As(S2),h=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(d.codec=r.googCodecName,d.targetDelayMs=Number(r.googTargetDelayMs),d.renderDelayMs=Number(r.googRenderDelayMs),d.currentDelayMs=Number(r.googCurrentDelayMs),d.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),d.decodeMs=Number(r.googDecodeMs),d.maxDecodeMs=Number(r.googMaxDecodeMs),d.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},d.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},d.decodeFrameRate=Number(r.googFrameRateDecoded),d.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},d.jitterBufferMs=Number(r.googJitterBufferMs),d.firsCount=Number(r.googFirsSent),d.nacksCount=Number(r.googNacksSent),d.plisCount=Number(r.googPlisSent),d.framesDecodeCount=Number(r.framesDecoded),d.bytes=Number(r.bytesReceived),d.packets=Number(r.packetsReceived),d.packetsLost=Number(r.packetsLost),d.ssrc=Number(r.ssrc),d.packets>0&&!this.isFirstVideoReceived[d.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(d.ssrc),this.isFirstVideoReceived[d.ssrc]=!0),d.framesDecodeCount>0&&!this.isFirstVideoDecoded[d.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(d.ssrc,d.decodedFrame.width,d.decodedFrame.height),this.isFirstVideoDecoded[d.ssrc]=!0),h){const p=h.stats,m=Date.now()-h.lts;d.framesDecodeFreezeTime=p.framesDecodeFreezeTime,d.framesDecodeInterval=p.framesDecodeInterval,d.framesDecodeCount>p.framesDecodeCount&&this.isFirstVideoDecoded[d.ssrc]?(h.lts=Date.now(),d.framesDecodeInterval=m,d.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?d.framesDecodeFreezeTime+=d.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):d.framesDecodeCount<h.stats.framesDecodeCount&&(d.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(d.ssrc,{stats:ON({},d),lts:Date.now()}),this._stats.videoRecv.push(d);break}case"audio_recv":{const d=As(L0);d.codec=r.googCodecName,d.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,d.decodingCNG=Number(r.googDecodingCNG),d.decodingCTN=Number(r.googDecodingCTN),d.decodingCTSG=Number(r.googDecodingCTSG),d.decodingNormal=Number(r.googDecodingNormal),d.decodingPLC=Number(r.googDecodingPLC),d.decodingPLCCNG=Number(r.googDecodingPLCCNG),d.expandRate=Number(r.googExpandRate),d.accelerateRate=Number(r.googAccelerateRate),d.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),d.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),d.speechExpandRate=Number(r.googSpeechExpandRate),d.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),d.jitterBufferMs=Number(r.googJitterBufferMs),d.jitterMs=Number(r.googJitterReceived),d.bytes=Number(r.bytesReceived),d.packets=Number(r.packetsReceived),d.packetsLost=Number(r.packetsLost),d.ssrc=Number(r.ssrc),d.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),d.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),d.receivedFrames>0&&!this.isFirstAudioReceived[d.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(d.ssrc),this.isFirstAudioReceived[d.ssrc]=!0),d.decodingNormal>0&&!this.isFirstAudioDecoded[d.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(d.ssrc),this.isFirstAudioDecoded[d.ssrc]=!0),this._stats.audioRecv.push(d);break}case"audio_send":{const d=As(Wh);d.codec=r.googCodecName,d.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,d.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),d.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),d.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),d.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),d.bytes=Number(r.bytesSent),d.packets=Number(r.packetsSent),d.packetsLost=Number(r.packetsLost),d.ssrc=Number(r.ssrc),d.rttMs=Number(r.googRtt||0),this._stats.rtt=d.rttMs,this._stats.audioSend.push(d);break}}})}_getStats(){return new q((i,r)=>{this.pc.getStats(i,r)})}statsResponsesToObjects(i){const r=[];return i.result().forEach(a=>{const l={id:a.id,timestamp:a.timestamp.valueOf().toString(),type:a.type};a.names().forEach(d=>{l[d]=a.stat(d)}),r.push(l)}),r}}function T2(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function zh(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?T2(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):T2(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class NN extends F0{constructor(){super(...arguments),C(this,"_stats",$d),C(this,"report",void 0),C(this,"lastDecodeVideoReceiverStats",new Map),C(this,"lastVideoFramesRecv",new Map),C(this,"lastVideoFramesSent",new Map),C(this,"lastVideoFramesDecode",new Map),C(this,"lastVideoJBDelay",new Map),C(this,"lastAudioJBDelay",new Map),C(this,"mediaBytesSent",new Map),C(this,"mediaBytesRetransmit",new Map),C(this,"mediaBytesTargetEncode",new Map),C(this,"lastEncoderMs",new Map)}updateStats(){var i=this;return M(function*(){i.report=yield i.pc.getStats(),i._stats=As($d),i.report.forEach(r=>{switch(r.type){case Or.OUTBOUND:case Or.INBOUND:{const a=r.mediaType||r.kind,l=!a&&"frameWidth"in r,d=!a&&!("frameWidth"in r);r.type===Or.OUTBOUND?"audio"===a||d?i.processAudioOutboundStats(r):("video"===a||l)&&i.processVideoOutboundStats(r):r.type===Or.INBOUND&&("audio"===a||d?i.processAudioInboundStats(r):("video"===a||l)&&i.processVideoInboundStats(r));break}case Or.TRANSPORT:{const a=i.report.get(r.selectedCandidatePairId);a&&i.processCandidatePairStats(a);break}case Or.CANDIDATE_PAIR:r.selected&&i.processCandidatePairStats(r)}}),i.updateSendBitrate(),i._stats.timestamp=Date.now(),i.calcLossRate(i._stats),i.stats=i._stats})()}getSelectedCandidatePair(){var i=this;return M(function*(){const r=yield i.pc.getStats(),a={local:zh({},Ds),remote:zh({},Ds)};return r.forEach(l=>{let d;if(l.type===Or.TRANSPORT&&(d=r.get(l.selectedCandidatePairId)),l.type===Or.CANDIDATE_PAIR&&l.selected&&(d=l),d){const h=(p,m)=>{p.type=m.type,p.id=m.id,m.address&&(p.address=m.address),m.candidateType&&(p.candidateType=m.candidateType),m.port&&(p.port=m.port),m.priority&&(p.priority=m.priority),m.protocol&&(p.protocol=m.protocol),m.relayProtocol&&(p.relayProtocol=m.relayProtocol)};if(d.localCandidateId){const p=r.get(d.localCandidateId);p&&h(a.local,p)}if(d.remoteCandidateId){const p=r.get(d.remoteCandidateId);p&&h(a.remote,p)}}}),a})()}processCandidatePairStats(i){if(this._stats.sendBandwidth=i.availableOutgoingBitrate||0,i.currentRoundTripTime&&(this._stats.rtt=1e3*i.currentRoundTripTime),this._stats.videoSend.forEach(r=>{i.currentRoundTripTime&&(r.rttMs=1e3*i.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{i.currentRoundTripTime&&(r.rttMs=1e3*i.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=i.id,i.localCandidateId){const r=this.report.get(i.localCandidateId);r&&this.processCandidateStats(r)}if(i.remoteCandidateId){const r=this.report.get(i.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(i){let r;i.type===Or.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),i.type===Or.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=i.type,r.id=i.id,i.address&&(r.address=i.address),i.candidateType&&(r.candidateType=i.candidateType),i.port&&(r.port=i.port),i.priority&&(r.priority=i.priority),i.protocol&&(r.protocol=i.protocol),i.relayProtocol&&(r.relayProtocol=i.relayProtocol),i.type===Or.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(zh({},r),zh({},this.stats.selectedCandidatePair.localCandidate)),i.type===Or.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(zh({},r),zh({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(i){let r=this._stats.audioRecv.find(a=>a.ssrc===i.ssrc);r||(r=As(L0),this._stats.audioRecv.push(r)),r.ssrc=i.ssrc,r.packets=i.packetsReceived,r.packetsLost=i.packetsLost,r.bytes=i.bytesReceived,r.jitterMs=1e3*i.jitter,this.processAudioTrackReceiverStats(i,i.trackId,r),i.codecId&&(r.codec=this.getCodecFromCodecStats(i.codecId)),r.receivedFrames||(r.receivedFrames=i.packetsReceived),r.droppedFrames||(r.droppedFrames=i.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),"number"==typeof i.concealedSamples&&(r.concealedSamples=i.concealedSamples)}processVideoInboundStats(i){let r=this._stats.videoRecv.find(h=>h.ssrc===i.ssrc);r||(r=As(S2),this._stats.videoRecv.push(r)),r.ssrc=i.ssrc,r.packets=i.packetsReceived,r.packetsLost=i.packetsLost,r.bytes=i.bytesReceived,r.firsCount=i.firCount,r.nacksCount=i.nackCount,r.plisCount=i.pliCount,r.framesDecodeCount=i.framesDecoded,r.totalInterFrameDelay=i.totalInterFrameDelay,r.totalSquaredInterFrameDelay=i.totalSquaredInterFrameDelay;const a=this.lastDecodeVideoReceiverStats.get(r.ssrc),l=this.lastVideoFramesDecode.get(r.ssrc),d=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,r.decodedFrame?r.decodedFrame.width:0,r.decodedFrame?r.decodedFrame.height:0),this.isFirstVideoDecoded[r.ssrc]=!0),a){const h=a.stats,p=d-a.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&p>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(a.lts=Date.now(),r.framesDecodeInterval=p,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(i.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(i.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),i.framesDecoded&&i.qpSum&&(r.qpSumPerFrame=a.stats.framesDecodeCount>i.framesDecoded?i.qpSum/i.framesDecoded:(i.qpSum-a.qpSum)/(i.framesDecoded-a.stats.framesDecodeCount))}l&&d-l.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-l.count)/((d-l.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:r.decodeFrameRate})):l?r.decodeFrameRate=l.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:0}),i.totalDecodeTime&&(r.decodeMs=1e3*i.totalDecodeTime),this.processVideoTrackReceiverStats(i,i.trackId,r),i.codecId&&(r.codec=this.getCodecFromCodecStats(i.codecId)),i.framerateMean&&(r.framesRateFirefox=i.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:zh({},r),lts:a?a.lts:Date.now(),qpSum:i.qpSum})}processVideoOutboundStats(i){let r=this._stats.videoSend.find(l=>l.ssrc===i.ssrc);r||(r=As(C2),this._stats.videoSend.push(r));const a=this.mediaBytesSent.get(i.ssrc);if(a)a.add(i.bytesSent);else{const l=new k0(10);l.add(i.bytesSent),this.mediaBytesSent.set(i.ssrc,l)}if(void 0!==i.retransmittedBytesSent){const l=this.mediaBytesRetransmit.get(i.ssrc);if(l)l.add(i.retransmittedBytesSent);else{const d=new k0(10);d.add(i.retransmittedBytesSent),this.mediaBytesRetransmit.set(i.ssrc,d)}}if(i.totalEncodedBytesTarget){const l=this.mediaBytesTargetEncode.get(i.ssrc);if(l)l.add(i.totalEncodedBytesTarget);else{const d=new k0(10);d.add(i.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(i.ssrc,d)}}if(r.ssrc=i.ssrc,r.bytes=i.bytesSent,r.packets=i.packetsSent,r.firsCount=i.firCount,r.nacksCount=i.nackCount,r.plisCount=i.pliCount,r.frameCount=i.framesEncoded,r.adaptionChangeReason=i.qualityLimitationReason,r.scalabilityMode=i.scalabilityMode,i.totalEncodeTime&&i.framesEncoded){const l=this.lastEncoderMs.get(i.ssrc);r.avgEncodeMs=!l||l.lastFrameCount>i.framesEncoded?1e3*i.totalEncodeTime/i.framesEncoded:1e3*(i.totalEncodeTime-l.lastEncoderTime)/(i.framesEncoded-l.lastFrameCount)}if(i.framesEncoded&&i.qpSum){const l=this.lastEncoderMs.get(i.ssrc);r.qpSumPerFrame=!l||l.lastFrameCount>i.framesEncoded?i.qpSum/i.framesEncoded:(i.qpSum-l.lastQpSum)/(i.framesEncoded-l.lastFrameCount)}if(this.lastEncoderMs.set(i.ssrc,{lastFrameCount:i.framesEncoded,lastEncoderTime:i.totalEncodeTime,lastQpSum:i.qpSum,lts:Date.now()}),i.codecId&&(r.codec=this.getCodecFromCodecStats(i.codecId)),i.mediaSourceId&&this.processVideoMediaSource(i.mediaSourceId,r),this.processVideoTrackSenderStats(i,i.trackId,r),i.remoteId)this.processRemoteInboundStats(i.remoteId,r);else{const l=this.findRemoteStatsId(i.ssrc,Or.REMOTE_INBOUND);l&&this.processRemoteInboundStats(l,r)}}processAudioOutboundStats(i){let r=this._stats.audioSend.find(a=>a.ssrc===i.ssrc);if(r||(r=As(Wh),this._stats.audioSend.push(r)),r.ssrc=i.ssrc,r.packets=i.packetsSent,r.bytes=i.bytesSent,i.mediaSourceId&&this.processAudioMediaSource(i.mediaSourceId,r),i.codecId&&(r.codec=this.getCodecFromCodecStats(i.codecId)),this.processAudioTrackSenderStats(i,i.trackId,r),i.remoteId)this.processRemoteInboundStats(i.remoteId,r);else{const a=this.findRemoteStatsId(i.ssrc,Or.REMOTE_INBOUND);a&&this.processRemoteInboundStats(a,r)}}findRemoteStatsId(i,r){var a;const l=Array.from(yo(a=this.report).call(a)).find(d=>d.type===r&&d.ssrc===i);return l?l.id:null}processVideoMediaSource(i,r){const a=this.report.get(i);a&&a.width&&a.height&&a.framesPerSecond&&(r.inputFrame={width:a.width,height:a.height,frameRate:a.framesPerSecond})}processAudioMediaSource(i,r){const a=this.report.get(i);a&&(r.inputLevel=a.audioLevel)}processVideoTrackSenderStats(i,r,a){var l,d,h,p;const m=r?this.report.get(r):void 0,g=null!==(l=m?.framesSent)&&void 0!==l?l:i.framesSent;if("number"!=typeof g)return;let E=null!==(d=m?.frameWidth)&&void 0!==d?d:i.frameWidth,y=null!==(h=m?.frameHeight)&&void 0!==h?h:i.frameHeight,b=null!==(p=m?.framesPerSecond)&&void 0!==p?p:i.framesPerSecond;if("number"==typeof E&&"number"==typeof y||(E=0,y=0),null==b){const T=Date.now(),O=this.lastVideoFramesSent.get(a.ssrc);O&&T-O.lts>=800?(b=Math.round((g-O.count)/((T-O.lts)/1e3)),this.lastVideoFramesSent.set(a.ssrc,{count:g,lts:T,rate:b})):O?b=O.rate:this.lastVideoFramesSent.set(a.ssrc,{count:g,lts:T,rate:0})}a.sentFrame={width:E,height:y,frameRate:Math.max(0,b)}}processVideoTrackReceiverStats(i,r,a){var l,d,h,p,m;const g=r?this.report.get(r):void 0,E=null!==(l=g?.framesReceived)&&void 0!==l?l:i.framesReceived,y=null!==(d=g?.frameWidth)&&void 0!==d?d:i.frameWidth,b=null!==(h=g?.frameHeight)&&void 0!==h?h:i.frameHeight,T=null!==(p=g?.jitterBufferDelay)&&void 0!==p?p:i.jitterBufferDelay,O=null!==(m=g?.jitterBufferEmittedCount)&&void 0!==m?m:i.jitterBufferEmittedCount;if("number"==typeof E){const P=this.lastVideoFramesRecv.get(a.ssrc),D=Date.now();a.framesReceivedCount=E;let L=0;P&&D-P.lts>=800?(L=Math.round((E-P.count)/((D-P.lts)/1e3)),this.lastVideoFramesRecv.set(a.ssrc,{count:E,lts:D,rate:L})):P?L=P.rate:this.lastVideoFramesRecv.set(a.ssrc,{count:E,lts:D,rate:0}),a.receivedFrame={width:y||0,height:b||0,frameRate:L||0},a.decodedFrame={width:y||0,height:b||0,frameRate:a.decodeFrameRate||0},a.outputFrame={width:y||0,height:b||0,frameRate:a.decodeFrameRate||0}}if(T&&O){const P=this.lastVideoJBDelay.get(a.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let D=P.jitterBufferMs;const L=O-P.jitterBufferEmittedCount;L>0&&(D=1e3*(T-P.jitterBufferDelay)/L),a.jitterBufferMs=D,a.currentDelayMs=Math.round(D),this.lastVideoJBDelay.set(a.ssrc,{jitterBufferDelay:T,jitterBufferEmittedCount:O,jitterBufferMs:a.currentDelayMs})}}processAudioTrackSenderStats(i,r,a){var l,d,h,p;const m=r?this.report.get(r):void 0,g=null!==(l=null!==(d=m?.echoReturnLoss)&&void 0!==d?d:i.echoReturnLoss)&&void 0!==l?l:0,E=null!==(h=null!==(p=m?.echoReturnLossEnhancement)&&void 0!==p?p:i.echoReturnLossEnhancement)&&void 0!==h?h:0;a.aecReturnLoss=g,a.aecReturnLossEnhancement=E}processAudioTrackReceiverStats(i,r,a){var l,d,h,p,m,g,E;const y=r?this.report.get(r):void 0,b=null!==(l=y?.removedSamplesForAcceleration)&&void 0!==l?l:i.removedSamplesForAcceleration,T=null!==(d=y?.totalSamplesReceived)&&void 0!==d?d:i.totalSamplesReceived,O=null!==(h=y?.jitterBufferDelay)&&void 0!==h?h:i.jitterBufferDelay,P=null!==(p=y?.jitterBufferEmittedCount)&&void 0!==p?p:i.jitterBufferEmittedCount,D=null!==(m=y?.audioLevel)&&void 0!==m?m:i?.audioLevel,L=null!==(g=y?.totalSamplesDuration)&&void 0!==g?g:i?.totalSamplesDuration,B=null!==(E=y?.concealedSamples)&&void 0!==E?E:i.concealedSamples;if(b&&T&&(a.accelerateRate=b/T),O&&P){const Q=this.lastAudioJBDelay.get(a.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let se=Q.jitterBufferMs;const K=P-Q.jitterBufferEmittedCount;K>0&&(se=1e3*(O-Q.jitterBufferDelay)/K),a.jitterBufferMs=Math.round(se),this.lastAudioJBDelay.set(a.ssrc,{jitterBufferDelay:O,jitterBufferEmittedCount:P,jitterBufferMs:a.jitterBufferMs})}a.outputLevel=D;let V=1920;L&&T&&(V=T/L/50,a.receivedFrames=Math.round(T/V)),B&&(a.droppedFrames=Math.round(B/V))}processRemoteInboundStats(i,r){const a=this.report.get(i);a&&(r.packetsLost=a.packetsLost,a.roundTripTime&&(r.rttMs=1e3*a.roundTripTime),a.jitter&&(r.jitterMs=1e3*a.jitter),a.timestamp&&(r.timestamp=a.timestamp))}getCodecFromCodecStats(i){const r=this.report.get(i);if(!r)return"";const a=r.mimeType.match(/\/(.*)$/);return a&&a[1]?a[1]:""}updateSendBitrate(){let i=0,r=null,a=null;this.mediaBytesSent.forEach(d=>{i+=d.diffMean()}),this.mediaBytesRetransmit.forEach(d=>{r=null===r?d.diffMean():r+d.diffMean()}),this.mediaBytesTargetEncode.forEach(d=>{a=null===a?d.diffMean():a+d.diffMean()}),this._stats.bitrate={actualEncoded:8*(null!==r?i-r:i)/(this.options.updateInterval/1e3),transmit:8*i/(this.options.updateInterval/1e3)},null!==r&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),null!==a&&(this._stats.bitrate.targetEncoded=8*a/(this.options.updateInterval/1e3))}}class w2 extends F0{updateStats(){return q.resolve()}}function Sv(s){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const d=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return d?d<76?new O3(s,{updateInterval:i,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:l}):new NN(s,{updateInterval:i,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:l}):window.RTCStatsReport&&s.getStats()instanceof q?new NN(s,{updateInterval:i,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:l}):new w2(s,{updateInterval:i,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:l})}function I2(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function PN(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?I2(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):I2(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class si extends bh{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(i,r){super(i,r),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"remoteSDP",void 0),C(this,"initialOffer",void 0),C(this,"statsFilter",void 0),C(this,"useRTX",!1),C(this,"localCapabilities",void 0),C(this,"localCandidateCount",0),C(this,"allCandidatesReceived",!1),C(this,"establishPromise",void 0),C(this,"mutex",new Zn("P2PConnection-mutex")),this.store=r,this.peerConnection=new RTCPeerConnection(si.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.statsFilter=Sv(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,Wt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(){var i=this;return M(function*(){try{const r=yield i.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=Kd(r.sdp),l=D0(r.sdp,{filterRTX:!i.useRTX,filterVideoFec:j("FILTER_VIDEO_FEC"),filterAudioFec:j("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return i.localCapabilities=l,i.initialOffer=r,PN(PN({},a),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:l},offerSDP:r.sdp})}catch(r){throw new J(x.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}})()}connect(i,r,a,l,d,h){var p=this;return M(function*(){try{if(!p.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");p.remoteSDP=new class{constructor(g){C(this,"sessionDesc",void 0),C(this,"localCapabilities",void 0),C(this,"rtpCapabilities",void 0),C(this,"candidates",void 0),C(this,"iceParameters",void 0),C(this,"dtlsParameters",void 0),C(this,"setup",void 0),C(this,"currentMidIndex",void 0),C(this,"cname",void 0),g=un(g);const{remoteIceParameters:E,remoteDtlsParameters:y,candidates:b,remoteRTPCapabilities:T,remoteSetup:O,localCapabilities:P,sdkCodec:D,cname:L}=g,B=cn.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=T,this.candidates=b,this.iceParameters=E,this.dtlsParameters=y,this.setup=O,this.localCapabilities=P,this.cname=L;for(let V=0;V<B.mediaDescriptions.length;V++){const Q=B.mediaDescriptions[V];if(Q.attributes.iceUfrag=E.iceUfrag,Q.attributes.icePwd=E.icePwd,Q.attributes.fingerprints=y.fingerprints,Q.attributes.candidates=b,Q.attributes.setup=O,"video"===Q.media.mediaType){Q.media.fmts=T.videoCodecs.map(K=>K.payloadType.toString(10));let se=T.videoCodecs.filter(K=>{var ee,$;return null===(ee=K.rtpMap)||void 0===ee?void 0:ye($=ee.encodingName.toLowerCase()).call($,D)});0===se.length&&(se=T.videoCodecs),Q.attributes.payloads=se,Q.attributes.extmaps=T.videoExtensions}"audio"===Q.media.mediaType&&(Q.media.fmts=T.audioCodecs.map(se=>se.payloadType.toString(10)),Q.attributes.payloads=T.audioCodecs,Q.attributes.extmaps=T.audioExtensions),B.mediaDescriptions[V]=this.mungMediaDesc(Q)}this.sessionDesc=B,this.currentMidIndex=B.mediaDescriptions.length-1}toString(){return cn.print(this.sessionDesc)}send(g,E,y){const{ssrcs:b,ssrcGroups:T}=Jr(E,this.cname),O=this.sessionDesc.mediaDescriptions.find(L=>g===Ee.VIDEO?"video"===L.media.mediaType:"audio"===L.media.mediaType),P=b[0].attributes.label,D=b[0].attributes.mslabel;return O.attributes.ssrcs=O.attributes.ssrcs.concat(b),O.attributes.ssrcGroups=O.attributes.ssrcGroups.concat(T),{id:P,mslabel:D}}batchSend(g){return g.map(E=>{let{kind:y,ssrcMsg:b}=E;return this.send(y,b,void 0)})}stopSending(g){this.sessionDesc.mediaDescriptions.forEach(E=>{const y=[],b=[],T=[];E.attributes.ssrcs.forEach(O=>{ye(g).call(g,O.attributes.label||"")?T.push(O):y.push(O)}),E.attributes.ssrcGroups.forEach(O=>{var P;ye(P=T.map(D=>D.ssrcId)).call(P,O.ssrcIds[0])||b.push(O)}),E.attributes.ssrcs=y,E.attributes.ssrcGroups=b})}mute(g){const E=this.sessionDesc.mediaDescriptions.find(y=>y.attributes.mid===g);if(!E)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.mute."));E.attributes.direction="inactive"}unmute(g){const E=this.sessionDesc.mediaDescriptions.find(y=>y.attributes.mid===g);if(!E)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.unmute."));E.attributes.direction="sendonly"}receive(g,E,y){g.forEach((b,T)=>{const O=b._mediaStreamTrack,P=this.sessionDesc.mediaDescriptions.findIndex(L=>L.attributes.mid===O.kind),D=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[P],b);this.sessionDesc.mediaDescriptions[P]=D})}stopReceiving(g){}updateCandidates(g){g===wi.TCP?this.candidates.forEach(E=>{-1===this.candidates.findIndex(y=>"tcp"===y.transport&&y.connectionAddress===E.connectionAddress&&y.port===E.port)&&this.candidates.push(M0(M0({},E),{},{foundation:"tcpcandidate",priority:Number(E.priority)-1+"",transport:"tcp",port:Number(E.port)+90+""}))}):this.candidates=this.candidates.filter(E=>"tcp"!==E.transport);for(const E of this.sessionDesc.mediaDescriptions)E.attributes.candidates=this.candidates}restartICE(g){g=un(g),this.iceParameters=g,this.sessionDesc.mediaDescriptions.forEach(E=>{E.attributes.iceUfrag=g.iceUfrag,E.attributes.icePwd=g.icePwd})}predictReceivingMids(g){const E=[];for(let y=0;y<g;y++)E.push((this.currentMidIndex+y+1).toString(10));return E}mungRecvMediaDsec(g,E){const y=un(g);return Yd(y,E),N0(y,E),y}updateRecvMedia(g,E){const y=this.sessionDesc.mediaDescriptions.findIndex(b=>b.attributes.mid===g);if(-1!==y){const b=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[y],E);this.sessionDesc.mediaDescriptions[y]=b}}bumpMid(g){this.currentMidIndex+=g}updateTrackLabel(g,E,y){const b=this.sessionDesc.mediaDescriptions.find(O=>g===Ee.VIDEO?"video"===O.attributes.mid:"audio"===O.attributes.mid);if(b){const O=b.attributes.ssrcs.find(P=>P.attributes.label===E);var T;O&&(O.attributes.label=y,null===(T=O.attributes.msid)||void 0===T||T.replace(E,y))}}mungMediaDesc(g){const E=un(g);return O0(E),function(y){const b=y.attributes.extmaps.find(T=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===T.extensionName);b&&y.attributes.extmaps.splice(y.attributes.extmaps.indexOf(b),1),y.attributes.payloads.forEach(T=>{const O=T.rtcpFeedbacks.findIndex(P=>"transport-cc"===P.type);-1!==O&&T.rtcpFeedbacks.splice(O,1)})}(E),E}getSSRC(g){for(const E of this.sessionDesc.mediaDescriptions)for(const y of E.attributes.ssrcs)if(y.attributes.label===g)return[y]}}({remoteIceParameters:i,remoteDtlsParameters:r,candidates:a,remoteRTPCapabilities:l.send,remoteSetup:d,localCapabilities:p.localCapabilities,sdkCodec:p.store.codec,cname:h});const m=p.remoteSDP.toString();yield p.peerConnection.setLocalDescription(p.initialOffer),yield p.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(m){throw new J(x.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(m.toString()))}})()}updateRemoteRTPCapabilities(i,r){return M(function*(){throw new J(x.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")})()}send(i,r){var a=this;return as(function*(){const l=yield ht(a.mutex.lock());try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=i.map(b=>a.peerConnection.addTrack(b._mediaStreamTrack)),h=yield ht(a.peerConnection.createOffer()),p=cn.parse(h.sdp),m=i.map(b=>{const T=b._mediaStreamTrack,O=p.mediaDescriptions.find(P=>P.attributes.mid===T.kind);if(!O)throw new Error("Cannot extract ssrc from mediaDescription.");return function(P,D,L){const B=P.attributes.ssrcs.filter(Q=>Q.attributes.label===D),V=P.attributes.ssrcGroups;if(0===B.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(V&&B.length>1){const Q=V.find(se=>-1!==se.ssrcIds.indexOf(B[0].ssrcId));return Q?[{ssrcId:Q.ssrcIds[0],rtx:L?Q.ssrcIds[1]:void 0}]:[{ssrcId:B[0].ssrcId}]}return[{ssrcId:B[0].ssrcId}]}(O,T.id,a.useRTX)});let g;try{g=yield m}catch(b){throw d.forEach(T=>{Ki()&&T.replaceTrack(null),a.peerConnection.removeTrack(T)}),b}const E=a.mungSendOfferSDP(h.sdp,i);a.remoteSDP.receive(i,r,g);const y=a.remoteSDP.toString();return yield ht(a.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield ht(a.applySendEncodings(d,i)),yield ht(a.peerConnection.setRemoteDescription({type:"answer",sdp:y})),i.map((b,T)=>({localSSRC:m[T],id:b._mediaStreamTrack.id}))}catch(d){throw new J(x.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{l()}})()}stopSending(i){var r=this;return M(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const a=r.peerConnection.getSenders().filter(h=>{var p;return-1!==i.indexOf((null===(p=h.track)||void 0===p?void 0:p.id)||"")});if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");a.map(h=>{Ki()&&h.replaceTrack(null),r.peerConnection.removeTrack(h)});const l=yield r.peerConnection.createOffer();yield r.peerConnection.setLocalDescription(l),r.remoteSDP.stopReceiving(i);const d=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new J(x.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(a.toString()))}})()}receive(i,r,a,l){var d=this;return M(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{id:h,mslabel:p}=d.remoteSDP.send(i,r,l),m=new q((y,b)=>{const T=setTimeout(()=>{b(new Error("Cannot receive track, id: ".concat(h)))},1e4),O=P=>{const D=dt();if(("Safari"===D.name&&11===Number(D.version)||Li())&&P.track.id!==h&&P.streams[0].id===p){var L;const B=P.streams[0].getTracks()[0];return null===(L=d.remoteSDP)||void 0===L||L.updateTrackLabel(i,h,P.track.id),d.peerConnection.removeEventListener("track",O),clearTimeout(T),void y(B)}if(P.track.id===h)return d.peerConnection.removeEventListener("track",O),clearTimeout(T),void y(P.track)};d.peerConnection.addEventListener("track",O)}),g=d.remoteSDP.toString();yield d.peerConnection.setRemoteDescription({type:"offer",sdp:g});const E=yield d.peerConnection.createAnswer();return yield d.peerConnection.setLocalDescription(E),{track:yield m,id:h}}catch(h){throw new J(x.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}stopReceiving(i){var r=this;return M(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.remoteSDP.stopSending(i);const a=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const l=yield r.peerConnection.createAnswer();yield r.peerConnection.setLocalDescription(l)}catch(a){throw new J(x.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}})()}muteRemote(i){return M(function*(){})()}unmuteRemote(i){return M(function*(){})()}muteLocal(i){var r=this;return M(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const a=r.peerConnection.getSenders().filter(l=>{var d;return-1!==i.indexOf((null===(d=l.track)||void 0===d?void 0:d.id)||"")});if(a.length!==i.length)throw new Error("sender' length doesn't match mids' length.");a.map(l=>{if(Ki()&&l.track)l.track.enabled=!1;else{const d=l.getParameters();d.encodings.forEach(h=>h.active=!1),l.setParameters(d)}})}catch(a){throw new J(x.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(a.toString()))}})()}unmuteLocal(i){var r=this;return M(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const a=r.peerConnection.getSenders().filter(h=>{var p;return-1!==i.indexOf((null===(p=h.track)||void 0===p?void 0:p.id)||"")});if(a.length!==i.length)throw new Error("Senders' length doesn't match mids' length.");a.map(function(){var h=M(function*(p){if(Ki()&&p.track)p.track.enabled=!0;else{const m=p.getParameters();m.encodings.forEach(g=>g.active=!0),yield p.setParameters(m)}});return function(p){return h.apply(this,arguments)}}());const l=yield r.peerConnection.createOffer();yield r.peerConnection.setLocalDescription(l);const d=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new J(x.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(a.toString()))}})()}restartICE(i){var r=this;return as(function*(){const a=yield ht(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if($e().supportPCSetConfiguration){const m=r.peerConnection.getConfiguration(),g=i===wi.RELAY?"relay":"all";m.iceTransportPolicy!==g&&(w.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(m.iceTransportPolicy,"] to [").concat(g,"]")),m.iceTransportPolicy=g,r.peerConnection.setConfiguration(m))}else if(i===wi.RELAY)return;i!==wi.RELAY&&r.remoteSDP.updateCandidates(i);const l=yield ht(r.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=Kd(l.sdp),{remoteIceParameters:h}=yield d.iceParameters;r.remoteSDP.restartICE(h);const p=r.remoteSDP.toString();yield ht(r.peerConnection.setLocalDescription(l)),yield ht(r.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(l){w.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),l)}finally{a()}})()}close(){var i;this.peerConnection.close(),null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}updateEncoderConfig(i,r){var a=this;return M(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const l=yield a.peerConnection.createOffer(),d=a.mungSendOfferSDP(l.sdp,[r]);a.remoteSDP.updateRecvMedia(r._mediaStreamTrack.kind,r);const h=a.remoteSDP.toString();yield a.peerConnection.setLocalDescription({type:"offer",sdp:d}),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(l){throw new J(x.EXCHANGE_SDP_FAILED,l.toString())}})()}updateSendParameters(i,r){var a=this;return M(function*(){const l=a.peerConnection.getSenders().filter(d=>{var h;return(null===(h=d.track)||void 0===h?void 0:h.id)===i});1===l.length&&(yield a.applySendEncodings(l,[r]))})()}setStatsRemoteVideoIsReady(i,r){this.statsFilter.setVideoIsReady2(i,r)}replaceTrack(i,r){var a=this;return M(function*(){const l=a.peerConnection.getSenders().find(d=>{var h;return(null===(h=d.track)||void 0===h?void 0:h.id)===r});l&&(yield l.replaceTrack(i._mediaStreamTrack))})()}createDataChannels(i,r){throw new J(x.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(i){throw new J(x.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;null===(i=this.onICEConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},j("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const r={iceServers:[],sdpSemantics:"plan-b"};return i.iceServers?r.iceServers=i.iceServers:i.turnServer&&"off"!==i.turnServer.mode&&(Da(i.turnServer.servers)?r.iceServers=i.turnServer.servers:(r.iceServers&&r.iceServers.push(...si.turnServerConfigToIceServers(i.turnServer.servers)),j("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&i.turnServer.serversFromGateway&&r.iceServers.push(...si.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(i){const r=[];return i.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}updateRtpSenderEncodings(i,r){var a=this;return M(function*(){var l;if(r||(r=a.peerConnection.getSenders().find(E=>{var y;return(null===(y=E.track)||void 0===y?void 0:y.id)===i._mediaStreamTrack.id})),!r)return w.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(!$e().supportSetRtpSenderParameters)return w.warn("Browser not support set rtp-sender parameters");const d={},h={};if(i instanceof ze)switch(i._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(j("DSCP_TYPE")&&zs()){var p;const E=j("DSCP_TYPE");ye(p=["very-low","low","medium","high"]).call(p,E)&&(h.networkPriority=E)}const m=r.getParameters(),g=null===(l=m.encodings)||void 0===l?void 0:l[0];g&&Object.assign(g,h),Object.assign(m,d),w.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),yield r.setParameters(m)})()}applySendEncodings(i,r){var a=this;return M(function*(){try{if(!$e().supportSetRtpSenderParameters||i.length!==r.length)return;for(let l=0;l<i.length;l++){const d=i[l],h=r[l];d&&h&&(yield a.updateRtpSenderEncodings(h,d))}}catch{w.debug("[".concat(a.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(i,r){const a=cn.parse(i);return r.forEach((l,d)=>{const h=l._mediaStreamTrack,p=a.mediaDescriptions.find(m=>m.attributes.mid===h.kind);p&&Yd(p,l)}),cn.print(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,r,a)=>{var l;null===(l=this.onFirstVideoDecoded)||void 0===l||l.call(this,i,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,i,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}batchReceive(i){var r=this;return M(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const a=r.remoteSDP.batchSend(i).map((h,p)=>{let{id:m,mslabel:g}=h;const{kind:E}=i[p];return new q((y,b)=>{const T=setTimeout(()=>{b(new Error("Cannot receive track, id: ".concat(m)))},1e4),O=P=>{const D=dt();if("Safari"===D.name&&11===Number(D.version)&&P.track.id!==m&&P.streams[0].id===g){var L;const B=P.streams[0].getTracks()[0];return null===(L=r.remoteSDP)||void 0===L||L.updateTrackLabel(E,m,P.track.id),r.peerConnection.removeEventListener("track",O),clearTimeout(T),void y({track:B,id:m})}if(P.track.id===m)return r.peerConnection.removeEventListener("track",O),clearTimeout(T),void y({track:P.track,id:m})};r.peerConnection.addEventListener("track",O)})}),l=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"offer",sdp:l});const d=yield r.peerConnection.createAnswer();return yield r.peerConnection.setLocalDescription(d),yield q.all(a)}catch(a){throw new J(x.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}})()}getRemoteSSRC(i){var r=this;return M(function*(){if(!r.remoteSDP)return;const a=r.remoteSDP.getSSRC(i);return a?.[0].ssrcId})()}setConfiguration(i){if($e().supportPCSetConfiguration){const r=si.resolvePCConfiguration(i);this.peerConnection.setConfiguration(r)}}}function Qr(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=M(function*(){const l=this.mutex,d=yield l.lock("Locking from P2PConnection.".concat(i));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield a.apply(this,p)}finally{d()}}),r}function R2(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Pl(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?R2(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):R2(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}te([Qr,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",q)],si.prototype,"connect",null),te([Qr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],si.prototype,"stopSending",null),te([Qr,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",q)],si.prototype,"receive",null),te([Qr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],si.prototype,"stopReceiving",null),te([Qr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],si.prototype,"muteRemote",null),te([Qr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],si.prototype,"unmuteRemote",null),te([Qr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],si.prototype,"muteLocal",null),te([Qr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],si.prototype,"unmuteLocal",null),te([Qr,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],si.prototype,"close",null),te([Qr,N("design:type",Function),N("design:paramtypes",[String,Ri]),N("design:returntype",q)],si.prototype,"updateEncoderConfig",null),te([Qr,N("design:type",Function),N("design:paramtypes",[String,Ri]),N("design:returntype",q)],si.prototype,"updateSendParameters",null),te([Qr,N("design:type",Function),N("design:paramtypes",[Ri,String]),N("design:returntype",q)],si.prototype,"replaceTrack",null),te([Qr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],si.prototype,"getRemoteSSRC",null);function cm(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function qh(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?cm(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):cm(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}let Xn=class HT extends bh{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var i,r;return null!==(i=null===(r=this.peerConnection.getReceivers()[0])||void 0===r||null===(r=r.transport)||void 0===r?void 0:r.state)&&void 0!==i?i:null}constructor(i,r){super(i,r),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"remoteSDP",void 0),C(this,"initialOffer",void 0),C(this,"transportEventReceiver",void 0),C(this,"statsFilter",void 0),C(this,"useXR",j("USE_XR")),C(this,"localCapabilities",void 0),C(this,"remoteCodecs",void 0),C(this,"localCandidateCount",0),C(this,"allCandidatesReceived",!1),C(this,"dataStreamChannelMap",new Map),C(this,"establishPromise",void 0),C(this,"mutex",new Zn("P2PConnection-mutex")),this.store=r,this.peerConnection=new RTCPeerConnection(HT.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.statsFilter=Sv(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,Wt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}updateRemoteRTPCapabilities(i,r){var a=this;return M(function*(){a.remoteCodecs=r;const l=[...new Set(a.localCapabilities&&a.localCapabilities.send.videoCodecs.map(d=>d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").filter(d=>{var h;return ye(h=Object.keys(Ui)).call(h,d)}))];if(Se.updateRemoteRTPCapabilities(a.store.sessionId,{mids:i,localCodecs:l,remoteCodecs:a.remoteCodecs}),a.remoteSDP)if(a.remoteSDP.updateRemoteCodec(i,r,a.store.codec)){const d=yield a.peerConnection.createOffer(),h=a.logSDPExchange(d.sdp||"","offer","local","muteLocal");yield a.peerConnection.setLocalDescription(d);const p=a.remoteSDP.toString();h?.(p),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:p})}else w.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else w.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(l,", codecs: ").concat(r))})()}establish(){var i=this;return M(function*(){try{i.peerConnection.addTransceiver("video",{direction:"recvonly"}),i.peerConnection.addTransceiver("audio",{direction:"recvonly"});const r=yield i.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=Kd(r.sdp),l=yield TN({filterRTX:!j("USE_PUB_RTX")&&!j("USE_SUB_RTX"),filterVideoFec:j("FILTER_VIDEO_FEC"),filterAudioFec:j("FILTER_AUDIO_FEC"),filterVideoCodec:j("FILTER_VIDEO_CODEC")},{useXR:i.useXR});return i.localCapabilities=vv(l),i.initialOffer=r,qh(qh({},a),{},{rtpCapabilities:l,offerSDP:r.sdp})}catch(r){throw new J(x.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}})()}connect(i,r,a,l,d,h){var p=this;return M(function*(){try{if(!p.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");p.remoteSDP=new class{get localCapabilities(){return un(this._localCapabilities)}get rtpCapabilities(){return un(this._rtpCapabilities)}get candidates(){return un(this._candidates)}get iceParameters(){return un(this._iceParameters)}get dtlsParameters(){return un(this._dtlsParameters)}constructor(O){C(this,"sessionDesc",void 0),C(this,"_localCapabilities",void 0),C(this,"_rtpCapabilities",void 0),C(this,"_candidates",void 0),C(this,"_iceParameters",void 0),C(this,"_dtlsParameters",void 0),C(this,"setup",void 0),C(this,"currentMidIndex",void 0),C(this,"cname",void 0),C(this,"firefoxSsrcMidMap",new Map),O=un(O);const{remoteIceParameters:P,remoteDtlsParameters:D,candidates:L,remoteRTPCapabilities:B,remoteSetup:V,localCapabilities:Q,cname:se}=O,K=cn.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n");this._rtpCapabilities=B,this._candidates=L,this._iceParameters=P,this._dtlsParameters=D,this._localCapabilities=Q,this.setup=V,this.cname=se;const ee=this.rtpCapabilities.send;for(const $ of K.mediaDescriptions){if($.attributes.iceUfrag=P.iceUfrag,$.attributes.icePwd=P.icePwd,$.attributes.fingerprints=D.fingerprints,$.attributes.candidates=L,$.attributes.setup=V,"video"===$.media.mediaType&&($.media.fmts=ee.videoCodecs.map(Y=>Y.payloadType.toString(10)),$.attributes.payloads=ee.videoCodecs,$.attributes.extmaps=ee.videoExtensions,j("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:Y,ssrcGroups:_e}=Jr([{ssrcId:4e4,rtx:j("USE_SUB_RTX")?40001:void 0}],this.cname);$.attributes.ssrcs=Y,$.attributes.ssrcGroups=_e}if("audio"===$.media.mediaType&&($.media.fmts=ee.audioCodecs.map(Y=>Y.payloadType.toString(10)),$.attributes.payloads=ee.audioCodecs,$.attributes.extmaps=ee.audioExtensions,Nl($),j("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:Y,ssrcGroups:_e}=Jr([{ssrcId:2e4}],this.cname);$.attributes.ssrcs=Y,$.attributes.ssrcGroups=_e}}this.sessionDesc=K,this.currentMidIndex=K.mediaDescriptions.length-1}preloadRemoteMedia(){const O=j("PRELOAD_MEDIA_COUNT"),P=this.candidates,D=this.dtlsParameters,L=this.iceParameters,B=this.rtpCapabilities.send;for(let V=1;V<O;V++){const Q=2*V+2e4,se=2*V+4e4,{ssrcs:K,ssrcGroups:ee}=Jr([{ssrcId:Q}],this.cname),{ssrcs:$,ssrcGroups:Y}=Jr([{ssrcId:se,rtx:j("USE_SUB_RTX")?se+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:B.videoCodecs.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:L.iceUfrag,icePwd:L.icePwd,unrecognized:[],candidates:P,extmaps:B.videoExtensions,fingerprints:D.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:$,ssrcGroups:Y,rtcpFeedbackWildcards:[],payloads:B.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*V)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:B.audioCodecs.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:L.iceUfrag,icePwd:L.icePwd,unrecognized:[],candidates:P,extmaps:B.audioExtensions,fingerprints:D.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:K,ssrcGroups:ee,rtcpFeedbackWildcards:[],payloads:B.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*V+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return cn.print(this.sessionDesc)}send(O,P,D,L){const{ssrcs:B,ssrcGroups:V}=Jr(P,this.cname,j("SYNC_GROUP")?D:void 0),Q=this.findPreloadMediaDesc(B);if(Q){if(Wt()&&this.firefoxSsrcMidMap.set(B[0].ssrcId,Q.attributes.mid),L&&(L.twcc||L.remb)){const se=this.sessionDesc.mediaDescriptions.indexOf(Q);return this.sessionDesc.mediaDescriptions[se]=this.mungSendMediaDesc(Q,L),{mid:Q.attributes.mid,needExchangeSDP:!0}}return{mid:Q.attributes.mid,needExchangeSDP:!1}}{const se=this.findAvailableMediaIndex(O,B);let K;return-1===se||1===se&&(Ki()||xA())||0===se&&j("USE_SUB_RTX")||MA()?(K=this.createOrRecycleSendMedia(O,B,V,"sendonly",L),this.updateBundleMids()):(K=un(this.sessionDesc.mediaDescriptions[se]),K.attributes.direction="sendonly",K.attributes.ssrcs=B,K.attributes.ssrcGroups=V,this.sessionDesc.mediaDescriptions[se]=this.mungSendMediaDesc(K,L)),Wt()&&this.firefoxSsrcMidMap.set(B[0].ssrcId,K.attributes.mid),{mid:K.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:O,needExchangeSDP:P}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:O.attributes.mid,needExchangeSDP:P}}batchSend(O){const P=O.map(B=>{let{kind:V,ssrcMsg:Q,mslabel:se}=B;return this.send(V,Q,se)}),D=[];let L=!1;return P.forEach(B=>{let{mid:V,needExchangeSDP:Q}=B;Q&&(L=!0),D.push(V)}),{mids:D,needExchangeSDP:L}}stopSending(O){const P=this.sessionDesc.mediaDescriptions.filter(D=>D.attributes.mid&&-1!==O.indexOf(D.attributes.mid));if(P.length!==O.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");P.forEach(D=>{"0"===D.attributes.mid||Wt()||MA()?D.attributes.ssrcs=[]:(D.attributes.ssrcs=[],D.attributes.direction="inactive",D.media.port="0")}),this.updateBundleMids()}mute(O){const P=this.sessionDesc.mediaDescriptions.find(D=>D.attributes.mid===O);if(!P)throw new Error("mediaDescription not found with ".concat(O," in remote SDP when calling RemoteSDP.mute."));P.attributes.direction="inactive"}unmute(O){const P=this.sessionDesc.mediaDescriptions.find(D=>D.attributes.mid===O);if(!P)throw new Error("mediaDescription not found with ".concat(O," in remote SDP when calling RemoteSDP.unmute."));P.attributes.direction="sendonly"}muteRemote(O){const P=this.sessionDesc.mediaDescriptions.filter(D=>ye(O).call(O,D.attributes.mid||""));if(P.length!==O.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");P.forEach(D=>{D.attributes.direction="inactive"})}unmuteRemote(O){const P=this.sessionDesc.mediaDescriptions.filter(D=>ye(O).call(O,D.attributes.mid||""));if(P.length!==O.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");P.forEach(D=>{D.attributes.direction="recvonly"})}receive(O,P,D,L){O.forEach((B,V)=>{this.createOrRecycleRecvMedia(B,[],"recvonly",P,D,L[V])}),this.updateBundleMids()}stopReceiving(O){const P=this.sessionDesc.mediaDescriptions.filter(D=>-1!==O.indexOf(D.attributes.mid));if(P.length!==O.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");P.forEach(D=>{D.media.port="0",D.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(O){const P=this._candidates.filter(D=>"udp"===D.transport);if(O===wi.TCP){if(0===P.length)return;if(j("TCP_CANDIDATE_ONLY")){const D=this._candidates.filter(L=>"tcp"===L.transport);P.forEach(L=>{-1===D.findIndex(B=>B.connectionAddress===L.connectionAddress)&&D.push(Pl(Pl({},L),{},{foundation:"tcpcandidate",priority:Number(L.priority)-1+"",transport:"tcp",port:Number(L.port)+90+""}))}),this._candidates=D}else{const D=[];P.forEach(L=>{D.push(Pl(Pl({},L),{},{foundation:"tcpcandidate",priority:Number(L.priority)-1+"",transport:"tcp",port:Number(L.port)+90+""}))}),this._candidates=[...P,...D]}}else if(O===wi.RELAY){if(0!==P.length)return;{const D=this._candidates.filter(L=>"tcp"===L.transport);D.forEach(L=>{P.push(Pl(Pl({},L),{},{foundation:"udpcandidate",priority:Number(L.priority)+1+"",transport:"udp",port:Number(L.port)-90+""}))}),this._candidates=[...P,...D]}}else 0===P.length?(this._candidates.filter(D=>"tcp"===D.transport).forEach(D=>{P.push(Pl(Pl({},D),{},{foundation:"udpcandidate",priority:Number(D.priority)+1+"",transport:"udp",port:Number(D.port)-90+""}))}),this._candidates=P):this._candidates=this._candidates.filter(D=>"tcp"!==D.transport);for(const D of this.sessionDesc.mediaDescriptions)D.attributes.candidates=this.candidates}restartICE(O){O=un(O),this._iceParameters=O,this.sessionDesc.mediaDescriptions.forEach(P=>{P.attributes.iceUfrag=O.iceUfrag,P.attributes.icePwd=O.icePwd})}predictReceivingMids(O){const P=[];for(let D=0;D<O;D++)P.push((this.currentMidIndex+D+1).toString(10));return P}findAvailableMediaIndex(O,P){return this.sessionDesc.mediaDescriptions.findIndex(D=>{const L=D.media.mediaType===O&&"0"!==D.media.port&&("sendonly"===D.attributes.direction||"sendrecv"===D.attributes.direction)&&0===D.attributes.ssrcs.length;if(Wt()){if(L){const B=this.firefoxSsrcMidMap.get(P[0].ssrcId);return!(B||"0"!==D.attributes.mid&&"1"!==D.attributes.mid)||!(!B||B!==D.attributes.mid)}return!1}return L})}createOrRecycleDataChannel(){for(const D of this.sessionDesc.mediaDescriptions)if("application"===D.media.mediaType)return{mediaDesc:D,needExchangeSDP:!1};this.currentMidIndex+=1;const O="".concat(this.currentMidIndex),P={media:{mediaType:"application",port:"9",protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(O),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(P),{mediaDesc:P,needExchangeSDP:!0}}createOrRecycleRecvMedia(O,P,D,L,B,V){const Q=O._mediaStreamTrack.kind,se=this.rtpCapabilities.recv,K=bv(Q,se,this.localCapabilities.send,Q===Ee.VIDEO?L:B),ee=Q===Ee.VIDEO?se.videoExtensions:se.audioExtensions;this.currentMidIndex+=1;const $="".concat(this.currentMidIndex);let Y={media:{mediaType:Q,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:K.map(ve=>ve.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:ee,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:P,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:K,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:D,rtcpMux:!0,rtcpRsize:!0,mid:"".concat($)}};Y=this.mungRecvMediaDsec(Y,O,V);const _e=this.findFirstClosedMedia(Q);if(_e){const ve=this.sessionDesc.mediaDescriptions.indexOf(_e);this.sessionDesc.mediaDescriptions[ve]=Y}else this.sessionDesc.mediaDescriptions.push(Y);return Y}updateRemoteCodec(O,P,D){const L=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(Y=>Y.rtpMap&&Y.rtpMap.encodingName.toLowerCase()||"").filter(Y=>{var _e;return ye(_e=Object.keys(Ui)).call(_e,Y)}))],B=new Set(P);if(L.every(Y=>B.has(Y)))return w.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(P)),!1;const V=this._rtpCapabilities.recv.videoCodecs.filter(Y=>P.some(_e=>{var ve;return ye(ve=Y.rtpMap&&Y.rtpMap.encodingName.toLowerCase()||"").call(ve,_e)}));if(0===V.length)return w.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(L," codecs: ").concat(P)),!1;const Q=[...new Set(V.map(Y=>Y.rtpMap&&Y.rtpMap.encodingName.toLowerCase()||""))];let se;if(w.debug("updateRemoteCodec, from ".concat(L," to ").concat(Q)),0===O.length)se=this.sessionDesc.mediaDescriptions.filter(Y=>"video"===Y.media.mediaType&&"recvonly"===Y.attributes.direction);else if(se=this.sessionDesc.mediaDescriptions.filter(Y=>Y.attributes.mid&&ye(O).call(O,Y.attributes.mid)&&"recvonly"===Y.attributes.direction),se.length!==O.length)return w.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(O,", codecs: ").concat(P)),!1;this._rtpCapabilities.recv.videoCodecs=V;const $=bv(Ee.VIDEO,this.rtpCapabilities.recv,this.localCapabilities.send,D);return se.forEach(Y=>{const _e=$.map(ve=>ve.payloadType.toString(10));w.debug("updateRemoteCodec mid: ".concat(Y.attributes.mid,", from ").concat(Y.attributes.payloads," to ").concat($)),Y.attributes.payloads=$,Y.media.fmts=_e}),!0}createOrRecycleSendMedia(O,P,D,L,B){const V=this.rtpCapabilities.send,Q=O===Ee.VIDEO?V.videoCodecs:V.audioCodecs,se=O===Ee.VIDEO?V.videoExtensions:V.audioExtensions;this.currentMidIndex+=1;const K="".concat(this.currentMidIndex);let ee={media:{mediaType:O,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:Q.map(Y=>Y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:se,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:P,ssrcGroups:D,rtcpFeedbackWildcards:[],payloads:Q,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:L,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(K)}};ee=this.mungSendMediaDesc(ee,B);const $=this.findFirstClosedMedia(O);if($){const Y=this.sessionDesc.mediaDescriptions.indexOf($);this.sessionDesc.mediaDescriptions[Y]=ee}else this.sessionDesc.mediaDescriptions.push(ee);return ee}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(O=>"0"!==O.media.port).map(O=>O.attributes.mid)}mungRecvMediaDsec(O,P,D){const L=un(O);return O0(L),Yd(L,P),N0(L,P),CN(L),gv(L,D,this.localCapabilities.send),L}mungSendMediaDesc(O,P){const D=un(O);return gv(D,P,this.localCapabilities.recv),Nl(D),D}updateRecvMedia(O,P){const D=this.sessionDesc.mediaDescriptions.findIndex(L=>L.attributes.mid===O);if(-1!==D){const L=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[D],P);this.sessionDesc.mediaDescriptions[D]=L}}bumpMid(O){this.currentMidIndex+=O}findFirstClosedMedia(O){return this.sessionDesc.mediaDescriptions.find(P=>Wt()?"0"===P.media.port&&P.media.mediaType===O:"0"===P.media.port)}findPreloadMediaDesc(O){return this.sessionDesc.mediaDescriptions.find(P=>{var D;return(null===(D=P.attributes)||void 0===D||null===(D=D.ssrcs[0])||void 0===D?void 0:D.ssrcId)===O[0].ssrcId})}getSSRC(O){var P;return null===(P=this.sessionDesc.mediaDescriptions.find(D=>D.attributes.mid===O))||void 0===P?void 0:P.attributes.ssrcs}}({remoteIceParameters:i,remoteDtlsParameters:r,candidates:a,remoteRTPCapabilities:l,remoteSetup:d,localCapabilities:p.localCapabilities,cname:h}),Array.isArray(p.remoteCodecs)&&p.remoteCodecs.length>0&&p.remoteSDP.updateRemoteCodec([],p.remoteCodecs,p.store.codec);const m=p.remoteSDP.toString(),g=cn.parse(p.initialOffer.sdp),E=g.mediaDescriptions.find(O=>"audio"===O.media.mediaType);E&&Nl(E),p.useXR&&yv(g);const y=cn.print(g),b=p.logSDPExchange(y||"","offer","local","connect");p.store.descriptionStart(),yield p.peerConnection.setLocalDescription({type:"offer",sdp:y}),b?.(m),yield p.peerConnection.setRemoteDescription({type:"answer",sdp:m});const T=p.peerConnection.getTransceivers()[0];if(null!=T&&T.receiver&&p.tryBindTransportEvents(T.receiver),j("PRELOAD_MEDIA_COUNT")>0){p.remoteSDP.preloadRemoteMedia();const O=p.remoteSDP.toString();yield p.peerConnection.setRemoteDescription({type:"offer",sdp:O});const P=yield p.peerConnection.createAnswer();yield p.peerConnection.setLocalDescription(P)}}catch(m){throw new J(x.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(m.toString()))}})()}send(i,r,a){var l=this;return as(function*(){const d=yield ht(l.mutex.lock("From P2PConnection.send"));try{if(!l.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[];i.forEach(P=>{const D=l.peerConnection.addTransceiver(P._mediaStreamTrack,{direction:"sendonly"});h.push(D),P._updateRtpTransceiver(D)}),Wt()&&!0===j("SIMULCAST")&&(yield ht(l.applySimulcastForFirefox(h,i)));const p=yield ht(l.peerConnection.createOffer()),m=l.remoteSDP.predictReceivingMids(i.length),g=l.mungSendOfferSDP(p.sdp,i,m),E=cn.parse(g),y=m.map(P=>{const D=E.mediaDescriptions.find(L=>L.attributes.mid===P);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return bN(D,j("USE_PUB_RTX"))});let b;try{b=yield y}catch(P){b=[],l.remoteSDP.receive(i,r,a,b);const D=l.remoteSDP.toString();throw yield ht(l.peerConnection.setLocalDescription({type:"offer",sdp:g})),yield ht(l.peerConnection.setRemoteDescription({type:"answer",sdp:D})),yield ht(l.stopSending(m,!0)),P}l.remoteSDP.receive(i,r,a,b);const T=l.remoteSDP.toString(),O=l.logSDPExchange(g,"offer","local","send");return yield ht(l.peerConnection.setLocalDescription({type:"offer",sdp:g})),yield ht(l.applySimulcastEncodings(h,i)),yield ht(l.applySendEncodings(h,i)),O?.(T),yield ht(l.peerConnection.setRemoteDescription({type:"answer",sdp:T})),h.map((P,D)=>({localSSRC:y[D],id:m[D],transceiver:P}))}catch(h){throw h instanceof J?h:new J(x.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}createDataChannels(i,r){var a=this;return M(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let l=a.dataStreamChannelMap.get(i);l&&"open"===l.readyState?w.debug("[P2PConnection] Channels are already available and can be reused directly."):(l=a.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:j("DATASTREAM_MAX_RETRANSMITS")}),l.binaryType="arraybuffer",a.dataStreamChannelMap.set(i,l)),r.forEach(h=>{h._updateOriginDataChannel(l)});const{needExchangeSDP:d}=a.remoteSDP.sendDataChannel();if(d){const h=a.remoteSDP.toString();yield a.peerConnection.setRemoteDescription({type:"offer",sdp:h});const p=yield a.peerConnection.createAnswer();yield a.peerConnection.setLocalDescription(p),w.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else w.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(l){throw l instanceof J?l:new J(x.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(l.toString()))}})()}stopDataChannels(i){var r=this;return M(function*(){try{const a=r.dataStreamChannelMap.get(i);return a?.close(),void r.dataStreamChannelMap.delete(i)}catch(a){throw a instanceof J?a:new J(x.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(a.toString()))}})()}stopSending(i,r){var a=this;return M(function*(){const l=r?void 0:yield a.mutex.lock("From P2PConnection.stopSending");try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const d=a.peerConnection.getTransceivers().filter(g=>-1!==i.indexOf(g.mid));if(d.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");d.map(g=>{var E;g.direction="inactive",null===(E=g.stop)||void 0===E||E.call(g)});const h=yield a.peerConnection.createOffer(),p=a.logSDPExchange(h.sdp||"","offer","local","stopSending");yield a.peerConnection.setLocalDescription(h),a.remoteSDP.stopReceiving(i);const m=a.remoteSDP.toString();p?.(m),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(d){throw new J(x.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(d.toString()))}finally{l&&l()}})()}receive(i,r,a,l){var d=this;return M(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{mid:h,needExchangeSDP:p}=d.remoteSDP.send(i,r,a,l);if(p){const g=d.remoteSDP.toString(),E=d.logSDPExchange(g,"offer","remote","receive");yield d.peerConnection.setRemoteDescription({type:"offer",sdp:g});const y=yield d.peerConnection.createAnswer(),b=d.mungReceiveAnswerSDP(y.sdp,h,i);E?.(b||""),yield d.peerConnection.setLocalDescription({type:"answer",sdp:b}),w.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(i," by exchanging SDP."))}else w.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(i," no need to exchange SDP."));const m=d.peerConnection.getTransceivers().find(g=>g.mid===h);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:h,transceiver:m}}catch(h){throw new J(x.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}batchReceive(i){var r=this;return M(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:a,needExchangeSDP:l}=r.remoteSDP.batchSend(i);if(l){const d=r.remoteSDP.toString(),h=r.logSDPExchange(d,"offer","remote","receive");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:d});const p=yield r.peerConnection.createAnswer();h?.(p.sdp||""),yield r.peerConnection.setLocalDescription(p),w.debug("[".concat(r.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else w.debug("[".concat(r.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return a.map(d=>{const h=r.peerConnection.getTransceivers().find(p=>p.mid===d);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:d,transceiver:h}})}catch(a){throw new J(x.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}})()}stopReceiving(i){var r=this;return M(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.remoteSDP.stopSending(i);const a=r.remoteSDP.toString(),l=r.logSDPExchange(a,"offer","remote","stopReceiving");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield r.peerConnection.createAnswer();l?.(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(a){throw new J(x.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}})()}muteRemote(i){var r=this;return M(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(i," before remote SDP created."));r.remoteSDP.mute(i);const a=r.remoteSDP.toString(),l=r.logSDPExchange(a,"offer","remote","muteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield r.peerConnection.createAnswer();l?.(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(a){throw new J(x.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(a.toString()))}})()}unmuteRemote(i){var r=this;return M(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(i," before remote SDP created."));r.remoteSDP.unmute(i);const a=r.remoteSDP.toString(),l=r.logSDPExchange(a,"offer","remote","unmuteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield r.peerConnection.createAnswer();l?.(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(a){throw new J(x.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(a.toString()))}})()}muteLocal(i){var r=this;return M(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==i.indexOf(p.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(p=>{p.direction="inactive"});const l=yield r.peerConnection.createOffer(),d=r.logSDPExchange(l.sdp||"","offer","local","muteLocal");yield r.peerConnection.setLocalDescription(l),r.remoteSDP.muteRemote(i);const h=r.remoteSDP.toString();d?.(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new J(x.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(a.toString()))}})()}unmuteLocal(i){var r=this;return M(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==i.indexOf(p.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(function(){var p=M(function*(m,g){m.direction="sendonly"});return function(m,g){return p.apply(this,arguments)}}());const l=yield r.peerConnection.createOffer(),d=r.logSDPExchange(l.sdp||"","offer","local","unmuteLocal");yield r.peerConnection.setLocalDescription(l),r.remoteSDP.unmuteRemote(i);const h=r.remoteSDP.toString();d?.(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new J(x.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(a.toString()))}})()}restartICE(i){var r=this;return as(function*(){const a=yield ht(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if($e().supportPCSetConfiguration){const g=r.peerConnection.getConfiguration(),E=i===wi.RELAY?"relay":"all";g.iceTransportPolicy!==E&&(w.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(g.iceTransportPolicy,"] to [").concat(E,"]")),g.iceTransportPolicy=E,r.peerConnection.setConfiguration(g))}else if(i===wi.RELAY)return;r.remoteSDP.updateCandidates(i);const l=yield ht(r.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=Kd(l.sdp),{remoteIceParameters:h}=yield d.iceParameters;r.remoteSDP.restartICE(h);const p=r.remoteSDP.toString(),m=r.logSDPExchange(l.sdp||"","offer","local","restartICE");r.store.descriptionStart(),yield ht(r.peerConnection.setLocalDescription(l)),m?.(p),yield ht(r.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(l){w.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),l)}finally{a()}})()}close(){var i;this.peerConnection.close(),null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}updateEncoderConfig(i,r){var a=this;return M(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const l=yield a.peerConnection.createOffer(),d=a.mungSendOfferSDP(l.sdp,[r],[i]);a.remoteSDP.updateRecvMedia(i,r);const h=a.remoteSDP.toString(),p=a.logSDPExchange(d,"offer","local","updateEncoderConfig");yield a.peerConnection.setLocalDescription({type:"offer",sdp:d}),p?.(h),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(l){throw new J(x.EXCHANGE_SDP_FAILED,l.toString())}})()}updateSendParameters(i,r){var a=this;return M(function*(){const l=a.peerConnection.getTransceivers().filter(d=>d.mid===i);1===l.length&&(a.isVP8Simulcast(r)?Wt()||(yield a.applySimulcastEncodings(l,[r])):yield a.applySendEncodings(l,[r]))})()}setStatsRemoteVideoIsReady(i,r){this.statsFilter.setVideoIsReady2(i,r)}replaceTrack(i,r){var a=this;return M(function*(){const l=a.peerConnection.getTransceivers().find(d=>d.mid===r);l&&(yield l.sender.replaceTrack(i._mediaStreamTrack))})()}getSelectedCandidatePair(){var i=this;return M(function*(){const r=i.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const a=r[0].transport.iceTransport,{local:l,remote:d}=a.getSelectedCandidatePair();return{local:qh(qh({},Ds),{},{candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port}),remote:qh(qh({},Ds),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})}}return i.statsFilter.getSelectedCandidatePair()})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;null===(i=this.onICEConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},j("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const r={iceServers:[]};return i.iceServers?r.iceServers=i.iceServers:i.turnServer&&"off"!==i.turnServer.mode&&(Da(i.turnServer.servers)?r.iceServers=i.turnServer.servers:(r.iceServers&&r.iceServers.push(...HT.turnServerConfigToIceServers(i.turnServer.servers)),j("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&i.turnServer.serversFromGateway&&r.iceServers.push(...HT.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),j("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),j("ENABLE_ENCODED_TRANSFORM")&&$e().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(i){const r=[];return i.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(sv(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!j("FORCE_TURN_TCP")&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}tryBindTransportEvents(i){const r=i.transport;if(r){this.transportEventReceiver=i,r.onstatechange=()=>{var l;null!=r&&r.state&&(null===(l=this.onDTLSTransportStateChange)||void 0===l||l.call(this,r.state))},r.onerror=l=>{var d;null===(d=this.onDTLSTransportError)||void 0===d||d.call(this,"error"in l?l.error:l)};const a=r.iceTransport;a&&(a.onstatechange=()=>{const l=r?.iceTransport.state;var d;l&&(null===(d=this.onICETransportStateChange)||void 0===d||d.call(this,l))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){const{local:l,remote:d}=a.getSelectedCandidatePair();w.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:l.type,protocol:l.protocol}),", remote ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(i,r){var a=this;return M(function*(){var l;if(r||(r=a.peerConnection.getSenders().find(y=>y.track===i._mediaStreamTrack)),!r)return w.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(a.isVP8Simulcast(i))return w.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!$e().supportSetRtpSenderParameters)return w.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(i._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(i._encoderConfig){var p;const{bitrateMax:y,frameRate:b,scaleResolutionDownBy:T}=i._encoderConfig;y&&(h.maxBitrate=1e3*y),(ye(p=i._hints).call(p,Ot.LOW_STREAM)||i.isUseScaleResolutionDownBy)&&(b&&(h.maxFramerate=Cr(b)),T&&T>=1&&(h.scaleResolutionDownBy=T))}if(j("DSCP_TYPE")&&zs()){var m;const y=j("DSCP_TYPE");ye(m=["very-low","low","medium","high"]).call(m,y)&&(h.networkPriority=y)}const g=r.getParameters(),E=null===(l=g.encodings)||void 0===l?void 0:l[0];Wt()&&!E&&(d.encodings=[h]),E&&Object.assign(E,h),Object.assign(g,d),w.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),yield r.setParameters(g)})()}applySendEncodings(i,r){var a=this;return M(function*(){try{if(!$e().supportSetRtpSenderParameters||i.length!==r.length)return;for(let l=0;l<i.length;l++){const d=i[l],h=r[l];h instanceof ze&&!a.isVP8Simulcast(h)&&(yield a.updateRtpSenderEncodings(h,d.sender))}}catch{w.debug("[".concat(a.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(i,r,a){const l=cn.parse(i);return r.forEach((d,h)=>{const p=a[h],m=l.mediaDescriptions.find(g=>g.attributes.mid===p);m&&(Yd(m,d),P0(m,d,this.store.codec))}),cn.print(l)}mungReceiveAnswerSDP(i,r,a){const l=cn.parse(i),d=l.mediaDescriptions.find(h=>h.attributes.mid===r);return d&&(a===Ee.AUDIO&&"audio"===d.media.mediaType&&Nl(d),this.useXR&&yv(l)),cn.print(l)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,r,a)=>{var l;null===(l=this.onFirstVideoDecoded)||void 0===l||l.call(this,i,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var r;null===(r=this.onFirstVideoDecodedTimeout)||void 0===r||r.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(i,r){var a=this;return M(function*(){if(i.length===r.length)for(let g=0;g<i.length;g++){var l,d,h,p,m;const E=i[g],y=r[g];if(y instanceof ze&&!ye(l=y._hints).call(l,Ot.LOW_STREAM)&&null!==(d=y._encoderConfig)&&void 0!==d&&d.bitrateMax&&(null===(h=y._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(p=y._scalabilityMode)&&void 0!==p&&p.numSpatialLayers&&(null===(m=y._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===a.store.codec){const b={},T={high:1e3*(y._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{rid:"m",active:!0,maxBitrate:T.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:T.high}];const O=E.sender.getParameters();yield E.sender.setParameters(Object.assign(O,b))}}})()}applySimulcastEncodings(i,r){var a=this;return M(function*(){if(!Wt()&&i.length===r.length)for(let l=0;l<i.length;l++){const d=r[l];if(d instanceof ze&&a.isVP8Simulcast(d)){const h=i[l],p={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=h.sender.getParameters();yield h.sender.setParameters(Object.assign(g,p))}}})()}isVP8Simulcast(i){var r,a,l,d,h;return!!(i instanceof ze&&j("SIMULCAST")&&"vp8"===this.store.codec&&!ye(r=i._hints).call(r,Ot.LOW_STREAM)&&null!==(a=i._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(l=i._encoderConfig)||void 0===l?void 0:l.bitrateMax)>200&&null!==(d=i._scalabilityMode)&&void 0!==d&&d.numSpatialLayers&&(null===(h=i._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(i,r,a,l){if(j("SDP_LOGGING"))return w.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(r," SDP during P2PConnection.").concat(l,"\n"),i),"offer"===r?d=>{this.logSDPExchange(d,"answer","local"===a?"remote":"local",l)}:void 0}getRemoteSSRC(i){var r=this;return M(function*(){if(!r.remoteSDP)return;const a=r.remoteSDP.getSSRC(i);return a?.[0].ssrcId})()}setConfiguration(i){if($e().supportPCSetConfiguration){const r=HT.resolvePCConfiguration(i);this.peerConnection.setConfiguration(r)}}};function Zr(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=M(function*(){const l=this.mutex,d=yield l.lock("From P2PConnection.".concat(i));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield a.apply(this,p)}finally{d()}}),r}function U0(s,i){let r=document.createElement("video"),a=document.createElement("canvas");r.setAttribute("style","display:none"),a.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),a.width=Cr(i.width),a.height=Cr(i.height);const l=Cr(i.framerate||15);document.body.append(r),document.body.append(a);let d=s._mediaStreamTrack;r.srcObject=new MediaStream([d]),r.play();const h=a.getContext("2d");if(!h)throw new W(x.UNEXPECTED_ERROR,"can not get canvas context");const p=$e(),m=a.captureStream(p.supportRequestFrame?0:l).getVideoTracks()[0];m.canvas||(m.canvas=a),a.startCapture=()=>{if(!r)return a.stopCapture&&a.stopCapture();if(r.paused&&r.play(),r.videoHeight>2&&r.videoWidth>2){const b=a.width*(r.videoHeight/r.videoWidth);Math.abs(b-a.height)>=2&&(w.debug("adjust low stream resolution","".concat(a.width,"x").concat(a.height," -> ").concat(a.width,"x").concat(b)),a.height=b)}h.drawImage(r,0,0,a.width,a.height),m.requestFrame&&m.requestFrame(),d!==s._mediaStreamTrack&&(d=s._mediaStreamTrack,r.srcObject=new MediaStream([d]))},a.stopCapture=OE(()=>a.startCapture&&a.startCapture(),l);const g=m.stop;return m.stop=()=>{g.call(m),r&&(r.remove(),r.srcObject=null,r=null),a&&(a.width=0,a.remove(),a.stopCapture&&a.stopCapture(),a.startCapture=void 0,a.stopCapture=void 0,a=null),w.debug("clean low stream renderer")},m}function A2(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function D2(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?A2(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):A2(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}te([Zr,N("design:type",Function),N("design:paramtypes",[Array,Array]),N("design:returntype",q)],Xn.prototype,"updateRemoteRTPCapabilities",null),te([Zr,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",q)],Xn.prototype,"connect",null),te([Zr,N("design:type",Function),N("design:paramtypes",[Object,Array]),N("design:returntype",q)],Xn.prototype,"createDataChannels",null),te([Zr,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",q)],Xn.prototype,"receive",null),te([Zr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],Xn.prototype,"batchReceive",null),te([Zr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],Xn.prototype,"stopReceiving",null),te([Zr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Xn.prototype,"muteRemote",null),te([Zr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Xn.prototype,"unmuteRemote",null),te([Zr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],Xn.prototype,"muteLocal",null),te([Zr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],Xn.prototype,"unmuteLocal",null),te([Zr,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Xn.prototype,"close",null),te([Zr,N("design:type",Function),N("design:paramtypes",[String,Ri]),N("design:returntype",q)],Xn.prototype,"updateEncoderConfig",null),te([Zr,N("design:type",Function),N("design:paramtypes",[String,Ri]),N("design:returntype",q)],Xn.prototype,"updateSendParameters",null),te([Zr,N("design:type",Function),N("design:paramtypes",[Ri,String]),N("design:returntype",q)],Xn.prototype,"replaceTrack",null),te([Zr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Xn.prototype,"getRemoteSSRC",null);const MN="v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0\na=msid-semantic: WMS\na=ice-lite\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 127.0.0.1\na=mid:0\n";class N3{get localCapabilities(){return un(this._localCapabilities)}get rtpCapabilities(){return un(this._rtpCapabilities)}get candidates(){return un(this._candidates)}get iceParameters(){return un(this._iceParameters)}get dtlsParameters(){return un(this._dtlsParameters)}constructor(i){C(this,"sessionDesc",void 0),C(this,"_localCapabilities",void 0),C(this,"_rtpCapabilities",void 0),C(this,"_candidates",void 0),C(this,"_iceParameters",void 0),C(this,"_dtlsParameters",void 0),C(this,"setup",void 0),C(this,"currentMidIndex",void 0),C(this,"cname",void 0),C(this,"firefoxSsrcMidMap",new Map),i=un(i);const{remoteIceParameters:r,remoteDtlsParameters:a,candidates:l,remoteRTPCapabilities:d,remoteSetup:h,localCapabilities:p,cname:m}=i,g=cn.parse(MN);this._rtpCapabilities=d,this._candidates=l,this._iceParameters=r,this._dtlsParameters=a,this._localCapabilities=p,this.setup=h,this.cname=m;const E=this.rtpCapabilities.send;for(const y of g.mediaDescriptions){if(y.attributes.iceUfrag=r.iceUfrag,y.attributes.icePwd=r.icePwd,y.attributes.fingerprints=a.fingerprints,y.attributes.candidates=l,y.attributes.setup=h,"application"===y.media.mediaType&&(y.attributes.sctpPort="5000"),"video"===y.media.mediaType&&(y.media.fmts=E.videoCodecs.map(b=>b.payloadType.toString(10)),y.attributes.payloads=E.videoCodecs,y.attributes.extmaps=E.videoExtensions,j("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:b,ssrcGroups:T}=Jr([{ssrcId:4e4,rtx:j("USE_SUB_RTX")?40001:void 0}],this.cname);y.attributes.ssrcs=b,y.attributes.ssrcGroups=T}if("audio"===y.media.mediaType&&(y.media.fmts=E.audioCodecs.map(b=>b.payloadType.toString(10)),y.attributes.payloads=E.audioCodecs,y.attributes.extmaps=E.audioExtensions,Nl(y),j("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:b,ssrcGroups:T}=Jr([{ssrcId:2e4}],this.cname);y.attributes.ssrcs=b,y.attributes.ssrcGroups=T}}this.sessionDesc=g,this.currentMidIndex=g.mediaDescriptions.length-1}updateRemoteRTPCapabilities(i){const r=cn.parse(MN);this._rtpCapabilities=i;const a=this.rtpCapabilities.send;for(const l of r.mediaDescriptions){if(l.attributes.iceUfrag=this._iceParameters.iceUfrag,l.attributes.icePwd=this._iceParameters.icePwd,l.attributes.fingerprints=this._dtlsParameters.fingerprints,l.attributes.candidates=this._candidates,l.attributes.setup=this.setup,"application"===l.media.mediaType&&(l.attributes.sctpPort="5000"),"video"===l.media.mediaType&&(l.media.fmts=a.videoCodecs.map(d=>d.payloadType.toString(10)),l.attributes.payloads=a.videoCodecs,l.attributes.extmaps=a.videoExtensions,j("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:d,ssrcGroups:h}=Jr([{ssrcId:4e4,rtx:j("USE_SUB_RTX")?40001:void 0}],this.cname);l.attributes.ssrcs=d,l.attributes.ssrcGroups=h}if("audio"===l.media.mediaType&&(l.media.fmts=a.audioCodecs.map(d=>d.payloadType.toString(10)),l.attributes.payloads=a.audioCodecs,l.attributes.extmaps=a.audioExtensions,j("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:d,ssrcGroups:h}=Jr([{ssrcId:2e4}],this.cname);l.attributes.ssrcs=d,l.attributes.ssrcGroups=h}}this.sessionDesc=r,this.currentMidIndex=r.mediaDescriptions.length-1}preloadRemoteMedia(i){const r=this.candidates,a=this.dtlsParameters,l=this.iceParameters,d=this.rtpCapabilities.send;for(let h=1;h<i;h++){const p=2*h+2e4,m=2*h+4e4,{ssrcs:g,ssrcGroups:E}=Jr([{ssrcId:p}],this.cname),{ssrcs:y,ssrcGroups:b}=Jr([{ssrcId:m,rtx:j("USE_SUB_RTX")?m+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.videoCodecs.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:l.iceUfrag,icePwd:l.icePwd,unrecognized:[],candidates:r,extmaps:d.videoExtensions,fingerprints:a.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:y,ssrcGroups:b,rtcpFeedbackWildcards:[],payloads:d.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.audioCodecs.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:l.iceUfrag,icePwd:l.icePwd,unrecognized:[],candidates:r,extmaps:d.audioExtensions,fingerprints:a.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:g,ssrcGroups:E,rtcpFeedbackWildcards:[],payloads:d.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return cn.print(this.sessionDesc)}send(i,r,a,l){const{ssrcs:d,ssrcGroups:h}=Jr(r,this.cname,j("SYNC_GROUP")?a:void 0),p=this.findPreloadMediaDesc(d);if(p){if(Wt()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,p.attributes.mid),l&&(l.twcc||l.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(p);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(p,l),{mid:p.attributes.mid,needExchangeSDP:!0}}return{mid:p.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(i,d);let g;return-1===m||Ki()||Li()||xA()||0===m&&j("USE_SUB_RTX")?(g=this.createOrRecycleSendMedia(i,d,h,"sendonly",l),this.updateBundleMids()):(g=un(this.sessionDesc.mediaDescriptions[m]),g.attributes.direction="sendonly",g.attributes.ssrcs=d,g.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(g,l)),Wt()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,g.attributes.mid),{mid:g.attributes.mid,needExchangeSDP:!0}}}batchSend(i){const r=i.map(d=>{let{kind:h,ssrcMsg:p,mslabel:m}=d;return this.send(h,p,m)}),a=[];let l=!1;return r.forEach(d=>{let{mid:h,needExchangeSDP:p}=d;p&&(l=!0),a.push(h)}),{mids:a,needExchangeSDP:l}}stopSending(i){const r=this.sessionDesc.mediaDescriptions.filter(a=>a.attributes.mid&&-1!==i.indexOf(a.attributes.mid));if(r.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(a=>{"0"===a.attributes.mid||Wt()||Ki()||Li()?a.attributes.ssrcs=[]:(a.attributes.ssrcs=[],a.attributes.direction="inactive",a.media.port="0")}),this.updateBundleMids()}mute(i){const r=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===i);if(!r)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(i){const r=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===i);if(!r)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}muteRemote(i){const r=this.sessionDesc.mediaDescriptions.filter(a=>ye(i).call(i,a.attributes.mid||""));if(r.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(a=>{a.attributes.direction="inactive"})}unmuteRemote(i){const r=this.sessionDesc.mediaDescriptions.filter(a=>ye(i).call(i,a.attributes.mid||""));if(r.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(a=>{a.attributes.direction="recvonly"})}receive(i,r,a,l){i.forEach((d,h)=>{this.createOrRecycleRecvMedia(d,[],"recvonly",r,a,l[h])}),this.updateBundleMids()}stopReceiving(i){const r=this.sessionDesc.mediaDescriptions.filter(a=>-1!==i.indexOf(a.attributes.mid));if(r.length!==i.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(a=>{a.media.port="0",a.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(i){i===wi.TCP?this._candidates.forEach(r=>{-1===this._candidates.findIndex(a=>"tcp"===a.transport&&a.connectionAddress===r.connectionAddress&&a.port===r.port)&&this._candidates.push(D2(D2({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}):this._candidates=this._candidates.filter(r=>"tcp"!==r.transport);for(const r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}restartICE(i){i=un(i),this._iceParameters=i,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=i.iceUfrag,r.attributes.icePwd=i.icePwd})}predictReceivingMids(i){const r=[];for(let a=0;a<i;a++)r.push((this.currentMidIndex+a+1).toString(10));return r}findAvailableMediaIndex(i,r){return this.sessionDesc.mediaDescriptions.findIndex(a=>{const l=a.media.mediaType===i&&"0"!==a.media.port&&("sendonly"===a.attributes.direction||"sendrecv"===a.attributes.direction)&&0===a.attributes.ssrcs.length;if(Wt()){if(l){const d=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(d||"0"!==a.attributes.mid&&"1"!==a.attributes.mid)||!(!d||d!==a.attributes.mid)}return!1}return l})}createOrRecycleRecvMedia(i,r,a,l,d,h){const p=i._mediaStreamTrack.kind,m=this.rtpCapabilities.recv,g=bv(p,m,this.localCapabilities.send,p===Ee.VIDEO?l:d),E=p===Ee.VIDEO?m.videoExtensions:m.audioExtensions;this.currentMidIndex+=1;const y="".concat(this.currentMidIndex);let b={media:{mediaType:p,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:g.map(O=>O.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:E,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:g,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(y)}};b=this.mungRecvMediaDsec(b,i,h);const T=this.findFirstClosedMedia(p);if(T){const O=this.sessionDesc.mediaDescriptions.indexOf(T);this.sessionDesc.mediaDescriptions[O]=b}else this.sessionDesc.mediaDescriptions.push(b);return b}updateRemoteCodec(i,r,a){const l=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(b=>b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||"").filter(b=>{var T;return ye(T=Object.keys(Ui)).call(T,b)}))],d=new Set(r);if(l.every(b=>d.has(b)))return w.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(r)),!1;const h=this._rtpCapabilities.recv.videoCodecs.filter(b=>r.some(T=>{var O;return ye(O=b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||"").call(O,T)}));if(0===h.length)return w.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(l," codecs: ").concat(r)),!1;const p=[...new Set(h.map(b=>b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||""))];let m;if(w.debug("updateRemoteCodec, from ".concat(l," to ").concat(p)),0===i.length)m=this.sessionDesc.mediaDescriptions.filter(b=>"video"===b.media.mediaType&&"recvonly"===b.attributes.direction);else if(m=this.sessionDesc.mediaDescriptions.filter(b=>b.attributes.mid&&ye(i).call(i,b.attributes.mid)&&"recvonly"===b.attributes.direction),m.length!==i.length)return w.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(i,", codecs: ").concat(r)),!1;this._rtpCapabilities.recv.videoCodecs=h;const y=bv(Ee.VIDEO,this.rtpCapabilities.recv,this.localCapabilities.send,a);return m.forEach(b=>{const T=y.map(O=>O.payloadType.toString(10));w.debug("updateRemoteCodec mid: ".concat(b.attributes.mid,", from ").concat(b.attributes.payloads," to ").concat(y)),b.attributes.payloads=y,b.media.fmts=T}),!0}createOrRecycleSendMedia(i,r,a,l,d){const h=this.rtpCapabilities.send,p=i===Ee.VIDEO?h.videoCodecs:h.audioCodecs,m=i===Ee.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const g="".concat(this.currentMidIndex);let E={media:{mediaType:i,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:a,rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:l,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};E=this.mungSendMediaDesc(E,d);const y=this.findFirstClosedMedia(i);if(y){const b=this.sessionDesc.mediaDescriptions.indexOf(y);this.sessionDesc.mediaDescriptions[b]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(i=>"0"!==i.media.port).map(i=>i.attributes.mid)}mungRecvMediaDsec(i,r,a){const l=un(i);return O0(l),Yd(l,r),N0(l,r),CN(l),gv(l,a,this.localCapabilities.send),l}mungSendMediaDesc(i,r){const a=un(i);return gv(a,r,this.localCapabilities.recv),Nl(a),a}updateRecvMedia(i,r){const a=this.sessionDesc.mediaDescriptions.findIndex(l=>l.attributes.mid===i);if(-1!==a){const l=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],r);this.sessionDesc.mediaDescriptions[a]=l}}bumpMid(i){this.currentMidIndex+=i}findFirstClosedMedia(i){return this.sessionDesc.mediaDescriptions.find(r=>Wt()?"0"===r.media.port&&r.media.mediaType===i:"0"===r.media.port)}findPreloadMediaDesc(i){return this.sessionDesc.mediaDescriptions.find(r=>{var a;return(null===(a=r.attributes)||void 0===a||null===(a=a.ssrcs[0])||void 0===a?void 0:a.ssrcId)===i[0].ssrcId})}getSSRC(i){var r;return null===(r=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===i))||void 0===r?void 0:r.attributes.ssrcs}}function LN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Tv(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?LN(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):LN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class Ni extends bh{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(i,r,a){super(i,r),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"remoteSDP",void 0),C(this,"initialOffer",void 0),C(this,"transportEventReceiver",void 0),C(this,"statsFilter",void 0),C(this,"useXR",j("USE_XR")),C(this,"localCapabilities",void 0),C(this,"localCandidateCount",0),C(this,"allCandidatesReceived",!1),C(this,"remoteCodecs",void 0),C(this,"dataStreamChannelMap",new Map),C(this,"establishPromise",void 0),C(this,"mutex",new Zn("NVExtentionsConnection-mutex")),C(this,"rtcMedia",void 0),this.store=r,this.peerConnection=a,this.statsFilter=Sv(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,Wt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(i){var r=this;return M(function*(){try{const a=yield r.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const l=Kd(a.sdp),d=yield TN({filterRTX:!j("USE_PUB_RTX")&&!j("USE_SUB_RTX"),filterVideoFec:j("FILTER_VIDEO_FEC"),filterAudioFec:j("FILTER_AUDIO_FEC"),filterVideoCodec:j("FILTER_VIDEO_CODEC")},{useXR:r.useXR});return r.localCapabilities=d,r.initialOffer=a,Tv(Tv({},l),{},{rtpCapabilities:d,offerSDP:a.sdp})}catch(a){throw new W(x.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}})()}connect(i,r,a,l,d,h){var p=this;return M(function*(){try{if(!p.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");p.remoteSDP=new N3({remoteIceParameters:i,remoteDtlsParameters:r,candidates:a,remoteRTPCapabilities:l,remoteSetup:d,localCapabilities:vv(p.localCapabilities),cname:h});const m=p.remoteSDP.toString(),g=cn.parse(p.initialOffer.sdp),E=g.mediaDescriptions.find(T=>"audio"===T.media.mediaType);E&&Nl(E),p.useXR&&yv(g);const y=cn.print(g),b=p.logSDPExchange(y||"","offer","local","connect");yield p.peerConnection.setLocalDescription({type:"offer",sdp:y}),b?.(m),yield p.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(m){throw new W(x.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(m.toString()))}})()}updateRemoteRTPCapabilities(i,r){var a=this;return M(function*(){let l;a.remoteCodecs=r,a.localCapabilities&&(l=vv(a.localCapabilities));const d=[...new Set(l&&l.send.videoCodecs.map(h=>h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").filter(h=>{var p;return ye(p=Object.keys(Ui)).call(p,h)}))];if(Se.updateRemoteRTPCapabilities(a.store.sessionId,{mids:i,localCodecs:d,remoteCodecs:a.remoteCodecs}),a.remoteSDP)if(a.remoteSDP.updateRemoteCodec(i,r,a.store.codec)){const h=yield a.peerConnection.createOffer(),p=a.logSDPExchange(h.sdp||"","offer","local","muteLocal");yield a.peerConnection.setLocalDescription(h);const m=a.remoteSDP.toString();p?.(m),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:m})}else w.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else w.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(d,", codecs: ").concat(r))})()}updateRemoteConnect(i){var r=this;return M(function*(){var a,l,d,h;null===(a=r.remoteSDP)||void 0===a||a.updateRemoteRTPCapabilities(i),Array.isArray(r.remoteCodecs)&&r.remoteCodecs.length>0&&(null===(h=r.remoteSDP)||void 0===h||h.updateRemoteCodec([],r.remoteCodecs,r.store.codec)),null===(l=r.remoteSDP)||void 0===l||l.preloadRemoteMedia(2);const p=null===(d=r.remoteSDP)||void 0===d?void 0:d.toString();yield r.peerConnection.setRemoteDescription({type:"offer",sdp:p});const m=yield r.peerConnection.createAnswer();yield r.peerConnection.setLocalDescription(m),w.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")})()}send(i,r,a){var l=this;return as(function*(){const d=yield ht(l.mutex.lock("From NVExtentionsConnection.send"));try{if(!l.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const h=[];i.forEach(P=>{const D=l.peerConnection.addTransceiver(P._mediaStreamTrack,{direction:"sendonly"});h.push(D)}),Wt()&&!0===j("SIMULCAST")&&(yield ht(l.applySimulcastForFirefox(h,i)));const p=yield ht(l.peerConnection.createOffer()),m=l.remoteSDP.predictReceivingMids(i.length),g=l.mungSendOfferSDP(p.sdp,i,m),E=cn.parse(g),y=m.map(P=>{const D=E.mediaDescriptions.find(L=>L.attributes.mid===P);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return bN(D,j("USE_PUB_RTX"))});let b;try{b=yield y}catch(P){b=[],l.remoteSDP.receive(i,r,a,b);const D=l.remoteSDP.toString();throw yield ht(l.peerConnection.setLocalDescription({type:"offer",sdp:g})),yield ht(l.peerConnection.setRemoteDescription({type:"answer",sdp:D})),yield ht(l.stopSending(m,!0)),P}l.remoteSDP.receive(i,r,a,b);const T=l.remoteSDP.toString(),O=l.logSDPExchange(g,"offer","local","send");return yield ht(l.peerConnection.setLocalDescription({type:"offer",sdp:g})),yield ht(l.applySimulcastEncodings(h,i)),yield ht(l.applySendEncodings(h,i)),O?.(T),yield ht(l.peerConnection.setRemoteDescription({type:"answer",sdp:T})),h.map((P,D)=>({localSSRC:y[D],id:m[D],transceiver:P}))}catch(h){throw h instanceof W?h:new W(x.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(h.toString()))}finally{d()}})()}stopSending(i,r){var a=this;return M(function*(){const l=r?void 0:yield a.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!a.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const d=a.peerConnection.getTransceivers().filter(g=>-1!==i.indexOf(g.mid));if(d.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");d.map(g=>{var E;g.direction="inactive",null===(E=g.stop)||void 0===E||E.call(g)});const h=yield a.peerConnection.createOffer(),p=a.logSDPExchange(h.sdp||"","offer","local","stopSending");yield a.peerConnection.setLocalDescription(h),a.remoteSDP.stopReceiving(i);const m=a.remoteSDP.toString();p?.(m),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(d){throw new W(x.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(d.toString()))}finally{l&&l()}})()}createDataChannels(i,r){var a=this;return M(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let l=a.dataStreamChannelMap.get(i);return l&&"open"===l.readyState?w.debug("[P2PConnection] Channels are already available and can be reused directly."):(l=a.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:j("DATASTREAM_MAX_RETRANSMITS")}),l.binaryType="arraybuffer",a.dataStreamChannelMap.set(i,l)),void r.forEach(d=>{d._updateOriginDataChannel(l)})}catch(l){throw l instanceof W?l:new W(x.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(l.toString()))}})()}stopDataChannels(i){var r=this;return M(function*(){try{const a=r.dataStreamChannelMap.get(i);return a?.close(),void r.dataStreamChannelMap.delete(i)}catch(a){throw a instanceof W?a:new W(x.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(a.toString()))}})()}receive(i,r,a,l){var d=this;return M(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(i," before remoteSDP created."));const{mid:h,needExchangeSDP:p}=d.remoteSDP.send(i,r,a,l);if(p){const g=d.remoteSDP.toString(),E=d.logSDPExchange(g,"offer","remote","receive");yield d.peerConnection.setRemoteDescription({type:"offer",sdp:g});const y=yield d.peerConnection.createAnswer(),b=d.mungReceiveAnswerSDP(y.sdp,h,i);E?.(b||""),yield d.peerConnection.setLocalDescription({type:"answer",sdp:b}),w.debug("[NVExtentionsConnection] receive ".concat(i," by exchanging SDP."))}else w.debug("[NVExtentionsConnection] receive ".concat(i," no need to exchange SDP."));const m=d.peerConnection.getTransceivers().find(g=>g.mid===h);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:h}}catch(h){throw new W(x.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(h.toString()))}})()}batchReceive(i){var r=this;return M(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:a,needExchangeSDP:l}=r.remoteSDP.batchSend(i);if(l){const d=r.remoteSDP.toString(),h=r.logSDPExchange(d,"offer","remote","receive");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:d});const p=yield r.peerConnection.createAnswer();h?.(p.sdp||""),yield r.peerConnection.setLocalDescription(p),w.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else w.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return a.map(d=>{const h=r.peerConnection.getTransceivers().find(p=>p.mid===d);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:d}})}catch(a){throw new W(x.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(a.toString()))}})()}stopReceiving(i){var r=this;return M(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");r.remoteSDP.stopSending(i);const a=r.remoteSDP.toString(),l=r.logSDPExchange(a,"offer","remote","stopReceiving");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield r.peerConnection.createAnswer();l?.(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(a){throw new W(x.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(a.toString()))}})()}muteRemote(i){var r=this;return M(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(i," before remote SDP created."));r.remoteSDP.mute(i);const a=r.remoteSDP.toString(),l=r.logSDPExchange(a,"offer","remote","muteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield r.peerConnection.createAnswer();l?.(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(a){throw new W(x.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(a.toString()))}})()}unmuteRemote(i){var r=this;return M(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(i," before remote SDP created."));r.remoteSDP.unmute(i);const a=r.remoteSDP.toString(),l=r.logSDPExchange(a,"offer","remote","unmuteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield r.peerConnection.createAnswer();l?.(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(a){throw new W(x.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(a.toString()))}})()}muteLocal(i){var r=this;return M(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==i.indexOf(p.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(p=>{p.direction="inactive"});const l=yield r.peerConnection.createOffer(),d=r.logSDPExchange(l.sdp||"","offer","local","muteLocal");yield r.peerConnection.setLocalDescription(l),r.remoteSDP.muteRemote(i);const h=r.remoteSDP.toString();d?.(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new W(x.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(a.toString()))}})()}unmuteLocal(i){var r=this;return M(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==i.indexOf(p.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(function(){var p=M(function*(m,g){m.direction="sendonly"});return function(m,g){return p.apply(this,arguments)}}());const l=yield r.peerConnection.createOffer(),d=r.logSDPExchange(l.sdp||"","offer","local","unmuteLocal");yield r.peerConnection.setLocalDescription(l),r.remoteSDP.unmuteRemote(i);const h=r.remoteSDP.toString();d?.(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new W(x.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(a.toString()))}})()}restartICE(i){var r=this;return as(function*(){const a=yield ht(r.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if($e().supportPCSetConfiguration){const g=r.peerConnection.getConfiguration(),E=i===wi.RELAY?"relay":"all";g.iceTransportPolicy!==E&&(w.debug("restartICE change iceTransportPolicy from [".concat(g.iceTransportPolicy,"] to [").concat(E,"]")),g.iceTransportPolicy=E,r.peerConnection.setConfiguration(g))}else if(i===wi.RELAY)return;i!==wi.RELAY&&r.remoteSDP.updateCandidates(i);const l=yield ht(r.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=Kd(l.sdp),{remoteIceParameters:h}=yield d.iceParameters;r.remoteSDP.restartICE(h);const p=r.remoteSDP.toString(),m=r.logSDPExchange(l.sdp||"","offer","local","restartICE");yield ht(r.peerConnection.setLocalDescription(l)),m?.(p),yield ht(r.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(l){w.warning("restart ICE failed, abort operation",l)}finally{a()}})()}close(){var i;null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}updateEncoderConfig(i,r){var a=this;return M(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const l=yield a.peerConnection.createOffer(),d=a.mungSendOfferSDP(l.sdp,[r],[i]);a.remoteSDP.updateRecvMedia(i,r);const h=a.remoteSDP.toString(),p=a.logSDPExchange(d,"offer","local","updateEncoderConfig");yield a.peerConnection.setLocalDescription({type:"offer",sdp:d}),p?.(h),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(l){throw new W(x.EXCHANGE_SDP_FAILED,l.toString())}})()}updateSendParameters(i,r){var a=this;return M(function*(){const l=a.peerConnection.getTransceivers().filter(d=>d.mid===i);1===l.length&&(a.isVP8Simulcast(r)?Wt()||(yield a.applySimulcastEncodings(l,[r])):yield a.applySendEncodings(l,[r]))})()}setStatsRemoteVideoIsReady(i,r){this.statsFilter.setVideoIsReady2(i,r)}replaceTrack(i,r){var a=this;return M(function*(){const l=a.peerConnection.getTransceivers().find(d=>d.mid===r);l&&(yield l.sender.replaceTrack(i._mediaStreamTrack))})()}getP2PConnectionParams(){var i;if(null===(i=this.peerConnection.currentLocalDescription)||void 0===i||!i.sdp||!this.localCapabilities)throw new Error;return Tv(Tv({},Kd(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;null===(i=this.onICEConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,w.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,w.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},j("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const r={iceServers:[]};return i.iceServers?r.iceServers=i.iceServers:i.turnServer&&"off"!==i.turnServer.mode&&(Da(i.turnServer.servers)?r.iceServers=i.turnServer.servers:(r.iceServers&&r.iceServers.push(...Ni.turnServerConfigToIceServers(i.turnServer.servers)),j("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&i.turnServer.serversFromGateway&&r.iceServers.push(...Ni.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),j("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(i){const r=[];return i.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(sv(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!j("FORCE_TURN_TCP")&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}applySendEncodings(i,r){var a=this;return M(function*(){try{if(!$e().supportSetRtpSenderParameters||i.length!==r.length)return;for(let b=0;b<i.length;b++){const T=i[b],O=r[b];if(O&&O instanceof ze){var l,d,h;if(a.isVP8Simulcast(O))continue;const P={},D={};switch(O._optimizationMode){case"motion":P.degradationPreference="maintain-framerate";break;case"detail":P.degradationPreference="maintain-resolution";break;default:P.degradationPreference="balanced"}var p,m,g,E;if(null!==(l=O._encoderConfig)&&void 0!==l&&l.bitrateMax&&(D.maxBitrate=1e3*(null===(p=O._encoderConfig)||void 0===p?void 0:p.bitrateMax)),ye(d=O._hints).call(d,Ot.LOW_STREAM)&&(null!==(m=O._encoderConfig)&&void 0!==m&&m.frameRate&&(D.maxFramerate=Cr(O._encoderConfig.frameRate)),null!==(g=O._encoderConfig)&&void 0!==g&&g.scaleResolutionDownBy&&(null===(E=O._encoderConfig)||void 0===E?void 0:E.scaleResolutionDownBy)>1&&(D.scaleResolutionDownBy=O._encoderConfig.scaleResolutionDownBy)),j("DSCP_TYPE")&&zs()){var y;const V=j("DSCP_TYPE");ye(y=["very-low","low","medium","high"]).call(y,V)&&(D.networkPriority=V)}const L=T.sender.getParameters(),B=null===(h=L.encodings)||void 0===h?void 0:h[0];Wt()&&!B&&(P.encodings=[D]),B&&Object.assign(B,D),Object.assign(L,P),yield T.sender.setParameters(L)}}}catch{w.debug("Apply RTPSendEncodings failed.")}})()}mungSendOfferSDP(i,r,a){const l=cn.parse(i);return r.forEach((d,h)=>{const p=a[h],m=l.mediaDescriptions.find(g=>g.attributes.mid===p);m&&(Yd(m,d),P0(m,d,this.store.codec))}),cn.print(l)}mungReceiveAnswerSDP(i,r,a){const l=cn.parse(i),d=l.mediaDescriptions.find(h=>h.attributes.mid===r);return d&&a===Ee.AUDIO&&"audio"===d.media.mediaType&&Nl(d),this.useXR&&yv(l),cn.print(l)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,r,a)=>{var l;null===(l=this.onFirstVideoDecoded)||void 0===l||l.call(this,i,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var r;null===(r=this.onFirstVideoDecodedTimeout)||void 0===r||r.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(i,r){var a=this;return M(function*(){if(i.length===r.length)for(let g=0;g<i.length;g++){var l,d,h,p,m;const E=i[g],y=r[g];if(y instanceof ze&&!ye(l=y._hints).call(l,Ot.LOW_STREAM)&&null!==(d=y._encoderConfig)&&void 0!==d&&d.bitrateMax&&(null===(h=y._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(p=y._scalabilityMode)&&void 0!==p&&p.numSpatialLayers&&(null===(m=y._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===a.store.codec){const b={},T={high:1e3*(y._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{rid:"m",active:!0,maxBitrate:T.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:T.high}];const O=E.sender.getParameters();yield E.sender.setParameters(Object.assign(O,b))}}})()}applySimulcastEncodings(i,r){var a=this;return M(function*(){if(!Wt()&&i.length===r.length)for(let l=0;l<i.length;l++){const d=r[l];if(d instanceof ze&&a.isVP8Simulcast(d)){const h=i[l],p={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=h.sender.getParameters();yield h.sender.setParameters(Object.assign(g,p))}}})()}isVP8Simulcast(i){var r,a,l,d,h;return!!(i instanceof ze&&j("SIMULCAST")&&"vp8"===this.store.codec&&!ye(r=i._hints).call(r,Ot.LOW_STREAM)&&null!==(a=i._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(l=i._encoderConfig)||void 0===l?void 0:l.bitrateMax)>200&&null!==(d=i._scalabilityMode)&&void 0!==d&&d.numSpatialLayers&&(null===(h=i._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(i,r,a,l){if(j("SDP_LOGGING"))return w.upload("exchanging ".concat(a," ").concat(r," SDP during NVExtentionsConnection.").concat(l,"\n"),i),"offer"===r?d=>{this.logSDPExchange(d,"answer","local"===a?"remote":"local",l)}:void 0}getRemoteSSRC(i){var r=this;return M(function*(){if(!r.remoteSDP)return;const a=r.remoteSDP.getSSRC(i);return a?.[0].ssrcId})()}setConfiguration(i){if($e().supportPCSetConfiguration){const r=Ni.resolvePCConfiguration(i);this.peerConnection.setConfiguration(r)}}}function eo(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=M(function*(){const l=this.mutex,d=yield l.lock("From NVExtentionsConnection.".concat(i));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield a.apply(this,p)}finally{d()}}),r}function O2(s){var i,r,a,l=2;for(typeof Symbol<"u"&&(r=vN,a=Symbol.iterator);l--;){if(r&&null!=(i=s[r]))return i.call(s);if(a&&null!=(i=s[a]))return new wv(i.call(s));r="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function wv(s){function i(r){if(Object(r)!==r)return q.reject(new TypeError(r+" is not an object."));var a=r.done;return q.resolve(r.value).then(function(l){return{value:l,done:a}})}return(wv=function(r){this.s=r,this.n=r.next}).prototype={s:null,n:null,next:function(){return i(this.n.apply(this.s,arguments))},return:function(r){var a=this.s.return;return void 0===a?q.resolve({value:r,done:!0}):i(a.apply(this.s,arguments))},throw:function(r){var a=this.s.return;return void 0===a?q.reject(r):i(a.apply(this.s,arguments))}},new wv(s)}te([eo,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",q)],Ni.prototype,"connect",null),te([eo,N("design:type",Function),N("design:paramtypes",[Array,Array]),N("design:returntype",q)],Ni.prototype,"updateRemoteRTPCapabilities",null),te([eo,N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",q)],Ni.prototype,"updateRemoteConnect",null),te([eo,N("design:type",Function),N("design:paramtypes",[Object,Array]),N("design:returntype",q)],Ni.prototype,"createDataChannels",null),te([eo,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",q)],Ni.prototype,"receive",null),te([eo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],Ni.prototype,"batchReceive",null),te([eo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],Ni.prototype,"stopReceiving",null),te([eo,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Ni.prototype,"muteRemote",null),te([eo,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Ni.prototype,"unmuteRemote",null),te([eo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],Ni.prototype,"muteLocal",null),te([eo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],Ni.prototype,"unmuteLocal",null),te([eo,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Ni.prototype,"close",null),te([eo,N("design:type",Function),N("design:paramtypes",[String,Ri]),N("design:returntype",q)],Ni.prototype,"updateEncoderConfig",null),te([eo,N("design:type",Function),N("design:paramtypes",[String,Ri]),N("design:returntype",q)],Ni.prototype,"updateSendParameters",null),te([eo,N("design:type",Function),N("design:paramtypes",[Ri,String]),N("design:returntype",q)],Ni.prototype,"replaceTrack",null),te([eo,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Ni.prototype,"getRemoteSSRC",null);class Hn extends bh{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(i,r){super(i,r),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"cname",void 0),C(this,"mutex",new Zn("DataChannelConnection-mutex")),C(this,"dataChannel",void 0),C(this,"_p2pConnection",void 0),C(this,"establishPromise",void 0),C(this,"_nvMedia",void 0),this.store=r,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(Hn.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new Ni(i,r,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}establish(){var i=this;return M(function*(){var r;const a=null===(r=i._nvMedia)||void 0===r?void 0:r.getLocalRtpCapabilities();return yield i._p2pConnection.establish(a)})()}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}connect(i,r,a,l,d,h){var p=this;return M(function*(){return p.cname=h,yield p._p2pConnection.connect(i,r,a,l,d,h),yield new q((m,g)=>{const E=setTimeout(()=>{p.closeSignal(),g(new W(x.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(a))))},2e3);p.dataChannel.onopen=()=>{if("open"===p.dataChannel.readyState)return clearTimeout(E),void m()},p.dataChannel.onerror=y=>{p.closeSignal(),g(y)}}),{transmitter:p.dataChannel,close:p.closeSignal.bind(p)}})()}updateRemoteRTPCapabilities(i,r){var a=this;return M(function*(){return a._p2pConnection.updateRemoteRTPCapabilities(i,r)})()}send(i,r,a){var l=this;return as(function*(){const d=yield ht(l.mutex.lock("From DataChannelConnection.send"));try{return yield*sm(O2(l._p2pConnection.send(i,r,a)))}finally{d()}})()}stopSending(i,r){var a=this;return M(function*(){return a._p2pConnection.stopSending(i,r)})()}createDataChannels(i,r){var a=this;return M(function*(){return a._p2pConnection.createDataChannels(i,r)})()}stopDataChannels(i){var r=this;return M(function*(){return r._p2pConnection.stopDataChannels(i)})()}receive(i,r,a,l){var d=this;return M(function*(){return d._nvMedia?(w.debug("[DataChannelConnection] receive ".concat(i," by DataChannel.")),yield d._nvMedia.reveiveByRTCMedia(i,r,d.cname)):(w.debug("[DataChannelConnection] receive ".concat(i," by WebRTC.")),yield d._p2pConnection.receive(i,r,a,l))})()}batchReceive(i){var r=this;return M(function*(){return[...yield r._p2pConnection.batchReceive(i)]})()}stopReceiving(i){var r=this;return M(function*(){return yield r._p2pConnection.stopReceiving(i)})()}muteRemote(i){var r=this;return M(function*(){return yield r._p2pConnection.muteRemote(i)})()}unmuteRemote(i){var r=this;return M(function*(){return yield r._p2pConnection.unmuteRemote(i)})()}muteLocal(i){var r=this;return M(function*(){return yield r._p2pConnection.muteLocal(i)})()}unmuteLocal(i){var r=this;return M(function*(){return yield r._p2pConnection.unmuteLocal(i)})()}restartICE(i){var r=this;return as(function*(){return yield*sm(O2(r._p2pConnection.restartICE(i)))})()}close(){var i;null===(i=this._nvMedia)||void 0===i||i.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(i){return this._p2pConnection.getRemoteVideoIsReady(i)}updateRemoteConnect(i){var r;null===(r=this._nvMedia)||void 0===r||r.setRemoteRtpCapabilities(i),this._p2pConnection.updateRemoteConnect(i)}updateEncoderConfig(i,r){var a=this;return M(function*(){return yield a._p2pConnection.updateEncoderConfig(i,r)})()}updateSendParameters(i,r){var a=this;return M(function*(){return yield a._p2pConnection.updateSendParameters(i,r)})()}setStatsRemoteVideoIsReady(i,r){this._p2pConnection.setStatsRemoteVideoIsReady(i,r)}replaceTrack(i,r){var a=this;return M(function*(){return yield a._p2pConnection.replaceTrack(i,r)})()}getRemoteSSRC(i){var r=this;return M(function*(){return r._p2pConnection.getRemoteSSRC(i)})()}logSDPExchange(i,r,a,l){if(j("SDP_LOGGING"))return w.upload("exchanging ".concat(a," ").concat(r," SDP during DataChannelConnection.").concat(l,"\n"),i),"offer"===r?d=>{this.logSDPExchange(d,"answer","local"===a?"remote":"local",l)}:void 0}static resolvePCConfiguration(i){const r={iceServers:[]};return i.iceServers?r.iceServers=i.iceServers:i.turnServer&&"off"!==i.turnServer.mode&&(Da(i.turnServer.servers)?r.iceServers=i.turnServer.servers:(r.iceServers&&r.iceServers.push(...Hn.turnServerConfigToIceServers(i.turnServer.servers)),j("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&i.turnServer.serversFromGateway&&r.iceServers.push(...Hn.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),j("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(i){const r=[];return i.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(sv(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!j("FORCE_TURN_TCP")&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=i=>{var r;return null===(r=this.onICEConnectionStateChange)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onConnectionStateChange=i=>{var r;return null===(r=this.onConnectionStateChange)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onDTLSTransportStateChange=i=>{var r;return null===(r=this.onDTLSTransportStateChange)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onDTLSTransportError=i=>{var r;return null===(r=this.onDTLSTransportError)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onICETransportStateChange=i=>{var r;return null===(r=this.onICETransportStateChange)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onFirstAudioReceived=i=>{var r;return null===(r=this.onFirstAudioReceived)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onFirstVideoReceived=i=>{var r;return null===(r=this.onFirstVideoReceived)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onFirstAudioDecoded=i=>{var r;return null===(r=this.onFirstAudioDecoded)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onFirstVideoDecoded=(i,r,a)=>{var l;return null===(l=this.onFirstVideoDecoded)||void 0===l?void 0:l.call(this,i,r,a)},this._p2pConnection.onFirstVideoDecodedTimeout=i=>{var r;return null===(r=this.onFirstVideoDecodedTimeout)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onSelectedLocalCandidateChanged=(i,r)=>{var a;return null===(a=this.onSelectedLocalCandidateChanged)||void 0===a?void 0:a.call(this,i,r)},this._p2pConnection.onSelectedRemoteCandidateChanged=(i,r)=>{var a;return null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a?void 0:a.call(this,i,r)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(i){i.onConnectionStateChange=void 0,i.onICEConnectionStateChange=void 0,i.onICETransportStateChange=void 0,i.onDTLSTransportStateChange=void 0,i.onDTLSTransportError=void 0,i.onFirstAudioDecoded=void 0,i.onFirstAudioReceived=void 0,i.onFirstVideoDecoded=void 0,i.onFirstVideoReceived=void 0,i.onSelectedLocalCandidateChanged=void 0,i.onSelectedRemoteCandidateChanged=void 0,i.onFirstVideoDecodedTimeout=void 0}setConfiguration(i){this._p2pConnection.setConfiguration(i)}}function Do(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=M(function*(){const l=this.mutex,d=yield l.lock("From DataChannelConnection.".concat(i));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield a.apply(this,p)}finally{d()}}),r}function N2(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function P2(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?N2(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):N2(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}te([Do,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",q)],Hn.prototype,"connect",null),te([Do,N("design:type",Function),N("design:paramtypes",[Array,Array]),N("design:returntype",q)],Hn.prototype,"updateRemoteRTPCapabilities",null),te([Do,N("design:type",Function),N("design:paramtypes",[Object,Array]),N("design:returntype",q)],Hn.prototype,"createDataChannels",null),te([Do,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",q)],Hn.prototype,"receive",null),te([Do,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],Hn.prototype,"stopReceiving",null),te([Do,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Hn.prototype,"muteRemote",null),te([Do,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Hn.prototype,"unmuteRemote",null),te([Do,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],Hn.prototype,"muteLocal",null),te([Do,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],Hn.prototype,"unmuteLocal",null),te([Do,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Hn.prototype,"close",null),te([Do,N("design:type",Function),N("design:paramtypes",[String,Ri]),N("design:returntype",q)],Hn.prototype,"updateEncoderConfig",null),te([Do,N("design:type",Function),N("design:paramtypes",[String,Ri]),N("design:returntype",q)],Hn.prototype,"updateSendParameters",null),te([Do,N("design:type",Function),N("design:paramtypes",[Ri,String]),N("design:returntype",q)],Hn.prototype,"replaceTrack",null),te([Do,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Hn.prototype,"getRemoteSSRC",null);class ai extends zt{constructor(){super(),C(this,"uplinkStatsUploadInterval",void 0),C(this,"uplinkRelatedStatsUploadInterval",void 0),C(this,"uplinkDenoiserStatsUploadInterval",void 0),C(this,"transportStatsUploadInterval",void 0),C(this,"uplinkExtensionStatsUploadInterval",void 0),C(this,"downlinkExtensionStatsUploadInterval",void 0),C(this,"extensionUsageStatsUploadInterval",void 0),C(this,"downlinkStatsUploadInterval",void 0),C(this,"downlinkRelatedStatsUploadInterval",void 0),C(this,"lastStats",void 0),C(this,"uploadUnplinkStarted",!1),C(this,"uploadDownlinkStarted",!1),C(this,"uploadTransportStarted",!1),C(this,"uploadExtensionUsageStarted",!1),C(this,"requestStats",void 0),C(this,"requestTransportStats",void 0),C(this,"requestLocalMedia",void 0),C(this,"requestRemoteMedia",void 0),C(this,"requestAllTracks",void 0),C(this,"requestVideoIsReady",void 0),C(this,"requestUpload",void 0)}startUploadTransportStats(i){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval(()=>{var r;const a=null===(r=this.requestStats)||void 0===r?void 0:r.call(this);if(a){const d=rs(a);if(i){var l;const h=null===(l=this.requestStats)||void 0===l?void 0:l.call(this,!0);if(h){const p=rs(h);d.connectionType+=p.connectionType<<3}d.connectionType+=110}else d.connectionType+=100;mo(()=>{var h;null===(h=this.requestUpload)||void 0===h||h.call(this,Xi.TRANSPORT_STATS,d)})}},1e3))}startUploadExtensionUsageStats(){var i=this;if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const r=new Map;this.extensionUsageStatsUploadInterval=window.setInterval(M(function*(){var a,l,d;const h=Date.now(),p={connectionInterval:j("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:h};let m=[];const g=(null===(a=i.requestAllTracks)||void 0===a?void 0:a.call(i))||[];for(const T of g)!T.muted&&T.enabled&&(m=m.concat(yield T.getProcessorUsage()));const E=(null===(l=i.requestRemoteMedia)||void 0===l?void 0:l.call(i))||[];for(const[T,O]of E)O.has(Ee.VIDEO)&&T.videoTrack&&(m=m.concat(yield T.videoTrack.getProcessorUsage())),O.has(Ee.AUDIO)&&T.audioTrack&&(m=m.concat(yield T.audioTrack.getProcessorUsage()));if(0===m.length)return;p.details=function(T,O){const P={};for(const{id:V,value:Q,level:se,direction:K}of T){var D;const ee=null!==(D=O.get(V))&&void 0!==D?D:0,$=2===Q?ee+j("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ee;var L,B;O.set(V,$),P[V]?(2===Q&&(P[V].value=Q),se>P[V].level&&(P[V].level=se),"remote"===K&&(P[V].remoteUidCount+=1),P[V].totalTs=null!==(L=O.get(V))&&void 0!==L?L:0):P[V]={value:Q,level:se,remoteUidCount:"local"===K?0:1,totalTs:null!==(B=O.get(V))&&void 0!==B?B:0}}return Object.keys(P).map(V=>{const{level:Q,value:se,totalTs:K}=P[V];return{id:V,level:Q,value:se,totalTs:K}})}(m,r);const y=Date.now();null===(d=i.requestUpload)||void 0===d||d.call(i,Xi.EXTENSION_USAGE_STATS,{usageStats:p,sendTs:y>h?y:h+1})}),j("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval(()=>{var i;const r=null===(i=this.requestStats)||void 0===i?void 0:i.call(this);r&&(this.uploadUplinkStats(r),this.lastStats=r)},3e3),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval(()=>{var i;const r=null===(i=this.requestStats)||void 0===i?void 0:i.call(this);r&&this.uploadRelatedUplinkStats(r,this.lastStats),this.lastStats=r},1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval(()=>{var i;const r=null===(i=this.requestAllTracks)||void 0===i?void 0:i.call(this);r&&this.uploadDenoiserStats(r)},2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval(()=>{var i;const r=null===(i=this.requestAllTracks)||void 0===i?void 0:i.call(this);r&&this.uploadExtensionStats(r)},2e3))}uploadUplinkStats(i){var r;((null===(r=this.requestLocalMedia)||void 0===r?void 0:r.call(this))||[]).forEach(a=>{let[l,{track:d,ssrcs:h}]=a;switch(l){case ne.LocalVideoLowTrack:case ne.LocalVideoTrack:{const p=function(E,y,b){var T;const O=y.videoSend.find(D=>D.ssrc===E);if(!O)return null;const P={id:Fe(10,""),timestamp:new Date(y.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:O.ssrc.toString()};switch(P.A_vstd=b._originMediaStreamTrack&&!b._originMediaStreamTrack.enabled||b._mediaStreamTrack&&!b._mediaStreamTrack.enabled?"1":"0",O.sentFrame&&(P.A_fhs=O.sentFrame.height.toString(),P.A_frs=O.sentFrame.frameRate.toString(),P.A_fws=O.sentFrame.width.toString()),O.adaptionChangeReason){case"none":P.A_ac="0";break;case"cpu":P.A_ac="1";break;case"bandwidth":P.A_ac="2";break;case"other":P.A_ac="3"}return P.A_lvps=RE[b._player?b._player.videoElementStatus:"uninit"].toString(),P.A_nr=null===(T=O.nacksCount)||void 0===T?void 0:T.toString(),O.avgEncodeMs&&(P.A_aem=O.avgEncodeMs.toFixed(0).toString()),j("P2P")&&(O.bytes&&(P.bytesSent=O.bytes.toString()),"number"==typeof O.packetsLost&&(P.packetsLost=O.packetsLost.toString()),O.packets&&(P.packetsSent=O.packets.toString())),P}(h[0].ssrcId,i,d),m=l===ne.LocalVideoTrack?function(E,y,b){var T,O,P,D,L,B,V,Q;const se=y.videoSend.find(_e=>_e.ssrc===E);if(!se)return null;const K={id:Fe(10,""),timestamp:new Date(y.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:se.ssrc.toString()},ee=null!==(T=null!==(O=null===(P=se.inputFrame)||void 0===P?void 0:P.height)&&void 0!==O?O:b?._videoHeight)&&void 0!==T?T:0,$=null!==(D=null!==(L=null===(B=se.inputFrame)||void 0===B?void 0:B.width)&&void 0!==L?L:b?._videoWidth)&&void 0!==D?D:0,Y=null!==(V=null===(Q=se.inputFrame)||void 0===Q?void 0:Q.frameRate)&&void 0!==V?V:0;return ee&&(K.A_fhi=ee+""),$&&(K.A_fwi=$+""),Y&&(K.A_fri=Y+""),K}(h[0].ssrcId,i,d):null;p&&mo(()=>{var E;return null===(E=this.requestUpload)||void 0===E?void 0:E.call(this,Xi.PUBLISH_STATS,{stream_type:l===ne.LocalVideoLowTrack?"low":"high",stats:P2(P2({},p),m)})});const g=function(E){const y={id:"bweforvideo",timestamp:new Date(E.timestamp).toISOString(),type:"VideoBwe"};return E.bitrate.retransmit&&(y.A_rb=E.bitrate.retransmit.toString()),E.bitrate.targetEncoded&&(y.A_teb=E.bitrate.targetEncoded.toString()),y.A_aeb=E.bitrate.actualEncoded.toString(),y.A_tb=E.bitrate.transmit.toString(),void 0!==E.sendBandwidth&&(y.A_asb=E.sendBandwidth.toString()),y}(i);g&&setTimeout(()=>{var E;return null===(E=this.requestUpload)||void 0===E?void 0:E.call(this,Xi.PUBLISH_STATS,{stream_type:l===ne.LocalVideoLowTrack?"low":"high",stats:g})},1e3);break}case ne.LocalAudioTrack:{const p=function(m,g,E){const y=g.audioSend.find(T=>T.ssrc===m);if(!y)return null;const b={id:Fe(10,""),timestamp:new Date(g.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:y.ssrc.toString()};return b.A_astd=E._originMediaStreamTrack&&!E._originMediaStreamTrack.enabled||E._mediaStreamTrack&&!E._mediaStreamTrack.enabled?"1":"0",b.A_ail=y.inputLevel?Math.round(100*y.inputLevel).toString():Math.round(100*E._source.getAccurateVolumeLevel()).toString(),b.A_apil=Math.round(100*E._source.getAccurateVolumeLevel()).toString(),y.aecReturnLoss&&(b.A_ecrl=Math.round(y.aecReturnLoss).toString()),y.aecReturnLossEnhancement&&(b.A_ecrle=Math.round(y.aecReturnLossEnhancement).toString()),j("P2P")&&(y.bytes&&(b.bytesSent=y.bytes.toString()),"number"==typeof y.packetsLost&&(b.packetsLost=y.packetsLost.toString()),y.packets&&(b.packetsSent=y.packets.toString())),b}(h[0].ssrcId,i,d);p&&mo(()=>{var m;return null===(m=this.requestUpload)||void 0===m?void 0:m.call(this,Xi.PUBLISH_STATS,{stream_type:"high",stats:p})});break}}})}uploadRelatedUplinkStats(i,r){var a;((null===(a=this.requestLocalMedia)||void 0===a?void 0:a.call(this))||[]).filter(l=>{let[d]=l;return d===ne.LocalVideoLowTrack||d===ne.LocalVideoTrack}).forEach(l=>{let[d,{ssrcs:h}]=l;const p=function(m,g){const E=g.videoSend.find(y=>y.ssrc===m);return E?{mediaType:"video",isVideoMute:!1,frameRateInput:E.inputFrame&&E.inputFrame.frameRate.toString(),frameRateSent:E.sentFrame&&E.sentFrame.frameRate.toString(),googRtt:E.rttMs.toString(),qpSumPerFrame:Math.floor(E.qpSumPerFrame).toString()}:null}(h[0].ssrcId,i);p&&mo(()=>{var m;null===(m=this.requestUpload)||void 0===m||m.call(this,Xi.PUBLISH_RELATED_STATS,{stream_type:d===ne.LocalVideoLowTrack?"low":"high",stats:p})})})}uploadDenoiserStats(i){for(let d=0;d<i.length;d++){const h=i[d];if(h instanceof Rd){var r,a,l;const p=null===(r=(a=h._external).getDenoiserStats)||void 0===r?void 0:r.call(a);return void(p&&(null===(l=this.requestUpload)||void 0===l||l.call(this,Xi.DENOISER_STATS,p)))}}}uploadExtensionStats(i){for(let r=0;r<i.length;r++)i[r].getProcessorStats().forEach(a=>{var l;null===(l=this.requestUpload)||void 0===l||l.call(this,a.type,a.stats)})}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let i;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let r=!1;this.downlinkStatsUploadInterval=window.setInterval(()=>{var a;const l=null===(a=this.requestStats)||void 0===a?void 0:a.call(this,!0);l&&(this.uploadDownlinkStats(l,r,i),i=l),r=!r},3e3),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval(()=>{var a;const l=null===(a=this.requestStats)||void 0===a?void 0:a.call(this,!0);l&&(this.uploadRelatedDownlinkStats(l,this.lastStats),this.lastStats=l)},1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval(()=>{var a;const l=null===(a=this.requestRemoteMedia)||void 0===a?void 0:a.call(this);l&&this.uploadDownlinkExtensionStats(l)},2e3)}uploadDownlinkStats(i,r,a){var l;((null===(l=this.requestRemoteMedia)||void 0===l?void 0:l.call(this))||[]).forEach(d=>{let[h,p]=d;if(p.has(Ee.VIDEO)&&h.videoTrack){const m=h.videoTrack?function(g,E,y,b,T){const O=E.videoRecv.find(B=>B.ssrc===g);if(!O)return null;const P={id:Fe(10,""),timestamp:new Date(E.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:O.ssrc.toString()};var D,L;if(P.bytesReceived=O.bytes.toString(),P.packetsLost=O.packetsLost.toString(),P.packetsReceived=O.packets.toString(),O.framesRateFirefox&&(P.A_frr=O.framesRateFirefox.toString()),O.receivedFrame?(P.A_frr=O.receivedFrame.frameRate.toString(),P.A_fhr=O.receivedFrame.height.toString(),P.A_fwr=O.receivedFrame.width.toString()):(P.A_fhr=null===(D=b._videoHeight)||void 0===D?void 0:D.toString(),P.A_fwr=null===(L=b._videoWidth)||void 0===L?void 0:L.toString()),P.A_frd=O.decodeFrameRate.toString(),O.outputFrame&&(P.A_fro=O.outputFrame.frameRate.toString()),void 0!==O.jitterBufferMs&&(P.A_jbm=Math.floor(O.jitterBufferMs).toString()),void 0!==O.currentDelayMs&&(P.A_cdm=Math.floor(O.currentDelayMs).toString()),P.A_fs=O.firsCount.toString(),P.A_ns=O.nacksCount.toString(),P.A_ps=O.plisCount.toString(),b&&(P.A_vrtd=b._originMediaStreamTrack.enabled&&b._mediaStreamTrack.enabled?"0":"1"),b._player&&b._player.freezeTimeCounterList.length>0&&(P.A_vrft=Math.round(b._player.freezeTimeCounterList.splice(0,1)[0]).toString()),T&&b._player&&"visible"===Fa.visibility){const B=Math.min(6e3,b._player.renderFreezeAccTime);P.A_vrrft=Math.round(B).toString(),b._player.renderFreezeAccTime=Math.max(0,b._player.renderFreezeAccTime-B)}if(P.A_rvps=RE[b._player?b._player.videoElementStatus:"uninit"].toString(),y){const B=y.videoRecv.find(V=>V.ssrc===g);if(B&&void 0!==O.totalInterFrameDelay&&void 0!==O.totalSquaredInterFrameDelay&&void 0!==B.totalInterFrameDelay&&void 0!==B.totalSquaredInterFrameDelay){const V=O.totalInterFrameDelay-B.totalInterFrameDelay,se=O.framesDecodeCount-B.framesDecodeCount,K=V/se*1e3,ee=Math.round(1e3*Math.sqrt((O.totalSquaredInterFrameDelay-B.totalSquaredInterFrameDelay-Math.pow(V,2)/se)/se));!isNaN(ee)&&K+ee>Math.max(3*K,K+150)&&(P.A_ifdsd=ee.toString())}}return P}(h._videoSSRC,i,a,h.videoTrack,r):void 0;m&&mo(()=>{var g;return null===(g=this.requestUpload)||void 0===g?void 0:g.call(this,Xi.SUBSCRIBE_STATS,{stream_id:h.uid,stats:m})})}if(p.has(Ee.AUDIO)&&h.audioTrack){const m=h.audioTrack?function(g,E,y,b){const T=E.audioRecv.find(P=>P.ssrc===g);if(!T)return null;const O={id:Fe(10,""),timestamp:new Date(E.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:T.ssrc.toString()};if(O.bytesReceived=T.bytes.toString(),O.packetsLost=T.packetsLost.toString(),O.packetsReceived=T.packets.toString(),O.A_aol=T.outputLevel?Math.round(100*T.outputLevel).toString():Math.round(100*b._source.getAccurateVolumeLevel()).toString(),O.A_apol=Math.round(100*b._source.getAccurateVolumeLevel()).toString(),b&&(O.A_artd=b._originMediaStreamTrack.enabled&&b._mediaStreamTrack.enabled?"0":"1"),O.A_jr=T.jitterMs.toString(),O.A_jbm=Math.floor(T.jitterBufferMs).toString(),O.A_cdm=Math.floor(T.jitterBufferMs).toString(),O.A_raps=RE[Xr.getPlayerState(b.getTrackId())].toString(),y){const P=y.audioRecv.find(D=>D.ssrc===g);if(P){const D=T.concealedSamples-P.concealedSamples;D>0&&(O.A_cs=Math.round(D).toString())}}return O}(h._audioSSRC,i,a,h.audioTrack):void 0;m&&mo(()=>{var g;return null===(g=this.requestUpload)||void 0===g?void 0:g.call(this,Xi.SUBSCRIBE_STATS,{stream_id:h.uid,stats:m})})}})}uploadRelatedDownlinkStats(i,r){var a;((null===(a=this.requestRemoteMedia)||void 0===a?void 0:a.call(this))||[]).forEach(l=>{let[d,h]=l;if(h.has(Ee.VIDEO)&&d.videoTrack){var p;const m=!0===(d._videoSSRC&&(null===(p=this.requestVideoIsReady)||void 0===p?void 0:p.call(this,d._videoSSRC))||!1),g=function(E,y,b,T,O,P){const D=b.videoRecv.find(Q=>Q.ssrc===E),L=O?O.videoRecv.find(Q=>Q.ssrc===E):void 0;if(!D)return null;const B=kh.isRemoteVideoFreeze(P,D,L)&&y,V={mediaType:"video",isVideoMute:!1,peerId:T,frameRateReceived:D.receivedFrame&&D.receivedFrame.frameRate.toString(),frameRateDecoded:D.decodedFrame&&D.decodedFrame.frameRate.toString(),isFreeze:B,bytesReceived:D.bytes.toString(),packetsReceived:D.packets.toString(),packetsLost:D.packetsLost.toString(),qpSumPerFrame:Math.floor(D.qpSumPerFrame).toString()};return D.framesRateFirefox&&(V.frameRateDecoded=D.framesRateFirefox.toString(),V.frameRateReceived=D.framesRateFirefox.toString()),V}(d._videoSSRC,m,i,d.uid,r,d.videoTrack);g&&mo(()=>{var E;null===(E=this.requestUpload)||void 0===E||E.call(this,Xi.SUBSCRIBE_RELATED_STATS,{stream_id:d.uid,stats:g})})}if(h.has(Ee.AUDIO)&&d.audioTrack){const m=function(g,E,y,b){const T=E.audioRecv.find(P=>P.ssrc===g);if(!T)return null;const O=kh.isRemoteAudioFreeze(b);return{mediaType:"audio",isAudioMute:!1,peerId:y,googJitterReceived:T.jitterMs.toString(),isFreeze:O,bytesReceived:T.bytes.toString(),packetsReceived:T.packets.toString(),packetsLost:T.packetsLost.toString(),frameReceived:T.receivedFrames.toString(),frameDropped:T.droppedFrames.toString()}}(d._audioSSRC,i,d.uid,d.audioTrack);m&&mo(()=>{var g;null===(g=this.requestUpload)||void 0===g||g.call(this,Xi.SUBSCRIBE_RELATED_STATS,{stream_id:d.uid,stats:m})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(i){i.forEach(r=>{let[a,l]=r;l.has(Ee.VIDEO)&&a.videoTrack&&a.videoTrack.getProcessorStats().forEach(d=>{var h;null===(h=this.requestUpload)||void 0===h||h.call(this,d.type,d.stats)}),l.has(Ee.AUDIO)&&a.audioTrack&&a.audioTrack.getProcessorStats().forEach(d=>{var h;null===(h=this.requestUpload)||void 0===h||h.call(this,d.type,d.stats)})})}}function x2(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Xd(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?x2(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):x2(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function M2(s){var i,r,a,l=2;for(typeof Symbol<"u"&&(r=vN,a=Symbol.iterator);l--;){if(r&&null!=(i=s[r]))return i.call(s);if(a&&null!=(i=s[a]))return new B0(i.call(s));r="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function B0(s){function i(r){if(Object(r)!==r)return q.reject(new TypeError(r+" is not an object."));var a=r.done;return q.resolve(r.value).then(function(l){return{value:l,done:a}})}return(B0=function(r){this.s=r,this.n=r.next}).prototype={s:null,n:null,next:function(){return i(this.n.apply(this.s,arguments))},return:function(r){var a=this.s.return;return void 0===a?q.resolve({value:r,done:!0}):i(a.apply(this.s,arguments))},throw:function(r){var a=this.s.return;return void 0===a?q.reject(r):i(a.apply(this.s,arguments))}},new B0(s)}class ci extends zt{get state(){return this._state}set state(i){const r=this._state;this._state=i,this.emit(we.StateChange,r,this._state)}constructor(i,r){var a;super(),a=this,C(this,"store",void 0),C(this,"statsUploader",void 0),C(this,"connection",void 0),C(this,"localTrackMap",new Map),C(this,"remoteUserMap",new Map),C(this,"localDataChannels",[]),C(this,"remoteDataChannelMap",new Map),C(this,"pendingLocalTracks",[]),C(this,"pendingRemoteTracks",[]),C(this,"pendingLocalDataChannels",[]),C(this,"pendingRemoteDataChannels",[]),C(this,"statsCollector",void 0),C(this,"isPlanB",!1),C(this,"shouldForwardP2PCreation",void 0),C(this,"iceFailedCount",0),C(this,"dtlsFailedCount",0),C(this,"mutex",new Zn("P2PChannel-mutex")),C(this,"_state",it.Disconnected),C(this,"_pcStatsUploadType",j("NEW_ICE_RESTART")?Xs.FIRST_CONNECTION:Xs.OLD_FIRST_CONNECTION),C(this,"_isInRestartIce",!1),C(this,"_isStartRestartIce",!1),C(this,"_restartStates",["disconnected","failed"]),C(this,"_restartTimer",void 0),C(this,"_isFirstConnected",!0),C(this,"handleMuteLocalTrack",function(){var l=M(function*(d,h,p){const m=yield a.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!a.connection||a.state!==it.Connected)return void p(new J(x.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const g=a.filterTobeMutedTracks(d);if(0===g.length)return void h();const E=g.find(b=>"videoLowTrack"===b[0]);E&&E[1].track._originMediaStreamTrack.stop(),yield a.connection.muteLocal(g.map(b=>{let[,{id:T}]=b;return T}));const y=a.createMuteMessage(g);yield Et(a,we.RequestMuteLocal,y),h()}catch(g){p(g)}finally{m()}});return function(d,h,p){return l.apply(this,arguments)}}()),C(this,"handleUnmuteLocalTrack",function(){var l=M(function*(d,h,p){const m=yield a.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!a.connection||a.state!==it.Connected)return void p(new J(x.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const g=a.filterTobeUnmutedTracks(d);if(0===g.length)return void h();const E=g.find(b=>"videoLowTrack"===b[0]);if(E){const b=E[1];if(b.track._originMediaStreamTrack.stop(),!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&$e().supportDualStreamEncoding){const T=d._mediaStreamTrack.clone();b.track._mediaStreamTrack=T,b.track._originMediaStreamTrack=T}else{const T=U0(d,uc(a,we.RequestLowStreamParameter));b.track._mediaStreamTrack=T,b.track._originMediaStreamTrack=T}yield new q((T,O)=>{a.handleReplaceTrack(b.track,T,O,!0)})}yield a.connection.unmuteLocal(g.map(b=>{let[,{id:T}]=b;return T}));const y=a.createUnmuteMessage(g);yield Et(a,we.RequestUnmuteLocal,y),h()}catch(g){p(g)}finally{m()}});return function(d,h,p){return l.apply(this,arguments)}}()),C(this,"handleUpdateVideoEncoder",function(){var l=M(function*(d,h,p){const m=yield a.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const g=a.localTrackMap.get(ne.LocalVideoTrack);if(!a.connection||!g||g.track!==d||a.state!==it.Connected)return void h();const{id:E,track:y}=g;yield a.connection.updateSendParameters(E,y),yield a.connection.updateEncoderConfig(E,y),a.emit(we.UpdateVideoEncoder,y),h()}catch(g){p(g)}finally{m()}});return function(d,h,p){return l.apply(this,arguments)}}()),C(this,"handleSetOptimizationMode",function(){var l=M(function*(d,h,p){const m=yield a.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const g=a.localTrackMap.get(ne.LocalVideoTrack);if(!a.connection||!g||g.track!==d||a.state!==it.Connected)return;const{id:E,track:y}=g;yield a.connection.updateSendParameters(E,y),h()}catch(g){p(g)}finally{m()}});return function(d,h,p){return l.apply(this,arguments)}}()),C(this,"handleReplaceTrack",function(){var l=M(function*(d,h,p,m){let g;w.debug("[".concat(a.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(d.getTrackId(),"]")),"boolean"==typeof m&&m||(g=yield a.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var E;const b=Array.from(a.localTrackMap.entries()).find(T=>{let[,{track:O}]=T;return d===O});if(!a.connection||!b||a.state!==it.Connected)return void h();if(yield null===(E=a.connection)||void 0===E?void 0:E.replaceTrack(d,b[1].id),a.isPlanB){const T=b[1];T.id=d._mediaStreamTrack.id,a.localTrackMap.set(b[0],T)}if(b[0]===ne.LocalVideoTrack&&!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&$e().supportDualStreamEncoding){const T=a.localTrackMap.get(ne.LocalVideoLowTrack);if(T){const O=d._mediaStreamTrack.clone();T.track._originMediaStreamTrack.stop(),T.track._mediaStreamTrack=O,T.track._originMediaStreamTrack=O,yield new q((P,D)=>{a.handleReplaceTrack(T.track,P,D,!0)})}}h()}catch(b){p(b)}finally{var y;null===(y=g)||void 0===y||y()}});return function(d,h,p,m){return l.apply(this,arguments)}}()),C(this,"handleGetRTCStats",l=>{l(this.statsCollector.getRTCStats())}),C(this,"handleGetLocalVideoStats",l=>{l(this.statsCollector.getLocalVideoTrackStats())}),C(this,"handleGetLocalAudioStats",l=>{l(this.statsCollector.getLocalAudioTrackStats())}),C(this,"handleGetRemoteVideoStats",l=>this.statsCollector.getRemoteVideoTrackStats(l.uid)[l.uid]),C(this,"handleGetRemoteAudioStats",l=>this.statsCollector.getRemoteAudioTrackStats(l.uid)[l.uid]),this.store=i,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new ai,this.bindStatsUploaderEvents(),this.isPlanB=!$e().supportUnifiedPlan||j("CHROME_FORCE_PLAN_B")&&zs(),this.shouldForwardP2PCreation=j("FORWARD_P2P_CREATION")&&$e().supportPCSetConfiguration&&function(){const l=Wg();return l===Fn.ANDROID||l===Fn.IOS||l===Fn.HARMONY_OS}(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Hn({},this.store):this.isPlanB?new si({},this.store):new Xn({},this.store),this.bindConnectionEvents(this.connection))}startP2PConnection(i,r){var a=this;return M(function*(){var l;a.state=it.New;const d=a.shouldForwardP2PCreation&&"closed"===(null===(l=a.connection)||void 0===l?void 0:l.peerConnectionState);if(a.shouldForwardP2PCreation&&!d||(d&&a.connection&&(w.warning("[".concat(a.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),a.connection.close(),a.unbindConnectionEvents(a.connection)),a.connection=a.store.useDataChannel?new Hn(i,a.store):a.isPlanB?new si(i,a.store):new Xn(i,a.store),a.bindConnectionEvents(a.connection)),!a.connection)throw new J(x.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return a._pcStatsUploadType=j("NEW_ICE_RESTART")?Xs.FIRST_CONNECTION:Xs.OLD_FIRST_CONNECTION,a._isFirstConnected=!0,a._isInRestartIce=!1,a._isStartRestartIce=!1,a.connection.setConfiguration(i),a.connection.establishPromise})()}connect(i,r,a,l,d,h){var p=this;return M(function*(){if(!p.connection)throw new J(x.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");p.connection instanceof Hn?p.connection.updateRemoteConnect(l):(p.store.peerConnectionStart(),yield p.connection.connect(i,r,a,l,d,h),p.statsUploader.startUploadTransportStats(),p.statsUploader.startUploadExtensionUsageStats(),p.state=it.Connected)})()}updateRemoteRTPCapabilities(i){const r=Array.from(this.localTrackMap.entries()).filter(a=>{var l;let[d]=a;return ye(l=[ne.LocalVideoLowTrack,ne.LocalVideoTrack]).call(l,d)}).map(a=>{let[,{id:l}]=a;return l});this.connection instanceof Xn&&this.connection.updateRemoteRTPCapabilities(r,i)}preConnect(i,r,a,l,d,h){var p=this;return M(function*(){if(!p.connection)throw new J(x.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");p.store.peerConnectionStart();const m=yield p.connection.connect(i,r,a,l,d,h);return p.statsUploader.startUploadTransportStats(),p.statsUploader.startUploadExtensionUsageStats(),p.state=it.Connected,m})()}getEstablishParams(){if(this.connection instanceof Hn)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}publishDataChannel(i){var r=this;return M(function*(){if(!r.connection){if(r.state===it.Disconnected)throw new J(x.UNEXPECTED_ERROR,"PeerConnection already disconnected.");const l=i.filter(d=>-1!==r.pendingLocalDataChannels.findIndex(h=>h.id===d.id));return void(r.pendingLocalDataChannels=r.pendingLocalDataChannels.concat(l))}const a=r.filterTobePublishedDataChannels(i);0!==a.length&&(a.forEach(l=>{const d=Date.now();r.store.publish(l.id.toString(),"datachannel",d)}),yield r.connection.createDataChannels(r.store.uid,a),a.forEach(l=>{r.localDataChannels.push(l);const d=Date.now();r.store.publish(l.id+"","datachannel",void 0,d)}))})()}publish(i,r,a){var l=this;return as(function*(){const d=yield ht(l.mutex.lock("From P2PChannel.publish"));try{if(!l.connection||l.state!==it.Connected){if(l.state===it.Disconnected)throw new J(x.UNEXPECTED_ERROR,"PeerConnection already disconnected.");l.throwIfTrackTypeNotMatch(i);const p=i.filter(m=>-1===l.pendingLocalTracks.indexOf(m));return void(l.pendingLocalTracks=l.pendingLocalTracks.concat(p))}l.store.pubId=l.store.pubId+1,Di.markPublishStart(l.store.clientId,l.store.pubId);const h=l.filterTobePublishedTracks(i,r,a);if(0===h.length)return void(yield ht(l.tryToUnmuteAudio(i)));yield*sm(M2(l.doPublish(l.connection,h)))}finally{d()}})()}doPublish(i,r){var a=this;return as(function*(){r.forEach(E=>{let{track:y,type:b}=E;const T=Date.now();a.store.publish(y.getTrackId(),b===ne.LocalAudioTrack?"audio":"video",T)}),a.bindLocalTrackEvents(r);const l=yield ht(i.send(r.map(E=>{let{track:y}=E;return y}),a.store.codec,a.store.audioCodec)),d=(yield ht(l.next())).value,h=a.createGatewayPublishMessage(r,d);let p;try{p=yield h}catch(E){throw l.throw(E),E?.code===x.WS_ABORT&&r.forEach(y=>{let{track:b}=y;-1===a.pendingLocalTracks.indexOf(b)&&a.pendingLocalTracks.push(b)}),a.unbindLocalTrackEvents(r),E}const m=a.mapPubResToRemoteConfig(h,p),g=(yield ht(l.next(m))).value;r.forEach(E=>{let{type:y}=E;a.statsCollector.addLocalStats(y)}),a.assignLocalTracks(r,g),a.statsUploader.startUploadUplinkStats(),r.forEach(E=>{let{track:y,type:b}=E;const T=Date.now();a.store.publish(y.getTrackId(),b===ne.LocalAudioTrack?"audio":"video",void 0,T)})})()}updateVideoStreamParameter(i,r){var a=this;return M(function*(){const l=a.localTrackMap.get(r);if(!l)return;if(!(l.track instanceof ze))return w.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(a.connection instanceof Xn||a.connection instanceof si))return w.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:d}=l,h=function(p,m){const g={};return p.height&&p.width&&(g.scaleResolutionDownBy=c0(p,m)),g.maxFramerate=p.framerate?Cr(p.framerate):void 0,g.maxBitrate=p.bitrate?1e3*p.bitrate:void 0,g}(i,d);if(d._encoderConfig||(d._encoderConfig={}),r!==ne.LocalVideoLowTrack||!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&$e().supportDualStreamEncoding)null!=h.scaleResolutionDownBy&&(d._encoderConfig.scaleResolutionDownBy=h.scaleResolutionDownBy);else{const p=d._originMediaStreamTrack;if(!p.canvas)return w.warn("[".concat(d.getTrackId(),"] no canvas on track"));!function(m,g){const E=m.canvas;g.width&&(E.width=Cr(g.width)),g.height&&(E.height=Cr(g.height)),g.framerate&&(E.stopCapture&&E.stopCapture(),E.stopCapture=OE(()=>{!E.startCapture&&E.stopCapture&&E.stopCapture(),E.startCapture&&E.startCapture()},Cr(g.framerate)))}(p,i)}null!=h.maxBitrate&&(d._encoderConfig.bitrateMax=h.maxBitrate/1e3),null!=h.maxFramerate&&(d._encoderConfig.frameRate&&"object"==typeof d._encoderConfig.frameRate?d._encoderConfig.frameRate.max=h.maxFramerate:d._encoderConfig.frameRate={max:h.maxFramerate}),w.debug("[".concat(d.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(d._encoderConfig))),yield a.connection.updateRtpSenderEncodings(d)})()}publishLowStream(i){var r=this;return as(function*(){if(!r.connection||r.state!==it.Connected)return;const a=yield ht(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const d=r.localTrackMap.get(ne.LocalVideoTrack);if(!d)throw new J(x.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(ne.LocalVideoLowTrack))throw new J(x.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const h=[{track:r.getLowVideoTrack(d.track,i),type:ne.LocalVideoLowTrack}];if(yield*sm(M2(r.doPublish(r.connection,h))),d.track.muted||!d.track.enabled){var l;const p=null===(l=r.localTrackMap.get(ne.LocalVideoLowTrack))||void 0===l?void 0:l.id;void 0!==p&&(yield ht(r.connection.muteLocal([p])))}}finally{a()}})()}republish(){var i=this;return M(function*(){i.pendingLocalTracks.length>0&&(w.debug("[".concat(i.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield Jt(i,we.RequestRePublish,i.pendingLocalTracks),i.emit(we.MediaReconnectEnd,i.store.uid),i.pendingLocalTracks=[]),i.pendingLocalDataChannels.length>0&&(w.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),yield Jt(i,we.RequestRePublishDataChannel,i.pendingLocalDataChannels),i.pendingLocalDataChannels=[])})()}reSubscribe(i){var r=this;return M(function*(){for(let a=r.pendingRemoteTracks.length-1;a>=0;a--){const{user:l,kind:d}=r.pendingRemoteTracks[a];(d!==Ee.AUDIO||l._audio_added_&&l._audioSSRC)&&(d!==Ee.VIDEO||l._video_added_&&l._videoSSRC)||r.pendingRemoteTracks.splice(a,1)}if(i)yield Jt(r,we.RequestReSubscribe,r.pendingRemoteTracks);else for(const{user:a,kind:l}of r.pendingRemoteTracks)yield r.subscribe(a,l,l===Ee.VIDEO?a._videoSSRC:a._audioSSRC);r.pendingRemoteTracks.forEach(a=>{let{user:l}=a;r.emit(we.MediaReconnectEnd,l.uid)}),r.pendingRemoteTracks=[]})()}unpublish(i){var r=this;return M(function*(){if(!r.connection||r.state!==it.Connected)return void i.forEach(d=>{const h=r.pendingLocalTracks.indexOf(d);-1!==h&&r.pendingLocalTracks.splice(h,1)});const a=r.filterTobeUnpublishedTracks(i);if(0===a.length)return;const l=a.find(d=>"videoLowTrack"===d[0]);return l&&l[1].track.close(),r.doUnpublish(r.connection,a)})()}unpublishDataChannel(i){var r=this;return M(function*(){if(!r.connection||r.state!==it.Connected)return void i.forEach(l=>{const d=r.pendingLocalDataChannels.indexOf(l);-1!==d&&r.pendingLocalDataChannels.splice(d,1)});const a=r.filterTobeUnpublishedDataChannels(i);return 0!==a.length?(a.forEach(l=>{const d=r.localDataChannels.indexOf(l);-1!==d&&r.localDataChannels.splice(d,1)}),0===r.localDataChannels.length&&(yield r.connection.stopDataChannels(r.store.uid)),a.map(l=>l.id)):void 0})()}unpublishLowStream(){var i=this;return M(function*(){if(!i.connection||i.state!==it.Connected)return;const r=i.localTrackMap.get(ne.LocalVideoLowTrack);return r?(r.track.close(),i.doUnpublish(i.connection,[[ne.LocalVideoLowTrack,r]])):void 0})()}doUnpublish(i,r){var a=this;return M(function*(){const l=a.createGatewayUnpublishMessage(r);return yield i.stopSending(r.map(d=>{let[,{id:h}]=d;return h})),a.withdrawLocalTracks(r),a.unbindLocalTrackEvents(r.map(d=>{let[h,{track:p}]=d;return{type:h,track:p}})),r.forEach(d=>{let[h]=d;a.statsCollector.removeLocalStats(h)}),0===a.localTrackMap.size&&a.statsUploader.stopUploadUplinkStats(),l})()}subscribeDataChannel(i,r){var a=this;return M(function*(){if(!a.connection||a.state!==it.Connected)throw new J(x.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const l=r.filter(d=>{var h;return!(null!==(h=a.remoteDataChannelMap.get(i))&&void 0!==h&&h.get(d.id))});if(0!==l.length)return yield a.connection.createDataChannels(i.uid,l),l.forEach(d=>{var h;a.remoteDataChannelMap.has(i)?null===(h=a.remoteDataChannelMap.get(i))||void 0===h||h.set(d.id,d):a.remoteDataChannelMap.set(i,new Map([[d.id,d]]));const p=a.pendingRemoteDataChannels.findIndex(m=>{let{user:g,id:E}=m;return g.uid===i.uid&&E===d.id});-1!==p&&a.pendingRemoteDataChannels.splice(p,1)}),l.map(d=>d.id)})()}subscribe(i,r,a,l,d){var h=this;return M(function*(){var p;if(!h.connection||h.state!==it.Connected)throw new J(x.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(p=h.remoteUserMap.get(i))&&void 0!==p&&p.has(r))return;let m,g,E;if(d){const T=d.find(P=>{let{stream_type:D}=P;return D===r});if(!T)throw new J(x.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(i.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const O=yield h.connection.receive(r,T.ssrcs,String(i._uintid),T.attributes);h.connection instanceof Xn&&(E=O.transceiver),m=O.track,g=O.id}else{const T=yield h.connection.receive(r,[{ssrcId:a,rtx:l}],String(i._uintid),void 0);h.connection instanceof Xn&&(E=T.transceiver),m=T.track,g=T.id}r===Ee.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(m):(i._audioTrack=new Co(m,i.uid,i._uintid,h.store),w.info("[".concat(h.store.clientId,"] [").concat(h.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),E&&i._audioTrack._updateRtpTransceiver(E),h.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(m):(i._videoTrack=new Cs(m,i.uid,i._uintid,h.store),w.info("[".concat(h.store.clientId,"] [").concat(h.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),E&&i._videoTrack._updateRtpTransceiver(E),h.bindRemoteTrackEvents(i,i._videoTrack));const y=h.remoteUserMap.get(i);y?y.set(r,g):h.remoteUserMap.set(i,new Map([[r,g]])),h.statsCollector.addRemoteStats(i.uid),h.statsUploader.startUploadDownlinkStats();const b=h.pendingRemoteTracks.findIndex(T=>{let{user:O,kind:P}=T;return O.uid===i.uid&&r===P});-1!==b&&(h.pendingRemoteTracks.splice(b,1),h.emit(we.MediaReconnectEnd,i.uid))})()}massSubscribe(i){var r=this;return M(function*(){return r.massSubscribeNoLock(i)})()}massSubscribeNoLock(i){var r=this;return M(function*(){if(!r.connection||r.state!==it.Connected)throw new J(x.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");i=i.filter(l=>{var d;let{user:h,mediaType:p}=l;return!(null!==(d=r.remoteUserMap.get(h))&&void 0!==d&&d.has(p))});const a=yield r.connection.batchReceive(i.map(l=>{let{user:d,mediaType:h,ssrcId:p,rtxSsrcId:m}=l;return{kind:h,ssrcMsg:[{ssrcId:p,rtx:m}],mslabel:String(d._uintid)}}));i.forEach((l,d)=>{let{user:h,mediaType:p}=l;const{track:m,id:g,transceiver:E}=a[d];p===Ee.AUDIO?(h._audioTrack?h._audioTrack._updateOriginMediaStreamTrack(m):(h._audioTrack=new Co(m,h.uid,h._uintid,r.store),w.info("[".concat(r.store.clientId,"] [").concat(r.store.p2pId,"] create remote audio track: ").concat(h._audioTrack.getTrackId()))),E&&h._audioTrack._updateRtpTransceiver(E),r.bindRemoteTrackEvents(h,h._audioTrack)):(h._videoTrack?h._videoTrack._updateOriginMediaStreamTrack(m):(h._videoTrack=new Cs(m,h.uid,h._uintid,r.store),w.info("[".concat(r.store.clientId,"] [").concat(r.store.p2pId,"] create remote video track: ").concat(h._videoTrack.getTrackId()))),E&&h._videoTrack._updateRtpTransceiver(E),r.bindRemoteTrackEvents(h,h._videoTrack));const y=r.remoteUserMap.get(h);y?y.set(p,g):r.remoteUserMap.set(h,new Map([[p,g]])),r.statsCollector.addRemoteStats(h.uid),r.statsUploader.startUploadDownlinkStats();const b=r.pendingRemoteTracks.findIndex(T=>{let{user:O,kind:P}=T;return O.uid===h.uid&&p===P});-1!==b&&(r.pendingRemoteTracks.splice(b,1),r.emit(we.MediaReconnectEnd,h.uid))})})()}unsubscribe(i,r,a){var l=this;return M(function*(){const d=l.pendingRemoteTracks.filter(m=>{let{user:g,kind:E}=m;return void 0!==r?g.uid===i.uid&&r===E:g.uid===i.uid});if(d.forEach(m=>{const g=l.pendingRemoteTracks.indexOf(m);l.pendingRemoteTracks.splice(g,1)}),l.connection&&l.state===it.Connected||a||d.forEach(m=>{let{kind:g}=m;var E;if(g===Ee.AUDIO)null===(E=i._audioTrack)||void 0===E||E._destroy(),i._audioTrack=void 0;else if(g===Ee.VIDEO){var y;null===(y=i._videoTrack)||void 0===y||y._destroy(),i._videoTrack=void 0}}),!l.connection||l.state!==it.Connected)return;const h=l.filterTobeUnSubscribedTracks(i,r);if(0===h.length)return;yield l.connection.stopReceiving(h.map(m=>{let[,{id:g}]=m;return g}));const p=l.createUnsubscribeMessage(h);return l.withdrawRemoteTracks(h),0===l.remoteUserMap.size&&l.statsUploader.stopUploadDownlinkStats(),h.forEach(m=>{let[g,{kind:E}]=m;var y,b;if(E===Ee.VIDEO&&g._videoSSRC&&(null===(y=l.connection)||void 0===y||y.setStatsRemoteVideoIsReady(g._videoSSRC,!1)),E===Ee.VIDEO)l.unbindRemoteTrackEvents(g._videoTrack),a||(null===(b=g._videoTrack)||void 0===b||b._destroy(),g._videoTrack=void 0);else if(E===Ee.AUDIO){var T;l.unbindRemoteTrackEvents(g._audioTrack),!a&&(null===(T=g._audioTrack)||void 0===T||T._destroy(),g._audioTrack=void 0)}}),p})()}unsubscribeDataChannel(i,r){var a=this;return M(function*(){if(r.forEach(h=>{const p=a.pendingRemoteDataChannels.findIndex(m=>m.id===h.id);-1!==p&&a.pendingRemoteDataChannels.splice(p,1)}),!a.connection)return;const l=a.filterTobeUnSubscribedDataChannels(i,r);if(0===l.length)return;r.forEach(h=>{h._close()});const d=a.remoteDataChannelMap.get(i);return l.forEach(h=>{d&&d.delete(h.id)}),d&&0===d.size&&(a.remoteDataChannelMap.delete(i),yield a.connection.stopDataChannels(i.uid)),l.map(h=>h.id)})()}massUnsubscribe(i){var r=this;return M(function*(){return r.massUnsubscribeNoLock(i)})()}massUnsubscribeNoLock(i){var r=this;return M(function*(){let a=[];for(const{user:h,mediaType:p}of i){const m=r.pendingRemoteTracks.filter(g=>{let{user:E,kind:y}=g;return void 0!==p?E.uid===h.uid&&p===y:E.uid===h.uid});m.forEach(g=>{const E=r.pendingRemoteTracks.indexOf(g);r.pendingRemoteTracks.splice(E,1)}),a=a.concat(m)}if(!r.connection||r.state!==it.Connected)return void a.forEach(h=>{let{user:p,kind:m}=h;var g;if(m===Ee.AUDIO)null===(g=p._audioTrack)||void 0===g||g._destroy(),p._audioTrack=void 0;else if(m===Ee.VIDEO){var E;null===(E=p._videoTrack)||void 0===E||E._destroy(),p._videoTrack=void 0}});const l=ll(i).call(i,(h,p)=>{let{user:m,mediaType:g}=p;const E=r.filterTobeUnSubscribedTracks(m,g);return h.concat(E)},[]);if(0===l.length)return;yield r.connection.stopReceiving(l.map(h=>{let[,{id:p}]=h;return p}));const d=r.createUnsubscribeAllMessage(l);return r.withdrawRemoteTracks(l),0===r.remoteUserMap.size&&r.statsUploader.stopUploadDownlinkStats(),l.forEach(h=>{let[p,{kind:m}]=h;var g,E;if(m===Ee.VIDEO&&p._videoSSRC&&(null===(g=r.connection)||void 0===g||g.setStatsRemoteVideoIsReady(p._videoSSRC,!1)),m===Ee.VIDEO)r.unbindRemoteTrackEvents(p._videoTrack),null===(E=p._videoTrack)||void 0===E||E._destroy(),p._videoTrack=void 0;else if(m===Ee.AUDIO){var y;r.unbindRemoteTrackEvents(p._audioTrack),null===(y=p._audioTrack)||void 0===y||y._destroy(),p._audioTrack=void 0}}),d})()}muteRemote(i,r){var a=this;return M(function*(){if(!a.connection)return;const l=a.remoteUserMap.get(i);if(!l)return void w.warning("[".concat(a.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(i.uid,"."));if(!l.get(r))return void w.warning("[".concat(a.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(i.uid," media type ").concat(r,"."));const d=r===Ee.VIDEO?i._videoSSRC:i._audioSSRC;void 0!==d&&a.connection.setStatsRemoteVideoIsReady(d,!1)})()}unmuteRemote(i,r){var a=this;return M(function*(){return a.unmuteRemoteNoLock(i,r)})()}unmuteRemoteNoLock(i,r){var a=this;return M(function*(){if(!a.connection)return;const l=a.remoteUserMap.get(i);l?l.get(r)||w.warning("[".concat(a.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(i.uid," media type ").concat(r,".")):w.warning("[".concat(a.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(i.uid,"."))})()}getAllTracks(i){const r=this.localTrackMap.get(ne.LocalAudioTrack);if(r?.track instanceof wn){const a=r.track;return Array.from(this.localTrackMap.entries()).filter(l=>{let[d]=l;return d!==ne.LocalAudioTrack}).filter(l=>{let[d]=l;return!(i&&d===ne.LocalVideoLowTrack)}).map(l=>{let[,{track:d}]=l;return d}).concat(a.trackList)}return Array.from(this.localTrackMap.entries()).filter(a=>{let[l]=a;return!(i&&l===ne.LocalVideoLowTrack)}).map(a=>{let[,{track:l}]=a;return l})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(i,r,a,l,d){if(i){const p=this.localTrackMap.get(ne.LocalAudioTrack),m=this.localTrackMap.get(l?ne.LocalVideoLowTrack:ne.LocalVideoTrack);Se.publish(this.store.sessionId,{eventElapse:Di.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:i,ec:r,audioName:p?.track.getTrackLabel(),videoName:m?.track.getTrackLabel(),screenshare:-1!==m?.track._hints.indexOf(Ot.SCREEN_TRACK),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}else{var h;a||(a=[]);const p=a.find(g=>g instanceof mt),m=l?null===(h=this.localTrackMap.get(ne.LocalVideoTrack))||void 0===h?void 0:h.track:a.find(g=>g instanceof ze);Se.publish(this.store.sessionId,{eventElapse:Di.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:i,ec:r,audioName:p?.getTrackLabel(),videoName:m?.getTrackLabel(),screenshare:-1!==m?._hints.indexOf(Ot.SCREEN_TRACK),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}}reportSubscribeEvent(i,r,a,l){const d=l===Ee.VIDEO?a._videoSSRC:a._audioSSRC;d&&Se.subscribe(this.store.sessionId,{succ:i,ec:r,video:l===Ee.VIDEO,audio:l===Ee.AUDIO,peerid:a.uid,subscribeRequestid:l===Ee.VIDEO?a._videoSSRC:a._audioSSRC,p2pid:this.store.p2pId,eventElapse:Di.measureFromSubscribeStart(this.store.clientId,d)})}reset(){w.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Zn("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Hn({},this.store):this.isPlanB?new si({},this.store):new Xn({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const i=this.localTrackMap.get(ne.LocalAudioTrack);if(i?.track instanceof wn){if(i.track.trackList.length>0){const r=i.track;i.track.trackList.forEach(a=>{r.removeAudioTrack(a)})}i.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=it.Disconnected}getStats(){var i;return null===(i=this.connection)||void 0===i?void 0:i.getStats()}getRemoteVideoIsReady(i){var r;return(null===(r=this.connection)||void 0===r?void 0:r.getRemoteVideoIsReady(i))||!1}getLocalAudioVolume(){const i=this.localTrackMap.get(ne.LocalAudioTrack);if(i)return i.track.getVolumeLevel()}getLocalVideoSize(){const i=this.localTrackMap.get(ne.LocalVideoTrack);if(i)return{width:i.track._videoWidth||0,height:i.track._videoHeight||0}}getEncoderConfig(i){const r=this.localTrackMap.get(i);return r&&r.track instanceof ze||r&&r.track instanceof mt?r.track._encoderConfig:void 0}getLocalMedia(i){return this.localTrackMap.get(i)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(i,r){if(!i)return this.remoteUserMap.size>0;const a=this.remoteUserMap.get(i);return!!a&&(!r||a.has(r))}hasRemoteMediaWithLock(i,r){var a=this;return M(function*(){if(!i)return a.remoteUserMap.size>0;const l=a.remoteUserMap.get(i);return!!l&&(!r||l.has(r))})()}getRemoteMedia(i){var r;const a=Array.from(zr(r=this.remoteUserMap).call(r)).find(l=>l.uid===i);return a?{audioTrack:a.audioTrack,audioSSRC:a._audioSSRC,videoTrack:a.videoTrack,videoSSRC:a._videoSSRC}:{}}getAudioLevels(){let i=Array.from(this.remoteUserMap.entries()).map(a=>{let[l]=a;return{uid:l.uid,level:l.audioTrack?100*l.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(ne.LocalAudioTrack);return r&&i.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),i=tl(i).call(i,(a,l)=>a.level-l.level),i}disconnectForReconnect(){var i=this;return M(function*(){i.connection&&(w.debug("[".concat(i.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),i.state=it.Reconnecting,j("KEEP_LAST_FRAME")&&0!==i.remoteUserMap.size&&Array.from(i.remoteUserMap.entries()).forEach(r=>{let[a]=r;var l;a._videoTrack&&a._videoTrack._player&&(null===(l=a._videoTrack._player.getVideoElement())||void 0===l||l.pause(),a._videoTrack._player.isKeepLastFrame=!0,a._videoTrack._originMediaStreamTrack.stop())}),i.connection.close(),i.unbindConnectionEvents(i.connection),i.connection=void 0,i.shouldForwardP2PCreation&&(i.connection=i.store.useDataChannel?new Hn({},i.store):i.isPlanB?new si({},i.store):new Xn({},i.store),i.bindConnectionEvents(i.connection)),0!==i.localTrackMap.size&&(Array.from(i.localTrackMap.entries()).forEach(r=>{var a;let[l,{track:d}]=r;switch(l){case ne.LocalVideoTrack:ye(a=d._hints).call(a,Ot.LOW_STREAM)?d.close():i.pendingLocalTracks.push(d);break;case ne.LocalAudioTrack:d instanceof wn?i.pendingLocalTracks=i.pendingLocalTracks.concat(d.trackList):i.pendingLocalTracks.push(d)}}),i.emit(we.MediaReconnectStart,i.store.uid)),i.unbindLocalTrackEvents(),i.localTrackMap.clear(),0!==i.remoteUserMap.size&&Array.from(i.remoteUserMap.entries()).forEach(r=>{let[a,l]=r;Array.from(zr(l).call(l)).forEach(d=>{i.setPendingRemoteMedia(a,d)}),i.emit(we.MediaReconnectStart,a.uid)}),i.unbindAllRemoteTrackEvents(),i.remoteUserMap.clear(),0!==i.localDataChannels.length&&(i.localDataChannels.forEach(r=>{i.pendingLocalDataChannels.push(r)}),i.localDataChannels.length=0),0!==i.remoteDataChannelMap.size&&(Array.from(i.remoteDataChannelMap.entries()).forEach(r=>{let[a,l]=r;Array.from(zr(l).call(l)).forEach(d=>{i.setPendingRemoteDataChannel(a,d)})}),i.remoteDataChannelMap.clear()),i.statsUploader.stopUploadUplinkStats(),i.statsUploader.stopUploadDownlinkStats(),i.statsUploader.stopUploadTransportStats(),w.debug("[".concat(i.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))})()}hasPendingRemoteDataChannel(i,r){for(const a of this.pendingRemoteDataChannels){const{user:l,id:d}=a;if((i instanceof Oi?i.uid:i)===l.uid&&d===r)return!0}return!1}setPendingRemoteDataChannel(i,r){this.hasPendingRemoteDataChannel(i,r)||this.pendingRemoteDataChannels.push({user:i,id:r})}hasPendingRemoteMedia(i,r){for(const a of this.pendingRemoteTracks){const{user:l,kind:d}=a;if((i instanceof Oi?i.uid:i)===l.uid&&r===d)return!0}return!1}setPendingRemoteMedia(i,r){this.hasPendingRemoteMedia(i,r)||this.pendingRemoteTracks.push({user:i,kind:r})}restartICE(i){var r=this;return as(function*(){if(!r.connection||r.state!==it.Connected||r.connection instanceof Hn)return;const a=yield ht(r.mutex.lock("From P2PChannel.restartICE"));let l;try{l=yield ht(r.connection.restartICE(i));const h=yield ht(l.next());if(h.done)return;const p=h.value,m=yield p;switch(r.reportPCDisconnectedOrFailed(i),i){case wi.TCP:r._pcStatsUploadType=Xs.TCP_RESTART;break;case wi.RELAY:r._pcStatsUploadType=Xs.RELAY_RESTART;break;default:r._pcStatsUploadType=Xs.OLD_RESTART}r._isInRestartIce=!0,l.next(m)}catch(h){var d;null===(d=l)||void 0===d||d.throw(h)}finally{a()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const i=this.connection.getStats(),r=this.localTrackMap.get(ne.LocalVideoTrack),a=this.localTrackMap.get(ne.LocalAudioTrack),l=i.videoSend.find(O=>O.ssrc===r?.ssrcs[0].ssrcId),d=i.audioSend.find(O=>O.ssrc===a?.ssrcs[0].ssrcId);if(!l||!d)return 1;const h=gr(this,we.NeedSignalRTT),p=l?l.rttMs:void 0,m=d?d.rttMs:void 0,g=p&&m?(p+m)/2:p||m,y=100*i.sendPacketLossRate*.7/50+.3*((g&&h?(g+h)/2:g||h)||0)/1500,b=y<.17?1:y<.36?2:y<.59?3:y<.1?4:5,T=r?.track;if(T&&T._encoderConfig&&-1===T._hints.indexOf(Ot.SCREEN_TRACK)){const O=T._encoderConfig.bitrateMax,P=i.bitrate.actualEncoded;if(O&&P){const D=(1e3*O-P)/(1e3*O);return ND[D<.15?0:D<.3?1:D<.45?2:D<.6?3:4][b]}}return b}getDownlinkNetworkQuality(){if(!this.connection)return 0;const i=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(a=>{let[l]=a;const d=l._audioSSRC,h=l._videoSSRC,p=i.audioRecv.find(P=>P.ssrc===d),m=i.videoRecv.find(P=>P.ssrc===h);if(!p&&!m)return void(r+=1);const g=gr(this,we.NeedSignalRTT),E=i.rtt,y=(E&&g?(E+g)/2:E||g)||0,b=p?p.jitterMs:void 0,T=i.recvPacketLossRate;let O=.7*T*100/50+.3*y/1500;b&&(O=.6*T*100/50+.2*y/1500+.2*b/400),r+=O<.1?1:O<.17?2:O<.36?3:O<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}muteLocalTrack(i){var r=this;return M(function*(){return new q((a,l)=>{r.handleMuteLocalTrack(i,a,l)})})()}filterTobePublishedTracks(i,r,a){const l=[],d=$e(),h=this.getAllTracks();i=lh(i=i.filter(g=>-1===h.indexOf(g)));let p=!1,m=!1;for(const g of i){if(g instanceof ze&&(this.localTrackMap.has(ne.LocalVideoTrack)||p?new J(x.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(l.push({track:g,type:ne.LocalVideoTrack}),p=!0),r)){const E=this.getLowVideoTrack(g,a);l.push({track:E,type:ne.LocalVideoLowTrack})}if(g instanceof mt){const E=this.localTrackMap.get(ne.LocalAudioTrack);if(E){if(!(E.track instanceof wn))throw new J(x.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new J(x.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0)}else if(m){const y=l.find(b=>{let{type:T}=b;return T===ne.LocalAudioTrack});if(!(y.track instanceof wn))throw new J(x.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new J(x.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");y.track.addAudioTrack(g)}else{if(!d.webAudioMediaStreamDest||g instanceof wn||g._bypassWebAudio)l.push({track:g,type:ne.LocalAudioTrack});else{const y=new wn;y.addAudioTrack(g),l.push({track:y,type:ne.LocalAudioTrack})}m=!0}}}return l}filterTobeUnpublishedTracks(i){const r=[],a=this.getAllTracks();i=lh(i=i.filter(l=>-1!==a.indexOf(l)));for(const l of i){if(l instanceof mt){const d=this.localTrackMap.get(ne.LocalAudioTrack);if(!d)continue;d.track instanceof wn?(d.track.removeAudioTrack(l),this.unbindLocalAudioTrackEvents(l),0===d.track.trackList.length&&(r.push([ne.LocalAudioTrack,d]),d.track.close())):r.push([ne.LocalAudioTrack,d])}if(l instanceof ze){const d=this.localTrackMap.get(ne.LocalVideoTrack);if(!d)continue;r.push([ne.LocalVideoTrack,d]);const h=this.localTrackMap.get(ne.LocalVideoLowTrack);h&&r.push([ne.LocalVideoLowTrack,h])}}return r}filterTobePublishedDataChannels(i){return(i=lh(i)).filter(r=>-1===this.localDataChannels.findIndex(a=>a.id===r.id))}filterTobeUnpublishedDataChannels(i){return(i=(i=lh(i)).filter(r=>-1!==this.localDataChannels.indexOf(r))).filter(r=>r._originDataChannel)}bindLocalTrackEvents(i){i.forEach(r=>{let{track:a,type:l}=r;switch(l){case ne.LocalVideoTrack:a.addListener(me.GET_STATS,this.handleGetLocalVideoStats),a.addListener(me.GET_RTC_STATS,this.handleGetRTCStats),a.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.addListener(me.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),a.addListener(me.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),a.addListener(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),a.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.bindLocalAudioTrackEvents(a)}})}bindLocalAudioTrackEvents(i,r){i instanceof wn?i.trackList.forEach(a=>{a.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.addListener(me.GET_STATS,this.handleGetLocalAudioStats),a.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(i.addListener(me.GET_STATS,this.handleGetLocalAudioStats),i.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||i.addListener(me.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(i){i||(i=Array.from(this.localTrackMap.entries()).map(r=>{let[a,{track:l}]=r;return{track:l,type:a}})),i.forEach(r=>{let{track:a,type:l}=r;switch(l){case ne.LocalVideoTrack:a.off(me.GET_STATS,this.handleGetLocalVideoStats),a.off(me.GET_RTC_STATS,this.handleGetRTCStats),a.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.off(me.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),a.off(me.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),a.off(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),a.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.unbindLocalAudioTrackEvents(a)}})}unbindLocalAudioTrackEvents(i){i instanceof wn?i.trackList.forEach(r=>{r.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(me.GET_STATS,this.handleGetLocalAudioStats),r.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(i.off(me.GET_STATS,this.handleGetLocalAudioStats),i.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(i,r){r instanceof Cs&&r.addListener(me.GET_STATS,a=>{a(this.handleGetRemoteVideoStats(i))}),r instanceof Co&&r.addListener(me.GET_STATS,a=>{a(this.handleGetRemoteAudioStats(i))})}unbindRemoteTrackEvents(i){i&&i.removeAllListeners(me.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(i=>{let[r,a]=i;a.has(Ee.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),a.has(Ee.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(i,r){return i.map((a,l)=>{var d;let h,p,{track:m,type:g}=a;switch(g){case ne.LocalAudioTrack:h=It.Audio,p={dtx:m instanceof Rd&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ne.LocalVideoTrack:h=ye(d=m._hints).call(d,Ot.SCREEN_TRACK)?It.Screen:It.High,p=Xd(Xd({},Gd(m)),{},{codec:this.store.codec});break;case ne.LocalVideoLowTrack:h=It.Low,p=Xd(Xd({},Gd(m)),{},{codec:this.store.codec})}return{stream_type:h,attributes:p,ssrcs:r[l]}})}createGatewayUnpublishMessage(i){return i.map(r=>{var a;let l,[d,{track:h,ssrcs:p,id:m}]=r;switch(d){case ne.LocalVideoTrack:l=ye(a=h._hints).call(a,Ot.SCREEN_TRACK)?It.Screen:It.High;break;case ne.LocalAudioTrack:l=It.Audio;break;case ne.LocalVideoLowTrack:l=It.Low}return{stream_type:l,ssrcs:p,mid:m}})}assignLocalTracks(i,r){i.forEach((a,l)=>{let{track:d,type:h}=a;this.localTrackMap.set(h,{track:d,id:r[l].id,ssrcs:r[l].localSSRC})})}withdrawLocalTracks(i){i.forEach(r=>{let[a]=r;this.localTrackMap.delete(a)})}bindConnectionEvents(i){var r=this;i.onConnectionStateChange=function(){var a=M(function*(l){if(w.info("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(l,")")),r.emit(we.PeerConnectionStateChange,l),"connected"!==l||r.store.keyMetrics.peerConnectionEnd||r.store.peerConnectionEnd(),"connected"===l&&(r._restartTimer&&(clearTimeout(r._restartTimer),r._restartTimer=void 0),(r._isFirstConnected||r._isInRestartIce)&&r.reportPCStats(Date.now(),!0,r._pcStatsUploadType),r._isInRestartIce=!1,r._isFirstConnected=!1,r._isStartRestartIce=!1),j("NEW_ICE_RESTART")){var d;if(ye(d=r._restartStates).call(d,l)){if(r._isStartRestartIce)return;r._isStartRestartIce=!0;const h=g=>{("disconnected"===i.iceConnectionState||"checking"===i.iceConnectionState||"failed"===i.iceConnectionState)&&(w.debug("[".concat(r.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(g)),"CONNECTED"===gr(r,we.QueryClientConnectionState)&&r.emit(we.RequestRestartICE,g))},p=()=>{"disconnected"!==i.iceConnectionState&&"checking"!==i.iceConnectionState&&"failed"!==i.iceConnectionState||(r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),w.debug("[".concat(r.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>r.emit(we.P2PLost),0),r.iceFailedCount+=1,r.requestReconnect())},m=j("ICE_RESTART_INTERVAL");return void(r._restartTimer=window.setTimeout(()=>{if(j("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&$e().supportPCSetConfiguration)h(wi.RELAY),r._restartTimer=window.setTimeout(p,m);else if(Wt())h(wi.UDP),r._restartTimer=window.setTimeout(p,4e3);else{if(h(wi.TCP),$e().supportPCSetConfiguration)return void(r._restartTimer=window.setTimeout(()=>{h(wi.RELAY),r._restartTimer=window.setTimeout(p,m)},m));r._restartTimer=window.setTimeout(p,m)}},800))}}else{if("disconnected"===l&&"disconnected"===i.iceConnectionState)return setTimeout(()=>{"disconnected"===i.iceConnectionState&&j("ICE_RESTART")&&"CONNECTED"===gr(r,we.QueryClientConnectionState)&&r.emit(we.RequestRestartICE)},800),void setTimeout(()=>{"disconnected"===i.peerConnectionState&&(w.debug("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),r._isInRestartIce=!1,setTimeout(()=>r.emit(we.P2PLost),0),r.iceFailedCount+=1,r.requestReconnect())},4e3);"failed"===l&&(w.debug("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection state failed, force reconnect")),r.reportPCDisconnectedOrFailed(),setTimeout(()=>r.emit(we.P2PLost),0),r.iceFailedCount+=1,yield r.requestReconnect())}});return function(l){return a.apply(this,arguments)}}(),i.onICEConnectionStateChange=a=>{"connected"!==a||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(a,")")),Se.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:a,tag:Xt.TRACER}).onSuccess(),this.emit(we.IceConnectionStateChange,a)},i.onICETransportStateChange=a=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(a,")"))},i.onDTLSTransportStateChange=a=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(a,")"))},i.onDTLSTransportError=a=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(a,")"))},i.onFirstAudioDecoded=a=>{var l;const d=Array.from(zr(l=this.remoteUserMap).call(l)).find(p=>p._audioSSRC===a);var h;d&&(this.store.subscribe(d.uid,"audio",void 0,void 0,void 0,Date.now()),null===(h=d.audioTrack)||void 0===h||h.emit(Cd.FIRST_FRAME_DECODED),Se.firstRemoteFrame(this.store.sessionId,Kn.FIRST_AUDIO_DECODE,qt.FIRST_AUDIO_DECODE,{peer:d._uintid,subscribeElapse:Di.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId}))},i.onFirstAudioReceived=a=>{var l;const d=Array.from(zr(l=this.remoteUserMap).call(l)).find(h=>h._audioSSRC===a);d&&Se.firstRemoteFrame(this.store.sessionId,Kn.FIRST_AUDIO_RECEIVED,qt.FIRST_AUDIO_RECEIVED,{peer:d._uintid,subscribeElapse:Di.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId})},i.onFirstVideoDecoded=(a,l,d)=>{this.reportVideoFirstFrameDecoded(a,l,d)},i.onFirstVideoReceived=a=>{var l;const d=Array.from(zr(l=this.remoteUserMap).call(l)).find(h=>h._videoSSRC===a);d&&Se.firstRemoteFrame(this.store.sessionId,Kn.FIRST_VIDEO_RECEIVED,qt.FIRST_VIDEO_RECEIVED,{peer:d._uintid,subscribeElapse:Di.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId})},i.onSelectedLocalCandidateChanged=(a,l)=>{const d="relay"===a.candidateType;"unknown"!==l.candidateType&&d===("relay"===l.candidateType)||this.emit(we.ConnectionTypeChange,d),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ol(l))," -> ").concat(JSON.stringify(Ol(a)),")"))},i.onSelectedRemoteCandidateChanged=(a,l)=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ol(l))," -> ").concat(JSON.stringify(Ol(a)),")"))},i.onFirstVideoDecodedTimeout=a=>{this.reportVideoFirstFrameDecoded(a,void 0,void 0,!0)}}unbindConnectionEvents(i){i.onConnectionStateChange=void 0,i.onICEConnectionStateChange=void 0,i.onICETransportStateChange=void 0,i.onDTLSTransportStateChange=void 0,i.onDTLSTransportError=void 0,i.onFirstAudioDecoded=void 0,i.onFirstAudioReceived=void 0,i.onFirstVideoDecoded=void 0,i.onFirstVideoReceived=void 0,i.onSelectedLocalCandidateChanged=void 0,i.onSelectedRemoteCandidateChanged=void 0,i.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(i){const r=[];if(-1===this.getAllTracks().indexOf(i))return r;const a=this.localTrackMap.get(ne.LocalAudioTrack);if(i instanceof mt&&a?.track instanceof wn)return a.track.isActive||r.push([ne.LocalAudioTrack,a]),r;const l=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return i===h});if(l&&(r.push(l),l[0]===ne.LocalVideoTrack)){const d=this.localTrackMap.get(ne.LocalVideoLowTrack);d&&r.push([ne.LocalVideoLowTrack,d])}return r}filterTobeUnmutedTracks(i){const r=[],a=this.localTrackMap.get(ne.LocalAudioTrack);if(i instanceof mt&&a?.track instanceof wn)return a.track.isActive&&r.push([ne.LocalAudioTrack,a]),r;const l=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return i===h});if(l)if(l[0]===ne.LocalVideoTrack){r.push(l);const d=this.localTrackMap.get(ne.LocalVideoLowTrack);d&&r.push([ne.LocalVideoLowTrack,d])}else r.push(l);return r}createMuteMessage(i){return i.map(r=>{var a;let l,[d,{track:h,ssrcs:p,id:m}]=r;switch(d){case ne.LocalAudioTrack:l=It.Audio;break;case ne.LocalVideoTrack:l=ye(a=h._hints).call(a,Ot.SCREEN_TRACK)?It.Screen:It.High;break;case ne.LocalVideoLowTrack:l=It.Low}return{stream_type:l,ssrcs:p,mid:m}})}createUnmuteMessage(i){return i.map(r=>{var a;let l,[d,{track:h,ssrcs:p,id:m}]=r;switch(d){case ne.LocalAudioTrack:l=It.Audio;break;case ne.LocalVideoTrack:l=ye(a=h._hints).call(a,Ot.SCREEN_TRACK)?It.Screen:It.High;break;case ne.LocalVideoLowTrack:l=It.Low}return{stream_type:l,ssrcs:p,mid:m}})}filterTobeUnSubscribedTracks(i,r){const a=[],l=this.remoteUserMap.get(i);if(!l)return a;if(r){const d=l.get(r);if(!d)return a;a.push([i,{kind:r,id:d}])}else Array.from(l.entries()).forEach(d=>{let[h,p]=d;a.push([i,{kind:h,id:p}])});return a}filterTobeUnSubscribedDataChannels(i,r){const a=[];return r.forEach(l=>{var d;null!==(d=this.remoteDataChannelMap.get(i))&&void 0!==d&&d.has(l.id)&&a.push(l)}),a}createUnsubscribeMessage(i){const r=[];return i.forEach(a=>{let[l,{kind:d}]=a;switch(d){case Ee.VIDEO:return void(l._videoSSRC&&r.push({stream_type:Ee.VIDEO,ssrcId:l._videoSSRC}));case Ee.AUDIO:return void(l._audioSSRC&&r.push({stream_type:Ee.AUDIO,ssrcId:l._audioSSRC}))}}),r}createUnsubscribeAllMessage(i){const r=new Map;return i.forEach(a=>{let[l,{kind:d}]=a;if(r.has(l)){let h=r.get(l);h|=d===Ee.VIDEO?Nn.Video:Nn.Audio,r.set(l,h)}else r.set(l,d===Ee.VIDEO?Nn.Video:Nn.Audio)}),{users:Array.from(r.entries()).map(a=>{let[l,d]=a;return{stream_id:l.uid,stream_type:d}})}}withdrawRemoteTracks(i){i.forEach(r=>{let[a,{kind:l}]=r;const d=this.remoteUserMap.get(a);d&&(d.delete(l),0===Array.from(d.entries()).length&&this.remoteUserMap.delete(a))})}updateBitrateLimit(i){var r=this;return M(function*(){const a=r.localTrackMap.get(ne.LocalVideoTrack),l=r.localTrackMap.get(ne.LocalVideoLowTrack);a&&(yield a.track.setBitrateLimit(i.uplink)),l&&i.low_stream_uplink&&(yield l.track.setBitrateLimit({max_bitrate:i.low_stream_uplink.bitrate,min_bitrate:i.low_stream_uplink.bitrate||0}))})()}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(i,r){return i.map((a,l)=>{var d;let{stream_type:h}=a;return null===(d=r.find(p=>{let{stream_type:m}=p;return h===m}))||void 0===d?void 0:d.attributes})}tryToUnmuteAudio(i){var r=this;return M(function*(){for(let l=0;l<i.length;l++)if(i[l]instanceof mt){var a;const d=r.filterTobeUnmutedTracks(i[l]);if(0===d.length)continue;yield null===(a=r.connection)||void 0===a?void 0:a.unmuteLocal(d.map(p=>{let[,{id:m}]=p;return m}));const h=r.createUnmuteMessage(d);return void(yield Et(r,we.RequestUnmuteLocal,h))}})()}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=i=>{var r;return!(null===(r=this.connection)||void 0===r||!r.getRemoteVideoIsReady(i))},this.statsUploader.requestUpload=(i,r)=>this.emit(we.RequestUploadStats,i,r),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){var i=this;return M(function*(){i.dtlsFailedCount+=1,yield _i(wt(i.dtlsFailedCount,Re)),i.emit(we.RequestReconnect)})()}reconnectP2P(){var i=this;return M(function*(){const r=Array.from(i.localTrackMap.entries()),a=i.createGatewayUnpublishMessage(r);Array.from(i.remoteUserMap.entries()),a.length>0&&(yield Jt(i,we.RequestUnpublishForReconnectPC,a)),i.disconnectForReconnect(),i.emit(we.RequestReconnectPC)})()}canPublishLowStream(){return this.localTrackMap.has(ne.LocalVideoTrack)||this.pendingLocalTracks.some(i=>i instanceof ze)}throwIfTrackTypeNotMatch(i){if(i.filter(r=>r instanceof ze).length>1)throw new J(x.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(i.filter(r=>r instanceof mt).length>1&&(i.some(r=>r instanceof mt&&r._bypassWebAudio)||!$e().webAudioMediaStreamDest))throw new J(x.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of i){if(r instanceof ze&&this.pendingLocalTracks.some(a=>a instanceof ze))throw new J(x.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof mt&&this.pendingLocalTracks.some(a=>a instanceof mt)&&(!$e().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(a=>a instanceof mt&&a._bypassWebAudio)))throw new J(x.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(i,r){const a=!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&$e().supportDualStreamEncoding,l=Xd(Xd({},{width:160,height:120,framerate:15,bitrate:50}),r);let d;d=a?i._mediaStreamTrack.clone():U0(i,l);const h=Fe(8,"track-low-"),p=new ze(d,Xd(Xd({},a&&{scaleResolutionDownBy:c0(l,i)}),{},{frameRate:l.framerate,bitrateMax:l.bitrate,bitrateMin:l.bitrate}),void 0,void 0,h);return p.on(_c.TRANSCEIVER_UPDATED,m=>{i._updateRtpTransceiver(m,mc.LOW_STREAM)}),p._hints.push(Ot.LOW_STREAM),i.addListener(me.NEED_CLOSE,()=>{p.close()}),p}globalLock(){var i=this;return M(function*(){return i.mutex.lock("From P2PChannel.globalLock")})()}reportPCStats(i,r,a){var l=arguments,d=this;return M(function*(){let h=l.length>3&&void 0!==l[3]?l[3]:null;if(d.connection&&d.connection instanceof Xn){var p,m,g,E;const y=d.store.keyMetrics.descriptionStart||0,{iceConnectionState:b,dtlsTransportState:T,peerConnectionState:O}=d.connection,{local:P,remote:D}=yield d.connection.getSelectedCandidatePair();Se.pcStats(d.store.sessionId,{startTime:y,eventElapse:i-y||0,iceconnectionsate:b,dtlsstate:T,connectionstate:O,intSucc:r?1:2,error:h,selectedLocalCandidateProtocol:null!==(p=P?.protocol)&&void 0!==p?p:"",selectedLocalCandidateType:null!==(m=P.candidateType)&&void 0!==m?m:"",selectedLocalCandidateAddress:"".concat(P.address,":").concat(P.port),selectedRemoteCandidateProtocol:null!==(g=D.protocol)&&void 0!==g?g:"",selectedRemoteCandidateType:null!==(E=D.candidateType)&&void 0!==E?E:"",selectedRemoteCandidateAddress:"".concat(D.address,":").concat(D.port),restartCnt:a})}})()}reportVideoFirstFrameDecoded(i,r,a,l){var d;const h=Array.from(zr(d=this.remoteUserMap).call(d)).find(p=>p._videoSSRC===i);if(h){l||this.store.subscribe(h.uid,"video",void 0,void 0,void 0,void 0,Date.now());const p=this.store.keyMetrics,m=p.subscribe.find(g=>g.userId===h.uid&&"video"===g.type);Se.firstRemoteVideoDecode(this.store.sessionId,Kn.FIRST_VIDEO_DECODE,qt.FIRST_VIDEO_DECODE,{peer:h._uintid,videowidth:r,videoheight:a,subscribeElapse:Di.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId,apEnd:p.requestAPEnd||0,apStart:p.requestAPStart||0,joinGwEnd:p.joinGatewayEnd||0,joinGwStart:p.joinGatewayStart||0,pcEnd:p.peerConnectionEnd||0,pcStart:p.peerConnectionStart||0,subscriberEnd:m?.subscribeEnd||0,subscriberStart:m?.subscribeStart||0,videoAddNotify:m?.streamAdded||0,state:l?1:0})}}remoteMediaSsrcChanged(i,r,a){var l=this;return M(function*(){if(!l.connection)return!1;const d=l.remoteUserMap.get(i);if(!d)return!1;const h=d.get(r);if(!h)return!1;const p=yield l.connection.getRemoteSSRC(h);return void 0!==p&&p!==a})()}resetConnection(i){w.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(i)),this.state===it.Connected?(w.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=i===gE.datachannel?new Hn({},this.store):this.isPlanB?new si({},this.store):new Xn({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(i=>{let[r,{track:a}]=i;r===ne.LocalVideoLowTrack?a._updateRtpTransceiver(void 0,mc.LOW_STREAM):a._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(i){this.connection&&this.connection instanceof Xn&&("disconnected"!==this.connection.iceConnectionState&&"checking"!==this.connection.iceConnectionState&&"failed"!==this.connection.iceConnectionState||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this.reportPCStats(Date.now(),!1,this._pcStatsUploadType===Xs.TCP_RESTART&&i===wi.RELAY?this._pcStatsUploadType:Xs.DISCONNECTED_OR_FAILED)))}}function Qi(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=M(function*(){const l=this.mutex,d=yield l.lock("From P2PChannel.".concat(i));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield a.apply(this,p)}finally{d()}}),r}function x3(s){let i={};e:for(;!V2(s);){let r=Cc(s);switch(r>>>3){case 0:break e;case 1:i.requestId=W0(s,Cc(s));break;case 2:i.requestType=Cc(s)>>>0;break;case 3:i.scorePorn=UN(s);break;case 4:i.scoreSexy=UN(s);break;case 5:i.scoreNeutral=UN(s);break;case 6:i.requestScene=Cc(s)>>>0;break;case 7:i.scene=Cc(s)>>>0;break;default:j0(s,7&r)}}return i}function M3(s,i){let r=s.service;void 0!==r&&(Rt(i,8),Rt(i,r));let a=s.vendor;void 0!==a&&(Rt(i,16),Rt(i,a));let l=s.token;void 0!==l&&(Rt(i,26),Sc(i,l));let d=s.callbackUrl;void 0!==d&&(Rt(i,34),Sc(i,d))}function k3(s){let i=Cc(s),r=s.limit;return s.limit=s.offset+i,r}function j0(s,i){switch(i){case 0:for(;128&B2(s););break;case 2:Iv(s,Cc(s));break;case 5:Iv(s,4);break;case 1:Iv(s,8);break;default:throw new Error("Unimplemented type: "+i)}}te([Qi,N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",q)],ci.prototype,"startP2PConnection",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",q)],ci.prototype,"connect",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",void 0)],ci.prototype,"updateRemoteRTPCapabilities",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",q)],ci.prototype,"preConnect",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],ci.prototype,"publishDataChannel",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],ci.prototype,"unpublish",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],ci.prototype,"unpublishDataChannel",null),te([Qi,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",q)],ci.prototype,"unpublishLowStream",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Oi,Array]),N("design:returntype",q)],ci.prototype,"subscribeDataChannel",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Oi,String,Number,Number,Array]),N("design:returntype",q)],ci.prototype,"subscribe",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],ci.prototype,"massSubscribe",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Oi,String,Boolean]),N("design:returntype",q)],ci.prototype,"unsubscribe",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Oi,Array]),N("design:returntype",q)],ci.prototype,"unsubscribeDataChannel",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],ci.prototype,"massUnsubscribe",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Oi,String]),N("design:returntype",q)],ci.prototype,"muteRemote",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Oi,String]),N("design:returntype",q)],ci.prototype,"unmuteRemote",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Oi,String]),N("design:returntype",q)],ci.prototype,"hasRemoteMediaWithLock",null),te([Qi,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",q)],ci.prototype,"disconnectForReconnect",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",q)],ci.prototype,"updateBitrateLimit",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Oi,String,Number]),N("design:returntype",q)],ci.prototype,"remoteMediaSsrcChanged",null);let L2=new Float32Array(1);new Uint8Array(L2.buffer);let H0=new Float64Array(1),or=new Uint8Array(H0.buffer);function Ga(s){return{low:s|=0,high:s>>31,unsigned:s>=0}}let F2=[];function U2(){const s=F2.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}function FN(s){F2.push(s)}function Iv(s,i){if(s.offset+i>s.limit)throw new Error("Skip past limit");s.offset+=i}function V2(s){return s.offset>=s.limit}function lm(s,i){let r=s.bytes,a=s.offset,l=s.limit,d=a+i;if(d>r.length){let h=new Uint8Array(2*d);h.set(r),s.bytes=h}return s.offset=d,d>l&&(s.limit=d),a}function G0(s,i){let r=s.offset;if(r+i>s.limit)throw new Error("Read past limit");return s.offset+=i,r}function W0(s,i){let r=G0(s,i),a=String.fromCharCode,l=s.bytes,d="\ufffd",h="";for(let p=0;p<i;p++){let m,g,E,y,b=l[p+r];128&b?192==(224&b)?p+1>=i?h+=d:(m=l[p+r+1],128!=(192&m)?h+=d:(y=(31&b)<<6|63&m,y<128?h+=d:(h+=a(y),p++))):224==(240&b)?p+2>=i?h+=d:(m=l[p+r+1],g=l[p+r+2],32896!=(49344&(m|g<<8))?h+=d:(y=(15&b)<<12|(63&m)<<6|63&g,y<2048||y>=55296&&y<=57343?h+=d:(h+=a(y),p+=2))):240==(248&b)?p+3>=i?h+=d:(m=l[p+r+1],g=l[p+r+2],E=l[p+r+3],8421504!=(12632256&(m|g<<8|E<<16))?h+=d:(y=(7&b)<<18|(63&m)<<12|(63&g)<<6|63&E,y<65536||y>1114111?h+=d:(y-=65536,h+=a(55296+(y>>10),56320+(1023&y)),p+=3))):h+=d:h+=a(b)}return h}function Sc(s,i){let r=i.length,a=0;for(let h=0;h<r;h++){let p=i.charCodeAt(h);p>=55296&&p<=56319&&h+1<r&&(p=(p<<10)+i.charCodeAt(++h)-56613888),a+=p<128?1:p<2048?2:p<65536?3:4}Rt(s,a);let l=lm(s,a),d=s.bytes;for(let h=0;h<r;h++){let p=i.charCodeAt(h);p>=55296&&p<=56319&&h+1<r&&(p=(p<<10)+i.charCodeAt(++h)-56613888),p<128?d[l++]=p:(p<2048?d[l++]=p>>6&31|192:(p<65536?d[l++]=p>>12&15|224:(d[l++]=p>>18&7|240,d[l++]=p>>12&63|128),d[l++]=p>>6&63|128),d[l++]=63&p|128)}}function L3(s,i){let r=lm(s,i.limit),a=s.bytes,l=i.bytes;for(let d=0,h=i.limit;d<h;d++)a[d+r]=l[d]}function B2(s){return s.bytes[G0(s,1)]}function j2(s,i){let r=lm(s,1);s.bytes[r]=i}function UN(s){let i=G0(s,8),r=s.bytes;return or[0]=r[i++],or[1]=r[i++],or[2]=r[i++],or[3]=r[i++],or[4]=r[i++],or[5]=r[i++],or[6]=r[i++],or[7]=r[i++],H0[0]}function VN(s,i){let r=lm(s,8),a=s.bytes;H0[0]=i,a[r++]=or[0],a[r++]=or[1],a[r++]=or[2],a[r++]=or[3],a[r++]=or[4],a[r++]=or[5],a[r++]=or[6],a[r++]=or[7]}function Cc(s){let i,r=0,a=0;do{i=B2(s),r<32&&(a|=(127&i)<<r),r+=7}while(128&i);return a}function Rt(s,i){for(i>>>=0;i>=128;)j2(s,127&i|128),i>>>=7;j2(s,i)}function xl(s,i){let r=i.low>>>0,a=(i.low>>>28|i.high<<4)>>>0,l=i.high>>>24,d=0===l?0===a?r<16384?r<128?1:2:r<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:l<128?9:10,h=lm(s,d),p=s.bytes;switch(d){case 10:p[h+9]=l>>>7&1;case 9:p[h+8]=9!==d?128|l:127&l;case 8:p[h+7]=8!==d?a>>>21|128:a>>>21&127;case 7:p[h+6]=7!==d?a>>>14|128:a>>>14&127;case 6:p[h+5]=6!==d?a>>>7|128:a>>>7&127;case 5:p[h+4]=5!==d?128|a:127&a;case 4:p[h+3]=4!==d?r>>>21|128:r>>>21&127;case 3:p[h+2]=3!==d?r>>>14|128:r>>>14&127;case 2:p[h+1]=2!==d?r>>>7|128:r>>>7&127;case 1:p[h]=1!==d?128|r:127&r}}function H2(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}const G2=new Map([["moderation",1],["supervise",2]]);class Rv extends zt{get connectionState(){return this._connectionState}set connectionState(i){if(this._connectionState===i)return;const r=this._connectionState;this._connectionState=i,this.emit(jn.CONNECTION_STATE_CHANGE,r,i)}get inspectType(){return this._inspectType}set inspectType(i){var r;this._inspectMode=ll(r=i.map(a=>G2.get(a)||0)).call(r,(a,l)=>a+l),this._inspectType=i}get quality(){return this._quality}set quality(i){this._quality=i>1?1:i<.1?.1:i,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(i){super(),C(this,"name","AgoraRTCVideoContentInspect"),C(this,"_connectionState",Nr.CONNECTING),C(this,"_innerConnectionState",void 0),C(this,"sequence",0),C(this,"inspectStartTime",void 0),C(this,"workerManagerConnection",void 0),C(this,"workerConnection",void 0),C(this,"workerMessageLengthLimit",void 0),C(this,"inspectIntervalMinimum",void 0),C(this,"qualityRatio",void 0),C(this,"_connectInfo",void 0),C(this,"_cancelTokenSource",vr.CancelToken.source()),C(this,"_retryConfig",void 0),C(this,"wmSequence",0),C(this,"inspectInterval",void 0),C(this,"inspectTimer",null),C(this,"ossFilePrefix",void 0),C(this,"extraInfo",void 0),C(this,"_inspectType",void 0),C(this,"_inspectMode",void 0),C(this,"_quality",1),C(this,"qualityTimer",null),C(this,"_inspectId",void 0),C(this,"_needWorkUrlOnly",!1),C(this,"inspectImage",()=>{if(this.connectionState!==Nr.CONNECTED)throw new W(x.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Nr.CONNECTED?this.requestToInspectImage():w.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Fe(5,"inspect-"),this.workerMessageLengthLimit=j("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=j("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=j("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=i.interval,this.ossFilePrefix=i.ossFilePrefix,this.extraInfo=i.extraInfo,this.inspectType=i.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Uf("worker-manager-"+this._inspectId,Re),this.on(jn.STATE_CHANGE,(r,a)=>{this._innerConnectionState=r,w.debug("[".concat(this._inspectId,"] Inspect operation :").concat(bo[r]," ").concat(a||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Uf("worker-"+this._inspectId,Re),this.handleWorkerEvents()}init(i,r){var a=this;return M(function*(){a.emit(jn.STATE_CHANGE,bo.CONNECT_AP),a._connectInfo=i;const l=a._cancelTokenSource.token;return a._retryConfig=r,new q((d,h)=>{a.on(jn.CONNECTION_STATE_CHANGE,(p,m)=>{m===Nr.CONNECTED&&d()}),a.requestAP(i,l,r).then(p=>{a.connectWorkerManager(p)}).catch(p=>{h(p)})})})()}requestAP(i,r,a){var l=this;return M(function*(){const d=j("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),h=yield function(m,g,E,y){let{appId:b,areaCode:T,cname:O,sid:P,token:D,uid:L}=g;Fh++;const B="image_moderation_api",V={service_name:B,json_body:JSON.stringify({appId:b,areaCode:T,cname:O,command:"allocateEdge",requestId:Fh,seq:Fh,sid:P,token:D,ts:Date.now(),uid:L+""})};let Q,se,K=m[0];return gs(M(function*(){Q=Date.now();const ee=yield Mt(K,{data:V,cancelToken:E,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(se=Date.now()-Q,0!==ee.code){const ve=new W(x.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ee.code,{retry:!0,responseTime:se});throw w.error(ve.toString()),ve}const $=JSON.parse(ee.json_body);if(200!==$.code){const ve=new W(x.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat($.code,", reason: ").concat($.reason),{code:$.code,responseTime:se});throw w.error(ve.toString()),ve}if(!$.servers||!Array.isArray($.servers)||0===$.servers.length){const ve=new W(x.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:$.code,responseTime:se});throw w.error(ve.toString()),ve}const Y=j("VIDEO_INSPECT_WORKER_MANAGER_HOST"),_e=j("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:$.servers.map(ve=>{let{address:Ze,wss:yt}=ve;if(Ze&&yt)return"wss://".concat(Ze.replace(/\./g,"-"),".").concat(Y,":").concat(_e||yt)}).filter(ve=>!!ve),workerToken:$.workerToken,vid:$.vid,responseTime:se}}),(ee,$)=>(Se.apworkerEvent(P,{success:!0,sc:200,serviceName:B,responseDetail:JSON.stringify(ee.addressList),firstSuccess:0===$,responseTime:se,serverIp:m[$%m.length]}),!1),(ee,$)=>(Se.apworkerEvent(P,{success:!1,sc:ee.data&&ee.data.code||200,serviceName:B,responseTime:se,serverIp:m[$%m.length]}),!!(ee.code!==x.OPERATION_ABORTED&&ee.code!==x.UNEXPECTED_RESPONSE||ee.data&&ee.data.retry)&&(K=m[($+1)%m.length],!0)),y)}(d,i,r,a);l.emit(jn.STATE_CHANGE,bo.AP_CONNECTED);const{addressList:p}=h;return l.wmSequence++,p})()}connectWorkerManager(i){var r=arguments,a=this;return M(function*(){a._needWorkUrlOnly=r.length>1&&void 0!==r[1]&&r[1],a.emit(jn.STATE_CHANGE,bo.CONNECT_WORKER_MANAGER),yield a.workerManagerConnection.init(i,1e4)})()}connectWorker(i){var r=this;return M(function*(){yield r.workerConnection.init([i])})()}handleWorkerManagerEvents(){var i=this;this.workerManagerConnection.on(Me.CONNECTED,M(function*(){i.emit(jn.STATE_CHANGE,bo.WORKER_MANAGER_CONNECTED,i.workerManagerConnection.url),i.workerManagerConnection.sendMessage({appId:i._connectInfo.appId,cname:i._connectInfo.cname,uid:i._connectInfo.uid+"",sdkVersion:"4.19.2",sid:i._connectInfo.sid,seq:i.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(Me.CLOSED,()=>{this._innerConnectionState<bo.GET_WORKER_MANAGER_RESPONSE&&w.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Me.FAILED,()=>{this._innerConnectionState<bo.GET_WORKER_MANAGER_RESPONSE&&w.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Me.RECONNECTING,()=>{this._innerConnectionState<bo.GET_WORKER_MANAGER_RESPONSE&&w.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Me.ON_MESSAGE,function(){var r=M(function*(a){i.emit(jn.STATE_CHANGE,bo.GET_WORKER_MANAGER_RESPONSE);const l=i.workerManagerConnection.url;i.workerManagerConnection.close();const d=JSON.parse(a.data);if(200!==d.code)throw w.error("[".concat(i._inspectId,"] Unexpected code ").concat(d.code," from worker manager")),new W(x.UNEXPECTED_RESPONSE,"response code of worker is unexpected",d);if(!(d.serverResponse&&d.serverResponse.portWss&&l))throw w.error("[".concat(i._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(d))),new W(x.UNEXPECTED_RESPONSE,"response content of worker is unexpected",d);{const h=j("VIDEO_INSPECT_WORKER_PORT")||d.serverResponse.portWss,p=l.replace(/:\d+\/?$/,":".concat(h));i.emit(jn.STATE_CHANGE,bo.CONNECT_WORKER,p),i._needWorkUrlOnly?i.emit(jn.REQUEST_NEW_WORKER_URL,p):yield i.connectWorker(p)}});return function(a){return r.apply(this,arguments)}}()),this.workerManagerConnection.on(Me.WILL_RECONNECT,(r,a,l)=>{l(r)}),this.workerManagerConnection.on(Me.REQUEST_NEW_URLS,(r,a)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(a)})}handleWorkerEvents(){var i=this;this.workerConnection.on(Me.CONNECTED,M(function*(){i.emit(jn.STATE_CHANGE,bo.WORKER_CONNECTED,i.workerConnection.url),i.connectionState=Nr.CONNECTED})),this.workerConnection.on(Me.ON_MESSAGE,function(){var r=M(function*(a){if(a.data instanceof ArrayBuffer){const d=function k2(s){return function(r){let a={};e:for(;!V2(r);){let l=Cc(r);switch(l>>>3){case 0:break e;case 1:a.code=Cc(r);break;case 2:a.msg=W0(r,Cc(r));break;case 3:{let d=k3(r);a.data=x3(r),r.limit=d;break}default:j0(r,7&l)}}return a}({bytes:i=s,offset:0,limit:i.length});var i}(new Uint8Array(a.data));if(j("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&w.debug("[".concat(i._inspectId,"] Response message for worker of inspect content "),JSON.stringify(d)),200===d.code){if(Array.isArray(i.inspectType)&&1===i.inspectType.length&&"supervise"===i.inspectType[0])return void i.emit(jn.INSPECT_RESULT,void 0,void 0);if(d.data&&d.data.scorePorn&&d.data.scoreSexy&&d.data.scoreNeutral){var l;const h={porn:d.data.scorePorn,sexy:d.data.scoreSexy,neutral:d.data.scoreNeutral},p=ll(l=Object.keys(h)).call(l,(g,E)=>h[g]>h[E]?g:E,"porn"),m=Object.keys(h).find(g=>g===p);i.emit(jn.INSPECT_RESULT,m)}else i.emit(jn.INSPECT_RESULT,void 0,new W(x.UNEXPECTED_RESPONSE,d.code+"","There is an unexpected data on message"))}else i.emit(jn.INSPECT_RESULT,void 0,new W(x.UNEXPECTED_RESPONSE,d.code+"",d.msg))}else w.error("[".concat(i._inspectId,"] Unexpected message type from worker")),i.emit(jn.INSPECT_RESULT,void 0,new W(x.UNEXPECTED_RESPONSE,"invalid worker message type"))});return function(a){return r.apply(this,arguments)}}()),this.workerConnection.on(Me.CLOSED,()=>{this.connectionState=Nr.CLOSED}),this.workerConnection.on(Me.FAILED,()=>{this.connectionState=Nr.CLOSED}),this.workerConnection.on(Me.RECONNECTING,()=>{this.connectionState=this.connectionState===Nr.CONNECTED?Nr.RECONNECTING:Nr.CONNECTING}),this.workerConnection.on(Me.WILL_RECONNECT,(r,a,l)=>{"recover"===r&&l(r),l("tryNext")}),this.workerConnection.on(Me.REQUEST_NEW_URLS,(r,a)=>{this.workerManagerConnection.close(),this.once(jn.REQUEST_NEW_WORKER_URL,l=>{r([l])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(l=>{this.connectWorkerManager(l,!0)}).catch(l=>{a(l)})})}static intToLong(i){return{low:i|=0,high:i>>31,unsigned:i>=0}}requestToInspectImage(){var i=this;return M(function*(){i.sequence++;const r=gr(i,jn.CLIENT_LOCAL_VIDEO_TRACK),a={appId:i._connectInfo.appId,cname:i._connectInfo.cname,cid:i._connectInfo.cid,sid:i._connectInfo.sid,uid:i._connectInfo.uid,vid:i._connectInfo.vid};if(r){if(!r.isPlaying)return void i.emit(jn.INSPECT_RESULT,void 0,new W(x.INVALID_OPERATION,"Only the track being played can be inspected"));const l=yield i.generateRequestData(r,a);i.workerConnection.sendMessage(l,!0,!0)}else i.emit(jn.INSPECT_RESULT,void 0,new W(x.INVALID_OPERATION,"Only the track being published can be inspected"))})()}generateRequestData(i,r){var a=this;return M(function*(){let{appId:l,cname:d,cid:h,vid:p,sid:m,uid:g}=r;const E=Date.now(),y=yield i.getCurrentFrameImage("image/jpeg",a.quality),b=yield OL(y,l,d),T=a.sequence+"-"+h+"-"+g+"-"+E+"-"+Fe(12,""),O={appId:l,cid:h,cname:d,deviceId:"",elapse:Rv.intToLong(Number(E-a.inspectStartTime)),fileSize:b.byteLength,jpgEncryption:2,height:y.height,width:y.width,jpg:b,networkType:6,osType:7,requestId:T,sdkVersion:"4.19.2",sequence:a.sequence,sid:m,timestamp:Rv.intToLong(E),uid:g,vid:p,service:a._inspectMode,callbackData:a.extraInfo,ossFilePrefix:a.ossFilePrefix};void 0===a.extraInfo&&delete O.callbackData,void 0===a.ossFilePrefix&&delete O.ossFilePrefix;const P=function P3(s){let i=U2();return function(r,a){let l=r.appId;void 0!==l&&(Rt(a,10),Sc(a,l));let d=r.cid;void 0!==d&&(Rt(a,16),Rt(a,d));let h=r.cname;void 0!==h&&(Rt(a,26),Sc(a,h));let p=r.deviceId;void 0!==p&&(Rt(a,34),Sc(a,p));let m=r.elapse;void 0!==m&&(Rt(a,40),xl(a,m));let g=r.fileSize;void 0!==g&&(Rt(a,48),xl(a,Ga(g)));let E=r.height;void 0!==E&&(Rt(a,56),xl(a,Ga(E)));let y=r.jpg;void 0!==y&&(Rt(a,66),Rt(a,y.length),function(li,ie){let ce=lm(li,ie.length);li.bytes.set(ie,ce)}(a,y));let b=r.networkType;void 0!==b&&(Rt(a,72),xl(a,Ga(b)));let T=r.osType;void 0!==T&&(Rt(a,80),xl(a,Ga(T)));let O=r.requestId;void 0!==O&&(Rt(a,90),Sc(a,O));let P=r.sdkVersion;void 0!==P&&(Rt(a,98),Sc(a,P));let D=r.sequence;void 0!==D&&(Rt(a,104),xl(a,Ga(D)));let L=r.sid;void 0!==L&&(Rt(a,114),Sc(a,L));let B=r.timestamp;void 0!==B&&(Rt(a,120),xl(a,B));let V=r.uid;void 0!==V&&(Rt(a,128),Rt(a,V));let Q=r.vid;void 0!==Q&&(Rt(a,136),Rt(a,Q));let se=r.width;void 0!==se&&(Rt(a,144),xl(a,Ga(se)));let K=r.service;void 0!==K&&(Rt(a,152),Rt(a,K));let ee=r.callbackData;void 0!==ee&&(Rt(a,162),Sc(a,ee));let $=r.jpgEncryption;void 0!==$&&(Rt(a,168),Rt(a,$));let Y=r.requestType;void 0!==Y&&(Rt(a,176),Rt(a,Y));let _e=r.scorePorn;void 0!==_e&&(Rt(a,185),VN(a,_e));let ve=r.scoreSexy;void 0!==ve&&(Rt(a,193),VN(a,ve));let Ze=r.scoreNeutral;void 0!==Ze&&(Rt(a,201),VN(a,Ze));let yt=r.scene;void 0!==yt&&(Rt(a,208),Rt(a,yt));let xn=r.ossFilePrefix;void 0!==xn&&(Rt(a,218),Sc(a,xn));let Ht=r.serviceVendor;if(void 0!==Ht)for(let li of Ht){Rt(a,226);let ie=U2();M3(li,ie),Rt(a,ie.limit),L3(a,ie),FN(ie)}}(s,i),function(r){let a=r.bytes,l=r.limit;return a.length===l?a:a.subarray(0,l)}(i)}(O);if(P.byteLength<a.workerMessageLengthLimit){if(j("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const D=function(L){for(var B=1;B<arguments.length;B++){var V=null!=arguments[B]?arguments[B]:{};B%2?H2(Object(V),!0).forEach(function(Q){C(L,Q,V[Q])}):Object.getOwnPropertyDescriptors?Object.defineProperties(L,Object.getOwnPropertyDescriptors(V)):H2(Object(V)).forEach(function(Q){Object.defineProperty(L,Q,Object.getOwnPropertyDescriptor(V,Q))})}return L}({},O);delete D.jpg,w.debug("[".concat(a._inspectId,"] Request message for worker of inspect content "),JSON.stringify(D))}return P}return a.quality=a.quality*a.qualityRatio,yield a.generateRequestData(i,{appId:l,cname:d,cid:h,vid:p,sid:m,uid:g})})()}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=vr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Nr.CLOSED,this.emit(jn.STATE_CHANGE,bo.CLOSED)}}function V3(s,i){switch(i){case 0:for(;128&Os(s););break;case 2:BN(s,Tc(s));break;case 5:BN(s,4);break;case 1:BN(s,8);break;default:throw new Error("Unimplemented type: "+i)}}function dm(s){return{low:s|=0,high:s>>31,unsigned:s>=0}}let B3=[];function BN(s,i){if(s.offset+i>s.limit)throw new Error("Skip past limit");s.offset+=i}function j3(s){return s.offset>=s.limit}function z0(s,i){let r=s.bytes,a=s.offset,l=s.limit,d=a+i;if(d>r.length){let h=new Uint8Array(2*d);h.set(r),s.bytes=h}return s.offset=d,d>l&&(s.limit=d),a}function W2(s,i){let r=s.offset;if(r+i>s.limit)throw new Error("Read past limit");return s.offset+=i,r}function z2(s,i){let r=z0(s,i.length);s.bytes.set(i,r)}function um(s,i){let r=W2(s,i),a=String.fromCharCode,l=s.bytes,d="\ufffd",h="";for(let p=0;p<i;p++){let m,g,E,y,b=l[p+r];128&b?192==(224&b)?p+1>=i?h+=d:(m=l[p+r+1],128!=(192&m)?h+=d:(y=(31&b)<<6|63&m,y<128?h+=d:(h+=a(y),p++))):224==(240&b)?p+2>=i?h+=d:(m=l[p+r+1],g=l[p+r+2],32896!=(49344&(m|g<<8))?h+=d:(y=(15&b)<<12|(63&m)<<6|63&g,y<2048||y>=55296&&y<=57343?h+=d:(h+=a(y),p+=2))):240==(248&b)?p+3>=i?h+=d:(m=l[p+r+1],g=l[p+r+2],E=l[p+r+3],8421504!=(12632256&(m|g<<8|E<<16))?h+=d:(y=(7&b)<<18|(63&m)<<12|(63&g)<<6|63&E,y<65536||y>1114111?h+=d:(y-=65536,h+=a(55296+(y>>10),56320+(1023&y)),p+=3))):h+=d:h+=a(b)}return h}function Kh(s,i){let r=i.length,a=0;for(let h=0;h<r;h++){let p=i.charCodeAt(h);p>=55296&&p<=56319&&h+1<r&&(p=(p<<10)+i.charCodeAt(++h)-56613888),a+=p<128?1:p<2048?2:p<65536?3:4}Rn(s,a);let l=z0(s,a),d=s.bytes;for(let h=0;h<r;h++){let p=i.charCodeAt(h);p>=55296&&p<=56319&&h+1<r&&(p=(p<<10)+i.charCodeAt(++h)-56613888),p<128?d[l++]=p:(p<2048?d[l++]=p>>6&31|192:(p<65536?d[l++]=p>>12&15|224:(d[l++]=p>>18&7|240,d[l++]=p>>12&63|128),d[l++]=p>>6&63|128),d[l++]=63&p|128)}}function Os(s){return s.bytes[W2(s,1)]}function Av(s,i){let r=z0(s,1);s.bytes[r]=i}function Tc(s){let i,r=0,a=0;do{i=Os(s),r<32&&(a|=(127&i)<<r),r+=7}while(128&i);return a}function Rn(s,i){for(i>>>=0;i>=128;)Av(s,127&i|128),i>>>=7;Av(s,i)}function Dv(s,i){let r,a=0,l=0,d=0;return r=Os(s),a=127&r,128&r&&(r=Os(s),a|=(127&r)<<7,128&r&&(r=Os(s),a|=(127&r)<<14,128&r&&(r=Os(s),a|=(127&r)<<21,128&r&&(r=Os(s),l=127&r,128&r&&(r=Os(s),l|=(127&r)<<7,128&r&&(r=Os(s),l|=(127&r)<<14,128&r&&(r=Os(s),l|=(127&r)<<21,128&r&&(r=Os(s),d=127&r,128&r&&(r=Os(s),d|=(127&r)<<7))))))))),{low:a|l<<28,high:l>>>4|d<<24,unsigned:i}}function Ml(s,i){let r=i.low>>>0,a=(i.low>>>28|i.high<<4)>>>0,l=i.high>>>24,d=0===l?0===a?r<16384?r<128?1:2:r<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:l<128?9:10,h=z0(s,d),p=s.bytes;switch(d){case 10:p[h+9]=l>>>7&1;case 9:p[h+8]=9!==d?128|l:127&l;case 8:p[h+7]=8!==d?a>>>21|128:a>>>21&127;case 7:p[h+6]=7!==d?a>>>14|128:a>>>14&127;case 6:p[h+5]=6!==d?a>>>7|128:a>>>7&127;case 5:p[h+4]=5!==d?128|a:127&a;case 4:p[h+3]=4!==d?r>>>21|128:r>>>21&127;case 3:p[h+2]=3!==d?r>>>14|128:r>>>14&127;case 2:p[h+1]=2!==d?r>>>7|128:r>>>7&127;case 1:p[h]=1!==d?128|r:127&r}}const jN={},HN={},Yh=4294967296,q0=Yh*Yh,K0=q0/2,hm=WN(0,!0),Y0=WN(0),$0=$h(0,-2147483648,!1),X0=$h(-1,2147483647,!1),GN=$h(-1,-1,!0);function WN(s,i){let r,a,l;return i?(l=0<=(s>>>=0)&&s<256)&&(a=HN[s],a)?a:(r=$h(s,0,!0),l&&(HN[s]=r),r):(l=-128<=(s|=0)&&s<128)&&(a=jN[s],a)?a:(r=$h(s,s<0?-1:0,!1),l&&(jN[s]=r),r)}function $h(s,i,r){return{low:0|s,high:0|i,unsigned:!!r}}function q2(s,i){if(isNaN(s))return i?hm:Y0;if(i){if(s<0)return hm;if(s>=q0)return GN}else{if(s<=-K0)return $0;if(s+1>=K0)return X0}return s<0?i?hm:Y0:$h(s%Yh|0,s/Yh|0,i)}function zN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}class J0 extends zt{get connectionState(){return this._connectionState}set connectionState(i){if(this._connectionState===i)return;const r=this._connectionState;this._connectionState=i,this.emit(Xo.CONNECTION_STATE_CHANGE,i,r)}get quality(){return this._quality}set quality(i){this._quality=i>1?1:i<.1?.1:i,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(i){var r;super(),C(this,"name","AgoraRTCImageModeration"),C(this,"_connectionState",Pr.CONNECTING),C(this,"_sequence",0),C(this,"_moderationStartTime",void 0),C(this,"_workerConnection",void 0),C(this,"_workerMessageLengthLimit",void 0),C(this,"_qualityRatio",void 0),C(this,"_connectInfo",void 0),C(this,"_cancelTokenSource",vr.CancelToken.source()),C(this,"_retryConfig",void 0),C(this,"_moderationInterval",void 0),C(this,"_moderationTimer",null),C(this,"_moderationMode",1),C(this,"_quality",1),C(this,"_qualityTimer",null),C(this,"_ticket",void 0),C(this,"_moderationIntervalMinimum",void 0),C(this,"_uploadFailedNum",0),C(this,"_uploadNum",0),C(this,"_uploadTimer",null),C(this,"_moderationId",void 0),C(this,"inspectImage",()=>{if(this.connectionState!==Pr.CONNECTED)throw new W(x.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Pr.CONNECTED?this.requestToInspectImage():w.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Fe(5,"image-moderation-"),this._workerMessageLengthLimit=j("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=j("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(r=i.interval)&&void 0!==r?r:1e3,this._qualityRatio=j("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Uf("worker-"+this._moderationId,Re),this.on(Xo.STATE_CHANGE,(a,l)=>{w.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Sd[a]," ").concat(l||""))}),this.handleWorkerEvents()}init(i,r){var a=this;return M(function*(){a.emit(Xo.STATE_CHANGE,Sd.CONNECT_AP),a._connectInfo=i;const l=a._cancelTokenSource.token;return a._retryConfig=r,new q((d,h)=>{a.on(Xo.CONNECTION_STATE_CHANGE,(p,m)=>{p===Pr.CONNECTED&&d()}),a.requestAP(i,l,r).then(p=>{a.connectWorker(p)}).catch(p=>{h(p)})})})()}updateConfig(i){var r;this._moderationInterval=null!==(r=i.interval)&&void 0!==r?r:1e3,w.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(i))),this.connectionState===Pr.CONNECTED&&this.inspectImage()}requestAP(i,r,a){var l=this;return M(function*(){const d=j("WEBCS_DOMAIN").map(g=>"https://".concat(g,"/api/v1")),h=yield function(g,E,y,b){let{appId:T,areaCode:O,cname:P,sid:D,token:L,uid:B}=E;Fh++;const V="moderation_plugin",Q={service_name:V,json_body:JSON.stringify({appId:T,areaCode:O,cname:P,command:"allocateEdge",requestId:Fh,seq:Fh,sid:D,appToken:L,ts:Date.now(),uid:B+""})};let se,K,ee=g[0];return gs(M(function*(){se=Date.now();const $=yield Mt(ee,{data:Q,cancelToken:y,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(K=Date.now()-se,0!==$.code){const ve=new W(x.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+$.code,{retry:!0,responseTime:K});throw w.error(ve.toString()),ve}const Y=JSON.parse($.json_body);if(200!==Y.code){const ve=new W(x.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Y.code,", reason: ").concat(Y.reason),{code:Y.code,responseTime:K});throw w.error(ve.toString()),ve}if(!Y.servers||!Array.isArray(Y.servers)||0===Y.servers.length){const ve=new W(x.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Y.code,responseTime:K});throw w.error(ve.toString()),ve}if(!Y.servers.some(ve=>!!ve.wss)){const ve=new W(x.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Y.code,responseTime:K});throw w.error(ve.toString()),ve}const _e=j("IMAGE_MODERATION_WORKER_HOST");return{addressList:Y.servers.map(ve=>{let{address:Ze,wss:yt}=ve;if(Ze&&yt)return"wss://".concat(Ze.replace(/\./g,"-"),".").concat(_e,":").concat(yt,"/moderation")}).filter(ve=>!!ve),workerToken:Y.workerToken,vid:Y.vid,ticket:Y.appTicket,responseTime:K}}),($,Y)=>(Se.apworkerEvent(D,{success:!0,sc:200,serviceName:V,responseDetail:JSON.stringify($.addressList),firstSuccess:0===Y,responseTime:K,serverIp:g[Y%g.length]}),!1),($,Y)=>(Se.apworkerEvent(D,{success:!1,sc:$.data&&$.data.code||200,serviceName:V,responseTime:K,serverIp:g[Y%g.length]}),!!($.code!==x.OPERATION_ABORTED&&$.code!==x.UNEXPECTED_RESPONSE||$.data&&$.data.retry)&&(ee=g[(Y+1)%g.length],!0)),b)}(d,i,r,a);l.emit(Xo.STATE_CHANGE,Sd.AP_CONNECTED);const{addressList:p,ticket:m}=h;return l._ticket=m,p})()}connectWorker(i){var r=this;return M(function*(){r.emit(Xo.STATE_CHANGE,Sd.CONNECT_WORKER),yield r._workerConnection.init(i,1e4)})()}handleWorkerEvents(){var i=this;this._workerConnection.on(Me.CONNECTED,M(function*(){i.emit(Xo.STATE_CHANGE,Sd.WORKER_CONNECTED,i._workerConnection.url),i.connectionState=Pr.CONNECTED})),this._workerConnection.on(Me.CLOSED,()=>{this.connectionState=Pr.CLOSED}),this._workerConnection.on(Me.FAILED,()=>{this.connectionState=Pr.CLOSED}),this._workerConnection.on(Me.RECONNECTING,()=>{this.connectionState=this.connectionState===Pr.CONNECTED?Pr.RECONNECTING:Pr.CONNECTING}),this._workerConnection.on(Me.ON_MESSAGE,function(){var r=M(function*(a){if(a.data instanceof ArrayBuffer){const l=function U3(s){return function(r){let a={};e:for(;!j3(r);){let l=Tc(r);switch(l>>>3){case 0:break e;case 1:a.code=Tc(r);break;case 2:a.msg=um(r,Tc(r));break;case 3:a.requestId=um(r,Tc(r));break;case 4:a.timestamp=Dv(r,!1);break;default:V3(r,7&l)}}return a}({bytes:i=s,offset:0,limit:i.length});var i}(new Uint8Array(a.data));j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&w.debug("[".concat(i._moderationId,"] Response message for worker of image moderation "),JSON.stringify(l)),i._uploadNum++,void 0===l.code||0===l.code||(i._uploadFailedNum++,w.error("[".concat(i._moderationId,"] Error response from worke, code is ").concat(l.code,", msg is ").concat(l.msg)),i._uploadTimer||(i._uploadTimer=window.setTimeout(()=>{Se.reportApiInvoke(i._connectInfo.sid||null,{name:On.IMAGE_MODERATION_UPLOAD,options:[i._uploadFailedNum,i._uploadNum,l.code],tag:Xt.TRACER}).onError(new W(x.IMAGE_MODERATION_UPLOAD_FAILED,l.msg)),i._uploadTimer=null},j("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else w.error("[".concat(i._moderationId,"] Unexpected message type from worker"))});return function(a){return r.apply(this,arguments)}}()),this._workerConnection.on(Me.WILL_RECONNECT,(r,a,l)=>{"recover"===r&&l(r),l("tryNext")}),this._workerConnection.on(Me.REQUEST_NEW_URLS,(r,a)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(a)})}static intToLong(i){return{low:i|=0,high:i>>31,unsigned:i>=0}}requestToInspectImage(){var i=this;return M(function*(){const r=gr(i,Xo.CLIENT_LOCAL_VIDEO_TRACK),a={appId:i._connectInfo.appId,cname:i._connectInfo.cname,cid:i._connectInfo.cid,sid:i._connectInfo.sid,uid:i._connectInfo.uid,vid:i._connectInfo.vid};if(r){if(!r.isPlaying)return void(j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&w.debug("Only the track being played can be inspected"));i._sequence++;const l=yield i.generateRequestData(r,a);i._workerConnection.sendMessage(l,!0,!0)}else j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&w.debug("Only the track being published can be inspected")})()}generateRequestData(i,r){var a=this;return M(function*(){let{appId:l,cname:d,cid:h,vid:p,sid:m,uid:g}=r;const E=Date.now(),y=yield i.getCurrentFrameImage("image/jpeg",a.quality),b=yield OL(y,l,d),T=a._sequence+"-"+h+"-"+g+"-"+E+"-"+Fe(12,""),O={appId:l,cid:h,cname:d,deviceId:"",elapse:J0.intToLong(Number(E-a._moderationStartTime)),fileSize:y.buffer.byteLength,height:y.height,width:y.width,jpg:b,networkType:6,osType:7,requestId:T,sdkVersion:"4.19.2",sequence:a._sequence,sid:m,timestamp:q2(E),uid:g,vid:p,service:a._moderationMode,ticket:a._ticket},P=function F3(s){let i=function(){const r=B3.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(r,a){let l=r.appId;void 0!==l&&(Rn(a,10),Kh(a,l));let d=r.cid;void 0!==d&&(Rn(a,16),Rn(a,d));let h=r.cname;void 0!==h&&(Rn(a,26),Kh(a,h));let p=r.deviceId;void 0!==p&&(Rn(a,34),Kh(a,p));let m=r.elapse;void 0!==m&&(Rn(a,40),Ml(a,m));let g=r.fileSize;void 0!==g&&(Rn(a,48),Ml(a,dm(g)));let E=r.height;void 0!==E&&(Rn(a,56),Ml(a,dm(E)));let y=r.jpg;void 0!==y&&(Rn(a,66),Rn(a,y.length),z2(a,y));let b=r.networkType;void 0!==b&&(Rn(a,72),Ml(a,dm(b)));let T=r.osType;void 0!==T&&(Rn(a,80),Ml(a,dm(T)));let O=r.requestId;void 0!==O&&(Rn(a,90),Kh(a,O));let P=r.sdkVersion;void 0!==P&&(Rn(a,98),Kh(a,P));let D=r.sequence;void 0!==D&&(Rn(a,104),Ml(a,dm(D)));let L=r.sid;void 0!==L&&(Rn(a,114),Kh(a,L));let B=r.timestamp;void 0!==B&&(Rn(a,120),Ml(a,B));let V=r.uid;void 0!==V&&(Rn(a,128),Rn(a,V));let Q=r.vid;void 0!==Q&&(Rn(a,136),Rn(a,Q));let se=r.width;void 0!==se&&(Rn(a,144),Ml(a,dm(se)));let K=r.service;void 0!==K&&(Rn(a,152),Rn(a,K));let ee=r.callbackData;void 0!==ee&&(Rn(a,162),Rn(a,ee.length),z2(a,ee));let $=r.ticket;void 0!==$&&(Rn(a,170),Kh(a,$))}(s,i),function(r){let a=r.bytes,l=r.limit;return a.length===l?a:a.subarray(0,l)}(i)}(O);if(P.byteLength<a._workerMessageLengthLimit){if(j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const D=function(L){for(var B=1;B<arguments.length;B++){var V=null!=arguments[B]?arguments[B]:{};B%2?zN(Object(V),!0).forEach(function(Q){C(L,Q,V[Q])}):Object.getOwnPropertyDescriptors?Object.defineProperties(L,Object.getOwnPropertyDescriptors(V)):zN(Object(V)).forEach(function(Q){Object.defineProperty(L,Q,Object.getOwnPropertyDescriptor(V,Q))})}return L}({},O);delete D.jpg,w.debug("[".concat(a._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(D))}return P}return a.quality=a.quality*a._qualityRatio,yield a.generateRequestData(i,{appId:l,cname:d,cid:h,vid:p,sid:m,uid:g})})()}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=vr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Pr.CLOSED,this.emit(Xo.STATE_CHANGE,Sd.CLOSED)}}function qN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function pm(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?qN(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):qN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class Gi extends cC{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var i,r;return null!==(i=null===(r=this.peerConnection.getReceivers()[0])||void 0===r||null===(r=r.transport)||void 0===r?void 0:r.state)&&void 0!==i?i:null}constructor(i,r,a){super(i,r),C(this,"direction",void 0),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"transportEventReceiver",void 0),C(this,"statsFilter",void 0),C(this,"localCandidateCount",0),C(this,"allCandidatesReceived",!1),C(this,"mutex",new Zn("P2PConnection-mutex")),C(this,"dataChannel",void 0),C(this,"onLocalCandidate",void 0),this.store=r,this.peerConnection=new RTCPeerConnection(Gi.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.direction=a??yd.SEND_ONLY,this.dataChannel=this.peerConnection.createDataChannel("agora-p2p-signal",{ordered:!0}),this.statsFilter=Sv(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,Wt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}establish(i){var r=this;return M(function*(){try{if(i){yield r.peerConnection.setRemoteDescription({type:"offer",sdp:i});const a=yield r.peerConnection.createAnswer();if(yield r.peerConnection.setLocalDescription(a),!a.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");return a.sdp}{const a=yield r.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");return yield r.peerConnection.setLocalDescription(a),a.sdp}}catch(a){throw new J(x.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}})()}connect(i){var r=this;return M(function*(){try{yield r.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(a){throw new J(x.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(a.toString()))}})()}addRemoteCandidate(i){var r=this;return M(function*(){try{yield r.peerConnection.addIceCandidate(i)}catch(a){throw new J(x.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(a.toString()))}})()}send(i){var r=this;return M(function*(){try{const a=[];i.forEach(h=>{const p=r.peerConnection.addTransceiver(h._mediaStreamTrack,{direction:"sendonly"});a.push(p)}),Wt()&&!0===j("SIMULCAST")&&(yield r.applySimulcastForFirefox(a,i)),yield r.applySimulcastEncodings(a,i),yield r.applySendEncodings(a,i);const l=yield r.peerConnection.createOffer();if(yield r.peerConnection.setLocalDescription(l),!l.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");const d=a.map(h=>{const p=r.getLocalSSRC(h.mid,l.sdp);if(!p)throw new Error("Cannot get ssrc when trying to send PeerConnection.");return{mid:h.mid,localSSRC:[{ssrcId:p}]}});return{sdp:l.sdp,trackMessage:d}}catch(a){throw a instanceof J?a:new J(x.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}})()}stopSending(i,r){var a=this;return M(function*(){const l=r?void 0:yield a.mutex.lock("From P2PConnection.stopSending");try{const d=a.peerConnection.getTransceivers().filter(p=>-1!==i.indexOf(p.mid));if(d.length!==i.length)throw new Error("Transceivers' length (".concat(d.length,") doesn't match mids' length (").concat(i.length,") when trying to call P2PConnection.stopSending."));d.map(p=>{var m;p.direction="inactive",null===(m=p.stop)||void 0===m||m.call(p),a.peerConnection.removeTrack(p.sender)});const h=yield a.peerConnection.createOffer();if(yield a.peerConnection.setLocalDescription(h),!h.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");return h.sdp}catch(d){throw new J(x.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(d.toString()))}finally{l&&l()}})()}receive(i,r,a){var l=this;return M(function*(){try{yield l.peerConnection.setRemoteDescription({type:"offer",sdp:r});const d=yield l.peerConnection.createAnswer();if(!d.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");yield l.peerConnection.setLocalDescription(d),w.debug("[".concat(l.store.clientId,"] [P2PConnection] receive ").concat(i," by exchanging SDP."));const h=l.getRemoteMid(a,r);if(void 0===h)throw new Error("Cannot get transceiver mid when trying to receive track.");const p=l.peerConnection.getTransceivers().find(m=>m.mid===h);if(!p||null===p.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,mid:p.mid,sdp:d.sdp}}catch(d){throw new J(x.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}})()}setDescription(i,r){var a=this;return M(function*(){try{if("remote"===i){yield a.peerConnection.setRemoteDescription({type:"offer",sdp:r});const l=yield a.peerConnection.createAnswer();if(!l.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return yield a.peerConnection.setLocalDescription(l),w.debug("[".concat(a.store.clientId,"] [P2PConnection] exchanging SDP, type is ").concat(i)),l.sdp}yield a.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(l){throw new J(x.EXCHANGE_SDP_FAILED,"P2PConnection.setDescription failed; ".concat(l.toString()))}})()}stopReceiving(i,r){var a=this;return M(function*(){try{const l=a.peerConnection.getTransceivers().filter(h=>-1!==i.indexOf(h.mid));if(l.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");l.map(h=>{var p;h.direction="inactive",null===(p=h.stop)||void 0===p||p.call(h)}),yield a.peerConnection.setRemoteDescription({type:"offer",sdp:r});const d=yield a.peerConnection.createAnswer();if(yield a.peerConnection.setLocalDescription(d),!d.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return d.sdp}catch(l){throw new J(x.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(l.toString()))}})()}restartICE(){var i=this;return M(function*(){try{const r=yield i.peerConnection.createOffer({iceRestart:!0});if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");return i.store.descriptionStart(),yield i.peerConnection.setLocalDescription(r),r.sdp}catch(r){throw new J(x.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}})()}close(){var i;this.peerConnection.close(),null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}updateEncoderConfig(i,r){return M(function*(){})()}updateSendParameters(i,r){var a=this;return M(function*(){const l=a.peerConnection.getTransceivers().filter(d=>d.mid===i);1===l.length&&(a.isVP8Simulcast(r)?Wt()||(yield a.applySimulcastEncodings(l,[r])):yield a.applySendEncodings(l,[r]))})()}setStatsRemoteVideoIsReady(i,r){this.statsFilter.setVideoIsReady2(i,r)}replaceTrack(i,r){var a=this;return M(function*(){const l=a.peerConnection.getTransceivers().find(d=>d.mid===r);l&&(yield l.sender.replaceTrack(i._mediaStreamTrack))})()}getSelectedCandidatePair(){var i=this;return M(function*(){const r=i.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const a=r[0].transport.iceTransport,{local:l,remote:d}=a.getSelectedCandidatePair();return{local:pm(pm({},Ds),{},{candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port}),remote:pm(pm({},Ds),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})}}return i.statsFilter.getSelectedCandidatePair()})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;null===(i=this.onICEConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{var r;i.candidate&&(null===(r=this.onLocalCandidate)||void 0===r||r.call(this,i.candidate)),i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},j("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const r={iceServers:[]};return i.iceServers?r.iceServers=i.iceServers:i.turnServer&&"off"!==i.turnServer.mode&&(Da(i.turnServer.servers)?r.iceServers=i.turnServer.servers:(r.iceServers&&r.iceServers.push(...Gi.turnServerConfigToIceServers(i.turnServer.servers)),j("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&i.turnServer.serversFromGateway&&r.iceServers.push(...Gi.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),j("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),j("ENABLE_ENCODED_TRANSFORM")&&$e().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(i){const r=[];return i.forEach(a=>{a.tcpport&&(r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(sv(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}),r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=udp")}),r.push({username:a.username,credential:a.password,credentialType:"password",urls:"stun:".concat(a.turnServerURL,":").concat(a.tcpport)}))}),r}tryBindTransportEvents(i){const r=i.transport;if(r){this.transportEventReceiver=i,r.onstatechange=()=>{var l;null!=r&&r.state&&(null===(l=this.onDTLSTransportStateChange)||void 0===l||l.call(this,r.state))},r.onerror=l=>{var d;null===(d=this.onDTLSTransportError)||void 0===d||d.call(this,"error"in l?l.error:l)};const a=r.iceTransport;a&&(a.onstatechange=()=>{const l=r?.iceTransport.state;var d;l&&(null===(d=this.onICETransportStateChange)||void 0===d||d.call(this,l))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){const{local:l,remote:d}=a.getSelectedCandidatePair();w.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:l.type,protocol:l.protocol}),", remote ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(i,r){var a=this;return M(function*(){var l;if(r||(r=a.peerConnection.getSenders().find(y=>y.track===i._mediaStreamTrack)),!r)return w.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(a.isVP8Simulcast(i))return w.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!$e().supportSetRtpSenderParameters)return w.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(i._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(i._encoderConfig){var p;const{bitrateMax:y,frameRate:b,scaleResolutionDownBy:T}=i._encoderConfig;y&&(h.maxBitrate=1e3*y),ye(p=i._hints).call(p,Ot.LOW_STREAM)&&(b&&(h.maxFramerate=Cr(b)),T&&T>=1&&(h.scaleResolutionDownBy=T))}if(j("DSCP_TYPE")&&zs()){var m;const y=j("DSCP_TYPE");ye(m=["very-low","low","medium","high"]).call(m,y)&&(h.networkPriority=y)}const g=r.getParameters(),E=null===(l=g.encodings)||void 0===l?void 0:l[0];Wt()&&!E&&(d.encodings=[h]),E&&Object.assign(E,h),Object.assign(g,d),w.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),yield r.setParameters(g)})()}applySendEncodings(i,r){var a=this;return M(function*(){try{if(!$e().supportSetRtpSenderParameters||i.length!==r.length)return;for(let l=0;l<i.length;l++){const d=i[l],h=r[l];h instanceof ze&&!a.isVP8Simulcast(h)&&(yield a.updateRtpSenderEncodings(h,d.sender))}}catch{w.debug("[".concat(a.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(i,r,a){const l=cn.parse(i);return r.forEach((d,h)=>{const p=a[h],m=l.mediaDescriptions.find(g=>g.attributes.mid===p);m&&(Yd(m,d),P0(m,d,this.store.codec))}),cn.print(l)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,r,a)=>{var l;null===(l=this.onFirstVideoDecoded)||void 0===l||l.call(this,i,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var r;null===(r=this.onFirstVideoDecodedTimeout)||void 0===r||r.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(i,r){var a=this;return M(function*(){if(i.length===r.length)for(let g=0;g<i.length;g++){var l,d,h,p,m;const E=i[g],y=r[g];if(y instanceof ze&&!ye(l=y._hints).call(l,Ot.LOW_STREAM)&&null!==(d=y._encoderConfig)&&void 0!==d&&d.bitrateMax&&(null===(h=y._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(p=y._scalabilityMode)&&void 0!==p&&p.numSpatialLayers&&(null===(m=y._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===a.store.codec){const b={},T={high:1e3*(y._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{rid:"m",active:!0,maxBitrate:T.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:T.high}];const O=E.sender.getParameters();yield E.sender.setParameters(Object.assign(O,b))}}})()}applySimulcastEncodings(i,r){var a=this;return M(function*(){if(!Wt()&&i.length===r.length)for(let l=0;l<i.length;l++){const d=r[l];if(d instanceof ze&&a.isVP8Simulcast(d)){const h=i[l],p={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=h.sender.getParameters();yield h.sender.setParameters(Object.assign(g,p))}}})()}isVP8Simulcast(i){var r,a,l,d,h;return!!(i instanceof ze&&j("SIMULCAST")&&"vp8"===this.store.codec&&!ye(r=i._hints).call(r,Ot.LOW_STREAM)&&null!==(a=i._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(l=i._encoderConfig)||void 0===l?void 0:l.bitrateMax)>200&&null!==(d=i._scalabilityMode)&&void 0!==d&&d.numSpatialLayers&&(null===(h=i._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(i,r,a,l){if(j("SDP_LOGGING"))return w.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(r," SDP during P2PConnection.").concat(l,"\n"),i),"offer"===r?d=>{this.logSDPExchange(d,"answer","local"===a?"remote":"local",l)}:void 0}getLocalSSRC(i,r){var a,l;if(r=null!==(a=r)&&void 0!==a?a:null===(l=this.currentLocalDescription)||void 0===l?void 0:l.sdp){var d;const h=null===(d=cn.parse(r).mediaDescriptions.find(p=>p.attributes.mid===i))||void 0===d?void 0:d.attributes.ssrcs;return h?.[0].ssrcId}}getRemoteMid(i,r){var a,l,d;if(r=null!==(a=r)&&void 0!==a?a:null===(l=this.currentRemoteDescription)||void 0===l?void 0:l.sdp)return null===(d=cn.parse(r).mediaDescriptions.find(h=>h.attributes.ssrcs.some(p=>p.ssrcId===i)))||void 0===d?void 0:d.attributes.mid}getRemoteSSRC(i,r){var a=this;return M(function*(){var l,d;if(r=null!==(l=r)&&void 0!==l?l:null===(d=a.currentRemoteDescription)||void 0===d?void 0:d.sdp){var h;const p=null===(h=cn.parse(r).mediaDescriptions.find(m=>m.attributes.mid===i))||void 0===h?void 0:h.attributes.ssrcs;return p?.[0].ssrcId}})()}}function Oo(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=M(function*(){const l=this.mutex,d=yield l.lock("From P2PConnection.".concat(i));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield a.apply(this,p)}finally{d()}}),r}var cs;function K2(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function wc(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?K2(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):K2(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}te([Oo,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Gi.prototype,"establish",null),te([Oo,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Gi.prototype,"connect",null),te([Oo,N("design:type",Function),N("design:paramtypes",[RTCIceCandidate]),N("design:returntype",q)],Gi.prototype,"addRemoteCandidate",null),te([Oo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],Gi.prototype,"send",null),te([Oo,N("design:type",Function),N("design:paramtypes",[String,String,Number]),N("design:returntype",q)],Gi.prototype,"receive",null),te([Oo,N("design:type",Function),N("design:paramtypes",[String,String]),N("design:returntype",q)],Gi.prototype,"setDescription",null),te([Oo,N("design:type",Function),N("design:paramtypes",[Array,String]),N("design:returntype",q)],Gi.prototype,"stopReceiving",null),te([Oo,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",q)],Gi.prototype,"restartICE",null),te([Oo,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Gi.prototype,"close",null),te([Oo,N("design:type",Function),N("design:paramtypes",[String,Ri]),N("design:returntype",q)],Gi.prototype,"updateEncoderConfig",null),te([Oo,N("design:type",Function),N("design:paramtypes",[String,Ri]),N("design:returntype",q)],Gi.prototype,"updateSendParameters",null),te([Oo,N("design:type",Function),N("design:paramtypes",[Ri,String]),N("design:returntype",q)],Gi.prototype,"replaceTrack",null),function(s){s.SEND_ONLY="SEND_ONLY",s.RECEIVE_ONLY="RECEIVE_ONLY"}(cs||(cs={}));class ln extends zt{get state(){return this._state}set state(i){const r=this._state;this._state=i,this.emit(we.StateChange,r,this._state)}constructor(i,r){var a;super(),a=this,C(this,"store",void 0),C(this,"statsUploader",void 0),C(this,"sendConnection",void 0),C(this,"recvConnection",void 0),C(this,"localTrackMap",new Map),C(this,"remoteUserMap",new Map),C(this,"localDataChannels",[]),C(this,"pendingLocalTracks",[]),C(this,"pendingRemoteTracks",[]),C(this,"statsCollector",void 0),C(this,"dtlsFailedCount",0),C(this,"sendMutex",new Zn("P2PChannel2-send-mutex")),C(this,"recvMutex",new Zn("P2PChannel2-recv-mutex")),C(this,"_state",it.Disconnected),C(this,"_restartStates",["disconnected","failed"]),C(this,"_restartTimer",void 0),C(this,"handleMuteLocalTrack",function(){var l=M(function*(d,h,p){const m=yield a.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!a.sendConnection||a.state!==it.Connected)return void p(new J(x.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const y=a.filterTobeMutedTracks(d);if(0===y.length)return void h();const b=y.find(V=>"videoLowTrack"===V[0]);b&&b[1].track._originMediaStreamTrack.stop();let T=!1;var g,E;T="video"===d.trackMediaType?!(null===(g=a.localTrackMap.get(ne.LocalAudioTrack))||void 0===g||!g.track._muted):void 0===(null===(E=a.localTrackMap.get(ne.LocalVideoTrack))||void 0===E?void 0:E.id);const O=y.filter(V=>{let[Q,se]=V;return(Q!==ne.LocalAudioTrack||T)&&void 0!==se.id}).map(V=>{let[,Q]=V;return Q});let P;O.length>0&&(P=yield a.sendConnection.stopSending(O.map(V=>V.id)),O.forEach(V=>{V.id=void 0,V.ssrcs=void 0}));const D=a.createMuteMessage(y),L="video"===d.trackMediaType?ys.MUTE_LOCAL_VIDEO:ys.MUTE_LOCAL_AUDIO,B=yield Jt(a,we.RequestP2PMuteLocal,{action:L,sdp:P,message:D,isMuteAll:T});B&&(yield a.sendConnection.setDescription("local",B)),(P||"audio"===d.trackMediaType)&&(yield Et(a,we.RequestMuteLocal,D)),h()}catch(y){p(y)}finally{m()}});return function(d,h,p){return l.apply(this,arguments)}}()),C(this,"handleUnmuteLocalTrack",function(){var l=M(function*(d,h,p){const m=yield a.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!a.sendConnection||a.state!==it.Connected)return void p(new J(x.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const g=a.filterTobeUnmutedTracks(d);if(0===g.length)return void h();const E=a.createUnmuteMessage(g),y="video"===d.trackMediaType?ys.UNMUTE_LOCAL_VIDEO:ys.UNMUTE_LOCAL_AUDIO;yield Et(a,we.RequestP2PMuteLocal,{action:y,message:E}),h()}catch(g){p(g)}finally{m()}});return function(d,h,p){return l.apply(this,arguments)}}()),C(this,"handleUpdateVideoEncoder",function(){var l=M(function*(d,h,p){const m=yield a.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const g=a.localTrackMap.get(ne.LocalVideoTrack);if(!a.sendConnection||!g||g.track!==d||a.state!==it.Connected)return void h();const{id:E,track:y}=g;E&&(yield a.sendConnection.updateSendParameters(E,y),yield a.sendConnection.updateEncoderConfig(E,y),a.emit(we.UpdateVideoEncoder,y)),h()}catch(g){p(g)}finally{m()}});return function(d,h,p){return l.apply(this,arguments)}}()),C(this,"handleSetOptimizationMode",function(){var l=M(function*(d,h,p){const m=yield a.sendMutex.lock("Locking from P2PChannel2.handleSetOptimizationMode");try{const g=a.localTrackMap.get(ne.LocalVideoTrack);if(!a.sendConnection||!g||g.track!==d||a.state!==it.Connected)return;const{id:E,track:y}=g;E&&(yield a.sendConnection.updateSendParameters(E,y)),h()}catch(g){p(g)}finally{m()}});return function(d,h,p){return l.apply(this,arguments)}}()),C(this,"handleReplaceTrack",function(){var l=M(function*(d,h,p,m){let g;w.debug("[".concat(a.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(d.getTrackId(),"]")),"boolean"==typeof m&&m||(g=yield a.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var E;const b=Array.from(a.localTrackMap.entries()).find(T=>{let[,{track:O}]=T;return d===O});if(!a.sendConnection||!b||void 0===b[1].id||a.state!==it.Connected)return void h();if(yield null===(E=a.sendConnection)||void 0===E?void 0:E.replaceTrack(d,b[1].id),b[0]===ne.LocalVideoTrack&&$e().supportDualStreamEncoding){const T=a.localTrackMap.get(ne.LocalVideoLowTrack);if(T){const O=d._mediaStreamTrack.clone();T.track._originMediaStreamTrack.stop(),T.track._mediaStreamTrack=O,T.track._originMediaStreamTrack=O,yield new q((P,D)=>{a.handleReplaceTrack(T.track,P,D,!0)})}}h()}catch(b){p(b)}finally{var y;null===(y=g)||void 0===y||y()}});return function(d,h,p,m){return l.apply(this,arguments)}}()),C(this,"handleGetLocalVideoStats",l=>{l(this.statsCollector.getLocalVideoTrackStats())}),C(this,"handleGetLocalAudioStats",l=>{l(this.statsCollector.getLocalAudioTrackStats())}),C(this,"handleGetRemoteVideoStats",l=>this.statsCollector.getRemoteVideoTrackStats(l.uid)[l.uid]),C(this,"handleGetRemoteAudioStats",l=>this.statsCollector.getRemoteAudioTrackStats(l.uid)[l.uid]),this.store=i,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new ai,this.bindStatsUploaderEvents()}startP2PConnection(i,r){return M(function*(){throw new J(x.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")})()}connect(i,r,a,l,d,h){return M(function*(){throw new J(x.NOT_SUPPORTED,"p2p mode does not support connect.")})()}startP2P(i,r){var a=this;return M(function*(){if(a.state=it.New,a.sendConnection&&(w.warning("[".concat(a.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),a.sendConnection.close(),a.unbindConnectionEvents(a.sendConnection)),a.recvConnection&&(w.warning("[".concat(a.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),a.recvConnection.close(),a.unbindConnectionEvents(a.recvConnection)),a.sendConnection=new Gi(i,a.store),a.bindConnectionEvents(a.sendConnection),a.recvConnection=new Gi(i,a.store,yd.RECEIVE_ONLY),a.bindConnectionEvents(a.recvConnection),r){a.store.peerConnectionStart(),yield a.recvConnection.establish(r);const l=yield a.sendConnection.establish(r);return a.statsUploader.startUploadTransportStats(!0),a.statsUploader.startUploadExtensionUsageStats(),a.state=it.Connected,l}return yield a.recvConnection.establish(r),a.sendConnection.establish(r)})()}p2pConnect(i){var r=this;return M(function*(){if(!r.sendConnection||!r.recvConnection)throw new J(x.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.startP2PConnection .");r.store.peerConnectionStart(),yield r.recvConnection.connect(i),yield r.sendConnection.connect(i),r.statsUploader.startUploadTransportStats(),r.statsUploader.startUploadExtensionUsageStats(),r.state=it.Connected})()}addRemoteCandidate(i){var r=this;return M(function*(){if(!r.sendConnection||!r.recvConnection)throw new J(x.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");yield r.recvConnection.addRemoteCandidate(i),yield r.sendConnection.addRemoteCandidate(i)})()}publish(i,r,a){var l=this;return M(function*(){if(!l.sendConnection||l.state!==it.Connected){l.throwIfTrackTypeNotMatch(i);const p=i.filter(m=>-1===l.pendingLocalTracks.indexOf(m));return void(l.pendingLocalTracks=l.pendingLocalTracks.concat(p))}l.store.pubId=l.store.pubId+1,Di.markPublishStart(l.store.clientId,l.store.pubId);const d=l.filterTobePublishedTracks(i,r,a);if(0===d.length)return void(yield l.tryToUnmuteAudio(i));d.forEach(p=>{let{track:m,type:g}=p;const E=Date.now();l.store.publish(m.getTrackId(),g===ne.LocalAudioTrack?"audio":"video",E)}),l.bindLocalTrackEvents(d);const h=l.createGatewayPublishMessage(d);return l.assignLocalTracks(d),d.forEach(p=>{let{track:m,type:g}=p;const E=Date.now();l.store.publish(m.getTrackId(),g===ne.LocalAudioTrack?"audio":"video",void 0,E)}),h})()}dopublish(i){var r=this;return M(function*(){if(!r.sendConnection||r.state!==it.Connected)return;const a=r.localTrackMap.get(i);if(a){const{sdp:l,trackMessage:d}=yield r.sendConnection.send([a.track]),{mid:h,localSSRC:p}=d[0];a.id=h,a.ssrcs=p,r.statsCollector.addLocalStats(i),r.statsUploader.startUploadUplinkStats();const m=yield Jt(r,we.RequestP2PPublish,{kind:i===ne.LocalAudioTrack?Ee.AUDIO:Ee.VIDEO,sdp:l,ssrcId:p[0].ssrcId});yield r.sendConnection.setDescription("local",m);const g=r.createUnmuteMessage([[i,a]]);yield Et(r,we.RequestUnmuteLocal,g)}})()}setDescription(i,r){var a=this;return M(function*(){let l,d;"local"===i?(l=yield a.sendMutex.lock("From P2PChannel.restartICE"),d=a.sendConnection):(l=yield a.recvMutex.lock("From P2PChannel.restartICE"),d=a.recvConnection);try{return d&&a.state===it.Connected?yield d.setDescription(i,r):void 0}finally{l()}})()}publishLowStream(i){return as(function*(){throw new J(x.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}republish(){var i=this;return M(function*(){i.pendingLocalTracks.length>0&&(w.debug("[".concat(i.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield Jt(i,we.RequestRePublish,i.pendingLocalTracks),i.emit(we.MediaReconnectEnd,i.store.uid),i.pendingLocalTracks=[])})()}unpublish(i){var r=this;return M(function*(){if(!r.sendConnection||r.state!==it.Connected)return void(0===i.length?r.pendingLocalTracks.length=0:r.pendingLocalTracks=r.pendingLocalTracks.filter(g=>!ye(i).call(i,g)));const a=r.filterTobeUnpublishedTracks(i);if(0===a.length)return;r.unbindLocalTrackEvents(a.map(g=>{let[E,{track:y}]=g;return{type:E,track:y}}));const l=a.filter(g=>{let[,{id:E}]=g;return void 0!==E});if(!r.sendConnection||r.state!==it.Connected)return void i.forEach(g=>{const E=r.pendingLocalTracks.indexOf(g);-1!==E&&r.pendingLocalTracks.splice(E,1)});const d=a.find(g=>"videoLowTrack"===g[0]);let h;d&&d[1].track.close();const p=r.createGatewayUnpublishMessage(a);l.length>0&&(h=yield r.sendConnection.stopSending(l.map(g=>{let[,{id:E}]=g;return E}))),r.withdrawLocalTracks(a),r.unbindLocalTrackEvents(a.map(g=>{let[E,{track:y}]=g;return{type:E,track:y}})),a.forEach(g=>{let[E]=g;r.statsCollector.removeLocalStats(E)}),0===r.localTrackMap.size&&r.statsUploader.stopUploadUplinkStats();const m=r.createMuteMessage(a);return yield q.all(m.map(function(){var g=M(function*(E){yield Et(r,we.RequestMuteLocal,[E])});return function(E){return g.apply(this,arguments)}}())),{sdp:h,unpubMsg:p}})()}unpublishLowStream(){return M(function*(){throw new J(x.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")})()}doUnpublish(i){var r=this;return M(function*(){if(!r.sendConnection||r.state!==it.Connected)return;const a=[];if(i!==Ee.AUDIO){const l=r.localTrackMap.get(ne.LocalVideoTrack);void 0!==l?.id&&a.push([ne.LocalVideoTrack,l]);const d=r.localTrackMap.get(ne.LocalVideoLowTrack);void 0!==d?.id&&a.push([ne.LocalVideoLowTrack,d]),r.statsCollector.removeLocalStats(ne.LocalVideoTrack),r.statsCollector.removeLocalStats(ne.LocalVideoLowTrack)}if(i!==Ee.VIDEO){const l=r.localTrackMap.get(ne.LocalAudioTrack);void 0!==l?.id&&a.push([ne.LocalAudioTrack,l]),r.statsCollector.removeLocalStats(ne.LocalAudioTrack)}if(a.length>0){const l=yield r.sendConnection.stopSending(a.map(p=>{let[,m]=p;return m.id}));a.forEach(p=>{let[,m]=p;m.id=void 0,m.ssrcs=void 0});const d=yield Jt(r,we.RequestP2PUnPublish,{sdp:l,kind:i});yield r.sendConnection.setDescription("local",d);const h=r.createMuteMessage(a);yield q.all(h.map(function(){var p=M(function*(m){yield Et(r,we.RequestMuteLocal,[m])});return function(m){return p.apply(this,arguments)}}()))}})()}subscribe(i,r,a,l){var d=this;return M(function*(){var h;if(!d.recvConnection||d.state!==it.Connected)throw new J(x.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(h=d.remoteUserMap.get(i))&&void 0!==h&&h.has(r))return;const{track:p,mid:m,sdp:g}=yield d.recvConnection.receive(r,a,l);r===Ee.AUDIO?(i._audioSSRC=l,i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(p):(i._audioTrack=new Co(p,i.uid,i._uintid,d.store),w.info("[".concat(d.store.clientId,"] [").concat(d.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),d.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoSSRC=l,i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(p):(i._videoTrack=new Cs(p,i.uid,i._uintid,d.store),w.info("[".concat(d.store.clientId,"] [").concat(d.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),d.bindRemoteTrackEvents(i,i._videoTrack));const E=d.remoteUserMap.get(i);E?E.set(r,m):d.remoteUserMap.set(i,new Map([[r,m]])),d.statsCollector.addRemoteStats(i.uid),d.statsUploader.startUploadDownlinkStats(),yield Et(d,we.RequestP2PUnmuteRemote,r);const y=d.pendingRemoteTracks.findIndex(b=>{let{user:T,kind:O}=b;return T.uid===i.uid&&r===O});return-1!==y&&(d.pendingRemoteTracks.splice(y,1),d.emit(we.MediaReconnectEnd,i.uid)),g})()}unsubscribe(i,r,a,l){var d=this;return M(function*(){const h=d.pendingRemoteTracks.filter(g=>{let{user:E,kind:y}=g;return void 0!==a?E.uid===i.uid&&a===y:E.uid===i.uid});if(h.forEach(g=>{const E=d.pendingRemoteTracks.indexOf(g);d.pendingRemoteTracks.splice(E,1)}),d.recvConnection&&d.state===it.Connected||l||h.forEach(g=>{let{kind:E}=g;var y;if(E===Ee.AUDIO)null===(y=i._audioTrack)||void 0===y||y._destroy(),i._audioTrack=void 0;else if(E===Ee.VIDEO){var b;null===(b=i._videoTrack)||void 0===b||b._destroy(),i._videoTrack=void 0}}),!d.recvConnection||d.state!==it.Connected)return;const p=d.filterTobeUnSubscribedTracks(i,a);if(0===p.length)return void(a!==Ee.VIDEO&&Et(d,we.RequestP2PMuteRemote,Ee.AUDIO));const m=yield d.recvConnection.stopReceiving(p.map(g=>{let[,{id:E}]=g;return E}),r);return d.withdrawRemoteTracks(p),0===d.remoteUserMap.size&&d.statsUploader.stopUploadDownlinkStats(),p.forEach(g=>{let[E,{kind:y}]=g;var b,T;if(y===Ee.VIDEO&&E._videoSSRC&&(null===(b=d.recvConnection)||void 0===b||b.setStatsRemoteVideoIsReady(E._videoSSRC,!1)),y===Ee.VIDEO)d.unbindRemoteTrackEvents(E._videoTrack),l||(null===(T=E._videoTrack)||void 0===T||T._destroy(),E._videoTrack=void 0);else if(y===Ee.AUDIO){var O;d.unbindRemoteTrackEvents(E._audioTrack),!l&&(null===(O=E._audioTrack)||void 0===O||O._destroy(),E._audioTrack=void 0)}}),p.filter(g=>{let[,{kind:E}]=g;return E!==Ee.AUDIO}).forEach(g=>{let[,{kind:E}]=g;Et(d,we.RequestP2PMuteRemote,E)}),a!==Ee.VIDEO&&Et(d,we.RequestP2PMuteRemote,Ee.AUDIO),m})()}getAllDataChannels(){return this.localDataChannels}massSubscribe(i){return M(function*(){throw new J(x.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")})()}massSubscribeNoLock(i){return M(function*(){throw new J(x.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")})()}massUnsubscribe(i){return M(function*(){throw new J(x.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")})()}massUnsubscribeNoLock(i){return M(function*(){throw new J(x.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")})()}muteRemote(i,r){var a=this;return M(function*(){if(!a.recvConnection)return;const l=a.remoteUserMap.get(i);if(!l)return void w.warning("[".concat(a.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(i.uid,"."));if(!l.get(r))return void w.warning("[".concat(a.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(i.uid," media type ").concat(r,"."));const d=r===Ee.VIDEO?i._videoSSRC:i._audioSSRC;void 0!==d&&a.recvConnection.setStatsRemoteVideoIsReady(d,!1)})()}unmuteRemote(i,r){var a=this;return M(function*(){return a.unmuteRemoteNoLock(i,r)})()}unmuteRemoteNoLock(i,r){var a=this;return M(function*(){if(!a.recvConnection)return;const l=a.remoteUserMap.get(i);l?l.get(r)||w.warning("[".concat(a.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(i.uid," media type ").concat(r,".")):w.warning("[".concat(a.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(i.uid,"."))})()}getAllTracks(i){const r=this.localTrackMap.get(ne.LocalAudioTrack);if(r?.track instanceof wn){const a=r.track;return Array.from(this.localTrackMap.entries()).filter(l=>{let[d]=l;return d!==ne.LocalAudioTrack}).filter(l=>{let[d]=l;return!(i&&d===ne.LocalVideoLowTrack)}).map(l=>{let[,{track:d}]=l;return d}).concat(a.trackList)}return Array.from(this.localTrackMap.entries()).filter(a=>{let[l]=a;return!(i&&l===ne.LocalVideoLowTrack)}).map(a=>{let[,{track:l}]=a;return l})}reportPublishEvent(i,r,a,l,d){if(i){const p=this.localTrackMap.get(ne.LocalAudioTrack),m=this.localTrackMap.get(l?ne.LocalVideoLowTrack:ne.LocalVideoTrack);Se.publish(this.store.sessionId,{eventElapse:Di.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:i,ec:r,audioName:p?.track.getTrackLabel(),videoName:m?.track.getTrackLabel(),screenshare:-1!==m?.track._hints.indexOf(Ot.SCREEN_TRACK),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}else{var h;a||(a=[]);const p=a.find(g=>g instanceof mt),m=l?null===(h=this.localTrackMap.get(ne.LocalVideoTrack))||void 0===h?void 0:h.track:a.find(g=>g instanceof ze);Se.publish(this.store.sessionId,{eventElapse:Di.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:i,ec:r,audioName:p?.getTrackLabel(),videoName:m?.getTrackLabel(),screenshare:-1!==m?._hints.indexOf(Ot.SCREEN_TRACK),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}}reportSubscribeEvent(i,r,a,l){const d=l===Ee.VIDEO?a._videoSSRC:a._audioSSRC;d&&Se.subscribe(this.store.sessionId,{succ:i,ec:r,video:l===Ee.VIDEO,audio:l===Ee.AUDIO,peerid:a.uid,subscribeRequestid:l===Ee.VIDEO?a._videoSSRC:a._audioSSRC,p2pid:this.store.p2pId,eventElapse:Di.measureFromSubscribeStart(this.store.clientId,d)})}reset(){w.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Zn("P2PChannel2-send-mutex"),this.sendMutex=new Zn("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const i=this.localTrackMap.get(ne.LocalAudioTrack);if(i?.track instanceof wn){if(i.track.trackList.length>0){const r=i.track;i.track.trackList.forEach(a=>{r.removeAudioTrack(a)})}i.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=it.Disconnected}getStats(i){var r,a;return i?null===(a=this.recvConnection)||void 0===a?void 0:a.getStats():null===(r=this.sendConnection)||void 0===r?void 0:r.getStats()}getRemoteVideoIsReady(i){var r;return(null===(r=this.recvConnection)||void 0===r?void 0:r.getRemoteVideoIsReady(i))||!1}getLocalAudioVolume(){const i=this.localTrackMap.get(ne.LocalAudioTrack);if(i)return i.track.getVolumeLevel()}getLocalVideoSize(){const i=this.localTrackMap.get(ne.LocalVideoTrack);if(i)return{width:i.track._videoWidth||0,height:i.track._videoHeight||0}}getEncoderConfig(i){const r=this.localTrackMap.get(i);return r&&r.track instanceof ze||r&&r.track instanceof mt?r.track._encoderConfig:void 0}getLocalMedia(i){return this.localTrackMap.get(i)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(i,r){if(!i)return this.remoteUserMap.size>0;const a=this.remoteUserMap.get(i);return!!a&&(!r||a.has(r))}hasRemoteMediaWithLock(i,r){var a=this;return M(function*(){if(!i)return a.remoteUserMap.size>0;const l=a.remoteUserMap.get(i);return!!l&&(!r||l.has(r))})()}getRemoteMedia(i){var r;const a=Array.from(zr(r=this.remoteUserMap).call(r)).find(l=>l.uid===i);return a?{audioTrack:a.audioTrack,audioSSRC:a._audioSSRC,videoTrack:a.videoTrack,videoSSRC:a._videoSSRC}:{}}getAudioLevels(){let i=Array.from(this.remoteUserMap.entries()).map(a=>{let[l]=a;return{uid:l.uid,level:l.audioTrack?100*l.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(ne.LocalAudioTrack);return r&&i.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),i=tl(i).call(i,(a,l)=>a.level-l.level),i}disconnectForReconnect(){var i=this;return M(function*(){i.sendConnection&&i.recvConnection&&(w.debug("[".concat(i.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),i.state=it.Reconnecting,j("KEEP_LAST_FRAME")&&0!==i.remoteUserMap.size&&Array.from(i.remoteUserMap.entries()).forEach(r=>{let[a]=r;var l;a._videoTrack&&a._videoTrack._player&&(null===(l=a._videoTrack._player.getVideoElement())||void 0===l||l.pause(),a._videoTrack._player.isKeepLastFrame=!0,a._videoTrack._originMediaStreamTrack.stop())}),i.sendConnection.close(),i.unbindConnectionEvents(i.sendConnection),i.sendConnection=void 0,i.recvConnection.close(),i.unbindConnectionEvents(i.recvConnection),i.recvConnection=void 0,0!==i.localTrackMap.size&&(Array.from(i.localTrackMap.entries()).forEach(r=>{var a;let[l,{track:d}]=r;switch(l){case ne.LocalVideoTrack:ye(a=d._hints).call(a,Ot.LOW_STREAM)?d.close():i.pendingLocalTracks.push(d);break;case ne.LocalAudioTrack:d instanceof wn?i.pendingLocalTracks=i.pendingLocalTracks.concat(d.trackList):i.pendingLocalTracks.push(d)}}),i.emit(we.MediaReconnectStart,i.store.uid)),i.unbindLocalTrackEvents(),i.localTrackMap.clear(),0!==i.remoteUserMap.size&&Array.from(i.remoteUserMap.entries()).forEach(r=>{let[a,l]=r;Array.from(zr(l).call(l)).forEach(d=>{i.setPendingRemoteMedia(a,d)}),i.emit(we.MediaReconnectStart,a.uid)}),i.unbindAllRemoteTrackEvents(),i.remoteUserMap.clear(),i.statsUploader.stopUploadUplinkStats(),i.statsUploader.stopUploadDownlinkStats(),i.statsUploader.stopUploadTransportStats(),w.debug("[".concat(i.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))})()}hasPendingRemoteMedia(i,r){for(const a of this.pendingRemoteTracks){const{user:l,kind:d}=a;if((i instanceof Oi?i.uid:i)===l.uid&&r===d)return!0}return!1}setPendingRemoteMedia(i,r){this.hasPendingRemoteMedia(i,r)||this.pendingRemoteTracks.push({user:i,kind:r})}restartICE(i){var r=this;return M(function*(){let a;a=i.direction===yd.SEND_ONLY?yield r.sendMutex.lock("From P2PChannel.restartICE"):yield r.recvMutex.lock("From P2PChannel.restartICE");try{const l=yield i.restartICE(),d=yield Jt(r,we.RequestP2PRestartICE,l);i.setDescription("local",d)}finally{a()}})()}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const i=this.sendConnection.getStats(),r=this.localTrackMap.get(ne.LocalVideoTrack),a=this.localTrackMap.get(ne.LocalAudioTrack),l=i.videoSend.find(O=>{var P;return O.ssrc===(null==r||null===(P=r.ssrcs)||void 0===P?void 0:P[0].ssrcId)}),d=i.audioSend.find(O=>{var P;return O.ssrc===(null==a||null===(P=a.ssrcs)||void 0===P?void 0:P[0].ssrcId)});if(!l||!d)return 1;const h=gr(this,we.NeedSignalRTT),p=l?l.rttMs:void 0,m=d?d.rttMs:void 0,g=p&&m?(p+m)/2:p||m,y=100*i.sendPacketLossRate*.7/50+.3*((g&&h?(g+h)/2:g||h)||0)/1500,b=y<.17?1:y<.36?2:y<.59?3:y<.1?4:5,T=r?.track;if(T&&T._encoderConfig&&-1===T._hints.indexOf(Ot.SCREEN_TRACK)){const O=T._encoderConfig.bitrateMax,P=i.bitrate.actualEncoded;if(O&&P){const D=(1e3*O-P)/(1e3*O);return ND[D<.15?0:D<.3?1:D<.45?2:D<.6?3:4][b]}}return b}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const i=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(a=>{let[l]=a;const d=l._audioSSRC,h=l._videoSSRC,p=i.audioRecv.find(P=>P.ssrc===d),m=i.videoRecv.find(P=>P.ssrc===h);if(!p&&!m)return void(r+=1);const g=gr(this,we.NeedSignalRTT),E=i.rtt,y=(E&&g?(E+g)/2:E||g)||0,b=p?p.jitterMs:void 0,T=i.recvPacketLossRate;let O=.7*T*100/50+.3*y/1500;b&&(O=.6*T*100/50+.2*y/1500+.2*b/400),r+=O<.1?1:O<.17?2:O<.36?3:O<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}muteLocalTrack(i){var r=this;return M(function*(){return new q((a,l)=>{r.handleMuteLocalTrack(i,a,l)})})()}filterTobePublishedTracks(i,r,a){const l=[],d=$e(),h=this.getAllTracks();i=lh(i=i.filter(g=>-1===h.indexOf(g)));let p=!1,m=!1;for(const g of i){if(g instanceof ze&&(this.localTrackMap.has(ne.LocalVideoTrack)||p?new J(x.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(l.push({track:g,type:ne.LocalVideoTrack}),p=!0),r)){const E=this.getLowVideoTrack(g,a);l.push({track:E,type:ne.LocalVideoLowTrack})}if(g instanceof mt){const E=this.localTrackMap.get(ne.LocalAudioTrack);if(E){if(!(E.track instanceof wn))throw new J(x.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new J(x.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0)}else if(m){const y=l.find(b=>{let{type:T}=b;return T===ne.LocalAudioTrack});if(!(y.track instanceof wn))throw new J(x.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new J(x.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");y.track.addAudioTrack(g)}else{if(!d.webAudioMediaStreamDest||g instanceof wn||g._bypassWebAudio)l.push({track:g,type:ne.LocalAudioTrack});else{const y=new wn;y.addAudioTrack(g),l.push({track:y,type:ne.LocalAudioTrack})}m=!0}}}return l}filterTobeUnpublishedTracks(i){const r=[],a=this.getAllTracks();i=lh(i=i.filter(l=>-1!==a.indexOf(l)));for(const l of i){if(l instanceof mt){const d=this.localTrackMap.get(ne.LocalAudioTrack);if(!d)continue;d.track instanceof wn?(d.track.removeAudioTrack(l),this.unbindLocalAudioTrackEvents(l),0===d.track.trackList.length&&(r.push([ne.LocalAudioTrack,d]),d.track.close())):r.push([ne.LocalAudioTrack,d])}if(l instanceof ze){const d=this.localTrackMap.get(ne.LocalVideoTrack);if(!d)continue;r.push([ne.LocalVideoTrack,d]);const h=this.localTrackMap.get(ne.LocalVideoLowTrack);h&&r.push([ne.LocalVideoLowTrack,h])}}return r}bindLocalTrackEvents(i){i.forEach(r=>{let{track:a,type:l}=r;switch(l){case ne.LocalVideoTrack:a.addListener(me.GET_STATS,this.handleGetLocalVideoStats),a.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.addListener(me.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),a.addListener(me.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),a.addListener(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),a.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.bindLocalAudioTrackEvents(a)}})}bindLocalAudioTrackEvents(i,r){i instanceof wn?i.trackList.forEach(a=>{a.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.addListener(me.GET_STATS,this.handleGetLocalAudioStats),a.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(i.addListener(me.GET_STATS,this.handleGetLocalAudioStats),i.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||i.addListener(me.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(i){i||(i=Array.from(this.localTrackMap.entries()).map(r=>{let[a,{track:l}]=r;return{track:l,type:a}})),i.forEach(r=>{let{track:a,type:l}=r;switch(l){case ne.LocalVideoTrack:a.off(me.GET_STATS,this.handleGetLocalVideoStats),a.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.off(me.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),a.off(me.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),a.off(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),a.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.unbindLocalAudioTrackEvents(a)}})}unbindLocalAudioTrackEvents(i){i instanceof wn?i.trackList.forEach(r=>{r.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(me.GET_STATS,this.handleGetLocalAudioStats),r.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(i.off(me.GET_STATS,this.handleGetLocalAudioStats),i.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(i,r){r instanceof Cs&&r.addListener(me.GET_STATS,a=>{a(this.handleGetRemoteVideoStats(i))}),r instanceof Co&&r.addListener(me.GET_STATS,a=>{a(this.handleGetRemoteAudioStats(i))})}unbindRemoteTrackEvents(i){i&&i.removeAllListeners(me.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(i=>{let[r,a]=i;a.has(Ee.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),a.has(Ee.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(i){return i.map(r=>{var a;let l,d,{track:h,type:p}=r;switch(p){case ne.LocalAudioTrack:l=It.Audio,d={dtx:h instanceof Rd&&h._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ne.LocalVideoTrack:l=ye(a=h._hints).call(a,Ot.SCREEN_TRACK)?It.Screen:It.High,d=wc(wc({},Gd(h)),{},{codec:this.store.codec});break;case ne.LocalVideoLowTrack:l=It.Low,d=wc(wc({},Gd(h)),{},{codec:this.store.codec})}return{kind:p===ne.LocalAudioTrack?Ee.AUDIO:Ee.VIDEO,stream_type:l,attributes:d,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(i){return i.map(r=>{var a;let l,[d,{track:h,ssrcs:p,id:m}]=r;switch(d){case ne.LocalVideoTrack:l=ye(a=h._hints).call(a,Ot.SCREEN_TRACK)?It.Screen:It.High;break;case ne.LocalAudioTrack:l=It.Audio;break;case ne.LocalVideoLowTrack:l=It.Low}return{stream_type:l,ssrcs:p,mid:m}})}assignLocalTracks(i){i.forEach(r=>{let{track:a,type:l}=r;this.localTrackMap.set(l,{track:a})})}withdrawLocalTracks(i){i.forEach(r=>{let[a]=r;this.localTrackMap.delete(a)})}bindConnectionEvents(i){var r=this;i.onConnectionStateChange=function(){var a=M(function*(l){var d;if(w.info("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(l,")")),r.emit(we.PeerConnectionStateChange,l),"connected"!==l||r.store.keyMetrics.peerConnectionEnd||r.store.peerConnectionEnd(),ye(d=r._restartStates).call(d,l)||i.direction===yd.SEND_ONLY){if(r._restartTimer)return;const h=()=>{("disconnected"===i.iceConnectionState||"checking"===i.iceConnectionState||"failed"===i.iceConnectionState)&&(w.debug("[".concat(r.store.clientId,"] [P2PChannel] start use restartICE")),"CONNECTED"===gr(r,we.QueryClientConnectionState)&&r.restartICE(i))};r._restartTimer=window.setTimeout(()=>{h(),r._restartTimer=void 0},800)}});return function(l){return a.apply(this,arguments)}}(),i.onICEConnectionStateChange=a=>{"connected"!==a||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(a,")")),Se.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:a,tag:Xt.TRACER}).onSuccess(),this.emit(we.IceConnectionStateChange,a)},i.onICETransportStateChange=a=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(a,")"))},i.onDTLSTransportStateChange=a=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(a,")"))},i.onDTLSTransportError=a=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(a,")"))},i.onFirstAudioDecoded=a=>{var l;const d=Array.from(zr(l=this.remoteUserMap).call(l)).find(p=>p._audioSSRC===a);var h;d&&(this.store.subscribe(d.uid,"audio",void 0,void 0,void 0,Date.now()),null===(h=d.audioTrack)||void 0===h||h.emit(Cd.FIRST_FRAME_DECODED),Se.firstRemoteFrame(this.store.sessionId,Kn.FIRST_AUDIO_DECODE,qt.FIRST_AUDIO_DECODE,{peer:d._uintid,subscribeElapse:Di.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId}))},i.onFirstAudioReceived=a=>{var l;const d=Array.from(zr(l=this.remoteUserMap).call(l)).find(h=>h._audioSSRC===a);d&&Se.firstRemoteFrame(this.store.sessionId,Kn.FIRST_AUDIO_RECEIVED,qt.FIRST_AUDIO_RECEIVED,{peer:d._uintid,subscribeElapse:Di.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId})},i.onFirstVideoDecoded=(a,l,d)=>{this.reportVideoFirstFrameDecoded(a,l,d)},i.onFirstVideoReceived=a=>{var l;const d=Array.from(zr(l=this.remoteUserMap).call(l)).find(h=>h._videoSSRC===a);d&&Se.firstRemoteFrame(this.store.sessionId,Kn.FIRST_VIDEO_RECEIVED,qt.FIRST_VIDEO_RECEIVED,{peer:d._uintid,subscribeElapse:Di.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId})},i.onSelectedLocalCandidateChanged=(a,l)=>{const d="relay"===a.candidateType;"unknown"!==l.candidateType&&d===("relay"===l.candidateType)||this.emit(we.ConnectionTypeChange,d),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ol(l))," -> ").concat(JSON.stringify(Ol(a)),")"))},i.onSelectedRemoteCandidateChanged=(a,l)=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ol(l))," -> ").concat(JSON.stringify(Ol(a)),")"))},i.onFirstVideoDecodedTimeout=a=>{this.reportVideoFirstFrameDecoded(a,void 0,void 0,!0)},i.onLocalCandidate=a=>{this.emit(we.LocalCandidate,a)}}unbindConnectionEvents(i){i.onConnectionStateChange=void 0,i.onICEConnectionStateChange=void 0,i.onICETransportStateChange=void 0,i.onDTLSTransportStateChange=void 0,i.onDTLSTransportError=void 0,i.onFirstAudioDecoded=void 0,i.onFirstAudioReceived=void 0,i.onFirstVideoDecoded=void 0,i.onFirstVideoReceived=void 0,i.onSelectedLocalCandidateChanged=void 0,i.onSelectedRemoteCandidateChanged=void 0,i.onFirstVideoDecodedTimeout=void 0,i.onLocalCandidate=void 0}filterTobeMutedTracks(i){const r=[];if(-1===this.getAllTracks().indexOf(i))return r;const a=this.localTrackMap.get(ne.LocalAudioTrack);if(i instanceof mt&&a?.track instanceof wn)return a.track.isActive||r.push([ne.LocalAudioTrack,a]),r;const l=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return i===h});if(l&&(r.push(l),l[0]===ne.LocalVideoTrack)){const d=this.localTrackMap.get(ne.LocalVideoLowTrack);d&&r.push([ne.LocalVideoLowTrack,d])}return r}filterTobeUnmutedTracks(i){const r=[],a=this.localTrackMap.get(ne.LocalAudioTrack);if(i instanceof mt&&a?.track instanceof wn)return a.track.isActive&&r.push([ne.LocalAudioTrack,a]),r;const l=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return i===h});if(l)if(l[0]===ne.LocalVideoTrack){r.push(l);const d=this.localTrackMap.get(ne.LocalVideoLowTrack);d&&r.push([ne.LocalVideoLowTrack,d])}else r.push(l);return r}createMuteMessage(i){return i.map(r=>{var a;let l,[d,{track:h,ssrcs:p,id:m}]=r;switch(d){case ne.LocalAudioTrack:l=It.Audio;break;case ne.LocalVideoTrack:l=ye(a=h._hints).call(a,Ot.SCREEN_TRACK)?It.Screen:It.High;break;case ne.LocalVideoLowTrack:l=It.Low}return{stream_type:l,ssrcs:p,mid:m}})}createUnmuteMessage(i){return i.map(r=>{var a;let l,[d,{track:h,ssrcs:p,id:m}]=r;switch(d){case ne.LocalAudioTrack:l=It.Audio;break;case ne.LocalVideoTrack:l=ye(a=h._hints).call(a,Ot.SCREEN_TRACK)?It.Screen:It.High;break;case ne.LocalVideoLowTrack:l=It.Low}return{stream_type:l,ssrcs:p,mid:m}})}filterTobeUnSubscribedTracks(i,r){const a=[],l=this.remoteUserMap.get(i);if(!l)return a;if(r){const d=l.get(r);if(!d)return a;a.push([i,{kind:r,id:d}])}else Array.from(l.entries()).forEach(d=>{let[h,p]=d;a.push([i,{kind:h,id:p}])});return a}createUnsubscribeMessage(i){const r=[];return i.forEach(a=>{let[l,{kind:d}]=a;switch(d){case Ee.VIDEO:return void(l._videoSSRC&&r.push({stream_type:Ee.VIDEO,ssrcId:l._videoSSRC}));case Ee.AUDIO:return void(l._audioSSRC&&r.push({stream_type:Ee.AUDIO,ssrcId:l._audioSSRC}))}}),r}withdrawRemoteTracks(i){i.forEach(r=>{let[a,{kind:l}]=r;const d=this.remoteUserMap.get(a);d&&(d.delete(l),0===Array.from(d.entries()).length&&this.remoteUserMap.delete(a))})}updateBitrateLimit(i){var r=this;return M(function*(){const a=r.localTrackMap.get(ne.LocalVideoTrack),l=r.localTrackMap.get(ne.LocalVideoLowTrack);a&&(yield a.track.setBitrateLimit(i.uplink)),l&&i.low_stream_uplink&&(yield l.track.setBitrateLimit({max_bitrate:i.low_stream_uplink.bitrate,min_bitrate:i.low_stream_uplink.bitrate||0}))})()}isP2PDisconnected(){return!this.sendConnection||!this.recvConnection||"connected"!==this.sendConnection.peerConnectionState&&"connected"!==this.recvConnection.peerConnectionState}tryToUnmuteAudio(i){var r=this;return M(function*(){for(let a=0;a<i.length;a++)if(i[a]instanceof mt){const l=r.filterTobeUnmutedTracks(i[a]);if(0===l.length)continue;const d=r.createUnmuteMessage(l);return void(yield Et(r,we.RequestUnmuteLocal,d))}})()}bindStatsUploaderEvents(){this.statsUploader.requestStats=i=>this.getStats(i),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(i=>{let[,{ssrcs:r}]=i;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=i=>{var r;return!(null===(r=this.recvConnection)||void 0===r||!r.getRemoteVideoIsReady(i))},this.statsUploader.requestUpload=(i,r)=>this.emit(we.RequestUploadStats,i,r),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){var i=this;return M(function*(){i.dtlsFailedCount+=1,yield _i(wt(i.dtlsFailedCount,Re)),i.emit(we.RequestReconnect)})()}reconnectP2P(){return M(function*(){})()}canPublishLowStream(){return this.localTrackMap.has(ne.LocalVideoTrack)||this.pendingLocalTracks.some(i=>i instanceof ze)}throwIfTrackTypeNotMatch(i){if(i.filter(r=>r instanceof ze).length>1)throw new J(x.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(i.filter(r=>r instanceof mt).length>1&&(i.some(r=>r instanceof mt&&r._bypassWebAudio)||!$e().webAudioMediaStreamDest))throw new J(x.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of i){if(r instanceof ze&&this.pendingLocalTracks.some(a=>a instanceof ze))throw new J(x.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof mt&&this.pendingLocalTracks.some(a=>a instanceof mt)&&(!$e().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(a=>a instanceof mt&&a._bypassWebAudio)))throw new J(x.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(i,r){const a=!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&$e().supportDualStreamEncoding,l=wc(wc({},{width:160,height:120,framerate:15,bitrate:50}),r);let d;d=a?i._mediaStreamTrack.clone():U0(i,l);const h=Fe(8,"track-low-"),p=new ze(d,wc(wc({},a&&{scaleResolutionDownBy:c0(l,i)}),{},{frameRate:l.framerate,bitrateMax:l.bitrate,bitrateMin:l.bitrate}),void 0,void 0,h);return p.on(_c.TRANSCEIVER_UPDATED,m=>{i._updateRtpTransceiver(m,mc.LOW_STREAM)}),p._hints.push(Ot.LOW_STREAM),i.addListener(me.NEED_CLOSE,()=>{p.close()}),p}globalLock(){var i=this;return M(function*(){return i.recvMutex.lock("From P2PChannel2.globalLock")})()}reportVideoFirstFrameDecoded(i,r,a,l){var d;const h=Array.from(zr(d=this.remoteUserMap).call(d)).find(p=>p._videoSSRC===i);if(h){l||this.store.subscribe(h.uid,"video",void 0,void 0,void 0,void 0,Date.now());const p=this.store.keyMetrics,m=p.subscribe.find(g=>g.userId===h.uid&&"video"===g.type);Se.firstRemoteVideoDecode(this.store.sessionId,Kn.FIRST_VIDEO_DECODE,qt.FIRST_VIDEO_DECODE,{peer:h._uintid,videowidth:r,videoheight:a,subscribeElapse:Di.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId,apEnd:p.requestAPEnd||0,apStart:p.requestAPStart||0,joinGwEnd:p.joinGatewayEnd||0,joinGwStart:p.joinGatewayStart||0,pcEnd:p.peerConnectionEnd||0,pcStart:p.peerConnectionStart||0,subscriberEnd:m?.subscribeEnd||0,subscriberStart:m?.subscribeStart||0,videoAddNotify:m?.streamAdded||0,state:l?1:0})}}remoteMediaSsrcChanged(i,r,a){var l=this;return M(function*(){if(!l.recvConnection)return!1;const d=l.remoteUserMap.get(i);if(!d)return!1;const h=d.get(r);if(!h)return!1;const p=yield l.recvConnection.getRemoteSSRC(h);return void 0!==p&&p!==a})()}resetConnection(i){w.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(i)),this.state===it.Connected?(w.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}publishDataChannel(i){return M(function*(){throw new J(x.NOT_SUPPORTED)})()}unpublishDataChannel(i){return M(function*(){throw new J(x.NOT_SUPPORTED)})()}subscribeDataChannel(i,r){return M(function*(){throw new J(x.NOT_SUPPORTED)})()}unsubscribeDataChannel(i,r){return M(function*(){throw new J(x.NOT_SUPPORTED)})()}hasPendingRemoteDataChannel(i,r){throw new J(x.NOT_SUPPORTED)}setPendingRemoteDataChannel(i,r){throw new J(x.NOT_SUPPORTED)}preConnect(i,r,a,l,d,h){return M(function*(){throw new J(x.NOT_SUPPORTED)})()}getEstablishParams(){throw new J(x.NOT_SUPPORTED)}reSubscribe(i){return M(function*(){throw new J(x.NOT_SUPPORTED)})()}updateVideoStreamParameter(i,r){return M(function*(){throw new J(x.NOT_SUPPORTED)})()}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(i=>{let[r,{track:a}]=i;r===ne.LocalVideoLowTrack?a._updateRtpTransceiver(void 0,mc.LOW_STREAM):a._updateRtpTransceiver(void 0)})}}function to(s){return function(i,r,a){const l=i[r];if("function"!=typeof l)throw new Error("Cannot use mutex on object property.");return a.value=M(function*(){for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];switch(s){case cs.SEND_ONLY:{const m=yield this.sendMutex.lock("From P2PChannel2.".concat(r));try{return yield l.apply(this,h)}finally{m()}}case cs.RECEIVE_ONLY:{const m=yield this.recvMutex.lock("From P2PChannel2.".concat(r));try{return yield l.apply(this,h)}finally{m()}}default:{const m=yield this.sendMutex.lock("From P2PChannel2.".concat(r)),g=yield this.recvMutex.lock("From P2PChannel2.".concat(r));try{return yield l.apply(this,h)}finally{m(),g()}}}}),a}}function Q0(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function KN(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?Q0(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Q0(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}te([to(),N("design:type",Function),N("design:paramtypes",[Object,String]),N("design:returntype",q)],ln.prototype,"startP2P",null),te([to(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],ln.prototype,"p2pConnect",null),te([to(cs.SEND_ONLY),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],ln.prototype,"dopublish",null),te([to(cs.SEND_ONLY),N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],ln.prototype,"unpublish",null),te([to(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",q)],ln.prototype,"unpublishLowStream",null),te([to(cs.SEND_ONLY),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],ln.prototype,"doUnpublish",null),te([to(cs.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Oi,String,String,Number]),N("design:returntype",q)],ln.prototype,"subscribe",null),te([to(cs.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Oi,String,String,Boolean]),N("design:returntype",q)],ln.prototype,"unsubscribe",null),te([to(cs.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Oi,String]),N("design:returntype",q)],ln.prototype,"muteRemote",null),te([to(cs.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Oi,String]),N("design:returntype",q)],ln.prototype,"unmuteRemote",null),te([to(cs.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Oi,String]),N("design:returntype",q)],ln.prototype,"hasRemoteMediaWithLock",null),te([to(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",q)],ln.prototype,"disconnectForReconnect",null),te([to(cs.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Oi,String,Number]),N("design:returntype",q)],ln.prototype,"remoteMediaSsrcChanged",null);const YN=Date.now(),Y2=20,Z0=new Map,Ov=new Map;function $2(s){return $N.apply(this,arguments)}function $N(){return $N=M(function*(s){const i=Z0.get(s),r=Array.isArray(i)&&i[i.length-1],a=Ov.get(s);if(!r)return void(a.isSyncing=!1);const l={uid:r.uid,payload:Qg(r.payload)};0===a.firstRecvTs&&(a.firstRecvTs=r.recvTs,a.firstSendTs=r.sendTs);const d=r.sendTs-a.firstSendTs,h=d-(Date.now()-a.firstRecvTs);h>0&&(a.firstRecvTs=Date.now()-d);let p=r.mediaDelay+h;p<=0?(i.pop(),eT(r.context,l),p=0):p=Math.min(p,Y2),setTimeout(()=>i.length&&$2(s),p)}),$N.apply(this,arguments)}function eT(s,i){s.safeEmit(Xe.STREAM_MESSAGE,i.uid,i.payload),s.onStreamMessage&&s.onStreamMessage(i)}const X2=dt().name;function XN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Xh(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?XN(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):XN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}Zn.setLogger(w);class Nt extends zt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var i;return(null===(i=this._config)||void 0===i?void 0:i.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(i){var r;let a;if(super(),r=this,C(this,"store",void 0),C(this,"_uid",void 0),C(this,"_channelName",void 0),C(this,"_uintUid",void 0),C(this,"_users",[]),C(this,"_config",void 0),C(this,"_clientId",void 0),C(this,"_appId",void 0),C(this,"_sessionId",null),C(this,"_key",void 0),C(this,"_joinInfo",void 0),C(this,"_gateway",void 0),C(this,"_statsCollector",void 0),C(this,"_configDistribute",void 0),C(this,"_leaveMutex",new Zn("client-leave")),C(this,"_publishMutex",new Zn("client-publish")),C(this,"_renewTokenMutex",new Zn("client-renewtoken")),C(this,"_subscribeMutex",new Zn("client-subscribe")),C(this,"_encryptionMode","none"),C(this,"_encryptionSecret",null),C(this,"_encryptionSalt",null),C(this,"_proxyServer",void 0),C(this,"_turnServer",{servers:[],mode:"auto"}),C(this,"_cloudProxyServerMode","disabled"),C(this,"_isDualStreamEnabled",!1),C(this,"_defaultStreamFallbackType",void 0),C(this,"_lowStreamParameter",void 0),C(this,"_streamFallbackTypeCacheMap",new Map),C(this,"_remoteStreamTypeCacheMap",new Map),C(this,"_axiosCancelSource",vr.CancelToken.source()),C(this,"_audioVolumeIndicationInterval",void 0),C(this,"_networkQualityInterval",void 0),C(this,"_userOfflineTimeout",void 0),C(this,"_streamRemovedTimeout",void 0),C(this,"_injectStreamingClient",void 0),C(this,"_liveTranscodeStreamingClient",void 0),C(this,"_liveRawStreamingClient",void 0),C(this,"_channelMediaRelayClient",void 0),C(this,"_networkQualitySensitivity","normal"),C(this,"_p2pChannel",void 0),C(this,"_useLocalAccessPoint",!1),C(this,"_setLocalAPVersion",void 0),C(this,"_joinAndNotLeaveYet",!1),C(this,"_numberOfJoinCount",0),C(this,"_remoteDefaultVideoStreamType",void 0),C(this,"_inspect",void 0),C(this,"_moderation",void 0),C(this,"_license",void 0),C(this,"_pendingPublishedUsers",[]),C(this,"ntpAlignErrorCount",0),C(this,"remoteInboundOffset",0),C(this,"_handleLocalTrackEnable",(l,d,h)=>{this.publish(l,!1).then(d).catch(h)}),C(this,"_handleLocalTrackDisable",(l,d,h)=>{this.unpublish(l).then(d).catch(h)}),C(this,"_handleUserOnline",l=>{if(j("BLOCK_LOCAL_CLIENT")&&fl(l.uid,this.channelName))return void w.debug("[".concat(l.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof l.uid&&w.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const d=this._users.find(h=>h.uid===l.uid);if(d)d._trust_in_room_=!0;else{const h=new Oi(l.uid,l.uint_id||l.uid);this._users.push(h),w.debug("[".concat(this._clientId,"] user online"),l.uid),this.safeEmit(Xe.USER_JOINED,h)}}),C(this,"_handleUserOffline",l=>{if(j("BLOCK_LOCAL_CLIENT")&&fl(l.uid,this.channelName))return;const d=this._users.find(h=>h.uid===l.uid);d&&(this._handleRemoveStream(l),this._handleRemoveDataChannels(l),RS(this._users,d),this._remoteStreamTypeCacheMap.delete(d.uid),this._streamFallbackTypeCacheMap.delete(d.uid),w.debug("[".concat(this._clientId,"] user offline"),l.uid,"reason:",l.reason),this.safeEmit(Xe.USER_LEAVED,d,l.reason))}),C(this,"_handleAddAudioOrVideoStream",(l,d,h,p,m,g,E)=>{if(j("BLOCK_LOCAL_CLIENT")&&fl(d,this.channelName))return;const y=this._users.find(T=>T.uid===d);if(!y)return void w.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));w.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(l)),this.store.subscribe(y.uid,l,void 0,void 0,void 0,Date.now());const b="audio"===l?y.hasAudio:y.hasVideo;y._uintid||(y._uintid=m||d),"audio"===l?y._trust_audio_stream_added_state_=!0:y._trust_video_stream_added_state_=!0,"audio"===l?(y._audio_added_=!0,void 0!==h&&(y._audioSSRC=h),void 0!==p&&(y._cname=p),g&&(y._audioOrtc=g)):(y._video_added_=!0,void 0!==h&&(y._videoSSRC=h),void 0!==p&&(y._cname=p),void 0!==E&&(y._rtxSsrcId=E),g&&(y._videoOrtc=g)),("audio"===l?y.hasAudio:y.hasVideo)&&!b&&(w.info("[".concat(this._clientId,"] remote user ").concat(y.uid," published ").concat(l)),this.safeEmit(Xe.USER_PUBLISHED,y,l)),"video"===l?Se.onGatewayStream(this._sessionId,Kn.ON_ADD_VIDEO_STREAM,qt.ON_ADD_VIDEO_STREAM,{peer:m||d,ssrc:y._videoSSRC}):Se.onGatewayStream(this._sessionId,Kn.ON_ADD_AUDIO_STREAM,qt.ON_ADD_AUDIO_STREAM,{peer:m||d,ssrc:y._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(y,l,h).then(T=>{if(T&&(w.debug("[".concat(this._clientId,"] resubscribe ").concat(l," for user ").concat(y.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof ci))return this._p2pChannel.unsubscribe(y,l,!0).then(()=>this._subscribe(y,l,!0).catch(O=>{w.error("[".concat(this._clientId,"] resubscribe error"),O.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(y,l)&&(w.debug("[".concat(this._clientId,"] resubscribe ").concat(l," for user ").concat(y.uid," after reconnect.")),this._subscribe(y,l,!0).catch(T=>{w.error("[".concat(this._clientId,"] resubscribe error"),T.toString())}))}),C(this,"_handleRemoveStream",(l,d,h)=>{if(j("BLOCK_LOCAL_CLIENT")&&fl(l.uid,this.channelName))return;const p=this._users.find(g=>g.uid===l.uid);if(!p)return void w.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));w.debug("[".concat(this._clientId,"] stream removed with uid ").concat(l.uid));let m=()=>{};if(p.hasAudio&&p.hasVideo?m=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished audio track")),this.safeEmit(Xe.USER_UNPUBLISHED,p,"audio"),w.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished video track")),this.safeEmit(Xe.USER_UNPUBLISHED,p,"video")}:p.hasVideo?m=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished video track")),this.safeEmit(Xe.USER_UNPUBLISHED,p,"video")}:p.hasAudio&&(m=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished audio track")),this.safeEmit(Xe.USER_UNPUBLISHED,p,"audio")}),p._trust_audio_stream_added_state_=!0,p._trust_video_stream_added_state_=!0,p._audio_added_=!1,p._video_added_=!1,this._p2pChannel instanceof ci)this._p2pChannel.unsubscribe(p).then(g=>{if(g)return this._gateway.unsubscribe(g,p.uid)});else if(d&&h)if(l.sdp){const{sdp:g}=l;this._p2pChannel.unsubscribe(p,g).then(E=>{E&&d(E)}).catch(h)}else d&&d();p._audioSSRC=void 0,p._videoSSRC=void 0,p._audioOrtc=void 0,p._videoOrtc=void 0,p._rtxSsrcId=void 0,Se.onGatewayStream(this._sessionId,Kn.ON_REMOVE_STREAM,qt.ON_REMOVE_STREAM,{peer:l.uint_id||l.uid}),m()}),C(this,"_handleSetStreamLocalEnable",(l,d,h)=>{if(j("BLOCK_LOCAL_CLIENT")&&fl(d,this.channelName))return;const p=this._users.find(E=>E.uid===d);if(!p)return void w.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));w.debug("[".concat(this._clientId,"] local ").concat(l," ").concat(h?"enabled":"disabled"," with uid ").concat(d));const m="audio"===l?p.hasAudio:p.hasVideo;if("audio"===l){p._trust_audio_enabled_state_=!0;const E=p._audio_enabled_;if(p._audio_enabled_=h,p._audio_enabled_===E)return;{const y=p._audio_enabled_?"enable-local-audio":"disable-local-audio";w.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(d,", msg: ").concat(y)),this.safeEmit(Xe.USER_INFO_UPDATED,d,y)}}else{p._trust_video_enabled_state_=!0;const E=p._video_enabled_;if(p._video_enabled_=h,p._video_enabled_===E)return;{const y=p._video_enabled_?"enable-local-video":"disable-local-video";w.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(y)),this.safeEmit(Xe.USER_INFO_UPDATED,d,y)}}const g="audio"===l?p.hasAudio:p.hasVideo;return m!==g?!m&&g?(w.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(l)),void this.safeEmit(Xe.USER_PUBLISHED,p,l)):("video"===l&&p._videoTrack&&p._videoTrack._destroy(),this._p2pChannel.muteRemote(p,l),w.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(l)),void this.safeEmit(Xe.USER_UNPUBLISHED,p,l)):void 0}),C(this,"_handleMuteStream",(l,d,h,p,m,g)=>{if(j("BLOCK_LOCAL_CLIENT")&&fl(l,this.channelName))return;w.debug("[".concat(this._clientId,"] receive mute message"),l,d,h);const E=this._users.find(T=>T.uid===l);if(!E)return void w.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(l));const y="audio"===d?E.hasAudio:E.hasVideo;if("audio"===d){E._trust_audio_mute_state_=!0;const T=E._audio_muted_;if(E._audio_muted_=h,E._audio_muted_===T)return;{const O=E._audio_muted_?"mute-audio":"unmute-audio";w.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(O)),this.safeEmit(Xe.USER_INFO_UPDATED,l,O)}}else{E._trust_video_mute_state_=!0;const T=E._video_muted_;if(E._video_muted_=h,E._video_muted_===T)return;{const O=E._video_muted_?"mute-video":"unmute-video";w.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(O)),this.safeEmit(Xe.USER_INFO_UPDATED,l,O)}}const b="audio"===d?E.hasAudio:E.hasVideo;if(y!==b){if(!y&&b)return this.store.useP2P||("audio"===d?E._audioSSRC:E._videoSSRC)?(w.info("[".concat(this._clientId,"] remote user ").concat(l," published ").concat(d)),void this.safeEmit(Xe.USER_PUBLISHED,E,d)):void w.warning("[".concat(this._clientId,"] remote user ").concat(l," receive ").concat(d," unmute message  before add stream message, ").concat(d," SSRC doesn't exist yet."));"video"===d&&E._videoTrack&&E._videoTrack._destroy(),m&&g&&this._p2pChannel instanceof ln&&(p?this._p2pChannel.unsubscribe(E,p,d).then(T=>{m(T)}).catch(g):m()),this._p2pChannel.muteRemote(E,d),w.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished ").concat(d)),this.safeEmit(Xe.USER_UNPUBLISHED,E,d)}}),C(this,"_handleP2PLost",function(){var l=M(function*(d){w.debug("[".concat(r._clientId,"] receive p2p lost"),d),parseInt(d.p2pid,10)===r.store.p2pId?yield r._p2pChannel.requestReconnect():w.warning("[".concat(r._clientId,"] P2PLost stream not found"),d)});return function(d){return l.apply(this,arguments)}}()),C(this,"_handleTokenWillExpire",()=>{w.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Xe.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),C(this,"_handleBeforeUnload",l=>{"beforeunload"===l.type&&void 0!==l.returnValue&&""!==l.returnValue||(this.leave(),w.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),C(this,"_handleUpdateNetworkQuality",()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(Xe.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const l={downlinkNetworkQuality:0,uplinkNetworkQuality:0};l.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),l.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Xe.NETWORK_QUALITY,l)}),C(this,"_handleP2PAddAudioOrVideoStream",(l,d)=>{const h=this._users.find(m=>m.uid===d);if(!h)return void w.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));w.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(l)),this.store.subscribe(h.uid,l,void 0,void 0,void 0,Date.now());const p="audio"===l?h.hasAudio:h.hasVideo;"audio"===l?h._trust_audio_stream_added_state_=!0:h._trust_video_stream_added_state_=!0,"audio"===l?h._audio_added_=!0:h._video_added_=!0,("audio"===l?h.hasAudio:h.hasVideo)&&!p&&(w.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published ").concat(l)),this.safeEmit(Xe.USER_PUBLISHED,h,l)),this._p2pChannel.hasPendingRemoteMedia(h,l)&&(w.debug("[".concat(this._clientId,"] resubscribe ").concat(l," for user ").concat(h.uid," after reconnect.")),this._subscribe(h,l,!0).catch(m=>{w.error("[".concat(this._clientId,"] resubscribe error"),m.toString())}))}),this._config=i,this._clientId=Fe(5,"client-"),this.store=new Vn(i.codec,i.audioCodec,i.mode,this._clientId),this.store.clientCreated(),i.proxyServer&&this.setProxyServer(i.proxyServer,!0),i.turnServer&&this.setTurnServer(i.turnServer,!0),w.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Yo," build: ").concat(JS,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),i.clientRoleOptions)try{Ef(i.clientRoleOptions),a=Object.assign({},i.clientRoleOptions)}catch(l){w.warning("[".concat(this._clientId,"] ").concat(l.toString()))}this._statsCollector=new kh(this.store),this._statsCollector.onStatsException=(l,d,h)=>{w.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(l,", msg: ").concat(d,", uid: ").concat(h)),this.safeEmit(Xe.EXCEPTION,{code:l,msg:d,uid:h})},this._statsCollector.onUploadPublishDuration=(l,d,h,p)=>{const m=this._users.find(g=>g.uid===l);m&&Se.peerPublishStatus(this._sessionId,{subscribeElapse:p,audioPublishDuration:d,videoPublishDuration:h,peer:m._uintid})},this.store.useDataChannel=$e().supportDataChannel&&j("SIGNAL_CHANNEL"),this.store.useP2P=j("P2P"),this._gateway=new p2(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:i.websocketRetryConfig||Re,httpRetryConfig:i.httpRetryConfig||Re,forceWaitGatewayResponse:void 0===i.forceWaitGatewayResponse||i.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:i.role,clientRoleOptions:a}),this._configDistribute=new T0,this.store.useP2P?(this._p2pChannel=new ln(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new ci(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}joinMeta(i,r,a,l,d){var h=arguments,p=this;return M(function*(){let m=!(h.length>5&&void 0!==h[5])||h[5],g=h.length>6&&void 0!==h[6]&&h[6];At("JOIN_GATEWAY_USE_443PORT_ONLY",m),At("JOIN_GATEWAY_USE_DUAL_DOMAIN",g);const E=p._gateway.signal.websocket;return E instanceof yE&&(E.use443PortOnly=m,E.tryDoubleDomain=g),(y=M(function*(b,T,O){Hg.get(b)||Hg.set(b,[]),Gg.get(b)||Gg.set(b,T),Aa.get(b)||Aa.set(b,0);const P=Hg.get(b),D=Gg.get(b);if(!P||!D)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Aa.get(b)===D){const se=mf();P.push(se),yield se.promise}Aa.set(b,Aa.get(b)+1);for(var L=arguments.length,B=new Array(L>3?L-3:0),V=3;V<L;V++)B[V-3]=arguments[V];const Q=yield O(...B);return Aa.set(b,Aa.get(b)-1),Aa.get(b)===D-1&&P.length>0&&(P[0].resolve(),P.shift()),0===Aa.get(b)&&(Hg.set(b,[]),Gg.set(b,0),Aa.set(b,0)),Q}),function(b,T,O){return y.apply(this,arguments)})("client.join",j("JOIN_MAX_CONCURRENCY"),p.join.bind(p),i,r,a,l,d);var y})()}join(i,r,a,l,d){var h=this;return M(function*(){const p=++h._numberOfJoinCount;h.store.joinStart(),l&&(h.store.uid=l);const m="HTTPS"===(Af||Af||(Af=(window.location.protocol.split(":")[0]||"").toUpperCase(),Af)),g=rL()?window.isSecureContext:"Browser Not Support";(rL()||m)&&window.isSecureContext||w.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");const E=Zg();"DISCONNECTED"===h.connectionState&&(h.store.avoidJoinStart=Math.round(Date.now()),w.debug("[".concat(h._clientId,"] set avoidJoinStart to ").concat(h.store.avoidJoinStart)));const y=Se.reportApiInvoke(E,{name:On.JOIN,options:[i,r,a,l],states:{isHttps:m,isSecureContext:g},tag:Xt.TRACER});Se.setAppId(i);try{if(!a&&null!==a)throw new W(x.INVALID_PARAMS,"Invalid token: ".concat(a,". If you don not use token, set it to null"));a&&Un(a,"token",1,2047),Un(i,"appid",1,2047),_E(r),l&&iC(l),d&&Un(d,"optionalInfo",1,2047)}catch(D){throw y.onError(D),D}if(w.info("[".concat(h._clientId,"] start join channel ").concat(r,", join number: ").concat(p)),h._leaveMutex.isLocked&&(w.debug("[".concat(h._clientId,"] join: waiting leave operation")),(yield h._leaveMutex.lock())(),w.debug("[".concat(h._clientId,"] join: continue"))),h._joinAndNotLeaveYet=!0,"DISCONNECTED"!==h.connectionState){const D=new W(x.INVALID_OPERATION,"[".concat(h._clientId,"] Client already in connecting/connected state"));throw y.onError(D),D}h._sessionId||(h._sessionId=E,h.store.sessionId=h._sessionId),h._gateway.state="CONNECTING";const b=Xh({clientId:h._clientId,appId:i,sid:h._sessionId,cname:r,uid:"string"!=typeof l?l:null,turnServer:h._turnServer,proxyServer:h._proxyServer,token:a||i,cloudProxyServer:h._cloudProxyServerMode,optionalInfo:d,license:h._license,useLocalAccessPoint:h._useLocalAccessPoint},void 0!==h._remoteDefaultVideoStreamType&&{defaultVideoStream:h._remoteDefaultVideoStreamType});if(h._useLocalAccessPoint&&(b.setLocalAPVersion=h._setLocalAPVersion),"string"==typeof l&&(b.stringUid=l,h._uintUid?(b.uid=h._uintUid,h._uintUid=void 0):b.uid=0),"none"!==h._encryptionMode&&h._encryptionSecret){if(b.aesmode=h._encryptionMode,b.aespassword=yield kA(h._encryptionSecret),!h._joinAndNotLeaveYet)throw new W(x.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));h._encryptionSalt&&(b.aessalt=h._encryptionSalt)}h._startSession(h._sessionId,{channel:r,appId:i});const T=h._sessionId;setTimeout(()=>{"CONNECTING"===h.connectionState&&T===h._sessionId&&Se.joinChannelTimeout(h._sessionId,5)},5e3);try{var O;let D;const L=b.cloudProxyServer;if(ye(O=["proxy3","proxy4","proxy5"]).call(O,L)){const se=j("PROXY_SERVER_TYPE3");b.proxyServer=Array.isArray(se)?se[0]:se}if(Se.setProxyServer(b.proxyServer),w.setProxyServer(b.proxyServer),h.store.requestAPStart(),b.stringUid&&!b.uid){const se=yield Bh(b.stringUid,b,h._axiosCancelSource.token,h._config.httpRetryConfig||Re,h.store);w.debug("[".concat(h._clientId,"] getUserAccount Success ").concat(b.stringUid," => ").concat(se)),b.uid=se,D=yield _0(b,h._axiosCancelSource.token,h._config.httpRetryConfig||Re,!0,h.store)}else D=yield _0(b,h._axiosCancelSource.token,h._config.httpRetryConfig||Re,!0,h.store);if(!h._joinAndNotLeaveYet)throw new W(x.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));h.store.requestAPEnd(),setTimeout(()=>{h._configDistribute.startGetConfigDistribute(b,h._axiosCancelSource.token),h._configDistribute.on(Lf.UPDATE_BITRATE_LIMIT,se=>{h._p2pChannel.updateBitrateLimit(se)})},0),h._key=a||i;const B=D.gatewayInfo;h._joinInfo=Xh(Xh({},b),{},{cid:B.cid,uid:b.uid?b.uid:B.uid,vid:B.vid,apResponse:B.res,uni_lbs_ip:B.uni_lbs_ip,gatewayAddrs:B.gatewayAddrs});const V=yield h._joinGateway();if(!h._joinAndNotLeaveYet)throw new W(x.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));y.onSuccess(V),h._appId=i,h._channelName=b.cname,h._uid=V,h.store.uid=V,setTimeout(()=>{h._networkQualityInterval&&window.clearInterval(h._networkQualityInterval),h._networkQualityInterval=window.setInterval(h._handleUpdateNetworkQuality,2e3),window.addEventListener(Ki()?"beforeunload":"pagehide",h._handleBeforeUnload)},0);const Q=b.stringUid?"string uid: ".concat(b.stringUid,",uid: ").concat(b.uid):"uid: ".concat(h._uid);return w.info("[".concat(h._clientId,"] Joining channel success: channel: ").concat(r,",").concat(Q)),setTimeout(()=>{w.startUpload()},5e3),h.store.joinEnd(),P=h,ye(pc).call(pc,P)||pc.push(P),V}catch(D){const L=Array.isArray(D)?D[0]:D;throw L&&L.code===x.OPERATION_ABORTED?w.warning("[".concat(h._clientId,"] join number: ").concat(p,", Joining channel failed, rollback"),L):w.error("[".concat(h._clientId,"] join number: ").concat(p,", Joining channel failed, rollback"),L),L.code!==x.OPERATION_ABORTED&&h._numberOfJoinCount===p&&(h._gateway.state="DISCONNECTED",h._reset()),y.onError(L),L}var P})()}_joinGateway(){if(!this._joinInfo||!this._key)throw new W(x.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!j("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(i=>i).catch(i=>{if(i.code===x.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,Ye.FALLBACK),i;if(i.code===x.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,Ye.FALLBACK),i;throw i}).then(i=>{if(i instanceof W){if(i.code===x.INIT_WEBSOCKET_TIMEOUT){if(w.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new W(x.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const r=j("PROXY_SERVER_TYPE3");if(Array.isArray(r))if(this._joinInfo.apUrl){const l=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),d=l.slice(l.length-2).join(".");r.forEach(h=>{this._joinInfo&&ye(h).call(h,d)&&(this._joinInfo.proxyServer=h)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=r[0])}else this._joinInfo.proxyServer=r[0];else this._joinInfo.proxyServer=r;const a=j("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return a&&a[1]&&"443"!==a[1]&&w.setProxyServer(this._joinInfo.proxyServer),"443"!==j("STATS_COLLECTOR_PORT").toString()&&Se.setProxyServer(this._joinInfo.proxyServer),Se.reportApiInvoke(this._sessionId,{name:On.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:Xt.TRACER}).onSuccess(),this.safeEmit(Xe.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),j("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(l=>{"forceturn"in l&&(l.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(w.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new W(x.INVALID_OPERATION);return Se.reportApiInvoke(this._sessionId,{name:On.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:Xt.TRACER}).onSuccess(),this._joinGateway()}return i}).then(i=>i)}leave(){var i=this;return M(function*(){w.info("[".concat(i._clientId,"] Leaving channel")),window.removeEventListener(Ki()?"beforeunload":"pagehide",i._handleBeforeUnload),i._reset(),function(a){const l=pc.indexOf(a);-1!==l&&pc.splice(l,1)}(i);const r=yield i._leaveMutex.lock();if("DISCONNECTED"===i.connectionState)return w.info("[".concat(i._clientId,"] Leaving channel repeated, success")),void r();yield i._gateway.leave("CONNECTED"!==i.connectionState),w.info("[".concat(i._clientId,"] Leaving channel success")),i._joinAndNotLeaveYet=!1,i.store.resetJoinChannelServiceRecords(),r()})()}publish(i){var r=arguments,a=this;return M(function*(){let l=!(r.length>1&&void 0!==r[1])||r[1];if(!Array.isArray(i)){if(!(i instanceof Ri))return a._publishDataChannel(i);i=[i]}if(0===i.length)throw new W(x.INVALID_PARAMS,"param list is empty");const d=i;if("audience"===a._gateway.role)throw new W(x.INVALID_OPERATION,"audience can not publish stream");for(const p of d){if(!(p instanceof Ri))throw new W(x.INVALID_PARAMS,"parameter is not local track");if(!p._enabled&&l)throw new W(x.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(p.getTrackId()))}w.info("[".concat(a._clientId,"] Publishing tracks, id ").concat(d.map(p=>"".concat(p.getTrackId()," "))));const h=yield a._publishMutex.lock();yield a._configDistribute.awaitConfigDistributeComplete(),l&&d.forEach(p=>{const m=a._configDistribute.getBitrateLimit();p instanceof ze&&m&&p.setBitrateLimit(m.uplink)});try{yield a._publishHighStream(d),w.info("[".concat(a._clientId,"] Publish success, id ").concat(d.map(p=>"".concat(p.getTrackId()," "))))}catch(p){throw w.error("[".concat(a._clientId,"] publish error"),p.toString()),p}finally{h()}})()}_publishDataChannel(i){var r=this;return M(function*(){ft(i.id,"id",0,65535,!0),_s(i.ordered,"ordered"),Un(i.metadata,"metadata",0,512),w.info("[".concat(r._clientId,"] Publishing datachannels, id ").concat(i.id));const a=yield r._publishMutex.lock();try{if(-1!==r._p2pChannel.getAllDataChannels().findIndex(d=>d.id===i.id))throw new W(x.INVALID_PARAMS,"Invalid id: ".concat(i.id,". If you want to republish the datachannel, unpublish first"));if(!r._joinInfo||void 0===r._uid)throw new W(x.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new W(x.INVALID_OPERATION,"can not publish datachannel in ".concat(r.connectionState," state"));if("auto"===r._turnServer.mode&&j("FORCE_TURN")&&!j("TURN_ENABLE_TCP")&&!j("TURN_ENABLE_UDP"))throw new W(x.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const l=new Ro(i);yield r._p2pChannel.publishDataChannel([l]);try{const d={streamId:i.id,ordered:i.ordered,maxRetransmits:j("DATASTREAM_MAX_RETRANSMITS"),metadata:i.metadata,channelId:l._originDataChannelId};yield r._gateway.publishDataChannel(r._uid,d,!0)}catch(d){if(d.code!==x.DISCONNECT_P2P)throw d}return yield l._waitTillOpen(),w.info("[".concat(r._clientId,"] Publish dataChannels success, id ").concat(l.id)),l}catch(l){throw w.error("[".concat(r._clientId,"] publish datachannels error"),l.toString()),l}finally{a()}})()}unpublish(i){var r=this;return M(function*(){if(!r._joinInfo||void 0===r._uid)throw new W(x.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let a=[];if(i)if(Array.isArray(i))a=i;else{if(!(i instanceof Ri))return r._unpublishDataChannel([i]);a=[i]}else r.store.useP2P||(yield r._unpublishDataChannel()),a=r._p2pChannel.getAllTracks(!0);w.info("[".concat(r._clientId,"] Unpublish tracks, tracks ").concat(a.map(d=>"".concat(d.getTrackId()," "))," "));const l=yield r._publishMutex.lock();try{if(r._p2pChannel instanceof ln){const d=yield r._p2pChannel.unpublish(a);if(d){const h=yield r._gateway.sendExtensionMessage(Dt.UNPUBLISH,d);h&&(yield r._p2pChannel.setDescription("local",h))}}else{const d=yield r._p2pChannel.unpublish(a);d&&(yield r._gateway.unpublish(d,r._uid)),w.info("[".concat(r._clientId,"] Unpublish success,tracks ").concat(a.map(h=>"".concat(h.getTrackId()))))}}catch(d){throw w.error("[".concat(r._clientId,"] unpublish error"),d.toString()),d}finally{l&&l()}})()}_unpublishDataChannel(i){var r=this;return M(function*(){void 0!==i&&0!==i.length||(i=r._p2pChannel.getAllDataChannels()),w.info("[".concat(r._clientId,"] Unpublish datachannels, datachannels ").concat(i.map(l=>"".concat(l.id," "))," "));const a=yield r._publishMutex.lock();try{const l=yield r._p2pChannel.unpublishDataChannel(i);l&&(yield r._gateway.unpublishDataChannel(l)),w.info("[".concat(r._clientId,"] Unpublish dataChannel success,dataChannel ").concat(i.map(d=>"".concat(d.id))))}catch(l){throw w.error("[".concat(r._clientId,"] unpublish dataChannel error"),l.toString()),l}finally{a&&a()}})()}subscribe(i,r,a){var l=this;return M(function*(){return"datachannel"===r?l._subscribeDataChannel(i,a):l._subscribe(i,r)})()}_subscribeDataChannel(i,r){var a=this;return M(function*(){var l;if(ft(r,"channelId",0,65535,!0),!a._joinInfo)throw new W(x.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==a.connectionState&&"RECONNECTING"!==a.connectionState)throw new W(x.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(a.connectionState," state"));if(!a._users.find(m=>m===i))throw w.error("[".concat(a._clientId,"] can not subscribe ").concat(i.uid,", this user is not in the channel")),new W(x.INVALID_REMOTE_USER,"user is not in the channel");if(!i.hasAudio&&!i.hasVideo&&0===i._dataChannels.length)throw w.error("[".concat(a._clientId,"] can not subscribe ").concat(i.uid,", user is not published")),new W(x.INVALID_REMOTE_USER,"user is not published");const d=null===(l=i._dataChannels)||void 0===l?void 0:l.find(m=>m.id===r);if(!d)throw w.error("[".concat(a._clientId,"] can not subscribe ").concat(i.uid," with mediaType datachannel, remote datachannel is not published")),new W(x.REMOTE_USER_IS_NOT_PUBLISHED);const h=yield a._subscribeMutex.lock();w.info("[".concat(a._clientId,"] subscribe user ").concat(i.uid,", mediaType: datachannel"));try{const m=yield a._p2pChannel.subscribeDataChannel(i,[d]);if(m&&ye(m).call(m,d.id))try{var p;if(!d._originDataChannelId)throw w.error("[".concat(a._clientId,"] can not subscribe ").concat(i.uid," with mediaType datachannel, cannot get RTCDatachannel")),new W(x.REMOTE_USER_IS_NOT_PUBLISHED);const g={id:d.id,datachannelId:d._originDataChannelId,ordered:d.ordered,maxRetransmits:d.maxRetransmits,metadata:null!==(p=d.metadata)&&void 0!==p?p:""};yield a._gateway.subscribeDataChannel(i.uid,g,!0)}catch(g){if(g?.code!==x.WS_ABORT)throw yield a._p2pChannel.unsubscribeDataChannel(i,[d]),g;yield a._p2pChannel.unsubscribeDataChannel(i,[d]),a._p2pChannel.setPendingRemoteDataChannel(i,d.id)}return yield d._waitTillOpen(),w.info("[".concat(a._clientId,"] subscribe success user ").concat(i.uid,", mediaType: datachannel")),d}finally{h()}})()}_p2pSubscribe(i,r,a){var l=this;return M(function*(){if(gn(r,"mediaType",["audio","video"]),!l._joinInfo)throw new W(x.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==l.connectionState&&"RECONNECTING"!==l.connectionState)throw new W(x.INVALID_OPERATION,"Can't subscribe stream in ".concat(l.connectionState," state"));if(!l._users.find(p=>p===i)){const p=new W(x.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(l._clientId,"] can not subscribe ").concat(i.uid,", this user is not in the channel")),p}if(!i.hasAudio&&!i.hasVideo){const p=new W(x.INVALID_REMOTE_USER,"user is not published");throw w.error("[".concat(l._clientId,"] can not subscribe ").concat(i.uid,", user is not published")),p}if(!a&&("audio"===r&&!i.hasAudio||"video"===r&&!i.hasVideo)){const p=new W(x.REMOTE_USER_IS_NOT_PUBLISHED);throw w.error("[".concat(l._clientId,"] can not subscribe ").concat(i.uid," with mediaType ").concat(r,", remote track is not published")),p}const d=yield l._subscribeMutex.lock();w.info("[".concat(l._clientId,"] subscribe user ").concat(i.uid,", mediaType: ").concat(r));const h="audio"===r?ne.LocalAudioTrack:l._joinInfo.defaultVideoStream===CE.LOW_STREAM?ne.LocalVideoLowTrack:ne.LocalVideoTrack;try{(yield l._p2pChannel.hasRemoteMediaWithLock(i,r))?yield l._p2pChannel.unmuteRemote(i,r):(l.store.subscribe(i.uid,r,Date.now()),l._p2pChannel instanceof ln&&(yield l._gateway.sendExtensionMessage(Dt.SUBSCRIBE,{trackType:h}))),w.info("[".concat(l._clientId,"] subscribe success user ").concat(i.uid,", mediaType: ").concat(r)),l._defaultStreamFallbackType&&l.setStreamFallbackOption(i.uid,l._defaultStreamFallbackType).catch(m=>{w.warning("[".concat(l._clientId,"] auto set fallback failed"),m)});const p="audio"===r?i._audioTrack:i._videoTrack;if(!p)throw new W(x.UNEXPECTED_ERROR,"can not find remote track in user object");return p}catch(p){throw w.error("[".concat(l._clientId,"] subscribe user ").concat(i.uid," error"),p),p}finally{d()}})()}_subscribe(i,r,a){var l=this;return M(function*(){if(l._p2pChannel instanceof ln)return l._p2pSubscribe(i,r);if(gn(r,"mediaType",["audio","video"]),!l._joinInfo)throw new W(x.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==l.connectionState&&"RECONNECTING"!==l.connectionState)throw new W(x.INVALID_OPERATION,"Can't subscribe stream in ".concat(l.connectionState," state"));if(!l._users.find(E=>E===i)){const E=new W(x.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(l._clientId,"] can not subscribe ").concat(i.uid,", this user is not in the channel")),E}if(!i.hasAudio&&!i.hasVideo){const E=new W(x.INVALID_REMOTE_USER,"user is not published");throw w.error("[".concat(l._clientId,"] can not subscribe ").concat(i.uid,", user is not published")),E}if(!(a||("audio"!==r||i.hasAudio&&void 0!==i._audioSSRC)&&("video"!==r||i.hasVideo&&void 0!==i._videoSSRC))){const E=new W(x.REMOTE_USER_IS_NOT_PUBLISHED);throw w.error("[".concat(l._clientId,"] can not subscribe ").concat(i.uid," with mediaType ").concat(r,", remote track is not published")),E}let d="audio"===r?i._audioSSRC:i._videoSSRC,h="audio"===r?i._audioOrtc:i._videoOrtc,p="video"===r?i._rtxSsrcId:void 0,m={stream_type:"audio"===r?Ee.AUDIO:Ee.VIDEO,ssrcId:d};const g=yield l._subscribeMutex.lock();w.info("[".concat(l._clientId,"] subscribe user ").concat(i.uid,", mediaType: ").concat(r));try{if(yield l._p2pChannel.hasRemoteMediaWithLock(i,r))yield l._p2pChannel.unmuteRemote(i,r);else try{const y="audio"===r?i._audioSSRC:i._videoSSRC;void 0!==y&&y!==d&&(d=y,h="audio"===r?i._audioOrtc:i._videoOrtc,p="video"===r?i._rtxSsrcId:void 0,m={stream_type:"audio"===r?Ee.AUDIO:Ee.VIDEO,ssrcId:d}),Di.markSubscribeStart(l.store.clientId,d),l.store.subscribe(i.uid,r,Date.now()),yield l._p2pChannel.subscribe(i,r,d,p,h);try{yield l._gateway.subscribe(i.uid,m,!0)}catch(b){if(b?.code!==x.WS_ABORT)throw yield l._p2pChannel.unsubscribe(i,r),b;yield l._p2pChannel.unsubscribe(i,r,!0),l._p2pChannel.setPendingRemoteMedia(i,r)}l.store.subscribe(i.uid,r,void 0,Date.now()),l._p2pChannel.reportSubscribeEvent(!0,null,i,r)}catch(y){throw l._p2pChannel.reportSubscribeEvent(!1,y?.code,i,r),y}w.info("[".concat(l._clientId,"] subscribe success user ").concat(i.uid,", mediaType: ").concat(r)),l._defaultStreamFallbackType&&l.setStreamFallbackOption(i.uid,l._defaultStreamFallbackType).catch(y=>{w.warning("[".concat(l._clientId,"] auto set fallback failed"),y)});const E="audio"===r?i._audioTrack:i._videoTrack;if(!E)throw new W(x.UNEXPECTED_ERROR,"can not find remote track in user object");return E}catch(E){throw w.error("[".concat(l._clientId,"] subscribe user ").concat(i.uid," error"),E),E}finally{g()}})()}massSubscribe(i){var r=this;return M(function*(){if(fo(i,"subscribeList"),!r._joinInfo)throw new W(x.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new W(x.INVALID_OPERATION,"Can't subscribe stream in ".concat(r.connectionState," state"));const a=Date.now(),l=new Map,d=yield r._subscribeMutex.lock();w.info("[".concat(r._clientId,"]start massSubscribe user ").concat(i.map(g=>{let{user:E,mediaType:y}=g;return"user: ".concat(E?.uid,", mediaType: ").concat(y)}).join("; ")));const h=(i=[...i]).map(g=>{let{user:E,mediaType:y}=g;return{user:E,mediaType:y}}),p=yield r._p2pChannel.globalLock();try{var m;for(let E=i.length-1;E>=0;E--){const y=i[E],{user:b,mediaType:T}=y;if(gn(T,"mediaType",["audio","video"]),!b){const D=new W(x.INVALID_PARAMS,"user property does not exist in subscribeList item");throw w.error("[".concat(r._clientId,"] user property does not exist in subscribeList item")),D}if(!r._users.find(D=>D===b)){const D=new W(x.INVALID_REMOTE_USER,"user is not in the channel");w.error("[".concat(r._clientId,"] can not massSubscribe ").concat(b.uid,", this user is not in the channel")),h[E].error=D,i.splice(E,1);continue}if("audio"===T&&(!b.hasAudio||void 0===b._audioSSRC)||"video"===T&&(!b.hasVideo||void 0===b._videoSSRC)){const D=new W(x.REMOTE_USER_IS_NOT_PUBLISHED);w.error("[".concat(r._clientId,"] can not subscribe ").concat(b.uid," with mediaType ").concat(T,", remote user is not published")),h[E].error=D,i.splice(E,1);continue}const O=Nn.Video|Nn.LwoVideo,P=l.get(b);if(P){if("video"===T?P&O:P&Nn.Audio){i.splice(E,1),w.warning("[".concat(r._clientId,"] repeat massSubscribe user:").concat(b.uid,", mediaType:").concat(T," twice"));continue}l.set(b,P|("video"===T?O:Nn.Audio))}else l.set(b,"video"===T?O:Nn.Audio)}for(let E=i.length-1;E>=0;E--){const y=i[E],{user:b,mediaType:T}=y,O=Nn.Video|Nn.LwoVideo;if(r._p2pChannel.hasRemoteMedia(b,T)){yield r._p2pChannel.unmuteRemoteNoLock(b,T);const P=l.get(b);l.set(b,"video"===T?P^O:P^Nn.Audio),i.splice(E,1)}}r.store.massSubscribe(i.map(E=>({userId:E.user.uid,type:E.mediaType})),a);const g=ll(m=Array.from(l.entries())).call(m,(E,y)=>{let[b,T]=y;if(0===T)return E;const O={stream_id:b.uid,stream_type:T};return T&Nn.Audio&&(O.audio_ssrc=b._audioSSRC),T&Nn.Video&&(O.video_ssrc=b._videoSSRC),E.push(O),E},[]);try{i.length>0&&(yield r._p2pChannel.massSubscribeNoLock(i.map(y=>{let{user:b,mediaType:T}=y;return{user:b,mediaType:T,ssrcId:T===Ee.VIDEO?b._videoSSRC:b._audioSSRC,rtxSsrcId:T===Ee.VIDEO?b._rtxSsrcId:void 0}})));const E=new Map;if(g.length>0){const y=yield r._gateway.subscribeAll(g,!0);(y?.users||[]).forEach(b=>{let{stream_id:T,video_error_code:O,audio_error_code:P,error_code:D}=b;(O||P||D)&&E.set(T,{video_error_code:O,audio_error_code:P,error_code:D})})}if(Array.from(E.entries()).length>0){const y=Array.from(E.entries()).map(b=>{let T,[O,P]=b;return P.error_code||P.video_error_code&&P.audio_error_code?T=void 0:P.video_error_code?T=Ee.VIDEO:P.audio_error_code&&(T=Ee.AUDIO),{user:r.remoteUsers.find(D=>D.uid===O),mediaType:T}});yield r._p2pChannel.massUnsubscribeNoLock(y)}for(const y of h){const b=E.get(y.user.uid);if(b){const T=b.error_code||"audio"===y.mediaType&&b.audio_error_code||"video"===y.mediaType&&b.video_error_code;if(T){const O=El(T);w.error("user:".concat(y.user.uid," mediaType:").concat(y.mediaType," has massSubscribe error ").concat(O.desc)),y.error=new W(x.SUBSCRIBE_FAILED,"code ".concat(T,": ").concat(O.desc))}}y.error||(y.track="video"===y.mediaType?y.user.videoTrack:y.user.audioTrack)}return r.store.massSubscribe(h.filter(y=>!y.error).map(y=>({userId:y.user.uid,type:y.mediaType})),void 0,Date.now()),h.forEach(y=>{var b;Se.subscribe(r.store.sessionId,{succ:!!y.error,ec:(null===(b=y.error)||void 0===b?void 0:b.code)||null,video:y.mediaType===Ee.VIDEO,audio:y.mediaType===Ee.AUDIO,peerid:y.user.uid,subscribeRequestid:y.mediaType===Ee.VIDEO?y.user._videoSSRC:y.user._audioSSRC,p2pid:r.store.p2pId,eventElapse:Math.floor(performance.now()-a)},!0)}),w.info("[".concat(r._clientId,"] massSubscribe success ").concat(i.map(y=>{let{user:b,mediaType:T}=y;return"user: ".concat(b?.uid,", mediaType: ").concat(T)}).join("; "))),h}catch(E){throw yield r._p2pChannel.massUnsubscribeNoLock(i),E}}finally{p(),d()}})()}unsubscribe(i,r,a){var l=this;return M(function*(){if(r||l.store.useP2P){if("datachannel"===r)return l._unsubscribeDataChannel(i,a)}else yield l._unsubscribeDataChannel(i,a);if(r&&gn(r,"mediaType",["audio","video"]),!l._joinInfo)throw new W(x.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!l._users.find(h=>h===i)){const h=new W(x.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(l._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),h}w.info("[".concat(l._clientId,"] unsubscribe uid: ").concat(i.uid,", mediaType: ").concat(r));const d=yield l._subscribeMutex.lock();try{if(l._p2pChannel instanceof ln)yield l._gateway.sendExtensionMessage(Dt.UNSUBSCRIBE,{mediaType:r});else{const h=yield l._p2pChannel.unsubscribe(i,r);h&&(yield l._gateway.unsubscribe(h,i.uid)),w.info("[".concat(l._clientId,"] unsubscribe success uid: ").concat(i.uid,", mediaType: ").concat(r))}}catch(h){if(h.code===x.DISCONNECT_P2P)return void w.warning("disconnecting p2p, abort unsubscribe request.");throw w.error("[".concat(l._clientId,"] unsubscribe user ").concat(i.uid," error"),h.toString()),h}finally{d()}})()}_unsubscribeDataChannel(i,r){var a=this;return M(function*(){if(r&&ft(r,"id",0,65535,!0),!a._joinInfo)throw new W(x.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!a._users.find(d=>d===i)){const d=new W(x.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(a._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),d}let l;if("number"==typeof r){const d=i._dataChannels.find(h=>h.id===r);d&&(l=[d])}else l=i._dataChannels;if(void 0===l){const d=new W(x.REMOTE_USER_IS_NOT_PUBLISHED);throw w.error("[".concat(a._clientId,"] can not unsubscribe ").concat(i.uid," with channelId ").concat(r,", remote datachannel is not published")),d}w.info("[".concat(a._clientId,"] unsubscribe uid: ").concat(i.uid,", mediaType: datachannel, ids: ").concat(l.map(d=>d.id)));try{const d=yield a._p2pChannel.unsubscribeDataChannel(i,l);d&&(yield a._gateway.unsubscribeDataChannel(d,i.uid)),w.info("[".concat(a._clientId,"] unsubscribe datachannel success uid: ").concat(i.uid,", mediaType: datachannel, ids: ").concat(d))}catch(d){if(d.code===x.DISCONNECT_P2P)return void w.warning("disconnecting p2p, abort unsubscribe request.");throw w.error("[".concat(a._clientId,"] unsubscribe user ").concat(i.uid," error"),d.toString()),d}})()}massUnsubscribe(i){var r=this;return M(function*(){if(fo(i,"unsubscribeList"),!r._joinInfo)throw new W(x.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");w.info("[".concat(r._clientId,"] start massUnsubscribe ").concat(i.map(l=>{let{user:d,mediaType:h}=l;return"user: ".concat(d?.uid,", mediaType: ").concat(h,";")}).join())),i=[...i];const a=new Map;for(let l=i.length-1;l>=0;l--){const{user:d,mediaType:h}=i[l];if(!d){const m=new W(x.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw w.error("[".concat(r._clientId,"] user property does not exist in unsubscribeList item")),m}if(gn(h,"mediaType",["video","audio",void 0]),!r._users.find(m=>m===d)){w.warning("[".concat(r._clientId,"] can not unsubscribe ").concat(d.uid,", user is not in the channel")),i.splice(l,1);continue}const p=Nn.Video|Nn.LwoVideo;if(a.has(d)){const m=a.get(d);let g;switch(h){case"video":g=m&p;break;case"audio":g=m&Nn.Audio;break;default:g=m&(Nn.Audio|p)}if(g){w.warning("[".concat(r._clientId,"] repeat massUnsubscribe user:").concat(d.uid,",mediaType:").concat(h," twice.")),i.splice(l,1);continue}h?"audio"===h?a.set(d,m|Nn.Audio):"video"===h&&a.set(d,m|p):a.set(d,m|Nn.Audio|p)}else h?"audio"===h?a.set(d,Nn.Audio):"video"===h&&a.set(d,p):a.set(d,Nn.Audio|p)}try{const l=yield r._p2pChannel.massUnsubscribe(i);l&&(yield r._gateway.massUnsubscribe(l)),w.info("[".concat(r._clientId,"] massUnsubscribe success ").concat(i.map(d=>{let{user:h,mediaType:p}=d;return"user: ".concat(h?.uid,", mediaType: ").concat(p,";")}).join()))}catch(l){if(l.code===x.DISCONNECT_P2P)return void w.warning("[".concat(r._clientId,"] disconnecting p2p, abort unsubscribe request."));throw w.error("[".concat(r._clientId,"] massUnsubscribe error"),l.toString()),l}})()}setLowStreamParameter(i){var r=this;return M(function*(){(function(l){if(!l)throw new J(x.INVALID_PARAMS);kt(l.width)||cl(l.width,"streamParameter.width"),kt(l.height)||cl(l.height,"streamParameter.height"),kt(l.framerate)||cl(l.framerate,"streamParameter.framerate"),kt(l.bitrate)||ft(l.bitrate,"streamParameter.bitrate")})(i),(!i.width&&i.height||i.width&&!i.height)&&w.warning("[".concat(r._clientId,"] The width and height parameters take effect only when both are set")),w.info("[".concat(r._clientId,"] set low stream parameter to"),JSON.stringify(i));const a=r._configDistribute.getLowStreamConfigDistribute();if(a&&a.bitrate&&i.bitrate&&a.bitrate<i.bitrate&&(i.bitrate=a.bitrate),r._lowStreamParameter=i,r._isDualStreamEnabled)return r._p2pChannel.updateVideoStreamParameter(i,ne.LocalVideoLowTrack)})()}enableDualStream(){var i=this;return M(function*(){if(!$e().supportDualStream)throw Se.streamSwitch(i._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new W(x.NOT_SUPPORTED,"Your browser is not support dual stream");if(i._isDualStreamEnabled)throw new W(x.INVALID_OPERATION,"Dual stream is already enabled");if(i._p2pChannel.canPublishLowStream())try{yield i._publishLowStream()}catch(r){throw Se.streamSwitch(i._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),r}i._isDualStreamEnabled=!0,Se.streamSwitch(i._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),w.info("[".concat(i._clientId,"] enable dual stream"))})()}disableDualStream(){var i=this;return M(function*(){if(i._isDualStreamEnabled){if(!i._joinInfo)throw new W(x.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(i._p2pChannel.getLocalMedia(ne.LocalVideoLowTrack))try{const r=yield i._p2pChannel.unpublishLowStream();r&&(yield i._gateway.unpublish(r,i._joinInfo.stringUid||i._joinInfo.uid))}catch(r){throw Se.streamSwitch(i._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),r}i._isDualStreamEnabled=!1,Se.streamSwitch(i._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),w.info("[".concat(i._clientId,"] disable dual stream"))}})()}setClientRole(i,r){var a=this;return M(function*(){if(gn(i,"role",["audience","host"]),r&&Ef(r),"rtc"===a.mode)throw w.warning("[".concat(a._clientId,"]rtc mode can not use setClientRole")),new W(x.INVALID_OPERATION,"rtc mode can not use setClientRole");if(r&&r.level&&"host"===i)throw new W(x.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===i&&a._p2pChannel.hasLocalMedia())throw new W(x.INVALID_OPERATION,"can not set client role to audience when publishing stream");yield a._gateway.setClientRole(i,r),a._config.role=i,w.info("[".concat(a._clientId,"] set client role to ").concat(i,", level: ").concat(r&&r.level))})()}getRemoteInboundOffset(){var i;const r=null===(i=this._p2pChannel.getStats())||void 0===i?void 0:i.audioSend[0];if(!r||!r.timestamp)return 0;const a=r.timestamp-Date.now();return Math.abs(a)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?a:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(i,r){if(Un(i,"proxyServer"),!r){if("DISCONNECTED"!==this.connectionState)throw new W(x.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new W(x.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=i,Se.setProxyServer(this._proxyServer),w.setProxyServer(this._proxyServer),w.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(i,r){if(Array.isArray(i)||(i=[i]),!r){if("DISCONNECTED"!==this.connectionState)throw new W(x.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new W(x.INVALID_OPERATION,"You have already set the proxy")}if(Da(i))return this._turnServer={servers:i,mode:"original-manual"},void w.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(i.map(a=>a.urls).join(","),"."));i.forEach(a=>Jg(a)),this._turnServer={servers:i,mode:"manual"},w.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(i){if("DISCONNECTED"!==this.connectionState)throw new W(x.INVALID_OPERATION,"you should set license before join channel");if(Un(i,"license",32,32),!/^[A-Za-z\d]+$/.test(i))throw new W(x.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=i,w.info("[".concat(this._clientId,"] set license success"),i)}startProxyServer(i){if("DISCONNECTED"!==this.connectionState)throw new W(x.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new W(x.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let a;switch(void 0===i&&(i=3),i){case 1:case 2:throw new W(x.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:a="proxy3";break;case 4:a="proxy4";break;case 5:a="proxy5";break;default:throw new W(x.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=a,this.store.cloudProxyServerMode=a,w.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new W(x.INVALID_OPERATION,"Stop proxy server after leave channel");Se.setProxyServer(),w.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",w.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(i){if(!i.accessPoints)throw new W(x.INVALID_PARAMS,"accessPoints is required.");fo(i.accessPoints.serverList,"accessPoints.serverList"),Un(i.accessPoints.domain,"accessPoints.domain");const r=(T,O)=>{ft(T,O,0,65535,!0)};let a=443;if(i.accessPoints.port&&(r(i.accessPoints.port,"accessPoints.port"),a=i.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new W(x.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");j("CLOSE_AFB_FOR_LOCAL_AP")&&(At("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),At("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const l=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,d=i.accessPoints.domain,h=i.accessPoints.serverList.map(T=>l.test(T)?"".concat(T.replace(/\./g,"-"),".").concat(d):T),p=h.map(T=>"".concat(T,":").concat(a));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,At("WEBCS_DOMAIN",p),At("WEBCS_DOMAIN_BACKUP_LIST",p),At("GATEWAY_DOMAINS",[d]),i.report&&i.report.hostname&&Array.isArray(i.report.hostname)&&i.report.hostname.length?(fo(i.report.hostname,"report.hostname"),At("EVENT_REPORT_DOMAIN",i.report.hostname[0]),At("EVENT_REPORT_BACKUP_DOMAIN",i.report.hostname[1]||i.report.hostname[0])):(At("EVENT_REPORT_DOMAIN",h[0]),At("EVENT_REPORT_BACKUP_DOMAIN",h[1]||h[0]));let m=6443;i.report&&i.report.port&&(r(i.report.port,"report.port"),m=i.report.port),At("STATS_COLLECTOR_PORT",m),At("ENABLE_EVENT_REPORT",!!i.report);let g="";i.log&&i.log.hostname&&Array.isArray(i.log.hostname)&&i.log.hostname.length?(fo(i.log.hostname,"log.hostname"),g=i.log.hostname[0]):g=h[0];let E=6444;i.log&&i.log.port&&(r(i.log.port,"log.port"),E=i.log.port),At("LOG_UPLOAD_SERVER","".concat(g,":").concat(E));let y=[];i.cds&&i.cds.hostname&&Array.isArray(i.cds.hostname)&&i.cds.hostname.length?(fo(i.cds.hostname,"cds.hostname"),y=i.cds.hostname):y=h;let b=443;i.cds&&i.cds.port&&(r(i.cds.port,"cds.port"),b=i.cds.port),At("CDS_AP",y.map(T=>"".concat(T,":").concat(b))),At("ENABLE_CONFIG_DISTRIBUTE",!!i.cds),w.info("set local access point v2 success")}setLocalAccessPoints(i,r){if(fo(i,"serverList"),Un(r,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new W(x.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const a=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;i=i.map(l=>a.test(l)?"".concat(l.replace(/\./g,"-"),".").concat(r):l),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,At("WEBCS_DOMAIN",i),At("WEBCS_DOMAIN_BACKUP_LIST",i),At("GATEWAY_DOMAINS",[r]),At("EVENT_REPORT_DOMAIN",i[0]),At("EVENT_REPORT_BACKUP_DOMAIN",i[1]||i[0]),At("LOG_UPLOAD_SERVER","".concat(i[0],":6444")),w.info("[".concat(this._clientId,"] set local access point success"))}setRemoteDefaultVideoStreamType(i){var r=this;return M(function*(){if(gn(i,"streamType",[0,1]),r._remoteDefaultVideoStreamType=i,r._joinInfo)try{yield r._gateway.setDefaultRemoteVideoStreamType(i),r._joinInfo.defaultVideoStream=r._remoteDefaultVideoStreamType}catch(a){throw w.error("[".concat(r._clientId,"] set default remote video stream type error"),a.toString()),a}else w.debug("[".concat(r._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(i))})()}setRemoteVideoStreamType(i,r){var a=this;return M(function*(){gn(r,"streamType",[0,1]);try{yield a._gateway.setRemoteVideoStreamType(i,r),setTimeout(()=>{const l=a._users.find(d=>d.uid===i);l&&l.videoTrack&&l.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(l){throw w.error("[".concat(a._clientId,"] set remote video stream type error"),l.toString()),l}w.info("[".concat(a._clientId,"] set remote ").concat(i," video stream type to ").concat(r)),a._remoteStreamTypeCacheMap.set(i,r)})()}setStreamFallbackOption(i,r){var a=this;return M(function*(){gn(r,"fallbackType",[0,1,2]);try{yield a._gateway.setStreamFallbackOption(i,r)}catch(l){throw w.error("[".concat(a._clientId,"] set stream fallback option"),l.toString()),l}w.info("[".concat(a._clientId,"] set remote ").concat(i," stream fallback type to ").concat(r)),a._streamFallbackTypeCacheMap.set(i,r)})()}setEncryptionConfig(i,r,a){gn(i,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"]),Un(r,"secret");const l=["aes-128-gcm2","aes-256-gcm2"];if(ye(l).call(l,i)){if(!a||!(a instanceof Uint8Array&&32===a.length))throw new W(x.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(a)throw new W(x.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(r)||w.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=i,this._encryptionSecret=r,a&&(this._encryptionSalt=dh(a))}renewToken(i){var r=this;return M(function*(){if(Un(i,"token",1,2047),!r._key||!r._joinInfo)throw new W(x.INVALID_OPERATION,"renewToken should not be called before user join");const a=r._key;r._key=i,r._joinInfo&&(r._joinInfo.token=i);const l=yield r._renewTokenMutex.lock();try{if(j("USE_NEW_TOKEN")){w.debug("[".concat(r._clientId,"] start renew token with ticket from unilbs"));const d=yield function S0(s,i,r){return C0.apply(this,arguments)}(r._joinInfo,r._axiosCancelSource.token,r._config.httpRetryConfig||Re);w.debug("[".concat(r._clientId,"] get ticket from unilbs success")),yield r._gateway.renewToken({token:i,ticket:d})}else w.debug("[".concat(r._clientId,"] start renew token without ticket")),yield r._gateway.renewToken({token:i});w.debug("[".concat(r._clientId,"] renewToken success"))}catch(d){throw r._key=a,r._joinInfo.token=a,w.error("[".concat(r._clientId,"] renewToken failed"),d.toString()),d}finally{l()}})()}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?w.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const i=this._p2pChannel.getAudioLevels();this.safeEmit(Xe.VOLUME_INDICATOR,i)},j("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const i=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return i.Duration=Math.round(r.duration/1e3),i}startLiveStreaming(i,r){var a=this;return M(function*(){if(!r){if("h264"!==a.codec)throw new W(x.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!a._p2pChannel.hasLocalMedia())throw new W(x.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(a._liveRawStreamingClient&&a._liveRawStreamingClient.hasUrl(i)||a._liveTranscodeStreamingClient&&a._liveTranscodeStreamingClient.hasUrl(i))throw new W(x.LIVE_STREAMING_TASK_CONFLICT);const l=r?Bn.TRANSCODE:Bn.RAW;return a._createLiveStreamingClient(l).startLiveStreamingTask(i,l)})()}setLiveTranscoding(i){return this._createLiveStreamingClient(Bn.TRANSCODE).setTranscodingConfig(i)}stopLiveStreaming(i){var r=this;return M(function*(){const a=[r._liveRawStreamingClient,r._liveTranscodeStreamingClient].filter(l=>l&&l.hasUrl(i));if(!a.length)throw new W(x.INVALID_PARAMS,"can not find live streaming url to stop");yield q.all(a.map(l=>l&&l.stopLiveStreamingTask(i)))})()}addInjectStreamUrl(i,r){var a=this;return M(function*(){if(!a._joinInfo)throw new W(x.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const l=a._createLiveStreamingClient(Bn.INJECT);l.setInjectStreamConfig(r,0),yield l.startLiveStreamingTask(i,Bn.INJECT)})()}removeInjectStreamUrl(){var i=this;return M(function*(){var r;const a=i._createLiveStreamingClient(Bn.INJECT),l=Array.from(yo(r=a.streamingTasks).call(r)).find(d=>d.mode===Bn.INJECT);if(!i._joinInfo||!l)throw new W(x.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");yield a.stopLiveStreamingTask(l.url)})()}startChannelMediaRelay(i){var r=this;return M(function*(){_v(i),yield r._createChannelMediaRelayClient().startChannelMediaRelay(i)})()}updateChannelMediaRelay(i){var r=this;return M(function*(){_v(i),yield r._createChannelMediaRelayClient().updateChannelMediaRelay(i)})()}stopChannelMediaRelay(){var i=this;return M(function*(){yield i._createChannelMediaRelayClient().stopChannelMediaRelay(),i._statsCollector.onStatsChanged&&(i._statsCollector.onStatsChanged=void 0)})()}sendStreamMessage(i){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new W(x.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof i||i instanceof Uint8Array)&&(i={payload:i}),"string"==typeof i.payload){const a=new TextEncoder;i.payload=a.encode(i.payload)}if(new Blob([i.payload]).size>1024)throw new W(x.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(Ce.DATA_STREAM,{payload:dh(i.payload),syncWithAudio:i.syncWithAudio,sendTs:Date.now()-YN},!r)}sendMetadata(i){if(!this._joinInfo)throw new W(x.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([i]).size>1024)throw new W(x.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Ce.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:dh(i)})}sendCustomReportMessage(i){var r=this;return M(function*(){if(Array.isArray(i)||(i=[i]),i.forEach(Nf),!r._joinInfo)throw new W(x.INVALID_OPERATION,"can not send custom report, not joined");yield Se.sendCustomReportMessage(r._joinInfo.sid,i)})()}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}pickSVCLayer(i,r){var a=this;return M(function*(){gn(r.spatialLayer,"spatialLayer",[0,1,2,3]),gn(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{yield a._gateway.pickSVCLayer(i,r)}catch(l){throw w.error("[".concat(a._clientId,"] pick SVC layer failed"),l.toString()),l}})()}setRTM2Flag(i){if(gn(i,"flag",[0,1]),!this._joinInfo)throw new W(x.INVALID_OPERATION,"Can't setRtm2Flag, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new W(x.INVALID_OPERATION,"Can't setRtm2Flag in ".concat(this.connectionState," state"));return this._gateway.setRTM2Flag(i)}_reset(){if(w.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=vr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._pendingPublishedUsers=[],this._users.forEach(i=>{i._audioTrack&&i._audioTrack._destroy(),i._videoTrack&&i._videoTrack._destroy(),i._dataChannels&&(i._dataChannels.forEach(r=>r._close()),i._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Zn("client-publish"),this._subscribeMutex=new Zn("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(i,r){const a=i||Zg();w.debug(i?"[".concat(this._clientId,"] new Session ").concat(a):"[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(a)),this._sessionId=a,this.store.sessionId=a,r?Se.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:r.channel,appid:r.appId,mode:this.mode}):this._joinInfo?Se.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this.mode}):this._gateway.joinInfo&&Se.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this.mode}),this._joinInfo&&(this._joinInfo.sid=a),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=a)}_publishHighStream(i){var r=this;return M(function*(){if(!r._joinInfo||void 0===r._uid)throw new W(x.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new W(x.INVALID_OPERATION,"can not publish stream in ".concat(r.connectionState," state"));if("auto"===r._turnServer.mode&&j("FORCE_TURN")&&!j("TURN_ENABLE_TCP")&&!j("TURN_ENABLE_UDP"))throw new W(x.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");w.debug("[".concat(r._clientId,"] publish high stream"));try{if(r._p2pChannel instanceof ln){const l=yield r._p2pChannel.publish(i,r._isDualStreamEnabled,r._lowStreamParameter);if(l)try{yield r._gateway.sendExtensionMessage(Dt.PUBLISH,l)}catch(d){throw r._p2pChannel.unpublish(i),d}}else{const l=yield r._p2pChannel.publish(i,r._isDualStreamEnabled,r._lowStreamParameter),d=(yield l.next()).value;if(d){var a;let h;try{h=yield r._gateway.publish(r._uid,d,!0)}catch(p){if(p.code!==x.DISCONNECT_P2P)throw l.throw(p),p}yield l.next((null===(a=h)||void 0===a?void 0:a.ortc)||[])}r._p2pChannel.reportPublishEvent(!0,null);for(const h of i)h instanceof ze&&h._encoderConfig&&r._gateway.setVideoProfile(h._encoderConfig),!h.muted&&h.enabled||(yield r._p2pChannel.muteLocalTrack(h))}}catch(l){if(r._p2pChannel.reportPublishEvent(!1,l?.code,i),l?.code===x.WS_ABORT)return;throw l}})()}_publishLowStream(){var i=this;return M(function*(){if(!i._joinInfo||void 0===i._uid)throw new W(x.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==i.connectionState&&"RECONNECTING"!==i.connectionState)throw new W(x.INVALID_OPERATION,"can not publish stream in ".concat(i.connectionState," state"));w.debug("[".concat(i._clientId,"] publish low stream"));const r=i._configDistribute.getLowStreamConfigDistribute();r&&r.bitrate&&(i._lowStreamParameter||(i._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),i._lowStreamParameter&&i._lowStreamParameter.bitrate&&r.bitrate<i._lowStreamParameter.bitrate&&(i._lowStreamParameter.bitrate=r.bitrate));try{const l=yield i._p2pChannel.publishLowStream(i._lowStreamParameter),d=(yield l.next()).value;if(d){var a;let h;try{h=yield i._gateway.publish(i._uid,d,!0)}catch(p){if(p.code!==x.DISCONNECT_P2P)throw l.throw(p),p}l.next((null===(a=h)||void 0===a?void 0:a.ortc)||[]),i._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(l){if(i._p2pChannel.reportPublishEvent(!1,l?.code,void 0,!0),l?.code===x.WS_ABORT)return;throw l}})()}_createLiveStreamingClient(i){if(!this._joinInfo||!this._appId)return new W(x.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const r=()=>new w0(this._joinInfo,this._config.websocketRetryConfig||Re,this._config.httpRetryConfig||Re),a=l=>{l.onLiveStreamError=(d,h)=>{Se.reportApiInvoke(this._sessionId,{name:On.ON_LIVE_STREAM_ERROR,options:[d,h],tag:Xt.TRACER}).onSuccess(),this.safeEmit(Xe.LIVE_STREAMING_ERROR,d,h)},l.onLiveStreamWarning=(d,h)=>{Se.reportApiInvoke(this._sessionId,{name:On.ON_LIVE_STREAM_WARNING,options:[d,h],tag:Xt.TRACER}).onSuccess(),this.safeEmit(Xe.LIVE_STREAMING_WARNING,d,h)},l.on(yh.REQUEST_WORKER_MANAGER_LIST,(d,h,p)=>{if(!this._joinInfo)return p(new W(x.INVALID_OPERATION,"can not find join info to get worker manager"));fv(d,this._joinInfo,this._axiosCancelSource.token,Re).then(h).catch(p)})};switch(i){case Bn.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=r(),a(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Bn.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=r(),a(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Bn.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=r(),this._injectStreamingClient.on(yh.REQUEST_WORKER_MANAGER_LIST,(l,d,h)=>{if(!this._joinInfo)return h(new W(x.INVALID_OPERATION,"can not find join info to get worker manager"));fv(l,this._joinInfo,this._axiosCancelSource.token,Re).then(d).catch(h)}),this._injectStreamingClient.onInjectStatusChange=(l,d,h)=>{this.safeEmit(Xe.INJECT_STREAM_STATUS,l,d,h)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new W(x.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:i,sendResolutionHeight:r}=this.getLocalVideoStats();this._channelMediaRelayClient=new _N(this._joinInfo,this._clientId,this._config.websocketRetryConfig||Re,this._config.httpRetryConfig||Re,{width:i,height:r}),this._channelMediaRelayClient.on("state",l=>{l===Ji.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(Xe.CHANNEL_MEDIA_RELAY_STATE,l)}),this._channelMediaRelayClient.on("event",l=>{this.safeEmit(Xe.CHANNEL_MEDIA_RELAY_EVENT,l)}),this._statsCollector.onStatsChanged=(l,d)=>{var h;"resolution"===l&&(null===(h=this._channelMediaRelayClient)||void 0===h||h.setVideoProfile(d))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(i,r){const{added:a,deleted:l}=i,d=[];Array.isArray(a)&&a.length>0&&a.forEach(h=>{const{uid:p,stream_id:m,ordered:g,max_retrans_times:E,metadata:y}=h,b=this._users.find(T=>T._uintid===p);if(b){if(w.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(p)),ye(d).call(d,b)||d.push(b),b._uintid||(b._uintid=p),-1===b._dataChannels.findIndex(T=>T.id===h.stream_id)){const T={id:m,ordered:!!g,maxRetransmits:E,metadata:y},O=new Pn(T);b._dataChannels.push(O),w.info("[".concat(this._clientId,"] remote user ").concat(b.uid," published datachannel")),r||this.safeEmit(Xe.USER_PUBLISHED,b,"datachannel",T)}this._p2pChannel.hasPendingRemoteDataChannel(b,h.stream_id)&&(w.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(b.uid," after reconnect.")),this._subscribeDataChannel(b,h.stream_id).catch(T=>{w.error("[".concat(this._clientId,"] resubscribe datachannel error"),T.toString())}))}else w.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))}),r&&(this.safeEmit(Xe.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(l)&&l.length>0&&l.forEach(h=>{const{uid:p}=h,g=this._users.find(y=>y._uintid===p);if(!g)return void w.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const E=g._dataChannels.find(y=>y.id===h.stream_id);E&&(w.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(p)),this._p2pChannel.unsubscribeDataChannel(g,[E]).then(y=>{if(y)return g._dataChannels=g._dataChannels.filter(b=>b!==E),this._gateway.unsubscribeDataChannel(y,g.uid)}),w.info("[".concat(this._clientId,"] remote user ").concat(p," unpublished datachannel ,id:").concat(E.id)),this.safeEmit(Xe.USER_UNPUBLISHED,g,"datachannel",E._config))})}_handleRemoveDataChannels(i){const r=this._users.find(a=>a.uid===i.uid);if(r){if(void 0!==r._dataChannels&&r._dataChannels.length>0){w.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(i.uid));const a=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(l=>{this.safeEmit(Xe.USER_UNPUBLISHED,r,"datachannel",l._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(l=>{if(l)return this._gateway.unsubscribeDataChannel(l,r.uid)}),a()}}else w.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){var i=this;this._gateway.on(sn.DISCONNECT_P2P,M(function*(){yield i._p2pChannel.disconnectForReconnect()})),this._gateway.on(sn.CONNECTION_STATE_CHANGE,(r,a,l)=>{var d;if(l===Ye.FALLBACK)return;const h=()=>{this.safeEmit(Xe.CONNECTION_STATE_CHANGE,r,a,l)};if(Se.reportApiInvoke(this._sessionId||(null===(d=this._gateway.joinInfo)||void 0===d?void 0:d.sid)||null,{name:On.CONNECTION_STATE_CHANGE,options:[r,a,l],tag:Xt.TRACER}).onSuccess(JSON.stringify({cur:r,prev:a,reason:l})),w.info("[".concat(this._clientId,"] connection state change: ").concat(a," -> ").concat(r)),"DISCONNECTED"===r)return this._reset(),void h();if("RECONNECTING"===r)this._users.forEach(m=>{m._trust_in_room_=!1,m._trust_audio_enabled_state_=!1,m._trust_video_enabled_state_=!1,m._trust_audio_mute_state_=!1,m._trust_video_mute_state_=!1,m._trust_audio_stream_added_state_=!1,m._trust_video_stream_added_state_=!1,m._audioSSRC=void 0,m._videoSSRC=void 0,m._videoOrtc=void 0,m._audioOrtc=void 0,m._cname=void 0,m._rtxSsrcId=void 0}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===r){var p;this._streamFallbackTypeCacheMap.forEach((m,g)=>{this._gateway.setStreamFallbackOption(g,m).catch(E=>{w.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),E)})}),this._remoteStreamTypeCacheMap.forEach((m,g)=>{this._gateway.setRemoteVideoStreamType(g,m).catch(E=>{w.warning("[".concat(this._clientId,"] auto set remote stream type failed"),E)})}),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(p=this._joinInfo)||void 0===p?void 0:p.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{w.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(m=>{w.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(m))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter(m=>!m._trust_in_room_).forEach(m=>{w.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(m.uid)),this._handleUserOffline({uid:m.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach(m=>{m._trust_audio_mute_state_||(w.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(m.uid)),this._handleMuteStream(m.uid,Ee.AUDIO,!1)),m._trust_video_mute_state_||(w.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(m.uid)),this._handleMuteStream(m.uid,Ee.VIDEO,!1)),m._trust_audio_enabled_state_||(w.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(m.uid)),this._handleSetStreamLocalEnable("audio",m.uid,!0)),m._trust_video_enabled_state_||(w.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(m.uid)),this._handleSetStreamLocalEnable("video",m.uid,!0)),m._trust_video_stream_added_state_||(w.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(m.uid)),this._handleResetAddStream(m,"video")),m._trust_audio_stream_added_state_||(w.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(m.uid)),this._handleResetAddStream(m,"audio")),m._video_added_||m._audio_added_||(w.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(m.uid)),this._handleRemoveStream({uid:m.uid,uint_id:m._uintid}))}))},1e3))}h()}),this._gateway.on(sn.REQUEST_NEW_GATEWAY_LIST,(r,a)=>{if(!this._joinInfo)return a(new W(x.UNEXPECTED_ERROR,"can not recover, no join info"));pv(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Re,this.store).then(l=>{this._joinInfo&&(this._joinInfo.apResponse=l.gatewayInfo.res,this._joinInfo.gatewayAddrs=l.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=l.gatewayInfo.uni_lbs_ip);const d=[];l.gatewayInfo.gatewayAddrs.forEach(h=>{let{address:p}=h;const[m,g]=p.split(":");d.push(this._joinInfo&&this._joinInfo.proxyServer?{proxy:this._joinInfo.proxyServer,host:m,port:g}:{host:m,port:g})}),r(d)}).catch(a)}),this._gateway.on(sn.NETWORK_QUALITY,r=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(Xe.NETWORK_QUALITY,r)}),this._gateway.on(sn.STREAM_TYPE_CHANGE,(r,a)=>{this.safeEmit(Xe.STREAM_TYPE_CHANGED,r,a),Se.reportApiInvoke(this._sessionId,{name:On.STREAM_TYPE_CHANGE,options:[r,a],tag:Xt.TRACER}).onSuccess(JSON.stringify({uid:r,streamType:a}))}),this._gateway.on(sn.IS_P2P_DISCONNECTED,r=>{this._p2pChannel.isP2PDisconnected()?r(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?r(!1):r(!0)}),this._gateway.on(sn.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(sn.REQUEST_P2P_CONNECTION_PARAMS,function(){var r=M(function*(a,l,d){try{l(yield i._p2pChannel.startP2PConnection(a))}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.on(sn.JOIN_RESPONSE,(r,a)=>{if(this.store.useP2P)return;const{dtlsParameters:l,iceParameters:d,candidates:h,rtpCapabilities:p,setup:m,cname:g}=SN(r.ortc,a);this._p2pChannel.connect(d,l,h,p,m,g)}),this._gateway.on(sn.REQUEST_DC_CONNECTION_PARAMS,r=>{r(this._p2pChannel.getEstablishParams())}),this._gateway.on(sn.RESET_SIGNAL,r=>{this._p2pChannel.resetConnection(r),this._handleGatewaySignalEvents()}),this._gateway.on(sn.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(sn.DATACHANNEL_PRECONNECT,function(){var r=M(function*(a,l,d,h){var p,m,g,E,y,b;yield i._p2pChannel.startP2PConnection({turnServer:null===(p=i._joinInfo)||void 0===p?void 0:p.turnServer},!0);const T=function(O,P){let D;return P&&P.ip&&"number"==typeof P.port?(D=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:P.ip,port:P.port.toString(),type:"host",extension:{}}],w.debug("Using remote candidate from AP ".concat(P.ip,":").concat(P.port)),P.ip6&&(D.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:P.ip6,port:P.port.toString(),type:"host",extension:{}}),w.debug("Using IPV6 remote candidate from AP ".concat(P.ip6,":").concat(P.port)))):D=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:O.ip,port:O.port.toString(),type:"host",extension:{}}],D}(a,l);return i._p2pChannel.preConnect({iceUfrag:"".concat(null===(m=i._joinInfo)||void 0===m?void 0:m.apResponse.cid,"_").concat(null===(g=i._joinInfo)||void 0===g?void 0:g.apResponse.cert),icePwd:"".concat(null===(E=i._joinInfo)||void 0===E?void 0:E.apResponse.cid,"_").concat(null===(y=i._joinInfo)||void 0===y?void 0:y.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(b=j("FINGERPRINT"))&&void 0!==b?b:a.fingerprint}]},T,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(d).catch(h)});return function(a,l,d,h){return r.apply(this,arguments)}}())}_handleGatewaySignalEvents(){var i=this;this._gateway.signal.on(Ue.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Ue.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Ue.ON_ADD_AUDIO_STREAM,r=>this._handleAddAudioOrVideoStream("audio",r.uid,r.ssrcId,r.cname,r.uint_id,r.ortc)),this._gateway.signal.on(Ue.ON_ADD_VIDEO_STREAM,r=>this._handleAddAudioOrVideoStream("video",r.uid,r.ssrcId,r.cname,r.uint_id,r.ortc,r.rtxSsrcId)),this._gateway.signal.on(Ue.ON_REMOTE_DATASTREAM_UPDATE,r=>{this._handleUpdateDataChannel(r)}),this._gateway.signal.on(Ue.ON_REMOTE_FULL_DATASTREAM_INFO,r=>{this._handleUpdateDataChannel({added:r.datastreams,deleted:[]},!0)}),this._gateway.signal.on(Ue.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Ue.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Ue.MUTE_AUDIO,r=>this._handleMuteStream(r.uid,Ee.AUDIO,!0)),this._gateway.signal.on(Ue.UNMUTE_AUDIO,r=>this._handleMuteStream(r.uid,Ee.AUDIO,!1)),this._gateway.signal.on(Ue.MUTE_VIDEO,r=>this._handleMuteStream(r.uid,Ee.VIDEO,!0)),this._gateway.signal.on(Ue.UNMUTE_VIDEO,r=>this._handleMuteStream(r.uid,Ee.VIDEO,!1)),this._gateway.signal.on(Ue.RECEIVE_METADATA,r=>{const a=Qg(r.metadata);this.safeEmit(Xe.RECEIVE_METADATA,r.uid,a)}),this._gateway.signal.on(Ue.ON_DATA_STREAM,function(){var r=M(function*(a){if(!a)return;let l=0;if(a.ordered||a.syncWithAudio){const d=i._p2pChannel.getStats(),h=i.remoteUsers.find(m=>m.uid===a.uid),p=d?.audioRecv.find(m=>m.ssrc===h?._audioSSRC);l=p?.jitterBufferMs}null==l&&(l=0),function H3(s){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(!s.syncWithAudio)return eT(r,{uid:s.uid,payload:Qg(s.payload)});const a="".concat(r.id,"-").concat(s.uid),l=Z0.get(a)||[],d=l.findIndex(g=>s.sendTs>=g.sendTs),h=KN(KN({},s),{},{context:r,mediaDelay:i,recvTs:Date.now()});-1===d?l.push(h):l.splice(d,0,h),Z0.set(a,l);let p=!1;var m;Ov.has(a)?p=!(null===(m=Ov.get(a))||void 0===m||!m.isSyncing):Ov.set(a,{isSyncing:p,firstRecvTs:0,firstSendTs:0}),p||$2(a)}(a,l,{id:i._clientId,onStreamMessage:"function"==typeof i.onStreamMessage?i.onStreamMessage.bind(i):void 0,safeEmit:i.safeEmit.bind(i)})});return function(a){return r.apply(this,arguments)}}()),this._gateway.signal.on(Ue.ON_CRYPT_ERROR,()=>{vf(()=>{w.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Xe.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Ue.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{w.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Ye.TOKEN_EXPIRE),this.safeEmit(Xe.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Ue.ON_STREAM_FALLBACK_UPDATE,r=>{w.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(r.stream_id,", attr: ").concat(r.stream_type)),this.safeEmit(Xe.STREAM_FALLBACK,r.stream_id,1===r.stream_type?"fallback":"recover")}),this._gateway.signal.on(Ue.ON_PUBLISH_STREAM,r=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:r.proxy})),w.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(r))))}),this._gateway.signal.on(Ue.ENABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!0)}),this._gateway.signal.on(Ue.DISABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!1)}),this._gateway.signal.on(he.REQUEST_TIMEOUT,(r,a)=>{if(this._joinInfo)switch(r){case Ce.PUBLISH:{if(!a)return;const h=a.ortc;if(h){var l,d;const p=h.some(E=>{let{stream_type:y}=E;return y===It.Audio}),m=h.some(E=>{let{stream_type:y}=E;return y!==It.Audio}),g=h.some(E=>{let{stream_type:y}=E;return y===It.Screen||y===It.ScreenLow});"offer"===a.state&&Se.publish(this._joinInfo.sid,{eventElapse:Di.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:x.TIMEOUT,audio:p,video:m,p2pid:a.p2p_id,publishRequestid:this.store.pubId,screenshare:g,audioName:p?null===(l=h.find(E=>{let{stream_type:y}=E;return y===It.Audio}))||void 0===l||null===(l=l.ssrcs[0])||void 0===l?void 0:l.ssrcId.toString():void 0,videoName:m?null===(d=h.find(E=>{let{stream_type:y}=E;return y!==It.Audio}))||void 0===d||null===(d=d.ssrcs[0])||void 0===d?void 0:d.ssrcId.toString():void 0})}break}case Ce.SUBSCRIBE:a&&Se.subscribe(this._joinInfo.sid,{succ:!1,ec:x.TIMEOUT,audio:a.stream_type===Ee.AUDIO,video:a.stream_type===Ee.VIDEO,peerid:a.stream_id,subscribeRequestid:a.ssrcId,p2pid:this.store.p2pId,eventElapse:Di.measureFromSubscribeStart(this.store.clientId,a.ssrcId)})}}),this._gateway.signal.on(Ue.ON_P2P_OK,r=>{}),this._gateway.signal.on(Ue.ON_PUBLISHED_USER_LIST,r=>{if(null==r||!r.users)return;j("BLOCK_LOCAL_CLIENT")&&(r.users=r.users.filter(d=>!fl(d.string_id||d.stream_id,this.channelName)));const a=[],l=[];for(const d of r.users){let h=this._users.find(b=>b._uintid===d.stream_id);h?h._trust_in_room_=!0:(h=new Oi(d.string_id||d.stream_id,d.stream_id),this._users.push(h),0===this.getListeners(Xe.PUBLISHED_USER_LIST).length&&(w.debug("[".concat(this._clientId,"] user online"),d.stream_id),this.safeEmit(Xe.USER_JOINED,h)));const p=Nn.Audio&d.stream_type,m=(Nn.Video|Nn.LwoVideo)&d.stream_type,g=0!=(65280&d.stream_type),E=p&&h.hasAudio,y=m&&h.hasVideo;m&&(h._trust_video_stream_added_state_=!0,h._video_added_=!0,h._videoSSRC=d.video_ssrc,h._rtxSsrcId=d.video_rtx),p&&(h._trust_audio_stream_added_state_=!0,h._audio_added_=!0,h._audioSSRC=d.audio_ssrc),p&&!E&&0===this.getListeners(Xe.PUBLISHED_USER_LIST).length&&(w.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published audio")),this.safeEmit(Xe.USER_PUBLISHED,h,"audio")),m&&!y&&0===this.getListeners(Xe.PUBLISHED_USER_LIST).length&&(w.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published video")),this.safeEmit(Xe.USER_PUBLISHED,h,"video")),(p&&!E||m&&!y||g)&&a.push(h),m&&this._p2pChannel.hasPendingRemoteMedia(h,"video")&&l.push({user:h,mediaType:"video"}),p&&this._p2pChannel.hasPendingRemoteMedia(h,"audio")&&l.push({user:h,mediaType:"audio"})}l.length>0&&(w.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(l.map(d=>"user: ".concat(d.user.uid,", mediaType: ").concat(d.mediaType)).join("; ")," ")),this.massSubscribe(l).catch(d=>{w.error("[".concat(this._clientId,"] mass resubscribe error"),d.toString())})),this.getListeners(Xe.PUBLISHED_USER_LIST).length>0?j("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=a:(w.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(a.map(d=>d.uid).join(", "))),this.safeEmit(Xe.PUBLISHED_USER_LIST,a)):w.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(a.map(d=>d.uid).join(", ")))}),this._gateway.signal.on(Ue.ON_RTP_CAPABILITY_CHANGE,r=>{const{video_codec:a}=r;this._p2pChannel instanceof ci&&this._p2pChannel.updateRemoteRTPCapabilities(a.map(l=>l.toLowerCase()).filter(l=>{var d;return ye(d=Object.keys(Ui)).call(d,l)}))})}_handleP2PEvents(){var i=this;this._gateway.signal.on(Ue.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Dt.PUBLISH,function(){var r=M(function*(a,l){a.forEach(d=>d.kind===Ee.VIDEO?(i._handleP2PAddAudioOrVideoStream("video",l),i._handleMuteStream(l,Ee.VIDEO,!!d.isMuted)):(i._handleP2PAddAudioOrVideoStream("audio",l),i._handleMuteStream(l,Ee.AUDIO,!!d.isMuted)))});return function(a,l){return r.apply(this,arguments)}}()),this._gateway.signal.on(he.P2P_START,function(){var r=M(function*(a,l){var d;i._p2pChannel instanceof ln&&l(yield i._p2pChannel.startP2P({turnServer:null===(d=i._joinInfo)||void 0===d?void 0:d.turnServer},a))});return function(a,l){return r.apply(this,arguments)}}()),this._gateway.signal.on(he.P2P_CONNECTION,function(){var r=M(function*(a){i._p2pChannel instanceof ln&&(yield i._p2pChannel.p2pConnect(a))});return function(a){return r.apply(this,arguments)}}()),this._gateway.signal.on(he.P2P_REMOTE_CANDIDATE_UPDATE,r=>{this._p2pChannel instanceof ln&&this._p2pChannel.addRemoteCandidate(JSON.parse(r))}),this._gateway.signal.on(Dt.SUBSCRIBE,function(){var r=M(function*(a,l,d){if(i._p2pChannel instanceof ln){const{trackType:h}=JSON.parse(a);try{yield i._p2pChannel.dopublish(h),l()}catch(p){d(p)}}});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.signal.on(Dt.UNSUBSCRIBE,function(){var r=M(function*(a,l,d){if(i._p2pChannel instanceof ln){const{mediaType:h}=JSON.parse(a);try{yield i._p2pChannel.doUnpublish(h),l()}catch(p){d(p)}}});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.signal.on(Dt.EXCHANGE_SDP,function(){var r=M(function*(a,l,d){if(i._p2pChannel instanceof ln){const{type:h,sdp:p}=JSON.parse(a);try{l(yield i._p2pChannel.setDescription(h,p))}catch(m){d(m)}}});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.signal.on(Dt.UNPUBLISH,function(){var r=M(function*(a,l,d){if(i._p2pChannel instanceof ln){const{unpubMsg:h,uid:p}=a;if(1===h.length){const m=h[0].stream_type===It.Audio?Ee.AUDIO:Ee.VIDEO;i._handleMuteStream(p,m,!0);const{sdp:g}=a;if(i._p2pChannel instanceof ln&&g){const E=i._users.find(y=>y.uid===p);if(!E)return w.warning("[".concat(i._clientId,"] can not find remote user, ignore mute event, uid: ").concat(p)),void l();i._p2pChannel.unsubscribe(E,g,m).then(y=>{y&&l(y)}).catch(d)}else l()}else i._handleRemoveStream(a,l,d)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.signal.on(Dt.CONTROL,function(){var r=M(function*(a,l,d){const{action:h,sdp:p,isMuteAll:m,uid:g}=a;switch(h){case ys.MUTE_LOCAL_VIDEO:i._handleMuteStream(g,Ee.VIDEO,!0,p,l,d);break;case ys.MUTE_LOCAL_AUDIO:l(),i._handleMuteStream(g,Ee.AUDIO,!0);break;case ys.UNMUTE_LOCAL_VIDEO:l(),i._handleP2PAddAudioOrVideoStream("video",g),i._handleMuteStream(g,Ee.VIDEO,!1);break;case ys.UNMUTE_LOCAL_AUDIO:l(),i._handleP2PAddAudioOrVideoStream("audio",g),i._handleMuteStream(g,Ee.AUDIO,!1)}m&&i._handleRemoveStream(a,l,d)});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.signal.on(Dt.DO_SUBSCRIBE,function(){var r=M(function*(a,l,d){if(i._p2pChannel instanceof ln){const{kind:h,sdp:p,ssrcId:m,uid:g}=a,E=i._users.find(y=>y.uid===g);if(!E)return w.error("[".concat(i._clientId,"] can not find target user!(on_add_stream)")),void l();try{l(yield i._p2pChannel.subscribe(E,h,p,m))}catch(y){d(y)}}});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.signal.on(Dt.DO_UNSUBSCRIBE,function(){var r=M(function*(a,l,d){if(i._p2pChannel instanceof ln){const{uid:h,kind:p,sdp:m}=a,g=i._users.find(E=>E.uid===h);if(!g)return w.error("[".concat(i._clientId,"] can not find target user!(on_add_stream)")),void l();try{l(yield i._p2pChannel.unsubscribe(g,m,p))}catch(E){d(E)}}});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.signal.on(Dt.RESTART_ICE,function(){var r=M(function*(a,l,d){if(i._p2pChannel instanceof ln)try{l(yield i._p2pChannel.setDescription("remote",a))}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.RequestP2PRestartICE,function(){var r=M(function*(a,l,d){try{l(yield i._gateway.sendExtensionMessage(Dt.RESTART_ICE,a))}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.LocalCandidate,r=>{this._gateway.sendExtensionMessage(Dt.CANDIDATE,JSON.stringify(r))}),this._p2pChannel.on(we.RequestP2PMuteLocal,function(){var r=M(function*(a,l,d){try{l(yield i._gateway.sendExtensionMessage(Dt.CONTROL,a))}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.RequestP2PPublish,function(){var r=M(function*(a,l,d){try{l(yield i._gateway.sendExtensionMessage(Dt.DO_SUBSCRIBE,a))}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.RequestP2PUnPublish,function(){var r=M(function*(a,l,d){try{l(yield i._gateway.sendExtensionMessage(Dt.DO_UNSUBSCRIBE,a))}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.RequestP2PUnmuteRemote,function(){var r=M(function*(a,l,d){if(i._joinInfo)try{yield i._gateway.unmuteRemote(a,i._joinInfo.stringUid||i._joinInfo.uid),l()}catch(h){h.code===x.DISCONNECT_P2P?l():d(h)}else l()});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.RequestP2PMuteRemote,function(){var r=M(function*(a,l,d){if(i._joinInfo)try{yield i._gateway.muteRemote(a,i._joinInfo.stringUid||i._joinInfo.uid),l()}catch(h){h.code===x.DISCONNECT_P2P?l():d(h)}else l()});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.StateChange,(r,a)=>{a===it.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){var i=this;this._p2pChannel.on(we.RequestMuteLocal,function(){var r=M(function*(a,l,d){if(i._joinInfo)try{yield i._gateway.muteLocal(a,i._joinInfo.stringUid||i._joinInfo.uid),l()}catch(h){h.code===x.DISCONNECT_P2P?l():d(h)}else l()});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.RequestUnmuteLocal,function(){var r=M(function*(a,l,d){if(i._joinInfo)try{yield i._gateway.unmuteLocal(a,i._joinInfo.stringUid||i._joinInfo.uid),l()}catch(h){h.code===x.DISCONNECT_P2P?l():d(h)}else l()});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.RequestRePublish,(r,a,l)=>{this.publish(r,!1).then(a).catch(l)}),this._p2pChannel.on(we.RequestRePublishDataChannel,(r,a,l)=>{q.all(r.map(function(){var d=M(function*(h){yield i._p2pChannel.publishDataChannel([h]);const p={streamId:h.id,ordered:h.ordered,maxRetransmits:h.maxRetransmits,metadata:h.metadata,channelId:h._originDataChannelId};try{yield i._gateway.publishDataChannel(i._uid,p,!0)}catch(m){if(m.code!==x.DISCONNECT_P2P)throw m}});return function(h){return d.apply(this,arguments)}}())).then(a).catch(l)}),this._p2pChannel.on(we.RequestReSubscribe,function(){var r=M(function*(a,l,d){try{for(const{user:h,kind:p}of a)p===Ee.VIDEO?yield i.subscribe(h,"video"):yield i.subscribe(h,"audio");l()}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.RequestUploadStats,(r,a)=>{this._gateway.uploadStats(r,a)}),this._p2pChannel.on(we.MediaReconnectStart,r=>{this.safeEmit(Xe.MEDIA_RECONNECT_START,r)}),this._p2pChannel.on(we.MediaReconnectEnd,r=>{this.safeEmit(Xe.MEDIA_RECONNECT_END,r)}),this._p2pChannel.on(we.NeedSignalRTT,r=>{r(this._gateway.getSignalRTT())}),this._p2pChannel.on(we.RequestRestartICE,function(){var r=M(function*(a){if(i._p2pChannel instanceof ln)return;const l=yield i._p2pChannel.restartICE(a),d=yield l.next();if(d.done)return;const h=d.value;let p;try{p=yield i._gateway.restartICE({iceParameters:h})}catch(g){return void l.throw(g)}const{iceParameters:m}=function(g){const E=g.iceParameters;return{iceParameters:{iceUfrag:E.iceUfrag,icePwd:E.icePwd}}}(p);yield l.next({remoteIceParameters:m})});return function(a){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.RequestReconnect,M(function*(){i._gateway.reconnect()})),this._p2pChannel.on(we.RequestReconnectPC,M(function*(){var r;const{iceParameters:a,dtlsParameters:l,rtpCapabilities:d}=yield i._p2pChannel.startP2PConnection({turnServer:null===(r=i._joinInfo)||void 0===r?void 0:r.turnServer}),{gatewayEstablishParams:h,gatewayAddress:p}=yield i._gateway.reconnectPC({iceParameters:a,dtlsParameters:l,rtpCapabilities:d}),{dtlsParameters:m,iceParameters:g,candidates:E,rtpCapabilities:y,setup:b,cname:T}=SN(h,p);yield i._p2pChannel.connect(g,m,E,y,b,T),yield i._p2pChannel.republish(),yield i._p2pChannel.reSubscribe()})),this._p2pChannel.on(we.RequestUnpublishForReconnectPC,function(){var r=M(function*(a,l,d){i._joinInfo&&void 0!==i._uid?(yield i._gateway.unpublish(a,i._uid),l()):d()});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.P2PLost,()=>{this.safeEmit(Xe.P2P_LOST,this.store.uid)}),this._p2pChannel.on(we.UpdateVideoEncoder,r=>{r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig)}),this._p2pChannel.on(we.ConnectionTypeChange,r=>{this.safeEmit(Xe.IS_USING_CLOUD_PROXY,r)}),this._p2pChannel.on(we.RequestLowStreamParameter,r=>{r(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(we.QueryClientConnectionState,r=>{r(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}enableContentInspect(i){var r=this;return M(function*(){if("CONNECTED"!==r.connectionState||!r._joinInfo)throw new W(x.INVALID_OPERATION,"[".concat(r._clientId,"] Client did not join channel"));if(r._inspect)throw new W(x.INVALID_OPERATION,"[".concat(r._clientId,"] Inspect content service already in connecting/connected state"));if(!i)throw new W(x.INVALID_PARAMS,"[".concat(r._clientId,"] inspectConfig is necessary"));if(!i.inspectType||!Array.isArray(i.inspectType))throw new W(x.INVALID_PARAMS,"[".concat(r._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const a=[...new Set(i.inspectType)];a.forEach(l=>{var d;if(!ye(d=["supervise","moderation"]).call(d,l))throw new W(x.INVALID_PARAMS,"[".concat(r._clientId,"] ").concat(l," is not a valid inspect type."))}),i.inspectType=a}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new W(x.INVALID_PARAMS,"[".concat(r._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const a=new Rv(i);r._inspect=a,r.handleVideoInspectEvents(r._inspect),yield a.init({appId:r._joinInfo.appId,areaCode:"",cname:r._joinInfo.cname,sid:r._joinInfo.sid,token:r._joinInfo.token,uid:r._joinInfo.uid,cid:r._joinInfo.cid,vid:r._joinInfo.vid?Number(r._joinInfo.vid):0},Re)}catch(a){throw Array.isArray(a)?a[0]:a}})()}disableContentInspect(){var i=this;return M(function*(){if(!i._inspect)throw new W(x.INVALID_OPERATION,"[".concat(i._clientId,"] inspectVideoContent not started"));try{i._inspect.close(),i._inspect=void 0}catch(r){throw Array.isArray(r)?r[0]:r}})()}setImageModeration(i,r){var a=this;return M(function*(){if(_s(i,"enabled"),i){if(!r)throw new W(x.INVALID_PARAMS,"[".concat(a._clientId,"] config is necessary"));if(ft(r.interval,"interval",1e3,1/0),"CONNECTED"!==a.connectionState||!a._joinInfo)throw new W(x.INVALID_OPERATION,"[".concat(a._clientId,'] can not enable image moderation, not joined"'));try{if(a._moderation)return void a._moderation.updateConfig(r);const l=new J0(r);a._moderation=l,a.handleImageModerationEvents(a._moderation),yield l.init({appId:a._joinInfo.appId,areaCode:"",cname:a._joinInfo.cname,sid:a._joinInfo.sid,token:a._joinInfo.token,uid:a._joinInfo.uid,cid:a._joinInfo.cid,vid:a._joinInfo.vid?Number(a._joinInfo.vid):0},Re)}catch(l){throw Array.isArray(l)?l[0]:l}}else{if(!a._moderation)throw new W(x.INVALID_OPERATION,"[".concat(a._clientId,"] image moderation not started"));try{a._moderation.close(),a._moderation.removeAllListeners(),a._moderation=void 0}catch(l){throw Array.isArray(l)?l[0]:l}}})()}handleImageModerationEvents(i){i.on(Xo.CONNECTION_STATE_CHANGE,(r,a)=>{if(this.safeEmit(Xe.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,a),r===Pr.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new W(x.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");i.inspectImage()}}),i.on(Xo.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(a=>"video"===a.trackMediaType)[0])})}handleVideoInspectEvents(i){i.on(jn.CONNECTION_STATE_CHANGE,(r,a)=>{if(this.safeEmit(Xe.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,a),a===Nr.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit(Xe.CONTENT_INSPECT_ERROR,new W(x.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));i.inspectImage()}}),i.on(jn.INSPECT_RESULT,(r,a)=>{var l;if(a?.code===x.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return w.debug("Stop inspect content because that has left channel"),null==this||null===(l=this._inspect)||void 0===l||l.close(),void(this._inspect=void 0);this.safeEmit(Xe.CONTENT_INSPECT_RESULT,r,a)}),i.on(jn.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(a=>"video"===a.trackMediaType)[0])})}getJoinChannelServiceRecords(){return w.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}setPublishAudioFilterEnabled(i){var r=this;return M(function*(){_s(i,"enabled"),At("ENABLE_PUBLISH_AUDIO_FILTER",i),r._joinInfo&&(yield r._gateway.setPublishAudioFilterEnabled(i))})()}_handleResetAddStream(i,r){switch(r){case"audio":i._audio_added_=!1,i._trust_audio_stream_added_state_=!0;break;case"video":i._video_added_=!1,i._trust_video_stream_added_state_=!0}}}te([Ae(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",q)],Nt.prototype,"leave",null),te([Ae({argsMap:(s,i)=>{if(!Array.isArray(i)){if(!(i instanceof Ri))return[i];i=[i]}return i.map(r=>r?Object(r).toString():"null")}}),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",q)],Nt.prototype,"publish",null),te([Ae({argsMap:(s,i)=>(i||(i=[]),i instanceof Ro?[i.getChannelId()]:(Array.isArray(i)||(i=[i]),i.map(r=>r.getTrackId())))}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",q)],Nt.prototype,"unpublish",null),te([Ae({argsMap:(s,i,r,a)=>[i.uid,r,a]}),N("design:type",Function),N("design:paramtypes",[Oi,String,Number]),N("design:returntype",q)],Nt.prototype,"subscribe",null),te([Ae({argsMap:(s,i)=>i.map(r=>{let{user:a,mediaType:l}=r;return[a?.uid,l]})}),N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],Nt.prototype,"massSubscribe",null),te([Ae({argsMap:(s,i,r,a)=>[i.uid,r,a]}),N("design:type",Function),N("design:paramtypes",[Oi,String,Number]),N("design:returntype",q)],Nt.prototype,"unsubscribe",null),te([Ae({argsMap:(s,i)=>i.map(r=>{let{user:a,mediaType:l}=r;return{uid:a?.uid,mediaType:l}})}),N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",q)],Nt.prototype,"massUnsubscribe",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",q)],Nt.prototype,"setLowStreamParameter",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",q)],Nt.prototype,"enableDualStream",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",q)],Nt.prototype,"disableDualStream",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[String,Object]),N("design:returntype",q)],Nt.prototype,"setClientRole",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[String,Boolean]),N("design:returntype",void 0)],Nt.prototype,"setProxyServer",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",void 0)],Nt.prototype,"setTurnServer",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",void 0)],Nt.prototype,"setLicense",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],Nt.prototype,"startProxyServer",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Nt.prototype,"stopProxyServer",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],Nt.prototype,"setLocalAccessPointsV2",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Array,String]),N("design:returntype",void 0)],Nt.prototype,"setLocalAccessPoints",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",q)],Nt.prototype,"setRemoteDefaultVideoStreamType",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Object,Number]),N("design:returntype",q)],Nt.prototype,"setRemoteVideoStreamType",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Object,Number]),N("design:returntype",q)],Nt.prototype,"setStreamFallbackOption",null),te([Ae({argsMap:(s,i)=>[i]}),N("design:type",Function),N("design:paramtypes",[String,String,Uint8Array]),N("design:returntype",void 0)],Nt.prototype,"setEncryptionConfig",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Nt.prototype,"renewToken",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Nt.prototype,"enableAudioVolumeIndicator",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[String,Boolean]),N("design:returntype",q)],Nt.prototype,"startLiveStreaming",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",q)],Nt.prototype,"setLiveTranscoding",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",q)],Nt.prototype,"stopLiveStreaming",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[String,Object]),N("design:returntype",q)],Nt.prototype,"addInjectStreamUrl",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",q)],Nt.prototype,"removeInjectStreamUrl",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[om]),N("design:returntype",q)],Nt.prototype,"startChannelMediaRelay",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[om]),N("design:returntype",q)],Nt.prototype,"updateChannelMediaRelay",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",q)],Nt.prototype,"stopChannelMediaRelay",null),te([Ae({argsMap:(s,i)=>(Array.isArray(i)||(i=[i]),[JSON.stringify(i)])}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",q)],Nt.prototype,"sendCustomReportMessage",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Object,Object]),N("design:returntype",q)],Nt.prototype,"pickSVCLayer",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",q)],Nt.prototype,"setRTM2Flag",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",q)],Nt.prototype,"enableContentInspect",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",q)],Nt.prototype,"disableContentInspect",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Boolean,Object]),N("design:returntype",q)],Nt.prototype,"setImageModeration",null),te([Ae({reportResult:!0}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",Array)],Nt.prototype,"getJoinChannelServiceRecords",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Boolean]),N("design:returntype",q)],Nt.prototype,"setPublishAudioFilterEnabled",null);class fm{constructor(i,r){C(this,"id",0),C(this,"element",void 0),C(this,"peerPair",void 0),C(this,"context",void 0),C(this,"audioPlayerElement",void 0),C(this,"audioTrack",void 0),fm.count+=1,this.id=fm.count,this.element=i,this.context=r}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=i=>{const r=document.createElement("audio");r.srcObject=new MediaStream([i.track]),r.play(),this.audioPlayerElement=r}}switchSdp(){var i=this;return M(function*(){if(!i.peerPair)return;const r=function(){var l=M(function*(d,h){const p="offer"===h?yield d.createOffer():yield d.createAnswer();return yield d.setLocalDescription(p),"complete"===d.iceGatheringState?d.localDescription:new q(m=>{d.onicegatheringstatechange=()=>{"complete"===d.iceGatheringState&&m(d.localDescription)}})});return function(h,p){return l.apply(this,arguments)}}(),a=function(){var l=M(function*(d,h){return yield d.setRemoteDescription(h)});return function(h,p){return l.apply(this,arguments)}}();try{const l=yield r(i.peerPair[0],"offer");yield a(i.peerPair[1],l);const d=yield r(i.peerPair[1],"answer");yield a(i.peerPair[0],d)}catch(l){throw new W(x.LOCAL_AEC_ERROR,l.toString()).print()}})()}getTracksFromMediaElement(i){var r=this;return M(function*(){if(r.audioTrack)return r.audioTrack;let a;try{i instanceof HTMLVideoElement&&(i.captureStream?i.captureStream():i.mozCaptureStream()),a=r.context.createMediaStreamDestination(),r.context.createMediaElementSource(i).connect(a)}catch(d){throw new W(x.LOCAL_AEC_ERROR,d.toString()).print()}if(!a)throw new W(x.LOCAL_AEC_ERROR,"no dest node when local aec").print();const l=a.stream.getAudioTracks()[0];return r.audioTrack=l,l})()}getElement(){return this.element}startEchoCancellation(){var i=this;return M(function*(){i.context.resume(),i.peerPair&&i.close(),i.initPeers();const r=i.element,a=yield i.getTracksFromMediaElement(r);i.peerPair&&i.peerPair[0].addTrack(a),yield i.switchSdp()})()}close(){w.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(i=>{i.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}C(fm,"count",0);const JN=window.AudioContext||window.webkitAudioContext;class tT{constructor(){C(this,"units",[]),C(this,"context",void 0)}processExternalMediaAEC(i){if(!this._doesEnvironmentNeedAEC())return w.debug("the system does not need to process local aec"),-1;this.context||(this.context=new JN);let r=this.units.find(a=>a&&a.getElement()===i);return r||(r=new fm(i,this.context),this.units.push(r)),r.startEchoCancellation(),w.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return dt().name!==Ne.SAFARI}}te([Ae({report:Se}),N("design:type",Function),N("design:paramtypes",[HTMLAudioElement]),N("design:returntype",Number)],tT.prototype,"processExternalMediaAEC",null);const QN=new tT;function Q2(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function ZN(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?Q2(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Q2(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}const eP=window||document;function tP(s){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!eP)return;const r=Gn._cspEventHandlerPointer;if(r&&i)return void console.error(r,i);const a=l=>{if(!(l&&l.blockedURI&&(Gn.onSecurityPolicyViolation||Gn.getListeners(Lt.SECURITY_POLICY_VIOLATION).length>0)))return;const d=l.blockedURI;j("CSP_DETECTED_HOSTNAME_LIST").some(h=>ye(d).call(d,h))&&(Gn.onSecurityPolicyViolation&&"function"==typeof Gn.onSecurityPolicyViolation&&Gn.onSecurityPolicyViolation(l),Gn.getListeners(Lt.SECURITY_POLICY_VIOLATION).length>0&&Gn.safeEmit(Lt.SECURITY_POLICY_VIOLATION,l))};r&&eP.removeEventListener("securitypolicyviolation",r),(i||s&&"function"==typeof s||Gn.getListeners(Lt.SECURITY_POLICY_VIOLATION).length>0)&&eP.addEventListener("securitypolicyviolation",a),Gn._cspEventHandlerPointer=a}At("PROCESS_ID","process-".concat(Fe(8,""),"-").concat(Fe(4,""),"-").concat(Fe(4,""),"-").concat(Fe(4,""),"-").concat(Fe(12,""))),function(){const s=dt();Ei.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Ei.getStreamFromExtension=s.name===Ne.CHROME&&Number(s.version)>34,Ei.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const i=new RTCPeerConnection;let r=!1;try{i.addTransceiver("audio"),r=!0}catch{}return i.close(),r}(),Ei.supportMinBitrate=s.name===Ne.CHROME||s.name===Ne.EDGE,Ei.supportSetRtpSenderParameters=function(){const i=dt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!zs()||!(!Ki()&&!zg())||i.name===Ne.FIREFOX&&Number(i.version)>=64)}(),s.name===Ne.SAFARI&&(Ei.supportDualStream=Number(s.version)>=14),Ei.webAudioMediaStreamDest=function(){const i=dt();return!(i.name===Ne.SAFARI&&Number(i.version)<12)}(),Ei.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,Ei.supportWebGL=typeof WebGLRenderingContext<"u",Ei.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,zs()||(Ei.webAudioWithAEC=!0),Ei.supportShareAudio=function(){const i=dt();return(i.os===Fn.WIN_10||i.os===Fn.WIN_81||i.os===Fn.WIN_7||i.os===Fn.LINUX||i.os===Fn.MAC_OS)&&i.name===Ne.CHROME&&Number(i.version)>=74}(),Ei.supportDataChannel=!!(Kg(76)||function(i){const r=dt();return!(r.name!==Ne.FIREFOX||!r.osVersion)&&Number(r.version)>=68}()||function(i){const r=dt();return!(r.name!==Ne.SAFARI||!r.osVersion)&&Number(r.version)>=14}()),Ei.supportPCSetConfiguration=function(){const i=window.RTCPeerConnection;return!Wt()&&!!i&&i.prototype.setConfiguration instanceof Function}(),Ei.supportWebRTCEncodedTransform=function(){const i=dt();return"Chrome"===i.name&&Number(i.version)>=86}(),Ei.supportWebRTCInsertableStream=function(){const i=dt();return(i.name===Ne.CHROME||i.name===Ne.EDGE)&&Number(i.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),mo(()=>{Ei.supportDualStreamEncoding=function(){const i=dt();return!!j("DISABLE_WEBAUDIO")||"Safari"===i.name&&Number(i.version)>=14||!!("Chrome"===i.name&&/Windows/i.test(i.os||"")&&Number(i.version)>=100&&j("CHROME_DUAL_STREAM_USE_ENCODING"))}(),w.info("browser compatibility",JSON.stringify(Ei),JSON.stringify(s))})}(),function(){let s;try{s=window.localStorage.getItem("websdk_ng_global_parameter")}catch(i){return void w.error("Error loading sdk config",i.message)}if(s)try{const i=JSON.parse(window.atob(s)),r=Date.now();w.debug("Loading global parameters from cache",i),Object.keys(i).forEach(a=>{if(Object.prototype.hasOwnProperty.call(ri,a)){const{value:l,expires:d}=i[a];if(d&&d<=r)return;Ys[a]=l,ri[a]=l}})}catch(i){w.error("Error loading mutableParamsCache: ".concat(s),i.message)}}(),Array.isArray(Ys.AREAS)&&Ys.AREAS.length>0&&In(Ys.AREAS,!0);const Gn=function(s){const i=new zt,r=s,a={getListeners:i.getListeners.bind(i),on:(l,d)=>(l===Lt.SECURITY_POLICY_VIOLATION&&tP(d,!0),i.on.bind(i)(l,d)),addListener:i.addListener.bind(i),once:i.once.bind(i),off:i.off.bind(i),removeAllListeners:i.removeAllListeners.bind(i),emit:i.emit.bind(i),safeEmit:i.safeEmit.bind(i)};return ZN(ZN({},r),a)}({__TRACK_LIST__:Sh,VERSION:Yo,BUILD:JS,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:(s,i,r)=>{w.debug("setParameter key:".concat(s,", value:").concat(JSON.stringify(i))),At(s,i,r)},getParameter:j,getSupportedCodec:function(){var s=M(function*(){let i={audio:[],video:[]};try{let r=new RTCPeerConnection;r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});const a=(yield r.createOffer()).sdp;if(!a)return i;r.close(),r=null,i=function(l){const d={video:[],audio:[]};return l.match(/ VP8/i)&&d.video.push("VP8"),l.match(/ VP9/i)&&d.video.push("VP9"),l.match(/ AV1/i)&&d.video.push("AV1"),l.match(/ H264/i)&&d.video.push("H264"),l.match(/ H265/i)&&d.video.push("H265"),l.match(/ opus/i)&&d.audio.push("OPUS"),l.match(/ PCMU/i)&&d.audio.push("PCMU"),l.match(/ PCMA/i)&&d.audio.push("PCMA"),l.match(/ G722/i)&&d.audio.push("G722"),d}(a)}catch(r){throw new W(x.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return i});return function(){return s.apply(this,arguments)}}(),checkSystemRequirements:function(){const s=Se.reportApiInvoke(null,{name:On.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Xt.TRACER});let i=!1;try{const d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,p=window.WebSocket;i=!!(d&&h&&p)}catch(d){return w.error("check system requirement failed: ",d),!1}let r=!1;const a=dt();a.name===Ne.CHROME&&Number(a.version)>=58&&(!function PA(){return"WebKit"===lc.engine.name}()||function Fk(){const s=dt();if(zg()){if(s.os===Fn.MAC_OS)return!0;if(s.os===Fn.IOS){const i=lc.os.version&&lc.os.version.split(".");if(i&&14===Number(i[0])&&i[1]&&Number(i[1])>=3||i&&Number(i[0])>14)return!0}}return!1}())&&(r=!0),a.name===Ne.FIREFOX&&Number(a.version)>=56&&(r=!0),a.name===Ne.OPERA&&Number(a.version)>=45&&(r=!0),a.name===Ne.SAFARI&&Number(a.version)>=11&&(r=!0),(_r()||dt().name===Ne.QQ)&&(r=!0),w.debug("checkSystemRequirements, api:",i,"browser",r);const l=i&&r;return s.onSuccess(l),l},getDevices:function(s){return Zo.enumerateDevices(!0,!0,s)},getMicrophones:function(s){return Zo.getRecordingDevices(s)},getCameras:function(s){return Zo.getCamerasDevices(s)},getElectronScreenSources:SC,getPlaybackDevices:function(s){return Zo.getSpeakers(s)},createClient:function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const i=Se.reportApiInvoke(null,{name:On.CREATE_CLIENT,options:[s],tag:Xt.TRACER});try{gn((r=s).codec,"config.codec",["vp8","vp9","av1","h264","h265"]),gn(r.mode,"config.mode",["rtc","live"]),void 0!==r.audioCodec&&gn(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==r.proxyServer&&Un(r.proxyServer,"config.proxyServer",1,1e4),void 0!==r.turnServer&&Jg(r.turnServer),void 0!==r.httpRetryConfig&&Xg(r.httpRetryConfig),void 0!==r.websocketRetryConfig&&Xg(r.websocketRetryConfig)}catch(r){throw i.onError(r),r}var r;return function J2(){return!function(s,i,r){const a=dt();if(a.os!==Fn.IOS||!a.osVersion)return!1;const l=a.osVersion.split(".");return Number(l[0])<16}()&&!function(s,i,r){const a=dt();if(a.name!==Ne.SAFARI||!a.osVersion)return!1;const l=a.version.split(".");return Number(l[0])<16}()}()||(s.codec="vp8",w.debug("browser not support vp9, force use vp8"),At("FILTER_VIDEO_CODEC",["vp8"])),void 0===s.audioCodec&&(s.audioCodec="opus"),i.onSuccess(),new Nt(Xh(Xh({forceWaitGatewayResponse:!0},s),{},{role:"rtc"===s.mode?"host":s.role||"audience"}))},createCameraVideoTrack:function(){var s=M(function*(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=Se.reportApiInvoke(null,{tag:Xt.TRACER,name:On.CREATE_CAM_VIDEO_TRACK,options:[MC({},i)]}),a=FE(i),l=Fe(8,"track-cam-");let d=null;const h="720p_auto"===i.encoderConfig;w.info("start create camera video track with config",JSON.stringify(i),"trackId",l);try{d=(yield Qo({video:a},l)).getVideoTracks()[0]||null}catch(m){throw r.onError(m),m}if(!d){const m=new J(x.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(m),m.throw(w)}i.optimizationMode&&gO(l,d,i,Ma(i.encoderConfig));const p=new Ad(d,i,a,i.scalabiltyMode?SE(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,l);return h&&p.startMonitorStats(),r.onSuccess(p.getTrackId()),w.info("create camera video success, trackId:",l),p});return function(){return s.apply(this,arguments)}}(),createCustomVideoTrack:function(s){const i=Se.reportApiInvoke(null,{tag:Xt.TRACER,name:On.CREATE_CUSTOM_VIDEO_TRACK,options:[s]}),r=new ze(s.mediaStreamTrack,{width:s.width,height:s.height,frameRate:s.frameRate,bitrateMax:s.bitrateMax,bitrateMin:s.bitrateMin},s.scalabiltyMode?SE(s.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},s.optimizationMode,Fe(8,"track-cus-"),[Ot.CUSTOM_TRACK]);return i.onSuccess(r.getTrackId()),w.info("create custom video track success with config",s,"trackId",r.getTrackId()),r},createScreenVideoTrack:function(){var s=M(function*(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const a=Se.reportApiInvoke(null,{tag:Xt.TRACER,name:On.CREATE_SCREEN_VIDEO_TRACK,options:[MC({},i),r]}),l="720p_auto"===i.encoderConfig;i.encoderConfig?"string"==typeof i.encoderConfig||i.encoderConfig.width&&i.encoderConfig.height||(i.encoderConfig.width={max:1920},i.encoderConfig.height={max:1080}):i.encoderConfig="1080p_2";const d=function(b){const T={};b.screenSourceType&&(T.mediaSource=b.screenSourceType),b.extensionId&&qg()&&(T.extensionId=b.extensionId);const{displaySurface:O,selfBrowserSurface:P,surfaceSwitching:D,systemAudio:L}=b;(Kg(107)||Uk(107)||_f(93))&&(O&&(gn(O,"displaySurface",["browser","window","monitor"]),T.displaySurface=O),P?(gn(P,"selfBrowserSurface",["exclude","include"]),T.selfBrowserSurface=P):T.selfBrowserSurface="include",D&&(gn(D,"surfaceSwitching",["exclude","include"]),T.surfaceSwitching=D)),(Kg(105)||Uk(105)||_f(91))&&L&&(gn(L,"systemAudio",["exclude","include"]),T.systemAudio=L),b.electronScreenSourceId&&(T.sourceId=b.electronScreenSourceId);const B=b.encoderConfig?XD(b.encoderConfig):null;return T.mandatory={chromeMediaSource:"desktop",maxWidth:B?B.width:void 0,maxHeight:B?B.height:void 0},B&&(B.frameRate&&("number"==typeof B.frameRate?(T.mandatory.maxFrameRate=B.frameRate,T.mandatory.minFrameRate=B.frameRate):(T.mandatory.maxFrameRate=B.frameRate.max||B.frameRate.ideal||B.frameRate.exact||void 0,T.mandatory.minFrameRate=B.frameRate.min||B.frameRate.ideal||B.frameRate.exact||void 0),T.frameRate=B.frameRate),B.width&&(T.width=B.width),B.height&&(T.height=B.height)),T}(i),h=Fe(8,"track-scr-v-");let p=null,m=null;const g=$e();if(!g.supportShareAudio&&"enable"===r){const b=new J(x.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return a.onError(b),b.throw(w)}w.info("start create screen video track with config",i,"withAudio",r,"trackId",h);try{const b=yield Qo({screen:d,screenAudio:"auto"===r?g.supportShareAudio:"enable"===r},h);p=b.getVideoTracks()[0]||null,m=b.getAudioTracks()[0]||null}catch(b){throw a.onError(b),b}if(!p){const b=new J(x.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(b),b.throw(w)}if(!m&&"enable"===r){p&&p.stop();const b=new J(x.SHARE_AUDIO_NOT_ALLOWED);return a.onError(b),b.throw(w)}i.optimizationMode||(i.optimizationMode="detail"),i.optimizationMode&&(gO(h,p,i,i.encoderConfig&&XD(i.encoderConfig)||void 0),i.encoderConfig&&"string"!=typeof i.encoderConfig&&(i.encoderConfig.bitrateMin=i.encoderConfig.bitrateMax));const E=new ze(p,i.encoderConfig?XD(i.encoderConfig):{},i.scalabiltyMode?SE(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,h,[Ot.SCREEN_TRACK]);if(l&&E.startMonitorStats(),!m)return a.onSuccess(E.getTrackId()),w.info("create screen video track success","video:",E.getTrackId()),E;const y=new mt(m,void 0,Fe(8,"track-scr-a-"),!1,!0);return a.onSuccess([E.getTrackId(),y.getTrackId()]),w.info("create screen video track success","video:",E.getTrackId(),"audio:",y.getTrackId()),[E,y]});return function(){return s.apply(this,arguments)}}(),createMicrophoneAndCameraTracks:function(){var s=M(function*(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=Se.reportApiInvoke(null,{tag:Xt.TRACER,name:On.CREATE_MIC_AND_CAM_TRACKS,options:[i,r]}),l="720p_auto"===r.encoderConfig,d=FE(r),h=AC(i),p=Fe(8,"track-mic-"),m=Fe(8,"track-cam-");let g=null,E=null;w.info("start create camera video track(".concat(m,") and microphone audio track(").concat(p,") with config, audio: ").concat(JSON.stringify(i),", video: ").concat(JSON.stringify(r)));try{const T=yield Qo({audio:h,video:d},"".concat(p,"-").concat(m));g=T.getAudioTracks()[0],E=T.getVideoTracks()[0]}catch(T){throw a.onError(T),T}if(!g||!E){const T=new J(x.UNEXPECTED_ERROR,"can not find tracks in media stream");return a.onError(T),T.throw(w)}r.optimizationMode&&gO(m,E,r,Ma(r.encoderConfig));const y=new Rd(g,i,h,p),b=new Ad(E,r,d,r.scalabiltyMode?SE(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,m);return l&&b.startMonitorStats(),a.onSuccess([y.getTrackId(),b.getTrackId()]),w.info("create camera video track(".concat(m,") and microphone audio track(").concat(p,") success")),[y,b]});return function(){return s.apply(this,arguments)}}(),createMicrophoneAudioTrack:function(){var s=M(function*(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=Se.reportApiInvoke(null,{tag:Xt.TRACER,name:On.CREATE_MIC_AUDIO_TRACK,options:[i]}),a=AC(i),l=Fe(8,"track-mic-");let d=null;w.info("start create microphone audio track with config",JSON.stringify(i),"trackId",l);try{d=(yield Qo({audio:a},l)).getAudioTracks()[0]||null}catch(p){throw r.onError(p),p}if(!d){const p=new J(x.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(p),p.throw(w)}const h=new Rd(d,i,a,l);return r.onSuccess(h.getTrackId()),w.info("create microphone audio track success, trackId:",l),h});return function(){return s.apply(this,arguments)}}(),createCustomAudioTrack:function(s){const i=Se.reportApiInvoke(null,{tag:Xt.TRACER,name:On.CREATE_CUSTOM_AUDIO_TRACK,options:[s]}),r=new mt(s.mediaStreamTrack,s.encoderConfig?Ss(s.encoderConfig):{},Fe(8,"track-cus-"),!1,!0);return w.info("create custom audio track success with config",s,"trackId",r.getTrackId()),i.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:function(){var s=M(function*(i){var r;const{cacheOnlineFile:a,encoderConfig:l}=i;let{source:d}=i;const h={source:d instanceof AudioBuffer?"AudioBuffer":d instanceof File?null!==(r=File.name)&&void 0!==r?r:"File":d,cacheOnlineFile:a,encoderConfig:l},p=Se.reportApiInvoke(null,{tag:Xt.TRACER,name:On.CREATE_BUFFER_AUDIO_TRACK,options:[h]});if(j("DISABLE_WEBAUDIO"))throw new J(x.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const m=Fe(8,"track-buf-");w.info("start create buffer source audio track with config",JSON.stringify(h),"trackId",m);const g=d;if(!(d instanceof AudioBuffer))try{d=yield function pO(s,i){return UE.apply(this,arguments)}(d,a)}catch(b){return p.onError(b),b.throw(w)}const E=new uO(d),y=new Sl(g,E,l?Ss(l):{},m);return w.info("create buffer source audio track success, trackId:",m),p.onSuccess(y.getTrackId()),y});return function(r){return s.apply(this,arguments)}}(),setAppType:function(s){if(w.debug("setAppType: ".concat(s)),!(Number.isInteger(s)&&s>=0))throw w.debug("Invalid appType"),new W(x.INVALID_PARAMS,"invalid app type",s);At("APP_TYPE",Math.floor(s))},setLogLevel:function(s){w.setLogLevel(s)},enableLogUpload:function(){j("USE_NEW_LOG")?At("UPLOAD_LOG",!0):w.enableLogUpload()},disableLogUpload:function(){j("USE_NEW_LOG")?At("UPLOAD_LOG",!1):w.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new om},checkAudioTrackIsActive:function(){var s=M(function*(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const a=Se.reportApiInvoke(null,{tag:Xt.TRACER,name:On.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(i instanceof mt||i instanceof Co)){const g=new W(x.INVALID_TRACK,"the parameter is not a audio track");return a.onError(g),g.throw()}r&&r<1e3&&(r=1e3);const l=i instanceof mt?i.getTrackLabel():"remote_track",d=i.getVolumeLevel();let h=d,p=d;const m=Date.now();return new q(g=>{const E=setInterval(()=>{const y=i.getVolumeLevel();h=y>h?y:h,p=y<p?y:p;const b=h-p>1e-4,T=Date.now()-m;if(b||T>r){clearInterval(E);const O=b,P={duration:T,deviceLabel:l,maxVolumeLevel:h,result:O};w.info("[track-".concat(i.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(P))),a.onSuccess(P),g(O)}},200)})});return function(r){return s.apply(this,arguments)}}(),checkVideoTrackIsActive:function(){var s=M(function*(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const a=Se.reportApiInvoke(null,{tag:Xt.TRACER,name:On.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(i instanceof ze||i instanceof Cs)){const b=new W(x.INVALID_TRACK,"the parameter is not a video track");return a.onError(b),b.throw()}r&&r<1e3&&(r=1e3);const l=i instanceof ze?i.getTrackLabel():"remote_track",d=i.getMediaStreamTrack(!0),h=document.createElement("video");h.style.width="1px",h.style.height="1px",h.setAttribute("muted",""),h.muted=!0,h.setAttribute("playsinline",""),h.controls=!1,(Ki()||zg())&&(h.style.opacity="0.01",h.style.position="fixed",h.style.left="0",h.style.top="0",document.body.appendChild(h)),h.srcObject=new MediaStream([d]),h.play();const p=document.createElement("canvas");p.width=160,p.height=120;let m=0,g=0;try{const b=Date.now();m=yield function(T,O,P,D){let L,B=0,V=null;return new q((Q,se)=>{setTimeout(()=>{L&&(L(),Q(B))},O),L=OE(()=>{!function K(){B>4&&L&&(L(),Q(B));const ee=P.getContext("2d");if(!ee){const _e=new W(x.UNEXPECTED_ERROR,"can not get canvas 2d context.");return w.error(_e.toString()),void se(_e)}ee.drawImage(T,0,0,160,120);const $=ee.getImageData(0,0,P.width,P.height),Y=Math.floor($.data.length/3);if(V){for(let _e=0;_e<Y;_e+=3)if($.data[_e]!==V[_e])return B+=1,void(V=$.data);V=$.data}else V=$.data}()},30)})}(h,r,p),g=Date.now()-b}catch(b){throw a.onError(b),b}X2===Ne.SAFARI&&(h.pause(),h.remove()),h.srcObject=null;const E=m>4,y={duration:g,changedPicNum:m,deviceLabel:l,result:E};return w.info("[track-".concat(i.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(y))),a.onSuccess(y),E});return function(r){return s.apply(this,arguments)}}(),setArea:In,audioElementPlayCenter:Xr,processExternalMediaAEC:function(s){QN.processExternalMediaAEC(s)},registerExtensions:function(s){s.forEach(i=>{const r=i;r.__registered__=!0,r.logger.hookLog=w.extLog,r.reporter.hookApiInvoke=Se.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach(a=>{r.parameters[a]=j(a)})})},ChannelMediaRelayError:_l,ChannelMediaRelayEvent:$s,ChannelMediaRelayState:Ji,RemoteStreamFallbackType:TE,RemoteStreamType:CE,ConnectionDisconnectedReason:Ye,AudienceLatencyLevelType:LA,AREAS:st});return Object.defineProperties(Gn,{onAudioAutoplayFailed:{get:()=>So.onAudioAutoplayFailed,set:s=>{So.onAudioAutoplayFailed=s}},onAutoplayFailed:{get:()=>So.onAutoplayFailed,set:s=>{So.onAutoplayFailed=s}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Gn._onSecurityPolicyViolation,set(s){Gn._onSecurityPolicyViolation=s,tP(s)}},__CLIENT_LIST__:{get:()=>j("SHOW_GLOBAL_CLIENT_LIST")?pc:[]}}),Zo.on(ka.CAMERA_DEVICE_CHANGED,s=>{w.info("camera device changed",JSON.stringify(s)),Gn.onCameraChanged&&Gn.onCameraChanged(s),Gn.safeEmit(Lt.CAMERA_CHANGED,s)}),Zo.on(ka.RECORDING_DEVICE_CHANGED,s=>{w.info("microphone device changed",JSON.stringify(s)),Gn.onMicrophoneChanged&&Gn.onMicrophoneChanged(s),Gn.safeEmit(Lt.MICROPHONE_CHANGED,s)}),Zo.on(ka.PLAYOUT_DEVICE_CHANGED,s=>{w.debug("playout device changed",JSON.stringify(s)),Gn.onPlaybackDeviceChanged&&Gn.onPlaybackDeviceChanged(s),Gn.safeEmit(Lt.PLAYBACK_DEVICE_CHANGED,s)}),Xr.onAutoplayFailed=()=>{w.info("detect audio element autoplay failed"),So.onAudioAutoplayFailed&&So.onAudioAutoplayFailed()},vt.on("autoplay-failed",()=>{w.info("detect webaudio autoplay failed"),So.onAudioAutoplayFailed&&So.onAudioAutoplayFailed(),Gn.safeEmit(Lt.AUTOPLAY_FAILED)}),on.on(dc.NETWORK_STATE_CHANGE,(s,i)=>{w.info("[network-indicator] network state changed, ".concat(i," => ").concat(s))}),window&&(window.__ARTC__=Gn),Gn}()},156:Oc=>{function xm(M,Nc,ua,ha,kn,Mo,Pc){try{var xc=M[Mo](Pc),Ur=xc.value}catch(Mc){return void ua(Mc)}xc.done?Nc(Ur):Promise.resolve(Ur).then(ha,kn)}Oc.exports=function ap(M){return function(){var Nc=this,ua=arguments;return new Promise(function(ha,kn){var Mo=M.apply(Nc,ua);function Pc(Ur){xm(Mo,ha,kn,Pc,xc,"next",Ur)}function xc(Ur){xm(Mo,ha,kn,Pc,xc,"throw",Ur)}Pc(void 0)})}},Oc.exports.__esModule=!0,Oc.exports.default=Oc.exports}},Oc=>{Oc(Oc.s=567)}]);